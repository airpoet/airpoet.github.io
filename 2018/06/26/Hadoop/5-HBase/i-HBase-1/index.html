<!DOCTYPE html>




<html class="theme-next pisces" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">


  <link rel="manifest" href="/images/manifest.json">


  <meta name="msapplication-config" content="/images/browserconfig.xml" />



  <meta name="keywords" content="原创,技术,Hadoop,HBase," />





  <link rel="alternate" href="/atom.xml" title="A.P的文艺杂谈" type="application/atom+xml" />






<meta name="description" content="Hbase概念 hbase &amp;amp; hdfs 关系图   hadoop数据库，分布式可伸缩大型数据存储。  用户对随机、实时读写数据。  十亿行 x 百万列。      版本化、非关系型数据库。   Feature Linear and modular scalability. //线性模块化扩展方式。 Strictly consistent reads and writes. //严格一致性">
<meta name="keywords" content="原创,技术,Hadoop,HBase">
<meta property="og:type" content="article">
<meta property="og:title" content="i-HBase-1">
<meta property="og:url" content="https://airpoet.github.io/2018/06/26/Hadoop/5-HBase/i-HBase-1/index.html">
<meta property="og:site_name" content="A.P的文艺杂谈">
<meta property="og:description" content="Hbase概念 hbase &amp;amp; hdfs 关系图   hadoop数据库，分布式可伸缩大型数据存储。  用户对随机、实时读写数据。  十亿行 x 百万列。      版本化、非关系型数据库。   Feature Linear and modular scalability. //线性模块化扩展方式。 Strictly consistent reads and writes. //严格一致性">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://img.mubu.com/document_image/40f0d2a9-20f1-4f73-84d9-e31b52685aad-584150.jpg">
<meta property="og:image" content="https://img.mubu.com/document_image/d4572c94-9da5-463f-a721-0c4dc42b87db-584150.jpg">
<meta property="og:image" content="https://img.mubu.com/document_image/feb7a6a8-6dfb-463a-8d57-181502d3d0e9-584150.jpg">
<meta property="og:image" content="https://img.mubu.com/document_image/13cfae11-e0c1-46fb-be2c-799578d701c9-584150.jpg">
<meta property="og:image" content="https://img.mubu.com/document_image/da7a0e5d-7157-458c-abfc-e17a2c81796f-584150.jpg">
<meta property="og:image" content="https://img.mubu.com/document_image/9a336ce6-5915-44bc-a3a6-f8ad86de7611-584150.jpg">
<meta property="og:image" content="https://img.mubu.com/document_image/12d391d8-836e-48de-bf08-53a95e01343c-584150.jpg">
<meta property="og:image" content="https://img.mubu.com/document_image/5c640ea0-d4ff-43ed-94bb-ebebfc35aa62-584150.jpg">
<meta property="og:image" content="https://img.mubu.com/document_image/ebc78e6e-830c-49af-a05f-c79ec1bad8d6-584150.jpg">
<meta property="og:image" content="https://img.mubu.com/document_image/7d75648a-c26c-46c9-9c06-286805d4270b-584150.jpg">
<meta property="og:image" content="https://img.mubu.com/document_image/36f8af62-4775-498f-a399-3e6a7f748382-584150.jpg">
<meta property="og:image" content="https://img.mubu.com/document_image/16c4bf5b-b2ea-4908-a6d2-1fc2cf779e22-584150.jpg">
<meta property="og:image" content="https://img.mubu.com/document_image/78a0ca5e-5ead-4a01-b37c-e5e29f650045-584150.jpg">
<meta property="og:updated_time" content="2018-06-29T16:51:50.191Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="i-HBase-1">
<meta name="twitter:description" content="Hbase概念 hbase &amp;amp; hdfs 关系图   hadoop数据库，分布式可伸缩大型数据存储。  用户对随机、实时读写数据。  十亿行 x 百万列。      版本化、非关系型数据库。   Feature Linear and modular scalability. //线性模块化扩展方式。 Strictly consistent reads and writes. //严格一致性">
<meta name="twitter:image" content="https://img.mubu.com/document_image/40f0d2a9-20f1-4f73-84d9-e31b52685aad-584150.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'airpoet'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://airpoet.github.io/2018/06/26/Hadoop/5-HBase/i-HBase-1/"/>





  <title>i-HBase-1 | A.P的文艺杂谈</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">A.P的文艺杂谈</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://airpoet.github.io/2018/06/26/Hadoop/5-HBase/i-HBase-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="airpoet">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-14-045043.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="A.P的文艺杂谈">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">i-HBase-1</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-26T09:47:42+08:00">
                2018-06-26
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2018-06-30T00:51:50+08:00">
                2018-06-30
              </time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Hadoop/" itemprop="url" rel="index">
                    <span itemprop="name">Hadoop</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Hadoop/HBase/" itemprop="url" rel="index">
                    <span itemprop="name">HBase</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/06/26/Hadoop/5-HBase/i-HBase-1/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/06/26/Hadoop/5-HBase/i-HBase-1/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv">本文总阅读量
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>次
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="Hbase概念"><a href="#Hbase概念" class="headerlink" title="Hbase概念"></a>Hbase概念</h2><ul>
<li><p>hbase &amp; hdfs 关系图</p>
<p><img src="https://img.mubu.com/document_image/40f0d2a9-20f1-4f73-84d9-e31b52685aad-584150.jpg" alt="img"></p>
</li>
<li><p>hadoop数据库，分布式可伸缩大型数据存储。</p>
</li>
<li><p>用户对随机、实时读写数据。</p>
</li>
<li><p>十亿行 x 百万列。    </p>
</li>
<li><p>版本化、非关系型数据库。</p>
</li>
</ul>
<h2 id="Feature"><a href="#Feature" class="headerlink" title="Feature"></a>Feature</h2><ul>
<li>Linear and modular scalability.<br> //线性模块化扩展方式。</li>
<li>Strictly consistent reads and writes.<br> //严格一致性读写</li>
<li>Automatic and configurable sharding of tables<br>//自动可配置表切割</li>
<li>Automatic failover support between RegionServers.<br>//区域服务器之间自动容在</li>
<li>Convenient base classes for backing Hadoop MapReduce jobs with Apache HBase tables.        </li>
<li>Easy to use Java API for client access.<br>//java API</li>
<li>Block cache and Bloom Filters for real-time queries<br>//块缓存和布隆过滤器用于实时查询</li>
<li>Query predicate push down via server side Filters<br>//通过服务器端过滤器实现查询预测</li>
<li>Thrift gateway and a REST-ful Web service that supports XML, Protobuf, and binary data encoding options    </li>
<li>Extensible jruby-based (JIRB) shell                    </li>
<li>Support for exporting metrics via the Hadoop metrics subsystem to files or Ganglia; or via JMX<br> //可视化</li>
<li>面向列数据库。</li>
</ul>
<h2 id="HBase要点"><a href="#HBase要点" class="headerlink" title="HBase要点"></a>HBase要点</h2><ul>
<li>1) 它介于 NoSQL 和 RDBMS 之间，仅能通过主键(rowkey)和主键的 range 来检索数据</li>
<li>2) HBase 查询数据功能很简单，不支持 join 等复杂操作</li>
<li>3) 不支持复杂的事务，只支持行级事务(可通过 hive 支持来实现多表 join 等复杂操作)。</li>
<li>4) HBase 中支持的数据类型:byte<a href="底层所有数据的存储都是字节数组"></a></li>
<li>5) 主要用来存储结构化和半结构化的松散数据。</li>
</ul>
<h2 id="HBase-表特点"><a href="#HBase-表特点" class="headerlink" title="HBase 表特点"></a>HBase 表特点</h2><ul>
<li>大:一个表可以有上十亿行，上百万列</li>
<li>面向列:面向列(族)的存储和权限控制，列(簇)独立检索。</li>
<li>稀疏:对于为空(null)的列，并不占用存储空间，因此，表可以设计的非常稀疏。</li>
<li>无模式:每行都有一个可排序的主键和任意多的列，列可以根据需要动态的增加，同一 张表中不同的行可以有截然不同的列</li>
</ul>
<h2 id="HBase-存储机制"><a href="#HBase-存储机制" class="headerlink" title="HBase 存储机制"></a>HBase 存储机制</h2><ul>
<li>面向列存储，table是按row排序。</li>
<li>底层是 跳表 &amp; 布隆过滤器</li>
</ul>
<h2 id="HBase-定位机制-三级坐标"><a href="#HBase-定位机制-三级坐标" class="headerlink" title="HBase 定位机制(三级坐标)"></a>HBase 定位机制(三级坐标)</h2><ul>
<li>行<br>rowkey</li>
<li>列族 &amp; 列<br>column family &amp; column</li>
<li>时间戳<br>timestamp版本</li>
</ul>
<h2 id="表-行-列-列族的关系"><a href="#表-行-列-列族的关系" class="headerlink" title="表 行 列 列族的关系"></a>表 行 列 列族的关系</h2><ul>
<li><p>官网的关系图如下</p>
<p><img src="https://img.mubu.com/document_image/d4572c94-9da5-463f-a721-0c4dc42b87db-584150.jpg" alt="img"></p>
</li>
<li><p>其它版本</p>
<p><img src="https://img.mubu.com/document_image/feb7a6a8-6dfb-463a-8d57-181502d3d0e9-584150.jpg" alt="img"></p>
</li>
<li><p>Table is a collection of rows.<br>表是行的集合</p>
</li>
<li><p>Row is a collection of column families<br>行是列族的集合</p>
</li>
<li><p>Column family is a collection of columns.<br>列族是列的集合</p>
</li>
<li><p>Column is a collection of key value pairs.<br>列是键值对的集合(列其实就是 key)</p>
</li>
</ul>
<h2 id="RowKey-Column-Family-TimeStamp-Cell-概念解释"><a href="#RowKey-Column-Family-TimeStamp-Cell-概念解释" class="headerlink" title="RowKey, Column Family, TimeStamp, Cell 概念解释"></a>RowKey, Column Family, TimeStamp, Cell 概念解释</h2><ul>
<li>RowKey 是用来检索记录的主键<ul>
<li>rowkey 行键可以是任意字符串(最大长度是 64KB，实际应用中长度一般为 10-100bytes)，最好是 16。<ul>
<li>每一个物理文件中都会存一个 rk:TODO ??</li>
</ul>
</li>
<li>在 HBase 内部，rowkey 保存为字节数组。HBase 会对表中的数据按照 rowkey 排序 (字典顺序)</li>
<li>设计 key 时，要充分排序存储这 个特性，将经常一起读取的行存储放到一起。(位置相关性)</li>
<li>注意：字典序对 int 排序的结果是1,10,100,11,12,13,14,15,16,17,18,19,2,20,21,…9,91,92,93,94,95,96,97,98,99。要保持整形的自然序，行键必须用 0 作左填充。</li>
</ul>
</li>
<li>Column Family 列族是表的 Schema 的一部分(而列不是)，必须在使用表之前定义好，而且定义好了之后就不能更改。<ul>
<li>HBase 表中的每个列，都归属与某个列簇。</li>
<li>列簇越多，在取一行数据时所要参与 IO、搜寻的文件就越多，所以，如果没有必要，不要 设置太多的列簇（最好就一个列簇）</li>
</ul>
</li>
<li>TimeStamp<ul>
<li>HBase 中通过 rowkey 和 columns 确定的为一个存储单元称为 cell。</li>
<li>每个 cell 都保存着同一份 数据的多个版本。</li>
<li>版本通过时间戳来索引。</li>
<li>每个 cell 中，不同版本的数据按照时间倒序排序，即最新的数据排在最前面。</li>
<li>hbase 提供了两种数据版 本回收方式:<ul>
<li>保存数据的最后 n 个版本</li>
<li>保存最近一段时间内的版本(设置数据的生命周期 TTL)。</li>
</ul>
</li>
</ul>
</li>
<li>Cell 单元格<ul>
<li>由{rowkey, column( =<family> + <column>), version} 唯一确定的单元。</column></family></li>
<li>Cell 中的数据是没有类型的，全部是字节码形式存贮。</li>
</ul>
</li>
</ul>
<h2 id="HBase-的HA搭建"><a href="#HBase-的HA搭建" class="headerlink" title="HBase 的HA搭建"></a>HBase 的HA搭建</h2><ul>
<li><p>选择安装的主机cs1~cs4, 安装jdk, 解压hbase 包, 配置环境变量</p>
</li>
<li><p>验证安装是否成功<br>$&gt;hbase version</p>
</li>
<li><p>配置 hbase 完全分布式<br>[hbase/conf/<a href="http://hbase-env.sh" target="_blank" rel="noopener">hbase-env.sh</a>]<br>export JAVA_HOME=/usr/local/jdk1.8.0_73<br>export HBASE_MANAGES_ZK=false</p>
<p>[hbse-site.xml]</p>
<!-- 使用完全分布式 -->
<property><br>    <name>hbase.cluster.distributed</name><br>    <value>true</value><br></property><br><!-- 指定hbase数据在hdfs上的存放路径,存储路径由 namenode 来统一管理 --><br><property><br>    <name>hbase.rootdir</name><br>    <value><a href="hdfs://mycluster/hbase" target="_blank" rel="noopener">hdfs://mycluster/hbase</a></value><br></property><br><!-- 配置zk地址 --><br><property><br>    <name>hbase.zookeeper.quorum</name><br>    <value>cs1:2181,cs2:2181,cs3:2181</value><br></property><br><!-- zk的本地目录 --><br><property><br>    <name>hbase.zookeeper.property.dataDir</name><br>    <value>/home/ap/zookeeper</value><br></property> 
</li>
<li><p>配置 regonservers<br>[hbase/conf/regionservers]<br>cs2<br>cs3<br>cs4<br>cs5</p>
</li>
<li><p>修改 backup-masters（自行创建），指定备用的主HMaster</p>
<h2 id="vi-backup-masters"><a href="#vi-backup-masters" class="headerlink" title="vi backup-masters"></a>vi backup-masters</h2><p>cs6</p>
</li>
<li><p>最重要一步:</p>
<ul>
<li>傻逼版:<ul>
<li>要把 hadoop 的 hdfs-site.xml 和 core-site.xml 放到 hbase/conf 下, 这样hbase 才能通过命名空间mycluster 找到当前可用 namenode, 再通过 namenode 分配指定 hbase 在 HDFS上的存储路径<br>cp <sub>/apps/hadoop/etc/hadoop/core-site.xml </sub>/apps/hbase/conf/<br>cp <sub>/apps/hadoop/etc/hadoop/hdfs-site.xml </sub>/apps/hbase/conf/</li>
</ul>
</li>
<li>高级版:<ul>
<li>在hbase-env.sh文件添加hadoop配置文件目录到HBASE_CLASSPATH环境变量并分发.<br>[/soft/hbase/conf/<a href="http://hbase-env.sh" target="_blank" rel="noopener">hbase-env.sh</a>]<br>export HBASE_CLASSPATH=$HBASE_CLASSPATH:/soft/hadoop/etc/hadoop </li>
<li>在hbase/conf/目录下创建到hadoop的hdfs-site.xml符号连接。<br>$&gt;ln -s /soft/hadoop/etc/hadoop/hdfs-site.xml /soft/hbase/conf/hdfs-site.xml</li>
</ul>
</li>
</ul>
</li>
<li><p>启动 hbase 集群<br>$&gt;<a href="http://start-hbase.sh" target="_blank" rel="noopener">start-hbase.sh</a></p>
</li>
<li><p>登录 hbase 的 webUI</p>
</li>
</ul>
<p>  <a href="http://cs1:16010/" target="_blank" rel="noopener">http://cs1:16010/</a></p>
<ul>
<li>注意, 页面上显示的版本, 是~/apps/hbase/lib中自己存储的 jar 包的版本</li>
</ul>
<h2 id="启动-停止-hbase-进程"><a href="#启动-停止-hbase-进程" class="headerlink" title="启动/停止 hbase 进程"></a>启动/停止 hbase 进程</h2><ul>
<li><a href="http://start-hbase.sh" target="_blank" rel="noopener">start-hbase.sh</a></li>
</ul>
<p>  等价于</p>
<ul>
<li>hbase-daemon.sh start master</li>
<li>hbase-daemons.sh start regionserver</li>
<li>注意: 在哪个节点启动 <a href="http://start-hbase.sh" target="_blank" rel="noopener">start-hbase.sh</a> , 就在哪里启动 HMaster 进程, 如果</li>
</ul>
<ul>
<li><a href="http://stop-hbase.sh" target="_blank" rel="noopener">stop-hbase.sh</a><br>停止 hbase</li>
</ul>
<h2 id="HBase-shell-操作"><a href="#HBase-shell-操作" class="headerlink" title="HBase shell 操作"></a>HBase shell 操作</h2><h4 id="登录shell终端"><a href="#登录shell终端" class="headerlink" title="登录shell终端."></a>登录shell终端.</h4><ul>
<li>$hbase&gt; hbase shell                           </li>
</ul>
<h4 id="help-相关"><a href="#help-相关" class="headerlink" title="help 相关"></a>help 相关</h4><ul>
<li>$hbase&gt; help<br>查看所有帮助</li>
<li>$hbase&gt; table_help<br>关于表操作的另外一种方式的帮助文档</li>
<li>$hbase&gt; help “dml”<br>获取一组命令的提示</li>
<li>$hbase&gt;help  ‘list_namespace’<br>查看特定的命令帮助</li>
</ul>
<h4 id="desc-查看描述信息"><a href="#desc-查看描述信息" class="headerlink" title="desc 查看描述信息"></a>desc 查看描述信息</h4><ul>
<li>desc ‘t1’ : 下面这些在建表的时候都可以指定<br>{NAME =&gt; ‘f1’, BLOOMFILTER =&gt; ‘ROW’, VERSIONS =&gt; ‘1’, IN_MEMORY =&gt; ‘false’, KEEP_DELETED_CELLS =&gt;<br> ‘FALSE’, DATA_BLOCK_ENCODING =&gt; ‘NONE’, TTL =&gt; ‘FOREVER’, COMPRESSION =&gt; ‘NONE’, MIN_VERSIONS =&gt;<br> ‘0’, BLOCKCACHE =&gt; ‘true’, BLOCKSIZE =&gt; ‘65536’, REPLICATION_SCOPE =&gt; ‘0’}<br>1 row(s) in 0.1780 seconds</li>
</ul>
<h4 id="list-相关"><a href="#list-相关" class="headerlink" title="list 相关"></a>list 相关</h4><ul>
<li>$hbase&gt; list<br>列出所有非系统表</li>
<li>$hbase&gt;list_namespace<br>列出名字空间(数据库)</li>
<li>$hbase&gt;list_namespace_tables ‘defalut’<br>列出名字空间的所以表</li>
</ul>
<h4 id="create-相关"><a href="#create-相关" class="headerlink" title="create 相关"></a>create 相关</h4><ul>
<li>$hbase&gt;create_namespace ‘ns1’<br>创建名字空间</li>
<li>$hbase&gt;create ‘ns1:t1’,’f1’<br>创建表,指定空间下,列族<br>注意: 如果 t1已经创建了, 就不能通过这个方式来添加 列族</li>
<li>create ‘t1’,’f1’</li>
<li>create ‘user_info’,{NAME=&gt;’base_info’,VERSIONS=&gt;3 },{NAME=&gt;’extra_info’,VERSIONS=&gt;1 }<br>同时创建多个 列族</li>
</ul>
<h4 id="exist-相关"><a href="#exist-相关" class="headerlink" title="exist 相关"></a>exist 相关</h4><ul>
<li>exists ‘t1’<br>查看表是否存在</li>
</ul>
<h4 id="put-相关"><a href="#put-相关" class="headerlink" title="put 相关"></a>put 相关</h4><ul>
<li>注意: 如果往 同表 &amp; 同rowkey &amp; 同样的列 中插入 value, 会默认展示最近的一个时间戳的信息, 如果 get 的回收指定 VERSIONS数量, 则会展示此数量的版本信息</li>
<li>向 user 表中插入信息，row key 为 rk0001，列簇 info 中添加 name 列标示符，值为 zhangsan<ul>
<li>put ‘user’, ‘rk0001’, ‘info:name’, ‘zhangsan’, 1482077777777<br>手动指定时间戳<br>时间戳是可以自己指定的，如若不指定，则会自动获取系统的当前时间的时间戳</li>
</ul>
</li>
<li>向 user 表中插入信息，row key 为 rk0001，列簇 info 中添加 gender 列标示符，值为 female<ul>
<li>put ‘user’, ‘rk0001’, ‘info:gender’, ‘female’</li>
</ul>
</li>
<li>向 user 表中插入信息，row key 为 rk0001，列簇 info 中添加 age 列标示符，值为 20<ul>
<li>put ‘user’, ‘rk0001’, ‘info:age’, 20</li>
</ul>
</li>
<li>向 user 表中插入信息，row key 为 rk0001，列簇 data 中添加 pic 列标示符，值为 picture<ul>
<li>put ‘user’, ‘rk0001’, ‘data:pic’, ‘picture’</li>
</ul>
</li>
</ul>
<h4 id="get-相关"><a href="#get-相关" class="headerlink" title="get 相关"></a>get 相关</h4><ul>
<li>获取 user 表中 row key 为 rk0001 的所有信息              </li>
</ul>
<p>  注意: ‘表名’, ‘ rowkey’</p>
<ul>
<li>get ‘user’, ‘rk0001’</li>
</ul>
<ul>
<li>获取 user 表中 row key 为 rk0001，info 列簇的所有信息</li>
</ul>
<p>  注意: ‘表名’, ‘ rowkey’, ‘列族名’</p>
<ul>
<li>get ‘user’, ‘rk0001’, ‘info’</li>
</ul>
<ul>
<li>获取 user 表中 row key 为 rk0001，info 列簇的 name、age 列标示符的信息</li>
</ul>
<p>  注意: ‘表名’, ‘rowkey’, ‘列族名’:’列名’, ‘列族名’:’列名’</p>
<ul>
<li>get ‘user’, ‘rk0001’, ‘info:name’, ‘info:age’</li>
</ul>
<ul>
<li>获取 user 表中 row key 为 rk0001，info、data 列簇的信息</li>
</ul>
<p>  注意: ‘表名’, ‘rowkey’, ‘列族名’, ‘列族名’</p>
<ul>
<li>get ‘user’, ‘rk0001’, ‘info’, ‘data’</li>
<li>get ‘user’, ‘rk0001’, {COLUMN =&gt; [‘info’, ‘data’]}</li>
<li>get ‘user’, ‘rk0001’, {COLUMN =&gt; [‘info:name’, ‘data:pic’]}</li>
</ul>
<ul>
<li>获取 user 表中 row key 为 rk0001，列簇为 info，版本号最新 5 个的信息</li>
</ul>
<p>  注意: ‘表名’, ‘rowkey’, {COLUMN =&gt;’列族名’, 存储版本数=&gt; 数量}</p>
<ul>
<li>get ‘user’, ‘rk0001’, {COLUMN =&gt; ‘info’, VERSIONS =&gt; 2}</li>
<li>get ‘user’, ‘rk0001’, {COLUMN =&gt; ‘info:name’, VERSIONS =&gt; 5}</li>
<li>get ‘user’, ‘rk0001’, {COLUMN =&gt; ‘info:name’, VERSIONS =&gt; 5, TIMERANGE =&gt; [1392368783980, 1392380169184]}</li>
</ul>
<ul>
<li><p>获取 user 表中 row key 为 rk0001，列标示符中含有 a 的信息</p>
<ul>
<li>get ‘people’, ‘rk0001’, {FILTER =&gt; “(QualifierFilter(=,’substring:a’))”}</li>
</ul>
</li>
<li><p>获取 国籍 为中国的用户信息</p>
</li>
</ul>
<p>  注意:   ‘表名’,    ‘rowkey’,      ‘列族名’:’列名’,  ‘value’</p>
<ul>
<li>put ‘user’, ‘rk0002’, ‘info:name’, ‘fanbingbing’</li>
<li>put ‘user’, ‘rk0002’, ‘info:gender’, ‘female’</li>
<li>put ‘user’, ‘rk0002’, ‘info:nationality’, ‘中国’</li>
<li>get ‘user’, ‘rk0002’, {FILTER =&gt; “ValueFilter(=, ‘binary:中国’)”}</li>
</ul>
<ul>
<li>获取2个不同列中的指定字段</li>
</ul>
<p>  注意:   ‘表名’,    ‘rowkey’, {COLUMN  =&gt; [‘列族名’:’列名’,  ‘列族名’:’列名’]}</p>
<ul>
<li>get ‘user’, ‘rk0002’, {COLUMN =&gt; [‘info:name’, ‘data:pic’]}</li>
</ul>
<h4 id="scan-相关"><a href="#scan-相关" class="headerlink" title="scan 相关"></a>scan 相关</h4><ul>
<li><p>扫描元数据</p>
<ul>
<li><p>scan ‘hbase : meta’<br> t9,,1529936935368.f1a900954c069f0319195f16043c8e1a column=info:regioninfo, timestamp=1529936935933, value={ENCODED =&gt; f1a900954c069f0319195f16043c8e1a, NAME =&gt; ‘t9,,1529936935368.f1a900954c069f031919<br> .                                                  5f16043c8e1a.’, STARTKEY =&gt; ‘’, ENDKEY =&gt; ‘’}<br> t9,,1529936935368.f1a900954c069f0319195f16043c8e1a column=info:seqnumDuringOpen, timestamp=1529936935933, value=\x00\x00\x00\x00\x00\x00\x00\x02<br> .<br> t9,,1529936935368.f1a900954c069f0319195f16043c8e1a column=info:server, timestamp=1529936935933, value=cs5:16020<br> .<br> t9,,1529936935368.f1a900954c069f0319195f16043c8e1a column=info:serverstartcode, timestamp=1529936935933, value=1529923622913</p>
</li>
<li><p>$hbase&gt;split ‘ns1:t1’<br>//切割表</p>
</li>
<li><p>$hbase&gt;split ‘’<br> //切割区域, 见下面</p>
</li>
<li><p>切割之前</p>
<p><img src="https://img.mubu.com/document_image/13cfae11-e0c1-46fb-be2c-799578d701c9-584150.jpg" alt="img"></p>
</li>
<li><p>切割之后</p>
<p><img src="https://img.mubu.com/document_image/da7a0e5d-7157-458c-abfc-e17a2c81796f-584150.jpg" alt="img"></p>
</li>
<li><p>UI界面 table regions</p>
<p><img src="https://img.mubu.com/document_image/9a336ce6-5915-44bc-a3a6-f8ad86de7611-584150.jpg" alt="img"></p>
</li>
<li><p>继续进行 region 切割</p>
<ul>
<li>scan ‘hbase:meta’</li>
<li>找到切割点 STARTKEY =&gt; ‘row000550’ 的 那行的 NAME =&gt; 后面的值</li>
<li>从这个值开始切割到指定值<br>split ‘t9,row000551,1529938745618.90ed2fb6b7744ea5f0a7ff613d05aada.’,’row000888’</li>
</ul>
</li>
</ul>
</li>
<li><p>扫描表中所有的信息</p>
<ul>
<li>$hbase&gt;scan ‘ns1:t1’</li>
</ul>
</li>
<li><p>查询 user 表中列簇为 info 的信息</p>
<ul>
<li>hbase&gt; scan ‘hbase:meta’<br>扫描权标</li>
<li>$hbase&gt; scan ‘hbase:meta’, {COLUMNS =&gt; ‘info’}<br>注意: COLUMNS要大写</li>
<li>$hbase&gt; scan ‘ns1:t1’, {COLUMNS =&gt; [‘c1’, ‘c2’], LIMIT =&gt; 10, STARTROW =&gt; ‘xyz’}</li>
<li>scan ‘user’, {COLUMNS =&gt; ‘info’, RAW =&gt; true, VERSIONS =&gt; 5}</li>
<li>scan ‘persion’, {COLUMNS =&gt; ‘info’, RAW =&gt; true, VERSIONS =&gt; 3}<br>Scan 时可以设置是否开启 Raw 模式，开启 Raw 模式会返回包括已添加删除标记但是未 实际删除的数据。</li>
</ul>
</li>
<li><p>查询 user 表中列簇为 info 和 data 的信息</p>
<ul>
<li>scan ‘user’, {COLUMNS =&gt; [‘info’, ‘data’]}</li>
<li>scan ‘user’, {COLUMNS =&gt; [‘info:name’, ‘data:pic’]}</li>
</ul>
</li>
<li><p>查询 user 表中列簇为 info、列标示符为 name 的信息</p>
<ul>
<li>scan ‘user’, {COLUMNS =&gt; ‘info:name’}</li>
</ul>
</li>
<li><p>查询 user 表中列簇为 info、列标示符为 name 的信息,并且版本最新的 5 个</p>
<ul>
<li>scan ‘user’, {COLUMNS =&gt; ‘info:name’, VERSIONS =&gt; 5}</li>
</ul>
</li>
<li><p>查询 user 表中列簇为 info 和 data 且列标示符中含有 a 字符的信息</p>
<ul>
<li>scan ‘user’, {COLUMNS =&gt; [‘info’, ‘data’], FILTER =&gt; “(QualifierFilter(=,’substring:a’))”}</li>
</ul>
</li>
<li><p>查询 user 表中列簇为 info，rk 范围是[rk0001, rk0003)的数据</p>
<ul>
<li>scan ‘people’, {COLUMNS =&gt; ‘info’, STARTROW =&gt; ‘rk0001’, ENDROW =&gt; ‘rk0003’}</li>
</ul>
</li>
<li><p>查询 user 表中 row key 以 rk 字符开头的</p>
<ul>
<li>scan ‘user’,{FILTER=&gt;”PrefixFilter(‘rk’)”}</li>
</ul>
</li>
<li><p>查询 user 表中指定范围的数据</p>
<ul>
<li>scan ‘user’, {TIMERANGE =&gt; [1392368783980, 1392380169184]}</li>
</ul>
</li>
</ul>
<h4 id="delete-truncate-相关-删除-清空数据"><a href="#delete-truncate-相关-删除-清空数据" class="headerlink" title="delete/truncate 相关 (删除,清空数据)"></a>delete/truncate 相关 (删除,清空数据)</h4><ul>
<li>注意: 删除列族, 在 alter 中</li>
<li>删除 user 表 row key 为 rk0001，列标示符为 info:name 的字段数据<ul>
<li>delete ‘people’, ‘rk0001’, ‘info:name’</li>
</ul>
</li>
<li>删除 user 表 row key 为 rk0001，列标示符为 info:name，timestamp 为 1392383705316 的数据<ul>
<li>delete ‘user’, ‘rk0001’, ‘info:name’, 1392383705316</li>
</ul>
</li>
<li>清空 user 表中的数据<ul>
<li>truncate ‘people’<br>目前版本会先 disable , 再 truncate, 最后再 enable</li>
</ul>
</li>
</ul>
<h4 id="alter-相关"><a href="#alter-相关" class="headerlink" title="alter 相关"></a>alter 相关</h4><ul>
<li>注意,在修改列族 时</li>
</ul>
<p>  hbase&gt; alter ‘t1’, NAME =&gt; ‘f1’, VERSIONS =&gt; 5</p>
<ul>
<li>VERSIONS 是指能存多少个版本, 如果不指定的话, 退出 hbase 的时候, 默认只会留最新的一个版本</li>
<li>如果存在, 就是修改</li>
<li>不存在, 就是增加</li>
</ul>
<ul>
<li><p>添加两个列簇 f1 和 f2</p>
<ul>
<li>简写: alter ‘t1’, ‘f2’</li>
<li>alter ‘people’, NAME =&gt; ‘f1’</li>
<li>alter ‘user’, NAME =&gt; ‘f2’</li>
</ul>
</li>
<li><p>停用/启用 表</p>
<ul>
<li>enable ‘t9’<br>启用</li>
<li>is_enabled ‘t9’<br>是否可用</li>
<li>disable ‘t9’<br>停用</li>
<li>is_disabled ‘t9’<br>是否不可用</li>
</ul>
</li>
<li><p>删除一个列簇:</p>
<ul>
<li>注意: 当表中只有一个列族时, 无法将其删除</li>
<li>disable ‘user’(新版本不用)</li>
<li>alter ‘user’, NAME =&gt; ‘f1’, METHOD =&gt; ‘delete’</li>
<li>或</li>
<li>alter ‘user’, ‘delete’ =&gt; ‘f1’</li>
<li>enable ‘user’</li>
</ul>
</li>
<li><p>添加列簇 f1 同时删除列簇 f2</p>
<ul>
<li>disable ‘user’(新版本不用)</li>
<li>alter ‘user’, {NAME =&gt; ‘f1’}, {NAME =&gt; ‘f2’, METHOD =&gt; ‘delete’}</li>
<li>enable ‘user’</li>
</ul>
</li>
<li><p>将 user 表的 f1 列簇版本号改为 5</p>
<ul>
<li>disable ‘user’(新版本不用)</li>
<li>alter ‘people’, NAME =&gt; ‘info’, VERSIONS =&gt; 5<br>people 为 rowkey</li>
<li>enable ‘user’</li>
</ul>
</li>
</ul>
<h4 id="drop-相关"><a href="#drop-相关" class="headerlink" title="drop 相关"></a>drop 相关</h4><ul>
<li>disable ‘user’</li>
<li>drop ‘user’</li>
</ul>
<h4 id="count-相关"><a href="#count-相关" class="headerlink" title="count 相关"></a>count 相关</h4><ul>
<li>$hbase&gt;count ‘ns1:t1’<br>统计函数, 1000行统计一次</li>
</ul>
<h4 id="flush-相关"><a href="#flush-相关" class="headerlink" title="flush 相关"></a>flush 相关</h4><ul>
<li>把文件刷到磁盘的过程</li>
<li>hbase&gt; flush ‘TABLENAME’</li>
<li>hbase&gt; flush ‘REGIONNAME’</li>
<li>hbase&gt; flush ‘ENCODED_REGIONNAME’</li>
</ul>
<h4 id="ValueFilter-过滤器"><a href="#ValueFilter-过滤器" class="headerlink" title="ValueFilter 过滤器"></a>ValueFilter 过滤器</h4><ul>
<li>get ‘person’, ‘rk0001’, {FILTER =&gt; “ValueFilter(=, ‘binary:中国’)”}</li>
<li>get ‘person’, ‘rk0001’, {FILTER =&gt; “(QualifierFilter(=,’substring:a’))”}</li>
</ul>
<h4 id="exit-退出"><a href="#exit-退出" class="headerlink" title="exit 退出"></a>exit 退出</h4><p>$hbase&gt; exit</p>
<h4 id="遇到问题总结"><a href="#遇到问题总结" class="headerlink" title="遇到问题总结"></a>遇到问题总结</h4><ul>
<li>插入前, 必须创建好<ul>
<li>namespace<br>相当于数据库的概念</li>
<li>table<br>表命</li>
<li>column family<br>列族名</li>
</ul>
</li>
<li>不需要提前创建<ul>
<li>行名</li>
<li>列名</li>
<li>value</li>
</ul>
</li>
<li>如果表已经创建, 要增加列族的话, 只能用 alter, 不能继续用 create</li>
</ul>
<h2 id="通过Java-API访问Hbase"><a href="#通过Java-API访问Hbase" class="headerlink" title="通过Java API访问Hbase"></a>通过Java API访问Hbase</h2><ul>
<li><p>创建hbase模块</p>
</li>
<li><p>添加依赖<br>&lt;?xml version=”1.0” encoding=”UTF-8”?&gt;</p>
<project xmlns="<http://maven.apache.org/POM/4.0.0>" xmlns:xsi="<http://www.w3.org/2001/XMLSchema-instance>" xsi:schemalocation="<http://maven.apache.org/POM/4.0.0http://maven.apache.org/xsd/maven-4.0.0.xsd>"><br>    <modelversion>4.0.0</modelversion><br>    <groupid>com.rox</groupid><br>    <artifactid>HbaseDemo</artifactid><br>    <version>1.0-SNAPSHOT</version><br>    <dependencies><br>        <dependency><br>            <groupid>org.apache.hbase</groupid><br>            <artifactid>hbase-client</artifactid><br>            <version>1.2.3</version><br>        </dependency><br>    </dependencies><br></project> 
</li>
<li><p>复制hbase集群的hbase-site.xml文件到模块的src/main/resources目录下。</p>
</li>
<li><p>-——————————————————————————————</p>
</li>
<li><p>Hbase API 类和数据模型之间的对应关系:</p>
<ul>
<li><p>\0. 总的对应关系</p>
<p><img src="https://img.mubu.com/document_image/12d391d8-836e-48de-bf08-53a95e01343c-584150.jpg" alt="img"></p>
</li>
<li><ol>
<li>HBaseAdmin</li>
</ol>
<ul>
<li></li>
</ul>
</li>
</ul>
</li>
<li><p>编程实现 代码见 <a href="https://github.com/airpoet/bigdata/blob/master/HBaseDemo/src/test/java/com/rox/text/TestCRUD.java" target="_blank" rel="noopener">https://github.com/airpoet/bigdata/blob/master/HBaseDemo/src/test/java/com/rox/text/TestCRUD.java</a><br>public class TestCRUD {<br>@Test<br>public void put() throws IOException {<br>// 创建 conf 对象<br>Configuration conf = HBaseConfiguration.create();/<em> 通过连接工厂创建连接对 </em>/<br>// 通过连接工厂创建连接对象<br>Connection conn = ConnectionFactory.createConnection(conf);<br>// 通过连接查询 TableName 对象<br>TableName tname = TableName.valueOf(“ns1:t1”);<br>// 获得 table对象<br>Table table = conn.getTable(tname);<br>// 通过bytes 工具类转化字符串为字节数组<br>byte[] bytes = Bytes.toBytes(“row3”);<br>// 创建 put 对象, 传入行号<br>Put put = new Put(bytes);<br>// 创建 列族, 列, value 的 byte 数据<br>byte[] f1 = Bytes.toBytes(“f1”);<br>byte[] id = Bytes.toBytes(“id”);<br>byte[] value = Bytes.toBytes(188);<br>put.addColumn(f1, id, value);<br>// table put 数据<br>table.put(put);<br>//============================<br>// get<br>byte[] rowid = Bytes.toBytes(“row3”);<br>Get get = new Get(rowid);<br>// 得到 res<br>Result res = table.get(get);<br> // 从 res 中取出 value<br>byte[] idvalue = res.getValue(Bytes.toBytes(“f1”),Bytes.toBytes(“id”));<br>System.out.println(Bytes.toInt(idvalue));<br>}<br>}</p>
</li>
</ul>
<h2 id="HBase-写入过程-amp-存储路径"><a href="#HBase-写入过程-amp-存储路径" class="headerlink" title="HBase 写入过程 &amp; 存储路径"></a>HBase 写入过程 &amp; 存储路径</h2><ul>
<li>WAL<br>write ahead log,写前日志。</li>
<li>HDFS 上存储路径详解<ul>
<li><a href="http://cs1:50070/explorer.html#/hbase/data/ns1/t1/97eada11d196f1e134c41e859d338e07/f1/fsfsfgwgfsgfrgfdg" target="_blank" rel="noopener">http://cs1:50070/explorer.html#/hbase/data/ns1/t1/97eada11d196f1e134c41e859d338e07/f1/fsfsfgwgfsgfrgfdg</a><ul>
<li>data<br>存储数据的目录</li>
<li>ns1<br>namespace 名称</li>
<li>t1<br>表名</li>
<li>97eada11d196f1e134c41e859d338e07<br>region 的编号</li>
<li>f1<br>列族</li>
<li>fsfsfgwgfsgfrgfdg<br>HFile: 列族存储的文件, 每一个 hfile 文件对应的是一个列族</li>
</ul>
</li>
<li>meta 数据路径 <a href="http://cs1:50070/explorer.html#/hbase/data/hbase/meta/1588230740/info" target="_blank" rel="noopener">http://cs1:50070/explorer.html#/hbase/data/hbase/meta/1588230740/info</a></li>
</ul>
</li>
</ul>
<h2 id="HBase-和-Hive-的比较"><a href="#HBase-和-Hive-的比较" class="headerlink" title="HBase 和 Hive 的比较"></a>HBase 和 Hive 的比较</h2><ul>
<li>相同点<ul>
<li>HBase 和 Hive 都是架构在 Hadoop 之上，用 HDFS 做底层的数据存储，用 MapReduce 做 数据计算</li>
</ul>
</li>
<li>不同点<ul>
<li>解决的问题不同<ul>
<li>Hive 是建立在 Hadoop 之上为了降低 MapReduce 编程复杂度的 ETL 工具。</li>
<li>HBase 是为了弥补 Hadoop 对实时操作的缺陷</li>
</ul>
</li>
<li>表的架构不同<ul>
<li>Hive 表是纯逻辑表，因为 Hive 的本身并不能做数据存储和计算，而是完全依赖 Hadoop</li>
<li>HBase 是物理表，提供了一张超大的内存 Hash 表来存储索引，方便查询</li>
</ul>
</li>
<li>定位 &amp; 访问机制不同<ul>
<li>Hive 是数据仓库工具，需要全表扫描，就用 Hive，因为 Hive 是文件存储</li>
<li>HBase 是数据库，需要索引访问，则用 HBase，因为 HBase 是面向列的 NoSQL 数据库</li>
</ul>
</li>
<li>存储模式不同<ul>
<li>Hive 表中存入数据(文件)时不做校验，属于读模式存储系统</li>
<li>HBase 表插入数据时，会和 RDBMS 一样做 Schema 校验，所以属于写模式存储系统</li>
</ul>
</li>
<li>是否实时处理(处理效率)不同<ul>
<li>Hive 不支持单行记录操作，数据处理依靠 MapReduce，操作延时高</li>
<li>HBase 支持单行记录的 CRUD，并且是实时处理，效率比 Hive 高得多</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="HBase在-HDFS-上的存储路径"><a href="#HBase在-HDFS-上的存储路径" class="headerlink" title="HBase在 HDFS 上的存储路径"></a>HBase在 HDFS 上的存储路径</h2><ul>
<li>相同列族的数据存放在一个文件中。</li>
<li>[表数据的存储目录结构构成]<ul>
<li><a href="hdfs://cs1:8020/hbase/data/${名字空间}/${表名}/${区域名称}/${列族名称}/${文件名}" target="_blank" rel="noopener">hdfs://cs1:8020/hbase/data/${名字空间}/${表名}/${区域名称}/${列族名称}/${文件名}</a></li>
</ul>
</li>
<li>[WAL目录结构构成]<ul>
<li><a href="hdfs://cs1:8020/hbase/WALs/${区域服务器名称,端口号,时间戳}/" target="_blank" rel="noopener">hdfs://cs1:8020/hbase/WALs/${区域服务器名称,端口号,时间戳}/</a></li>
</ul>
</li>
</ul>
<h2 id="Client-端-与-HBase-交互过程"><a href="#Client-端-与-HBase-交互过程" class="headerlink" title="Client 端 与 HBase 交互过程"></a>Client 端 与 HBase 交互过程</h2><ul>
<li><p>HBase 简单集群结构</p>
<p><img src="https://img.mubu.com/document_image/5c640ea0-d4ff-43ed-94bb-ebebfc35aa62-584150.jpg" alt="img"></p>
<ul>
<li>region:是 hbase 中对表进行切割的单元，由 regionserver 负责管理<ul>
<li>region 分裂是逻辑概念?? :TODO</li>
</ul>
</li>
<li>hamster:hbase 的主节点，负责整个集群的状态感知，负载分配、负责用户表的元数据(schema)管理(可以配置多个用来实现 HA),hmaster 负载压力相对于 hdfs 的 namenode 会小很多</li>
<li>regionserver:hbase 中真正负责管理 region 的服务器，也就是负责为客户端进行表数据读写 的服务器每一台 regionserver 会管理很多的 region，同一个 regionserver 上面管理的所有的 region 不属于同一张表</li>
<li>zookeeper:整个 hbase 中的主从节点协调，主节点之间的选举，集群节点之间的上下线感 知„„都是通过 zookeeper 来实现</li>
<li>HDFS:用来存储 hbase 的系统文件，或者表的 region</li>
</ul>
</li>
<li><p>Hbase 顶层结构图</p>
<p><img src="https://img.mubu.com/document_image/ebc78e6e-830c-49af-a05f-c79ec1bad8d6-584150.jpg" alt="img"></p>
</li>
<li><p>0.hbase集群启动时，master负责分配区域到指定区域服务器。</p>
</li>
<li><p>1.联系zk，找出meta表所在rs(regionserver)/hbase/meta-region-server</p>
</li>
<li><p>2.定位row key,找到对应region server</p>
</li>
<li><p>3.缓存信息在本地。</p>
</li>
<li><p>4.联系RegionServer</p>
</li>
<li><p>5.HRegionServer负责open HRegion对象，为每个列族创建Store对象，Store包含多个StoreFile实例，他们是对HFile的轻量级封装。每个Store还对应了一个MemStore，用于内存存储数据。</p>
</li>
</ul>
<h2 id="百万数据批量插入"><a href="#百万数据批量插入" class="headerlink" title="百万数据批量插入"></a>百万数据批量插入</h2><ul>
<li>代码<br>long start = System.currentTimeMillis() ;<br>Configuration conf = HBaseConfiguration.create();<br>Connection conn = ConnectionFactory.createConnection(conf);<br>TableName tname = TableName.valueOf(“ns1:t1”);<br>HTable table = (HTable)conn.getTable(tname);<br>//不要自动清理缓冲区<br>table.setAutoFlush(false);<br>for(int i = 4 ; i &lt; 1000000 ; i ++){<pre><code>Put put = new Put(Bytes.toBytes(&quot;row&quot; + i)) ;
//关闭写前日志
put.setWriteToWAL(false);
put.addColumn(Bytes.toBytes(&quot;f1&quot;),Bytes.toBytes(&quot;id&quot;),Bytes.toBytes(i));
put.addColumn(Bytes.toBytes(&quot;f1&quot;),Bytes.toBytes(&quot;name&quot;),Bytes.toBytes(&quot;tom&quot; + i));
put.addColumn(Bytes.toBytes(&quot;f1&quot;),Bytes.toBytes(&quot;age&quot;),Bytes.toBytes(i % 100));
table.put(put);
if(i % 2000 == 0){
    table.flushCommits();
}
</code></pre>}<br>//<br>table.flushCommits();<br>System.out.println(System.currentTimeMillis() - start ); </li>
</ul>
<h2 id="HBase-切割文件"><a href="#HBase-切割文件" class="headerlink" title="HBase 切割文件"></a>HBase 切割文件</h2><ul>
<li>默认10G 进行切割<property><br>        <name>hbase.hregion.max.filesize</name><br>        <value>10737418240</value><br>        <source>hbase-default.xml<br></property> 





</li>
</ul>
<h2 id="HBase-合并文件"><a href="#HBase-合并文件" class="headerlink" title="HBase 合并文件"></a>HBase 合并文件</h2><ul>
<li>merge_region ‘1f4609ba4e2a9440aedde5d0e7123722’,’48277c27196a5c6e30d5ae679e9ec4f0’<br>merge ‘前一个区域的 encoded’ , ‘后一个区域的 encoded’</li>
</ul>
<h2 id="HBase-手动移动文件"><a href="#HBase-手动移动文件" class="headerlink" title="HBase 手动移动文件"></a>HBase 手动移动文件</h2><ul>
<li>hbase(main):034:0&gt; move ‘8658ac9ea01f80c2cca32693397a1e70’,’cs3,16020,1529980599903’<br>前面是 encoded region name , 后面是服务器名</li>
</ul>
<h2 id="预先切割"><a href="#预先切割" class="headerlink" title="预先切割"></a>预先切割</h2><ul>
<li>创建表时, 预先对表进行切割</li>
<li>切割线是 rowkey<br>create ‘ns1:t2’,’f1’,SPLITS=&gt;[‘row300’, ‘row600’]</li>
<li>创建预先切割表之后, 存的值就会到对应的区域中去</li>
<li>注意: put 一次就是一条数据</li>
</ul>
<h2 id="指定版本数的问题"><a href="#指定版本数的问题" class="headerlink" title="指定版本数的问题"></a>指定版本数的问题</h2><ul>
<li>创建表时指定列族的版本数,该列族的所有列都具有相同数量版本 </li>
<li>创建表时，指定列族的版本数。<br>$hbase&gt;create ‘ns1:t3’,{NAME=&gt;’f1’,VERSIONS=&gt;3}            </li>
<li>如果创建表的时候创的是3个版本, 查4个版本, 此时最多也就显示3个<br>$hbase&gt;get ‘ns1:t3’,’row1’,{COLUMN=&gt;’f1’,VERSIONS=&gt;4}<br>COLUMN                  CELL<br> f1:name                timestamp=1530019546709, value=tom3<br> f1:name                timestamp=1530019542978, value=tom2<br> f1:name                timestamp=1530019540164, value=tom1</li>
</ul>
<h2 id="原生扫描-expert"><a href="#原生扫描-expert" class="headerlink" title="原生扫描(expert)"></a>原生扫描(expert)</h2><ul>
<li><p><img src="https://img.mubu.com/document_image/7d75648a-c26c-46c9-9c06-286805d4270b-584150.jpg" alt="img"></p>
</li>
<li><p>原生扫描, 包含标记了delete的数据<br>$hbase&gt;scan ‘ns1:t3’,{COLUMN=&gt;’f1’,RAW=&gt;true,VERSIONS=&gt;10}<br>hbase(main):177:0&gt; scan ‘ns1:t3’,{COLUMN=&gt;’f1’,RAW=&gt;true,VERSIONS=&gt;10}<br>ROW                     COLUMN+CELL<br> row1                   column=f1:name, timestamp=1530019546709, value=tom3<br> row1                   column=f1:name, timestamp=1530019542978, value=tom2<br> row1                   column=f1:name, timestamp=1530019540164, type=DeleteColumn<br> row1                   column=f1:name, timestamp=1530019540164, value=tom1</p>
</li>
<li><p>删除数据, 标记为删除, 小于该删除时间的数据都作废, flush 后, 用 RAW 似乎还会保留, 用非 RAW 的方式查看的画, 此删除数据, 及时间戳比这个小的数据, 都不会显示.</p>
</li>
</ul>
<p>   $hbase&gt;delete ‘ns1:t3’,’row1’,’f1:name’,148989875645</p>
<ul>
<li>这里是否要停掉 hbase 服务再起来看看?</li>
</ul>
<ul>
<li><p>TTL</p>
<ul>
<li>time to live ,存活时间</li>
<li>影响所有的数据，包括没有删除的数据</li>
<li>超过该时间，原生扫描也扫不到数据</li>
<li>创建带 TTL参数的表<br>$hbase&gt;create ‘ns1:tx’ , {NAME=&gt;’f1’,TTL=&gt;10,VERSIONS=&gt;10} </li>
</ul>
</li>
<li><p>KEEP_DELETED_CELLS</p>
<ul>
<li>删除key之后，数据是否还保留, 未测试<br>$hbase&gt;create ‘ns1:tx’ , {NAME=&gt;’f1’,TTL=&gt;10,VERSIONS,KEEP_DELETED_CELLS=&gt;true}</li>
<li>TTL 的优先级高于 KEEP_DELETED_CELLS, 如果设置了 TTL, 时间一到就没了, 用 RAW 也找不回来</li>
</ul>
</li>
</ul>
<h2 id="缓存-和-批处理"><a href="#缓存-和-批处理" class="headerlink" title="缓存 和 批处理"></a>缓存 和 批处理</h2><ul>
<li><p>开启服务器端扫描器缓存</p>
<ul>
<li>表层面(全局), 貌似是默认的? 再看看书上说的<property><br>    <name>hbase.client.scanner.caching</name><br>    <!-- 整数最大值 --><br>    <value>2147483647</value><br>    <source>hbase-default.xml<br></property> 
</li>
</ul>
</li>
<li><p>操作层面</p>
</li>
</ul>
<p>  注意: 貌似JavaAPI 中默认是没有设置 caching 的</p>
<ul>
<li>设置方式<br>scan.setCaching(10);</li>
<li>操作时间<br>cache row nums : 1000            //632<br>cache row nums : 5000            //423<br>cache row nums : 1                //7359 </li>
</ul>
<ul>
<li><p>扫描器缓存是 面向行级别的</p>
</li>
<li><p>批量扫描是 面向列级别的</p>
<ul>
<li>控制每次next()服务器端返回的列的个数。</li>
<li>scan.setBatch(5);<br>每次next返回5列。</li>
</ul>
</li>
</ul>
<h2 id="过滤器"><a href="#过滤器" class="headerlink" title="过滤器"></a>过滤器</h2><ul>
<li><p>图示</p>
<p><img src="https://img.mubu.com/document_image/36f8af62-4775-498f-a399-3e6a7f748382-584150.jpg" alt="img"></p>
</li>
<li><p>代码</p>
<ul>
<li><a href="https://github.com/airpoet/bigdata/blob/master/HBaseDemo/src/test/java/com/rox/text/TestCRUD.java" target="_blank" rel="noopener">https://github.com/airpoet/bigdata/blob/master/HBaseDemo/src/test/java/com/rox/text/TestCRUD.java</a></li>
</ul>
</li>
</ul>
<h2 id="计数器"><a href="#计数器" class="headerlink" title="计数器"></a>计数器</h2><ul>
<li>shell 实现<ul>
<li>$hbase&gt;incr ‘ns1:t8’,’row1’,’f1:click’,1<br>后面可以跟任意数字, 正负,0都可以</li>
<li>$hbase&gt;get_counter ‘ns1:t8’,’row1’,’f1:click’<br>获取计数器</li>
</ul>
</li>
<li>Java 代码<ul>
<li><a href="https://github.com/airpoet/bigdata/blob/master/HBaseDemo/src/test/java/com/rox/text/TestCRUD.java" target="_blank" rel="noopener">https://github.com/airpoet/bigdata/blob/master/HBaseDemo/src/test/java/com/rox/text/TestCRUD.java</a></li>
</ul>
</li>
</ul>
<h2 id="协处理器-coprocessor-TODO-有空再看"><a href="#协处理器-coprocessor-TODO-有空再看" class="headerlink" title="协处理器 coprocessor :TODO 有空再看"></a>协处理器 coprocessor :TODO 有空再看</h2><ul>
<li><p>批处理的，等价于存储过程或者触发器 </p>
<p><img src="https://img.mubu.com/document_image/16c4bf5b-b2ea-4908-a6d2-1fc2cf779e22-584150.jpg" alt="img"></p>
</li>
<li><p>Observer</p>
<p><img src="https://img.mubu.com/document_image/78a0ca5e-5ead-4a01-b37c-e5e29f650045-584150.jpg" alt="img"></p>
<ul>
<li>RegionObserver        //RegionServer区域观察者</li>
<li>MasterObserver        //Master节点。</li>
<li>WAlObserver            //</li>
</ul>
</li>
<li><p>Endpoint</p>
<ul>
<li>终端,类似于存储过程。 </li>
</ul>
</li>
</ul>
<h2 id="HBase-amp-Mapreduce-整合"><a href="#HBase-amp-Mapreduce-整合" class="headerlink" title="HBase &amp; Mapreduce 整合"></a>HBase &amp; Mapreduce 整合</h2><ul>
<li>运行官方案例<ul>
<li>[ap@cs1]~/apps/hbase%  export HBASE_HOME=/home/ap/apps/hbase</li>
<li>[ap@cs1]~/apps/hbase%  export HADOOP_HOME=/home/ap/apps/hadoop</li>
<li>[ap@cs1]~/apps/hbase% export HADOOP_CLASSPATH=<code>${HBASE_HOME}/bin/hbase mapredcp</code></li>
</ul>
</li>
<li>使用 MapReduce导入本地数据到Hbase<ul>
<li>apps/hadoop/bin/yarn jar apps/hbase/lib/hbase-server-1.2.6.1.jar importtsv \</li>
<li>-Dimporttsv.columns=HBASE_ROW_KEY,info:name,info:color fruit \</li>
<li><a href="hdfs://cs1:8020/input_fruit" target="_blank" rel="noopener">hdfs://cs1:8020/input_fruit</a><br>这是 namenode 的 RPC 地址</li>
</ul>
</li>
</ul>
<h2 id="HBase-amp-Hive-整合"><a href="#HBase-amp-Hive-整合" class="headerlink" title="HBase &amp; Hive 整合"></a>HBase &amp; Hive 整合</h2><p>1.环境配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> HBASE_HOME=/home/ap/apps/hbase</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> HADOOP_HOME=/home/ap/apps/hadoop</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> HADOOP_CLASSPATH=`<span class="variable">$&#123;HBASE_HOME&#125;</span>/bin/hbase mapredcp`</span><br></pre></td></tr></table></figure>
<h2 id="剩下的hbase知识点-有空再补充"><a href="#剩下的hbase知识点-有空再补充" class="headerlink" title="剩下的hbase知识点 有空再补充"></a>剩下的hbase知识点 有空再补充</h2>
      
    </div>
    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>如果帮到你, 可以给我赞助杯咖啡☕️</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/uploads/images/wechat-reward.jpg" alt="airpoet 微信支付"/>
        <p>微信支付</p>
      </div>
    

    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/原创/" rel="tag"># 原创</a>
          
            <a href="/tags/技术/" rel="tag"># 技术</a>
          
            <a href="/tags/Hadoop/" rel="tag"># Hadoop</a>
          
            <a href="/tags/HBase/" rel="tag"># HBase</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/06/23/Hadoop/4-Zookeeper/i-Zookeeper/" rel="next" title="i-Zookeeper">
                <i class="fa fa-chevron-left"></i> i-Zookeeper
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/06/28/Hadoop/6-Sqoop&Azkaban/Sqoop/" rel="prev" title="Sqoop">
                Sqoop <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-14-045043.jpg"
                alt="airpoet" />
            
              <p class="site-author-name" itemprop="name">airpoet</p>
              <p class="site-description motion-element" itemprop="description">没有边界就没有自由.</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">123</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">47</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">44</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://www.jianshu.com/u/3b9b97fe7e04" target="_blank" title="我的简书">
                      
                        <i class="fa fa-fw fa-globe"></i>我的简书</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:airpoet@qq.com" target="_blank" title="Mile2Me">
                      
                        <i class="fa fa-fw fa-envelope"></i>Mile2Me</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                友情链接
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.jianshu.com/u/8ee264c6557d" title="女神凉姨" target="_blank">女神凉姨</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Hbase概念"><span class="nav-text">Hbase概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Feature"><span class="nav-text">Feature</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HBase要点"><span class="nav-text">HBase要点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HBase-表特点"><span class="nav-text">HBase 表特点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HBase-存储机制"><span class="nav-text">HBase 存储机制</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HBase-定位机制-三级坐标"><span class="nav-text">HBase 定位机制(三级坐标)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#表-行-列-列族的关系"><span class="nav-text">表 行 列 列族的关系</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RowKey-Column-Family-TimeStamp-Cell-概念解释"><span class="nav-text">RowKey, Column Family, TimeStamp, Cell 概念解释</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HBase-的HA搭建"><span class="nav-text">HBase 的HA搭建</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#vi-backup-masters"><span class="nav-text">vi backup-masters</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#启动-停止-hbase-进程"><span class="nav-text">启动/停止 hbase 进程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HBase-shell-操作"><span class="nav-text">HBase shell 操作</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#登录shell终端"><span class="nav-text">登录shell终端.</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#help-相关"><span class="nav-text">help 相关</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#desc-查看描述信息"><span class="nav-text">desc 查看描述信息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#list-相关"><span class="nav-text">list 相关</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#create-相关"><span class="nav-text">create 相关</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#exist-相关"><span class="nav-text">exist 相关</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#put-相关"><span class="nav-text">put 相关</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#get-相关"><span class="nav-text">get 相关</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#scan-相关"><span class="nav-text">scan 相关</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#delete-truncate-相关-删除-清空数据"><span class="nav-text">delete/truncate 相关 (删除,清空数据)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#alter-相关"><span class="nav-text">alter 相关</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#drop-相关"><span class="nav-text">drop 相关</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#count-相关"><span class="nav-text">count 相关</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#flush-相关"><span class="nav-text">flush 相关</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ValueFilter-过滤器"><span class="nav-text">ValueFilter 过滤器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#exit-退出"><span class="nav-text">exit 退出</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#遇到问题总结"><span class="nav-text">遇到问题总结</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#通过Java-API访问Hbase"><span class="nav-text">通过Java API访问Hbase</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HBase-写入过程-amp-存储路径"><span class="nav-text">HBase 写入过程 &amp; 存储路径</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HBase-和-Hive-的比较"><span class="nav-text">HBase 和 Hive 的比较</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HBase在-HDFS-上的存储路径"><span class="nav-text">HBase在 HDFS 上的存储路径</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Client-端-与-HBase-交互过程"><span class="nav-text">Client 端 与 HBase 交互过程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#百万数据批量插入"><span class="nav-text">百万数据批量插入</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HBase-切割文件"><span class="nav-text">HBase 切割文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HBase-合并文件"><span class="nav-text">HBase 合并文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HBase-手动移动文件"><span class="nav-text">HBase 手动移动文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#预先切割"><span class="nav-text">预先切割</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#指定版本数的问题"><span class="nav-text">指定版本数的问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#原生扫描-expert"><span class="nav-text">原生扫描(expert)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#缓存-和-批处理"><span class="nav-text">缓存 和 批处理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#过滤器"><span class="nav-text">过滤器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#计数器"><span class="nav-text">计数器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#协处理器-coprocessor-TODO-有空再看"><span class="nav-text">协处理器 coprocessor :TODO 有空再看</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HBase-amp-Mapreduce-整合"><span class="nav-text">HBase &amp; Mapreduce 整合</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HBase-amp-Hive-整合"><span class="nav-text">HBase &amp; Hive 整合</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#剩下的hbase知识点-有空再补充"><span class="nav-text">剩下的hbase知识点 有空再补充</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">airpoet</span>

  
</div>









        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      本站访客数
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      人次
    </span>
  

  
    <span class="site-pv">
      本站总访问量
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    
      <div id="needsharebutton-float">
        <span class="btn">
          <i class="fa fa-share-alt" aria-hidden="true"></i>
        </span>
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  

    
      <script id="dsq-count-scr" src="https://A.P.disqus.com/count.js" async></script>
    

    
      <script type="text/javascript">
        var disqus_config = function () {
          this.page.url = 'https://airpoet.github.io/2018/06/26/Hadoop/5-HBase/i-HBase-1/';
          this.page.identifier = '2018/06/26/Hadoop/5-HBase/i-HBase-1/';
          this.page.title = 'i-HBase-1';
        };
        var d = document, s = d.createElement('script');
        s.src = 'https://A.P.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      </script>
    

  




	





  














  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  
  
  <link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css">

  
  
  <script src="/lib/needsharebutton/needsharebutton.js"></script>

  <script>
    
    
      flOptions = {};
      
          flOptions.iconStyle = "box";
      
          flOptions.boxForm = "horizontal";
      
          flOptions.position = "middleRight";
      
          flOptions.networks = "Weibo,Twitter,Facebook";
      
      new needShareButton('#needsharebutton-float', flOptions);
    
  </script>

  

  

  
  <script type="text/javascript" src="/js/src/js.cookie.js?v=5.1.4"></script>
  <script type="text/javascript" src="/js/src/scroll-cookie.js?v=5.1.4"></script>


  

</body>
</html>
