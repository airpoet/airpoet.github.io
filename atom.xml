<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>A.Pçš„æ–‡è‰ºæ‚è°ˆ</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://airpoet.github.io/"/>
  <updated>2018-07-04T04:29:51.654Z</updated>
  <id>https://airpoet.github.io/</id>
  
  <author>
    <name>airpoet</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Redis</title>
    <link href="https://airpoet.github.io/2018/07/03/Hadoop/8_Redis/Redis/"/>
    <id>https://airpoet.github.io/2018/07/03/Hadoop/8_Redis/Redis/</id>
    <published>2018-07-03T13:36:06.543Z</published>
    <updated>2018-07-04T04:29:51.654Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-å®‰è£…"><a href="#1-å®‰è£…" class="headerlink" title="1.å®‰è£…"></a>1.å®‰è£…</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">1. ä¸‹è½½</span><br><span class="line">2. tar</span><br><span class="line">3. ln -s redis.xxxx  redis</span><br><span class="line">4. <span class="built_in">cd</span> redis</span><br><span class="line">-----------------</span><br><span class="line">5. æ‰§è¡Œç¼–è¯‘è„šæœ¬</span><br><span class="line">$&gt; make </span><br><span class="line"></span><br><span class="line">6. é»˜è®¤ä¼šè‡ªåŠ¨å®‰è£…åˆ° /usr/<span class="built_in">local</span>/bin, åé¢è·Ÿä¸Š PREFIX å¯ä»¥è‡ªå·±æŒ‡å®šå®‰è£…è·¯å¾„</span><br><span class="line">$&gt; sudo make  PREFIX=/usr/<span class="built_in">local</span>/redis install</span><br><span class="line"></span><br><span class="line">7. ç§»åŠ¨é…ç½®æ–‡ä»¶åˆ°rediså®‰è£…ç›®å½•</span><br><span class="line">$&gt; sudo cp redis.conf /usr/<span class="built_in">local</span>/redis</span><br><span class="line"></span><br><span class="line">8. å¯åŠ¨è¯•è¯•çœ‹~</span><br><span class="line">[ap@cs1]/usr/<span class="built_in">local</span>/redis% bin/redis-server redis.conf</span><br><span class="line">                _._</span><br><span class="line">           _.-``__ <span class="string">''</span>-._</span><br><span class="line">      _.-``    `.  `_.  <span class="string">''</span>-._           Redis 4.0.10 (00000000/0) 64 bit</span><br><span class="line">  .-`` .-```.  ```\/    _.,_ <span class="string">''</span>-._</span><br><span class="line"> (    <span class="string">'      ,       .-`  | `,    )     Running in standalone mode</span></span><br><span class="line"><span class="string"> |`-._`-...-` __...-.``-._|'</span>` _.-<span class="string">'|     Port: 6379</span></span><br><span class="line"><span class="string"> |    `-._   `._    /     _.-'</span>    |     PID: 1034</span><br><span class="line">  `-._    `-._  `-./  _.-<span class="string">'    _.-'</span></span><br><span class="line"> |`-._`-._    `-.__.-<span class="string">'    _.-'</span>_.-<span class="string">'|</span></span><br><span class="line"><span class="string"> |    `-._`-._        _.-'</span>_.-<span class="string">'    |           http://redis.io</span></span><br><span class="line"><span class="string">  `-._    `-._`-.__.-'</span>_.-<span class="string">'    _.-'</span></span><br><span class="line"> |`-._`-._    `-.__.-<span class="string">'    _.-'</span>_.-<span class="string">'|</span></span><br><span class="line"><span class="string"> |    `-._`-._        _.-'</span>_.-<span class="string">'    |</span></span><br><span class="line"><span class="string">  `-._    `-._`-.__.-'</span>_.-<span class="string">'    _.-'</span></span><br><span class="line">      `-._    `-.__.-<span class="string">'    _.-'</span></span><br><span class="line">          `-._        _.-<span class="string">'</span></span><br><span class="line"><span class="string">              `-.__.-'</span></span><br><span class="line"></span><br><span class="line">å‡ºç°ä¸€ä¸ªè¿™ä¸ªåŠçš„å›¾åƒ, å°±è¯´æ˜å¯åŠ¨æˆåŠŸäº†.....</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ˜¯å¦æœ‰è¿›ç¨‹</span></span><br><span class="line">ps -ef | grep redis </span><br><span class="line"></span><br><span class="line"><span class="comment"># è®©redisä»¥åå°è¿›ç¨‹çš„å½¢å¼è¿è¡Œ</span></span><br><span class="line">ç¼–è¾‘confé…ç½®æ–‡ä»¶,ä¿®æ”¹å¦‚ä¸‹å†…å®¹</span><br><span class="line">daemonize yes</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹ protected-mode ä¸º no</span></span><br><span class="line">protected-mode no</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ³¨é‡Šæ‰ bind æœ¬æœºç«¯å£</span></span><br><span class="line"><span class="comment"># bind 127.0.0.1 ::1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®ç¯å¢ƒå˜é‡</span></span><br><span class="line"><span class="built_in">export</span> REDIS_HOME=/home/ap/apps/redis</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$REDIS_HOME</span>/bin</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">9. è¿æ¥</span><br><span class="line"><span class="comment"># redis/bin/redis-cli [-h localhost -p 6379 ]</span></span><br><span class="line">å¦‚æœæ˜¯æœ¬æœº</span><br><span class="line">$&gt;/usr/<span class="built_in">local</span>/redis%  bin/redis-cli</span><br><span class="line">å¦‚æœæ˜¯å…¶å®ƒæœºå™¨</span><br><span class="line">[ap@cs2]~/apps/redis% redis-cli -h cs1 -p 6379</span><br><span class="line">cs1:6379&gt; ping</span><br><span class="line">PONG</span><br><span class="line"></span><br><span class="line">10. åœæ­¢æœåŠ¡</span><br><span class="line">cliç«¯:  shutdown  save|nosave</span><br></pre></td></tr></table></figure><h2 id="2-Redis-æ³¨æ„ç‚¹"><a href="#2-Redis-æ³¨æ„ç‚¹" class="headerlink" title="2.Redis æ³¨æ„ç‚¹"></a>2.Redis æ³¨æ„ç‚¹</h2><h4 id="REmote-DIctionary-Server-Redis"><a href="#REmote-DIctionary-Server-Redis" class="headerlink" title="REmote DIctionary Server(Redis)"></a><strong>REmote DIctionary Server(Redis)</strong></h4><p>Redis å¸¸è¢«ç§°ä½œæ˜¯ä¸€æ¬¾ key-value å†… å­˜å­˜å‚¨ç³»ç»Ÿæˆ–è€…å†…å­˜æ•°æ®åº“ï¼ŒåŒæ—¶ç”±äºå®ƒæ”¯æŒä¸°å¯Œçš„æ•°æ®ç»“æ„ï¼Œåˆè¢«ç§°ä¸ºä¸€ç§æ•°æ®ç»“æ„æœåŠ¡ å™¨ï¼ˆData Structure Serverï¼‰ã€‚</p><p>å› ä¸ºå€¼ï¼ˆvalueï¼‰å¯ä»¥æ˜¯å­—ç¬¦ä¸²(String)ï¼Œå“ˆå¸Œ(Map)ï¼Œåˆ—è¡¨(list)ï¼Œ é›†åˆ(sets)å’Œæœ‰åºé›†åˆ(sorted sets)ç­‰ç±»å‹ã€‚</p><h4 id="ä¸å…¶ä»–-key-value-ç¼“å­˜äº§å“æ¯”è¾ƒç‹¬æœ‰ç‰¹ç‚¹"><a href="#ä¸å…¶ä»–-key-value-ç¼“å­˜äº§å“æ¯”è¾ƒç‹¬æœ‰ç‰¹ç‚¹" class="headerlink" title="ä¸å…¶ä»– key-value ç¼“å­˜äº§å“æ¯”è¾ƒç‹¬æœ‰ç‰¹ç‚¹"></a><strong>ä¸å…¶ä»– key-value ç¼“å­˜äº§å“æ¯”è¾ƒç‹¬æœ‰ç‰¹ç‚¹</strong></h4><p>1ã€Redis æ”¯æŒæ•°æ®çš„æŒä¹…åŒ–ï¼Œå¯ä»¥å°†å†…å­˜ä¸­çš„æ•°æ®ä¿æŒåœ¨ç£ç›˜ä¸­ï¼Œé‡å¯çš„æ—¶å€™å¯ä»¥å†æ¬¡åŠ è½½ è¿›è¡Œä½¿ç”¨ã€‚</p><p>2ã€Redis ä¸ä»…ä»…æ”¯æŒç®€å•çš„ key-value ç±»å‹çš„æ•°æ®ï¼ŒåŒæ—¶è¿˜æä¾› listï¼Œsetï¼Œzsetï¼Œhash ç­‰æ•°æ® ç»“æ„çš„å­˜å‚¨ã€‚</p><p>3ã€Redis æ”¯æŒæ•°æ®çš„å¤‡ä»½ï¼Œå³ master-slave æ¨¡å¼çš„æ•°æ®å¤‡ä»½ã€‚</p><h4 id="Redisä¼˜åŠ¿"><a href="#Redisä¼˜åŠ¿" class="headerlink" title="Redisä¼˜åŠ¿"></a><strong>Redisä¼˜åŠ¿</strong></h4><p>1ã€æ€§èƒ½æé«˜ï¼šRedis èƒ½è¯»çš„é€Ÿåº¦æ˜¯ 110000 æ¬¡/sï¼Œå†™çš„é€Ÿåº¦æ˜¯ 81000 æ¬¡/s ã€‚</p><p>2ã€ä¸°å¯Œçš„æ•°æ®ç±»å‹ï¼šRedis æ”¯æŒäºŒè¿›åˆ¶æ¡ˆä¾‹çš„ String, List, Hash, Set åŠ Sorted Set æ•°æ®ç±»å‹æ“ ä½œã€‚</p><p>3ã€åŸå­æ“ä½œï¼šRedis çš„æ‰€æœ‰æ“ä½œéƒ½æ˜¯åŸå­æ€§çš„ï¼ŒåŒæ—¶ Redis è¿˜æ”¯æŒå¯¹å‡ ä¸ªæ“ä½œå…¨å¹¶åçš„åŸå­ æ€§æ‰§è¡Œã€‚</p><p>4ã€ä¸°å¯Œçš„ç‰¹æ€§ï¼šRedis è¿˜æ”¯æŒ Publish/Subscribeï¼Œé€šçŸ¥ key è¿‡æœŸï¼Œæ”¯æŒé«˜å¯ç”¨é›†ç¾¤ç­‰ç­‰ç‰¹æ€§ã€‚</p><p>5ã€æ•°æ®æŒä¹…åŒ–æœºåˆ¶</p><h4 id="æŒä¹…åŒ–æœºåˆ¶æœ‰ä¸¤ç§ï¼š"><a href="#æŒä¹…åŒ–æœºåˆ¶æœ‰ä¸¤ç§ï¼š" class="headerlink" title="æŒä¹…åŒ–æœºåˆ¶æœ‰ä¸¤ç§ï¼š"></a><strong>æŒä¹…åŒ–æœºåˆ¶æœ‰ä¸¤ç§ï¼š</strong></h4><p>1ã€<strong>RDB æ–¹å¼</strong>ï¼šå®šæœŸå°†å†…å­˜æ•°æ® dump åˆ°ç£ç›˜</p><p>2ã€<strong>AOF(append only file)æŒä¹…åŒ–æœºåˆ¶</strong>ï¼šç”¨è®°æ—¥å¿—çš„æ–¹å¼è®°å½•æ¯ä¸€æ¡æ•°æ®æ›´æ–°æ“ä½œï¼Œä¸€æ—¦ å‡ºç°ç¾éš¾äº‹ä»¶ï¼Œå¯ä»¥é€šè¿‡æ—¥å¿—é‡æ”¾æ¥æ¢å¤æ•´ä¸ªæ•°æ®åº“</p><h4 id="Redisé€‚ç”¨åœºæ™¯"><a href="#Redisé€‚ç”¨åœºæ™¯" class="headerlink" title="Redisé€‚ç”¨åœºæ™¯"></a><strong>Redisé€‚ç”¨åœºæ™¯</strong></h4><p>1ã€TopN éœ€æ±‚ï¼šå–æœ€æ–°çš„ n ä¸ªæ•°æ®ï¼Œå¦‚è¯»å–ä½œå®¶åšå®¢æœ€æ–°çš„ 50 ç¯‡æ–‡ç« ï¼Œé€šè¿‡ List å®ç°æŒ‰æ—¶ é—´æ’åºçš„æ•°æ®çš„é«˜æ•ˆè·å–</p><p>2ã€æ’è¡Œæ¦œåº”ç”¨ï¼šä»¥ç‰¹å®šæ¡ä»¶ä¸ºæ’åºæ ‡å‡†ï¼Œå°†å…¶è®¾æˆ sorted set çš„ scoreï¼Œè¿›è€Œå®ç°é«˜æ•ˆè·å–</p><p>3ã€éœ€è¦ç²¾å‡†è®¾å®šè¿‡æœŸæ—¶é—´çš„åº”ç”¨ï¼šæŠŠ sorted set çš„ score å€¼è®¾ç½®æˆè¿‡æœŸæ—¶é—´çš„æ—¶é—´æˆ³ï¼Œé‚£ä¹ˆ å°±å¯ä»¥ç®€å•åœ°é€šè¿‡è¿‡æœŸæ—¶é—´æ’åºï¼Œå®šæ—¶æ¸…é™¤è¿‡æœŸæ•°æ®äº†</p><p>4ã€è®¡æ•°å™¨åº”ç”¨ï¼šRedis çš„å‘½ä»¤éƒ½æ˜¯åŸå­æ€§çš„ï¼Œå¯ä»¥è½»æ¾åœ°åˆ©ç”¨ INCRï¼ŒDECR å‘½ä»¤æ¥æ„å»ºè®¡æ•° å™¨ç³»ç»Ÿã€‚</p><p>5ã€å»é™¤å¤§é‡æ•°æ®ä¸­çš„é‡å¤æ•°æ®ï¼šå°†æ•°æ®æ”¾å…¥ set ä¸­ï¼Œå°±èƒ½å®ç°å¯¹é‡å¤æ•°æ®çš„æ’é™¤</p><p>6ã€æ„å»ºé˜Ÿåˆ—ç³»ç»Ÿï¼šä½¿ç”¨ list å¯ä»¥æ„å»ºé˜Ÿåˆ—ç³»ç»Ÿï¼Œä½¿ç”¨ sorted set ç”šè‡³å¯ä»¥æ„å»ºæœ‰ä¼˜å…ˆçº§çš„é˜Ÿ åˆ—ç³»ç»Ÿã€‚</p><p>7ã€å®æ—¶ç³»ç»Ÿï¼Œååƒåœ¾ç³»ç»Ÿï¼šé€šè¿‡ä¸Šé¢è¯´åˆ°çš„ set åŠŸèƒ½ï¼Œä½ å¯ä»¥çŸ¥é“ä¸€ä¸ªç»ˆç«¯ç”¨æˆ·æ˜¯å¦è¿›è¡Œ äº†æŸä¸ªæ“ä½œï¼Œå¯ä»¥æ‰¾åˆ°å…¶æ“ä½œçš„é›†åˆå¹¶è¿›è¡Œåˆ†æç»Ÿè®¡å¯¹æ¯”ç­‰ã€‚</p><p>8ã€Publish/SubScribe æ„å»ºå®æ—¶æ¶ˆæ¯ç³»ç»Ÿ</p><p><strong>9ã€ç¼“å­˜ï¼ˆä¼šè¯ï¼Œå•†å“åˆ—è¡¨ï¼Œè¯„è®ºåˆ—è¡¨ï¼Œç»å¸¸æŸ¥è¯¢çš„æ•°æ®ç­‰ï¼‰</strong></p><h2 id="3-RedisåŸºæœ¬æ“ä½œ"><a href="#3-RedisåŸºæœ¬æ“ä½œ" class="headerlink" title="3.RedisåŸºæœ¬æ“ä½œ"></a>3.RedisåŸºæœ¬æ“ä½œ</h2><p><a href="https://app.yinxiang.com/shard/s37/nl/7399077/42d95f59-be2a-4780-a814-d91e42f7ff48/" target="_blank" rel="noopener">å…·ä½“è§æ–‡æ¡£</a></p><h3 id="2-1-å­—ç¬¦ä¸²"><a href="#2-1-å­—ç¬¦ä¸²" class="headerlink" title="2.1 å­—ç¬¦ä¸²"></a>2.1 å­—ç¬¦ä¸²</h3><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-07-03-151528.png" alt="image-20180703231528195"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br></pre></td><td class="code"><pre><span class="line">å¦‚æœç»™å®šäº† NX é€‰é¡¹ï¼Œé‚£ä¹ˆå‘½ä»¤ä»…åœ¨é”® key ä¸å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œæ‰è¿›è¡Œè®¾ç½®æ“ä½œï¼›å¦‚æœé”® key å·²ç»å­˜ åœ¨ï¼Œé‚£ä¹ˆ SET ... NX å‘½ä»¤ä¸åšåŠ¨ä½œï¼ˆä¸ä¼šè¦†ç›–æ—§å€¼ï¼‰ã€‚===&gt; not exist</span><br><span class="line"></span><br><span class="line">å¦‚æœç»™å®šäº† XX é€‰é¡¹ï¼Œé‚£ä¹ˆå‘½ä»¤ä»…åœ¨é”® key å·²ç»å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œæ‰è¿›è¡Œè®¾ç½®æ“ä½œï¼›å¦‚æœé”® key ä¸å­˜ åœ¨ï¼Œé‚£ä¹ˆ SET ... XX å‘½ä»¤ä¸åšåŠ¨ä½œï¼ˆä¸€å®šä¼šè¦†ç›–æ—§å€¼ï¼‰ã€‚</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç®€å•å­˜å–</span></span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">å¤æ‚åº¦ä¸º O(1) ã€‚</span><br><span class="line">redis&gt; SET msg <span class="string">"hello world"</span> </span><br><span class="line">OK</span><br><span class="line">redis&gt; GET msg</span><br><span class="line">hello world</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤</span></span><br><span class="line">del key1 key2 ... Keyn</span><br><span class="line">--------------------------------------------------------------------</span><br><span class="line">ä½œç”¨: åˆ é™¤1ä¸ªæˆ–å¤šä¸ªé”®</span><br><span class="line">è¿”å›å€¼: ä¸å­˜åœ¨çš„keyå¿½ç•¥æ‰,è¿”å›çœŸæ­£åˆ é™¤çš„keyçš„æ•°é‡</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»™key è®¾ç½®æ–°å€¼</span></span><br><span class="line">rename key newkey</span><br><span class="line">------------------------------------------------------------------------</span><br><span class="line">ä½œç”¨: ç»™keyèµ‹ä¸€ä¸ªæ–°çš„keyå</span><br><span class="line">æ³¨:å¦‚æœnewkeyå·²å­˜åœ¨,åˆ™newkeyçš„åŸå€¼è¢«è¦†ç›–</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># multi å­˜å–</span></span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line"><span class="comment"># ä¸­é—´çš„åˆ†éš”ç¬¦æ˜¯è‡ªå·±æŒ‡å®šçš„</span></span><br><span class="line">127.0.0.1:6379&gt; mset ss::name <span class="string">"airpoet"</span> ss::age <span class="string">"a8"</span> ss::like <span class="string">"ycy"</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; mget ss::name ss::age ss::like</span><br><span class="line">1) <span class="string">"airpoet"</span></span><br><span class="line">2) <span class="string">"a8"</span></span><br><span class="line">3) <span class="string">"ycy"</span></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; mset ss.age <span class="string">"18"</span> ss.teacher <span class="string">"noone"</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; mget ss.age ss::age</span><br><span class="line">1) <span class="string">"18"</span></span><br><span class="line">2) <span class="string">"a8"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># msetnx</span></span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">åªæœ‰åœ¨æ‰€æœ‰ç»™å®šé”®éƒ½ä¸å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œ MSETNX ä¼šä¸ºæ‰€æœ‰ç»™å®šé”®è®¾ç½®å€¼ï¼Œæ•ˆæœå’ŒåŒæ—¶æ‰§è¡Œå¤šä¸ª SETNX ä¸€æ ·ã€‚å¦‚æœç»™å®šçš„é”®è‡³å°‘æœ‰ä¸€ä¸ªæ˜¯å­˜åœ¨çš„ ï¼Œé‚£ä¹ˆ MSETNX å°†ä¸æ‰§è¡Œä»»ä½•è®¾ç½®æ“ä½œã€‚</span><br><span class="line">redis&gt; MSETNX nx-1 <span class="string">"hello"</span> nx-2 <span class="string">"world"</span> nx-3 <span class="string">"good luck"</span> 1</span><br><span class="line">redis&gt; SET ex-key <span class="string">"bad key here"</span></span><br><span class="line">OK</span><br><span class="line">redis&gt; MSETNX nx-4 <span class="string">"apple"</span> nx-5 <span class="string">"banana"</span> ex-key <span class="string">"cherry"</span> nx-6 <span class="string">"durian"</span> </span><br><span class="line">0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®æ–°å€¼å¹¶è¿”å›æ—§å€¼</span></span><br><span class="line">GETSET key new-value</span><br><span class="line">------------------------------------------------------------------------------------</span><br><span class="line"><span class="comment"># å…ˆè®¾ç½®</span></span><br><span class="line">redis&gt; SET getset-str <span class="string">"i'm old value"</span></span><br><span class="line">OK</span><br><span class="line"><span class="comment"># è®¾ç½®æ–°çš„å€¼, è¿”å›æ—§å€¼</span></span><br><span class="line">redis&gt; GETSET getset-str <span class="string">"i'm new value"</span> </span><br><span class="line">i<span class="string">'m old value</span></span><br><span class="line"><span class="string"># é‡æ–° get ä¸€ä¸‹, å‘ç°å·²æ˜¯æ–°å€¼</span></span><br><span class="line"><span class="string">redis&gt; GET getset-str </span></span><br><span class="line"><span class="string">i'</span>m new value</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#è¿½åŠ å†…å®¹åˆ°å­—ç¬¦ä¸²æœ«å°¾</span></span><br><span class="line">APPEND key value</span><br><span class="line">------------------------------------------------------------------------------------</span><br><span class="line">redis&gt; SET myPhone <span class="string">"nokia"</span> </span><br><span class="line">OK</span><br><span class="line">redis&gt; APPEND myPhone <span class="string">"-1110"</span> (<span class="built_in">integer</span>) </span><br><span class="line">10</span><br><span class="line">redis&gt; GET myPhone </span><br><span class="line"><span class="string">"nokia-1110"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#è¿”å›å€¼çš„é•¿åº¦</span></span><br><span class="line">------------------------------------------------------------------------------------</span><br><span class="line">redis&gt; SET msg <span class="string">"hello"</span> </span><br><span class="line">OK </span><br><span class="line">redis&gt; STRLEN msg </span><br><span class="line">(<span class="built_in">integer</span>) 5 redis&gt; </span><br><span class="line"></span><br><span class="line">APPEND msg <span class="string">" world"</span> </span><br><span class="line">(<span class="built_in">integer</span>) 11 </span><br><span class="line">redis&gt; STRLEN msg (<span class="built_in">integer</span>) 11</span><br><span class="line"></span><br><span class="line">==========================================================================================</span><br><span class="line"><span class="comment"># ç´¢å¼•</span></span><br><span class="line">-------------------------------------------------------------------------------------</span><br><span class="line">$ å¦‚æœå­—ç¬¦ä¸²é•¿åº¦ä¸º n</span><br><span class="line">ä»å·¦åˆ°å³&gt;&gt; 0 ~ n-1</span><br><span class="line">ä»å³åˆ°åš&gt;&gt; -1 ~ -n </span><br><span class="line"></span><br><span class="line"><span class="comment"># èŒƒå›´è®¾ç½®</span></span><br><span class="line">SETRANGE key index value</span><br><span class="line">-------------------------------------------------------------------------------------</span><br><span class="line">ä»ç´¢å¼• index å¼€å§‹ï¼Œç”¨ value è¦†å†™(overwrite)ç»™å®šé”® key æ‰€å‚¨å­˜çš„å­—ç¬¦ä¸²å€¼ã€‚åªæ¥å—æ­£æ•°ç´¢å¼•ã€‚</span><br><span class="line">redis&gt; SET msg <span class="string">"hello"</span></span><br><span class="line">OK</span><br><span class="line">redis&gt; SETRANGE msg 1 <span class="string">"appy"</span> </span><br><span class="line">(<span class="built_in">integer</span>) 5</span><br><span class="line">redis&gt; GET msg </span><br><span class="line"><span class="string">"happy"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># èŒƒå›´å–å€¼</span></span><br><span class="line">GETRANGE key start end</span><br><span class="line">-------------------------------------------------------------------------------------</span><br><span class="line">è¿”å›é”® key å‚¨å­˜çš„å­—ç¬¦ä¸²å€¼ä¸­ï¼Œä½äº start å’Œ end ä¸¤ä¸ªç´¢å¼•ä¹‹é—´çš„å†…å®¹(é—­åŒºé—´ï¼Œstart å’Œ end ä¼šè¢«åŒ…æ‹¬ åœ¨å†…)ã€‚å’Œ SETRANGE åªæ¥å—æ­£æ•°ç´¢å¼•ä¸åŒï¼Œ GETRANGE çš„ç´¢å¼•å¯ä»¥æ˜¯æ­£æ•°æˆ–è€… è´Ÿæ•°ã€‚</span><br><span class="line">redis&gt; SET msg <span class="string">"hello world"</span></span><br><span class="line">OK</span><br><span class="line">redis&gt; GETRANGE msg 0 4 </span><br><span class="line"><span class="string">"hello"</span></span><br><span class="line"><span class="comment"># ä»åå¾€å‰å–èŒƒå›´, ä¾ç„¶æ˜¯ä»å·¦å¾€å³(ä»å‰å¾€å)è¯»çš„</span></span><br><span class="line">redis&gt; GETRANGE msg -5 -1 </span><br><span class="line"><span class="string">"world"</span></span><br><span class="line"></span><br><span class="line">==========================================================================================</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ•°å­—æ“ä½œ</span></span><br><span class="line">-------------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">åªè¦å‚¨å­˜åœ¨å­—ç¬¦ä¸²é”®é‡Œé¢çš„å€¼å¯ä»¥è¢«è§£é‡Šä¸º 64 ä½æ•´æ•°ï¼Œæˆ–è€… IEEE-754 æ ‡å‡†çš„ 64 ä½æµ®ç‚¹æ•°ï¼Œ</span><br><span class="line">é‚£ä¹ˆç”¨æˆ·å°±å¯ä»¥å¯¹è¿™ä¸ªå­—ç¬¦ä¸²é”®æ‰§è¡Œé’ˆå¯¹æ•°å­—å€¼çš„å‘½ä»¤ã€‚</span><br><span class="line"> </span><br><span class="line"><span class="comment"># å¢åŠ æˆ–è€…å‡å°‘æ•°å­—çš„å€¼ </span></span><br><span class="line">INCRBY, DECRBY</span><br><span class="line">å¯å®ç°æ¡ˆä¾‹: è®¡æ•°å™¨(counter), id ç”Ÿæˆå™¨</span><br><span class="line">  <span class="comment"># é”® num ä¸å­˜åœ¨ï¼Œå‘½ä»¤å…ˆå°† num çš„å€¼åˆå§‹åŒ–ä¸º 0 ,ç„¶åå†æ‰§è¡ŒåŠ  100 æ“ä½œ</span></span><br><span class="line"> redis&gt; INCRBY num 100 </span><br><span class="line"> (<span class="built_in">integer</span>) 100</span><br><span class="line"> redis&gt; DECRBY num 50 </span><br><span class="line"> (<span class="built_in">integer</span>) 50</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="comment"># æµ®ç‚¹æ•°çš„è‡ªå¢å’Œè‡ªå‡</span></span><br><span class="line">INCRBYFLOAT key increment</span><br><span class="line">å‡çš„è¯ ç”¨è´Ÿæ•°</span><br><span class="line">-------------------------------------------------------------------------------------</span><br><span class="line">redis&gt; SET num 10</span><br><span class="line">OK</span><br><span class="line">redis&gt; INCRBYFLOAT num 3.14 </span><br><span class="line"><span class="string">"13.14"</span></span><br><span class="line">redis&gt; INCRBYFLOAT num -2.04 </span><br><span class="line"><span class="string">"11.1"</span></span><br><span class="line"></span><br><span class="line">å³ä½¿å­—ç¬¦ä¸²é”®å‚¨å­˜çš„æ˜¯æ•°å­—å€¼ï¼Œå®ƒä¹Ÿå¯ä»¥æ‰§è¡Œ APPENDã€STRLENã€SETRANGE å’Œ GETRANGE</span><br><span class="line">å½“ç”¨æˆ·é’ˆå¯¹ä¸€ä¸ªæ•°å­—å€¼æ‰§è¡Œè¿™äº›å‘½ä»¤çš„æ—¶å€™ï¼ŒRedis ä¼šå…ˆå°†æ•°å­—å€¼è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œç„¶åå†æ‰§è¡Œå‘½ä»¤ã€‚</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">==========================================================================================</span><br><span class="line"></span><br><span class="line"><span class="comment"># äºŒè¿›åˆ¶çš„æ“ä½œ</span></span><br><span class="line">ç´¢å¼•æ˜¯ä»å³å¾€å·¦é€’å¢ </span><br><span class="line">å…·ä½“æŸ¥çœ‹</span><br><span class="line">åº”ç”¨æ¡ˆä¾‹: å®ç°åœ¨çº¿äººæ•°ç»Ÿè®¡</span><br><span class="line">åº”ç”¨æ¡ˆä¾‹: ä½¿ç”¨ Redis ç¼“å­˜çƒ­é—¨å›¾ç‰‡(äºŒè¿›åˆ¶)</span><br><span class="line">https://app.yinxiang.com/shard/s37/nl/7399077/92dcb5fb-c005-45dc-bcc5-d00863c08f84/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">==========================================================================================</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å‚¨å­˜ä¸­æ–‡æ—¶çš„æ³¨æ„äº‹é¡¹</span></span><br><span class="line">--------------------------------------------</span><br><span class="line">ä¸€ä¸ªè‹±æ–‡å­—ç¬¦åªéœ€è¦ä½¿ç”¨ å•ä¸ªå­—èŠ‚æ¥å‚¨å­˜ï¼Œè€Œä¸€ä¸ªä¸­æ–‡å­—ç¬¦å´éœ€è¦ä½¿ç”¨å¤šä¸ªå­— èŠ‚æ¥å‚¨å­˜ã€‚</span><br><span class="line">STRLENã€SETRANGE å’Œ GETRANGE éƒ½æ˜¯ä¸ºè‹±æ–‡è®¾ç½®çš„ï¼Œå®ƒä»¬åªä¼šåœ¨å­—ç¬¦ä¸ºå•ä¸ªå­—èŠ‚çš„æƒ…å†µä¸‹æ­£å¸¸ å·¥ä½œï¼Œè€Œä¸€æ—¦æˆ‘ä»¬å‚¨å­˜çš„æ˜¯ç±»ä¼¼ä¸­æ–‡è¿™æ ·çš„å¤šå­—èŠ‚å­—ç¬¦ï¼Œé‚£ä¹ˆè¿™ä¸‰ä¸ªå‘½ä»¤å°±ä¸å†é€‚ç”¨äº†ã€‚</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨ redis-cli ä¸­ä½¿ç”¨ä¸­æ–‡æ—¶ï¼Œå¿…é¡»æ‰“å¼€ --raw é€‰é¡¹ï¼Œæ‰èƒ½æ­£å¸¸æ˜¾ç¤ºä¸­æ–‡</span></span><br><span class="line">$ redis-cli --raw</span><br><span class="line"></span><br><span class="line">$ redis&gt; SET msg <span class="string">"ä¸–ç•Œä½ å¥½"</span> </span><br><span class="line">OK</span><br><span class="line">$ redis&gt; GET msg </span><br><span class="line">ä¸–ç•Œä½ å¥½</span><br><span class="line"><span class="comment"># strlen åªèƒ½è·å–å­—èŠ‚</span></span><br><span class="line"><span class="variable">$redis</span>&gt; STRLEN msg </span><br><span class="line">12</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">==========================================================================================</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç§»åŠ¨åº“</span></span><br><span class="line">move key db</span><br><span class="line">(æ³¨æ„: ä¸€ä¸ªredisè¿›ç¨‹,æ‰“å¼€äº†ä¸æ­¢ä¸€ä¸ªæ•°æ®åº“, é»˜è®¤æ‰“å¼€16ä¸ªæ•°æ®åº“,ä»0åˆ°15ç¼–å·,å¦‚æœæƒ³æ‰“å¼€æ›´å¤šæ•°æ®åº“,å¯ä»¥ä»é…ç½®æ–‡ä»¶ä¿®æ”¹)</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">redis 127.0.0.1:6379[1]&gt; select 2</span><br><span class="line">OK</span><br><span class="line">redis 127.0.0.1:6379[2]&gt; keys *</span><br><span class="line">(empty list or <span class="built_in">set</span>)</span><br><span class="line">redis 127.0.0.1:6379[2]&gt; select 0</span><br><span class="line">OK</span><br><span class="line">redis 127.0.0.1:6379&gt; keys *</span><br><span class="line">1) <span class="string">"name"</span></span><br><span class="line">2) <span class="string">"cc"</span></span><br><span class="line">3) <span class="string">"a"</span></span><br><span class="line">4) <span class="string">"b"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç§»åŠ¨key åˆ°å…¶å®ƒçš„åº“</span></span><br><span class="line">redis 127.0.0.1:6379&gt; move cc 2</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">redis 127.0.0.1:6379&gt; select 2</span><br><span class="line">OK</span><br><span class="line">redis 127.0.0.1:6379[2]&gt; keys *</span><br><span class="line">1) <span class="string">"cc"</span></span><br><span class="line">redis 127.0.0.1:6379[2]&gt; get cc</span><br><span class="line"><span class="string">"3"</span></span><br></pre></td></tr></table></figure><h3 id="2-2-æ•£åˆ—"><a href="#2-2-æ•£åˆ—" class="headerlink" title="2.2 æ•£åˆ—"></a>2.2 æ•£åˆ—</h3><p><strong>ä¸€ä¸ªæ•£åˆ—ç”±å¤šä¸ªåŸŸå€¼å¯¹(field-value pair)ç»„æˆï¼Œæ•£åˆ—çš„é”®å’Œå€¼éƒ½å¯ä»¥æ˜¯æ–‡å­—ã€æ•´æ•°ã€æµ®ç‚¹æ•°æˆ–è€…äºŒ è¿›åˆ¶æ•°æ®ã€‚</strong></p><p><strong>åŒä¸€ä¸ªæ•£åˆ—é‡Œé¢çš„å„ä¸ªåŸŸå¿… é¡»æ˜¯ç‹¬ä¸€æ— äºŒçš„ï¼Œä½†ä¸åŒåŸŸçš„ å€¼å¯ä»¥æ˜¯é‡å¤çš„ã€‚</strong> </p><p><strong>å°½é‡ä½¿ç”¨æ•£åˆ—é”®è€Œä¸æ˜¯å­—ç¬¦ä¸²é”®æ¥å‚¨å­˜é”®å€¼å¯¹æ•°æ®ï¼Œå› ä¸ºæ•£åˆ—é”®ç®¡ç†æ–¹ä¾¿ã€èƒ½å¤Ÿé¿å…é”®åå†²çªã€å¹¶ä¸”è¿˜èƒ½å¤ŸèŠ‚çº¦å†…å­˜ã€‚</strong> </p><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-07-03-151738.png" alt="image-20180703231738040"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ•£åˆ—(hash)</span></span><br><span class="line">ç±»ä¼¼äº HashMap</span><br><span class="line">ä¸€ä¸ªæ•£åˆ—ç”±å¤šä¸ªåŸŸ å€¼å¯¹(field-value pair)ç»„æˆï¼Œæ•£åˆ—çš„åŸŸå’Œå€¼éƒ½å¯ä»¥æ˜¯æ–‡å­—ã€æ•´æ•°ã€æµ®ç‚¹æ•°æˆ–è€…äºŒ è¿›åˆ¶æ•°æ®</span><br><span class="line">åŒä¸€ä¸ªæ•£åˆ—é‡Œé¢çš„æ¯ä¸ªåŸŸå¿… é¡»æ˜¯ç‹¬ä¸€æ— äºŒã€å„ä¸ç›¸åŒ çš„ï¼Œè€ŒåŸŸçš„å€¼åˆ™æ²¡æœ‰è¿™ä¸€è¦æ±‚ï¼Œæ¢å¥è¯è¯´ï¼Œä¸åŒåŸŸçš„å€¼ å¯ä»¥æ˜¯é‡çš„ã€‚</span><br><span class="line"></span><br><span class="line"><span class="comment">#å…³è”åŸŸå€¼å¯¹</span></span><br><span class="line">HSET key field value</span><br><span class="line">HGET key field</span><br><span class="line">:TODO  çœŸæ­£çš„ kv æ˜¯ f v, é‚£è®¾ç½®è¿™ä¸ª key å¹²å˜›çš„? ? ğŸ‘Œ</span><br><span class="line">===&gt; key æ˜¯æ•£åˆ—åç§°, æ¯”å¦‚ æ•£åˆ— message çš„ field-value pair æ˜¯<span class="string">"sender"</span> <span class="string">"peter"</span> </span><br><span class="line">-------------------------------------------------------------------------------------</span><br><span class="line">redis&gt; HSET message <span class="string">"id"</span> 10086 </span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">redis&gt; HSET message <span class="string">"sender"</span> <span class="string">"peter"</span> </span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">redis&gt; HSET message <span class="string">"receiver"</span> <span class="string">"jack"</span> </span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">==========================================================================================</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸€æ¬¡è®¾ç½®æˆ–è·å–æ•£åˆ—ä¸­çš„å¤šä¸ªåŸŸå€¼å¯¹</span></span><br><span class="line">HMSET key field value [field value ...]</span><br><span class="line">HMGET key field [field ...]</span><br><span class="line"></span><br><span class="line">redis&gt; HMSET message  <span class="string">"id"</span> 10086  <span class="string">"sender"</span> <span class="string">"peter"</span>  <span class="string">"receiver"</span> <span class="string">"jack"</span></span><br><span class="line">OK</span><br><span class="line">redis&gt; HMGET message <span class="string">"id"</span> <span class="string">"sender"</span> <span class="string">"receiver"</span></span><br><span class="line">1) <span class="string">"10086"</span></span><br><span class="line">2) <span class="string">"peter"</span></span><br><span class="line">3) <span class="string">"jack"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#è·å–æ•£åˆ—åŒ…å«çš„æ‰€æœ‰åŸŸã€å€¼ã€æˆ–è€…åŸŸå€¼å¯¹</span></span><br><span class="line">HKEYS key =&gt; è¿”å›æ•£åˆ—é”® key åŒ…å«çš„æ‰€æœ‰åŸŸã€‚</span><br><span class="line">HVALS key =&gt; è¿”å›æ•£åˆ—é”® key ä¸­ï¼Œæ‰€æœ‰åŸŸçš„å€¼ã€‚</span><br><span class="line">HGETALL key =&gt; è¿”å›æ•£åˆ—é”® key åŒ…å«çš„æ‰€æœ‰åŸŸå€¼å¯¹ã€‚</span><br><span class="line"></span><br><span class="line">redis&gt; HKEYS message 1) <span class="string">"id"</span></span><br><span class="line">2) <span class="string">"sender"</span></span><br><span class="line">3) <span class="string">"receiver"</span></span><br><span class="line">4) <span class="string">"date"</span></span><br><span class="line">5) <span class="string">"content"</span></span><br><span class="line"></span><br><span class="line">redis&gt; HVALS message </span><br><span class="line">1) <span class="string">"10086"</span></span><br><span class="line">2) <span class="string">"peter"</span></span><br><span class="line">3) <span class="string">"jack"</span></span><br><span class="line">4) <span class="string">"2014-8-3 3:25 p.m."</span> </span><br><span class="line">5) <span class="string">"Good morning, jack!"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">redis&gt; HGETALL message</span><br><span class="line">1) <span class="string">"id"</span><span class="comment">#åŸŸ</span></span><br><span class="line">2) <span class="string">"10086"</span><span class="comment">#å€¼</span></span><br><span class="line">3) <span class="string">"sender"</span><span class="comment">#åŸŸ</span></span><br><span class="line">4) <span class="string">"peter"</span><span class="comment">#å€¼</span></span><br><span class="line">5) <span class="string">"receiver"</span></span><br><span class="line">6) <span class="string">"jack"</span></span><br><span class="line">7) <span class="string">"date"</span></span><br><span class="line">8) <span class="string">"2014-8-3 3:25 p.m."</span> 9) <span class="string">"content"</span></span><br><span class="line">10) <span class="string">"Good morning, jack!"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">==========================================================================================</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ•°å­—æ“ä½œ</span></span><br></pre></td></tr></table></figure><h2 id="4-å…¶å®ƒå¤„ç†"><a href="#4-å…¶å®ƒå¤„ç†" class="headerlink" title="4.å…¶å®ƒå¤„ç†"></a>4.å…¶å®ƒå¤„ç†</h2><p>gson: å¯¹è±¡è½¬ json å·¥å…·</p><h2 id="Redis-é”™è¯¯"><a href="#Redis-é”™è¯¯" class="headerlink" title="Redis é”™è¯¯"></a>Redis é”™è¯¯</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é”™è¯¯1</span></span><br><span class="line">(error) MISCONF Redis is configured to save RDB snapshots, but it is currently not able to persist on disk. Commands that may modify the data <span class="built_in">set</span> are disabled, because this instance is configured to report errors during writes <span class="keyword">if</span> RDB snapshotting fails (stop-writes-on-bgsave-error option). Please check the Redis logs <span class="keyword">for</span> details about the RDB error.</span><br><span class="line">127.0.0.1:6379&gt; config <span class="built_in">set</span> stop-writes-on-bgsave-error no</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; ping</span><br><span class="line">PONG</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># é”™è¯¯2</span></span><br><span class="line">cc: ../deps/hiredis/libhiredis.a: No such file or directory</span><br><span class="line">cc: ../deps/lua/src/liblua.a: No such file or directory</span><br><span class="line">cc: ../deps/geohash-int/geohash.o: No such file or directory</span><br><span class="line">cc: ../deps/geohash-int/geohash_helper.o: No such file or directory</span><br><span class="line">make[1]: * [redis-server] Error 1</span><br><span class="line">make[1]: Leaving directory `/usr/<span class="built_in">local</span>/src/redis-3.2.9/src<span class="string">'</span></span><br><span class="line"><span class="string">make: * [all] Error 2</span></span><br><span class="line"><span class="string">----------------</span></span><br><span class="line"><span class="string">è§£å†³åŠæ³•</span></span><br><span class="line"><span class="string">è¿›å…¥æºç åŒ…ç›®å½•ä¸‹çš„depsç›®å½•ä¸­æ‰§è¡Œ</span></span><br><span class="line"><span class="string">make geohash-int hiredis jemalloc linenoise lua</span></span><br><span class="line"><span class="string">ç„¶åå†è¿›è¡Œ../makeç¼–è¯‘å°±å¯ä»¥äº†</span></span><br><span class="line"><span class="string">å† $&gt; sudo make  PREFIX=/usr/local/redis install</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;1-å®‰è£…&quot;&gt;&lt;a href=&quot;#1-å®‰è£…&quot; class=&quot;headerlink&quot; title=&quot;1.å®‰è£…&quot;&gt;&lt;/a&gt;1.å®‰è£…&lt;/h2&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre
      
    
    </summary>
    
      <category term="Hadoop" scheme="https://airpoet.github.io/categories/Hadoop/"/>
    
      <category term="Redis" scheme="https://airpoet.github.io/categories/Hadoop/Redis/"/>
    
    
      <category term="åŸåˆ›" scheme="https://airpoet.github.io/tags/%E5%8E%9F%E5%88%9B/"/>
    
      <category term="æŠ€æœ¯" scheme="https://airpoet.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="Hadoop" scheme="https://airpoet.github.io/tags/Hadoop/"/>
    
      <category term="Redis" scheme="https://airpoet.github.io/tags/Redis/"/>
    
  </entry>
  
  <entry>
    <title>Kafka</title>
    <link href="https://airpoet.github.io/2018/07/01/Hadoop/7-Flume&amp;Kafka/Kafka/"/>
    <id>https://airpoet.github.io/2018/07/01/Hadoop/7-Flume&amp;Kafka/Kafka/</id>
    <published>2018-07-01T13:55:50.563Z</published>
    <updated>2018-07-03T17:28:46.335Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-æ¦‚è§ˆ"><a href="#1-æ¦‚è§ˆ" class="headerlink" title="1.æ¦‚è§ˆ"></a>1.æ¦‚è§ˆ</h2><p><strong>åˆ†å¸ƒå¼æµå¤„ç†å¹³å°ã€‚</strong> </p><p>åˆ†å¸ƒå¼, å‰¯æœ¬, å®¹é”™çš„åˆ†å¸ƒå¼å­˜å‚¨æµ.</p><p>åœ¨ç³»ç»Ÿä¹‹é—´æ„å»ºå®æ—¶æ•°æ®æµç®¡é“ã€‚ </p><p>ä»¥topicåˆ†ç±»å¯¹è®°å½•è¿›è¡Œå­˜å‚¨ </p><p>æ¯ä¸ªè®°å½•åŒ…å«key-value+timestamp </p><p>æ¯ç§’é’Ÿç™¾ä¸‡æ¶ˆæ¯ååé‡ã€‚ </p><p><strong>Java çš„ JMS</strong> æœ‰2ç§æ¨¡å¼: <strong>å‘å¸ƒè®¢é˜…æ¨¡å¼( æ‹¿åˆ°çš„æ˜¯ copy) &amp; é˜Ÿåˆ—æ¨¡å¼(queue): </strong></p><p>kafka é€šè¿‡ group æŠŠè¿™ä¸¤ç§æ¨¡å¼å®Œç¾çš„ç»“åˆèµ·æ¥</p><ul><li>å¦‚æœæƒ³è¦å®ç°queue æ¨¡å¼, å°±æŠŠæ¶ˆè´¹è€…æ”¾åœ¨åŒä¸€ç»„, æ­¤ç»„ä¸­åªèƒ½æœ‰ä¸€ä¸ªæˆå‘˜æ¥æ¶ˆè´¹æ­¤æ¶ˆæ¯</li><li>æƒ³è¦å®ç°å‘å¸ƒè®¢é˜…æ¨¡å¼, å°±æŠŠæ¯ä¸ªæ¶ˆè´¹è€…å„è‡ªä¸€ç»„, æ¯ä¸ªäººéƒ½å¯ä»¥æ‹¿åˆ°ä¸€ä¸ªæ¶ˆæ¯å‰¯æœ¬</li></ul><p><strong>å…³é”®è¯:</strong></p><ul><li>producer             //æ¶ˆæ¯ç”Ÿäº§è€…</li><li>consumer              //æ¶ˆæ¯æ¶ˆè´¹è€…</li><li>consumer group        //æ¶ˆè´¹è€…ç»„</li><li>kafka server          //broker,kafkaæœåŠ¡å™¨</li><li>topic                     //ä¸»é¢˜,å‰¯æœ¬æ•°,åˆ†åŒº.</li><li>zookeeper            //hadoop namenoade + RM HA | hbase | kafka</li></ul><p>ä¼˜åŒ–æ–¹æ¡ˆ: </p><ul><li>æŠŠç£ç›˜æŒ‚è½½åœ¨æŸä¸ªç›®å½•, ç„¶åè®©è¿™ä¸ªç›®å½•, åªæ˜¯å­˜å‚¨æŸä¸ªåˆ†åŒºçš„æ•°æ®</li></ul><h4 id="kafka-çš„è¦ç‚¹"><a href="#kafka-çš„è¦ç‚¹" class="headerlink" title="kafka çš„è¦ç‚¹"></a>kafka çš„è¦ç‚¹</h4><p>ä¸€æ¡æ¶ˆæ¯æ˜¯å­˜åœ¨ä¸€ä¸ªåˆ†åŒºçš„</p><p>å‰¯æœ¬â€“å¯é æ€§</p><p>åˆ†åŒºâ€“é«˜æ•ˆæ€§  =&gt; å¹¶å‘è®¿é—®</p><p>åˆ†åŒº(partition)æ˜¯ producer é€šè¿‡è´Ÿè½½å‡è¡¡é€‰æ‹©çš„</p><p>ä¸€ä¸ªåˆ†åŒºå­˜ç€å¤šæ¡æ¶ˆæ¯, æ¶ˆæ¯æ˜¯æœ‰åºçš„</p><p>ä¸€ä¸ªåˆ†åŒºå†…çš„æ¶ˆæ¯åªèƒ½è¢«ä¸€ä¸ªç»„å†…çš„ä¸€ä¸ªæˆå‘˜æ¶ˆè´¹</p><p>topic æ˜¯åœ¨ kafka server ä¸Š</p><p>topic åŒ…å« å‰¯æœ¬æ•°, åˆ†åŒº</p><p>producer &amp; consumer éƒ½æ˜¯é’ˆå¯¹ topic æ¥æ“ä½œçš„</p><p>kafka çš„ consumer æ˜¯æ‹‰æ¨¡å¼,  ä» kafkaå»pull æ¶ˆæ¯, å®æ—¶è®¡ç®—æ¡†æ¶æœ‰å¤šå¤§èƒ½åŠ›, å°± pull å¤šå°‘</p><p>æ‰€ä»¥ kafka ä¸€èˆ¬éƒ½ç”¨åœ¨å®æ—¶/å‡†å®æ—¶ è®¡ç®—ä¸­</p><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-07-03-032535.png" alt="image-20180703112535633"></p><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-07-03-032546.png" alt="image-20180703112545937"></p><p><strong>é¡ºåºè¯»å†™</strong></p><ul><li>è¿½åŠ æ•°æ®, æ˜¯è¿½åŠ åˆ°æœ€å</li><li>è¯»å–æ˜¯ä»å¼€å¤´è¯»å–</li><li>å¯ç”¨ offset è·³è½¬åˆ°æŒ‡å®šçš„æ•°æ®æ®µ</li><li>æ•°æ®å¯é‡å¤æ¶ˆè´¹</li></ul><p><strong>Consumers</strong></p><ul><li>ä¸€æ¡æ•°æ®åªèƒ½è¢«åŒç»„å†…ä¸€ä¸ªæˆå‘˜æ¶ˆè´¹</li><li>ä¸åŒç»„çš„å¯ä»¥æ¶ˆè´¹åŒä¸€ä¸ªæ•°æ®</li></ul><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-07-03-032635.png" alt="image-20180703112634857"></p><p><strong>SSDè¯»å†™é€Ÿåº¦: 1200 ~ 3500 MB/s</strong></p><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-07-03-032302.png" alt="image-20180703112302238"></p><p><strong>æ³¨æ„ç‚¹:</strong> </p><ul><li>Kafka çš„åˆ†åŒºæ•°, å¯ä»¥åŠ¨æ€è°ƒæ•´</li><li>Kafka çš„æ¯ä¸ªåˆ†åŒºéƒ½æœ‰å¯¹åº”çš„å†—ä½™æ•°é‡, é»˜è®¤æ˜¯1</li><li>æ¯ä¸ªåˆ†åŒºå¦‚æœæœ‰å¤šä¸ªå‰¯æœ¬, è¿™äº›å‰¯æœ¬ä¸­, ä¼šæœ‰ä¸€ä¸ªæ˜¯ active çš„çŠ¶æ€, è´Ÿè´£è¯»å†™, å…¶å®ƒçš„éƒ½æ˜¯ standby çš„çŠ¶æ€</li><li>å¯¹äºHDFSå’Œkafkaçš„  block  partition å¯¹äºä¸åŒçš„æ–‡ä»¶æˆ–è€…topicæ¥è¯´ï¼Œéƒ½å¯ä»¥æœ‰ä¸åŒçš„å‰¯æœ¬æ•°ï¼(æ¯ä¸ª topic å¯ä»¥å•ç‹¬è®¾ç½®)<br>è®¾ç½®çš„å‰¯æœ¬æ•°ä¸èƒ½è¶…è¿‡brokerçš„æ•°é‡ï¼ï¼ï¼</li></ul><hr><h4 id="Kafka-çš„å¤§è‡´å·¥ä½œæ¨¡å¼ï¼š"><a href="#Kafka-çš„å¤§è‡´å·¥ä½œæ¨¡å¼ï¼š" class="headerlink" title="Kafka çš„å¤§è‡´å·¥ä½œæ¨¡å¼ï¼š"></a><strong>Kafka çš„å¤§è‡´å·¥ä½œæ¨¡å¼ï¼š</strong></h4><p>1ã€å¯åŠ¨ ZooKeeper çš„ server</p><p>2ã€å¯åŠ¨ Kafka çš„ server</p><p>3ã€Producer ç”Ÿäº§æ•°æ®ï¼Œç„¶åé€šè¿‡ ZooKeeper æ‰¾åˆ° Brokerï¼Œå†å°†æ•°æ® push åˆ° Broker ä¿å­˜</p><p>4ã€Consumer é€šè¿‡ ZooKeeper æ‰¾åˆ° Brokerï¼Œç„¶åå†ä¸»åŠ¨ pull æ•°æ®</p><h2 id="2-å®‰è£…-kafka"><a href="#2-å®‰è£…-kafka" class="headerlink" title="2.å®‰è£… kafka"></a>2.å®‰è£… kafka</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">0.é€‰æ‹©cs1 ~ cs6,  6å°ä¸»æœºéƒ½å®‰è£…kafka</span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">1.å‡†å¤‡zk</span><br><span class="line">ç•¥</span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">2.jdk</span><br><span class="line">ç•¥</span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">3.taræ–‡ä»¶</span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">4.ç¯å¢ƒå˜é‡</span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">ç•¥</span><br><span class="line">5.é…ç½®kafka</span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">    [kafka/config/server.properties]</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment"># è¿™é‡Œæ¯å°ä¸ä¸€æ ·</span></span><br><span class="line">    broker.id=1</span><br><span class="line">    ...</span><br><span class="line">    listeners=PLAINTEXT://:9092</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment"># è¿™é‡Œæ¯å°ä¸ä¸€æ ·</span></span><br><span class="line">    advertised.listeners=PLAINTEXT://cs1:9092</span><br><span class="line">    host.name=cs1</span><br><span class="line">    ...</span><br><span class="line">    log.dirs=/home/centos/kafka/logs</span><br><span class="line">    ...</span><br><span class="line">    zookeeper.connect=s201:2181,s202:2181,s203:2181</span><br><span class="line"></span><br><span class="line">6.åˆ†å‘æ•´ä¸ªæ–‡ä»¶ &amp; ç¬¦å·é“¾æ¥,  .zshrcé…ç½®æ–‡ä»¶,     åŒæ—¶ä¿®æ”¹æ¯ä¸ªserver.properties æ–‡ä»¶çš„broker.idå‚æ•° </span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">7.å¯åŠ¨kafkaæœåŠ¡å™¨</span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">    a)å…ˆå¯åŠ¨zk</span><br><span class="line">    b)å¯åŠ¨kafka       </span><br><span class="line">    b1)å‰å°å¯åŠ¨</span><br><span class="line">    [cs2 ~ cs4]</span><br><span class="line">    [ap@cs1]~% kafka-server-start.sh /home/ap/apps/kafka/config/server.properties</span><br><span class="line"></span><br><span class="line">    b2)åå°å¯åŠ¨</span><br><span class="line">    <span class="comment"># è¿™é‡Œæ—¥å¿—ç›´æ¥æ‰“å°åœ¨æ§åˆ¶å°</span></span><br><span class="line">    $&gt; kafka-server-start.sh  -daemon  /home/ap/apps/kafka/config/server.properties     </span><br><span class="line">    [æˆ–è€…]</span><br><span class="line">    <span class="comment"># è¿™æ ·èƒ½æŠŠæ—¥å¿—è¾“å‡ºåˆ°æ–‡ä»¶ä¸­</span></span><br><span class="line">    nohup kafka-server-start.sh /home/ap/apps/kafka/config/server.properties 1&gt;&lt;sub&gt;/kafka/logs/kafka_std.log  2&gt;&lt;/sub&gt;/kafka/logs/kafka_err.log &amp;</span><br><span class="line"></span><br><span class="line">    c)éªŒè¯kafkaæœåŠ¡å™¨æ˜¯å¦å¯åŠ¨</span><br><span class="line">    $&gt;netstat -anop | grep 9092</span><br><span class="line"></span><br><span class="line">8.åˆ›å»ºä¸»é¢˜ </span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">    [ap@cs2]~% kafka-topics.sh --create  --zookeeper cs1:2181 --replication-factor 3 --partitions 3 --topic <span class="built_in">test</span></span><br><span class="line"></span><br><span class="line">9.æŸ¥çœ‹ä¸»é¢˜åˆ—è¡¨</span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">[ap@cs2]~% kafka-topics.sh --list --zookeeper cs1:2181</span><br><span class="line"></span><br><span class="line">10.å¯åŠ¨æ§åˆ¶å°ç”Ÿäº§è€…  (å‰ææ˜¯ æ“ä½œæœ¬æœº &amp; cs2 ä¸Šå·²ç»å¯åŠ¨kafkaæœåŠ¡)</span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">    æ³¨æ„ : producer ä¸ç›´æ¥è¿æ¥ zk, è€Œæ˜¯è¿æ¥ broker, ä¹Ÿå°±æ˜¯ kafka server. </span><br><span class="line">    å…¶å®ƒçš„éƒ½æ˜¯è¿ zk</span><br><span class="line">    å¦‚æœproducer è¿çš„æŸä¸€å°æŒ‚æ‰çš„è¯, å¯ä»¥åœ¨ --broker-list åé¢, åŠ ä¸Šå¤šå°æœåŠ¡å™¨,ç”¨é€—å·éš”å¼€</span><br><span class="line">    [ap@cs2]~% kafka-console-producer.sh --broker-list cs2:9092 --topic <span class="built_in">test</span></span><br><span class="line"></span><br><span class="line">11.å¯åŠ¨æ§åˆ¶å°æ¶ˆè´¹è€… (å‰ææ˜¯ æ“ä½œæœ¬æœº &amp; cs2 ä¸Šå·²ç»å¯åŠ¨å¡å¤«å¡æœåŠ¡)</span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">    <span class="comment"># ä½¿ç”¨bootstrap-serverå‚æ•° æ›¿ä»£zookeeper</span></span><br><span class="line">    Using the ConsoleConsumer with old consumer is deprecated and will be removed <span class="keyword">in</span> a future major release. Consider using the new consumer by passing [bootstrap-server] instead of [zookeeper].</span><br><span class="line">    [ap@cs3]~% kafka-console-consumer.sh --bootstrap-server cs2:9092 --topic <span class="built_in">test</span> --from-beginning</span><br><span class="line"></span><br><span class="line">12.åœ¨ç”Ÿäº§è€…æ§åˆ¶å°è¾“å…¥hello world</span><br><span class="line">---------------------------------------------------------------------</span><br></pre></td></tr></table></figure><h2 id="3-kafkaé›†ç¾¤åœ¨zkçš„é…ç½®"><a href="#3-kafkaé›†ç¾¤åœ¨zkçš„é…ç½®" class="headerlink" title="3.kafkaé›†ç¾¤åœ¨zkçš„é…ç½®"></a>3.kafkaé›†ç¾¤åœ¨zkçš„é…ç½®</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">/controller            ===&gt;    &#123;<span class="string">"version"</span>:1,<span class="string">"brokerid"</span>:202,<span class="string">"timestamp"</span>:<span class="string">"1490926369148"</span></span><br><span class="line"></span><br><span class="line">/controller_epoch    ===&gt;    1</span><br><span class="line"></span><br><span class="line">/brokers</span><br><span class="line">/brokers/ids</span><br><span class="line">/brokers/ids/202    ===&gt;    &#123;<span class="string">"jmx_port"</span>:-1,<span class="string">"timestamp"</span>:<span class="string">"1490926370304"</span>,<span class="string">"endpoints"</span>:[<span class="string">"PLAINTEXT://s202:9092"</span>],<span class="string">"host"</span>:<span class="string">"s202"</span>,<span class="string">"version"</span>:3,<span class="string">"port"</span>:9092&#125;</span><br><span class="line">/brokers/ids/203</span><br><span class="line">/brokers/ids/204    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/brokers/topics/<span class="built_in">test</span>/partitions/0/state ===&gt;&#123;<span class="string">"controller_epoch"</span>:1,<span class="string">"leader"</span>:203,<span class="string">"version"</span>:1,<span class="string">"leader_epoch"</span>:0,<span class="string">"isr"</span>:[203,204,202]&#125;</span><br><span class="line">/brokers/topics/<span class="built_in">test</span>/partitions/1/state ===&gt;...</span><br><span class="line">/brokers/topics/<span class="built_in">test</span>/partitions/2/state ===&gt;...</span><br><span class="line"></span><br><span class="line">/brokers/seqid        ===&gt; null</span><br><span class="line"></span><br><span class="line">/admin</span><br><span class="line">/admin/delete_topics/<span class="built_in">test</span>        ===&gt;æ ‡è®°åˆ é™¤çš„ä¸»é¢˜, ä½†æ˜¯å®é™…åˆ é™¤å, è¿™é‡Œæ²¡å‡ºç°</span><br><span class="line"></span><br><span class="line">/isr_change_notification</span><br><span class="line"></span><br><span class="line">/consumers/xxxx/</span><br><span class="line">/config</span><br></pre></td></tr></table></figure><h2 id="4-kafka-ä¸»é¢˜-amp-å‰¯æœ¬æ“ä½œ"><a href="#4-kafka-ä¸»é¢˜-amp-å‰¯æœ¬æ“ä½œ" class="headerlink" title="4.kafka ä¸»é¢˜&amp;å‰¯æœ¬æ“ä½œ"></a>4.kafka ä¸»é¢˜&amp;å‰¯æœ¬æ“ä½œ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line">---------------------------------------------------------------------</span><br><span class="line">PS: æŸ¥çœ‹å¸®åŠ©å¥—è·¯</span><br><span class="line">* å¦‚æœçœ‹ topic ç›¸å…³å¸®åŠ©</span><br><span class="line">    * bin/kafka-topic.sh  è„šæœ¬ç›´æ¥å›è½¦, æŸ¥çœ‹å¸®åŠ©</span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">æŸ¥çœ‹ä¸»é¢˜åˆ—è¡¨</span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">[ap@cs2]~% kafka-topics.sqqh --list --zookeeper cs1:2181</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">åˆ›å»ºä¸»é¢˜</span><br><span class="line">---------------------------------------------------------</span><br><span class="line">    repliation_factor 2 partitions 5</span><br><span class="line"></span><br><span class="line">    $&gt;kafka-topics.sh --zookeeper cs2:2181 --replication-factor 2 --partitions 3 --create --topic test2</span><br><span class="line"></span><br><span class="line">    2 x 3  = 6        //ä¸ªæ–‡ä»¶å¤¹</span><br><span class="line"></span><br><span class="line">    2ä»½å‰¯æœ¬, æ¯ä»½å‰¯æœ¬æœ‰3ä¸ªåˆ†åŒº</span><br><span class="line">    æ€»åˆ†åŒºæ•°ä¸º 6</span><br><span class="line">    æ¯ä¸ªåˆ†åŒºéƒ½æœ‰ä¸€ä¸ª leader,  follower å°±æ˜¯å…¶å®ƒçš„å‰¯æœ¬</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">åˆ é™¤ä¸»é¢˜</span><br><span class="line">------------------------------------------------------------</span><br><span class="line">[ap@cs2]~% kafka-topics.sh --zookeeper cs1:2181,cs2:2181,cs3:2181  --delete --topic kafka_test1</span><br><span class="line"></span><br><span class="line">æŸ¥çœ‹ä¸»é¢˜æè¿°</span><br><span class="line">--------------------------------------------------------</span><br><span class="line">[ap@cs2]~% kafka-topics.sh --zookeeper cs1:2181,cs2:2181,cs3:2181  --describe --topic kafka_test1</span><br><span class="line"></span><br><span class="line">å¢åŠ /åˆ é™¤åˆ†åŒºæ•°</span><br><span class="line">--------------------------------------------------------</span><br><span class="line">kafka-topics.sh \</span><br><span class="line">--alter \</span><br><span class="line">--zookeeper cs1:2181,cs2:2181,cs3:2181 \</span><br><span class="line">--topic kafka_test1 \</span><br><span class="line">--partitions 20</span><br><span class="line">--------------</span><br><span class="line">kafka-topics.sh \</span><br><span class="line">--alter \</span><br><span class="line">--zookeeper hadoop02:2181,hadoop03:2181,hadoop04:2181 \ --topic kafka_test \</span><br><span class="line">--replication-factor 2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">æŸ¥çœ‹æŸ topic æŸä¸ªåˆ†åŒºçš„åç§»é‡æœ€å¤§å€¼å’Œæœ€å°å€¼ :TODO  å•¥æ„æ€??</span><br><span class="line">--------------------------------------------------------</span><br><span class="line">kafka-run-class.sh kafka.tools.GetOffsetShell --topic kafka_test1 --time -1 --broker-list cs1:9092,cs2:9092,cs3:9092 --partitions 1</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">é‡æ–°å¸ƒå±€åˆ†åŒºå’Œå‰¯æœ¬ï¼Œæ‰‹åŠ¨å†å¹³è¡¡  :TODO è¿˜æœªæµ‹è¯• </span><br><span class="line">------------------------------------------------------------</span><br><span class="line">alter ä¼¼ä¹æ˜¯æœ‰é—®é¢˜çš„, createå¥½åƒæ²¡é—®é¢˜</span><br><span class="line">æ­¤å¥æ˜¯æ‰‹åŠ¨æŠŠåˆ†åŒºæ”¾åˆ° 203 &amp; 204ä¸Šäº†</span><br><span class="line">    $&gt;kafka-topics.sh --alter --zookeeper s202:2181 --topic test2 --replica-assignment 203:204,203:204,203:204,203:204,203:204</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">æµ‹è¯• producer å‘æ¶ˆæ¯å, å­˜åœ¨æœ¬åœ°çš„logs ç›®å½•çš„æ–‡ä»¶</span><br><span class="line">--------------------------------------------------------------</span><br><span class="line">1. å¼€å¯ä¸€ä¸ªproducer, å‘æ¶ˆæ¯</span><br><span class="line">2. æŸ¥çœ‹æœ¬åœ° <span class="built_in">cd</span>  ~/kafka/logs</span><br><span class="line">3. æŸ¥çœ‹æ–‡ä»¶å¤§å°, æ‰¾å‡ºæ–‡ä»¶(ä¸€æ¬¡æ€§æŸ¥çœ‹)</span><br><span class="line">    1. [ap@cs1]~% xcall.sh <span class="string">"ls -lh  kafka/logs/test2-*"</span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">å‰¯æœ¬</span><br><span class="line">--------------------------------------------------------------</span><br><span class="line">brokerå­˜æ”¾æ¶ˆæ¯ä»¥æ¶ˆæ¯è¾¾åˆ°é¡ºåºå­˜æ”¾ã€‚ç”Ÿäº§å’Œæ¶ˆè´¹éƒ½æ˜¯å‰¯æœ¬æ„ŸçŸ¥çš„ã€‚</span><br><span class="line">æ”¯æŒåˆ°n-1æ•…éšœã€‚æ¯ä¸ªåˆ†åŒºéƒ½æœ‰leaderï¼Œfollow.</span><br><span class="line">leaderæŒ‚æ‰æ—¶ï¼Œæ¶ˆæ¯åˆ†åŒºå†™å…¥åˆ°æœ¬åœ°<span class="built_in">log</span>æˆ–è€…ï¼Œå‘ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ç¡®è®¤å›æ‰§ä¹‹å‰ï¼Œç”Ÿäº§è€…å‘æ–°çš„leaderå‘é€æ¶ˆæ¯ã€‚</span><br><span class="line"></span><br><span class="line">æ–°leaderçš„é€‰ä¸¾æ˜¯é€šè¿‡isrè¿›è¡Œï¼Œç¬¬ä¸€ä¸ªæ³¨å†Œçš„followeræˆä¸ºleaderã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## kafkaæ”¯æŒå‰¯æœ¬æ¨¡å¼, å°±æ˜¯ producer å†™åˆ° brokerçš„ topicä¸­çš„ partition çš„å‰¯æœ¬æœºåˆ¶</span></span><br><span class="line">---------------------</span><br><span class="line">[åŒæ­¥å¤åˆ¶]</span><br><span class="line">    1.producerè”ç³»zkè¯†åˆ«leader</span><br><span class="line">    2.å‘leaderå‘é€æ¶ˆæ¯</span><br><span class="line">    3.leadræ”¶åˆ°æ¶ˆæ¯å†™å…¥åˆ°æœ¬åœ°<span class="built_in">log</span></span><br><span class="line">    4.followerä»leader pullæ¶ˆæ¯</span><br><span class="line">    5.followerå‘æœ¬åœ°å†™å…¥<span class="built_in">log</span></span><br><span class="line">    6.followerå‘leaderå‘é€ackæ¶ˆæ¯</span><br><span class="line">    7.leaderæ”¶åˆ°æ‰€æœ‰followerçš„ackæ¶ˆæ¯</span><br><span class="line">    8.leaderå‘producerå›ä¼ ack</span><br><span class="line">                    </span><br><span class="line">    </span><br><span class="line">[å¼‚æ­¥å‰¯æœ¬]</span><br><span class="line">--------------------------------------------------------------</span><br><span class="line">    å’ŒåŒæ­¥å¤åˆ¶çš„åŒºåˆ«åœ¨äº leaderå†™å…¥æœ¬åœ°<span class="built_in">log</span>ä¹‹åï¼Œ</span><br><span class="line">    ç›´æ¥å‘clientå›ä¼ ackæ¶ˆæ¯ï¼Œä¸éœ€è¦ç­‰å¾…æ‰€æœ‰followerå¤åˆ¶å®Œæˆã€‚</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="comment"># kafka å‰¯æœ¬æ¨¡å¼ &amp; leader æœºåˆ¶ | å®˜æ–¹æ–‡æ¡£</span></span><br><span class="line">----------------------------------------------------</span><br><span class="line">ps : æ¨é€‰leaderè¿‡ç¨‹å°±æ˜¯followeråœ¨zkä¸­æ³¨å†Œè¿‡ç¨‹ï¼Œç¬¬ä¸€ä¸ªæ³¨å†Œå°±æ˜¯leader</span><br><span class="line"></span><br><span class="line">The process of choosing the new lead replica is that all followers<span class="string">' In-sync Replicas (ISRs) register themselves with ZooKeeper. The very first registered replica becomes the new lead replica, and the rest of the registered replicas become the followers.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Kafka supports the following replication modes:</span></span><br><span class="line"><span class="string">â€¢ Synchronous replication: In synchronous replication, a producer first identifies the lead replica from ZooKeeper and publishes the message. As soon as the message is published, it is written to the log of the lead replica and all the followers of the lead start pulling the message, and by using a single channel, the order of messages is ensured. Each follower replica sends an acknowledgement to the lead replica once the message is written to its respective logs. Once replications are complete and all expected acknowledgements are received, the lead replica sends an acknowledgement to the producer.</span></span><br><span class="line"><span class="string">On the consumer side, all the pulling of messages is done from the lead replica.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">â€¢ Asynchronous replication: The only difference in this mode is that as soon as a lead replica writes the message to its local log, it sends the acknowledgement to the message client and does not wait for the acknowledgements from follower replicas. But as a down side, this mode does not ensure the message delivery in case of broker failure.</span></span><br></pre></td></tr></table></figure><h2 id="5-Kafka-java-API"><a href="#5-Kafka-java-API" class="headerlink" title="5.Kafka java API"></a>5.Kafka java API</h2><h4 id="5-0-pom-æ–‡ä»¶"><a href="#5-0-pom-æ–‡ä»¶" class="headerlink" title="5.0   pom æ–‡ä»¶"></a>5.0   pom æ–‡ä»¶</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.rox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>Kafka_Demo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.kafka<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>kafka-clients<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.kafka<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>kafka_2.11<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="5-1å®ç°æ¶ˆæ¯ç”Ÿäº§è€…ï¼Œå‘é€-amp-æ¥å—-æ¶ˆæ¯"><a href="#5-1å®ç°æ¶ˆæ¯ç”Ÿäº§è€…ï¼Œå‘é€-amp-æ¥å—-æ¶ˆæ¯" class="headerlink" title="5.1å®ç°æ¶ˆæ¯ç”Ÿäº§è€…ï¼Œå‘é€&amp;æ¥å— æ¶ˆæ¯"></a>5.1å®ç°æ¶ˆæ¯ç”Ÿäº§è€…ï¼Œå‘é€&amp;æ¥å— æ¶ˆæ¯</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.rox.kafkademo.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> kafka.consumer.Consumer;</span><br><span class="line"><span class="keyword">import</span> kafka.consumer.ConsumerConfig;</span><br><span class="line"><span class="keyword">import</span> kafka.consumer.ConsumerIterator;</span><br><span class="line"><span class="keyword">import</span> kafka.consumer.KafkaStream;</span><br><span class="line"><span class="keyword">import</span> kafka.producer.KeyedMessage$;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> kafka.javaapi.producer.Producer;</span><br><span class="line"><span class="keyword">import</span> kafka.producer.KeyedMessage;</span><br><span class="line"><span class="keyword">import</span> kafka.producer.ProducerConfig;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestProducer</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿</span><br><span class="line">    <span class="comment">// å‘é€æ¶ˆæ¯ producer</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSend</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        Properties props = <span class="keyword">new</span> Properties();</span><br><span class="line">        <span class="comment">// brokeråˆ—è¡¨</span></span><br><span class="line">        props.put(<span class="string">"metadata.broker.list"</span>,<span class="string">"cs2:9092"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä¸²è¡ŒåŒ–</span></span><br><span class="line">        props.put(<span class="string">"serializer.class"</span>, <span class="string">"kafka.serializer.StringEncoder"</span>);</span><br><span class="line">        props.put(<span class="string">"request.required.acks"</span>, <span class="string">"1"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ›å»ºç”Ÿäº§è€…é…ç½®å¯¹è±¡</span></span><br><span class="line">        ProducerConfig config = <span class="keyword">new</span> ProducerConfig(props);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ›å»ºç”Ÿäº§è€…</span></span><br><span class="line">        Producer&lt;String, String&gt; producer = <span class="keyword">new</span> Producer&lt;String, String&gt;(config);</span><br><span class="line"></span><br><span class="line">        KeyedMessage&lt;String, String&gt; msg = <span class="keyword">new</span> KeyedMessage&lt;String, String&gt;(<span class="string">"test2"</span>, <span class="string">"100"</span>, <span class="string">"hello word fuck you kafka"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å‘é€</span></span><br><span class="line">        producer.send(msg);</span><br><span class="line">        System.out.println(<span class="string">"å‘é€å®Œæˆ"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿</span><br><span class="line">    <span class="comment">// æ¥æ”¶æ¶ˆæ¯ consumer</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testConsumer</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        Properties props = <span class="keyword">new</span> Properties();</span><br><span class="line">        props.put(<span class="string">"zookeeper.connect"</span>, <span class="string">"cs2:2181"</span>);</span><br><span class="line">        props.put(<span class="string">"group.id"</span>, <span class="string">"g2"</span>);</span><br><span class="line">        props.put(<span class="string">"zookeeper.session.timeout.ms"</span>, <span class="string">"500"</span>);</span><br><span class="line">        props.put(<span class="string">"auto.commit.interval.ms"</span>, <span class="string">"1000"</span>);</span><br><span class="line">        props.put(<span class="string">"auto.offset.reset"</span>, <span class="string">"smallest"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºæ¶ˆè´¹è€…é…ç½®å¯¹è±¡</span></span><br><span class="line">        ConsumerConfig config = <span class="keyword">new</span> ConsumerConfig(props);</span><br><span class="line"></span><br><span class="line">        Map&lt;String, Integer&gt; map = <span class="keyword">new</span> HashMap&lt;String, Integer&gt;();</span><br><span class="line">        map.put(<span class="string">"test2"</span>, <span class="keyword">new</span> Integer(<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">        Map&lt;String, List&lt;KafkaStream&lt;<span class="keyword">byte</span>[], <span class="keyword">byte</span>[]&gt;&gt;&gt; msgs = Consumer.createJavaConsumerConnector(<span class="keyword">new</span> ConsumerConfig(props)).createMessageStreams(map);</span><br><span class="line">        List&lt;KafkaStream&lt;<span class="keyword">byte</span>[], <span class="keyword">byte</span>[]&gt;&gt; msgList = msgs.get(<span class="string">"test2"</span>);</span><br><span class="line">        <span class="keyword">for</span>(KafkaStream&lt;<span class="keyword">byte</span>[],<span class="keyword">byte</span>[]&gt; stream : msgList)&#123;</span><br><span class="line">            ConsumerIterator&lt;<span class="keyword">byte</span>[],<span class="keyword">byte</span>[]&gt; it = stream.iterator();</span><br><span class="line">            <span class="keyword">while</span>(it.hasNext())&#123;</span><br><span class="line">                <span class="keyword">byte</span>[] message = it.next().message();</span><br><span class="line">                System.out.println(<span class="keyword">new</span> String(message));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="5-2-æ–°çš„-API"><a href="#5-2-æ–°çš„-API" class="headerlink" title="5.2 æ–°çš„ API"></a>5.2 æ–°çš„ API</h4><h2 id="6-Flume-é›†æˆ-kafak"><a href="#6-Flume-é›†æˆ-kafak" class="headerlink" title="6.Flume é›†æˆ kafak"></a>6.Flume é›†æˆ kafak</h2><h4 id="6-1KafkaSink"><a href="#6-1KafkaSink" class="headerlink" title="6.1KafkaSink"></a>6.1KafkaSink</h4><p><strong>kafka æ˜¯ consumer (æ¶ˆè´¹è€…)</strong></p><p><strong>flume çš„æ¶ˆæ¯, ç»ç”± kafkaSink å¯¼å‡ºåˆ° kafka â€“æœ€å¸¸ç”¨</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">[flume ä¸ºç”Ÿäº§è€…]</span><br><span class="line">1.1) flume å‚æ•°é…ç½® </span><br><span class="line">----------------------------------------------------</span><br><span class="line">    a1.sources = r1</span><br><span class="line">    a1.sinks = k1</span><br><span class="line">    a1.channels = c1</span><br><span class="line"></span><br><span class="line">    a1.sources.r1.type=netcat</span><br><span class="line">    a1.sources.r1.bind=localhost</span><br><span class="line">    a1.sources.r1.port=8888</span><br><span class="line"></span><br><span class="line">    a1.sinks.k1.type = org.apache.flume.sink.kafka.KafkaSink</span><br><span class="line">    a1.sinks.k1.kafka.topic = test3</span><br><span class="line">    a1.sinks.k1.kafka.bootstrap.servers = cs2:9092</span><br><span class="line">    a1.sinks.k1.kafka.flumeBatchSize = 20</span><br><span class="line">    a1.sinks.k1.kafka.producer.acks = 1</span><br><span class="line"></span><br><span class="line">    a1.channels.c1.type=memory</span><br><span class="line"></span><br><span class="line">    a1.sources.r1.channels = c1</span><br><span class="line">    a1.sinks.k1.channel = c1</span><br><span class="line"></span><br><span class="line">1.2) å¼€å¯ kafka æ¶ˆè´¹è€…</span><br><span class="line">----------------------------------------------------</span><br><span class="line">    kafka-console-consumer.sh --bootstrap-server cs2:9092 --topic test3 --from-beginning</span><br><span class="line">    æ³¨æ„ :  Consider using the new consumer by passing [bootstrap-server] instead of [zookeeper]. </span><br><span class="line">    ä½¿ç”¨ [bootstrap-server]ä»£æ›¿[zookeeper]</span><br><span class="line"></span><br><span class="line">1.3) flume æ‰§è¡Œ kafka_sink.conf </span><br><span class="line">----------------------------------------------------</span><br><span class="line">flume-ng agent -f apps/flume/conf/confs/kafka_sink.conf -n a1</span><br><span class="line"></span><br><span class="line">1.4) éªŒè¯ç«¯å£</span><br><span class="line">----------------------------------------------------</span><br><span class="line">    netstat -anop | grep 8888  </span><br><span class="line">    [OR]</span><br><span class="line">    lsof -i tcp:8888</span><br><span class="line"></span><br><span class="line">1.5) nc è¿æ¥</span><br><span class="line">----------------------------------------------------</span><br><span class="line">    nc localhost 8888</span><br><span class="line">    å‘æ¶ˆæ¯....</span><br><span class="line"></span><br><span class="line">1.6) è§‚å¯Ÿ kafka æ¶ˆè´¹è€…æ¥å—æ¶ˆæ¯</span><br><span class="line">----------------------------------------------------</span><br><span class="line">å‘ç°ç‰¹åˆ«å¿«!</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">========================================================</span><br><span class="line">ç®€å•æ¡ˆä¾‹2</span><br><span class="line">--------------</span><br><span class="line">a1.sources = r1</span><br><span class="line">a1.sinks = k1</span><br><span class="line">a1.channels = c1</span><br><span class="line"></span><br><span class="line">a1.sources.r1.type=<span class="built_in">exec</span></span><br><span class="line"><span class="comment">#-F æœ€å10è¡Œ,å¦‚æœä»å¤´å¼€å§‹æ”¶é›† -c +0 -F:æŒç»­æ”¶é›†åç»­æ•°æ®,å¦åˆ™è¿›ç¨‹åœæ­¢ã€‚</span></span><br><span class="line">a1.sources.r1.command=tail -F -c +0  /home/ap/calllog/calllog.log</span><br><span class="line"></span><br><span class="line">a1.channels.c1.type=memory</span><br><span class="line"></span><br><span class="line">a1.sinks.k1.type = org.apache.flume.sink.kafka.KafkaSink</span><br><span class="line">a1.sinks.k1.kafka.topic = calllog</span><br><span class="line">a1.sinks.k1.kafka.bootstrap.servers = cs2:9092 cs3:9092 cs4:9092</span><br><span class="line"></span><br><span class="line"><span class="comment"># How many messages to process in one batch. Larger batches improve throughput while adding latency.</span></span><br><span class="line">a1.sinks.k1.kafka.flumeBatchSize = 20</span><br><span class="line"></span><br><span class="line"><span class="comment"># How many replicas must acknowledge a message before its considered successfully written. Accepted values are 0 (Never wait for acknowledgement), 1 (wait for leader only), -1 (wait for all replicas) Set this to -1 to avoid data loss in some cases of leader failure.</span></span><br><span class="line">a1.sinks.k1.kafka.producer.acks = 1</span><br><span class="line"></span><br><span class="line">a1.sources.r1.channels = c1</span><br><span class="line">a1.sinks.k1.channel = c1</span><br></pre></td></tr></table></figure><h4 id="6-2-KafkaSource-TODO"><a href="#6-2-KafkaSource-TODO" class="headerlink" title="6.2 KafkaSource :TODO"></a>6.2 KafkaSource :TODO</h4><p><strong>flume source ä» kafka æŠ“æ•°æ®, flume source æ˜¯æ¶ˆè´¹è€…,  kafka å¼€å¯ producer.</strong> </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[æ¶ˆè´¹è€…]</span><br><span class="line">1) é…ç½®</span><br><span class="line">    a1.sources = r1</span><br><span class="line">    a1.sinks = k1</span><br><span class="line">    a1.channels = c1</span><br><span class="line"></span><br><span class="line">    a1.sources.r1.type = org.apache.flume.source.kafka.KafkaSource</span><br><span class="line">    a1.sources.r1.batchSize = 5000</span><br><span class="line">    a1.sources.r1.batchDurationMillis = 2000</span><br><span class="line">    a1.sources.r1.kafka.bootstrap.servers =  cs2:9092</span><br><span class="line">    a1.sources.r1.kafka.topics = test3</span><br><span class="line">    a1.sources.r1.kafka.consumer.group.id = g4</span><br><span class="line"></span><br><span class="line">    a1.sinks.k1.type = logger</span><br><span class="line"></span><br><span class="line">    a1.channels.c1.type=memory</span><br><span class="line"></span><br><span class="line">    a1.sources.r1.channels = c1</span><br><span class="line">    a1.sinks.k1.channel = c1</span><br><span class="line"></span><br><span class="line">2) å¯åŠ¨ flume </span><br><span class="line">    flume-ng agent -f /home/ap/apps/flume/conf/confs/kafka_source.conf -n a1 -Dflume.root.logger=INFO,console</span><br><span class="line"></span><br><span class="line">3) å¯åŠ¨ kafka producer</span><br><span class="line">kafka-console-producer.sh --broker-list cs2:9092 --topic test3 </span><br><span class="line"></span><br><span class="line">4) kafka å‘æ¶ˆæ¯:  æ”¶ä¸åˆ°!!!!  :TODO</span><br></pre></td></tr></table></figure><h4 id="6-3-KafkaChannel-TODO"><a href="#6-3-KafkaChannel-TODO" class="headerlink" title="6.3 KafkaChannel  :TODO"></a>6.3 KafkaChannel  :TODO</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">:TODO  ä¹Ÿå‡ºé”™ ?? </span><br><span class="line">    è¶Šç•Œ</span><br><span class="line">            ç”Ÿäº§è€… + æ¶ˆè´¹è€…</span><br><span class="line">    a1.sources = r1</span><br><span class="line">    a1.sinks = k1</span><br><span class="line">    a1.channels = c1</span><br><span class="line"></span><br><span class="line">    a1.sources.r1.type = avro</span><br><span class="line">    a1.sources.r1.bind = localhost</span><br><span class="line">    a1.sources.r1.port = 8888</span><br><span class="line"></span><br><span class="line">    a1.sinks.k1.type = logger</span><br><span class="line"></span><br><span class="line">    a1.channels.c1.type = org.apache.flume.channel.kafka.KafkaChannel</span><br><span class="line">    a1.channels.c1.kafka.bootstrap.servers = cs2:9092</span><br><span class="line">    a1.channels.c1.kafka.topic = test3</span><br><span class="line">    a1.channels.c1.kafka.consumer.group.id = g6</span><br><span class="line">    a1.channels.c1.kafka.parseAsFlumeEvent = <span class="literal">false</span></span><br><span class="line">    a1.channels.c1.zookeeperConnect= cs2:2181</span><br><span class="line"></span><br><span class="line">    a1.sources.r1.channels = c1</span><br><span class="line">    a1.sinks.k1.channel = c1</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;1-æ¦‚è§ˆ&quot;&gt;&lt;a href=&quot;#1-æ¦‚è§ˆ&quot; class=&quot;headerlink&quot; title=&quot;1.æ¦‚è§ˆ&quot;&gt;&lt;/a&gt;1.æ¦‚è§ˆ&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;åˆ†å¸ƒå¼æµå¤„ç†å¹³å°ã€‚&lt;/strong&gt; &lt;/p&gt;
&lt;p&gt;åˆ†å¸ƒå¼, å‰¯æœ¬, å®¹é”™çš„åˆ†å¸ƒå¼å­˜å‚¨æµ.&lt;/p&gt;
&lt;p&gt;
      
    
    </summary>
    
      <category term="Hadoop" scheme="https://airpoet.github.io/categories/Hadoop/"/>
    
      <category term="Kafka" scheme="https://airpoet.github.io/categories/Hadoop/Kafka/"/>
    
    
      <category term="åŸåˆ›" scheme="https://airpoet.github.io/tags/%E5%8E%9F%E5%88%9B/"/>
    
      <category term="æŠ€æœ¯" scheme="https://airpoet.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="Hadoop" scheme="https://airpoet.github.io/tags/Hadoop/"/>
    
      <category term="Kafka" scheme="https://airpoet.github.io/tags/Kafka/"/>
    
  </entry>
  
  <entry>
    <title>Flume</title>
    <link href="https://airpoet.github.io/2018/06/30/Hadoop/7-Flume&amp;Kafka/Flume/"/>
    <id>https://airpoet.github.io/2018/06/30/Hadoop/7-Flume&amp;Kafka/Flume/</id>
    <published>2018-06-30T13:32:24.747Z</published>
    <updated>2018-07-02T13:44:40.969Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-Flume-æ¦‚å¿µ"><a href="#1-Flume-æ¦‚å¿µ" class="headerlink" title="1.Flume æ¦‚å¿µ"></a>1.Flume æ¦‚å¿µ</h2><p>æä¾› <strong>æ”¶é›†ã€ç§»åŠ¨ã€èšåˆå¤§é‡æ—¥å¿—æ•°æ®</strong>çš„æœåŠ¡ã€‚ </p><p>åŸºäºæµæ•°æ®çš„æ¶æ„ï¼Œç”¨äºåœ¨çº¿æ—¥å¿—åˆ†æã€‚ </p><p>åŸºäºäº‹ä»¶ã€‚ </p><p>åœ¨ç”Ÿäº§å’Œæ¶ˆè´¹è€…ä¹‹é—´å¯åŠ¨åè°ƒä½œç”¨ã€‚ </p><p>æä¾›äº†äº‹åŠ¡ä¿è¯ï¼Œç¡®ä¿æ¶ˆæ¯ä¸€å®šè¢«åˆ†å‘ã€‚ </p><p>å¤šç§ <code>Source</code>, <code>Channel</code>, <code>Sink</code>é…ç½®æ–¹å¼ã€‚ </p><p><strong>ä¸ Sqoop åŒºåˆ«</strong></p><ul><li>Sqoop ç”¨æ¥é‡‡é›†å…³ç³»å‹æ•°æ®åº“æ•°æ®</li><li>Flume ç”¨ æ¥é‡‡é›†æµåŠ¨å‹æ•°æ®ã€‚ </li></ul><p><strong>å…³é”®è¯è§£é‡Š</strong></p><ul><li><p><strong>Client</strong> </p><ul><li>Client æ˜¯ä¸€ä¸ª<strong>å°†åŸå§‹ log åŒ…è£…æˆ events</strong> å¹¶ä¸”å‘é€ä»–ä»¬åˆ°ä¸€ä¸ªæˆ–å¤šä¸ª agent çš„å®ä½“, äº¤ç»™ source å¤„ç†</li></ul></li><li><p><strong>Event</strong></p><ul><li>Event ç”±å¯é€‰çš„ header å’Œè½½æœ‰æ•°æ®çš„ä¸€ä¸ª byte array æ„æˆã€‚ </li></ul></li><li><p><strong>Source</strong></p><ul><li>æ¥å—æ•°æ®ï¼Œç±»å‹æœ‰å¤šç§ã€‚</li></ul></li><li><strong>Channel</strong><ul><li>ä¸´æ—¶å­˜æ”¾åœ°ï¼Œå¯¹Sourceä¸­æ¥çš„æ•°æ®è¿›è¡Œç¼“å†²ï¼Œç›´åˆ°sinkæ¶ˆè´¹æ‰ã€‚</li></ul></li><li><strong>Sink</strong><ul><li>ä»channelæå–æ•°æ®å­˜æ”¾åˆ°ä¸­å¤®åŒ–å­˜å‚¨(hadoop / hbase)ã€‚</li></ul></li><li><strong>Iterator</strong><ul><li>ä½œç”¨äº Sourceï¼ŒæŒ‰ç…§é¢„è®¾çš„é¡ºåºåœ¨å¿…è¦åœ°æ–¹è£…é¥°å’Œè¿‡æ»¤ </li></ul></li><li><strong>events Channel Selector</strong><ul><li>å…è®¸ Source åŸºäºé¢„è®¾çš„æ ‡å‡†ï¼Œä»æ‰€æœ‰ channel ä¸­ï¼Œé€‰æ‹©ä¸€ä¸ªæˆ–è€…å¤šä¸ª channel</li></ul></li></ul><p><strong>A simple Flume agent with one source, channel, and sink</strong></p><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-30-143349.png" alt="image-20180630223348497"></p><p><strong>Source ==&gt;Channel </strong></p><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-30-142908.png" alt="image-20180630222908165"></p><p><strong>Channel</strong></p><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-30-142944.png" alt="image-20180630222943933"></p><hr><p>Flume çš„æ•°æ®æµç”±äº‹ä»¶(Event)è´¯ç©¿å§‹ç»ˆã€‚<strong>äº‹ä»¶æ˜¯ Flume çš„åŸºæœ¬æ•°æ®å•ä½</strong>ï¼Œå®ƒæºå¸¦æ—¥å¿—æ•°æ®(å­— èŠ‚æ•°ç»„å½¢å¼)å¹¶ä¸”æºå¸¦æœ‰å¤´ä¿¡æ¯ï¼Œè¿™äº› Event ç”± Agent å¤–éƒ¨çš„ Source ç”Ÿæˆï¼Œå½“ Source æ•è·äº‹ ä»¶åä¼šè¿›è¡Œç‰¹å®šçš„æ ¼å¼åŒ–ï¼Œç„¶å Source ä¼šæŠŠäº‹ä»¶æ¨å…¥(å•ä¸ªæˆ–å¤šä¸ª)Channel ä¸­ã€‚ä½ å¯ä»¥æŠŠ Channel çœ‹ä½œæ˜¯ä¸€ä¸ªç¼“å†²åŒºï¼Œå®ƒå°†ä¿å­˜äº‹ä»¶ç›´åˆ° Sink å¤„ç†å®Œè¯¥äº‹ä»¶ã€‚Sink è´Ÿè´£æŒä¹…åŒ–æ—¥å¿—æˆ– è€…æŠŠäº‹ä»¶æ¨å‘å¦ä¸€ä¸ª Sourceã€‚</p><p>Flume ä»¥ agent ä¸ºæœ€å°çš„ç‹¬ç«‹è¿è¡Œå•ä½ã€‚<strong>ä¸€ä¸ª agent å°±æ˜¯ä¸€ä¸ª JVM</strong>ã€‚å• agent ç”± Sourceã€Sink å’Œ Channel ä¸‰å¤§ç»„ä»¶æ„æˆï¼Œå¦‚ä¸‹å›¾:</p><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-07-02-020612.png" alt="image-20180702100612437"></p><p><a href="https://app.yinxiang.com/shard/s37/nl/7399077/e762aaa0-8e96-4539-ad5f-3c260ec697b2/" target="_blank" rel="noopener">å‚è€ƒæ–‡æ¡£</a></p><h2 id="2-å®‰è£…-Flume"><a href="#2-å®‰è£…-Flume" class="headerlink" title="2.å®‰è£… Flume"></a>2.å®‰è£… Flume</h2><h4 id="1-ä¸‹è½½"><a href="#1-ä¸‹è½½" class="headerlink" title="1.ä¸‹è½½"></a>1.ä¸‹è½½</h4><h4 id="2-tar"><a href="#2-tar" class="headerlink" title="2.tar"></a>2.tar</h4><h4 id="3-ç¯å¢ƒå˜é‡"><a href="#3-ç¯å¢ƒå˜é‡" class="headerlink" title="3.ç¯å¢ƒå˜é‡"></a>3.ç¯å¢ƒå˜é‡</h4><p><strong>æ³¨æ„</strong>: é…ç½®çš„è¯, ä½¿ç”¨è„šæœ¬å°±æ–¹ä¾¿äº›,  ä½†æ˜¯å¦‚æœé…ç½®æ–‡ä»¶åœ¨ flume æ–‡ä»¶å¤¹ä¸­, è·¯å¾„å°±æ¯”è¾ƒé•¿</p><p>â€‹     ä¸é…ç½®çš„è¯, è¦è¿›å…¥åˆ°flume è·¯å¾„ä¸‹ä½¿ç”¨, ä½†æ˜¯æ­¤æ—¶é…ç½®æ–‡ä»¶çš„è·¯å¾„å°±æ¯”è¾ƒçŸ­äº†</p><p><strong>PS</strong>: å¦‚æœ<code>.sh</code>æ–‡ä»¶æ²¡æœ‰æ‰§è¡Œæƒé™, å³<code>x</code>æƒé™,  è¦ç”¨ç›¸å¯¹è·¯å¾„æ¥å¯åŠ¨, å³å¦‚æœåœ¨ bin ç›®å½•, è¦ç”¨<code>./flume-ng</code>, åœ¨ bin å¤–,è¦ç”¨ <code>bin/flume</code>æ‰§è¡Œ, æœ‰<code>x</code>æƒé™çš„è¯,  å°±å¯ä»¥ç›´æ¥åœ¨ bin ä¸‹, ä½¿ç”¨  <code>flume-ng</code>, å¦‚æœé…ç½®äº†ç¯å¢ƒå˜é‡, å¯ä»¥åœ¨ä»»ä½•è·¯å¾„ä¸‹ä½¿ç”¨  <code>flume-ng</code>äº†.</p><ul><li><p>Open <strong><code>flume-env.sh</code></strong> file and <strong>set the <code>JAVA_Home</code></strong> to the folder where Java was installed in your system.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/<span class="built_in">local</span>/jdk1.8.0_73</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>In the <strong><code>.zshrc</code></strong> file, set <strong>FLUME_HOME</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#flume</span></span><br><span class="line"><span class="built_in">export</span> FLUME_HOME=/home/ap/apps/flume</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$FLUME_HOME</span>/bin</span><br><span class="line">---</span><br><span class="line"><span class="built_in">source</span> .zshrc</span><br></pre></td></tr></table></figure></li></ul><h4 id="4-éªŒè¯"><a href="#4-éªŒè¯" class="headerlink" title="4.éªŒè¯"></a>4.éªŒè¯</h4><pre><code>` $&gt; flume-ng version`            //next generation.ä¸‹ä¸€ä»£.</code></pre><hr><h2 id="3-é…ç½®flumeå‡†å¤‡å·¥ä½œ"><a href="#3-é…ç½®flumeå‡†å¤‡å·¥ä½œ" class="headerlink" title="3.é…ç½®flumeå‡†å¤‡å·¥ä½œ"></a>3.é…ç½®flumeå‡†å¤‡å·¥ä½œ</h2><h4 id="3-0å¦‚æœ-yum-æ²¡æœ‰è®¾ç½®ç½‘ç»œæºçš„-è®¾ç½®ä¸€ä¸‹-é˜¿é‡Œ-ç½‘æ˜“"><a href="#3-0å¦‚æœ-yum-æ²¡æœ‰è®¾ç½®ç½‘ç»œæºçš„-è®¾ç½®ä¸€ä¸‹-é˜¿é‡Œ-ç½‘æ˜“" class="headerlink" title="3.0å¦‚æœ yum æ²¡æœ‰è®¾ç½®ç½‘ç»œæºçš„, è®¾ç½®ä¸€ä¸‹ é˜¿é‡Œ | ç½‘æ˜“"></a>3.0<strong>å¦‚æœ yum æ²¡æœ‰è®¾ç½®ç½‘ç»œæºçš„, è®¾ç½®ä¸€ä¸‹ é˜¿é‡Œ | ç½‘æ˜“</strong></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…ˆå¤‡ä»½åŸæ¥çš„ CentOS-Base.repo ä¸º CentOS-Base.repo.bak</span></span><br><span class="line">mv CentOS-Base.repo CentOS-Base.repo.bak</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‹è½½é˜¿é‡ŒåŸºæœ¬æº </span></span><br><span class="line">$&gt;sudo wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‹è½½é˜¿é‡Œepelæº</span></span><br><span class="line">$&gt;sudo wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿæˆç¼“å­˜æ–‡ä»¶</span></span><br><span class="line">$&gt;sudo yum clean all</span><br><span class="line">$&gt;sudo yum makecache</span><br></pre></td></tr></table></figure><h5 id="3-1-æ‰€æœ‰æœºå™¨å®‰è£…-nc-æˆ–è€…-telnet"><a href="#3-1-æ‰€æœ‰æœºå™¨å®‰è£…-nc-æˆ–è€…-telnet" class="headerlink" title="3.1 æ‰€æœ‰æœºå™¨å®‰è£… nc æˆ–è€… telnet"></a>3.1 æ‰€æœ‰æœºå™¨å®‰è£… nc æˆ–è€… telnet</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$&gt;yum search nc</span><br><span class="line">$&gt; xcall.sh sudo yum install -y nc.x86_64</span><br><span class="line">$&gt; xcall.sh sudo yum install -y telnet</span><br></pre></td></tr></table></figure><h5 id="3-2-ä½¿ç”¨-nc"><a href="#3-2-ä½¿ç”¨-nc" class="headerlink" title="3.2 ä½¿ç”¨ nc"></a>3.2 ä½¿ç”¨ nc</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cs1_1&gt; nc -lk 8888  : å¼€å¯8888ç«¯å£ç›‘å¬</span><br><span class="line">-------</span><br><span class="line">å†å¼€ä¸€ä¸ªcs1 session</span><br><span class="line">cs1_2&gt; netstat -anop | grep 8888 :  æŸ¥çœ‹æ˜¯æœ‰æœ‰æ­¤ç«¯å£</span><br><span class="line">æˆ–è€…  &gt;  lsof -i tcp:8888       : å¯ä»¥ç›´æ¥çœ‹åˆ° pid</span><br><span class="line">tcp        0      0 0.0.0.0:8888                0.0.0.0:*                   LISTEN      17251/nc            off (0.00/0/0)</span><br><span class="line">---------</span><br><span class="line">æœ‰çš„è¯å°±å¯ä»¥æµ‹è¯•è¿æ¥äº† (å®¢æˆ·ç«¯è¿æ¥)</span><br><span class="line">cs1_2&gt; nc localhost 8888 </span><br><span class="line"></span><br><span class="line">==================</span><br><span class="line">telnet ä½¿ç”¨æ–¹å¼ç±»ä¼¼, å¯æŸ¥çœ‹å¸®åŠ©</span><br></pre></td></tr></table></figure><h2 id="4-flumeé…ç½®"><a href="#4-flumeé…ç½®" class="headerlink" title="4. flumeé…ç½®"></a>4. flumeé…ç½®</h2><p><a href="http://flume.apache.org/FlumeUserGuide.html" target="_blank" rel="noopener"><strong>å®˜æ–¹æ–‡æ¡£</strong></a></p><h4 id="æ€»ä½“æ¦‚è¿°"><a href="#æ€»ä½“æ¦‚è¿°" class="headerlink" title="æ€»ä½“æ¦‚è¿°"></a><strong>æ€»ä½“æ¦‚è¿°</strong></h4><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-07-02-021156.png" alt="image-20180702101155514"></p><h4 id="å®æ—¶å¤„ç†æ¶æ„"><a href="#å®æ—¶å¤„ç†æ¶æ„" class="headerlink" title="å®æ—¶å¤„ç†æ¶æ„"></a>å®æ—¶å¤„ç†æ¶æ„</h4><p><strong>flume:</strong> ç›‘æ§æ—¥å¿—æ–‡ä»¶</p><ul><li>æ¯æ¬¡äº§ç”Ÿä¸€æ¡æ–°çš„æ•°æ®, ä¼šè¢«å®æ—¶çš„æ”¶é›†åˆ°ä¸‹ä¸€è·³</li></ul><p><strong>Kafka:</strong> æ¶ˆæ¯ç³»ç»Ÿ</p><ul><li>å¯¹æ¶ˆæ¯è¿›è¡Œç®€å•å¤„ç†, å½“ç„¶, å…·æœ‰ç®€å•ç¼“å†²ä½œç”¨</li></ul><p><strong>Storm / SparkStreaming</strong>:</p><ul><li>æµå¼çš„åˆ†å¸ƒå¼è®¡ç®—å¼•æ“</li></ul><p><strong>Redis:</strong> ç¼“å­˜ç»„ä»¶</p><ul><li>å†…å­˜æ•°æ®åº“</li></ul><p><strong>Hbase / HDFS /ES â€¦</strong>: </p><ul><li>æœ€åæŒä¹…åŒ–åˆ°è¿™äº›åœ°æ–¹..</li></ul><h3 id="4-1-Flume-Source"><a href="#4-1-Flume-Source" class="headerlink" title="4.1  Flume Source"></a>4.1  Flume Source</h3><p><strong>æ³¨æ„:</strong> å¯åŠ¨ flume é…ç½®çš„æ—¶å€™, åé¢åŠ ä¸Š <strong><code>-Dflume.root.logger=INFO,console</code></strong></p><p>è¿˜æœ‰ä¸€ç§<strong>æ›´è¯¦ç»†çš„</strong> <strong>: <code>-Dflume.root.logger=DEBUG,console</code></strong></p><p>ä¼š<strong>æ‰“å°æ›´è¯¦ç»†çš„æ—¥å¿—</strong></p><h4 id="4-1-1-netcat"><a href="#4-1-1-netcat" class="headerlink" title="4.1.1 netcat"></a>4.1.1 netcat</h4><p><strong>é€šè¿‡æ¶ˆæ¯é€šä¿¡çš„æ–¹å¼, è¿›è¡Œé‡‡é›†</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">1.åˆ›å»ºé…ç½®æ–‡ä»¶</span><br><span class="line">   [/soft/flume/conf/helloworld.conf]</span><br><span class="line">   <span class="comment">#å£°æ˜ä¸‰ç§ç»„ä»¶</span></span><br><span class="line">   a1.sources = r1</span><br><span class="line">   a1.channels = c1</span><br><span class="line">   a1.sinks = k1</span><br><span class="line"></span><br><span class="line">   <span class="comment">#å®šä¹‰sourceä¿¡æ¯</span></span><br><span class="line">   a1.sources.r1.type=netcat</span><br><span class="line">   a1.sources.r1.bind=localhost</span><br><span class="line">   a1.sources.r1.port=8888</span><br><span class="line"></span><br><span class="line">   <span class="comment">#å®šä¹‰sinkä¿¡æ¯</span></span><br><span class="line">   a1.sinks.k1.type=logger</span><br><span class="line"></span><br><span class="line">   <span class="comment">#å®šä¹‰channelä¿¡æ¯</span></span><br><span class="line">   a1.channels.c1.type=memory</span><br><span class="line"></span><br><span class="line">   <span class="comment">#ç»‘å®šåœ¨ä¸€èµ·</span></span><br><span class="line">   ps: æ³¨æ„:  ä¸€ä¸ª<span class="built_in">source</span>(æº) å¯ä»¥è¾“å‡ºåˆ°å¤šä¸ª channels(é€šé“)</span><br><span class="line">                   ä¸€ä¸ªsink(æ²‰æ¼•)åªèƒ½ä»ä¸€ä¸ª channel(é€šé“)ä¸­è·å–æ•°æ®</span><br><span class="line"></span><br><span class="line">   a1.sources.r1.channels=c1</span><br><span class="line">   a1.sinks.k1.channel=c1</span><br><span class="line"></span><br><span class="line">   2.è¿è¡Œ</span><br><span class="line">       a)å¯åŠ¨flume agent</span><br><span class="line">           $&gt; bin/flume-ng agent -f  conf/helloworld.conf -n a1 -Dflume.root.logger=INFO,console</span><br><span class="line">       b)å¯åŠ¨ncçš„å®¢æˆ·ç«¯</span><br><span class="line">           $&gt;nc localhost 8888</span><br><span class="line">           <span class="variable">$nc</span>&gt;hello world</span><br><span class="line">       </span><br><span class="line">       c)åœ¨flumeçš„ç»ˆç«¯è¾“å‡ºhello world.</span><br></pre></td></tr></table></figure><h4 id="4-1-2-exec"><a href="#4-1-2-exec" class="headerlink" title="4.1.2  exec"></a>4.1.2  exec</h4><p><strong>å®æ—¶æ—¥å¿—æ”¶é›†,å®æ—¶æ”¶é›†æ—¥å¿—ã€‚</strong></p><p><strong>æµ‹è¯•:</strong> </p><ol><li><p>å…ˆå¯åŠ¨ç›‘æ§, å†åˆ›å»ºæ–‡ä»¶, èƒ½å¦ç›‘æ§åˆ° </p><p>ç»“è®º: å¯ä»¥ç›‘æ§åˆ°</p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">1. é…ç½®</span><br><span class="line">    <span class="comment"># å£°æ˜3ç§ç»„ä»¶</span></span><br><span class="line">    a1.sources=r1</span><br><span class="line">    a1.channels=c1</span><br><span class="line">    a1.sinks=k1</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å®šä¹‰ source ä¿¡æ¯</span></span><br><span class="line">    a1.sources.r1.type=<span class="built_in">exec</span></span><br><span class="line">    a1.sources.r1.command=tail -F /home/ap/test.txt   <span class="comment">#æ”¶é›†æœ€åçš„10è¡Œ</span></span><br><span class="line">    a1.sources.r1.command=tail -F -c +0 /home/ap/test.txt <span class="comment">#ä»ç¬¬0è¡Œå¼€å§‹æ”¶é›†</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># å®šä¹‰ sink ä¿¡æ¯</span></span><br><span class="line">    a1.sinks.k1.type=logger</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å®šä¹‰ channel ä¿¡æ¯</span></span><br><span class="line">    a1.channels.c1.type=memory</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ç»‘å®šåœ¨ä¸€èµ·</span></span><br><span class="line">    a1.sources.r1.channels=c1</span><br><span class="line">    a1.sinks.k1.channel=c1</span><br><span class="line"></span><br><span class="line">2&gt; æ–°å»ºæ–‡ä»¶ test.txt</span><br><span class="line"></span><br><span class="line">3&gt; å¯åŠ¨</span><br><span class="line">[ap@cs1]~% flume-ng agent -f apps/flume/conf/confs/exec.conf -n a1 -Dflume.root.logger=INFO,console</span><br><span class="line"></span><br><span class="line">4&gt; ä¿®æ”¹ test.txt æ–‡ä»¶</span><br><span class="line">$&gt;  <span class="built_in">echo</span> ddd &gt; test.txt   è§‚å¯Ÿ agent æ§åˆ¶å°å˜åŒ–</span><br></pre></td></tr></table></figure><h4 id="4-1-3-æ‰¹é‡æ”¶é›†-spool"><a href="#4-1-3-æ‰¹é‡æ”¶é›†-spool" class="headerlink" title="4.1.3 æ‰¹é‡æ”¶é›†(spool)"></a>4.1.3 æ‰¹é‡æ”¶é›†(spool)</h4><p><strong>ç›‘æ§ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œé™æ€æ–‡ä»¶ã€‚</strong> </p><p><strong>æ–‡ä»¶æœ€å¥½æ˜¯ç›´æ¥ä»å¤–éƒ¨ç§»å…¥</strong>, æ–‡ä»¶å¤¹å†…æœ€å¥½ä¸è¦åšæ–‡ä»¶ç¼–è¾‘ã€‚ </p><p><strong>æ”¶é›†å®Œä¹‹åï¼Œä¼šé‡å‘½åæ–‡ä»¶æˆæ–°æ–‡ä»¶ã€‚.compeleted.</strong> </p><p><strong>ä¹‹åå°±ä¸ä¼šå†æ¬¡å¤„ç†è¿™ä¸ªæ–‡ä»¶äº†.</strong></p><p><strong>åªä¼šç›‘æ§æ–°å¢åŠ çš„æ–‡ä»¶, ä¸ä¼šç›‘æ§åˆ é™¤çš„æœ¬åœ°æ–‡ä»¶.</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">a) é…ç½®</span><br><span class="line">    <span class="comment"># å£°æ˜3ç§ç»„ä»¶</span></span><br><span class="line">    a1.sources=r1</span><br><span class="line">    a1.channels=c1</span><br><span class="line">    a1.sinks=k1</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å®šä¹‰ source ä¿¡æ¯</span></span><br><span class="line">    a1.sources.r1.type=spooldir</span><br><span class="line">    a1.sources.r1.spoolDir=/home/ap/spool</span><br><span class="line">    a1.sources.r1.fileHeader=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># å®šä¹‰ sink ä¿¡æ¯</span></span><br><span class="line">    a1.sinks.k1.type=logger</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å®šä¹‰ channel ä¿¡æ¯</span></span><br><span class="line">    a1.channels.c1.type=memory</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ç»‘å®šåœ¨ä¸€èµ·</span></span><br><span class="line">    a1.sources.r1.channels=c1</span><br><span class="line">    a1.sinks.k1.channel=c1</span><br><span class="line"></span><br><span class="line">b)åˆ›å»ºç›®å½•</span><br><span class="line">$&gt;mkdir ~/spool</span><br><span class="line"></span><br><span class="line">c)å¯åŠ¨flume</span><br><span class="line">å¯ä»¥ç›´æ¥å¯åŠ¨</span><br><span class="line">$&gt;flume-ng agent -f apps/flume/conf/confs/spool.conf -n a1 -Dflume.root.logger=INFO,console</span><br></pre></td></tr></table></figure><h4 id="4-1-4-åºåˆ—sources-seq"><a href="#4-1-4-åºåˆ—sources-seq" class="headerlink" title="4.1.4 åºåˆ—sources (seq)"></a>4.1.4 åºåˆ—sources (seq)</h4><p>ä¸€ä¸ªç®€å•çš„åºåˆ—ç”Ÿæˆå™¨, å®ƒè¿ç»­ç”Ÿæˆä¸€ä¸ªè®¡æ•°å™¨, å®ƒä»0å¼€å§‹, å¢é‡ä¸º 1, å¹¶åœ¨ totalEvents åœæ­¢ã€‚</p><p><strong>ä¸»è¦ç”¨äºæµ‹è¯•ã€‚</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">1) é…ç½®</span><br><span class="line"><span class="comment"># å£°æ˜3ç§ç»„ä»¶</span></span><br><span class="line">a1.sources=r1</span><br><span class="line">a1.channels=c1</span><br><span class="line">a1.sinks=k1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰ source ä¿¡æ¯</span></span><br><span class="line">a1.sources.r1.type=seq</span><br><span class="line">a1.sources.r1.totalEvents=1000</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰ sink ä¿¡æ¯</span></span><br><span class="line">a1.sinks.k1.type=logger</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰ channel ä¿¡æ¯</span></span><br><span class="line">a1.channels.c1.type=memory</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»‘å®šåœ¨ä¸€èµ·</span></span><br><span class="line">a1.sources.r1.channels=c1</span><br><span class="line">a1.sinks.k1.channel=c1</span><br><span class="line"></span><br><span class="line">2) è¿è¡Œ</span><br><span class="line">$&gt;bin/flume-ng agent -f conf/confs/helloworld.seq.conf -n a1 -Dflume.root.logger=INFO,console</span><br></pre></td></tr></table></figure><h4 id="4-1-5-å‹åŠ›-source-ç”¨äºå‹åŠ›æµ‹è¯•"><a href="#4-1-5-å‹åŠ›-source-ç”¨äºå‹åŠ›æµ‹è¯•" class="headerlink" title="4.1.5 å‹åŠ› source (ç”¨äºå‹åŠ›æµ‹è¯•)"></a>4.1.5 å‹åŠ› source (ç”¨äºå‹åŠ›æµ‹è¯•)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a1.sources = stresssource-1</span><br><span class="line">a1.channels = memoryChannel-1</span><br><span class="line">a1.sources.stresssource-1.type = org.apache.flume.source.StressSource</span><br><span class="line">a1.sources.stresssource-1.size = 10240</span><br><span class="line">a1.sources.stresssource-1.maxTotalEvents = 1000000</span><br><span class="line">a1.sources.stresssource-1.channels = memoryChannel-1</span><br></pre></td></tr></table></figure><h4 id="4-1-6-Multiplexing-Channel-Selector-TODO"><a href="#4-1-6-Multiplexing-Channel-Selector-TODO" class="headerlink" title="4.1.6 Multiplexing Channel Selector :TODO"></a>4.1.6 Multiplexing Channel Selector :TODO</h4><p><strong>flume å¤šè·¯å¤ç”¨</strong></p><p><a href="http://flume.apache.org/FlumeUserGuide.html#multiplexing-channel-selector" target="_blank" rel="noopener">å®˜ç½‘</a></p><hr><h3 id="4-2-Flume-Sink"><a href="#4-2-Flume-Sink" class="headerlink" title="4.2. Flume Sink"></a>4.2. Flume Sink</h3><p><strong>æ²‰æ¼•, source ç»è¿‡ channel, æœ€åä¸‹æ²‰åˆ° sink, å†ç”± sink è¾“å‡º</strong></p><p><strong>æ³¨æ„, flume åé¢åŠ ä¸Š <code>&amp;</code>æ˜¯æŒ‡åå°è¿è¡Œ</strong></p><p><a href="http://flume.apache.org/FlumeUserGuide.html#hdfs-sink" target="_blank" rel="noopener">å®˜ç½‘</a></p><h4 id="4-2-1è¾“å‡º-sink-åˆ°-HDFS"><a href="#4-2-1è¾“å‡º-sink-åˆ°-HDFS" class="headerlink" title="4.2.1è¾“å‡º (sink) åˆ° HDFS"></a>4.2.1è¾“å‡º (sink) åˆ° HDFS</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">1) é…ç½®</span><br><span class="line">===================================================================</span><br><span class="line">a1.sources = r1</span><br><span class="line">a1.channels = c1</span><br><span class="line">a1.sinks = k1</span><br><span class="line"></span><br><span class="line">a1.sources.r1.type = netcat</span><br><span class="line">a1.sources.r1.bind = localhost</span><br><span class="line">a1.sources.r1.port = 8888</span><br><span class="line"></span><br><span class="line">a1.sinks.k1.type = hdfs</span><br><span class="line">a1.sinks.k1.hdfs.path = /flume/events/%y-%m-%d/%H/%M/%S</span><br><span class="line">a1.sinks.k1.hdfs.filePrefix = events-</span><br><span class="line"></span><br><span class="line"><span class="comment"># roundç›®å½• æ˜¯å¦ä¼šäº§ç”Ÿæ–°ç›®å½•,æ¯ååˆ†é’Ÿäº§ç”Ÿä¸€ä¸ªæ–°ç›®å½•,ä¸€èˆ¬æ§åˆ¶çš„ç›®å½•æ–¹é¢ã€‚</span></span><br><span class="line"><span class="comment">#2017-12-12 --&gt;</span></span><br><span class="line"><span class="comment">#2017-12-12 --&gt;%H%M%S</span></span><br><span class="line">æ¯”å¦‚ å†™ä¸Š 1 / day, å°±æ˜¯ä¸€å¤©äº§ç”Ÿçš„æ•°æ®æ–‡ä»¶éƒ½åœ¨ ä¸€ä¸ªæ—¥æœŸçš„ç›®å½•ä¸‹.</span><br><span class="line">---</span><br><span class="line">a1.sinks.k1.hdfs.round = <span class="literal">true</span>            </span><br><span class="line">a1.sinks.k1.hdfs.roundValue = 1</span><br><span class="line">a1.sinks.k1.hdfs.roundUnit = day</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä½¿ç”¨æœ¬åœ°æ—¶é—´æˆ³ä¸ºæ—¶é—´åºåˆ—å¤´ </span></span><br><span class="line">a1.sinks.k1.hdfs.useLocalTimeStamp=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ˜¯å¦äº§ç”Ÿæ–°æ–‡ä»¶ã€‚ </span></span><br><span class="line">-------------</span><br><span class="line">åªè¦3ä¸ªæ¡ä»¶ä¸­æŸä¸€ä¸ªæ»¡è¶³, å°±ä¼šæ»šåŠ¨ä¸€ä¸ªæ–‡ä»¶</span><br><span class="line"><span class="comment"># rollæ»šåŠ¨, æ­¤äº‹ä»¶å†…çš„æ—¥å¿—ä¼šå†™å…¥åˆ°ä¸€ä¸ªæ–‡ä»¶</span></span><br><span class="line"><span class="comment"># ç›®å‰çš„çŒœæµ‹: 10ä¸ªå­—èŠ‚å°±ä¼šè§¦å‘, å¦‚æœ10ç§’å†… 0 &lt; input &lt; 10å­—èŠ‚,  ä¹Ÿä¼šæ»šåŠ¨ =&gt; æ˜¯çš„</span></span><br><span class="line"><span class="comment"># ç­‰å¾…æ»šåŠ¨å½“å‰çš„æ–‡ä»¶ 10ç§’,Number of seconds to wait before rolling current file (0 = never roll based on time interval)</span></span><br><span class="line">a1.sinks.k1.hdfs.rollInterval=10      </span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™æ˜¯æŒ‡10ä¸ªå­—èŠ‚å°±è§¦å‘æ»šåŠ¨ File size to trigger roll, in bytes (0: never roll based on file size)                </span></span><br><span class="line">a1.sinks.k1.hdfs.rollSize=10           </span><br><span class="line"></span><br><span class="line"><span class="comment"># Number of events written to file before it rolled (0 = never roll based on number of events) ä¸€è¡Œå°±æ˜¯ä¸€ä¸ªäº‹ä»¶  </span></span><br><span class="line">a1.sinks.k1.hdfs.rollCount=3          </span><br><span class="line"></span><br><span class="line">a1.channels.c1.type=memory</span><br><span class="line"></span><br><span class="line">a1.sources.r1.channels = c1</span><br><span class="line">a1.sinks.k1.channel = c1</span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line"><span class="comment"># sinkå…¶å®ƒå¯é€‰é…ç½®å‚æ•°(è¯¦æƒ…å¯æŸ¥å®˜ç½‘)</span></span><br><span class="line">agent1.sinks.sink1.type = hdfs</span><br><span class="line"><span class="comment">#a1.sinks.k1.channel = c1</span></span><br><span class="line">agent1.sinks.sink1.hdfs.path =hdfs://myha01/weblog/flume-event/%y-%m-%d/%H-%M agent1.sinks.sink1.hdfs.filePrefix = tomcat_</span><br><span class="line">agent1.sinks.sink1.hdfs.maxOpenFiles = 5000</span><br><span class="line">agent1.sinks.sink1.hdfs.batchSize= 100</span><br><span class="line">agent1.sinks.sink1.hdfs.fileType = DataStream</span><br><span class="line">agent1.sinks.sink1.hdfs.writeFormat =Text</span><br><span class="line">agent1.sinks.sink1.hdfs.rollSize = 102400</span><br><span class="line">agent1.sinks.sink1.hdfs.rollCount = 1000000</span><br><span class="line">agent1.sinks.sink1.hdfs.rollInterval = 60</span><br><span class="line">agent1.sinks.sink1.hdfs.round = <span class="literal">true</span></span><br><span class="line">agent1.sinks.sink1.hdfs.roundValue = 10</span><br><span class="line">agent1.sinks.sink1.hdfs.roundUnit = minute</span><br><span class="line">agent1.sinks.sink1.hdfs.useLocalTimeStamp = <span class="literal">true</span></span><br><span class="line">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">å¦‚æœ HDFS é›†ç¾¤æ˜¯é«˜å¯ç”¨é›†ç¾¤ï¼Œé‚£ä¹ˆå¿…é¡»è¦æ”¾å…¥ core-site.xml å’Œ hdfs-site.xml æ–‡ä»¶åˆ° <span class="variable">$FLUME_HOME</span>/conf/confs  ç›®å½•ä¸­, å°±æ˜¯è·Ÿé…ç½®æ–‡ä»¶åŒçº§ç›®å½•.</span><br><span class="line">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line"></span><br><span class="line">2) å¼€å¯agent</span><br><span class="line">===================================================================</span><br><span class="line">[ap@cs1]~/apps/flume/conf/confs% flume-ng agent -f hdfs.conf -n a1</span><br><span class="line"></span><br><span class="line">3) nc è¿æ¥</span><br><span class="line">===================================================================</span><br><span class="line">nc <span class="built_in">local</span> 8888</span><br><span class="line">è¿æ¥ä¸Šäº†ä¹‹å, å‘å‡ºå»çš„æ¶ˆæ¯å°±ä¼šå†™å…¥ hdfs </span><br><span class="line"></span><br><span class="line">4) å†™å…¥æ—¶, å®Œæ•´çš„ <span class="built_in">log</span> æ˜¯è¿™æ ·çš„</span><br><span class="line">===================================================================</span><br><span class="line">18/06/30 18:39:18 INFO hdfs.HDFSSequenceFile: writeFormat = Writable, UseRawLocalFileSystem = <span class="literal">false</span></span><br><span class="line">18/06/30 18:39:18 INFO hdfs.BucketWriter: Creating /user/ap/flume/events/18-06-30/18/39/00/events-.1530355158463.tmp</span><br><span class="line">18/06/30 18:39:28 INFO hdfs.BucketWriter: Closing /user/ap/flume/events/18-06-30/18/39/00/events-.1530355158463.tmp</span><br><span class="line">18/06/30 18:39:28 INFO hdfs.BucketWriter: Renaming /user/ap/flume/events/18-06-30/18/39/00/events-.1530355158463.tmp to /user/ap/flume/events/18-06-30/18/39/00/events-.1530355158463</span><br><span class="line">18/06/30 18:39:28 INFO hdfs.HDFSEventSink: Writer callback called.</span><br><span class="line"></span><br><span class="line">5) æŸ¥çœ‹ </span><br><span class="line">===================================================================</span><br><span class="line">æ³¨æ„: åºåˆ—æ–‡ä»¶ç”¨ text æŸ¥çœ‹</span><br></pre></td></tr></table></figure><h4 id="4-2-2-è¾“å‡ºåˆ°-Hive"><a href="#4-2-2-è¾“å‡ºåˆ°-Hive" class="headerlink" title="4.2.2 è¾“å‡ºåˆ° Hive"></a>4.2.2 è¾“å‡ºåˆ° Hive</h4><p><strong>å†™å…¥å¤ªæ…¢, å› ä¸ºè¦è½¬ä¸º MR, æ‰€ä»¥ä¸€èˆ¬ä¸ä¼šç”¨</strong></p><h4 id="4-2-3-è¾“å‡º-sink-åˆ°-HBase"><a href="#4-2-3-è¾“å‡º-sink-åˆ°-HBase" class="headerlink" title="4.2.3 è¾“å‡º (sink) åˆ° HBase"></a>4.2.3 è¾“å‡º (sink) åˆ° HBase</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">3.1) é…ç½®æ–‡ä»¶</span><br><span class="line">===================================================================</span><br><span class="line">a1.sources = r1</span><br><span class="line">a1.channels = c1</span><br><span class="line">a1.sinks = k1</span><br><span class="line"></span><br><span class="line">a1.sources.r1.type = netcat</span><br><span class="line">a1.sources.r1.bind = localhost</span><br><span class="line">a1.sources.r1.port = 8888</span><br><span class="line"></span><br><span class="line">a1.sinks.k1.type = hbase</span><br><span class="line">a1.sinks.k1.table = ns1:t12</span><br><span class="line">a1.sinks.k1.columnFamily = f1</span><br><span class="line">a1.sinks.k1.serializer = org.apache.flume.sink.hbase.RegexHbaseEventSerializer</span><br><span class="line"></span><br><span class="line">a1.channels.c1.type=memory</span><br><span class="line"></span><br><span class="line">a1.sources.r1.channels = c1</span><br><span class="line">a1.sinks.k1.channel = c1</span><br><span class="line"></span><br><span class="line">3.2) å¼€å¯ nc è¾“å…¥</span><br><span class="line">===================================================================</span><br><span class="line"></span><br><span class="line">3.3) åœ¨ hbase shell ä¸­ scan è¡¨ <span class="string">'ns1:t12'</span></span><br><span class="line">===================================================================</span><br></pre></td></tr></table></figure><h4 id="4-2-4-è¾“å‡ºåˆ°-kafka"><a href="#4-2-4-è¾“å‡ºåˆ°-kafka" class="headerlink" title="4.2.4 è¾“å‡ºåˆ° kafka"></a>4.2.4 è¾“å‡ºåˆ° kafka</h4><p>:TODO</p><h3 id="4-3-Flume-Channel"><a href="#4-3-Flume-Channel" class="headerlink" title="4.3. Flume Channel"></a>4.3. Flume Channel</h3><h4 id="4-3-1-Memory-Channel"><a href="#4-3-1-Memory-Channel" class="headerlink" title="4.3.1.Memory Channel"></a>4.3.1.Memory Channel</h4><p><strong>ä»¥ä¸Šç”¨çš„éƒ½æ˜¯Memory Channel, ä¸å†æ˜¾ç¤º</strong></p><h4 id="4-3-2-FileChannel"><a href="#4-3-2-FileChannel" class="headerlink" title="4.3.2 FileChannel"></a>4.3.2 FileChannel</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">1) é…ç½®</span><br><span class="line">===================================================================</span><br><span class="line">a1.sources = r1</span><br><span class="line">a1.sinks= k1</span><br><span class="line">a1.channels = c1</span><br><span class="line"></span><br><span class="line">a1.sources.r1.type=netcat</span><br><span class="line">a1.sources.r1.bind=localhost</span><br><span class="line">a1.sources.r1.port=8888</span><br><span class="line"></span><br><span class="line">a1.sinks.k1.type=logger</span><br><span class="line"></span><br><span class="line">a1.channels.c1.type = file</span><br><span class="line">a1.channels.c1.checkpointDir = /home/centos/flume/fc_check</span><br><span class="line">a1.channels.c1.dataDirs = /home/centos/flume/fc_data</span><br><span class="line"></span><br><span class="line">a1.sources.r1.channels=c1</span><br><span class="line">a1.sinks.k1.channel=c1</span><br><span class="line"></span><br><span class="line">2) åˆ›å»ºçš„æ–‡ä»¶å¤§æ¦‚æ˜¯è¿™æ ·</span><br><span class="line">===================================================================</span><br><span class="line">$~/flumedata&gt; ls -r <span class="built_in">fc</span>*</span><br><span class="line">fc_data:</span><br><span class="line"><span class="built_in">log</span>-1.meta  <span class="built_in">log</span>-1  in_use.lock</span><br><span class="line"></span><br><span class="line">fc_check:</span><br><span class="line">queueset  in_use.lock  inflighttakes  inflightputs  checkpoint.meta  checkpoint</span><br></pre></td></tr></table></figure><h4 id="4-3-3-å¯æº¢å‡ºæ–‡ä»¶é€šé“"><a href="#4-3-3-å¯æº¢å‡ºæ–‡ä»¶é€šé“" class="headerlink" title="4.3.3 å¯æº¢å‡ºæ–‡ä»¶é€šé“"></a>4.3.3 å¯æº¢å‡ºæ–‡ä»¶é€šé“</h4><p><strong>This channel is currently experimental and not recommended for use in production.</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[spillable_channel.conf]</span><br><span class="line"></span><br><span class="line">a1.channels = c1</span><br><span class="line">a1.channels.c1.type = SPILLABLEMEMORY</span><br><span class="line"><span class="comment">#0è¡¨ç¤ºç¦ç”¨å†…å­˜é€šé“ï¼Œç­‰ä»·äºæ–‡ä»¶é€šé“</span></span><br><span class="line">a1.channels.c1.memoryCapacity = 0</span><br><span class="line"><span class="comment">#0,ç¦ç”¨æ–‡ä»¶é€šé“ï¼Œç­‰ä»·å†…å­˜é€šé“ã€‚</span></span><br><span class="line">a1.channels.c1.overflowCapacity = 2000</span><br><span class="line"></span><br><span class="line">a1.channels.c1.byteCapacity = 800000</span><br><span class="line">a1.channels.c1.checkpointDir = /user/centos/flume/fc_check</span><br><span class="line">a1.channels.c1.dataDirs = /user/centos/flume/fc_data</span><br></pre></td></tr></table></figure><h3 id="4-4-ä½¿ç”¨AvroSourceå’ŒAvroSinkå®ç°è·ƒç‚¹agentå¤„ç†"><a href="#4-4-ä½¿ç”¨AvroSourceå’ŒAvroSinkå®ç°è·ƒç‚¹agentå¤„ç†" class="headerlink" title="4.4 ä½¿ç”¨AvroSourceå’ŒAvroSinkå®ç°è·ƒç‚¹agentå¤„ç†"></a>4.4 ä½¿ç”¨AvroSourceå’ŒAvroSinkå®ç°è·ƒç‚¹agentå¤„ç†</h3><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-30-144236.png" alt="image-20180630224236332"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"> [avro_hop.conf]</span><br><span class="line"><span class="comment">############ ï£¿a1ï£¿ ############</span></span><br><span class="line"><span class="comment"># å£°æ˜3ç§ç»„ä»¶</span></span><br><span class="line">a1.sources=r1</span><br><span class="line">a1.channels=c1</span><br><span class="line">a1.sinks=k1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰ source ä¿¡æ¯</span></span><br><span class="line">a1.sources.r1.type=netcat</span><br><span class="line">a1.sources.r1.bind=localhost</span><br><span class="line">a1.sources.r1.port=8888</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰ sink ä¿¡æ¯</span></span><br><span class="line">a1.sinks.k1.type=avro</span><br><span class="line">a1.sinks.k1.hostname=localhost</span><br><span class="line">a1.sinks.k1.port=9999</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰ channel ä¿¡æ¯</span></span><br><span class="line">a1.channels.c1.type=memory</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»‘å®šåœ¨ä¸€èµ·</span></span><br><span class="line">a1.sources.r1.channels=c1</span><br><span class="line">a1.sinks.k1.channel=c1</span><br><span class="line"></span><br><span class="line"><span class="comment">############ ï£¿a2ï£¿ ############</span></span><br><span class="line"><span class="comment"># å£°æ˜3ç§ç»„ä»¶</span></span><br><span class="line">a2.sources=r2</span><br><span class="line">a2.channels=c2</span><br><span class="line">a2.sinks=k2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰ source ä¿¡æ¯</span></span><br><span class="line"><span class="comment"># source æ˜¯ avro, ç»‘å®šç«¯å£9999</span></span><br><span class="line">a2.sources.r2.type=avro</span><br><span class="line">a2.sources.r2.bind=localhost</span><br><span class="line">a2.sources.r2.port=9999</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰ sink ä¿¡æ¯</span></span><br><span class="line"><span class="comment"># sink æ‰“å°åˆ°æ§åˆ¶å°</span></span><br><span class="line">a2.sinks.k2.type=logger</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰ channel ä¿¡æ¯</span></span><br><span class="line">a2.channels.c2.type=memory</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»‘å®šåœ¨ä¸€èµ·</span></span><br><span class="line">a2.sources.r2.channels=c2</span><br><span class="line">a2.sinks.k2.channel=c2</span><br><span class="line"></span><br><span class="line">2.å¯åŠ¨a2</span><br><span class="line">===================================================================</span><br><span class="line">$&gt;flume-ng agent -f /soft/flume/conf/avro_hop.conf -n a2 -Dflume.root.logger=INFO,console</span><br><span class="line"></span><br><span class="line">3.éªŒè¯a2</span><br><span class="line">===================================================================</span><br><span class="line">$&gt;netstat -anop | grep 9999</span><br><span class="line"></span><br><span class="line">4.å¯åŠ¨a1</span><br><span class="line">===================================================================</span><br><span class="line">$&gt;flume-ng agent -f /soft/flume/conf/avro_hop.conf -n a1</span><br><span class="line"></span><br><span class="line">5.éªŒè¯a1</span><br><span class="line">===================================================================</span><br><span class="line">$&gt;netstat -anop | grep 8888</span><br><span class="line"></span><br><span class="line">6.nc è¿æ¥a1 &amp; å‘æ¶ˆæ¯</span><br><span class="line">===================================================================</span><br><span class="line">$&gt;nc localhost 8888</span><br></pre></td></tr></table></figure><h3 id="4-5-Flume-çš„é«˜å¯ç”¨é…ç½®"><a href="#4-5-Flume-çš„é«˜å¯ç”¨é…ç½®" class="headerlink" title="4.5 Flume çš„é«˜å¯ç”¨é…ç½®"></a>4.5 Flume çš„é«˜å¯ç”¨é…ç½®</h3><ul><li><p>æ˜¯é€šè¿‡é…ç½®ä¼˜å…ˆçº§æ¥å®ç°ä¸»ä», ä¼˜å…ˆçº§æ˜¯ç»„å†…çš„ä¼˜å…ˆçº§, éœ€è¦å…ˆè®¾ç½®ä¸ºä¸€ç»„</p></li><li><p>ä¼˜å…ˆçº§é«˜çš„ down æ‰äº†, å†å¯åŠ¨èµ·æ¥, ä¾ç„¶æ˜¯ä¸» ==&gt; <strong>å·²éªŒè¯</strong></p></li><li><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">==============================</span><br><span class="line">--è®¾ç½®ä¼˜å…ˆçº§ä»£é…ç½®å¦‚ä¸‹----------</span><br><span class="line"><span class="comment">#set sink group è®¾ç½®ä¸ºä¸€ç»„</span></span><br><span class="line">a1.sinkgroups.g1.sinks = k1 k2</span><br><span class="line"></span><br><span class="line"><span class="comment">#set failover è®¾ç½®å®¹ç¾ç›¸å…³çš„å‚æ•°</span></span><br><span class="line">a1.sinkgroups.g1.processor.type = failover</span><br><span class="line"><span class="comment"># è®¾ç½® ç»„å†…æˆå‘˜çš„ä¼˜å…ˆçº§, å†³å®š ä¸»å¤‡</span></span><br><span class="line">a1.sinkgroups.g1.processor.priority.k1 = 10 </span><br><span class="line">a1.sinkgroups.g1.processor.priority.k2 = 1 </span><br><span class="line">a1.sinkgroups.g1.processor.maxpenalty = 10000</span><br></pre></td></tr></table></figure></li></ul><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-07-02-080516.jpg" alt=""></p><ul><li><strong>ä»¥ä¸‹é…ç½®æ–¹æ¡ˆä¸ä¸Šå›¾ä¸åŒçš„, ç”¨çš„æ˜¯1ä¸ª <code>channel</code>, 2ä¸ª`sink</strong>`</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">1. é…ç½® agent ==&gt; cs1, cs2</span><br><span class="line">================================================================================================</span><br><span class="line">[ha_agent.conf]</span><br><span class="line">------------------</span><br><span class="line"></span><br><span class="line"><span class="comment">#agent name: a1 </span></span><br><span class="line">a1.channels = c1 </span><br><span class="line">a1.sources = r1</span><br><span class="line">a1.sinks = k1 k2</span><br><span class="line"></span><br><span class="line"><span class="comment">#set gruop</span></span><br><span class="line">a1.sinkgroups = g1</span><br><span class="line"></span><br><span class="line"><span class="comment">#set channel</span></span><br><span class="line">a1.channels.c1.type = memory </span><br><span class="line">a1.channels.c1.capacity = 1000 </span><br><span class="line">a1.channels.c1.transactionCapacity = 100</span><br><span class="line"></span><br><span class="line"><span class="comment"># set sources</span></span><br><span class="line">a1.sources.r1.channels = c1</span><br><span class="line">a1.sources.r1.type = <span class="built_in">exec</span></span><br><span class="line">a1.sources.r1.command = tail -F /home/ap/flumedata/testha.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™é‡Œæœ‰ç–‘é—® : è¿™é‡Œè®¾ç½®æ‹¦æˆªå™¨çš„æ„ä¹‰?? éšä¾¿è®¾ç½®çš„å—?? :TODO</span></span><br><span class="line">a1.sources.r1.interceptors = i1 i2 </span><br><span class="line">a1.sources.r1.interceptors.i1.type = static </span><br><span class="line">a1.sources.r1.interceptors.i1.key = Type </span><br><span class="line">a1.sources.r1.interceptors.i1.value = LOGIN </span><br><span class="line">a1.sources.r1.interceptors.i2.type = timestamp</span><br><span class="line"></span><br><span class="line"><span class="comment"># set sink1 -&gt; é€šè¿‡ avro æ²‰åˆ° cs3çš„ source ä¸Š</span></span><br><span class="line">a1.sinks.k1.channel = c1 </span><br><span class="line">a1.sinks.k1.type = avro </span><br><span class="line">a1.sinks.k1.hostname = cs3 </span><br><span class="line">a1.sinks.k1.port = 52020</span><br><span class="line"></span><br><span class="line"><span class="comment"># set sink2  -&gt; é€šè¿‡ avro æ²‰åˆ° cs4çš„ source ä¸Š</span></span><br><span class="line">a1.sinks.k2.channel = c1 </span><br><span class="line">a1.sinks.k2.type = avro </span><br><span class="line">a1.sinks.k2.hostname = cs4 </span><br><span class="line">a1.sinks.k2.port = 52020</span><br><span class="line"></span><br><span class="line"><span class="comment">#set sink group è®¾ç½®ä¸ºä¸€ç»„</span></span><br><span class="line">a1.sinkgroups.g1.sinks = k1 k2</span><br><span class="line"></span><br><span class="line"><span class="comment">#set failover è®¾ç½®å®¹ç¾ç›¸å…³çš„å‚æ•°</span></span><br><span class="line">a1.sinkgroups.g1.processor.type = failover</span><br><span class="line"><span class="comment"># è®¾ç½® ç»„å†…æˆå‘˜çš„ä¼˜å…ˆçº§, å†³å®š ä¸»å¤‡</span></span><br><span class="line">a1.sinkgroups.g1.processor.priority.k1 = 10 </span><br><span class="line">a1.sinkgroups.g1.processor.priority.k2 = 1 </span><br><span class="line">a1.sinkgroups.g1.processor.maxpenalty = 10000</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2. é…ç½® collector ==&gt; cs3,cs4</span><br><span class="line">================================================================================================</span><br><span class="line">[ha_collector.conf]</span><br><span class="line"></span><br><span class="line"><span class="comment">#set agent name </span></span><br><span class="line">a1.sources = r1</span><br><span class="line">a1.channels = c1 </span><br><span class="line">a1.sinks = k1</span><br><span class="line"></span><br><span class="line"><span class="comment">#set channel</span></span><br><span class="line">a1.channels.c1.type = memory </span><br><span class="line">a1.channels.c1.capacity = 1000 </span><br><span class="line">a1.channels.c1.transactionCapacity = 100</span><br><span class="line"></span><br><span class="line"><span class="comment"># other node,nna to nns</span></span><br><span class="line">a1.sources.r1.type = avro</span><br><span class="line"></span><br><span class="line"><span class="comment"># :TODO è¿™äº› key, value è®¾ç½®äº†ä¹‹å, ç”¨åœ¨ä»€ä¹ˆåœ°æ–¹???</span></span><br><span class="line"><span class="comment">## å½“å‰ä¸»æœºæ˜¯ä»€ä¹ˆï¼Œå°±ä¿®æ”¹æˆä»€ä¹ˆä¸»æœºå </span></span><br><span class="line">a1.sources.r1.bind = cs3 </span><br><span class="line">a1.sources.r1.port = 52020 </span><br><span class="line">a1.sources.r1.interceptors = i1 </span><br><span class="line">a1.sources.r1.interceptors.i1.type = static </span><br><span class="line">a1.sources.r1.interceptors.i1.key = Collector</span><br><span class="line"><span class="comment">## å½“å‰ä¸»æœºæ˜¯ä»€ä¹ˆï¼Œå°±ä¿®æ”¹æˆä»€ä¹ˆä¸»æœºå </span></span><br><span class="line">a1.sources.r1.interceptors.i1.value = cs3 </span><br><span class="line">a1.sources.r1.channels = c1</span><br><span class="line"></span><br><span class="line"><span class="comment">#set sink to hdfs</span></span><br><span class="line">a1.sinks.k1.type=hdfs</span><br><span class="line">a1.sinks.k1.hdfs.path=/user/ap/flume/event_ha/loghdfs </span><br><span class="line">a1.sinks.k1.hdfs.fileType=DataStream </span><br><span class="line">a1.sinks.k1.hdfs.writeFormat=TEXT </span><br><span class="line">a1.sinks.k1.hdfs.rollInterval=10</span><br><span class="line">a1.sinks.k1.channel=c1 </span><br><span class="line">a1.sinks.k1.hdfs.filePrefix=%Y-%m-%d</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3. å¯åŠ¨</span><br><span class="line">================================================================================================</span><br><span class="line"><span class="comment"># å…ˆå¯åŠ¨ cs3,cs4 ==&gt; collector </span></span><br><span class="line">$&gt; [ap@cs4]~/apps/flume/conf/confs%  </span><br><span class="line">flume-ng agent -f ha_collector.conf -n a1 -Dflume.root.logger=DEBUG,console</span><br><span class="line"></span><br><span class="line"><span class="comment"># å†å¯åŠ¨ cs1, cs2  ==&gt; agent, è¿æ¥ collector</span></span><br><span class="line">[ap@cs1]~/apps/flume/conf/confs% </span><br><span class="line">flume-ng agent  -f ha_agent.conf -n a1 -Dflume.root.logger=DEBUG,console</span><br></pre></td></tr></table></figure><h3 id="4-6-å®ç”¨ä¸šåŠ¡åœºæ™¯"><a href="#4-6-å®ç”¨ä¸šåŠ¡åœºæ™¯" class="headerlink" title="4.6 å®ç”¨ä¸šåŠ¡åœºæ™¯"></a>4.6 å®ç”¨ä¸šåŠ¡åœºæ™¯</h3><p>çŸ¥è¯†ç‚¹: <strong>æ‹¦æˆªå™¨</strong> <strong>interceptors</strong></p><h4 id="4-6-1-éœ€æ±‚"><a href="#4-6-1-éœ€æ±‚" class="headerlink" title="4.6.1 éœ€æ±‚:"></a>4.6.1 <strong>éœ€æ±‚:</strong></h4><blockquote><p>Aã€B ä¸¤å°æ—¥å¿—æœåŠ¡æœºå™¨å®æ—¶ç”Ÿäº§æ—¥å¿—ä¸»è¦ç±»å‹ä¸º access.logã€nginx.logã€web.log ç°åœ¨è¦æ±‚:</p><p>æŠŠ Aã€B æœºå™¨ä¸­çš„ access.logã€nginx.logã€web.log é‡‡é›†æ±‡æ€»åˆ° C æœºå™¨ä¸Šç„¶åç»Ÿä¸€æ”¶é›†åˆ° hdfs ä¸­ã€‚</p><p>ä½†æ˜¯åœ¨ hdfs ä¸­è¦æ±‚çš„ç›®å½•ä¸º:</p><p>/source/logs/access/20160101/**</p><p>/source/logs/nginx/20160101/**</p><p>/source/logs/web/20160101/** </p></blockquote><h4 id="4-6-2-éœ€æ±‚åˆ†æ"><a href="#4-6-2-éœ€æ±‚åˆ†æ" class="headerlink" title="4.6.2 éœ€æ±‚åˆ†æ"></a>4.6.2 éœ€æ±‚åˆ†æ</h4><p><strong>éœ€æ±‚åˆ†æå›¾ç¤º</strong></p><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-07-02-091340.png" alt="image-20180702171339961"></p><p><strong>æ•°æ®å¤„ç†æµç¨‹åˆ†æ</strong></p><ul><li>åœ¨<strong>æ¯ä¸€å°èŠ‚ç‚¹</strong>ä¸Šéƒ½è¦ <strong>æœé›† 3ä¸ª source æº</strong></li><li>æœé›†å®Œæˆåå‘å¾€åŒä¸€å°èŠ‚ç‚¹</li></ul><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-07-02-091444.png" alt="image-20180702171443885"></p><h4 id="4-6-3-éœ€æ±‚å®ç°"><a href="#4-6-3-éœ€æ±‚å®ç°" class="headerlink" title="4.6.3 éœ€æ±‚å®ç°"></a>4.6.3 éœ€æ±‚å®ç°</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line">1.åœ¨cs1,cs2ä¸Šé…ç½®flume, é€šè¿‡ avro, sinkåˆ°cs3</span><br><span class="line">=============================================================</span><br><span class="line">[exec_source_avro_sink.conf]</span><br><span class="line">------------------------------</span><br><span class="line"><span class="comment"># æŒ‡å®šå„ä¸ªæ ¸å¿ƒç»„ä»¶ </span></span><br><span class="line">a1.sources = r1 r2 r3 </span><br><span class="line">a1.sinks = k1 </span><br><span class="line">a1.channels = c1</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‡†å¤‡æ•°æ®æº</span></span><br><span class="line"><span class="comment"># static æ‹¦æˆªå™¨çš„åŠŸèƒ½å°±æ˜¯å¾€é‡‡é›†åˆ°çš„æ•°æ®çš„ header ä¸­æ’å…¥è‡ªå·±å®šä¹‰çš„ key-value å¯¹ </span></span><br><span class="line"><span class="comment"># sources-&gt;r1</span></span><br><span class="line">a1.sources.r1.type = <span class="built_in">exec</span></span><br><span class="line">a1.sources.r1.command = tail -F -c +0 /home/ap/flumedata/access.log </span><br><span class="line">a1.sources.r1.interceptors = i1</span><br><span class="line">a1.sources.r1.interceptors.i1.type = static</span><br><span class="line">a1.sources.r1.interceptors.i1.key = <span class="built_in">type</span></span><br><span class="line">a1.sources.r1.interceptors.i1.value = access</span><br><span class="line"></span><br><span class="line"><span class="comment"># sources-&gt;r2</span></span><br><span class="line">a1.sources.r2.type = <span class="built_in">exec</span></span><br><span class="line">a1.sources.r2.command = tail -F  -c +0 /home/ap/flumedata/nginx.log </span><br><span class="line">a1.sources.r2.interceptors = i2</span><br><span class="line">a1.sources.r2.interceptors.i2.type = static </span><br><span class="line">a1.sources.r2.interceptors.i2.key = <span class="built_in">type</span> </span><br><span class="line">a1.sources.r2.interceptors.i2.value = nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># sources-&gt;r3</span></span><br><span class="line">a1.sources.r3.type = <span class="built_in">exec</span></span><br><span class="line">a1.sources.r3.command = tail -F  -c +0 /home/ap/flumedata/web.log </span><br><span class="line">a1.sources.r3.interceptors = i3</span><br><span class="line">a1.sources.r3.interceptors.i3.type = static </span><br><span class="line">a1.sources.r3.interceptors.i3.key = <span class="built_in">type</span> </span><br><span class="line">a1.sources.r3.interceptors.i3.value = web</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Describe the sink</span></span><br><span class="line">a1.sinks.k1.type = avro </span><br><span class="line">a1.sinks.k1.hostname = cs3 </span><br><span class="line">a1.sinks.k1.port = 41414</span><br><span class="line"></span><br><span class="line"><span class="comment"># Use a channel which buffers events in memory </span></span><br><span class="line">a1.channels.c1.type = memory </span><br><span class="line">a1.channels.c1.capacity = 20000 </span><br><span class="line">a1.channels.c1.transactionCapacity = 10000</span><br><span class="line"></span><br><span class="line"><span class="comment"># Bind the source and sink to the channel </span></span><br><span class="line">a1.sources.r1.channels = c1 </span><br><span class="line">a1.sources.r2.channels = c1 </span><br><span class="line">a1.sources.r3.channels = c1 </span><br><span class="line">a1.sinks.k1.channel = c1</span><br><span class="line"></span><br><span class="line">2. åœ¨ cs3ä¸Šé…ç½® flume, <span class="built_in">source</span> ä¸º avro, æ¥å—æ¥è‡ª cs1,cs2ä¸‹æ²‰çš„æ•°æ®</span><br><span class="line">======================================================================</span><br><span class="line">[avro_source_hdfs_sink.conf]</span><br><span class="line">-------------------------------</span><br><span class="line"><span class="comment">#å®šä¹‰ agent åï¼Œ sourceã€channelã€sink çš„åç§° </span></span><br><span class="line">a1.sources = r1</span><br><span class="line">a1.sinks = k1</span><br><span class="line">a1.channels = c1</span><br><span class="line"></span><br><span class="line"><span class="comment">#å®šä¹‰ source </span></span><br><span class="line">a1.sources.r1.type = avro </span><br><span class="line">a1.sources.r1.bind = localhost</span><br><span class="line">a1.sources.r1.port =41414</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ·»åŠ æ—¶é—´æ‹¦æˆªå™¨</span></span><br><span class="line"><span class="comment">#Note:For all of the time related escape sequences, a header with the key â€œtimestampâ€ must #exist among the headers of the event (unless hdfs.useLocalTimeStamp is set to true). One way #to add this automatically is to use the TimestampInterceptor. </span></span><br><span class="line">a1.sources.r1.interceptors = i1 a1.sources.r1.interceptors.i1.type=org.apache.flume.interceptor.TimestampInterceptor<span class="variable">$Builder</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å®šä¹‰ channels</span></span><br><span class="line">a1.channels.c1.type = memory </span><br><span class="line"><span class="comment">#The maximum number of events stored in the channel</span></span><br><span class="line">a1.channels.c1.capacity = 20000 </span><br><span class="line"><span class="comment">#The maximum number of events the channel will take from a source or give to a sink per transaction</span></span><br><span class="line">a1.channels.c1.transactionCapacity = 10000</span><br><span class="line"></span><br><span class="line"><span class="comment">#å®šä¹‰ sink</span></span><br><span class="line">a1.sinks.k1.type = hdfs </span><br><span class="line">a1.sinks.k1.hdfs.path = /user/ap/flume/event/%&#123;<span class="built_in">type</span>&#125;/%Y%m%d </span><br><span class="line">a1.sinks.k1.hdfs.filePrefix = events</span><br><span class="line">a1.sinks.k1.hdfs.fileType = DataStream</span><br><span class="line">a1.sinks.k1.hdfs.writeFormat = Text</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ—¶é—´ç±»å‹</span></span><br><span class="line">a1.sinks.k1.hdfs.useLocalTimeStamp = <span class="literal">true</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">#ç”Ÿæˆçš„æ–‡ä»¶ä¸æŒ‰æ¡æ•°ç”Ÿæˆ, å¦åˆ™å°±æ˜¯æŒ‰ç…§è®¾å®šçš„ eventäº§ç”Ÿçš„, 1è¡Œå°±æ˜¯ä¸€ä¸ª event </span></span><br><span class="line"><span class="comment">#Number of events written to file before it rolled (0 = never roll based on number of events)</span></span><br><span class="line">a1.sinks.k1.hdfs.rollCount = 0</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç”Ÿæˆçš„æ–‡ä»¶æŒ‰æ—¶é—´ç”Ÿæˆ,å•ä½æ˜¯ç§’</span></span><br><span class="line"><span class="comment">#Number of seconds to wait before rolling current file (0 = never roll based on time interval)</span></span><br><span class="line">a1.sinks.k1.hdfs.rollInterval = 30</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç”Ÿæˆçš„æ–‡ä»¶æŒ‰å¤§å°ç”Ÿæˆ, å•ä½æ˜¯ bytes</span></span><br><span class="line"><span class="comment">#1 MB = 1,024 KB = 1,048,576 Bytes </span></span><br><span class="line"><span class="comment">#File size to trigger roll, in bytes (0: never roll based on file size)</span></span><br><span class="line">a1.sinks.k1.hdfs.rollSize = 10485760   <span class="comment">#è¿™é‡Œæ˜¯10MB</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ‰¹é‡å†™å…¥ hdfs çš„ä¸ªæ•°</span></span><br><span class="line">a1.sinks.k1.hdfs.batchSize = 20</span><br><span class="line"></span><br><span class="line"><span class="comment">#flume æ“ä½œ hdfs çš„çº¿ç¨‹æ•°(åŒ…æ‹¬æ–°å»ºï¼Œå†™å…¥ç­‰) </span></span><br><span class="line">a1.sinks.k1.hdfs.threadsPoolSize=10</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ“ä½œ hdfs è¶…æ—¶æ—¶é—´</span></span><br><span class="line">a1.sinks.k1.hdfs.callTimeout=30000</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç»„è£… sourceã€channelã€sink </span></span><br><span class="line">a1.sources.r1.channels = c1 </span><br><span class="line">a1.sinks.k1.channel = c1</span><br><span class="line"></span><br><span class="line">3.å¯åŠ¨æœåŠ¡</span><br><span class="line">============================================================================</span><br><span class="line"><span class="comment"># å¯åŠ¨cs3 =&gt; æœåŠ¡å™¨ c</span></span><br><span class="line">[ap@cs3]~/apps/flume/conf/confs% flume-ng agent -f avro_source_hdfs_sink.conf -n a1 -Dflume.root.logger=DEBUG,console</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨cs1, cs2 =&gt; æœåŠ¡å™¨ a, b</span></span><br><span class="line"><span class="comment"># æ³¨æ„: åƒä¸‡åˆ«å¯é”™äº†, å¦åˆ™å¾ˆéš¾æ‰¾åˆ°åŸå› ..</span></span><br><span class="line">[ap@cs2]~/apps/flume/conf/confs% flume-ng agent -f exec_source_avro_sink.conf  -n a1 -Dflume.root.logger=DEBUG,console</span><br><span class="line"></span><br><span class="line">==============</span><br><span class="line">é‡åˆ°é—®é¢˜: </span><br><span class="line">è¿™ç§é€šè¿‡avroå¤šç‚¹ sink åˆ°ä¸€ä¸ª <span class="built_in">source</span> çš„æ—¶å€™, å®ç°ä¸åˆ›å»ºæ–‡ä»¶å¤¹/æ–‡ä»¶çš„, å¥½åƒç¡®å®å†™å…¥ä¸è¿›å»...</span><br><span class="line">===&gt; md, åŸå› åº”è¯¥æ˜¯å¯åŠ¨é”™é…ç½®äº†</span><br></pre></td></tr></table></figure><h2 id="5-Flumeçš„Mavenä¾èµ–"><a href="#5-Flumeçš„Mavenä¾èµ–" class="headerlink" title="5.Flumeçš„Mavenä¾èµ–"></a>5.Flumeçš„Mavenä¾èµ–</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.rox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>Flume_test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.flume<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flume-ng-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.6.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.flume.flume-ng-sinks<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flume-hdfs-sink<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.6.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.flume.flume-ng-sinks<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flume-ng-hbase-sink<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.6.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.flume.flume-ng-channels<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flume-file-channel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.6.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;1-Flume-æ¦‚å¿µ&quot;&gt;&lt;a href=&quot;#1-Flume-æ¦‚å¿µ&quot; class=&quot;headerlink&quot; title=&quot;1.Flume æ¦‚å¿µ&quot;&gt;&lt;/a&gt;1.Flume æ¦‚å¿µ&lt;/h2&gt;&lt;p&gt;æä¾› &lt;strong&gt;æ”¶é›†ã€ç§»åŠ¨ã€èšåˆå¤§é‡æ—¥å¿—æ•°æ®&lt;/strong&gt;çš„æœåŠ¡ã€‚
      
    
    </summary>
    
      <category term="Hadoop" scheme="https://airpoet.github.io/categories/Hadoop/"/>
    
      <category term="Flume" scheme="https://airpoet.github.io/categories/Hadoop/Flume/"/>
    
    
      <category term="åŸåˆ›" scheme="https://airpoet.github.io/tags/%E5%8E%9F%E5%88%9B/"/>
    
      <category term="æŠ€æœ¯" scheme="https://airpoet.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="Hadoop" scheme="https://airpoet.github.io/tags/Hadoop/"/>
    
      <category term="Flume" scheme="https://airpoet.github.io/tags/Flume/"/>
    
  </entry>
  
  <entry>
    <title>Azkaban</title>
    <link href="https://airpoet.github.io/2018/06/29/Hadoop/6-Sqoop&amp;Azkaban/Azkaban/"/>
    <id>https://airpoet.github.io/2018/06/29/Hadoop/6-Sqoop&amp;Azkaban/Azkaban/</id>
    <published>2018-06-29T02:46:03.592Z</published>
    <updated>2018-06-29T08:28:30.050Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-å‡ºç°å¥‘æœº"><a href="#1-å‡ºç°å¥‘æœº" class="headerlink" title="1.å‡ºç°å¥‘æœº"></a>1.å‡ºç°å¥‘æœº</h2><p><strong>åº”ç”¨åœºæ™¯ä¸¾ä¾‹:</strong> </p><p>1ã€é€šè¿‡ Hadoop å…ˆå°†åŸå§‹æ•°æ®åŒæ­¥åˆ° HDFS ä¸Š;</p><p>2ã€å€ŸåŠ© MapReduce è®¡ç®—æ¡†æ¶å¯¹åŸå§‹æ•°æ®è¿›è¡Œæ¸…æ´—è½¬æ¢ï¼Œç”Ÿæˆçš„æ•°æ®ä»¥åˆ†åŒºè¡¨çš„å½¢å¼å­˜å‚¨åˆ° å¤šå¼  Hive è¡¨ä¸­;</p><p>3ã€éœ€è¦å¯¹ Hive ä¸­å¤šä¸ªè¡¨çš„æ•°æ®è¿›è¡Œ Join å¤„ç†ï¼Œå¾—åˆ°ä¸€ä¸ªæ˜ç»†æ•°æ® Hive å¤§è¡¨; 4ã€å°†æ˜ç»†æ•°æ®è¿›è¡Œå„ç§ç»Ÿè®¡åˆ†æï¼Œå¾—åˆ°ç»“æœæŠ¥è¡¨ä¿¡æ¯; 5ã€éœ€è¦å°†ç»Ÿè®¡åˆ†æå¾—åˆ°çš„ç»“æœæ•°æ®åŒæ­¥åˆ°ä¸šåŠ¡ç³»ç»Ÿä¸­ï¼Œä¾›ä¸šåŠ¡è°ƒç”¨ä½¿ç”¨ã€‚</p><h2 id="2-å¸¸è§å·¥ä½œæµè°ƒåº¦ç³»ç»Ÿ-amp-å¯¹æ¯”"><a href="#2-å¸¸è§å·¥ä½œæµè°ƒåº¦ç³»ç»Ÿ-amp-å¯¹æ¯”" class="headerlink" title="2.å¸¸è§å·¥ä½œæµè°ƒåº¦ç³»ç»Ÿ &amp; å¯¹æ¯”"></a>2.å¸¸è§å·¥ä½œæµè°ƒåº¦ç³»ç»Ÿ &amp; å¯¹æ¯”</h2><p>åœ¨ Hadoop é¢†åŸŸï¼Œå¸¸è§çš„å·¥ä½œæµè°ƒåº¦å™¨æœ‰ Oozieï¼ŒAzkabanï¼ŒCascadingï¼ŒHamake ç­‰ </p><h4 id="2-1-å„ç§è°ƒåº¦å·¥å…·å¯¹æ¯”"><a href="#2-1-å„ç§è°ƒåº¦å·¥å…·å¯¹æ¯”" class="headerlink" title="2.1.å„ç§è°ƒåº¦å·¥å…·å¯¹æ¯”"></a>2.1.å„ç§è°ƒåº¦å·¥å…·å¯¹æ¯”</h4><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-29-024909.png" alt="image-20180629104909306"></p><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-29-024925.png" alt="image-20180629104925001"></p><h4 id="2-2-Azkaban-ä¸-Oozie-å¯¹æ¯”"><a href="#2-2-Azkaban-ä¸-Oozie-å¯¹æ¯”" class="headerlink" title="2.2.Azkaban ä¸ Oozie å¯¹æ¯”"></a>2.2.Azkaban ä¸ Oozie å¯¹æ¯”</h4><p>ooize ç›¸æ¯” azkaban æ˜¯ä¸€ä¸ªé‡é‡çº§çš„ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿï¼ŒåŠŸèƒ½å…¨é¢ï¼Œä½†é…ç½®ä½¿ç”¨ä¹Ÿæ›´å¤æ‚ã€‚å¦‚æœå¯ä»¥ä¸ åœ¨æ„æŸäº›åŠŸèƒ½çš„ç¼ºå¤±ï¼Œè½»é‡çº§è°ƒåº¦å™¨ azkaban æ˜¯å¾ˆä¸é”™çš„å€™é€‰å¯¹è±¡ã€‚ </p><p><strong>ïµ å·¥ä½œæµå®šä¹‰</strong></p><p>Azkaban ä½¿ç”¨ Properties æ–‡ä»¶å®šä¹‰å·¥ä½œæµ Oozie ä½¿ç”¨ XML æ–‡ä»¶å®šä¹‰å·¥ä½œæµ</p><p><strong>ïµ å®šæ—¶æ‰§è¡Œ</strong></p><p>Azkaban çš„å®šæ—¶æ‰§è¡Œä»»åŠ¡æ˜¯åŸºäºæ—¶é—´çš„ Oozie çš„å®šæ—¶æ‰§è¡Œä»»åŠ¡åŸºäºæ—¶é—´å’Œè¾“å…¥æ•°æ®</p><h4 id="2-3-Azkaban-ç»„ä»¶å…³ç³»"><a href="#2-3-Azkaban-ç»„ä»¶å…³ç³»" class="headerlink" title="2.3.Azkaban ç»„ä»¶å…³ç³»"></a>2.3.Azkaban ç»„ä»¶å…³ç³»</h4><p>å…³ç³»æ•°æ®åº“(ç›®å‰ä»…æ”¯æŒ MySQL) web </p><p>ç®¡ç†æœåŠ¡å™¨-AzkabanWebServer </p><p>æ‰§è¡ŒæœåŠ¡å™¨-AzkabanExecutorServer </p><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-29-025120.png" alt="image-20180629105120180"></p><p>Azkaban ä½¿ç”¨ MySQL æ¥å­˜å‚¨å®ƒçš„çŠ¶æ€ä¿¡æ¯ï¼ŒAzkaban Executor Server å’Œ Azkaban Web Server å‡ä½¿ç”¨åˆ°äº† MySQL æ•°æ®åº“ã€‚ </p><p><strong>å®ƒæœ‰å¦‚ä¸‹åŠŸèƒ½ç‰¹ç‚¹:</strong></p><p>ï‚² Web ç”¨æˆ·ç•Œé¢</p><p>ï‚² æ–¹ä¾¿ä¸Šä¼ å·¥ä½œæµ</p><p>ï‚² æ–¹ä¾¿è®¾ç½®ä»»åŠ¡ä¹‹é—´çš„å…³ç³» ï‚² è°ƒåº¦å·¥ä½œæµ</p><p>ï‚² è®¤è¯/æˆæƒ(æƒé™çš„å·¥ä½œ)</p><p>ï‚² èƒ½å¤Ÿæ€æ­»å¹¶é‡æ–°å¯åŠ¨å·¥ä½œæµ</p><p>ï‚² æ¨¡å—åŒ–å’Œå¯æ’æ‹”çš„æ’ä»¶æœºåˆ¶</p><p>ï‚² é¡¹ç›®å·¥ä½œåŒº</p><p>ï‚² å·¥ä½œæµå’Œä»»åŠ¡çš„æ—¥å¿—è®°å½•å’Œå®¡è®¡</p><h2 id="3-Azkaban-å®‰è£…éƒ¨ç½²"><a href="#3-Azkaban-å®‰è£…éƒ¨ç½²" class="headerlink" title="3.Azkaban å®‰è£…éƒ¨ç½²"></a>3.Azkaban å®‰è£…éƒ¨ç½²</h2><h4 id="3-1å‡†å¤‡å·¥ä½œ"><a href="#3-1å‡†å¤‡å·¥ä½œ" class="headerlink" title="3.1å‡†å¤‡å·¥ä½œ"></a>3.1å‡†å¤‡å·¥ä½œ</h4><p><strong>Azkaban Web æœåŠ¡å™¨</strong>:azkaban-web-server-2.5.0.tar.gz</p><p><strong>Azkaban Excutor æ‰§è¡ŒæœåŠ¡å™¨</strong> :azkaban-executor-server-2.5.0.tar.gz </p><p><strong>Azkaban åˆå§‹åŒ–è„šæœ¬æ–‡ä»¶</strong>:azkaban-sql-script-2.5.0.tar.gz</p><h4 id="3-2å®‰è£…è¯´æ˜"><a href="#3-2å®‰è£…è¯´æ˜" class="headerlink" title="3.2å®‰è£…è¯´æ˜"></a>3.2å®‰è£…è¯´æ˜</h4><p>å°†å®‰è£…æ–‡ä»¶ä¸Šä¼ åˆ°é›†ç¾¤,æœ€å¥½ä¸Šä¼ åˆ°å®‰è£…hiveã€sqoop çš„æœºå™¨ä¸Š,æ–¹ä¾¿å‘½ä»¤çš„æ‰§è¡Œã€‚å¹¶æœ€å¥½åŒ</p><p>ä¸€å­˜æ”¾åœ¨ apps ç›®å½•ä¸‹,ç”¨äºå­˜æ”¾æºå®‰è£…æ–‡ä»¶.æ–°å»º azkaban ç›®å½•,ç”¨äºå­˜æ”¾ azkaban è¿è¡Œç¨‹åº</p><h4 id="3-3è§£å‹"><a href="#3-3è§£å‹" class="headerlink" title="3.3è§£å‹"></a>3.3è§£å‹</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf azkaban-web-server-2.5.0.tar.gz -C /home/apps/ap/azkaban/</span><br><span class="line">tar -zxvf azkaban-executor-server-2.5.0.tar.gz -C /home/apps/ap/azkaban/</span><br><span class="line">tar -zxvf azkaban-sql-script-2.5.0.tar.gz -C /home/apps/ap/azkaban/</span><br></pre></td></tr></table></figure><h4 id="3-4è¿›å…¥-mysql-å¯¼å…¥ä»»åŠ¡-job-è¡¨"><a href="#3-4è¿›å…¥-mysql-å¯¼å…¥ä»»åŠ¡-job-è¡¨" class="headerlink" title="3.4è¿›å…¥ mysql å¯¼å…¥ä»»åŠ¡ job è¡¨"></a>3.4è¿›å…¥ mysql å¯¼å…¥ä»»åŠ¡ job è¡¨</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create database azkaban; </span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br><span class="line">mysql&gt; use azkaban; </span><br><span class="line">Database changed</span><br><span class="line">mysql&gt; source /home/hadoop/apps/azkaban/azkaban-script-2.5.0/create-all-sql-2.5.0.sql;</span><br></pre></td></tr></table></figure><h4 id="3-5åˆ›å»º-SSL-é…ç½®"><a href="#3-5åˆ›å»º-SSL-é…ç½®" class="headerlink" title="3.5åˆ›å»º SSL é…ç½®"></a>3.5åˆ›å»º SSL é…ç½®</h4><p>æœ€å¥½æ˜¯åœ¨ azkaban ç›®å½•ä¸‹æ‰§è¡Œ: </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ‰§è¡Œå‘½ä»¤: </span></span><br><span class="line">keytool -keystore keystore -<span class="built_in">alias</span> jetty -genkey -keyalg RSA</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿è¡Œæ­¤å‘½ä»¤å,ä¼šæç¤ºè¾“å…¥å½“å‰ç”Ÿæˆ keystore çš„å¯†ç åŠç›¸åº”ä¿¡æ¯,è¾“å…¥å¯†ç è¯·åŠ³è®°,ä¿¡æ¯å¦‚ä¸‹:</span></span><br><span class="line">Enter keystore password:</span><br><span class="line">Re-enter new password:</span><br><span class="line">What is your first and last name?</span><br><span class="line">[Unknown]:</span><br><span class="line">What is the name of your organizational unit?</span><br><span class="line">[Unknown]:</span><br><span class="line">What is the name of your organization?</span><br><span class="line">[Unknown]:</span><br><span class="line">What is the name of your City or Locality?</span><br><span class="line">[Unknown]:</span><br><span class="line">What is the name of your State or Province? </span><br><span class="line">[Unknown]:</span><br><span class="line">What is the two-letter country code <span class="keyword">for</span> this unit? </span><br><span class="line">[Unknown]: CN</span><br><span class="line">Is CN=Unknown, OU=Unknown, O=Unknown, L=Unknown, ST=Unknown, C=CN correct? </span><br><span class="line">[no]: y</span><br><span class="line"></span><br><span class="line">Enter key password <span class="keyword">for</span> &lt;jetty&gt;</span><br><span class="line">(RETURN <span class="keyword">if</span> same as keystore password):</span><br><span class="line"></span><br><span class="line">æ­¤æ—¶, ä¼šå‘ç°ç›®å½•ä¸‹æœ‰ä¸€ä¸ª Keystore æ–‡ä»¶</span><br><span class="line"></span><br><span class="line">------------------------------------------</span><br><span class="line">å®Œæˆä¸Šè¿°å·¥ä½œå,å°†åœ¨å½“å‰ç›®å½•ç”Ÿæˆ keystore è¯ä¹¦æ–‡ä»¶,å°† keystore æ‹·è´åˆ° azkaban web æœåŠ¡ å™¨æ ¹ç›®å½•ä¸­.å¦‚:</span><br><span class="line">ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿</span><br><span class="line">cp keystore azkaban-web-2.5.0</span><br></pre></td></tr></table></figure><h4 id="3-6-ä¿®æ”¹é…ç½®æ–‡ä»¶"><a href="#3-6-ä¿®æ”¹é…ç½®æ–‡ä»¶" class="headerlink" title="3.6 ä¿®æ”¹é…ç½®æ–‡ä»¶"></a>3.6 ä¿®æ”¹é…ç½®æ–‡ä»¶</h4><p><strong>æ³¨æ„: é…ç½®æ–‡ä»¶åé¢ä¸€å®šä¸è¦æœ‰ç©ºæ ¼</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">1) ç”Ÿæˆæ—¶åŒºé…ç½®æ–‡ä»¶ Asia/Shanghaiï¼Œç”¨äº¤äº’å¼å‘½ä»¤ tzselect å³å¯, å¦‚æœæœ‰çš„è¯å°±ä¸ç”¨å†ç”Ÿæˆäº†</span><br><span class="line">tzselect</span><br><span class="line"></span><br><span class="line">2) æ‹·è´è¯¥æ—¶åŒºæ–‡ä»¶ï¼Œè¦†ç›–ç³»ç»Ÿæœ¬åœ°æ—¶åŒºé…ç½®</span><br><span class="line">sudo cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span><br><span class="line"></span><br><span class="line">3) ï£¿ï£¿ï£¿ azkaban web æœåŠ¡å™¨é…ç½® ï£¿ï£¿ï£¿</span><br><span class="line"></span><br><span class="line">3.1) ï£¿ é…ç½® web çš„ azkaban.properties ï£¿</span><br><span class="line"><span class="built_in">cd</span> ~/apps/azkaban/azkaban-web-2.5.0/conf/</span><br><span class="line">vi azkaban.properties</span><br><span class="line">ï£¿ ä»¥ä¸‹æ˜¯éœ€è¦ä¿®æ”¹çš„å†…å®¹ ï£¿</span><br><span class="line"><span class="comment">#é»˜è®¤æ ¹ web ç›®å½•</span></span><br><span class="line">web.resource.dir=/home/ap/apps/azkaban/azkaban-web-2.5.0/web</span><br><span class="line"></span><br><span class="line"><span class="comment">#é»˜è®¤æ—¶åŒº,å·²æ”¹ä¸ºäºšæ´²/ä¸Šæµ· é»˜è®¤ä¸ºç¾å›½</span></span><br><span class="line">default.timezone.id=Asia/Shanghai</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç”¨æˆ·é…ç½®,å…·ä½“é…ç½®å‚åŠ ä¸‹æ–‡</span></span><br><span class="line">user.manager.xml.file=/home/ap/apps/azkaban/azkaban-web-2.5.0/conf/azkaban-users.xml</span><br><span class="line"></span><br><span class="line"><span class="comment">#globalé…ç½®æ–‡ä»¶æ‰€åœ¨ä½ç½®</span></span><br><span class="line">executor.global.properties=/home/ap/apps/azkaban/azkaban-executor-2.5.0/conf/global.properties</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ•°æ®åº“ç›¸å…³é…ç½®</span></span><br><span class="line">mysql.host=cs2</span><br><span class="line">mysql.database=azkaban</span><br><span class="line">mysql.user=root</span><br><span class="line">mysql.password=123</span><br><span class="line"></span><br><span class="line"><span class="comment">#SSL æ–‡ä»¶å</span></span><br><span class="line">jetty.keystore=/home/ap/apps/azkaban/azkaban-web-2.5.0/keystore</span><br><span class="line"><span class="comment">#SSL æ–‡ä»¶å¯†ç </span></span><br><span class="line">jetty.password=123456</span><br><span class="line"><span class="comment">#Jetty ä¸»å¯†ç  ä¸ keystore æ–‡ä»¶ç›¸åŒ</span></span><br><span class="line">jetty.keypassword=123456</span><br><span class="line"><span class="comment">#SSL æ–‡ä»¶å</span></span><br><span class="line">jetty.truststore=/home/ap/apps/azkaban/azkaban-web-2.5.0/keystore</span><br><span class="line"><span class="comment"># SSL æ–‡ä»¶å¯†ç </span></span><br><span class="line">jetty.trustpassword=123456</span><br><span class="line"></span><br><span class="line">3.2) é…ç½® web çš„ azkaban-users.xml </span><br><span class="line"><span class="comment"># å¢åŠ  ç®¡ç†å‘˜ç”¨æˆ·</span></span><br><span class="line">vi azkaban-users.xml </span><br><span class="line"></span><br><span class="line">    &lt;azkaban-users&gt;</span><br><span class="line">        &lt;user username=<span class="string">"azkaban"</span> password=<span class="string">"azkaban"</span> roles=<span class="string">"admin"</span> groups=<span class="string">"azkaban"</span>/&gt;</span><br><span class="line">        &lt;user username=<span class="string">"metrics"</span> password=<span class="string">"metrics"</span> roles=<span class="string">"metrics"</span>/&gt;</span><br><span class="line">        <span class="comment"># æ­¤è¡Œæ˜¯åŠ çš„, æŒ‡ç”¨æˆ·åå¯†ç éƒ½ä¸º admin</span></span><br><span class="line">        &lt;user username=<span class="string">"admin"</span> password=<span class="string">"admin"</span> roles=<span class="string">"admin,metrics"</span>/&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;role name=<span class="string">"admin"</span> permissions=<span class="string">"ADMIN"</span>/&gt;</span><br><span class="line">        &lt;role name=<span class="string">"metrics"</span> permissions=<span class="string">"METRICS"</span>/&gt;</span><br><span class="line">    &lt;/azkaban-users&gt;</span><br><span class="line">    </span><br><span class="line">4) ï£¿ï£¿ï£¿ é…ç½®æ‰§è¡ŒæœåŠ¡å™¨ executor ï£¿ï£¿ï£¿</span><br><span class="line"></span><br><span class="line"> <span class="built_in">cd</span> apps/azkaban/azkaban-executor-2.5.0/conf/ </span><br><span class="line"> vi azkaban.properties</span><br><span class="line">-----</span><br><span class="line">ä»¥ä¸‹æ˜¯éœ€è¦ä¿®æ”¹çš„å†…å®¹</span><br><span class="line">------</span><br><span class="line"><span class="comment">#æ—¶åŒº</span></span><br><span class="line">default.timezone.id=Asia/Shanghai </span><br><span class="line"></span><br><span class="line"><span class="comment"># Azkaban JobTypes æ’ä»¶é…ç½®ï¼Œæ’ä»¶æ‰€åœ¨ä½ç½® </span></span><br><span class="line">azkaban.jobtype.plugin.dir=/home/hadoop/apps/azkaban/azkaban-executor-2.5.0/plugins/jobtypes</span><br><span class="line"></span><br><span class="line"><span class="comment">#Loader for projects</span></span><br><span class="line">executor.global.properties=/home/ap/apps/azkaban/azkaban-executor-2.5.0/conf/global.properties</span><br><span class="line"></span><br><span class="line"><span class="comment">#mysql éœ€è¦ä¿®æ”¹çš„åœ°æ–¹</span></span><br><span class="line">mysql.host=cs2</span><br><span class="line">mysql.database=azkaban</span><br><span class="line">mysql.user=root</span><br><span class="line">mysql.password=123</span><br><span class="line"></span><br><span class="line">5)ï£¿ï£¿ï£¿ é…ç½®ç¯å¢ƒå˜é‡ ï£¿ï£¿ï£¿</span><br><span class="line">vi .zshrc </span><br><span class="line"><span class="comment"># azkaban</span></span><br><span class="line"><span class="built_in">export</span> AZKABAN_WEB_HOME=/home/ap/apps/azkaban/azkaban-web-2.5.0</span><br><span class="line"><span class="built_in">export</span> AZKABAN_EXE_HOME=/home/ap/apps/azkaban/azkaban-executor-2.5.0</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$AZKABAN_WEB_HOME</span>/bin:<span class="variable">$AZKABAN_EXE_HOME</span>/bin</span><br></pre></td></tr></table></figure><h4 id="3-7-å¯åŠ¨"><a href="#3-7-å¯åŠ¨" class="headerlink" title="3.7 å¯åŠ¨"></a>3.7 å¯åŠ¨</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">1) ï£¿ï£¿ï£¿ å¯åŠ¨ Azkaban Web Server: ï£¿ï£¿ï£¿</span><br><span class="line"><span class="comment"># ps: .out æ˜¯æ—¥å¿—, å¯ä»¥å…ˆåˆ›å»º logs ç›®å½•, æ—¥å¿—åœ°å€éšä¾¿</span></span><br><span class="line"><span class="comment"># å‰å°å¯åŠ¨</span></span><br><span class="line">azkaban-web-start.sh</span><br><span class="line"><span class="comment"># åå°å¯åŠ¨</span></span><br><span class="line">nohup azkaban-web-start.sh 1&gt;/home/ap/logs/azwebstd.out 2&gt;/home/ap/logs/azweberr.out &amp;</span><br><span class="line"></span><br><span class="line">2) ï£¿ï£¿ï£¿ å¯åŠ¨ Azkaban Executor: ï£¿ï£¿ï£¿</span><br><span class="line"><span class="comment">#å‰å°å¯åŠ¨</span></span><br><span class="line">azkaban-executor-start.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># åå°å¯åŠ¨</span></span><br><span class="line">nohup azkaban-executor-start.sh 1&gt;/home/ap/logs/azexstd.out 2&gt;/home/ap/logs/azexerr.out &amp;</span><br><span class="line"></span><br><span class="line">3) ï£¿ï£¿ï£¿ ç™»å½• webUI ï£¿ï£¿ï£¿</span><br><span class="line">https://cs2:8443/</span><br><span class="line">u: admin</span><br><span class="line">p: admin</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ³¨æ„: é…ç½®åé¢ä¸èƒ½æœ‰ç©ºæ ¼!!!</span></span><br></pre></td></tr></table></figure><h2 id="4-Azkaban-å®æˆ˜æ¼”ç¤º"><a href="#4-Azkaban-å®æˆ˜æ¼”ç¤º" class="headerlink" title="4.Azkaban å®æˆ˜æ¼”ç¤º"></a>4.Azkaban å®æˆ˜æ¼”ç¤º</h2><p><a href="https://app.yinxiang.com/shard/s37/nl/7399077/1545999d-5e3f-47a6-9bc5-fb9c7bfd98f1/" target="_blank" rel="noopener">è§è¿™é‡Œ</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;1-å‡ºç°å¥‘æœº&quot;&gt;&lt;a href=&quot;#1-å‡ºç°å¥‘æœº&quot; class=&quot;headerlink&quot; title=&quot;1.å‡ºç°å¥‘æœº&quot;&gt;&lt;/a&gt;1.å‡ºç°å¥‘æœº&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;åº”ç”¨åœºæ™¯ä¸¾ä¾‹:&lt;/strong&gt; &lt;/p&gt;
&lt;p&gt;1ã€é€šè¿‡ Hadoop å…ˆå°†åŸå§‹æ•°æ®åŒæ­¥åˆ°
      
    
    </summary>
    
      <category term="Hadoop" scheme="https://airpoet.github.io/categories/Hadoop/"/>
    
      <category term="Azkaban" scheme="https://airpoet.github.io/categories/Hadoop/Azkaban/"/>
    
    
      <category term="åŸåˆ›" scheme="https://airpoet.github.io/tags/%E5%8E%9F%E5%88%9B/"/>
    
      <category term="æŠ€æœ¯" scheme="https://airpoet.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="Hadoop" scheme="https://airpoet.github.io/tags/Hadoop/"/>
    
      <category term="Azkaban" scheme="https://airpoet.github.io/tags/Azkaban/"/>
    
  </entry>
  
  <entry>
    <title>Sqoop</title>
    <link href="https://airpoet.github.io/2018/06/28/Hadoop/6-Sqoop&amp;Azkaban/Sqoop/"/>
    <id>https://airpoet.github.io/2018/06/28/Hadoop/6-Sqoop&amp;Azkaban/Sqoop/</id>
    <published>2018-06-28T01:45:13.084Z</published>
    <updated>2018-06-29T11:51:12.925Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-ä½œç”¨"><a href="#1-ä½œç”¨" class="headerlink" title="1. ä½œç”¨"></a>1. ä½œç”¨</h2><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-28-123439.png" alt="image-20180628203438952"></p><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-28-123419.png" alt="image-20180628203419288"></p><p>Sqoop æ˜¯ Apache æ——ä¸‹ä¸€æ¬¾â€œHadoop å’Œå…³ç³»æ•°æ®åº“æœåŠ¡å™¨ä¹‹é—´ä¼ é€æ•°æ®â€çš„å·¥å…·ã€‚</p><p><strong>å¯¼å…¥æ•°æ®</strong>ï¼š<strong>MySQLï¼ŒOracle å¯¼å…¥æ•°æ®åˆ° Hadoop çš„ HDFSã€HIVEã€HBASE ç­‰æ•°æ®å­˜å‚¨ç³»ç»Ÿ</strong></p><p><strong>å¯¼å‡ºæ•°æ®</strong>ï¼šä» Hadoop çš„æ–‡ä»¶ç³»ç»Ÿä¸­å¯¼å‡ºæ•°æ®åˆ°å…³ç³»æ•°æ®åº“ MySQL ç­‰</p><p>Sqoop çš„æœ¬è´¨è¿˜æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œå’Œ HDFSï¼ŒHive ç›¸æ¯”ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆé«˜æ·±çš„ç†è®ºã€‚</p><h2 id="2-å·¥ä½œæœºåˆ¶"><a href="#2-å·¥ä½œæœºåˆ¶" class="headerlink" title="2.å·¥ä½œæœºåˆ¶"></a>2.å·¥ä½œæœºåˆ¶</h2><p>å°†å¯¼å…¥å¯¼å‡ºå‘½ä»¤ç¿»è¯‘æˆ MapReduce ç¨‹åºæ¥å®ç°</p><p>åœ¨ç¿»è¯‘å‡ºçš„ MapReduce ä¸­ä¸»è¦æ˜¯å¯¹ InputFormat å’Œ OutputFormat è¿›è¡Œå®šåˆ¶</p><h2 id="3-å®‰è£…"><a href="#3-å®‰è£…" class="headerlink" title="3.å®‰è£…"></a>3.å®‰è£…</h2><p>æ³¨æ„: ç›®å½•ä¸‹è¦æœ‰hive, å› ä¸ºè¦æ‹¿åˆ° hive çš„ home, æ‰§è¡Œ hive æ“ä½œ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">1ã€ å‡†å¤‡å®‰è£…åŒ… sqoop-1.4.6.bin_hadoop-2.0.4-alpha.tar.gz</span><br><span class="line"></span><br><span class="line">2ã€ è§£å‹å®‰è£…åŒ…åˆ°å®‰è£…ç›®å½•</span><br><span class="line">tar -zxvf sqoop-1.4.6.bin_hadoop-2.0.4-alpha.tar.gz -C apps/ cd apps</span><br><span class="line">mv sqoop-1.4.6.bin_hadoop-2.0.4-alpha/ sqoop-1.4.6</span><br><span class="line"></span><br><span class="line">3ã€ è¿›å…¥åˆ° conf æ–‡ä»¶å¤¹ï¼Œæ‰¾åˆ° sqoop-env-template.shï¼Œä¿®æ”¹å…¶åç§°ä¸º sqoop-env.sh cd conf</span><br><span class="line">mv sqoop-env-template.sh sqoop-env.sh</span><br><span class="line"></span><br><span class="line">4ã€ ä¿®æ”¹ sqoop-env.sh</span><br><span class="line"><span class="comment">-----</span></span><br><span class="line">export HADOOP_COMMON_HOME=/home/ap/apps/hadoop export HADOOP_MAPRED_HOME=/home/ap/apps/hadoop export HBASE_HOME=/home/ap/apps/hbase</span><br><span class="line">export HIVE_HOME=/home/ap/apps/hive</span><br><span class="line">export ZOOCFGDIR=/home/ap/apps/zookeeper/conf</span><br><span class="line"><span class="comment">-----</span></span><br><span class="line"></span><br><span class="line">5ã€ åŠ å…¥ mysql é©±åŠ¨åŒ…åˆ° sqoop-1.4.6/lib ç›®å½•ä¸‹</span><br><span class="line">cp mysql-connector-java-5.1.40-bin.jar ~/apps/sqoop-1.4.6/lib/</span><br><span class="line"></span><br><span class="line">6ã€ é…ç½®ç³»ç»Ÿç¯å¢ƒå˜é‡ vi ~/.bashrc</span><br><span class="line">ç„¶åè¾“å…¥:</span><br><span class="line">export SQOOP_HOME=/home/hadoop/apps/sqoop-1.4.6 export PATH=$PATH:$SQOOP_HOME/bin</span><br><span class="line">ç„¶åä¿å­˜é€€å‡º</span><br><span class="line">source ~/.bashrc</span><br><span class="line"></span><br><span class="line">7ã€ éªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸ</span><br><span class="line">sqoop-version æˆ–è€… sqoopversion</span><br><span class="line"></span><br><span class="line">ps : å¹å‡ºç°è­¦å‘Š, ä¸ç”¨ç®¡</span><br><span class="line"><span class="comment">---</span></span><br><span class="line">[ap@cs2]~% sqoop version</span><br><span class="line">Warning: /home/ap/apps/sqoop/../hcatalog does not exist! HCatalog jobs will fail.</span><br><span class="line">Please <span class="keyword">set</span> $HCAT_HOME <span class="keyword">to</span> the root <span class="keyword">of</span> your HCatalog installation.</span><br><span class="line"><span class="keyword">Warning</span>: /home/ap/apps/sqoop/../accumulo does <span class="keyword">not</span> exist! Accumulo imports will fail.</span><br><span class="line">Please <span class="keyword">set</span> $ACCUMULO_HOME <span class="keyword">to</span> the root <span class="keyword">of</span> your Accumulo installation.</span><br><span class="line"><span class="keyword">Warning</span>: /home/ap/apps/sqoop/../zookeeper does <span class="keyword">not</span> exist! Accumulo imports will fail.</span><br><span class="line">Please <span class="keyword">set</span> $ZOOKEEPER_HOME <span class="keyword">to</span> the root <span class="keyword">of</span> your Zookeeper installation.</span><br><span class="line"><span class="number">18</span>/<span class="number">06</span>/<span class="number">28</span> <span class="number">20</span>:<span class="number">43</span>:<span class="number">52</span> INFO sqoop.Sqoop: Running Sqoop <span class="keyword">version</span>: <span class="number">1.4</span><span class="number">.6</span></span><br><span class="line">Sqoop <span class="number">1.4</span><span class="number">.6</span></span><br><span class="line">git <span class="keyword">commit</span> <span class="keyword">id</span> c0c5a81723759fa575844a0a1eae8f510fa32c25</span><br><span class="line"><span class="keyword">Compiled</span> <span class="keyword">by</span> root <span class="keyword">on</span> Mon Apr <span class="number">27</span> <span class="number">14</span>:<span class="number">38</span>:<span class="number">36</span> CST <span class="number">2015</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">8</span>\ ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿  å¯ä»¥é…ç½®è®°ä½å¯†ç  ï£¿ï£¿ï£¿ï£¿ï£¿</span><br><span class="line">ä½†æ˜¯å¥½åƒä¸èµ·ä½œç”¨???</span><br><span class="line"></span><br><span class="line">æŸ¥çœ‹ä»»åŠ¡è¯¦ç»†æˆ–è€…æ‰§è¡Œä»»åŠ¡çš„æ—¶å€™ä¸è¾“å…¥å¯†ç   å…å¯†</span><br><span class="line">[sqoop-site.xml]</span><br><span class="line">æ·»åŠ : </span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;<span class="keyword">name</span>&gt;sqoop.metastore.client.record.password&lt;/<span class="keyword">name</span>&gt;</span><br><span class="line">        &lt;<span class="keyword">value</span>&gt;<span class="literal">true</span>&lt;/<span class="keyword">value</span>&gt;</span><br><span class="line">        &lt;description&gt;<span class="keyword">If</span> <span class="literal">true</span>, <span class="keyword">allow</span> saved passwords <span class="keyword">in</span> the metastore.&lt;/description&gt;</span><br><span class="line">    &lt;/property&gt;</span><br></pre></td></tr></table></figure><h2 id="4-åŸºæœ¬ä½¿ç”¨"><a href="#4-åŸºæœ¬ä½¿ç”¨" class="headerlink" title="4. åŸºæœ¬ä½¿ç”¨"></a>4. åŸºæœ¬ä½¿ç”¨</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1) sqoop <span class="keyword">help</span> : æŸ¥çœ‹å¸®åŠ©</span><br><span class="line"><span class="number">2</span>) sqoop <span class="keyword">help</span> <span class="keyword">import</span> : è¿›ä¸€æ­¥å±‚çº§æŸ¥çœ‹</span><br></pre></td></tr></table></figure><h2 id="5-Sqoop-æ•°æ®å¯¼å…¥"><a href="#5-Sqoop-æ•°æ®å¯¼å…¥" class="headerlink" title="5. Sqoop æ•°æ®å¯¼å…¥"></a>5. Sqoop æ•°æ®å¯¼å…¥</h2><h5 id="å¸¸ç”¨æŒ‡ä»¤"><a href="#å¸¸ç”¨æŒ‡ä»¤" class="headerlink" title="å¸¸ç”¨æŒ‡ä»¤"></a>å¸¸ç”¨æŒ‡ä»¤</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--connectæŒ‡å®šæ•°æ®åº“é“¾æ¥url</span></span><br><span class="line"><span class="comment">--usernameæŒ‡å®šæ•°æ®åº“çš„ç”¨æˆ·å</span></span><br><span class="line"><span class="comment">--passwordæŒ‡å®šæ•°æ®åº“çš„å¯†ç </span></span><br><span class="line"><span class="comment">--tableæŒ‡å®šè¦å¯¼å‡ºæ•°æ®çš„mysqlæ•°æ®åº“è¡¨</span></span><br><span class="line">-mæŒ‡å®šMapTaskçš„ä¸ªæ•°</span><br><span class="line"><span class="comment">--target-diræŒ‡å®šå¯¼å‡ºæ•°æ®åœ¨HDFSä¸Šçš„å­˜å‚¨ç›®å½•</span></span><br><span class="line"><span class="comment">--fields-terminated-byæŒ‡å®šæ¯æ¡è®°å½•ä¸­å­—æ®µä¹‹é—´çš„åˆ†éš”ç¬¦</span></span><br><span class="line"><span class="comment">--whereæŒ‡å®šæŸ¥è¯¢SQLçš„whereæ¡ä»¶</span></span><br><span class="line"><span class="comment">--queryæŒ‡å®šæŸ¥è¯¢SQL</span></span><br><span class="line"><span class="comment">--columnsæŒ‡å®šæŸ¥è¯¢åˆ—</span></span><br></pre></td></tr></table></figure><h4 id="5-1-list-mysql-çš„æ•°æ®åº“-amp-è¡¨-å¤åˆ¶mysql-ä¸­è¡¨ç»“æ„ç›¸åŒè¡¨-â€“-gt-hive"><a href="#5-1-list-mysql-çš„æ•°æ®åº“-amp-è¡¨-å¤åˆ¶mysql-ä¸­è¡¨ç»“æ„ç›¸åŒè¡¨-â€“-gt-hive" class="headerlink" title="5.1  list mysql çš„æ•°æ®åº“ &amp; è¡¨, å¤åˆ¶mysql ä¸­è¡¨ç»“æ„ç›¸åŒè¡¨ â€“&gt; hive"></a>5.1  list mysql çš„æ•°æ®åº“ &amp; è¡¨, å¤åˆ¶mysql ä¸­è¡¨ç»“æ„ç›¸åŒè¡¨ â€“&gt; hive</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">åˆ—å‡ºMySQLæ•°æ®æœ‰å“ªäº›æ•°æ®åº“ï¼š</span><br><span class="line">ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿</span><br><span class="line">sqoop list-databases \</span><br><span class="line"><span class="comment">--connect jdbc:mysql://cs2:3306/ \</span></span><br><span class="line"><span class="comment">--username root \</span></span><br><span class="line"><span class="comment">--password 123</span></span><br><span class="line"></span><br><span class="line">åˆ—å‡ºMySQLä¸­çš„æŸä¸ªæ•°æ®åº“æœ‰å“ªäº›æ•°æ®è¡¨ï¼š</span><br><span class="line">ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿</span><br><span class="line">sqoop list-tables \</span><br><span class="line"><span class="comment">--connect jdbc:mysql://cs2:3306/mysql \</span></span><br><span class="line"><span class="comment">--username root \</span></span><br><span class="line"><span class="comment">--password 123</span></span><br><span class="line"></span><br><span class="line">åˆ›å»ºä¸€å¼ è·Ÿmysqlä¸­çš„help_keywordè¡¨ä¸€æ ·çš„hiveè¡¨hkï¼š(æ²¡æœ‰æ•°æ®è²Œä¼¼)</span><br><span class="line">ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿</span><br><span class="line">sqoop <span class="keyword">create</span>-hive-<span class="keyword">table</span> \</span><br><span class="line"><span class="comment">--connect jdbc:mysql://cs2:3306/mysql \</span></span><br><span class="line"><span class="comment">--username root \</span></span><br><span class="line"><span class="comment">--password 123 \</span></span><br><span class="line"><span class="comment">--table help_keyword \</span></span><br><span class="line"><span class="comment">--hive-table hk</span></span><br></pre></td></tr></table></figure><h4 id="5-2-å¯¼å…¥-mysqlä¸­è¡¨-åˆ°-HDFS"><a href="#5-2-å¯¼å…¥-mysqlä¸­è¡¨-åˆ°-HDFS" class="headerlink" title="5.2 å¯¼å…¥ mysqlä¸­è¡¨ åˆ° HDFS"></a>5.2 å¯¼å…¥ mysqlä¸­è¡¨ åˆ° HDFS</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿</span><br><span class="line">å¯¼å…¥MySQLè¡¨ä¸­æ•°æ®åˆ°HDFSä¸­ï¼š</span><br><span class="line">ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿</span><br><span class="line">// æ™®é€šå¯¼å…¥ï¼šå¯¼å…¥mysqlåº“ä¸­çš„help_keywordçš„æ•°æ®åˆ°HDFSä¸Šçš„é»˜è®¤è·¯å¾„ï¼š/user/ap/help_keyword</span><br><span class="line">sqoop import   \</span><br><span class="line"><span class="comment">--connect jdbc:mysql://cs2:3306/mysql   \</span></span><br><span class="line"><span class="comment">--username root  \</span></span><br><span class="line"><span class="comment">--password 123   \</span></span><br><span class="line"><span class="comment">--table help_keyword   \</span></span><br><span class="line">-m 1</span><br><span class="line"></span><br><span class="line">æœ€åçš„1,æ˜¯æŒ‡ä½¿ç”¨1ä¸ª mapTask </span><br><span class="line">å¯¼å…¥åˆ°hdfså, å¯ä»¥ä½¿ç”¨ hdfs dfs -text /.... æŸ¥çœ‹æ•°æ®</span><br><span class="line"><span class="comment">----</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// å¯¼å…¥ï¼š æŒ‡å®šåˆ†éš”ç¬¦ &amp; å¯¼å…¥è·¯å¾„ &amp; mapTask ä¸ªæ•°</span><br><span class="line">ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿</span><br><span class="line">sqoop import   \</span><br><span class="line"><span class="comment">--connect jdbc:mysql://cs2:3306/mysql   \</span></span><br><span class="line"><span class="comment">--username root  \</span></span><br><span class="line"><span class="comment">--password 123   \</span></span><br><span class="line"><span class="comment">--table help_keyword   \</span></span><br><span class="line"><span class="comment">--target-dir /user/ap/my_help_keyword1  \</span></span><br><span class="line"><span class="comment">--fields-terminated-by '\t'  \</span></span><br><span class="line">-m 3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// å¯¼å…¥æ•°æ®ï¼šå¸¦whereæ¡ä»¶</span><br><span class="line">ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿</span><br><span class="line">sqoop import   \</span><br><span class="line"><span class="comment">--connect jdbc:mysql://cs2:3306/mysql   \</span></span><br><span class="line"><span class="comment">--username root  \</span></span><br><span class="line"><span class="comment">--password 123   \</span></span><br><span class="line"><span class="comment">--where "name='STRING' " \</span></span><br><span class="line"><span class="comment">--table help_keyword   \</span></span><br><span class="line"><span class="comment">--target-dir /user/ap/my_help_keyword2  \</span></span><br><span class="line">-m 1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// æŸ¥è¯¢æŒ‡å®šåˆ—</span><br><span class="line"><span class="comment">-------------å‘ç°ä¸€ä¸ªç»“è®º, å¦‚æœå¯åŠ¨3ä¸ª mapper, ä½†æ˜¯æœ€ååªæœ‰ä¸€ä¸ªç»“è®º, åªä¼šç”Ÿæˆä¸€ä¸ªç»“æœæ–‡ä»¶</span></span><br><span class="line">ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿</span><br><span class="line">sqoop import   \</span><br><span class="line"><span class="comment">--connect jdbc:mysql://cs2:3306/mysql   \</span></span><br><span class="line"><span class="comment">--username root  \</span></span><br><span class="line"><span class="comment">--password 123   \</span></span><br><span class="line"><span class="comment">--columns "name" \</span></span><br><span class="line"><span class="comment">--where "name='STRING' " \</span></span><br><span class="line"><span class="comment">--table help_keyword  \</span></span><br><span class="line"><span class="comment">--target-dir /user/ap/my_help_keyword3  \</span></span><br><span class="line">-m 3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// å¯¼å…¥ï¼šæŒ‡å®šè‡ªå®šä¹‰æŸ¥è¯¢SQL</span><br><span class="line"><span class="comment">--------------ç–‘ç‚¹:  split-by çš„ä½œç”¨, å’Œ -m æ•°é‡çš„å…³ç³»</span></span><br><span class="line">ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿</span><br><span class="line">sqoop import   \</span><br><span class="line"><span class="comment">--connect jdbc:mysql://cs2:3306/mysql   \</span></span><br><span class="line"><span class="comment">--username root  \</span></span><br><span class="line"><span class="comment">--password 123   \</span></span><br><span class="line"><span class="comment">--target-dir /user/ap/my_help_keyword4  \</span></span><br><span class="line"><span class="comment">--query 'select help_keyword_id,name from help_keyword WHERE $CONDITIONS and  name = "STRING"' \</span></span><br><span class="line"><span class="comment">--split-by  help_keyword_id \</span></span><br><span class="line"><span class="comment">--fields-terminated-by '\t'  \</span></span><br><span class="line">-m 1</span><br><span class="line"></span><br><span class="line"><span class="comment">----------------------------</span></span><br><span class="line">sqoop import  \</span><br><span class="line"><span class="comment">--connect jdbc:mysql://cs2:3306/mysql \</span></span><br><span class="line"><span class="comment">--username root  \</span></span><br><span class="line"><span class="comment">--password 123  \</span></span><br><span class="line"><span class="comment">--target-dir /user/hadoop/my_help_keyword5 \</span></span><br><span class="line"><span class="comment">--query "select help_keyword_id,name from help_keyword WHERE \$CONDITIONS"  \</span></span><br><span class="line"><span class="comment">--split-by  help_keyword_id \</span></span><br><span class="line"><span class="comment">--fields-terminated-by '\t' \</span></span><br><span class="line">-m 1</span><br><span class="line"></span><br><span class="line"># åœ¨ä»¥ä¸Šéœ€è¦æŒ‰ç…§è‡ªå®šä¹‰SQLè¯­å¥å¯¼å‡ºæ•°æ®åˆ°HDFSçš„æƒ…å†µä¸‹ï¼š</span><br><span class="line">1ã€å¼•å·é—®é¢˜ï¼Œè¦ä¹ˆå¤–å±‚ä½¿ç”¨å•å¼•å·ï¼Œå†…å±‚ä½¿ç”¨åŒå¼•å·ï¼Œ$CONDITIONSçš„$ç¬¦å·ä¸ç”¨è½¬ä¹‰ï¼Œ è¦ä¹ˆå¤–å±‚ä½¿ç”¨åŒå¼•å·ï¼Œé‚£ä¹ˆå†…å±‚ä½¿ç”¨å•å¼•å·ï¼Œç„¶å$CONDITIONSçš„$ç¬¦å·éœ€è¦è½¬ä¹‰</span><br><span class="line">2ã€è‡ªå®šä¹‰çš„SQLè¯­å¥ä¸­å¿…é¡»å¸¦æœ‰WHERE \$CONDITIONS</span><br></pre></td></tr></table></figure><h4 id="5-3-å¯¼å…¥MySQLæ•°æ®åº“ä¸­çš„è¡¨æ•°æ®åˆ°Hiveä¸­ï¼š"><a href="#5-3-å¯¼å…¥MySQLæ•°æ®åº“ä¸­çš„è¡¨æ•°æ®åˆ°Hiveä¸­ï¼š" class="headerlink" title="5.3 å¯¼å…¥MySQLæ•°æ®åº“ä¸­çš„è¡¨æ•°æ®åˆ°Hiveä¸­ï¼š"></a>5.3 å¯¼å…¥MySQLæ•°æ®åº“ä¸­çš„è¡¨æ•°æ®åˆ°Hiveä¸­ï¼š</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿</span><br><span class="line">å¯¼å…¥MySQLæ•°æ®åº“ä¸­çš„è¡¨æ•°æ®åˆ°Hiveä¸­ï¼š</span><br><span class="line">ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿</span><br><span class="line">// æ™®é€šå¯¼å…¥ï¼šæ•°æ®å­˜å‚¨åœ¨é»˜è®¤çš„default hiveåº“ä¸­ï¼Œè¡¨åå°±æ˜¯å¯¹åº”çš„mysqlçš„è¡¨åï¼š</span><br><span class="line">// é€šè¿‡å¯¹æ¯”å‘ç°, sqoop æ˜¯é»˜è®¤å¯¼å…¥åˆ° hdfs çš„, å¯¼å…¥åˆ°hdfsæ—¶, ä¸ç”¨åŠ é¢å¤–çš„å‚æ•°</span><br><span class="line"></span><br><span class="line">sqoop import   \</span><br><span class="line"><span class="comment">--connect jdbc:mysql://cs2:3306/mysql  \</span></span><br><span class="line"><span class="comment">--username root  \</span></span><br><span class="line"><span class="comment">--password 123  \</span></span><br><span class="line"><span class="comment">--table help_keyword  \</span></span><br><span class="line"><span class="comment">--hive-import \</span></span><br><span class="line">-m 1</span><br><span class="line"></span><br><span class="line">hadoop fs -cat /user/myhive/warehouse/help_keyword/part-m-00000     // æŸ¥çœ‹æ•°æ®</span><br><span class="line">å½“ç„¶ä¹Ÿå¯ä»¥åœ¨ hive ä¸­æŸ¥çœ‹æ•°æ®</span><br><span class="line"></span><br><span class="line">// æŒ‡å®šè¡Œåˆ†éš”ç¬¦å’Œåˆ—åˆ†éš”ç¬¦ï¼ŒæŒ‡å®šhive-importï¼ŒæŒ‡å®šè¦†ç›–å¯¼å…¥ï¼ŒæŒ‡å®šè‡ªåŠ¨åˆ›å»ºhiveè¡¨ï¼ŒæŒ‡å®šè¡¨åï¼ŒæŒ‡å®šåˆ é™¤ä¸­é—´ç»“æœæ•°æ®ç›®å½• </span><br><span class="line"></span><br><span class="line">Database does not exist: mydb_test ???</span><br><span class="line">æ³¨æ„: è¦å…ˆåˆ›å»º database mydb_test</span><br><span class="line">é—®é¢˜: ä¸ºä»€ä¹ˆå¯¼å‡ºå, å˜æˆäº†4ä¸ªå—</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sqoop import  \</span><br><span class="line"><span class="comment">--connect jdbc:mysql://cs2:3306/mysql  \</span></span><br><span class="line"><span class="comment">--username root  \</span></span><br><span class="line"><span class="comment">--password 123  \</span></span><br><span class="line"><span class="comment">--table help_keyword  \</span></span><br><span class="line"><span class="comment">--fields-terminated-by "\t"  \</span></span><br><span class="line"><span class="comment">--lines-terminated-by "\n"  \</span></span><br><span class="line"><span class="comment">--hive-import  \</span></span><br><span class="line"><span class="comment">--hive-overwrite  \</span></span><br><span class="line"><span class="comment">--create-hive-table  \</span></span><br><span class="line"><span class="comment">--delete-target-dir \</span></span><br><span class="line"><span class="comment">--hive-database mydb_test \</span></span><br><span class="line"><span class="comment">--hive-table new_help_keyword</span></span><br><span class="line"></span><br><span class="line">å¦å¤–ä¸€ç§å†™æ³•ï¼š</span><br><span class="line">sqoop import  \</span><br><span class="line"><span class="comment">--connect jdbc:mysql://cs2:3306/mysql  \</span></span><br><span class="line"><span class="comment">--username root  \</span></span><br><span class="line"><span class="comment">--password 123  \</span></span><br><span class="line"><span class="comment">--table help_keyword  \</span></span><br><span class="line"><span class="comment">--fields-terminated-by "\t"  \</span></span><br><span class="line"><span class="comment">--lines-terminated-by "\n"  \</span></span><br><span class="line"><span class="comment">--hive-import  \</span></span><br><span class="line"><span class="comment">--hive-overwrite  \</span></span><br><span class="line"><span class="comment">--create-hive-table  \</span></span><br><span class="line"><span class="comment">--hive-table mydb_test.new_help_keyword1 \</span></span><br><span class="line"><span class="comment">--delete-target-dir</span></span><br></pre></td></tr></table></figure><h4 id="5-4-å¢é‡å¯¼å…¥åˆ°-HDFS"><a href="#5-4-å¢é‡å¯¼å…¥åˆ°-HDFS" class="headerlink" title="5.4 å¢é‡å¯¼å…¥åˆ° HDFS"></a>5.4 å¢é‡å¯¼å…¥åˆ° HDFS</h4><p>â€”-åº”è¯¥ä¹Ÿæ˜¯å¯ä»¥å¯¼å…¥åˆ° Hive</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿</span><br><span class="line">ç¬¬ä¸‰éƒ¨åˆ†ï¼šå¢é‡å¯¼å…¥</span><br><span class="line">ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿</span><br><span class="line">Incremental import arguments:</span><br><span class="line">   <span class="comment">--check-column &lt;column&gt;        Source column to check for incremental</span></span><br><span class="line">                                  <span class="keyword">change</span>  åŸå§‹çš„åˆ—ä½œä¸ºå¢é•¿æ”¹å˜çš„</span><br><span class="line">   <span class="comment">--incremental &lt;import-type&gt;    Define an incremental import of type</span></span><br><span class="line">                                  <span class="string">'append'</span> <span class="keyword">or</span> <span class="string">'lastmodified'</span></span><br><span class="line">   <span class="comment">--last-value &lt;value&gt;           Last imported value in the incremental</span></span><br><span class="line">                                  <span class="keyword">check</span> <span class="keyword">column</span></span><br><span class="line">ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿</span><br><span class="line">æ¯”è¾ƒä½¿ç”¨äºè‡ªå¢é•¿ä¸»é”®!! </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// å¢é‡å¯¼å…¥</span><br><span class="line">ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿</span><br><span class="line"></span><br><span class="line">sqoop <span class="keyword">import</span>   \</span><br><span class="line"><span class="comment">--connect jdbc:mysql://cs2:3306/mysql   \</span></span><br><span class="line"><span class="comment">--username root  \</span></span><br><span class="line"><span class="comment">--password 123   \</span></span><br><span class="line"><span class="comment">--table help_keyword  \</span></span><br><span class="line"><span class="comment">--target-dir /user/ap/my_help_keyword_import1  \</span></span><br><span class="line"><span class="comment">--incremental  append  \</span></span><br><span class="line"><span class="comment">--check-column  help_keyword_id \</span></span><br><span class="line"><span class="comment">--last-value 500  \</span></span><br><span class="line">-m <span class="number">3</span></span><br></pre></td></tr></table></figure><h4 id="5-5-ç¬¬å››éƒ¨åˆ†ï¼š-å¯¼å…¥æ•°æ®åˆ°HBase"><a href="#5-5-ç¬¬å››éƒ¨åˆ†ï¼š-å¯¼å…¥æ•°æ®åˆ°HBase" class="headerlink" title="5.5 ç¬¬å››éƒ¨åˆ†ï¼š å¯¼å…¥æ•°æ®åˆ°HBase"></a>5.5 ç¬¬å››éƒ¨åˆ†ï¼š å¯¼å…¥æ•°æ®åˆ°HBase</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿</span><br><span class="line">ç¬¬å››éƒ¨åˆ†ï¼š å¯¼å…¥æ•°æ®åˆ°HBase</span><br><span class="line">ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿</span><br><span class="line"></span><br><span class="line">å¯¼å…¥MySQLæ•°æ®åº“ä¸­çš„è¡¨æ•°æ®åˆ°HBaseä¸­ï¼š</span><br><span class="line"></span><br><span class="line">sqoop import  \</span><br><span class="line"><span class="comment">--connect jdbc:mysql://cs2:3306/mysql  \</span></span><br><span class="line"><span class="comment">--username root  \</span></span><br><span class="line"><span class="comment">--password 123  \</span></span><br><span class="line"><span class="comment">--table help_keyword  \</span></span><br><span class="line"><span class="comment">--hbase-table new_help_keyword  \</span></span><br><span class="line"><span class="comment">--column-family person  \</span></span><br><span class="line"><span class="comment">--hbase-row-key help_keyword_id</span></span><br></pre></td></tr></table></figure><h4 id="5-6-å¯¼å‡º"><a href="#5-6-å¯¼å‡º" class="headerlink" title="5.6 å¯¼å‡º"></a>5.6 å¯¼å‡º</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿</span><br><span class="line">ç¬¬äº”éƒ¨åˆ†ï¼šå¯¼å‡ºï¼š</span><br><span class="line">ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿</span><br><span class="line"></span><br><span class="line">æ³¨æ„ï¼šå¯¼å‡ºçš„RDBMSçš„è¡¨å¿…é¡»è‡ªå·±é¢„å…ˆåˆ›å»ºï¼Œä¸ä¼šè‡ªåŠ¨åˆ›å»º</span><br><span class="line"><span class="comment">------mysql-----å…ˆåœ¨ mysql ä¸­åˆ›å»ºåº“</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> sqoopdb <span class="keyword">default</span> <span class="built_in">character</span> <span class="keyword">set</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci; </span><br><span class="line"><span class="keyword">use</span> sqoopdb;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> sqoopstudent ( </span><br><span class="line">   <span class="keyword">id</span> <span class="built_in">INT</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> PRIMARY <span class="keyword">KEY</span>, </span><br><span class="line">   <span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>), </span><br><span class="line">   sex <span class="built_in">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">   age <span class="built_in">INT</span>,</span><br><span class="line">department <span class="built_in">VARCHAR</span>(<span class="number">20</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// å¯¼å‡ºHDFSæ•°æ®åˆ°MySQLï¼š</span><br><span class="line">ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿</span><br><span class="line"></span><br><span class="line">sqoop export \</span><br><span class="line"><span class="comment">--connect jdbc:mysql://cs2:3306/sqoopdb  \</span></span><br><span class="line"><span class="comment">--username root \</span></span><br><span class="line"><span class="comment">--password 123 \</span></span><br><span class="line"><span class="comment">--table sqoopstudent \</span></span><br><span class="line"><span class="comment">--export-dir /sqoopdata \</span></span><br><span class="line"><span class="comment">--fields-terminated-by ','</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// å¯¼å‡ºhiveæ•°æ®åˆ°MySQLï¼š</span><br><span class="line">sqoop export \</span><br><span class="line"><span class="comment">--connect jdbc:mysql://cs2:3306/sqoopdb \</span></span><br><span class="line"><span class="comment">--username root \</span></span><br><span class="line"><span class="comment">--password 123 \</span></span><br><span class="line"><span class="comment">--table uv_info \</span></span><br><span class="line"><span class="comment">--export-dir /user/hive/warehouse/uv/dt=2011-08-03 \</span></span><br><span class="line"><span class="comment">--input-fields-terminated-by '\t'</span></span><br></pre></td></tr></table></figure><h4 id="5-6-å¯¼å‡ºHBaseæ•°æ®åˆ°MySQL"><a href="#5-6-å¯¼å‡ºHBaseæ•°æ®åˆ°MySQL" class="headerlink" title="5.6 å¯¼å‡ºHBaseæ•°æ®åˆ°MySQL"></a>5.6 å¯¼å‡ºHBaseæ•°æ®åˆ°MySQL</h4><p>å¾ˆé—æ†¾ï¼Œç°åœ¨è¿˜æ²¡æœ‰ç›´æ¥çš„å‘½ä»¤å°† HBase çš„æ•°æ®å¯¼å‡ºåˆ° MySQL</p><p>ä¸€èˆ¬é‡‡ç”¨å¦‚ä¸‹ 3 ç§æ–¹æ³•:</p><p>1ã€å°† HBase æ•°æ®ï¼Œæ‰å¹³åŒ–æˆ HDFS æ–‡ä»¶ï¼Œç„¶åå†ç”± sqoop å¯¼å…¥</p><p>2ã€å°† HBase æ•°æ®å¯¼å…¥ Hive è¡¨ä¸­ï¼Œç„¶åå†å¯¼å…¥ MySQL</p><p>3ã€ç›´æ¥ä½¿ç”¨ HBase çš„ Java API è¯»å–è¡¨æ•°æ®ï¼Œç›´æ¥å‘ MySQL å¯¼å…¥ï¼Œä¸éœ€è¦ä½¿ç”¨ sqoop</p><h4 id="5-7-sqoop-æ”¯æŒ-amp-ä¸æ”¯æŒ"><a href="#5-7-sqoop-æ”¯æŒ-amp-ä¸æ”¯æŒ" class="headerlink" title="5.7 sqoop æ”¯æŒ &amp; ä¸æ”¯æŒ"></a>5.7 sqoop æ”¯æŒ &amp; ä¸æ”¯æŒ</h4><p>hdfs to mysql   å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚ï¼ï¼<br>hive to mysql   å°±æ˜¯hdfs to mysql<br>hbase to mysql   å¾ˆä¸å¹¸ï¼Œä¸æ”¯æŒã€‚ï¼</p><p>æ€ä¹ˆå®ç°ï¼Ÿ</p><pre><code>1ã€æ‰å¹³åŒ–åˆ°HDFS2ã€hbaseå’Œhiveåšæ•´åˆ3ã€è‡ªå·±ç¼–å†™ç¨‹åºå»å®ç°ä»HBASEå½“ä¸­è¯»å–æ•°æ®ï¼Œç„¶åå†™å…¥åˆ°mYsql</code></pre><h2 id="6-Sqoop-Job-ä½œä¸š"><a href="#6-Sqoop-Job-ä½œä¸š" class="headerlink" title="6.Sqoop Job ä½œä¸š"></a>6.Sqoop Job ä½œä¸š</h2><p><strong>æŸ¥çœ‹å¸®åŠ©:</strong> </p><p><code>sqoop help job</code></p><h4 id="6-0-mysql-åˆ›å»ºæ•°æ®åº“-spider-å’Œ-è¡¨-lagou"><a href="#6-0-mysql-åˆ›å»ºæ•°æ®åº“-spider-å’Œ-è¡¨-lagou" class="headerlink" title="6.0 mysql åˆ›å»ºæ•°æ®åº“ spider å’Œ è¡¨ lagou"></a>6.0 mysql åˆ›å»ºæ•°æ®åº“ spider å’Œ è¡¨ lagou</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># è¿™æ ·å¯ä»¥ç›´æ¥å¯¼å…¥ sql æ•°æ®</span><br><span class="line">source /home/ap/temp/lagou.sql</span><br></pre></td></tr></table></figure><h4 id="6-1-åˆ›å»ºä½œä¸š-Job-â€“create"><a href="#6-1-åˆ›å»ºä½œä¸š-Job-â€“create" class="headerlink" title="6.1 åˆ›å»ºä½œä¸š Job (â€“create)"></a>6.1 åˆ›å»ºä½œä¸š Job (â€“create)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ³¨æ„: mysql ä¸­æ­¤æ—¶å·²ç»å­˜åœ¨ spider åº“, åº“ä¸­æœ‰ lagou è¡¨</span></span><br><span class="line"><span class="comment"># ps: å¯¼å…¥è¡¨</span></span><br><span class="line"></span><br><span class="line">sqoop job --create my_sqoop_job \</span><br><span class="line">-- import \</span><br><span class="line">--connect jdbc:mysql://cs2:3306/spider \</span><br><span class="line">--username root \</span><br><span class="line">--password 123 \</span><br><span class="line">--table lagou</span><br></pre></td></tr></table></figure><h4 id="6-2-æŸ¥çœ‹ä½œä¸š-Job-â€“list"><a href="#6-2-æŸ¥çœ‹ä½œä¸š-Job-â€“list" class="headerlink" title="6.2 æŸ¥çœ‹ä½œä¸š Job (â€“list)"></a>6.2 æŸ¥çœ‹ä½œä¸š Job (â€“list)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sqoop job --list</span><br><span class="line">----------------------</span><br><span class="line">Available <span class="built_in">jobs</span>:</span><br><span class="line">  my_sqoop_job</span><br></pre></td></tr></table></figure><h4 id="6-3-æŸ¥çœ‹ä½œä¸šè¯¦ç»†ä¿¡æ¯-â€“show"><a href="#6-3-æŸ¥çœ‹ä½œä¸šè¯¦ç»†ä¿¡æ¯-â€“show" class="headerlink" title="6.3 æŸ¥çœ‹ä½œä¸šè¯¦ç»†ä¿¡æ¯ (â€“show)"></a>6.3 æŸ¥çœ‹ä½œä¸šè¯¦ç»†ä¿¡æ¯ (â€“show)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqoop job --show my_sqoop_job</span><br></pre></td></tr></table></figure><h4 id="6-4-æ‰§è¡Œä½œä¸š"><a href="#6-4-æ‰§è¡Œä½œä¸š" class="headerlink" title="6.4 æ‰§è¡Œä½œä¸š"></a>6.4 æ‰§è¡Œä½œä¸š</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqoop job --<span class="built_in">exec</span> my_sqoop_job</span><br></pre></td></tr></table></figure><h4 id="6-5-åˆ é™¤ä½œä¸š"><a href="#6-5-åˆ é™¤ä½œä¸š" class="headerlink" title="6.5 åˆ é™¤ä½œä¸š"></a>6.5 åˆ é™¤ä½œä¸š</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqoop job --delete my_sqoop_job</span><br></pre></td></tr></table></figure><h2 id="7-Sqoop-å¯¼å…¥å¯¼å‡ºåŸç†"><a href="#7-Sqoop-å¯¼å…¥å¯¼å‡ºåŸç†" class="headerlink" title="7.Sqoop å¯¼å…¥å¯¼å‡ºåŸç†"></a>7.Sqoop å¯¼å…¥å¯¼å‡ºåŸç†</h2><h4 id="7-1-å¯¼å…¥åŸç†"><a href="#7-1-å¯¼å…¥åŸç†" class="headerlink" title="7.1 å¯¼å…¥åŸç†"></a>7.1 å¯¼å…¥åŸç†</h4><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-29-092721.png" alt="image-20180629172721667"></p><p>1ã€ç¬¬ä¸€æ­¥ï¼ŒSqoop ä¼šé€šè¿‡ JDBC æ¥è·å–æ‰€éœ€è¦çš„æ•°æ®åº“å…ƒæ•°æ®ï¼Œä¾‹å¦‚ï¼Œå¯¼å…¥è¡¨çš„åˆ—åï¼Œæ•°æ® ç±»å‹ç­‰ã€‚</p><p>2ã€ç¬¬äºŒæ­¥ï¼Œè¿™äº›æ•°æ®åº“çš„æ•°æ®ç±»å‹(varchar, number ç­‰)ä¼šè¢«æ˜ å°„æˆ Java çš„æ•°æ®ç±»å‹(String, int ç­‰)ï¼Œæ ¹æ®è¿™äº›ä¿¡æ¯ï¼ŒSqoop ä¼šç”Ÿæˆä¸€ä¸ªä¸è¡¨ååŒåçš„ç±»ç”¨æ¥å®Œæˆåºåˆ—åŒ–å·¥ä½œï¼Œä¿å­˜è¡¨ä¸­çš„ æ¯ä¸€è¡Œè®°å½•ã€‚</p><p>3ã€ç¬¬ä¸‰æ­¥ï¼ŒSqoop å¯åŠ¨ MapReducer ä½œä¸š</p><p>4ã€ç¬¬å››æ­¥ï¼Œå¯åŠ¨çš„ä½œä¸šåœ¨ input çš„è¿‡ç¨‹ä¸­ï¼Œä¼šé€šè¿‡ JDBC è¯»å–æ•°æ®è¡¨ä¸­çš„å†…å®¹ï¼Œè¿™æ—¶ï¼Œä¼šä½¿ ç”¨ Sqoop ç”Ÿæˆçš„ç±»è¿›è¡Œååºåˆ—åŒ–æ“ä½œ</p><p>5ã€ç¬¬äº”æ­¥ï¼Œæœ€åå°†è¿™äº›è®°å½•å†™åˆ° HDFS ä¸­ï¼Œåœ¨å†™å…¥åˆ° HDFS çš„è¿‡ç¨‹ä¸­ï¼ŒåŒæ ·ä¼šä½¿ç”¨ Sqoop ç”Ÿ æˆçš„ç±»è¿›è¡Œååºåˆ—åŒ–</p><h4 id="7-2-å¯¼å‡ºåŸç†"><a href="#7-2-å¯¼å‡ºåŸç†" class="headerlink" title="7.2 å¯¼å‡ºåŸç†"></a>7.2 å¯¼å‡ºåŸç†</h4><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-29-092707.png" alt="image-20180629172706382"></p><p>1ã€ ç¬¬ä¸€æ­¥ï¼Œsqoop ä¾ç„¶ä¼šé€šè¿‡ JDBC è®¿é—®å…³ç³»å‹æ•°æ®åº“ï¼Œå¾—åˆ°éœ€è¦å¯¼å‡ºæ•°æ®çš„å…ƒæ•°æ®ä¿¡æ¯</p><p>2ã€ ç¬¬äºŒæ­¥ï¼Œæ ¹æ®è·å–åˆ°çš„å…ƒæ•°æ®çš„ä¿¡æ¯ï¼Œsqoop ç”Ÿæˆä¸€ä¸ª Java ç±»ï¼Œç”¨æ¥è¿›è¡Œæ•°æ®çš„ä¼ è¾“è½½</p><p>  ä½“ã€‚è¯¥ç±»å¿…é¡»å®ç°åºåˆ—åŒ–å’Œååºåˆ—åŒ–</p><p>3ã€ ç¬¬ä¸‰æ­¥ï¼Œå¯åŠ¨ mapreduce ä½œä¸š</p><p>4ã€ ç¬¬å››æ­¥ï¼Œsqoop åˆ©ç”¨ç”Ÿæˆçš„è¿™ä¸ª java ç±»ï¼Œå¹¶è¡Œçš„ä» hdfs ä¸­è¯»å–æ•°æ®</p><p>5ã€ ç¬¬äº”æ­¥ï¼Œæ¯ä¸ª map ä½œä¸šéƒ½ä¼šæ ¹æ®è¯»å–åˆ°çš„å¯¼å‡ºè¡¨çš„å…ƒæ•°æ®ä¿¡æ¯å’Œè¯»å–åˆ°çš„æ•°æ®ï¼Œç”Ÿæˆä¸€ æ‰¹ insert è¯­å¥ï¼Œç„¶åå¤šä¸ª map ä½œä¸šä¼šå¹¶è¡Œçš„å‘æ•°æ®åº“ mysql ä¸­æ’å…¥æ•°æ®</p><p>æ‰€ä»¥ï¼Œæ•°æ®æ˜¯ä» hdfs ä¸­å¹¶è¡Œçš„è¿›è¡Œè¯»å–ï¼Œä¹Ÿæ˜¯å¹¶è¡Œçš„è¿›å…¥å†™å…¥ï¼Œé‚£å¹¶è¡Œçš„è¯»å–æ˜¯ä¾èµ– hdfs çš„æ€§èƒ½ï¼Œè€Œå¹¶è¡Œçš„å†™å…¥åˆ° mysql ä¸­ï¼Œé‚£å°±è¦ä¾èµ–äº mysql çš„å†™å…¥æ€§èƒ½å˜ã€‚</p><p><a href="http://sqoop.apache.org/docs/" target="_blank" rel="noopener"><strong>å®˜ç½‘:</strong></a> </p><p><a href="https://app.yinxiang.com/shard/s37/nl/7399077/8530b06a-e01c-42fb-a833-7f14c918e0da/" target="_blank" rel="noopener"><strong>å‚è€ƒPDF:</strong></a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;1-ä½œç”¨&quot;&gt;&lt;a href=&quot;#1-ä½œç”¨&quot; class=&quot;headerlink&quot; title=&quot;1. ä½œç”¨&quot;&gt;&lt;/a&gt;1. ä½œç”¨&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-28-
      
    
    </summary>
    
      <category term="Hadoop" scheme="https://airpoet.github.io/categories/Hadoop/"/>
    
      <category term="Sqoop" scheme="https://airpoet.github.io/categories/Hadoop/Sqoop/"/>
    
    
      <category term="åŸåˆ›" scheme="https://airpoet.github.io/tags/%E5%8E%9F%E5%88%9B/"/>
    
      <category term="æŠ€æœ¯" scheme="https://airpoet.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="Hadoop" scheme="https://airpoet.github.io/tags/Hadoop/"/>
    
      <category term="Sqoop" scheme="https://airpoet.github.io/tags/Sqoop/"/>
    
  </entry>
  
  <entry>
    <title>i-HBase-1</title>
    <link href="https://airpoet.github.io/2018/06/26/Hadoop/5-HBase/i-HBase-1/"/>
    <id>https://airpoet.github.io/2018/06/26/Hadoop/5-HBase/i-HBase-1/</id>
    <published>2018-06-26T01:47:42.704Z</published>
    <updated>2018-06-29T16:51:50.191Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Hbaseæ¦‚å¿µ"><a href="#Hbaseæ¦‚å¿µ" class="headerlink" title="Hbaseæ¦‚å¿µ"></a>Hbaseæ¦‚å¿µ</h2><ul><li><p>hbase &amp; hdfs å…³ç³»å›¾</p><p><img src="https://img.mubu.com/document_image/40f0d2a9-20f1-4f73-84d9-e31b52685aad-584150.jpg" alt="img"></p></li><li><p>hadoopæ•°æ®åº“ï¼Œåˆ†å¸ƒå¼å¯ä¼¸ç¼©å¤§å‹æ•°æ®å­˜å‚¨ã€‚</p></li><li><p>ç”¨æˆ·å¯¹éšæœºã€å®æ—¶è¯»å†™æ•°æ®ã€‚</p></li><li><p>åäº¿è¡Œ x ç™¾ä¸‡åˆ—ã€‚    </p></li><li><p>ç‰ˆæœ¬åŒ–ã€éå…³ç³»å‹æ•°æ®åº“ã€‚</p></li></ul><h2 id="Feature"><a href="#Feature" class="headerlink" title="Feature"></a>Feature</h2><ul><li>Linear and modular scalability.<br> //çº¿æ€§æ¨¡å—åŒ–æ‰©å±•æ–¹å¼ã€‚</li><li>Strictly consistent reads and writes.<br> //ä¸¥æ ¼ä¸€è‡´æ€§è¯»å†™</li><li>Automatic and configurable sharding of tables<br>//è‡ªåŠ¨å¯é…ç½®è¡¨åˆ‡å‰²</li><li>Automatic failover support between RegionServers.<br>//åŒºåŸŸæœåŠ¡å™¨ä¹‹é—´è‡ªåŠ¨å®¹åœ¨</li><li>Convenient base classes for backing Hadoop MapReduce jobs with Apache HBase tables.        </li><li>Easy to use Java API for client access.<br>//java API</li><li>Block cache and Bloom Filters for real-time queries<br>//å—ç¼“å­˜å’Œå¸ƒéš†è¿‡æ»¤å™¨ç”¨äºå®æ—¶æŸ¥è¯¢</li><li>Query predicate push down via server side Filters<br>//é€šè¿‡æœåŠ¡å™¨ç«¯è¿‡æ»¤å™¨å®ç°æŸ¥è¯¢é¢„æµ‹</li><li>Thrift gateway and a REST-ful Web service that supports XML, Protobuf, and binary data encoding options    </li><li>Extensible jruby-based (JIRB) shell                    </li><li>Support for exporting metrics via the Hadoop metrics subsystem to files or Ganglia; or via JMX<br> //å¯è§†åŒ–</li><li>é¢å‘åˆ—æ•°æ®åº“ã€‚</li></ul><h2 id="HBaseè¦ç‚¹"><a href="#HBaseè¦ç‚¹" class="headerlink" title="HBaseè¦ç‚¹"></a>HBaseè¦ç‚¹</h2><ul><li>1) å®ƒä»‹äº NoSQL å’Œ RDBMS ä¹‹é—´ï¼Œä»…èƒ½é€šè¿‡ä¸»é”®(rowkey)å’Œä¸»é”®çš„ range æ¥æ£€ç´¢æ•°æ®</li><li>2) HBase æŸ¥è¯¢æ•°æ®åŠŸèƒ½å¾ˆç®€å•ï¼Œä¸æ”¯æŒ join ç­‰å¤æ‚æ“ä½œ</li><li>3) ä¸æ”¯æŒå¤æ‚çš„äº‹åŠ¡ï¼Œåªæ”¯æŒè¡Œçº§äº‹åŠ¡(å¯é€šè¿‡ hive æ”¯æŒæ¥å®ç°å¤šè¡¨ join ç­‰å¤æ‚æ“ä½œ)ã€‚</li><li>4) HBase ä¸­æ”¯æŒçš„æ•°æ®ç±»å‹:byte<a href="åº•å±‚æ‰€æœ‰æ•°æ®çš„å­˜å‚¨éƒ½æ˜¯å­—èŠ‚æ•°ç»„"></a></li><li>5) ä¸»è¦ç”¨æ¥å­˜å‚¨ç»“æ„åŒ–å’ŒåŠç»“æ„åŒ–çš„æ¾æ•£æ•°æ®ã€‚</li></ul><h2 id="HBase-è¡¨ç‰¹ç‚¹"><a href="#HBase-è¡¨ç‰¹ç‚¹" class="headerlink" title="HBase è¡¨ç‰¹ç‚¹"></a>HBase è¡¨ç‰¹ç‚¹</h2><ul><li>å¤§:ä¸€ä¸ªè¡¨å¯ä»¥æœ‰ä¸Šåäº¿è¡Œï¼Œä¸Šç™¾ä¸‡åˆ—</li><li>é¢å‘åˆ—:é¢å‘åˆ—(æ—)çš„å­˜å‚¨å’Œæƒé™æ§åˆ¶ï¼Œåˆ—(ç°‡)ç‹¬ç«‹æ£€ç´¢ã€‚</li><li>ç¨€ç–:å¯¹äºä¸ºç©º(null)çš„åˆ—ï¼Œå¹¶ä¸å ç”¨å­˜å‚¨ç©ºé—´ï¼Œå› æ­¤ï¼Œè¡¨å¯ä»¥è®¾è®¡çš„éå¸¸ç¨€ç–ã€‚</li><li>æ— æ¨¡å¼:æ¯è¡Œéƒ½æœ‰ä¸€ä¸ªå¯æ’åºçš„ä¸»é”®å’Œä»»æ„å¤šçš„åˆ—ï¼Œåˆ—å¯ä»¥æ ¹æ®éœ€è¦åŠ¨æ€çš„å¢åŠ ï¼ŒåŒä¸€ å¼ è¡¨ä¸­ä¸åŒçš„è¡Œå¯ä»¥æœ‰æˆªç„¶ä¸åŒçš„åˆ—</li></ul><h2 id="HBase-å­˜å‚¨æœºåˆ¶"><a href="#HBase-å­˜å‚¨æœºåˆ¶" class="headerlink" title="HBase å­˜å‚¨æœºåˆ¶"></a>HBase å­˜å‚¨æœºåˆ¶</h2><ul><li>é¢å‘åˆ—å­˜å‚¨ï¼Œtableæ˜¯æŒ‰rowæ’åºã€‚</li><li>åº•å±‚æ˜¯ è·³è¡¨ &amp; å¸ƒéš†è¿‡æ»¤å™¨</li></ul><h2 id="HBase-å®šä½æœºåˆ¶-ä¸‰çº§åæ ‡"><a href="#HBase-å®šä½æœºåˆ¶-ä¸‰çº§åæ ‡" class="headerlink" title="HBase å®šä½æœºåˆ¶(ä¸‰çº§åæ ‡)"></a>HBase å®šä½æœºåˆ¶(ä¸‰çº§åæ ‡)</h2><ul><li>è¡Œ<br>rowkey</li><li>åˆ—æ— &amp; åˆ—<br>column family &amp; column</li><li>æ—¶é—´æˆ³<br>timestampç‰ˆæœ¬</li></ul><h2 id="è¡¨-è¡Œ-åˆ—-åˆ—æ—çš„å…³ç³»"><a href="#è¡¨-è¡Œ-åˆ—-åˆ—æ—çš„å…³ç³»" class="headerlink" title="è¡¨ è¡Œ åˆ— åˆ—æ—çš„å…³ç³»"></a>è¡¨ è¡Œ åˆ— åˆ—æ—çš„å…³ç³»</h2><ul><li><p>å®˜ç½‘çš„å…³ç³»å›¾å¦‚ä¸‹</p><p><img src="https://img.mubu.com/document_image/d4572c94-9da5-463f-a721-0c4dc42b87db-584150.jpg" alt="img"></p></li><li><p>å…¶å®ƒç‰ˆæœ¬</p><p><img src="https://img.mubu.com/document_image/feb7a6a8-6dfb-463a-8d57-181502d3d0e9-584150.jpg" alt="img"></p></li><li><p>Table is a collection of rows.<br>è¡¨æ˜¯è¡Œçš„é›†åˆ</p></li><li><p>Row is a collection of column families<br>è¡Œæ˜¯åˆ—æ—çš„é›†åˆ</p></li><li><p>Column family is a collection of columns.<br>åˆ—æ—æ˜¯åˆ—çš„é›†åˆ</p></li><li><p>Column is a collection of key value pairs.<br>åˆ—æ˜¯é”®å€¼å¯¹çš„é›†åˆ(åˆ—å…¶å®å°±æ˜¯ key)</p></li></ul><h2 id="RowKey-Column-Family-TimeStamp-Cell-æ¦‚å¿µè§£é‡Š"><a href="#RowKey-Column-Family-TimeStamp-Cell-æ¦‚å¿µè§£é‡Š" class="headerlink" title="RowKey, Column Family, TimeStamp, Cell æ¦‚å¿µè§£é‡Š"></a>RowKey, Column Family, TimeStamp, Cell æ¦‚å¿µè§£é‡Š</h2><ul><li>RowKey æ˜¯ç”¨æ¥æ£€ç´¢è®°å½•çš„ä¸»é”®<ul><li>rowkey è¡Œé”®å¯ä»¥æ˜¯ä»»æ„å­—ç¬¦ä¸²(æœ€å¤§é•¿åº¦æ˜¯ 64KBï¼Œå®é™…åº”ç”¨ä¸­é•¿åº¦ä¸€èˆ¬ä¸º 10-100bytes)ï¼Œæœ€å¥½æ˜¯ 16ã€‚<ul><li>æ¯ä¸€ä¸ªç‰©ç†æ–‡ä»¶ä¸­éƒ½ä¼šå­˜ä¸€ä¸ª rk:TODO ??</li></ul></li><li>åœ¨ HBase å†…éƒ¨ï¼Œrowkey ä¿å­˜ä¸ºå­—èŠ‚æ•°ç»„ã€‚HBase ä¼šå¯¹è¡¨ä¸­çš„æ•°æ®æŒ‰ç…§ rowkey æ’åº (å­—å…¸é¡ºåº)</li><li>è®¾è®¡ key æ—¶ï¼Œè¦å……åˆ†æ’åºå­˜å‚¨è¿™ ä¸ªç‰¹æ€§ï¼Œå°†ç»å¸¸ä¸€èµ·è¯»å–çš„è¡Œå­˜å‚¨æ”¾åˆ°ä¸€èµ·ã€‚(ä½ç½®ç›¸å…³æ€§)</li><li>æ³¨æ„ï¼šå­—å…¸åºå¯¹ int æ’åºçš„ç»“æœæ˜¯1,10,100,11,12,13,14,15,16,17,18,19,2,20,21,â€¦9,91,92,93,94,95,96,97,98,99ã€‚è¦ä¿æŒæ•´å½¢çš„è‡ªç„¶åºï¼Œè¡Œé”®å¿…é¡»ç”¨ 0 ä½œå·¦å¡«å……ã€‚</li></ul></li><li>Column Family åˆ—æ—æ˜¯è¡¨çš„ Schema çš„ä¸€éƒ¨åˆ†(è€Œåˆ—ä¸æ˜¯)ï¼Œå¿…é¡»åœ¨ä½¿ç”¨è¡¨ä¹‹å‰å®šä¹‰å¥½ï¼Œè€Œä¸”å®šä¹‰å¥½äº†ä¹‹åå°±ä¸èƒ½æ›´æ”¹ã€‚<ul><li>HBase è¡¨ä¸­çš„æ¯ä¸ªåˆ—ï¼Œéƒ½å½’å±ä¸æŸä¸ªåˆ—ç°‡ã€‚</li><li>åˆ—ç°‡è¶Šå¤šï¼Œåœ¨å–ä¸€è¡Œæ•°æ®æ—¶æ‰€è¦å‚ä¸ IOã€æœå¯»çš„æ–‡ä»¶å°±è¶Šå¤šï¼Œæ‰€ä»¥ï¼Œå¦‚æœæ²¡æœ‰å¿…è¦ï¼Œä¸è¦ è®¾ç½®å¤ªå¤šçš„åˆ—ç°‡ï¼ˆæœ€å¥½å°±ä¸€ä¸ªåˆ—ç°‡ï¼‰</li></ul></li><li>TimeStamp<ul><li>HBase ä¸­é€šè¿‡ rowkey å’Œ columns ç¡®å®šçš„ä¸ºä¸€ä¸ªå­˜å‚¨å•å…ƒç§°ä¸º cellã€‚</li><li>æ¯ä¸ª cell éƒ½ä¿å­˜ç€åŒä¸€ä»½ æ•°æ®çš„å¤šä¸ªç‰ˆæœ¬ã€‚</li><li>ç‰ˆæœ¬é€šè¿‡æ—¶é—´æˆ³æ¥ç´¢å¼•ã€‚</li><li>æ¯ä¸ª cell ä¸­ï¼Œä¸åŒç‰ˆæœ¬çš„æ•°æ®æŒ‰ç…§æ—¶é—´å€’åºæ’åºï¼Œå³æœ€æ–°çš„æ•°æ®æ’åœ¨æœ€å‰é¢ã€‚</li><li>hbase æä¾›äº†ä¸¤ç§æ•°æ®ç‰ˆ æœ¬å›æ”¶æ–¹å¼:<ul><li>ä¿å­˜æ•°æ®çš„æœ€å n ä¸ªç‰ˆæœ¬</li><li>ä¿å­˜æœ€è¿‘ä¸€æ®µæ—¶é—´å†…çš„ç‰ˆæœ¬(è®¾ç½®æ•°æ®çš„ç”Ÿå‘½å‘¨æœŸ TTL)ã€‚</li></ul></li></ul></li><li>Cell å•å…ƒæ ¼<ul><li>ç”±{rowkey, column( =<family> + <column>), version} å”¯ä¸€ç¡®å®šçš„å•å…ƒã€‚</column></family></li><li>Cell ä¸­çš„æ•°æ®æ˜¯æ²¡æœ‰ç±»å‹çš„ï¼Œå…¨éƒ¨æ˜¯å­—èŠ‚ç å½¢å¼å­˜è´®ã€‚</li></ul></li></ul><h2 id="HBase-çš„HAæ­å»º"><a href="#HBase-çš„HAæ­å»º" class="headerlink" title="HBase çš„HAæ­å»º"></a>HBase çš„HAæ­å»º</h2><ul><li><p>é€‰æ‹©å®‰è£…çš„ä¸»æœºcs1~cs4, å®‰è£…jdk, è§£å‹hbase åŒ…, é…ç½®ç¯å¢ƒå˜é‡</p></li><li><p>éªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸ<br>$&gt;hbase version</p></li><li><p>é…ç½® hbase å®Œå…¨åˆ†å¸ƒå¼<br>[hbase/conf/<a href="http://hbase-env.sh" target="_blank" rel="noopener">hbase-env.sh</a>]<br>export JAVA_HOME=/usr/local/jdk1.8.0_73<br>export HBASE_MANAGES_ZK=false</p><p>[hbse-site.xml]</p><!-- ä½¿ç”¨å®Œå…¨åˆ†å¸ƒå¼ --><property><br>    <name>hbase.cluster.distributed</name><br>    <value>true</value><br></property><br><!-- æŒ‡å®šhbaseæ•°æ®åœ¨hdfsä¸Šçš„å­˜æ”¾è·¯å¾„,å­˜å‚¨è·¯å¾„ç”± namenode æ¥ç»Ÿä¸€ç®¡ç† --><br><property><br>    <name>hbase.rootdir</name><br>    <value><a href="hdfs://mycluster/hbase" target="_blank" rel="noopener">hdfs://mycluster/hbase</a></value><br></property><br><!-- é…ç½®zkåœ°å€ --><br><property><br>    <name>hbase.zookeeper.quorum</name><br>    <value>cs1:2181,cs2:2181,cs3:2181</value><br></property><br><!-- zkçš„æœ¬åœ°ç›®å½• --><br><property><br>    <name>hbase.zookeeper.property.dataDir</name><br>    <value>/home/ap/zookeeper</value><br></property> </li><li><p>é…ç½® regonservers<br>[hbase/conf/regionservers]<br>cs2<br>cs3<br>cs4<br>cs5</p></li><li><p>ä¿®æ”¹ backup-mastersï¼ˆè‡ªè¡Œåˆ›å»ºï¼‰ï¼ŒæŒ‡å®šå¤‡ç”¨çš„ä¸»HMaster</p><h2 id="vi-backup-masters"><a href="#vi-backup-masters" class="headerlink" title="vi backup-masters"></a>vi backup-masters</h2><p>cs6</p></li><li><p>æœ€é‡è¦ä¸€æ­¥:</p><ul><li>å‚»é€¼ç‰ˆ:<ul><li>è¦æŠŠ hadoop çš„ hdfs-site.xml å’Œ core-site.xml æ”¾åˆ° hbase/conf ä¸‹, è¿™æ ·hbase æ‰èƒ½é€šè¿‡å‘½åç©ºé—´mycluster æ‰¾åˆ°å½“å‰å¯ç”¨ namenode, å†é€šè¿‡ namenode åˆ†é…æŒ‡å®š hbase åœ¨ HDFSä¸Šçš„å­˜å‚¨è·¯å¾„<br>cp <sub>/apps/hadoop/etc/hadoop/core-site.xml </sub>/apps/hbase/conf/<br>cp <sub>/apps/hadoop/etc/hadoop/hdfs-site.xml </sub>/apps/hbase/conf/</li></ul></li><li>é«˜çº§ç‰ˆ:<ul><li>åœ¨hbase-env.shæ–‡ä»¶æ·»åŠ hadoopé…ç½®æ–‡ä»¶ç›®å½•åˆ°HBASE_CLASSPATHç¯å¢ƒå˜é‡å¹¶åˆ†å‘.<br>[/soft/hbase/conf/<a href="http://hbase-env.sh" target="_blank" rel="noopener">hbase-env.sh</a>]<br>export HBASE_CLASSPATH=$HBASE_CLASSPATH:/soft/hadoop/etc/hadoop </li><li>åœ¨hbase/conf/ç›®å½•ä¸‹åˆ›å»ºåˆ°hadoopçš„hdfs-site.xmlç¬¦å·è¿æ¥ã€‚<br>$&gt;ln -s /soft/hadoop/etc/hadoop/hdfs-site.xml /soft/hbase/conf/hdfs-site.xml</li></ul></li></ul></li><li><p>å¯åŠ¨ hbase é›†ç¾¤<br>$&gt;<a href="http://start-hbase.sh" target="_blank" rel="noopener">start-hbase.sh</a></p></li><li><p>ç™»å½• hbase çš„ webUI</p></li></ul><p>  <a href="http://cs1:16010/" target="_blank" rel="noopener">http://cs1:16010/</a></p><ul><li>æ³¨æ„, é¡µé¢ä¸Šæ˜¾ç¤ºçš„ç‰ˆæœ¬, æ˜¯~/apps/hbase/libä¸­è‡ªå·±å­˜å‚¨çš„ jar åŒ…çš„ç‰ˆæœ¬</li></ul><h2 id="å¯åŠ¨-åœæ­¢-hbase-è¿›ç¨‹"><a href="#å¯åŠ¨-åœæ­¢-hbase-è¿›ç¨‹" class="headerlink" title="å¯åŠ¨/åœæ­¢ hbase è¿›ç¨‹"></a>å¯åŠ¨/åœæ­¢ hbase è¿›ç¨‹</h2><ul><li><a href="http://start-hbase.sh" target="_blank" rel="noopener">start-hbase.sh</a></li></ul><p>  ç­‰ä»·äº</p><ul><li>hbase-daemon.sh start master</li><li>hbase-daemons.sh start regionserver</li><li>æ³¨æ„: åœ¨å“ªä¸ªèŠ‚ç‚¹å¯åŠ¨ <a href="http://start-hbase.sh" target="_blank" rel="noopener">start-hbase.sh</a> , å°±åœ¨å“ªé‡Œå¯åŠ¨ HMaster è¿›ç¨‹, å¦‚æœ</li></ul><ul><li><a href="http://stop-hbase.sh" target="_blank" rel="noopener">stop-hbase.sh</a><br>åœæ­¢ hbase</li></ul><h2 id="HBase-shell-æ“ä½œ"><a href="#HBase-shell-æ“ä½œ" class="headerlink" title="HBase shell æ“ä½œ"></a>HBase shell æ“ä½œ</h2><h4 id="ç™»å½•shellç»ˆç«¯"><a href="#ç™»å½•shellç»ˆç«¯" class="headerlink" title="ç™»å½•shellç»ˆç«¯."></a>ç™»å½•shellç»ˆç«¯.</h4><ul><li>$hbase&gt; hbase shell                           </li></ul><h4 id="help-ç›¸å…³"><a href="#help-ç›¸å…³" class="headerlink" title="help ç›¸å…³"></a>help ç›¸å…³</h4><ul><li>$hbase&gt; help<br>æŸ¥çœ‹æ‰€æœ‰å¸®åŠ©</li><li>$hbase&gt; table_help<br>å…³äºè¡¨æ“ä½œçš„å¦å¤–ä¸€ç§æ–¹å¼çš„å¸®åŠ©æ–‡æ¡£</li><li>$hbase&gt; help â€œdmlâ€<br>è·å–ä¸€ç»„å‘½ä»¤çš„æç¤º</li><li>$hbase&gt;help  â€˜list_namespaceâ€™<br>æŸ¥çœ‹ç‰¹å®šçš„å‘½ä»¤å¸®åŠ©</li></ul><h4 id="desc-æŸ¥çœ‹æè¿°ä¿¡æ¯"><a href="#desc-æŸ¥çœ‹æè¿°ä¿¡æ¯" class="headerlink" title="desc æŸ¥çœ‹æè¿°ä¿¡æ¯"></a>desc æŸ¥çœ‹æè¿°ä¿¡æ¯</h4><ul><li>desc â€˜t1â€™ : ä¸‹é¢è¿™äº›åœ¨å»ºè¡¨çš„æ—¶å€™éƒ½å¯ä»¥æŒ‡å®š<br>{NAME =&gt; â€˜f1â€™, BLOOMFILTER =&gt; â€˜ROWâ€™, VERSIONS =&gt; â€˜1â€™, IN_MEMORY =&gt; â€˜falseâ€™, KEEP_DELETED_CELLS =&gt;<br> â€˜FALSEâ€™, DATA_BLOCK_ENCODING =&gt; â€˜NONEâ€™, TTL =&gt; â€˜FOREVERâ€™, COMPRESSION =&gt; â€˜NONEâ€™, MIN_VERSIONS =&gt;<br> â€˜0â€™, BLOCKCACHE =&gt; â€˜trueâ€™, BLOCKSIZE =&gt; â€˜65536â€™, REPLICATION_SCOPE =&gt; â€˜0â€™}<br>1 row(s) in 0.1780 seconds</li></ul><h4 id="list-ç›¸å…³"><a href="#list-ç›¸å…³" class="headerlink" title="list ç›¸å…³"></a>list ç›¸å…³</h4><ul><li>$hbase&gt; list<br>åˆ—å‡ºæ‰€æœ‰éç³»ç»Ÿè¡¨</li><li>$hbase&gt;list_namespace<br>åˆ—å‡ºåå­—ç©ºé—´(æ•°æ®åº“)</li><li>$hbase&gt;list_namespace_tables â€˜defalutâ€™<br>åˆ—å‡ºåå­—ç©ºé—´çš„æ‰€ä»¥è¡¨</li></ul><h4 id="create-ç›¸å…³"><a href="#create-ç›¸å…³" class="headerlink" title="create ç›¸å…³"></a>create ç›¸å…³</h4><ul><li>$hbase&gt;create_namespace â€˜ns1â€™<br>åˆ›å»ºåå­—ç©ºé—´</li><li>$hbase&gt;create â€˜ns1:t1â€™,â€™f1â€™<br>åˆ›å»ºè¡¨,æŒ‡å®šç©ºé—´ä¸‹,åˆ—æ—<br>æ³¨æ„: å¦‚æœ t1å·²ç»åˆ›å»ºäº†, å°±ä¸èƒ½é€šè¿‡è¿™ä¸ªæ–¹å¼æ¥æ·»åŠ  åˆ—æ—</li><li>create â€˜t1â€™,â€™f1â€™</li><li>create â€˜user_infoâ€™,{NAME=&gt;â€™base_infoâ€™,VERSIONS=&gt;3 },{NAME=&gt;â€™extra_infoâ€™,VERSIONS=&gt;1 }<br>åŒæ—¶åˆ›å»ºå¤šä¸ª åˆ—æ—</li></ul><h4 id="exist-ç›¸å…³"><a href="#exist-ç›¸å…³" class="headerlink" title="exist ç›¸å…³"></a>exist ç›¸å…³</h4><ul><li>exists â€˜t1â€™<br>æŸ¥çœ‹è¡¨æ˜¯å¦å­˜åœ¨</li></ul><h4 id="put-ç›¸å…³"><a href="#put-ç›¸å…³" class="headerlink" title="put ç›¸å…³"></a>put ç›¸å…³</h4><ul><li>æ³¨æ„: å¦‚æœå¾€ åŒè¡¨ &amp; åŒrowkey &amp; åŒæ ·çš„åˆ— ä¸­æ’å…¥ value, ä¼šé»˜è®¤å±•ç¤ºæœ€è¿‘çš„ä¸€ä¸ªæ—¶é—´æˆ³çš„ä¿¡æ¯, å¦‚æœ get çš„å›æ”¶æŒ‡å®š VERSIONSæ•°é‡, åˆ™ä¼šå±•ç¤ºæ­¤æ•°é‡çš„ç‰ˆæœ¬ä¿¡æ¯</li><li>å‘ user è¡¨ä¸­æ’å…¥ä¿¡æ¯ï¼Œrow key ä¸º rk0001ï¼Œåˆ—ç°‡ info ä¸­æ·»åŠ  name åˆ—æ ‡ç¤ºç¬¦ï¼Œå€¼ä¸º zhangsan<ul><li>put â€˜userâ€™, â€˜rk0001â€™, â€˜info:nameâ€™, â€˜zhangsanâ€™, 1482077777777<br>æ‰‹åŠ¨æŒ‡å®šæ—¶é—´æˆ³<br>æ—¶é—´æˆ³æ˜¯å¯ä»¥è‡ªå·±æŒ‡å®šçš„ï¼Œå¦‚è‹¥ä¸æŒ‡å®šï¼Œåˆ™ä¼šè‡ªåŠ¨è·å–ç³»ç»Ÿçš„å½“å‰æ—¶é—´çš„æ—¶é—´æˆ³</li></ul></li><li>å‘ user è¡¨ä¸­æ’å…¥ä¿¡æ¯ï¼Œrow key ä¸º rk0001ï¼Œåˆ—ç°‡ info ä¸­æ·»åŠ  gender åˆ—æ ‡ç¤ºç¬¦ï¼Œå€¼ä¸º female<ul><li>put â€˜userâ€™, â€˜rk0001â€™, â€˜info:genderâ€™, â€˜femaleâ€™</li></ul></li><li>å‘ user è¡¨ä¸­æ’å…¥ä¿¡æ¯ï¼Œrow key ä¸º rk0001ï¼Œåˆ—ç°‡ info ä¸­æ·»åŠ  age åˆ—æ ‡ç¤ºç¬¦ï¼Œå€¼ä¸º 20<ul><li>put â€˜userâ€™, â€˜rk0001â€™, â€˜info:ageâ€™, 20</li></ul></li><li>å‘ user è¡¨ä¸­æ’å…¥ä¿¡æ¯ï¼Œrow key ä¸º rk0001ï¼Œåˆ—ç°‡ data ä¸­æ·»åŠ  pic åˆ—æ ‡ç¤ºç¬¦ï¼Œå€¼ä¸º picture<ul><li>put â€˜userâ€™, â€˜rk0001â€™, â€˜data:picâ€™, â€˜pictureâ€™</li></ul></li></ul><h4 id="get-ç›¸å…³"><a href="#get-ç›¸å…³" class="headerlink" title="get ç›¸å…³"></a>get ç›¸å…³</h4><ul><li>è·å– user è¡¨ä¸­ row key ä¸º rk0001 çš„æ‰€æœ‰ä¿¡æ¯              </li></ul><p>  æ³¨æ„: â€˜è¡¨åâ€™, â€˜ rowkeyâ€™</p><ul><li>get â€˜userâ€™, â€˜rk0001â€™</li></ul><ul><li>è·å– user è¡¨ä¸­ row key ä¸º rk0001ï¼Œinfo åˆ—ç°‡çš„æ‰€æœ‰ä¿¡æ¯</li></ul><p>  æ³¨æ„: â€˜è¡¨åâ€™, â€˜ rowkeyâ€™, â€˜åˆ—æ—åâ€™</p><ul><li>get â€˜userâ€™, â€˜rk0001â€™, â€˜infoâ€™</li></ul><ul><li>è·å– user è¡¨ä¸­ row key ä¸º rk0001ï¼Œinfo åˆ—ç°‡çš„ nameã€age åˆ—æ ‡ç¤ºç¬¦çš„ä¿¡æ¯</li></ul><p>  æ³¨æ„: â€˜è¡¨åâ€™, â€˜rowkeyâ€™, â€˜åˆ—æ—åâ€™:â€™åˆ—åâ€™, â€˜åˆ—æ—åâ€™:â€™åˆ—åâ€™</p><ul><li>get â€˜userâ€™, â€˜rk0001â€™, â€˜info:nameâ€™, â€˜info:ageâ€™</li></ul><ul><li>è·å– user è¡¨ä¸­ row key ä¸º rk0001ï¼Œinfoã€data åˆ—ç°‡çš„ä¿¡æ¯</li></ul><p>  æ³¨æ„: â€˜è¡¨åâ€™, â€˜rowkeyâ€™, â€˜åˆ—æ—åâ€™, â€˜åˆ—æ—åâ€™</p><ul><li>get â€˜userâ€™, â€˜rk0001â€™, â€˜infoâ€™, â€˜dataâ€™</li><li>get â€˜userâ€™, â€˜rk0001â€™, {COLUMN =&gt; [â€˜infoâ€™, â€˜dataâ€™]}</li><li>get â€˜userâ€™, â€˜rk0001â€™, {COLUMN =&gt; [â€˜info:nameâ€™, â€˜data:picâ€™]}</li></ul><ul><li>è·å– user è¡¨ä¸­ row key ä¸º rk0001ï¼Œåˆ—ç°‡ä¸º infoï¼Œç‰ˆæœ¬å·æœ€æ–° 5 ä¸ªçš„ä¿¡æ¯</li></ul><p>  æ³¨æ„: â€˜è¡¨åâ€™, â€˜rowkeyâ€™, {COLUMN =&gt;â€™åˆ—æ—åâ€™, å­˜å‚¨ç‰ˆæœ¬æ•°=&gt; æ•°é‡}</p><ul><li>get â€˜userâ€™, â€˜rk0001â€™, {COLUMN =&gt; â€˜infoâ€™, VERSIONS =&gt; 2}</li><li>get â€˜userâ€™, â€˜rk0001â€™, {COLUMN =&gt; â€˜info:nameâ€™, VERSIONS =&gt; 5}</li><li>get â€˜userâ€™, â€˜rk0001â€™, {COLUMN =&gt; â€˜info:nameâ€™, VERSIONS =&gt; 5, TIMERANGE =&gt; [1392368783980, 1392380169184]}</li></ul><ul><li><p>è·å– user è¡¨ä¸­ row key ä¸º rk0001ï¼Œåˆ—æ ‡ç¤ºç¬¦ä¸­å«æœ‰ a çš„ä¿¡æ¯</p><ul><li>get â€˜peopleâ€™, â€˜rk0001â€™, {FILTER =&gt; â€œ(QualifierFilter(=,â€™substring:aâ€™))â€}</li></ul></li><li><p>è·å– å›½ç± ä¸ºä¸­å›½çš„ç”¨æˆ·ä¿¡æ¯</p></li></ul><p>  æ³¨æ„:   â€˜è¡¨åâ€™,    â€˜rowkeyâ€™,      â€˜åˆ—æ—åâ€™:â€™åˆ—åâ€™,  â€˜valueâ€™</p><ul><li>put â€˜userâ€™, â€˜rk0002â€™, â€˜info:nameâ€™, â€˜fanbingbingâ€™</li><li>put â€˜userâ€™, â€˜rk0002â€™, â€˜info:genderâ€™, â€˜femaleâ€™</li><li>put â€˜userâ€™, â€˜rk0002â€™, â€˜info:nationalityâ€™, â€˜ä¸­å›½â€™</li><li>get â€˜userâ€™, â€˜rk0002â€™, {FILTER =&gt; â€œValueFilter(=, â€˜binary:ä¸­å›½â€™)â€}</li></ul><ul><li>è·å–2ä¸ªä¸åŒåˆ—ä¸­çš„æŒ‡å®šå­—æ®µ</li></ul><p>  æ³¨æ„:   â€˜è¡¨åâ€™,    â€˜rowkeyâ€™, {COLUMN  =&gt; [â€˜åˆ—æ—åâ€™:â€™åˆ—åâ€™,  â€˜åˆ—æ—åâ€™:â€™åˆ—åâ€™]}</p><ul><li>get â€˜userâ€™, â€˜rk0002â€™, {COLUMN =&gt; [â€˜info:nameâ€™, â€˜data:picâ€™]}</li></ul><h4 id="scan-ç›¸å…³"><a href="#scan-ç›¸å…³" class="headerlink" title="scan ç›¸å…³"></a>scan ç›¸å…³</h4><ul><li><p>æ‰«æå…ƒæ•°æ®</p><ul><li><p>scan â€˜hbase : metaâ€™<br> t9,,1529936935368.f1a900954c069f0319195f16043c8e1a column=info:regioninfo, timestamp=1529936935933, value={ENCODED =&gt; f1a900954c069f0319195f16043c8e1a, NAME =&gt; â€˜t9,,1529936935368.f1a900954c069f031919<br> .                                                  5f16043c8e1a.â€™, STARTKEY =&gt; â€˜â€™, ENDKEY =&gt; â€˜â€™}<br> t9,,1529936935368.f1a900954c069f0319195f16043c8e1a column=info:seqnumDuringOpen, timestamp=1529936935933, value=\x00\x00\x00\x00\x00\x00\x00\x02<br> .<br> t9,,1529936935368.f1a900954c069f0319195f16043c8e1a column=info:server, timestamp=1529936935933, value=cs5:16020<br> .<br> t9,,1529936935368.f1a900954c069f0319195f16043c8e1a column=info:serverstartcode, timestamp=1529936935933, value=1529923622913</p></li><li><p>$hbase&gt;split â€˜ns1:t1â€™<br>//åˆ‡å‰²è¡¨</p></li><li><p>$hbase&gt;split â€˜â€™<br> //åˆ‡å‰²åŒºåŸŸ, è§ä¸‹é¢</p></li><li><p>åˆ‡å‰²ä¹‹å‰</p><p><img src="https://img.mubu.com/document_image/13cfae11-e0c1-46fb-be2c-799578d701c9-584150.jpg" alt="img"></p></li><li><p>åˆ‡å‰²ä¹‹å</p><p><img src="https://img.mubu.com/document_image/da7a0e5d-7157-458c-abfc-e17a2c81796f-584150.jpg" alt="img"></p></li><li><p>UIç•Œé¢ table regions</p><p><img src="https://img.mubu.com/document_image/9a336ce6-5915-44bc-a3a6-f8ad86de7611-584150.jpg" alt="img"></p></li><li><p>ç»§ç»­è¿›è¡Œ region åˆ‡å‰²</p><ul><li>scan â€˜hbase:metaâ€™</li><li>æ‰¾åˆ°åˆ‡å‰²ç‚¹ STARTKEY =&gt; â€˜row000550â€™ çš„ é‚£è¡Œçš„ NAME =&gt; åé¢çš„å€¼</li><li>ä»è¿™ä¸ªå€¼å¼€å§‹åˆ‡å‰²åˆ°æŒ‡å®šå€¼<br>split â€˜t9,row000551,1529938745618.90ed2fb6b7744ea5f0a7ff613d05aada.â€™,â€™row000888â€™</li></ul></li></ul></li><li><p>æ‰«æè¡¨ä¸­æ‰€æœ‰çš„ä¿¡æ¯</p><ul><li>$hbase&gt;scan â€˜ns1:t1â€™</li></ul></li><li><p>æŸ¥è¯¢ user è¡¨ä¸­åˆ—ç°‡ä¸º info çš„ä¿¡æ¯</p><ul><li>hbase&gt; scan â€˜hbase:metaâ€™<br>æ‰«ææƒæ ‡</li><li>$hbase&gt; scan â€˜hbase:metaâ€™, {COLUMNS =&gt; â€˜infoâ€™}<br>æ³¨æ„: COLUMNSè¦å¤§å†™</li><li>$hbase&gt; scan â€˜ns1:t1â€™, {COLUMNS =&gt; [â€˜c1â€™, â€˜c2â€™], LIMIT =&gt; 10, STARTROW =&gt; â€˜xyzâ€™}</li><li>scan â€˜userâ€™, {COLUMNS =&gt; â€˜infoâ€™, RAW =&gt; true, VERSIONS =&gt; 5}</li><li>scan â€˜persionâ€™, {COLUMNS =&gt; â€˜infoâ€™, RAW =&gt; true, VERSIONS =&gt; 3}<br>Scan æ—¶å¯ä»¥è®¾ç½®æ˜¯å¦å¼€å¯ Raw æ¨¡å¼ï¼Œå¼€å¯ Raw æ¨¡å¼ä¼šè¿”å›åŒ…æ‹¬å·²æ·»åŠ åˆ é™¤æ ‡è®°ä½†æ˜¯æœª å®é™…åˆ é™¤çš„æ•°æ®ã€‚</li></ul></li><li><p>æŸ¥è¯¢ user è¡¨ä¸­åˆ—ç°‡ä¸º info å’Œ data çš„ä¿¡æ¯</p><ul><li>scan â€˜userâ€™, {COLUMNS =&gt; [â€˜infoâ€™, â€˜dataâ€™]}</li><li>scan â€˜userâ€™, {COLUMNS =&gt; [â€˜info:nameâ€™, â€˜data:picâ€™]}</li></ul></li><li><p>æŸ¥è¯¢ user è¡¨ä¸­åˆ—ç°‡ä¸º infoã€åˆ—æ ‡ç¤ºç¬¦ä¸º name çš„ä¿¡æ¯</p><ul><li>scan â€˜userâ€™, {COLUMNS =&gt; â€˜info:nameâ€™}</li></ul></li><li><p>æŸ¥è¯¢ user è¡¨ä¸­åˆ—ç°‡ä¸º infoã€åˆ—æ ‡ç¤ºç¬¦ä¸º name çš„ä¿¡æ¯,å¹¶ä¸”ç‰ˆæœ¬æœ€æ–°çš„ 5 ä¸ª</p><ul><li>scan â€˜userâ€™, {COLUMNS =&gt; â€˜info:nameâ€™, VERSIONS =&gt; 5}</li></ul></li><li><p>æŸ¥è¯¢ user è¡¨ä¸­åˆ—ç°‡ä¸º info å’Œ data ä¸”åˆ—æ ‡ç¤ºç¬¦ä¸­å«æœ‰ a å­—ç¬¦çš„ä¿¡æ¯</p><ul><li>scan â€˜userâ€™, {COLUMNS =&gt; [â€˜infoâ€™, â€˜dataâ€™], FILTER =&gt; â€œ(QualifierFilter(=,â€™substring:aâ€™))â€}</li></ul></li><li><p>æŸ¥è¯¢ user è¡¨ä¸­åˆ—ç°‡ä¸º infoï¼Œrk èŒƒå›´æ˜¯[rk0001, rk0003)çš„æ•°æ®</p><ul><li>scan â€˜peopleâ€™, {COLUMNS =&gt; â€˜infoâ€™, STARTROW =&gt; â€˜rk0001â€™, ENDROW =&gt; â€˜rk0003â€™}</li></ul></li><li><p>æŸ¥è¯¢ user è¡¨ä¸­ row key ä»¥ rk å­—ç¬¦å¼€å¤´çš„</p><ul><li>scan â€˜userâ€™,{FILTER=&gt;â€PrefixFilter(â€˜rkâ€™)â€}</li></ul></li><li><p>æŸ¥è¯¢ user è¡¨ä¸­æŒ‡å®šèŒƒå›´çš„æ•°æ®</p><ul><li>scan â€˜userâ€™, {TIMERANGE =&gt; [1392368783980, 1392380169184]}</li></ul></li></ul><h4 id="delete-truncate-ç›¸å…³-åˆ é™¤-æ¸…ç©ºæ•°æ®"><a href="#delete-truncate-ç›¸å…³-åˆ é™¤-æ¸…ç©ºæ•°æ®" class="headerlink" title="delete/truncate ç›¸å…³ (åˆ é™¤,æ¸…ç©ºæ•°æ®)"></a>delete/truncate ç›¸å…³ (åˆ é™¤,æ¸…ç©ºæ•°æ®)</h4><ul><li>æ³¨æ„: åˆ é™¤åˆ—æ—, åœ¨ alter ä¸­</li><li>åˆ é™¤ user è¡¨ row key ä¸º rk0001ï¼Œåˆ—æ ‡ç¤ºç¬¦ä¸º info:name çš„å­—æ®µæ•°æ®<ul><li>delete â€˜peopleâ€™, â€˜rk0001â€™, â€˜info:nameâ€™</li></ul></li><li>åˆ é™¤ user è¡¨ row key ä¸º rk0001ï¼Œåˆ—æ ‡ç¤ºç¬¦ä¸º info:nameï¼Œtimestamp ä¸º 1392383705316 çš„æ•°æ®<ul><li>delete â€˜userâ€™, â€˜rk0001â€™, â€˜info:nameâ€™, 1392383705316</li></ul></li><li>æ¸…ç©º user è¡¨ä¸­çš„æ•°æ®<ul><li>truncate â€˜peopleâ€™<br>ç›®å‰ç‰ˆæœ¬ä¼šå…ˆ disable , å† truncate, æœ€åå† enable</li></ul></li></ul><h4 id="alter-ç›¸å…³"><a href="#alter-ç›¸å…³" class="headerlink" title="alter ç›¸å…³"></a>alter ç›¸å…³</h4><ul><li>æ³¨æ„,åœ¨ä¿®æ”¹åˆ—æ— æ—¶</li></ul><p>  hbase&gt; alter â€˜t1â€™, NAME =&gt; â€˜f1â€™, VERSIONS =&gt; 5</p><ul><li>VERSIONS æ˜¯æŒ‡èƒ½å­˜å¤šå°‘ä¸ªç‰ˆæœ¬, å¦‚æœä¸æŒ‡å®šçš„è¯, é€€å‡º hbase çš„æ—¶å€™, é»˜è®¤åªä¼šç•™æœ€æ–°çš„ä¸€ä¸ªç‰ˆæœ¬</li><li>å¦‚æœå­˜åœ¨, å°±æ˜¯ä¿®æ”¹</li><li>ä¸å­˜åœ¨, å°±æ˜¯å¢åŠ </li></ul><ul><li><p>æ·»åŠ ä¸¤ä¸ªåˆ—ç°‡ f1 å’Œ f2</p><ul><li>ç®€å†™: alter â€˜t1â€™, â€˜f2â€™</li><li>alter â€˜peopleâ€™, NAME =&gt; â€˜f1â€™</li><li>alter â€˜userâ€™, NAME =&gt; â€˜f2â€™</li></ul></li><li><p>åœç”¨/å¯ç”¨ è¡¨</p><ul><li>enable â€˜t9â€™<br>å¯ç”¨</li><li>is_enabled â€˜t9â€™<br>æ˜¯å¦å¯ç”¨</li><li>disable â€˜t9â€™<br>åœç”¨</li><li>is_disabled â€˜t9â€™<br>æ˜¯å¦ä¸å¯ç”¨</li></ul></li><li><p>åˆ é™¤ä¸€ä¸ªåˆ—ç°‡:</p><ul><li>æ³¨æ„: å½“è¡¨ä¸­åªæœ‰ä¸€ä¸ªåˆ—æ—æ—¶, æ— æ³•å°†å…¶åˆ é™¤</li><li>disable â€˜userâ€™(æ–°ç‰ˆæœ¬ä¸ç”¨)</li><li>alter â€˜userâ€™, NAME =&gt; â€˜f1â€™, METHOD =&gt; â€˜deleteâ€™</li><li>æˆ–</li><li>alter â€˜userâ€™, â€˜deleteâ€™ =&gt; â€˜f1â€™</li><li>enable â€˜userâ€™</li></ul></li><li><p>æ·»åŠ åˆ—ç°‡ f1 åŒæ—¶åˆ é™¤åˆ—ç°‡ f2</p><ul><li>disable â€˜userâ€™(æ–°ç‰ˆæœ¬ä¸ç”¨)</li><li>alter â€˜userâ€™, {NAME =&gt; â€˜f1â€™}, {NAME =&gt; â€˜f2â€™, METHOD =&gt; â€˜deleteâ€™}</li><li>enable â€˜userâ€™</li></ul></li><li><p>å°† user è¡¨çš„ f1 åˆ—ç°‡ç‰ˆæœ¬å·æ”¹ä¸º 5</p><ul><li>disable â€˜userâ€™(æ–°ç‰ˆæœ¬ä¸ç”¨)</li><li>alter â€˜peopleâ€™, NAME =&gt; â€˜infoâ€™, VERSIONS =&gt; 5<br>people ä¸º rowkey</li><li>enable â€˜userâ€™</li></ul></li></ul><h4 id="drop-ç›¸å…³"><a href="#drop-ç›¸å…³" class="headerlink" title="drop ç›¸å…³"></a>drop ç›¸å…³</h4><ul><li>disable â€˜userâ€™</li><li>drop â€˜userâ€™</li></ul><h4 id="count-ç›¸å…³"><a href="#count-ç›¸å…³" class="headerlink" title="count ç›¸å…³"></a>count ç›¸å…³</h4><ul><li>$hbase&gt;count â€˜ns1:t1â€™<br>ç»Ÿè®¡å‡½æ•°, 1000è¡Œç»Ÿè®¡ä¸€æ¬¡</li></ul><h4 id="flush-ç›¸å…³"><a href="#flush-ç›¸å…³" class="headerlink" title="flush ç›¸å…³"></a>flush ç›¸å…³</h4><ul><li>æŠŠæ–‡ä»¶åˆ·åˆ°ç£ç›˜çš„è¿‡ç¨‹</li><li>hbase&gt; flush â€˜TABLENAMEâ€™</li><li>hbase&gt; flush â€˜REGIONNAMEâ€™</li><li>hbase&gt; flush â€˜ENCODED_REGIONNAMEâ€™</li></ul><h4 id="ValueFilter-è¿‡æ»¤å™¨"><a href="#ValueFilter-è¿‡æ»¤å™¨" class="headerlink" title="ValueFilter è¿‡æ»¤å™¨"></a>ValueFilter è¿‡æ»¤å™¨</h4><ul><li>get â€˜personâ€™, â€˜rk0001â€™, {FILTER =&gt; â€œValueFilter(=, â€˜binary:ä¸­å›½â€™)â€}</li><li>get â€˜personâ€™, â€˜rk0001â€™, {FILTER =&gt; â€œ(QualifierFilter(=,â€™substring:aâ€™))â€}</li></ul><h4 id="exit-é€€å‡º"><a href="#exit-é€€å‡º" class="headerlink" title="exit é€€å‡º"></a>exit é€€å‡º</h4><p>$hbase&gt; exit</p><h4 id="é‡åˆ°é—®é¢˜æ€»ç»“"><a href="#é‡åˆ°é—®é¢˜æ€»ç»“" class="headerlink" title="é‡åˆ°é—®é¢˜æ€»ç»“"></a>é‡åˆ°é—®é¢˜æ€»ç»“</h4><ul><li>æ’å…¥å‰, å¿…é¡»åˆ›å»ºå¥½<ul><li>namespace<br>ç›¸å½“äºæ•°æ®åº“çš„æ¦‚å¿µ</li><li>table<br>è¡¨å‘½</li><li>column family<br>åˆ—æ—å</li></ul></li><li>ä¸éœ€è¦æå‰åˆ›å»º<ul><li>è¡Œå</li><li>åˆ—å</li><li>value</li></ul></li><li>å¦‚æœè¡¨å·²ç»åˆ›å»º, è¦å¢åŠ åˆ—æ—çš„è¯, åªèƒ½ç”¨ alter, ä¸èƒ½ç»§ç»­ç”¨ create</li></ul><h2 id="é€šè¿‡Java-APIè®¿é—®Hbase"><a href="#é€šè¿‡Java-APIè®¿é—®Hbase" class="headerlink" title="é€šè¿‡Java APIè®¿é—®Hbase"></a>é€šè¿‡Java APIè®¿é—®Hbase</h2><ul><li><p>åˆ›å»ºhbaseæ¨¡å—</p></li><li><p>æ·»åŠ ä¾èµ–<br>&lt;?xml version=â€1.0â€ encoding=â€UTF-8â€?&gt;</p><project xmlns="<http://maven.apache.org/POM/4.0.0>" xmlns:xsi="<http://www.w3.org/2001/XMLSchema-instance>" xsi:schemalocation="<http://maven.apache.org/POM/4.0.0http://maven.apache.org/xsd/maven-4.0.0.xsd>"><br>    <modelversion>4.0.0</modelversion><br>    <groupid>com.rox</groupid><br>    <artifactid>HbaseDemo</artifactid><br>    <version>1.0-SNAPSHOT</version><br>    <dependencies><br>        <dependency><br>            <groupid>org.apache.hbase</groupid><br>            <artifactid>hbase-client</artifactid><br>            <version>1.2.3</version><br>        </dependency><br>    </dependencies><br></project> </li><li><p>å¤åˆ¶hbaseé›†ç¾¤çš„hbase-site.xmlæ–‡ä»¶åˆ°æ¨¡å—çš„src/main/resourcesç›®å½•ä¸‹ã€‚</p></li><li><p>-â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</p></li><li><p>Hbase API ç±»å’Œæ•°æ®æ¨¡å‹ä¹‹é—´çš„å¯¹åº”å…³ç³»:</p><ul><li><p>\0. æ€»çš„å¯¹åº”å…³ç³»</p><p><img src="https://img.mubu.com/document_image/12d391d8-836e-48de-bf08-53a95e01343c-584150.jpg" alt="img"></p></li><li><ol><li>HBaseAdmin</li></ol><ul><li></li></ul></li></ul></li><li><p>ç¼–ç¨‹å®ç° ä»£ç è§ <a href="https://github.com/airpoet/bigdata/blob/master/HBaseDemo/src/test/java/com/rox/text/TestCRUD.java" target="_blank" rel="noopener">https://github.com/airpoet/bigdata/blob/master/HBaseDemo/src/test/java/com/rox/text/TestCRUD.java</a><br>public class TestCRUD {<br>@Test<br>public void put() throws IOException {<br>// åˆ›å»º conf å¯¹è±¡<br>Configuration conf = HBaseConfiguration.create();/<em> é€šè¿‡è¿æ¥å·¥å‚åˆ›å»ºè¿æ¥å¯¹ </em>/<br>// é€šè¿‡è¿æ¥å·¥å‚åˆ›å»ºè¿æ¥å¯¹è±¡<br>Connection conn = ConnectionFactory.createConnection(conf);<br>// é€šè¿‡è¿æ¥æŸ¥è¯¢ TableName å¯¹è±¡<br>TableName tname = TableName.valueOf(â€œns1:t1â€);<br>// è·å¾— tableå¯¹è±¡<br>Table table = conn.getTable(tname);<br>// é€šè¿‡bytes å·¥å…·ç±»è½¬åŒ–å­—ç¬¦ä¸²ä¸ºå­—èŠ‚æ•°ç»„<br>byte[] bytes = Bytes.toBytes(â€œrow3â€);<br>// åˆ›å»º put å¯¹è±¡, ä¼ å…¥è¡Œå·<br>Put put = new Put(bytes);<br>// åˆ›å»º åˆ—æ—, åˆ—, value çš„ byte æ•°æ®<br>byte[] f1 = Bytes.toBytes(â€œf1â€);<br>byte[] id = Bytes.toBytes(â€œidâ€);<br>byte[] value = Bytes.toBytes(188);<br>put.addColumn(f1, id, value);<br>// table put æ•°æ®<br>table.put(put);<br>//============================<br>// get<br>byte[] rowid = Bytes.toBytes(â€œrow3â€);<br>Get get = new Get(rowid);<br>// å¾—åˆ° res<br>Result res = table.get(get);<br> // ä» res ä¸­å–å‡º value<br>byte[] idvalue = res.getValue(Bytes.toBytes(â€œf1â€),Bytes.toBytes(â€œidâ€));<br>System.out.println(Bytes.toInt(idvalue));<br>}<br>}</p></li></ul><h2 id="HBase-å†™å…¥è¿‡ç¨‹-amp-å­˜å‚¨è·¯å¾„"><a href="#HBase-å†™å…¥è¿‡ç¨‹-amp-å­˜å‚¨è·¯å¾„" class="headerlink" title="HBase å†™å…¥è¿‡ç¨‹ &amp; å­˜å‚¨è·¯å¾„"></a>HBase å†™å…¥è¿‡ç¨‹ &amp; å­˜å‚¨è·¯å¾„</h2><ul><li>WAL<br>write ahead log,å†™å‰æ—¥å¿—ã€‚</li><li>HDFS ä¸Šå­˜å‚¨è·¯å¾„è¯¦è§£<ul><li><a href="http://cs1:50070/explorer.html#/hbase/data/ns1/t1/97eada11d196f1e134c41e859d338e07/f1/fsfsfgwgfsgfrgfdg" target="_blank" rel="noopener">http://cs1:50070/explorer.html#/hbase/data/ns1/t1/97eada11d196f1e134c41e859d338e07/f1/fsfsfgwgfsgfrgfdg</a><ul><li>data<br>å­˜å‚¨æ•°æ®çš„ç›®å½•</li><li>ns1<br>namespace åç§°</li><li>t1<br>è¡¨å</li><li>97eada11d196f1e134c41e859d338e07<br>region çš„ç¼–å·</li><li>f1<br>åˆ—æ—</li><li>fsfsfgwgfsgfrgfdg<br>HFile: åˆ—æ—å­˜å‚¨çš„æ–‡ä»¶, æ¯ä¸€ä¸ª hfile æ–‡ä»¶å¯¹åº”çš„æ˜¯ä¸€ä¸ªåˆ—æ—</li></ul></li><li>meta æ•°æ®è·¯å¾„ <a href="http://cs1:50070/explorer.html#/hbase/data/hbase/meta/1588230740/info" target="_blank" rel="noopener">http://cs1:50070/explorer.html#/hbase/data/hbase/meta/1588230740/info</a></li></ul></li></ul><h2 id="HBase-å’Œ-Hive-çš„æ¯”è¾ƒ"><a href="#HBase-å’Œ-Hive-çš„æ¯”è¾ƒ" class="headerlink" title="HBase å’Œ Hive çš„æ¯”è¾ƒ"></a>HBase å’Œ Hive çš„æ¯”è¾ƒ</h2><ul><li>ç›¸åŒç‚¹<ul><li>HBase å’Œ Hive éƒ½æ˜¯æ¶æ„åœ¨ Hadoop ä¹‹ä¸Šï¼Œç”¨ HDFS åšåº•å±‚çš„æ•°æ®å­˜å‚¨ï¼Œç”¨ MapReduce åš æ•°æ®è®¡ç®—</li></ul></li><li>ä¸åŒç‚¹<ul><li>è§£å†³çš„é—®é¢˜ä¸åŒ<ul><li>Hive æ˜¯å»ºç«‹åœ¨ Hadoop ä¹‹ä¸Šä¸ºäº†é™ä½ MapReduce ç¼–ç¨‹å¤æ‚åº¦çš„ ETL å·¥å…·ã€‚</li><li>HBase æ˜¯ä¸ºäº†å¼¥è¡¥ Hadoop å¯¹å®æ—¶æ“ä½œçš„ç¼ºé™·</li></ul></li><li>è¡¨çš„æ¶æ„ä¸åŒ<ul><li>Hive è¡¨æ˜¯çº¯é€»è¾‘è¡¨ï¼Œå› ä¸º Hive çš„æœ¬èº«å¹¶ä¸èƒ½åšæ•°æ®å­˜å‚¨å’Œè®¡ç®—ï¼Œè€Œæ˜¯å®Œå…¨ä¾èµ– Hadoop</li><li>HBase æ˜¯ç‰©ç†è¡¨ï¼Œæä¾›äº†ä¸€å¼ è¶…å¤§çš„å†…å­˜ Hash è¡¨æ¥å­˜å‚¨ç´¢å¼•ï¼Œæ–¹ä¾¿æŸ¥è¯¢</li></ul></li><li>å®šä½ &amp; è®¿é—®æœºåˆ¶ä¸åŒ<ul><li>Hive æ˜¯æ•°æ®ä»“åº“å·¥å…·ï¼Œéœ€è¦å…¨è¡¨æ‰«æï¼Œå°±ç”¨ Hiveï¼Œå› ä¸º Hive æ˜¯æ–‡ä»¶å­˜å‚¨</li><li>HBase æ˜¯æ•°æ®åº“ï¼Œéœ€è¦ç´¢å¼•è®¿é—®ï¼Œåˆ™ç”¨ HBaseï¼Œå› ä¸º HBase æ˜¯é¢å‘åˆ—çš„ NoSQL æ•°æ®åº“</li></ul></li><li>å­˜å‚¨æ¨¡å¼ä¸åŒ<ul><li>Hive è¡¨ä¸­å­˜å…¥æ•°æ®(æ–‡ä»¶)æ—¶ä¸åšæ ¡éªŒï¼Œå±äºè¯»æ¨¡å¼å­˜å‚¨ç³»ç»Ÿ</li><li>HBase è¡¨æ’å…¥æ•°æ®æ—¶ï¼Œä¼šå’Œ RDBMS ä¸€æ ·åš Schema æ ¡éªŒï¼Œæ‰€ä»¥å±äºå†™æ¨¡å¼å­˜å‚¨ç³»ç»Ÿ</li></ul></li><li>æ˜¯å¦å®æ—¶å¤„ç†(å¤„ç†æ•ˆç‡)ä¸åŒ<ul><li>Hive ä¸æ”¯æŒå•è¡Œè®°å½•æ“ä½œï¼Œæ•°æ®å¤„ç†ä¾é  MapReduceï¼Œæ“ä½œå»¶æ—¶é«˜</li><li>HBase æ”¯æŒå•è¡Œè®°å½•çš„ CRUDï¼Œå¹¶ä¸”æ˜¯å®æ—¶å¤„ç†ï¼Œæ•ˆç‡æ¯” Hive é«˜å¾—å¤š</li></ul></li></ul></li></ul><h2 id="HBaseåœ¨-HDFS-ä¸Šçš„å­˜å‚¨è·¯å¾„"><a href="#HBaseåœ¨-HDFS-ä¸Šçš„å­˜å‚¨è·¯å¾„" class="headerlink" title="HBaseåœ¨ HDFS ä¸Šçš„å­˜å‚¨è·¯å¾„"></a>HBaseåœ¨ HDFS ä¸Šçš„å­˜å‚¨è·¯å¾„</h2><ul><li>ç›¸åŒåˆ—æ—çš„æ•°æ®å­˜æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚</li><li>[è¡¨æ•°æ®çš„å­˜å‚¨ç›®å½•ç»“æ„æ„æˆ]<ul><li><a href="hdfs://cs1:8020/hbase/data/${åå­—ç©ºé—´}/${è¡¨å}/${åŒºåŸŸåç§°}/${åˆ—æ—åç§°}/${æ–‡ä»¶å}" target="_blank" rel="noopener">hdfs://cs1:8020/hbase/data/${åå­—ç©ºé—´}/${è¡¨å}/${åŒºåŸŸåç§°}/${åˆ—æ—åç§°}/${æ–‡ä»¶å}</a></li></ul></li><li>[WALç›®å½•ç»“æ„æ„æˆ]<ul><li><a href="hdfs://cs1:8020/hbase/WALs/${åŒºåŸŸæœåŠ¡å™¨åç§°,ç«¯å£å·,æ—¶é—´æˆ³}/" target="_blank" rel="noopener">hdfs://cs1:8020/hbase/WALs/${åŒºåŸŸæœåŠ¡å™¨åç§°,ç«¯å£å·,æ—¶é—´æˆ³}/</a></li></ul></li></ul><h2 id="Client-ç«¯-ä¸-HBase-äº¤äº’è¿‡ç¨‹"><a href="#Client-ç«¯-ä¸-HBase-äº¤äº’è¿‡ç¨‹" class="headerlink" title="Client ç«¯ ä¸ HBase äº¤äº’è¿‡ç¨‹"></a>Client ç«¯ ä¸ HBase äº¤äº’è¿‡ç¨‹</h2><ul><li><p>HBase ç®€å•é›†ç¾¤ç»“æ„</p><p><img src="https://img.mubu.com/document_image/5c640ea0-d4ff-43ed-94bb-ebebfc35aa62-584150.jpg" alt="img"></p><ul><li>region:æ˜¯ hbase ä¸­å¯¹è¡¨è¿›è¡Œåˆ‡å‰²çš„å•å…ƒï¼Œç”± regionserver è´Ÿè´£ç®¡ç†<ul><li>region åˆ†è£‚æ˜¯é€»è¾‘æ¦‚å¿µ?? :TODO</li></ul></li><li>hamster:hbase çš„ä¸»èŠ‚ç‚¹ï¼Œè´Ÿè´£æ•´ä¸ªé›†ç¾¤çš„çŠ¶æ€æ„ŸçŸ¥ï¼Œè´Ÿè½½åˆ†é…ã€è´Ÿè´£ç”¨æˆ·è¡¨çš„å…ƒæ•°æ®(schema)ç®¡ç†(å¯ä»¥é…ç½®å¤šä¸ªç”¨æ¥å®ç° HA),hmaster è´Ÿè½½å‹åŠ›ç›¸å¯¹äº hdfs çš„ namenode ä¼šå°å¾ˆå¤š</li><li>regionserver:hbase ä¸­çœŸæ­£è´Ÿè´£ç®¡ç† region çš„æœåŠ¡å™¨ï¼Œä¹Ÿå°±æ˜¯è´Ÿè´£ä¸ºå®¢æˆ·ç«¯è¿›è¡Œè¡¨æ•°æ®è¯»å†™ çš„æœåŠ¡å™¨æ¯ä¸€å° regionserver ä¼šç®¡ç†å¾ˆå¤šçš„ regionï¼ŒåŒä¸€ä¸ª regionserver ä¸Šé¢ç®¡ç†çš„æ‰€æœ‰çš„ region ä¸å±äºåŒä¸€å¼ è¡¨</li><li>zookeeper:æ•´ä¸ª hbase ä¸­çš„ä¸»ä»èŠ‚ç‚¹åè°ƒï¼Œä¸»èŠ‚ç‚¹ä¹‹é—´çš„é€‰ä¸¾ï¼Œé›†ç¾¤èŠ‚ç‚¹ä¹‹é—´çš„ä¸Šä¸‹çº¿æ„Ÿ çŸ¥â€â€éƒ½æ˜¯é€šè¿‡ zookeeper æ¥å®ç°</li><li>HDFS:ç”¨æ¥å­˜å‚¨ hbase çš„ç³»ç»Ÿæ–‡ä»¶ï¼Œæˆ–è€…è¡¨çš„ region</li></ul></li><li><p>Hbase é¡¶å±‚ç»“æ„å›¾</p><p><img src="https://img.mubu.com/document_image/ebc78e6e-830c-49af-a05f-c79ec1bad8d6-584150.jpg" alt="img"></p></li><li><p>0.hbaseé›†ç¾¤å¯åŠ¨æ—¶ï¼Œmasterè´Ÿè´£åˆ†é…åŒºåŸŸåˆ°æŒ‡å®šåŒºåŸŸæœåŠ¡å™¨ã€‚</p></li><li><p>1.è”ç³»zkï¼Œæ‰¾å‡ºmetaè¡¨æ‰€åœ¨rs(regionserver)/hbase/meta-region-server</p></li><li><p>2.å®šä½row key,æ‰¾åˆ°å¯¹åº”region server</p></li><li><p>3.ç¼“å­˜ä¿¡æ¯åœ¨æœ¬åœ°ã€‚</p></li><li><p>4.è”ç³»RegionServer</p></li><li><p>5.HRegionServerè´Ÿè´£open HRegionå¯¹è±¡ï¼Œä¸ºæ¯ä¸ªåˆ—æ—åˆ›å»ºStoreå¯¹è±¡ï¼ŒStoreåŒ…å«å¤šä¸ªStoreFileå®ä¾‹ï¼Œä»–ä»¬æ˜¯å¯¹HFileçš„è½»é‡çº§å°è£…ã€‚æ¯ä¸ªStoreè¿˜å¯¹åº”äº†ä¸€ä¸ªMemStoreï¼Œç”¨äºå†…å­˜å­˜å‚¨æ•°æ®ã€‚</p></li></ul><h2 id="ç™¾ä¸‡æ•°æ®æ‰¹é‡æ’å…¥"><a href="#ç™¾ä¸‡æ•°æ®æ‰¹é‡æ’å…¥" class="headerlink" title="ç™¾ä¸‡æ•°æ®æ‰¹é‡æ’å…¥"></a>ç™¾ä¸‡æ•°æ®æ‰¹é‡æ’å…¥</h2><ul><li>ä»£ç <br>long start = System.currentTimeMillis() ;<br>Configuration conf = HBaseConfiguration.create();<br>Connection conn = ConnectionFactory.createConnection(conf);<br>TableName tname = TableName.valueOf(â€œns1:t1â€);<br>HTable table = (HTable)conn.getTable(tname);<br>//ä¸è¦è‡ªåŠ¨æ¸…ç†ç¼“å†²åŒº<br>table.setAutoFlush(false);<br>for(int i = 4 ; i &lt; 1000000 ; i ++){<pre><code>Put put = new Put(Bytes.toBytes(&quot;row&quot; + i)) ;//å…³é—­å†™å‰æ—¥å¿—put.setWriteToWAL(false);put.addColumn(Bytes.toBytes(&quot;f1&quot;),Bytes.toBytes(&quot;id&quot;),Bytes.toBytes(i));put.addColumn(Bytes.toBytes(&quot;f1&quot;),Bytes.toBytes(&quot;name&quot;),Bytes.toBytes(&quot;tom&quot; + i));put.addColumn(Bytes.toBytes(&quot;f1&quot;),Bytes.toBytes(&quot;age&quot;),Bytes.toBytes(i % 100));table.put(put);if(i % 2000 == 0){    table.flushCommits();}</code></pre>}<br>//<br>table.flushCommits();<br>System.out.println(System.currentTimeMillis() - start ); </li></ul><h2 id="HBase-åˆ‡å‰²æ–‡ä»¶"><a href="#HBase-åˆ‡å‰²æ–‡ä»¶" class="headerlink" title="HBase åˆ‡å‰²æ–‡ä»¶"></a>HBase åˆ‡å‰²æ–‡ä»¶</h2><ul><li>é»˜è®¤10G è¿›è¡Œåˆ‡å‰²<property><br>        <name>hbase.hregion.max.filesize</name><br>        <value>10737418240</value><br>        <source>hbase-default.xml<br></property> </li></ul><h2 id="HBase-åˆå¹¶æ–‡ä»¶"><a href="#HBase-åˆå¹¶æ–‡ä»¶" class="headerlink" title="HBase åˆå¹¶æ–‡ä»¶"></a>HBase åˆå¹¶æ–‡ä»¶</h2><ul><li>merge_region â€˜1f4609ba4e2a9440aedde5d0e7123722â€™,â€™48277c27196a5c6e30d5ae679e9ec4f0â€™<br>merge â€˜å‰ä¸€ä¸ªåŒºåŸŸçš„ encodedâ€™ , â€˜åä¸€ä¸ªåŒºåŸŸçš„ encodedâ€™</li></ul><h2 id="HBase-æ‰‹åŠ¨ç§»åŠ¨æ–‡ä»¶"><a href="#HBase-æ‰‹åŠ¨ç§»åŠ¨æ–‡ä»¶" class="headerlink" title="HBase æ‰‹åŠ¨ç§»åŠ¨æ–‡ä»¶"></a>HBase æ‰‹åŠ¨ç§»åŠ¨æ–‡ä»¶</h2><ul><li>hbase(main):034:0&gt; move â€˜8658ac9ea01f80c2cca32693397a1e70â€™,â€™cs3,16020,1529980599903â€™<br>å‰é¢æ˜¯ encoded region name , åé¢æ˜¯æœåŠ¡å™¨å</li></ul><h2 id="é¢„å…ˆåˆ‡å‰²"><a href="#é¢„å…ˆåˆ‡å‰²" class="headerlink" title="é¢„å…ˆåˆ‡å‰²"></a>é¢„å…ˆåˆ‡å‰²</h2><ul><li>åˆ›å»ºè¡¨æ—¶, é¢„å…ˆå¯¹è¡¨è¿›è¡Œåˆ‡å‰²</li><li>åˆ‡å‰²çº¿æ˜¯ rowkey<br>create â€˜ns1:t2â€™,â€™f1â€™,SPLITS=&gt;[â€˜row300â€™, â€˜row600â€™]</li><li>åˆ›å»ºé¢„å…ˆåˆ‡å‰²è¡¨ä¹‹å, å­˜çš„å€¼å°±ä¼šåˆ°å¯¹åº”çš„åŒºåŸŸä¸­å»</li><li>æ³¨æ„: put ä¸€æ¬¡å°±æ˜¯ä¸€æ¡æ•°æ®</li></ul><h2 id="æŒ‡å®šç‰ˆæœ¬æ•°çš„é—®é¢˜"><a href="#æŒ‡å®šç‰ˆæœ¬æ•°çš„é—®é¢˜" class="headerlink" title="æŒ‡å®šç‰ˆæœ¬æ•°çš„é—®é¢˜"></a>æŒ‡å®šç‰ˆæœ¬æ•°çš„é—®é¢˜</h2><ul><li>åˆ›å»ºè¡¨æ—¶æŒ‡å®šåˆ—æ—çš„ç‰ˆæœ¬æ•°,è¯¥åˆ—æ—çš„æ‰€æœ‰åˆ—éƒ½å…·æœ‰ç›¸åŒæ•°é‡ç‰ˆæœ¬ </li><li>åˆ›å»ºè¡¨æ—¶ï¼ŒæŒ‡å®šåˆ—æ—çš„ç‰ˆæœ¬æ•°ã€‚<br>$hbase&gt;create â€˜ns1:t3â€™,{NAME=&gt;â€™f1â€™,VERSIONS=&gt;3}            </li><li>å¦‚æœåˆ›å»ºè¡¨çš„æ—¶å€™åˆ›çš„æ˜¯3ä¸ªç‰ˆæœ¬, æŸ¥4ä¸ªç‰ˆæœ¬, æ­¤æ—¶æœ€å¤šä¹Ÿå°±æ˜¾ç¤º3ä¸ª<br>$hbase&gt;get â€˜ns1:t3â€™,â€™row1â€™,{COLUMN=&gt;â€™f1â€™,VERSIONS=&gt;4}<br>COLUMN                  CELL<br> f1:name                timestamp=1530019546709, value=tom3<br> f1:name                timestamp=1530019542978, value=tom2<br> f1:name                timestamp=1530019540164, value=tom1</li></ul><h2 id="åŸç”Ÿæ‰«æ-expert"><a href="#åŸç”Ÿæ‰«æ-expert" class="headerlink" title="åŸç”Ÿæ‰«æ(expert)"></a>åŸç”Ÿæ‰«æ(expert)</h2><ul><li><p><img src="https://img.mubu.com/document_image/7d75648a-c26c-46c9-9c06-286805d4270b-584150.jpg" alt="img"></p></li><li><p>åŸç”Ÿæ‰«æ, åŒ…å«æ ‡è®°äº†deleteçš„æ•°æ®<br>$hbase&gt;scan â€˜ns1:t3â€™,{COLUMN=&gt;â€™f1â€™,RAW=&gt;true,VERSIONS=&gt;10}<br>hbase(main):177:0&gt; scan â€˜ns1:t3â€™,{COLUMN=&gt;â€™f1â€™,RAW=&gt;true,VERSIONS=&gt;10}<br>ROW                     COLUMN+CELL<br> row1                   column=f1:name, timestamp=1530019546709, value=tom3<br> row1                   column=f1:name, timestamp=1530019542978, value=tom2<br> row1                   column=f1:name, timestamp=1530019540164, type=DeleteColumn<br> row1                   column=f1:name, timestamp=1530019540164, value=tom1</p></li><li><p>åˆ é™¤æ•°æ®, æ ‡è®°ä¸ºåˆ é™¤, å°äºè¯¥åˆ é™¤æ—¶é—´çš„æ•°æ®éƒ½ä½œåºŸ, flush å, ç”¨ RAW ä¼¼ä¹è¿˜ä¼šä¿ç•™, ç”¨é RAW çš„æ–¹å¼æŸ¥çœ‹çš„ç”», æ­¤åˆ é™¤æ•°æ®, åŠæ—¶é—´æˆ³æ¯”è¿™ä¸ªå°çš„æ•°æ®, éƒ½ä¸ä¼šæ˜¾ç¤º.</p></li></ul><p>   $hbase&gt;delete â€˜ns1:t3â€™,â€™row1â€™,â€™f1:nameâ€™,148989875645</p><ul><li>è¿™é‡Œæ˜¯å¦è¦åœæ‰ hbase æœåŠ¡å†èµ·æ¥çœ‹çœ‹?</li></ul><ul><li><p>TTL</p><ul><li>time to live ,å­˜æ´»æ—¶é—´</li><li>å½±å“æ‰€æœ‰çš„æ•°æ®ï¼ŒåŒ…æ‹¬æ²¡æœ‰åˆ é™¤çš„æ•°æ®</li><li>è¶…è¿‡è¯¥æ—¶é—´ï¼ŒåŸç”Ÿæ‰«æä¹Ÿæ‰«ä¸åˆ°æ•°æ®</li><li>åˆ›å»ºå¸¦ TTLå‚æ•°çš„è¡¨<br>$hbase&gt;create â€˜ns1:txâ€™ , {NAME=&gt;â€™f1â€™,TTL=&gt;10,VERSIONS=&gt;10} </li></ul></li><li><p>KEEP_DELETED_CELLS</p><ul><li>åˆ é™¤keyä¹‹åï¼Œæ•°æ®æ˜¯å¦è¿˜ä¿ç•™, æœªæµ‹è¯•<br>$hbase&gt;create â€˜ns1:txâ€™ , {NAME=&gt;â€™f1â€™,TTL=&gt;10,VERSIONS,KEEP_DELETED_CELLS=&gt;true}</li><li>TTL çš„ä¼˜å…ˆçº§é«˜äº KEEP_DELETED_CELLS, å¦‚æœè®¾ç½®äº† TTL, æ—¶é—´ä¸€åˆ°å°±æ²¡äº†, ç”¨ RAW ä¹Ÿæ‰¾ä¸å›æ¥</li></ul></li></ul><h2 id="ç¼“å­˜-å’Œ-æ‰¹å¤„ç†"><a href="#ç¼“å­˜-å’Œ-æ‰¹å¤„ç†" class="headerlink" title="ç¼“å­˜ å’Œ æ‰¹å¤„ç†"></a>ç¼“å­˜ å’Œ æ‰¹å¤„ç†</h2><ul><li><p>å¼€å¯æœåŠ¡å™¨ç«¯æ‰«æå™¨ç¼“å­˜</p><ul><li>è¡¨å±‚é¢(å…¨å±€), è²Œä¼¼æ˜¯é»˜è®¤çš„? å†çœ‹çœ‹ä¹¦ä¸Šè¯´çš„<property><br>    <name>hbase.client.scanner.caching</name><br>    <!-- æ•´æ•°æœ€å¤§å€¼ --><br>    <value>2147483647</value><br>    <source>hbase-default.xml<br></property> </li></ul></li><li><p>æ“ä½œå±‚é¢</p></li></ul><p>  æ³¨æ„: è²Œä¼¼JavaAPI ä¸­é»˜è®¤æ˜¯æ²¡æœ‰è®¾ç½® caching çš„</p><ul><li>è®¾ç½®æ–¹å¼<br>scan.setCaching(10);</li><li>æ“ä½œæ—¶é—´<br>cache row nums : 1000            //632<br>cache row nums : 5000            //423<br>cache row nums : 1                //7359 </li></ul><ul><li><p>æ‰«æå™¨ç¼“å­˜æ˜¯ é¢å‘è¡Œçº§åˆ«çš„</p></li><li><p>æ‰¹é‡æ‰«ææ˜¯ é¢å‘åˆ—çº§åˆ«çš„</p><ul><li>æ§åˆ¶æ¯æ¬¡next()æœåŠ¡å™¨ç«¯è¿”å›çš„åˆ—çš„ä¸ªæ•°ã€‚</li><li>scan.setBatch(5);<br>æ¯æ¬¡nextè¿”å›5åˆ—ã€‚</li></ul></li></ul><h2 id="è¿‡æ»¤å™¨"><a href="#è¿‡æ»¤å™¨" class="headerlink" title="è¿‡æ»¤å™¨"></a>è¿‡æ»¤å™¨</h2><ul><li><p>å›¾ç¤º</p><p><img src="https://img.mubu.com/document_image/36f8af62-4775-498f-a399-3e6a7f748382-584150.jpg" alt="img"></p></li><li><p>ä»£ç </p><ul><li><a href="https://github.com/airpoet/bigdata/blob/master/HBaseDemo/src/test/java/com/rox/text/TestCRUD.java" target="_blank" rel="noopener">https://github.com/airpoet/bigdata/blob/master/HBaseDemo/src/test/java/com/rox/text/TestCRUD.java</a></li></ul></li></ul><h2 id="è®¡æ•°å™¨"><a href="#è®¡æ•°å™¨" class="headerlink" title="è®¡æ•°å™¨"></a>è®¡æ•°å™¨</h2><ul><li>shell å®ç°<ul><li>$hbase&gt;incr â€˜ns1:t8â€™,â€™row1â€™,â€™f1:clickâ€™,1<br>åé¢å¯ä»¥è·Ÿä»»æ„æ•°å­—, æ­£è´Ÿ,0éƒ½å¯ä»¥</li><li>$hbase&gt;get_counter â€˜ns1:t8â€™,â€™row1â€™,â€™f1:clickâ€™<br>è·å–è®¡æ•°å™¨</li></ul></li><li>Java ä»£ç <ul><li><a href="https://github.com/airpoet/bigdata/blob/master/HBaseDemo/src/test/java/com/rox/text/TestCRUD.java" target="_blank" rel="noopener">https://github.com/airpoet/bigdata/blob/master/HBaseDemo/src/test/java/com/rox/text/TestCRUD.java</a></li></ul></li></ul><h2 id="åå¤„ç†å™¨-coprocessor-TODO-æœ‰ç©ºå†çœ‹"><a href="#åå¤„ç†å™¨-coprocessor-TODO-æœ‰ç©ºå†çœ‹" class="headerlink" title="åå¤„ç†å™¨ coprocessor :TODO æœ‰ç©ºå†çœ‹"></a>åå¤„ç†å™¨ coprocessor :TODO æœ‰ç©ºå†çœ‹</h2><ul><li><p>æ‰¹å¤„ç†çš„ï¼Œç­‰ä»·äºå­˜å‚¨è¿‡ç¨‹æˆ–è€…è§¦å‘å™¨ </p><p><img src="https://img.mubu.com/document_image/16c4bf5b-b2ea-4908-a6d2-1fc2cf779e22-584150.jpg" alt="img"></p></li><li><p>Observer</p><p><img src="https://img.mubu.com/document_image/78a0ca5e-5ead-4a01-b37c-e5e29f650045-584150.jpg" alt="img"></p><ul><li>RegionObserver        //RegionServeråŒºåŸŸè§‚å¯Ÿè€…</li><li>MasterObserver        //MasterèŠ‚ç‚¹ã€‚</li><li>WAlObserver            //</li></ul></li><li><p>Endpoint</p><ul><li>ç»ˆç«¯,ç±»ä¼¼äºå­˜å‚¨è¿‡ç¨‹ã€‚ </li></ul></li></ul><h2 id="HBase-amp-Mapreduce-æ•´åˆ"><a href="#HBase-amp-Mapreduce-æ•´åˆ" class="headerlink" title="HBase &amp; Mapreduce æ•´åˆ"></a>HBase &amp; Mapreduce æ•´åˆ</h2><ul><li>è¿è¡Œå®˜æ–¹æ¡ˆä¾‹<ul><li>[ap@cs1]~/apps/hbase%  export HBASE_HOME=/home/ap/apps/hbase</li><li>[ap@cs1]~/apps/hbase%  export HADOOP_HOME=/home/ap/apps/hadoop</li><li>[ap@cs1]~/apps/hbase% export HADOOP_CLASSPATH=<code>${HBASE_HOME}/bin/hbase mapredcp</code></li></ul></li><li>ä½¿ç”¨ MapReduceå¯¼å…¥æœ¬åœ°æ•°æ®åˆ°Hbase<ul><li>apps/hadoop/bin/yarn jar apps/hbase/lib/hbase-server-1.2.6.1.jar importtsv \</li><li>-Dimporttsv.columns=HBASE_ROW_KEY,info:name,info:color fruit \</li><li><a href="hdfs://cs1:8020/input_fruit" target="_blank" rel="noopener">hdfs://cs1:8020/input_fruit</a><br>è¿™æ˜¯ namenode çš„ RPC åœ°å€</li></ul></li></ul><h2 id="HBase-amp-Hive-æ•´åˆ"><a href="#HBase-amp-Hive-æ•´åˆ" class="headerlink" title="HBase &amp; Hive æ•´åˆ"></a>HBase &amp; Hive æ•´åˆ</h2><p>1.ç¯å¢ƒé…ç½®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> HBASE_HOME=/home/ap/apps/hbase</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> HADOOP_HOME=/home/ap/apps/hadoop</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> HADOOP_CLASSPATH=`<span class="variable">$&#123;HBASE_HOME&#125;</span>/bin/hbase mapredcp`</span><br></pre></td></tr></table></figure><h2 id="å‰©ä¸‹çš„hbaseçŸ¥è¯†ç‚¹-æœ‰ç©ºå†è¡¥å……"><a href="#å‰©ä¸‹çš„hbaseçŸ¥è¯†ç‚¹-æœ‰ç©ºå†è¡¥å……" class="headerlink" title="å‰©ä¸‹çš„hbaseçŸ¥è¯†ç‚¹ æœ‰ç©ºå†è¡¥å……"></a>å‰©ä¸‹çš„hbaseçŸ¥è¯†ç‚¹ æœ‰ç©ºå†è¡¥å……</h2>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;Hbaseæ¦‚å¿µ&quot;&gt;&lt;a href=&quot;#Hbaseæ¦‚å¿µ&quot; class=&quot;headerlink&quot; title=&quot;Hbaseæ¦‚å¿µ&quot;&gt;&lt;/a&gt;Hbaseæ¦‚å¿µ&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;hbase &amp;amp; hdfs å…³ç³»å›¾&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;htt
      
    
    </summary>
    
      <category term="Hadoop" scheme="https://airpoet.github.io/categories/Hadoop/"/>
    
      <category term="HBase" scheme="https://airpoet.github.io/categories/Hadoop/HBase/"/>
    
    
      <category term="åŸåˆ›" scheme="https://airpoet.github.io/tags/%E5%8E%9F%E5%88%9B/"/>
    
      <category term="æŠ€æœ¯" scheme="https://airpoet.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="Hadoop" scheme="https://airpoet.github.io/tags/Hadoop/"/>
    
      <category term="HBase" scheme="https://airpoet.github.io/tags/HBase/"/>
    
  </entry>
  
  <entry>
    <title>i-Zookeeper</title>
    <link href="https://airpoet.github.io/2018/06/23/Hadoop/4-Zookeeper/i-Zookeeper/"/>
    <id>https://airpoet.github.io/2018/06/23/Hadoop/4-Zookeeper/i-Zookeeper/</id>
    <published>2018-06-23T06:00:32.111Z</published>
    <updated>2018-06-30T15:07:11.420Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-Zookeeper-çš„å®‰è£…-amp-æ¦‚è¿°"><a href="#1-Zookeeper-çš„å®‰è£…-amp-æ¦‚è¿°" class="headerlink" title="1.Zookeeper çš„å®‰è£…&amp;æ¦‚è¿°"></a>1.Zookeeper çš„å®‰è£…&amp;æ¦‚è¿°</h1><h3 id="1-1-Zookeeper-ç®€ä»‹"><a href="#1-1-Zookeeper-ç®€ä»‹" class="headerlink" title="1.1. Zookeeper ç®€ä»‹"></a>1.1. Zookeeper ç®€ä»‹</h3><p><strong>Zookeeperæ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼çš„ï¼Œä¸ºåˆ†å¸ƒå¼åº”ç”¨æä¾›åè°ƒæœåŠ¡çš„Apacheé¡¹ç›®ã€‚</strong></p><p>zkæä¾›çš„æœåŠ¡ </p><ul><li><p>Naming service                //æŒ‰åç§°åŒºåˆ†é›†ç¾¤ä¸­çš„èŠ‚ç‚¹. </p></li><li><p>Configuration management    //å¯¹åŠ å…¥èŠ‚ç‚¹çš„æœ€æ–°åŒ–å¤„ç†ã€‚ </p></li><li>Cluster management            //å®æ—¶æ„ŸçŸ¥é›†ç¾¤ä¸­èŠ‚ç‚¹çš„å¢å‡. </li><li>Leader election                //leaderé€‰ä¸¾ </li><li>Locking and synchronization service    //ä¿®æ”¹æ—¶é”å®šæ•°æ®ï¼Œå®ç°å®¹ç¾. </li><li>Highly reliable data registry        //èŠ‚ç‚¹å®•æœºæ•°æ®ä¹Ÿæ˜¯å¯ç”¨çš„ã€‚ </li></ul><h3 id="1-2-ZK-çš„å·¥ä½œæœºåˆ¶"><a href="#1-2-ZK-çš„å·¥ä½œæœºåˆ¶" class="headerlink" title="1.2.  ZK çš„å·¥ä½œæœºåˆ¶"></a>1.2.  ZK çš„å·¥ä½œæœºåˆ¶</h3><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-23-065529.png" alt="image-20180623145528682"></p><h3 id="1-4-ZK-æ¶æ„"><a href="#1-4-ZK-æ¶æ„" class="headerlink" title="1.4. ZK æ¶æ„"></a>1.4. ZK æ¶æ„</h3><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-23-064232.png" alt="image-20180623144232085"></p><h4 id="1-4-1-åè¯è§£é‡Š"><a href="#1-4-1-åè¯è§£é‡Š" class="headerlink" title="1.4.1 åè¯è§£é‡Š"></a>1.4.1 åè¯è§£é‡Š</h4><p>   1.Client </p><p>â€‹        ä»serverè·å–ä¿¡æ¯ï¼Œå‘¨æœŸæ€§å‘é€æ•°æ®ç»™serverï¼Œè¡¨ç¤ºè‡ªå·±è¿˜æ´»ç€ã€‚ </p><p>â€‹        clientè¿æ¥æ—¶ï¼Œserverå›ä¼ ackä¿¡æ¯ã€‚ </p><p>â€‹        å¦‚æœclientæ²¡æœ‰æ”¶åˆ°reponseï¼Œè‡ªåŠ¨é‡å®šå‘åˆ°å¦ä¸€ä¸ªserver. </p><p>â€‹    2.Server </p><p>â€‹        zké›†ç¾¤ä¸­çš„ä¸€å‘˜ï¼Œå‘clientæä¾›æ‰€æœ‰serviceï¼Œå›ä¼ ackä¿¡æ¯ç»™clientï¼Œè¡¨ç¤ºè‡ªå·±è¿˜æ´»ç€ã€‚ </p><p>â€‹    3.ensemble </p><p>â€‹        ä¸€ç»„æœåŠ¡å™¨ã€‚ </p><p>â€‹        æœ€å°èŠ‚ç‚¹æ•°æ˜¯3. </p><p>â€‹    4.Leader </p><p>â€‹        å¦‚æœè¿æ¥çš„èŠ‚ç‚¹å¤±è´¥ï¼Œè‡ªå®šæ¢å¤ï¼ŒzkæœåŠ¡å¯åŠ¨æ—¶ï¼Œå®Œæˆleaderé€‰ä¸¾ã€‚ </p><p>â€‹    5.Follower </p><p>â€‹        è¿½å¯»leaderæŒ‡ä»¤çš„èŠ‚ç‚¹ã€‚ </p><h4 id="1-4-2-æ•´ä½“è§£é‡Š"><a href="#1-4-2-æ•´ä½“è§£é‡Š" class="headerlink" title="1.4.2 æ•´ä½“è§£é‡Š"></a>1.4.2 æ•´ä½“è§£é‡Š</h4><ul><li>1ï¼‰Zookeeperï¼šä¸€ä¸ªé¢†å¯¼è€…ï¼ˆleaderï¼‰ï¼Œå¤šä¸ªè·Ÿéšè€…ï¼ˆfollowerï¼‰ç»„æˆçš„é›†ç¾¤ã€‚</li><li>2ï¼‰Leaderè´Ÿè´£è¿›è¡ŒæŠ•ç¥¨çš„å‘èµ·å’Œå†³è®®ï¼Œæ›´æ–°ç³»ç»ŸçŠ¶æ€</li><li>3ï¼‰Followerç”¨äºæ¥æ”¶å®¢æˆ·è¯·æ±‚å¹¶å‘å®¢æˆ·ç«¯è¿”å›ç»“æœï¼Œåœ¨é€‰ä¸¾Leaderè¿‡ç¨‹ä¸­å‚ä¸æŠ•ç¥¨</li><li>4ï¼‰é›†ç¾¤ä¸­åªè¦æœ‰åŠæ•°ä»¥ä¸ŠèŠ‚ç‚¹å­˜æ´»ï¼ŒZookeeperé›†ç¾¤å°±èƒ½æ­£å¸¸æœåŠ¡ã€‚</li><li>5ï¼‰å…¨å±€æ•°æ®ä¸€è‡´ï¼šæ¯ä¸ªserverä¿å­˜ä¸€ä»½ç›¸åŒçš„æ•°æ®å‰¯æœ¬ï¼Œclientæ— è®ºè¿æ¥åˆ°å“ªä¸ªserverï¼Œæ•°æ®éƒ½æ˜¯ä¸€è‡´çš„ã€‚</li><li>6ï¼‰æ›´æ–°è¯·æ±‚é¡ºåºè¿›è¡Œï¼Œæ¥è‡ªåŒä¸€ä¸ªclientçš„æ›´æ–°è¯·æ±‚æŒ‰å…¶å‘é€é¡ºåºä¾æ¬¡æ‰§è¡Œã€‚</li><li>7ï¼‰æ•°æ®æ›´æ–°åŸå­æ€§ï¼Œä¸€æ¬¡æ•°æ®æ›´æ–°è¦ä¹ˆæˆåŠŸï¼Œè¦ä¹ˆå¤±è´¥ã€‚</li><li>8ï¼‰å®æ—¶æ€§ï¼Œåœ¨ä¸€å®šæ—¶é—´èŒƒå›´å†…ï¼Œclientèƒ½è¯»åˆ°æœ€æ–°æ•°æ®ã€‚</li></ul><h3 id="1-5-znode"><a href="#1-5-znode" class="headerlink" title="1.5. znode"></a>1.5. znode</h3><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-23-064202.png" alt="image-20180623144202281"></p><p>ZooKeeperæ•°æ®æ¨¡å‹çš„ç»“æ„ä¸Unixæ–‡ä»¶ç³»ç»Ÿå¾ˆç±»ä¼¼ï¼Œæ•´ä½“ä¸Šå¯ä»¥çœ‹ä½œæ˜¯ä¸€æ£µæ ‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹ç§°åšä¸€ä¸ªZNodeã€‚æ¯ä¸€ä¸ªZNodeé»˜è®¤èƒ½å¤Ÿå­˜å‚¨1MBçš„æ•°æ®ï¼Œæ¯ä¸ªZNodeéƒ½å¯ä»¥é€šè¿‡å…¶è·¯å¾„å”¯ä¸€æ ‡è¯† </p><p>zkä¸­çš„èŠ‚ç‚¹ï¼Œç»´æŠ¤äº†statï¼Œç”±Version number, Action control list (ACL), Timestamp,Data length.æ„æˆ. </p><p>data version        //æ•°æ®å†™å…¥çš„è¿‡ç¨‹å˜åŒ– </p><p> ACL                    //action control list, </p><h3 id="1-6-èŠ‚ç‚¹ç±»å‹"><a href="#1-6-èŠ‚ç‚¹ç±»å‹" class="headerlink" title="1.6. èŠ‚ç‚¹ç±»å‹"></a>1.6. èŠ‚ç‚¹ç±»å‹</h3><p>â€‹    1.æŒä¹…èŠ‚ç‚¹ </p><p>â€‹        clientç»“æŸï¼Œè¿˜å­˜åœ¨ã€‚ </p><p>â€‹    2.ä¸´æ—¶èŠ‚ç‚¹ </p><p>â€‹        åœ¨clientæ´»åŠ¨æ—¶æœ‰æ•ˆï¼Œæ–­å¼€è‡ªåŠ¨åˆ é™¤ã€‚ä¸´æ—¶èŠ‚ç‚¹ä¸èƒ½æœ‰å­èŠ‚ç‚¹ã€‚ </p><p>â€‹        leaderæ¨é€‰æ—¶ä½¿ç”¨ã€‚ </p><p>â€‹    3.åºåˆ—èŠ‚ç‚¹ </p><p>â€‹        åœ¨èŠ‚ç‚¹åä¹‹åé™„åŠ 10ä¸ªæ•°å­—ï¼Œä¸»è¦ç”¨äºåŒæ­¥å’Œé”. </p><h3 id="1-7-Session"><a href="#1-7-Session" class="headerlink" title="1.7. Session"></a>1.7. Session</h3><p>â€‹    Sessionä¸­çš„è¯·æ±‚ä»¥FIFOæ‰§è¡Œï¼Œä¸€æ—¦clientè¿æ¥åˆ°serverï¼Œsessionå°±å»ºç«‹äº†ã€‚sessionidåˆ†é…client. </p><p>â€‹    clientä»¥å›ºå®šé—´éš”å‘serverå‘é€å¿ƒè·³ï¼Œè¡¨ç¤ºsessionæ˜¯validçš„ï¼Œzké›†ç¾¤å¦‚æœåœ¨è¶…æ—¶æ—¶å€™ï¼Œæ²¡æœ‰æ”¶åˆ°å¿ƒè·³ï¼Œ </p><p>â€‹    åˆ¤å®šä¸ºclientæŒ‚äº†ï¼Œä¸æ­¤åŒæ—¶ï¼Œä¸´æ—¶èŠ‚ç‚¹è¢«åˆ é™¤ã€‚ </p><h3 id="1-8-Watches"><a href="#1-8-Watches" class="headerlink" title="1.8. Watches"></a>1.8. Watches</h3><p>â€‹    è§‚å¯Ÿã€‚ </p><p>â€‹    clientèƒ½å¤Ÿé€šè¿‡watchæœºåˆ¶åœ¨æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶æ”¶åˆ°é€šçŸ¥ã€‚ </p><p>â€‹    clientå¯ä»¥åœ¨read èŠ‚ç‚¹æ—¶è®¾ç½®è§‚å¯Ÿè€…ã€‚watchæœºåˆ¶ä¼šå‘é€é€šçŸ¥ç»™æ³¨å†Œçš„å®¢æˆ·ç«¯ã€‚ </p><p>â€‹    è§‚å¯Ÿæ¨¡å¼åªè§¦å‘ä¸€æ¬¡ã€‚ </p><p>â€‹    sessionè¿‡æœŸï¼Œwatchæœºåˆ¶åˆ é™¤äº†ã€‚ </p><h3 id="1-9-zkå·¥ä½œæµç¨‹"><a href="#1-9-zkå·¥ä½œæµç¨‹" class="headerlink" title="1.9. zkå·¥ä½œæµç¨‹"></a>1.9. zkå·¥ä½œæµç¨‹</h3><p>â€‹    zké›†ç¾¤å¯åŠ¨åï¼Œclientè¿æ¥åˆ°å…¶ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè¿™ä¸ªèŠ‚ç‚¹å¯ä»¥æ˜¯leaderï¼Œä¹Ÿå¯ä»¥æ˜¯followerã€‚ </p><p>â€‹    è¿é€šåï¼Œnodeåˆ†é…ä¸€ä¸ªidç»™clientï¼Œå‘é€ackä¿¡æ¯ç»™clientã€‚ </p><p>â€‹    å¦‚æœå®¢æˆ·ç«¯æ²¡æœ‰æ”¶åˆ°ackï¼Œè¿æ¥åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹ã€‚ </p><p>â€‹    clientå‘¨æœŸæ€§å‘é€å¿ƒè·³ä¿¡æ¯ç»™èŠ‚ç‚¹ä¿è¯è¿æ¥ä¸ä¼šä¸¢å¤±ã€‚ </p><p>â€‹    å¦‚æœclientè¯»å–æ•°æ®ï¼Œå‘é€è¯·æ±‚ç»™nodeï¼Œnodeè¯»å–è‡ªå·±æ•°æ®åº“ï¼Œè¿”å›èŠ‚ç‚¹æ•°æ®ç»™client. </p><p>â€‹    å¦‚æœclientæƒ³è¦åœ¨ zk ä¸­å­˜å‚¨æ•°æ®ï¼Œå°†è·¯å¾„å’Œæ•°æ®å‘é€ç»™serverï¼Œserverè½¬å‘ç»™leaderã€‚ </p><p>â€‹    leaderå†è¡¥å‘è¯·æ±‚ç»™æ‰€æœ‰followerã€‚åªæœ‰å¤§å¤šæ•°(è¶…è¿‡åŠæ•°)èŠ‚ç‚¹æˆåŠŸå“åº”ï¼Œåˆ™ </p><p>â€‹    å†™æ“ä½œæˆåŠŸã€‚ </p><h3 id="1-10-zk-åº”ç”¨åœºæ™¯"><a href="#1-10-zk-åº”ç”¨åœºæ™¯" class="headerlink" title="1.10 zk åº”ç”¨åœºæ™¯"></a>1.10 zk åº”ç”¨åœºæ™¯</h3><h4 id="1-10-1-ç»Ÿä¸€å‘½åæœåŠ¡"><a href="#1-10-1-ç»Ÿä¸€å‘½åæœåŠ¡" class="headerlink" title="1.10.1 ç»Ÿä¸€å‘½åæœåŠ¡"></a>1.10.1 ç»Ÿä¸€å‘½åæœåŠ¡</h4><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-23-073654.png" alt="image-20180623153654235"></p><h4 id="1-10-2-ç»Ÿä¸€é…ç®¡ç†"><a href="#1-10-2-ç»Ÿä¸€é…ç®¡ç†" class="headerlink" title="1.10.2 ç»Ÿä¸€é…ç®¡ç†"></a>1.10.2 ç»Ÿä¸€é…ç®¡ç†</h4><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-23-073811.png" alt="image-20180623153811327"></p><h4 id="1-10-3-ç»Ÿä¸€é›†ç¾¤ç®¡ç†"><a href="#1-10-3-ç»Ÿä¸€é›†ç¾¤ç®¡ç†" class="headerlink" title="1.10.3 ç»Ÿä¸€é›†ç¾¤ç®¡ç†"></a>1.10.3 ç»Ÿä¸€é›†ç¾¤ç®¡ç†</h4><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-23-073914.png" alt="image-20180623153914499"></p><h4 id="1-10-4-æœåŠ¡å™¨åŠ¨æ€ä¸Šä¸‹çº¿"><a href="#1-10-4-æœåŠ¡å™¨åŠ¨æ€ä¸Šä¸‹çº¿" class="headerlink" title="1.10.4 æœåŠ¡å™¨åŠ¨æ€ä¸Šä¸‹çº¿"></a>1.10.4 æœåŠ¡å™¨åŠ¨æ€ä¸Šä¸‹çº¿</h4><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-23-074113.png" alt="image-20180623154113232"></p><h4 id="1-10-5-è½¯è´Ÿè½½å‡è¡¡"><a href="#1-10-5-è½¯è´Ÿè½½å‡è¡¡" class="headerlink" title="1.10.5 è½¯è´Ÿè½½å‡è¡¡"></a>1.10.5 è½¯è´Ÿè½½å‡è¡¡</h4><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-23-074213.png" alt="image-20180623154212560"></p><h1 id="2-Zookeeper-å®Œå…¨åˆ†å¸ƒå¼çš„å®‰è£…-amp-åŸºæœ¬ä½¿ç”¨"><a href="#2-Zookeeper-å®Œå…¨åˆ†å¸ƒå¼çš„å®‰è£…-amp-åŸºæœ¬ä½¿ç”¨" class="headerlink" title="2.Zookeeper å®Œå…¨åˆ†å¸ƒå¼çš„å®‰è£…&amp;åŸºæœ¬ä½¿ç”¨"></a>2.Zookeeper å®Œå…¨åˆ†å¸ƒå¼çš„å®‰è£…&amp;åŸºæœ¬ä½¿ç”¨</h1><h3 id="2-1-å®‰è£…"><a href="#2-1-å®‰è£…" class="headerlink" title="2.1 å®‰è£…"></a>2.1 å®‰è£…</h3><h4 id="2-1-1-é«˜å¯ç”¨å®‰è£…"><a href="#2-1-1-é«˜å¯ç”¨å®‰è£…" class="headerlink" title="2.1.1 é«˜å¯ç”¨å®‰è£…"></a>2.1.1 é«˜å¯ç”¨å®‰è£…</h4><p><a href="https://airpoet.github.io/2018/06/22/Hadoop/0-Hadoop/Hadoop-HA%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/">PS:  é«˜å¯ç”¨å®‰è£…è§è¿™é‡Œ</a></p><h4 id="2-2-2-å®Œå…¨åˆ†å¸ƒå¼å®‰è£…"><a href="#2-2-2-å®Œå…¨åˆ†å¸ƒå¼å®‰è£…" class="headerlink" title="2.2.2 å®Œå…¨åˆ†å¸ƒå¼å®‰è£…"></a>2.2.2 å®Œå…¨åˆ†å¸ƒå¼å®‰è£…</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">1.æŒ‘é€‰3å°ä¸»æœº</span><br><span class="line">cs1 ~ cs3</span><br><span class="line">2.æ¯å°æœºå™¨éƒ½å®‰è£…zk &amp; é…ç½®ç¯å¢ƒå˜é‡</span><br><span class="line"></span><br><span class="line">3.é…ç½®zké…ç½®æ–‡ä»¶</span><br><span class="line">cs1 ~ cs3</span><br><span class="line">[/home/ap/apps/zk/conf/zoo.cfg]</span><br><span class="line">----------</span><br><span class="line">tickTime=2000</span><br><span class="line">initLimit=10</span><br><span class="line">syncLimit=5</span><br><span class="line">dataDir=/home/ap/zookeeper</span><br><span class="line">clientPort=2181</span><br><span class="line"></span><br><span class="line">server.1=cs1:2888:3888</span><br><span class="line">server.2=cs2:2888:3888</span><br><span class="line">server.3=cs3:2888:3888</span><br><span class="line">---------</span><br><span class="line"></span><br><span class="line">4.åœ¨æ¯å°ä¸»æœºçš„/home/ap/zookeeperä¸­æ·»åŠ myid,å†…å®¹åˆ†åˆ«æ˜¯1,2,3</span><br><span class="line">[cs1]</span><br><span class="line">$&gt;<span class="built_in">echo</span> 1 &gt; /home/ap/zookeeper/myid</span><br><span class="line">[cs2]</span><br><span class="line">$&gt;<span class="built_in">echo</span> 2 &gt; /home/ap/zookeeper/myid</span><br><span class="line">[cs3]</span><br><span class="line">$&gt;<span class="built_in">echo</span> 3 &gt; /home/ap/zookeeper/myid</span><br><span class="line"></span><br><span class="line">5.åœ¨cs1~cs3ä¸Š,å¯åŠ¨æœåŠ¡å™¨é›†ç¾¤ </span><br><span class="line">$&gt;zkServer.sh start</span><br><span class="line"></span><br><span class="line">6.æŸ¥çœ‹æ¯å°æœåŠ¡å™¨çš„çŠ¶æ€</span><br><span class="line">$&gt;zkServer.sh status</span><br><span class="line">* æ³¨æ„: å¦‚æœæœ‰3å°æœºå™¨, åªå¯åŠ¨ä¸€å°çš„è¯, ä¼šæ˜¾ç¤ºå¦‚ä¸‹, å› ä¸ºæ ¹æ®é…ç½®, æœ‰3å°æœºå™¨, æ­¤æ—¶åªæœ‰ä¸€å°å¯åŠ¨, æ²¡æœ‰è¿‡åŠæ•°, æ•´ä¸ªé›†ç¾¤æ˜¯æŒ‚æ‰çš„</span><br><span class="line">* åªæœ‰å¯åŠ¨çš„æœºå™¨æ•°é‡è¶…è¿‡é…ç½®çš„åŠæ•°, zk é›†ç¾¤æ‰æœ‰æ•ˆ.</span><br></pre></td></tr></table></figure><h4 id="2-2-3-zoo-cfg-æ–‡ä»¶ä¸­é…ç½®å‚æ•°çš„å«ä¹‰"><a href="#2-2-3-zoo-cfg-æ–‡ä»¶ä¸­é…ç½®å‚æ•°çš„å«ä¹‰" class="headerlink" title="2.2.3 zoo.cfg æ–‡ä»¶ä¸­é…ç½®å‚æ•°çš„å«ä¹‰"></a>2.2.3 <strong>zoo.cfg æ–‡ä»¶ä¸­é…ç½®å‚æ•°çš„å«ä¹‰</strong></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">1ï¼‰tickTime=2000ï¼šé€šä¿¡å¿ƒè·³æ•°</span><br><span class="line">    tickTimeï¼šé€šä¿¡å¿ƒè·³æ•°ï¼ŒZookeeperæœåŠ¡å™¨å¿ƒè·³æ—¶é—´ï¼Œå•ä½æ¯«ç§’</span><br><span class="line">    Zookeeperä½¿ç”¨çš„åŸºæœ¬æ—¶é—´ï¼ŒæœåŠ¡å™¨ä¹‹é—´æˆ–å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´ç»´æŒå¿ƒè·³çš„æ—¶é—´é—´éš”ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªtickTimeæ—¶é—´å°±ä¼šå‘é€ä¸€ä¸ªå¿ƒè·³ï¼Œæ—¶é—´å•ä½ä¸ºæ¯«ç§’ã€‚</span><br><span class="line">    å®ƒç”¨äºå¿ƒè·³æœºåˆ¶ï¼Œå¹¶ä¸”è®¾ç½®æœ€å°çš„sessionè¶…æ—¶æ—¶é—´ä¸ºä¸¤å€å¿ƒè·³æ—¶é—´ã€‚(sessionçš„æœ€å°è¶…æ—¶æ—¶é—´æ˜¯2*tickTime)</span><br><span class="line">2ï¼‰initLimit=10ï¼šLFåˆå§‹é€šä¿¡æ—¶é™</span><br><span class="line">    initLimitï¼šLFåˆå§‹é€šä¿¡æ—¶é™</span><br><span class="line">    é›†ç¾¤ä¸­çš„followerè·Ÿéšè€…æœåŠ¡å™¨(F)ä¸leaderé¢†å¯¼è€…æœåŠ¡å™¨(L)ä¹‹é—´åˆå§‹è¿æ¥æ—¶èƒ½å®¹å¿çš„æœ€å¤šå¿ƒè·³æ•°ï¼ˆtickTimeçš„æ•°é‡ï¼‰ï¼Œç”¨å®ƒæ¥é™å®šé›†ç¾¤ä¸­çš„ZookeeperæœåŠ¡å™¨è¿æ¥åˆ°Leaderçš„æ—¶é™ã€‚</span><br><span class="line">    æŠ•ç¥¨é€‰ä¸¾æ–°leaderçš„åˆå§‹åŒ–æ—¶é—´</span><br><span class="line">    Followeråœ¨å¯åŠ¨è¿‡ç¨‹ä¸­ï¼Œä¼šä»LeaderåŒæ­¥æ‰€æœ‰æœ€æ–°æ•°æ®ï¼Œç„¶åç¡®å®šè‡ªå·±èƒ½å¤Ÿå¯¹å¤–æœåŠ¡çš„èµ·å§‹çŠ¶æ€ã€‚</span><br><span class="line">    Leaderå…è®¸Fåœ¨initLimitæ—¶é—´å†…å®Œæˆè¿™ä¸ªå·¥ä½œã€‚</span><br><span class="line">3ï¼‰syncLimit=5ï¼šLFåŒæ­¥é€šä¿¡æ—¶é™</span><br><span class="line">    syncLimitï¼šLFåŒæ­¥é€šä¿¡æ—¶é™</span><br><span class="line">    é›†ç¾¤ä¸­Leaderä¸Followerä¹‹é—´çš„æœ€å¤§å“åº”æ—¶é—´å•ä½ï¼Œå‡å¦‚å“åº”è¶…è¿‡syncLimit * tickTimeï¼Œ</span><br><span class="line">    Leaderè®¤ä¸ºFollweræ­»æ‰ï¼Œä»æœåŠ¡å™¨åˆ—è¡¨ä¸­åˆ é™¤Follwerã€‚</span><br><span class="line">    åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼ŒLeaderè´Ÿè´£ä¸ZKé›†ç¾¤ä¸­æ‰€æœ‰æœºå™¨è¿›è¡Œé€šä¿¡ï¼Œä¾‹å¦‚é€šè¿‡ä¸€äº›å¿ƒè·³æ£€æµ‹æœºåˆ¶ï¼Œæ¥æ£€æµ‹æœºå™¨çš„å­˜æ´»çŠ¶æ€ã€‚</span><br><span class="line">    å¦‚æœLå‘å‡ºå¿ƒè·³åŒ…åœ¨syncLimitä¹‹åï¼Œè¿˜æ²¡æœ‰ä»Fé‚£æ”¶åˆ°å“åº”ï¼Œé‚£ä¹ˆå°±è®¤ä¸ºè¿™ä¸ªFå·²ç»ä¸åœ¨çº¿äº†ã€‚</span><br><span class="line">4ï¼‰dataDirï¼šæ•°æ®æ–‡ä»¶ç›®å½•+æ•°æ®æŒä¹…åŒ–è·¯å¾„</span><br><span class="line">    dataDirï¼šæ•°æ®æ–‡ä»¶ç›®å½•+æ•°æ®æŒä¹…åŒ–è·¯å¾„</span><br><span class="line">    ä¿å­˜å†…å­˜æ•°æ®åº“å¿«ç…§ä¿¡æ¯çš„ä½ç½®ï¼Œå¦‚æœæ²¡æœ‰å…¶ä»–è¯´æ˜ï¼Œæ›´æ–°çš„äº‹åŠ¡æ—¥å¿—ä¹Ÿä¿å­˜åˆ°æ•°æ®åº“ã€‚</span><br><span class="line">5ï¼‰clientPort=2181ï¼šå®¢æˆ·ç«¯è¿æ¥ç«¯å£</span><br><span class="line">    ç›‘å¬å®¢æˆ·ç«¯è¿æ¥çš„ç«¯å£</span><br><span class="line">6) Server.A=B:C:Dã€‚</span><br><span class="line">    Aæ˜¯ä¸€ä¸ªæ•°å­—ï¼Œè¡¨ç¤ºè¿™ä¸ªæ˜¯ç¬¬å‡ å·æœåŠ¡å™¨ï¼›</span><br><span class="line">    Bæ˜¯è¿™ä¸ªæœåŠ¡å™¨çš„ipåœ°å€ï¼›</span><br><span class="line">    Cæ˜¯è¿™ä¸ªæœåŠ¡å™¨ä¸é›†ç¾¤ä¸­çš„LeaderæœåŠ¡å™¨äº¤æ¢ä¿¡æ¯çš„ç«¯å£ï¼›</span><br><span class="line">    Dæ˜¯ä¸‡ä¸€é›†ç¾¤ä¸­çš„LeaderæœåŠ¡å™¨æŒ‚äº†ï¼Œéœ€è¦ä¸€ä¸ªç«¯å£æ¥é‡æ–°è¿›è¡Œé€‰ä¸¾ï¼Œé€‰å‡ºä¸€ä¸ªæ–°çš„Leaderï¼Œè€Œè¿™ä¸ªç«¯å£å°±æ˜¯ç”¨æ¥æ‰§è¡Œé€‰ä¸¾æ—¶æœåŠ¡å™¨ç›¸äº’é€šä¿¡çš„ç«¯å£ã€‚</span><br><span class="line">    <span class="comment"># é›†ç¾¤æ¨¡å¼ä¸‹é…ç½®ä¸€ä¸ªæ–‡ä»¶myidï¼Œè¿™ä¸ªæ–‡ä»¶åœ¨dataDirç›®å½•ä¸‹ï¼Œè¿™ä¸ªæ–‡ä»¶é‡Œé¢æœ‰ä¸€ä¸ªæ•°æ®å°±æ˜¯Açš„å€¼ï¼ŒZookeeperå¯åŠ¨æ—¶è¯»å–æ­¤æ–‡ä»¶ï¼Œæ‹¿åˆ°é‡Œé¢çš„æ•°æ®ä¸zoo.cfgé‡Œé¢çš„é…ç½®ä¿¡æ¯æ¯”è¾ƒä»è€Œåˆ¤æ–­åˆ°åº•æ˜¯å“ªä¸ªserverã€‚</span></span><br></pre></td></tr></table></figure><h3 id="2-2-ZKå®¢æˆ·ç«¯çš„è¿æ¥"><a href="#2-2-ZKå®¢æˆ·ç«¯çš„è¿æ¥" class="headerlink" title="2.2 ZKå®¢æˆ·ç«¯çš„è¿æ¥"></a>2.2 ZKå®¢æˆ·ç«¯çš„è¿æ¥</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">$&gt;zkCli.sh -server cs1:2181    //è¿›å…¥zkå‘½ä»¤è¡Œ</span><br><span class="line"><span class="variable">$zk</span>]<span class="built_in">help</span>                        //æŸ¥çœ‹å¸®åŠ©</span><br><span class="line"><span class="variable">$zk</span>]quit                        //é€€å‡º</span><br><span class="line"><span class="variable">$zk</span>]create /a tom                 //åˆ›å»ºèŠ‚ç‚¹</span><br><span class="line"><span class="variable">$zk</span>]get /a                        //æŸ¥çœ‹æ•°æ®</span><br><span class="line"><span class="variable">$zk</span>]ls /                          //åˆ—å‡ºèŠ‚ç‚¹</span><br><span class="line"><span class="variable">$zk</span>]ls2 /                         //æŸ¥çœ‹å½“å‰èŠ‚ç‚¹æ•°æ®å¹¶èƒ½çœ‹åˆ°æ›´æ–°æ¬¡æ•°ç­‰æ•°æ®</span><br><span class="line"><span class="variable">$zk</span>]<span class="built_in">set</span> /a tom                    //è®¾ç½®æ•°æ®</span><br><span class="line"><span class="variable">$zk</span>]delete /a                     //åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹</span><br><span class="line"><span class="variable">$zk</span>]rmr /a                        //é€’å½’åˆ é™¤æ‰€æœ‰èŠ‚ç‚¹ã€‚</span><br><span class="line"><span class="variable">$zk</span>]<span class="built_in">stat</span> ///æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€</span><br><span class="line"></span><br><span class="line">æ³¨æ„: </span><br><span class="line">* åˆ›å»ºèŠ‚ç‚¹ä¸èƒ½é€’å½’åˆ›å»º, ç›®å‰åªèƒ½ä¸€å±‚ä¸€å±‚åˆ›å»º</span><br><span class="line">* æ¯æ¬¡åˆ›å»ºéƒ½çš„å†™æ•°æ®, åªåˆ›å»ºç›®å½•çš„è¯ä¼šåˆ›å»ºä¸æˆåŠŸ</span><br><span class="line">* å¦‚æœ close å, å¹¶æ²¡æœ‰é€€å‡ºå®¢æˆ·ç«¯, åªæ˜¯è®¿é—®ä¸åˆ°æ•°æ®, æ­¤æ—¶å¦‚æœæƒ³è¦è¿æ¥, å¯ä»¥ç”¨connect host:port</span><br><span class="line">================================================================================</span><br><span class="line"></span><br><span class="line">ZK çš„å¸®åŠ©æ–‡æ¡£</span><br><span class="line">----------------</span><br><span class="line"><span class="built_in">help</span>:</span><br><span class="line">ZooKeeper -server host:port cmd args</span><br><span class="line">    <span class="built_in">stat</span> path [watch]</span><br><span class="line">    <span class="built_in">set</span> path data [version]</span><br><span class="line">    ls path [watch]</span><br><span class="line">    delquota [-n|-b] path</span><br><span class="line">    ls2 path [watch]</span><br><span class="line">    setAcl path acl</span><br><span class="line">    setquota -n|-b val path</span><br><span class="line">    <span class="built_in">history</span></span><br><span class="line">    redo cmdno</span><br><span class="line">    printwatches on|off</span><br><span class="line">    delete path [version]</span><br><span class="line">    sync path</span><br><span class="line">    listquota path</span><br><span class="line">    rmr path</span><br><span class="line">    get path [watch]</span><br><span class="line">    create [-s] [-e] path data acl</span><br><span class="line">    addauth scheme auth</span><br><span class="line">    quit</span><br><span class="line">    getAcl path</span><br><span class="line">    close</span><br><span class="line">    connect host:port</span><br></pre></td></tr></table></figure><h3 id="2-3-ç›‘å¬æµ‹è¯•"><a href="#2-3-ç›‘å¬æµ‹è¯•" class="headerlink" title="2.3 ç›‘å¬æµ‹è¯•"></a>2.3 ç›‘å¬æµ‹è¯•</h3><p><strong>æ³¨æ„ç‚¹: æ³¨å†Œçš„ç›‘å¬åªèƒ½ä½¿ç”¨ä¸€æ¬¡, ç›‘å¬å®Œæ¯•åéœ€è¦é‡æ–°æ³¨å†Œ.</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">=======èŠ‚ç‚¹å€¼çš„å˜åŒ–çš„ç›‘å¬==========</span><br><span class="line">ï¼ˆ1ï¼‰åœ¨cs1ä¸»æœºä¸Šæ³¨å†Œç›‘å¬/app1èŠ‚ç‚¹æ•°æ®å˜åŒ–</span><br><span class="line">[zk: localhost:2181(CONNECTED) 26] get /app1 watch</span><br><span class="line"></span><br><span class="line">ï¼ˆ2ï¼‰åœ¨cs2ä¸»æœºä¸Šä¿®æ”¹/app1èŠ‚ç‚¹çš„æ•°æ®</span><br><span class="line">[zk: localhost:2181(CONNECTED) 5] <span class="built_in">set</span> /app1  777</span><br><span class="line"></span><br><span class="line">ï¼ˆ3ï¼‰è§‚å¯Ÿcs2ä¸»æœºæ”¶åˆ°æ•°æ®å˜åŒ–çš„ç›‘å¬</span><br><span class="line">WATCHER::</span><br><span class="line">WatchedEvent state:SyncConnected <span class="built_in">type</span>:NodeDataChanged path:/app1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">=======èŠ‚ç‚¹çš„å­èŠ‚ç‚¹å˜åŒ–çš„ç›‘å¬==========</span><br><span class="line">ï¼ˆ1ï¼‰åœ¨cs1ä¸»æœºä¸Šæ³¨å†Œç›‘å¬/app1èŠ‚ç‚¹çš„å­èŠ‚ç‚¹å˜åŒ–</span><br><span class="line">[zk: localhost:2181(CONNECTED) 1] ls /app1 watch</span><br><span class="line">[aa0000000001, server101]</span><br><span class="line"></span><br><span class="line">ï¼ˆ2ï¼‰åœ¨cs2ä¸»æœº/app1èŠ‚ç‚¹ä¸Šåˆ›å»ºå­èŠ‚ç‚¹</span><br><span class="line">[zk: localhost:2181(CONNECTED) 6] create /app1/bb 666</span><br><span class="line">Created /app1/bb</span><br><span class="line"></span><br><span class="line">ï¼ˆ3ï¼‰è§‚å¯Ÿcs1ä¸»æœºæ”¶åˆ°å­èŠ‚ç‚¹å˜åŒ–çš„ç›‘å¬</span><br><span class="line">WATCHER::</span><br><span class="line">WatchedEvent state:SyncConnected <span class="built_in">type</span>:NodeChildrenChanged path:/app1</span><br></pre></td></tr></table></figure><h1 id="3-ZK-å†…éƒ¨æœºåˆ¶"><a href="#3-ZK-å†…éƒ¨æœºåˆ¶" class="headerlink" title="3. ZK å†…éƒ¨æœºåˆ¶"></a>3. ZK å†…éƒ¨æœºåˆ¶</h1><h2 id="3-1-é€‰ä¸¾æœºåˆ¶"><a href="#3-1-é€‰ä¸¾æœºåˆ¶" class="headerlink" title="3.1  é€‰ä¸¾æœºåˆ¶"></a>3.1  é€‰ä¸¾æœºåˆ¶</h2><h4 id="3-1-1-zookeeperçš„é€‰ä¸¾æœºåˆ¶ï¼ˆå…¨æ–°é›†ç¾¤paxosï¼‰"><a href="#3-1-1-zookeeperçš„é€‰ä¸¾æœºåˆ¶ï¼ˆå…¨æ–°é›†ç¾¤paxosï¼‰" class="headerlink" title="3.1.1. zookeeperçš„é€‰ä¸¾æœºåˆ¶ï¼ˆå…¨æ–°é›†ç¾¤paxosï¼‰"></a>3.1.1. zookeeperçš„é€‰ä¸¾æœºåˆ¶ï¼ˆå…¨æ–°é›†ç¾¤paxosï¼‰</h4><p>ä»¥ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´æ˜æ•´ä¸ªé€‰ä¸¾çš„è¿‡ç¨‹.<br> å‡è®¾æœ‰äº”å°æœåŠ¡å™¨ç»„æˆçš„zookeeperé›†ç¾¤,å®ƒä»¬çš„idä»1-5,åŒæ—¶å®ƒä»¬éƒ½æ˜¯æœ€æ–°å¯åŠ¨çš„,ä¹Ÿå°±æ˜¯æ²¡æœ‰å†å²æ•°æ®,åœ¨å­˜æ”¾æ•°æ®é‡è¿™ä¸€ç‚¹ä¸Š,éƒ½æ˜¯ä¸€æ ·çš„.å‡è®¾è¿™äº›æœåŠ¡å™¨ä¾åºå¯åŠ¨,æ¥çœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆ.<br> 1) æœåŠ¡å™¨1å¯åŠ¨,æ­¤æ—¶åªæœ‰å®ƒä¸€å°æœåŠ¡å™¨å¯åŠ¨äº†,å®ƒå‘å‡ºå»çš„æŠ¥æ²¡æœ‰ä»»ä½•å“åº”,æ‰€ä»¥å®ƒçš„é€‰ä¸¾çŠ¶æ€ä¸€ç›´æ˜¯LOOKINGçŠ¶æ€<br> 2) æœåŠ¡å™¨2å¯åŠ¨,å®ƒä¸æœ€å¼€å§‹å¯åŠ¨çš„æœåŠ¡å™¨1è¿›è¡Œé€šä¿¡,äº’ç›¸äº¤æ¢è‡ªå·±çš„é€‰ä¸¾ç»“æœ,ç”±äºä¸¤è€…éƒ½æ²¡æœ‰å†å²æ•°æ®,æ‰€ä»¥idå€¼è¾ƒå¤§çš„æœåŠ¡å™¨2èƒœå‡º,ä½†æ˜¯ç”±äºæ²¡æœ‰è¾¾åˆ°è¶…è¿‡åŠæ•°ä»¥ä¸Šçš„æœåŠ¡å™¨éƒ½åŒæ„é€‰ä¸¾å®ƒ(è¿™ä¸ªä¾‹å­ä¸­çš„åŠæ•°ä»¥ä¸Šæ˜¯3),æ‰€ä»¥æœåŠ¡å™¨1,2è¿˜æ˜¯ç»§ç»­ä¿æŒLOOKINGçŠ¶æ€.<br> 3) æœåŠ¡å™¨3å¯åŠ¨,æ ¹æ®å‰é¢çš„ç†è®ºåˆ†æ,æœåŠ¡å™¨3æˆä¸ºæœåŠ¡å™¨1,2,3ä¸­çš„è€å¤§,è€Œä¸ä¸Šé¢ä¸åŒçš„æ˜¯,æ­¤æ—¶æœ‰ä¸‰å°æœåŠ¡å™¨é€‰ä¸¾äº†å®ƒ,æ‰€ä»¥å®ƒæˆä¸ºäº†è¿™æ¬¡é€‰ä¸¾çš„leader.<br> 4) æœåŠ¡å™¨4å¯åŠ¨,æ ¹æ®å‰é¢çš„åˆ†æ,ç†è®ºä¸ŠæœåŠ¡å™¨4åº”è¯¥æ˜¯æœåŠ¡å™¨1,2,3,4ä¸­æœ€å¤§çš„,ä½†æ˜¯ç”±äºå‰é¢å·²ç»æœ‰åŠæ•°ä»¥ä¸Šçš„æœåŠ¡å™¨é€‰ä¸¾äº†æœåŠ¡å™¨3,æ‰€ä»¥å®ƒåªèƒ½æ¥æ”¶å½“å°å¼Ÿçš„å‘½äº†.<br> 5) æœåŠ¡å™¨5å¯åŠ¨,åŒ4ä¸€æ ·,å½“å°å¼Ÿ.</p><h4 id="3-1-2-éå…¨æ–°é›†ç¾¤çš„é€‰ä¸¾æœºåˆ¶-æ•°æ®æ¢å¤"><a href="#3-1-2-éå…¨æ–°é›†ç¾¤çš„é€‰ä¸¾æœºåˆ¶-æ•°æ®æ¢å¤" class="headerlink" title="3.1.2. éå…¨æ–°é›†ç¾¤çš„é€‰ä¸¾æœºåˆ¶(æ•°æ®æ¢å¤)"></a>3.1.2. éå…¨æ–°é›†ç¾¤çš„é€‰ä¸¾æœºåˆ¶(æ•°æ®æ¢å¤)</h4><p>é‚£ä¹ˆï¼Œåˆå§‹åŒ–çš„æ—¶å€™ï¼Œæ˜¯æŒ‰ç…§ä¸Šè¿°çš„è¯´æ˜è¿›è¡Œé€‰ä¸¾çš„ï¼Œä½†æ˜¯å½“zookeeperè¿è¡Œäº†ä¸€æ®µæ—¶é—´ä¹‹åï¼Œæœ‰æœºå™¨downæ‰ï¼Œé‡æ–°é€‰ä¸¾æ—¶ï¼Œé€‰ä¸¾è¿‡ç¨‹å°±ç›¸å¯¹å¤æ‚äº†ã€‚</p><p>éœ€è¦åŠ å…¥æ•°æ®idã€leader idå’Œé€»è¾‘æ—¶é’Ÿã€‚</p><p>æ•°æ®idï¼šæ•°æ®æ–°çš„idå°±å¤§ï¼Œæ•°æ®æ¯æ¬¡æ›´æ–°éƒ½ä¼šæ›´æ–°idã€‚</p><p>Leader idï¼šå°±æ˜¯æˆ‘ä»¬é…ç½®çš„myidä¸­çš„å€¼ï¼Œæ¯ä¸ªæœºå™¨ä¸€ä¸ªã€‚</p><p>é€»è¾‘æ—¶é’Ÿï¼šè¿™ä¸ªå€¼ä»0å¼€å§‹é€’å¢,æ¯æ¬¡é€‰ä¸¾å¯¹åº”ä¸€ä¸ªå€¼,ä¹Ÿå°±æ˜¯è¯´:  å¦‚æœåœ¨åŒä¸€æ¬¡é€‰ä¸¾ä¸­,é‚£ä¹ˆè¿™ä¸ªå€¼åº”è¯¥æ˜¯ä¸€è‡´çš„ ;  é€»è¾‘æ—¶é’Ÿå€¼è¶Šå¤§,è¯´æ˜è¿™ä¸€æ¬¡é€‰ä¸¾leaderçš„è¿›ç¨‹æ›´æ–°.</p><p>é€‰ä¸¾çš„æ ‡å‡†å°±å˜æˆï¼š</p><p>â€‹                     1ã€é€»è¾‘æ—¶é’Ÿå°çš„é€‰ä¸¾ç»“æœè¢«å¿½ç•¥ï¼Œé‡æ–°æŠ•ç¥¨</p><p>â€‹                     2ã€ç»Ÿä¸€é€»è¾‘æ—¶é’Ÿåï¼Œæ•°æ®idå¤§çš„èƒœå‡º</p><p>â€‹                     3ã€æ•°æ®idç›¸åŒçš„æƒ…å†µä¸‹ï¼Œleader idå¤§çš„èƒœå‡º</p><p>æ ¹æ®è¿™ä¸ªè§„åˆ™é€‰å‡ºleaderã€‚</p><h2 id="3-2-stat-çš„ç»“æ„"><a href="#3-2-stat-çš„ç»“æ„" class="headerlink" title="3.2  stat çš„ç»“æ„"></a>3.2  stat çš„ç»“æ„</h2><ul><li>1ï¼‰czxid- å¼•èµ·è¿™ä¸ªznodeåˆ›å»ºçš„zxidï¼Œåˆ›å»ºèŠ‚ç‚¹çš„äº‹åŠ¡çš„zxid<ul><li>æ¯æ¬¡ä¿®æ”¹ZooKeeperçŠ¶æ€éƒ½ä¼šæ”¶åˆ°ä¸€ä¸ªzxidå½¢å¼çš„æ—¶é—´æˆ³ï¼Œä¹Ÿå°±æ˜¯ZooKeeperäº‹åŠ¡IDã€‚<br>äº‹åŠ¡IDæ˜¯ZooKeeperä¸­æ‰€æœ‰ä¿®æ”¹æ€»çš„æ¬¡åºã€‚æ¯ä¸ªä¿®æ”¹éƒ½æœ‰å”¯ä¸€çš„zxidï¼Œå¦‚æœzxid1å°äºzxid2ï¼Œé‚£ä¹ˆzxid1åœ¨zxid2ä¹‹å‰å‘ç”Ÿã€‚</li></ul></li><li>2ï¼‰ctime - znodeè¢«åˆ›å»ºçš„æ¯«ç§’æ•°(ä»1970å¹´å¼€å§‹)</li><li>3ï¼‰mzxid - znodeæœ€åæ›´æ–°çš„zxid</li><li>4ï¼‰mtime - znodeæœ€åä¿®æ”¹çš„æ¯«ç§’æ•°(ä»1970å¹´å¼€å§‹)</li><li>5ï¼‰pZxid-znodeæœ€åæ›´æ–°çš„å­èŠ‚ç‚¹zxid</li><li>6ï¼‰cversion - znodeå­èŠ‚ç‚¹å˜åŒ–å·ï¼Œznodeå­èŠ‚ç‚¹ä¿®æ”¹æ¬¡æ•°</li><li>7ï¼‰dataversion - znodeæ•°æ®å˜åŒ–å·</li><li>8ï¼‰aclVersion - znodeè®¿é—®æ§åˆ¶åˆ—è¡¨çš„å˜åŒ–å·</li><li>9ï¼‰ephemeralOwner- å¦‚æœæ˜¯ä¸´æ—¶èŠ‚ç‚¹ï¼Œè¿™ä¸ªæ˜¯znodeæ‹¥æœ‰è€…çš„session idã€‚å¦‚æœä¸æ˜¯ä¸´æ—¶èŠ‚ç‚¹åˆ™æ˜¯0ã€‚</li><li>10ï¼‰dataLength- znodeçš„æ•°æ®é•¿åº¦</li><li>11ï¼‰numChildren - znodeå­èŠ‚ç‚¹æ•°é‡</li></ul><h1 id="4-é€šè¿‡-JavaAPI-è®¿é—®-ZK"><a href="#4-é€šè¿‡-JavaAPI-è®¿é—®-ZK" class="headerlink" title="4. é€šè¿‡ JavaAPI è®¿é—® ZK"></a>4. é€šè¿‡ JavaAPI è®¿é—® ZK</h1><h3 id="4-1-æ·»åŠ Maven-ä¾èµ–"><a href="#4-1-æ·»åŠ Maven-ä¾èµ–" class="headerlink" title="4.1  æ·»åŠ Maven ä¾èµ–"></a>4.1  æ·»åŠ Maven ä¾èµ–</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">9.1[pom.xml]</span><br><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.it18zhang<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ZooKeeperDemo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.zookeeper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="4-2-Java-ä»£ç "><a href="#4-2-Java-ä»£ç " class="headerlink" title="4.2 Java ä»£ç "></a>4.2 Java ä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line">* å¯¹åº”å…³ç³»:</span><br><span class="line">*  Linux   Java</span><br><span class="line">----------------------</span><br><span class="line">*  ls      getChildren</span><br><span class="line">*  get     getData</span><br><span class="line">*  set     setDAta</span><br><span class="line">*  create  create</span><br><span class="line">Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜Ë˜</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.rox.zktest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.data.ACL;</span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.data.Stat;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¯¹åº”å…³ç³»:</span></span><br><span class="line"><span class="comment"> *  Linux   Java</span></span><br><span class="line"><span class="comment"> *  ls      getChildren</span></span><br><span class="line"><span class="comment"> *  get     getData</span></span><br><span class="line"><span class="comment"> *  set     setDAta</span></span><br><span class="line"><span class="comment"> *  create  create</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestZK</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ls</span><span class="params">()</span> <span class="keyword">throws</span> IOException, KeeperException, InterruptedException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * æ”¾ä¸‰ä¸ªå°±ä¸è¡Œ, åªèƒ½æ”¾2ä¸ªç›®å‰æ¥çœ‹</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        ZooKeeper zk = <span class="keyword">new</span> ZooKeeper(<span class="string">"cs1:2181,cs2:2181,cs3:2181"</span>, <span class="number">5000</span>, <span class="keyword">null</span>);</span><br><span class="line">        List&lt;String&gt; list = zk.getChildren(<span class="string">"/"</span>, <span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (String s : list) &#123;</span><br><span class="line">            System.out.println(s);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lsAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ls(<span class="string">"/"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ—å‡ºæŒ‡å®š path ä¸‹çš„children</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> path</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ls</span><span class="params">(String path)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(path);</span><br><span class="line"></span><br><span class="line">        ZooKeeper zk = <span class="keyword">new</span> ZooKeeper(<span class="string">"cs1:2181,cs2:2181,cs3:2181"</span>, <span class="number">5000</span>, <span class="keyword">null</span>);</span><br><span class="line">        List&lt;String&gt; list = zk.getChildren(path, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">if</span> (list == <span class="keyword">null</span> || list.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (String s : list) &#123;</span><br><span class="line">            <span class="comment">// å…ˆè¾“å‡º children</span></span><br><span class="line">            <span class="keyword">if</span> (path.equals(<span class="string">"/"</span> )) &#123;</span><br><span class="line">                ls(path + s);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                ls(path + <span class="string">"/"</span> + s);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¾ç½®æ•°æ®</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">void</span>  <span class="title">setData</span><span class="params">()</span> <span class="keyword">throws</span>  Exception </span>&#123;</span><br><span class="line">        ZooKeeper zk = <span class="keyword">new</span> ZooKeeper(<span class="string">"cs1:2181"</span>, <span class="number">5000</span>, <span class="keyword">null</span>);</span><br><span class="line">        zk.setData(<span class="string">"/a"</span>,<span class="string">"tomaslee"</span>.getBytes(),<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºä¸´æ—¶èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">createEPHEMERAL</span><span class="params">()</span> <span class="keyword">throws</span>  Exception </span>&#123;</span><br><span class="line">        ZooKeeper zk = <span class="keyword">new</span> ZooKeeper(<span class="string">"cs1:2181"</span>, <span class="number">5000</span>, <span class="keyword">null</span>);</span><br><span class="line">        zk.create(<span class="string">"/c/c1"</span>, <span class="string">"tom"</span>.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE,</span><br><span class="line">                CreateMode.EPHEMERAL);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"hello"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºè§‚å¯Ÿè€…</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">testWatch</span><span class="params">()</span> <span class="keyword">throws</span>  Exception </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> ZooKeeper zk = <span class="keyword">new</span> ZooKeeper(<span class="string">"cs1:2181,cs2:2181,cs3:2181"</span>, <span class="number">5000</span>, <span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">        Stat st = <span class="keyword">new</span> Stat();</span><br><span class="line"></span><br><span class="line">        Watcher w = <span class="keyword">null</span>;</span><br><span class="line">        w = <span class="keyword">new</span> Watcher() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(WatchedEvent event)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">"æ•°æ®æ”¹äº†..."</span>);</span><br><span class="line">                    zk.getData(<span class="string">"/a"</span>,<span class="keyword">this</span>,<span class="keyword">null</span>);</span><br><span class="line">                &#125;<span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">byte</span>[] data = zk.getData(<span class="string">"/a"</span>,w,st);</span><br><span class="line">        System.out.println(<span class="keyword">new</span> String(data));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;1-Zookeeper-çš„å®‰è£…-amp-æ¦‚è¿°&quot;&gt;&lt;a href=&quot;#1-Zookeeper-çš„å®‰è£…-amp-æ¦‚è¿°&quot; class=&quot;headerlink&quot; title=&quot;1.Zookeeper çš„å®‰è£…&amp;amp;æ¦‚è¿°&quot;&gt;&lt;/a&gt;1.Zookeeper çš„å®‰è£…&amp;amp;
      
    
    </summary>
    
      <category term="Hadoop" scheme="https://airpoet.github.io/categories/Hadoop/"/>
    
      <category term="Zookeeper" scheme="https://airpoet.github.io/categories/Hadoop/Zookeeper/"/>
    
    
      <category term="åŸåˆ›" scheme="https://airpoet.github.io/tags/%E5%8E%9F%E5%88%9B/"/>
    
      <category term="æŠ€æœ¯" scheme="https://airpoet.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="Hadoop" scheme="https://airpoet.github.io/tags/Hadoop/"/>
    
      <category term="Zookeeper" scheme="https://airpoet.github.io/tags/Zookeeper/"/>
    
  </entry>
  
  <entry>
    <title>Hadoop-HAé«˜å¯ç”¨é›†ç¾¤QJMæ­å»º</title>
    <link href="https://airpoet.github.io/2018/06/22/Hadoop/0-Hadoop/Hadoop-HA%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/"/>
    <id>https://airpoet.github.io/2018/06/22/Hadoop/0-Hadoop/Hadoop-HAé«˜å¯ç”¨é›†ç¾¤æ­å»º/</id>
    <published>2018-06-21T16:38:59.993Z</published>
    <updated>2018-06-30T15:29:15.618Z</updated>
    
    <content type="html"><![CDATA[<h3 id="1-æ­¤æ•™ç¨‹é»˜è®¤å·²ç»æ­å»ºå¥½å®Œå…¨åˆ†å¸ƒå¼"><a href="#1-æ­¤æ•™ç¨‹é»˜è®¤å·²ç»æ­å»ºå¥½å®Œå…¨åˆ†å¸ƒå¼" class="headerlink" title="1.æ­¤æ•™ç¨‹é»˜è®¤å·²ç»æ­å»ºå¥½å®Œå…¨åˆ†å¸ƒå¼"></a>1.æ­¤æ•™ç¨‹é»˜è®¤å·²ç»æ­å»ºå¥½å®Œå…¨åˆ†å¸ƒå¼</h3><h3 id="2-Zookeeper-é›†ç¾¤æ­å»º"><a href="#2-Zookeeper-é›†ç¾¤æ­å»º" class="headerlink" title="2. Zookeeper é›†ç¾¤æ­å»º"></a>2. Zookeeper é›†ç¾¤æ­å»º</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">é…ç½®å®Œå…¨åˆ†å¸ƒå¼zké›†ç¾¤</span><br><span class="line">---------------------</span><br><span class="line">    1.æŒ‘é€‰3å°ä¸»æœº</span><br><span class="line">        cs1 ~ cs3</span><br><span class="line">    2.æ¯å°æœºå™¨éƒ½å®‰è£…zk</span><br><span class="line">        tar</span><br><span class="line">        ç¯å¢ƒå˜é‡</span><br><span class="line"></span><br><span class="line">    3.é…ç½®zké…ç½®æ–‡ä»¶</span><br><span class="line">        cs1 ~ cs3</span><br><span class="line">        [/home/ap/apps/zk/conf/zoo.cfg]</span><br><span class="line">        ...</span><br><span class="line">        dataDir=/home/ap/zookeeper</span><br><span class="line"></span><br><span class="line">    4.åœ¨æ¯å°ä¸»æœºçš„/home/centos/zookeeperä¸­æ·»åŠ myid,å†…å®¹åˆ†åˆ«æ˜¯1,2,3</span><br><span class="line">        [cs1]</span><br><span class="line">        $&gt;<span class="built_in">echo</span> 1 &gt; /home/ap/zookeeper/myid</span><br><span class="line">        [cs2]</span><br><span class="line">        $&gt;<span class="built_in">echo</span> 2 &gt; /home/ap/zookeeper/myid</span><br><span class="line">        [cs3]</span><br><span class="line">        $&gt;<span class="built_in">echo</span> 3 &gt; /home/ap/zookeeper/myid</span><br><span class="line"></span><br><span class="line">    5.å¯åŠ¨æœåŠ¡å™¨é›†ç¾¤ </span><br><span class="line">        $&gt;zkServer.sh start</span><br><span class="line">            </span><br><span class="line">    6.æŸ¥çœ‹æ¯å°æœåŠ¡å™¨çš„çŠ¶æ€</span><br><span class="line">        $&gt;zkServer.sh status</span><br><span class="line">* æ³¨æ„: å¦‚æœæœ‰3å°æœºå™¨, åªå¯åŠ¨ä¸€å°çš„è¯, ä¼šæ˜¾ç¤ºå¦‚ä¸‹, å› ä¸ºæ ¹æ®é…ç½®, æœ‰3å°æœºå™¨, æ­¤æ—¶åªæœ‰ä¸€å°å¯åŠ¨, æ²¡æœ‰è¿‡åŠæ•°, æ•´ä¸ªé›†ç¾¤æ˜¯æŒ‚æ‰çš„</span><br><span class="line">* åªæœ‰å¯åŠ¨çš„æœºå™¨æ•°é‡è¶…è¿‡é…ç½®çš„åŠæ•°, zk é›†ç¾¤æ‰æœ‰æ•ˆ.</span><br></pre></td></tr></table></figure><h3 id="3-HA-é›†ç¾¤æ­å»º"><a href="#3-HA-é›†ç¾¤æ­å»º" class="headerlink" title="3.HA é›†ç¾¤æ­å»º"></a>3.HA é›†ç¾¤æ­å»º</h3><h4 id="é¦–å…ˆå£°æ˜"><a href="#é¦–å…ˆå£°æ˜" class="headerlink" title="é¦–å…ˆå£°æ˜"></a>é¦–å…ˆå£°æ˜</h4><p><strong>ç¬”è€…ç”¨çš„6å°ä¸»æœº,  ä¸»æœºå <code>cs1-cs6</code>,  ç”¨æˆ·åä¸º<code>ap</code>, å¯ä»¥å¯¹ç…§æ”¹ä¸ºè‡ªå·±çš„ä¸»æœºå&amp;ç”¨æˆ·å</strong></p><p>å¦å¤–, æ­å»º HA ä¸ä¼šå½±å“åŸæ¥çš„å®Œå…¨åˆ†å¸ƒå¼, å…·ä½“æ“ä½œä¼šåœ¨ä¸‹é¢å‘ŠçŸ¥.<br><strong>hadoop å®‰è£…ç›®å½•å±‚çº§ç»“æ„:</strong></p><ul><li><code>/home/ap/apps/hadoop/etc/hadoop/hdfs-site.xml</code></li></ul><p><strong>data ç›®å½•å±‚çº§ç»“æ„:</strong></p><ul><li><code>cs1</code>: <code>/home/ap/hadoopdata/namenode/current/edits_00....</code> </li><li><code>cs2</code>: <code>/home/ap/hadoopdata/datanode/current/BP-15...</code></li></ul><p><strong>å¯ä»¥å¯¹ç…§å‚è€ƒ</strong></p><p><br></p><p><strong>é›†ç¾¤ç»“æ„å¦‚ä¸‹</strong></p><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-21-164723.png" alt="image-20180622004722436"></p><hr><h4 id="å¼€å§‹æ­å»º"><a href="#å¼€å§‹æ­å»º" class="headerlink" title="å¼€å§‹æ­å»º"></a>å¼€å§‹æ­å»º</h4><p><strong>é¦–å…ˆä¿è¯ å„èŠ‚ç‚¹ç›´æ¥çš„ ssh å…å¯†ç™»å½•æ²¡é—®é¢˜</strong></p><ul><li>å¦‚æœéç”Ÿäº§ç¯å¢ƒ, å¯ä»¥åŒæ—¶æŠŠ <code>.ssh</code>åˆ æ‰å, å…¨éƒ¨é‡æ–°ç”Ÿæˆ <code>ssh-keygen</code>,  åŒæ—¶ç›¸äº’å‘é€, è¿™æ ·æ“ä½œæœ€ç®€å•, æ•ˆç‡æœ€é«˜. </li></ul><p><strong>å…¶æ¬¡ä¸Šä»£ç äº†</strong></p><ol><li>æŠŠåŸæœ¬<code>/home/ap/apps/hadoop/etc/hadoop</code>ä¸­çš„ <code>hadoop</code>ç›®å½•æ”¹ä¸º<code>full</code>,æ„æ€æ˜¯å®Œå…¨åˆ†å¸ƒå¼.  </li><li><code>cp -r full ha</code>, å¤åˆ¶ä¸€ä»½ full ä¸º ha, åœ¨è¿™ä»½é…ç½®æ–‡ä»¶ä¸­é…ç½® HA</li><li><code>ln -s /home/ap/apps/hadoop/etc/ha  /home/ap/apps/hadoop/etc/hadoop</code>, ç”¨ä¸€ä¸ªè½¯é“¾æ¥hadoop æŒ‡å‘ ha</li><li>é…ç½® <code>/home/ap/apps/hadoop/etc/ha/hdfs-site.xml</code></li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">[hdfs-site.xml]</span><br><span class="line">------------------------------------------------------------------</span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- æŒ‡å®š 2ä¸ª namenode çš„å‘½åç©ºé—´ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.nameservices<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>mycluster<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- myuclusterä¸‹çš„åç§°èŠ‚ç‚¹ä¸¤ä¸ªid --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.ha.namenodes.mycluster<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>nn1,nn2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- é…ç½®æ¯ä¸ªnnçš„rpcåœ°å€ã€‚ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.rpc-address.mycluster.nn1<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>cs1:8020<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.rpc-address.mycluster.nn2<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>cs6:8020<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- é…ç½®webuiç«¯å£ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.http-address.mycluster.nn1<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>cs1:50070<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.http-address.mycluster.nn2<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>cs6:50070<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- åç§°èŠ‚ç‚¹å…±äº«ç¼–è¾‘ç›®å½•. --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.shared.edits.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>qjournal://cs2:8485;cs3:8485;cs4:8485/mycluster<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- javaç±»ï¼Œclientä½¿ç”¨å®ƒåˆ¤æ–­å“ªä¸ªèŠ‚ç‚¹æ˜¯æ¿€æ´»æ€ã€‚ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.client.failover.proxy.provider.mycluster<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- è„šæœ¬åˆ—è¡¨æˆ–è€…javaç±»ï¼Œåœ¨å®¹ç¾ä¿æŠ¤æ¿€æ´»æ€çš„nn. --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.ha.fencing.methods<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span></span><br><span class="line">                sshfence</span><br><span class="line">                shell(/bin/true)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- sshå…å¯†ç™»é™† --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.ha.fencing.ssh.private-key-files<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>/home/ap/.ssh/id_rsa<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- é…ç½® sshfence éš”ç¦»æœºåˆ¶è¶…æ—¶æ—¶é—´(å¯ä¸é…) --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.ha.fencing.ssh.connect-timeout<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>30000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- é…ç½®JNå­˜æ”¾editçš„æœ¬åœ°è·¯å¾„ã€‚ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.journalnode.edits.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>/home/ap/hadoopdata/journal<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="5"><li>é…ç½® <code>core-site.xml</code>, è¿™é‡Œç»™å‡ºå®Œæ•´é…ç½® (ç›®å‰ä¸åŒ…æ‹¬ Hive é…ç½®)</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[core-site.xml]</span><br><span class="line">------------------------------------------------------------</span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- æŒ‡å®š hdfs çš„ nameservice ä¸º mycluster --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.defaultFS<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://mycluster<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- æŒ‡å®š hadoop å·¥ä½œç›®å½• --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.tmp.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>/home/ap/hadoopdata<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- æŒ‡å®šzké›†ç¾¤è®¿é—®åœ°å€ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>ha.zookeeper.quorum<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>cs1:2181,cs2:2181,cs3:2181<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="6"><li>é…ç½®<code>mapred-site.xml</code></li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[mapred-site.xml]</span><br><span class="line">-------------------</span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- æŒ‡å®š mr æ¡†æ¶ä¸º yarn æ–¹å¼ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.framework.name<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>yarn<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- è®¾ç½® mapreduce çš„å†å²æœåŠ¡å™¨åœ°å€å’Œç«¯å£å· --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.jobhistory.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>cs1:10020<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- mapreduce å†å²æœåŠ¡å™¨çš„ web è®¿é—®åœ°å€ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.jobhistory.webapp.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>cs1:19888<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="6"><li>æŠŠ<code>/home/ap/apps/hadoop/etc/*</code>å‘ç»™å…¶ä»–æ‰€æœ‰èŠ‚ç‚¹ 2-6<ul><li>æ³¨æ„: è½¯é“¾æ¥scp çš„æ—¶å€™ä¼šæœ‰é—®é¢˜, æœ€ç»ˆä¿è¯æ¯ä¸ªèŠ‚ç‚¹è·Ÿ cs1ä¸€æ ·å°±å¯ä»¥äº†,å¯ä»¥æ¯ä¸ªèŠ‚ç‚¹å•ç‹¬ä¿®æ”¹, ä¹Ÿå¯ä»¥å†™è„šæœ¬ä¸€èµ·ä¿®æ”¹</li><li><code>ln -sfT /home/ap/apps/hadoop/etc/ha  /home/ap/apps/hadoop/etc/hadoop</code></li></ul></li><li><strong>éƒ¨ç½²ç»†èŠ‚</strong></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">0.åœ¨ zk èŠ‚ç‚¹å¯åŠ¨ zkServer</span><br><span class="line">cs1-cs3: $&gt;zkServer.sh start</span><br><span class="line"></span><br><span class="line">1.åœ¨jnèŠ‚ç‚¹åˆ†åˆ«å¯åŠ¨jnè¿›ç¨‹</span><br><span class="line">$&gt;hadoop-daemon.sh start journalnode</span><br><span class="line"></span><br><span class="line">2.å¯åŠ¨jnä¹‹åï¼Œåœ¨ä¸¤ä¸ªNNä¹‹é—´è¿›è¡Œdiskå…ƒæ•°æ®åŒæ­¥</span><br><span class="line">    a)å¦‚æœæ˜¯å…¨æ–°é›†ç¾¤ï¼Œå…ˆformatæ–‡ä»¶ç³»ç»Ÿ,åªéœ€è¦åœ¨ä¸€ä¸ªnnä¸Šæ‰§è¡Œã€‚</span><br><span class="line">    [cs1]</span><br><span class="line">    $&gt;hadoop namenode -format</span><br><span class="line"></span><br><span class="line">    b)å¦‚æœå°†éHAé›†ç¾¤è½¬æ¢æˆHAé›†ç¾¤ï¼Œå¤åˆ¶åŸNNçš„metadataåˆ°å¦ä¸€ä¸ªnn.</span><br><span class="line">        1.æ­¥éª¤ä¸€</span><br><span class="line">        [cs1]</span><br><span class="line">        $&gt;scp -r /home/centos/hadoop/dfs ap@cs6:/home/centos/hadoop/</span><br><span class="line"></span><br><span class="line">        2.æ­¥éª¤äºŒ</span><br><span class="line">        åœ¨æ–°çš„nn(æœªæ ¼å¼åŒ–çš„nn)ä¸Šè¿è¡Œä¸€ä¸‹å‘½ä»¤ï¼Œå®ç°å¾…å‘½çŠ¶æ€å¼•å¯¼ã€‚</span><br><span class="line">        [cs6]</span><br><span class="line">        $&gt;hdfs namenode -bootstrapStandby        //éœ€è¦cs1ä¸ºå¯åŠ¨çŠ¶æ€,æç¤ºæ˜¯å¦æ ¼å¼åŒ–,é€‰æ‹©N.</span><br><span class="line"></span><br><span class="line">3.åœ¨ä¸€ä¸ªNNä¸Šæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå®Œæˆeditæ—¥å¿—åˆ°jnèŠ‚ç‚¹çš„ä¼ è¾“ã€‚</span><br><span class="line">$&gt;hdfs namenode -initializeSharedEdits</span><br><span class="line"><span class="comment">#æŸ¥çœ‹cs2,cs3,cs4 è¿™å‡ ä¸ª jn èŠ‚ç‚¹æ˜¯å¦æœ‰editæ•°æ®.</span></span><br><span class="line"></span><br><span class="line">4.å¯åŠ¨æ‰€æœ‰èŠ‚ç‚¹.</span><br><span class="line">[cs1]</span><br><span class="line">$&gt;hadoop-daemon.sh start namenode        //å¯åŠ¨åç§°èŠ‚ç‚¹</span><br><span class="line">$&gt;hadoop-daemons.sh start datanode        //å¯åŠ¨æ‰€æœ‰æ•°æ®èŠ‚ç‚¹</span><br><span class="line"></span><br><span class="line">[2,3,4]</span><br><span class="line">$&gt;hadoop-daemon.sh start journalnode</span><br><span class="line"></span><br><span class="line">[cs6]</span><br><span class="line">$&gt;hadoop-daemon.sh start namenode        //å¯åŠ¨åç§°èŠ‚ç‚¹</span><br></pre></td></tr></table></figure><ol start="8"><li><strong>HA ç®¡ç†</strong></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹web ç•Œé¢, æ˜¯å¦æ˜¯2ä¸ª standby çŠ¶æ€</span></span><br><span class="line">http://cs1:50070/</span><br><span class="line">http://cs6:50070/</span><br><span class="line"></span><br><span class="line">hdfs haadmin : æŸ¥çœ‹ ha å¸®åŠ©</span><br><span class="line">-----------------</span><br><span class="line">$&gt;hdfs haadmin -transitionToActive nn1                //åˆ‡æˆæ¿€æ´»æ€</span><br><span class="line">$&gt;hdfs haadmin -transitionToStandby nn1                //åˆ‡æˆå¾…å‘½æ€</span><br><span class="line">$&gt;hdfs haadmin -transitionToActive --forceactive nn2//å¼ºè¡Œæ¿€æ´»</span><br><span class="line">$&gt;hdfs haadmin -failover nn1 nn2                    //æ¨¡æ‹Ÿå®¹ç¾æ¼”ç¤º,ä»nn1åˆ‡æ¢åˆ°nn2</span><br></pre></td></tr></table></figure><ol start="9"><li><strong>åŠ å…¥ Zookeeper å®¹ç¾æœåŠ¡ zkfc</strong></li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 1.éƒ¨ç½²å®¹ç¾ --&gt;</span></span><br><span class="line">------------------------------</span><br><span class="line">a.åœæ­¢æ‰€æœ‰è¿›ç¨‹</span><br><span class="line">$&gt;stop-all.sh</span><br><span class="line"></span><br><span class="line">b.é…ç½®hdfs-site.xmlï¼Œå¯ç”¨è‡ªåŠ¨å®¹ç¾.</span><br><span class="line">[hdfs-site.xml]</span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.ha.automatic-failover.enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">c.é…ç½®core-site.xmlï¼ŒæŒ‡å®šzkçš„è¿æ¥åœ°å€.</span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>ha.zookeeper.quorum<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>cs1:2181,cs2:2181,cs3:2181<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">d.åˆ†å‘ä»¥ä¸Šä¸¤ä¸ªæ–‡ä»¶åˆ°æ‰€æœ‰èŠ‚ç‚¹ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 2.ç™»å½•å…¶ä¸­çš„ä¸€å°NN(s201),åœ¨ZKä¸­åˆå§‹åŒ–HAçŠ¶æ€,</span></span><br><span class="line"><span class="comment"> åˆ›å»º namenode çš„ å‘½åç©ºé—´èŠ‚ç‚¹ mycluster --&gt;</span></span><br><span class="line">------------------------------------</span><br><span class="line">$&gt;hdfs zkfc -formatZK</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 3.å¯åŠ¨hdfsè¿›ç¨‹. --&gt;</span>    </span><br><span class="line">$&gt;start-dfs.sh</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 4.æŸ¥çœ‹ webUI, æ˜¯å¦æœ‰ä¸€å°è‡ªåŠ¨åˆ‡æ¢ä¸º active çŠ¶æ€äº† --&gt;</span></span><br><span class="line">http://cs1:50070/</span><br><span class="line">http://cs6:50070/</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 5.æµ‹è¯•è‡ªåŠ¨å®¹ç¾(å¦‚æœcs6æ˜¯æ´»è·ƒèŠ‚ç‚¹) --&gt;</span>    </span><br><span class="line">$&gt;kill -9  cs6çš„ namenodeè¿›ç¨‹å·</span><br><span class="line">è§‚å¯Ÿ cs1:50070çš„çŠ¶æ€å˜åŒ–</span><br></pre></td></tr></table></figure><ol start="10"><li><strong>é…ç½®RMçš„HAè‡ªåŠ¨å®¹ç¾</strong></li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line">1.é…ç½®yarn-site.xml</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- æ˜¯å¦å…è®¸é«˜å¯ç”¨ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.ha.enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Identifies the cluster. Used by the elector to ensure an RM doesnâ€™t take over as Active for another cluster.  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.cluster-id<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>cluster1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- RM çš„ id --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.ha.rm-ids<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>rm1,rm2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 2å° RM çš„å®¿ä¸» --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.hostname.rm1<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>cs1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.hostname.rm2<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>cs6<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- é…ç½®webç•Œé¢ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.webapp.address.rm1<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>cs1:8088<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.webapp.address.rm2<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>cs6:8088<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- zookeeper åœ°å€ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.zk-address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>cs1:2181,cs2:2181,cs3:2181<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- YARN é›†ç¾¤ä¸º MapReduce ç¨‹åºæä¾›çš„ shuffle æœåŠ¡(åŸæœ¬çš„)  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.aux-services<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>mapreduce_shuffle<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- ===========ä»¥ä¸‹æ˜¯å¯é€‰çš„============= --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- å¼€å¯ YARN é›†ç¾¤çš„æ—¥å¿—èšåˆåŠŸèƒ½ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.log-aggregation-enable<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- YARN é›†ç¾¤çš„èšåˆæ—¥å¿—æœ€é•¿ä¿ç•™æ—¶é•¿ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.log-aggregation.retain-seconds<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>86400<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- å¯ç”¨è‡ªåŠ¨æ¢å¤ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.recovery.enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- æŒ‡å®š resourcemanager çš„çŠ¶æ€ä¿¡æ¯å­˜å‚¨åœ¨ zookeeper é›†ç¾¤ä¸Š--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.store.class<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>org.apache.hadoop.yarn.server.resourcemanager.recovery.ZKRMStateStore<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2.ä½¿ç”¨ç®¡ç†å‘½ä»¤</span><br><span class="line"><span class="comment">&lt;!-- æŸ¥çœ‹çŠ¶æ€ --&gt;</span></span><br><span class="line">$&gt;yarn rmadmin -getServiceState rm1</span><br><span class="line"><span class="comment">&lt;!-- åˆ‡æ¢çŠ¶æ€åˆ°standby --&gt;</span></span><br><span class="line">$&gt;yarn rmadmin -transitionToStandby rm1</span><br><span class="line"></span><br><span class="line">3.å¯åŠ¨yarné›†ç¾¤</span><br><span class="line">$&gt;start-yarn.sh</span><br><span class="line"></span><br><span class="line">4.hadoopæ²¡æœ‰å¯åŠ¨ä¸¤ä¸ªresourcemanager,éœ€è¦æ‰‹åŠ¨å¯åŠ¨å¦å¤–ä¸€ä¸ª</span><br><span class="line">$&gt;yarn-daemon.sh start resourcemanager</span><br><span class="line"></span><br><span class="line">5.æŸ¥çœ‹webUI, ç‚¹å‡» About, æŸ¥çœ‹ active æˆ– standby</span><br><span class="line">http://cs1:8088</span><br><span class="line">http://cs6:8088</span><br><span class="line"></span><br><span class="line">6.åšå®¹ç¾æ¨¡æ‹Ÿ.</span><br><span class="line">kill -9 æ´»è·ƒçš„ RM ç«¯å£å·</span><br><span class="line"></span><br><span class="line">7.æ³¨æ„: å¦‚æœå®¹ç¾å¤±è´¥, æ£€æŸ¥ä¸‹æ¯å°ä¸»æœºæ—¶é—´æ˜¯å¦åŒæ­¥</span><br><span class="line">$&gt;sudo ntpdate ntp1.aliyun.com</span><br></pre></td></tr></table></figure><p><strong>è‡³æ­¤, å¤§åŠŸå‘Šæˆ</strong></p><hr><h3 id="4-HA-é›†ç¾¤çš„å¯åŠ¨-å…³é—­"><a href="#4-HA-é›†ç¾¤çš„å¯åŠ¨-å…³é—­" class="headerlink" title="4.HA é›†ç¾¤çš„å¯åŠ¨/å…³é—­"></a>4.HA é›†ç¾¤çš„å¯åŠ¨/å…³é—­</h3><h4 id="4-1-HA-çš„å¯åŠ¨"><a href="#4-1-HA-çš„å¯åŠ¨" class="headerlink" title="4.1 HA çš„å¯åŠ¨"></a>4.1 HA çš„å¯åŠ¨</h4><p><strong>ä¸€:å•ç‚¹å¯åŠ¨</strong></p><ol start="0"><li><p>å¯åŠ¨ zk æœåŠ¡ QuorumPeerMain, å¦åˆ™åé¢ RM ä¼šèµ·ä¸æ¥,è¿ä¸ä¸Š ZK æœåŠ¡<br>cs1-cs3: $&gt; <code>zkServer.sh start</code></p></li><li><p>å¯åŠ¨ namenode/datanode<br> cs1,cs6: $&gt; <code>hadoop-daemon.sh start namenode</code><br> cs1/cs6: $&gt; <code>hadoop-daemons.sh start datanode</code><br> cs6:     $&gt; <code>hadoop-daemon.sh start namenode</code></p></li></ol><ol start="2"><li>å¯åŠ¨ journalnode<br> cs2-cs4: $&gt; <code>hadoop-daemon.sh start journalnode</code></li></ol><ol start="3"><li>å¯åŠ¨RM (RM ä¼šè‡ªåŠ¨é€‰å‡ºä¸€ä¸ª active)<br> cs1,cs6: $&gt; <code>yarn-daemon.sh start resourcemanager</code><br> cs1/cs6: $&gt; <code>yarn-daemons.sh start nodemanager</code></li></ol><ol start="4"><li><p>å¯åŠ¨ zk çš„ DFSZKFailoverController<br> cs1,cs6: $&gt; <code>hadoop-daemon.sh start zkfc</code></p></li><li><p>æ­¤å¤–å¯ä»¥å¯åŠ¨MapReduce çš„å†å²ä»»åŠ¡æœåŠ¡å™¨</p><p>[ap@cs1]$&gt; <code>mr-jobhistory-daemon.sh start historyserver</code></p><p>ç„¶åè®¿é—®é…ç½®çš„ <code>http://cs1:19888/jobhistory</code></p></li></ol><p><strong>äºŒ:æ‡’æ±‰å¯åŠ¨</strong></p><ol start="0"><li><p>å¯åŠ¨ zk æœåŠ¡ QuorumPeerMain, å¦åˆ™åé¢ RM ä¼šèµ·ä¸æ¥,è¿ä¸ä¸Š ZK æœåŠ¡<br>cs1-cs3: $&gt; <code>zkServer.sh start</code></p></li><li><p>æ‰§è¡Œå¯åŠ¨å…¨éƒ¨</p><p>cs1: $&gt;  <code>start-all.sh</code>(RM èŠ‚ç‚¹)</p><p>æˆ–è€…, ä½¿ç”¨æ–°çš„å¯åŠ¨æ–¹å¼</p><p>cs1: $&gt; <code>start-dfs.sh</code>(ä»»æ„èŠ‚ç‚¹)</p><p>cs1: $&gt; <code>start-yarn.sh</code>(åœ¨ RM èŠ‚ç‚¹)</p></li><li><p>å¦ä¸€ä¸ª RM èŠ‚ç‚¹ä¸ä¼šè‡ªå·±å¯åŠ¨,è¦æ‰‹åŠ¨å¯åŠ¨</p><p>cs6: $&gt;  <code>yarn-daemon.sh start resourcemanager</code></p></li></ol><p>ä¸‰: å¯åŠ¨å®Œæˆå</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">============= cs1 jps =============</span><br><span class="line">5696 QuorumPeerMain</span><br><span class="line">6641 DFSZKFailoverController</span><br><span class="line">6338 NameNode</span><br><span class="line">6756 ResourceManager</span><br><span class="line">6873 Jps</span><br><span class="line">============= cs2 jps =============</span><br><span class="line">10849 Jps</span><br><span class="line">10722 NodeManager</span><br><span class="line">10631 JournalNode</span><br><span class="line">10541 DataNode</span><br><span class="line">127934 QuorumPeerMain</span><br><span class="line">============= cs3 jps =============</span><br><span class="line">630 NodeManager</span><br><span class="line">758 Jps</span><br><span class="line">535 JournalNode</span><br><span class="line">443 DataNode</span><br><span class="line">117503 QuorumPeerMain</span><br><span class="line">============= cs4 jps =============</span><br><span class="line">79589 Jps</span><br><span class="line">79462 NodeManager</span><br><span class="line">79368 JournalNode</span><br><span class="line">79278 DataNode</span><br><span class="line">============= cs5 jps =============</span><br><span class="line">23655 Jps</span><br><span class="line">23529 NodeManager</span><br><span class="line">23423 DataNode</span><br><span class="line">============= cs6 jps =============</span><br><span class="line">35680 Jps</span><br><span class="line">35506 NameNode</span><br><span class="line">35608 DFSZKFailoverController</span><br><span class="line">21455 ResourceManager</span><br></pre></td></tr></table></figure><h4 id="4-2-HA-çš„å…³é—­"><a href="#4-2-HA-çš„å…³é—­" class="headerlink" title="4.2 HA çš„å…³é—­"></a>4.2 HA çš„å…³é—­</h4><p>åœ¨ ä¸€å°NN ä¸Š<code>stop-all.sh</code>, æ³¨æ„ zk çš„ server- <code>QuorumPeerMain</code>ä¸ä¼šåœæ‰</p><h3 id="5-åœ¨é›†ç¾¤å®ç°æ—¶é—´åŒæ­¥-root-ç”¨æˆ·æ“ä½œ"><a href="#5-åœ¨é›†ç¾¤å®ç°æ—¶é—´åŒæ­¥-root-ç”¨æˆ·æ“ä½œ" class="headerlink" title="5. åœ¨é›†ç¾¤å®ç°æ—¶é—´åŒæ­¥(root ç”¨æˆ·æ“ä½œ)"></a>5. åœ¨é›†ç¾¤å®ç°æ—¶é—´åŒæ­¥(root ç”¨æˆ·æ“ä½œ)</h3><h4 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯:"></a>æ€è·¯:</h4><p><strong>æ—¶é—´åŒæ­¥çš„æ–¹å¼ï¼šæ‰¾ä¸€ä¸ªæœºå™¨ï¼Œä½œä¸ºæ—¶é—´æœåŠ¡å™¨ï¼Œæ‰€æœ‰çš„æœºå™¨ä¸è¿™å°é›†ç¾¤æ—¶é—´è¿›è¡Œå®šæ—¶çš„åŒæ­¥ï¼Œæ¯”å¦‚ï¼Œæ¯éš”ååˆ†é’Ÿï¼ŒåŒæ­¥ä¸€æ¬¡æ—¶é—´ã€‚</strong> </p><h4 id="5-1-åœ¨cs1ä¸Šä¿®æ”¹ntpæœåŠ¡"><a href="#5-1-åœ¨cs1ä¸Šä¿®æ”¹ntpæœåŠ¡" class="headerlink" title="5.1 åœ¨cs1ä¸Šä¿®æ”¹ntpæœåŠ¡"></a>5.1 åœ¨<code>cs1</code>ä¸Šä¿®æ”¹<code>ntp</code>æœåŠ¡</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">1) æ£€æŸ¥ ntp æ˜¯å¦å®‰è£…</span><br><span class="line"><span class="comment">#root&gt; rpm -qa|grep ntp</span></span><br><span class="line">---</span><br><span class="line">ntp-4.2.6p5-10.el6.centos.x86_64</span><br><span class="line">fontpackages-filesystem-1.41-1.1.el6.noarch</span><br><span class="line">ntpdate-4.2.6p5-10.el6.centos.x86_64</span><br><span class="line"><span class="comment"># å‡ºç°ä¸Šé¢çš„3ä¸ªæ–‡ä»¶, å°±æ˜¯å®‰è£…äº†; å¦‚æœæ²¡æœ‰çš„è¯, ç”¨ yum è£…ä¸€ä¸‹</span></span><br><span class="line"><span class="comment"># root&gt; yum inatall -y ntp</span></span><br><span class="line"></span><br><span class="line">2) ä¿®æ”¹ ntp é…ç½®æ–‡ä»¶</span><br><span class="line"><span class="comment">#root&gt; vi /etc/ntp.conf</span></span><br><span class="line"></span><br><span class="line">ä¿®æ”¹å†…å®¹å¦‚ä¸‹</span><br><span class="line">    aï¼‰ä¿®æ”¹1ï¼ˆè®¾ç½®æœ¬åœ°ç½‘ç»œä¸Šçš„ä¸»æœºä¸å—é™åˆ¶ã€‚ï¼‰</span><br><span class="line">    <span class="comment">#restrict 192.168.1.0 mask 255.255.255.0 nomodify notrap</span></span><br><span class="line">    ä¸º</span><br><span class="line">    restrict 192.168.1.0 mask 255.255.255.0 nomodify notrap</span><br><span class="line">    bï¼‰ä¿®æ”¹2ï¼ˆè®¾ç½®ä¸ºä¸é‡‡ç”¨å…¬å…±çš„æœåŠ¡å™¨ï¼‰</span><br><span class="line">    server 0.centos.pool.ntp.org iburst</span><br><span class="line">    server 1.centos.pool.ntp.org iburst</span><br><span class="line">    server 2.centos.pool.ntp.org iburst</span><br><span class="line">    server 3.centos.pool.ntp.org iburst</span><br><span class="line">    ä¸º</span><br><span class="line">    <span class="comment">#server 0.centos.pool.ntp.org iburst</span></span><br><span class="line">    <span class="comment">#server 1.centos.pool.ntp.org iburst</span></span><br><span class="line">    <span class="comment">#server 2.centos.pool.ntp.org iburst</span></span><br><span class="line">    <span class="comment">#server 3.centos.pool.ntp.org iburst</span></span><br><span class="line">    cï¼‰æ·»åŠ 3ï¼ˆæ·»åŠ é»˜è®¤çš„ä¸€ä¸ªå†…éƒ¨æ—¶é’Ÿæ•°æ®ï¼Œä½¿ç”¨å®ƒä¸ºå±€åŸŸç½‘ç”¨æˆ·æä¾›æœåŠ¡ã€‚ï¼‰</span><br><span class="line">    server 127.127.1.0</span><br><span class="line">    fudge 127.127.1.0 stratum 10</span><br><span class="line"></span><br><span class="line">3ï¼‰ä¿®æ”¹/etc/sysconfig/ntpd æ–‡ä»¶</span><br><span class="line"><span class="comment">#root&gt; vim /etc/sysconfig/ntpd</span></span><br><span class="line">å¢åŠ å†…å®¹å¦‚ä¸‹ï¼ˆè®©ç¡¬ä»¶æ—¶é—´ä¸ç³»ç»Ÿæ—¶é—´ä¸€èµ·åŒæ­¥ï¼‰</span><br><span class="line">SYNC_HWCLOCK=yes</span><br><span class="line"></span><br><span class="line">4ï¼‰é‡æ–°å¯åŠ¨ntpd</span><br><span class="line"><span class="comment">#root&gt; service ntpd status</span></span><br><span class="line">ntpd å·²åœ</span><br><span class="line"></span><br><span class="line"><span class="comment">#root&gt; service ntpd start</span></span><br><span class="line">æ­£åœ¨å¯åŠ¨ ntpdï¼š    </span><br><span class="line"></span><br><span class="line">5) æ‰§è¡Œå¼€æœºå¯åŠ¨ ntpd æœåŠ¡</span><br><span class="line"><span class="comment">#root&gt; chkconfig ntpd on</span></span><br><span class="line">æŸ¥çœ‹ ntpd æœåŠ¡å¼€æœºå¯åŠ¨çš„çŠ¶æ€</span><br><span class="line"><span class="comment">#root&gt; chkconfig --list ntpd</span></span><br></pre></td></tr></table></figure><h4 id="5-2-å…¶å®ƒæœºå™¨ä¸Š"><a href="#5-2-å…¶å®ƒæœºå™¨ä¸Š" class="headerlink" title="5.2 å…¶å®ƒæœºå™¨ä¸Š"></a>5.2 å…¶å®ƒæœºå™¨ä¸Š</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1ï¼‰åœ¨å…¶ä»–æ‰€æœ‰æœºå™¨é…ç½®10åˆ†é’Ÿä¸æ—¶é—´æœåŠ¡å™¨åŒæ­¥ä¸€æ¬¡</span><br><span class="line"><span class="comment">#ç¼–å†™å®šæ—¶ä»»åŠ¡è„šæœ¬</span></span><br><span class="line"><span class="comment">#root&gt; crontab -e </span></span><br><span class="line">*/10 * * * * /usr/sbin/ntpdate hadoop102</span><br><span class="line"></span><br><span class="line">2) ä¿®æ”¹ä»»æ„æœºå™¨æ—¶é—´</span><br><span class="line"><span class="comment">#root&gt; date -s "2017-9-11 11:11:11"</span></span><br><span class="line"></span><br><span class="line">3) ååˆ†é’ŸåæŸ¥çœ‹æœºå™¨æ—¶é—´æ˜¯å¦ä¸cs1 åŒæ­¥</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;1-æ­¤æ•™ç¨‹é»˜è®¤å·²ç»æ­å»ºå¥½å®Œå…¨åˆ†å¸ƒå¼&quot;&gt;&lt;a href=&quot;#1-æ­¤æ•™ç¨‹é»˜è®¤å·²ç»æ­å»ºå¥½å®Œå…¨åˆ†å¸ƒå¼&quot; class=&quot;headerlink&quot; title=&quot;1.æ­¤æ•™ç¨‹é»˜è®¤å·²ç»æ­å»ºå¥½å®Œå…¨åˆ†å¸ƒå¼&quot;&gt;&lt;/a&gt;1.æ­¤æ•™ç¨‹é»˜è®¤å·²ç»æ­å»ºå¥½å®Œå…¨åˆ†å¸ƒå¼&lt;/h3&gt;&lt;h3 id=&quot;2-Zoo
      
    
    </summary>
    
      <category term="Hadoop" scheme="https://airpoet.github.io/categories/Hadoop/"/>
    
      <category term="hadoop" scheme="https://airpoet.github.io/categories/Hadoop/hadoop/"/>
    
    
      <category term="åŸåˆ›" scheme="https://airpoet.github.io/tags/%E5%8E%9F%E5%88%9B/"/>
    
      <category term="æŠ€æœ¯" scheme="https://airpoet.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="Hadoop" scheme="https://airpoet.github.io/tags/Hadoop/"/>
    
  </entry>
  
  <entry>
    <title>i-Hive-Practice-1 å½±è¯„ç»ƒä¹ </title>
    <link href="https://airpoet.github.io/2018/06/19/Hadoop/3-Hive/i-Hive-Practice-1-%E5%BD%B1%E8%AF%84%E7%BB%83%E4%B9%A0/"/>
    <id>https://airpoet.github.io/2018/06/19/Hadoop/3-Hive/i-Hive-Practice-1-å½±è¯„ç»ƒä¹ /</id>
    <published>2018-06-19T11:56:19.763Z</published>
    <updated>2018-06-19T15:33:56.958Z</updated>
    
    <content type="html"><![CDATA[<p><strong>ç°æœ‰å¦‚æ­¤ä¸‰ä»½æ•°æ®ï¼š</strong><br><strong>1ã€users.dat    æ•°æ®æ ¼å¼ä¸ºï¼š  2::M::56::16::70072</strong><br><strong>å¯¹åº”å­—æ®µä¸ºï¼šUserID BigInt, Gender String, Age Int, Occupation String, Zipcode String</strong><br><strong>å¯¹åº”å­—æ®µä¸­æ–‡è§£é‡Šï¼šç”¨æˆ·idï¼Œæ€§åˆ«ï¼Œå¹´é¾„ï¼ŒèŒä¸šï¼Œé‚®æ”¿ç¼–ç </strong></p><p><strong>2ã€movies.dat        æ•°æ®æ ¼å¼ä¸ºï¼š 2::Jumanji (1995)::Adventure|Childrenâ€™s|Fantasy</strong><br><strong>å¯¹åº”å­—æ®µä¸ºï¼šMovieID BigInt, Title String, Genres String</strong><br><strong>å¯¹åº”å­—æ®µä¸­æ–‡è§£é‡Šï¼šç”µå½±IDï¼Œç”µå½±åå­—ï¼Œç”µå½±ç±»å‹</strong></p><p><strong>3ã€ratings.dat        æ•°æ®æ ¼å¼ä¸ºï¼š  1::1193::5::978300760</strong><br><strong>å¯¹åº”å­—æ®µä¸ºï¼šUserID BigInt, MovieID BigInt, Rating Double, Timestamped String</strong><br><strong>å¯¹åº”å­—æ®µä¸­æ–‡è§£é‡Šï¼šç”¨æˆ·IDï¼Œç”µå½±IDï¼Œè¯„åˆ†ï¼Œè¯„åˆ†æ—¶é—´æˆ³</strong></p><p>é¢˜ç›®è¦æ±‚ï¼š</p><p>æ•°æ®è¦æ±‚ï¼š<br>ï¼ˆ1ï¼‰å†™shellè„šæœ¬æ¸…æ´—æ•°æ®ã€‚ï¼ˆhiveä¸æ”¯æŒè§£æå¤šå­—èŠ‚çš„åˆ†éš”ç¬¦ï¼Œä¹Ÿå°±æ˜¯è¯´hiveåªèƒ½è§£æâ€™:â€™, ä¸æ”¯æŒè§£æâ€™::â€™ï¼Œæ‰€ä»¥ç”¨æ™®é€šæ–¹å¼å»ºè¡¨æ¥ä½¿ç”¨æ˜¯è¡Œä¸é€šçš„ï¼Œè¦æ±‚å¯¹æ•°æ®åšä¸€æ¬¡ç®€å•æ¸…æ´—ï¼‰<br>ï¼ˆ2ï¼‰ä½¿ç”¨Hiveèƒ½è§£æçš„æ–¹å¼è¿›è¡Œ</p><p>Hiveè¦æ±‚ï¼š<br><strong>ï¼ˆ1ï¼‰æ­£ç¡®å»ºè¡¨ï¼Œå¯¼å…¥æ•°æ®ï¼ˆä¸‰å¼ è¡¨ï¼Œä¸‰ä»½æ•°æ®ï¼‰ï¼Œå¹¶éªŒè¯æ˜¯å¦æ­£ç¡®</strong></p><p><strong>ï¼ˆ2ï¼‰æ±‚è¢«è¯„åˆ†æ¬¡æ•°æœ€å¤šçš„10éƒ¨ç”µå½±ï¼Œå¹¶ç»™å‡ºè¯„åˆ†æ¬¡æ•°ï¼ˆç”µå½±åï¼Œè¯„åˆ†æ¬¡æ•°ï¼‰</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">æ€è·¯:</span><br><span class="line">1. åˆ†ç»„</span><br><span class="line"><span class="keyword">select</span> movieid, <span class="keyword">count</span>(movieid) rateCount <span class="keyword">from</span> ratings </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> movieid <span class="keyword">limit</span> <span class="number">10</span>;</span><br><span class="line">2. æ’åº</span><br><span class="line"><span class="keyword">select</span> movieid, <span class="keyword">count</span>(movieid) rateCount <span class="keyword">from</span> ratings </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> movieid <span class="keyword">order</span> <span class="keyword">by</span> rateCount <span class="keyword">desc</span> <span class="keyword">limit</span> <span class="number">10</span>;</span><br><span class="line">3.join</span><br><span class="line"><span class="keyword">select</span> a.movieid mvid, b.Title mvtitle, a.rateCount mvratecount <span class="keyword">from</span> </span><br><span class="line">(<span class="keyword">select</span> movieid, <span class="keyword">count</span>(movieid) rateCount <span class="keyword">from</span> ratings </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> movieid <span class="keyword">order</span> <span class="keyword">by</span> rateCount <span class="keyword">desc</span> <span class="keyword">limit</span> <span class="number">10</span>) a</span><br><span class="line"><span class="keyword">join</span> movies b <span class="keyword">where</span> a.movieid=b.movieid;</span><br><span class="line">==============================</span><br><span class="line"></span><br><span class="line">ï£¿ å®Œæ•´çš„</span><br><span class="line"><span class="comment">------------</span></span><br><span class="line"><span class="keyword">select</span> a.movieid mvid, b.Title mvtitle, a.rateCount mvratecount <span class="keyword">from</span> </span><br><span class="line">(<span class="keyword">select</span> movieid, <span class="keyword">count</span>(movieid) rateCount <span class="keyword">from</span> ratings </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> movieid <span class="keyword">order</span> <span class="keyword">by</span> rateCount <span class="keyword">desc</span> <span class="keyword">limit</span> <span class="number">10</span>) a</span><br><span class="line"><span class="keyword">join</span> movies b <span class="keyword">where</span> a.movieid=b.movieid;</span><br><span class="line"></span><br><span class="line"><span class="comment">--ç»“æœ---</span></span><br><span class="line">+<span class="comment">-------+----------------------------------------------------+--------------+</span></span><br><span class="line">| mvid  |                      mvtitle                       | mvratecount  |</span><br><span class="line">+<span class="comment">-------+----------------------------------------------------+--------------+</span></span><br><span class="line">| 2858  | American Beauty (1999)                             | 3428         |</span><br><span class="line">| 260   | Star Wars: Episode IV - A New Hope (1977)          | 2991         |</span><br><span class="line">| 1196  | Star Wars: Episode V - The Empire Strikes Back (1980) | 2990         |</span><br><span class="line">| 1210  | Star Wars: Episode VI - Return of the Jedi (1983)  | 2883         |</span><br><span class="line">| 480   | Jurassic Park (1993)                               | 2672         |</span><br><span class="line">| 2028  | Saving Private Ryan (1998)                         | 2653         |</span><br><span class="line">| 589   | Terminator 2: Judgment Day (1991)                  | 2649         |</span><br><span class="line">| 2571  | Matrix, The (1999)                                 | 2590         |</span><br><span class="line">| 1270  | Back to the Future (1985)                          | 2583         |</span><br><span class="line">| 593   | Silence of the Lambs, The (1991)                   | 2578         |</span><br><span class="line">+<span class="comment">-------+----------------------------------------------------+--------------+</span></span><br></pre></td></tr></table></figure><p><strong>ï¼ˆ3ï¼‰åˆ†åˆ«æ±‚ç”·æ€§ï¼Œå¥³æ€§å½“ä¸­è¯„åˆ†æœ€é«˜çš„10éƒ¨ç”µå½±ï¼ˆæ€§åˆ«ï¼Œç”µå½±åï¼Œå½±è¯„åˆ†ï¼‰</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"># æ³¨æ„,è¿™é‡Œçš„ avg(r.rating) æ˜¯å› ä¸ºgroup byäº† gender,title, ä¹Ÿå°±æ˜¯</span><br><span class="line"># è¯´æœ‰ gender,title åˆ†ç»„, æ­¤æ—¶å¯èƒ½å¯¹åº”æ­¤ç»„çš„æœ‰å¤šä¸ªå€¼,</span><br><span class="line"># è¿™é‡Œå°±æ˜¯ ç›¸åŒæ€§åˆ«è¯„ä»·ç›¸åŒç”µå½±çš„, è¯„åˆ†æœ‰å¤šä¸ª, æ­¤æ—¶å°±è¦ä½¿ç”¨èšåˆå‡½æ•°,å¾—å‡ºå”¯ä¸€å€¼</span><br><span class="line"># å› æ­¤å°±ä½¿ç”¨äº† avg(r.rating)</span><br><span class="line"><span class="keyword">select</span> u.gender, m.title, <span class="keyword">avg</span>(r.rating) rr</span><br><span class="line"><span class="keyword">from</span> ratings r </span><br><span class="line"><span class="keyword">join</span> <span class="keyword">users</span> u <span class="keyword">on</span> r.userid=u.userid </span><br><span class="line"><span class="keyword">join</span> movies m <span class="keyword">on</span> r.movieid=m.movieid</span><br><span class="line"><span class="keyword">where</span> u.gender = <span class="string">'M'</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> gender,title</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> rr <span class="keyword">desc</span></span><br><span class="line"><span class="keyword">limit</span> <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">+<span class="comment">-----------+--------------------------------------------+------+</span></span><br><span class="line">| u.gender  |                  m.title                   |  rr  |</span><br><span class="line">+<span class="comment">-----------+--------------------------------------------+------+</span></span><br><span class="line">| M         | Schlafes Bruder (Brother of Sleep) (1995)  | 5.0  |</span><br><span class="line">| M         | Small Wonders (1996)                       | 5.0  |</span><br><span class="line">| M         | Lured (1947)                               | 5.0  |</span><br><span class="line">| M         | Bells, The (1926)                          | 5.0  |</span><br><span class="line">| M         | Dangerous Game (1993)                      | 5.0  |</span><br><span class="line">| M         | Baby, The (1973)                           | 5.0  |</span><br><span class="line">| M         | Gate of Heavenly Peace, The (1995)         | 5.0  |</span><br><span class="line">| M         | Follow the Bitch (1998)                    | 5.0  |</span><br><span class="line">| M         | Ulysses (Ulisse) (1954)                    | 5.0  |</span><br><span class="line">| M         | Angela (1995)                              | 5.0  |</span><br><span class="line">+<span class="comment">-----------+--------------------------------------------+------+</span></span><br></pre></td></tr></table></figure><p><strong>ï¼ˆ4ï¼‰æ±‚movieid = 2116è¿™éƒ¨ç”µå½±å„å¹´é¾„æ®µï¼ˆå› ä¸ºå¹´é¾„å°±åªæœ‰7ä¸ªï¼Œå°±æŒ‰è¿™ä¸ª7ä¸ªåˆ†å°±å¥½äº†ï¼‰çš„å¹³å‡å½±è¯„ï¼ˆå¹´é¾„æ®µï¼Œå½±è¯„åˆ†ï¼‰</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># æ³¨æ„: æ²¡æœ‰æ­§ä¹‰çš„å­—æ®µ, å¯ä»¥ä¸ç”¨æŒ‡æ˜æ˜¯è°çš„å±æ€§</span><br><span class="line"><span class="keyword">select</span> age, <span class="keyword">avg</span>(r.rating) avgrating <span class="keyword">from</span> ratings r </span><br><span class="line"><span class="keyword">join</span> <span class="keyword">users</span> u <span class="keyword">on</span> r.userid=u.userid</span><br><span class="line"><span class="keyword">where</span> movieid=<span class="number">2116</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> age;</span><br></pre></td></tr></table></figure><p><strong>ï¼ˆ5ï¼‰æ±‚æœ€å–œæ¬¢çœ‹ç”µå½±ï¼ˆå½±è¯„æ¬¡æ•°æœ€å¤šï¼‰çš„é‚£ä½å¥³æ€§è¯„æœ€é«˜åˆ†çš„10éƒ¨ç”µå½±çš„å¹³å‡å½±è¯„åˆ†ï¼ˆè§‚å½±è€…ï¼Œç”µå½±åï¼Œå½±è¯„åˆ†ï¼‰</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"># 1.å…ˆæ‹¿åˆ° å½±è¯„æ¬¡æ•°æœ€å¤šçš„å¥³æ€§(id)</span><br><span class="line">0: jdbc:hive2://cs2:10000&gt; select UserID, count(UserID) count from ratings</span><br><span class="line">. . . . . . . . . . . . .&gt; group by UserID</span><br><span class="line">. . . . . . . . . . . . .&gt; order by count desc</span><br><span class="line">. . . . . . . . . . . . .&gt; limit 1;</span><br><span class="line">+<span class="comment">---------+--------+</span></span><br><span class="line">| userid  | count  |</span><br><span class="line">+<span class="comment">---------+--------+</span></span><br><span class="line">| 4169    | 2314   |</span><br><span class="line">+<span class="comment">---------+--------+</span></span><br><span class="line"></span><br><span class="line"># 2.æ‹¿åˆ°æ­¤äººè¯„åˆ†æœ€é«˜çš„10éƒ¨ç”µå½±, æ­¤äºº userid, ç”µå½± id, æ­¤äººè¯„åˆ†</span><br><span class="line">##  ä¸€å®šè¦å»é‡</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span>(MovieID) MovieID, Rating <span class="keyword">from</span> ratings <span class="keyword">where</span> UserID=<span class="number">4169</span> </span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> Rating <span class="keyword">desc</span></span><br><span class="line"><span class="keyword">limit</span> <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">+<span class="comment">----------+---------+</span></span><br><span class="line">| movieid  | rating  |</span><br><span class="line">+<span class="comment">----------+---------+</span></span><br><span class="line">| 78       | 5.0     |</span><br><span class="line">| 73       | 5.0     |</span><br><span class="line">| 72       | 5.0     |</span><br><span class="line">| 58       | 5.0     |</span><br><span class="line">| 55       | 5.0     |</span><br><span class="line">| 50       | 5.0     |</span><br><span class="line">| 41       | 5.0     |</span><br><span class="line">| 36       | 5.0     |</span><br><span class="line">| 25       | 5.0     |</span><br><span class="line">| 17       | 5.0     |</span><br><span class="line">+<span class="comment">----------+---------+</span></span><br><span class="line"></span><br><span class="line">3.è¿™10éƒ¨ç”µå½±çš„(è§‚å½±è€…ï¼Œç”µå½±åï¼Œå¹³å‡å½±è¯„åˆ†)</span><br><span class="line">è§‚å½±è€…è¿˜æ²¡å†™</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> t.MovieID, m.Title, <span class="keyword">avg</span>(r.rating) avgrating <span class="keyword">from</span> topten t </span><br><span class="line"><span class="keyword">join</span> ratings r <span class="keyword">on</span> t.MovieID=r.MovieID</span><br><span class="line"><span class="keyword">join</span> movies m <span class="keyword">on</span> t.MovieID=m.MovieID</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> t.MovieID,m.Title;</span><br><span class="line"></span><br><span class="line">+<span class="comment">------------+-----------------------------------------------+---------------------+</span></span><br><span class="line">| t.movieid  |                    m.title                    |      avgrating      |</span><br><span class="line">+<span class="comment">------------+-----------------------------------------------+---------------------+</span></span><br><span class="line">| 3849       | Spiral Staircase, The (1946)                  | 4.046511627906977   |</span><br><span class="line">| 3870       | Our Town (1940)                               | 3.857142857142857   |</span><br><span class="line">| 3871       | Shane (1953)                                  | 3.839344262295082   |</span><br><span class="line">| 3893       | Nurse Betty (2000)                            | 3.5026833631484795  |</span><br><span class="line">| 3897       | Almost Famous (2000)                          | 4.22635814889336    |</span><br><span class="line">| 3910       | Dancer in the Dark (2000)                     | 3.82                |</span><br><span class="line">| 3927       | Fantastic Voyage (1966)                       | 3.5804597701149423  |</span><br><span class="line">| 3928       | Abbott and Costello Meet Frankenstein (1948)  | 3.441747572815534   |</span><br><span class="line">| 3929       | Bank Dick, The (1940)                         | 3.993197278911565   |</span><br><span class="line">| 3932       | Invisible Man, The (1933)                     | 3.75                |</span><br><span class="line">+<span class="comment">------------+-----------------------------------------------+---------------------+</span></span><br></pre></td></tr></table></figure><p>ï¼ˆ6ï¼‰æ±‚å¥½ç‰‡ï¼ˆè¯„åˆ†&gt;=4.0ï¼‰æœ€å¤šçš„é‚£ä¸ªå¹´ä»½çš„æœ€å¥½çœ‹çš„10éƒ¨ç”µå½±<br>ï¼ˆ7ï¼‰æ±‚1997å¹´ä¸Šæ˜ çš„ç”µå½±ä¸­ï¼Œè¯„åˆ†æœ€é«˜çš„10éƒ¨Comedyç±»ç”µå½±<br>ï¼ˆ8ï¼‰è¯¥å½±è¯„åº“ä¸­å„ç§ç±»å‹ç”µå½±ä¸­è¯„ä»·æœ€é«˜çš„5éƒ¨ç”µå½±ï¼ˆç±»å‹ï¼Œç”µå½±åï¼Œå¹³å‡å½±è¯„åˆ†ï¼‰<br>ï¼ˆ9ï¼‰å„å¹´è¯„åˆ†æœ€é«˜çš„ç”µå½±ç±»å‹ï¼ˆå¹´ä»½ï¼Œç±»å‹ï¼Œå½±è¯„åˆ†ï¼‰<br>ï¼ˆ10ï¼‰æ¯ä¸ªåœ°åŒºæœ€é«˜è¯„åˆ†çš„ç”µå½±åï¼ŒæŠŠç»“æœå­˜å…¥HDFSï¼ˆåœ°åŒºï¼Œç”µå½±åï¼Œå½±è¯„åˆ†ï¼‰</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;strong&gt;ç°æœ‰å¦‚æ­¤ä¸‰ä»½æ•°æ®ï¼š&lt;/strong&gt;&lt;br&gt;&lt;strong&gt;1ã€users.dat    æ•°æ®æ ¼å¼ä¸ºï¼š  2::M::56::16::70072&lt;/strong&gt;&lt;br&gt;&lt;strong&gt;å¯¹åº”å­—æ®µä¸ºï¼šUserID BigInt, Gender String, 
      
    
    </summary>
    
      <category term="Hadoop" scheme="https://airpoet.github.io/categories/Hadoop/"/>
    
      <category term="Hive" scheme="https://airpoet.github.io/categories/Hadoop/Hive/"/>
    
    
      <category term="åŸåˆ›" scheme="https://airpoet.github.io/tags/%E5%8E%9F%E5%88%9B/"/>
    
      <category term="æŠ€æœ¯" scheme="https://airpoet.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="Hadoop" scheme="https://airpoet.github.io/tags/Hadoop/"/>
    
      <category term="Hive" scheme="https://airpoet.github.io/tags/Hive/"/>
    
  </entry>
  
  <entry>
    <title>IDEAçš„ç®€å•ä½¿ç”¨</title>
    <link href="https://airpoet.github.io/2018/06/18/Tools/IDEA/IDEA%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/"/>
    <id>https://airpoet.github.io/2018/06/18/Tools/IDEA/IDEAçš„ç®€å•ä½¿ç”¨/</id>
    <published>2018-06-18T11:14:22.768Z</published>
    <updated>2018-07-03T12:16:38.123Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-å®‰è£…-Scala-æ’ä»¶"><a href="#1-å®‰è£…-Scala-æ’ä»¶" class="headerlink" title="1.å®‰è£… Scala æ’ä»¶"></a>1.å®‰è£… Scala æ’ä»¶</h2><p><strong>é¦–å…ˆ, ç›´æ¥åœ¨ plugin ä¸­æœç´¢å®˜æ–¹çš„ Scala è¯­è¨€åŒ…æ’ä»¶æ˜¯è¿ä¸ä¸Šçš„, è¦éªŒè¯ä¸€äº› <code>UUID</code>ä¹‹ç±»çš„ä¸œè¥¿,  åŸå› ä½ æ‡‚çš„</strong></p><p><strong>äºæ˜¯ä¹åœ¨ç½‘ä¸Šæœç´¢, æœ‰ä¸€ç¯‡åšå®¢è¯´, çœ‹æœç´¢çš„æ—¶å€™æ˜¾ç¤ºçš„ç‰ˆæœ¬, ç„¶åä¸‹è½½æ­¤ç‰ˆæœ¬å®‰è£…, å¦‚ä¸‹å›¾ä¸­ç”»æ¡†çš„ç‰ˆæœ¬å·</strong></p><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-07-03-120649.png" alt="image-20180703200648842"></p><p><strong><a href="https://plugins.jetbrains.com/plugin/1347-scala" target="_blank" rel="noopener">ç„¶åå»å®˜ç½‘æ‰¾åˆ°æ­¤ç‰ˆæœ¬å®‰è£…,ä¸‹è½½ä¸‹æ¥</a></strong></p><p><strong>ä»ç£ç›˜å®‰è£…</strong></p><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-07-03-121009.png" alt="image-20180703201009168"></p><p><strong>ç®€ç›´ä¸è¦å¤ªå‘ b å“¦!!! </strong></p><p>ä¸€ç›´è¯´ç‰ˆæœ¬ä¸åŒ¹é….  æˆ‘å°±ä¸€ç›´æ²¡æœ‰æ€€ç–‘ç‰ˆæœ¬çš„é—®é¢˜, ç›´åˆ°çœ‹åˆ°</p><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-07-03-121105.png" alt="image-20180703201105675"></p><p><strong>æ€ä¹ˆæ„Ÿè§‰è¿™ä¸ª 2013.3 åœ¨å“ªé‡Œè§åˆ°è¿‡??</strong></p><p><strong>æŸ¥äº†ä¸€ä¸‹æˆ‘çš„ idea ç‰ˆæœ¬,  ä¸å°±æ˜¯ 2017.3.5å˜› !</strong></p><p>éš¾é“ä»–ä»¬æœ‰å…³ç³»?? æŠ±ç€è¯•ä¸€è¯•çš„æ€åº¦, éšä¾¿ä¸‹äº†ä¸€ä¸ª<strong>2017.3.15</strong>çš„</p><p><strong>å±…ç„¶èƒ½è£…ä¸Š??</strong></p><p><strong>å¥½å§, é‡å¯, OK äº†!</strong></p><p>ç”±æ­¤å¯è§, ä¹Ÿä¸è¦å®Œå…¨ç›¸ä¿¡åˆ«äººçš„åšå®¢å•Š!!  </p><p>å¦‚æœä¸è¡Œ, å¤šæ–¹å°è¯•! </p><p><strong>å°½ä¿¡ä¹¦ä¸å¦‚æ— ä¹¦!</strong></p><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-07-03-120834.png" alt="image-20180703200833829"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;1-å®‰è£…-Scala-æ’ä»¶&quot;&gt;&lt;a href=&quot;#1-å®‰è£…-Scala-æ’ä»¶&quot; class=&quot;headerlink&quot; title=&quot;1.å®‰è£… Scala æ’ä»¶&quot;&gt;&lt;/a&gt;1.å®‰è£… Scala æ’ä»¶&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;é¦–å…ˆ, ç›´æ¥åœ¨ plugin ä¸­æœç´¢
      
    
    </summary>
    
      <category term="å·¥å…·" scheme="https://airpoet.github.io/categories/%E5%B7%A5%E5%85%B7/"/>
    
      <category term="IDEA" scheme="https://airpoet.github.io/categories/%E5%B7%A5%E5%85%B7/IDEA/"/>
    
    
      <category term="åŸåˆ›" scheme="https://airpoet.github.io/tags/%E5%8E%9F%E5%88%9B/"/>
    
      <category term="å·¥å…·" scheme="https://airpoet.github.io/tags/%E5%B7%A5%E5%85%B7/"/>
    
      <category term="IDEA" scheme="https://airpoet.github.io/tags/IDEA/"/>
    
  </entry>
  
  <entry>
    <title>Hiveå­¦ä¹ â€”2</title>
    <link href="https://airpoet.github.io/2018/06/14/Hadoop/3-Hive/Hive%E5%AD%A6%E4%B9%A0-2/"/>
    <id>https://airpoet.github.io/2018/06/14/Hadoop/3-Hive/Hiveå­¦ä¹ -2/</id>
    <published>2018-06-14T01:04:30.334Z</published>
    <updated>2018-06-14T15:21:20.295Z</updated>
    
    <content type="html"><![CDATA[<h1 id="hiveæ•°æ®ç±»å‹"><a href="#hiveæ•°æ®ç±»å‹" class="headerlink" title="hiveæ•°æ®ç±»å‹"></a>hiveæ•°æ®ç±»å‹</h1><h3 id="1-åŸå­æ•°æ®ç±»å‹"><a href="#1-åŸå­æ•°æ®ç±»å‹" class="headerlink" title="1) åŸå­æ•°æ®ç±»å‹"></a>1) åŸå­æ•°æ®ç±»å‹</h3><ul><li>TinyIntï¼š1byteæœ‰ç¬¦å·æ•´æ•°</li><li>SmallIntï¼š2byteæœ‰ç¬¦å·æ•´æ•°</li><li>Intï¼š4byteæœ‰ç¬¦å·æ•´æ•°</li><li>BigIntï¼š8byteæœ‰ç¬¦å·æ•´æ•°</li><li>Floatï¼šå•ç²¾åº¦æµ®ç‚¹æ•°</li><li>Doubleï¼šåŒç²¾åº¦æµ®ç‚¹æ•°</li><li>Booleanï¼šå¸ƒå°”ç±»å‹</li><li>Stringï¼šå­—ç¬¦ä¸²</li><li>TimeStampï¼šæ•´æ•°</li></ul><h3 id="2-å¤æ‚æ•°æ®ç±»å‹"><a href="#2-å¤æ‚æ•°æ®ç±»å‹" class="headerlink" title="2) å¤æ‚æ•°æ®ç±»å‹"></a>2) å¤æ‚æ•°æ®ç±»å‹</h3><ul><li><p>Array\&lt;Type></p><ul><li>ç”±ä¸€ç³»åˆ—ç›¸åŒæ•°æ®ç±»å‹çš„å…ƒç´ ç»„æˆ</li><li>è¿™äº›å…ƒç´ å¯ä»¥é€šè¿‡ ä¸‹æ ‡ æ¥è®¿é—®</li><li>æŸ¥è¯¢æ—¶å¦‚æœæŸ¥åˆ°è¿”å›å“åº”å€¼ï¼Œæ²¡æŸ¥åˆ°åˆ™è¿”å›null<br>å»ºè¡¨ï¼š<br>create table person(name string,work_locations array\&lt;string>)<br>row format delimited fields terminated by â€˜\tâ€™<br>collection items terminated by â€˜,â€™;<br>å¯¼å…¥æ•°æ®ï¼š<br>load data local inpath â€˜/home/sigeon/person.txtâ€™ into table person;<br>æŸ¥è¯¢<br>Select work_locations[0] from person;</li></ul></li><li><p>Map&lt;KType, VType&gt;</p><ul><li>åŒ…å« key-value é”®å€¼å¯¹</li><li>å¯ä»¥é€šè¿‡ key æ¥è®¿é—®å…ƒç´ <br>å»ºè¡¨è¯­å¥ï¼š<br>create table score(name string, scores map)<br>row format delimited fields terminated by â€˜\tâ€™<br>collection items terminated by â€˜,â€™<br>map keys terminated by â€˜:â€™;<br>å¯¼å…¥æ•°æ®ï¼š<br>load data local inpath â€˜/home/sigeon/score.txtâ€™ into table score;<br>æŸ¥è¯¢è¯­å¥ï¼š<br>Select scores[â€˜Chineseâ€™] from score;</li></ul></li><li><p>Struct&lt;Param1:Type1, Param1:Type1, â€¦ &gt;</p><ul><li>å¯ä»¥åŒ…å«ä¸åŒæ•°æ®ç±»å‹çš„å…ƒç´ <br>ç±»ä¼¼äºcè¯­è¨€ä¸­çš„ç»“æ„ä½“</li><li>è¿™äº›å…ƒç´ å¯ä»¥é€šè¿‡ ç‚¹è¯­æ³• çš„æ–¹å¼æ¥å¾—åˆ°<br>å»ºè¡¨è¯­å¥ï¼š<br>create table course(id int,course struct&lt;name:string, score:int&gt;)<br>row format delimited fields terminated by â€˜\tâ€™<br>collection items terminated by â€˜,â€™;<br>å¯¼å…¥æ•°æ®ï¼š<br>load data local inpath â€˜/ home/sigoen/course.txtâ€™ into table course;<br>æŸ¥è¯¢è¯­å¥ï¼š<br>Select c.course.score from course c;</li></ul></li><li><p>å‡ ä¸ªåˆ†éš”ç¬¦</p></li></ul><p>  æŒ‡å®šåˆ†éš”ç¬¦è¦æŒ‰ä»å¤–å‘å†…çš„é¡ºåºï¼Œå­—æ®µ -&gt; é›†åˆå…ƒç´  -&gt;map k-v</p><ul><li>ROW FORMATï¼šæŒ‡å®šåˆ†éš”ç¬¦çš„å…³é”®å­— </li><li>DELIMITED FIELDS TERMINATED BYï¼šå­—æ®µåˆ†éš”ç¬¦ </li><li>COLLECTION ITEMS TERMINATED BYï¼šé›†åˆå…ƒç´ åˆ†éš”ç¬¦ï¼ˆArray ä¸­çš„å„å…ƒç´ ã€Struct ä¸­çš„å„å…ƒç´ ã€ Map ä¸­çš„ key-value å¯¹ä¹‹é—´ï¼‰ </li><li>MAP KEYS TERMINATED BYï¼šMap ä¸­ key ä¸ value çš„åˆ†éš”ç¬¦ </li><li>LINES TERMINATED BYï¼šè¡Œä¹‹é—´çš„åˆ†éš”ç¬¦</li></ul><h1 id="hiveè§†å›¾"><a href="#hiveè§†å›¾" class="headerlink" title="hiveè§†å›¾"></a>hiveè§†å›¾</h1><ul><li><p>å’Œå…³ç³»å‹æ•°æ®åº“ä¸€æ ·ï¼ŒHiveä¹Ÿæä¾›äº†è§†å›¾çš„åŠŸèƒ½</p></li><li><p>Hive çš„è§†å›¾å’Œå…³ç³»å‹æ•°æ®åº“çš„è§†å›¾æœ‰å¾ˆå¤§çš„åŒºåˆ«ï¼š </p><ul><li>1ã€åªæœ‰é€»è¾‘è§†å›¾ï¼Œæ²¡æœ‰ç‰©åŒ–è§†å›¾ï¼› </li><li>2ã€è§†å›¾åªèƒ½æŸ¥è¯¢ï¼Œä¸èƒ½å¢åˆ æ”¹ (Load|Insert/Update/Delete) æ•°æ®ï¼› </li><li>3ã€è§†å›¾åœ¨åˆ›å»ºæ—¶å€™ï¼Œåªæ˜¯ä¿å­˜äº†ä¸€ä»½å…ƒæ•°æ® (å­˜åœ¨TBLSä¸­)ï¼Œå½“æŸ¥è¯¢è§†å›¾çš„æ—¶å€™ï¼Œæ‰å¼€å§‹æ‰§è¡Œè§†å›¾å¯¹åº”çš„é‚£äº›å­æŸ¥è¯¢<br>è§†å›¾å…ƒæ•°æ®åªå­˜å‚¨äº†hqlè¯­å¥ï¼Œè€Œä¸æ˜¯æ‰§è¡Œç»“æœ</li></ul></li><li><p>è§†å›¾æ“ä½œ</p><ul><li><p>åˆ›å»ºè§†å›¾</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">view</span> my_view <span class="keyword">as</span> &lt;<span class="keyword">select</span> * <span class="keyword">from</span> mytable&gt; [<span class="keyword">limit</span> <span class="number">500</span>];</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹è§†å›¾</p><ul><li>show tables;   // æ˜¾ç¤ºæ‰€æœ‰è¡¨å’Œè§†å›¾</li><li>show views;    //æ˜¾ç¤ºæ‰€æœ‰è§†å›¾</li><li>desc [formatted] view_name;   // æŸ¥çœ‹æŸä¸ªå…·ä½“è§†å›¾çš„(è¯¦ç»†)ä¿¡æ¯<br>è§†å›¾ç±»å‹ï¼šVIRTUAL_VIEW</li></ul></li><li><p>åˆ é™¤è§†å›¾</p><ul><li>drop view [if exists] view_name</li></ul></li><li><p>ä½¿ç”¨è§†å›¾ </p><ul><li>select count(distinct uid) from my_view;</li></ul></li></ul></li></ul><h1 id="hiveå‡½æ•°"><a href="#hiveå‡½æ•°" class="headerlink" title="hiveå‡½æ•°"></a>hiveå‡½æ•°</h1><ul><li><p>å‡½æ•°åˆ†ç±»</p><ul><li>UDFï¼ˆè‡ªå®šä¹‰å‡½æ•° User-Defined Functionï¼‰ä½œç”¨äºå•ä¸ªæ•°æ®è¡Œï¼Œäº§ç”Ÿä¸€ä¸ªæ•°æ®è¡Œä½œä¸ºè¾“å‡ºã€‚ï¼ˆæ•°å­¦å‡½æ•°ï¼Œå­— ç¬¦ä¸²å‡½æ•°ï¼‰ </li><li>UDAFï¼ˆç”¨æˆ·å®šä¹‰èšé›†å‡½æ•° User-Defined Aggregation Funcationï¼‰ï¼šæ¥æ”¶å¤šä¸ªè¾“å…¥æ•°æ®è¡Œï¼Œå¹¶äº§ ç”Ÿä¸€ä¸ªè¾“å‡ºæ•°æ®è¡Œã€‚ï¼ˆcountï¼Œmaxï¼‰ </li><li>UDTFï¼ˆè¡¨æ ¼ç”Ÿæˆå‡½æ•° User-Defined Table Functionï¼‰ï¼šæ¥æ”¶ä¸€è¡Œè¾“å…¥ï¼Œè¾“å‡ºå¤šè¡Œï¼ˆexplodeï¼‰</li></ul></li><li><p>å†…ç½®å‡½æ•°</p><ul><li><p>æŸ¥çœ‹å‡½æ•°å‘½ä»¤</p><ul><li>æŸ¥çœ‹å†…ç½®å‡½æ•°ï¼š show functions; </li><li>æ˜¾ç¤ºå‡½æ•°çš„è¯¦ç»†ä¿¡æ¯ï¼š desc function [extended] fun_name;<br>extendedï¼šæ˜¾ç¤ºæ‰©å±•ä¿¡æ¯</li></ul></li><li><p>åˆ†ç±»</p><ul><li><p>å…³ç³»è¿ç®—</p><ul><li>åˆ†ç±»<br>\1. ç­‰å€¼æ¯”è¾ƒ: =<br>\2. ç­‰å€¼æ¯”è¾ƒ:&lt;=&gt;<br>\3. ä¸ç­‰å€¼æ¯”è¾ƒ: &lt;&gt;å’Œ!=<br>\4. å°äºæ¯”è¾ƒ: &lt;<br>\5. å°äºç­‰äºæ¯”è¾ƒ: &lt;=<br>\6. å¤§äºæ¯”è¾ƒ: &gt;<br>\7. å¤§äºç­‰äºæ¯”è¾ƒ: &gt;=<br>\8. åŒºé—´æ¯”è¾ƒ<br>\9. ç©ºå€¼åˆ¤æ–­: IS NULL<br>\10. éç©ºåˆ¤æ–­: IS NOT NULL<br>\10. LIKE æ¯”è¾ƒ: LIKE<br>\11. JAVA çš„ LIKE æ“ä½œ: RLIKE<br>\12. REGEXP æ“ä½œ: REGEXP</li></ul></li><li><p>æ•°å­¦è¿ç®—</p><ul><li>åˆ†ç±»<br>\1. åŠ æ³•æ“ä½œ: +<br>\2. å‡æ³•æ“ä½œ: â€“<br>\3. ä¹˜æ³•æ“ä½œ: *<br>\4. é™¤æ³•æ“ä½œ: /<br>\5. å–ä½™æ“ä½œ: %<br>\6. ä½ä¸æ“ä½œ: &amp;<br>\7. ä½æˆ–æ“ä½œ: |<br>\8. ä½å¼‚æˆ–æ“ä½œ: ^<br>9ï¼ä½å–åæ“ä½œ: ~</li></ul></li><li><p>é€»è¾‘è¿ç®—</p><ul><li>åˆ†ç±»<br>\1. é€»è¾‘ä¸æ“ä½œ: AND ã€&amp;&amp;<br>\2. é€»è¾‘æˆ–æ“ä½œ: OR ã€||<br>\3. é€»è¾‘éæ“ä½œ: NOTã€!</li></ul></li><li><p>å¤åˆç±»å‹æ„é€ å‡½æ•° </p><ul><li>åˆ†ç±»<ol><li>array ç»“æ„</li><li>map ç»“æ„<br>\3. struct ç»“æ„<br>\4. named_struct ç»“æ„<br>\5. create_union </li></ol></li></ul></li><li><p>å¤åˆç±»å‹æ“ä½œç¬¦</p><ul><li>\1. è·å– array ä¸­çš„å…ƒç´  </li><li>\2. è·å– map ä¸­çš„å…ƒç´  </li><li>\3. è·å– struct ä¸­çš„å…ƒç´ </li></ul></li><li><p>é›†åˆæ“ä½œå‡½æ•° </p><ul><li><p>\1. map ç±»å‹å¤§å°ï¼šsize </p></li><li><p>\2. array ç±»å‹å¤§å°ï¼šsize </p></li><li><p>\3. åˆ¤æ–­å…ƒç´ æ•°ç»„æ˜¯å¦åŒ…å«å…ƒç´ ï¼šarray_contains </p></li><li><p>\4. è·å– map ä¸­æ‰€æœ‰ value é›†åˆ </p></li><li><p>\5. è·å– map ä¸­æ‰€æœ‰ key é›†åˆ </p></li><li><p>\6. æ•°ç»„æ’åº</p></li><li><p>\7. è·å–ç´ ç»„æˆ–mapé›†åˆçš„å•ä¸ªå…ƒç´ ï¼ˆk-vå¯¹ï¼‰ï¼š<strong>explode()</strong></p><p><strong>å½“åŒæ—¶æŸ¥è¯¢ç‚¸è£‚å­—æ®µå’Œæ™®é€šå­—æ®µæ—¶ï¼Œéœ€è¦ä½¿ç”¨æ¨ªå‘è™šæ‹Ÿè§†å›¾ï¼šlateral view</strong></p><ul><li>å¦‚ï¼šselect name,addr.city from usr_addr lateral view(address) addr as city;<br>è¿™é‡Œä¸€èˆ¬éœ€è¦ç»™ æŸ¥è¯¢ç»“æœ å’Œ ç»“æœå­—æ®µ èµ·åˆ«åï¼Œä¸ç„¶æ²¡åŠæ³•è·å¾—æ¯ä¸ªå­—æ®µï¼Œå¦‚æœåªæ˜¯æŸ¥è¯¢æ‰€æœ‰çš„è¯å°±ä¸éœ€è¦äº†</li></ul></li></ul></li><li><p>ç±»å‹è½¬æ¢å‡½æ•°</p><ul><li>\1. äºŒè¿›åˆ¶è½¬æ¢ï¼šbinary </li><li>\2. åŸºç¡€ç±»å‹ä¹‹é—´å¼ºåˆ¶è½¬æ¢ï¼šcast </li></ul></li><li><p>æ•°å€¼è®¡ç®—å‡½æ•°</p><ul><li>\1. å–æ•´å‡½æ•°: round </li><li>\2. æŒ‡å®šç²¾åº¦å–æ•´å‡½æ•°: round </li><li>\3. å‘ä¸‹å–æ•´å‡½æ•°: floor </li><li>\4. å‘ä¸Šå–æ•´å‡½æ•°: ceil </li><li>\5. å‘ä¸Šå–æ•´å‡½æ•°: ceiling </li><li>\6. å–éšæœºæ•°å‡½æ•°: rand </li><li>\7. è‡ªç„¶æŒ‡æ•°å‡½æ•°: exp </li><li>\8. ä»¥ 10 ä¸ºåº•å¯¹æ•°å‡½æ•°: log10 </li><li>\9. ä»¥ 2 ä¸ºåº•å¯¹æ•°å‡½æ•°: log2 </li><li>\10. å¯¹æ•°å‡½æ•°: log </li><li>\11. å¹‚è¿ç®—å‡½æ•°: pow </li><li>\12. å¹‚è¿ç®—å‡½æ•°: power </li><li>\13. å¼€å¹³æ–¹å‡½æ•°: sqrt </li><li>\14. äºŒè¿›åˆ¶å‡½æ•°: bin </li><li>\15. åå…­è¿›åˆ¶å‡½æ•°: hex </li><li>\16. åè½¬åå…­è¿›åˆ¶å‡½æ•°: unhex </li><li>\17. è¿›åˆ¶è½¬æ¢å‡½æ•°: conv </li><li>\18. ç»å¯¹å€¼å‡½æ•°: abs </li><li>\19. æ­£å–ä½™å‡½æ•°: pmod </li><li>\20. æ­£å¼¦å‡½æ•°: sin </li><li>\21. åæ­£å¼¦å‡½æ•°: asin </li><li>\22. ä½™å¼¦å‡½æ•°: cos </li><li>\23. åä½™å¼¦å‡½æ•°: acos </li><li>\24. positive å‡½æ•°: positive </li><li>\25. negative å‡½æ•°: negative </li></ul></li><li><p>å­—ç¬¦ä¸²å‡½æ•°</p><ul><li>\1. å­—ç¬¦ ascii ç å‡½æ•°ï¼šascii </li><li>\2. base64 å­—ç¬¦ä¸² </li><li>\3. å­—ç¬¦ä¸²è¿æ¥å‡½æ•°ï¼šconcat </li><li>\4. å¸¦åˆ†éš”ç¬¦å­—ç¬¦ä¸²è¿æ¥å‡½æ•°ï¼šconcat_ws </li><li>\5. æ•°ç»„è½¬æ¢æˆå­—ç¬¦ä¸²çš„å‡½æ•°ï¼šconcat_ws </li><li>\6. å°æ•°ä½æ ¼å¼åŒ–æˆå­—ç¬¦ä¸²å‡½æ•°ï¼šformat_number </li><li>\7. å­—ç¬¦ä¸²æˆªå–å‡½æ•°ï¼šsubstr, substring<br>åºå·ä»1å¼€å§‹ï¼Œå¯ä»¥ä¼ è´Ÿæ•°ï¼Œä»£è¡¨ä»å³å¼€å§‹</li><li>\9. å­—ç¬¦ä¸²æŸ¥æ‰¾å‡½æ•°ï¼šinstr<br>æ‰¾åˆ°è¿”å›ä¸€ä¸ªæ­£æ•´æ•°ï¼Œæœªæ‰¾åˆ°è¿”å›0</li><li>\10. å­—ç¬¦ä¸²é•¿åº¦å‡½æ•°ï¼šlength </li><li>\11. å­—ç¬¦ä¸²æŸ¥æ‰¾å‡½æ•°ï¼šlocate </li><li>\12. å­—ç¬¦ä¸²æ ¼å¼åŒ–å‡½æ•°ï¼šprintf </li><li>\13. å­—ç¬¦ä¸²è½¬æ¢æˆ map å‡½æ•°ï¼šstr_to_map </li><li>\14. base64 è§£ç å‡½æ•°ï¼šunbase64(string str) </li><li>\15. å­—ç¬¦ä¸²è½¬å¤§å†™å‡½æ•°ï¼šupper,ucase </li><li>\16. å­—ç¬¦ä¸²è½¬å°å†™å‡½æ•°ï¼šlower,lcase </li><li>\17. å»ç©ºæ ¼å‡½æ•°ï¼štrim </li><li>\18. å·¦è¾¹å»ç©ºæ ¼å‡½æ•°ï¼šltrim </li><li>\19. å³è¾¹å»ç©ºæ ¼å‡½æ•°ï¼šrtrim </li><li>\20. æ­£åˆ™è¡¨è¾¾å¼æ›¿æ¢å‡½æ•°ï¼šregexp_replace </li><li>\21. æ­£åˆ™è¡¨è¾¾å¼è§£æå‡½æ•°ï¼šregexp_extract </li><li>\22. URL è§£æå‡½æ•°ï¼šparse_url </li><li>\23. json è§£æå‡½æ•°ï¼šget_json_object </li><li>\24. ç©ºæ ¼å­—ç¬¦ä¸²å‡½æ•°ï¼šspace </li><li>\25. é‡å¤å­—ç¬¦ä¸²å‡½æ•°ï¼šrepeat </li><li>\26. å·¦è¡¥è¶³å‡½æ•°ï¼šlpad</li><li>\27. å³è¡¥è¶³å‡½æ•°ï¼šrpad </li><li>\28. åˆ†å‰²å­—ç¬¦ä¸²å‡½æ•°: split </li><li>\29. é›†åˆæŸ¥æ‰¾å‡½æ•°: find_in_set </li><li>\30. åˆ†è¯å‡½æ•°ï¼šsentences </li><li>\31. åˆ†è¯åç»Ÿè®¡ä¸€èµ·å‡ºç°é¢‘æ¬¡æœ€é«˜çš„ TOP-K </li><li>\32. åˆ†è¯åç»Ÿè®¡ä¸æŒ‡å®šå•è¯ä¸€èµ·å‡ºç°é¢‘æ¬¡æœ€é«˜çš„ TOP-K </li></ul></li><li><p>æ—¥æœŸå‡½æ•°</p><ul><li>\1. UNIX æ—¶é—´æˆ³è½¬æ—¥æœŸå‡½æ•°: from_unixtime </li><li>\2. è·å–å½“å‰ UNIX æ—¶é—´æˆ³å‡½æ•°: unix_timestamp </li><li>\3. æ—¥æœŸè½¬ UNIX æ—¶é—´æˆ³å‡½æ•°: unix_timestamp </li><li>\4. æŒ‡å®šæ ¼å¼æ—¥æœŸè½¬ UNIX æ—¶é—´æˆ³å‡½æ•°: unix_timestamp </li><li>\5. æ—¥æœŸæ—¶é—´è½¬æ—¥æœŸå‡½æ•°: to_date </li><li>\6. æ—¥æœŸè½¬å¹´å‡½æ•°: year </li><li>\7. æ—¥æœŸè½¬æœˆå‡½æ•°: month </li><li>\8. æ—¥æœŸè½¬å¤©å‡½æ•°: day </li><li>\9. æ—¥æœŸè½¬å°æ—¶å‡½æ•°: hour </li><li>\10. æ—¥æœŸè½¬åˆ†é’Ÿå‡½æ•°: minute </li><li>\11. æ—¥æœŸè½¬ç§’å‡½æ•°: second </li><li>\12. æ—¥æœŸè½¬å‘¨å‡½æ•°: weekofyear </li><li>\13. æ—¥æœŸæ¯”è¾ƒå‡½æ•°: datediff </li><li>\14. æ—¥æœŸå¢åŠ å‡½æ•°: date_add </li><li>\15. æ—¥æœŸå‡å°‘å‡½æ•°: date_sub </li></ul></li><li><p>æ¡ä»¶å‡½æ•°</p><ul><li>\1. If å‡½æ•°: if( æ¡ä»¶ ï¼Œtrueè¿”å›å‚æ•°ï¼Œfalseè¿”å›å‚æ•° ) </li><li>\2. å½“param1ä¸ä¸ºnullè¿”å›param1ï¼Œå¦åˆ™è¿”å›param2ï¼šnvl(param1, param2)</li><li>\2. éç©ºæŸ¥æ‰¾å‡½æ•°: coalesce</li><li>\3. æ¡ä»¶åˆ¤æ–­å‡½æ•°ï¼šcase</li></ul></li><li><p>æ··åˆå‡½æ•° </p><ul><li>åˆ†ç±»<br>\1. è°ƒç”¨ Java å‡½æ•°ï¼šjava_method<br>\2. è°ƒç”¨ Java å‡½æ•°ï¼šreflect<br>\3. å­—ç¬¦ä¸²çš„ hash å€¼ï¼šhash</li></ul></li><li><p>XPath è§£æ XML å‡½æ•° </p><ul><li>åˆ†ç±»<br>\1. xpath<br>\2. xpath_string<br>\3. xpath_boolean<br>\4. xpath_short, xpath_int, xpath_long<br>\5. xpath_float, xpath_double, xpath_number </li></ul></li><li><p>æ±‡æ€»ç»Ÿè®¡å‡½æ•°ï¼ˆUDAFï¼‰</p><ul><li>\1. ä¸ªæ•°ç»Ÿè®¡å‡½æ•°: count </li><li>\2. æ€»å’Œç»Ÿè®¡å‡½æ•°: sum </li><li>\3. å¹³å‡å€¼ç»Ÿè®¡å‡½æ•°: avg </li><li>\4. æœ€å°å€¼ç»Ÿè®¡å‡½æ•°: min </li><li>\5. æœ€å¤§å€¼ç»Ÿè®¡å‡½æ•°: max</li><li>\6. éç©ºé›†åˆæ€»ä½“å˜é‡å‡½æ•°: var_pop </li><li>\7. éç©ºé›†åˆæ ·æœ¬å˜é‡å‡½æ•°: var_samp </li><li>\8. æ€»ä½“æ ‡å‡†åç¦»å‡½æ•°: stddev_pop </li><li>\9. æ ·æœ¬æ ‡å‡†åç¦»å‡½æ•°: stddev_samp </li><li>10ï¼ä¸­ä½æ•°å‡½æ•°: percentile </li><li>\11. ä¸­ä½æ•°å‡½æ•°: percentile </li><li>\12. è¿‘ä¼¼ä¸­ä½æ•°å‡½æ•°: percentile_approx </li><li>\13. è¿‘ä¼¼ä¸­ä½æ•°å‡½æ•°: percentile_approx </li><li>\14. ç›´æ–¹å›¾: histogram_numeric </li><li>\15. é›†åˆå»é‡æ•°ï¼šcollect_set </li><li>\16. é›†åˆä¸å»é‡å‡½æ•°ï¼šcollect_list </li></ul></li><li><p>è¡¨æ ¼ç”Ÿæˆå‡½æ•° Table-Generating Functions (UDTF) </p><ul><li>åˆ†ç±»<br>1ï¼æ•°ç»„æ‹†åˆ†æˆå¤šè¡Œï¼šexplode(array)<br>2ï¼Map æ‹†åˆ†æˆå¤šè¡Œï¼šexplode(map) </li></ul></li></ul></li></ul></li><li><p>è‡ªå®šä¹‰å‡½æ•°</p><ul><li>\1. éœ€è¦ç»§æ‰¿ org.apache.hadoop.hive.ql.exec.UDF ç±»ï¼Œå®ç°ä¸€ä¸ªæˆ–å¤šä¸ª evaluate() æ–¹æ³•</li><li>\2. å°†hiveçš„jaråŒ…æ”¾åœ¨hiveçš„classpathè·¯å¾„ä¸‹ï¼Œè¿›å…¥hiveå®¢æˆ·ç«¯ï¼Œæ‰§è¡Œå‘½ä»¤ï¼šadd jar \<jar path="">;</jar></li><li>\3. æ£€æŸ¥jaråŒ…æ˜¯å¦æ·»åŠ æˆåŠŸï¼Œæ‰§è¡Œå‘½ä»¤ï¼šlist jars;</li><li>\4. ç»™è‡ªå®šä¹‰å‡½æ•° æ·»åŠ åˆ«åï¼Œå¹¶åœ¨hiveä¸­ æ³¨å†Œ è¯¥å‡½æ•°ï¼Œæ‰§è¡Œå‘½ä»¤ï¼šcreate temporary function myfunc as â€˜ä¸»ç±»å…¨è·¯å¾„åâ€™;<br>myfuncï¼šè‡ªå®šä¹‰å‡½æ•°åˆ«å<br>è¯¥æ–¹æ³•åˆ›å»ºçš„æ˜¯ä¸´æ—¶å‡½æ•°ï¼Œå½“å‰å®¢æˆ·ç«¯å…³é—­å°±æ²¡æœ‰äº†ï¼Œä¸‹æ¬¡é‡å¤ç¬¬3ï¼Œ4æ­¥ï¼›<br>çœŸå® ç”Ÿäº§ä¸­å°±æ˜¯ä½¿ç”¨è¯¥æ–¹æ³•ï¼</li><li>\5. æŸ¥çœ‹hiveå‡½æ•°åº“æœ‰æ²¡æœ‰æˆåŠŸæ·»åŠ ï¼Œæ‰§è¡Œå‘½ä»¤ï¼šshow functions;</li><li>\6. è°ƒç”¨å‡½æ•°æ—¶é€šè¿‡å‡½æ•°åå’Œå‚æ•°åˆ—è¡¨ç¡®å®šè°ƒç”¨çš„æ˜¯å…·ä½“å“ªä¸€ä¸ªæ–¹æ³•</li></ul></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;hiveæ•°æ®ç±»å‹&quot;&gt;&lt;a href=&quot;#hiveæ•°æ®ç±»å‹&quot; class=&quot;headerlink&quot; title=&quot;hiveæ•°æ®ç±»å‹&quot;&gt;&lt;/a&gt;hiveæ•°æ®ç±»å‹&lt;/h1&gt;&lt;h3 id=&quot;1-åŸå­æ•°æ®ç±»å‹&quot;&gt;&lt;a href=&quot;#1-åŸå­æ•°æ®ç±»å‹&quot; class=&quot;head
      
    
    </summary>
    
      <category term="Hadoop" scheme="https://airpoet.github.io/categories/Hadoop/"/>
    
      <category term="Hive" scheme="https://airpoet.github.io/categories/Hadoop/Hive/"/>
    
    
      <category term="åŸåˆ›" scheme="https://airpoet.github.io/tags/%E5%8E%9F%E5%88%9B/"/>
    
      <category term="æŠ€æœ¯" scheme="https://airpoet.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="Hadoop" scheme="https://airpoet.github.io/tags/Hadoop/"/>
    
      <category term="Hive" scheme="https://airpoet.github.io/tags/Hive/"/>
    
  </entry>
  
  <entry>
    <title>i-Hive-1</title>
    <link href="https://airpoet.github.io/2018/06/13/Hadoop/3-Hive/i-Hive-1/"/>
    <id>https://airpoet.github.io/2018/06/13/Hadoop/3-Hive/i-Hive-1/</id>
    <published>2018-06-13T14:04:40.446Z</published>
    <updated>2018-06-22T13:29:40.732Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-Hive-åˆæ¢"><a href="#1-Hive-åˆæ¢" class="headerlink" title="1.  Hive åˆæ¢"></a>1.  Hive åˆæ¢</h1><h3 id="1-1-Hive-çš„æ•°æ®å­˜å‚¨"><a href="#1-1-Hive-çš„æ•°æ®å­˜å‚¨" class="headerlink" title="1.1 Hive çš„æ•°æ®å­˜å‚¨"></a>1.1 Hive çš„æ•°æ®å­˜å‚¨</h3><ul><li>Hiveçš„æ•°æ®å­˜å‚¨åŸºäºHadoop HDFS</li><li>Hiveæ²¡æœ‰ä¸“é—¨çš„æ•°æ®å­˜å‚¨æ ¼å¼</li><li>å­˜å‚¨ç»“æ„ä¸»è¦åŒ…æ‹¬ï¼šæ•°æ®åº“ã€æ–‡ä»¶ã€è¡¨ã€è§†å›¾ã€ç´¢å¼•</li><li>Hiveé»˜è®¤å¯ä»¥ç›´æ¥åŠ è½½æ–‡æœ¬æ–‡ä»¶ï¼ˆTextFileï¼‰ï¼Œè¿˜æ”¯æŒSequenceFileã€RCFile </li><li>åˆ›å»ºè¡¨æ—¶ï¼ŒæŒ‡å®šHiveæ•°æ®çš„åˆ—åˆ†éš”ç¬¦ä¸è¡Œåˆ†éš”ç¬¦ï¼ŒHiveå³å¯è§£ææ•°æ®</li></ul><h3 id="1-2-Hiveçš„ç³»ç»Ÿæ¶æ„"><a href="#1-2-Hiveçš„ç³»ç»Ÿæ¶æ„" class="headerlink" title="1.2 Hiveçš„ç³»ç»Ÿæ¶æ„"></a>1.2 Hiveçš„ç³»ç»Ÿæ¶æ„</h3><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-13-152054.jpg" alt=""></p><ul><li>ç”¨æˆ·æ¥å£ï¼ŒåŒ…æ‹¬ CLIï¼ŒJDBC/ODBCï¼ŒWebUI</li><li>å…ƒæ•°æ®å­˜å‚¨ï¼Œé€šå¸¸æ˜¯å­˜å‚¨åœ¨å…³ç³»æ•°æ®åº“å¦‚ mysql, derby ä¸­</li><li>è§£é‡Šå™¨ã€ç¼–è¯‘å™¨ã€ä¼˜åŒ–å™¨ã€æ‰§è¡Œå™¨</li><li>Hadoopï¼šç”¨ HDFS è¿›è¡Œå­˜å‚¨ï¼Œåˆ©ç”¨ MapReduce è¿›è¡Œè®¡ç®—</li></ul><h3 id="1-3-Hiveçš„ç³»ç»Ÿæ¶æ„"><a href="#1-3-Hiveçš„ç³»ç»Ÿæ¶æ„" class="headerlink" title="1.3 Hiveçš„ç³»ç»Ÿæ¶æ„"></a>1.3 Hiveçš„ç³»ç»Ÿæ¶æ„</h3><ul><li>ç”¨æˆ·æ¥å£ä¸»è¦æœ‰ä¸‰ä¸ªï¼šCLIï¼ŒJDBC/ODBCå’Œ WebUI<ul><li>CLIï¼Œå³Shellå‘½ä»¤è¡Œ</li><li>JDBC/ODBC æ˜¯ Hive çš„Javaï¼Œä¸ä½¿ç”¨ä¼ ç»Ÿæ•°æ®åº“JDBCçš„æ–¹å¼ç±»ä¼¼</li><li>WebGUIæ˜¯é€šè¿‡æµè§ˆå™¨è®¿é—® Hive</li></ul></li><li>Hive å°†å…ƒæ•°æ®å­˜å‚¨åœ¨æ•°æ®åº“ä¸­(metastore)ï¼Œç›®å‰åªæ”¯æŒ mysqlã€derbyã€‚Hive ä¸­çš„å…ƒæ•°æ®åŒ…æ‹¬è¡¨çš„åå­—ï¼Œè¡¨çš„åˆ—å’Œåˆ†åŒºåŠå…¶å±æ€§ï¼Œè¡¨çš„å±æ€§ï¼ˆæ˜¯å¦ä¸ºå¤–éƒ¨è¡¨ç­‰ï¼‰ï¼Œè¡¨çš„æ•°æ®æ‰€åœ¨ç›®å½•ç­‰</li><li>è§£é‡Šå™¨ã€ç¼–è¯‘å™¨ã€ä¼˜åŒ–å™¨å®Œæˆ HQL æŸ¥è¯¢è¯­å¥ä»è¯æ³•åˆ†æã€è¯­æ³•åˆ†æã€ç¼–è¯‘ã€ä¼˜åŒ–ä»¥åŠæŸ¥è¯¢è®¡åˆ’ï¼ˆplanï¼‰çš„ç”Ÿæˆã€‚ç”Ÿæˆçš„æŸ¥è¯¢è®¡åˆ’å­˜å‚¨åœ¨ HDFS ä¸­ï¼Œå¹¶åœ¨éšåç”± MapReduce è°ƒç”¨æ‰§è¡Œ</li><li>Hive çš„æ•°æ®å­˜å‚¨åœ¨ HDFS ä¸­ï¼Œå¤§éƒ¨åˆ†çš„æŸ¥è¯¢ç”± MapReduce å®Œæˆï¼ˆåŒ…å« <em> çš„æŸ¥è¯¢ï¼Œæ¯”å¦‚ select </em> from table ä¸ä¼šç”Ÿæˆ MapRedcue ä»»åŠ¡</li></ul><h3 id="1-4-Hiveçš„metastore"><a href="#1-4-Hiveçš„metastore" class="headerlink" title="1.4 Hiveçš„metastore"></a>1.4 Hiveçš„metastore</h3><ul><li>metastoreæ˜¯hiveå…ƒæ•°æ®çš„é›†ä¸­å­˜æ”¾åœ°ã€‚</li><li>metastoreé»˜è®¤ä½¿ç”¨å†…åµŒçš„derbyæ•°æ®åº“ä½œä¸ºå­˜å‚¨å¼•æ“</li><li>Derbyå¼•æ“çš„ç¼ºç‚¹ï¼šä¸€æ¬¡åªèƒ½æ‰“å¼€ä¸€ä¸ªä¼šè¯</li><li>ä½¿ç”¨Mysqlä½œä¸ºå¤–ç½®å­˜å‚¨å¼•æ“ï¼Œå¤šç”¨æˆ·åŒæ—¶è®¿é—® </li></ul><h3 id="1-5-Hive-å’Œ-Hadoop-çš„è°ƒç”¨å…³ç³»"><a href="#1-5-Hive-å’Œ-Hadoop-çš„è°ƒç”¨å…³ç³»" class="headerlink" title="1.5 Hive å’Œ Hadoop çš„è°ƒç”¨å…³ç³»"></a>1.5 Hive å’Œ Hadoop çš„è°ƒç”¨å…³ç³»</h3><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-13-140311.jpg" alt=""></p><blockquote><p>1ã€æäº¤sql  äº¤ç»™é©±åŠ¨<br>2ã€é©±åŠ¨ç¼–è¯‘    è§£æç›¸å…³çš„å­—æ®µè¡¨ä¿¡æ¯<br>3ã€å»metastoreæŸ¥è¯¢ç›¸å…³çš„ä¿¡æ¯    è¿”å›å­—æ®µè¡¨ä¿¡æ¯<br>4ã€ç¼–è¯‘è¿”å›ä¿¡æ¯ å‘ç»™é©±åŠ¨<br>5ã€é©±åŠ¨å‘é€ä¸€ä¸ªæ‰§è¡Œè®¡åˆ’    äº¤ç»™æ‰§è¡Œå¼•æ“<br>6.1ã€DDLs <strong>å¯¹æ•°æ®åº“è¡¨çš„æ“ä½œçš„, ç›´æ¥å’Œmetastoreäº¤äº’</strong>,<code>create table t1(name string);</code></p><p>6.2ã€å®Œæˆjobè¿”å›æ•°æ®ä¿¡æ¯ã€æ‰¾<strong>namenode</strong>æŸ¥æ•°æ®<br>6.3ã€<strong>namenode</strong>äº¤äº’<code>select count(1) from t1;</code><br>7ã€è¿”å›ç»“æœä¿¡æ¯é›†</p></blockquote><h3 id="1-6-Hive-å‚æ•°é…ç½®ä½¿ç”¨"><a href="#1-6-Hive-å‚æ•°é…ç½®ä½¿ç”¨" class="headerlink" title="1.6 Hive å‚æ•°é…ç½®ä½¿ç”¨"></a>1.6 Hive å‚æ•°é…ç½®ä½¿ç”¨</h3><table><thead><tr><th>å‘½åç©ºé—´</th><th>ä½¿ç”¨æƒé™</th><th>æè¿°</th></tr></thead><tbody><tr><td>hivevar</td><td>å¯è¯»å†™</td><td>$   hive -d name=zhangsan;</td></tr><tr><td>hiveconf</td><td>å¯è¯»å†™</td><td>\$   hive â€“hiveconf hive.cli.print.current.db=true;   $   hive â€“hiveconf hive.cli.print.header=true;</td></tr><tr><td>system</td><td>å¯è¯»å†™</td><td>javaå®šä¹‰çš„é…ç½®å±æ€§ï¼Œå¦‚system:user.name</td></tr><tr><td>env</td><td>åªè¯»</td><td>shellç¯å¢ƒå˜é‡ï¼Œå¦‚env:USER</td></tr></tbody></table><ul><li><p>hivevar </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨åœºæ™¯: èµ·åˆ«å</span></span><br><span class="line">hive -d name=zhangsan  <span class="comment">#ä¼ å‚</span></span><br><span class="line">&gt; create table t2(name string,<span class="variable">$&#123;name&#125;</span> string); <span class="comment">#å–å‚æ•°</span></span><br><span class="line">&gt; desc t2;</span><br><span class="line">---</span><br><span class="line">name                string</span><br><span class="line">zhangsan            string</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>hiveconf :</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  æ˜¾ç¤ºå½“å‰æ•°æ®åº“åç§°</span></span><br><span class="line">[ap@cs2]~% hive --hiveconf hive.cli.print.current.db=<span class="literal">true</span>;</span><br><span class="line">hive (default)&gt; create database mydb;</span><br><span class="line">hive (default)&gt; use mydb;</span><br><span class="line">hive (mydb)&gt; </span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºè¡¨å¤´(å­—æ®µå)</span></span><br><span class="line">hive --hiveconf hive.cli.print.header=<span class="literal">true</span>;</span><br><span class="line">select * from t2;</span><br><span class="line">t2.namet2.zhangsan</span><br></pre></td></tr></table></figure></li></ul><h3 id="1-7-Hive-çš„è„šæœ¬æ‰§è¡Œ"><a href="#1-7-Hive-çš„è„šæœ¬æ‰§è¡Œ" class="headerlink" title="1.7 Hive çš„è„šæœ¬æ‰§è¡Œ"></a>1.7 Hive çš„è„šæœ¬æ‰§è¡Œ</h3><ul><li><strong>Hive -e â€œxx â€</strong><ul><li>e å°±æ˜¯ edit, åœ¨ç»ˆç«¯æ‰“å°è¾“å‡º</li></ul></li><li><strong>Hive -e â€œshow tablesâ€ &gt;&gt; a.txt</strong><ul><li>å¯ä»¥æŠŠæ‰§è¡Œç»“æœé‡å®šå‘åˆ°æ–‡ä»¶ä¸­</li></ul></li><li><strong>Hive -S -e â€œshow tablesâ€ &gt;&gt; a.txt</strong><ul><li>-S : silence å®‰é™çš„æ‰§è¡Œ</li></ul></li><li><strong>hive -f file</strong> <ul><li>hive -f hql ,  hql æ˜¯æ–‡ä»¶, æ‰§è¡Œæ–‡ä»¶</li><li>æ‰§è¡Œå®Œäº†ä¹‹å,  å°±ç¦»å¼€ hive å‘½ä»¤è¡Œ</li></ul></li><li><strong>hive -i /home/ap/hive-init.sql</strong> <ul><li>æ‰§è¡Œå®Œäº†,è¿˜åœ¨æ§åˆ¶å°, å¯ä»¥ç»§ç»­æ“ä½œ</li></ul></li><li><strong>hive&gt;source file</strong><ul><li>source + æ–‡ä»¶å  : ç›´æ¥æ‰§è¡Œå½“å‰ç›®å½•æ–‡ä»¶</li><li>source /home/ap/xx.sql;</li></ul></li></ul><h3 id="1-8-hiveä¸ä¾èµ–ç¯å¢ƒçš„äº¤äº’"><a href="#1-8-hiveä¸ä¾èµ–ç¯å¢ƒçš„äº¤äº’" class="headerlink" title="1.8 hiveä¸ä¾èµ–ç¯å¢ƒçš„äº¤äº’"></a>1.8 hiveä¸ä¾èµ–ç¯å¢ƒçš„äº¤äº’</h3><ul><li><strong>ä¸linuxäº¤äº’å‘½ä»¤ ï¼</strong><ul><li><code>!ls</code></li><li><code>!pwd</code></li></ul></li><li><strong>ä¸hdfsäº¤äº’å‘½ä»¤</strong><ul><li><code>dfs -ls /</code></li><li><code>dfs -mkdir /hive</code></li><li><code>hive (default)&gt; dfs -rm -r /user/hive/warehouse/t5;</code></li></ul></li><li><strong>beeline ä¸ linux &amp; hdfs äº¤äº’</strong><ul><li>!help æŸ¥çœ‹å¸®åŠ©</li></ul></li></ul><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-19-043653.png" alt="image-20180619123652339"></p><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-19-043558.png" alt="image-20180619123557944"></p><h3 id="1-9-Hive-çš„-JDBC-æ¨¡å¼"><a href="#1-9-Hive-çš„-JDBC-æ¨¡å¼" class="headerlink" title="1.9 Hive çš„ JDBC æ¨¡å¼"></a>1.9 Hive çš„ JDBC æ¨¡å¼</h3><ul><li><p>JAVA APIäº¤äº’æ‰§è¡Œæ–¹å¼ </p></li><li><p>hive è¿œç¨‹æœåŠ¡ (ç«¯å£å·1000  0) å¯åŠ¨æ–¹å¼</p><ul><li><code>hive --service hiveserver2</code></li><li><code>org.apache.hive.jdbc.HiveDriver</code></li></ul></li><li><p>åœ¨javaä»£ç ä¸­è°ƒç”¨hiveçš„JDBCå»ºç«‹è¿æ¥</p></li><li><p><strong>ç”¨ beeline è¿æ¥</strong></p><ul><li><p><strong>æ–¹å¼1: ç›´æ¥ç™»å½•</strong></p><ul><li>æ³¨æ„: è¿™é‡Œçš„<strong>cs2æ˜¯æŒ‡çš„æ•°æ®åº“æ‰€åœ¨çš„æœåŠ¡å™¨</strong>, å¦‚æœmysql å®‰è£…åœ¨ cs2ä¸Š, é‚£ä¹ˆä¸ç®¡åœ¨å“ªå°æœºå™¨ä¸Šç™»å½•beeline , éƒ½è¿™æ ·è¾“å…¥å°±è¡Œäº†</li></ul><p><code>beeline -u jdbc:hive2://cs2:10000 -n ap</code></p></li><li><p><strong>æ–¹å¼2: è¾“å…¥ç”¨æˆ·åå¯†ç ç™»å½•</strong></p><p><code>!connect jdbc:hive2://cs2:10000</code></p></li></ul></li><li><p><strong>beelineæ³¨æ„ç‚¹:</strong> </p><ul><li>ä½¿ç”¨ beeline è¿æ¥æ—¶, è²Œä¼¼æ— æ³•ä¸ Linux ç›®å½•äº¤äº’</li><li>å½“å‰ç›®å½•åœ¨<code>/home/ap/apps/apache-hive-2.3.2-bin/bin/</code>ä¸‹</li><li><strong>è¦ä¼ æ–‡ä»¶çš„è¯, è¦ä½¿ç”¨å…¨è·¯å¾„</strong></li></ul></li></ul><h3 id="1-10-SETå‘½ä»¤ä½¿ç”¨"><a href="#1-10-SETå‘½ä»¤ä½¿ç”¨" class="headerlink" title="1.10 SETå‘½ä»¤ä½¿ç”¨"></a>1.10 SETå‘½ä»¤ä½¿ç”¨</h3><ul><li>Hive æ§åˆ¶å°set å‘½ä»¤<ul><li>set;    set -v;  æ˜¾ç¤ºæ‰€æœ‰çš„ç¯å¢ƒå˜é‡</li><li><code>set hive.cli.print.current.db=true;</code></li><li><code>set hive.cli.print.header=true;</code> </li><li><code>set hive.metastore.warehouse.dir=/hive;</code></li></ul></li><li><strong>hiveå‚æ•°åˆå§‹åŒ–é…ç½®setå‘½ä»¤:</strong><ul><li><strong>~/.hiverc</strong><ul><li>åˆ›å»ºæ­¤æ–‡ä»¶, åœ¨æ­¤æ–‡ä»¶ä¸­é…ç½®åˆå§‹åŒ–å‘½ä»¤</li></ul></li><li>è¡¥å……ï¼š<br><strong>hiveå†å²æ“ä½œå‘½ä»¤é›†</strong><br><strong>~/.hivehistory</strong></li></ul></li></ul><p><br></p><h1 id="2-Hiveæ•°æ®ç±»å‹"><a href="#2-Hiveæ•°æ®ç±»å‹" class="headerlink" title="2.  Hiveæ•°æ®ç±»å‹"></a>2.  Hiveæ•°æ®ç±»å‹</h1><h3 id="2-1-åŸºæœ¬æ•°æ®ç±»å‹"><a href="#2-1-åŸºæœ¬æ•°æ®ç±»å‹" class="headerlink" title="2.1 åŸºæœ¬æ•°æ®ç±»å‹"></a>2.1 åŸºæœ¬æ•°æ®ç±»å‹</h3><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-13-163316.jpg" alt=""></p><h3 id="2-2-å¤åˆæ•°æ®ç±»å‹"><a href="#2-2-å¤åˆæ•°æ®ç±»å‹" class="headerlink" title="2.2 å¤åˆæ•°æ®ç±»å‹"></a>2.2 å¤åˆæ•°æ®ç±»å‹</h3><blockquote><p>åˆ›å»ºå­¦ç”Ÿè¡¨</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> student(</span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">INT</span>,</span><br><span class="line">    <span class="keyword">name</span> <span class="keyword">STRING</span>,</span><br><span class="line">    favors <span class="built_in">ARRAY</span>\&lt;<span class="keyword">STRING</span>&gt;,</span><br><span class="line">    scores <span class="keyword">MAP</span>&lt;<span class="keyword">STRING</span>, <span class="built_in">FLOAT</span>&gt;</span><br><span class="line">);</span><br></pre></td></tr></table></figure><table><thead><tr><th>é»˜è®¤åˆ†éš”ç¬¦</th><th>æè¿°</th><th>è¯­å¥</th></tr></thead><tbody><tr><td>\n</td><td>åˆ†éš”è¡Œ</td><td>LINES   TERMINATED BY â€˜\tâ€™</td></tr><tr><td>^A</td><td>åˆ†éš”å­—æ®µ(åˆ—)ï¼Œæ˜¾ç¤ºç¼–ç ä½¿ç”¨\001</td><td>FIELDS   TERMINATED BY â€˜\001â€™</td></tr><tr><td>^B</td><td>åˆ†éš”å¤åˆç±»å‹ä¸­çš„å…ƒç´ ï¼Œæ˜¾ç¤ºç¼–ç ä½¿ç”¨\002</td><td>COLLECTION   ITEMS TERMINATED BY â€˜\002â€™</td></tr><tr><td>^C</td><td>åˆ†éš”mapå…ƒç´ çš„keyå’Œvalueï¼Œæ˜¾ç¤ºç¼–ç ä½¿ç”¨\003</td><td>MAP   KEYS TERMINATED BY â€˜\003â€™</td></tr></tbody></table><h4 id="2-2-1-Struct-ä½¿ç”¨"><a href="#2-2-1-Struct-ä½¿ç”¨" class="headerlink" title="2.2.1.  Struct ä½¿ç”¨"></a>2.2.1.  Struct ä½¿ç”¨</h4><p><strong>Structså†…éƒ¨çš„æ•°æ®å¯ä»¥é€šè¿‡DOTï¼ˆ.ï¼‰æ¥å­˜å–</strong>ï¼Œä¾‹å¦‚ï¼Œè¡¨ä¸­ä¸€åˆ—cçš„ç±»å‹ä¸º<code>STRUCT{a INT; b INT}</code>ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡c.aæ¥è®¿é—®åŸŸa</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"># æ•°æ®</span><br><span class="line">1001,zhangsan:24</span><br><span class="line">1002,lisi:28</span><br><span class="line">1003,wangwu:25</span><br><span class="line"></span><br><span class="line"># 1.åˆ›å»ºè¡¨</span><br><span class="line">hive&gt; create table student_test(id INT, info struct&lt;name:STRING, age:INT&gt;)ROW FORMAT DELIMITED FIELDS TERMINATED BY ','COLLECTION ITEMS TERMINATED BY ':';</span><br><span class="line"></span><br><span class="line"># 2.åŠ è½½è¡¨</span><br><span class="line">hive&gt; load data local inpath "student_test" into table student_test;</span><br><span class="line"></span><br><span class="line"># 3.é¡ºä¾¿è®¾ç½® æ˜¾ç¤ºè¡¨å¤´,å’Œå½“å‰æ•°æ®åº“</span><br><span class="line">hive&gt; set hive.cli.print.header=true;</span><br><span class="line">hive&gt; set hive.cli.print.current.db=true;</span><br><span class="line"></span><br><span class="line"># 4. å±•ç¤ºæ‰€æœ‰çš„</span><br><span class="line">hive (default)&gt; select * from student_test;</span><br><span class="line"><span class="comment">---</span></span><br><span class="line">student_test.idstudent_test.info</span><br><span class="line">1001&#123;"name":"zhangsan","age":24&#125;</span><br><span class="line">1002&#123;"name":"lisi","age":28&#125;</span><br><span class="line">1003&#123;"name":"wangwu","age":25&#125;</span><br><span class="line"><span class="comment">---</span></span><br><span class="line"></span><br><span class="line"># Struct -ç»“æ„ä½“-ä½¿ç”¨ . </span><br><span class="line">hive (default)&gt; select id,info.name,info.age from student_test;</span><br><span class="line">idnameage</span><br><span class="line">1001zhangsan24</span><br><span class="line">1002lisi28</span><br><span class="line">1003wangwu25</span><br></pre></td></tr></table></figure><h4 id="2-2-2-Array-ä½¿ç”¨"><a href="#2-2-2-Array-ä½¿ç”¨" class="headerlink" title="2.2.2. Array ä½¿ç”¨"></a>2.2.2. Array ä½¿ç”¨</h4><p><strong>Arrayä¸­çš„æ•°æ®ä¸ºç›¸åŒç±»å‹</strong>ï¼Œä¾‹å¦‚ï¼Œå‡å¦‚array Aä¸­å…ƒç´ <code>[&#39;a&#39;,&#39;b&#39;,&#39;câ€™]</code>ï¼Œåˆ™A[1]çš„å€¼ä¸ºâ€™bâ€™</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># åŸå§‹æ•°æ®</span><br><span class="line">zhangsan,24:25:27:37</span><br><span class="line">lisi,28:39:23:43</span><br><span class="line">wangwu,25:23:02:54</span><br><span class="line"></span><br><span class="line"># åˆ›å»ºè¡¨</span><br><span class="line">hive (default)&gt; create table class_test(name string,student_id_list array&lt;int&gt;) row format delimited fields terminated by ',' collection items terminated by ':';</span><br><span class="line"></span><br><span class="line"># åŠ è½½è¡¨</span><br><span class="line">hive (default)&gt; load data local inpath "class_test" into table class_test;</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹è¡¨</span><br><span class="line">hive (default)&gt; select * from class_test;</span><br><span class="line">OK</span><br><span class="line">class_test.nameclass_test.student_id_list</span><br><span class="line">zhangsan[24,25,27,37]</span><br><span class="line">lisi[28,39,23,43]</span><br><span class="line">wangwu[25,23,2,54]</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹æ•°æ®ä¸­æŸä¸ªå…ƒç´ </span><br><span class="line">hive (default)&gt; select name, student_id_list[0] from class_test where name='zhangsan';</span><br><span class="line">OK</span><br><span class="line">name_c1</span><br><span class="line">zhangsan24</span><br></pre></td></tr></table></figure><h4 id="2-2-3-Map-ä½¿ç”¨"><a href="#2-2-3-Map-ä½¿ç”¨" class="headerlink" title="2.2.3. Map ä½¿ç”¨"></a>2.2.3. Map ä½¿ç”¨</h4><p>è®¿é—®æŒ‡å®šåŸŸå¯ä»¥é€šè¿‡[â€œæŒ‡å®šåŸŸåç§°â€]è¿›è¡Œï¼Œä¾‹å¦‚ï¼Œä¸€ä¸ªMap MåŒ…å«äº†ä¸€ä¸ªgroup-&gt;gidçš„kvå¯¹ï¼Œ<strong>gidçš„å€¼å¯ä»¥é€šè¿‡M[â€˜groupâ€™]æ¥è·å–</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"># åŸå§‹æ•°æ®</span><br><span class="line">1001job:80,team:60,person:70</span><br><span class="line">1002job:60,team:80,person:80</span><br><span class="line">1003job:90,team:70,person:100</span><br><span class="line"></span><br><span class="line"># åˆ›å»ºè¡¨</span><br><span class="line">hive (default)&gt; create table employee(id string,perf map&lt;string,int&gt;) row format delimited fields terminated by '\t' collection items terminated by ',' map keys terminated by ':';</span><br><span class="line"></span><br><span class="line"># å¯¼å…¥</span><br><span class="line">hive (default)&gt; load data local inpath "employee_data" into table employee;</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹</span><br><span class="line">hive (default)&gt; select * from employee;</span><br><span class="line"><span class="comment">---</span></span><br><span class="line">employee.idemployee.perf</span><br><span class="line">1001&#123;"job":80,"team":60,"person":70&#125;</span><br><span class="line">1002&#123;"job":60,"team":80,"person":80&#125;</span><br><span class="line">1003&#123;"job":90,"team":70,"person":100&#125;</span><br><span class="line">Time taken: 0.228 seconds, Fetched: 3 row(s)</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹å•ä¸ª</span><br><span class="line">hive (default)&gt; select id,perf['job'],perf['team'],perf['person'] from employee;</span><br><span class="line">OK</span><br><span class="line">id_c1_c2_c3</span><br><span class="line">1001806070</span><br><span class="line">1002608080</span><br><span class="line">10039070100</span><br><span class="line"></span><br><span class="line"># æ˜¾ç¤ºåˆ«å</span><br><span class="line">hive (default)&gt; select id,perf['job'] as job,perf['team'] as team,perf['person'] as person from employee;</span><br><span class="line">OK</span><br><span class="line">idjobteamperson</span><br><span class="line">1001806070</span><br><span class="line">1002608080</span><br><span class="line">10039070100</span><br></pre></td></tr></table></figure><p><br></p><h1 id="3-DDL-DML"><a href="#3-DDL-DML" class="headerlink" title="3. DDL , DML"></a>3. DDL , DML</h1><h2 id="3-1-DDL"><a href="#3-1-DDL" class="headerlink" title="3.1 DDL"></a>3.1 DDL</h2><h3 id="3-1-1-æ•°æ®åº“å®šä¹‰"><a href="#3-1-1-æ•°æ®åº“å®šä¹‰" class="headerlink" title="3.1.1  æ•°æ®åº“å®šä¹‰"></a>3.1.1  æ•°æ®åº“å®šä¹‰</h3><ul><li><p>é»˜è®¤æ•°æ®åº“â€defaultâ€</p></li><li><p>ä½¿ç”¨æŸä¸ªæ•°æ®åº“ <code>use &lt;æ•°æ®åº“å&gt;</code></p></li><li><p>åˆ›å»ºä¸€ä¸ªæ–°åº“</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span>  </span><br><span class="line">[<span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span>] mydb  </span><br><span class="line">[LOCATION] <span class="string">'/.......'</span>  </span><br><span class="line">[<span class="keyword">COMMENT</span>] <span class="string">'....â€™;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">hive&gt;SHOW DATABASES;</span></span><br><span class="line"><span class="string">hive&gt;DESCRIBE DATABASE [extended] mydb;</span></span><br><span class="line"><span class="string">hive&gt;DROP DATABASE [IF EXISTS] mydb [CASCADE];</span></span><br></pre></td></tr></table></figure></li><li><p>åˆ›å»º</p><ul><li><code>create database db1;</code></li></ul></li><li><p>åˆ é™¤</p><ul><li><code>drop database if exists db1;</code></li><li><strong>çº§è”åˆ é™¤</strong><ul><li><code>drop database if exists db1 cascade;</code></li></ul></li></ul></li></ul><h3 id="3-1-2-è¡¨å®šä¹‰-ä¿®æ”¹"><a href="#3-1-2-è¡¨å®šä¹‰-ä¿®æ”¹" class="headerlink" title="3.1.2  è¡¨å®šä¹‰/ä¿®æ”¹"></a>3.1.2  è¡¨å®šä¹‰/ä¿®æ”¹</h3><ul><li><p><strong>åˆ›å»ºè¡¨</strong></p><ul><li><p>hive&gt;CREATE TABLE IF NOT EXISTS t1(â€¦) </p><p>[COMMENT â€˜â€¦.â€™] </p><p>[LOCATION â€˜â€¦â€™] </p><ul><li><code>hive (default)&gt; create table t4(name string,age int) row format delimited fields terminated by &quot;\tâ€;</code></li></ul></li><li><p>hive&gt; SHOW TABLES in mydb;</p><ul><li><code>show tables in mydb â€˜â€™class*â€œ</code> : æŸ¥çœ‹ä»¥ mydb åº“ä¸­, ä»¥ class å¼€å¤´çš„è¡¨</li></ul></li><li><p><strong>hive&gt;CREATE TABLE t2 LIKE t1;</strong>   å¤åˆ¶è¡¨</p><ul><li><strong>åªä¼šå¤åˆ¶è¡¨ç»“æ„</strong></li><li><code>hive (default)&gt; create table t2 like t1;</code></li><li><code>hive (mydb)&gt; create table t3 like default.employee;</code><ul><li>å¤åˆ¶å…¶å®ƒåº“çš„è¡¨</li></ul></li></ul></li><li><p>hive&gt;DESCRIBE t2;</p><ul><li>desc t2;  # æ•ˆæœä¸€æ ·çš„</li><li><code>desc extended t1;</code>    # æŸ¥çœ‹æ›´è¯¦ç»†çš„è¡¨ä¿¡æ¯</li><li><strong><code>hive (default)&gt; desc formatted t1;</code>  # æ ¼å¼åŒ–æŸ¥çœ‹è¡¨çš„è¯¦ç»†ä¿¡æ¯</strong></li></ul></li><li><p>drop  table xxx;</p><ul><li>åˆ é™¤è¡¨</li></ul></li><li><p><strong>æŸ¥çœ‹å»ºè¡¨è¯­å¥</strong></p><ul><li><strong>show create table t_table;</strong></li></ul></li></ul></li><li><p><strong>ä¿®æ”¹è¡¨</strong></p><ul><li><strong>é‡å‘½åè¡¨</strong><ul><li><code>ALTER TABLE table_name RENAME TO new_table_name</code></li></ul></li><li><strong>å¢åŠ /åˆ é™¤ åˆ†åŒº</strong><ul><li><code>alter table student_p add partition(part=&#39;a&#39;) partition(part=&#39;b&#39;);</code><ul><li>ä¸¤ä¸ª partitionä¸­æ²¡æœ‰â€™,â€™</li></ul></li><li>alter table student drop partition(stat_data=â€˜ffffâ€™), partition(part=â€˜aâ€™),partiton(part=â€˜bâ€™);<ul><li>ä¸¤ä¸ª partitionä¸­æœ‰â€™,â€™</li></ul></li></ul></li><li><strong>å¢åŠ /æ›´æ–° åˆ—</strong><ul><li><code>ALTER TABLE table_name ADD|REPLACE COLUMNS (col_name data_type [COMMENT col_comment], ...)</code><ul><li><em>æ³¨ï¼šADD<strong>æ˜¯ä»£è¡¨æ–°å¢ä¸€å­—æ®µï¼Œå­—æ®µä½ç½®åœ¨æ‰€æœ‰åˆ—åé¢(partition</strong>åˆ—å‰)<strong>ï¼ŒREPLACE</strong>åˆ™æ˜¯è¡¨ç¤ºæ›¿æ¢è¡¨ä¸­æ‰€æœ‰å­—æ®µã€‚</em> </li><li><code>alter table student add  columns (name1 string);</code></li></ul></li><li><code>ALTER TABLE table_name CHANGE c_name new_c_name new_c_type [FIRST | AFTER c_name]</code></li></ul></li></ul></li></ul><h3 id="3-1-3-åˆ—å®šä¹‰"><a href="#3-1-3-åˆ—å®šä¹‰" class="headerlink" title="3.1.3 åˆ—å®šä¹‰"></a>3.1.3 åˆ—å®šä¹‰</h3><ul><li><p>ä¿®æ”¹åˆ—çš„åç§°ã€ç±»å‹ã€ä½ç½®ã€æ³¨é‡Š</p><ul><li><p><code>ALTER TABLE t3 CHANGE COLUMN old_name new_name String COMMENT &#39;...&#39; AFTER column2;</code></p></li><li><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># ä¿®æ”¹åˆ—å</span><br><span class="line">hive (default)&gt; alter table t1 change column name username string comment 'new name';</span><br><span class="line"># æŸ¥çœ‹è¡¨</span><br><span class="line">hive (default)&gt; desc t1;</span><br><span class="line"><span class="comment">---</span></span><br><span class="line">col_namedata_type<span class="keyword">comment</span></span><br><span class="line">username            <span class="keyword">string</span>              <span class="keyword">new</span> <span class="keyword">name</span></span><br><span class="line">age                 <span class="built_in">int</span></span><br><span class="line"><span class="comment">---</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>å¢åŠ åˆ—</p><ul><li><p><code>hive&gt; ALTER TABLE t3 ADD COLUMNS(gender int);</code></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># æŸ¥çœ‹è¡¨ç»“æ„</span><br><span class="line">hive (default)&gt; desc t3;</span><br><span class="line"><span class="comment">---</span></span><br><span class="line">col_namedata_type<span class="keyword">comment</span></span><br><span class="line"><span class="keyword">name</span>                <span class="keyword">string</span></span><br><span class="line"><span class="comment">---</span></span><br><span class="line"># æ·»åŠ åˆ—</span><br><span class="line">hive (<span class="keyword">default</span>)&gt; <span class="keyword">alter</span> <span class="keyword">table</span> t3 <span class="keyword">add</span> <span class="keyword">columns</span>(gender <span class="built_in">int</span>);</span><br><span class="line"><span class="comment">---</span></span><br><span class="line">hive (default)&gt; desc t3;</span><br><span class="line"><span class="comment">---</span></span><br><span class="line">col_namedata_type<span class="keyword">comment</span></span><br><span class="line"><span class="keyword">name</span>                <span class="keyword">string</span></span><br><span class="line">gender              <span class="built_in">int</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>åˆ é™¤åˆ—  replace </p><ul><li><strong>éå¸¸ä¸å»ºè®®ä½¿ç”¨</strong>, ä¼šé€ æˆæ•°æ®é”™ä¹±, ä¸€èˆ¬é‡‡å–é‡æ–°åˆ›å»ºä¸€å¼ è¡¨çš„æ–¹å¼.</li></ul></li></ul><h3 id="3-1-4-æ˜¾ç¤ºå‘½ä»¤"><a href="#3-1-4-æ˜¾ç¤ºå‘½ä»¤" class="headerlink" title="3.1.4 æ˜¾ç¤ºå‘½ä»¤"></a>3.1.4 æ˜¾ç¤ºå‘½ä»¤</h3><blockquote><p>show tables</p><p>show databases</p><p>show partitions</p><p>show functions</p><p>desc extended t_name;</p><p>desc formatted table_name;</p></blockquote><h2 id="3-2-DML"><a href="#3-2-DML" class="headerlink" title="3.2 DML"></a>3.2 DML</h2><h3 id="3-2-1-Load"><a href="#3-2-1-Load" class="headerlink" title="3.2.1 Load"></a>3.2.1 Load</h3><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-17-032955.gif" alt="*">  <strong>è¯­æ³•ç»“æ„</strong></p><p><code>LOAD DATA [LOCAL] INPATH &#39;filepath&#39; [OVERWRITE] INTO TABLE tablename [PARTITION (partcol1=val1, partcol2=val2 ...)]</code></p><p><strong>è¯´æ˜ï¼š</strong></p><ol><li>Load æ“ä½œåªæ˜¯å•çº¯çš„å¤åˆ¶/ç§»åŠ¨æ“ä½œï¼Œå°†æ•°æ®æ–‡ä»¶ç§»åŠ¨åˆ° Hive è¡¨å¯¹åº”çš„ä½ç½®ã€‚</li><li>filepathï¼š<ul><li>ç›¸å¯¹è·¯å¾„ï¼Œä¾‹å¦‚ï¼š<code>project/data1</code></li><li>ç»å¯¹è·¯å¾„ï¼Œä¾‹å¦‚ï¼š<code>/user/hive/project/data1</code></li><li>åŒ…å«æ¨¡å¼çš„å®Œæ•´ URIï¼Œä¾‹å¦‚ï¼š<ul><li><code>hdfs://namenode:9000/user/hive/project/data1</code></li></ul></li></ul></li><li><p>LOCALå…³é”®å­—</p><ul><li>å¦‚æœæŒ‡å®šäº† LOCALï¼Œ load å‘½ä»¤ä¼šå»æŸ¥æ‰¾æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­çš„ filepathã€‚</li><li>å¦‚æœæ²¡æœ‰æŒ‡å®š LOCAL å…³é”®å­—ï¼Œåˆ™æ ¹æ®inpathä¸­çš„uriæŸ¥æ‰¾æ–‡ä»¶</li></ul></li><li><p>OVERWRITE å…³é”®å­—</p><ul><li>å¦‚æœä½¿ç”¨äº† OVERWRITE å…³é”®å­—ï¼Œåˆ™ç›®æ ‡è¡¨ï¼ˆæˆ–è€…åˆ†åŒºï¼‰ä¸­çš„å†…å®¹ä¼šè¢«åˆ é™¤ï¼Œç„¶åå†å°† filepath æŒ‡å‘çš„æ–‡ä»¶/ç›®å½•ä¸­çš„å†…å®¹æ·»åŠ åˆ°è¡¨/åˆ†åŒºä¸­ã€‚ </li><li>å¦‚æœç›®æ ‡è¡¨ï¼ˆåˆ†åŒºï¼‰å·²ç»æœ‰ä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶ä¸”æ–‡ä»¶åå’Œ filepath ä¸­çš„æ–‡ä»¶åå†²çªï¼Œé‚£ä¹ˆç°æœ‰çš„æ–‡ä»¶ä¼šè¢«æ–°æ–‡ä»¶æ‰€æ›¿ä»£ã€‚ </li></ul></li></ol><h3 id="3-2-2-Insert"><a href="#3-2-2-Insert" class="headerlink" title="3.2.2 Insert"></a>3.2.2 Insert</h3><h4 id="è¯­æ³•ç»“æ„"><a href="#è¯­æ³•ç»“æ„" class="headerlink" title="è¯­æ³•ç»“æ„"></a><strong>è¯­æ³•ç»“æ„</strong></h4><ul><li><p>æ™®é€šæ’å…¥</p><ul><li>INSERT OVERWRITE TABLE tablename1 [PARTITION (partcol1=val1, partcol2=val2 â€¦)] select_statement1 FROM from_statement </li></ul></li><li><p>Multiple inserts:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">FROM from_statement </span><br><span class="line">[<span class="keyword">INSERT</span> OVERWRITE <span class="keyword">TABLE</span> tablename1 [<span class="keyword">PARTITION</span> (partcol1=val1, partcol2=val2 ...)] select_statement1 ]</span><br><span class="line">[<span class="keyword">INSERT</span> OVERWRITE <span class="keyword">TABLE</span> tablename2 [<span class="keyword">PARTITION</span> ...] select_statement2] ...</span><br><span class="line"></span><br><span class="line"># å¤šé‡æ’å…¥ä¸¾ä¾‹</span><br><span class="line"><span class="keyword">from</span> student</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">table</span> student_p <span class="keyword">partition</span>(part=<span class="string">'a'</span>)</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">where</span> <span class="keyword">id</span>&lt;<span class="number">95011</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">table</span> student_p <span class="keyword">partition</span>(part=<span class="string">'b'</span>)</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">where</span> <span class="keyword">id</span>&gt;<span class="number">95011</span>;</span><br></pre></td></tr></table></figure></li><li><p>Dynamic partition inserts:</p><ul><li>ä¸æŒ‡å®šåˆ†åŒºå­—æ®µ, æŒ‰ç…§ from è¡¨çš„åˆ†åŒºå­—æ®µæ’å…¥</li><li><code>INSERT OVERWRITE TABLE tablename PARTITION (partcol1, partcol2 ...) select_statement FROM from_statement</code></li></ul></li></ul><h4 id="å¯¼å‡ºè¡¨æ•°æ®"><a href="#å¯¼å‡ºè¡¨æ•°æ®" class="headerlink" title="å¯¼å‡ºè¡¨æ•°æ®"></a>å¯¼å‡ºè¡¨æ•°æ®</h4><p><strong>è¯­æ³•ç»“æ„</strong></p><ul><li><p><code>INSERT OVERWRITE [LOCAL] DIRECTORY directory1 SELECT ... FROM ...</code></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># å¯¼å‡ºåˆ°æœ¬åœ°</span><br><span class="line"><span class="keyword">insert</span> overwrite <span class="keyword">local</span> <span class="keyword">directory</span> <span class="string">'/home/ap/test/stucent1'</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> student1;</span><br><span class="line"><span class="comment">--------------------</span></span><br><span class="line">ä¾‹å­:</span><br><span class="line">'æŸ¥è¯¢å­¦ç”Ÿä¿¡æ¯ï¼ŒæŒ‰æ€§åˆ«åˆ†åŒºï¼Œåœ¨åˆ†åŒºå†…æŒ‰å¹´é¾„æœ‰åº'</span><br><span class="line">0: jdbc:hive2://cs2:10000&gt; set mapred.reduce.tasks=2;</span><br><span class="line">No rows affected (0.015 seconds)</span><br><span class="line">0: jdbc:hive2://cs2:10000&gt; insert overwrite local directory '/home/ap/ihiveout'</span><br><span class="line">. . . . . . . . . . . . .&gt; select * from student distribute by Sex sort by Sage;</span><br><span class="line"><span class="comment">--------------------</span></span><br><span class="line"></span><br><span class="line"># å¯¼å‡ºåˆ° HDFS (ä»…ä»…æ˜¯å°‘äº†ä¸€ä¸ª local)</span><br><span class="line"><span class="keyword">insert</span> overwrite <span class="keyword">directory</span> <span class="string">'/test/stucent1'</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> student1;</span><br></pre></td></tr></table></figure></li><li><p><strong>multiple inserts:</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FROM from_statement</span><br><span class="line"><span class="keyword">INSERT</span> OVERWRITE [<span class="keyword">LOCAL</span>] <span class="keyword">DIRECTORY</span> directory1 select_statement1</span><br><span class="line">[<span class="keyword">INSERT</span> OVERWRITE [<span class="keyword">LOCAL</span>] <span class="keyword">DIRECTORY</span> directory2 select_statement2] ...</span><br></pre></td></tr></table></figure></li></ul><h1 id="4-Hiveçš„æ•°æ®æ¨¡å‹"><a href="#4-Hiveçš„æ•°æ®æ¨¡å‹" class="headerlink" title="4. Hiveçš„æ•°æ®æ¨¡å‹"></a>4. Hiveçš„æ•°æ®æ¨¡å‹</h1><h3 id="4-1-ç®¡ç†è¡¨-åˆç§°ä¸ºå†…éƒ¨è¡¨-å—æ§è¡¨"><a href="#4-1-ç®¡ç†è¡¨-åˆç§°ä¸ºå†…éƒ¨è¡¨-å—æ§è¡¨" class="headerlink" title="4.1 ç®¡ç†è¡¨ - åˆç§°ä¸ºå†…éƒ¨è¡¨, å—æ§è¡¨"></a>4.1 ç®¡ç†è¡¨ - åˆç§°ä¸ºå†…éƒ¨è¡¨, å—æ§è¡¨</h3><h4 id="åŸºæœ¬æ“ä½œ"><a href="#åŸºæœ¬æ“ä½œ" class="headerlink" title="åŸºæœ¬æ“ä½œ"></a><strong>åŸºæœ¬æ“ä½œ</strong></h4><ul><li>åˆ›å»ºæ•°æ®æ–‡ä»¶inner_table.dat</li><li>åˆ›å»ºè¡¨<ul><li><code>hive&gt;create table inner_table (key string);</code></li></ul></li><li><strong>åŠ è½½æ•°æ®</strong><ul><li><strong>åŠ è½½æœ¬åœ°æ•°æ®</strong><ul><li><code>hive&gt;load data local inpath &#39;/root/inner_table.dat&#39; into table inner_table;</code></li></ul></li><li><strong>åŠ è½½HDFS ä¸Šæ•°æ®</strong><ul><li><code>hive&gt;load data inpath â€˜xxxâ€™ into table xxx;</code></li></ul></li><li><strong>åŒºåˆ«</strong><ul><li>åŠ è½½ hdfs ä¸Šçš„æ•°æ®æ²¡æœ‰ <strong>local</strong></li><li><strong>åŠ è½½æœ¬åœ°æ•°æ®æ˜¯ copy ä¸€ä»½, åŠ è½½ hdfs ä¸Šçš„æ•°æ®æ˜¯ç›´æ¥ç§»åŠ¨æ•°æ®åˆ°åŠ è½½çš„è¡¨ç›®å½•ä¸‹â€“ mv</strong></li></ul></li></ul></li><li>æŸ¥çœ‹æ•°æ®<ul><li><code>select * from inner_table</code></li><li><code>select count(*) from inner_table</code></li></ul></li><li><strong>åˆ é™¤è¡¨ <code>drop table inner_table</code></strong></li><li><strong>æ¸…ç©ºè¡¨ <code>truncate table table_name;</code></strong> </li><li><strong>æ³¨æ„: </strong><ul><li><strong>å¦‚æœåˆ›å»ºè¡¨çš„æ—¶å€™, åªæŒ‡å®šäº†ç›®å½•, æ²¡æœ‰æŒ‡å®šè¡¨å, åˆ é™¤è¡¨çš„æ—¶å€™, ä¼šæŠŠè¯¥ç›®å½•ä¸‹çš„æ‰€æœ‰è¡¨å…¨éƒ¨åˆ æ‰</strong></li><li><code>hive (mydb)&gt; create table t2(id int)location &#39;/home/t2&#39;;</code></li></ul></li></ul><h4 id="å†…éƒ¨è¡¨è§£é‡Š"><a href="#å†…éƒ¨è¡¨è§£é‡Š" class="headerlink" title="å†…éƒ¨è¡¨è§£é‡Š"></a><strong>å†…éƒ¨è¡¨è§£é‡Š</strong></h4><ul><li>ç®¡ç†è¡¨ï¼Œä¹Ÿç§°ä½œ<strong>å†…éƒ¨è¡¨</strong>,å—æ§è¡¨<ul><li>æ‰€æœ‰çš„ Table æ•°æ®ï¼ˆä¸åŒ…æ‹¬ External Tableï¼‰<strong>éƒ½ä¿å­˜åœ¨warehouseè¿™ä¸ªç›®å½•ä¸­ã€‚</strong></li><li><strong>åˆ é™¤è¡¨æ—¶ï¼Œå…ƒæ•°æ®ä¸æ•°æ®éƒ½ä¼šè¢«åˆ é™¤</strong></li><li>åˆ›å»ºè¿‡ç¨‹å’Œæ•°æ®åŠ è½½è¿‡ç¨‹ï¼ˆè¿™ä¸¤ä¸ªè¿‡ç¨‹å¯ä»¥åœ¨åŒä¸€ä¸ªè¯­å¥ä¸­å®Œæˆï¼‰ï¼Œ<strong>åœ¨åŠ è½½æ•°æ®çš„è¿‡ç¨‹ä¸­ï¼Œå®é™…æ•°æ®ä¼šè¢«ç§»åŠ¨åˆ°æ•°æ®ä»“åº“ç›®å½•ä¸­</strong>ï¼›ä¹‹å<strong>å¯¹æ•°æ®å¯¹è®¿é—®</strong>å°†ä¼š<strong>ç›´æ¥åœ¨æ•°æ®ä»“åº“ç›®å½•ä¸­</strong>å®Œæˆã€‚åˆ é™¤è¡¨æ—¶ï¼Œè¡¨ä¸­çš„æ•°æ®å’Œå…ƒæ•°æ®å°†ä¼šè¢«åŒæ—¶åˆ é™¤</li></ul></li></ul><h4 id="å†…éƒ¨è¡¨è½¬ä¸ºå¤–éƒ¨è¡¨-å¤–éƒ¨è¡¨è½¬ä¸ºå†…éƒ¨è¡¨"><a href="#å†…éƒ¨è¡¨è½¬ä¸ºå¤–éƒ¨è¡¨-å¤–éƒ¨è¡¨è½¬ä¸ºå†…éƒ¨è¡¨" class="headerlink" title="å†…éƒ¨è¡¨è½¬ä¸ºå¤–éƒ¨è¡¨,  å¤–éƒ¨è¡¨è½¬ä¸ºå†…éƒ¨è¡¨"></a><strong>å†…éƒ¨è¡¨è½¬ä¸ºå¤–éƒ¨è¡¨,  å¤–éƒ¨è¡¨è½¬ä¸ºå†…éƒ¨è¡¨</strong></h4><ul><li><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">hive (mydb)&gt; create table t1(id int);</span><br><span class="line"></span><br><span class="line"># manage_table è½¬æ¢ä¸º å¤–éƒ¨è¡¨ external_table </span><br><span class="line">## æ³¨æ„: ä¿®æ”¹ä¸ºå¤–éƒ¨è¡¨æ—¶, åé¢2ä¸ªéƒ½è¦å¤§å†™</span><br><span class="line">hive (mydb)&gt; alter table t1 set tblproperties('EXTERNAL'='TRUE');</span><br><span class="line">## ä¿®æ”¹ä¸ºå†…éƒ¨è¡¨</span><br><span class="line">hive (mydb)&gt; alter table t1 set tblproperties('EXTERNAL'='FALSE');</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹t1è¯¦ç»†ä¿¡æ¯</span><br><span class="line">desc formatted t1;</span><br><span class="line"><span class="comment">---</span></span><br><span class="line">Location:           hdfs://cs1:9000/user/hive/warehouse/mydb.db/t1</span><br><span class="line">Table Type:         EXTERNAL_TABLE</span><br><span class="line"><span class="comment">-- </span></span><br><span class="line"></span><br><span class="line"># åˆ é™¤t1</span><br><span class="line">hive (mydb)&gt; drop table t1;</span><br><span class="line"># æ­¤æ—¶å†æŸ¥çœ‹, å·²ç»æ²¡äº†</span><br><span class="line">hive (mydb)&gt; show tables;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line"></span><br><span class="line"># ä½†æ˜¯æŸ¥çœ‹hdfs è·¯å¾„ä¼šå‘ç°è¿˜åœ¨, å› ä¸ºæ­¤è¡¨ç°åœ¨å·²ç»æ˜¯å¤–éƒ¨è¡¨, åˆ é™¤ä¸ä¼šåˆ é™¤æ•°æ®</span><br><span class="line">dfs -ls /user/hive/warehouse/mydb.db/t1</span><br><span class="line"></span><br><span class="line"># å¦‚æœæ­¤æ—¶å†åˆ›å»ºä¸€ä¸ªæ–°è¡¨ t1, è¡¨ç»“æ„ä¸€æ ·, åˆ™æ•°æ®ä¼šè‡ªåŠ¨åŠ è½½</span><br></pre></td></tr></table></figure></li></ul><h3 id="4-2-â€»-å¤–éƒ¨è¡¨"><a href="#4-2-â€»-å¤–éƒ¨è¡¨" class="headerlink" title="4.2 â€» å¤–éƒ¨è¡¨"></a>4.2 â€» å¤–éƒ¨è¡¨</h3><h4 id="4-2-1åŸºæœ¬æ“ä½œ"><a href="#4-2-1åŸºæœ¬æ“ä½œ" class="headerlink" title="4.2.1åŸºæœ¬æ“ä½œ"></a><strong>4.2.1åŸºæœ¬æ“ä½œ</strong></h4><ul><li>åˆ›å»ºæ•°æ®æ–‡ä»¶external_table.dat</li><li>åˆ›å»ºè¡¨<ul><li><code>hive&gt;create external table external_table1 (key string) ROW FORMAT DELIMITED FIELDS TERMINATED BY &#39;\t&#39; location &#39;/home/externalâ€™;</code></li></ul></li><li>åœ¨HDFSåˆ›å»ºç›®å½•/home/external<ul><li><code>#hadoop fs -put /home/external_table.dat /home/external</code></li><li>åœ¨å·¥ä½œä¸­, ä¸€èˆ¬éƒ½è¿™æ ·ä½¿ç”¨, æŠŠæ•°æ®ä¸Šä¼ åˆ° hdfs ä¸­</li></ul></li><li>åŠ è½½æ•°æ®<ul><li><code>LOAD DATA  &#39;/home/external_table1.dat&#39; INTO TABLE external_table1;</code></li></ul></li><li>æŸ¥çœ‹æ•°æ®<ul><li><code>select * from external_table</code></li><li><code>select count(*) from external_table</code></li></ul></li><li>åˆ é™¤è¡¨ <ul><li><code>drop table external_table</code></li></ul></li></ul><h4 id="4-2-2-å¤–éƒ¨è¡¨è§£é‡Š"><a href="#4-2-2-å¤–éƒ¨è¡¨è§£é‡Š" class="headerlink" title="4.2.2 å¤–éƒ¨è¡¨è§£é‡Š"></a><strong>4.2.2 å¤–éƒ¨è¡¨è§£é‡Š</strong></h4><ul><li>åŒ…å«External çš„è¡¨å«å¤–éƒ¨è¡¨<ul><li>åˆ é™¤å¤–éƒ¨è¡¨åªåˆ é™¤metastoreçš„å…ƒæ•°æ®ï¼Œä¸åˆ é™¤hdfsä¸­çš„è¡¨æ•°æ®</li><li>å¤–éƒ¨è¡¨ åªæœ‰ä¸€ä¸ªè¿‡ç¨‹ï¼ŒåŠ è½½æ•°æ®å’Œåˆ›å»ºè¡¨åŒæ—¶å®Œæˆï¼Œå¹¶ä¸ä¼šç§»åŠ¨åˆ°æ•°æ®ä»“åº“ç›®å½•ä¸­ï¼Œåªæ˜¯ä¸å¤–éƒ¨æ•°æ®å»ºç«‹ä¸€ä¸ªé“¾æ¥ã€‚å½“åˆ é™¤ä¸€ä¸ª å¤–éƒ¨è¡¨ æ—¶ï¼Œä»…åˆ é™¤è¯¥é“¾æ¥</li><li>æŒ‡å‘å·²ç»åœ¨ HDFS ä¸­å­˜åœ¨çš„æ•°æ®ï¼Œå¯ä»¥åˆ›å»º Partition</li><li>å®ƒå’Œ å†…éƒ¨è¡¨ åœ¨å…ƒæ•°æ®çš„ç»„ç»‡ä¸Šæ˜¯ç›¸åŒçš„ï¼Œè€Œå®é™…æ•°æ®çš„å­˜å‚¨åˆ™æœ‰è¾ƒå¤§çš„å·®å¼‚</li></ul></li></ul><h4 id="4-2-3-å¤–éƒ¨è¡¨è¯­æ³•"><a href="#4-2-3-å¤–éƒ¨è¡¨è¯­æ³•" class="headerlink" title="4.2.3 å¤–éƒ¨è¡¨è¯­æ³•"></a>4.2.3 å¤–éƒ¨è¡¨è¯­æ³•</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">EXTERNAL</span> <span class="keyword">TABLE</span> page_view</span><br><span class="line">( viewTime <span class="built_in">INT</span>, </span><br><span class="line">  userid <span class="built_in">BIGINT</span>,</span><br><span class="line">  page_url <span class="keyword">STRING</span>, </span><br><span class="line"> referrer_url <span class="keyword">STRING</span>, </span><br><span class="line">  ip <span class="keyword">STRING</span> <span class="keyword">COMMENT</span> <span class="string">'IP Address of the User'</span>,</span><br><span class="line">  country <span class="keyword">STRING</span> <span class="keyword">COMMENT</span> <span class="string">'country of originationâ€˜</span></span><br><span class="line"><span class="string">)</span></span><br><span class="line"><span class="string">    COMMENT '</span>This <span class="keyword">is</span> the staging page <span class="keyword">view</span> <span class="keyword">table</span><span class="string">'</span></span><br><span class="line"><span class="string">    ROW FORMAT DELIMITED FIELDS TERMINATED BY '</span>\t<span class="string">' LINES TERMINATED BY '</span>\n<span class="string">'</span></span><br><span class="line"><span class="string">    STORED AS TEXTFILE</span></span><br><span class="line"><span class="string">    LOCATION '</span>hdfs://centos:<span class="number">9000</span>/<span class="keyword">user</span>/<span class="keyword">data</span>/staging/page_view<span class="string">';</span></span><br></pre></td></tr></table></figure><h4 id="4-2-4å¤–éƒ¨è¡¨æ³¨æ„ç‚¹"><a href="#4-2-4å¤–éƒ¨è¡¨æ³¨æ„ç‚¹" class="headerlink" title="4.2.4å¤–éƒ¨è¡¨æ³¨æ„ç‚¹:"></a>4.2.4å¤–éƒ¨è¡¨æ³¨æ„ç‚¹:</h4><ul><li><p>å…ˆåˆ›å»ºå¤–éƒ¨è¡¨/å†…éƒ¨è¡¨, è¡¨åä¸º<code>t3</code>, å†å¾€<code>t3</code>ä¼ å¯¹åº”å­—æ®µçš„æ•°æ®, å°±å¯ä»¥ç›´æ¥ select æ•°æ®äº†</p></li><li><p><u>åˆ é™¤å¤–éƒ¨è¡¨ä¹‹å, åŸæœ¬æ•°æ®ä¸ä¼šåˆ é™¤</u>, æ­¤æ—¶<strong>åœ¨ç›¸åŒçš„çˆ¶è·¯å¾„</strong>åˆ›å»ºä¸è¢«åˆ é™¤è¡¨<strong>å­—æ®µç›¸åŒ&amp;åç§°ç›¸åŒ</strong>çš„<strong>å†…éƒ¨/å¤–éƒ¨è¡¨</strong>, æ•°æ®<strong>ä¹Ÿä¼šç›´æ¥åŠ è½½</strong></p></li><li><p><strong>å†çœ‹ä¸€ä¸ªæ“ä½œ</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># åœ¨ mydb.db åº“ä¸‹åˆ›å»ºä¸€ä¸ªå¤–éƒ¨è¡¨ t5, æŒ‡å®šè·¯å¾„ä¸º '/external/t5'</span><br><span class="line"># æ­¤æ—¶åœ¨ mydb.db åº“çš„è·¯å¾„ä¸‹æ˜¯ä¸å­˜åœ¨ t5è¡¨çš„, è€Œæ˜¯å­˜åœ¨ '/external/t5' ä¸­</span><br><span class="line"># ä½†æ˜¯ä½¿ç”¨ 'show tables' æ˜¯å­˜åœ¨ t5 çš„</span><br><span class="line">hive (mydb)&gt; create external table t5(id int) location '/external/t5';</span><br><span class="line"># å¾€æ­¤ç›®å½•ä¼ æ•°æ®, æ³¨æ„: æ­¤æ—¶ä¼ è¿‡å», intdata æ•°æ®å­˜åœ¨ t5ç›®å½•ä¸‹</span><br><span class="line">[ap@cs2]~% hadoop fs -put intdata /external/t5</span><br><span class="line">[ap@cs2]~% hadoop fs -put intdata /external/t5/i2</span><br><span class="line"># ç»§ç»­ä¼ æ•°æ®, æŸ¥è¯¢çš„æ—¶å€™, å°±æ˜¯ä¼ çš„å…¨éƒ¨æ•°æ®'ç›¸å½“äºæ‰€æœ‰çš„æ•°æ®éƒ½åœ¨ t5è¡¨ä¸­'</span><br><span class="line">[ap@cs2]~% hadoop fs -put intdata /external/t5</span><br><span class="line"># æ³¨æ„: å¦‚æœä¼ åˆ° t5 ç›®å½•ä¸‹, æ²¡æœ‰æŒ‡å®šæ•°æ®æ–‡ä»¶åçš„è¯, ä¼šé»˜è®¤é‡‡ç”¨æ•°æ®çš„åç§°æ–‡ä»¶.</span><br></pre></td></tr></table></figure></li></ul><h3 id="4-3-â€»-åˆ†åŒºè¡¨"><a href="#4-3-â€»-åˆ†åŒºè¡¨" class="headerlink" title="4.3  â€» åˆ†åŒºè¡¨"></a>4.3  â€» åˆ†åŒºè¡¨</h3><h4 id="4-3-1-åŸºæœ¬æ¦‚å¿µå’Œæ“ä½œ"><a href="#4-3-1-åŸºæœ¬æ¦‚å¿µå’Œæ“ä½œ" class="headerlink" title="4.3.1 åŸºæœ¬æ¦‚å¿µå’Œæ“ä½œ"></a>4.3.1 åŸºæœ¬æ¦‚å¿µå’Œæ“ä½œ</h4><ul><li>åˆ†åŒºå¯ä»¥ç†è§£ä¸ºåˆ†ç±»ï¼Œé€šè¿‡åˆ†ç±»æŠŠä¸åŒç±»å‹çš„æ•°æ®æ”¾åˆ°ä¸åŒçš„ç›®å½•ä¸‹ã€‚</li><li>åˆ†ç±»çš„æ ‡å‡†å°±æ˜¯åˆ†åŒºå­—æ®µï¼Œå¯ä»¥ä¸€ä¸ªï¼Œä¹Ÿå¯ä»¥å¤šä¸ªã€‚</li><li>åˆ†åŒºè¡¨çš„æ„ä¹‰åœ¨äºä¼˜åŒ–æŸ¥è¯¢ã€‚æŸ¥è¯¢æ—¶å°½é‡åˆ©ç”¨åˆ†åŒºå­—æ®µã€‚å¦‚æœä¸ä½¿ç”¨åˆ†åŒºå­—æ®µï¼Œå°±ä¼šå…¨éƒ¨æ‰«æã€‚</li></ul><blockquote><p><strong>åˆ›å»ºåˆ†åŒºè¡¨, æŒ‡å®šåˆ†åŒºå­—æ®µ</strong></p><p><code>hive&gt;CREATE TABLE t3(...) PARTITIONED BY (province string);</code></p><ul><li>åˆ›å»ºè¡¨çš„æ—¶å€™, æŒ‡å®šåˆ†åŒºå­—æ®µ key<code>province</code></li></ul><p><strong>ä¸ºåˆ†åŒºå­—æ®µæ·»åŠ ä¸€ä¸ªå€¼</strong></p><p><code>hive&gt;ALTER TABLE t3 ADD [IF NOT EXISTS] PARTITION(...) LOCATION &#39;...â€™;</code></p><ul><li><code>alter table t3 add if not exists partition(province=&#39;hubei&#39;) partition(province=&#39;shanghai&#39;);</code></li><li><code>alter table t3 add if not exists partition(province=&#39;jiangsu&#39;);</code></li><li>å¯ä¸ºæ­¤åˆ†åŒºå­—æ®µæ·»åŠ å¤šä¸ªå€¼,  ä¸º province æ·»åŠ  hubei, hunanâ€¦.</li></ul><p><strong>æŸ¥çœ‹è¡¨çš„åˆ†åŒºå­—æ®µ&amp;å€¼</strong></p><p><code>hive&gt;SHOW PARTITIONS t3 [partition (province=&#39;beijing&#39;)];</code></p><p><strong>åˆ é™¤åˆ†åŒº</strong></p><p><code>hive&gt;ALTER TABLE t3 DROP PARTITION(province=â€˜beijingâ€™.);</code></p><ul><li>è¿™é‡Œæ˜¯åˆ é™¤åŒ—äº¬çš„åˆ†åŒº (å¦‚æœæ˜¯å†…éƒ¨è¡¨, ä¼šè¿æ•°æ®ä¸€èµ·åˆ é™¤)</li></ul><p><strong>è®¾ç½®è¡¨ä¸èƒ½è¢«åˆ é™¤/æŸ¥è¯¢</strong>  â€”â€”â€“ è¿™é‡ŒæŠ¥è¯­æ³•é”™è¯¯, :TODO</p><ul><li>é˜²æ­¢åˆ†åŒºè¢«åˆ é™¤:<code>alter table student_p partition (part=&#39;aa&#39;) enable no_drop;</code></li><li>é˜²æ­¢åˆ†åŒºè¢«æŸ¥è¯¢:<code>alter table student_p partition (part=&#39;aa&#39;) enable offline;</code></li><li>enable å’Œ disable æ˜¯åå‘æ“ä½œ</li></ul><p><strong>å…¶å®ƒä¸€äº›ç›¸å…³å‘½ä»¤</strong></p><p>SHOW TABLES; # æŸ¥çœ‹æ‰€æœ‰çš„è¡¨</p><p>SHOW TABLES â€˜<em>TMP</em>â€˜; #æ”¯æŒæ¨¡ç³ŠæŸ¥è¯¢</p><p><code>SHOW PARTITIONS TMP_TABLE;</code> #æŸ¥çœ‹è¡¨æœ‰å“ªäº›åˆ†åŒº</p><p>DESC TMP_TABLE; #æŸ¥çœ‹è¡¨ç»“æ„</p></blockquote><h4 id="4-3-2-åˆ›å»ºåˆ†åŒºè¡¨å®Œæ•´è¯­æ³•"><a href="#4-3-2-åˆ›å»ºåˆ†åŒºè¡¨å®Œæ•´è¯­æ³•" class="headerlink" title="4.3.2 åˆ›å»ºåˆ†åŒºè¡¨å®Œæ•´è¯­æ³•"></a>4.3.2 åˆ›å»ºåˆ†åŒºè¡¨å®Œæ•´è¯­æ³•</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> tmp_table #è¡¨å</span><br><span class="line">(</span><br><span class="line">title   <span class="keyword">string</span>, # å­—æ®µåç§° å­—æ®µç±»å‹</span><br><span class="line">minimum_bid     <span class="keyword">double</span>,</span><br><span class="line">quantity        <span class="built_in">bigint</span>,</span><br><span class="line">have_invoice    <span class="built_in">bigint</span></span><br><span class="line">)<span class="keyword">COMMENT</span> <span class="string">'æ³¨é‡Šï¼šXXX'</span> #è¡¨æ³¨é‡Š</span><br><span class="line"> PARTITIONED <span class="keyword">BY</span>(pt <span class="keyword">STRING</span>) #åˆ†åŒºè¡¨å­—æ®µï¼ˆå¦‚æœä½ æ–‡ä»¶éå¸¸ä¹‹å¤§çš„è¯ï¼Œé‡‡ç”¨åˆ†åŒºè¡¨å¯ä»¥å¿«è¿‡æ»¤å‡ºæŒ‰åˆ†åŒºå­—æ®µåˆ’åˆ†çš„æ•°æ®ï¼‰</span><br><span class="line"> <span class="keyword">ROW</span> <span class="keyword">FORMAT</span> <span class="keyword">DELIMITED</span> </span><br><span class="line">   <span class="keyword">FIELDS</span> <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">'\001'</span>   # å­—æ®µæ˜¯ç”¨ä»€ä¹ˆåˆ†å‰²å¼€çš„</span><br><span class="line">STORED AS SEQUENCEFILE; #ç”¨å“ªç§æ–¹å¼å­˜å‚¨æ•°æ®ï¼ŒSEQUENCEFILEæ˜¯hadoopè‡ªå¸¦çš„æ–‡ä»¶å‹ç¼©æ ¼å¼</span><br></pre></td></tr></table></figure><h4 id="4-3-3-åˆ†åŒºè¡¨æ³¨æ„ç‚¹-é”™è¯¯ç‚¹"><a href="#4-3-3-åˆ†åŒºè¡¨æ³¨æ„ç‚¹-é”™è¯¯ç‚¹" class="headerlink" title="4.3.3 åˆ†åŒºè¡¨æ³¨æ„ç‚¹(é”™è¯¯ç‚¹)"></a>4.3.3 åˆ†åŒºè¡¨æ³¨æ„ç‚¹(é”™è¯¯ç‚¹)</h4><ul><li><p><strong>1) åˆ†åŒºè¡¨åœ¨ load æ•°æ®çš„æ—¶å€™, å¾—æŒ‡å®šåˆ†åŒº, å¦åˆ™ä¼šæŠ¥é”™</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># é”™è¯¯1: åˆ†åŒºè¡¨åœ¨ load æ•°æ®çš„æ—¶å€™, å¾—æŒ‡å®šåˆ†åŒº</span><br><span class="line">hive (mydb)&gt; load data local inpath '~/ihivedata/intdata' into table t6;</span><br><span class="line">FAILED: SemanticException [Error 10062]: Need to specify partition columns because the destination table is partitioned</span><br><span class="line"></span><br><span class="line"># é”™è¯¯2: å¯¼å…¥æœ¬åœ°æ•°æ®çš„æ—¶å€™, 'path'æ˜¯ä»å½“å‰æ‰€åœ¨è·¯å¾„å¼€å§‹çš„</span><br><span class="line">hive (mydb)&gt; load data local inpath '~/ihivedata/intdata' into table t6 partition(class='job1');</span><br><span class="line">FAILED: SemanticException Line 1:23 Invalid path ''&lt;sub&gt;/ihivedata/intdata'': No files matching path file:/home/ap/&lt;/sub&gt;/ihivedata/intdata</span><br><span class="line"></span><br><span class="line"># è¿™é‡Œå°±æ­£ç¡®äº†</span><br><span class="line">hive (mydb)&gt; load data local inpath 'ihivedata/intdata' into table t6 partition(class='job1');</span><br><span class="line">Loading data to table mydb.t6 partition (class=job1)</span><br><span class="line">OK</span><br></pre></td></tr></table></figure><ul><li><p><strong>æœ¬è´¨åŸå› :</strong> </p><ul><li><strong>åˆ†åŒºè¡¨çš„åˆ†åŒº, å°±æ˜¯åœ¨ hdfs ä¸Š, åŸè¡¨çš„æ–‡ä»¶å¤¹ä¸‹é¢åˆ›å»ºäº†ä¸€ä¸ªå­æ–‡ä»¶å¤¹, æ–‡ä»¶å¤¹åå°±æ˜¯åˆ†åŒºå.</strong></li></ul><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-14-113618.png" alt="image-20180614193618027"></p><ul><li><strong>ä»æœ¬åœ° load æ•°æ®:</strong> <code>hive (mydb)&gt; load data local inpath &#39;ihivedata/intdata&#39; into table t6 partition(class=&#39;job1&#39;);</code></li><li><strong>load æ•°æ®æŒ‡å®šåˆ†åŒºä¹‹å, ä¼šç›´æ¥ load åˆ°æ•°æ®æ–‡ä»¶å¤¹é‡Œé¢</strong></li></ul><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-14-113550.png" alt="image-20180614193549709"></p></li><li><p><strong>2) æ²¡æœ‰æ·»åŠ åˆ†åŒºæ—¶, ç›´æ¥å¾€ä¸å­˜åœ¨çš„åˆ†åŒºå¯¼å…¥æ•°æ®, åˆ†åŒºä¼šè‡ªåŠ¨åˆ›å»º</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># ç›´æ¥å¾€ä¸å­˜åœ¨çš„åˆ†åŒºloadæ•°æ®, åˆ†åŒºä¼šè‡ªåŠ¨åˆ›å»º</span><br><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> <span class="keyword">local</span> inpath <span class="string">'ihivedata/intdata'</span> <span class="keyword">into</span> <span class="keyword">table</span> t6 <span class="keyword">partition</span>(<span class="keyword">class</span>=<span class="string">'job110'</span>);</span><br></pre></td></tr></table></figure></li></ul></li></ul><ul><li><p><strong>3) æ‰‹åŠ¨åœ¨è¡¨ä¸­åˆ›å»ºåˆ†åŒº(æ–‡ä»¶å¤¹), å¹¶ç›´æ¥å‘æ­¤æ–‡ä»¶å¤¹ä¸­å¯¼å…¥æ•°æ®</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"># ç›´æ¥åˆ›å»ºç›®å½•</span><br><span class="line">hive (mydb)&gt; dfs -mkdir /user/hive/warehouse/mydb.db/t6/class=job120;</span><br><span class="line"></span><br><span class="line"># ç›´æ¥ä» hadoop ç«¯ä¼ æ•°æ®</span><br><span class="line">hadoop fs -put ihivedata/intdata /user/hive/warehouse/mydb.db/t6/class=job120</span><br><span class="line"></span><br><span class="line"># æ­¤æ—¶å† show partitions t6; ä¼šå‘ç°å¹¶æ²¡æœ‰æ­¤åˆ†åŒº</span><br><span class="line"><span class="comment">---</span></span><br><span class="line">partition</span><br><span class="line">class=job1</span><br><span class="line">class=job110</span><br><span class="line">class=job2</span><br><span class="line">class=job3</span><br><span class="line">class=job4</span><br><span class="line"></span><br><span class="line"># æ­¤æ—¶å°±éœ€è¦æ‰‹åŠ¨'æ¿€æ´»'æ­¤åˆ†åŒº, åŠ å…¥äº†å°±æœ‰äº†</span><br><span class="line">hive (mydb)&gt; alter table t6 add partition(class='job120');</span><br><span class="line"><span class="comment">---</span></span><br><span class="line">hive (mydb)&gt; show partitions t6;</span><br><span class="line"><span class="comment">---</span></span><br><span class="line">partition</span><br><span class="line">class=job1</span><br><span class="line">class=job110</span><br><span class="line">class=job120</span><br><span class="line">class=job2</span><br><span class="line">class=job3</span><br><span class="line">class=job4</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹åˆ†åŒºä¿¡æ¯</span><br><span class="line">hive (mydb)&gt; select * from t6 where class='job110';</span><br><span class="line">OK</span><br><span class="line">t6.idt6.class</span><br><span class="line">1job110</span><br><span class="line">2job110</span><br><span class="line">3job110</span><br><span class="line">4job110</span><br><span class="line">5job110</span><br></pre></td></tr></table></figure></li></ul><h4 id="4-3-4-å¤åˆåˆ†åŒº"><a href="#4-3-4-å¤åˆåˆ†åŒº" class="headerlink" title="4.3.4 å¤åˆåˆ†åŒº"></a>4.3.4 å¤åˆåˆ†åŒº</h4><h5 id="åŸºæœ¬æ“ä½œ-1"><a href="#åŸºæœ¬æ“ä½œ-1" class="headerlink" title="åŸºæœ¬æ“ä½œ"></a>åŸºæœ¬æ“ä½œ</h5><ul><li>åˆ›å»ºæ•°æ®æ–‡ä»¶<code>partition_table.dat</code></li><li>åˆ›å»ºè¡¨<ul><li><code>create table t7(name string,age int)partitioned by(class string,city string)row format delimited fields terminated by &#39;\t&#39; stored as TEXTFILE;</code></li></ul></li><li><strong>åœ¨ Hive ä¸‹åŠ è½½æ•°æ®åˆ°åˆ†åŒº</strong><ul><li><code>load data local inpath &#39;ihivedata/partidata&#39; into table t7 partition(class=&#39;job1&#39;,city=&#39;beijing&#39;);</code></li><li><code>load data local inpath &#39;ihivedata/partidata&#39; into table t7 partition(class=&#39;job1&#39;,city=&#39;shanghai&#39;);</code></li><li><code>load data local inpath &#39;ihivedata/partidata&#39; into table t7 partition(class=&#39;job2&#39;,city=&#39;ss&#39;);</code></li><li><strong>æ³¨æ„: å¤šçº§åˆ†åŒºå…¶å®å°±æ˜¯å¤šçº§ç›®å½•</strong><ul><li>è¶Šé è¿‘å·¦è¾¹, ç›®å½•å±‚çº§è¶Šé«˜; </li><li>è¶Šé è¿‘å³è¾¹, ç›®å½•å±‚çº§è¶Šä½; </li></ul></li><li><strong>load æ•°æ®åˆ°å¤šçº§åˆ†åŒº, loadå±‚çº§å¿…é¡»å’Œæ•´ä¸ªå±‚çº§æ•°é‡ç›¸åŒ</strong><ul><li>ä¹Ÿå°±æ˜¯è¯´, å¦‚æœ<strong>åˆ†åŒºæœ‰2å±‚</strong>, <strong>ä¼ æ•°æ®</strong>çš„æ—¶å€™, ä¹Ÿ<strong>å¿…é¡»ä¼ 2å±‚åˆ†åŒº</strong>, å¹¶ä¸”<strong>å±‚çº§é¡ºåºå¿…é¡»ä¸€è‡´</strong></li></ul></li></ul></li><li><strong>ä»Linux æœ¬åœ°ç›´æ¥å¯¼æ•°æ®åˆ°åˆ†åŒº</strong><ul><li><strong>å¯ä»¥ç›´æ¥åœ¨ hadoop UI é¡µé¢, æŸ¥çœ‹è·¯å¾„, ç„¶åç›´æ¥ä¼ åˆ°æ­¤è·¯å¾„ä¸­</strong></li><li><code>hadoop fs -put ihivedata/partidata /user/hive/warehouse/mydb.db/t7/class=job1/city=beijing/p2</code></li></ul></li><li>æŸ¥çœ‹æ•°æ®<ul><li><code>select * from partition_table</code></li><li><code>select count(*) from partition_table</code></li></ul></li><li>åˆ é™¤è¡¨<ul><li><code>drop table partition_table</code></li></ul></li><li>å·¥ä½œä¸­ ç”¨çš„æœ€å¤šçš„æ˜¯ <strong>å¤–éƒ¨è¡¨ + åˆ†åŒºè¡¨</strong> </li></ul><h3 id="4-4-æ¡¶è¡¨-ä¸»è¦ç”¨äºæŠ½æ ·æŸ¥è¯¢"><a href="#4-4-æ¡¶è¡¨-ä¸»è¦ç”¨äºæŠ½æ ·æŸ¥è¯¢" class="headerlink" title="4.4 æ¡¶è¡¨ - ä¸»è¦ç”¨äºæŠ½æ ·æŸ¥è¯¢"></a>4.4 æ¡¶è¡¨ - ä¸»è¦ç”¨äºæŠ½æ ·æŸ¥è¯¢</h3><h4 id="æ¡¶è¡¨çš„åŸºæœ¬æ“ä½œ"><a href="#æ¡¶è¡¨çš„åŸºæœ¬æ“ä½œ" class="headerlink" title="æ¡¶è¡¨çš„åŸºæœ¬æ“ä½œ"></a>æ¡¶è¡¨çš„åŸºæœ¬æ“ä½œ</h4><ul><li><strong>åˆ›å»ºæ¡¶è¡¨å®Œæ•´è¿‡ç¨‹</strong></li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#åˆ›å»ºåˆ†æ¡¶è¡¨</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> stu_buck;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> stu_buck(Sno <span class="built_in">int</span>,Sname <span class="keyword">string</span>,Sex <span class="keyword">string</span>,Sage <span class="built_in">int</span>,Sdept <span class="keyword">string</span>)</span><br><span class="line">clustered <span class="keyword">by</span>(Sno) </span><br><span class="line">sorted <span class="keyword">by</span>(Sno <span class="keyword">DESC</span>)</span><br><span class="line"><span class="keyword">into</span> <span class="number">4</span> buckets</span><br><span class="line"><span class="keyword">row</span> <span class="keyword">format</span> <span class="keyword">delimited</span></span><br><span class="line"><span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">','</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#è®¾ç½®å˜é‡,è®¾ç½®åˆ†æ¡¶ä¸ºtrue, è®¾ç½®reduceæ•°é‡æ˜¯åˆ†æ¡¶çš„æ•°é‡ä¸ªæ•°</span><br><span class="line"><span class="keyword">set</span> hive.enforce.bucketing = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">set</span> mapreduce.job.reduces=<span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">#å¼€å§‹å¾€åˆ›å»ºçš„åˆ†é€šè¡¨æ’å…¥æ•°æ®(æ’å…¥æ•°æ®éœ€è¦æ˜¯å·²åˆ†æ¡¶, ä¸”æ’åºçš„)</span><br><span class="line">#å¯ä»¥ä½¿ç”¨distribute by(sno) sort by(sno asc)   æˆ–æ˜¯æ’åºå’Œåˆ†æ¡¶çš„å­—æ®µç›¸åŒçš„æ—¶å€™ä½¿ç”¨Cluster by(å­—æ®µ)</span><br><span class="line">#æ³¨æ„ä½¿ç”¨cluster by  å°±ç­‰åŒäºåˆ†æ¡¶+æ’åº(sort)</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">table</span> stu_buck</span><br><span class="line"><span class="keyword">select</span> Sno,Sname,Sex,Sage,Sdept <span class="keyword">from</span> student <span class="keyword">distribute</span> <span class="keyword">by</span>(Sno) <span class="keyword">sort</span> <span class="keyword">by</span>(Sno <span class="keyword">asc</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> overwrite <span class="keyword">table</span> stu_buck</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> student <span class="keyword">distribute</span> <span class="keyword">by</span>(Sno) <span class="keyword">sort</span> <span class="keyword">by</span>(Sno <span class="keyword">asc</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> overwrite <span class="keyword">table</span> stu_buck</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> student cluster <span class="keyword">by</span>(Sno);</span><br><span class="line"><span class="comment">-----</span></span><br><span class="line">ä»¥ä¸Š3è€…æ•ˆæœä¸€æ ·çš„</span><br></pre></td></tr></table></figure><ul><li><p><strong>ä¿å­˜selectæŸ¥è¯¢ç»“æœçš„å‡ ç§æ–¹å¼ï¼š</strong></p><ul><li><p>å°†æŸ¥è¯¢ç»“æœä¿å­˜åˆ°ä¸€å¼ æ–°çš„hiveè¡¨ä¸­</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_tmp</span><br><span class="line"><span class="keyword">as</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> t_p;</span><br></pre></td></tr></table></figure></li></ul></li></ul><ol start="2"><li><p>å°†æŸ¥è¯¢ç»“æœä¿å­˜åˆ°ä¸€å¼ å·²ç»å­˜åœ¨çš„hiveè¡¨ä¸­</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span>  <span class="keyword">table</span> t_tmp</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> t_p;</span><br></pre></td></tr></table></figure></li></ol><ol start="3"><li><p>å°†æŸ¥è¯¢ç»“æœä¿å­˜åˆ°æŒ‡å®šçš„æ–‡ä»¶ç›®å½•ï¼ˆå¯ä»¥æ˜¯æœ¬åœ°ï¼Œä¹Ÿå¯ä»¥æ˜¯hdfsï¼‰</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> overwrite <span class="keyword">local</span> <span class="keyword">directory</span> <span class="string">'/home/hadoop/test'</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> t_p;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> overwrite <span class="keyword">directory</span> <span class="string">'/aaa/test'</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> t_p;</span><br></pre></td></tr></table></figure></li></ol><ul><li><p><strong>æ•°æ®åŠ è½½åˆ°æ¡¶è¡¨æ—¶ï¼Œä¼šå¯¹å­—æ®µå–hashå€¼ï¼Œç„¶åä¸æ¡¶çš„æ•°é‡å–æ¨¡ã€‚æŠŠæ•°æ®æ”¾åˆ°å¯¹åº”çš„æ–‡ä»¶ä¸­ã€‚</strong></p><ul><li>æ‰€ä»¥<strong>é¡ºåºæ˜¯æ‰“ä¹±çš„</strong>, ä¸æ˜¯åŸå§‹ t1çš„æ•°æ®é¡ºåº</li></ul></li><li><p><strong>æŸ¥çœ‹æ•°æ®</strong></p><ul><li><p>å¯ä»¥ç›´æ¥select * æŸ¥çœ‹å…¨éƒ¨</p></li><li><p>ä¹Ÿå¯ä»¥ç›´æ¥å•ç‹¬æŸ¥çœ‹æ¯ä¸ªæ¡¶çš„æ•°æ®</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">hive (mydb)&gt; dfs -cat /user/hive/warehouse/mydb.db/bucket_table/000000_0;</span><br><span class="line">4</span><br><span class="line">hive (mydb)&gt; dfs -cat /user/hive/warehouse/mydb.db/bucket_table/000001_0;</span><br><span class="line">5</span><br><span class="line">1</span><br><span class="line">hive (mydb)&gt; dfs -cat /user/hive/warehouse/mydb.db/bucket_table/000002_0;</span><br><span class="line">2</span><br><span class="line">hive (mydb)&gt; dfs -cat /user/hive/warehouse/mydb.db/bucket_table/000003_0;</span><br><span class="line">3</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>ä¿®æ”¹æ¡¶çš„ä¸ªæ•°</strong></p><ul><li><code>alter table bucket_table clustered by (id) sorted by(id) into 10 buckets;</code><ul><li>ä½†æ˜¯è¿™æ ·ä¿®æ”¹ä¹‹å, ç”Ÿæˆçš„æ˜¯åŸæ¥çš„ copy, å¹¶ä¸”é‡Œé¢çš„æ•°æ®ä¹Ÿå¾ˆå¥‡æ€ª, ä¸çŸ¥é“æ˜¯æŒ‰ç…§ä»€ä¹ˆæ¥æ‰§è¡Œçš„? <strong>:TODO</strong></li></ul></li></ul></li><li><p><strong>æ³¨æ„ï¼š</strong></p><ul><li><strong>ç‰©ç†ä¸Šï¼Œæ¯ä¸ªæ¡¶å°±æ˜¯è¡¨(æˆ–åˆ†åŒºï¼‰ç›®å½•é‡Œçš„ä¸€ä¸ªæ–‡ä»¶</strong></li><li>ä¸€ä¸ªä½œä¸šäº§ç”Ÿçš„<strong>æ¡¶(è¾“å‡ºæ–‡ä»¶)å’Œreduceä»»åŠ¡ä¸ªæ•°ç›¸åŒ</strong></li></ul></li><li><p><strong>æ¡¶è¡¨å·¥ä½œä¸­å®¹æ˜“é‡åˆ°çš„é”™è¯¯</strong></p><ul><li><p><strong>å‘æ¡¶è¡¨ä¸­æ’å…¥å…¶å®ƒè¡¨æŸ¥å‡ºçš„æ•°æ®çš„æ—¶å€™,  å¿…é¡»æŒ‡å®šå­—æ®µå</strong>, å¦åˆ™ä¼šæŠ¥å­—æ®µä¸åŒ¹é….</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">FAILED: SemanticException [Error 10044]: Line 1:12 Cannot <span class="keyword">insert</span> <span class="keyword">into</span> target <span class="keyword">table</span> because <span class="keyword">column</span> <span class="built_in">number</span>/types <span class="keyword">are</span> different <span class="string">'bucket_table'</span>: <span class="keyword">Table</span> insclause<span class="number">-0</span> has <span class="number">1</span> <span class="keyword">columns</span>, but <span class="keyword">query</span> has <span class="number">2</span> columns.</span><br><span class="line"></span><br><span class="line"># åº”è¯¥æ˜¯è¿™æ ·</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> bucket_table <span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t6;</span><br></pre></td></tr></table></figure></li></ul></li></ul><h4 id="â€»-æ¡¶è¡¨çš„æŠ½æ ·æŸ¥è¯¢"><a href="#â€»-æ¡¶è¡¨çš„æŠ½æ ·æŸ¥è¯¢" class="headerlink" title="â€» æ¡¶è¡¨çš„æŠ½æ ·æŸ¥è¯¢"></a>â€» æ¡¶è¡¨çš„æŠ½æ ·æŸ¥è¯¢</h4><ul><li>æ¡¶è¡¨çš„æŠ½æ ·æŸ¥è¯¢<ul><li>select * from bucket_table tablesample<strong>(bucket 1 out of 4 on id);</strong></li></ul></li><li>tablesampleæ˜¯æŠ½æ ·è¯­å¥<ul><li>è¯­æ³•è§£æï¼š<strong>TABLESAMPLE(BUCKET x OUT OF y)</strong></li><li><strong>yå¿…é¡»æ˜¯tableæ€»bucketæ•°çš„<u>å€æ•°</u>æˆ–è€…<u>å› å­</u>ã€‚</strong></li><li>hiveæ ¹æ®yçš„å¤§å°ï¼Œå†³å®šæŠ½æ ·çš„æ¯”ä¾‹ã€‚</li><li><strong>ä¾‹å¦‚</strong>ï¼Œtableæ€»å…±åˆ†äº†64ä»½ï¼Œå½“y=32æ—¶ï¼ŒæŠ½å–(64/32=)2ä¸ªbucketçš„æ•°æ®ï¼Œå½“y=128æ—¶ï¼ŒæŠ½å–(64/128=)1/2ä¸ªbucketçš„æ•°æ®ã€‚xè¡¨ç¤ºä»å“ªä¸ªbucketå¼€å§‹æŠ½å–ã€‚</li><li><strong>ä¾‹å¦‚</strong>ï¼Œtableæ€»bucketæ•°ä¸º32ï¼Œtablesample(bucket 3 out of 16)ï¼Œè¡¨ç¤ºæ€»å…±æŠ½å–ï¼ˆ32/16=ï¼‰2ä¸ªbucketçš„æ•°æ®ï¼Œåˆ†åˆ«ä¸ºç¬¬3ä¸ªbucketå’Œç¬¬ï¼ˆ3+16=ï¼‰19ä¸ªbucketçš„æ•°æ®ã€‚</li></ul></li></ul><h1 id="5-Hive-è§†å›¾çš„æ“ä½œ"><a href="#5-Hive-è§†å›¾çš„æ“ä½œ" class="headerlink" title="5. Hive è§†å›¾çš„æ“ä½œ"></a>5. Hive è§†å›¾çš„æ“ä½œ</h1><ul><li>ä½¿ç”¨è§†å›¾å¯ä»¥<strong>é™ä½æŸ¥è¯¢çš„å¤æ‚åº¦</strong></li><li><strong>è§†å›¾çš„åˆ›å»º</strong><ul><li><strong>create view</strong> v1 <strong>AS</strong> <u>select  t1.name from t1</u>;</li></ul></li><li><strong>è§†å›¾çš„åˆ é™¤</strong><ul><li><strong>drop view</strong> if exists v1;</li></ul></li></ul><h1 id="6-Hive-ç´¢å¼•çš„æ“ä½œ"><a href="#6-Hive-ç´¢å¼•çš„æ“ä½œ" class="headerlink" title="6. Hive ç´¢å¼•çš„æ“ä½œ"></a>6. Hive ç´¢å¼•çš„æ“ä½œ</h1><ul><li><p><strong>åˆ›å»ºç´¢å¼•</strong></p><ul><li><code>create index t1_index on table t1(id) as &#39;org.apache.hadoop.hive.ql.index.compact.CompactIndexHandler&#39; with deferred rebuild in table t1_index_table;</code></li><li><code>t1_index</code>: <strong>ç´¢å¼•åç§°</strong></li><li>as: æŒ‡å®šç´¢å¼•å™¨</li><li><code>t1_index_table</code>: <strong>è¦åˆ›å»ºçš„ç´¢å¼•è¡¨</strong></li></ul></li><li><p><strong>æ˜¾ç¤ºç´¢å¼•</strong></p><ul><li><code>show formatted index on t1;</code></li></ul></li><li><p><strong>é‡å»ºç´¢å¼•</strong></p><ul><li><p><strong>alter index</strong> t1_index <strong>on</strong> t1 <strong>rebuild</strong>;</p></li><li><p>é‡å»ºå®Œç´¢å¼•ä¹‹å, æŸ¥çœ‹ t1_index_table è¿™å¼ è¡¨, å°±å­˜äº†t1è¡¨æ–‡ä»¶å…·ä½“çš„ä½ç½®, æœ€åä¸€åˆ—<code>t1_index_table._offsets</code>æ˜¯ <strong>ç´¢å¼•çš„åç§»é‡, ç±»ä¼¼äºæŒ‡é’ˆ,  åç§»é‡æ˜¯ç´¢å¼•çš„ç²¾é«“</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">hive (mydb)&gt; select * from t1_index_table;</span><br><span class="line">OK</span><br><span class="line">t1_index_table.idt1_index_table._bucketnamet1_index_table._offsets</span><br><span class="line">1hdfs://cs1:9000/user/hive/warehouse/mydb.db/t1/intdata[0]</span><br><span class="line">2hdfs://cs1:9000/user/hive/warehouse/mydb.db/t1/intdata[2]</span><br><span class="line">3hdfs://cs1:9000/user/hive/warehouse/mydb.db/t1/intdata[4]</span><br><span class="line">4hdfs://cs1:9000/user/hive/warehouse/mydb.db/t1/intdata[6]</span><br><span class="line">5hdfs://cs1:9000/user/hive/warehouse/mydb.db/t1/intdata[8]</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>åˆ†åŒºå­—æ®µæœ¬è´¨ä¸Šå…¶å®å°±æ˜¯ç´¢å¼•</strong></p></li></ul><h1 id="7-è£…è½½æ•°æ®"><a href="#7-è£…è½½æ•°æ®" class="headerlink" title="7. è£…è½½æ•°æ®"></a>7. è£…è½½æ•°æ®</h1><h3 id="7-1-æ™®é€šè£…è½½æ•°æ®"><a href="#7-1-æ™®é€šè£…è½½æ•°æ®" class="headerlink" title="7.1 æ™®é€šè£…è½½æ•°æ®:"></a><strong>7.1 æ™®é€šè£…è½½æ•°æ®:</strong></h3><ul><li><strong>ä»æœ¬åœ°</strong>  put</li><li><p><strong>ä» hive</strong> cp</p></li><li><p><strong>ä»æ–‡ä»¶ä¸­è£…è½½æ•°æ®</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive&gt;LOAD DATA [LOCAL] INPATH '...' [OVERWRITE] INTO TABLE t2 [PARTITION (province='beijing')];</span><br></pre></td></tr></table></figure></li><li><p><strong>é€šè¿‡æŸ¥è¯¢è¡¨è£…è½½æ•°æ®</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># æ–¹å¼1</span><br><span class="line">hive&gt;INSERT OVERWRITE TABLE t2 PARTITION (province='beijing') SELECT * FROM xxx WHERE xxx;</span><br><span class="line"></span><br><span class="line"># æ–¹å¼2</span><br><span class="line">hive&gt;FROM t4 </span><br><span class="line"> <span class="keyword">INSERT</span> OVERWRITE <span class="keyword">TABLE</span> t3 <span class="keyword">PARTITION</span> (...) <span class="keyword">SELECT</span> ...WHERE... </span><br><span class="line"> <span class="keyword">INSERT</span> OVERWRITE <span class="keyword">TABLE</span> t3 <span class="keyword">PARTITION</span> (...) <span class="keyword">SELECT</span> ...WHERE... </span><br><span class="line"> <span class="keyword">INSERT</span> OVERWRITE <span class="keyword">TABLE</span> t3 <span class="keyword">PARTITION</span> (...) <span class="keyword">SELECT</span> ...WHERE...;</span><br><span class="line"> </span><br><span class="line"> # æ–¹å¼3</span><br><span class="line"> ç›´æ¥æ’å…¥æ•°æ®, ä¹Ÿä¼šè½¬åŒ–ä¸ºæ–‡ä»¶çš„å½¢å¼, å­˜åœ¨è¡¨çš„ç›®å½•ä¸‹</span><br><span class="line">- <span class="keyword">insert</span> <span class="keyword">into</span> table_name  <span class="keyword">values</span>(xxx); </span><br><span class="line"></span><br><span class="line"># æ–¹å¼4</span><br><span class="line"> ç›´æ¥ä¼ æ–‡ä»¶</span><br><span class="line"> - <span class="keyword">load</span> <span class="keyword">data</span> (<span class="keyword">local</span>) inpath â€˜ xxxâ€™ <span class="keyword">into</span> <span class="keyword">table</span> t_1;</span><br></pre></td></tr></table></figure></li></ul><h3 id="7-2åŠ¨æ€è£…è½½æ•°æ®"><a href="#7-2åŠ¨æ€è£…è½½æ•°æ®" class="headerlink" title="7.2åŠ¨æ€è£…è½½æ•°æ®"></a>7.2åŠ¨æ€è£…è½½æ•°æ®</h3><ul><li><p>ä¸å¼€å¯åŠ¨æ€è£…è½½æ—¶</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hive&gt;INSERT OVERWRITE TABLE t3 PARTITION(province='bj', city='bj') </span><br><span class="line"><span class="keyword">SELECT</span> t.province, t.city <span class="keyword">FROM</span> temp t <span class="keyword">WHERE</span> t.province=<span class="string">'bj'</span>;</span><br></pre></td></tr></table></figure></li><li><p><strong>å¼€å¯åŠ¨æ€åˆ†åŒºæ”¯æŒ</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hive&gt;set hive.exec.dynamic.partition=true;</span><br><span class="line">hive&gt;set hive.exec.dynamic.partition.mode=nostrict;</span><br><span class="line">hive&gt;set hive.exec.max.dynamic.partitions.pernode=1000;</span><br></pre></td></tr></table></figure></li><li><p><strong>æŠŠ t6 è¡¨çš„æ‰€æœ‰çš„å­—æ®µ (åŒ…æ‹¬åˆ†åŒºå­—æ®µ) åŠ è½½è¿› t9 å¯¹åº”çš„åˆ†åŒº</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (mydb)&gt; insert overwrite table t9 partition(class) select id,class from t6;</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>å•è¯­å¥å»ºè¡¨å¹¶åŒæ—¶è£…è½½æ•°æ®</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive&gt;CREATE TABLE t4 AS SELECT ....</span><br></pre></td></tr></table></figure></li></ul><h1 id="8-å¯¼å‡ºæ•°æ®"><a href="#8-å¯¼å‡ºæ•°æ®" class="headerlink" title="8. å¯¼å‡ºæ•°æ®"></a>8. å¯¼å‡ºæ•°æ®</h1><ul><li><strong>åœ¨hdfsä¹‹é—´å¤åˆ¶æ–‡ä»¶(å¤¹)</strong><ul><li><code>hadoop fs -cp source destination</code></li><li><code>hive&gt; dfs -cp source destination</code></li><li>æ¡ˆä¾‹: <code>hive&gt;  dfs -get  /user/hive/warehouse/mydb.db/t9  /root/t9;</code><ul><li>ä» hdfs å¤åˆ¶åˆ°æœ¬åœ°</li></ul></li></ul></li><li>ä½¿ç”¨DIRECTORY<ul><li><code>hive&gt;INSERT OVERWRITE ã€LOCALã€‘ DIRECTORY &#39;...&#39; SELECT ...FROM...WHERE ...;</code></li><li>æ¡ˆä¾‹:é€šè¿‡æŸ¥è¯¢å¯¼å‡ºåˆ° t9, èµ°çš„ MapReduce<ul><li>å¯¼åˆ°åˆ° hdfs:  <code>insert overwrite directory &quot;/home/t9&quot; select * from t9;</code></li><li>å¯¼å‡ºåˆ°æœ¬åœ°: <code>insert overwrite local directory &quot;/home/ap/t9&quot; select * from t9;</code></li></ul></li></ul></li></ul><h1 id="9-è¯»æ¨¡å¼-amp-å†™æ¨¡å¼"><a href="#9-è¯»æ¨¡å¼-amp-å†™æ¨¡å¼" class="headerlink" title="9. è¯»æ¨¡å¼&amp;å†™æ¨¡å¼"></a>9. è¯»æ¨¡å¼&amp;å†™æ¨¡å¼</h1><ul><li>RDBMSæ˜¯å†™æ¨¡å¼</li><li>Hiveæ˜¯è¯»æ¨¡å¼</li></ul><h1 id="10-å®Œæ•´å»ºè¡¨è¯­å¥è¯­æ³•"><a href="#10-å®Œæ•´å»ºè¡¨è¯­å¥è¯­æ³•" class="headerlink" title="10. å®Œæ•´å»ºè¡¨è¯­å¥è¯­æ³•"></a>10. å®Œæ•´å»ºè¡¨è¯­å¥è¯­æ³•</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> [<span class="keyword">EXTERNAL</span>] <span class="keyword">TABLE</span> [<span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span>] [db_name.]table_name</span><br><span class="line">  [(col_name data_type [<span class="keyword">COMMENT</span> col_comment], ...)]</span><br><span class="line">    [<span class="keyword">COMMENT</span> table_comment]</span><br><span class="line">    [PARTITIONED <span class="keyword">BY</span> (col_name data_type [<span class="keyword">COMMENT</span> col_comment], ...)]</span><br><span class="line">    [CLUSTERED <span class="keyword">BY</span> (col_name, col_name, ...) </span><br><span class="line">    [SORTED <span class="keyword">BY</span> (col_name [<span class="keyword">ASC</span>|<span class="keyword">DESC</span>], ...)] <span class="keyword">INTO</span> num_buckets BUCKETS]</span><br><span class="line">    [SKEWED <span class="keyword">BY</span> (col_name, col_name, ...) <span class="keyword">ON</span> ([(col_value, col_value, ...), ...|col_value, col_value, ...]) </span><br><span class="line">    [<span class="keyword">STORED</span> <span class="keyword">AS</span> DIRECTORIES]   ]</span><br><span class="line">  [ [<span class="keyword">ROW</span> <span class="keyword">FORMAT</span> row_format] </span><br><span class="line">    [<span class="keyword">STORED</span> <span class="keyword">AS</span> file_format] | <span class="keyword">STORED</span> <span class="keyword">BY</span> <span class="string">'storage.handler.class.name'</span> [<span class="keyword">WITH</span> SERDEPROPERTIES (...)]   ]</span><br><span class="line">  [LOCATION hdfs_path]</span><br><span class="line">  [TBLPROPERTIES (property_name=property_value, ...)]     </span><br><span class="line">  [<span class="keyword">AS</span> select_statement]  (Note: <span class="keyword">not</span> supported <span class="keyword">when</span> creating <span class="keyword">external</span> tables.)</span><br></pre></td></tr></table></figure><h1 id="11-æ–‡ä»¶æ ¼å¼"><a href="#11-æ–‡ä»¶æ ¼å¼" class="headerlink" title="11. æ–‡ä»¶æ ¼å¼"></a>11. æ–‡ä»¶æ ¼å¼</h1><ul><li>TextFile</li><li>SequenceFile</li><li>RCFile</li><li>ORC</li></ul><h3 id="11-1-é»˜è®¤å­˜å‚¨æ ¼å¼å°±æ˜¯-TextFile"><a href="#11-1-é»˜è®¤å­˜å‚¨æ ¼å¼å°±æ˜¯-TextFile" class="headerlink" title="11.1 é»˜è®¤å­˜å‚¨æ ¼å¼å°±æ˜¯ TextFile"></a>11.1 é»˜è®¤å­˜å‚¨æ ¼å¼å°±æ˜¯ TextFile</h3><ul><li>å­˜å‚¨ç©ºé—´æ¶ˆè€—æ¯”è¾ƒå¤§ï¼Œ</li><li>å¹¶ä¸”å‹ç¼©çš„text æ— æ³•åˆ†å‰²å’Œåˆå¹¶</li><li>æŸ¥è¯¢çš„æ•ˆç‡æœ€ä½,å¯ä»¥ç›´æ¥å­˜å‚¨ï¼Œ</li><li>åŠ è½½æ•°æ®çš„é€Ÿåº¦æœ€é«˜</li></ul><h3 id="11-2-ä½¿ç”¨SequenceFileå­˜å‚¨"><a href="#11-2-ä½¿ç”¨SequenceFileå­˜å‚¨" class="headerlink" title="11.2 ä½¿ç”¨SequenceFileå­˜å‚¨"></a>11.2 ä½¿ç”¨SequenceFileå­˜å‚¨</h3><ul><li>å­˜å‚¨ç©ºé—´æ¶ˆè€—å¤§</li><li>å‹ç¼©çš„æ–‡ä»¶å¯ä»¥åˆ†å‰²å’Œåˆå¹¶ </li><li>æŸ¥è¯¢æ•ˆç‡é«˜</li><li>éœ€è¦é€šè¿‡textæ–‡ä»¶è½¬åŒ–æ¥åŠ è½½</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">hive&gt; </span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> test2(<span class="keyword">str</span> <span class="keyword">STRING</span>) <span class="keyword">STORED</span> <span class="keyword">AS</span> SEQUENCEFILE;  </span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span> hive.exec.compress.output=<span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span> mapred.output.compress=<span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span> mapred.output.compression.codec=com.hadoop.compression.lzo.LzoCodec;</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span> io.seqfile.compression.type=<span class="keyword">BLOCK</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span> io.compression.codecs=com.hadoop.compression.lzo.LzoCodec;</span><br><span class="line"><span class="keyword">INSERT</span> OVERWRITE <span class="keyword">TABLE</span> test2 <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> test1;</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„ç‚¹: SequenceFile ç±»å‹çš„è¡¨, ä¸èƒ½ç›´æ¥å¯¼å…¥æ•°æ®æ–‡ä»¶,  åªèƒ½é€šè¿‡ä»ä»–è¡¨æŸ¥è¯¢</strong></p><ul><li><p><code>insert overwrite table t2 select * from t1;</code></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># æŸ¥çœ‹æ­¤ 'SequenceFile' è¡¨</span><br><span class="line">hive (db2)&gt; dfs -cat /user/hive/warehouse/db2.db/t2/000000_0 ;</span><br><span class="line">SEQ"org.apache.hadoop.io.BytesWritableorg.apache.hadoop.io.Text*org.apache.hadoop.io.compress.DefaultCodecï¿½ï¿½ï¿½/*&lt;bbï¿½mï¿½?xï¿½c453xï¿½c464xï¿½c475xï¿½c486xï¿½c497hive (db2)&gt;</span><br></pre></td></tr></table></figure></li></ul><h3 id="11-3-ä½¿ç”¨RCFileå­˜å‚¨"><a href="#11-3-ä½¿ç”¨RCFileå­˜å‚¨" class="headerlink" title="11.3 ä½¿ç”¨RCFileå­˜å‚¨"></a>11.3 ä½¿ç”¨RCFileå­˜å‚¨</h3><p><strong>RCFILEæ˜¯ä¸€ç§è¡Œåˆ—å­˜å‚¨ç›¸ç»“åˆçš„å­˜å‚¨æ–¹å¼ã€‚é¦–å…ˆï¼Œå…¶å°†æ•°æ®æŒ‰è¡Œåˆ†å—ï¼Œä¿è¯åŒä¸€ä¸ªrecordåœ¨ä¸€ä¸ªå—ä¸Šï¼Œé¿å…è¯»ä¸€ä¸ªè®°å½•éœ€è¦è¯»å–å¤šä¸ªblockã€‚å…¶æ¬¡ï¼Œå—æ•°æ®åˆ—å¼å­˜å‚¨ï¼Œæœ‰åˆ©äºæ•°æ®å‹ç¼©å’Œå¿«é€Ÿçš„åˆ—å­˜å–ã€‚</strong></p><ul><li>rcfile å­˜å‚¨ç©ºé—´æœ€å°</li><li>æŸ¥è¯¢çš„æ•ˆç‡æœ€é«˜</li><li>éœ€è¦é€šè¿‡textæ–‡ä»¶è½¬åŒ–æ¥åŠ è½½</li><li>åŠ è½½çš„é€Ÿåº¦æœ€ä½</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">hive&gt; </span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> test3(<span class="keyword">str</span> <span class="keyword">STRING</span>)  <span class="keyword">STORED</span> <span class="keyword">AS</span> RCFILE;  </span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span> hive.exec.compress.output=<span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span> mapred.output.compress=<span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span> mapred.output.compression.codec=com.hadoop.compression.lzo.LzoCodec;</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span> io.compression.codecs=com.hadoop.compression.lzo.LzoCodec;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> OVERWRITE <span class="keyword">TABLE</span> test3 <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> test1;</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„ç‚¹:  RCFile ä¹Ÿåªèƒ½ä»å…¶å®ƒè¡¨å¯¼å…¥æ•°æ®</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hive (db2)&gt; dfs -cat /user/hive/warehouse/db2.db/t3/000000_0;</span><br><span class="line">RCF*org.apache.hadoop.io.compress.DefaultCodechive.io.rcfile.column.number1</span><br></pre></td></tr></table></figure><h3 id="11-4-ä½¿ç”¨ORCå­˜å‚¨-æœ€å¥½çš„ä¸€ç§æ ¼å¼"><a href="#11-4-ä½¿ç”¨ORCå­˜å‚¨-æœ€å¥½çš„ä¸€ç§æ ¼å¼" class="headerlink" title="11.4 ä½¿ç”¨ORCå­˜å‚¨(æœ€å¥½çš„ä¸€ç§æ ¼å¼)"></a>11.4 ä½¿ç”¨ORCå­˜å‚¨(æœ€å¥½çš„ä¸€ç§æ ¼å¼)</h3><p><strong>æ˜¯ä¸€ç§é’ˆå¯¹ RCFile ä¼˜åŒ–çš„æ ¼å¼</strong></p><p>ä¸»è¦ç‰¹ç‚¹: <strong>å‹ç¼©, ç´¢å¼•, å•æ–‡ä»¶è¾“å‡º</strong></p><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-15-070816.jpg" alt=""></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">hive&gt; </span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t1_orc(<span class="keyword">id</span> <span class="built_in">int</span>, <span class="keyword">name</span> <span class="keyword">string</span>) <span class="keyword">row</span> <span class="keyword">format</span> <span class="keyword">delimited</span> <span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">'\t'</span> <span class="keyword">stored</span> <span class="keyword">as</span> orc </span><br><span class="line"></span><br><span class="line">tblproperties(<span class="string">"orc.compress"</span>=<span class="string">"ZLIB"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> ... [<span class="keyword">PARTITION</span> partition_spec] <span class="keyword">SET</span> FILEFORMAT ORC;</span><br><span class="line"></span><br><span class="line"># ä¹Ÿå¯ä»¥æ”¹ä¸ºå…¶å®ƒçš„, ä¿®æ”¹çš„è¯­æ³•å°±æ˜¯è¿™æ ·</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> t1 <span class="keyword">set</span> fileformat textfile;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> hive.default.fileformat=Orc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> overwrite <span class="keyword">table</span> t1_orc <span class="keyword">select</span> * <span class="keyword">from</span> t1;</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„ç‚¹:  </strong></p><ul><li><strong>ORC ä¹Ÿåªèƒ½ä»å…¶å®ƒè¡¨å¯¼å…¥æ•°æ®</strong></li><li><strong>å ç”¨ç©ºé—´å¤§, ä¸€ä¸ª block æœ‰256M, ä¹‹å‰2ç§éƒ½æ˜¯128M</strong></li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">hive (db2)&gt; dfs -cat /user/hive/warehouse/db2.db/t4/000000_0;</span><br><span class="line">ORC</span><br><span class="line">P+</span><br><span class="line">Pï¿½6ï¿½bï¿½``ï¿½ï¿½ï¿½ÑŒ@ï¿½Hï¿½</span><br><span class="line">                       1q01-</span><br><span class="line">P</span><br><span class="line">PK</span><br><span class="line"># ("</span><br><span class="line">       id0P:</span><br><span class="line">P@ï¿½;ï¿½ï¿½"</span><br><span class="line">       (0ï¿½ï¿½ORChive</span><br></pre></td></tr></table></figure><h1 id="12-åºåˆ—åŒ–-amp-ååºåˆ—åŒ–-Hive-SerDe"><a href="#12-åºåˆ—åŒ–-amp-ååºåˆ—åŒ–-Hive-SerDe" class="headerlink" title="12. åºåˆ—åŒ– &amp; ååºåˆ—åŒ– (Hive SerDe)"></a>12. åºåˆ—åŒ– &amp; ååºåˆ—åŒ– (Hive SerDe)</h1><h3 id="12-1-SerDe"><a href="#12-1-SerDe" class="headerlink" title="12.1 SerDe"></a>12.1 SerDe</h3><ul><li><strong>What is a SerDe?</strong><ul><li>SerDe æ˜¯ â€œSerializer and Deserializer.â€çš„ç¼©å†™</li><li>Hive ä½¿ç”¨ SerDeå’ŒFileFormatè¿›è¡Œè¡Œå†…å®¹çš„è¯»å†™.</li></ul></li><li><strong>Hiveåºåˆ—åŒ–æµç¨‹</strong><ul><li><strong>ä» HDFS ä¸Šè¯»å…¥æ–‡ä»¶ (ååºåˆ—åŒ–)</strong><ul><li><code>HDFSæ–‡ä»¶ --&gt; InputFileFormat --&gt; &lt;key, value&gt; --&gt; Deserializer --&gt; è¡Œå¯¹è±¡</code></li></ul></li><li><strong>å†™å‡ºåˆ° HDFS (åºåˆ—åŒ–)</strong><ul><li><code>è¡Œå¯¹è±¡ --&gt; Serializer --&gt; &lt;key, value&gt; --&gt; OutputFileFormat --&gt; HDFSæ–‡ä»¶</code></li></ul></li><li>æ³¨æ„: <strong>æ•°æ®å…¨éƒ¨å­˜åœ¨åœ¨valueä¸­ï¼Œkeyå†…å®¹æ— æ„ä¹‰</strong></li></ul></li></ul><ul><li><p><strong>Hive ä½¿ç”¨å¦‚ä¸‹FileFormat ç±»è¯»å†™ HDFS files:</strong></p><ul><li>TextInputFormat/HiveIgnoreKeyTextOutputFormat: è¯»å†™æ™®é€šHDFSæ–‡æœ¬æ–‡ä»¶.</li><li>SequenceFileInputFormat/SequenceFileOutputFormat: è¯»å†™SequenceFileæ ¼å¼çš„HDFSæ–‡ä»¶</li><li>â€¦.</li></ul></li></ul><ul><li><p><strong>Hive ä½¿ç”¨å¦‚ä¸‹SerDe ç±»(å)åºåˆ—åŒ–æ•°æ®:</strong></p><ul><li>MetadataTypedColumnsetSerDe: è¯»å†™csvã€tsvæ–‡ä»¶å’Œé»˜è®¤æ ¼å¼æ–‡ä»¶</li><li>ThriftSerDe: è¯»å†™Thrift åºåˆ—åŒ–åçš„å¯¹è±¡.</li><li>DynamicSerDe: è¯»å†™Thriftåºåˆ—åŒ–åçš„å¯¹è±¡, ä¸è¿‡ä¸éœ€è¦è§£è¯»schemaä¸­çš„ddl.</li></ul></li></ul><h3 id="12-2-ä½¿ç”¨CSV-Serde"><a href="#12-2-ä½¿ç”¨CSV-Serde" class="headerlink" title="12.2 ä½¿ç”¨CSV Serde"></a>12.2 ä½¿ç”¨CSV Serde</h3><p>CSVæ ¼å¼çš„æ–‡ä»¶ä¹Ÿç§°ä¸ºé€—å·åˆ†éš”å€¼ï¼ˆComma-Separated Valuesï¼ŒCSVï¼Œæœ‰æ—¶ä¹Ÿç§°ä¸ºå­—ç¬¦åˆ†éš”å€¼ï¼Œå› ä¸ºåˆ†éš”å­—ç¬¦ä¹Ÿå¯ä»¥ä¸æ˜¯é€—å·ã€‚åœ¨æœ¬æ–‡ä¸­çš„CSVæ ¼å¼çš„æ•°æ®å°±ä¸æ˜¯ç®€å•çš„é€—å·åˆ†å‰²çš„ï¼‰ï¼Œå…¶æ–‡ä»¶ä»¥çº¯æ–‡æœ¬å½¢å¼å­˜å‚¨è¡¨æ ¼æ•°æ®ï¼ˆæ•°å­—å’Œæ–‡æœ¬ï¼‰ã€‚CSVæ–‡ä»¶ç”±ä»»æ„æ•°ç›®çš„è®°å½•ç»„æˆï¼Œè®°å½•é—´ä»¥æŸç§æ¢è¡Œç¬¦åˆ†éš”ï¼›æ¯æ¡è®°å½•ç”±å­—æ®µç»„æˆï¼Œå­—æ®µé—´çš„åˆ†éš”ç¬¦æ˜¯å…¶å®ƒå­—ç¬¦æˆ–å­—ç¬¦ä¸²ï¼Œæœ€å¸¸è§çš„æ˜¯é€—å·æˆ–åˆ¶è¡¨ç¬¦ã€‚é€šå¸¸ï¼Œæ‰€æœ‰è®°å½•éƒ½æœ‰å®Œå…¨ç›¸åŒçš„å­—æ®µåºåˆ—ã€‚<br>é»˜è®¤çš„åˆ†éš”ç¬¦æ˜¯</p><blockquote><p>DEFAULT_ESCAPE_CHARACTER \<br>DEFAULT_QUOTE_CHARACTER  â€œ     â€”å¦‚æœæ²¡æœ‰ï¼Œåˆ™ä¸éœ€è¦æŒ‡å®š<br>DEFAULT_SEPARATOR  , </p></blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> csv_table(a <span class="keyword">string</span>, b <span class="keyword">string</span>) <span class="keyword">ROW</span> <span class="keyword">FORMAT</span> SERDE <span class="string">'org.apache.hadoop.hive.serde2.OpenCSVSerde'</span> <span class="keyword">WITH</span> SERDEPROPERTIES (<span class="string">"separatorChar"</span>=<span class="string">"\t"</span>, <span class="string">"quoteChar"</span>=<span class="string">"'"</span>, <span class="string">"escapeChar"</span>=<span class="string">"\\"</span>)  <span class="keyword">STORED</span> <span class="keyword">AS</span> TEXTFILE;</span><br><span class="line"></span><br><span class="line"># separatorCharï¼šåˆ†éš”ç¬¦</span><br><span class="line"># quoteCharï¼šå¼•å·ç¬¦</span><br><span class="line"># escapeCharï¼šè½¬ä¹‰ç¬¦</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt;&gt;  :TODO åˆ›å»ºè¡¨æ²¡æˆåŠŸ, ç”¨åˆ°æ—¶å†è¯´</span><br></pre></td></tr></table></figure><h1 id="13-Lateral-View-è¯­æ³•"><a href="#13-Lateral-View-è¯­æ³•" class="headerlink" title="13. Lateral View è¯­æ³•"></a>13. Lateral View è¯­æ³•</h1><p>lateral viewç”¨äºå’Œsplit, explodeç­‰UDTFä¸€èµ·ä½¿ç”¨ï¼Œå®ƒèƒ½å¤Ÿ<strong>å°†ä¸€è¡Œæ•°æ®æ‹†æˆå¤šè¡Œæ•°æ®ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šå¯ä»¥å¯¹æ‹†åˆ†åçš„æ•°æ®è¿›è¡Œèšåˆ</strong>ã€‚lateral viewé¦–å…ˆä¸ºåŸå§‹è¡¨çš„æ¯è¡Œè°ƒç”¨UDTFï¼ŒUTDFä¼šæŠŠä¸€è¡Œæ‹†åˆ†æˆä¸€æˆ–è€…å¤šè¡Œï¼Œlateral viewå†æŠŠç»“æœç»„åˆï¼Œäº§ç”Ÿä¸€ä¸ª<strong>æ”¯æŒåˆ«åè¡¨çš„è™šæ‹Ÿè¡¨</strong>ã€‚</p><p><strong>lateral: ä¾§é¢, æ¨ªåˆ‡é¢</strong></p><p><strong>Lateral View: åˆ‡é¢è¡¨</strong></p><ul><li><p>åˆ›å»ºè¡¨</p><ul><li><strong>create table t8(name string,nums array\&lt;int>)row format delimited fields terminated by â€œ\tâ€ COLLECTION ITEMS TERMINATED BY â€˜:â€™;</strong></li></ul></li><li><p>æ•°æ®åˆ‡å‰²</p><ul><li><strong>SELECT name,new_num FROM t8 LATERAL VIEW explode(nums) num AS new_num;</strong></li><li><code>select name,id from class_test lateral view explode(student_id_list) list as id;</code></li><li><strong>æ³¨æ„: as å‰é¢çš„ <code>list</code> è²Œä¼¼æ˜¯å¯ä»¥éšè¡¨èµ·åçš„</strong></li></ul></li><li><p>æ•ˆæœæ¼”ç¤º</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select * from class_test;</span><br><span class="line">OK</span><br><span class="line">class_test.nameclass_test.student_id_list</span><br><span class="line">zhangsan[24,25,27,37]</span><br><span class="line">lisi[28,39,23,43]</span><br><span class="line">wangwu[25,23,2,54]</span><br><span class="line"><span class="comment">---</span></span><br><span class="line">hive (default)&gt; select name,id from class_test lateral view explode(student_id_list) list as id;</span><br><span class="line">OK</span><br><span class="line">nameid</span><br><span class="line">zhangsan24</span><br><span class="line">zhangsan25</span><br><span class="line">zhangsan27</span><br><span class="line">zhangsan37</span><br><span class="line">lisi28</span><br><span class="line">lisi39</span><br><span class="line">lisi23</span><br><span class="line">lisi43</span><br><span class="line">wangwu25</span><br><span class="line">wangwu23</span><br><span class="line">wangwu2</span><br><span class="line">wangwu54</span><br></pre></td></tr></table></figure></li></ul><h1 id="14-Hiveçš„é«˜çº§å‡½æ•°"><a href="#14-Hiveçš„é«˜çº§å‡½æ•°" class="headerlink" title="14. Hiveçš„é«˜çº§å‡½æ•°"></a>14. Hiveçš„é«˜çº§å‡½æ•°</h1><h3 id="14-1-ç®€ä»‹"><a href="#14-1-ç®€ä»‹" class="headerlink" title="14.1 ç®€ä»‹"></a>14.1 ç®€ä»‹</h3><ul><li>ç®€å•æŸ¥è¯¢<ul><li>select â€¦ fromâ€¦whereâ€¦</li></ul></li><li><strong>ä½¿ç”¨å„ç§å‡½æ•°</strong><ul><li><strong>hive&gt;show functions;</strong><ul><li>å±•ç¤ºæ‰€æœ‰å‡½æ•°</li></ul></li><li><strong>hive&gt;describe function  xxx;</strong><ul><li>è¯¦ç»†æè¿°å‡½æ•°ç”¨æ³•</li></ul></li></ul></li><li>LIMITè¯­å¥</li><li>åˆ—åˆ«å</li><li>åµŒå¥—selectè¯­å¥</li></ul><h3 id="14-2-é«˜çº§å‡½æ•°åˆ†ç±»"><a href="#14-2-é«˜çº§å‡½æ•°åˆ†ç±»" class="headerlink" title="14.2 é«˜çº§å‡½æ•°åˆ†ç±»"></a>14.2 é«˜çº§å‡½æ•°åˆ†ç±»</h3><ul><li><p>æ ‡å‡†å‡½æ•°</p><ul><li>reverse()</li><li>upper()</li></ul></li><li><p>èšåˆå‡½æ•°</p><ul><li><p>avg()</p></li><li><p>sum()</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">avg</span>(<span class="keyword">id</span>) <span class="keyword">from</span> t3;</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">sum</span>(<span class="keyword">id</span>) <span class="keyword">from</span> t3;</span><br><span class="line"></span><br><span class="line"># æœ€ç®€ç­”çš„åµŒå¥—</span><br><span class="line">hive (mydb)&gt; select t.id from (select * from t1 where id &gt; 3)t;</span><br><span class="line"></span><br><span class="line"># æœ€ç®€å•çš„ group by</span><br><span class="line"></span><br><span class="line"># if else çš„æ•ˆæœ</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">id</span>, </span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> </span><br><span class="line"><span class="keyword">when</span> <span class="keyword">id</span> &lt;= <span class="number">2</span> </span><br><span class="line"><span class="keyword">then</span> <span class="string">'low'</span></span><br><span class="line"><span class="keyword">when</span> <span class="keyword">id</span>&gt;=<span class="number">3</span> <span class="keyword">and</span> <span class="keyword">id</span> &lt;<span class="number">4</span> </span><br><span class="line"><span class="keyword">then</span> <span class="string">'middle'</span></span><br><span class="line"><span class="keyword">when</span> <span class="keyword">id</span>&gt;=<span class="number">4</span> <span class="keyword">and</span> <span class="keyword">id</span> &lt;<span class="number">5</span> </span><br><span class="line"><span class="keyword">then</span> <span class="string">'high'</span></span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line"><span class="string">'very high'</span></span><br><span class="line"><span class="keyword">end</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">as</span> </span><br><span class="line">id_highly </span><br><span class="line"><span class="keyword">from</span> t1;</span><br><span class="line"></span><br><span class="line"><span class="comment">----æ‰§è¡Œç»“æœ----</span></span><br><span class="line">idid_highly</span><br><span class="line">1low</span><br><span class="line">2low</span><br><span class="line">3middle</span><br><span class="line">4high</span><br><span class="line">5very high</span><br><span class="line"></span><br><span class="line"><span class="comment">--------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">sid</span>,</span><br><span class="line"><span class="keyword">case</span> course</span><br><span class="line"><span class="keyword">when</span> <span class="string">'yuwen'</span> <span class="keyword">then</span> score</span><br><span class="line"><span class="keyword">else</span> <span class="string">'0'</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">(åˆ«å) yuwen</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> course</span><br><span class="line"><span class="keyword">when</span> <span class="string">'shuxue'</span> <span class="keyword">then</span> score</span><br><span class="line"><span class="keyword">else</span> <span class="string">'0'</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">(åˆ«å) shuxue</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># <span class="keyword">cast</span> è½¬æ¢å‡½æ•°, å¤§æ¦‚æ˜¯è¿™ä¹ˆç”¨</span><br><span class="line">hive (mydb)&gt; <span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t1 <span class="keyword">where</span> <span class="keyword">cast</span>(<span class="keyword">id</span> <span class="keyword">AS</span> <span class="built_in">FLOAT</span>) &lt;<span class="number">3.0</span>;</span><br><span class="line">OK</span><br><span class="line">id</span><br><span class="line">1</span><br><span class="line">2</span><br></pre></td></tr></table></figure><pre><code>- ![image-20180619150824031](http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-19-070824.png)</code></pre></li></ul></li></ul><p><strong>é¦–å…ˆå½“å‰ä¸å­˜åœ¨çš„åˆ—è¡¥0, ç„¶åæŒ‰ç…§å­¦å·åˆ†ç»„æ±‚å’Œ</strong></p><p>â€‹    </p><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-19-070624.png" alt="image-20180619150623836"></p><ul><li>ç„¶åæŒ‰ç…§ sid åˆ†ç»„æ±‚å’Œ/æ±‚æœ€å¤§å€¼, å°±å¯ä»¥äº†</li><li>åŒä¸€åˆ—ä¸åŒçš„æ”¾åœ¨ä¸åŒçš„åˆ—ä¸Š, å¸¸ç”¨çš„æ–¹æ³•</li></ul><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-19-071819.png" alt="image-20180619151819409"></p><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-19-072342.png" alt="image-20180619152341523"></p><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-19-072352.png" alt="image-20180619152351866"></p><hr><p>é¢è¯•é¢˜4</p><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-19-075926.png" alt="image-20180619155925871"></p><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-19-080134.png" alt="image-20180619160134008"></p><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-19-080605.png" alt="image-20180619160604750"></p><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-19-080942.png" alt="image-20180619160941777"></p><p>array_contains()</p><p>desc function array_contains()</p><ul><li><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-19-081706.jpg?ff=fh3" alt=""></li></ul><ul><li><p>è‡ªå®šä¹‰å‡½æ•°</p><ul><li>UDF</li></ul></li></ul><hr><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-19-082423.png" alt="image-20180619162423281"></p><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-19-084428.png" alt="image-20180619164428063"></p><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-19-084655.png" alt="image-20180619164654514"></p><h1 id="15-Hive-æ€§èƒ½è°ƒä¼˜"><a href="#15-Hive-æ€§èƒ½è°ƒä¼˜" class="headerlink" title="15. Hive æ€§èƒ½è°ƒä¼˜"></a>15. Hive æ€§èƒ½è°ƒä¼˜</h1><h3 id="15-1-ä»€ä¹ˆæ—¶å€™å¯ä»¥é¿å…æ‰§è¡ŒMapReduceï¼Ÿ"><a href="#15-1-ä»€ä¹ˆæ—¶å€™å¯ä»¥é¿å…æ‰§è¡ŒMapReduceï¼Ÿ" class="headerlink" title="15.1 ä»€ä¹ˆæ—¶å€™å¯ä»¥é¿å…æ‰§è¡ŒMapReduceï¼Ÿ"></a>15.1 ä»€ä¹ˆæ—¶å€™å¯ä»¥é¿å…æ‰§è¡ŒMapReduceï¼Ÿ</h3><ul><li><p><code>select *  or  select field1,field2</code></p></li><li><p><code>limite 10</code></p></li><li><p>whereè¯­å¥ä¸­åªæœ‰åˆ†åŒºå­—æ®µ</p></li><li><p>ä½¿ç”¨æœ¬åœ°<code>set hive.exec.mode.local.auto=true;</code></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> t3;</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">name</span>,age <span class="keyword">from</span> t3;</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">name</span>,age <span class="keyword">from</span> t3 <span class="keyword">limit</span> <span class="number">2</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">name</span>,age <span class="keyword">from</span> t3 <span class="keyword">where</span> age=<span class="number">25</span>;</span><br><span class="line"># å½“ where æ˜¯æœ¬åœ°å­—æ®µ(åˆ—ä¸­çš„å­—æ®µ), æ˜¯ä¸èµ° MRçš„</span><br></pre></td></tr></table></figure></li><li><p>group byè¯­å¥ï¼š</p><ul><li>é€šå¸¸å’Œèšåˆå‡½æ•°ä¸€èµ·ä½¿ç”¨ï¼ŒæŒ‰ç…§ä¸€ä¸ªæˆ–è€…å¤šä¸ªåˆ—å¯¹ç»“æœè¿›è¡Œåˆ†ç»„ï¼Œç„¶åå¯¹æ¯ç»„æ‰§è¡Œèšåˆæ“ä½œ</li></ul></li><li>havingè¯­å¥ï¼š<ul><li>é™åˆ¶ç»“æœçš„è¾“å‡º</li></ul></li><li>hiveå°†æŸ¥è¯¢è½¬åŒ–ä¸ºMapReduceæ‰§è¡Œï¼Œhiveçš„ä¼˜åŒ–å¯ä»¥è½¬åŒ–ä¸ºmapreduceçš„ä¼˜åŒ–ï¼</li></ul><h3 id="15-2-hiveæ˜¯å¦‚ä½•å°†æŸ¥è¯¢è½¬åŒ–ä¸ºMapReduceçš„ï¼Ÿ-EXPLAINçš„ä½¿ç”¨"><a href="#15-2-hiveæ˜¯å¦‚ä½•å°†æŸ¥è¯¢è½¬åŒ–ä¸ºMapReduceçš„ï¼Ÿ-EXPLAINçš„ä½¿ç”¨" class="headerlink" title="15.2 hiveæ˜¯å¦‚ä½•å°†æŸ¥è¯¢è½¬åŒ–ä¸ºMapReduceçš„ï¼Ÿ-EXPLAINçš„ä½¿ç”¨"></a><strong>15.2 hiveæ˜¯å¦‚ä½•å°†æŸ¥è¯¢è½¬åŒ–ä¸ºMapReduceçš„ï¼Ÿ-EXPLAINçš„ä½¿ç”¨</strong></h3><ul><li>hiveå¯¹sqlçš„æŸ¥è¯¢è®¡åˆ’ä¿¡æ¯è§£æ</li><li><p>EXPLAIN SELECT COUNT(1) FROM T1;</p></li><li><p><strong>EXPLAIN EXTENDED</strong> </p><ul><li><p><strong>æ˜¾ç¤ºè¯¦ç»†æ‰©å±•æŸ¥è¯¢è®¡åˆ’ä¿¡æ¯</strong></p></li><li><p><strong><code>EXPLAIN EXTENDED SELECT COUNT(1) FROM T1;</code></strong></p></li><li><p>ä¸ºå•¥æˆ‘çš„ explain extended åªæœ‰å›ºå®šçš„å‡ è¡Œ?</p><ul><li><strong>å› ä¸ºè¿™ä¸ª count æ²¡æœ‰è°ƒåŠ¨ MR, ç”¨ sum å°±ä¼šå¯ç”¨ MR, ä¼šå‡ºç°é•¿é•¿çš„ log</strong></li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">---ä¸ä¼šå¯ç”¨ MR</span></span><br><span class="line">hive (mydb)&gt; explain EXTENDED select count(1) from t9;</span><br><span class="line"><span class="comment">---</span></span><br><span class="line"><span class="keyword">Explain</span></span><br><span class="line">STAGE DEPENDENCIES:</span><br><span class="line">  Stage<span class="number">-0</span> <span class="keyword">is</span> a root stage</span><br><span class="line">  ...</span><br><span class="line"><span class="comment">-----------------------------</span></span><br><span class="line"><span class="comment">---è¿™é‡Œä¼šå¯ç”¨ MR</span></span><br><span class="line">hive (mydb)&gt; <span class="keyword">explain</span> <span class="keyword">EXTENDED</span> <span class="keyword">select</span> <span class="keyword">sum</span>(<span class="keyword">id</span>) <span class="keyword">from</span> t9;</span><br><span class="line"><span class="comment">---</span></span><br><span class="line"><span class="keyword">Explain</span></span><br><span class="line">STAGE DEPENDENCIES:</span><br><span class="line">  Stage<span class="number">-1</span> <span class="keyword">is</span> a root stage</span><br><span class="line">  Stage<span class="number">-0</span> depends <span class="keyword">on</span> stages: Stage<span class="number">-1</span></span><br><span class="line"></span><br><span class="line">STAGE PLANS:</span><br><span class="line">  Stage: Stage<span class="number">-1</span></span><br><span class="line">  ....</span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="15-3-æ€§èƒ½è°ƒä¼˜"><a href="#15-3-æ€§èƒ½è°ƒä¼˜" class="headerlink" title="15.3 æ€§èƒ½è°ƒä¼˜"></a>15.3 æ€§èƒ½è°ƒä¼˜</h3><h4 id="15-3-1-æœ¬åœ°mr"><a href="#15-3-1-æœ¬åœ°mr" class="headerlink" title="15.3.1 æœ¬åœ°mr"></a>15.3.1 æœ¬åœ°mr</h4><ul><li><p><strong>æœ¬åœ°æ¨¡å¼è®¾ç½®æ–¹å¼ï¼š</strong></p><ul><li><code>set mapred.job.tracker=local;</code><ul><li>mapper çš„æœ¬åœ°æ¨¡å¼, <strong>åªæœ‰åœ¨å¼€å‘ä¸­æ‰ä¼šä½¿ç”¨</strong></li></ul></li><li><strong><code>set hive.exec.mode.local.auto=true;</code></strong><ul><li><strong>Hive çš„æ‰§è¡Œæ¨¡å¼</strong></li><li><strong>å¯ä»¥ç”¨åœ¨ç”Ÿäº§ä¸­</strong>, å› ä¸ºæ˜¯è‡ªåŠ¨æ¨¡å¼, å¯æ ¹æ®å‚æ•°å˜åŒ–</li><li><strong>è®¾ç½®è¿™é‡Œæ‰ä¼šè½¬æˆ local  hadoop</strong></li><li>æŒ‰ç…§è¿™é‡Œè®¾å®šçš„è§„åˆ™<code>hive.exec.mode.local.auto.input.files.max</code></li></ul></li><li>æµ‹è¯• select 1 from wlan limit 5;</li></ul></li><li><p><strong>ä¸‹é¢ä¸¤ä¸ªå‚æ•°æ˜¯local mrä¸­å¸¸ç”¨çš„æ§åˆ¶å‚æ•°:</strong></p><ul><li><p><code>hive.exec.mode.local.auto.inputbytes.max</code>é»˜è®¤134217728</p><ul><li><strong>è®¾ç½®local mrçš„æœ€å¤§è¾“å…¥æ•°æ®é‡</strong>,å½“è¾“å…¥æ•°æ®é‡å°äºè¿™ä¸ªå€¼çš„æ—¶å€™ä¼šé‡‡ç”¨local  mrçš„æ–¹å¼</li></ul></li><li><p><strong><code>hive.exec.mode.local.auto.input.files.max</code>é»˜è®¤æ˜¯4</strong></p><ul><li><p>è®¾ç½®local mrçš„æœ€å¤§è¾“å…¥æ–‡ä»¶ä¸ªæ•°,å½“è¾“å…¥æ–‡ä»¶ä¸ªæ•°å°äºè¿™ä¸ªå€¼çš„æ—¶å€™ä¼šé‡‡ç”¨local mrçš„æ–¹å¼</p></li><li><p>å¤§äºæ­¤æ•°æ—¶, å°±ä¸ä¼šè½¬åŒ–ä¸º local hadoop</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cannot run job locally: Number of Input Files (= 6) is larger than hive.exec.mode.local.auto.input.files.max(= 4)</span><br></pre></td></tr></table></figure></li><li><p><strong>å¯ä»¥è¿™æ ·ä¿®æ”¹local mrçš„æœ€å¤§è¾“å…¥æ–‡ä»¶ä¸ªæ•°å€¼, ä¸»è¦åœ¨è°ƒè¯•é˜¶æ®µä½¿ç”¨</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hive (mydb)&gt; set hive.exec.mode.local.auto.input.files.max=8;</span><br><span class="line"></span><br><span class="line"># è¿™æ ·è®¾ç½®äº†ä¹‹å, åªè¦æ–‡ä»¶æ•°&lt;=8, å°±ä¼šåœ¨æœ¬åœ°è¿è¡Œ</span><br><span class="line">Job running in-process (local Hadoop)</span><br></pre></td></tr></table></figure></li></ul></li></ul></li></ul><h4 id="15-3-2-å¼€å¯å¹¶è¡Œè®¡ç®—"><a href="#15-3-2-å¼€å¯å¹¶è¡Œè®¡ç®—" class="headerlink" title="15.3.2 å¼€å¯å¹¶è¡Œè®¡ç®—"></a>15.3.2 å¼€å¯å¹¶è¡Œè®¡ç®—</h4><ul><li>å¼€å¯å¹¶è¡Œè®¡ç®—,å¢åŠ é›†ç¾¤çš„åˆ©ç”¨ç‡<ul><li><code>set hive.exec.parallel=true;</code></li></ul></li></ul><h4 id="15-3-3-è®¾ç½®ä¸¥æ ¼æ¨¡å¼"><a href="#15-3-3-è®¾ç½®ä¸¥æ ¼æ¨¡å¼" class="headerlink" title="15.3.3 è®¾ç½®ä¸¥æ ¼æ¨¡å¼"></a>15.3.3 è®¾ç½®ä¸¥æ ¼æ¨¡å¼</h4><ul><li><strong>è®¾ç½®ä¸¥æ ¼æ¨¡å¼</strong><ul><li><code>set hive.mapred.mode=strict;</code></li></ul></li><li>è®¾ç½®éä¸¥æ ¼æ¨¡å¼<ul><li><code>set hive.mapred.mode=nonstrict;</code></li></ul></li><li><strong>strictå¯ä»¥ç¦æ­¢ä¸‰ç§ç±»å‹çš„æŸ¥è¯¢ï¼š</strong><ul><li>å¼ºåˆ¶åˆ†åŒºè¡¨çš„whereæ¡ä»¶è¿‡æ»¤</li><li>Order byè¯­å¥å¿…é¡»ä½¿ç”¨limit<ul><li><code>hive (mydb)&gt; select id from t9 where class=&#39;job110&#39; order by id limit 3;</code></li></ul></li><li>é™åˆ¶ç¬›å¡å°”ç§¯æŸ¥è¯¢</li></ul></li></ul><h4 id="15-3-4-è°ƒæ•´mapperå’Œreducerçš„æ•°é‡"><a href="#15-3-4-è°ƒæ•´mapperå’Œreducerçš„æ•°é‡" class="headerlink" title="15.3.4 è°ƒæ•´mapperå’Œreducerçš„æ•°é‡"></a>15.3.4 è°ƒæ•´mapperå’Œreducerçš„æ•°é‡</h4><ul><li>è°ƒæ•´mapperå’Œreducerçš„æ•°é‡<ul><li>å¤ªå¤šmapå¯¼è‡´å¯åŠ¨äº§ç”Ÿè¿‡å¤šå¼€é”€</li><li><code>marpred.min.split.size</code></li><li>æŒ‰ç…§è¾“å…¥æ•°æ®é‡å¤§å°ç¡®å®šreduceræ•°ç›®,<ul><li>`set mapred.reduce.tasks=  é»˜è®¤3</li><li>dfs -count  /åˆ†åŒºç›®å½•/* </li><li>hive.exec.reducers.maxè®¾ç½®é˜»æ­¢èµ„æºè¿‡åº¦æ¶ˆè€—</li></ul></li></ul></li><li>JVMé‡ç”¨<ul><li>å°æ–‡ä»¶å¤šæˆ–taskå¤šçš„ä¸šåŠ¡åœºæ™¯</li><li>set mapred.job.reuse.jvm.num.task=10</li><li>ä¼šä¸€ç›´å ç”¨taskæ§½</li></ul></li></ul><h4 id="15-3-5-æ’åºæ–¹é¢çš„ä¼˜åŒ–"><a href="#15-3-5-æ’åºæ–¹é¢çš„ä¼˜åŒ–" class="headerlink" title="15.3.5 æ’åºæ–¹é¢çš„ä¼˜åŒ–"></a>15.3.5 æ’åºæ–¹é¢çš„ä¼˜åŒ–</h4><ul><li><p><strong>order by</strong> è¯­å¥ï¼šæ˜¯<strong>å…¨å±€</strong>æ’åº, ç”¨çš„æ¯”è¾ƒå¤š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># åŠ ä¸ª desc å°±æ˜¯å€’åºæ’åº</span><br><span class="line">hive (mydb)&gt; select id from bucket_table order by id desc limit 10;</span><br><span class="line">Automatically selecting local only mode for query</span><br></pre></td></tr></table></figure><p> <strong>sort by</strong> è¯­å¥ï¼š      æ˜¯<strong>å•reduce</strong>æ’åº</p><ul><li>ä¸€èˆ¬ä¸ <code>distribute by</code>ç»“åˆä½¿ç”¨</li></ul></li><li><p><strong>distribute by</strong>è¯­å¥ï¼šç±»ä¼¼äºåˆ†æ¡¶ï¼Œ<strong>æ ¹æ®æŒ‡å®šçš„å­—æ®µ</strong>å°†<strong>æ•°æ®åˆ†åˆ°ä¸åŒçš„ reducer</strong>ï¼Œä¸”åˆ†å‘ç®—æ³•æ˜¯ <strong>hash æ•£åˆ—</strong></p><ul><li><p><strong>ä¸ sort by ç»“åˆç”¨çš„æ¯”è¾ƒå¤š</strong>, <strong>åœ¨æ¯ä¸ªåˆ†åŒºå†…æœ‰åº</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># æ³¨æ„æ­¤å¤„ distribute çš„ä½œç”¨</span><br><span class="line">hive (mydb)&gt; select id from bucket_table distribute by id sort by id desc limit 10;</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>cluster by</strong>è¯­å¥ï¼š</p><ul><li><code>select * from t9 cluster by id;</code></li><li>å¯ä»¥ç¡®ä¿ç±»ä¼¼çš„æ•°æ®çš„åˆ†å‘åˆ°åŒä¸€ä¸ªreduce taskä¸­ï¼Œå¹¶ä¸”ä¿è¯æ•°æ®æœ‰åº, é˜²æ­¢æ‰€æœ‰çš„æ•°æ®åˆ†å‘åˆ°åŒä¸€ä¸ªreduceä¸Šï¼Œå¯¼è‡´æ•´ä½“çš„jobæ—¶é—´å»¶é•¿</li></ul></li><li><p><strong>cluster byè¯­å¥çš„ç­‰ä»·è¯­å¥ï¼š</strong></p><ul><li><em>å¦‚æœåˆ†æ¡¶å’Œsortå­—æ®µæ˜¯åŒä¸€ä¸ªæ—¶ï¼Œæ­¤æ—¶ï¼Œcluster by = distribute by + sort by</em> </li><li><code>distribute by Word sort by Word ASC</code></li></ul></li></ul><h4 id="15-3-6-Map-sideèšåˆ"><a href="#15-3-6-Map-sideèšåˆ" class="headerlink" title="15.3.6 Map-sideèšåˆ"></a>15.3.6 Map-sideèšåˆ</h4><p><strong>å¯ä»¥ç›´æ¥åœ¨ <code>.hiverc</code>ä¸­é…ç½®</strong></p><ul><li><code>set hive.map.aggr=true;</code></li><li>è¿™ä¸ªè®¾ç½®å¯ä»¥å°†é¡¶å±‚çš„èšåˆæ“ä½œæ”¾åœ¨Mapé˜¶æ®µæ‰§è¡Œï¼Œä»è€Œå‡è½»æ¸…æ´—é˜¶æ®µæ•°æ®ä¼ è¾“å’ŒReduceé˜¶æ®µçš„æ‰§è¡Œæ—¶é—´ï¼Œæå‡æ€»ä½“æ€§èƒ½ã€‚:TODO ä¸å¤ªæ‡‚</li><li>ç¼ºç‚¹ï¼šè¯¥è®¾ç½®ä¼šæ¶ˆè€—æ›´å¤šçš„å†…å­˜ã€‚</li><li>æ‰§è¡Œselect count(1) from wlan;</li></ul><h4 id="15-3-6-Join-ä¼˜åŒ–"><a href="#15-3-6-Join-ä¼˜åŒ–" class="headerlink" title="15.3.6 Join ä¼˜åŒ–"></a>15.3.6 Join ä¼˜åŒ–</h4><ul><li>ä¼˜å…ˆè¿‡æ»¤åå†è¿›è¡Œ Join æ“ä½œï¼Œæœ€å¤§é™åº¦çš„å‡å°‘å‚ä¸ join çš„æ•°æ®é‡</li><li>å°è¡¨ join å¤§è¡¨ï¼Œæœ€å¥½å¯åŠ¨ mapjoin<ul><li>åœ¨ä½¿ç”¨å†™æœ‰ Join æ“ä½œçš„æŸ¥è¯¢è¯­å¥æ—¶æœ‰ä¸€æ¡åŸåˆ™:åº”è¯¥å°†æ¡ç›®å°‘çš„è¡¨/å­æŸ¥è¯¢æ”¾åœ¨ Join æ“ä½œ ç¬¦çš„å·¦è¾¹ã€‚ </li></ul></li><li>Join on çš„æ¡ä»¶ç›¸åŒçš„è¯ï¼Œæœ€å¥½æ”¾å…¥åŒä¸€ä¸ª jobï¼Œå¹¶ä¸” join è¡¨çš„æ’åˆ—é¡ºåºä»å°åˆ°å¤§</li></ul><blockquote><p>åœ¨ç¼–å†™ Join æŸ¥è¯¢è¯­å¥æ—¶ï¼Œå¦‚æœç¡®å®šæ˜¯ç”±äº join å‡ºç°çš„æ•°æ®å€¾æ–œï¼Œé‚£ä¹ˆè¯·åšå¦‚ä¸‹è®¾ç½®:</p><p>set hive.skewjoin.key=100000; // è¿™ä¸ªæ˜¯ join çš„é”®å¯¹åº”çš„è®°å½•æ¡æ•°è¶…è¿‡è¿™ä¸ªå€¼åˆ™ä¼šè¿›è¡Œ</p><p>åˆ†æ‹†ï¼Œå€¼æ ¹æ®å…·ä½“æ•°æ®é‡è®¾ç½®</p><p>set hive.optimize.skewjoin=true; // å¦‚æœæ˜¯ join è¿‡ç¨‹å‡ºç°å€¾æ–œåº”è¯¥è®¾ç½®ä¸º true</p></blockquote><h1 id="16-è¡¨è¿æ¥-åªæ”¯æŒç­‰å€¼è¿æ¥"><a href="#16-è¡¨è¿æ¥-åªæ”¯æŒç­‰å€¼è¿æ¥" class="headerlink" title="16. è¡¨è¿æ¥  (åªæ”¯æŒç­‰å€¼è¿æ¥)"></a>16. è¡¨è¿æ¥  (åªæ”¯æŒç­‰å€¼è¿æ¥)</h1><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-16-071623.jpg" alt=""></p><h3 id="16-1-ç®€ä»‹"><a href="#16-1-ç®€ä»‹" class="headerlink" title="16.1 ç®€ä»‹"></a>16.1 ç®€ä»‹</h3><ul><li><p>INNER JOIN</p><ul><li>ä¸¤å¼ è¡¨ä¸­éƒ½æœ‰ï¼Œä¸”ä¸¤è¡¨ç¬¦åˆè¿æ¥æ¡ä»¶</li><li>select t1.name,t1.age,t9.age from t9 join t1 on t1.name=t9.name;</li></ul></li><li><p><strong>LEFT OUTER JOIN</strong></p><ul><li>å·¦è¡¨ä¸­ç¬¦åˆwhereæ¡ä»¶å‡ºç°ï¼Œå³è¡¨å¯ä»¥ä¸ºç©º</li><li><strong>ä»å·¦è¡¨è¿”å›æ‰€æœ‰çš„è¡Œ(å­—æ®µ), å³è¡¨æ²¡æœ‰åŒ¹é…where æ¡ä»¶çš„è¯è¿”å›null</strong></li></ul></li><li><p>RIGHT OUTER JOIN</p><ul><li>å³è¡¨ä¸­ç¬¦åˆwhereæ¡ä»¶å‡ºç°ï¼Œå·¦è¡¨å¯ä»¥ä¸ºç©º</li></ul></li><li><p>FULL OUTER JOIN</p><ul><li>è¿”å›æ‰€æœ‰è¡¨ç¬¦åˆwhereæ¡ä»¶çš„æ‰€æœ‰è®°å½•ï¼Œæ²¡æœ‰NULLæ›¿ä»£</li></ul></li><li><p><strong>LEFT SEMI-JOIN</strong></p><ul><li><p>å·¦è¡¨ä¸­ç¬¦åˆå³è¡¨onæ¡ä»¶å‡ºç°ï¼Œå³è¡¨ä¸å‡ºç°</p></li><li><p>Hive å½“å‰<strong>æ²¡æœ‰å®ç° IN/EXISTS å­æŸ¥è¯¢ï¼Œå¯ä»¥ç”¨ LEFT SEMI JOIN é‡å†™å­æŸ¥è¯¢è¯­å¥</strong>ã€‚LEFT SEMI JOIN çš„é™åˆ¶æ˜¯ï¼Œ JOIN å­å¥ä¸­å³è¾¹çš„è¡¨åªèƒ½åœ¨ ON å­å¥ä¸­è®¾ç½®è¿‡æ»¤æ¡ä»¶ï¼Œåœ¨ WHERE å­å¥ã€SELECT å­å¥æˆ–å…¶ä»–åœ°æ–¹è¿‡æ»¤éƒ½ä¸è¡Œã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> a.key, a.value <span class="keyword">FROM</span> a</span><br><span class="line"><span class="keyword">WHERE</span> a.key <span class="keyword">in</span> (<span class="keyword">SELECT</span> b.key <span class="keyword">FROM</span> B);</span><br><span class="line"></span><br><span class="line"># å¯ä»¥è¢«é‡å†™ä¸ºï¼š</span><br><span class="line"><span class="keyword">SELECT</span> a.key, a.val <span class="keyword">FROM</span> a <span class="keyword">LEFT</span> SEMI <span class="keyword">JOIN</span> b <span class="keyword">on</span> (a.key = b.key)</span><br></pre></td></tr></table></figure></li></ul></li><li><p>ç¬›å¡å°”ç§¯</p><ul><li>æ˜¯m x nçš„ç»“æœ</li></ul></li><li><p><strong>map-side JOIN</strong></p><ul><li>åªæœ‰ä¸€å¼ å°è¡¨ï¼Œåœ¨mapperçš„æ—¶å€™å°†å°è¡¨å®Œå…¨æ”¾åœ¨å†…å­˜ä¸­</li><li>select /<em>+ mapjoin(t9) </em>/t1.name,t1.age from t9 JOIN t1on t1.name=t9.name;</li></ul></li></ul><h3 id="16-2-ä»£ç æµ‹è¯•"><a href="#16-2-ä»£ç æµ‹è¯•" class="headerlink" title="16.2  ä»£ç æµ‹è¯•"></a>16.2  ä»£ç æµ‹è¯•</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">å…³äºhiveä¸­çš„å„ç§join</span><br><span class="line"></span><br><span class="line">å‡†å¤‡æ•°æ®</span><br><span class="line">1,a</span><br><span class="line">2,b</span><br><span class="line">3,c</span><br><span class="line">4,d</span><br><span class="line">7,y</span><br><span class="line">8,u</span><br><span class="line"></span><br><span class="line">2,bb</span><br><span class="line">3,cc</span><br><span class="line">7,yy</span><br><span class="line">9,pp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">å»ºè¡¨ï¼š</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> a(<span class="keyword">id</span> <span class="built_in">int</span>,<span class="keyword">name</span> <span class="keyword">string</span>)</span><br><span class="line"><span class="keyword">row</span> <span class="keyword">format</span> <span class="keyword">delimited</span> <span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">','</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> b(<span class="keyword">id</span> <span class="built_in">int</span>,<span class="keyword">name</span> <span class="keyword">string</span>)</span><br><span class="line"><span class="keyword">row</span> <span class="keyword">format</span> <span class="keyword">delimited</span> <span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">','</span>;</span><br><span class="line"></span><br><span class="line">å¯¼å…¥æ•°æ®ï¼š</span><br><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> <span class="keyword">local</span> inpath <span class="string">'/home/hadoop/a.txt'</span> <span class="keyword">into</span> <span class="keyword">table</span> a;</span><br><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> <span class="keyword">local</span> inpath <span class="string">'/home/hadoop/b.txt'</span> <span class="keyword">into</span> <span class="keyword">table</span> b;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">å®éªŒï¼š</span><br><span class="line">** inner join</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> a <span class="keyword">inner</span> <span class="keyword">join</span> b <span class="keyword">on</span> a.id=b.id;</span><br><span class="line">+<span class="comment">-------+---------+-------+---------+--+</span></span><br><span class="line">| a.id  | a.name  | b.id  | b.name  |</span><br><span class="line">+<span class="comment">-------+---------+-------+---------+--+</span></span><br><span class="line">| 2     | b       | 2     | bb      |</span><br><span class="line">| 3     | c       | 3     | cc      |</span><br><span class="line">| 7     | y       | 7     | yy      |</span><br><span class="line">+<span class="comment">-------+---------+-------+---------+--+</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**left join</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> a <span class="keyword">left</span> <span class="keyword">join</span> b <span class="keyword">on</span> a.id=b.id;</span><br><span class="line">+<span class="comment">-------+---------+-------+---------+--+</span></span><br><span class="line">| a.id  | a.name  | b.id  | b.name  |</span><br><span class="line">+<span class="comment">-------+---------+-------+---------+--+</span></span><br><span class="line">| 1     | a       | NULL  | NULL    |</span><br><span class="line">| 2     | b       | 2     | bb      |</span><br><span class="line">| 3     | c       | 3     | cc      |</span><br><span class="line">| 4     | d       | NULL  | NULL    |</span><br><span class="line">| 7     | y       | 7     | yy      |</span><br><span class="line">| 8     | u       | NULL  | NULL    |</span><br><span class="line">+<span class="comment">-------+---------+-------+---------+--+</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**right join</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> a <span class="keyword">right</span> <span class="keyword">join</span> b <span class="keyword">on</span> a.id=b.id;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> a <span class="keyword">full</span> <span class="keyword">outer</span> <span class="keyword">join</span> b <span class="keyword">on</span> a.id=b.id;</span><br><span class="line">+<span class="comment">-------+---------+-------+---------+--+</span></span><br><span class="line">| a.id  | a.name  | b.id  | b.name  |</span><br><span class="line">+<span class="comment">-------+---------+-------+---------+--+</span></span><br><span class="line">| 1     | a       | NULL  | NULL    |</span><br><span class="line">| 2     | b       | 2     | bb      |</span><br><span class="line">| 3     | c       | 3     | cc      |</span><br><span class="line">| 4     | d       | NULL  | NULL    |</span><br><span class="line">| 7     | y       | 7     | yy      |</span><br><span class="line">| 8     | u       | NULL  | NULL    |</span><br><span class="line">| NULL  | NULL    | 9     | pp      |</span><br><span class="line">+<span class="comment">-------+---------+-------+---------+--+</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> a <span class="keyword">left</span> semi <span class="keyword">join</span> b <span class="keyword">on</span> a.id = b.id;</span><br><span class="line">+<span class="comment">-------+---------+--+</span></span><br><span class="line">| a.id  | a.name  |</span><br><span class="line">+<span class="comment">-------+---------+--+</span></span><br><span class="line">| 2     | b       |</span><br><span class="line">| 3     | c       |</span><br><span class="line">| 7     | y       |</span><br><span class="line">+<span class="comment">-------+---------+--+</span></span><br></pre></td></tr></table></figure><p><br></p><h1 id="17-Hiveè‡ªå®šä¹‰å‡½æ•°-amp-Transform"><a href="#17-Hiveè‡ªå®šä¹‰å‡½æ•°-amp-Transform" class="headerlink" title="17.  Hiveè‡ªå®šä¹‰å‡½æ•° &amp; Transform"></a>17.  Hiveè‡ªå®šä¹‰å‡½æ•° &amp; Transform</h1><h3 id="17-1-è‡ªå®šä¹‰å‡½æ•°ç±»åˆ«"><a href="#17-1-è‡ªå®šä¹‰å‡½æ•°ç±»åˆ«" class="headerlink" title="17.1 è‡ªå®šä¹‰å‡½æ•°ç±»åˆ«"></a>17.1 è‡ªå®šä¹‰å‡½æ•°ç±»åˆ«</h3><ul><li><strong>UDF</strong>  <ul><li>ä½œç”¨äºå•ä¸ªæ•°æ®è¡Œï¼Œäº§ç”Ÿä¸€ä¸ªæ•°æ®è¡Œä½œä¸ºè¾“å‡ºã€‚ï¼ˆæ•°å­¦å‡½æ•°ï¼Œå­—ç¬¦ä¸²å‡½æ•°ï¼‰</li></ul></li><li><strong>UDAF</strong><ul><li>(ç”¨æˆ·å®šä¹‰èšé›†å‡½æ•°)ï¼šæ¥æ”¶å¤šä¸ªè¾“å…¥æ•°æ®è¡Œï¼Œå¹¶äº§ç”Ÿä¸€ä¸ªè¾“å‡ºæ•°æ®è¡Œã€‚ï¼ˆcountï¼Œmaxï¼‰</li></ul></li></ul><h3 id="17-2-UDF-å¼€å‘å®ä¾‹"><a href="#17-2-UDF-å¼€å‘å®ä¾‹" class="headerlink" title="17.2 UDF å¼€å‘å®ä¾‹"></a>17.2 UDF å¼€å‘å®ä¾‹</h3><h4 id="17-2-1-ç®€å•å…¥é—¨"><a href="#17-2-1-ç®€å•å…¥é—¨" class="headerlink" title="17.2.1 ç®€å•å…¥é—¨"></a>17.2.1 ç®€å•å…¥é—¨</h4><ul><li><p>å…ˆå¼€å‘ä¸€ä¸ªjavaç±»ï¼Œç»§æ‰¿UDFï¼Œå¹¶é‡è½½evaluateæ–¹æ³• </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.rox.hive.udf;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hive.ql.exec.UDF;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ToLowerCase</span> <span class="keyword">extends</span> <span class="title">UDF</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¿…é¡»æ˜¯ public</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">evaluate</span><span class="params">(String field)</span> </span>&#123;</span><br><span class="line">String res = field.toLowerCase();</span><br><span class="line"><span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>æ‰“æˆjaråŒ…ä¸Šä¼ åˆ°æœåŠ¡å™¨ </p></li><li><p>å°†jaråŒ…æ·»åŠ åˆ°hiveçš„classpath </p><ul><li><code>hive&gt;add JAR /home/ap/udf.jar;</code></li></ul></li><li><p>åˆ›å»ºä¸´æ—¶å‡½æ•°ä¸å¼€å‘å¥½çš„java classå…³è” </p><ul><li><code>Hive&gt;create temporary function tolowercase as &#39;com.rox.hive.udf.ToLowerCase&#39;;</code></li></ul></li><li><p>å³å¯åœ¨hqlä¸­ä½¿ç”¨è‡ªå®šä¹‰çš„å‡½æ•°strip  </p><ul><li><code>select tolowercase(name) from t_1..</code></li></ul></li></ul><h4 id="17-2-2-ç¨ç¨å¤æ‚"><a href="#17-2-2-ç¨ç¨å¤æ‚" class="headerlink" title="17.2.2 ç¨ç¨å¤æ‚"></a>17.2.2 ç¨ç¨å¤æ‚</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"># éœ€æ±‚: é€šè¿‡ä¸€äº›æ‰‹æœºå·åˆ¤æ–­æ‰‹æœºåŒºåŸŸ</span><br><span class="line">1364535532,10</span><br><span class="line">1374535532,42</span><br><span class="line">1384535532,34</span><br><span class="line">1364535532,45</span><br><span class="line">1384535532,22</span><br><span class="line">136-beijing</span><br><span class="line">137-shanghai</span><br><span class="line">138-guangzhou</span><br><span class="line"><span class="comment">-----</span></span><br><span class="line"></span><br><span class="line">## 1.ç¼–å†™ UDF</span><br><span class="line">public static HashMap&lt;String, String&gt; provinceMap = new HashMap&lt;String, String&gt;();</span><br><span class="line">static &#123;</span><br><span class="line">provinceMap.put("136", "beijing");</span><br><span class="line">provinceMap.put("136", "shanghai");</span><br><span class="line">provinceMap.put("136", "guangzhou");</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public String evaluate(String phoneNum) &#123;</span><br><span class="line">return provinceMap.get(phoneNum.substring(0, 3)) == null ? "huoxing" : provinceMap.get(phoneNum.substring(0, 3));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">## 2.æ‰“åŒ…ä¸Šä¼ , æ·»åŠ åˆ° classpath, åˆ›å»ºä¸´æ—¶å‡½æ•°</span><br><span class="line"></span><br><span class="line">## 3.åˆ›å»ºè¡¨,åŠ è½½æ•°æ®</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> flow_t(pnum <span class="keyword">string</span>,flow <span class="built_in">int</span>)</span><br><span class="line"><span class="keyword">row</span> <span class="keyword">format</span> <span class="keyword">delimited</span> <span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">','</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> <span class="keyword">local</span> inpath <span class="string">'/home/ap/ihivedata/flow.tmp'</span> <span class="keyword">into</span> <span class="keyword">table</span> flow_t;</span><br><span class="line"></span><br><span class="line">## 4.ä½¿ç”¨</span><br><span class="line">0: jdbc:hive2://cs2:10000&gt; select pnum,tolow(pnum),flow from flow_t;</span><br><span class="line">+<span class="comment">-------------+------------+-------+</span></span><br><span class="line">|    pnum     |    _c1     | flow  |</span><br><span class="line">+<span class="comment">-------------+------------+-------+</span></span><br><span class="line">| 1364535532  | guangzhou  | 10    |</span><br><span class="line">| 1374535532  | huoxing    | 42    |</span><br><span class="line">| 1384535532  | huoxing    | 34    |</span><br><span class="line">| 1364535532  | guangzhou  | 45    |</span><br><span class="line">| 1384535532  | huoxing    | 22    |</span><br><span class="line">+<span class="comment">-------------+------------+-------+</span></span><br></pre></td></tr></table></figure><h4 id="17-2-3-æœ‰äº›å¤æ‚"><a href="#17-2-3-æœ‰äº›å¤æ‚" class="headerlink" title="17.2.3  æœ‰äº›å¤æ‚"></a>17.2.3  æœ‰äº›å¤æ‚</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"># è§£æ json æ•°æ®è¡¨ rating.json</span><br><span class="line">## 1. å†™ udf</span><br><span class="line"></span><br><span class="line"><span class="comment">//ï£¿ï£¿ï£¿ï£¿ï£¿ com.rox.json.MovieRateBean ï£¿ï£¿ï£¿ï£¿</span></span><br><span class="line"><span class="keyword">package</span> com.rox.json;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MovieRateBean</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> String movie;</span><br><span class="line"><span class="keyword">private</span> String rate;</span><br><span class="line"><span class="keyword">private</span> String timeStamp;</span><br><span class="line"><span class="keyword">private</span> String uid;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> movie + <span class="string">"\t"</span> + rate + <span class="string">"\t"</span></span><br><span class="line">+ timeStamp + <span class="string">"\t"</span> + uid;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ï£¿ï£¿ï£¿ï£¿ com.rox.json.JsonParser ï£¿ï£¿ï£¿ï£¿</span></span><br><span class="line"><span class="keyword">package</span> com.rox.json;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hive.ql.exec.UDF;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JsonParser</span> <span class="keyword">extends</span> <span class="title">UDF</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">evaluate</span><span class="params">(String jsonLine)</span> </span>&#123;</span><br><span class="line">ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">MovieRateBean bean = objectMapper.readValue(jsonLine, MovieRateBean.class);</span><br><span class="line"><span class="keyword">return</span> bean.toString();</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">====================================================</span><br><span class="line">## 2.æ‰“åŒ…ä¸Šä¼ , æ·»åŠ åˆ° classpath, åˆ›å»ºä¸´æ—¶å‡½æ•°, æ£€æŸ¥æ˜¯å¦æˆåŠŸ</span><br><span class="line">show functions;</span><br><span class="line"></span><br><span class="line">## 3.åˆ›å»ºè¡¨,åŠ è½½æ•°æ®</span><br><span class="line"><span class="function">create table <span class="title">t_json</span><span class="params">(line string)</span> row format delimited</span>;</span><br><span class="line"></span><br><span class="line">load data local inpath <span class="string">'/home/ap/ihivedata/flow.log'</span> into table t_json;</span><br><span class="line"></span><br><span class="line">## 4.æ£€æŸ¥æ•°æ®</span><br><span class="line">select * from t_json limit <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">## 5.è°ƒç”¨å‡½æ•°</span><br><span class="line"><span class="number">0</span>: jdbc:hive2:<span class="comment">//cs2:10000&gt; select jsonparser(line)parsedline  from t_json limit 10;</span></span><br><span class="line">+---------------------+</span><br><span class="line">|     parsedline      |</span><br><span class="line">+---------------------+</span><br><span class="line">| <span class="number">1193</span><span class="number">5</span><span class="number">978300760</span><span class="number">1</span>  |</span><br><span class="line">| <span class="number">661</span><span class="number">3</span><span class="number">978302109</span><span class="number">1</span>   |</span><br><span class="line">| <span class="number">914</span><span class="number">3</span><span class="number">978301968</span><span class="number">1</span>   |</span><br><span class="line">| <span class="number">3408</span><span class="number">4</span><span class="number">978300275</span><span class="number">1</span>  |</span><br><span class="line">| <span class="number">2355</span><span class="number">5</span><span class="number">978824291</span><span class="number">1</span>  |</span><br><span class="line">| <span class="number">1197</span><span class="number">3</span><span class="number">978302268</span><span class="number">1</span>  |</span><br><span class="line">| <span class="number">1287</span><span class="number">5</span><span class="number">978302039</span><span class="number">1</span>  |</span><br><span class="line">| <span class="number">2804</span><span class="number">5</span><span class="number">978300719</span><span class="number">1</span>  |</span><br><span class="line">| <span class="number">594</span><span class="number">4</span><span class="number">978302268</span><span class="number">1</span>   |</span><br><span class="line">| <span class="number">919</span><span class="number">4</span><span class="number">978301368</span><span class="number">1</span>   |</span><br><span class="line">+---------------------+</span><br><span class="line"><span class="comment">// ä½†æ˜¯è¿™æ ·åªæ˜¯æŠŠæ¯ä¸€è¡Œè§£æå‡ºæ¥äº†,</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">## 6.åˆ é™¤åŸæ¥çš„è¡¨    </span><br><span class="line">drop table <span class="keyword">if</span> exists t_rating;</span><br><span class="line"></span><br><span class="line">## 7.é‡æ–°åˆ›å»ºä¸€ä¸ªè¡¨</span><br><span class="line"><span class="function">create table <span class="title">t_rating</span><span class="params">(movieid string,rate <span class="keyword">int</span>,timestring string,uid string)</span></span></span><br><span class="line"><span class="function">row format delimited fields terminated by '\t'</span>;</span><br><span class="line"></span><br><span class="line">## 8.æ ¹æ®æŸ¥å‡ºæ¥çš„æ¯ä¸€è¡Œ, æŒ‰ç…§ '\t'åˆ†å‰², ç„¶åå†æ’å…¥åˆ°è¡¨ä¸­</span><br><span class="line">create table  t_rating as</span><br><span class="line">select </span><br><span class="line">split(jsonparser(line),<span class="string">'\t'</span>)[<span class="number">0</span>]as movieid, split(jsonparser(line),<span class="string">'\t'</span>)[<span class="number">1</span>] as rate, split(jsonparser(line),<span class="string">'\t'</span>)[<span class="number">2</span>] as timestring, split(jsonparser(line),<span class="string">'\t'</span>)[<span class="number">3</span>] as uid   </span><br><span class="line">from t_json limit <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½†æ˜¯æ‰§è¡Œç»“æœä¼šæŠ¥é”™,ä¸çŸ¥é“ä¸ºå•¥,éš¾é“æ˜¯ java ä»£ç çš„é—®é¢˜? :TODO</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-------</span><br><span class="line">## 9.å†…ç½®jsonå‡½æ•°</span><br><span class="line"><span class="function">select <span class="title">get_json_object</span><span class="params">(line,<span class="string">'$.movie'</span>)</span> as moive,<span class="title">get_json_object</span><span class="params">(line,<span class="string">'$.rate'</span>)</span> as rate  from rat_json limit 10</span>;</span><br></pre></td></tr></table></figure><h4 id="17-3-Transformå®ç°"><a href="#17-3-Transformå®ç°" class="headerlink" title="17.3 Transformå®ç°"></a>17.3 Transformå®ç°</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"># 1ã€å…ˆåŠ è½½rating.jsonæ–‡ä»¶åˆ°hiveçš„ä¸€ä¸ªåŸå§‹è¡¨ t_json</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> rat_json(line <span class="keyword">string</span>) <span class="keyword">row</span> <span class="keyword">format</span> <span class="keyword">delimited</span>;</span><br><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> <span class="keyword">local</span> inpath <span class="string">'/home/ap/rating.json'</span> <span class="keyword">into</span> <span class="keyword">table</span> t_json;</span><br><span class="line"></span><br><span class="line">2ã€éœ€è¦è§£æjsonæ•°æ®æˆå››ä¸ªå­—æ®µï¼Œæ’å…¥ä¸€å¼ æ–°çš„è¡¨ t_rating</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">exists</span> t_rating;</span><br><span class="line"># åˆ›å»ºè¡¨</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_rating(movieid <span class="keyword">string</span>,rate <span class="built_in">int</span>,timestring <span class="keyword">string</span>,uid <span class="keyword">string</span>)</span><br><span class="line"><span class="keyword">row</span> <span class="keyword">format</span> <span class="keyword">delimited</span> <span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">'\t'</span>;</span><br><span class="line"></span><br><span class="line"># æ’å…¥, ä¹Ÿå¯ä»¥ç›´æ¥åˆ›å»º  create table xx as + select...</span><br><span class="line"><span class="keyword">insert</span> overwrite <span class="keyword">table</span> t_rating</span><br><span class="line"><span class="keyword">select</span> get_json_object(line,<span class="string">'$.movie'</span>) <span class="keyword">as</span> moiveid, get_json_object(line,<span class="string">'$.rate'</span>) <span class="keyword">as</span> rate, get_json_object(line,<span class="string">'$.timeStamp'</span>) <span class="keyword">as</span> timestring,</span><br><span class="line">get_json_object(line,<span class="string">'$.uid'</span>) <span class="keyword">as</span> uid </span><br><span class="line"><span class="keyword">from</span> t_json;</span><br><span class="line"></span><br><span class="line">3. å†™ä¸€ä¸ª python è„šæœ¬</span><br><span class="line">vi weekday_mapper.py</span><br><span class="line"></span><br><span class="line">#!/bin/python</span><br><span class="line">import sys</span><br><span class="line">import datetime</span><br><span class="line"></span><br><span class="line">for line in sys.stdin:</span><br><span class="line">  line = line.strip()</span><br><span class="line">  movieid, rating, timestring,userid = line.split('\t')</span><br><span class="line">  weekday = datetime.datetime.fromtimestamp(float(timestring)).isoweekday()</span><br><span class="line">  print '\t'.join([movieid, rating, str(weekday),userid])</span><br><span class="line">  </span><br><span class="line">4. ä¿å­˜æ–‡ä»¶, ç„¶åå°†æ–‡ä»¶åŠ å…¥ hive çš„ classpath</span><br><span class="line">hive&gt;add FILE /home/hadoop/weekday_mapper.py;</span><br><span class="line"></span><br><span class="line">5. æ­¤æ—¶å¯ä»¥ç›´æ¥åˆ›å»ºæ–°è¡¨</span><br><span class="line">hive&gt;create TABLE u_data_new as</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">  TRANSFORM (movieid, rate, timestring,uid)</span><br><span class="line">  <span class="keyword">USING</span> <span class="string">'python weekday_mapper.py'</span></span><br><span class="line">  <span class="keyword">AS</span> (movieid, rate, <span class="keyword">weekday</span>,uid)</span><br><span class="line"><span class="keyword">FROM</span> t_rating;</span><br><span class="line"></span><br><span class="line">6. æŸ¥è¯¢ç»“æœ</span><br><span class="line">## distinctçœ‹çœ‹æœ‰å¤šå°‘ä¸ªä¸é‡å¤çš„æ•°å­—</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span>(<span class="keyword">weekday</span>) <span class="keyword">from</span> u_data_new <span class="keyword">limit</span> <span class="number">10</span>;</span><br></pre></td></tr></table></figure><h1 id="18-æ¡ˆä¾‹"><a href="#18-æ¡ˆä¾‹" class="headerlink" title="18. æ¡ˆä¾‹"></a>18. æ¡ˆä¾‹</h1><h3 id="18-1-å¹¿å‘Šæ¨é€-ç”¨æˆ·ç”»åƒçš„ä»‹ç»"><a href="#18-1-å¹¿å‘Šæ¨é€-ç”¨æˆ·ç”»åƒçš„ä»‹ç»" class="headerlink" title="18.1 å¹¿å‘Šæ¨é€-ç”¨æˆ·ç”»åƒçš„ä»‹ç»"></a>18.1 å¹¿å‘Šæ¨é€-ç”¨æˆ·ç”»åƒçš„ä»‹ç»</h3><p><strong>ä¸€ä¸ªå¹¿å‘Šæ¨é€å¹³å°çš„é¡¹ç›®ç»“æ„ç¤ºæ„å›¾</strong></p><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-17-071714.png" alt="image-20180617151714445"></p><h3 id="18-2-ç´¯è®¡æŠ¥è¡¨å®ç°å¥—è·¯-é¢è¯•"><a href="#18-2-ç´¯è®¡æŠ¥è¡¨å®ç°å¥—è·¯-é¢è¯•" class="headerlink" title="18.2 ç´¯è®¡æŠ¥è¡¨å®ç°å¥—è·¯(é¢è¯•)"></a>18.2 ç´¯è®¡æŠ¥è¡¨å®ç°å¥—è·¯(é¢è¯•)</h3><p><strong>é¢˜:  æ±‚æ¯ä¸ªæœˆçš„ç´¯è®¡è®¿é—®æ¬¡æ•°</strong></p><p><strong>æ­¤å¤„çš„è®¿é—®æ¬¡æ•°å¯ä»¥æ¢æˆå·¥èµ„,ç­‰ç­‰..</strong></p><p><strong>æœ‰å¦‚ä¸‹è®¿å®¢è®¿é—®æ¬¡æ•°ç»Ÿè®¡è¡¨ t_access_times</strong></p><table><thead><tr><th>è®¿å®¢</th><th>æœˆä»½</th><th>è®¿é—®æ¬¡æ•°</th></tr></thead><tbody><tr><td>A</td><td>2015-01</td><td>5</td></tr><tr><td>A</td><td>2015-01</td><td>15</td></tr><tr><td>B</td><td>2015-01</td><td>5</td></tr><tr><td>A</td><td>2015-01</td><td>8</td></tr><tr><td>B</td><td>2015-01</td><td>25</td></tr><tr><td>A</td><td>2015-01</td><td>5</td></tr><tr><td>A</td><td>2015-02</td><td>4</td></tr><tr><td>A</td><td>2015-02</td><td>6</td></tr><tr><td>B</td><td>2015-02</td><td>10</td></tr><tr><td>B</td><td>2015-02</td><td>5</td></tr><tr><td>â€¦â€¦</td><td>â€¦â€¦</td><td>â€¦â€¦</td></tr></tbody></table><p><strong>éœ€è¦è¾“å‡ºæŠ¥è¡¨ï¼št_access_times_accumulate</strong></p><table><thead><tr><th>è®¿å®¢</th><th>æœˆä»½</th><th>æœˆè®¿é—®æ€»è®¡</th><th>ç´¯è®¡è®¿é—®æ€»è®¡</th></tr></thead><tbody><tr><td>A</td><td>2015-01</td><td>33</td><td>33</td></tr><tr><td>A</td><td>2015-02</td><td>10</td><td>43</td></tr><tr><td>â€¦â€¦.</td><td>â€¦â€¦.</td><td>â€¦â€¦.</td><td>â€¦â€¦.</td></tr><tr><td>B</td><td>2015-01</td><td>30</td><td>30</td></tr><tr><td>B</td><td>2015-02</td><td>15</td><td>45</td></tr><tr><td>â€¦â€¦.</td><td>â€¦â€¦.</td><td>â€¦â€¦.</td><td>â€¦â€¦.</td></tr></tbody></table><h5 id="è§£é¢˜ä»£ç "><a href="#è§£é¢˜ä»£ç " class="headerlink" title="è§£é¢˜ä»£ç "></a>è§£é¢˜ä»£ç </h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># å‡†å¤‡æ•°æ®</span><br><span class="line">vi t_access_times</span><br><span class="line"></span><br><span class="line">A,2015-01,5</span><br><span class="line">A,2015-01,15</span><br><span class="line">B,2015-01,5</span><br><span class="line">A,2015-01,8</span><br><span class="line">B,2015-01,254</span><br><span class="line">A,2015-01,5</span><br><span class="line">A,2015-02,4</span><br><span class="line">A,2015-02,6</span><br><span class="line">B,2015-02,10</span><br><span class="line">B,2015-02,5</span><br><span class="line"><span class="comment">----</span></span><br><span class="line"></span><br><span class="line"># å»ºè¡¨</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_access_times(username <span class="keyword">string</span>,<span class="keyword">month</span> <span class="keyword">string</span>,salary <span class="built_in">int</span>)</span><br><span class="line"><span class="keyword">row</span> <span class="keyword">format</span> <span class="keyword">delimited</span> <span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">','</span>;</span><br><span class="line"></span><br><span class="line"># åŠ è½½æ•°æ®</span><br><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> <span class="keyword">local</span> inpath <span class="string">'/home/ap/t_access_times'</span> <span class="keyword">into</span> <span class="keyword">table</span> t_access_times;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1ã€ç¬¬ä¸€æ­¥ï¼Œå…ˆæ±‚ä¸ªç”¨æˆ·çš„æœˆæ€»é‡‘é¢</span><br><span class="line"><span class="keyword">select</span> username,<span class="keyword">month</span>,<span class="keyword">sum</span>(salary) <span class="keyword">as</span> salary <span class="keyword">from</span> t_access_times <span class="keyword">group</span> <span class="keyword">by</span> username,<span class="keyword">month</span>;</span><br><span class="line"></span><br><span class="line">+<span class="comment">-----------+----------+---------+--+</span></span><br><span class="line">| username  |  month   | salary  |</span><br><span class="line">+<span class="comment">-----------+----------+---------+--+</span></span><br><span class="line">| A         | 2015-01  | 33      |</span><br><span class="line">| A         | 2015-02  | 10      |</span><br><span class="line">| B         | 2015-01  | 30      |</span><br><span class="line">| B         | 2015-02  | 15      |</span><br><span class="line">+<span class="comment">-----------+----------+---------+--+</span></span><br><span class="line"></span><br><span class="line">2ã€ç¬¬äºŒæ­¥ï¼Œå°†æœˆæ€»é‡‘é¢è¡¨ è‡ªå·±è¿æ¥ è‡ªå·±è¿æ¥</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> aa <span class="keyword">as</span></span><br><span class="line">(<span class="keyword">select</span> username,<span class="keyword">month</span>,<span class="keyword">sum</span>(salary) <span class="keyword">as</span> salary <span class="keyword">from</span> t_access_times <span class="keyword">group</span> <span class="keyword">by</span> username,<span class="keyword">month</span>) A </span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> </span><br><span class="line">(<span class="keyword">select</span> username,<span class="keyword">month</span>,<span class="keyword">sum</span>(salary) <span class="keyword">as</span> salary <span class="keyword">from</span> t_access_times <span class="keyword">group</span> <span class="keyword">by</span> username,<span class="keyword">month</span>) B</span><br><span class="line">A.username=B.username</span><br><span class="line"></span><br><span class="line">+<span class="comment">-------------+----------+-----------+-------------+----------+-----------+--+</span></span><br><span class="line">| a.username  | a.month  | a.salary  | b.username  | b.month  | b.salary  |</span><br><span class="line">+<span class="comment">-------------+----------+-----------+-------------+----------+-----------+--+</span></span><br><span class="line">| A           | <span class="number">2015</span><span class="number">-01</span>  | <span class="number">33</span>        | A           | <span class="number">2015</span><span class="number">-01</span>  | <span class="number">33</span>        |</span><br><span class="line">| A           | <span class="number">2015</span><span class="number">-01</span>  | <span class="number">33</span>        | A           | <span class="number">2015</span><span class="number">-02</span>  | <span class="number">10</span>        |</span><br><span class="line">| A           | <span class="number">2015</span><span class="number">-02</span>  | <span class="number">10</span>        | A           | <span class="number">2015</span><span class="number">-01</span>  | <span class="number">33</span>        |</span><br><span class="line">| A           | <span class="number">2015</span><span class="number">-02</span>  | <span class="number">10</span>        | A           | <span class="number">2015</span><span class="number">-02</span>  | <span class="number">10</span>        |</span><br><span class="line">| B           | <span class="number">2015</span><span class="number">-01</span>  | <span class="number">30</span>        | B           | <span class="number">2015</span><span class="number">-01</span>  | <span class="number">30</span>        |</span><br><span class="line">| B           | <span class="number">2015</span><span class="number">-01</span>  | <span class="number">30</span>        | B           | <span class="number">2015</span><span class="number">-02</span>  | <span class="number">15</span>        |</span><br><span class="line">| B           | <span class="number">2015</span><span class="number">-02</span>  | <span class="number">15</span>        | B           | <span class="number">2015</span><span class="number">-01</span>  | <span class="number">30</span>        |</span><br><span class="line">| B           | <span class="number">2015</span><span class="number">-02</span>  | <span class="number">15</span>        | B           | <span class="number">2015</span><span class="number">-02</span>  | <span class="number">15</span>        |</span><br><span class="line">+<span class="comment">-------------+----------+-----------+-------------+----------+-----------+--+</span></span><br><span class="line"></span><br><span class="line"><span class="number">3</span>ã€ç¬¬ä¸‰æ­¥ï¼Œä»ä¸Šä¸€æ­¥çš„ç»“æœä¸­</span><br><span class="line">è¿›è¡Œåˆ†ç»„æŸ¥è¯¢ï¼Œåˆ†ç»„çš„å­—æ®µæ˜¯a.username a.month</span><br><span class="line">æ±‚æœˆç´¯è®¡å€¼ï¼š  å°†b.month &lt;= a.monthçš„æ‰€æœ‰b.salaryæ±‚å’Œå³å¯</span><br><span class="line"><span class="keyword">select</span> A.username,A.month,<span class="keyword">max</span>(A.salary) <span class="keyword">as</span> salary,<span class="keyword">sum</span>(B.salary) <span class="keyword">as</span> accumulate</span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">(<span class="keyword">select</span> username,<span class="keyword">month</span>,<span class="keyword">sum</span>(salary) <span class="keyword">as</span> salary <span class="keyword">from</span> t_access_times <span class="keyword">group</span> <span class="keyword">by</span> username,<span class="keyword">month</span>) A </span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> </span><br><span class="line">(<span class="keyword">select</span> username,<span class="keyword">month</span>,<span class="keyword">sum</span>(salary) <span class="keyword">as</span> salary <span class="keyword">from</span> t_access_times <span class="keyword">group</span> <span class="keyword">by</span> username,<span class="keyword">month</span>) B</span><br><span class="line"><span class="keyword">on</span></span><br><span class="line">A.username=B.username</span><br><span class="line"><span class="keyword">where</span> B.month &lt;= A.month</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> A.username,A.month</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> A.username,A.month;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">+<span class="comment">-------------+----------+---------+-------------+</span></span><br><span class="line">| a.username  | a.month  | salary  | accumulate  |</span><br><span class="line">+<span class="comment">-------------+----------+---------+-------------+</span></span><br><span class="line">| A           | 2015-01  | 33      | 33          |</span><br><span class="line">| A           | 2015-02  | 10      | 43          |</span><br><span class="line">| B           | 2015-01  | 259     | 259         |</span><br><span class="line">| B           | 2015-02  | 15      | 274         |</span><br><span class="line">+<span class="comment">-------------+----------+---------+-------------+</span></span><br></pre></td></tr></table></figure><h3 id="18-3-å¾…åšé¡¹ç›®"><a href="#18-3-å¾…åšé¡¹ç›®" class="headerlink" title="18.3 å¾…åšé¡¹ç›®"></a>18.3 å¾…åšé¡¹ç›®</h3><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-17-082606.png" alt="image-20180617162606289"></p><h1 id="19-æ³¨æ„ç‚¹"><a href="#19-æ³¨æ„ç‚¹" class="headerlink" title="19.æ³¨æ„ç‚¹"></a>19.æ³¨æ„ç‚¹</h1><ol><li><strong>ä½¿ç”¨èšåˆå‡½æ•°, åé¢ä¸€å®šè¦åˆ†ç»„(group by xxx),  group by ä¼šè‡ªåŠ¨å»é‡</strong><ul><li>å¦‚æœ sql è¯­å¥ä¸­æœ‰ group by, é‚£ä¹ˆ select åé¢å¿…é¡»æœ‰ group by çš„å­—æ®µ, æˆ–èšåˆå‡½æ•°</li></ul></li><li><strong>ä½¿ç”¨order by æ’åºæŸä¸ªå­—æ®µæ—¶, å¿…é¡»åœ¨ selectä¸­å‡ºç°æ­¤å­—æ®µ, å¦åˆ™ä¼šæ‰¾ä¸åˆ° :TODO</strong><ul><li>å¾…éªŒè¯</li></ul></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;1-Hive-åˆæ¢&quot;&gt;&lt;a href=&quot;#1-Hive-åˆæ¢&quot; class=&quot;headerlink&quot; title=&quot;1.  Hive åˆæ¢&quot;&gt;&lt;/a&gt;1.  Hive åˆæ¢&lt;/h1&gt;&lt;h3 id=&quot;1-1-Hive-çš„æ•°æ®å­˜å‚¨&quot;&gt;&lt;a href=&quot;#1-1-Hiv
      
    
    </summary>
    
      <category term="Hadoop" scheme="https://airpoet.github.io/categories/Hadoop/"/>
    
      <category term="Hive" scheme="https://airpoet.github.io/categories/Hadoop/Hive/"/>
    
    
      <category term="åŸåˆ›" scheme="https://airpoet.github.io/tags/%E5%8E%9F%E5%88%9B/"/>
    
      <category term="æŠ€æœ¯" scheme="https://airpoet.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="Hadoop" scheme="https://airpoet.github.io/tags/Hadoop/"/>
    
      <category term="Hive" scheme="https://airpoet.github.io/tags/Hive/"/>
    
  </entry>
  
  <entry>
    <title>MapReduce-ç®€å•æ€»ç»“</title>
    <link href="https://airpoet.github.io/2018/06/12/Hadoop/2-MapReduce/MapReduce-%E7%AE%80%E5%8D%95%E6%80%BB%E7%BB%93/"/>
    <id>https://airpoet.github.io/2018/06/12/Hadoop/2-MapReduce/MapReduce-ç®€å•æ€»ç»“/</id>
    <published>2018-06-12T07:03:29.967Z</published>
    <updated>2018-06-17T09:27:08.821Z</updated>
    
    <content type="html"><![CDATA[<p>MapReduceåœ¨ç¼–ç¨‹çš„æ—¶å€™ï¼ŒåŸºæœ¬ä¸Šä¸€ä¸ªå›ºåŒ–çš„æ¨¡å¼ï¼Œæ²¡æœ‰å¤ªå¤šå¯çµæ´»æ”¹å˜çš„åœ°æ–¹ï¼Œ<strong>é™¤äº†ä»¥ä¸‹å‡ å¤„</strong>ï¼š</p><ul><li><h4 id="è¾“å…¥æ•°æ®æ¥å£ï¼šInputFormat"><a href="#è¾“å…¥æ•°æ®æ¥å£ï¼šInputFormat" class="headerlink" title="è¾“å…¥æ•°æ®æ¥å£ï¼šInputFormat"></a><strong>è¾“å…¥æ•°æ®æ¥å£ï¼šInputFormat</strong></h4><ul><li>FileInputFormat  (æ–‡ä»¶ç±»å‹æ•°æ®è¯»å–çš„é€šç”¨æŠ½è±¡ç±»)  </li><li>DBInputFormat ï¼ˆæ•°æ®åº“æ•°æ®è¯»å–çš„é€šç”¨æŠ½è±¡ç±»ï¼‰</li><li><strong>é»˜è®¤ä½¿ç”¨çš„å®ç°ç±»æ˜¯ï¼š TextInputFormat</strong>    <ul><li>job.setInputFormatClass(TextInputFormat.class)</li><li>TextInputFormatçš„åŠŸèƒ½é€»è¾‘æ˜¯ï¼šä¸€æ¬¡è¯»ä¸€è¡Œæ–‡æœ¬ï¼Œç„¶åå°†è¯¥è¡Œçš„èµ·å§‹åç§»é‡ä½œä¸ºkeyï¼Œè¡Œå†…å®¹ä½œä¸ºvalueè¿”å›</li></ul></li></ul></li><li><h4 id="é€»è¾‘å¤„ç†æ¥å£ï¼š-Mapper"><a href="#é€»è¾‘å¤„ç†æ¥å£ï¼š-Mapper" class="headerlink" title="é€»è¾‘å¤„ç†æ¥å£ï¼š Mapper"></a><strong>é€»è¾‘å¤„ç†æ¥å£ï¼š Mapper</strong></h4><ul><li>å®Œå…¨éœ€è¦ç”¨æˆ·è‡ªå·±å»å®ç°å…¶ä¸­  <code>map()   setup()   clean()</code></li></ul></li></ul><ul><li><h4 id="mapè¾“å‡ºçš„ç»“æœåœ¨shuffleé˜¶æ®µä¼šè¢«partitionä»¥åŠsortï¼Œæ­¤å¤„æœ‰ä¸¤ä¸ªæ¥å£å¯è‡ªå®šä¹‰ï¼š"><a href="#mapè¾“å‡ºçš„ç»“æœåœ¨shuffleé˜¶æ®µä¼šè¢«partitionä»¥åŠsortï¼Œæ­¤å¤„æœ‰ä¸¤ä¸ªæ¥å£å¯è‡ªå®šä¹‰ï¼š" class="headerlink" title="mapè¾“å‡ºçš„ç»“æœåœ¨shuffleé˜¶æ®µä¼šè¢«partitionä»¥åŠsortï¼Œæ­¤å¤„æœ‰ä¸¤ä¸ªæ¥å£å¯è‡ªå®šä¹‰ï¼š"></a><strong>mapè¾“å‡ºçš„ç»“æœåœ¨shuffleé˜¶æ®µä¼šè¢«partitionä»¥åŠsort</strong>ï¼Œæ­¤å¤„æœ‰ä¸¤ä¸ªæ¥å£å¯è‡ªå®šä¹‰ï¼š</h4><ul><li><strong>Partitioner</strong><ul><li>æœ‰é»˜è®¤å®ç° <code>HashPartitioner</code>ï¼Œé€»è¾‘æ˜¯æ ¹æ®<strong>key</strong>å’Œ<strong>numReduces</strong>æ¥è¿”å›ä¸€ä¸ªåˆ†åŒºå·:<code>key.hashCode()&amp;Integer.MAXVALUE % numReduces</code></li><li>é€šå¸¸æƒ…å†µä¸‹ï¼Œç”¨é»˜è®¤çš„è¿™ä¸ªHashPartitionerå°±å¯ä»¥ï¼Œå¦‚æœä¸šåŠ¡ä¸Šæœ‰ç‰¹åˆ«çš„éœ€æ±‚ï¼Œå¯ä»¥è‡ªå®šä¹‰</li><li>ç»§æ‰¿ <code>Partitioner</code>, é‡å†™<code>getPartition</code>æ–¹æ³•, å…·ä½“è§<a href="https://airpoet.github.io/2018/06/07/Hadoop/Study/2-MapReduce/MapReduce%E7%AC%94%E8%AE%B0-2/#%E5%85%B8%E5%9E%8B%E7%9A%84-Partitioner-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0">è¿™é‡Œ</a></li></ul></li><li><strong>Comparable</strong><ul><li>å½“æˆ‘ä»¬ç”¨è‡ªå®šä¹‰çš„å¯¹è±¡ä½œä¸ºkeyæ¥è¾“å‡ºæ—¶ï¼Œå°±å¿…é¡»è¦å®ç°<code>WritableComparable</code>æ¥å£ï¼Œ<strong>override</strong>å…¶ä¸­çš„<code>compareTo()</code>æ–¹æ³•, å…·ä½“è§<a href="https://airpoet.github.io/2018/06/07/Hadoop/Study/2-MapReduce/MapReduce%E7%AC%94%E8%AE%B0-2/#%E5%85%B8%E5%9E%8B%E7%9A%84-Partitioner-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0">è¿™é‡Œ</a></li></ul></li></ul></li></ul><ul><li><h4 id="reduceç«¯çš„æ•°æ®åˆ†ç»„æ¯”è¾ƒæ¥å£-ï¼š-Groupingcomparator"><a href="#reduceç«¯çš„æ•°æ®åˆ†ç»„æ¯”è¾ƒæ¥å£-ï¼š-Groupingcomparator" class="headerlink" title="reduceç«¯çš„æ•°æ®åˆ†ç»„æ¯”è¾ƒæ¥å£ ï¼š Groupingcomparator"></a><strong>reduceç«¯çš„æ•°æ®åˆ†ç»„æ¯”è¾ƒæ¥å£ ï¼š Groupingcomparator</strong></h4><ul><li>reduceTaskæ‹¿åˆ°è¾“å…¥æ•°æ®ï¼ˆä¸€ä¸ªpartitionçš„æ‰€æœ‰æ•°æ®ï¼‰åï¼Œé¦–å…ˆéœ€è¦å¯¹æ•°æ®è¿›è¡Œåˆ†ç»„ï¼Œå…¶åˆ†ç»„çš„é»˜è®¤åŸåˆ™æ˜¯keyç›¸åŒï¼Œç„¶åå¯¹æ¯ä¸€ç»„kvæ•°æ®è°ƒç”¨ä¸€æ¬¡reduce()æ–¹æ³•ï¼Œå¹¶ä¸”å°†è¿™ä¸€ç»„kvä¸­çš„ç¬¬ä¸€ä¸ªkvçš„keyä½œä¸ºå‚æ•°ä¼ ç»™reduceçš„keyï¼Œå°†è¿™ä¸€ç»„æ•°æ®çš„valueçš„è¿­ä»£å™¨ä¼ ç»™reduce()çš„valueså‚æ•°</li><li>åˆ©ç”¨ä¸Šè¿°è¿™ä¸ªæœºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥<strong>å®ç°ä¸€ä¸ªé«˜æ•ˆçš„åˆ†ç»„å–æœ€å¤§å€¼çš„é€»è¾‘ï¼š</strong><ul><li>è‡ªå®šä¹‰ä¸€ä¸ªbeanå¯¹è±¡ç”¨æ¥å°è£…æˆ‘ä»¬çš„æ•°æ®ï¼Œç„¶åæ”¹å†™å…¶compareToæ–¹æ³•äº§ç”Ÿå€’åºæ’åºçš„æ•ˆæœ</li><li>ç„¶åè‡ªå®šä¹‰ä¸€ä¸ªGroupingcomparatorï¼Œå°†beanå¯¹è±¡çš„åˆ†ç»„é€»è¾‘æ”¹æˆæŒ‰ç…§æˆ‘ä»¬çš„ä¸šåŠ¡åˆ†ç»„idæ¥åˆ†ç»„ï¼ˆæ¯”å¦‚è®¢å•å·ï¼‰</li><li>è¿™æ ·ï¼Œæˆ‘ä»¬è¦å–çš„æœ€å¤§å€¼å°±æ˜¯reduce()æ–¹æ³•ä¸­ä¼ è¿›æ¥key</li></ul></li></ul></li></ul><hr><ul><li><h4 id="é€»è¾‘å¤„ç†æ¥å£ï¼šReducer"><a href="#é€»è¾‘å¤„ç†æ¥å£ï¼šReducer" class="headerlink" title="é€»è¾‘å¤„ç†æ¥å£ï¼šReducer"></a><strong>é€»è¾‘å¤„ç†æ¥å£ï¼šReducer</strong></h4><ul><li>å®Œå…¨éœ€è¦ç”¨æˆ·è‡ªå·±å»å®ç°å…¶ä¸­  <code>reduce()   setup()   clean()</code></li></ul></li><li><h4 id="è¾“å‡ºæ•°æ®æ¥å£ï¼š-OutputFormat"><a href="#è¾“å‡ºæ•°æ®æ¥å£ï¼š-OutputFormat" class="headerlink" title="è¾“å‡ºæ•°æ®æ¥å£ï¼š OutputFormat"></a><strong>è¾“å‡ºæ•°æ®æ¥å£ï¼š OutputFormat</strong></h4><ul><li>æœ‰ä¸€ç³»åˆ—å­ç±»  FileOutputformat  DBoutputFormat  â€¦..</li><li>é»˜è®¤å®ç°ç±»æ˜¯TextOutputFormat</li><li>åŠŸèƒ½é€»è¾‘æ˜¯ï¼š  <strong>å°†æ¯ä¸€ä¸ªKVå¯¹å‘ç›®æ ‡æ–‡æœ¬æ–‡ä»¶ä¸­è¾“å‡ºä¸ºä¸€è¡Œ</strong></li></ul><p>â€‹    </p></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;MapReduceåœ¨ç¼–ç¨‹çš„æ—¶å€™ï¼ŒåŸºæœ¬ä¸Šä¸€ä¸ªå›ºåŒ–çš„æ¨¡å¼ï¼Œæ²¡æœ‰å¤ªå¤šå¯çµæ´»æ”¹å˜çš„åœ°æ–¹ï¼Œ&lt;strong&gt;é™¤äº†ä»¥ä¸‹å‡ å¤„&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;h4 id=&quot;è¾“å…¥æ•°æ®æ¥å£ï¼šInputFormat&quot;&gt;&lt;a href=&quot;#è¾“å…¥æ•°æ®æ¥å£ï¼šInputFormat&quot; c
      
    
    </summary>
    
      <category term="Hadoop" scheme="https://airpoet.github.io/categories/Hadoop/"/>
    
      <category term="MapReduce" scheme="https://airpoet.github.io/categories/Hadoop/MapReduce/"/>
    
    
      <category term="åŸåˆ›" scheme="https://airpoet.github.io/tags/%E5%8E%9F%E5%88%9B/"/>
    
      <category term="æŠ€æœ¯" scheme="https://airpoet.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="Hadoop" scheme="https://airpoet.github.io/tags/Hadoop/"/>
    
      <category term="MapReduce" scheme="https://airpoet.github.io/tags/MapReduce/"/>
    
  </entry>
  
  <entry>
    <title>Hiveå­¦ä¹ -1-å®‰è£…</title>
    <link href="https://airpoet.github.io/2018/06/12/Hadoop/3-Hive/Hive%E5%AD%A6%E4%B9%A0-1/"/>
    <id>https://airpoet.github.io/2018/06/12/Hadoop/3-Hive/Hiveå­¦ä¹ -1/</id>
    <published>2018-06-12T03:24:46.733Z</published>
    <updated>2018-06-28T13:55:35.306Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Hiveç®€ä»‹"><a href="#Hiveç®€ä»‹" class="headerlink" title="Hiveç®€ä»‹"></a>Hiveç®€ä»‹</h1><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-12-034055.png" alt="image-20180612114055129"></p><h3 id="HiveåŸºæœ¬æƒ…å†µ"><a href="#HiveåŸºæœ¬æƒ…å†µ" class="headerlink" title="HiveåŸºæœ¬æƒ…å†µ"></a>HiveåŸºæœ¬æƒ…å†µ</h3><p><strong>Hive</strong> æ˜¯å»ºç«‹åœ¨ <strong>Hadoop</strong> ä¸Šçš„æ•°æ®ä»“åº“åŸºç¡€æ„æ¶</p><ul><li>ç”±facebookå¼€æºï¼Œæœ€åˆç”¨äºè§£å†³æµ·é‡ç»“æ„åŒ–çš„æ—¥å¿—æ•°æ®ç»Ÿ è®¡é—®é¢˜;<ul><li><strong>ETL</strong>(<strong>Extraction-Transformation-Loading</strong>)å·¥å…·</li></ul></li><li>æ„å»ºåœ¨Hadoopä¹‹ä¸Šçš„æ•°æ®ä»“åº“;<ul><li>æ•°æ®è®¡ç®—ä½¿ç”¨<strong>MR</strong>ï¼Œæ•°æ®å­˜å‚¨ä½¿ç”¨<strong>HDFS</strong></li><li>æ•°æ®åº“&amp;æ•°æ®ä»“åº“ çš„åŒºåˆ«ï¼š<ul><li>æ¦‚å¿µä¸Š<ul><li><strong>æ•°æ®åº“</strong>ï¼šç”¨äºç®¡ç†ç²¾ç»†åŒ–æ•°æ®ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ç”¨äºå­˜å‚¨ç»“æœæ•°æ®ï¼Œåˆ†åº“åˆ†è¡¨è¿›è¡Œå­˜å‚¨</li><li><strong>æ•°æ®ä»“åº“</strong>ï¼š<strong>å­˜å‚¨ã€æŸ¥è¯¢ã€åˆ†æå¤§è§„æ¨¡æ•°æ®</strong> ã€‚æ›´åƒä¸€ä¸ªæ‰“åŒ…çš„è¿‡ç¨‹ï¼Œé‡Œé¢å­˜å‚¨çš„æ•°æ®æ²¡æœ‰ç»†åŒ–åŒºåˆ†ï¼Œç²’åº¦è¾ƒç²—</li></ul></li><li>ç”¨é€”ä¸Šï¼š<ul><li>æ•°æ®åº“ï¼šOLTPï¼Œon line Transation Processing è”æœºäº‹åŠ¡å¤„ç†ï¼Œå¢åˆ æ”¹</li><li>æ•°æ®ä»“åº“ï¼šOLAPï¼Œon line analysis Processing è”æœºäº‹åŠ¡åˆ†æå¤„ç†ï¼ŒæŸ¥è¯¢ï¼Œhiveä¸æ”¯æŒåˆ é™¤ã€ä¿®æ”¹ã€‚ æ”¯æŒæ’å…¥ã€‚</li></ul></li><li>ä½¿ç”¨ä¸Šï¼š<ul><li>æ•°æ®åº“ï¼šæ ‡å‡†sql,  hbase: éæ ‡å‡†sql</li><li>æ•°æ®ä»“åº“ï¼šæ–¹è¨€ç‰ˆçš„sqlï¼Œ HQL</li></ul></li><li>æ¨¡å¼ä¸Šï¼š<ul><li>æ•°æ®åº“ï¼šå†™æ¨¡å¼</li><li>æ•°æ®ä»“åº“ï¼šè¯»æ¨¡å¼</li></ul></li></ul></li></ul></li><li>å¯ä»¥å°†ç»“æ„åŒ–çš„æ•°æ®æ˜ å°„æˆä¸€å¼ æ•°æ®åº“è¡¨<ul><li>ç»“æ„åŒ–æ•°æ®æ˜ å°„æˆäºŒç»´è¡¨</li><li><strong>å°†æ–‡æœ¬ä¸­æ¯ä¸€è¡Œæ•°æ®æ˜ å°„ä¸ºæ•°æ®åº“çš„æ¯ä¸€æ¡æ•°æ®</strong></li><li><strong>å°†æ–‡æœ¬ä¸­æ¯ä¸€åˆ—æ•°æ®æ˜ å°„ä¸ºhiveçš„è¡¨å­—æ®µ</strong></li></ul></li><li>æä¾›HQL æŸ¥è¯¢åŠŸèƒ½<ul><li>hive query languageï¼Œ æ–¹è¨€ç‰ˆsql</li></ul></li><li><strong>åº•å±‚æ•°æ®æ˜¯å­˜å‚¨åœ¨HDFSä¸Š</strong><ul><li>hiveä¸Šå»ºçš„è¡¨ä»…ä»…ç›¸å½“äº<strong>å¯¹hdfsä¸Šçš„ç»“æ„åŒ–æ•°æ®è¿›è¡Œæ˜ å°„ç®¡ç†</strong></li><li>hiveä»…ä»…æ˜¯ä¸€ä¸ªç®¡ç†æ•°æ®çš„ä½œç”¨ï¼Œè€Œ<strong>ä¸ä¼šå­˜å‚¨æ•°æ®</strong></li><li>hiveæƒ³è¦ç®¡ç†hdfsä¸Šçš„æ•°æ®ï¼Œå°±è¦å»ºç«‹ä¸€ä¸ªå…³è”å…³ç³»ï¼Œå…³è”hiveä¸Šçš„è¡¨å’Œhdfsä¸Šçš„æ•°æ®è·¯å¾„</li><li>æ•°æ®æ˜¯ä¾èµ–äºä¸€ä¸ªå…ƒæ•°æ®åº“</li><li>å…ƒæ•°æ®åº“é‡‡ç”¨çš„æ˜¯å…³ç³»å‹æ•°æ®åº“ï¼Œ çœŸå®ç”Ÿäº§ä¸­ä¸€èˆ¬ä½¿ç”¨mysqlä¸ºhiveçš„å…ƒæ•°æ®åº“ï¼Œhiveå†…ç½®é»˜è®¤çš„å…ƒæ•°æ®åº“æ˜¯ derby</li><li><strong>å…ƒæ•°æ®ï¼š</strong> <strong>HCalalog</strong> <ul><li>hiveä¸­çš„è¡¨å’Œhdfsçš„<strong>æ˜ å°„å…³ç³»</strong>ï¼Œä»¥åŠ<strong>hiveè¡¨å±æ€§</strong>ï¼ˆå†…éƒ¨è¡¨ï¼Œå¤–éƒ¨è¡¨ï¼Œè§†å›¾ï¼‰å’Œ<strong>å­—æ®µä¿¡æ¯</strong></li><li>å…ƒæ•°æ®ä¸€æ—¦ä¿®é¥°ï¼Œhiveçš„æ‰€æœ‰æ˜ å°„å…³ç³»ç­‰éƒ½æ²¡äº†ï¼Œå°±æ— æ³•ä½¿ç”¨äº†</li><li>å¯ä¸<strong>Pig</strong>ã€<strong>Presto</strong>ç­‰å…±äº« </li></ul></li></ul></li><li>Hiveçš„æ˜¯<strong>æ„å»ºåœ¨Hadoopä¹‹ä¸Šçš„æ•°æ®ä»“åº“</strong><ul><li>æ•°æ®è®¡ç®—ä½¿ç”¨<strong>MR</strong>ï¼Œæ•°æ®å­˜å‚¨ä½¿ç”¨<strong>HDFS</strong> </li></ul></li><li>é€šå¸¸ç”¨äºè¿›è¡Œç¦»çº¿æ•°æ®å¤„ç†(é‡‡ç”¨MapReduce) </li><li><strong>å¯è®¤ä¸ºæ˜¯ä¸€ä¸ªHQLâ€”-&gt;MRçš„è¯­è¨€ç¿»è¯‘å™¨</strong> </li></ul><h3 id="Hiveä¼˜ç¼ºç‚¹ï¼š"><a href="#Hiveä¼˜ç¼ºç‚¹ï¼š" class="headerlink" title="Hiveä¼˜ç¼ºç‚¹ï¼š"></a>Hiveä¼˜ç¼ºç‚¹ï¼š</h3><ul><li><p>ä¼˜ç‚¹ï¼š</p><ul><li>ç®€å•ï¼Œå®¹æ˜“ä¸Šæ‰‹ <ul><li>æä¾›äº†ç±»<strong>SQL</strong>æŸ¥è¯¢è¯­è¨€<strong>HQL</strong> </li></ul></li><li>ä¸ºè¶…å¤§æ•°æ®é›†è®¾è®¡çš„è®¡ç®—/æ‰©å±•èƒ½åŠ› <ul><li><strong>MR</strong>ä½œä¸ºè®¡ç®—å¼•æ“ï¼Œ<strong>HDFS</strong>ä½œä¸ºå­˜å‚¨ç³»ç»Ÿ </li></ul></li><li>ç»Ÿä¸€çš„å…ƒæ•°æ®ç®¡ç†(HCalalog) <ul><li>å¯ä¸<strong>Pig</strong>ã€<strong>Presto</strong>ç­‰å…±äº« </li></ul></li></ul></li><li><p><strong>ç¼ºç‚¹</strong></p><ul><li><p><strong>ä¸æ”¯æŒ åˆ é™¤ &amp; ä¿®æ”¹</strong>  delete&amp;updateï¼Œ<strong>ä¸æ”¯æŒäº‹åŠ¡</strong></p><ul><li>å› ä¸ºæ˜¯åŸºäºHDFS</li><li>hiveåšçš„æœ€å¤šçš„æ˜¯æŸ¥è¯¢</li></ul></li><li><p>Hiveçš„HQLè¡¨è¾¾çš„èƒ½åŠ›æœ‰é™ </p><ul><li>è¿­ä»£å¼ç®—æ³•æ— æ³•è¡¨è¾¾ </li><li>æœ‰äº›å¤æ‚è¿ç®—ç”¨<strong>HQL</strong>ä¸æ˜“è¡¨è¾¾ </li></ul></li><li><p><strong>Hiveæ•ˆç‡è¾ƒä½ï¼ŒæŸ¥è¯¢å»¶æ—¶é«˜</strong></p><ul><li><strong>Hive</strong>è‡ªåŠ¨ç”Ÿæˆ<strong>MapReduce</strong>ä½œä¸šï¼Œé€šå¸¸ä¸å¤Ÿæ™ºèƒ½ </li><li><strong>HQL</strong>è°ƒä¼˜å›°éš¾ï¼Œç²’åº¦è¾ƒç²— </li><li>å¯æ§æ€§å·® </li></ul></li></ul></li></ul><h3 id="Hiveä¸ä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“-RDBMSï¼‰å¯¹æ¯”"><a href="#Hiveä¸ä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“-RDBMSï¼‰å¯¹æ¯”" class="headerlink" title="Hiveä¸ä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“(RDBMSï¼‰å¯¹æ¯”"></a>Hiveä¸ä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“(RDBMSï¼‰å¯¹æ¯”</h3><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-12-082659.png" alt="image-20180612162659151"><br></p><h1 id="Hiveçš„æ¶æ„"><a href="#Hiveçš„æ¶æ„" class="headerlink" title="Hiveçš„æ¶æ„"></a>Hiveçš„æ¶æ„</h1><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-12-061321.png" alt="image-20180612141321130"></p><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-12-061413.png" alt="image-20180612141413285"></p><ul><li><p><strong>1) ç”¨æˆ·æ¥å£</strong></p><ul><li><p>CLIï¼šCommand Line Interfaceï¼Œå³Shellç»ˆç«¯å‘½ä»¤è¡Œï¼Œä½¿ç”¨ Hive å‘½ä»¤è¡Œä¸ Hive è¿›è¡Œäº¤äº’ï¼Œæœ€å¸¸ç”¨ï¼ˆå­¦ä¹ ï¼Œè°ƒè¯•ï¼Œç”Ÿäº§ï¼‰ï¼ŒåŒ…æ‹¬ä¸¤ç§è¿è¡Œæ–¹å¼ï¼š</p><ul><li><p>hiveå‘½ä»¤æ–¹å¼ï¼šå‰æå¿…é¡»åœ¨hiveå®‰è£…èŠ‚ç‚¹ä¸Šæ‰§è¡Œ</p></li><li><p>hiveserver2æ–¹å¼ï¼šhiveå®‰è£…èŠ‚ç‚¹å°†hiveå¯åŠ¨ä¸ºä¸€ä¸ªåå°è¿›ç¨‹ï¼Œå®¢æˆ·æœºè¿›è¡Œè¿æ¥ï¼ˆç±»ä¼¼äºå¯åŠ¨äº†ä¸€ä¸ªhiveæœåŠ¡ç«¯ï¼‰</p></li></ul></li></ul></li></ul><pre><code>çœŸå®ç”Ÿäº§ä¸­å¸¸ç”¨ï¼- 1) ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå…è®¸è¿œç¨‹è¿æ¥;  ç¬¬ä¸€ï¼šä¿®æ”¹ hdfs-site.xmlï¼ŒåŠ å…¥ä¸€æ¡é…ç½®ä¿¡æ¯ï¼Œå¯ç”¨ webhdfsï¼›  ç¬¬äºŒï¼šä¿®æ”¹ core-site.xmlï¼ŒåŠ å…¥ä¸¤æ¡é…ç½®ä¿¡æ¯ï¼Œè®¾ç½® hadoopçš„ä»£ç†ç”¨æˆ·ã€‚- 2) å¯åŠ¨æœåŠ¡è¿›ç¨‹  - å‰å°å¯åŠ¨ï¼šhiveserver2  - åå°å¯åŠ¨    - è®°å½•æ—¥å¿—ï¼šnohup hiveserver2 1&gt;/home/sigeon/hiveserver.log 2&gt;/home/sigeon/hiveserver.err &amp;      0ï¼šæ ‡å‡†æ—¥å¿—è¾“å…¥   1ï¼šæ ‡å‡†æ—¥å¿—è¾“å‡º   2ï¼šé”™è¯¯æ—¥å¿—è¾“å‡º      å¦‚æœæˆ‘æ²¡æœ‰é…ç½®æ—¥å¿—çš„è¾“å‡ºè·¯å¾„ï¼Œæ—¥å¿—ä¼šç”Ÿæˆåœ¨å½“å‰å·¥ä½œç›®å½•ï¼Œé»˜è®¤çš„æ—¥å¿—åç§°å«åšï¼š      nohup.xxx    - ä¸è®°å½•æ—¥å¿—ï¼šnohup hiveserver2 1&gt;/dev/null 2&gt;/dev/null &amp;     - [è¡¥å……ï¼š]      - nohupå‘½ä»¤ï¼šno hang upçš„ç¼©å†™ï¼Œå³ä¸æŒ‚èµ·ï¼Œå¯ä»¥åœ¨ä½ é€€å‡ºå¸æˆ·/å…³é—­ç»ˆç«¯ä¹‹åç»§ç»­è¿è¡Œç›¸åº”çš„è¿›ç¨‹ã€‚      - è¯­æ³•ï¼šnohup &lt;command&gt; &amp;- 3) å¼€å¯beenlineå®¢æˆ·ç«¯å¹¶è¿æ¥ï¼š  - æ–¹æ³•ä¸€ï¼š     - beenlineï¼Œå¼€å¯beenlineå®¢æˆ·ç«¯;    - !connect jdbc:&lt;hive2://master:10000&gt;ï¼Œå›è½¦ã€‚ç„¶åè¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼Œè¿™ä¸ªç”¨æˆ·åæ˜¯å®‰è£… hadoop é›†ç¾¤çš„ç”¨æˆ·å  - æ–¹æ³•äºŒï¼š    - beeline -u jdbc:&lt;hive2://master:10000&gt; -n sigeon</code></pre><ul><li><p>JDBC/ODBCï¼šæ˜¯ Hive çš„åŸºäº JDBC æ“ä½œæä¾›çš„å®¢æˆ·ç«¯ï¼Œç”¨æˆ·ï¼ˆå¼€å‘å‘˜ï¼Œè¿ç»´äººå‘˜ï¼‰é€šè¿‡ è¿™è¿æ¥è‡³ Hive server æœåŠ¡ </p></li><li><p>Web UIï¼šé€šè¿‡æµè§ˆå™¨è®¿é—® Hiveï¼ŒåŸºæœ¬ä¸ä¼šä½¿ç”¨</p></li></ul><ul><li><p>2) å…ƒæ•°æ®åº“ï¼šä¿å­˜å…ƒæ•°æ®ï¼Œä¸€èˆ¬ä¼šé€‰ç”¨å…³ç³»å‹æ•°æ®åº“ï¼ˆå¦‚mysqlï¼ŒHive å’Œ MySQL ä¹‹é—´é€šè¿‡ MetaStore æœåŠ¡äº¤äº’ï¼‰</p></li><li><p>3) ThriftæœåŠ¡ï¼šFacebook å¼€å‘çš„ä¸€ä¸ªè½¯ä»¶æ¡†æ¶ï¼Œå¯ä»¥ç”¨æ¥è¿›è¡Œå¯æ‰©å±•ä¸”è·¨è¯­è¨€çš„æœåŠ¡çš„å¼€å‘ï¼Œ Hive é›†æˆäº†è¯¥æœåŠ¡ï¼Œèƒ½è®©ä¸åŒçš„ç¼–ç¨‹è¯­è¨€è°ƒç”¨ Hive çš„æ¥å£</p></li><li><p>4) é©±åŠ¨Driver</p><ul><li>a. è§£é‡Šå™¨ï¼šè§£é‡Šå™¨çš„ä½œç”¨æ˜¯å°† HiveSQL è¯­å¥è½¬æ¢ä¸ºæŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰ </li><li>b. ç¼–è¯‘å™¨ï¼šç¼–è¯‘å™¨æ˜¯å°†è¯­æ³•æ ‘ç¼–è¯‘ä¸ºé€»è¾‘æ‰§è¡Œè®¡åˆ’ </li><li>c. ä¼˜åŒ–å™¨ï¼šä¼˜åŒ–å™¨æ˜¯å¯¹é€»è¾‘æ‰§è¡Œè®¡åˆ’è¿›è¡Œä¼˜åŒ– </li><li>d. æ‰§è¡Œå™¨ï¼šæ‰§è¡Œå™¨æ˜¯è°ƒç”¨åº•å±‚çš„è¿è¡Œæ¡†æ¶æ‰§è¡Œé€»è¾‘æ‰§è¡Œè®¡åˆ’ </li></ul></li></ul><p><br></p><h1 id="Hiveçš„æ•°æ®ç»„ç»‡æ ¼å¼"><a href="#Hiveçš„æ•°æ®ç»„ç»‡æ ¼å¼" class="headerlink" title="Hiveçš„æ•°æ®ç»„ç»‡æ ¼å¼"></a>Hiveçš„æ•°æ®ç»„ç»‡æ ¼å¼</h1><ul><li><p>1)åº“ï¼šdatabase</p></li><li><p>2) è¡¨</p><ul><li><p>a. å†…éƒ¨è¡¨ï¼ˆç®¡ç†è¡¨ï¼šmanaged_tableï¼‰</p></li><li><p>b. å¤–éƒ¨è¡¨ï¼ˆexternal_tableï¼‰</p></li><li><p>å†…éƒ¨è¡¨å’Œå¤–éƒ¨è¡¨åŒºåˆ«ï¼š</p><ul><li>å†…éƒ¨è¡¨å’Œå¤–éƒ¨è¡¨æ˜¯ä¸¤ä¸ªç›¸å¯¹çš„æ¦‚å¿µï¼Œä¸å¯èƒ½æœ‰ä¸€ä¸ªè¡¨åŒæ—¶æ˜¯å†…éƒ¨è¡¨åˆæ˜¯å¤–éƒ¨è¡¨ï¼›</li><li>å†…éƒ¨è¡¨åˆ é™¤è¡¨çš„æ—¶å€™ä¼šåˆ é™¤åŸå§‹æ•°æ®å’Œå…ƒæ•°æ®ï¼Œè€Œå¤–éƒ¨è¡¨åˆ é™¤è¡¨çš„æ—¶å€™åªä¼šåˆ é™¤å…ƒæ•°æ®ä¸ä¼šåˆ é™¤åŸå§‹æ•°æ®</li><li>ä¸€èˆ¬æƒ…å†µä¸‹å­˜å‚¨å…¬å…±æ•°æ®çš„è¡¨å­˜æ”¾ä¸ºå¤–éƒ¨è¡¨</li><li>å¤§å¤šæ•°æƒ…å†µï¼Œä»–ä»¬çš„åŒºåˆ«ä¸æ˜æ˜¾ã€‚å¦‚æœæ•°æ®çš„æ‰€æœ‰å¤„ç†éƒ½åœ¨ Hive ä¸­è¿›è¡Œï¼Œé‚£ä¹ˆå€¾å‘äº é€‰æ‹©å†…éƒ¨è¡¨ï¼›ä½†æ˜¯å¦‚æœ Hive å’Œå…¶ä»–å·¥å…·è¦é’ˆå¯¹ç›¸åŒçš„æ•°æ®é›†è¿›è¡Œå¤„ç†ï¼Œå¤–éƒ¨è¡¨æ›´åˆé€‚ã€‚ </li><li>ä½¿ç”¨å¤–éƒ¨è¡¨è®¿é—®å­˜å‚¨åœ¨ HDFS ä¸Šçš„åˆå§‹æ•°æ®ï¼Œç„¶åé€šè¿‡ Hive è½¬æ¢æ•°æ®å¹¶å­˜åˆ°å†…éƒ¨è¡¨ä¸­ï¼Œä½¿ç”¨å¤–éƒ¨è¡¨çš„åœºæ™¯æ˜¯é’ˆå¯¹ä¸€ä¸ªæ•°æ®é›†æœ‰å¤šä¸ªä¸åŒçš„ Schemaã€‚ </li></ul></li><li><p>c. åˆ†åŒºè¡¨</p><ul><li>ä¸åŒäºhadoopä¸­çš„åˆ†åŒºï¼Œåˆ†åŒºè¡¨æ˜¯äººä¸ºåˆ’åˆ†çš„</li><li>hiveæœ€ç»ˆå­˜å‚¨æµ·é‡æ•°æ®ï¼Œæµ·é‡æ•°æ®æŸ¥è¯¢ä¸€å®šæ³¨æ„é¿å…å…¨è¡¨æ‰«æ</li><li>æŸ¥è¯¢çš„æ—¶å€™ä¸ºäº†æå‡æˆ‘ä»¬çš„æŸ¥è¯¢æ€§èƒ½ï¼Œå‡ºç°äº†åˆ†åŒºè¡¨</li><li>å°†æ•°æ®æŒ‰ç…§ç”¨æˆ·çš„ä¸šåŠ¡å­˜å‚¨åˆ°ä¸åŒçš„ç›®å½•ä¸‹ï¼Œåœ¨è¿›è¡Œæ•°æ®æŸ¥è¯¢æ—¶åªä¼šå¯¹æŒ‡å®šåˆ†åŒºä¸‹çš„æ•°æ®è¿›è¡Œæ‰«æ<br>ä¸€èˆ¬æƒ…å†µä¸‹ç”Ÿäº§ä¸­ç”¨æ—¥æœŸä½œä¸ºåˆ†åŒºå­—æ®µ</li></ul></li><li><p>d. åˆ†æ¡¶è¡¨</p><ul><li><p>ç±»ä¼¼äºhadoopä¸­çš„åˆ†åŒºï¼Œæ˜¯ç”±ç¨‹åºå†³å®šçš„ï¼Œåªèƒ½æŒ‡å®šæ¡¶çš„ä¸ªæ•°ï¼ˆåˆ†åŒºçš„ä¸ªæ•°ï¼‰</p></li><li><p>æ ¹æ®hashç®—æ³•å°†ä½™æ•°ä¸åŒçš„è¾“å‡ºåˆ°ä¸åŒçš„æ–‡ä»¶ä¸­</p></li><li><p>ä½œç”¨ï¼š</p><ul><li>1ï¼‰æå‡joinçš„æ€§èƒ½<br>æ€è€ƒè¿™ä¸ªé—®é¢˜ï¼šselect <a href="http://a.id" target="_blank" rel="noopener">a.id</a>,<a href="http://a.name" target="_blank" rel="noopener">a.name</a>,b.addr from a join b on <a href="http://a.id" target="_blank" rel="noopener">a.id</a> = <a href="http://b.id" target="_blank" rel="noopener">b.id</a>;å¦‚æœ a è¡¨å’Œ b è¡¨å·²ç»æ˜¯ åˆ†æ¡¶è¡¨ï¼Œè€Œä¸”åˆ†æ¡¶çš„å­—æ®µæ˜¯ id å­—æ®µåšè¿™ä¸ª join æ“ä½œæ—¶ï¼Œè¿˜éœ€è¦å…¨è¡¨åšç¬›å¡å°”ç§¯</li><li>2ï¼‰æå‡æ•°æ®æ ·æœ¬çš„æŠ½å–æ•ˆç‡ï¼Œç›´æ¥æ‹¿ä¸€ä¸ªæ¡¶ä¸­çš„æ•°æ®ä½œä¸ºæ ·æœ¬æ•°æ®</li></ul></li><li><p>åˆ†åŒºè¡¨å’Œåˆ†æ¡¶è¡¨çš„åŒºåˆ«ï¼š </p><p><img src="/var/folders/6l/blvdbwd53hqglz0f09n3sd5c0000gn/T/abnerworks.Typora/image-20180612143606401.png" alt="image-20180612143606401"></p><ul><li>Hive æ•°æ®è¡¨å¯ä»¥æ ¹æ®æŸäº›å­—æ®µè¿›è¡Œåˆ†åŒºæ“ä½œï¼Œç»†åŒ–æ•°æ®ç®¡ç†ï¼Œå¯ä»¥è®©éƒ¨åˆ†æŸ¥è¯¢æ›´å¿«ã€‚</li><li>åŒæ—¶è¡¨å’Œåˆ†åŒºä¹Ÿå¯ä»¥è¿›ä¸€æ­¥è¢«åˆ’åˆ†ä¸º Bucketsï¼Œåˆ†æ¡¶è¡¨çš„åŸç†å’Œ MapReduce ç¼–ç¨‹ä¸­çš„ HashPartitioner çš„åŸç†ç±»ä¼¼ </li><li>åˆ†åŒºå’Œåˆ†æ¡¶éƒ½æ˜¯ç»†åŒ–æ•°æ®ç®¡ç†ï¼Œä½†æ˜¯åˆ†åŒºè¡¨æ˜¯æ‰‹åŠ¨æ·»åŠ åŒºåˆ†ï¼Œç”±äº Hive æ˜¯è¯»æ¨¡å¼ï¼Œæ‰€ä»¥å¯¹æ·»åŠ è¿›åˆ†åŒºçš„æ•°æ®ä¸åšæ¨¡å¼æ ¡éªŒ</li><li>åˆ†æ¡¶è¡¨ä¸­çš„æ•°æ®æ˜¯æŒ‰ç…§æŸäº›åˆ†æ¡¶å­—æ®µè¿›è¡Œ hash æ•£åˆ— å½¢æˆçš„å¤šä¸ªæ–‡ä»¶ï¼Œæ‰€ä»¥æ•°æ®çš„å‡†ç¡®æ€§ä¹Ÿé«˜å¾ˆå¤š</li></ul></li></ul></li></ul></li></ul><p><br></p><ul><li><p><strong>3)è§†å›¾ï¼š</strong></p><ul><li>hiveä¸­çš„è§†å›¾ä»…ä»…ç›¸å½“äºä¸€ä¸ªsqlè¯­å¥çš„åˆ«å</li><li><strong>åœ¨hiveä¸­ä»…ä»…å­˜åœ¨é€»è¾‘è§†å›¾ï¼Œä¸å­˜åœ¨ç‰©ç†è§†å›¾</strong><ul><li>ç‰©ç†è§†å›¾ï¼šè®²sqlè¯­å¥çš„æ‰§è¡Œç»“æœå­˜åœ¨è§†å›¾ä¸­</li><li>é€»è¾‘è§†å›¾ï¼š <strong>ä»…ä»…æ˜¯å¯¹æŸ¥è¯¢ç»“æœçš„å¼•ç”¨</strong></li></ul></li></ul></li><li><p><strong>4)æ•°æ®å­˜å‚¨ï¼š</strong></p><ul><li>åŸå§‹æ•°æ®ä¸­å­˜åœ¨HDFS</li><li>å…ƒæ•°æ®å­˜åœ¨mysql</li></ul></li></ul><p><br></p><h1 id="Hiveå®‰è£…"><a href="#Hiveå®‰è£…" class="headerlink" title="Hiveå®‰è£…"></a>Hiveå®‰è£…</h1><p><strong>è£…hiveå…¶å®ä¸éš¾ï¼Œä¸»è¦æ˜¯å®‰è£…mysqlï¼Œè§£å†³mysqlçš„æƒé™é—®é¢˜</strong></p><h2 id="MySqlå®‰è£…"><a href="#MySqlå®‰è£…" class="headerlink" title="MySqlå®‰è£…"></a>MySqlå®‰è£…</h2><h3 id="RPM-å®‰è£…MySQlï¼š"><a href="#RPM-å®‰è£…MySQlï¼š" class="headerlink" title="RPM å®‰è£…MySQlï¼š"></a>RPM å®‰è£…MySQlï¼š</h3><ol><li><p>æ£€æŸ¥ä»¥å‰æ˜¯å¦è£…è¿‡ MySQL </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -qa|grep -i mysql</span><br></pre></td></tr></table></figure></li><li><p>å‘ç°æœ‰çš„è¯å°±éƒ½å¸è½½ </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rpm -e --nodeps mysql-libs-5.1.73-5.el6_6.x86_64</span><br><span class="line">rpm -e --nodeps ....</span><br></pre></td></tr></table></figure></li><li><p>åˆ é™¤è€ç‰ˆæœ¬ mysql çš„å¼€å‘å¤´æ–‡ä»¶å’Œåº“ </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rm -rf /usr/lib64/mysql</span><br><span class="line"><span class="comment"># åœ¨æœç´¢ my.cnf æ–‡ä»¶ï¼Œæœ‰çš„è¯å°±åˆ æ‰</span></span><br></pre></td></tr></table></figure></li><li><p>ä¸Šä¼ mysql å®‰è£…åŒ…åˆ° Linuxä¸­ï¼Œè§£å‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">tar -xvf mysql-5.6.26-1.linux_glibc2.5.x86_64.rpm-bundle.tar</span><br><span class="line"><span class="comment"># è§£å‹å‡ºæ¥æœ‰è¿™äº›æ–‡ä»¶</span></span><br><span class="line">MySQL-devel-5.6.26-1.linux_glibc2.5.x86_64.rpm</span><br><span class="line">MySQL-embedded-5.6.26-1.linux_glibc2.5.x86_64.rpm</span><br><span class="line">MySQL-server-5.6.26-1.linux_glibc2.5.x86_64.rpm</span><br><span class="line">MySQL-shared-5.6.26-1.linux_glibc2.5.x86_64.rpm</span><br><span class="line">MySQL-shared-compat-5.6.26-1.linux_glibc2.5.x86_64.rpm</span><br><span class="line">MySQL-test-5.6.26-1.linux_glibc2.5.x86_64.rpm</span><br></pre></td></tr></table></figure></li><li><p>å®‰è£… server &amp; client </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># server</span></span><br><span class="line">rpm -ivh MySQL-server-5.6.26-1.linux_glibc2.5.x86_64.rpm</span><br><span class="line"><span class="comment"># client</span></span><br><span class="line">rpm -ivh MySQL-client-5.6.26-1.linux_glibc2.5.x86_64.rpm</span><br></pre></td></tr></table></figure></li><li><p>å¯åŠ¨Mysql</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service mysql start</span><br></pre></td></tr></table></figure></li><li><p>ç™»å½•Mysqlå¹¶æ”¹å¯†ç ï¼Œç­‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"># åˆå§‹å¯†ç åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­</span><br><span class="line">cat /root/.mysql_sercert </span><br><span class="line"></span><br><span class="line"># ç™»å½•</span><br><span class="line">mysql -uroot -pxxxxx</span><br><span class="line"></span><br><span class="line"># åˆ é™¤é™¤äº†`%`ä¹‹å¤–çš„å…¶ä»–æ‰€æœ‰host</span><br><span class="line">use mysql;</span><br><span class="line">select host,user,password from user;</span><br><span class="line">delete from user where host in (&apos;localhost&apos;, &apos;127.0.0.1&apos;,&apos;::1&apos;, ...)</span><br><span class="line"></span><br><span class="line"># ä¿®æ”¹å¯†ç  </span><br><span class="line">UPDATE user SET Password = PASSWORD(&apos;psd&apos;) WHERE user = &apos;root&apos;;</span><br><span class="line"></span><br><span class="line"># ä¸º`%` å’Œ `*` æ·»åŠ è¿œç¨‹ç™»å½•æƒé™ </span><br><span class="line">#æ³¨æ„ï¼š å‰é¢çš„ mysql ç™»å½•ç”¨æˆ·åï¼Œ 123 æ˜¯ç™»å½•å¯†ç </span><br><span class="line">GRANT ALL PRIVILEGES ON *.* TO &apos;root&apos;@&apos;%&apos; IDENTIFIED BY &apos;psd&apos; WITH GRANT OPTION;</span><br><span class="line">GRANT ALL PRIVILEGES ON *.* TO &apos;root&apos;@&apos;*&apos; IDENTIFIED BY &apos;psd&apos; WITH GRANT OPTION;</span><br><span class="line">FLUSH PRIVILEGES;</span><br><span class="line"></span><br><span class="line"># é€€å‡ºç™»å½•</span><br><span class="line">exit;</span><br><span class="line"></span><br><span class="line"># æ­¤æ—¶å¯ä»¥å†ç™»å½•è¯•è¯•</span><br><span class="line">mysql -uroot -ppsd</span><br><span class="line"></span><br><span class="line">======================================</span><br><span class="line"></span><br><span class="line"># ä¿®æ”¹å­—ç¬¦é›†ä¸º utf-8</span><br><span class="line"># æ–°å»ºä¸€ä¸ªæ–‡ä»¶</span><br><span class="line">vi /etc/my.cnf  </span><br><span class="line"># æ·»åŠ ä»¥ä¸‹å†…å®¹</span><br><span class="line">[client]</span><br><span class="line">default-character-set=utf8</span><br><span class="line"></span><br><span class="line">[mysql]</span><br><span class="line">default-character-set=utf8</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line">character-set-server=utf8</span><br><span class="line"></span><br><span class="line"># é‡å¯mysql</span><br><span class="line">sudo service mysql restart</span><br><span class="line"></span><br><span class="line">======================================</span><br><span class="line"></span><br><span class="line"># å¿˜è®°å¯†ç ï¼Œä¿®æ”¹å¯†ç çš„æ–¹æ³•</span><br><span class="line"># åœæ­¢mysqlæœåŠ¡çš„è¿è¡Œ</span><br><span class="line">service mysql stop</span><br><span class="line"></span><br><span class="line"># è·³è¿‡æˆæƒè¡¨è®¿é—®</span><br><span class="line">mysqld_safe --user=mysql --skip-grant-tables --skip-networking &amp; </span><br><span class="line"></span><br><span class="line"># ç™»å½•mysql</span><br><span class="line">mysql -u root mysql </span><br><span class="line"></span><br><span class="line"># æ¥ä¸‹æ¥å¯ä»¥ä¿®æ”¹å¯†ç äº†</span><br><span class="line">  ##åœ¨mysql5.7ä»¥ä¸‹çš„ç‰ˆæœ¬å¦‚ä¸‹ï¼š</span><br><span class="line">mysql&gt; UPDATE user SET Password=PASSWORD(&apos;newpassword&apos;) where USER=&apos;rootâ€™ï¼›</span><br><span class="line">  ##åœ¨mysql5.7ç‰ˆæœ¬å¦‚ä¸‹ï¼š</span><br><span class="line">update mysql.user set authentication_string=password(&apos;newpassword&apos;) ;</span><br><span class="line"></span><br><span class="line"># ä¿®æ”¹å®Œäº†é‡å¯</span><br><span class="line">service mysql restart</span><br><span class="line"></span><br><span class="line">======================================</span><br></pre></td></tr></table></figure></li></ol><h4 id="MySqlçš„å…¶å®ƒé”™è¯¯"><a href="#MySqlçš„å…¶å®ƒé”™è¯¯" class="headerlink" title="MySqlçš„å…¶å®ƒé”™è¯¯"></a>MySqlçš„å…¶å®ƒé”™è¯¯</h4><p>åœ¨è¿è¡Œ<code>schematool -dbType mysql -initSchema</code>æ‰‹åŠ¨åˆå§‹åŒ–å…ƒæ•°æ®åº“çš„æ—¶å€™</p><ul><li><p>æŠ¥äº†ä¸€ä¸ªlog4jé‡å¤åŠ è½½çš„é—®é¢˜</p><ul><li>è§£å†³ï¼šå¯ä»¥ä¸ç”¨ç†ç¬</li></ul></li><li><p>é“¾æ¥mysql å¯†ç è¿‡æœŸé—®é¢˜ <code>Your password has expired.</code></p><ul><li><p>è§£å†³ï¼š </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p123</span><br><span class="line"></span><br><span class="line">mysql&gt; use mysql</span><br><span class="line">Reading table information for completion of table and column names</span><br><span class="line">You can turn off this feature to get a quicker startup with -A</span><br><span class="line"></span><br><span class="line">Database changed</span><br><span class="line">mysql&gt; select host,user,password_expired from user;</span><br><span class="line">+-----------+------+------------------+</span><br><span class="line">| host      | user | password_expired |</span><br><span class="line">+-----------+------+------------------+</span><br><span class="line">| %         | root | N                |</span><br><span class="line">| cs1       | root | Y                |</span><br><span class="line">| 127.0.0.1 | root | Y                |</span><br><span class="line">| ::1       | root | Y                |</span><br><span class="line">+-----------+------+------------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br><span class="line">-------------</span><br><span class="line">mysql&gt; update user set password_expired=&apos;N&apos; where host=&apos;::1&apos;;</span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; update user set password_expired=&apos;N&apos; where host=&apos;cs1&apos;;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; update user set password_expired=&apos;N&apos; where host=&apos;127.0.0.1&apos;;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; FLUSH PRIVILEGES;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select host,user,password_expired from user;</span><br><span class="line">+-----------+------+------------------+</span><br><span class="line">| host      | user | password_expired |</span><br><span class="line">+-----------+------+------------------+</span><br><span class="line">| %         | root | N                |</span><br><span class="line">| cs1       | root | N                |</span><br><span class="line">| 127.0.0.1 | root | N                |</span><br><span class="line">| ::1       | root | N                |</span><br><span class="line">+-----------+------+------------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; exit</span><br><span class="line">Bye</span><br><span class="line">[ap@cs1]~/apps/hive% sudo service mysql restart</span><br><span class="line"></span><br><span class="line"># å†é‡æ–°åˆå§‹åŒ–å°±å¥½äº†</span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="Yumå®‰è£…-Mysql"><a href="#Yumå®‰è£…-Mysql" class="headerlink" title="Yumå®‰è£… Mysql"></a>Yumå®‰è£… Mysql</h3><blockquote><p><strong>å› ä¸ºç¬”è€…æ²¡è£…è¿‡ï¼Œæ‰€ä»¥è¿™éƒ¨åˆ†æš‚ä¸”ä¸è¡¨</strong></p></blockquote><hr><h2 id="step2-å®‰è£…Hive"><a href="#step2-å®‰è£…Hive" class="headerlink" title="step2-å®‰è£…Hive"></a>step2-å®‰è£…Hive</h2><p>MySqlå®‰è£…å¥½ä¹‹åï¼Œ å®‰è£…Hiveå°±å¾ˆç®€ç­”äº†</p><h4 id="æ³¨æ„-Hive-æ˜¯æ“ä½œ-Mysql-çš„æ•°æ®åº“-ä¸€å®šè¦è®°å¾—æŠŠ-mysql-é©±åŠ¨æ–‡ä»¶æ”¾åˆ°-hive-ä¸‹çš„-lib-ä¸­"><a href="#æ³¨æ„-Hive-æ˜¯æ“ä½œ-Mysql-çš„æ•°æ®åº“-ä¸€å®šè¦è®°å¾—æŠŠ-mysql-é©±åŠ¨æ–‡ä»¶æ”¾åˆ°-hive-ä¸‹çš„-lib-ä¸­" class="headerlink" title="æ³¨æ„: Hive æ˜¯æ“ä½œ Mysql çš„æ•°æ®åº“, ä¸€å®šè¦è®°å¾—æŠŠ mysql é©±åŠ¨æ–‡ä»¶æ”¾åˆ° hive ä¸‹çš„ lib ä¸­!!!"></a>æ³¨æ„: Hive æ˜¯æ“ä½œ Mysql çš„æ•°æ®åº“, ä¸€å®šè¦è®°å¾—æŠŠ mysql é©±åŠ¨æ–‡ä»¶æ”¾åˆ° hive ä¸‹çš„ lib ä¸­!!!</h4><h4 id="å¯åŠ¨beeline-å‰-è¦æŠŠ-hiveserver2å¼€èµ·æ¥-å½“ç„¶-hdfs-mysql-éƒ½è¦å¯åŠ¨èµ·æ¥"><a href="#å¯åŠ¨beeline-å‰-è¦æŠŠ-hiveserver2å¼€èµ·æ¥-å½“ç„¶-hdfs-mysql-éƒ½è¦å¯åŠ¨èµ·æ¥" class="headerlink" title="å¯åŠ¨beeline å‰, è¦æŠŠ hiveserver2å¼€èµ·æ¥, å½“ç„¶, hdfs, mysql éƒ½è¦å¯åŠ¨èµ·æ¥"></a>å¯åŠ¨beeline å‰, è¦æŠŠ hiveserver2å¼€èµ·æ¥, å½“ç„¶, hdfs, mysql éƒ½è¦å¯åŠ¨èµ·æ¥</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.ä¸Šä¼ åˆ°Linux</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.è§£å‹å®‰è£…åŒ…åˆ°å®‰è£…ç›®å½•</span></span><br><span class="line">tar -zxvf apache-hive-2.3.2-bin.tar.gz -C ~/apps/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.æŠŠMySQLé©±åŠ¨åŒ…(mysql-connector-java-5.1.40-bin.jar)æ”¾ç½®åœ¨hive çš„æ ¹è·¯å¾„ä¸‹çš„ lib ç›®å½•ï¼Œæ­¤å¤„æ˜¯ ~/apps/apache-hive-2.3.2-bin/lib</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.ä¿®æ”¹é…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">cd</span> ~/apps/apache-hive-2.3.2-bin/conf</span><br><span class="line"><span class="comment"># æ–°å»ºä¸€ä¸ª hive-site.xml</span></span><br><span class="line">touch hive-site.xml</span><br><span class="line">vi hive-site.xml</span><br><span class="line"></span><br><span class="line">+++++++++++++++++++++++++++++++++++++++++++æ·»åŠ å¦‚ä¸‹å†…å®¹++++++++++++</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">&lt;name&gt;javax.jdo.option.ConnectionURL&lt;/name&gt;</span><br><span class="line">&lt;value&gt;jdbc:mysql://localhost:3306/hivedb?createDatabaseIfNotExist=<span class="literal">true</span>&lt;/value&gt;</span><br><span class="line">&lt;description&gt;JDBC connect string <span class="keyword">for</span> a JDBC metastore&lt;/description&gt;</span><br><span class="line">&lt;!-- æ³¨æ„:å¦‚æœmysqlå’Œhive ä¸åœ¨åŒä¸€ä¸ªæœåŠ¡å™¨èŠ‚ç‚¹,éœ€è¦ä½¿ç”¨mysqlèŠ‚ç‚¹çš„ hostname æˆ– ip --&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">&lt;name&gt;javax.jdo.option.ConnectionDriverName&lt;/name&gt;</span><br><span class="line">&lt;value&gt;com.mysql.jdbc.Driver&lt;/value&gt;</span><br><span class="line">&lt;description&gt;Driver class name <span class="keyword">for</span> a JDBC metastore&lt;/description&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">&lt;name&gt;javax.jdo.option.ConnectionUserName&lt;/name&gt;</span><br><span class="line">&lt;value&gt;root&lt;/value&gt;</span><br><span class="line">&lt;description&gt;username to use against metastore database&lt;/description&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">&lt;name&gt;javax.jdo.option.ConnectionPassword&lt;/name&gt;</span><br><span class="line">&lt;value&gt;123&lt;/value&gt;</span><br><span class="line">&lt;description&gt;password to use against metastore database&lt;/description&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br><span class="line">+++++++++++++++++++++++++++++++++++++++++++æ·»åŠ å¦‚ä¸‹å†…å®¹+++++++++++</span><br><span class="line">&lt;property&gt;</span><br><span class="line">&lt;name&gt;hive.metastore.warehouse.dir&lt;/name&gt;</span><br><span class="line">&lt;value&gt;/user/hive/warehouse&lt;/value&gt;</span><br><span class="line">&lt;description&gt;hive default warehouse, <span class="keyword">if</span> nessecory, change it</span><br><span class="line"></span><br><span class="line">&lt;!-- è¿™ä¸ªæ˜¯é…ç½®hiveåœ¨HDFSä¸Š db çš„è·¯å­˜å‚¨å¾„çš„ï¼Œä¸é…é»˜è®¤é»˜è®¤å°±æ˜¯ä¸Šè¿°è·¯å¾„ --&gt;</span><br><span class="line">&lt;/description&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">++++++++++++++++++++++++++</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.é…ç½®ç¯å¢ƒå˜é‡ &amp; source</span></span><br><span class="line"><span class="comment">## æ³¨æ„ï¼šapæ˜¯æˆ‘çš„ç”¨æˆ·å®¶ç›®å½•ï¼Œæ¢ä¸Šè‡ªå·±çš„ç”¨æˆ·å®¶ç›®å½•</span></span><br><span class="line"><span class="built_in">export</span> HIVE_HOME=/home/ap/apps/apache-hive-2.3.2-bin </span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$HIVE_HOME</span>/bin</span><br><span class="line"><span class="comment"># ç”¨bashçš„æ‰¾ .bash_profileï¼Œ é…ç½®æ‰€æœ‰ç¯å¢ƒå˜é‡</span></span><br><span class="line"><span class="built_in">source</span> ~/.zshrc  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.æ­¤æ—¶åŸºæœ¬å®‰è£…å®Œæˆäº†ï¼ŒéªŒè¯Hiveå®‰è£…</span></span><br><span class="line">hive --helo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 7.é‡ç‚¹æ¥äº†ï¼ åˆå§‹åŒ–å…ƒæ•°æ®åº“</span></span><br><span class="line">schematool -dbType mysql -initSchema</span><br><span class="line">&gt; è¿™é‡Œå¯èƒ½ä¼šé‡åˆ°å¾ˆå¤šé”™è¯¯ï¼ï¼ </span><br><span class="line">&gt; ä½†æ˜¯å¦‚æœå‰é¢æŒ‰ç…§æˆ‘çš„æ–¹æ³•è£…çš„, åº”è¯¥å°±é—®é¢˜ä¸å¤§äº†</span><br><span class="line">&gt; ä¸»è¦æ˜¯ mysql è¿æ¥æƒé™çš„é—®é¢˜ï¼ï¼</span><br><span class="line"><span class="comment"># ä¸€å®šä¼šå‡ºç°çš„2ä¸ª</span></span><br><span class="line">1&gt; æ‰¾ä¸åˆ° hiveå‘½ä»¤çš„ä¸€é•¿ä¸²ç¯å¢ƒå˜é‡ (ä¸ç”¨ç†ä¼š)</span><br><span class="line">2&gt; ä¸¤ä¸ªlog4jï¼ŒjaråŒ…é‡å¤çš„é—®é¢˜ (ä¸ç”¨ç†ä¼š)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 8.åˆå§‹åŒ–å®Œæˆåï¼Œå¯ä»¥çœ‹ä¸‹æ•°æ®åº“ä¸­æœ‰æ²¡æœ‰ hivedb è¿™ä¸ªåº“ï¼ŒæˆåŠŸçš„è¯æ˜¯ä¼šæœ‰çš„</span></span><br><span class="line"><span class="comment">## å¯åŠ¨hive</span></span><br><span class="line">hive --service cli  </span><br><span class="line">&gt;hive: show databases;</span><br><span class="line"><span class="comment"># å¦‚æœèƒ½æ˜¾ç¤ºæ•°æ®åº“ï¼Œå°±æ²¡å•¥é—®é¢˜äº†</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># â¤ï¸9.Hiveçš„ä½¿ç”¨æ–¹å¼ä¹‹  HiveServer2/beeline</span></span><br><span class="line">æ­¤å¤„éœ€è¦ä¿®æ”¹ hadoop çš„é…ç½®æ–‡ä»¶</span><br><span class="line"></span><br><span class="line"><span class="comment"># 9.1.é¦–å…ˆå…³é—­hdfs &amp; yarnæœåŠ¡ &amp; RunJar(hiveæœåŠ¡)ï¼Œä¿®æ”¹hadoopé…ç½®æ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 9.2.ä¿®æ”¹ hadoop é›†ç¾¤çš„ hdfs-site.xml é…ç½®æ–‡ä»¶:åŠ å…¥ä¸€æ¡é…ç½®ä¿¡æ¯ï¼Œè¡¨ç¤ºå¯ç”¨ webhdfs</span></span><br><span class="line">&lt;property&gt;</span><br><span class="line">&lt;name&gt;dfs.webhdfs.enabled&lt;/name&gt;</span><br><span class="line">&lt;value&gt;<span class="literal">true</span>&lt;/value&gt; </span><br><span class="line">&lt;/property&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 9.3.ä¿®æ”¹ hadoop é›†ç¾¤çš„ core-site.xml é…ç½®æ–‡ä»¶:åŠ å…¥ä¸¤æ¡é…ç½®ä¿¡æ¯:è¡¨ç¤ºè®¾ç½® hadoop çš„ä»£ç†ç”¨æˆ·</span></span><br><span class="line"><span class="comment">## æ³¨æ„ï¼š æ­¤å¤„çš„apæ˜¯é…ç½® hadoop çš„ç”¨æˆ·å</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;property&gt;</span><br><span class="line">&lt;name&gt;hadoop.proxyuser.ap.hosts&lt;/name&gt;</span><br><span class="line">&lt;value&gt;*&lt;/value&gt; </span><br><span class="line">&lt;!-- è¡¨ç¤ºä»»æ„èŠ‚ç‚¹ä½¿ç”¨ hadoop é›†ç¾¤çš„ä»£ç†ç”¨æˆ· hadoop éƒ½èƒ½è®¿é—® hdfs é›†ç¾¤ --&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line"></span><br><span class="line">&lt;property&gt; </span><br><span class="line">&lt;name&gt;hadoop.proxyuser.ap.groups&lt;/name&gt; </span><br><span class="line">&lt;value&gt;*&lt;/value&gt;</span><br><span class="line">&lt;!-- è¡¨ç¤ºä»£ç†ç”¨æˆ·çš„ç»„æ‰€å± --&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line"></span><br><span class="line">ï£¿ï£¿ï£¿ æ³¨æ„ ï£¿ï£¿ï£¿</span><br><span class="line">ä¿®æ”¹å®Œæˆåï¼Œ å‘ç»™hadoopé›†ç¾¤å…¶ä»–ä¸»æœº</span><br><span class="line">scp xxx.xx  xxx.ss  cs2:<span class="variable">$PWD</span></span><br><span class="line">scp xxx.xx  xxx.ss  cs3:<span class="variable">$PWD</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment"># 9.4.é‡å¯hdfs &amp; yarnæœåŠ¡</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 9.5.å¯åŠ¨ hiveserver2 æœåŠ¡</span></span><br><span class="line"><span class="comment">## åå°å¯åŠ¨ï¼š</span></span><br><span class="line">nohup hiveserver2 1&gt;/home/ap/hiveserver.log 2&gt;/home/ap/hiveserver.err &amp; </span><br><span class="line"><span class="comment"># æˆ–è€…:</span></span><br><span class="line">nohup hiveserver2 1&gt;/dev/null 2&gt;/dev/null &amp;</span><br><span class="line"><span class="comment"># æˆ–è€…:</span></span><br><span class="line">nohup hiveserver2 &gt;/dev/null 2&gt;&amp;1 &amp;</span><br><span class="line"><span class="comment"># ä»¥ä¸Š 3 ä¸ªå‘½ä»¤æ˜¯ç­‰ä»·çš„ï¼Œç¬¬ä¸€ä¸ªè¡¨ç¤ºè®°å½•æ—¥å¿—ï¼Œç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªè¡¨ç¤ºä¸è®°å½•æ—¥å¿—</span></span><br><span class="line"></span><br><span class="line">æ³¨æ„ï¼š nohup å¯ä»¥åœ¨ä½ é€€å‡ºå¸æˆ·/å…³é—­ç»ˆç«¯ä¹‹åç»§ç»­è¿è¡Œç›¸åº”çš„è¿›ç¨‹ã€‚ nohup å°±æ˜¯ä¸æŒ‚èµ·çš„æ„æ€(no hang up)ã€‚</span><br><span class="line">è¯¥å‘½ä»¤çš„ä¸€èˆ¬å½¢å¼ä¸º:nohup <span class="built_in">command</span> &amp;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 9.6 å¯åŠ¨ beeline å®¢æˆ·ç«¯å»è¿æ¥</span></span><br><span class="line">æ–¹å¼1ï¼šæ‰§è¡Œå‘½ä»¤:</span><br><span class="line">beeline -u jdbc:hive2://cs2:10000 -n ap</span><br><span class="line">-u : æŒ‡å®šå…ƒæ•°æ®åº“çš„é“¾æ¥ä¿¡æ¯ -n : æŒ‡å®šç”¨æˆ·åå’Œå¯†ç </span><br><span class="line"></span><br><span class="line">æ–¹å¼2ï¼š</span><br><span class="line">å…ˆæ‰§è¡Œ </span><br><span class="line">beeline</span><br><span class="line">ç„¶åæŒ‰å›¾æ‰€ç¤ºè¾“å…¥:</span><br><span class="line"><span class="comment"># æ­¤å¤„çš„cs2æ˜¯åªå®‰è£…hiveçš„hostname</span></span><br><span class="line">!connect jdbc:hive2://cs2:10000 æŒ‰å›è½¦ï¼Œç„¶åè¾“å…¥ç”¨æˆ·åï¼Œå¯†ç ï¼Œè¿™ä¸ª ç”¨æˆ·åå°±æ˜¯å®‰è£… hadoop é›†ç¾¤çš„ç”¨æˆ·åå’Œå¯†ç </span><br></pre></td></tr></table></figure><h4 id="ç™»å½•beeline-bee"><a href="#ç™»å½•beeline-bee" class="headerlink" title="ç™»å½•beeline  :bee:"></a>ç™»å½•beeline  :bee:</h4><p><strong>æ–¹å¼1: ç›´æ¥ç™»å½•</strong></p><p>ç™»å½•å‰è¦å¼€å¯ RunJar è¿›ç¨‹, ä¹Ÿå°±æ˜¯ å¼€å¯hiveserver2</p><p><code>nohup hiveserver2 1&gt;/home/ap/hiveserver.log 2&gt;/home/ap/hiveserver.err &amp;</code></p><p><code>beeline -u jdbc:hive2://cs2:10000 -n ap</code></p><p><strong>æ–¹å¼2: è¾“å…¥ç”¨æˆ·åå¯†ç ç™»å½•</strong></p><p><code>!connect jdbc:hive2://cs2:10000</code></p><h4 id="ç™»å½•-hive"><a href="#ç™»å½•-hive" class="headerlink" title="ç™»å½• hive"></a>ç™»å½• hive</h4><p><code>hive</code></p><h4 id="PS-Linuxç¯å¢ƒå˜é‡å¤±æ•ˆ"><a href="#PS-Linuxç¯å¢ƒå˜é‡å¤±æ•ˆ" class="headerlink" title="PS: Linuxç¯å¢ƒå˜é‡å¤±æ•ˆ"></a>PS: Linuxç¯å¢ƒå˜é‡å¤±æ•ˆ</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°±æ˜¯ç›´æ¥æŠŠç¯å¢ƒå˜é‡è®¾ç½®ä¸º/bin:/usr/binï¼Œå› ä¸ºå¸¸ç”¨çš„å‘½ä»¤éƒ½åœ¨/binè¿™ä¸ªæ–‡ä»¶å¤¹ä¸­ã€‚</span></span><br><span class="line">PATH=/bin:/usr/bin</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¥ä¸‹æ¥ä¿®æ”¹ .bashr_profile æˆ–åˆ™ .zshrcä¸­çš„å†…å®¹å³å¯ï¼Œ ä¿®æ”¹å®Œäº†é‡æ–°source</span></span><br></pre></td></tr></table></figure><h1 id="Hive-â€“-DDL"><a href="#Hive-â€“-DDL" class="headerlink" title="Hive â€“ DDL"></a>Hive â€“ DDL</h1><h3 id="åº“çš„æ“ä½œ"><a href="#åº“çš„æ“ä½œ" class="headerlink" title="åº“çš„æ“ä½œ"></a>åº“çš„æ“ä½œ</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿  åº“çš„æ“ä½œ ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿</span><br><span class="line">============================================================================</span><br><span class="line"></span><br><span class="line"># ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ å»ºåº“ ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿</span><br><span class="line">CREATE (DATABASE|SCHEMA) [IF NOT EXISTS] database_name [COMMENT database_comment]</span><br><span class="line">[LOCATION hdfs_path]</span><br><span class="line">[WITH DBPROPERTIES (property_name=property_value, ...)];</span><br><span class="line"></span><br><span class="line">1ã€åˆ›å»ºæ™®é€šåº“</span><br><span class="line">create database dbname;</span><br><span class="line"></span><br><span class="line">2ã€åˆ›å»ºåº“çš„æ—¶å€™æ£€æŸ¥å­˜ä¸å¦</span><br><span class="line">create databse if not exists dbname;</span><br><span class="line"></span><br><span class="line">3ã€åˆ›å»ºåº“çš„æ—¶å€™å¸¦æ³¨é‡Š</span><br><span class="line">create database if not exists dbname comment &apos;create my db named dbname&apos;;</span><br><span class="line"></span><br><span class="line">4ã€æŸ¥çœ‹åˆ›å»ºåº“çš„è¯¦ç»†è¯­å¥</span><br><span class="line">show create database mydb;</span><br><span class="line"></span><br><span class="line"># ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ æŸ¥çœ‹åº“ ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿</span><br><span class="line">1ã€æŸ¥çœ‹æœ‰å“ªäº›æ•°æ®åº“ </span><br><span class="line">show databases;</span><br><span class="line"></span><br><span class="line">2ã€æ˜¾ç¤ºæ•°æ®åº“çš„è¯¦ç»†å±æ€§ä¿¡æ¯</span><br><span class="line">è¯­æ³•:desc database [extended] dbname; </span><br><span class="line">ç¤ºä¾‹:desc database extended myhive;</span><br><span class="line"></span><br><span class="line">3ã€æŸ¥çœ‹æ­£åœ¨ä½¿ç”¨å“ªä¸ªåº“ </span><br><span class="line">select current_database();</span><br><span class="line"></span><br><span class="line">4ã€æŸ¥çœ‹åˆ›å»ºåº“çš„è¯¦ç»†è¯­å¥ </span><br><span class="line">show create database mydb;</span><br><span class="line"></span><br><span class="line">5ã€æŸ¥çœ‹ä»¥xxå¼€å¤´çš„åº“</span><br><span class="line">show databases like &apos;s*&apos;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ åˆ é™¤åº“ ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿</span><br><span class="line">åˆ é™¤åº“æ“ä½œ:</span><br><span class="line">drop database dbname;</span><br><span class="line">drop database if exists dbname;</span><br><span class="line"></span><br><span class="line">é»˜è®¤æƒ…å†µä¸‹ï¼Œhive ä¸å…è®¸åˆ é™¤åŒ…å«è¡¨çš„æ•°æ®åº“ï¼Œæœ‰ä¸¤ç§è§£å†³åŠæ³•:</span><br><span class="line">1ã€ æ‰‹åŠ¨åˆ é™¤åº“ä¸‹æ‰€æœ‰è¡¨ï¼Œç„¶ååˆ é™¤åº“</span><br><span class="line">2ã€ ä½¿ç”¨ cascade å…³é”®å­—</span><br><span class="line">drop database if exists dbname cascade;</span><br><span class="line"></span><br><span class="line">    é»˜è®¤æƒ…å†µä¸‹å°±æ˜¯ restrictï¼ˆä¸¥æ ¼æ¨¡å¼ï¼‰, å2è¡Œæ•ˆæœä¸€æ ·</span><br><span class="line">drop database if exists myhive </span><br><span class="line">drop database if exists myhive restrict</span><br><span class="line"></span><br><span class="line"># ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ åˆ‡æ¢åº“ ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿</span><br><span class="line">åˆ‡æ¢åº“æ“ä½œ:</span><br><span class="line">- è¯­æ³•:</span><br><span class="line">use database_name </span><br><span class="line">- å®ä¾‹:</span><br><span class="line">use myhive;</span><br></pre></td></tr></table></figure><h3 id="è¡¨çš„æ“ä½œ"><a href="#è¡¨çš„æ“ä½œ" class="headerlink" title="è¡¨çš„æ“ä½œ"></a>è¡¨çš„æ“ä½œ</h3><h4 id="åˆ›å»ºè¡¨"><a href="#åˆ›å»ºè¡¨" class="headerlink" title="åˆ›å»ºè¡¨"></a>åˆ›å»ºè¡¨</h4><h5 id="å»ºè¡¨è¯­æ³•"><a href="#å»ºè¡¨è¯­æ³•" class="headerlink" title="å»ºè¡¨è¯­æ³•"></a><strong>å»ºè¡¨è¯­æ³•</strong></h5><ul><li><code>CREATE [EXTERNAL] TABLE [IF NOT EXISTS] &lt;table_name&gt;</code><br>åˆ›å»ºå†…éƒ¨è¡¨ï¼›æ·»åŠ EXTERNALå‚æ•°ä¼šåˆ›å»ºå¤–éƒ¨è¡¨</li><li><code>(col_name data_type [COMMENT col_comment], ...)</code><br>æ·»åŠ å­—æ®µå’Œå­—æ®µæè¿°</li><li><code>[COMMENT table_comment]</code><br>æ·»åŠ è¡¨æè¿°</li><li><code>[PARTITIONED BY (col_name data_type [COMMENT col_comment], ...)]</code><br>æŒ‡å®šåˆ†åŒºå­—æ®µå’Œå­—æ®µæè¿°ï¼Œåˆ†åŒºå­—æ®µä¸èƒ½ä¸ºå»ºè¡¨å­—æ®µï¼</li><li><code>[CLUSTERED BY (col_name, col_name, ...)]  SORTED BY (col_name [ASC|DESC], ...)] INTO num_buckets BUCKETS]</code><ul><li>æŒ‡å®šåˆ†æ¡¶å­—æ®µï¼Œåˆ†æ¡¶å­—æ®µå¿…é¡»ä¸ºå»ºè¡¨å­—æ®µï¼</li><li>æŒ‡å®šæ’åºå­—æ®µï¼Œæ­¤å­—æ®µä¹Ÿå¿…é¡»ä¸ºå»ºè¡¨å­—æ®µï¼ŒæŒ‡å®šçš„æ˜¯åˆ†æ¡¶å†…çš„æ’åº</li><li>æŒ‡å®šåˆ†æ¡¶ä¸ªæ•°ï¼ˆhashåå†å–æ¨¡ï¼‰</li></ul></li><li><code>[ROW FORMAT row_format]</code><br>æŒ‡å®šåˆ†éš”ç¬¦ï¼Œrow_format æ ¼å¼ï¼š<pre><code>åˆ—åˆ†éš”ç¬¦ï¼š`delimited fields terminated by â€˜x&apos;`è¡Œåˆ†éš”ç¬¦ï¼š`line terminated by â€˜x&apos;`</code></pre></li><li><code>[STORED AS file_format]</code><br>æŒ‡å®šå­˜å‚¨æ ¼å¼<pre><code>textfileï¼šæ–‡æœ¬æ ¼å¼ï¼Œé»˜è®¤rcfileï¼šè¡Œåˆ—ç»“åˆæ ¼å¼parquetï¼šå‹ç¼©æ ¼å¼</code></pre></li><li><code>[LOCATION hdfs_path]</code><br>æŒ‡å®šè¡¨åœ¨hsfsä¸Šçš„å­˜å‚¨è·¯å¾„ï¼Œä¸æŒ‡å®šçš„è¯å°±æŒ‰é…ç½®çš„è·¯å¾„å­˜å‚¨ï¼Œå¦‚æœä¹Ÿæ²¡æŒ‡å®šå°±åœ¨hiveé»˜è®¤çš„è·¯ç» <code>/user/hive/warehouse</code></li></ul><h5 id="å»ºè¡¨ä»£ç "><a href="#å»ºè¡¨ä»£ç " class="headerlink" title="å»ºè¡¨ä»£ç "></a>å»ºè¡¨ä»£ç </h5><ul><li>a. åˆ›å»ºå†…éƒ¨è¡¨<ul><li><code>create table mytable (id int, name string) row format delimited fields terminated by &#39;,&#39; stored as textfile;</code></li></ul></li><li>b. åˆ›å»ºå¤–éƒ¨è¡¨<ul><li><code>create  external table mytable2 (id int, name string) row format delimited  fields terminated by &#39;,&#39; location &#39;/user/hive/warehouse/mytable2&#39;;</code></li></ul></li><li>c. åˆ›å»ºåˆ†åŒºè¡¨<ul><li><code>create  table table3(id int, name string) partitioned by(sex string) row format  delimited fields terminated by &#39;,&#39; stored as textfile;</code></li><li>æ’å…¥åˆ†åŒºæ•°æ®ï¼š<code>load data local inpath &#39;/root/hivedata/mingxing.txt&#39; overwrite into table mytable3 partition(sex=&#39;girlâ€™);</code></li><li>æŸ¥è¯¢è¡¨åˆ†åŒºï¼š <code>show partitions mytable3</code></li></ul></li><li>d. åˆ›å»ºåˆ†æ¡¶è¡¨<ul><li><code>create  table stu_buck(Sno int,Sname string,Sex string,Sage int,Sdept string)  clustered by(Sno) sorted by(Sno DESC) into 4 buckets row format  delimited fields terminated by &#39;,â€™;</code></li></ul></li><li>e. å¤åˆ¶è¡¨<ul><li><code>create [external] table [if not exists] new_table like table_name;</code></li></ul></li><li>f. æŸ¥è¯¢è¡¨<ul><li><code>create table table_a as select * from  teble_b;</code></li></ul></li></ul><h4 id="æŸ¥çœ‹è¡¨"><a href="#æŸ¥çœ‹è¡¨" class="headerlink" title="æŸ¥çœ‹è¡¨"></a>æŸ¥çœ‹è¡¨</h4><ul><li><code>desc &lt;table_name&gt;</code>ï¼šæ˜¾ç¤ºè¡¨çš„å­—æ®µä¿¡æ¯</li><li><code>desc formatted &lt;table_name&gt;</code>ï¼šæ ¼å¼åŒ–æ˜¾ç¤ºè¡¨çš„è¯¦ç»†ä¿¡æ¯</li><li><code>desc extended &lt;table_name&gt;</code>ï¼šæ˜¾ç¤ºè¡¨çš„è¯¦ç»†ä¿¡æ¯</li></ul><h4 id="ä¿®æ”¹è¡¨"><a href="#ä¿®æ”¹è¡¨" class="headerlink" title="ä¿®æ”¹è¡¨"></a>ä¿®æ”¹è¡¨</h4><ul><li>é‡å‘½å<ul><li><code>ALTER TABLE old_name RENAME TO new_name</code></li></ul></li><li>ä¿®æ”¹å±æ€§<ul><li><code>ALTER TABLE table_name SET TBLPROPERTIES (&#39;comment&#39; = &#39;my new students tableâ€™);</code></li><li>ä¸æ”¯æŒä¿®æ”¹è¡¨åï¼Œå’Œè¡¨çš„æ•°æ®å­˜å‚¨ç›®å½•</li></ul></li><li>å¢åŠ /ä¿®æ”¹/æ›¿æ¢å­—æ®µ<ul><li><code>ALTER TABLE table_name ADD COLUMNS (col_spec [, col_spec ...])</code><br>æ–°å¢çš„å­—æ®µä½ç½®åœ¨æ‰€æœ‰åˆ—åé¢ ( partition åˆ—å‰ )</li><li><code>ALTER TABLE table_name CHANGE c_name new_c_name new_c_type [FIRST | AFTER c_name]</code><br>æ³¨æ„ä¿®æ”¹å­—æ®µæ—¶ï¼Œç±»å‹åªèƒ½ç”±å°ç±»å‹è½¬ä¸ºå¤§ç±»å‹ï¼Œä¸è®©å›æŠ¥é”™ï¼›ï¼ˆåœ¨hive1.2.2ä¸­å¹¶æ²¡æœ‰æ­¤é™åˆ¶ï¼‰</li><li><code>ALTER TABLE table_name REPLACE COLUMNS (col_spec [, col_spec ...])</code><br>REPLACE è¡¨ç¤ºæ›¿æ¢è¡¨ä¸­æ‰€æœ‰å­—æ®µ</li></ul></li><li>æ·»åŠ /åˆ é™¤åˆ†åŒº<ul><li>æ·»åŠ åˆ†åŒºï¼š<code>ALTER TABLE table_name ADD [IF NOT EXISTS]  PARTITION (partition_col = col_value1 [ ... ] ) [LOCATION &#39;location1â€™]</code></li><li>åˆ é™¤åˆ†åŒºï¼š<code>ALTER TABLE table_name DROP [IF EXISTS] PARTITION (partition_col = col_value1 [ ... ] )</code></li><li>ä¿®æ”¹åˆ†åŒºè·¯å¾„ï¼š<code>ALTER TABLE student_p PARTITION (part=&#39;bb&#39;) SET LOCATION &#39;/myhive_bbbbbâ€™;</code></li><li><strong>[è¡¥å……ï¼š]</strong><ul><li>1ã€ é˜²æ­¢åˆ†åŒºè¢«åˆ é™¤ï¼šalter table student_p partition (part=â€™aaâ€™) enable no_drop;</li><li>2ã€ é˜²æ­¢åˆ†åŒºè¢«æŸ¥è¯¢ï¼šalter table student_p partition (part=â€™aaâ€™) enable offline;<br>enable å’Œ disable æ˜¯åå‘æ“ä½œ </li></ul></li></ul></li></ul><h4 id="åˆ é™¤è¡¨"><a href="#åˆ é™¤è¡¨" class="headerlink" title="åˆ é™¤è¡¨"></a>åˆ é™¤è¡¨</h4><ul><li><code>drop table if exists &lt;table_name&gt;;</code></li></ul><h4 id="æ¸…ç©ºè¡¨"><a href="#æ¸…ç©ºè¡¨" class="headerlink" title="æ¸…ç©ºè¡¨"></a>æ¸…ç©ºè¡¨</h4><p>ä¼šä¿ç•™è¡¨ç»“æ„</p><ul><li><code>truncate table table_name;</code></li><li><code>truncate table table_name partition(city=&#39;beijingâ€™);</code></li></ul><h4 id="å…¶ä»–è¾…åŠ©å‘½ä»¤"><a href="#å…¶ä»–è¾…åŠ©å‘½ä»¤" class="headerlink" title="å…¶ä»–è¾…åŠ©å‘½ä»¤"></a>å…¶ä»–è¾…åŠ©å‘½ä»¤</h4><ul><li>a. æŸ¥çœ‹æ•°æ®åº“åˆ—è¡¨<ul><li><code>show databases;</code></li><li><code>show databases like &#39;my*&#39;;</code></li></ul></li><li>b. æŸ¥çœ‹æ•°æ®è¡¨<ul><li><code>show tables;</code></li><li><code>show tables in db_name;</code></li></ul></li><li>c. æŸ¥çœ‹æ•°æ®è¡¨çš„å»ºè¡¨è¯­å¥<ul><li><code>show create table table_name;</code></li></ul></li><li>d. æŸ¥çœ‹ hive å‡½æ•°åˆ—è¡¨<ul><li><code>show functions;</code></li></ul></li><li>e. æŸ¥çœ‹ hive è¡¨çš„åˆ†åŒº<ul><li><code>show partitions table_name;</code></li><li><code>show partitions table_name partition(city=&#39;beijing&#39;)</code></li></ul></li><li>f. æŸ¥çœ‹è¡¨çš„è¯¦ç»†ä¿¡æ¯ï¼ˆå…ƒæ•°æ®ä¿¡æ¯ï¼‰ <ul><li><code>desc table_name;</code></li><li><code>desc extended table_name;</code></li></ul></li><li>g. æŸ¥çœ‹æ•°æ®åº“çš„è¯¦ç»†å±æ€§ä¿¡æ¯<ul><li><code>desc formatted table_name;</code></li><li><code>desc database db_name; desc database extended db_name;</code></li></ul></li><li>h. æ¸…ç©ºæ•°æ®è¡¨<ul><li><code>truncate table table_name;</code></li></ul></li></ul><p><br></p><h1 id="Hive-â€“-DML"><a href="#Hive-â€“-DML" class="headerlink" title="Hive â€“ DML"></a>Hive â€“ DML</h1><h3 id="è£…è½½æ•°æ®"><a href="#è£…è½½æ•°æ®" class="headerlink" title="è£…è½½æ•°æ®"></a>è£…è½½æ•°æ®</h3><ul><li><code>LOAD DATA [LOCAL] INPATH &#39;filepath&#39; [OVERWRITE] INTO TABLE table_name [PARTITION (partcol1=val1, partcol2=val2 ...)]</code></li><li>æ³¨æ„ï¼š<ul><li>LOAD æ“ä½œåªæ˜¯å•çº¯çš„ å¤åˆ¶ï¼ˆæœ¬åœ°æ–‡ä»¶ï¼‰æˆ–è€… ç§»åŠ¨ï¼ˆhdfsæ–‡ä»¶ï¼Œä¸€èˆ¬æ˜¯å…¬å…±æ•°æ®ï¼Œéœ€è¦å»ºç«‹å¤–éƒ¨è¡¨ï¼‰æ“ä½œï¼Œå°†æ•°æ®æ–‡ä»¶ç§»åŠ¨åˆ° Hive è¡¨å¯¹åº”çš„ä½ç½®</li><li>å¦‚æœæŒ‡å®šäº† LOCAL å°±å»æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­æŸ¥æ‰¾ï¼Œå¦åˆ™æŒ‰ inpath ä¸­çš„ uri åœ¨ hdfs ä¸ŠæŸ¥æ‰¾</li><li>inpath å­å¥ä¸­çš„æ–‡ä»¶è·¯å¾„ä¸‹ï¼Œä¸èƒ½å†æœ‰æ–‡ä»¶å¤¹</li><li>å¦‚æœä½¿ç”¨äº† OVERWRITE å…³é”®å­—ï¼Œåˆ™ç›®æ ‡è¡¨ï¼ˆæˆ–è€…åˆ†åŒºï¼‰ä¸­çš„å†…å®¹ä¼šè¢«åˆ é™¤ï¼Œç„¶åå†å°† filepath æŒ‡å‘çš„æ–‡ä»¶/ç›®å½•ä¸­çš„å†…å®¹æ·»åŠ åˆ°è¡¨/åˆ†åŒºä¸­ã€‚ </li><li>å¦‚æœç›®æ ‡è¡¨ï¼ˆåˆ†åŒºï¼‰å·²ç»æœ‰ä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶ä¸”æ–‡ä»¶åå’Œ filepath ä¸­çš„æ–‡ä»¶åå†²çªï¼Œé‚£ä¹ˆç°æœ‰çš„æ–‡ä»¶ä¼šè¢«æ–°æ–‡ä»¶æ‰€æ›¿ä»£ã€‚???ä¸æ˜¯è‡ªåŠ¨é‡å‘½åä¸ºxxx_copy_1</li></ul></li></ul><h3 id="æ’å…¥æ•°æ®"><a href="#æ’å…¥æ•°æ®" class="headerlink" title="æ’å…¥æ•°æ®"></a>æ’å…¥æ•°æ®</h3><ul><li><p>a. å•æ¡æ’å…¥</p><ul><li><code>INSERT INTO TABLE table_name VALUES(value1, value2, ...);</code></li></ul></li><li><p>b. å•é‡æ’å…¥</p><ul><li><code>INSERT INTO TABLE table_name [PARTITION (partcol1=val1, ...)] &lt;select_statement1 FROM from_statement&gt;</code></li></ul></li><li><p>c. å¤šé‡æ’å…¥</p><ul><li>FROM from_statement<br>ä»åŸºè¡¨ä¸­æŒ‰ä¸åŒçš„å­—æ®µæŸ¥è¯¢å¾—åˆ°çš„ç»“æœåˆ†åˆ«æ’å…¥ä¸åŒçš„ hive è¡¨<br>åªä¼šæ‰«æä¸€æ¬¡åŸºè¡¨ï¼Œæé«˜æŸ¥è¯¢æ€§èƒ½</li><li><code>INSERT INTO TABLE table_name1 [PARTITION (partcol1=val1, partcol2=val2 ...)] select_statement1 [WHERE where_statement]</code></li><li><code>INSERT INTO TABLE table_name2 [PARTITION (partcol1=val1, partcol2=val2 ...)] select_statement2 [WHERE where_statement]</code></li><li>[ â€¦ ];</li></ul></li><li><p>d. åˆ†åŒºæ’å…¥</p><ul><li><p>åˆ†åŒºæ’å…¥æœ‰ä¸¤ç§ï¼šä¸€ç§æ˜¯é™æ€åˆ†åŒºï¼Œå¦ä¸€ç§æ˜¯åŠ¨æ€åˆ†åŒºã€‚</p></li><li><p>å¦‚æœæ··åˆä½¿ç”¨é™æ€åˆ†åŒºå’ŒåŠ¨æ€åˆ†åŒºï¼Œ åˆ™é™æ€åˆ†åŒºå¿…é¡»å‡ºç°åœ¨åŠ¨æ€åˆ†åŒºä¹‹å‰ã€‚</p></li><li><p>é™æ€åˆ†åŒº</p><ul><li>A)ã€åˆ›å»ºé™æ€åˆ†åŒºè¡¨ </li><li>B)ã€ä»æŸ¥è¯¢ç»“æœä¸­å¯¼å…¥æ•°æ®ï¼ˆå•é‡æ’å…¥ï¼‰<br>è®°å¾—åŠ è½½æ•°æ®å‰è¦æ·»åŠ åˆ†åŒºï¼Œç„¶åæŒ‡å®šè¦åŠ è½½åˆ°é‚£ä¸ªåˆ†åŒº</li><li>C)ã€æŸ¥çœ‹æ’å…¥ç»“æœ </li></ul></li><li><p>åŠ¨æ€åˆ†åŒº</p><ul><li><p>é™æ€åˆ†åŒºæ·»åŠ æ•°æ®å‰éœ€è¦æŒ‡å®šåˆ†åŒºï¼Œå½“åˆ†åŒºä¸ªæ•°ä¸ç¡®å®šçš„æ—¶å€™å°±å¾ˆä¸æ–¹ä¾¿äº†ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨åŠ¨æ€åˆ†åŒº</p></li><li><p>é‡è¦ä¸”å¸¸ç”¨ï¼Œå°¤å…¶æ˜¯æŒ‰ç…§æ—¥æœŸåˆ†åŒºæ—¶ï¼</p></li><li><p>A)ã€åˆ›å»ºåˆ†åŒºè¡¨ </p></li><li><p>B)ã€å‚æ•°è®¾ç½®</p></li></ul></li></ul></li></ul><pre><code>  hive-1.2ç‰ˆæœ¬  -  set hive.exec.dynamic.partition=true;   //åŠ¨æ€åˆ†åŒºå¼€å¯çŠ¶æ€ï¼Œé»˜è®¤å¼€å¯  -  set hive.exec.dynamic.partition.mode=nonstrict;   //åŠ¨æ€åˆ†åŒºæ‰§è¡Œæ¨¡å¼ï¼Œé»˜è®¤&quot;strict&quot;ï¼Œåœ¨è¿™ç§æ¨¡å¼ ä¸‹è¦æ±‚è‡³å°‘æœ‰ä¸€åˆ—åˆ†åŒºå­—æ®µæ˜¯é™æ€çš„ï¼Œè¿™æœ‰åŠ©äºé˜»æ­¢å› è®¾è®¡é”™è¯¯å¯¼è‡´æŸ¥è¯¢äº§ç”Ÿå¤§é‡çš„åˆ†åŒº  - \# å¯é€‰è®¾ç½®é¡¹    å¦‚æœè¿™äº›å‚æ•°è¢«æ›´æ”¹äº†åˆæƒ³è¿˜åŸï¼Œåˆ™æ‰§è¡Œä¸€æ¬¡ reset å‘½ä»¤å³å¯    - set hive.exec.max.dynamic.partitions.pernode=100;   //æ¯ä¸ªèŠ‚ç‚¹ç”ŸæˆåŠ¨æ€åˆ†åŒºæœ€å¤§ä¸ªæ•°     - set hive.exec.max.dynamic.partitions=1000;   //ç”ŸæˆåŠ¨æ€åˆ†åŒºæœ€å¤§ä¸ªæ•°ï¼Œå¦‚æœè‡ªåŠ¨åˆ†åŒºæ•°å¤§äºè¿™ä¸ªå‚æ•°ï¼Œå°†ä¼šæŠ¥é”™     - set hive.exec.max.created.files=100000;   //ä¸€ä¸ªä»»åŠ¡æœ€å¤šå¯ä»¥åˆ›å»ºçš„æ–‡ä»¶æ•°ç›®     - set dfs.datanode.max.xcievers=4096;   //é™å®šä¸€æ¬¡æœ€å¤šæ‰“å¼€çš„æ–‡ä»¶æ•° set     - hive.error.on.empty.partition=false;   //è¡¨ç¤ºå½“æœ‰ç©ºåˆ†åŒºäº§ç”Ÿæ—¶ï¼Œæ˜¯å¦æŠ›å‡ºå¼‚å¸¸- C)ã€åŠ¨æ€æ•°æ®æ’å…¥   - å•ä¸ªåˆ†åŒºå­—æ®µ    - insert into table test2 partition (age) select name,address,school,age from students;   - å¤šä¸ªåˆ†åŒºå­—æ®µ    å¤šé‡åˆ†åŒºä¸­ç›®å½•ç»“æ„æ˜¯æŒ‰ç…§åˆ†åŒºå­—æ®µé¡ºåºè¿›è¡Œåˆ’åˆ†çš„    - insert into table student_ptn2 partition(department, age) select id, name, sex, department,age from students;      åˆ†åŒºå­—æ®µéƒ½æ˜¯åŠ¨æ€çš„    - insert into table student_ptn2 partition(city=&apos;sa&apos;, zipcode) select id, name, sex, age, department, department as zipcode from students;      ç¬¬ä¸€ä¸ªåˆ†åŒºå­—æ®µæ—¶é™æ€çš„ï¼Œç¬¬äºŒå­—departmentå­—æ®µåŠ¨æ€çš„ï¼Œé‡å‘½åä¸ºzipcodeï¼Ÿ  - [æ³¨æ„ï¼š]    - æŸ¥è¯¢è¯­å¥ select æŸ¥è¯¢å‡ºæ¥çš„åŠ¨æ€åˆ†åŒº age å’Œ zipcode å¿…é¡»æ”¾åœ¨ æœ€åï¼Œå’Œåˆ†åŒºå­—æ®µå¯¹åº”ï¼Œä¸ç„¶ç»“æœä¼šå‡ºé”™- D)ã€æŸ¥çœ‹æ’å…¥ç»“æœ  - select * from student_ptn2 where city=&apos;sa&apos; and zipcode=&apos;MA&apos;;</code></pre><ul><li><p>e. åˆ†æ¡¶æ’å…¥</p><ul><li>A)ã€åˆ›å»ºåˆ†æ¡¶è¡¨</li><li>B)ã€ä»æŸ¥è¯¢ç»“æœä¸­å¯¼å…¥æ•°æ®<br>åªèƒ½ä½¿ç”¨insertæ–¹å¼</li><li>C)ã€æŸ¥çœ‹æ’å…¥ç»“æœ </li><li># å‡ ä¸ªå‘½ä»¤<ul><li>set hive.exec.reducers.bytes.per.reducer=<number>  // è®¾ç½®æ¯ä¸ªreducerçš„ååé‡ï¼Œå•ä½byteï¼Œé»˜è®¤256M</number></li><li>set hive.exec.reducers.max=<number>  //reduceTaskæœ€å¤šæ‰§è¡Œä¸ªæ•°ï¼Œé»˜è®¤1009</number></li><li>set mapreduce.job.reduces=<number>   //è®¾ç½®reducetaskå®é™…è¿è¡Œæ•°ï¼Œé»˜è®¤-1ï¼Œä»£è¡¨æ²¡æœ‰è®¾ç½®ï¼Œå³reducetaské»˜è®¤æ•°ä¸º1</number></li><li>set hive.exec.mode.local.auto=true //è®¾ç½®hiveæœ¬åœ°æ¨¡å¼</li></ul></li></ul></li></ul><h3 id="å¯¼å‡ºæ•°æ®ï¼ˆäº†è§£ï¼‰"><a href="#å¯¼å‡ºæ•°æ®ï¼ˆäº†è§£ï¼‰" class="headerlink" title="å¯¼å‡ºæ•°æ®ï¼ˆäº†è§£ï¼‰"></a>å¯¼å‡ºæ•°æ®ï¼ˆäº†è§£ï¼‰</h3><ul><li>å•æ¨¡å¼å¯¼å‡º<ul><li><code>INSERT OVERWRITE [LOCAL] DIRECTORY directory1 &lt;select_statement&gt;;</code></li></ul></li><li>å¤šæ¨¡å¼å¯¼å‡º<ul><li><code>FROM from_statement</code></li><li><code>INSERT OVERWRITE [LOCAL] DIRECTORY directory1 &lt;select_statement1&gt;</code></li><li><code>[INSERT OVERWRITE [LOCAL] DIRECTORY directory2 &lt;select_statement2&gt;] ...</code></li></ul></li></ul><h3 id="æŸ¥è¯¢æ•°æ®"><a href="#æŸ¥è¯¢æ•°æ®" class="headerlink" title="æŸ¥è¯¢æ•°æ®"></a>æŸ¥è¯¢æ•°æ®</h3><ul><li>Hive ä¸­çš„ SELECT åŸºç¡€è¯­æ³•å’Œæ ‡å‡† SQL è¯­æ³•åŸºæœ¬ä¸€è‡´ï¼Œæ”¯æŒ WHEREã€DISTINCTã€GROUP BYã€ ORDER BYã€HAVINGã€LIMITã€å­æŸ¥è¯¢ç­‰ï¼›<ul><li>1ã€<code>select * from db.table1</code><br>è™½ç„¶å¯ä»¥ï¼Œä½†æ˜¯è¦å°½é‡é¿å… select * è¿™æ ·çš„å…¨è¡¨æ‰«ææ“ä½œï¼Œæ•ˆç‡å¤ªä½åˆè´¹æ—¶</li><li>2ã€<code>select count(distinct uid) from db.table1</code></li><li>3ã€æ”¯æŒ selectã€union allã€joinï¼ˆleftã€rightã€full joinï¼‰ã€likeã€whereã€havingã€å„ç§èšåˆå‡½æ•°ã€ æ”¯æŒ json è§£æ </li><li>4ã€UDF/ UDAF/UDTF <ul><li>UDFï¼šUser Defined Functionï¼Œè‡ªå®šä¹‰å‡½æ•°ï¼Œä¸€å¯¹ä¸€</li><li>UDAFï¼šUser Defined Aggregate Functionï¼Œè‡ªå®šä¹‰èšåˆå‡½æ•°ï¼Œå¤šå¯¹ä¸€ï¼Œå¦‚sum()ï¼Œcount()</li><li>UDTF ï¼šUser Defined Table Functionï¼Œè‡ªå®šä¹‰è¡¨å‡½æ•°ï¼Œä¸€å¯¹å¤šï¼Œå¦‚explode()</li></ul></li><li>5ã€ä¸æ”¯æŒ update å’Œ delete </li><li>6ã€hive è™½ç„¶æ”¯æŒ in/existsï¼ˆè€ç‰ˆæœ¬æ˜¯ä¸æ”¯æŒçš„ï¼‰ï¼Œä½†æ˜¯ hive æ¨èä½¿ç”¨ semi join çš„æ–¹å¼æ¥ä»£æ›¿ å®ç°ï¼Œè€Œä¸”æ•ˆç‡æ›´é«˜ã€‚ <ul><li>åŠè¿æ¥<ul><li>å·¦åŠè¿æ¥ï¼šleft semi joinï¼Œä»¥å·¦è¡¨ä¸ºåŸºè¡¨ï¼Œå³è¡¨æœ‰çš„ï¼Œåªæ˜¾ç¤ºå·¦è¡¨ç›¸åº”è®°å½•ï¼ˆå³ä¸€åŠï¼‰</li><li>å³åŠè¿æ¥ï¼šright semi joinï¼Œä¸å·¦åŠè¿æ¥ç›¸å</li></ul></li><li>å†…è¿æ¥ï¼šinner joinï¼Œä¸¤è¡¨ä¸­éƒ½æœ‰çš„æ‰ä¼šè¿æ¥</li><li>å¤–è¿æ¥<ul><li>å·¦å¤–è¿æ¥ï¼šleft outer joinï¼Œåæ ‡ä¸ºåŸºè¡¨ï¼Œå³è¡¨æœ‰çš„ä¼šå…³è”ï¼Œå³è¡¨æ²¡æœ‰çš„ä»¥nullè¡¨ç¤ºï¼›å·¦è¡¨æ²¡æœ‰å³è¡¨æœ‰çš„ä¸ä¼šå…³è”</li><li>å³å¤–è¿æ¥ï¼šright outer joinï¼Œä¸å·¦å¤–è¿æ¥ç›¸å</li><li>å…¨å¤–è¿æ¥ï¼šfull outer joinï¼Œä¸¤è¡¨åˆå¹¶</li></ul></li></ul></li><li>7ã€æ”¯æŒ case â€¦ when â€¦</li></ul></li><li><strong>è¯­æ³•ç»“æ„</strong><ul><li><code>SELECT [ALL | DISTINCT] select_ condition, select_ condition, ...</code></li><li>FROM table_name a </li><li>[JOIN table_other b ON <a href="http://a.id" target="_blank" rel="noopener">a.id</a> = <a href="http://b.id" target="_blank" rel="noopener">b.id</a>]<br>è¡¨è¿æ¥</li><li>[WHERE where_condition]<br>è¿‡æ»¤æ¡ä»¶</li><li>[GROUP BY col_list [HAVING condition]]<br>åˆ†ç»„æ¡ä»¶</li><li>[CLUSTER BY col_list | [DISTRIBUTE BY col_list] [SORT BY col_list | ORDER BY col_list] [DESC]]<br>æ’åºæ¡ä»¶ï¼š<br>\1. order byï¼šå…¨å±€æ’åºï¼Œé»˜è®¤å‡åºï¼ŒDESCè¡¨ç¤ºé™åºã€‚åªæœ‰ä¸€ä¸ª reduce task çš„ç»“æœï¼Œæ¯”å¦‚æ–‡<br>ä»¶åæ˜¯ 000000_0ï¼Œä¼šå¯¼è‡´å½“è¾“å…¥è§„æ¨¡è¾ƒå¤§æ—¶ï¼Œéœ€è¦è¾ƒé•¿çš„è®¡ç®—æ—¶é—´ã€‚<br>\2.  sort byï¼šå±€éƒ¨æ’åºï¼Œå…¶åœ¨æ•°æ®è¿›å…¥ reducer å‰å®Œæˆæ’åºã€‚å› æ­¤ï¼Œå¦‚æœç”¨ sort by è¿›è¡Œæ’åºï¼Œå¹¶ä¸”è®¾ç½®  mapred.reduce.tasks &gt; 1ï¼Œåˆ™ sort by åªä¿è¯æ¯ä¸ª reducer çš„è¾“å‡ºæœ‰åºï¼Œä¸ä¿è¯å…¨å±€æœ‰åºã€‚<br>\3. distribute byï¼šç±»ä¼¼äºåˆ†æ¡¶ï¼Œæ ¹æ®æŒ‡å®šçš„å­—æ®µå°†æ•°æ®åˆ†åˆ°ä¸åŒçš„ reducerï¼Œä¸”åˆ†å‘ç®—æ³•æ˜¯ hash æ•£åˆ—<br>\4. cluster byï¼šé™¤äº†å…·æœ‰ Distribute by çš„åŠŸèƒ½å¤–ï¼Œè¿˜ä¼šå¯¹è¯¥å­—æ®µè¿›è¡Œæ’åºã€‚<br>æ³¨æ„ï¼šå¦‚æœ distribute å’Œ sort å­—æ®µæ˜¯åŒä¸€ä¸ªæ—¶ï¼Œcluster by = distribute by + sort byï¼›<br>å¦‚æœåˆ†æ¡¶å­—æ®µå’Œæ’åºå­—æ®µä¸ä¸€æ ·ï¼Œé‚£ä¹ˆå°±ä¸èƒ½ä½¿ç”¨ clustered by </li><li>[LIMIT number]<br>æ˜¾ç¤ºç»“æœçš„å‰å‡ ä¸ªè®°å½•</li></ul></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Hiveç®€ä»‹&quot;&gt;&lt;a href=&quot;#Hiveç®€ä»‹&quot; class=&quot;headerlink&quot; title=&quot;Hiveç®€ä»‹&quot;&gt;&lt;/a&gt;Hiveç®€ä»‹&lt;/h1&gt;&lt;p&gt;&lt;img src=&quot;http://p6i5vzkfk.bkt.clouddn.com/study/2018-
      
    
    </summary>
    
      <category term="Hadoop" scheme="https://airpoet.github.io/categories/Hadoop/"/>
    
      <category term="Hive" scheme="https://airpoet.github.io/categories/Hadoop/Hive/"/>
    
    
      <category term="åŸåˆ›" scheme="https://airpoet.github.io/tags/%E5%8E%9F%E5%88%9B/"/>
    
      <category term="æŠ€æœ¯" scheme="https://airpoet.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="Hadoop" scheme="https://airpoet.github.io/tags/Hadoop/"/>
    
      <category term="Hive" scheme="https://airpoet.github.io/tags/Hive/"/>
    
  </entry>
  
  <entry>
    <title>å¶ç„¶å‘ç°çš„å¥½æ­Œ</title>
    <link href="https://airpoet.github.io/2018/06/11/Songs/%E5%81%B6%E7%84%B6%E5%8F%91%E7%8E%B0%E7%9A%84%E5%A5%BD%E6%AD%8C/"/>
    <id>https://airpoet.github.io/2018/06/11/Songs/å¶ç„¶å‘ç°çš„å¥½æ­Œ/</id>
    <published>2018-06-11T11:04:05.646Z</published>
    <updated>2018-06-11T11:32:43.834Z</updated>
    
    <content type="html"><![CDATA[ <blockquote class="blockquote-center"><h1 id="Dealbreaker"><a href="#Dealbreaker" class="headerlink" title="Dealbreaker"></a>Dealbreaker</h1><ul><li>ä¸“è¾‘ï¼š<a href="orpheus://orpheus/pub/app.html#/m/album/?id=1715512" target="_blank" rel="noopener">Chesapeake</a></li><li>æ­Œæ‰‹ï¼š<a href="orpheus://orpheus/pub/app.html#/m/artist/?id=72720" target="_blank" rel="noopener">Rachael Yamagata</a></li><li>é“¾æ¥ï¼š<a href="http://music.163.com/#/m/song?id=18733198" target="_blank" rel="noopener">http://music.163.com/#/m/song?id=18733198</a></li></ul><p><br></p><h1 id="You-Wonâ€™t-Let-Me"><a href="#You-Wonâ€™t-Let-Me" class="headerlink" title="You Wonâ€™t Let Me"></a>You Wonâ€™t Let Me</h1><ul><li>ä¸“è¾‘ï¼š<a href="orpheus://orpheus/pub/app.html#/m/album/?id=1715512" target="_blank" rel="noopener">Chesapeake</a></li><li>æ­Œæ‰‹ï¼š<a href="orpheus://orpheus/pub/app.html#/m/artist/?id=72720" target="_blank" rel="noopener">Rachael Yamagata</a></li><li>é“¾æ¥ï¼š<a href="http://music.163.com/#/song?id=18733192" target="_blank" rel="noopener">http://music.163.com/#/song?id=18733192</a></li></ul></blockquote>]]></content>
    
    <summary type="html">
    
      
      
         &lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;h1 id=&quot;Dealbreaker&quot;&gt;&lt;a href=&quot;#Dealbreaker&quot; class=&quot;headerlink&quot; title=&quot;Dealbreaker&quot;&gt;&lt;/a&gt;Dealbreaker&lt;/h
      
    
    </summary>
    
      <category term="æ–‡è‰º" scheme="https://airpoet.github.io/categories/%E6%96%87%E8%89%BA/"/>
    
      <category term="Songs" scheme="https://airpoet.github.io/categories/%E6%96%87%E8%89%BA/Songs/"/>
    
    
      <category term="åŸåˆ›" scheme="https://airpoet.github.io/tags/%E5%8E%9F%E5%88%9B/"/>
    
      <category term="æ–‡è‰º" scheme="https://airpoet.github.io/tags/%E6%96%87%E8%89%BA/"/>
    
      <category term="Songs" scheme="https://airpoet.github.io/tags/Songs/"/>
    
  </entry>
  
  <entry>
    <title>_HDFSåº”ç”¨åœºæ™¯&amp;åŸç†&amp;åŸºæœ¬æ¶æ„åŠä½¿ç”¨æ–¹æ³•</title>
    <link href="https://airpoet.github.io/2018/06/11/Hadoop/1-HDFS/HDFS%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF&amp;%E5%8E%9F%E7%90%86&amp;%E5%9F%BA%E6%9C%AC%E6%9E%B6%E6%9E%84%E5%8F%8A%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/"/>
    <id>https://airpoet.github.io/2018/06/11/Hadoop/1-HDFS/HDFSåº”ç”¨åœºæ™¯&amp;åŸç†&amp;åŸºæœ¬æ¶æ„åŠä½¿ç”¨æ–¹æ³•/</id>
    <published>2018-06-11T00:01:43.146Z</published>
    <updated>2018-06-11T16:27:43.347Z</updated>
    
    <content type="html"><![CDATA[<h1 id="HDFSåŸºæœ¬æ¶æ„å’ŒåŸç†"><a href="#HDFSåŸºæœ¬æ¶æ„å’ŒåŸç†" class="headerlink" title="HDFSåŸºæœ¬æ¶æ„å’ŒåŸç†"></a>HDFSåŸºæœ¬æ¶æ„å’ŒåŸç†</h1><h2 id="HDFSè®¾è®¡æ€æƒ³"><a href="#HDFSè®¾è®¡æ€æƒ³" class="headerlink" title="HDFSè®¾è®¡æ€æƒ³"></a>HDFSè®¾è®¡æ€æƒ³</h2><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-11-142401.png" alt="image-20180611222401493"></p><h2 id="HDFSæ¶æ„"><a href="#HDFSæ¶æ„" class="headerlink" title="HDFSæ¶æ„"></a>HDFSæ¶æ„</h2><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-11-142442.png" alt="image-20180611222442066"></p><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-11-142505.png" alt="image-20180611222505133"></p><h2 id="HDFSæ•°æ®å—ï¼ˆblockï¼‰"><a href="#HDFSæ•°æ®å—ï¼ˆblockï¼‰" class="headerlink" title="HDFSæ•°æ®å—ï¼ˆblockï¼‰"></a>HDFSæ•°æ®å—ï¼ˆblockï¼‰</h2><ul><li><strong>æ³¨æ„ï¼š Hadoop2.xï¼Œblocké»˜è®¤å¤§å°æ˜¯128MB</strong></li></ul><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-11-142646.png" alt="image-20180611222645888"></p><h2 id="HDFSå†™æµç¨‹"><a href="#HDFSå†™æµç¨‹" class="headerlink" title="HDFSå†™æµç¨‹"></a>HDFSå†™æµç¨‹</h2><ul><li>åˆ›å»ºDistributed FileSystemç±» </li><li>è¯¢é—® NameNode è¦å†™çš„æ–‡ä»¶å¯¹å¦å­˜åœ¨</li><li>ä¸å­˜åœ¨å°±å†™å…¥åˆ° FSDataOutputStream æµä¸­</li><li>æµå†™å‡ºå»åˆ°ä¸€ä¸ª DataNode</li><li>â€¦</li></ul><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-11-143228.png" alt="image-20180611223228053"></p><h2 id="HDFSè¯»æµç¨‹"><a href="#HDFSè¯»æµç¨‹" class="headerlink" title="HDFSè¯»æµç¨‹"></a>HDFSè¯»æµç¨‹</h2><ul><li>å®¢æˆ·ç«¯å‘ NameNode è¯¢é—® block çš„ä½ç½®</li><li>æŒ‰ç…§å®¢æˆ·ç«¯æŒ‰ç…§æ‹¿åˆ°çš„ä½ç½®ï¼Œå‘ä¸åŒçš„DataNode è¯·æ±‚æ•°æ®</li><li>â€¦â€¦</li></ul><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-11-143510.png" alt="image-20180611223510239"></p><h2 id="HDFSå…¸å‹ç‰©ç†æ‹“æ‰‘"><a href="#HDFSå…¸å‹ç‰©ç†æ‹“æ‰‘" class="headerlink" title="HDFSå…¸å‹ç‰©ç†æ‹“æ‰‘"></a>HDFSå…¸å‹ç‰©ç†æ‹“æ‰‘</h2><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-11-143914.png" alt="image-20180611223914168"></p><h2 id="HDFSå‰¯æœ¬æ”¾ç½®ç­–ç•¥"><a href="#HDFSå‰¯æœ¬æ”¾ç½®ç­–ç•¥" class="headerlink" title="HDFSå‰¯æœ¬æ”¾ç½®ç­–ç•¥"></a>HDFSå‰¯æœ¬æ”¾ç½®ç­–ç•¥</h2><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-11-143940.png" alt="image-20180611223939952"></p><h2 id="HDFSå¯é æ€§ç­–ç•¥"><a href="#HDFSå¯é æ€§ç­–ç•¥" class="headerlink" title="HDFSå¯é æ€§ç­–ç•¥"></a>HDFSå¯é æ€§ç­–ç•¥</h2><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-11-144153.png" alt="image-20180611224152799"></p><h2 id="HDFSä¸é€‚åˆå­˜å‚¨å°æ–‡ä»¶"><a href="#HDFSä¸é€‚åˆå­˜å‚¨å°æ–‡ä»¶" class="headerlink" title="HDFSä¸é€‚åˆå­˜å‚¨å°æ–‡ä»¶"></a>HDFSä¸é€‚åˆå­˜å‚¨å°æ–‡ä»¶</h2><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-11-144344.png" alt="image-20180611224344481"></p><p><br></p><h1 id="HDFSç¨‹åºè®¾è®¡"><a href="#HDFSç¨‹åºè®¾è®¡" class="headerlink" title="HDFSç¨‹åºè®¾è®¡"></a>HDFSç¨‹åºè®¾è®¡</h1><h2 id="HDFSè®¿é—®æ–¹å¼"><a href="#HDFSè®¿é—®æ–¹å¼" class="headerlink" title="HDFSè®¿é—®æ–¹å¼"></a>HDFSè®¿é—®æ–¹å¼</h2><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-11-144935.png" alt="image-20180611224934785"></p><h2 id="HDFS-Shellå‘½ä»¤"><a href="#HDFS-Shellå‘½ä»¤" class="headerlink" title="HDFS Shellå‘½ä»¤"></a>HDFS Shellå‘½ä»¤</h2><h3 id="æ¦‚è§ˆ"><a href="#æ¦‚è§ˆ" class="headerlink" title="æ¦‚è§ˆ"></a>æ¦‚è§ˆ</h3><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-11-145132.png" alt="image-20180611225131966"></p><h3 id="HDFS-Shellå‘½ä»¤â€”æ–‡ä»¶æ“ä½œå‘½ä»¤"><a href="#HDFS-Shellå‘½ä»¤â€”æ–‡ä»¶æ“ä½œå‘½ä»¤" class="headerlink" title="HDFS Shellå‘½ä»¤â€”æ–‡ä»¶æ“ä½œå‘½ä»¤"></a>HDFS Shellå‘½ä»¤â€”æ–‡ä»¶æ“ä½œå‘½ä»¤</h3><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-11-145219.png" alt="image-20180611225219211"></p><h3 id="HDFS-Shellå‘½ä»¤â€”æ–‡ä»¶æ“ä½œå‘½ä»¤-1"><a href="#HDFS-Shellå‘½ä»¤â€”æ–‡ä»¶æ“ä½œå‘½ä»¤-1" class="headerlink" title="HDFS Shellå‘½ä»¤â€”æ–‡ä»¶æ“ä½œå‘½ä»¤"></a>HDFS Shellå‘½ä»¤â€”æ–‡ä»¶æ“ä½œå‘½ä»¤</h3><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-11-145604.png" alt="image-20180611225604218"></p><h3 id="HDFS-Shellå‘½ä»¤â€”ç®¡ç†å‘½ä»¤"><a href="#HDFS-Shellå‘½ä»¤â€”ç®¡ç†å‘½ä»¤" class="headerlink" title="HDFS Shellå‘½ä»¤â€”ç®¡ç†å‘½ä»¤"></a>HDFS Shellå‘½ä»¤â€”ç®¡ç†å‘½ä»¤</h3><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-11-145728.png" alt="image-20180611225727910"></p><h3 id="HDFS-Shellå‘½ä»¤â€”ç®¡ç†è„šæœ¬"><a href="#HDFS-Shellå‘½ä»¤â€”ç®¡ç†è„šæœ¬" class="headerlink" title="HDFS Shellå‘½ä»¤â€”ç®¡ç†è„šæœ¬"></a>HDFS Shellå‘½ä»¤â€”ç®¡ç†è„šæœ¬</h3><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-11-145803.png" alt="image-20180611225802894"></p><h3 id="HDFS-Shellå‘½ä»¤â€”æ–‡ä»¶ç®¡ç†å‘½ä»¤fsck"><a href="#HDFS-Shellå‘½ä»¤â€”æ–‡ä»¶ç®¡ç†å‘½ä»¤fsck" class="headerlink" title="HDFS Shellå‘½ä»¤â€”æ–‡ä»¶ç®¡ç†å‘½ä»¤fsck"></a>HDFS Shellå‘½ä»¤â€”æ–‡ä»¶ç®¡ç†å‘½ä»¤fsck</h3><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-11-145932.png" alt="image-20180611225931880"></p><ul><li><strong>æŸ¥çœ‹å¸®åŠ©</strong></li></ul><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-11-145915.png" alt="image-20180611225914482"></p><ul><li><strong>ç”¨æ³•ç¤ºä¾‹</strong></li></ul><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-11-150253.png" alt="image-20180611230252655"></p><h3 id="HDFS-Shellå‘½ä»¤â€”æ•°æ®å‡è¡¡å™¨balancer"><a href="#HDFS-Shellå‘½ä»¤â€”æ•°æ®å‡è¡¡å™¨balancer" class="headerlink" title="HDFS Shellå‘½ä»¤â€”æ•°æ®å‡è¡¡å™¨balancer"></a>HDFS Shellå‘½ä»¤â€”æ•°æ®å‡è¡¡å™¨balancer</h3><ul><li><strong>ä¸€èˆ¬è®¾ç½®10% â€”â€” 15% å°±å·®ä¸å¤šäº†</strong></li></ul><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-11-150614.png" alt="image-20180611230613854"></p><h3 id="HDFS-Shellå‘½ä»¤â€”è®¾ç½®ç›®å½•ä»½é¢"><a href="#HDFS-Shellå‘½ä»¤â€”è®¾ç½®ç›®å½•ä»½é¢" class="headerlink" title="HDFS Shellå‘½ä»¤â€”è®¾ç½®ç›®å½•ä»½é¢"></a>HDFS Shellå‘½ä»¤â€”è®¾ç½®ç›®å½•ä»½é¢</h3><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-11-150704.png" alt="image-20180611230703142"></p><h3 id="â€»-HDFS-Shellå‘½ä»¤â€”å¢åŠ -ç§»é™¤èŠ‚ç‚¹-â€»"><a href="#â€»-HDFS-Shellå‘½ä»¤â€”å¢åŠ -ç§»é™¤èŠ‚ç‚¹-â€»" class="headerlink" title="â€» HDFS Shellå‘½ä»¤â€”å¢åŠ /ç§»é™¤èŠ‚ç‚¹ â€»"></a>â€» HDFS Shellå‘½ä»¤â€”å¢åŠ /ç§»é™¤èŠ‚ç‚¹ â€»</h3><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-11-150741.png" alt="image-20180611230741126"></p><h2 id="HDFS-Java"><a href="#HDFS-Java" class="headerlink" title="HDFS Java"></a>HDFS Java</h2><h3 id="APIä»‹ç»"><a href="#APIä»‹ç»" class="headerlink" title="APIä»‹ç»"></a>APIä»‹ç»</h3><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-11-150953.png" alt="image-20180611230953359"></p><h3 id="HDFS-Javaç¨‹åºä¸¾ä¾‹"><a href="#HDFS-Javaç¨‹åºä¸¾ä¾‹" class="headerlink" title="HDFS Javaç¨‹åºä¸¾ä¾‹"></a>HDFS Javaç¨‹åºä¸¾ä¾‹</h3><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-11-151048.png" alt="image-20180611231047354"></p><h2 id="HDFS-å¤šè¯­è¨€APIâ€”å€ŸåŠ©thrift"><a href="#HDFS-å¤šè¯­è¨€APIâ€”å€ŸåŠ©thrift" class="headerlink" title="HDFS å¤šè¯­è¨€APIâ€”å€ŸåŠ©thrift"></a>HDFS å¤šè¯­è¨€APIâ€”å€ŸåŠ©thrift</h2><p><a href="http://thrift.apache.org/" target="_blank" rel="noopener">ä¹Ÿæ˜¯Apacheçš„é¡¶çº§é¡¹ç›®</a></p><h3 id="thriftæ‰§è¡Œæµç¨‹"><a href="#thriftæ‰§è¡Œæµç¨‹" class="headerlink" title="thriftæ‰§è¡Œæµç¨‹"></a>thriftæ‰§è¡Œæµç¨‹</h3><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-11-151149.png" alt="image-20180611231148955"></p><h3 id="hadoopfs-thriftæ¥å£å®šä¹‰"><a href="#hadoopfs-thriftæ¥å£å®šä¹‰" class="headerlink" title="hadoopfs.thriftæ¥å£å®šä¹‰"></a>hadoopfs.thriftæ¥å£å®šä¹‰</h3><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-11-151634.png" alt="image-20180611231634046"></p><h3 id="PHPè¯­è¨€è®¿é—®HDFS"><a href="#PHPè¯­è¨€è®¿é—®HDFS" class="headerlink" title="PHPè¯­è¨€è®¿é—®HDFS"></a>PHPè¯­è¨€è®¿é—®HDFS</h3><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-11-151654.png" alt="image-20180611231653750"></p><h3 id="Pythonè¯­è¨€è®¿é—®HDFS"><a href="#Pythonè¯­è¨€è®¿é—®HDFS" class="headerlink" title="Pythonè¯­è¨€è®¿é—®HDFS"></a>Pythonè¯­è¨€è®¿é—®HDFS</h3><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-11-152052.png" alt="image-20180611232052633"></p><hr><h1 id="Hadoop-2-0æ–°ç‰¹æ€§"><a href="#Hadoop-2-0æ–°ç‰¹æ€§" class="headerlink" title="Hadoop 2.0æ–°ç‰¹æ€§"></a>Hadoop 2.0æ–°ç‰¹æ€§</h1><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-11-152948.png" alt="image-20180611232948514"></p><h2 id="HA-é«˜å¯ç”¨-ä¸Federation-è”é‚¦"><a href="#HA-é«˜å¯ç”¨-ä¸Federation-è”é‚¦" class="headerlink" title="HA(é«˜å¯ç”¨)ä¸Federation(è”é‚¦)"></a>HA(é«˜å¯ç”¨)ä¸Federation(è”é‚¦)</h2><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-11-153058.png" alt="image-20180611233058385"></p><h2 id="å¼‚æ„å±‚çº§å­˜å‚¨ç»“æ„"><a href="#å¼‚æ„å±‚çº§å­˜å‚¨ç»“æ„" class="headerlink" title="å¼‚æ„å±‚çº§å­˜å‚¨ç»“æ„"></a>å¼‚æ„å±‚çº§å­˜å‚¨ç»“æ„</h2><h3 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h3><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-11-153117.png" alt="image-20180611233117295"></p><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-11-153206.png" alt="image-20180611233206158"></p><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-11-153228.png" alt="image-20180611233227447"></p><h2 id="HDFS-ACL"><a href="#HDFS-ACL" class="headerlink" title="HDFS ACL"></a>HDFS ACL</h2><h3 id="èƒŒæ™¯ï¼šç°æœ‰æƒé™ç®¡ç†çš„å±€é™æ€§"><a href="#èƒŒæ™¯ï¼šç°æœ‰æƒé™ç®¡ç†çš„å±€é™æ€§" class="headerlink" title="èƒŒæ™¯ï¼šç°æœ‰æƒé™ç®¡ç†çš„å±€é™æ€§"></a>èƒŒæ™¯ï¼šç°æœ‰æƒé™ç®¡ç†çš„å±€é™æ€§</h3><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-11-153255.png" alt="image-20180611233255196"></p><h3 id="åŸºäºPOSIX-ACLçš„å®ç°"><a href="#åŸºäºPOSIX-ACLçš„å®ç°" class="headerlink" title="åŸºäºPOSIX ACLçš„å®ç°"></a>åŸºäºPOSIX ACLçš„å®ç°</h3><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-11-153310.png" alt="image-20180611233310082"></p><h2 id="HDFSå¿«ç…§"><a href="#HDFSå¿«ç…§" class="headerlink" title="HDFSå¿«ç…§"></a>HDFSå¿«ç…§</h2><h3 id="èƒŒæ™¯-1"><a href="#èƒŒæ™¯-1" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h3><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-11-153338.png" alt="image-20180611233337709"></p><h3 id="åŸºæœ¬ä½¿ç”¨æ–¹æ³•"><a href="#åŸºæœ¬ä½¿ç”¨æ–¹æ³•" class="headerlink" title="åŸºæœ¬ä½¿ç”¨æ–¹æ³•"></a>åŸºæœ¬ä½¿ç”¨æ–¹æ³•</h3><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-11-153358.png" alt="image-20180611233357356"></p><h2 id="HDFSç¼“å­˜"><a href="#HDFSç¼“å­˜" class="headerlink" title="HDFSç¼“å­˜"></a>HDFSç¼“å­˜</h2><h3 id="èƒŒæ™¯-2"><a href="#èƒŒæ™¯-2" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h3><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-11-153423.png" alt="image-20180611233423131"></p><h3 id="åŸç†-1"><a href="#åŸç†-1" class="headerlink" title="åŸç†"></a>åŸç†</h3><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-11-153446.png" alt="image-20180611233446072"></p><h3 id="å®ç°æƒ…å†µ"><a href="#å®ç°æƒ…å†µ" class="headerlink" title="å®ç°æƒ…å†µ"></a>å®ç°æƒ…å†µ</h3><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-11-153502.png" alt="image-20180611233502379"></p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-11-153521.png" alt="image-20180611233521502"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;HDFSåŸºæœ¬æ¶æ„å’ŒåŸç†&quot;&gt;&lt;a href=&quot;#HDFSåŸºæœ¬æ¶æ„å’ŒåŸç†&quot; class=&quot;headerlink&quot; title=&quot;HDFSåŸºæœ¬æ¶æ„å’ŒåŸç†&quot;&gt;&lt;/a&gt;HDFSåŸºæœ¬æ¶æ„å’ŒåŸç†&lt;/h1&gt;&lt;h2 id=&quot;HDFSè®¾è®¡æ€æƒ³&quot;&gt;&lt;a href=&quot;#HDFSè®¾è®¡æ€æƒ³&quot;
      
    
    </summary>
    
      <category term="Hadoop" scheme="https://airpoet.github.io/categories/Hadoop/"/>
    
      <category term="HDFS" scheme="https://airpoet.github.io/categories/Hadoop/HDFS/"/>
    
    
      <category term="åŸåˆ›" scheme="https://airpoet.github.io/tags/%E5%8E%9F%E5%88%9B/"/>
    
      <category term="æŠ€æœ¯" scheme="https://airpoet.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="Hadoop" scheme="https://airpoet.github.io/tags/Hadoop/"/>
    
      <category term="HDFS" scheme="https://airpoet.github.io/tags/HDFS/"/>
    
  </entry>
  
  <entry>
    <title>å…³äºhexoçš„æ—¶åºå›¾æ’ä»¶ hexo-filter-sequence çš„å·¨å‘</title>
    <link href="https://airpoet.github.io/2018/06/10/Tools/Hexo/%E5%85%B3%E4%BA%8Ehexo%E7%9A%84%E6%97%B6%E5%BA%8F%E5%9B%BE%E6%8F%92%E4%BB%B6-hexo-filter-sequence-%E7%9A%84%E5%B7%A8%E5%9D%91/"/>
    <id>https://airpoet.github.io/2018/06/10/Tools/Hexo/å…³äºhexoçš„æ—¶åºå›¾æ’ä»¶-hexo-filter-sequence-çš„å·¨å‘/</id>
    <published>2018-06-10T13:13:02.149Z</published>
    <updated>2018-06-10T13:19:32.909Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨å†™ä»£ç çš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°æ—¶åºå›¾è¿˜æ˜¯æŒºç®¡ç”¨çš„ï¼Œç®€æ´æ˜äº†ï¼Œäºæ˜¯æƒ³ç”¨ä¸€ç”¨ã€‚</p><p>ç»“æœå‘åˆ°ç«™ä¸Šï¼Œä¸æ˜¾ç¤ºã€‚</p><p>åœ¨ç½‘ä¸ŠæŸ¥äº†ä¸‹ï¼Œå‘ç°æ˜¯hexoæ‰€ä½¿ç”¨çš„Markdownæ¸²æŸ“è¯­æ³•ä¸æ”¯æŒã€‚</p><p>è¿™é‡Œåæ§½ä¸‹ï¼Œè¿™é‡Œæ¸²æŸ“çš„ç¡®å®çƒ‚ï¼Œä½œè€…ä¸ºå•¥ä¸æ”¹æ”¹..</p><p><br></p><p>äºæ˜¯å¼€å§‹æ‰¾è§£å†³æ–¹æ¡ˆï¼Œå‘ç°å¤§å¤šæ•°éƒ½æ¨èäº†ä¸€ä¸ªå«<code>hexo-filter-sequence</code>çš„æ’ä»¶ï¼Œæ•…å®‰è£…ä¹‹ã€‚</p><p>ç»“æœæ­»æ´»è¿˜æ˜¯ä¸è¡Œã€‚</p><p>è£…äº†å…¶å®ƒçš„å‡ ä¸ªflowå›¾ï¼Œå´å¯ä»¥æ˜¾ç¤ºã€‚</p><p><strong>å½“flowå›¾å’Œsequenceå›¾åŒæ—¶å­˜åœ¨çš„æ—¶å€™ï¼Œsequenceå¯ä»¥æ˜¾ç¤ºï¼Œä½†æ˜¯sequenceå•ç‹¬å­˜åœ¨æ—¶ï¼Œæ­»æ´»ä¸æ˜¾ç¤ºã€‚</strong></p><p>éš¾ä¸æˆæœ‰å•¥ä¾èµ–ï¼Ÿå¿…é¡»å…ˆä½¿ç”¨flowæ‰èƒ½ä½¿ç”¨sequenceï¼Ÿé€»è¾‘ä¸Šä¸åº”è¯¥å•Šï¼</p><p>ä½†æ˜¯äº‹å®å´æ˜¯è¿™æ ·ï¼</p><p><br></p><p>ç½‘ä¸Šæœ‰ä¸€ç¯‡å¤§ç¥è¯´è¦æ”¹æºç æ‰è¡Œï¼Œå¼€å§‹æ²¡æ³¨æ„ï¼Œè§‰å¾—åº”è¯¥ä¸ä¼šå§ï¼Œè¿™ä¹ˆå¤šäººä½¿ç”¨ï¼Œæºç è¿˜ä¼šæœ‰é—®é¢˜ï¼Ÿï¼Ÿ</p><p><strong>ä»”ç»†ä¸€çœ‹æºç ï¼Œå¦ˆçš„ï¼ï¼å¿ƒé‡Œåƒä¸‡åŒ¹è‰æ³¥é©¬å‘¼å•¸è€Œè¿‡ï¼</strong></p><p><strong>æŠŠåˆå§‹åŒ– sequenceï¼Œå†™æˆäº†åˆå§‹åŒ– flowï¼ï¼ï¼</strong></p><p><strong>æŠŠ flow æ”¹æˆ sequenceï¼Œ å†æŠŠ js CDNæºæ¢æˆå›½å†…çš„ï¼</strong></p><p><strong>å¯ä»¥äº†ï¼ï¼</strong></p><p>å†ä»”ç»†ä¸€çœ‹ï¼Œå‘ç°æœ€åä¸€æ¬¡æ›´æ–°æ˜¯åœ¨1å¹´å‰ï¼</p><p>å‘çˆ¹çš„ä½œè€…ï¼Œæµªè´¹äº†æˆ‘è‡³å°‘3-5ä¸ªå°æ—¶ï¼ï¼</p><p><br></p><hr><h2 id="ä¸‹é¢ä¸ºéƒ¨åˆ†æ‘˜æŠ„"><a href="#ä¸‹é¢ä¸ºéƒ¨åˆ†æ‘˜æŠ„" class="headerlink" title="ä¸‹é¢ä¸ºéƒ¨åˆ†æ‘˜æŠ„"></a>ä¸‹é¢ä¸ºéƒ¨åˆ†æ‘˜æŠ„</h2><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p><a href="https://github.com/bubkoo/hexo-filter-sequence" target="_blank" rel="noopener">hexo-filter-sequence</a> æ’ä»¶:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save hexo-filter-sequence</span><br></pre></td></tr></table></figure><h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><p>ç«™ç‚¹é…ç½®æ–‡ä»¶ <code>_config.yml</code> ä¸­å¢åŠ å¦‚ä¸‹é…ç½®:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sequence:</span><br><span class="line">  webfont: https:<span class="comment">//cdn.bootcss.com/webfont/1.6.28/webfontloader.js</span></span><br><span class="line">  raphael: https:<span class="comment">//cdn.bootcss.com/raphael/2.2.7/raphael.min.js</span></span><br><span class="line">  underscore: https:<span class="comment">//cdn.bootcss.com/underscore.js/1.8.3/underscore-min.js</span></span><br><span class="line">  sequence: https:<span class="comment">//cdn.bootcss.com/js-sequence-diagrams/1.0.6/sequence-diagram-min.js</span></span><br><span class="line">  css: # optional, the url for css, such as hand drawn theme </span><br><span class="line">  options: </span><br><span class="line">    theme: simple</span><br><span class="line">    css_class:</span><br></pre></td></tr></table></figure><h3 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h3><p>æºç ä¿®æ”¹åæ‰èƒ½æ­£å¸¸ä½¿ç”¨ï¼Œè¿›å…¥æ’ä»¶ç›®å½•ä½œå¦‚ä¸‹ä¿®æ”¹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">var</span> assign = <span class="built_in">require</span>(<span class="string">'deep-assign'</span>);</span><br><span class="line"><span class="keyword">var</span> renderer = <span class="built_in">require</span>(<span class="string">'./lib/renderer'</span>);</span><br><span class="line"></span><br><span class="line">hexo.config.sequence = assign(&#123;</span><br><span class="line">  webfont: <span class="string">'https://cdn.bootcss.com/webfont/1.6.28/webfontloader.js'</span>,</span><br><span class="line">  raphael: <span class="string">'https://cdn.bootcss.com/raphael/2.2.7/raphael.min.js'</span>,</span><br><span class="line">  underscore: <span class="string">'https://cdn.bootcss.com/underscore.js/1.8.3/underscore-min.js'</span>,</span><br><span class="line">  sequence: <span class="string">'https://cdn.bootcss.com/js-sequence-diagrams/1.0.6/sequence-diagram-min.js'</span>,</span><br><span class="line">  css: <span class="string">''</span>,</span><br><span class="line">  options: &#123;</span><br><span class="line">    theme: <span class="string">'simple'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;, hexo.config.sequence);</span><br><span class="line"></span><br><span class="line">hexo.extend.filter.register(<span class="string">'before_post_render'</span>, renderer.render, <span class="number">9</span>);</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// lib/renderer.js, 25 è¡Œ</span></span><br><span class="line"><span class="keyword">if</span> (sequences.length) &#123;</span><br><span class="line">      <span class="keyword">var</span> config = <span class="keyword">this</span>.config.sequence;</span><br><span class="line">      <span class="comment">// resources</span></span><br><span class="line">      data.content += <span class="string">'&lt;script src="'</span> + config.webfont + <span class="string">'"&gt;&lt;/script&gt;'</span>;</span><br><span class="line">      data.content += <span class="string">'&lt;script src="'</span> + config.raphael + <span class="string">'"&gt;&lt;/script&gt;'</span>;</span><br><span class="line">      data.content += <span class="string">'&lt;script src="'</span> + config.underscore + <span class="string">'"&gt;&lt;/script&gt;'</span>;</span><br><span class="line">      data.content += <span class="string">'&lt;script src="'</span> + config.sequence + <span class="string">'"&gt;&lt;/script&gt;'</span>;</span><br><span class="line">      ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><p>æ–°å»ºä»£ç å—ï¼Œå¢åŠ å¦‚ä¸‹å†…å®¹ï¼š</p><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-10-131910.png" alt="image-20180610211909603"></p><div id="sequence-0"></div><p><a href="http://wewelove.github.io/fcoder/2017/09/06/markdown-sequence/index.html" target="_blank" rel="noopener">è¯¦æƒ…å‚è€ƒ</a></p><p><script src="https://cdn.bootcss.com/webfont/1.6.28/webfontloader.js"></script><script src="https://cdn.bootcss.com/snap.svg/0.5.1/snap.svg-min.js"></script><script src="https://cdn.bootcss.com/raphael/2.2.7/raphael.min.js"></script><script src="https://cdn.bootcss.com/underscore.js/1.8.3/underscore-min.js"></script><script src="https://cdn.bootcss.com/js-sequence-diagrams/1.0.6/sequence-diagram-min.js"></script><textarea id="sequence-0-code" style="display: none">Alice->Bob: Hello Bob, how are you?Note right of Bob: Bob thinksBob-->Alice: I am good thanks!</textarea><textarea id="sequence-0-options" style="display: none">{"theme":"simple"}</textarea><script>  var code = document.getElementById("sequence-0-code").value;  var options = JSON.parse(decodeURIComponent(document.getElementById("sequence-0-options").value));  var diagram = Diagram.parse(code);  diagram.drawSVG("sequence-0", options);</script></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;åœ¨å†™ä»£ç çš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°æ—¶åºå›¾è¿˜æ˜¯æŒºç®¡ç”¨çš„ï¼Œç®€æ´æ˜äº†ï¼Œäºæ˜¯æƒ³ç”¨ä¸€ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;ç»“æœå‘åˆ°ç«™ä¸Šï¼Œä¸æ˜¾ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ç½‘ä¸ŠæŸ¥äº†ä¸‹ï¼Œå‘ç°æ˜¯
      
    
    </summary>
    
      <category term="å·¥å…·" scheme="https://airpoet.github.io/categories/%E5%B7%A5%E5%85%B7/"/>
    
      <category term="hexo" scheme="https://airpoet.github.io/categories/%E5%B7%A5%E5%85%B7/hexo/"/>
    
    
      <category term="åŸåˆ›" scheme="https://airpoet.github.io/tags/%E5%8E%9F%E5%88%9B/"/>
    
      <category term="å·¥å…·" scheme="https://airpoet.github.io/tags/%E5%B7%A5%E5%85%B7/"/>
    
      <category term="hexo" scheme="https://airpoet.github.io/tags/hexo/"/>
    
  </entry>
  
  <entry>
    <title>MapReduce-åˆ†ç»„æµ…æ¢</title>
    <link href="https://airpoet.github.io/2018/06/10/Hadoop/2-MapReduce/MapReduce-%E5%88%86%E7%BB%84%E6%B5%85%E6%8E%A2/"/>
    <id>https://airpoet.github.io/2018/06/10/Hadoop/2-MapReduce/MapReduce-åˆ†ç»„æµ…æ¢/</id>
    <published>2018-06-10T08:49:24.337Z</published>
    <updated>2018-06-11T11:46:23.533Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>æœ€è¿‘å­¦åˆ†ç»„çš„æ—¶å€™ï¼Œä¸€ç›´å¼„ä¸æ˜ç™½ï¼Œæ€»æ„Ÿè§‰ä¸€å¤´é›¾æ°´ï¼Œé€šè¿‡è¿‘3ä¸ªå°æ—¶çš„æ–­ç‚¹è°ƒè¯•å’Œlogè¾“å‡ºã€‚ å¤§æ¦‚äº†è§£äº†ä¸€äº›è¡¨è±¡ï¼Œå…ˆè®°å½•ã€‚</p><p>æ¡ˆä¾‹æ˜¯è¿™ä¸ª</p><blockquote><p>æ±‚å‡ºæ¯é—¨è¯¾ç¨‹å‚è€ƒå­¦ç”Ÿæˆç»©æœ€é«˜å¹³å‡åˆ†çš„å­¦ç”Ÿçš„ä¿¡æ¯ï¼š</p><p>è¯¾ç¨‹ï¼Œå§“åå’Œå¹³å‡åˆ†ï¼Œè¯¦ç»†è§<a href="https://airpoet.github.io/2018/06/09/Hadoop/Study/MapReduce%E7%AC%94%E8%AE%B0-%E7%BB%83%E4%B9%A0/"><sup>MapReduceç¬”è®°-ç»ƒä¹ ç¬¬äºŒé¢˜ç¬¬3å°é¢˜</sup></a></p><p>æ•°æ®æ ¼å¼æ˜¯è¿™æ ·çš„ï¼š</p><blockquote><p>ç¬¬ä¸€ä¸ªæ˜¯è¯¾ç¨‹åç§°ï¼Œæ€»å…±å››ä¸ªè¯¾ç¨‹ï¼Œcomputerï¼Œmathï¼Œenglishï¼Œalgorithmï¼Œ</p><p>ç¬¬äºŒä¸ªæ˜¯å­¦ç”Ÿå§“åï¼Œåé¢æ˜¯æ¯æ¬¡è€ƒè¯•çš„åˆ†æ•°</p><p><em>math,huangxiaoming,85,75,85,99,66,88,75,91</em></p><p><em>english,huanglei,85,75,85,99,66,88,75,91</em></p><p>â€¦ </p></blockquote></blockquote><p><br></p><p><br></p><h3 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h3><div id="sequence-0"></div><h4 id="æ‰§è¡Œæµç¨‹ç»“è®º"><a href="#æ‰§è¡Œæµç¨‹ç»“è®º" class="headerlink" title="æ‰§è¡Œæµç¨‹ç»“è®º"></a><strong>æ‰§è¡Œæµç¨‹ç»“è®º</strong></h4><ul><li>mapæ¯è¯»ä¸€è¡Œå°± write åˆ° context ä¸€æ¬¡ï¼ŒæŒ‰ç…§æŒ‡å®šçš„<code>key</code>è¿›è¡Œåˆ†å‘</li><li><p>map æŠŠæ‰€æœ‰çš„æ•°æ®éƒ½è¯»å®Œäº†ä¹‹åï¼Œå¤§æ¦‚æ‰§è¡Œåˆ°<code>67%</code>çš„æ—¶å€™ï¼Œå¼€å§‹è¿›å…¥ <code>CustomBean</code>ï¼Œæ‰§è¡Œ<code>CustomBean</code>çš„<code>compareTo()</code>æ–¹æ³•ï¼Œä¼šæŒ‰ç…§è‡ªå·±å†™çš„è§„åˆ™ä¸€æ¡ä¸€æ¡æ•°æ®æ¯”è¾ƒ</p></li><li><p>ä¸Šè¿°éƒ½æ¯”è¾ƒå®Œæ¯•ä¹‹åï¼Œmapé˜¶æ®µå°±ç»“æŸäº†ï¼Œæ­¤æ—¶æ¥åˆ°äº† reduceé˜¶æ®µï¼Œä½†æ˜¯æ˜¯åˆ°äº†<code>67%</code>äº†</p></li><li>åˆ°äº†reduceé˜¶æ®µï¼Œç›´æ¥è¿›å…¥äº†<strong>MyGroup</strong>ä¸­è‡ªå®šä¹‰çš„<strong>compare</strong>æ–¹æ³•ã€‚</li><li>MyGroupçš„<code>compare()</code>æ–¹æ³•ï¼Œå¦‚æœè¿”å›<strong>é0</strong>ï¼Œ å°±ä¼šè¿›å…¥ reduce æ–¹æ³•<strong>å†™å‡ºåˆ°context</strong></li></ul><h4 id="MyGroupè¿›å…¥Reduceçš„æ¡ä»¶æ˜¯"><a href="#MyGroupè¿›å…¥Reduceçš„æ¡ä»¶æ˜¯" class="headerlink" title="MyGroupè¿›å…¥Reduceçš„æ¡ä»¶æ˜¯"></a><strong>MyGroupè¿›å…¥Reduceçš„æ¡ä»¶æ˜¯</strong></h4><ul><li>MyReduceä¸­ï¼Œå¦‚æœcompareçš„ç»“æœä¸ç­‰äº0ï¼Œä¹Ÿå°±æ˜¯æ¯”è¾ƒçš„2è€…ä¸ç›¸åŒï¼Œ æ­¤æ—¶å°±è¿›å…¥Reduceï¼Œ å†™å‡ºåˆ°ä¸Šä¸‹æ–‡</li><li>å¦‚æœç›¸åŒï¼Œä¼šä¸€ç›´å¾€ä¸‹è¯»ï¼Œç›´åˆ°è¯»åˆ°ä¸åŒçš„ï¼Œ æ­¤æ—¶å†™å‡ºè¯»åˆ°ä¸Šä¸‹æ–‡ã€‚</li><li>å› ä¸ºMyGroupä¼šåœ¨Reduceé˜¶æ®µæ‰§è¡Œï¼Œè€Œ<code>CustomBean</code>ä¸­çš„<code>compareTo()</code>æ˜¯åœ¨mapé˜¶æ®µæ‰§è¡Œï¼Œæ‰€ä»¥éœ€è¦åœ¨<code>CustomBean</code>ä¸­å°±æŠŠç»„æ’å¥½åºï¼Œæ­¤æ—¶<strong>åˆ†ç»„åŠŸèƒ½</strong>æ‰èƒ½æ­£å¸¸è¿ä½œ</li></ul><h4 id="æŒ‡å®šåˆ†ç»„ç±»MyGroupå’Œä¸æŒ‡å®šçš„åŒºåˆ«"><a href="#æŒ‡å®šåˆ†ç»„ç±»MyGroupå’Œä¸æŒ‡å®šçš„åŒºåˆ«" class="headerlink" title="æŒ‡å®šåˆ†ç»„ç±»MyGroupå’Œä¸æŒ‡å®šçš„åŒºåˆ«"></a>æŒ‡å®šåˆ†ç»„ç±»MyGroupå’Œä¸æŒ‡å®šçš„åŒºåˆ«</h4><p><em>æŒ‡å®šä¸ä¸æŒ‡å®šæ˜¯æŒ‡ï¼šåœ¨Driverç±»ä¸­ï¼Œæ˜¯å¦åŠ ä¸Š<code>job.setGroupingComparatorClass(MyGrouper.class);</code>è¿™ä¸€å¥ã€‚</em></p><ul><li><strong>æŒ‡å®šåˆ†ç»„ç±»</strong>ï¼š<ul><li>ä¼šæŒ‰ç…§åˆ†ç»„ç±»ä¸­ï¼Œè‡ªå®šä¹‰çš„<code>compare()</code>æ–¹æ³•æ¯”è¾ƒï¼Œç›¸åŒçš„ä¸ºä¸€ç»„ï¼Œåˆ†å®Œä¸€ç»„å°±è¿›å…¥ä¸€æ¬¡reduceæ–¹æ³•</li></ul></li><li><strong>ä¸æŒ‡å®šåˆ†ç»„ç±»ï¼šï¼ˆç›®å‰å­˜ç–‘ï¼‰</strong><ul><li>æ˜¯å¦æ˜¯æŒ‰ç…§keyè¿›è¡Œåˆ†ç»„</li><li>å¦‚æœæ˜¯è‡ªå®šä¹‰ç±»ä¸ºkeyï¼Œæ˜¯å¦æ˜¯æŒ‰ç…§æ­¤keyä¸­å€¼ç›¸åŒçš„åˆ†ä¸ºä¸€ç»„</li><li>å¦‚æœæ˜¯hadoopå†…ç½®ç±»ï¼Œæ˜¯å¦æ˜¯æŒ‰ç…§æ­¤ç±»çš„å€¼åˆ†ç»„ï¼ˆText-Stringçš„å€¼ï¼ŒIntWritable-intå€¼ç­‰..ï¼‰</li><li><strong>ä¾ç„¶æ˜¯èµ°å¾—ä»¥ä¸Šè¿™å¥—åˆ†ç»„é€»è¾‘ï¼Œä¸€ç»„çš„æ•°æ®è¯»å®Œæ‰è¿›å…¥åˆ°Reduceé˜¶æ®µåšå½’å¹¶</strong></li></ul></li></ul><p><br></p><p><br></p><h3 id="Logä¿¡æ¯"><a href="#Logä¿¡æ¯" class="headerlink" title="Logä¿¡æ¯"></a>Logä¿¡æ¯</h3><h5 id="CustomBeanä¸­æ²¡æœ‰è¿›è¡Œåˆ†ç»„-ç»„å†…æ’åºçš„log"><a href="#CustomBeanä¸­æ²¡æœ‰è¿›è¡Œåˆ†ç»„-ç»„å†…æ’åºçš„log" class="headerlink" title="CustomBeanä¸­æ²¡æœ‰è¿›è¡Œåˆ†ç»„, ç»„å†…æ’åºçš„log"></a><code>CustomBean</code>ä¸­æ²¡æœ‰è¿›è¡Œ<code>åˆ†ç»„</code>, <code>ç»„å†…æ’åº</code>çš„log</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ==================MyGroupä¸­compare()æ–¹æ³•=======================</span></span><br><span class="line">computer---MyGroupä¸­æ¯”è¾ƒ---computer</span><br><span class="line">computer---MyGroupä¸­æ¯”è¾ƒ---math</span><br><span class="line">math---MyGroupä¸­æ¯”è¾ƒ---english</span><br><span class="line">english---MyGroupä¸­æ¯”è¾ƒ---math</span><br><span class="line">math---MyGroupä¸­æ¯”è¾ƒ---algorithm</span><br><span class="line">algorithm---MyGroupä¸­æ¯”è¾ƒ---algorithm</span><br><span class="line">algorithm---MyGroupä¸­æ¯”è¾ƒ---computer</span><br><span class="line">computer---MyGroupä¸­æ¯”è¾ƒ---english</span><br><span class="line">english---MyGroupä¸­æ¯”è¾ƒ---algorithm</span><br><span class="line">algorithm---MyGroupä¸­æ¯”è¾ƒ---math</span><br><span class="line">math---MyGroupä¸­æ¯”è¾ƒ---algorithm</span><br><span class="line">algorithm---MyGroupä¸­æ¯”è¾ƒ---math</span><br><span class="line">math---MyGroupä¸­æ¯”è¾ƒ---computer</span><br><span class="line">computer---MyGroupä¸­æ¯”è¾ƒ---english</span><br><span class="line">english---MyGroupä¸­æ¯”è¾ƒ---math</span><br><span class="line">math---MyGroupä¸­æ¯”è¾ƒ---computer</span><br><span class="line">computer---MyGroupä¸­æ¯”è¾ƒ---math</span><br><span class="line">math---MyGroupä¸­æ¯”è¾ƒ---english</span><br><span class="line">english---MyGroupä¸­æ¯”è¾ƒ---computer</span><br><span class="line">computer---MyGroupä¸­æ¯”è¾ƒ---computer</span><br><span class="line">computer---MyGroupä¸­æ¯”è¾ƒ---english</span><br><span class="line">english---MyGroupä¸­æ¯”è¾ƒ---computer</span><br><span class="line">computer---MyGroupä¸­æ¯”è¾ƒ---algorithm</span><br><span class="line">algorithm---MyGroupä¸­æ¯”è¾ƒ---english</span><br><span class="line">english---MyGroupä¸­æ¯”è¾ƒ---computer</span><br><span class="line">computer---MyGroupä¸­æ¯”è¾ƒ---english</span><br><span class="line">english---MyGroupä¸­æ¯”è¾ƒ---english</span><br><span class="line">english---MyGroupä¸­æ¯”è¾ƒ---math</span><br><span class="line">math---MyGroupä¸­æ¯”è¾ƒ---algorithm</span><br><span class="line">algorithm---MyGroupä¸­æ¯”è¾ƒ---computer</span><br><span class="line">computer---MyGroupä¸­æ¯”è¾ƒ---english</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ======================reduceä¸­çš„æ‰§è¡Œlog==========================</span></span><br><span class="line"></span><br><span class="line">==================ç¬¬<span class="number">1</span>æ¬¡è¿›å…¥reduce</span><br><span class="line">computerhuangjiaju<span class="number">83.2</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">computerliutao<span class="number">83.0</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">==================ç¬¬<span class="number">2</span>æ¬¡è¿›å…¥reduce</span><br><span class="line">mathhuangxiaoming<span class="number">83.0</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">==================ç¬¬<span class="number">3</span>æ¬¡è¿›å…¥reduce</span><br><span class="line">englishhuanglei<span class="number">83.0</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">==================ç¬¬<span class="number">4</span>æ¬¡è¿›å…¥reduce</span><br><span class="line">mathhuangjiaju<span class="number">82.28571428571429</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">==================ç¬¬<span class="number">5</span>æ¬¡è¿›å…¥reduce</span><br><span class="line">algorithmhuangjiaju<span class="number">82.28571428571429</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">algorithmliutao<span class="number">82.0</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">==================ç¬¬<span class="number">6</span>æ¬¡è¿›å…¥reduce</span><br><span class="line">computerhuanglei<span class="number">74.42857142857143</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">==================ç¬¬<span class="number">7</span>æ¬¡è¿›å…¥reduce</span><br><span class="line">englishliuyifei<span class="number">74.42857142857143</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">==================ç¬¬<span class="number">8</span>æ¬¡è¿›å…¥reduce</span><br><span class="line">algorithmhuanglei<span class="number">74.42857142857143</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">==================ç¬¬<span class="number">9</span>æ¬¡è¿›å…¥reduce</span><br><span class="line">mathhuanglei<span class="number">74.42857142857143</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">==================ç¬¬<span class="number">10</span>æ¬¡è¿›å…¥reduce</span><br><span class="line">algorithmhuangzitao<span class="number">72.75</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">==================ç¬¬<span class="number">11</span>æ¬¡è¿›å…¥reduce</span><br><span class="line">mathliujialing<span class="number">72.75</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">==================ç¬¬<span class="number">12</span>æ¬¡è¿›å…¥reduce</span><br><span class="line">computerhuangzitao<span class="number">72.42857142857143</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">==================ç¬¬<span class="number">13</span>æ¬¡è¿›å…¥reduce</span><br><span class="line">englishhuangxiaoming<span class="number">72.42857142857143</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">==================ç¬¬<span class="number">14</span>æ¬¡è¿›å…¥reduce</span><br><span class="line">mathwangbaoqiang<span class="number">72.42857142857143</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">==================ç¬¬<span class="number">15</span>æ¬¡è¿›å…¥reduce</span><br><span class="line">computerhuangxiaoming<span class="number">72.42857142857143</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">==================ç¬¬<span class="number">16</span>æ¬¡è¿›å…¥reduce</span><br><span class="line">mathxuzheng<span class="number">69.28571428571429</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">==================ç¬¬<span class="number">17</span>æ¬¡è¿›å…¥reduce</span><br><span class="line">englishzhaobenshan<span class="number">69.28571428571429</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">==================ç¬¬<span class="number">18</span>æ¬¡è¿›å…¥reduce</span><br><span class="line">computerhuangbo<span class="number">65.25</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">computerxuzheng<span class="number">65.0</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">==================ç¬¬<span class="number">19</span>æ¬¡è¿›å…¥reduce</span><br><span class="line">englishzhouqi<span class="number">64.18181818181819</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">==================ç¬¬<span class="number">20</span>æ¬¡è¿›å…¥reduce</span><br><span class="line">computerliujialing<span class="number">64.11111111111111</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">==================ç¬¬<span class="number">21</span>æ¬¡è¿›å…¥reduce</span><br><span class="line">algorithmliuyifei<span class="number">62.142857142857146</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">==================ç¬¬<span class="number">22</span>æ¬¡è¿›å…¥reduce</span><br><span class="line">englishliujialing<span class="number">62.142857142857146</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">==================ç¬¬<span class="number">23</span>æ¬¡è¿›å…¥reduce</span><br><span class="line">computerliuyifei<span class="number">62.142857142857146</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">==================ç¬¬<span class="number">24</span>æ¬¡è¿›å…¥reduce</span><br><span class="line">englishliuyifei<span class="number">59.57142857142857</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">englishhuangdatou<span class="number">56.0</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">==================ç¬¬<span class="number">25</span>æ¬¡è¿›å…¥reduce</span><br><span class="line">mathliutao<span class="number">56.0</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">==================ç¬¬<span class="number">26</span>æ¬¡è¿›å…¥reduce</span><br><span class="line">algorithmhuangdatou<span class="number">56.0</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">==================ç¬¬<span class="number">27</span>æ¬¡è¿›å…¥reduce</span><br><span class="line">computerhuangdatou<span class="number">56.0</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">==================ç¬¬<span class="number">28</span>æ¬¡è¿›å…¥reduce</span><br><span class="line">englishhuangbo<span class="number">55.0</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br></pre></td></tr></table></figure><h5 id="CustomBeanä¸­åšäº†åˆ†ç»„-amp-ç»„å†…æ’åº-çš„"><a href="#CustomBeanä¸­åšäº†åˆ†ç»„-amp-ç»„å†…æ’åº-çš„" class="headerlink" title="CustomBeanä¸­åšäº†åˆ†ç»„&amp;ç»„å†…æ’åº çš„"></a><code>CustomBean</code>ä¸­åšäº†<code>åˆ†ç»„&amp;ç»„å†…æ’åº</code> çš„</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// **Beanä¸­ç›¸åŒçš„ç»„è¿›è¡Œåˆ†æ•°é™åºï¼Œ ç»„è¿›è¡Œå­—å…¸æ’åºï¼Œæ­¤æ—¶MyGroupä¸­æ‰§è¡Œçš„**</span></span><br><span class="line"></span><br><span class="line">algorithm---MyGroupä¸­æ¯”è¾ƒ---algorithm</span><br><span class="line">algorithm---MyGroupä¸­æ¯”è¾ƒ---algorithm</span><br><span class="line">algorithm---MyGroupä¸­æ¯”è¾ƒ---algorithm</span><br><span class="line">algorithm---MyGroupä¸­æ¯”è¾ƒ---algorithm</span><br><span class="line">algorithm---MyGroupä¸­æ¯”è¾ƒ---algorithm</span><br><span class="line">algorithm---MyGroupä¸­æ¯”è¾ƒ---computer</span><br><span class="line">computer---MyGroupä¸­æ¯”è¾ƒ---computer</span><br><span class="line">computer---MyGroupä¸­æ¯”è¾ƒ---computer</span><br><span class="line">computer---MyGroupä¸­æ¯”è¾ƒ---computer</span><br><span class="line">computer---MyGroupä¸­æ¯”è¾ƒ---computer</span><br><span class="line">computer---MyGroupä¸­æ¯”è¾ƒ---computer</span><br><span class="line">computer---MyGroupä¸­æ¯”è¾ƒ---computer</span><br><span class="line">computer---MyGroupä¸­æ¯”è¾ƒ---computer</span><br><span class="line">computer---MyGroupä¸­æ¯”è¾ƒ---computer</span><br><span class="line">computer---MyGroupä¸­æ¯”è¾ƒ---computer</span><br><span class="line">computer---MyGroupä¸­æ¯”è¾ƒ---english</span><br><span class="line">english---MyGroupä¸­æ¯”è¾ƒ---english</span><br><span class="line">english---MyGroupä¸­æ¯”è¾ƒ---english</span><br><span class="line">english---MyGroupä¸­æ¯”è¾ƒ---english</span><br><span class="line">english---MyGroupä¸­æ¯”è¾ƒ---english</span><br><span class="line">english---MyGroupä¸­æ¯”è¾ƒ---english</span><br><span class="line">english---MyGroupä¸­æ¯”è¾ƒ---english</span><br><span class="line">english---MyGroupä¸­æ¯”è¾ƒ---english</span><br><span class="line">english---MyGroupä¸­æ¯”è¾ƒ---english</span><br><span class="line">english---MyGroupä¸­æ¯”è¾ƒ---math</span><br><span class="line">math---MyGroupä¸­æ¯”è¾ƒ---math</span><br><span class="line">math---MyGroupä¸­æ¯”è¾ƒ---math</span><br><span class="line">math---MyGroupä¸­æ¯”è¾ƒ---math</span><br><span class="line">math---MyGroupä¸­æ¯”è¾ƒ---math</span><br><span class="line">math---MyGroupä¸­æ¯”è¾ƒ---math</span><br><span class="line">math---MyGroupä¸­æ¯”è¾ƒ---math</span><br><span class="line"></span><br><span class="line"><span class="comment">// ======================reduceä¸­æ‰§è¡Œ==========================</span></span><br><span class="line"></span><br><span class="line">==================ç¬¬<span class="number">1</span>æ¬¡è¿›å…¥reduce</span><br><span class="line">algorithmhuangjiaju<span class="number">82.28571428571429</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">algorithmliutao<span class="number">82.0</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">algorithmhuanglei<span class="number">74.42857142857143</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">algorithmhuangzitao<span class="number">72.75</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">algorithmliuyifei<span class="number">62.142857142857146</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">algorithmhuangdatou<span class="number">56.0</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">===================ç¦»å¼€reduce</span><br><span class="line">==================ç¬¬<span class="number">2</span>æ¬¡è¿›å…¥reduce</span><br><span class="line">computerhuangjiaju<span class="number">83.2</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">computerliutao<span class="number">83.0</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">computerhuanglei<span class="number">74.42857142857143</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">computerhuangzitao<span class="number">72.42857142857143</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">computerhuangxiaoming<span class="number">72.42857142857143</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">computerhuangbo<span class="number">65.25</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">computerxuzheng<span class="number">65.0</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">computerliujialing<span class="number">64.11111111111111</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">computerliuyifei<span class="number">62.142857142857146</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">computerhuangdatou<span class="number">56.0</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">===================ç¦»å¼€reduce</span><br><span class="line">==================ç¬¬<span class="number">3</span>æ¬¡è¿›å…¥reduce</span><br><span class="line">englishhuanglei<span class="number">83.0</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">englishliuyifei<span class="number">74.42857142857143</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">englishhuangxiaoming<span class="number">72.42857142857143</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">englishzhaobenshan<span class="number">69.28571428571429</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">englishzhouqi<span class="number">64.18181818181819</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">englishliujialing<span class="number">62.142857142857146</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">englishliuyifei<span class="number">59.57142857142857</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">englishhuangdatou<span class="number">56.0</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">englishhuangbo<span class="number">55.0</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">===================ç¦»å¼€reduce</span><br><span class="line">==================ç¬¬<span class="number">4</span>æ¬¡è¿›å…¥reduce</span><br><span class="line">mathhuangxiaoming<span class="number">83.0</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">mathhuangjiaju<span class="number">82.28571428571429</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">mathhuanglei<span class="number">74.42857142857143</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">mathliujialing<span class="number">72.75</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">mathwangbaoqiang<span class="number">72.42857142857143</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">mathxuzheng<span class="number">69.28571428571429</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">mathliutao<span class="number">56.0</span></span><br><span class="line">---------in <span class="keyword">for</span> write------</span><br><span class="line">===================ç¦»å¼€reduce</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ å¦‚æœåªå–ä¸€ä¸ªæ¯æ¬¡valuesçš„ç¬¬ä¸€ä¸ªçš„è¯ ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿ï£¿</span></span><br><span class="line"></span><br><span class="line">algorithmhuangjiaju<span class="number">82.28571428571429</span></span><br><span class="line">==================ç¬¬<span class="number">1</span>æ¬¡è¿›å…¥reduce</span><br><span class="line">computerhuangjiaju<span class="number">83.2</span></span><br><span class="line">==================ç¬¬<span class="number">2</span>æ¬¡è¿›å…¥reduce</span><br><span class="line">englishhuanglei<span class="number">83.0</span></span><br><span class="line">==================ç¬¬<span class="number">3</span>æ¬¡è¿›å…¥reduce</span><br><span class="line">mathhuangxiaoming<span class="number">83.0</span></span><br><span class="line">==================ç¬¬<span class="number">4</span>æ¬¡è¿›å…¥reduce</span><br></pre></td></tr></table></figure><p><br></p><p><br></p><h3 id="å…¶å®ƒç–‘ç‚¹"><a href="#å…¶å®ƒç–‘ç‚¹" class="headerlink" title="å…¶å®ƒç–‘ç‚¹"></a>å…¶å®ƒç–‘ç‚¹</h3><ul><li>é€šè¿‡logå¯ä»¥çœ‹å‡ºæ¥ï¼Œ MyGroupæ˜¯åœ¨è¯»åˆ°äº†ä¸åŒçš„æ•°æ®ï¼Œæ‰ä¼šè¿›å…¥åˆ° reduce ç±»ä¸­å†™å‡ºï¼›</li><li>ä½†æ˜¯ é€šè¿‡ <strong>æ–­ç‚¹è°ƒè¯•</strong>æ—¶ï¼Œ ç°è±¡æ˜¯ï¼Œç¬¬ä¸€æ¬¡è¯»åˆ°äº†2ä¸ªç›¸åŒçš„ï¼Œå°±å»reduceå»å†™å‡ºäº†ï¼›</li><li>åé¢å†è¯»çš„å°±ä¸åšå†™å‡ºæ“ä½œï¼Œç›´åˆ°ä¸‹ä¸€æ¬¡è¯»åˆ°2ä¸ªç›¸åŒçš„ï¼Œå†åœ¨reduceä¸­å†™å‡ºã€‚</li></ul><p><script src="https://cdn.bootcss.com/webfont/1.6.28/webfontloader.js"></script><script src="https://cdn.bootcss.com/snap.svg/0.5.1/snap.svg-min.js"></script><script src="https://cdn.bootcss.com/raphael/2.2.7/raphael.min.js"></script><script src="https://cdn.bootcss.com/underscore.js/1.8.3/underscore-min.js"></script><script src="https://cdn.bootcss.com/js-sequence-diagrams/1.0.6/sequence-diagram-min.js"></script><textarea id="sequence-0-code" style="display: none">title:ï£¿ï£¿ï£¿ï£¿ï£¿ æ‰§è¡Œæµç¨‹æ—¶åºå›¾ ï£¿ï£¿ï£¿ï£¿ï£¿Mapper(map)->ScoreBean: k:ScoreBean(courseName,avgScore)Mapper(map)->ScoreBean: v:Text(stuName)Mapper(ScoreBean)->Reducer(MyGroup): courseæŒ‰å­—å…¸å‡åºMapper(ScoreBean)->Reducer(MyGroup): courseå†…æˆç»©é™åºReducer(MyGroup)->Reducer(reduce): æ ¹æ®è‡ªå®šä¹‰çš„åˆ†ç»„è§„åˆ™æŒ‰ç»„è¾“å‡ºReducer(MyGroup)->Reducer(reduce): ä¸€ç»„åªè°ƒç”¨reduceä¸€æ¬¡Reducer(reduce)-->Reducer(reduce):</textarea><textarea id="sequence-0-options" style="display: none">{"theme":"simple"}</textarea><script>  var code = document.getElementById("sequence-0-code").value;  var options = JSON.parse(decodeURIComponent(document.getElementById("sequence-0-options").value));  var diagram = Diagram.parse(code);  diagram.drawSVG("sequence-0", options);</script></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h3&gt;&lt;p&gt;æœ€è¿‘å­¦åˆ†ç»„çš„æ—¶å€™ï¼Œä¸€ç›´å¼„ä¸æ˜ç™½ï¼Œæ€»æ„Ÿè§‰ä¸€å¤´é›¾æ°´ï¼Œé€šè¿‡è¿‘3ä¸ªå°æ—¶çš„æ–­ç‚¹è°ƒè¯•å’Œlogè¾“å‡ºã€‚ å¤§æ¦‚äº†è§£äº†ä¸€äº›è¡¨è±¡ï¼Œå…ˆè®°å½•ã€‚&lt;/p&gt;
&lt;p&gt;æ¡ˆä¾‹æ˜¯è¿™
      
    
    </summary>
    
      <category term="Hadoop" scheme="https://airpoet.github.io/categories/Hadoop/"/>
    
      <category term="MapReduce" scheme="https://airpoet.github.io/categories/Hadoop/MapReduce/"/>
    
    
      <category term="åŸåˆ›" scheme="https://airpoet.github.io/tags/%E5%8E%9F%E5%88%9B/"/>
    
      <category term="æŠ€æœ¯" scheme="https://airpoet.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="Hadoop" scheme="https://airpoet.github.io/tags/Hadoop/"/>
    
      <category term="MapReduce" scheme="https://airpoet.github.io/tags/MapReduce/"/>
    
  </entry>
  
  <entry>
    <title>â–å¼€å§‹</title>
    <link href="https://airpoet.github.io/2018/06/10/Poetry/%E5%BC%80%E5%A7%8B/"/>
    <id>https://airpoet.github.io/2018/06/10/Poetry/å¼€å§‹/</id>
    <published>2018-06-09T17:03:10.001Z</published>
    <updated>2018-06-09T17:19:40.887Z</updated>
    
    <content type="html"><![CDATA[<blockquote class="blockquote-center"><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-09-601528563678_.pic.jpg" alt=""></p><p>æœˆäº®è½ä¸‹ä¸€ä¸¤ç‰‡ç¾½æ¯›åœ¨ç”°é‡ä¸Šã€‚</p><p>é»‘æš—ä¸­çš„éº¦å­è†å¬ç€ã€‚</p><p>å¿«é™ä¸‹æ¥ã€‚</p><p>å¿«ã€‚</p><p>å°±åœ¨é‚£å„¿ï¼Œæœˆäº®çš„å­©å­ä»¬æ­£è¯•ç€</p><p>æŒ¥åŠ¨ç¿…è†€ã€‚</p><p>åœ¨ä¸¤æ£µæ ‘ä¹‹é—´ï¼Œèº«æä¿®é•¿çš„å¥³å­æŠ¬èµ·é¢åºï¼Œ</p><p>ç¾ä¸½çš„å‰ªå½±ã€‚æ¥ç€ï¼Œå¥¹æ­¥å…¥ç©ºä¸­ï¼Œæ¥ç€ï¼Œ</p><p>å¥¹å®Œå…¨æ¶ˆå¤±åœ¨ç©ºä¸­ã€‚</p><p>æˆ‘ç‹¬è‡ªç«™åœ¨ä¸€æ£µæ¥éª¨æœ¨æ—ï¼Œä¸æ•¢å‘¼å¸ï¼Œ</p><p>ä¹Ÿä¸æ•¢åŠ¨ã€‚</p><p>æˆ‘è†å¬ç€ã€‚</p><p>éº¦å­å‘åé ç€è‡ªå·±çš„é»‘æš—ï¼Œ</p><p>è€Œæˆ‘é ç€æˆ‘çš„ã€‚</p><p><br></p><p><strong>ä½œè€… / [ç¾å›½] è©¹å§†æ–¯Â·èµ–ç‰¹</strong></p><p>ç¿»è¯‘ / å¼ æ–‡æ­¦</p><hr><h3 id="â–Beginning"><a href="#â–Beginning" class="headerlink" title="â–Beginning"></a><strong>â–Beginning</strong></h3><p><br></p><p>The moon drops one or two feathers into the fields.</p><p>The dark wheat listens.</p><p>Be still.</p><p>Now.</p><p>There they are, the moonâ€™s young, trying</p><p>Their wings.</p><p>Between trees, a slender woman lifts up the lovely shadow</p><p>Of her face, and now she steps into the air, now she is gone</p><p>Wholly, into the air.</p><p>I stand alone by an elder tree, I do not dare breathe</p><p>Or move.</p><p>I listen.</p><p>The wheat leans back toward its own darkness,</p><p>And I lean toward mine.</p><p><br></p><p><strong>Author / James Wright</strong></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;p&gt;&lt;img src=&quot;http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-09-601528563678_.pic.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;æœˆ
      
    
    </summary>
    
      <category term="æ–‡è‰º" scheme="https://airpoet.github.io/categories/%E6%96%87%E8%89%BA/"/>
    
      <category term="è¯—æ­Œ" scheme="https://airpoet.github.io/categories/%E6%96%87%E8%89%BA/%E8%AF%97%E6%AD%8C/"/>
    
    
      <category term="è¯—æ­Œ" scheme="https://airpoet.github.io/tags/%E8%AF%97%E6%AD%8C/"/>
    
  </entry>
  
  <entry>
    <title>Markdowné«˜é˜¶è¯­æ³•</title>
    <link href="https://airpoet.github.io/2018/06/10/Tools/Markdown/Markdown%E9%AB%98%E9%98%B6%E8%AF%AD%E6%B3%95/"/>
    <id>https://airpoet.github.io/2018/06/10/Tools/Markdown/Markdowné«˜é˜¶è¯­æ³•/</id>
    <published>2018-06-09T16:49:50.407Z</published>
    <updated>2018-06-10T13:21:24.745Z</updated>
    
    <content type="html"><![CDATA[<h3 id="æ—¶åºå›¾çš„å†™æ³•"><a href="#æ—¶åºå›¾çš„å†™æ³•" class="headerlink" title="æ—¶åºå›¾çš„å†™æ³•"></a>æ—¶åºå›¾çš„å†™æ³•</h3><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-09-165900.png" alt="image-20180610005859980"></p><div id="sequence-0"></div><h3 id="æµç¨‹å›¾çš„å†™æ³•"><a href="#æµç¨‹å›¾çš„å†™æ³•" class="headerlink" title="æµç¨‹å›¾çš„å†™æ³•"></a>æµç¨‹å›¾çš„å†™æ³•</h3><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-09-165930.png" alt="image-20180610005930019"></p><div id="flowchart-0" class="flow-chart"></div><h3 id="ç±»å›¾çš„å†™æ³•"><a href="#ç±»å›¾çš„å†™æ³•" class="headerlink" title="ç±»å›¾çš„å†™æ³•"></a>ç±»å›¾çš„å†™æ³•</h3><p><img src="http://p6i5vzkfk.bkt.clouddn.com/study/2018-06-09-165948.png" alt="image-20180610005948130"></p><p><img src="https://www.plantuml.com/plantuml/svg/SoWkIImgAStDuKhEIImkLl2jz4qiA4Wjud98pKi12WC0"></p><p><script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.2.7/raphael.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/flowchart/1.6.5/flowchart.min.js"></script><textarea id="flowchart-0-code" style="display: none">st=>start: Start|past:>http://www.google.com[blank]e=>end: End:>http://www.google.comop1=>operation: My Operation|pastop2=>operation: Stuff|currentsub1=>subroutine: My Subroutine|invalidcond=>condition: Yesor No?|approved:>http://www.google.comc2=>condition: Good idea|rejectedio=>inputoutput: catch something...|requestst->op1(right)->condcond(yes, right)->c2cond(no)->sub1(left)->op1c2(yes)->io->ec2(no)->op2->e</textarea><textarea id="flowchart-0-options" style="display: none">{"scale":1,"line-width":2,"line-length":50,"text-margin":10,"font-size":12}</textarea><script>  var code = document.getElementById("flowchart-0-code").value;  var options = JSON.parse(decodeURIComponent(document.getElementById("flowchart-0-options").value));  var diagram = flowchart.parse(code);  diagram.drawSVG("flowchart-0", options);</script><script src="https://cdn.bootcss.com/webfont/1.6.28/webfontloader.js"></script><script src="https://cdn.bootcss.com/snap.svg/0.5.1/snap.svg-min.js"></script><script src="https://cdn.bootcss.com/raphael/2.2.7/raphael.min.js"></script><script src="https://cdn.bootcss.com/underscore.js/1.8.3/underscore-min.js"></script><script src="https://cdn.bootcss.com/js-sequence-diagrams/1.0.6/sequence-diagram-min.js"></script><textarea id="sequence-0-code" style="display: none">mapper->Bob: Hello Bob, how are you?Note right of Bob: Bob thinksBob-->reducer: I am good thanks!ad u?reducer->out: I'm fine tooout->me: ok, you winme-->Bob: nono, not</textarea><textarea id="sequence-0-options" style="display: none">{"theme":"simple"}</textarea><script>  var code = document.getElementById("sequence-0-code").value;  var options = JSON.parse(decodeURIComponent(document.getElementById("sequence-0-options").value));  var diagram = Diagram.parse(code);  diagram.drawSVG("sequence-0", options);</script></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;æ—¶åºå›¾çš„å†™æ³•&quot;&gt;&lt;a href=&quot;#æ—¶åºå›¾çš„å†™æ³•&quot; class=&quot;headerlink&quot; title=&quot;æ—¶åºå›¾çš„å†™æ³•&quot;&gt;&lt;/a&gt;æ—¶åºå›¾çš„å†™æ³•&lt;/h3&gt;&lt;p&gt;&lt;img src=&quot;http://p6i5vzkfk.bkt.clouddn.com/study/2018-
      
    
    </summary>
    
      <category term="å·¥å…·" scheme="https://airpoet.github.io/categories/%E5%B7%A5%E5%85%B7/"/>
    
      <category term="Markdown" scheme="https://airpoet.github.io/categories/%E5%B7%A5%E5%85%B7/Markdown/"/>
    
    
      <category term="åŸåˆ›" scheme="https://airpoet.github.io/tags/%E5%8E%9F%E5%88%9B/"/>
    
      <category term="å·¥å…·" scheme="https://airpoet.github.io/tags/%E5%B7%A5%E5%85%B7/"/>
    
      <category term="Markdown" scheme="https://airpoet.github.io/tags/Markdown/"/>
    
  </entry>
  
</feed>
